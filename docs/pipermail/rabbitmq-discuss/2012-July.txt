From brett.r.cameron at gmail.com  Sun Jul  1 10:04:20 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Sun, 1 Jul 2012 21:04:20 +1200
Subject: [rabbitmq-discuss] Moving on
In-Reply-To: <CAHfw-YO5mcfA=_shJ_Yx7Pi9sOBMkBE0QMff_YOP1-8task+ZA@mail.gmail.com>
References: <20120622124110.GA31802@wellquite.org>
	<CAJreXKDf-6DzeLLoC8XPyRE72XNYRBp_cxPcrfD4ahuh9NQaVw@mail.gmail.com>
	<CAHfw-YO5mcfA=_shJ_Yx7Pi9sOBMkBE0QMff_YOP1-8task+ZA@mail.gmail.com>
Message-ID: <CALPqkiq2=C2=_w-Cyd2zaoJh6dp-Cr35vRSKxyOVVc0cP5Vf8w@mail.gmail.com>

Matthew,



Congratulations on the new role and best of luck with your future
endeavours. You have been instrumental in the creation and evolution of a
truly excellent piece of software that continues to grow in popularity -
something to be very proud of. I have no doubt that you will continue to
make such contributions in your future projects.



The AtomizeJS stuff looks interesting, and I am looking forward to watching
things develop!



Regards,

Brett


On Sat, Jun 30, 2012 at 10:36 AM, Paul Jones <pauljones23 at gmail.com> wrote:

> +1. Great work on everything you've done!
>
>
> On Sat, Jun 30, 2012 at 6:58 AM, James Carr <james.r.carr at gmail.com>wrote:
>
>> +1. Your contributions will be missed!
>>
>>
>> On Fri, Jun 22, 2012 at 7:41 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:
>>
>>> As some of you will have noticed, over the last few months, my
>>> contributions to RabbitMQ have decreased fairly sharply. I have been
>>> busying myself with other projects (eg AtomizeJS) and have only really
>>> returned to work on Rabbit to help with knowledge transfer
>>> (active/active HA systems) and other issues that interest me (eg the
>>> Codel AQM experiments). Even that though is now at an end.
>>>
>>> Whilst I am staying with VMware, I'm now officially moving on from
>>> working with RabbitMQ to pastures new.
>>>
>>> I first started work on RabbitMQ in the summer of 2006 and whilst there
>>> were about 2.5 years in which I did various bits of a PhD and didn't
>>> have anything to do with Rabbit during that time, I've nevertheless been
>>> involved in Rabbit on and off for the last 6 years. When I returned to
>>> LShift early spring 2009, Rabbit was a very much more primitive beast
>>> than it is today - it couldn't hold more messages than could fit in RAM,
>>> there were no plugins, we didn't implement the whole of AMQP 0-8, let
>>> alone 0-9-1, there was no form of HA at all, etc etc. I am very grateful
>>> to have had the opportunity to work on many of those areas and help the
>>> community and guide the direction of Rabbit.
>>>
>>> Obviously, Rabbit is in very good hands going forwards, not just with
>>> the remaining members of the original team that came, along with myself,
>>> to VMware from LShift, but with additional recruits, and of course with
>>> the community that has, through bug reports, the creation of many
>>> clients and applications, and through publicity in the form of blog
>>> posts, books, and tweets, helped so much with Rabbit's growth and
>>> continuing popularity.
>>>
>>> Thank you, one and all.
>>>
>>> Matthew
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120701/8c45f4e5/attachment.htm>

From charles.law at openx.com  Sun Jul  1 17:42:15 2012
From: charles.law at openx.com (Charles Law)
Date: Sun, 1 Jul 2012 09:42:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Preserving Order Across Multiple Consumers on a
	Single Queue
Message-ID: <9e28af94-3e3e-46fa-8513-1a3dfb30ee12@googlegroups.com>

We are setting up RabbitMQ to accept CRUD messages and talk to consumers 
that will directly interact with our databases (each account on our system 
has a dedicated database & queue).  For a particular queue/database we 
would like to prevent collisions on items in the database.  Unless we parse 
our messages out, that would mean that RabbitMQ would need to preserve 
message order on a queue.

Ideally we want multiple consumers, with each consumer subscribed to 
multiple queues.  And if possible, at any point in time, each queue would 
only have 1 message being processed by our set of consumers.  We'd only 
send another message from a queue out to our consumers after getting an 
acknowledgement back that the current one is done.  We'll have multiple 
queues, so across the different queues message order doesn't matter.

We did consider using an exclusive queues, but we want to balance our loads 
so if 1 account/queue is very active, it is spread across all our consumers.

Can we set this up fairly easily with RabbitMQ?  Or use a different setup 
to accomplish the same goal?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120701/edc81ca6/attachment.htm>

From keith at spronkey.com  Sun Jul  1 01:14:46 2012
From: keith at spronkey.com (spronkey)
Date: Sat, 30 Jun 2012 17:14:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer/publisher - last message published does
 not appear in queue, but appears in firehose trace!?
Message-ID: <27f47332-a02f-42a7-a429-60a9697ead08@googlegroups.com>

Hi all,
 
I've got a double pump scenario going on - that is, my application enqueues 
a *broadcast* message, that then gets picked up by *consumer** type 1*, and 
transformed into many *singlecast* messages on a separate queue that are 
picked up by *consumer** type 2. *Consumer type 1 also creates and 
publishes a confirmation message in yet another queue, containing the 
number of singlecast messages it enqueued.*
 
*
 
What's happening is that Consumer type 1 is operating fine up until it 
needs to enqueue the confirmation message. The first time any particular 
type 1 consumer publishes a confirm message, it never ends up in the 
confirmation queue. All singlecast messages end up correctly in their 
queues. If the same process is allowed to consume a second broadcast 
message, the confirmation it publishes *does *end up in the confirmation 
queue (seemingly every time, but this could be a red herring). Firehose 
trace would indicate that the consumer is doing everything it should - it 
shows all confirm message publishes with correct exchange and routing key, 
yet confirm queue remains empty.
 
The Consumer/publisher operates as follows:
 

   1. Initiate 2 connections (to same server, currently): "in", and "out"
   2. Create 4 channels:
      1. bound to *gn-broadcast*
      2. bound to *gn-smsout*
      3. bound to *gn-emailout*
      4. bound to *msg-broadcast-confirm***
   3. Consume loop begins on *in* channel consuming from *broadcast* queue
      1. Gather person list from broadcast message body
      2. Start transactions on *smsout* and *emailout* channels
      3. Loop through person list. For each, create two AMQP Messages w/ 
      single person and publish to *smsout *and *emailout* queues 
      respectively
      4. Once finished looping, commit transaction (assuming all OK)
      5. Create new AMQPMessage with number of persons and publish to *
      msg-broadcast-confirm* queue
   
A copy of the script is here for reference: http://pastebin.com/GH1hr1ph
 
The php-amqplib debug output clearly shows in all cases that the 
basic_publish message* is being sent with the correct contents of the 
confirmation message*. There are no breaks in the connection or exceptions 
occurring. Likewise, the firehose trace from rabbit publishes a message to 
trace queue showing the confirm message has been published, with the 
correct exchange and correct routing key.  However, my confirm queue is 
completely empty!
 
Why would this occur? Do I need more than 2 connections? (I didn't think I 
would need more than 1, but the sms and email messages don't seem to 
publish nicely without a second connection).
 
What on earth is going on? It's doing my head in!
 
Rabbitmq-server version 2.8.2 running in a Turnkey LAMP VM (Ubuntu 10.04). 
Client is running on Mac OS X 10.6.8 with latest php-amqplib.
 
Regards,
 
Keith
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120630/421efc96/attachment.htm>

From keith at spronkey.com  Sun Jul  1 01:16:06 2012
From: keith at spronkey.com (spronkey)
Date: Sat, 30 Jun 2012 17:16:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer/publisher - last message published
 does not appear in queue, but appears in firehose trace!?
In-Reply-To: <27f47332-a02f-42a7-a429-60a9697ead08@googlegroups.com>
References: <27f47332-a02f-42a7-a429-60a9697ead08@googlegroups.com>
Message-ID: <461ed3dd-4782-4144-944b-6bef6fd5f863@googlegroups.com>

I should note that in all cases, queues/exchanges are durable, 
non-exclusive, and without autodelete.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120630/42319d78/attachment.htm>

From jaugenstine at gmail.com  Sun Jul  1 19:07:28 2012
From: jaugenstine at gmail.com (jonathan augenstine)
Date: Sun, 1 Jul 2012 11:07:28 -0700
Subject: [rabbitmq-discuss]  rabbitmq-c RPC example
Message-ID: <CAAq2U1DHE7HkfLB9G-3GgtSVYE_ywgFNAYzz8+mHeBmCYXY1ug@mail.gmail.com>

I would like to say that rabbitmq is a very nice messaging implementation.
I had to implement a module to coordinate a very large number of processes
on Linux and over a one week time period installed rabbitmq, worked out the
implementation, and pushed to production.  I expected to have to work out
some bugs, but amazingly it just worked.  One or two minor tweaks and it
has been running for almost two weeks now with out issue.

That being said, I implemented this using the C library.  I used a basic
publish/subscribe approach to the implementation.  The reality is that the
design pattern really fits an RPC implementation.  My problem was that I
was pressed for time and could not quite get the details worked out for an
RPC implementation.  I was wondering if someone had an example of a C
implementation of the RPC on rabbitmq?

Jonathan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120701/5ac1c5cf/attachment.htm>

From matthias at rabbitmq.com  Sun Jul  1 19:23:14 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 01 Jul 2012 19:23:14 +0100
Subject: [rabbitmq-discuss] Vanishing of persistent messages on durable,
 auto-deleting queue with dead-lettering
In-Reply-To: <4FEDD75D.1030808@comarch.pl>
References: <4FEDD75D.1030808@comarch.pl>
Message-ID: <4FF09592.20302@rabbitmq.com>

Ernest,

On 29/06/12 17:27, Ernest Staszuk wrote:
> After disconnecting a client from durable, auto-deleting queue with
> dead-lettering-exchange I would expect passing all messages to dead
> letter exchange and then deleting queue. But surprisingly for me
> queue was deleted and messages just vanished into limbo.

That's the defined behaviour. From 
http://www.rabbitmq.com/extensions.html#dead-letter-exchanges
<quote>
A message is dead-lettered when any of the following events occur:
- The message is rejected (basic.reject or basic.nack) with 
requeue=false; or
- The TTL for the message expires.
</quote>

> Is this behavior desirable? Why?

We deliberately kept the set of operations susceptible to dead-lettering 
small, to avoid unintended consequences. It is possible that actions 
like auto-deletion, queue lease expiry, explicit deletion and purging 
should all trigger the dead-letter mechanism, but I'd like to see 
compelling use cases first before making such a change.

> How should I get around this problem? I thought about declare queue
> as non auto deleting and making own monitoring daemon, which could
> handle cleaning queues without consumers. Is there any simpler way of
> achieve my goal?

Perhaps a combination of queue leases and ttl would work. The former has 
the additional advantage of allowing the system to mask temporary 
consumer and connectivity failures.

Regards,

Matthias.

From matthias at rabbitmq.com  Sun Jul  1 19:28:59 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 01 Jul 2012 19:28:59 +0100
Subject: [rabbitmq-discuss] Vanishing of persistent messages on durable,
 auto-deleting queue with dead-lettering
In-Reply-To: <4FF09592.20302@rabbitmq.com>
References: <4FEDD75D.1030808@comarch.pl> <4FF09592.20302@rabbitmq.com>
Message-ID: <4FF096EB.8030809@rabbitmq.com>

On 01/07/12 19:23, Matthias Radestock wrote:
> On 29/06/12 17:27, Ernest Staszuk wrote:
>> durable, auto-deleting queue

btw, it is somewhat nonsensical to make an auto-delete queue 
non-durable. Durability ensures that a queue survives broker restarts, 
while auto-deletion ensures it gets deleted when the last consumer 
vanishes. But of course restarting the broker causes all consumers to 
vanish, so the queue will disappear. The only exception is when the 
queue hasn't had any consumers yet when the broker stops.

Matthias.

From matthias at rabbitmq.com  Sun Jul  1 19:40:29 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 01 Jul 2012 19:40:29 +0100
Subject: [rabbitmq-discuss] Consumer/publisher - last message published
 does not appear in queue, but appears in firehose trace!?
In-Reply-To: <27f47332-a02f-42a7-a429-60a9697ead08@googlegroups.com>
References: <27f47332-a02f-42a7-a429-60a9697ead08@googlegroups.com>
Message-ID: <4FF0999D.3010508@rabbitmq.com>

Keith,

On 01/07/12 01:14, spronkey wrote:
>  3. Consume loop begins on *in* channel consuming from *broadcast* queue
>      1. Gather person list from broadcast message body
>      2. Start transactions on *smsout* and *emailout* channels
>      3. Loop through person list. For each, create two AMQP Messages w/
>         single person and publish to *smsout *and *emailout* queues
>         respectively
>      4. Once finished looping, commit transaction (assuming all OK)
>      5. Create new AMQPMessage with number of persons and publish to
>         *msg-broadcast-confirm* queue

In AMQP, once a channel is put in transactional mode with tx.select(), 
it stays in that mode forever. So the message published in step 5 above 
is part of a new transaction and hence will only end up in queues  at 
the next tx.commit().

Regards,

Matthias.
PS: in future please post to the rabbitmq-discuss mailing list rather 
than the google group.

From hackeron at gmail.com  Mon Jul  2 02:09:05 2012
From: hackeron at gmail.com (Roman Gaufman)
Date: Mon, 2 Jul 2012 02:09:05 +0100
Subject: [rabbitmq-discuss] Ruby-AMQP with Federation doesn't work?
Message-ID: <CAAs9BZOrijO-brzitEkN3MuS7i==hEo3aot+-fafCG66Goeq8g@mail.gmail.com>

I'm trying to get the Ruby-AMQP gem working with RabbitMQ's federation
plugin.

I have a federation set up as following:

{rabbitmq_federation,
   [ {exchanges, [[{exchange,     "xanview"},
                   {virtual_host, "/"},
                   {type,         "topic"},
                   {durable,      true},
                   {auto_delete,  false},
                   {internal,     false},
                   {upstream_set, "my-upstreams"}]
                 ]},

It appears in the web interface as:

Type    x-federation
Parameters   arguments: upstream-set:   my-upstreams
                                                type:   topic
                         durable:   true

I try to use it in Ruby in a consumer like this:

exchange = AMQP::Exchange.new(channel, "x-federation", "my-exchange",
:durable => true)

However in the RabbitMQ config I get this error:

connection <0.16597.1>, channel 2 - error:
{amqp_error,precondition_failed,
            "inequivalent arg 'type'for exchange 'xanview' in vhost
'/': received none but current is the value 'topic' of type
'longstr'",
            'exchange.declare'}

It seems something in the Ruby-AMQP gem is preventing me from using an
exchange type "x-federation"?

Also when I try to consume messages sent to a federated exchange using your
typical:

AMQP.start('amqp://guest:guest at localhost:25672') do |connection, open_ok|
  channel  = AMQP::Channel.new(connection)
  channel.queue("", :durable => true) do |queue|
    queue.bind('xanview', :routing_key => '#')
    queue.subscribe do |metadata, payload|
      puts "Recieved message: #{payload.inspect}."
    end
  end end

I get this exception for the first message received:

/usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/table.rb:89:in
`decode': NotImplementedError (NotImplementedError)    from
/usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/table_value_decoder.rb:144:in
`decode_hash'    from
/usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/table_value_decoder.rb:46:in
`decode_array'
    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/table.rb:99:in
`decode'    from
/usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/client.rb:1560:in
`block in decode_properties'    from
/usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/client.rb:1543:in
`each'
    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/client.rb:1543:in
`decode_properties'    from
/usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/frame.rb:142:in
`decode_payload'    from
/usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/frame.rb:115:in
`body_size'
    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-client-0.9.3/lib/amq/client/async/adapter.rb:675:in
`content_complete?'    from
/usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-client-0.9.3/lib/amq/client/async/adapter.rb:667:in
`frameset_complete?'    from
/usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-client-0.9.3/lib/amq/client/async/adapter.rb:518:in
`receive_frame'
    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-client-0.9.3/lib/amq/client/async/adapters/event_machine.rb:327:in
`receive_data'    from
/usr/local/rvm/gems/ruby-1.9.3-p194/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in
`run_machine'    from
/usr/local/rvm/gems/ruby-1.9.3-p194/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in
`run'
    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amqp-0.9.6/lib/amqp/connection.rb:38:in
`start'    from client1.rb:7:in `<main>'

Any advice would be greatly appreciated. Maybe someone has an example of
using RabbitMQ Federation with the Ruby-AMQP gem?

Thank you,

Roman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/a6b1bcc4/attachment.htm>

From dwayne.dsouza at gmail.com  Mon Jul  2 08:48:02 2012
From: dwayne.dsouza at gmail.com (Deelo55)
Date: Mon, 2 Jul 2012 00:48:02 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ subscriber loses connection across
 firewalls after long idle
Message-ID: <1341215282338-20480.post@n5.nabble.com>

My RabbitMQ subscriber stops receiving messages when my connection is idle
for more than 300 seconds. I've tested this on the same network and I do not
have this problem. The problem only occurs when I am trying to attempt a
subscription through a firewall (Cisco ASA 5505).


From nimmavadiraj at gmail.com  Mon Jul  2 09:38:22 2012
From: nimmavadiraj at gmail.com (vadiraj hebbar)
Date: Mon, 2 Jul 2012 14:08:22 +0530
Subject: [rabbitmq-discuss] how much data can publisher send at a time to
	queue?
Message-ID: <CALK6wMrRoD2dCiMS3Cn4jfsrKbL0qkJNur6yVTvduT1m0nVU_w@mail.gmail.com>

how much data can publisher send at a time to queue? can publisher send 1GB
data to queue. is any limits is their?

regards

Vadiraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/0dedbe20/attachment.htm>

From nimmavadiraj at gmail.com  Mon Jul  2 09:42:54 2012
From: nimmavadiraj at gmail.com (vadiraj hebbar)
Date: Mon, 2 Jul 2012 14:12:54 +0530
Subject: [rabbitmq-discuss] time to live (ttl) in c++ client
Message-ID: <CALK6wMoveDBSRCCxz-AC0763QgeReVSnAJ9vybB6QfcpEscjaA@mail.gmail.com>

how to set ttl in c++ client if u know please send me that link. I google
it i am didknot find any soln

regards,
Vadiraj hebbar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/5563e4ee/attachment.htm>

From evangeline.eleanor at gmail.com  Sun Jul  1 23:01:17 2012
From: evangeline.eleanor at gmail.com (eleanor)
Date: Sun, 1 Jul 2012 15:01:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Authentication Backend HTTP
Message-ID: <1341180077844-20476.post@n5.nabble.com>

Hi, I found the following plugin, which I think can be a great way to extend
the rabbitmq: https://github.com/simonmacmullen/rabbitmq-auth-backend-http

But since I'm only starting with rabbitmq, I downloaded the rabbitmq
development tools like it says here
http://www.rabbitmq.com/plugin-development.html . So the plugins/ directory
under rabbitmq-server contains the following:
    # ls plugins/
    lrwxrwxrwx 1 eleanor eleanor 32 Jul  1 19:22 rabbitmq-auth-backend-http
-> ../../rabbitmq-auth-backend-http
    lrwxrwxrwx 1 eleanor eleanor 28 Jul  1 18:47 rabbitmq-erlang-client ->
../../rabbitmq-erlang-client


This should be fine, since the rabbitmq-auth-backend-http is enabled. The
problem happens with the enable command:
    # rabbitmq-plugins enable rabbitmq_auth_backend_http
    Error: The following plugins could not be found:
rabbitmq_auth_backend_http

And when I compile and run the rabbitmq, the plugin is not loaded:
# make run
RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="" RABBITMQ_LOG_BASE="/tmp"
RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-rabbit-mnesia"
RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-rabbit-plugins-scratch" \
        RABBITMQ_ALLOW_INPUT=true \
        RABBITMQ_SERVER_START_ARGS="" \
        ./scripts/rabbitmq-server
kernel-poll not supported; "K" parameter ignored
Erlang R13B04 (erts-5.7.5) [source] [64-bit] [rq:1] [async-threads:30]

Eshell V5.7.5  (abort with ^G)
(rabbit at rabbit1)1> Warning: the following enabled plugins were not found:
[rabbitmq_auth_mechanism_ssl,
                                                        rabbitmq_management]

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
| v%%VSN%%  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2012 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at rabbit1
app descriptor :
/home/eleanor/testing/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
home dir       : /root
config file(s) : (none)
cookie hash    : 6VhgzI7kqUE7mzyaNL+b7Q==
log            : /tmp/rabbit at rabbit1.log
sasl log       : /tmp/rabbit at rabbit1-sasl.log
database dir   : /tmp/rabbitmq-rabbit-mnesia
erlang version : 5.7.5

-- rabbit boot start
starting file handle cache server                                    
...done
starting worker pool                                                 
...done
starting database                                                    
...done
starting database sync                                               
...done
starting codec correctness check                                     
...done
-- external infrastructure ready
starting statistics event manager                                    
...done
starting logging server                                              
...done
starting plugin registry                                             
...done
starting auth mechanism amqplain                                     
...done
starting auth mechanism cr-demo                                      
...done
starting auth mechanism plain                                        
...done
starting exchange type direct                                        
...done
starting exchange type fanout                                        
...done
starting exchange type headers                                       
...done
starting exchange type topic                                         
...done
-- kernel ready
starting node monitor                                                
...done
starting cluster delegate                                            
...done
starting guid generator                                              
...done
starting alarm handler                                               
...done
starting memory monitor                                              
...done
-- core initialized
starting empty DB check                                              
...done
starting policy parameters                                           
...done
starting exchange, queue and binding recovery                        
...done
starting mirror queue slave sup                                      
...done
starting adding mirrors to queues                                    
...done
-- message delivery logic ready
starting error log relay                                             
...done
starting networking                                                  
...done
starting notify cluster nodes                                        
...done
starting direct client                                               
...done

broker running




Does anybody have any idea how to install the HTTP backend to test it out?
Btw: why isn't this plugin part of the default plugins if rabbitmq?

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Authentication-Backend-HTTP-tp20476.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From evangeline.eleanor at gmail.com  Sun Jul  1 23:07:38 2012
From: evangeline.eleanor at gmail.com (eleanor)
Date: Sun, 1 Jul 2012 15:07:38 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmy on IPhone
Message-ID: <1341180458828-20477.post@n5.nabble.com>

Hi, I'm wondering if the C implementation of RabbitMQ, which is accessible
here: http://hg.rabbitmq.com/rabbitmq-c/ actually works on IPhone?

The confirmation that it works is enough, but if there is some proof that
this is the case, it's even better.

Thank you

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbitmy-on-IPhone-tp20477.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From evangeline.eleanor at gmail.com  Mon Jul  2 05:45:47 2012
From: evangeline.eleanor at gmail.com (eleanor)
Date: Sun, 1 Jul 2012 21:45:47 -0700 (PDT)
Subject: [rabbitmq-discuss] How to specify user/pass
Message-ID: <1341204347925-20479.post@n5.nabble.com>

Hi,

is there a tutorial somewhere which specifies how we can login to the
rabbitmq which uses internal database and LDAP database. 

The example from the tutorial is the following code:

#!/usr/bin/env python
import pika
import sys

connection = pika.BlockingConnection(pika.ConnectionParameters(
        host='10.1.1.176'))
channel = connection.channel()

channel.queue_declare(queue='logs', durable=True)

message = ' '.join(sys.argv[1:]) or "Hello World!"
channel.basic_publish(exchange='',
                      routing_key='logs',
                      body=message,
                      properties=pika.BasicProperties(
                         delivery_mode = 2, # make message persistent
                      ))
print " [x] Sent %r" % (message,)
connection.close()


How can I change that to also login with the user/pass to the rabbitmq. A
link to the tutorial would be great. Sorry for the noob question, but I'm
really just starting out with rabbitmq.

Thanks

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-specify-user-pass-tp20479.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From chripede at gmail.com  Mon Jul  2 06:44:03 2012
From: chripede at gmail.com (Christian Pedersen)
Date: Sun, 1 Jul 2012 22:44:03 -0700 (PDT)
Subject: [rabbitmq-discuss] After waking from standby Rabbit uses 100% cpu
	(Windows)
Message-ID: <23f5d674-adf9-4068-9469-9ff18063db83@googlegroups.com>

This seems to be the only place to file a bug report:

I'm running RabbitMQ 2.8.4 on Windows. After waking the system after a 
standby, RabbitMQ will often use 100% cpu (1 full core).

Please let me know if you need more info.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120701/70088cd6/attachment.htm>

From francesco at rabbitmq.com  Mon Jul  2 10:11:47 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 02 Jul 2012 10:11:47 +0100
Subject: [rabbitmq-discuss] how much data can publisher send at a time
	to	queue?
In-Reply-To: <CALK6wMrRoD2dCiMS3Cn4jfsrKbL0qkJNur6yVTvduT1m0nVU_w@mail.gmail.com>
References: <CALK6wMrRoD2dCiMS3Cn4jfsrKbL0qkJNur6yVTvduT1m0nVU_w@mail.gmail.com>
Message-ID: <87y5n2plws.wl%francesco@rabbitmq.com>

Hi Vadiraj,

At Mon, 2 Jul 2012 14:08:22 +0530,
> how much data can publisher send at a time to queue? can publisher
> send 1GB data to queue. is any limits is their?

RabbitMQ starts paging the messages to disc in low memory
situation. Thus, it can handle large amounts of data. The limits are
regulated by the configuration settings `vm_memory_high_watermark',
which determines when the messages will start to be paged to disc; and
`disk_free_limit', which determines the amount of free space below
which RabbitMQ after which the publisher connections will be
blocked.

See http://www.rabbitmq.com/configure.html for docs on the
configuration and http://www.rabbitmq.com/memory.html for docs on flow
control (the system that regulates when the connections are blocked).

--
Francesco * Often in error, never in doubt

From emile at rabbitmq.com  Mon Jul  2 10:32:35 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Jul 2012 10:32:35 +0100
Subject: [rabbitmq-discuss] RabbitMQ subscriber loses connection across
 firewalls after long idle
In-Reply-To: <1341215282338-20480.post@n5.nabble.com>
References: <1341215282338-20480.post@n5.nabble.com>
Message-ID: <4FF16AB3.8010109@rabbitmq.com>

Hi,

On 02/07/12 08:48, Deelo55 wrote:
> My RabbitMQ subscriber stops receiving messages when my connection is idle

> silently without any warning despite using heartbeats.

Heartbeats are supposed to prevent the connection from being idle. It
should not be possible for the connection to be idle for 600 seconds in
the presence of heartbeats set to 10 seconds. At what event did you
start counting 600 seconds?


-Emile





From francesco at rabbitmq.com  Mon Jul  2 10:29:30 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 02 Jul 2012 10:29:30 +0100
Subject: [rabbitmq-discuss] After waking from standby Rabbit uses 100%
	cpu	(Windows)
In-Reply-To: <23f5d674-adf9-4068-9469-9ff18063db83@googlegroups.com>
References: <23f5d674-adf9-4068-9469-9ff18063db83@googlegroups.com>
Message-ID: <87wr2mpl39.wl%francesco@rabbitmq.com>

Hi Christian,

At Sun, 1 Jul 2012 22:44:03 -0700 (PDT),
Christian Pedersen wrote:
> This seems to be the only place to file a bug report:

Yes, this is the right place.

> I'm running RabbitMQ 2.8.4 on Windows. After waking the system after
> a standby, RabbitMQ will often use 100% cpu (1 full core).
> 
> Please let me know if you need more info.

Yes please, otherwise it is hard for us to investigate. Can you
describe your setup, post the logs, and the output of `rabbitmqctl
status'?

Also, you are currently using the Google groups interface - I suggest
to switch to the proper mailing list (
http://news.gmane.org/gmane.comp.networking.rabbitmq.general ), or
maybe gmane (
http://news.gmane.org/gmane.comp.networking.rabbitmq.general ), which
seems to be a reliable mirror, while Google groups often falls behind.

--
Francesco * Often in error, never in doubt

From dwayne.dsouza at gmail.com  Mon Jul  2 10:34:00 2012
From: dwayne.dsouza at gmail.com (Deelo55)
Date: Mon, 2 Jul 2012 02:34:00 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ subscriber loses connection across
 firewalls after long idle
In-Reply-To: <4FF16AB3.8010109@rabbitmq.com>
References: <1341215282338-20480.post@n5.nabble.com>
	<4FF16AB3.8010109@rabbitmq.com>
Message-ID: <1341221640243-20487.post@n5.nabble.com>

Hi,
My test class starts the subscriber...waits 5 minutes than publishes a
message. When I run it locally it works fine...when I run across firewall it
fails.
The hearbeat doesn't help here and when I check on the server it still has
the connection up and running.


public class TimeoutTest {
	private static final Logger log =
LoggerFactory.getLogger(TimeoutTest.class);
	public static void main(String[] args) throws Exception{
		final RabbitMqPublisher<String> publisher=new
RabbitMqPublisher<String>("xxx.xxx.xxx.xxx","EXCHANGE","TEST");
		final RabbitMqSubscriber<String> subscriber=new
RabbitMqSubscriber<String>("xxx.xxx.xxx.xxx","EXCHANGE", "TEST");
		subscriber.setListener(new MessageListener<String>() {
			
			@Override
			public void receive(String s) {
				System.out.println("SUCCESSFUL!!!"); //NEVER GETS CALLED!!!
				
			}
		});
		Executors.newSingleThreadExecutor().execute(new Runnable() {
			public void run() {
				try{
				subscriber.run();
				}catch(Exception e){
					e.printStackTrace();
				}
			}
		});
		
		//start subscriber then wait >5 minutes before publishing first message 
		int timeout=1000*401;
		System.out.println("timeout="+timeout);
		Thread.sleep(timeout);
		
		publisher.publish("MESSAGE PUBLISHED");
		
	}
	
}

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-subscriber-loses-connection-across-firewalls-after-long-idle-tp20480p20487.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From francesco at rabbitmq.com  Mon Jul  2 10:37:47 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 02 Jul 2012 10:37:47 +0100
Subject: [rabbitmq-discuss] Authentication Backend HTTP
In-Reply-To: <1341180077844-20476.post@n5.nabble.com>
References: <1341180077844-20476.post@n5.nabble.com>
Message-ID: <87vci6pkpg.wl%francesco@rabbitmq.com>

At Sun, 1 Jul 2012 15:01:17 -0700 (PDT),
eleanor  wrote:
> 
> Hi, I found the following plugin, which I think can be a great way to extend
> the rabbitmq: https://github.com/simonmacmullen/rabbitmq-auth-backend-http
> 
> But since I'm only starting with rabbitmq, I downloaded the rabbitmq
> development tools like it says here
> http://www.rabbitmq.com/plugin-development.html . So the plugins/ directory
> under rabbitmq-server contains the following:
>     # ls plugins/
>     lrwxrwxrwx 1 eleanor eleanor 32 Jul  1 19:22 rabbitmq-auth-backend-http
> -> ../../rabbitmq-auth-backend-http
>     lrwxrwxrwx 1 eleanor eleanor 28 Jul  1 18:47 rabbitmq-erlang-client ->
> ../../rabbitmq-erlang-client
> 
> 
> This should be fine, since the rabbitmq-auth-backend-http is enabled. The
> problem happens with the enable command:
>     # rabbitmq-plugins enable rabbitmq_auth_backend_http
>     Error: The following plugins could not be found:
> rabbitmq_auth_backend_http
> [...]
> Does anybody have any idea how to install the HTTP backend to test it out?

The missing step in your description seems to be building the plugin
itself. Go into the `rabbitmq-auth-backend-http' directory and issue a
`make'

> Btw: why isn't this plugin part of the default plugins if rabbitmq?

Well I'm not sure about that, but the README reads "Note: it's at an
early stage of development, although it's conceptually very simple."

--
Francesco * Often in error, never in doubt

From mauryam at live.in  Mon Jul  2 11:15:33 2012
From: mauryam at live.in (Maurya M)
Date: Mon, 2 Jul 2012 15:45:33 +0530
Subject: [rabbitmq-discuss] RabbitMQ C++ program for TTL implementation
Message-ID: <SNT143-W15D5044E526B26239D731DBBEA0@phx.gbl>


Hi,
 I am using the example from RabbitMQ website - http://www.rabbitmq.com/devtools.html 
                - amqpcpp a C++ message library for RabbitMQ.

I have a need to implement the Time-To-Live feature wherein my Publisher is in Java and Consumer in C++. 
I am able to declare the queue with "x-message-ttl" in my Java Publisher but my C++ consume also needs to declare the queue with this same "x-message-ttl"? Is my understanding correct? And how can this be targeted using the amqpcpp - C++ library. Has anyone of the members come across similar requirement and cracked this one.

Thanks in advance,

Maurya.
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/d7e836b5/attachment.htm>

From emile at rabbitmq.com  Mon Jul  2 11:39:06 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Jul 2012 11:39:06 +0100
Subject: [rabbitmq-discuss] RabbitMQ subscriber loses connection across
 firewalls after long idle
In-Reply-To: <1341221640243-20487.post@n5.nabble.com>
References: <1341215282338-20480.post@n5.nabble.com>
	<4FF16AB3.8010109@rabbitmq.com>
	<1341221640243-20487.post@n5.nabble.com>
Message-ID: <4FF17A4A.3010704@rabbitmq.com>

Hi,

On 02/07/12 10:34, Deelo55 wrote:

> public class TimeoutTest {

There is nothing in this code to indicate that heartbeats are actually
in effect. You can check for heartbeats by running the following command
at 10s intervals:

rabbitmqctl list_connections name send_oct recv_oct

You should see both "send_oct" and "recv_oct" increment by 8. If these
values stay constant on an idle connection then heartbeats have not been
enabled, and that is probably why the firewall is closing the connection.

You could also use a protocol analyser (such as WireShark) to monitor
traffic on port 5672 and inspect heartbeats that way.


-Emile


From dwayne.dsouza at gmail.com  Mon Jul  2 11:47:54 2012
From: dwayne.dsouza at gmail.com (Deelo55)
Date: Mon, 2 Jul 2012 03:47:54 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ subscriber loses connection across
 firewalls after long idle
In-Reply-To: <4FF17A4A.3010704@rabbitmq.com>
References: <1341215282338-20480.post@n5.nabble.com>
	<4FF16AB3.8010109@rabbitmq.com>
	<1341221640243-20487.post@n5.nabble.com>
	<4FF17A4A.3010704@rabbitmq.com>
Message-ID: <1341226074241-20491.post@n5.nabble.com>

The heartbeats are processing...I can see the connection timeout on the
subscriber connections have been set to 10 seconds and the connections do
not get dropped after 5 minutes. So it looks like the TCP connection
according to the server is running but for some reason its not sending any
data to the subscriber.

There seems to be a related thread here but I can't see any confirmed
solution:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017138.html

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-subscriber-loses-connection-across-firewalls-after-long-idle-tp20480p20491.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Mon Jul  2 11:52:03 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 02 Jul 2012 11:52:03 +0100
Subject: [rabbitmq-discuss] RabbitMQ C++ program for TTL implementation
In-Reply-To: <SNT143-W15D5044E526B26239D731DBBEA0@phx.gbl>
References: <SNT143-W15D5044E526B26239D731DBBEA0@phx.gbl>
Message-ID: <4FF17D53.8090507@rabbitmq.com>

On 07/02/2012 11:15 AM, Maurya M wrote:
> Hi,
>  I am using the example from RabbitMQ website - 
> http://www.rabbitmq.com/devtools.html - amqpcpp 
> <https://github.com/akalend/amqpcpp> a C++ message library for RabbitMQ.
>
> I have a need to implement the Time-To-Live feature wherein my 
> Publisher is in Java and Consumer in C++.
> I am able to declare the queue with "x-message-ttl" in my Java 
> Publisher but my C++ consume also needs to declare the queue with this 
> same "x-message-ttl"? Is my understanding correct? And how can this be 
> targeted using the amqpcpp - C++ library. Has anyone of the members 
> come across similar requirement and cracked this one.
>

Well, looking at the constructor and declare handling code for 
AMQPExchange in 
https://github.com/akalend/amqpcpp/blob/master/src/AMQPExchange.cpp, it 
doesn't look like this is supported. Instead of initialising the 
arguments which are passed to the underlying call to 
amqp_exchange_declare (in rabbitmq-c, which amqpcpp is ostensibly based 
on), the code sets the arguments to empty/null.

If you want to support proper declare semantics then, you'll either need 
to patch amqpcpp, or defer to using rabbitmq-c directly.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/dec1ca2a/attachment.htm>

From tim at rabbitmq.com  Mon Jul  2 11:53:48 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 02 Jul 2012 11:53:48 +0100
Subject: [rabbitmq-discuss] RabbitMQ C++ program for TTL implementation
In-Reply-To: <4FF17D53.8090507@rabbitmq.com>
References: <SNT143-W15D5044E526B26239D731DBBEA0@phx.gbl>
	<4FF17D53.8090507@rabbitmq.com>
Message-ID: <4FF17DBC.205@rabbitmq.com>

On 07/02/2012 11:52 AM, Tim Watson wrote:
> On 07/02/2012 11:15 AM, Maurya M wrote:
>> Hi,
>>  I am using the example from RabbitMQ website - 
>> http://www.rabbitmq.com/devtools.html - amqpcpp 
>> <https://github.com/akalend/amqpcpp> a C++ message library for RabbitMQ.
>>
>> I have a need to implement the Time-To-Live feature wherein my 
>> Publisher is in Java and Consumer in C++.
>> I am able to declare the queue with "x-message-ttl" in my Java 
>> Publisher but my C++ consume also needs to declare the queue with 
>> this same "x-message-ttl"? Is my understanding correct? And how can 
>> this be targeted using the amqpcpp - C++ library. Has anyone of the 
>> members come across similar requirement and cracked this one.
>>
>
> Well, looking at the constructor and declare handling code for 
> AMQPExchange in 
> https://github.com/akalend/amqpcpp/blob/master/src/AMQPExchange.cpp, 
> it doesn't look like this is supported. Instead of initialising the 
> arguments which are passed to the underlying call to 
> amqp_exchange_declare (in rabbitmq-c, which amqpcpp is ostensibly 
> based on), the code sets the arguments to empty/null.
>
> If you want to support proper declare semantics then, you'll either 
> need to patch amqpcpp, or defer to using rabbitmq-c directly.

Sorry - s/exchange/queue

Cheers,
T

>
> Cheers,
> Tim
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/f95ea3b9/attachment.htm>

From tim at rabbitmq.com  Mon Jul  2 11:55:02 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 02 Jul 2012 11:55:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ C++ program for TTL implementation
In-Reply-To: <4FF17DBC.205@rabbitmq.com>
References: <SNT143-W15D5044E526B26239D731DBBEA0@phx.gbl>
	<4FF17D53.8090507@rabbitmq.com> <4FF17DBC.205@rabbitmq.com>
Message-ID: <4FF17E06.5060800@rabbitmq.com>

On 07/02/2012 11:53 AM, Tim Watson wrote:
>>
>> Well, looking at the constructor and declare handling code for 
>> AMQPExchange in 
>> https://github.com/akalend/amqpcpp/blob/master/src/AMQPExchange.cpp, 
>> it doesn't look like this is supported. Instead of initialising the 
>> arguments which are passed to the underlying call to 
>> amqp_exchange_declare (in rabbitmq-c, which amqpcpp is ostensibly 
>> based on), the code sets the arguments to empty/null.
>>
>> If you want to support proper declare semantics then, you'll either 
>> need to patch amqpcpp, or defer to using rabbitmq-c directly.
>
>
> Sorry - s/exchange/queue
>

And the link is 
https://github.com/akalend/amqpcpp/blob/master/src/AMQPQueue.cpp.

From tim at rabbitmq.com  Mon Jul  2 11:55:37 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 02 Jul 2012 11:55:37 +0100
Subject: [rabbitmq-discuss] time to live (ttl) in c++ client
In-Reply-To: <CALK6wMoveDBSRCCxz-AC0763QgeReVSnAJ9vybB6QfcpEscjaA@mail.gmail.com>
References: <CALK6wMoveDBSRCCxz-AC0763QgeReVSnAJ9vybB6QfcpEscjaA@mail.gmail.com>
Message-ID: <4FF17E29.60601@rabbitmq.com>

On 07/02/2012 09:42 AM, vadiraj hebbar wrote:
> how to set ttl in c++ client if u know please send me that link. I 
> google it i am didknot find any soln
>

This just depends. What C++ client are you referring to?

From emile at rabbitmq.com  Mon Jul  2 12:07:00 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Jul 2012 12:07:00 +0100
Subject: [rabbitmq-discuss] RabbitMQ subscriber loses connection across
 firewalls after long idle
In-Reply-To: <1341226074241-20491.post@n5.nabble.com>
References: <1341215282338-20480.post@n5.nabble.com>
	<4FF16AB3.8010109@rabbitmq.com>
	<1341221640243-20487.post@n5.nabble.com>
	<4FF17A4A.3010704@rabbitmq.com>
	<1341226074241-20491.post@n5.nabble.com>
Message-ID: <4FF180D4.2000609@rabbitmq.com>

Hi,

On 02/07/12 11:47, Deelo55 wrote:
> The heartbeats are processing...I can see the connection timeout on the
> subscriber connections have been set to 10 seconds and the connections do

Checking the "timeout" property is actually a better way of confirming
the heartbeat interval:

rabbitmqctl list_connections name timeout

You should get output that looks similar to this (except for port numbers):

Listing connections ...
127.0.0.1:49323 -> 127.0.0.1:5672	10
...done.

Can you confirm what output you are seeing from this command?

> not get dropped after 5 minutes. So it looks like the TCP connection
> according to the server is running but for some reason its not sending any
> data to the subscriber.

So you are saying the connection is *not* dropping? What evidence are
you basing this on?


-Emile



From ask at rabbitmq.com  Mon Jul  2 12:16:59 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Mon, 2 Jul 2012 12:16:59 +0100
Subject: [rabbitmq-discuss] rabbitmq-c RPC example
In-Reply-To: <CAAq2U1DHE7HkfLB9G-3GgtSVYE_ywgFNAYzz8+mHeBmCYXY1ug@mail.gmail.com>
References: <CAAq2U1DHE7HkfLB9G-3GgtSVYE_ywgFNAYzz8+mHeBmCYXY1ug@mail.gmail.com>
Message-ID: <2AE08EBA-5E65-49C8-B406-04AF2AFCCF46@rabbitmq.com>


On 1 Jul 2012, at 19:07, jonathan augenstine wrote:

> I would like to say that rabbitmq is a very nice messaging implementation.  I had to implement a module to coordinate a very large number of processes on Linux and over a one week time period installed rabbitmq, worked out the implementation, and pushed to production.  I expected to have to work out some bugs, but amazingly it just worked.  One or two minor tweaks and it has been running for almost two weeks now with out issue.
> 
> That being said, I implemented this using the C library.  I used a basic publish/subscribe approach to the implementation.  The reality is that the design pattern really fits an RPC implementation.  My problem was that I was pressed for time and could not quite get the details worked out for an RPC implementation.  I was wondering if someone had an example of a C implementation of the RPC on rabbitmq?
> 

There are several examples here:
https://github.com/alanxz/rabbitmq-c/tree/master/examples

No direct port of the RPC examples on the website though,
but that is a great opportunity for you to learn and contribute some :)


From m.luchak at smartasking.com  Mon Jul  2 12:23:46 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Mon, 2 Jul 2012 07:23:46 -0400 (EDT)
Subject: [rabbitmq-discuss] Rabbitmy on IPhone
In-Reply-To: <1341180458828-20477.post@n5.nabble.com>
References: <1341180458828-20477.post@n5.nabble.com>
Message-ID: <1341228226.646819428@apps.rackspace.com>


Hi Eleanor,
 
Yes, this C client works on iOS (we are developing for iOS5 - and I can't see why 4 would cause any difficulties).
 
Matthew
 
-----Original Message-----
From: "eleanor" <evangeline.eleanor at gmail.com>
Sent: Sunday, July 1, 2012 6:07pm
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Rabbitmy on IPhone



Hi, I'm wondering if the C implementation of RabbitMQ, which is accessible
here: http://hg.rabbitmq.com/rabbitmq-c/ actually works on IPhone?

The confirmation that it works is enough, but if there is some proof that
this is the case, it's even better.

Thank you

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbitmy-on-IPhone-tp20477.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/e6816c66/attachment.htm>

From mauryam at live.in  Mon Jul  2 12:30:36 2012
From: mauryam at live.in (Maurya M)
Date: Mon, 2 Jul 2012 17:00:36 +0530
Subject: [rabbitmq-discuss] RabbitMQ C++ program for TTL implementation
In-Reply-To: <4FF17E06.5060800@rabbitmq.com>
References: <SNT143-W15D5044E526B26239D731DBBEA0@phx.gbl>
	<4FF17D53.8090507@rabbitmq.com>
	<4FF17DBC.205@rabbitmq.com>,<4FF17E06.5060800@rabbitmq.com>
Message-ID: <SNT143-W161DAF729105C2F6481030BBEA0@phx.gbl>


Tim,
You are right in pointing that existing code - AMQCPP library does not support Map arguments as describe in the Java client examples, for TTL implementation.

Is there any alternate C++ client which might support or popular for consumer code supporting TTL feature.

Cheers,
Maurya

> Date: Mon, 2 Jul 2012 11:55:02 +0100
> From: tim at rabbitmq.com
> To: mauryam at live.in
> CC: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] RabbitMQ C++ program for TTL implementation
> 
> On 07/02/2012 11:53 AM, Tim Watson wrote:
> >>
> >> Well, looking at the constructor and declare handling code for 
> >> AMQPExchange in 
> >> https://github.com/akalend/amqpcpp/blob/master/src/AMQPExchange.cpp, 
> >> it doesn't look like this is supported. Instead of initialising the 
> >> arguments which are passed to the underlying call to 
> >> amqp_exchange_declare (in rabbitmq-c, which amqpcpp is ostensibly 
> >> based on), the code sets the arguments to empty/null.
> >>
> >> If you want to support proper declare semantics then, you'll either 
> >> need to patch amqpcpp, or defer to using rabbitmq-c directly.
> >
> >
> > Sorry - s/exchange/queue
> >
> 
> And the link is 
> https://github.com/akalend/amqpcpp/blob/master/src/AMQPQueue.cpp.
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/641a2a18/attachment.htm>

From tim at rabbitmq.com  Mon Jul  2 12:41:43 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 2 Jul 2012 12:41:43 +0100
Subject: [rabbitmq-discuss] RabbitMQ C++ program for TTL implementation
In-Reply-To: <SNT143-W161DAF729105C2F6481030BBEA0@phx.gbl>
References: <SNT143-W15D5044E526B26239D731DBBEA0@phx.gbl>
	<4FF17D53.8090507@rabbitmq.com> <4FF17DBC.205@rabbitmq.com>,
	<4FF17E06.5060800@rabbitmq.com>
	<SNT143-W161DAF729105C2F6481030BBEA0@phx.gbl>
Message-ID: <7997EE99-CE32-4BBD-A318-1657CE6FD2EF@rabbitmq.com>


On 2 Jul 2012, at 12:30, Maurya M wrote:

> Tim,
> You are right in pointing that existing code - AMQCPP library does not support Map arguments as describe in the Java client examples, for TTL implementation.
> 
> Is there any alternate C++ client which might support or popular for consumer code supporting TTL feature.
> 

Have you tried looking through the clients listed in http://www.rabbitmq.com/devtools.html#c-dev? I don't know if these support TTL or not, but it shouldn't take you too long to look at their queue declare implementations to figure it out.

Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/b3ae5cf6/attachment.htm>

From dwayne.dsouza at gmail.com  Mon Jul  2 12:42:11 2012
From: dwayne.dsouza at gmail.com (Deelo55)
Date: Mon, 2 Jul 2012 04:42:11 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ subscriber loses connection across
 firewalls after long idle
In-Reply-To: <4FF180D4.2000609@rabbitmq.com>
References: <1341215282338-20480.post@n5.nabble.com>
	<4FF16AB3.8010109@rabbitmq.com>
	<1341221640243-20487.post@n5.nabble.com>
	<4FF17A4A.3010704@rabbitmq.com>
	<1341226074241-20491.post@n5.nabble.com>
	<4FF180D4.2000609@rabbitmq.com>
Message-ID: <1341229331833-20500.post@n5.nabble.com>

I can confirm I see the timeout has been set to 10 for all subscriber
connections.
The evidence for the connection not dropping is the fact that  "send_oct"
and "recv_oct" incrementing (and also the list-connections still shows the
connection).


--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-subscriber-loses-connection-across-firewalls-after-long-idle-tp20480p20500.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Mon Jul  2 13:24:44 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 02 Jul 2012 13:24:44 +0100
Subject: [rabbitmq-discuss] Failure starting up after power pulled from
 machine
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD790385F1CB0DC@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD790385F1CB0DC@vmexchange02.seegrid.local>
Message-ID: <4FF1930C.6020702@rabbitmq.com>

Liz,

On 29/06/12 19:30, Elizabeth Liao wrote:
> We're trying to debug a rabbitmq crash to prevent it in the future.
> [...]

What version of RabbitMQ are you running? We fixed some bugs in the area 
referenced by your error report a few releases ago, so if you are not 
running the latest version then it's worth upgrading.

Matthias.

From emile at rabbitmq.com  Mon Jul  2 13:51:03 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Jul 2012 13:51:03 +0100
Subject: [rabbitmq-discuss] RabbitMQ subscriber loses connection across
 firewalls after long idle
In-Reply-To: <1341229331833-20500.post@n5.nabble.com>
References: <1341215282338-20480.post@n5.nabble.com>
	<4FF16AB3.8010109@rabbitmq.com>
	<1341221640243-20487.post@n5.nabble.com>
	<4FF17A4A.3010704@rabbitmq.com>
	<1341226074241-20491.post@n5.nabble.com>
	<4FF180D4.2000609@rabbitmq.com>
	<1341229331833-20500.post@n5.nabble.com>
Message-ID: <4FF19937.4010205@rabbitmq.com>

Hi

On 02/07/12 12:42, Deelo55 wrote:
> I can confirm I see the timeout has been set to 10 for all subscriber
> connections.
> The evidence for the connection not dropping is the fact that  "send_oct"
> and "recv_oct" incrementing (and also the list-connections still shows the
> connection).

Previously you showed a stack trace with that was caused by
java.io.EOFException (normally indicates a dropped connection). Is that
still happening? If I understand this correctly then you are saying that
this command

rabbitmqctl list_connections name timeout

shows an active connection, with a heartbeat set to 10 seconds, and that
successive invocations of this command:

rabbitmqctl list_connections name send_oct recv_oct

shows incrementing values for "send_oct" and  "recv_oct", yet expected
messages were not received when a message was published after 600 seconds.

I strongly suspect that there is a network error behind this problem. A
possible way to solve this is to trace all network traffic on port 5672
at the server and at the client and compare the two streams and
correlate with the broker logfile and timed diagnostic output from the
client. It should be pretty easy to determine from this evidence where
the problem lies.


-Emile


From emile at rabbitmq.com  Mon Jul  2 13:53:28 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Jul 2012 13:53:28 +0100
Subject: [rabbitmq-discuss] Preserving Order Across Multiple Consumers
 on a Single Queue
In-Reply-To: <9e28af94-3e3e-46fa-8513-1a3dfb30ee12@googlegroups.com>
References: <9e28af94-3e3e-46fa-8513-1a3dfb30ee12@googlegroups.com>
Message-ID: <4FF199C8.30802@rabbitmq.com>

Hi,

On 01/07/12 17:42, Charles Law wrote:
> Can we set this up fairly easily with RabbitMQ?  Or use a different
> setup to accomplish the same goal?

Take a look at the ordering guarantees made by the broker:
http://www.rabbitmq.com/semantics.html#ordering

If you require operations on each database to be applied in order then
you should use a queue per database.

If you allow more than one consumer to subscribe to a queue then they
may attempt to perform CRUD operations simultaneously or even out of
order, so avoid more than one consumer per queue. The "exclusive" option
can enforce this constraint:

http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.exclusive

I don't see how you can spread the load across multiple consumers for
operations to a single database that have to be performed in order.
There may be some combinations of operations that can be parallelised,
such as "add row x" and "add row y" where the order does not matter, but
it would be challenging to exploit that potential. Making use of QoS
prefetch-count will probably be useful in that scenario:

http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos.prefetch-count



-Emile



From emile at rabbitmq.com  Mon Jul  2 14:05:30 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Jul 2012 14:05:30 +0100
Subject: [rabbitmq-discuss] Consumer
In-Reply-To: <df13db4b-576a-4248-9477-5c6495ecbe45@ucimail1.uci.cu>
References: <df13db4b-576a-4248-9477-5c6495ecbe45@ucimail1.uci.cu>
Message-ID: <4FF19C9A.8050600@rabbitmq.com>

Hi,

On 30/06/12 22:16, Yurisleidy Hern?ndez Moya wrote:
> In the Producer I need to know if there are Consumers connected

> 1- to use the method getConsumerCount of the queue.

The other problem with this approach is that you will fail to account
for any clients consuming messages synchronously, using basic.get.

Another option that you may consider is to monitor the queue length
instead of the number of consumers. The assumption is that if the queue
gets too long then there are probably too few or no consumers servicing
that queue.

> 2-  Declaring a queue as passive in the Producer and autodelete in the
> Consumer. Thus, the queue  only exists when the Consumer is connected
> and the queue is destroyed when the Consumer dies.

A possible solution is to publish with the "immediate" flag:

http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish.immediate

This will immediately return the messages to the publisher if the
message cannot be routed to a queue with consumers.


-Emile



From ask at rabbitmq.com  Mon Jul  2 15:24:07 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Mon, 2 Jul 2012 15:24:07 +0100
Subject: [rabbitmq-discuss] Losing messages in a Cluster configuration
	of RabbitMQ
In-Reply-To: <35e7e11f-ad0b-443c-a114-4e5fb2590e2a@googlegroups.com>
References: <35e7e11f-ad0b-443c-a114-4e5fb2590e2a@googlegroups.com>
Message-ID: <FA2EDA27-AED2-46AD-BAD7-68B31D0576A9@rabbitmq.com>


On 28 Jun 2012, at 22:24, Upendra Sharma wrote:

> Hi all,
> 
> I am facing a weird problem of losing messages, even though I am publishing them as persistent messages with pika.BasicProperties(delivery_mode=2) . Here is the scenario:
> 
> I have two RabbitMQ brokers, namely rabbit at vm11 and rabbit at vm22;  these two are have been setup in a cluster configuration as shown below:
> [{nodes,[{disc,[rabbit at vm11,rabbit at vm22]}]},
>  {running_nodes,[rabbit at vm22,rabbit at vm11]}]
> 
> I have two clients (written using pika.BlockingConnection() ); lets call these clients C1 and N1.
> 1.) C1 creates an unique exchange (exchange name generated using UUID, say 3fe546be8aa341b7b174b29a56e63797).
> 2.) C1 then spawns a thread, say C1-T1, which connects to rabbitmq server and waits for a response on this exchange using channel.start_consuming(). 
> 3.) C1 then sends a message to N1 and in the message provides the name of the exchange (3fe546be8aa341b7b174b29a56e63797) where N1 should send the response.
> 4.) once C1-T1 gets the response, it hands over the response to C1 and dies.
> 
> In my current setup I have 100 clients process like C1, i.e. C1, C2 ... C100 and one N1. 
> 
> This setup works perfectly fine when RabbitMQ is in a single node setup but when I put it in a cluster setup, it starts to loose the messages. What I mean is that Thread C1-T1 never gets a response and time-outs writing an ERROR in my log file. 
> 
> The trouble is I am loosing as many as 50% of the messages.
> 

Rabbitmq delivers messages in round-robin, so when you say 50% of the messages
are lost it sounds like too much of a coincidence to me.

What can often happen is having a broken consumer process that just sits
there stealing messages, you can verify that by looking at the `rabbitmqctl list_queues`
output:

    $ sudo rabbitmqct list_queues -p $your_vhost name messages_ready messages_unacknowledged consumers

If you have more consumers and unacknowledged messages than you expected then
you probably have a stale consumer process that you have to kill.


From eliao at seegrid.com  Mon Jul  2 15:24:45 2012
From: eliao at seegrid.com (Elizabeth Liao)
Date: Mon, 2 Jul 2012 14:24:45 +0000
Subject: [rabbitmq-discuss] Failure starting up after power pulled from
 machine
In-Reply-To: <4FF1930C.6020702@rabbitmq.com>
References: <E94F626F5C43D14F8B8479C5EBD790385F1CB0DC@vmexchange02.seegrid.local>,
	<4FF1930C.6020702@rabbitmq.com>
Message-ID: <E94F626F5C43D14F8B8479C5EBD790385F1CB622@vmexchange02.seegrid.local>

We are currently running RabbitMQ 2.8.2
________________________________________
From: Matthias Radestock [matthias at rabbitmq.com]
Sent: Monday, July 02, 2012 8:24 AM
To: Elizabeth Liao
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Failure starting up after power pulled from machine

Liz,

On 29/06/12 19:30, Elizabeth Liao wrote:
> We're trying to debug a rabbitmq crash to prevent it in the future.
> [...]

What version of RabbitMQ are you running? We fixed some bugs in the area
referenced by your error report a few releases ago, so if you are not
running the latest version then it's worth upgrading.

Matthias.

From matthias at rabbitmq.com  Mon Jul  2 15:34:23 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 02 Jul 2012 15:34:23 +0100
Subject: [rabbitmq-discuss] Failure starting up after power pulled from
 machine
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD790385F1CB622@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD790385F1CB0DC@vmexchange02.seegrid.local>,
	<4FF1930C.6020702@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD790385F1CB622@vmexchange02.seegrid.local>
Message-ID: <4FF1B16F.5060504@rabbitmq.com>

Liz,

On 02/07/12 15:24, Elizabeth Liao wrote:
> We are currently running RabbitMQ 2.8.2

Hmm. That should be recent enough.

Do you still have a copy of the $RABBITMQ_MNESIA_BASE dir tree from the 
time of the fault?

Matthias.

From evangeline.eleanor at gmail.com  Mon Jul  2 15:46:42 2012
From: evangeline.eleanor at gmail.com (eleanor)
Date: Mon, 2 Jul 2012 07:46:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Authentication Backend HTTP
In-Reply-To: <87vci6pkpg.wl%francesco@rabbitmq.com>
References: <1341180077844-20476.post@n5.nabble.com>
	<87vci6pkpg.wl%francesco@rabbitmq.com>
Message-ID: <1341240402122-20509.post@n5.nabble.com>

Hi, sorry for not being clearer. Of course I run 'make' in the http plugin
directory. I can prove it:
# pwd
./rabbitmq-public-umbrella/rabbitmq-auth-backend-http

# make
make: Nothing to be done for `dist'.

To provide more info. The plugins directory in rabbitmq-server has the
following entries:
# pwd
./rabbitmq-public-umbrella/rabbitmq-server

# ls -l plugins/
total 0
lrwxrwxrwx 1 eleanor eleanor 32 Jul  1 19:22 rabbitmq-auth-backend-http ->
../../rabbitmq-auth-backend-http
lrwxrwxrwx 1 eleanor eleanor 28 Jul  1 18:47 rabbitmq-erlang-client ->
../../rabbitmq-erlang-client


And I have to run the "make run" in rabbitmq-server as root to run the
server. If I run it as normal user I get the following error - maybe this is
connected to http plugin not working:
$ make run
RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="" RABBITMQ_LOG_BASE="/tmp"
RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-rabbit-mnesia"
RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-rabbit-plugins-scratch" \
        RABBITMQ_ALLOW_INPUT=true \
        RABBITMQ_SERVER_START_ARGS="" \
        ./scripts/rabbitmq-server
kernel-poll not supported; "K" parameter ignored
Erlang R13B04 (erts-5.7.5) [source] [64-bit] [rq:1] [async-threads:30]

Eshell V5.7.5  (abort with ^G)
(rabbit at rabbit1)1> {"init terminating in
do_boot",{{nocatch,{error,{cannot_log_to_file,"/tmp/rabbit at rabbit1.log",{error,eacces}}}},[{init,start_it,1},{init,start_em,1}]}}
init terminating in do_boot ()
make: *** [run] Error 1


Any ideas?

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Authentication-Backend-HTTP-tp20476p20509.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From videlalvaro at gmail.com  Mon Jul  2 15:52:56 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 2 Jul 2012 16:52:56 +0200
Subject: [rabbitmq-discuss] Authentication Backend HTTP
In-Reply-To: <1341240402122-20509.post@n5.nabble.com>
References: <1341180077844-20476.post@n5.nabble.com>
	<87vci6pkpg.wl%francesco@rabbitmq.com>
	<1341240402122-20509.post@n5.nabble.com>
Message-ID: <CAMcAHLVq5cXADSvin=6a4doKwz8GnEVhPvheEjrLZ_u37-rYPA@mail.gmail.com>

Just to be sure. Can you performa 'make run' without that plugin
installed/enabled/checked out?

On Mon, Jul 2, 2012 at 4:46 PM, eleanor <evangeline.eleanor at gmail.com>wrote:

> Hi, sorry for not being clearer. Of course I run 'make' in the http plugin
> directory. I can prove it:
> # pwd
> ./rabbitmq-public-umbrella/rabbitmq-auth-backend-http
>
> # make
> make: Nothing to be done for `dist'.
>
> To provide more info. The plugins directory in rabbitmq-server has the
> following entries:
> # pwd
> ./rabbitmq-public-umbrella/rabbitmq-server
>
> # ls -l plugins/
> total 0
> lrwxrwxrwx 1 eleanor eleanor 32 Jul  1 19:22 rabbitmq-auth-backend-http ->
> ../../rabbitmq-auth-backend-http
> lrwxrwxrwx 1 eleanor eleanor 28 Jul  1 18:47 rabbitmq-erlang-client ->
> ../../rabbitmq-erlang-client
>
>
> And I have to run the "make run" in rabbitmq-server as root to run the
> server. If I run it as normal user I get the following error - maybe this
> is
> connected to http plugin not working:
> $ make run
> RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="" RABBITMQ_LOG_BASE="/tmp"
> RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-rabbit-mnesia"
> RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-rabbit-plugins-scratch" \
>         RABBITMQ_ALLOW_INPUT=true \
>         RABBITMQ_SERVER_START_ARGS="" \
>         ./scripts/rabbitmq-server
> kernel-poll not supported; "K" parameter ignored
> Erlang R13B04 (erts-5.7.5) [source] [64-bit] [rq:1] [async-threads:30]
>
> Eshell V5.7.5  (abort with ^G)
> (rabbit at rabbit1)1> {"init terminating in
> do_boot",{{nocatch,{error,{cannot_log_to_file,"/tmp/rabbit at rabbit1.log
> ",{error,eacces}}}},[{init,start_it,1},{init,start_em,1}]}}
> init terminating in do_boot ()
> make: *** [run] Error 1
>
>
> Any ideas?
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Authentication-Backend-HTTP-tp20476p20509.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/df6ef8d6/attachment.htm>

From jaugenstine at gmail.com  Mon Jul  2 15:57:46 2012
From: jaugenstine at gmail.com (jonathan augenstine)
Date: Mon, 2 Jul 2012 07:57:46 -0700
Subject: [rabbitmq-discuss] rabbitmq-c RPC example
In-Reply-To: <2AE08EBA-5E65-49C8-B406-04AF2AFCCF46@rabbitmq.com>
References: <CAAq2U1DHE7HkfLB9G-3GgtSVYE_ywgFNAYzz8+mHeBmCYXY1ug@mail.gmail.com>
	<2AE08EBA-5E65-49C8-B406-04AF2AFCCF46@rabbitmq.com>
Message-ID: <CAAq2U1C_d_V527ASFhW8SYze50E6DD+vgcq94tBe=gKNOLLPFQ@mail.gmail.com>

OK, thanks.  When I figure it out, I will put an example together and
submit it.

On Mon, Jul 2, 2012 at 4:16 AM, Ask Solem <ask at rabbitmq.com> wrote:

>
> On 1 Jul 2012, at 19:07, jonathan augenstine wrote:
>
> > I would like to say that rabbitmq is a very nice messaging
> implementation.  I had to implement a module to coordinate a very large
> number of processes on Linux and over a one week time period installed
> rabbitmq, worked out the implementation, and pushed to production.  I
> expected to have to work out some bugs, but amazingly it just worked.  One
> or two minor tweaks and it has been running for almost two weeks now with
> out issue.
> >
> > That being said, I implemented this using the C library.  I used a basic
> publish/subscribe approach to the implementation.  The reality is that the
> design pattern really fits an RPC implementation.  My problem was that I
> was pressed for time and could not quite get the details worked out for an
> RPC implementation.  I was wondering if someone had an example of a C
> implementation of the RPC on rabbitmq?
> >
>
> There are several examples here:
> https://github.com/alanxz/rabbitmq-c/tree/master/examples
>
> No direct port of the RPC examples on the website though,
> but that is a great opportunity for you to learn and contribute some :)
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/5bc8e298/attachment.htm>

From francesco at rabbitmq.com  Mon Jul  2 16:16:17 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 02 Jul 2012 16:16:17 +0100
Subject: [rabbitmq-discuss] Authentication Backend HTTP
In-Reply-To: <1341240402122-20509.post@n5.nabble.com>
References: <1341180077844-20476.post@n5.nabble.com>
	<87vci6pkpg.wl%francesco@rabbitmq.com>
	<1341240402122-20509.post@n5.nabble.com>
Message-ID: <87d34ery66.wl%francesco@rabbitmq.com>

Hi Eleanor,

At Mon, 2 Jul 2012 07:46:42 -0700 (PDT),
eleanor  wrote:
> Hi, sorry for not being clearer. Of course I run 'make' in the http plugin
> directory. I can prove it:
> # pwd
> ./rabbitmq-public-umbrella/rabbitmq-auth-backend-http
> 
> # make
> make: Nothing to be done for `dist'.
> 
> To provide more info. The plugins directory in rabbitmq-server has the
> following entries:
> # pwd
> ./rabbitmq-public-umbrella/rabbitmq-server
> 
> # ls -l plugins/
> total 0
> lrwxrwxrwx 1 eleanor eleanor 32 Jul  1 19:22 rabbitmq-auth-backend-http ->
> ../../rabbitmq-auth-backend-http
> lrwxrwxrwx 1 eleanor eleanor 28 Jul  1 18:47 rabbitmq-erlang-client ->
> ../../rabbitmq-erlang-client

That looks fine. What does `./scripts/rabbitmq-plugins list' say?

What I suspect you're doing, given your previous messages, is running
the system-wide utilities instead of the ones in the local broker:

> This should be fine, since the rabbitmq-auth-backend-http is enabled. The
> problem happens with the enable command:
>      # rabbitmq-plugins enable rabbitmq_auth_backend_http
>      Error: The following plugins could not be found:
> rabbitmq_auth_backend_http

that `rabbitmq-plugins' as root looks does not look good. Make sure
that you're running the executables in the `rabbitmq-server/scripts'
folder, inside `rabbitmq-public-umbrella'.

> And I have to run the "make run" in rabbitmq-server as root to run the
> server. If I run it as normal user I get the following error - maybe this is
> connected to http plugin not working:
> [...]
> (rabbit at rabbit1)1> {"init terminating in
> do_boot",{{nocatch,{error,{cannot_log_to_file,"/tmp/rabbit at rabbit1.log",{error,eacces}}}},[{init,start_it,1},{init,start_em,1}]}}
> init terminating in do_boot ()
> make: *** [run] Error 1

That is probably happening because the user does not have permissions
on the existing log file, or maybe /tmp itself (although that seems
unlikely). Clear the existing files and make sure that /tmp is
writable by the user you want to run rabbitmq from.

--
Francesco * Often in error, never in doubt

From emile at rabbitmq.com  Mon Jul  2 16:30:34 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Jul 2012 16:30:34 +0100
Subject: [rabbitmq-discuss] Consumer
In-Reply-To: <4FF19C9A.8050600@rabbitmq.com>
References: <df13db4b-576a-4248-9477-5c6495ecbe45@ucimail1.uci.cu>
	<4FF19C9A.8050600@rabbitmq.com>
Message-ID: <4FF1BE9A.7040909@rabbitmq.com>

Hi,

On 02/07/12 16:14, Yurisleidy Hern?ndez Moya wrote:
> The client behave like consumers when they consume message with
> basicGet? I tried with two clients. A Client consumes messages from
> the queue and another Client account the number of consumers. The
> number of consumers was always zero. This case is that you tell me?

Clients can obtain messages using basic.get or basic.consume. Only in
the case of basic.consume will they be registered as consumers. If
clients use basic.get then they will typically poll the broker periodically.

> Using the immediate flag, How I can do to receive in the Client the
> undeliverable message?

Register a return handler. See
http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.return
The exact details of how to do this will depend on your AMQP client.


-Emile



From eliao at seegrid.com  Mon Jul  2 16:31:31 2012
From: eliao at seegrid.com (Elizabeth Liao)
Date: Mon, 2 Jul 2012 15:31:31 +0000
Subject: [rabbitmq-discuss] Failure starting up after power pulled from
 machine
In-Reply-To: <4FF1B16F.5060504@rabbitmq.com>
References: <E94F626F5C43D14F8B8479C5EBD790385F1CB0DC@vmexchange02.seegrid.local>,
	<4FF1930C.6020702@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD790385F1CB622@vmexchange02.seegrid.local>,
	<4FF1B16F.5060504@rabbitmq.com>
Message-ID: <E94F626F5C43D14F8B8479C5EBD790385F1CB676@vmexchange02.seegrid.local>

Unfortunately, I do not.  I'll try to reproduce it and grab the appropriate files/logs.
________________________________________
From: Matthias Radestock [matthias at rabbitmq.com]
Sent: Monday, July 02, 2012 10:34 AM
To: Elizabeth Liao
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Failure starting up after power pulled from machine

Liz,

On 02/07/12 15:24, Elizabeth Liao wrote:
> We are currently running RabbitMQ 2.8.2

Hmm. That should be recent enough.

Do you still have a copy of the $RABBITMQ_MNESIA_BASE dir tree from the
time of the fault?

Matthias.

From wolfgang.wiessler at siemens.com  Mon Jul  2 16:40:01 2012
From: wolfgang.wiessler at siemens.com (Wiessler, Wolfgang)
Date: Mon, 2 Jul 2012 17:40:01 +0200
Subject: [rabbitmq-discuss] Message acknowledgment scenarios
Message-ID: <261B7FE1ECF3ED4C997D432F8018855E0117DC8CB3@DEFTHW99E85MSX.ww902.siemens.net>

Hi,

In my setup, I have a Rabbit MQ server running somewhere centrally. A receiver picks up a message from the queue. Auto-ack is turned off, since I want the receiver to only acknowledge the message when all necessary processing at the receiver is done. The processing in the receiver happens in a separate thread, so if the thread dies because of an error, the receiver is still online and has a valid connection to Rabbit MQ. I am using the .NET client.

The basic question is: Is it possible to acknowledge a message that was received on one IModel instance using a different IModel instance? I did a brief test and that did not work. It seems as if a message's delivery tag is specific to an IModel.

What happens to an unacknowledged message if the server dies/is not reachable? Is it automatically re-queued since the server lost its connection to the receiver? Or could a receiver send an acknowledgment once the server is reachable again? E.g. by waiting in a loop for a successful connection to the server.

Thanks for any help,
Wolfgang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/95156a57/attachment.htm>

From andrea.rosa at hp.com  Mon Jul  2 17:06:17 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Mon, 2 Jul 2012 16:06:17 +0000
Subject: [rabbitmq-discuss] Question about HA configuration
Message-ID: <5F389C517756284F80239F55BCA5DDDD5A993309@G9W0721.americas.hpqcorp.net>

Hi 

Please consider this scenario:
- Active/Passive HA configuration for MQ servers (Pacemaker+corosync+DRBD)
- NOT using persistent queues: so every time there is a failure all messages in the queues are lost

Does it make sense to have a shared backend storage, for example using DRDB? Which is the value of the shared storage if messages are not stored on the file system?
Maybe it's useful because in the shared folder are stored information about queues?!

Regards
--
Andrea Rosa


From fearsome.lucidity at gmail.com  Mon Jul  2 17:26:45 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Mon, 2 Jul 2012 09:26:45 -0700
Subject: [rabbitmq-discuss] RabbitMQ subscriber loses connection across
	firewalls after long idle
Message-ID: <CAFDmHdNyMZ4Pok-80AfD+580HMeqhMwDoDwXSb-E0OMe-X=JnQ@mail.gmail.com>

On Mon, Jul 2, 2012 at 4:00 AM, <rabbitmq-discuss-request at lists.rabbitmq.com
> wrote:

> I've tried adding this to my rabbitmq.config:
>
> [
>         {rabbit, [{tcp_listen_options, [{keepalive, true}]}]}
> ].
>
>
That should be:  {tcp_listen_options, [binary, {keepalive, true}]}

Notice the "binary" in there.

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/df8bd26c/attachment.htm>

From evangeline.eleanor at gmail.com  Mon Jul  2 18:24:53 2012
From: evangeline.eleanor at gmail.com (eleanor)
Date: Mon, 2 Jul 2012 10:24:53 -0700 (PDT)
Subject: [rabbitmq-discuss] Authentication Backend HTTP
In-Reply-To: <87d34ery66.wl%francesco@rabbitmq.com>
References: <1341180077844-20476.post@n5.nabble.com>
	<87vci6pkpg.wl%francesco@rabbitmq.com>
	<1341240402122-20509.post@n5.nabble.com>
	<87d34ery66.wl%francesco@rabbitmq.com>
Message-ID: <1341249893525-20518.post@n5.nabble.com>

Hi,

running rabbitmq-plugins as normal user gives me the following error:

# scripts/rabbitmq-plugins list
Error: {cannot_read_enabled_plugins_file,"/etc/rabbitmq/enabled_plugins",
           eacces}


And that file has RWX access to ALL, but the error still happens:
# ls -l /etc/rabbitmq/enabled_plugins
-rwxrwxrwx 1 rabbitmq rabbitmq 51 Jul  1 19:07 /etc/rabbitmq/enabled_plugins

And the /tmp directory is writable by normal user, so that's not the cause
of the program for the previous error.

Any other ideas?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Authentication-Backend-HTTP-tp20476p20518.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From hackeron at gmail.com  Mon Jul  2 21:19:03 2012
From: hackeron at gmail.com (Roman Gaufman)
Date: Mon, 2 Jul 2012 21:19:03 +0100
Subject: [rabbitmq-discuss] Ruby-AMQP with Federation doesn't work?
In-Reply-To: <CAAs9BZOrijO-brzitEkN3MuS7i==hEo3aot+-fafCG66Goeq8g@mail.gmail.com>
References: <CAAs9BZOrijO-brzitEkN3MuS7i==hEo3aot+-fafCG66Goeq8g@mail.gmail.com>
Message-ID: <CAAs9BZMTwou-1j6PDiQ6CAJjrFpbr+jDWrmK+rZMY8ZOH7YbVQ@mail.gmail.com>

Just an update, I have created a repository that shows exactly what I'm
trying to do:

https://github.com/hackeron/ruby-amqp-federation-example

The maintainer of Ruby-AMQP has been helping me with this a great deal
(thank you!) and I'm finally able to get federated messaged :) - only error
now is if the message rate is higher than around 1 message/sec, I get:

E, [2012-07-02T21:06:54.126367 #4399] ERROR -- : [amqp] Detected missing
server heartbeats

A workaround is explicitly setting the
heartbeat: AMQP.start('amqp://guest:guest at localhost:25672', :heartbeat => 0)

Hope others struggling to get Federation working with Ruby-AMQP will find
this useful,

Roman


On 2 July 2012 02:09, Roman Gaufman <hackeron at gmail.com> wrote:

> I'm trying to get the Ruby-AMQP gem working with RabbitMQ's federation
> plugin.
>
> I have a federation set up as following:
>
> {rabbitmq_federation,
>    [ {exchanges, [[{exchange,     "xanview"},
>                    {virtual_host, "/"},
>                    {type,         "topic"},
>                    {durable,      true},
>                    {auto_delete,  false},
>                    {internal,     false},
>                    {upstream_set, "my-upstreams"}]
>                  ]},
>
> It appears in the web interface as:
>
> Type    x-federation
> Parameters   arguments: upstream-set:   my-upstreams
>                                                 type:   topic
>                          durable:   true
>
> I try to use it in Ruby in a consumer like this:
>
> exchange = AMQP::Exchange.new(channel, "x-federation", "my-exchange", :durable => true)
>
> However in the RabbitMQ config I get this error:
>
> connection <0.16597.1>, channel 2 - error:
> {amqp_error,precondition_failed,
>             "inequivalent arg 'type'for exchange 'xanview' in vhost '/': received none but current is the value 'topic' of type 'longstr'",
>             'exchange.declare'}
>
> It seems something in the Ruby-AMQP gem is preventing me from using an
> exchange type "x-federation"?
>
> Also when I try to consume messages sent to a federated exchange using
> your typical:
>
> AMQP.start('amqp://guest:guest at localhost:25672') do |connection, open_ok|
>   channel  = AMQP::Channel.new(connection)
>   channel.queue("", :durable => true) do |queue|
>     queue.bind('xanview', :routing_key => '#')
>     queue.subscribe do |metadata, payload|
>       puts "Recieved message: #{payload.inspect}."
>     end
>   end end
>
> I get this exception for the first message received:
>
> /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/table.rb:89:in `decode': NotImplementedError (NotImplementedError)    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/table_value_decoder.rb:144:in `decode_hash'    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/table_value_decoder.rb:46:in `decode_array'
>     from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/table.rb:99:in `decode'    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/client.rb:1560:in `block in decode_properties'    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/client.rb:1543:in `each'
>     from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/client.rb:1543:in `decode_properties'    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/frame.rb:142:in `decode_payload'    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-protocol-0.9.3/lib/amq/protocol/frame.rb:115:in `body_size'
>     from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-client-0.9.3/lib/amq/client/async/adapter.rb:675:in `content_complete?'    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-client-0.9.3/lib/amq/client/async/adapter.rb:667:in `frameset_complete?'    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-client-0.9.3/lib/amq/client/async/adapter.rb:518:in `receive_frame'
>     from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amq-client-0.9.3/lib/amq/client/async/adapters/event_machine.rb:327:in `receive_data'    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run_machine'    from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/eventmachine-0.12.10/lib/eventmachine.rb:256:in `run'
>     from /usr/local/rvm/gems/ruby-1.9.3-p194/gems/amqp-0.9.6/lib/amqp/connection.rb:38:in `start'    from client1.rb:7:in `<main>'
>
> Any advice would be greatly appreciated. Maybe someone has an example of
> using RabbitMQ Federation with the Ruby-AMQP gem?
>
> Thank you,
>
> Roman
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/d766f157/attachment.htm>

From matthias at rabbitmq.com  Mon Jul  2 21:29:03 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 02 Jul 2012 21:29:03 +0100
Subject: [rabbitmq-discuss] Ruby-AMQP with Federation doesn't work?
In-Reply-To: <CAAs9BZMTwou-1j6PDiQ6CAJjrFpbr+jDWrmK+rZMY8ZOH7YbVQ@mail.gmail.com>
References: <CAAs9BZOrijO-brzitEkN3MuS7i==hEo3aot+-fafCG66Goeq8g@mail.gmail.com>
	<CAAs9BZMTwou-1j6PDiQ6CAJjrFpbr+jDWrmK+rZMY8ZOH7YbVQ@mail.gmail.com>
Message-ID: <4FF2048F.2010203@rabbitmq.com>

On 02/07/12 21:19, Roman Gaufman wrote:
> only error now is if the message rate is higher than around 1
> message/sec,  I get:
>
> E, [2012-07-02T21:06:54.126367 #4399] ERROR -- : [amqp] Detected missing
> server heartbeats
>
> A workaround is explicitly setting the
> heartbeat: AMQP.start('amqp://guest:guest at localhost:25672', :heartbeat => 0)

I wonder whether that's a bug in ruby-amqp; heartbeats only need to be 
sent in the absence of other traffic, but perhaps ruby-amqp expects to 
receive them regardless?

I am also surprised that 0 (i.e. no heartbeats) isn't the default.

Regards,

Matthias.

From evangeline.eleanor at gmail.com  Mon Jul  2 21:45:12 2012
From: evangeline.eleanor at gmail.com (eleanor)
Date: Mon, 2 Jul 2012 13:45:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Authentication Backend HTTP
In-Reply-To: <1341249893525-20518.post@n5.nabble.com>
References: <1341180077844-20476.post@n5.nabble.com>
	<87vci6pkpg.wl%francesco@rabbitmq.com>
	<1341240402122-20509.post@n5.nabble.com>
	<87d34ery66.wl%francesco@rabbitmq.com>
	<1341249893525-20518.post@n5.nabble.com>
Message-ID: <1341261912970-20521.post@n5.nabble.com>

Ok, I solved the problem. I changed the variable ENABLED_PLUGINS_FILE in
scripts/rabbitmq-defaults. It originally pointed to the
/etc/rabbitmq/enabled_plugins, but I copied that file from /etc to the new
production rabbitmq environment and changed the path. It works now.

The rabbitmq-defaults now contains:
### next line potentially updated in package install steps
SYS_PREFIX=

## Set default values

CONFIG_FILE=${SYS_PREFIX}/etc/rabbitmq/rabbitmq
LOG_BASE=${SYS_PREFIX}/var/log/rabbitmq
MNESIA_BASE=${SYS_PREFIX}/var/lib/rabbitmq/mnesia
ENABLED_PLUGINS_FILE=/home/user/rabbitmq/rabbitmq-server/etc/enabled_plugins



The SYS_PREFIX variable got me thinking that I should rather change that,
but the /etc nor /var directories aren't under the rabbitmq development
directory, so I didn't bother with it. But if anybody has a better solution,
please let me know.

Thansk

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Authentication-Backend-HTTP-tp20476p20521.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From evangeline.eleanor at gmail.com  Mon Jul  2 21:47:43 2012
From: evangeline.eleanor at gmail.com (eleanor)
Date: Mon, 2 Jul 2012 13:47:43 -0700 (PDT)
Subject: [rabbitmq-discuss] How to specify user/pass
In-Reply-To: <1341204347925-20479.post@n5.nabble.com>
References: <1341204347925-20479.post@n5.nabble.com>
Message-ID: <1341262063896-20522.post@n5.nabble.com>

Hi, does anybody know this. I've successfully built the HTTP backend module
for rabbitmq, but now I need to know how can I authenticate against it with
rabbitmq code (client code).

If there are any suggestions - even with normal ldap or some other login
mechanism - I would be glad to hear it or read about it if you post a link
to tutorial.

Thank you

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-specify-user-pass-tp20479p20522.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alexander.ward at quibids.com  Mon Jul  2 21:59:35 2012
From: alexander.ward at quibids.com (Alexander Ward)
Date: Mon, 2 Jul 2012 15:59:35 -0500
Subject: [rabbitmq-discuss] How to specify user/pass
In-Reply-To: <1341262063896-20522.post@n5.nabble.com>
References: <1341204347925-20479.post@n5.nabble.com>
	<1341262063896-20522.post@n5.nabble.com>
Message-ID: <CAKeoubVeU6z0ntuugRx+V9rNQkqWQ72z+8LWt924+J3T8gswEw@mail.gmail.com>

If I understand your question, Rabbit has a default username/password of
guest/guest with all permissions to the / virtual host. Pika sends those by
default so you don't have to pass them when you connect.

You can read about connecting on the Pika documentation here:
http://pika.github.com/connecting.html

Check out the credentials section on how to change what user/password
you're sending.

Cheers,
-Alex

On Mon, Jul 2, 2012 at 3:47 PM, eleanor <evangeline.eleanor at gmail.com>wrote:

> Hi, does anybody know this. I've successfully built the HTTP backend module
> for rabbitmq, but now I need to know how can I authenticate against it with
> rabbitmq code (client code).
>
> If there are any suggestions - even with normal ldap or some other login
> mechanism - I would be glad to hear it or read about it if you post a link
> to tutorial.
>
> Thank you
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/How-to-specify-user-pass-tp20479p20522.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/e748da08/attachment.htm>

From aravindh86 at gmail.com  Mon Jul  2 22:05:00 2012
From: aravindh86 at gmail.com (Aravindh S)
Date: Mon, 2 Jul 2012 17:05:00 -0400
Subject: [rabbitmq-discuss] Issue in creating a RabbitMQ Cluster
Message-ID: <CAL696ubrR66MQnYUK_8KdOA6HDW3mFgHTW5BnWQ2mngCd7E2-g@mail.gmail.com>

Hi.

I am trying to create a cluster of three RabbitMQ nodes.
I am having trouble setting the ".erlang.cookie" file correctly.

Node1 - x.y.z.28        - Ubuntu 12.04 - RabbitMQ installed from
repositories.
Node2 - x.y.z.38        - Ubuntu 12.04 - RabbitMQ installed from
repositories.
Node3 - x.y.z.39        - Ubuntu 12.04 - RabbitMQ installed from
repositories.

Individually all the three nodes are working fine.

Step 1 : copy the erlang magic cookie between the nodes

   - I replace the /var/lib/rabbitmq/.erlang.cookie file in Node 2 with
   that of Node 1
   - ls -al shows the file is owned by "rabbitmq" user

step 2 : I try to add Node2 to a cluster with Node1

   - Every rabbitmqctl command fails like below

root at rabbit3:/home/aravindh# rabbitmqctl cluster rabbit at 130.127.39.28
Clustering node rabbit at rabbit3 with ['rabbit at 130.127.39.28'] ...
Error: unable to connect to node rabbit at rabbit3: nodedown
diagnostics:
- nodes and their ports on rabbit3:
[{rabbit,37223},{rabbitmqctl12238,44154}]
- current node: rabbitmqctl12238 at rabbit3
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: rMqeVIBUabtB2sZrvleTTQ==


root at rabbit3:/home/aravindh# rabbitmqctl status
Status of node rabbit at rabbit3 ...
Error: unable to connect to node rabbit at rabbit3: nodedown
diagnostics:
- nodes and their ports on rabbit3:
[{rabbit,37223},{rabbitmqctl12271,38179}]
- current node: rabbitmqctl12271 at rabbit3
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: rMqeVIBUabtB2sZrvleTTQ==

Reverting back to the original .erlang.cookie file gets rid of the error,
but I cannot proceed with cluster without this cookie step right ?

please help me find where I am going wrong ....

--

Aravindh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/4d6775bb/attachment.htm>

From evangeline.eleanor at gmail.com  Mon Jul  2 23:22:10 2012
From: evangeline.eleanor at gmail.com (eleanor)
Date: Mon, 2 Jul 2012 15:22:10 -0700 (PDT)
Subject: [rabbitmq-discuss] How to specify user/pass
In-Reply-To: <1341204347925-20479.post@n5.nabble.com>
References: <1341204347925-20479.post@n5.nabble.com>
Message-ID: <1341267730612-20525.post@n5.nabble.com>

Yeah, that works fine with internal authentication scheme of rabbitmq.

But what about https://github.com/simonmacmullen/rabbitmq-auth-backend-http
. I've installed the plugin successfully. 

Then I've put the following into ebin/rabbit.app as HTTP README says:

{application,rabbit,
    [{description,"RabbitMQ"},
     {id,"RabbitMQ"},
     {vsn,"%%VSN%%"},
     {modules,
        
[app_utils,credit_flow,delegate,delegate_sup,dtree,file_handle_cache,
         
gatherer,gen_server2,gm,gm_soak_test,gm_speed_test,gm_tests,lqueue,
         
mirrored_supervisor,mirrored_supervisor_tests,mnesia_sync,pg2_fixed,
          pg_local,pmon,priority_queue,rabbit,rabbit_access_control,
          rabbit_alarm,rabbit_amqqueue,rabbit_amqqueue_process,
          rabbit_amqqueue_sup,rabbit_auth_backend,
          rabbit_auth_backend_internal,rabbit_auth_mechanism,
          rabbit_auth_mechanism_amqplain,rabbit_auth_mechanism_cr_demo,
          rabbit_auth_mechanism_plain,rabbit_backing_queue,
          rabbit_backing_queue_qc,rabbit_basic,rabbit_binary_generator,
          rabbit_binary_parser,rabbit_binding,rabbit_channel,
          rabbit_channel_sup,rabbit_channel_sup_sup,rabbit_client_sup,
         
rabbit_command_assembler,rabbit_connection_sup,rabbit_control_main,
          rabbit_ctl_usage,rabbit_direct,rabbit_disk_monitor,
          rabbit_error_logger,rabbit_error_logger_file_h,rabbit_event,
          rabbit_exchange,rabbit_exchange_decorator,rabbit_exchange_type,
          rabbit_exchange_type_direct,rabbit_exchange_type_fanout,
          rabbit_exchange_type_headers,rabbit_exchange_type_invalid,
          rabbit_exchange_type_topic,rabbit_file,rabbit_framing,
          rabbit_framing_amqp_0_8,rabbit_framing_amqp_0_9_1,rabbit_guid,
          rabbit_heartbeat,rabbit_limiter,rabbit_log,rabbit_memory_monitor,
          rabbit_mirror_queue_coordinator,rabbit_mirror_queue_master,
          rabbit_mirror_queue_misc,rabbit_mirror_queue_slave,
          rabbit_mirror_queue_slave_sup,rabbit_misc,rabbit_mnesia,
          rabbit_msg_file,rabbit_msg_store,rabbit_msg_store_ets_index,
          rabbit_msg_store_gc,rabbit_msg_store_index,rabbit_net,
          rabbit_networking,rabbit_node_monitor,rabbit_nodes,
          rabbit_parameter_validation,rabbit_plugins,rabbit_plugins_main,
          rabbit_plugins_usage,rabbit_policy,rabbit_prelaunch,
          rabbit_queue_collector,rabbit_queue_index,rabbit_reader,
          rabbit_registry,rabbit_restartable_sup,rabbit_router,
          rabbit_runtime_parameter,rabbit_runtime_parameters,
         
rabbit_runtime_parameters_test,rabbit_sasl_report_file_h,rabbit_ssl,
          rabbit_sup,rabbit_tests,rabbit_tests_event_receiver,rabbit_trace,
          rabbit_types,rabbit_upgrade,rabbit_upgrade_functions,
          rabbit_variable_queue,rabbit_version,rabbit_vhost,rabbit_writer,
          supervisor2,tcp_acceptor,tcp_acceptor_sup,tcp_listener,
          tcp_listener_sup,test_sup,vm_memory_monitor,worker_pool,
          worker_pool_sup,worker_pool_worker]},
     {registered,
         [rabbit_amqqueue_sup,rabbit_log,rabbit_node_monitor,rabbit_router,
          rabbit_sup,rabbit_tcp_client_sup,rabbit_direct_client_sup]},
     {applications,[kernel,stdlib,sasl,mnesia,os_mon]},
     {mod,{rabbit,[]}},
     {rabbitmq_auth_backend_http,
       [{user_path,     "http://127.0.0.1/auth/user"},
        {vhost_path,    "http://127.0.0.1/auth/vhost"},
        {resource_path, "http://127.0.0.1/auth/resource"}]},
     {env,
         [{hipe_compile,false},
          {tcp_listeners,[5672]},
          {ssl_listeners,[]},
          {ssl_options,[]},
          {vm_memory_high_watermark,0.4},
          {disk_free_limit,1000000000},
          {msg_store_index_module,rabbit_msg_store_ets_index},
          {backing_queue_module,rabbit_variable_queue},
          {frame_max,131072},
          {msg_store_file_size_limit,16777216},
          {queue_index_max_journal_entries,262144},
          {default_user,<<"guest">>},
          {default_pass,<<"guest">>},
          {default_user_tags,[administrator]},
          {default_vhost,<<"/">>},
          {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
          {cluster_nodes,[]},
          {server_properties,[]},
          {collect_statistics,none},
          {collect_statistics_interval,5000},
          {auth_mechanisms,['PLAIN','AMQPLAIN']},
          {auth_backends,[rabbitmq_auth_backend_http]},
          {delegate_count,16},
          {trace_vhosts,[]},
          {log_levels,[{connection,info}]},
          {ssl_cert_login_from,distinguished_name},
          {tcp_listen_options,
              [binary,
               {packet,raw},
               {reuseaddr,true},
               {backlog,128},
               {nodelay,true},
               {linger,{true,0}},
               {exit_on_close,false}]}]}]}.



Notice the:
 {rabbit, [{auth_backends, [rabbit_auth_backend_http]}]},
  {rabbitmq_auth_backend_http,
   [{user_path,     "http://some-server/auth/user"},
    {vhost_path,    "http://some-server/auth/vhost"},
    {resource_path, "http://some-server/auth/resource"}]}



The problem is that with the following send.py I cannot login to the
rabbitmq with HTTP server:
#!/usr/bin/env python
import pika

credentials = pika.PlainCredentials('test', 'test')
params = pika.ConnectionParameters(credentials=credentials,
host="localhost", virtual_host='/')
connection = pika.BlockingConnection(params)
channel = connection.channel()
channel.queue_declare(queue='')
channel.basic_publish(exchange='logs', routing_key='', body='Hello World!')
connection.close()


I specified the test:test username and password, since that's what I added
to the django application, which is included as an example to the HTTP
plugin. If I enter the GET request:
    http://127.0.0.1:8000/auth/user?username=test&password=test

everything is ok - the user is authenticated.

But when I try to login with the send.py script, the GET request isn't even
made. Now my question is: how to fix rabbitmq for rabbitmq to start making
GET requests to the http server or how to debug an issue?

Thank you

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-specify-user-pass-tp20479p20525.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ivan.lysov at gmail.com  Mon Jul  2 23:24:17 2012
From: ivan.lysov at gmail.com (ivan.lysov)
Date: Mon, 2 Jul 2012 15:24:17 -0700 (PDT)
Subject: [rabbitmq-discuss] lost messages (.NET)
In-Reply-To: <CABzX+qzpW3LCa6LLf-VGjSnYQ+9dMXn_bn_pyW6dPs_J80TieQ@mail.gmail.com>
References: <1340818001643-20402.post@n5.nabble.com>
	<CABzX+qzpW3LCa6LLf-VGjSnYQ+9dMXn_bn_pyW6dPs_J80TieQ@mail.gmail.com>
Message-ID: <1341267857667-20526.post@n5.nabble.com>

Marek, thank you for response!

Everything is working in a proper way. Better look on my logs explained it
to me, I was confused by the order of the delivering messages. Sorry for my
panic)

I have couple of questions on ConnectionFactory.RequestedHeartbeat property.

- Should i set it in the case of unstable connections (GPRS)?
- Is it possible to set the value lower than 1 second and does it make
sense?

Thank you!

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/lost-messages-NET-tp20402p20526.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alexander.ward at quibids.com  Mon Jul  2 23:34:58 2012
From: alexander.ward at quibids.com (Alexander Ward)
Date: Mon, 2 Jul 2012 17:34:58 -0500
Subject: [rabbitmq-discuss] How to specify user/pass
In-Reply-To: <1341267730612-20525.post@n5.nabble.com>
References: <1341204347925-20479.post@n5.nabble.com>
	<1341267730612-20525.post@n5.nabble.com>
Message-ID: <CAKeoubXdGmUkbvAap0F8usPx7+Z2QnNM=nN47UmtNinxEb0V+Q@mail.gmail.com>

Ah. I have never used said plugin, so I don't really know anything about
it. My guess would be that your configuration is off a little bit (for
example, I have no idea if both stanzas need to be inside of env or not).

But the documentation does say:

Check the RabbitMQ logs if things don't seem to be working properly. Look
> for log messages containing "rabbit_auth_backend_http failed".
>

Best of luck.

-Alex

On Mon, Jul 2, 2012 at 5:22 PM, eleanor <evangeline.eleanor at gmail.com>wrote:

> Yeah, that works fine with internal authentication scheme of rabbitmq.
>
> But what about
> https://github.com/simonmacmullen/rabbitmq-auth-backend-http
> . I've installed the plugin successfully.
>
> Then I've put the following into ebin/rabbit.app as HTTP README says:
>
> {application,rabbit,
>     [{description,"RabbitMQ"},
>      {id,"RabbitMQ"},
>      {vsn,"%%VSN%%"},
>      {modules,
>
> [app_utils,credit_flow,delegate,delegate_sup,dtree,file_handle_cache,
>
> gatherer,gen_server2,gm,gm_soak_test,gm_speed_test,gm_tests,lqueue,
>
> mirrored_supervisor,mirrored_supervisor_tests,mnesia_sync,pg2_fixed,
>           pg_local,pmon,priority_queue,rabbit,rabbit_access_control,
>           rabbit_alarm,rabbit_amqqueue,rabbit_amqqueue_process,
>           rabbit_amqqueue_sup,rabbit_auth_backend,
>           rabbit_auth_backend_internal,rabbit_auth_mechanism,
>           rabbit_auth_mechanism_amqplain,rabbit_auth_mechanism_cr_demo,
>           rabbit_auth_mechanism_plain,rabbit_backing_queue,
>           rabbit_backing_queue_qc,rabbit_basic,rabbit_binary_generator,
>           rabbit_binary_parser,rabbit_binding,rabbit_channel,
>           rabbit_channel_sup,rabbit_channel_sup_sup,rabbit_client_sup,
>
> rabbit_command_assembler,rabbit_connection_sup,rabbit_control_main,
>           rabbit_ctl_usage,rabbit_direct,rabbit_disk_monitor,
>           rabbit_error_logger,rabbit_error_logger_file_h,rabbit_event,
>           rabbit_exchange,rabbit_exchange_decorator,rabbit_exchange_type,
>           rabbit_exchange_type_direct,rabbit_exchange_type_fanout,
>           rabbit_exchange_type_headers,rabbit_exchange_type_invalid,
>           rabbit_exchange_type_topic,rabbit_file,rabbit_framing,
>           rabbit_framing_amqp_0_8,rabbit_framing_amqp_0_9_1,rabbit_guid,
>           rabbit_heartbeat,rabbit_limiter,rabbit_log,rabbit_memory_monitor,
>           rabbit_mirror_queue_coordinator,rabbit_mirror_queue_master,
>           rabbit_mirror_queue_misc,rabbit_mirror_queue_slave,
>           rabbit_mirror_queue_slave_sup,rabbit_misc,rabbit_mnesia,
>           rabbit_msg_file,rabbit_msg_store,rabbit_msg_store_ets_index,
>           rabbit_msg_store_gc,rabbit_msg_store_index,rabbit_net,
>           rabbit_networking,rabbit_node_monitor,rabbit_nodes,
>           rabbit_parameter_validation,rabbit_plugins,rabbit_plugins_main,
>           rabbit_plugins_usage,rabbit_policy,rabbit_prelaunch,
>           rabbit_queue_collector,rabbit_queue_index,rabbit_reader,
>           rabbit_registry,rabbit_restartable_sup,rabbit_router,
>           rabbit_runtime_parameter,rabbit_runtime_parameters,
>
> rabbit_runtime_parameters_test,rabbit_sasl_report_file_h,rabbit_ssl,
>           rabbit_sup,rabbit_tests,rabbit_tests_event_receiver,rabbit_trace,
>           rabbit_types,rabbit_upgrade,rabbit_upgrade_functions,
>           rabbit_variable_queue,rabbit_version,rabbit_vhost,rabbit_writer,
>           supervisor2,tcp_acceptor,tcp_acceptor_sup,tcp_listener,
>           tcp_listener_sup,test_sup,vm_memory_monitor,worker_pool,
>           worker_pool_sup,worker_pool_worker]},
>      {registered,
>          [rabbit_amqqueue_sup,rabbit_log,rabbit_node_monitor,rabbit_router,
>           rabbit_sup,rabbit_tcp_client_sup,rabbit_direct_client_sup]},
>      {applications,[kernel,stdlib,sasl,mnesia,os_mon]},
>      {mod,{rabbit,[]}},
>      {rabbitmq_auth_backend_http,
>        [{user_path,     "http://127.0.0.1/auth/user"},
>         {vhost_path,    "http://127.0.0.1/auth/vhost"},
>         {resource_path, "http://127.0.0.1/auth/resource"}]},
>      {env,
>          [{hipe_compile,false},
>           {tcp_listeners,[5672]},
>           {ssl_listeners,[]},
>           {ssl_options,[]},
>           {vm_memory_high_watermark,0.4},
>           {disk_free_limit,1000000000},
>           {msg_store_index_module,rabbit_msg_store_ets_index},
>           {backing_queue_module,rabbit_variable_queue},
>           {frame_max,131072},
>           {msg_store_file_size_limit,16777216},
>           {queue_index_max_journal_entries,262144},
>           {default_user,<<"guest">>},
>           {default_pass,<<"guest">>},
>           {default_user_tags,[administrator]},
>           {default_vhost,<<"/">>},
>           {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>           {cluster_nodes,[]},
>           {server_properties,[]},
>           {collect_statistics,none},
>           {collect_statistics_interval,5000},
>           {auth_mechanisms,['PLAIN','AMQPLAIN']},
>           {auth_backends,[rabbitmq_auth_backend_http]},
>           {delegate_count,16},
>           {trace_vhosts,[]},
>           {log_levels,[{connection,info}]},
>           {ssl_cert_login_from,distinguished_name},
>           {tcp_listen_options,
>               [binary,
>                {packet,raw},
>                {reuseaddr,true},
>                {backlog,128},
>                {nodelay,true},
>                {linger,{true,0}},
>                {exit_on_close,false}]}]}]}.
>
>
>
> Notice the:
>  {rabbit, [{auth_backends, [rabbit_auth_backend_http]}]},
>   {rabbitmq_auth_backend_http,
>    [{user_path,     "http://some-server/auth/user"},
>     {vhost_path,    "http://some-server/auth/vhost"},
>     {resource_path, "http://some-server/auth/resource"}]}
>
>
>
> The problem is that with the following send.py I cannot login to the
> rabbitmq with HTTP server:
> #!/usr/bin/env python
> import pika
>
> credentials = pika.PlainCredentials('test', 'test')
> params = pika.ConnectionParameters(credentials=credentials,
> host="localhost", virtual_host='/')
> connection = pika.BlockingConnection(params)
> channel = connection.channel()
> channel.queue_declare(queue='')
> channel.basic_publish(exchange='logs', routing_key='', body='Hello World!')
> connection.close()
>
>
> I specified the test:test username and password, since that's what I added
> to the django application, which is included as an example to the HTTP
> plugin. If I enter the GET request:
>     http://127.0.0.1:8000/auth/user?username=test&password=test
>
> everything is ok - the user is authenticated.
>
> But when I try to login with the send.py script, the GET request isn't even
> made. Now my question is: how to fix rabbitmq for rabbitmq to start making
> GET requests to the http server or how to debug an issue?
>
> Thank you
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/How-to-specify-user-pass-tp20479p20525.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/c0f77eaa/attachment.htm>

From tim at rabbitmq.com  Tue Jul  3 01:56:48 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 03 Jul 2012 01:56:48 +0100
Subject: [rabbitmq-discuss] Issue in creating a RabbitMQ Cluster
In-Reply-To: <CAL696ubrR66MQnYUK_8KdOA6HDW3mFgHTW5BnWQ2mngCd7E2-g@mail.gmail.com>
References: <CAL696ubrR66MQnYUK_8KdOA6HDW3mFgHTW5BnWQ2mngCd7E2-g@mail.gmail.com>
Message-ID: <4FF24350.4080001@rabbitmq.com>

On 02/07/2012 22:05, Aravindh S wrote:
> Hi.
>
> I am trying to create a cluster of three RabbitMQ nodes.
> I am having trouble setting the ".erlang.cookie" file correctly.
>
> Node1 - x.y.z.28        - Ubuntu 12.04 - RabbitMQ installed from
> repositories.
> Node2 - x.y.z.38        - Ubuntu 12.04 - RabbitMQ installed from
> repositories.
> Node3 - x.y.z.39        - Ubuntu 12.04 - RabbitMQ installed from
> repositories.
>
> Individually all the three nodes are working fine.
>
> Step 1 : copy the erlang magic cookie between the nodes
>
>   * I replace the /var/lib/rabbitmq/.erlang.cookie file in Node 2 with
>     that of Node 1
>   * ls -al shows the file is owned by "rabbitmq" user

make sure the permissions are tight enough (readable ONLY):

-r--------    1 t4    staff      20  8 Apr  2010 .erlang.cookie

>
> step 2 : I try to add Node2 to a cluster with Node1
>
>   * Every rabbitmqctl command fails like below
>
> root at rabbit3:/home/aravindh# rabbitmqctl cluster rabbit at 130.127.39.28
> <mailto:rabbit at 130.127.39.28>
> Clustering node rabbit at rabbit3 with ['rabbit at 130.127.39.28
> <mailto:rabbit at 130.127.39.28>'] ...
> Error: unable to connect to node rabbit at rabbit3: nodedown
> diagnostics:
> - nodes and their ports on rabbit3:
> [{rabbit,37223},{rabbitmqctl12238,44154}]
> - current node: rabbitmqctl12238 at rabbit3
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: rMqeVIBUabtB2sZrvleTTQ==
>
>

Well why are you using an IP addr instead of hostname!? It looks like 
you're not even running rabbit on rabbit3. Have you actually run 
rabbitmq-server to start the broker? What does erl -sname rabbit look 
like on the local machine(s)?

> root at rabbit3:/home/aravindh# rabbitmqctl status
> Status of node rabbit at rabbit3 ...
> Error: unable to connect to node rabbit at rabbit3: nodedown
> diagnostics:
> - nodes and their ports on rabbit3:
> [{rabbit,37223},{rabbitmqctl12271,38179}]
> - current node: rabbitmqctl12271 at rabbit3
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: rMqeVIBUabtB2sZrvleTTQ==
>

This is saying that the local node (rabbit at rabbit3) is not running. This 
is *probably* because your Erlang cookie's permissions aren't tight enough.

> Reverting back to the original .erlang.cookie file gets rid of the
> error, but I cannot proceed with cluster without this cookie step right ?
>

That is correct. Try making the permission on the cookie file more 
restrictive. Don't forget to start the broker and then try running 
`rabbitmqctl status` and see if you're up and running locally.


From tim at rabbitmq.com  Tue Jul  3 02:03:55 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 03 Jul 2012 02:03:55 +0100
Subject: [rabbitmq-discuss] How to specify user/pass
In-Reply-To: <1341267730612-20525.post@n5.nabble.com>
References: <1341204347925-20479.post@n5.nabble.com>
	<1341267730612-20525.post@n5.nabble.com>
Message-ID: <4FF244FB.2040300@rabbitmq.com>

On 02/07/2012 23:22, eleanor wrote:
> Yeah, that works fine with internal authentication scheme of rabbitmq.
>
>

Snip.

>       {mod,{rabbit,[]}},
>       {rabbitmq_auth_backend_http,
>         [{user_path,     "http://127.0.0.1/auth/user"},
>          {vhost_path,    "http://127.0.0.1/auth/vhost"},
>          {resource_path, "http://127.0.0.1/auth/resource"}]},
>       {env,

Ok, so you're look at http://127.0.0.1/auth/user - does that *really* 
return a response for you!?

snip snip....

> I specified the test:test username and password, since that's what I added
> to the django application, which is included as an example to the HTTP
> plugin. If I enter the GET request:
>      http://127.0.0.1:8000/auth/user?username=test&password=test
>

Because *THIS* URL specifies that the web application is running on a 
different port - 8000. Unless I'm loosing my marbles, the default port 
for HTTP traffic is 8080, so that's probably why the rabbit plugin 
cannot get through to your web server.

From matthias at rabbitmq.com  Tue Jul  3 02:41:54 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 03 Jul 2012 02:41:54 +0100
Subject: [rabbitmq-discuss] Issue in creating a RabbitMQ Cluster
In-Reply-To: <4FF24350.4080001@rabbitmq.com>
References: <CAL696ubrR66MQnYUK_8KdOA6HDW3mFgHTW5BnWQ2mngCd7E2-g@mail.gmail.com>
	<4FF24350.4080001@rabbitmq.com>
Message-ID: <4FF24DE2.5070504@rabbitmq.com>

On 03/07/12 01:56, Tim Watson wrote:
> On 02/07/2012 22:05, Aravindh S wrote:
>> diagnostics:
>> - nodes and their ports on rabbit3:
>> [{rabbit,37223},{rabbitmqctl12238,44154}]
>
> It looks like you're not even running rabbit on rabbit3.

Er, yes he is. Hence the {rabbit,37223} line.

> This is saying that the local node (rabbit at rabbit3) is not running. This
> is *probably* because your Erlang cookie's permissions aren't tight enough.

Or the cookies simply don't match. Check the startup log of the nodes, 
which displays their cookie hashes, and compare that info to what is 
shown by rabbitmqctl.

Or the ports aren't accessible due to firewalls etc. Try connecting to 
the port displayed for rabbit in the diagnostics, e.g. "telnet rabbit3 
37223".

Also, check the troubleshooting guide at 
http://www.rabbitmq.com/troubleshooting.html

Matthias.

From tim at rabbitmq.com  Tue Jul  3 03:06:23 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 03 Jul 2012 03:06:23 +0100
Subject: [rabbitmq-discuss] Issue in creating a RabbitMQ Cluster
In-Reply-To: <4FF24DE2.5070504@rabbitmq.com>
References: <CAL696ubrR66MQnYUK_8KdOA6HDW3mFgHTW5BnWQ2mngCd7E2-g@mail.gmail.com>
	<4FF24350.4080001@rabbitmq.com> <4FF24DE2.5070504@rabbitmq.com>
Message-ID: <4FF2539F.3030903@rabbitmq.com>

On 03/07/2012 02:41, Matthias Radestock wrote:
> On 03/07/12 01:56, Tim Watson wrote:
>> On 02/07/2012 22:05, Aravindh S wrote:
>>> diagnostics:
>>> - nodes and their ports on rabbit3:
>>> [{rabbit,37223},{rabbitmqctl12238,44154}]
>>
>> It looks like you're not even running rabbit on rabbit3.
>
> Er, yes he is. Hence the {rabbit,37223} line.

Good point! :/

>
>> This is saying that the local node (rabbit at rabbit3) is not running. This
>> is *probably* because your Erlang cookie's permissions aren't tight
>> enough.
>

But isn't this line

"Error: unable to connect to node rabbit at rabbit3: nodedown"

Saying that rabbitmqctl cannot connect to rabbit at rabbit3, which is the 
local node!?

From tim at rabbitmq.com  Tue Jul  3 03:09:53 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 03 Jul 2012 03:09:53 +0100
Subject: [rabbitmq-discuss] Issue in creating a RabbitMQ Cluster
In-Reply-To: <4FF2539F.3030903@rabbitmq.com>
References: <CAL696ubrR66MQnYUK_8KdOA6HDW3mFgHTW5BnWQ2mngCd7E2-g@mail.gmail.com>
	<4FF24350.4080001@rabbitmq.com> <4FF24DE2.5070504@rabbitmq.com>
	<4FF2539F.3030903@rabbitmq.com>
Message-ID: <4FF25471.2020701@rabbitmq.com>

On 03/07/2012 03:06, Tim Watson wrote:
>>
>
> But isn't this line
>
> "Error: unable to connect to node rabbit at rabbit3: nodedown"
>
> Saying that rabbitmqctl cannot connect to rabbit at rabbit3, which is the
> local node!?

Oops, was a bit trigger happy with the send button! What I mean by that 
is, perhaps the rabbit instance on the current node (rabbit3) is running 
but not contactable by rabbitmqctl, because e.g., it was started before 
the cookies changed.

From matthias at rabbitmq.com  Tue Jul  3 03:09:48 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 03 Jul 2012 03:09:48 +0100
Subject: [rabbitmq-discuss] Issue in creating a RabbitMQ Cluster
In-Reply-To: <4FF2539F.3030903@rabbitmq.com>
References: <CAL696ubrR66MQnYUK_8KdOA6HDW3mFgHTW5BnWQ2mngCd7E2-g@mail.gmail.com>
	<4FF24350.4080001@rabbitmq.com> <4FF24DE2.5070504@rabbitmq.com>
	<4FF2539F.3030903@rabbitmq.com>
Message-ID: <4FF2546C.2040408@rabbitmq.com>

On 03/07/12 03:06, Tim Watson wrote:
> "Error: unable to connect to node rabbit at rabbit3: nodedown"
>
> Saying that rabbitmqctl cannot connect to rabbit at rabbit3, which is the
> local node!?

Correct. But that doesn't mean the node isn't running. 'nodedown' is the 
reason Erlang gives, and it covers a multitude of failures, hence we 
show the diagnostics info in order to help narrowing down the cause.

Matthias.

From evangeline.eleanor at gmail.com  Tue Jul  3 05:39:50 2012
From: evangeline.eleanor at gmail.com (eleanor)
Date: Mon, 2 Jul 2012 21:39:50 -0700 (PDT)
Subject: [rabbitmq-discuss] How to specify user/pass
In-Reply-To: <4FF244FB.2040300@rabbitmq.com>
References: <1341204347925-20479.post@n5.nabble.com>
	<1341267730612-20525.post@n5.nabble.com>
	<4FF244FB.2040300@rabbitmq.com>
Message-ID: <1341290390924-20534.post@n5.nabble.com>

Hi,

yeah that's a big mistake I overlooked, but it isn't the cause. The rabbitmq
still doesn't send any requests to the specified web site. 

Can somebody check if I configured the rabbit.app correctly. Here's the
updated version of it:

{application,rabbit,
    [{description,"RabbitMQ"},
     {id,"RabbitMQ"},
     {vsn,"%%VSN%%"},
     {modules,
        
[app_utils,credit_flow,delegate,delegate_sup,dtree,file_handle_cache,
         
gatherer,gen_server2,gm,gm_soak_test,gm_speed_test,gm_tests,lqueue,
         
mirrored_supervisor,mirrored_supervisor_tests,mnesia_sync,pg2_fixed,
          pg_local,pmon,priority_queue,rabbit,rabbit_access_control,
          rabbit_alarm,rabbit_amqqueue,rabbit_amqqueue_process,
          rabbit_amqqueue_sup,rabbit_auth_backend,
          rabbit_auth_backend_internal,rabbit_auth_mechanism,
          rabbit_auth_mechanism_amqplain,rabbit_auth_mechanism_cr_demo,
          rabbit_auth_mechanism_plain,rabbit_backing_queue,
          rabbit_backing_queue_qc,rabbit_basic,rabbit_binary_generator,
          rabbit_binary_parser,rabbit_binding,rabbit_channel,
          rabbit_channel_sup,rabbit_channel_sup_sup,rabbit_client_sup,
         
rabbit_command_assembler,rabbit_connection_sup,rabbit_control_main,
          rabbit_ctl_usage,rabbit_direct,rabbit_disk_monitor,
          rabbit_error_logger,rabbit_error_logger_file_h,rabbit_event,
          rabbit_exchange,rabbit_exchange_decorator,rabbit_exchange_type,
          rabbit_exchange_type_direct,rabbit_exchange_type_fanout,
          rabbit_exchange_type_headers,rabbit_exchange_type_invalid,
          rabbit_exchange_type_topic,rabbit_file,rabbit_framing,
          rabbit_framing_amqp_0_8,rabbit_framing_amqp_0_9_1,rabbit_guid,
          rabbit_heartbeat,rabbit_limiter,rabbit_log,rabbit_memory_monitor,
          rabbit_mirror_queue_coordinator,rabbit_mirror_queue_master,
          rabbit_mirror_queue_misc,rabbit_mirror_queue_slave,
          rabbit_mirror_queue_slave_sup,rabbit_misc,rabbit_mnesia,
          rabbit_msg_file,rabbit_msg_store,rabbit_msg_store_ets_index,
          rabbit_msg_store_gc,rabbit_msg_store_index,rabbit_net,
          rabbit_networking,rabbit_node_monitor,rabbit_nodes,
          rabbit_parameter_validation,rabbit_plugins,rabbit_plugins_main,
          rabbit_plugins_usage,rabbit_policy,rabbit_prelaunch,
          rabbit_queue_collector,rabbit_queue_index,rabbit_reader,
          rabbit_registry,rabbit_restartable_sup,rabbit_router,
          rabbit_runtime_parameter,rabbit_runtime_parameters,
         
rabbit_runtime_parameters_test,rabbit_sasl_report_file_h,rabbit_ssl,
          rabbit_sup,rabbit_tests,rabbit_tests_event_receiver,rabbit_trace,
          rabbit_types,rabbit_upgrade,rabbit_upgrade_functions,
          rabbit_variable_queue,rabbit_version,rabbit_vhost,rabbit_writer,
          supervisor2,tcp_acceptor,tcp_acceptor_sup,tcp_listener,
          tcp_listener_sup,test_sup,vm_memory_monitor,worker_pool,
          worker_pool_sup,worker_pool_worker]},
     {registered,
         [rabbit_amqqueue_sup,rabbit_log,rabbit_node_monitor,rabbit_router,
          rabbit_sup,rabbit_tcp_client_sup,rabbit_direct_client_sup]},
     {applications,[kernel,stdlib,sasl,mnesia,os_mon]},
     {mod,{rabbit,[]}},
     {rabbitmq_auth_backend_http,
       [{user_path,     "http://127.0.0.1:8000/auth/user"},
        {vhost_path,    "http://127.0.0.1:8000/auth/vhost"},
        {resource_path, "http://127.0.0.1:8000/auth/resource"}]},
     {env,
         [{hipe_compile,false},
          {tcp_listeners,[5672]},
          {ssl_listeners,[]},
          {ssl_options,[]},
          {vm_memory_high_watermark,0.4},
          {disk_free_limit,1000000000},
          {msg_store_index_module,rabbit_msg_store_ets_index},
          {backing_queue_module,rabbit_variable_queue},
          {frame_max,131072},
          {msg_store_file_size_limit,16777216},
          {queue_index_max_journal_entries,262144},
          {default_user,<<"guest">>},
          {default_pass,<<"guest">>},
          {default_user_tags,[administrator]},
          {default_vhost,<<"/">>},
          {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
          {cluster_nodes,[]},
          {server_properties,[]},
          {collect_statistics,none},
          {collect_statistics_interval,5000},
          {auth_mechanisms,['PLAIN','AMQPLAIN']},
          {auth_backends,[rabbitmq_auth_backend_http]},
          {delegate_count,16},
          {trace_vhosts,[]},
          {log_levels,[{connection,info}]},
          {ssl_cert_login_from,distinguished_name},
          {tcp_listen_options,
              [binary,
               {packet,raw},
               {reuseaddr,true},
               {backlog,128},
               {nodelay,true},
               {linger,{true,0}},
               {exit_on_close,false}]}]}]}.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-specify-user-pass-tp20479p20534.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Tue Jul  3 08:19:03 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 3 Jul 2012 08:19:03 +0100
Subject: [rabbitmq-discuss] How to specify user/pass
In-Reply-To: <1341290390924-20534.post@n5.nabble.com>
References: <1341204347925-20479.post@n5.nabble.com>
	<1341267730612-20525.post@n5.nabble.com>
	<4FF244FB.2040300@rabbitmq.com>
	<1341290390924-20534.post@n5.nabble.com>
Message-ID: <084B639D-9846-4A20-9B32-6878C5FC19CD@rabbitmq.com>

No that doesn't look right to me. First of all, I would expect the rabbitmq_auth_backend_http config element to reside inside of the 'env' list - please bare in mind I've never used this plugin before so I could be mistaken, but AFAIK you cannot set this at the top level. So it would be

{env, [
    {rabbitmq_auth_backend_http, .....
]}

Also, you appear to still be missing the {rabbit, [{auth_backends, [rabbit_auth_backend_http]}]} entry that the example in the README  file instructs you to add. This should also go inside the env AFAICT.

I'm sure Simon (the plugin author!) will dive in and correct me if I've got this wrong!

Tim

On 3 Jul 2012, at 05:39, eleanor wrote:

> Hi,
> 
> yeah that's a big mistake I overlooked, but it isn't the cause. The rabbitmq
> still doesn't send any requests to the specified web site. 
> 
> Can somebody check if I configured the rabbit.app correctly. Here's the
> updated version of it:
> 
> {application,rabbit,
>    [{description,"RabbitMQ"},
>     {id,"RabbitMQ"},
>     {vsn,"%%VSN%%"},
>     {modules,
> 
> [app_utils,credit_flow,delegate,delegate_sup,dtree,file_handle_cache,
> 
> gatherer,gen_server2,gm,gm_soak_test,gm_speed_test,gm_tests,lqueue,
> 
> mirrored_supervisor,mirrored_supervisor_tests,mnesia_sync,pg2_fixed,
>          pg_local,pmon,priority_queue,rabbit,rabbit_access_control,
>          rabbit_alarm,rabbit_amqqueue,rabbit_amqqueue_process,
>          rabbit_amqqueue_sup,rabbit_auth_backend,
>          rabbit_auth_backend_internal,rabbit_auth_mechanism,
>          rabbit_auth_mechanism_amqplain,rabbit_auth_mechanism_cr_demo,
>          rabbit_auth_mechanism_plain,rabbit_backing_queue,
>          rabbit_backing_queue_qc,rabbit_basic,rabbit_binary_generator,
>          rabbit_binary_parser,rabbit_binding,rabbit_channel,
>          rabbit_channel_sup,rabbit_channel_sup_sup,rabbit_client_sup,
> 
> rabbit_command_assembler,rabbit_connection_sup,rabbit_control_main,
>          rabbit_ctl_usage,rabbit_direct,rabbit_disk_monitor,
>          rabbit_error_logger,rabbit_error_logger_file_h,rabbit_event,
>          rabbit_exchange,rabbit_exchange_decorator,rabbit_exchange_type,
>          rabbit_exchange_type_direct,rabbit_exchange_type_fanout,
>          rabbit_exchange_type_headers,rabbit_exchange_type_invalid,
>          rabbit_exchange_type_topic,rabbit_file,rabbit_framing,
>          rabbit_framing_amqp_0_8,rabbit_framing_amqp_0_9_1,rabbit_guid,
>          rabbit_heartbeat,rabbit_limiter,rabbit_log,rabbit_memory_monitor,
>          rabbit_mirror_queue_coordinator,rabbit_mirror_queue_master,
>          rabbit_mirror_queue_misc,rabbit_mirror_queue_slave,
>          rabbit_mirror_queue_slave_sup,rabbit_misc,rabbit_mnesia,
>          rabbit_msg_file,rabbit_msg_store,rabbit_msg_store_ets_index,
>          rabbit_msg_store_gc,rabbit_msg_store_index,rabbit_net,
>          rabbit_networking,rabbit_node_monitor,rabbit_nodes,
>          rabbit_parameter_validation,rabbit_plugins,rabbit_plugins_main,
>          rabbit_plugins_usage,rabbit_policy,rabbit_prelaunch,
>          rabbit_queue_collector,rabbit_queue_index,rabbit_reader,
>          rabbit_registry,rabbit_restartable_sup,rabbit_router,
>          rabbit_runtime_parameter,rabbit_runtime_parameters,
> 
> rabbit_runtime_parameters_test,rabbit_sasl_report_file_h,rabbit_ssl,
>          rabbit_sup,rabbit_tests,rabbit_tests_event_receiver,rabbit_trace,
>          rabbit_types,rabbit_upgrade,rabbit_upgrade_functions,
>          rabbit_variable_queue,rabbit_version,rabbit_vhost,rabbit_writer,
>          supervisor2,tcp_acceptor,tcp_acceptor_sup,tcp_listener,
>          tcp_listener_sup,test_sup,vm_memory_monitor,worker_pool,
>          worker_pool_sup,worker_pool_worker]},
>     {registered,
>         [rabbit_amqqueue_sup,rabbit_log,rabbit_node_monitor,rabbit_router,
>          rabbit_sup,rabbit_tcp_client_sup,rabbit_direct_client_sup]},
>     {applications,[kernel,stdlib,sasl,mnesia,os_mon]},
>     {mod,{rabbit,[]}},
>     {rabbitmq_auth_backend_http,
>       [{user_path,     "http://127.0.0.1:8000/auth/user"},
>        {vhost_path,    "http://127.0.0.1:8000/auth/vhost"},
>        {resource_path, "http://127.0.0.1:8000/auth/resource"}]},
>     {env,
>         [{hipe_compile,false},
>          {tcp_listeners,[5672]},
>          {ssl_listeners,[]},
>          {ssl_options,[]},
>          {vm_memory_high_watermark,0.4},
>          {disk_free_limit,1000000000},
>          {msg_store_index_module,rabbit_msg_store_ets_index},
>          {backing_queue_module,rabbit_variable_queue},
>          {frame_max,131072},
>          {msg_store_file_size_limit,16777216},
>          {queue_index_max_journal_entries,262144},
>          {default_user,<<"guest">>},
>          {default_pass,<<"guest">>},
>          {default_user_tags,[administrator]},
>          {default_vhost,<<"/">>},
>          {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>          {cluster_nodes,[]},
>          {server_properties,[]},
>          {collect_statistics,none},
>          {collect_statistics_interval,5000},
>          {auth_mechanisms,['PLAIN','AMQPLAIN']},
>          {auth_backends,[rabbitmq_auth_backend_http]},
>          {delegate_count,16},
>          {trace_vhosts,[]},
>          {log_levels,[{connection,info}]},
>          {ssl_cert_login_from,distinguished_name},
>          {tcp_listen_options,
>              [binary,
>               {packet,raw},
>               {reuseaddr,true},
>               {backlog,128},
>               {nodelay,true},
>               {linger,{true,0}},
>               {exit_on_close,false}]}]}]}.
> 
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-specify-user-pass-tp20479p20534.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/7fa792b4/attachment.htm>

From tim at rabbitmq.com  Tue Jul  3 08:25:40 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 3 Jul 2012 08:25:40 +0100
Subject: [rabbitmq-discuss] time to live (ttl) in c++ client
In-Reply-To: <CALK6wMr+zZ2-RDmAR1c6qvz7zF=k20PwNT-t-WFN=XPvroSKJg@mail.gmail.com>
References: <CALK6wMoveDBSRCCxz-AC0763QgeReVSnAJ9vybB6QfcpEscjaA@mail.gmail.com>
	<4FF17E29.60601@rabbitmq.com>
	<CALK6wMr+zZ2-RDmAR1c6qvz7zF=k20PwNT-t-WFN=XPvroSKJg@mail.gmail.com>
Message-ID: <D7D5F6D2-CA7C-4DAE-A4F9-E3AEA3547F3F@rabbitmq.com>

Hi Vadiraj,

Please keep the mailing cc-ed in, as this provides a record of answers for users later on to look at. For example, I answered a very similar question to this one yesterday on the mailing list: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/020968.html.

Now I'm not really 100% clear what your question is anymore. You asked about setting x-message-ttl, which is an argument to queue declare. I'm assuming that your description below (viz "C++ consumer consumes that message..." etc) is of what you want to eventually happen. Look at the link above to my previous answer to what is essentially the same question. TTL will be applied by the broker, so the clients simply need to coordinate themselves around the right queues and/or exchanges.

Oh and by the way, please feel free to call me Tim! ;)  

On 3 Jul 2012, at 06:45, vadiraj hebbar wrote:
> 
> 
> Hi Watson
> 
> I am referring AMQP c++ client. I am using Java client for publishing messages there i am setting ttl in channel.queuedeclare() method for 5 seconds, C++ consumer consumes that messages with in 5 seconds after 5 sec he cannot receive that msg.  if u know please explain with example .
> 
> 
> regards,
> Vadiraj


From matthias at rabbitmq.com  Tue Jul  3 08:49:15 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 03 Jul 2012 08:49:15 +0100
Subject: [rabbitmq-discuss] How to specify user/pass
In-Reply-To: <084B639D-9846-4A20-9B32-6878C5FC19CD@rabbitmq.com>
References: <1341204347925-20479.post@n5.nabble.com>
	<1341267730612-20525.post@n5.nabble.com>
	<4FF244FB.2040300@rabbitmq.com>
	<1341290390924-20534.post@n5.nabble.com>
	<084B639D-9846-4A20-9B32-6878C5FC19CD@rabbitmq.com>
Message-ID: <4FF2A3FB.9020707@rabbitmq.com>

On 03/07/12 08:19, Tim Watson wrote:
> No that doesn't look right to me. First of all, I would expect the
> rabbitmq_auth_backend_http config element to reside inside of the 'env'
> list - please bare in mind I've never used this plugin before so I could
> be mistaken, but AFAIK you cannot set this at the top level. So it would be
>
> {env, [
> {rabbitmq_auth_backend_http, .....
> ]}

Er, no. The plugin gets configured like any other plug-in: by placing an 
appropriate entry into the rabbitmq.config file (*not* .app). See 
http://www.rabbitmq.com/configure.html#configuration-file

> Also, you appear to still be missing the {rabbit, [{auth_backends,
> [rabbit_auth_backend_http]}]} entry that the example in the README file
> instructs you to add. This should also go inside the env AFAICT.

Ditto.

Matthias.

From joelfriedly at gmail.com  Tue Jul  3 00:11:46 2012
From: joelfriedly at gmail.com (Joel Friedly)
Date: Mon, 2 Jul 2012 16:11:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq-server Fails to Start
Message-ID: <71192ea9-31c8-4903-8912-97edc97fc83e@googlegroups.com>


>
> $ sudo service rabbitmq-server start
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, 
> _err}
> rabbitmq-server.

 
The log file shows that everything started properly, and the error file 
only says that rabbitmq-server failed to start:

Activating RabbitMQ plugins ...
> 0 plugins activated:
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v2.5.0  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2011 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
> node           : rabbit at ubuntu-vm
> app descriptor : 
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.5.0/sbin/../ebin/rabbit.app
> home dir       : /var/lib/rabbitmq
> config file(s) : (none)
> cookie hash    : Eg8kv9KaWD54peNHomznOw==
> log            : /var/log/rabbitmq/rabbit at ubuntu-vm.log
> sasl log       : /var/log/rabbitmq/rabbit at ubuntu-vm-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit at ubuntu-vm
> erlang version : 5.8.3
> -- rabbit boot start
> starting file handle cache server                                     
> ...done
> starting worker pool                                                 
>  ...done
> starting database                                                     
> ...done
> starting codec correctness check                                     
>  ...done
> -- external infrastructure ready
> starting plugin registry                                             
>  ...done
> starting auth mechanism cr-demo                                       
> ...done
> starting auth mechanism amqplain                                     
>  ...done
> starting auth mechanism plain                                         
> ...done
> starting statistics event manager                                     
> ...done
> starting logging server                                               
> ...done
> starting exchange type direct                                         
> ...done
> starting exchange type fanout                                         
> ...done
> starting exchange type headers                                       
>  ...done
> starting exchange type topic                                         
>  ...done
> -- kernel ready
> starting alarm handler                                               
>  ...done
> starting node monitor                                                 
> ...done
> starting cluster delegate                                             
> ...done
> starting guid generator                                               
> ...done
> starting memory monitor                                               
> ...done
> -- core initialized
> starting empty DB check                                               
> ...done
> starting exchange, queue and binding recovery                         
> ...done
> -- message delivery logic ready
> starting error log relay                                             
>  ...done
> starting networking                                                   
> ...done
> starting direct_client                                               
>  ...done
> starting notify cluster nodes                                         
> ...done
> broker running


Error file:

Mon Jul  2 15:29:32 PDT 2012 - rabbitmq failed to start


Running `ps aux | grep rabbit` after a failed start shows that the 
processes seem to be running normally though:

$ ps aux | grep rabbit
> rabbitmq 20611  0.0  0.0   6808   324 ?        S    15:02   0:01 
> /usr/lib/erlang/erts-5.8.3/bin/epmd -daemon
> root     22617  0.0  0.0   4272   580 ?        Ss   15:29   0:00 /bin/sh 
> /usr/sbin/rabbitmq-server
> rabbitmq 22626  0.0  0.0  44804  1388 ?        S    15:29   0:00 su 
> rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmq-server 
> rabbitmq 22627  0.0  0.0   4272   584 ?        S    15:29   0:00 sh -c 
> /usr/lib/rabbitmq/bin/rabbitmq-server 
> rabbitmq 22628  0.9  1.2  97360 26564 ?        Sl   15:29   0:07 
> /usr/lib/erlang/erts-5.8.3/bin/beam.smp -W w -K true -A30 -P 1048576 -- 
> -root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -- -noshell 
> -noinput -sname rabbit at ubuntu-vm -boot 
> /var/lib/rabbitmq/mnesia/rabbit at ubuntu-vm-plugins-expand/rabbit -kernel 
> inet_default_connect_options [{nodelay,true}] -sasl errlog_type error 
> -kernel error_logger {file,"/var/log/rabbitmq/rabbit at ubuntu-vm.log"} -sasl 
> sasl_error_logger {file,"/var/log/rabbitmq/rabbit at ubuntu-vm-sasl.log"} 
> -os_mon start_cpu_sup true -os_mon start_disksup false -os_mon start_memsup 
> false -mnesia dir "/var/lib/rabbitmq/mnesia/rabbit at ubuntu-vm"
> rabbitmq 22724  0.0  0.0   4164   324 ?        Ss   15:29   0:00 
> /usr/lib/erlang/lib/os_mon-2.2.5/priv/bin/cpu_sup
> rabbitmq 22725  0.0  0.0   6776   344 ?        Ss   15:29   0:00 
> inet_gethost 4
> rabbitmq 22726  0.0  0.0   8876   636 ?        S    15:29   0:00 
> inet_gethost 4
> joel     22805  0.0  0.0   9252   872 pts/0    R+   15:42   0:00 grep 
> rabbit


(My user is 'joel'.)

Running a `rabbitmqctl status` at this point shows that the broker is 
running:

$ sudo rabbitmqctl status
> Status of node 'rabbit at ubuntu-vm' ...
> [{pid,22628},
>  {running_applications,[{rabbit,"RabbitMQ","2.5.0"},
>                         {os_mon,"CPO  CXC 138 46","2.2.5"},
>                         {sasl,"SASL  CXC 138 11","2.1.9.3"},
>                         {mnesia,"MNESIA  CXC 138 12","4.4.17"},
>                         {stdlib,"ERTS  CXC 138 10","1.17.3"},
>                         {kernel,"ERTS  CXC 138 10","2.14.3"}]},
>  {os,{unix,linux}},
>  {erlang_version,"Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:3:3] 
> [rq:3] [async-threads:30] [kernel-poll:true]\n"},
>  {memory,[{total,24305496},
>           {processes,9824640},
>           {processes_used,9821704},
>           {system,14480856},
>           {atom,1108281},
>           {atom_used,1096596},
>           {binary,6944},
>           {code,10828669},
>           {ets,692904}]}]
> ...done.


At this point, attempting a `sudo service rabbitmq-server restart` fails, 
with the same error message as starting the server.
Stopping the server via any of service rabbitmq-server stop, rabbitmqctl 
stop, or rabbitmqctl stop_app works fine, and I can reset nodes as 
expected, but starting the server always reports failure.

For reference, here's the output from `sudo service rabbitmqctl report`:

$ sudo rabbitmqctl report
> Reporting server status on {{2012,7,2},{22,53,37}}
> Status of node 'rabbit at ubuntu-vm' ...
> [{pid,23209},
>  {running_applications,[{rabbit,"RabbitMQ","2.5.0"},
>                         {os_mon,"CPO  CXC 138 46","2.2.5"},
>                         {sasl,"SASL  CXC 138 11","2.1.9.3"},
>                         {mnesia,"MNESIA  CXC 138 12","4.4.17"},
>                         {stdlib,"ERTS  CXC 138 10","1.17.3"},
>                         {kernel,"ERTS  CXC 138 10","2.14.3"}]},
>  {os,{unix,linux}},
>  {erlang_version,"Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:3:3] 
> [rq:3] [async-threads:30] [kernel-poll:true]\n"},
>  {memory,[{total,24464720},
>           {processes,9917040},
>           {processes_used,9914104},
>           {system,14547680},
>           {atom,1108281},
>           {atom_used,1096530},
>           {binary,72472},
>           {code,10828669},
>           {ets,692760}]}]
> Cluster status of node 'rabbit at ubuntu-vm' ...
>
> [{nodes,[{disc,['rabbit at ubuntu-vm']}]},{running_nodes,['rabbit at ubuntu-vm']}]
> Application environment of node 'rabbit at ubuntu-vm' ...
> [{auth_backends,[rabbit_auth_backend_internal]},
>  {auth_mechanisms,['PLAIN','AMQPLAIN']},
>  {backing_queue_module,rabbit_variable_queue},
>  {cluster_nodes,[]},
>  {collect_statistics,none},
>  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
>  {delegate_count,16},
>  {frame_max,131072},
>  {included_applications,[]},
>  {msg_store_file_size_limit,16777216},
>  {msg_store_index_module,rabbit_msg_store_ets_index},
>  {persister_hibernate_after,10000},
>  {persister_max_wrap_entries,500},
>  {queue_index_max_journal_entries,262144},
>  {server_properties,[]},
>  {ssl_listeners,[]},
>  {ssl_options,[]},
>  {tcp_listen_options,[binary,
>                       {packet,raw},
>                       {reuseaddr,true},
>                       {backlog,128},
>                       {nodelay,true},
>                       {exit_on_close,false}]},
>  {tcp_listeners,[5672]},
>  {trace_vhosts,[]},
>  {vm_memory_high_watermark,0.4}]
> Connections:
> Channels:
> Queues on /:
> Exchanges on /:
> name type durable auto_delete internal arguments
> amq.direct direct true false false []
> amq.topic topic true false false []
> amq.rabbitmq.trace topic true false false []
> amq.rabbitmq.log topic true false false []
> amq.fanout fanout true false false []
> amq.headers headers true false false []
> direct true false false []
> amq.match headers true false false []
> Bindings on /:
> Consumers on /:
> Permissions on /:
> user configure write read
> guest .* .* .*
> End of server status report
> ...done.


-----------------------------------

This problem started pretty randomly.  I've been using rabbitmq for quite a 
while but running my test suite failed today and I can't think of anything 
different that I've done.  
I've also attempted rebooting and purging/reinstalling.  This is all 
running on an Ubuntu VM, which could potentially cause problems, but 
shouldn't.  If you guys don't have any suggestions, I guess my next step 
will be to try reinstalling the VM.


Thanks for any help,
Joel Friedly
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120702/8c7c39ba/attachment.htm>

From ake.kullenberg at gmail.com  Tue Jul  3 03:53:27 2012
From: ake.kullenberg at gmail.com (=?ISO-8859-1?Q?=C5ke_Kullenberg?=)
Date: Tue, 3 Jul 2012 10:53:27 +0800
Subject: [rabbitmq-discuss] What can I do about this ioloop error and
 subsequent write buffer exceeded warnings?
In-Reply-To: <08F63798499541D3BA685805976C3639@myyearbook.com>
References: <bc75d70e-d0d1-4626-8a0b-de6eb8c6ec77@googlegroups.com>
	<E71575E3-04EA-40DD-B502-CAC267E885E1@rabbitmq.com>
	<08F63798499541D3BA685805976C3639@myyearbook.com>
Message-ID: <CALTR4=O93vYiboac8CG_bLgcdqdAUgF0Ouf=d83HVOq5jD8y8g@mail.gmail.com>

Yes I am using one connection per thread. It works well, but I'd say once
every day this error pops up. The messaging performed is not very high
intensity so I don't think it is a performance issue.

I have attached the sender thread code. The code is very straight forward,
pretty much taken straight from the pika website. The ioloop is started in
run, and then the main thread will call the send function to send messages.

I am going to do some digging on my end to try to catch the error upstream
from where I catch it now.

On Sat, Jun 30, 2012 at 2:54 AM, Gavin M. Roy <gmr at myyearbook.com> wrote:

> Unless you're using a connection per thread, I'd not use threads. If you
> want to create a simple example recreating the issue I can try and track it
> down.
>
> Gavin
>
> On Friday, June 29, 2012 at 2:49 PM, Ask Solem wrote:
>
>
> On 25 Jun 2012, at 10:18, c00kiemonster wrote:
>
> I have a server script running three threads. One main thread with the
> inner core of the server instance, and then one receiver thread, and one
> sender thread. The receiver thread has one asynchronous pika connection
> receiving messages, and the sender thread has another asynchronous pika
> connection sending messages. This server instance is running just fine, but
> here and there this error pops up, and after the error comes write buffer
> exceeded warnings. At this point I simply restart the server script and
> everything is fine again.
>
> How can I track this issue down? It's not easy to replicate, usually it
> happens every second day or so. I guess the question is actually two fold.
> First, looking in the base_connection.py file on line 106, it seems that
> the error variable passed to the _handle_error is None which makes it
> problematic to get the error_code. At this point in the code it seems odd
> for error to be None, but on line 137 error has a default value of None. So
> the first thing is to try to figure out whether the error is a proper
> error, or if it's just a bug somewhere in the event handling. Second, if it
> turns out to be a proper error, how can I debug to see which message /
> event triggered the error? Is there any way that I can see inspect the
> traffic to try to find the bad message / event?
>
>
> Looks like a bug in pika to me, maybe you should open up an issue
> at https://github.com/pika/pika/issues
>
> This looks hard to track down indeed, but in general you should probably
> expect
> that such errors can happen, and retry the operation if it does.
>
> pika should raise some connection related error if there is no error code,
> so that you can depend on catching some other exception than TypeError.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/531d4a39/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: example.py
Type: application/octet-stream
Size: 1292 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/531d4a39/attachment.obj>

From tim at rabbitmq.com  Tue Jul  3 09:17:45 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 3 Jul 2012 09:17:45 +0100
Subject: [rabbitmq-discuss] How to specify user/pass
In-Reply-To: <4FF2A3FB.9020707@rabbitmq.com>
References: <1341204347925-20479.post@n5.nabble.com>
	<1341267730612-20525.post@n5.nabble.com>
	<4FF244FB.2040300@rabbitmq.com>
	<1341290390924-20534.post@n5.nabble.com>
	<084B639D-9846-4A20-9B32-6878C5FC19CD@rabbitmq.com>
	<4FF2A3FB.9020707@rabbitmq.com>
Message-ID: <5EB86C5C-04EA-4AAD-BCD0-E7037F38F4AA@rabbitmq.com>

Thanks for clearing that up Matthias. The documentation for the plugin should probably change, as the line "set the value of the auth_backends configuration item for the rabbit application" makes it sound like this is an item that be passed to the rabbit application in the ordinary OTP sense. Perhaps "set the value of the auth_backends configuration item for the rabbit application as per the instructions in in http://www.rabbitmq.com/configure.html#configuration-file" would be a good general pattern for plugin documentation to follow, just for those cases where users have jumped straight to trying to configure the plugin without reading all of the rabbit documentation?

On 3 Jul 2012, at 08:49, Matthias Radestock wrote:

> On 03/07/12 08:19, Tim Watson wrote:
>> No that doesn't look right to me. First of all, I would expect the
>> rabbitmq_auth_backend_http config element to reside inside of the 'env'
>> list - please bare in mind I've never used this plugin before so I could
>> be mistaken, but AFAIK you cannot set this at the top level. So it would be
>> 
>> {env, [
>> {rabbitmq_auth_backend_http, .....
>> ]}
> 
> Er, no. The plugin gets configured like any other plug-in: by placing an appropriate entry into the rabbitmq.config file (*not* .app). See http://www.rabbitmq.com/configure.html#configuration-file
> 
>> Also, you appear to still be missing the {rabbit, [{auth_backends,
>> [rabbit_auth_backend_http]}]} entry that the example in the README file
>> instructs you to add. This should also go inside the env AFAICT.
> 
> Ditto.
> 
> Matthias.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/1662c11b/attachment.htm>

From matthias at rabbitmq.com  Tue Jul  3 09:23:40 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 03 Jul 2012 09:23:40 +0100
Subject: [rabbitmq-discuss] How to specify user/pass
In-Reply-To: <5EB86C5C-04EA-4AAD-BCD0-E7037F38F4AA@rabbitmq.com>
References: <1341204347925-20479.post@n5.nabble.com>
	<1341267730612-20525.post@n5.nabble.com>
	<4FF244FB.2040300@rabbitmq.com>
	<1341290390924-20534.post@n5.nabble.com>
	<084B639D-9846-4A20-9B32-6878C5FC19CD@rabbitmq.com>
	<4FF2A3FB.9020707@rabbitmq.com>
	<5EB86C5C-04EA-4AAD-BCD0-E7037F38F4AA@rabbitmq.com>
Message-ID: <4FF2AC0C.20602@rabbitmq.com>

On 03/07/12 09:17, Tim Watson wrote:
> Thanks for clearing that up Matthias. The documentation for the plugin
> should probably change, as the line "set the value of the
> |auth_backends| configuration item for the |rabbit| application" makes
> it sound like this is an item that be passed to the rabbit application
> in the ordinary OTP sense.

It is. That's what the .config file does; it sets environment entries 
for Erlang applications. Only erlang hackers go around editing .app 
files. And we generally assume they know what they are doing ;)

Matthias.

From tim at rabbitmq.com  Tue Jul  3 09:24:46 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 3 Jul 2012 09:24:46 +0100
Subject: [rabbitmq-discuss] How to specify user/pass
In-Reply-To: <4FF2AC0C.20602@rabbitmq.com>
References: <1341204347925-20479.post@n5.nabble.com>
	<1341267730612-20525.post@n5.nabble.com>
	<4FF244FB.2040300@rabbitmq.com>
	<1341290390924-20534.post@n5.nabble.com>
	<084B639D-9846-4A20-9B32-6878C5FC19CD@rabbitmq.com>
	<4FF2A3FB.9020707@rabbitmq.com>
	<5EB86C5C-04EA-4AAD-BCD0-E7037F38F4AA@rabbitmq.com>
	<4FF2AC0C.20602@rabbitmq.com>
Message-ID: <211B5D11-6826-45C7-B6EB-BFBE7FD476CB@rabbitmq.com>

On 3 Jul 2012, at 09:23, Matthias Radestock wrote:

> On 03/07/12 09:17, Tim Watson wrote:
>> Thanks for clearing that up Matthias. The documentation for the plugin
>> should probably change, as the line "set the value of the
>> |auth_backends| configuration item for the |rabbit| application" makes
>> it sound like this is an item that be passed to the rabbit application
>> in the ordinary OTP sense.
> 
> It is. That's what the .config file does; it sets environment entries for Erlang applications. Only erlang hackers go around editing .app files. And we generally assume they know what they are doing ;)

Ah ok, well I'm glad I read the meaning of 'set the value of... rabbit application...' properly! :/

From michael.s.klishin at gmail.com  Tue Jul  3 09:31:59 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 3 Jul 2012 12:31:59 +0400
Subject: [rabbitmq-discuss] Ruby-AMQP with Federation doesn't work?
In-Reply-To: <4FF2048F.2010203@rabbitmq.com>
References: <CAAs9BZOrijO-brzitEkN3MuS7i==hEo3aot+-fafCG66Goeq8g@mail.gmail.com>
	<CAAs9BZMTwou-1j6PDiQ6CAJjrFpbr+jDWrmK+rZMY8ZOH7YbVQ@mail.gmail.com>
	<4FF2048F.2010203@rabbitmq.com>
Message-ID: <DF7806C1-6FAE-4816-9D03-1139F8DEDE90@gmail.com>

Matthias Radestock:

> I wonder whether that's a bug in ruby-amqp; heartbeats only need to be sent in the absence of other traffic, but perhaps ruby-amqp expects to receive them regardless?

This hypothesis is correct and will be fixed soon.

MK

michael at defprotocol.org

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 841 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/089fca06/attachment.pgp>

From emile at rabbitmq.com  Tue Jul  3 10:13:48 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 03 Jul 2012 10:13:48 +0100
Subject: [rabbitmq-discuss] Rabbitmq-server Fails to Start
In-Reply-To: <71192ea9-31c8-4903-8912-97edc97fc83e@googlegroups.com>
References: <71192ea9-31c8-4903-8912-97edc97fc83e@googlegroups.com>
Message-ID: <4FF2B7CC.7080103@rabbitmq.com>

Hi Joel,

On 03/07/12 00:11, Joel Friedly wrote:
> This problem started pretty randomly.

That will make it hard to diagnose via the mailing list. Is it possible
that some other piece of system software was changed at the same time?

You should consider upgrading. v2.5.0 is more than a year old. The
startup scripts have improved and upgrading may solve the problem.



-Emile


From michael.s.klishin at gmail.com  Tue Jul  3 10:22:43 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 3 Jul 2012 13:22:43 +0400
Subject: [rabbitmq-discuss] [announcement] amqp gem 0.9.7 is released
Message-ID: <BE9311EF-875F-42B4-B41D-FFB5C42D7B93@gmail.com>

amqp gem 0.9.7 is released to rubygems.org [1].

* Support for decoding of 64 bit signed integers in attribute tables (headers) that RabbitMQ federation plugin uses
* Any incoming traffic is now treated as server heartbeats
* Heartbeats are disabled by default again

As usual, all users are encouraged to upgrade.

1. https://rubygems.org/gems/amqp

MK

michael at defprotocol.org

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 841 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/73094cb0/attachment.pgp>

From emile at rabbitmq.com  Tue Jul  3 10:38:48 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 03 Jul 2012 10:38:48 +0100
Subject: [rabbitmq-discuss] Question about HA configuration
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD5A993309@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD5A993309@G9W0721.americas.hpqcorp.net>
Message-ID: <4FF2BDA8.3000204@rabbitmq.com>


Hi Andrea,

On 02/07/12 17:06, Rosa, Andrea (HP Cloud Services) wrote:
> Please consider this scenario: - Active/Passive HA configuration for
> MQ servers (Pacemaker+corosync+DRBD) - NOT using persistent queues:
> so every time there is a failure all messages in the queues are lost
> 
> Does it make sense to have a shared backend storage, for example
> using DRDB? Which is the value of the shared storage if messages are
> not stored on the file system? Maybe it's useful because in the
> shared folder are stored information about queues?!

Shared storage has little value if messages are not durable anyway and
if your application can tolerate queues being emptied when the standby
server takes over from the active one. However the design of the
Active/Passive HA configuration described here:

http://www.rabbitmq.com/pacemaker.html

assumes that the Mnesia database is on shared storage, and that Active
and Passive have a shared identity.

You should consider using the Active/Active HA configuration described here:

http://www.rabbitmq.com/ha.html



-Emile



From emile at rabbitmq.com  Tue Jul  3 10:50:45 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 03 Jul 2012 10:50:45 +0100
Subject: [rabbitmq-discuss] Message acknowledgment scenarios
In-Reply-To: <261B7FE1ECF3ED4C997D432F8018855E0117DC8CB3@DEFTHW99E85MSX.ww902.siemens.net>
References: <261B7FE1ECF3ED4C997D432F8018855E0117DC8CB3@DEFTHW99E85MSX.ww902.siemens.net>
Message-ID: <4FF2C075.2010902@rabbitmq.com>

Hi,

On 02/07/12 16:40, Wiessler, Wolfgang wrote:
> The basic question is: Is it possible to acknowledge a message that was
> received on one IModel instance using a different IModel instance? I did
> a brief test and that did not work. It seems as if a message?s delivery
> tag is specific to an IModel.

Acknowledgements and deliveries are channel-scoped, so it is not
possible to send an acknowledgement on a different channel from the one
that the delivery was made on.

> What happens to an unacknowledged message if the server dies/is not
> reachable? Is it automatically re-queued since the server lost its
> connection to the receiver? Or could a receiver send an acknowledgment
> once the server is reachable again? E.g. by waiting in a loop for a
> successful connection to the server.

When a channel closes, all unacknowledged messages are requeued. There
is no way to re-establish the state of a closed channel, so client
cannot acknowledge messages from a channel that has closed. The client
will need to establish a new subscription, have the messages delivered
again and acknowledge the redelivery. You will notice that such messages
will have their "redelivery" flag set to indicate that they have been
delivered before.


-Emile



From ask at rabbitmq.com  Tue Jul  3 10:58:32 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Tue, 3 Jul 2012 10:58:32 +0100
Subject: [rabbitmq-discuss] pika 0.9.5 - trouble closing a connection?
In-Reply-To: <41CD2EC8C0A143639389021BE0A31EA3@myyearbook.com>
References: <54e49166-7b18-436f-aac5-224896cc1f82@googlegroups.com>
	<C1CD1E98-89B0-494C-8967-F40A9EA8FE8C@rabbitmq.com>
	<41CD2EC8C0A143639389021BE0A31EA3@myyearbook.com>
Message-ID: <389D706C-6F41-42DB-9E3D-AD017FFAAABD@rabbitmq.com>


On 29 Jun 2012, at 20:07, Gavin M. Roy wrote:

> IIRC channels in _channels are not removed until Channel.CloseOk is received from Rabbit, even if you asked for a Channel.Close.
> 

That makes sense.

If this keeps the objects alive creating a leak, then you could
add a timeout to the connection.close, so that if the server doesn't respond within
10 seconds for example, you clean up the channels yourself.

Or maybe you can do that directly too, but I'm not sure how important it is to get
the close ok reply back.


From ask at rabbitmq.com  Tue Jul  3 11:05:06 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Tue, 3 Jul 2012 11:05:06 +0100
Subject: [rabbitmq-discuss] How to specify user/pass
In-Reply-To: <1341204347925-20479.post@n5.nabble.com>
References: <1341204347925-20479.post@n5.nabble.com>
Message-ID: <5CE418EE-017E-4585-930A-A969DDF0A992@rabbitmq.com>


On 2 Jul 2012, at 05:45, eleanor wrote:

> Hi,
> 
> is there a tutorial somewhere which specifies how we can login to the
> rabbitmq which uses internal database and LDAP database. 
> 
> The example from the tutorial is the following code:
> 
> 
> How can I change that to also login with the user/pass to the rabbitmq. A
> link to the tutorial would be great. Sorry for the noob question, but I'm
> really just starting out with rabbitmq.
> 

The ConnectionParameters takes a credentials argument:

   credentials = pika.PlainCredentials('username', 'password')
   connection = pika.BlockingConnection(pika.ConnectionParameters(
        credentials=credentials,
        host='localhost')

I believe it's also possible use SSL, you can see the documentation
for more information:
http://pika.github.com/connecting.html#credentials


From upendras at hotmail.com  Tue Jul  3 11:22:19 2012
From: upendras at hotmail.com (Upendra Sharma)
Date: Tue, 3 Jul 2012 10:22:19 +0000
Subject: [rabbitmq-discuss] Losing messages in a Cluster configuration
 of RabbitMQ
In-Reply-To: <FA2EDA27-AED2-46AD-BAD7-68B31D0576A9@rabbitmq.com>
References: <35e7e11f-ad0b-443c-a114-4e5fb2590e2a@googlegroups.com>,
	<FA2EDA27-AED2-46AD-BAD7-68B31D0576A9@rabbitmq.com>
Message-ID: <BLU126-W7B58071B9C37A39F4DE6AC5E90@phx.gbl>


thanks for your response.
After some deeper drilling I think I have found out the cause. I think that compared to a single-node mode, rabbitmq takes slightly longer time (probably a few mili sec longer) to create a new exchange or a queue in a clustered mode. I had, inadvertently, made some assumptions which started to go wrong in a clustered-setup because of this slight delay in clustered mode. I think that the message was getting published before a client could attach a queue to the exchange. My guess is that RabbitMQ was trashing the message published on that exchange as there was no queue to collect it; and later when the client did attach a queue to the exchange the message would already have been trashed and client would keep waiting for it until timeout.
thanks,-upendra


> From: ask at rabbitmq.com
> Date: Mon, 2 Jul 2012 15:24:07 +0100
> To: upendra.sharma at gmail.com
> CC: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Losing messages in a Cluster configuration	of RabbitMQ
> 
> 
> On 28 Jun 2012, at 22:24, Upendra Sharma wrote:
> 
> > Hi all,
> > 
> > I am facing a weird problem of losing messages, even though I am publishing them as persistent messages with pika.BasicProperties(delivery_mode=2) . Here is the scenario:
> > 
> > I have two RabbitMQ brokers, namely rabbit at vm11 and rabbit at vm22;  these two are have been setup in a cluster configuration as shown below:
> > [{nodes,[{disc,[rabbit at vm11,rabbit at vm22]}]},
> >  {running_nodes,[rabbit at vm22,rabbit at vm11]}]
> > 
> > I have two clients (written using pika.BlockingConnection() ); lets call these clients C1 and N1.
> > 1.) C1 creates an unique exchange (exchange name generated using UUID, say 3fe546be8aa341b7b174b29a56e63797).
> > 2.) C1 then spawns a thread, say C1-T1, which connects to rabbitmq server and waits for a response on this exchange using channel.start_consuming(). 
> > 3.) C1 then sends a message to N1 and in the message provides the name of the exchange (3fe546be8aa341b7b174b29a56e63797) where N1 should send the response.
> > 4.) once C1-T1 gets the response, it hands over the response to C1 and dies.
> > 
> > In my current setup I have 100 clients process like C1, i.e. C1, C2 ... C100 and one N1. 
> > 
> > This setup works perfectly fine when RabbitMQ is in a single node setup but when I put it in a cluster setup, it starts to loose the messages. What I mean is that Thread C1-T1 never gets a response and time-outs writing an ERROR in my log file. 
> > 
> > The trouble is I am loosing as many as 50% of the messages.
> > 
> 
> Rabbitmq delivers messages in round-robin, so when you say 50% of the messages
> are lost it sounds like too much of a coincidence to me.
> 
> What can often happen is having a broken consumer process that just sits
> there stealing messages, you can verify that by looking at the `rabbitmqctl list_queues`
> output:
> 
>     $ sudo rabbitmqct list_queues -p $your_vhost name messages_ready messages_unacknowledged consumers
> 
> If you have more consumers and unacknowledged messages than you expected then
> you probably have a stale consumer process that you have to kill.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/d68149c4/attachment.htm>

From simon at rabbitmq.com  Tue Jul  3 11:46:29 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Jul 2012 11:46:29 +0100
Subject: [rabbitmq-discuss] Shovel configuration for a clustered broker
 with mirrored high-availability queues
In-Reply-To: <096b42df-5723-4673-a7da-461785cee3c3@mi5g2000pbc.googlegroups.com>
References: <78293bda-8d11-48dc-ba47-4dd8822702f2@googlegroups.com>	<CAHZsVQY4UHkDSDc=UAWc0BC4PbA73MPFHG59WrJS6ixqipHwAw@mail.gmail.com>	<f9ae5a1e-30ed-4999-906f-f40a124c0ff5@googlegroups.com>
	<096b42df-5723-4673-a7da-461785cee3c3@mi5g2000pbc.googlegroups.com>
Message-ID: <4FF2CD85.6030208@rabbitmq.com>

On 29/06/12 23:42, Eric wrote:
> I thought I sent along another message, but apparently it didn't go
> through.  Viewing this group through the new Google Groups UI is
> confusing.

As previously mentioned, we prefer people not use the Google group - 
it's an unofficial mirror that we sadly have no control over.

> I misunderstood the federation configuration; I see now that you
> declare a backing type when you declare the federated exchange, which
> makes sense.  I thought the backing type was based on the upstream
> exchange.

Yes. The two should really match though, or you will get weird behaviour.

> Going back to shovel for a second... if I have two shovels running in
> a cluster, one on each broker, and they connect to their host broker
> and consume from the same mirrored queue (the queue is 'shared' across
> the cluster) will they simply behave like two consumers on the same
> queue, and basically receive messages round-robin?  Because that would
> work fine for my scenario.  They'll share the workload unless one of
> the brokers in the cluster dies, after which one shovel would be doing
> all the work.

Yes, the shovel is a normal AMQP client in that respect (and every other).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jul  3 11:48:21 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Jul 2012 11:48:21 +0100
Subject: [rabbitmq-discuss] Shovel configuration for a clustered broker
 with mirrored high-availability queues
In-Reply-To: <ef0e0744-4638-4ff0-9c21-fac3b4f8fcce@si8g2000pbc.googlegroups.com>
References: <78293bda-8d11-48dc-ba47-4dd8822702f2@googlegroups.com>	<CAHZsVQY4UHkDSDc=UAWc0BC4PbA73MPFHG59WrJS6ixqipHwAw@mail.gmail.com>	<f9ae5a1e-30ed-4999-906f-f40a124c0ff5@googlegroups.com>
	<ef0e0744-4638-4ff0-9c21-fac3b4f8fcce@si8g2000pbc.googlegroups.com>
Message-ID: <4FF2CDF5.1060401@rabbitmq.com>

On 29/06/12 17:18, Eric wrote:
> It's still a little odd to me that the master is responsible for
> "pulling" rather than having the upstream brokers push.

The reason we did it like this is so that the downstream can transmit 
its bindings upstream, and thus we can be smart about which messages are 
sent over the wire.

> If I add new
> upstream brokers, do I have to edit the master's configuration and
> restart it to consume messages from them?

Yes. Although that will change in the next release, you'll be able to 
reconfigure federation without restarting.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jul  3 12:48:10 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Jul 2012 12:48:10 +0100
Subject: [rabbitmq-discuss] lost messages (.NET)
In-Reply-To: <1341267857667-20526.post@n5.nabble.com>
References: <1340818001643-20402.post@n5.nabble.com>	<CABzX+qzpW3LCa6LLf-VGjSnYQ+9dMXn_bn_pyW6dPs_J80TieQ@mail.gmail.com>
	<1341267857667-20526.post@n5.nabble.com>
Message-ID: <4FF2DBFA.6030106@rabbitmq.com>

On 02/07/12 23:24, ivan.lysov wrote:
> I have couple of questions on ConnectionFactory.RequestedHeartbeat property.
>
> - Should i set it in the case of unstable connections (GPRS)?

Possibly. The heartbeat does a couple of things: makes sure the network 
infrastructure sees some traffic to prevent it closing "idle" 
connections if it is minded to do so, and lets the server detect 
unresponsive clients so it can disconnect them.

> - Is it possible to set the value lower than 1 second and does it make
> sense?

No, and probably not. The lower you make it, the more eager the server 
will be to disconnect you if the network is slow - which with GPRS is 
likely to be the last thing you need.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jul  3 12:51:11 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Jul 2012 12:51:11 +0100
Subject: [rabbitmq-discuss] Authentication Backend HTTP
In-Reply-To: <87vci6pkpg.wl%francesco@rabbitmq.com>
References: <1341180077844-20476.post@n5.nabble.com>
	<87vci6pkpg.wl%francesco@rabbitmq.com>
Message-ID: <4FF2DCAF.7060401@rabbitmq.com>

On 02/07/12 10:37, Francesco Mazzoli wrote:
>> >  Btw: why isn't this plugin part of the default plugins if rabbitmq?
> Well I'm not sure about that, but the README reads "Note: it's at an
> early stage of development, although it's conceptually very simple."

Yeah, this basically. But it's simple enough that it might make sense 
just to import it into the release anyway.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jul  3 12:59:39 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Jul 2012 12:59:39 +0100
Subject: [rabbitmq-discuss] RabbitMQ failure under high load
In-Reply-To: <CAHFJS_XLY0ajinZ1=KEbmB+A5eCr+fe71MLay0O4j-6GAQyRqw@mail.gmail.com>
References: <CAHFJS_UBn4Viv2VHuD7cg_dL96ZQMkMX6PQcVxFP0561F7dMOw@mail.gmail.com>	<4FE47A17.1030805@rabbitmq.com>	<CAHFJS_WGV=+S60unnpzRN006GsYms4mve0DBtgNO3fXc8o3wYw@mail.gmail.com>	<4FEAE228.3040000@rabbitmq.com>
	<CAHFJS_XLY0ajinZ1=KEbmB+A5eCr+fe71MLay0O4j-6GAQyRqw@mail.gmail.com>
Message-ID: <4FF2DEAB.4050601@rabbitmq.com>

On 27/06/12 12:19, Micha? Ki?dy? wrote:
> Would you like to get more details of this test to be able to play it on
> your own?

I can certainly give it a go - although that reduces the likelihood of 
being able to replicate it...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alex.lovelltroy at gmail.com  Tue Jul  3 13:01:28 2012
From: alex.lovelltroy at gmail.com (Alex Lovell-Troy)
Date: Tue, 3 Jul 2012 08:01:28 -0400
Subject: [rabbitmq-discuss] Authentication Backend HTTP
In-Reply-To: <4FF2DCAF.7060401@rabbitmq.com>
References: <1341180077844-20476.post@n5.nabble.com>
	<87vci6pkpg.wl%francesco@rabbitmq.com>
	<4FF2DCAF.7060401@rabbitmq.com>
Message-ID: <CAMACij4TW3kUoPacOPg0PiF92iuUEixQkiTzCj8AesOE5UVDJg@mail.gmail.com>

Based on this thread, I took a look at your example code and toying with
the idea of using the session-id and csrf token or something like that to
authenticate to rabbit through stomp and sockjs.  Is anyone else working in
the same direction?  I'd rather add to someone else's project than start my
own, but I'll release any code I have that works.

-alex

On Tue, Jul 3, 2012 at 7:51 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 02/07/12 10:37, Francesco Mazzoli wrote:
>
>> >  Btw: why isn't this plugin part of the default plugins if rabbitmq?
>>>
>> Well I'm not sure about that, but the README reads "Note: it's at an
>> early stage of development, although it's conceptually very simple."
>>
>
> Yeah, this basically. But it's simple enough that it might make sense just
> to import it into the release anyway.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/73b9d9d0/attachment.htm>

From sanjiv.kumar.jha at accenture.com  Tue Jul  3 12:09:19 2012
From: sanjiv.kumar.jha at accenture.com (sanjiv.kumar.jha at accenture.com)
Date: Tue, 3 Jul 2012 11:09:19 +0000
Subject: [rabbitmq-discuss] messages disappearing from RabbitMQ queue on
	cluster set-up
Message-ID: <EEA1DC407D5C23479BEAAF68C3D5604005312D08@048-CH1MPN1-213.048d.mgd.msft.net>

Hi,

We are using rabbitMQ version 2.7.1.
We've set up a cluster of 2 nodes having mirrored queues ("x-ha-policy", "all") on 2 different linux servers.
After posting a persistent message to node -1, we are able to see the message on both nodes - fine till this point.
When rabbitmq is stopped (using rabbitmqctl stop_app) on any of the nodes (say node - 1 is stopped), we are still able to see the message on the other node (node - 2) - again fine till this point.
But, when we restart node - 1 and stop node - 2, the messages are getting lost after this point.
Please let us know, if this is an expected behavior or if we need to do any specific setting/configuration .

Thanks.

________________________________
Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
______________________________________________________________________________________

www.accenture.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/a9edba37/attachment.htm>

From dwayne.dsouza at gmail.com  Tue Jul  3 14:50:21 2012
From: dwayne.dsouza at gmail.com (Deelo55)
Date: Tue, 3 Jul 2012 06:50:21 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ subscriber loses connection across
 firewalls after long idle
In-Reply-To: <4FF19937.4010205@rabbitmq.com>
References: <1341215282338-20480.post@n5.nabble.com>
	<4FF16AB3.8010109@rabbitmq.com>
	<1341221640243-20487.post@n5.nabble.com>
	<4FF17A4A.3010704@rabbitmq.com>
	<1341226074241-20491.post@n5.nabble.com>
	<4FF180D4.2000609@rabbitmq.com>
	<1341229331833-20500.post@n5.nabble.com>
	<4FF19937.4010205@rabbitmq.com>
Message-ID: <1341323421722-20558.post@n5.nabble.com>

I'll need to allocate some time to this...I'm not very familiar with network
traffic analysis.

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-subscriber-loses-connection-across-firewalls-after-long-idle-tp20480p20558.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From msteele at beringmedia.com  Tue Jul  3 15:04:21 2012
From: msteele at beringmedia.com (Mark Steele)
Date: Tue, 3 Jul 2012 10:04:21 -0400
Subject: [rabbitmq-discuss] RabbitMQ subscriber loses connection across
 firewalls after long idle
In-Reply-To: <1341323421722-20558.post@n5.nabble.com>
References: <1341215282338-20480.post@n5.nabble.com>
	<4FF16AB3.8010109@rabbitmq.com>
	<1341221640243-20487.post@n5.nabble.com>
	<4FF17A4A.3010704@rabbitmq.com>
	<1341226074241-20491.post@n5.nabble.com>
	<4FF180D4.2000609@rabbitmq.com>
	<1341229331833-20500.post@n5.nabble.com>
	<4FF19937.4010205@rabbitmq.com>
	<1341323421722-20558.post@n5.nabble.com>
Message-ID: <CAH24rBPY2rZS7SpHDc4+3M8Z+2rgtXwDi3H-GDXoagsHMi+F5Q@mail.gmail.com>

It's probably your firewall. Many firewalls have built-in idle timers. Your
clients are likely in a consuming loop where there are no messages, and
hence the idle timer kicks in and kills your connections.

Some options:

   - You can try getting your Rabbit server and clients to utilize TCP
   keepalives
   - Setup libkeepalive on your server
   - Use AMQP heartbeats (probably the best option) to keep packets flowing.


Mark Steele, CISSP, CSM, GPEN
Bering Media Inc.



On Tue, Jul 3, 2012 at 9:50 AM, Deelo55 <dwayne.dsouza at gmail.com> wrote:

> I'll need to allocate some time to this...I'm not very familiar with
> network
> traffic analysis.
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-subscriber-loses-connection-across-firewalls-after-long-idle-tp20480p20558.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/fc4f8ba2/attachment.htm>

From msteele at beringmedia.com  Tue Jul  3 15:04:56 2012
From: msteele at beringmedia.com (Mark Steele)
Date: Tue, 3 Jul 2012 10:04:56 -0400
Subject: [rabbitmq-discuss] RabbitMQ subscriber loses connection across
 firewalls after long idle
In-Reply-To: <CAH24rBPY2rZS7SpHDc4+3M8Z+2rgtXwDi3H-GDXoagsHMi+F5Q@mail.gmail.com>
References: <1341215282338-20480.post@n5.nabble.com>
	<4FF16AB3.8010109@rabbitmq.com>
	<1341221640243-20487.post@n5.nabble.com>
	<4FF17A4A.3010704@rabbitmq.com>
	<1341226074241-20491.post@n5.nabble.com>
	<4FF180D4.2000609@rabbitmq.com>
	<1341229331833-20500.post@n5.nabble.com>
	<4FF19937.4010205@rabbitmq.com>
	<1341323421722-20558.post@n5.nabble.com>
	<CAH24rBPY2rZS7SpHDc4+3M8Z+2rgtXwDi3H-GDXoagsHMi+F5Q@mail.gmail.com>
Message-ID: <CAH24rBNHmPRHvqATLaoVJhOk+23cE0Wf0FhRQU5dQmbKGhFheA@mail.gmail.com>

Oh, and you can also re-configure your firewall to stop that idle timer.

Mark Steele, CISSP, CSM, GPEN
Bering Media Inc.

On Tue, Jul 3, 2012 at 10:04 AM, Mark Steele <msteele at beringmedia.com>wrote:

> It's probably your firewall. Many firewalls have built-in idle timers.
> Your clients are likely in a consuming loop where there are no messages,
> and hence the idle timer kicks in and kills your connections.
>
> Some options:
>
>    - You can try getting your Rabbit server and clients to utilize TCP
>    keepalives
>    - Setup libkeepalive on your server
>    - Use AMQP heartbeats (probably the best option) to keep packets
>    flowing.
>
>
> Mark Steele, CISSP, CSM, GPEN
> Bering Media Inc.
>
>
>
>
> On Tue, Jul 3, 2012 at 9:50 AM, Deelo55 <dwayne.dsouza at gmail.com> wrote:
>
>> I'll need to allocate some time to this...I'm not very familiar with
>> network
>> traffic analysis.
>>
>> --
>> View this message in context:
>> http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-subscriber-loses-connection-across-firewalls-after-long-idle-tp20480p20558.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/d832dc79/attachment.htm>

From dwayne.dsouza at gmail.com  Tue Jul  3 15:07:52 2012
From: dwayne.dsouza at gmail.com (Deelo55)
Date: Tue, 3 Jul 2012 07:07:52 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ subscriber loses connection across
 firewalls after long idle
In-Reply-To: <CAH24rBNHmPRHvqATLaoVJhOk+23cE0Wf0FhRQU5dQmbKGhFheA@mail.gmail.com>
References: <4FF16AB3.8010109@rabbitmq.com>
	<1341221640243-20487.post@n5.nabble.com>
	<4FF17A4A.3010704@rabbitmq.com>
	<1341226074241-20491.post@n5.nabble.com>
	<4FF180D4.2000609@rabbitmq.com>
	<1341229331833-20500.post@n5.nabble.com>
	<4FF19937.4010205@rabbitmq.com>
	<1341323421722-20558.post@n5.nabble.com>
	<CAH24rBPY2rZS7SpHDc4+3M8Z+2rgtXwDi3H-GDXoagsHMi+F5Q@mail.gmail.com>
	<CAH24rBNHmPRHvqATLaoVJhOk+23cE0Wf0FhRQU5dQmbKGhFheA@mail.gmail.com>
Message-ID: <1341324472486-20561.post@n5.nabble.com>

How do you use AMQP heartbeats? (I tried setting the heartbeat option already
in the Java client and this had no effect)

I'm going to try and fix my firewall but I was also using Rackspace for
another server and had the same problem here. Not sure how I can fix that as
I have no control over their firewall.

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-subscriber-loses-connection-across-firewalls-after-long-idle-tp20480p20561.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Tue Jul  3 15:08:39 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Jul 2012 15:08:39 +0100
Subject: [rabbitmq-discuss] messages disappearing from RabbitMQ queue
 on	cluster set-up
In-Reply-To: <EEA1DC407D5C23479BEAAF68C3D5604005312D08@048-CH1MPN1-213.048d.mgd.msft.net>
References: <EEA1DC407D5C23479BEAAF68C3D5604005312D08@048-CH1MPN1-213.048d.mgd.msft.net>
Message-ID: <4FF2FCE7.9010900@rabbitmq.com>

On 03/07/12 12:09, sanjiv.kumar.jha at accenture.com wrote:
> Please let us know, if this is an expected behavior or if we need to do
> any specific setting/configuration .

Please see http://www.rabbitmq.com/ha.html#unsynchronised-slaves

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From msteele at beringmedia.com  Tue Jul  3 16:28:45 2012
From: msteele at beringmedia.com (Mark Steele)
Date: Tue, 3 Jul 2012 11:28:45 -0400
Subject: [rabbitmq-discuss] RabbitMQ subscriber loses connection across
 firewalls after long idle
In-Reply-To: <1341324472486-20561.post@n5.nabble.com>
References: <4FF16AB3.8010109@rabbitmq.com>
	<1341221640243-20487.post@n5.nabble.com>
	<4FF17A4A.3010704@rabbitmq.com>
	<1341226074241-20491.post@n5.nabble.com>
	<4FF180D4.2000609@rabbitmq.com>
	<1341229331833-20500.post@n5.nabble.com>
	<4FF19937.4010205@rabbitmq.com>
	<1341323421722-20558.post@n5.nabble.com>
	<CAH24rBPY2rZS7SpHDc4+3M8Z+2rgtXwDi3H-GDXoagsHMi+F5Q@mail.gmail.com>
	<CAH24rBNHmPRHvqATLaoVJhOk+23cE0Wf0FhRQU5dQmbKGhFheA@mail.gmail.com>
	<1341324472486-20561.post@n5.nabble.com>
Message-ID: <CAH24rBO9Q=kdBQTLe4sMV083-Y=bH81W5hJvB+5VRuGzbQc2uA@mail.gmail.com>

At the TCP layer, you can enable TCP keepalives on the connection.

I believe there's a configuration setting in Rabbit/Erlang for this. Ask
around on the rabbit irc channel.

Failing that, google 'libkeepalive'

Mark Steele, CISSP, CSM, GPEN
Bering Media Inc.


On Tue, Jul 3, 2012 at 10:07 AM, Deelo55 <dwayne.dsouza at gmail.com> wrote:

> How do you use AMQP heartbeats? (I tried setting the heartbeat option
> already
> in the Java client and this had no effect)
>
> I'm going to try and fix my firewall but I was also using Rackspace for
> another server and had the same problem here. Not sure how I can fix that
> as
> I have no control over their firewall.
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-subscriber-loses-connection-across-firewalls-after-long-idle-tp20480p20561.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/7cba50ac/attachment.htm>

From steve at rabbitmq.com  Tue Jul  3 16:42:23 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 3 Jul 2012 16:42:23 +0100
Subject: [rabbitmq-discuss] RabbitMQ Subscriber Timeout When Waiting for
	Delivery
In-Reply-To: <1341023042691-20464.post@n5.nabble.com>
References: <e6247647-7ec7-454e-af6d-5b7c1d2048ee@googlegroups.com>
	<4FEE61B4.8030205@rabbitmq.com>
	<1341023042691-20464.post@n5.nabble.com>
Message-ID: <E6B007D6-13AA-4A88-977B-B46FD2589377@rabbitmq.com>

Dwayne,

AFAIK RabbitMQ doesn't perform any connection timeout processing, but if
your subscriber does nothing for some time the connection has been known
to be dropped by pieces of soft/hardware in the network infrastructure
you are using. In other words, if there is no traffic, some piece of
network hardware can drop you without warning. 300 seconds sounds about
right for this sort of thing.

The heartbeat mechanism can be used to fool the intervening wires that
they are being used, and thus stay open. Heartbeat overhead is
relatively low.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 30 Jun 2012, at 03:24, Deelo55 wrote:

> Hi,
> There is no exception or message visible. If the subscriber doesn't receive
> anything in 300 seconds it stops subscribing. I managed to solve by using a
> heartbeat. I suspect this may have something to do with the fact it is using
> an auto delete queue. Still debugging further v
> Thxs. 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Subscriber-Timeout-When-Waiting-for-Delivery-tp20442p20464.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From andrea.rosa at hp.com  Tue Jul  3 16:49:33 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Tue, 3 Jul 2012 15:49:33 +0000
Subject: [rabbitmq-discuss] Question about HA configuration
In-Reply-To: <4FF2BDA8.3000204@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD5A993309@G9W0721.americas.hpqcorp.net>
	<4FF2BDA8.3000204@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD5A9A4E20@G9W0721.americas.hpqcorp.net>

Hi Emilie

Thanks for your reply.

>Shared storage has little value if messages are not durable 

If I use a shared storage to put mnesia DB the two nodes (Active and passive) share the same username, password, vhosts.
Is that correct?
In this case that's a good point to use shared storage even if messages are not durable.

Cheers
--
Andrea Rosa


From steve at rabbitmq.com  Tue Jul  3 17:06:32 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 3 Jul 2012 17:06:32 +0100
Subject: [rabbitmq-discuss] STOMP plug-in, HA queues,
	and consumer cancelations
In-Reply-To: <CAFDmHdMWUXyfAOOxJjMpPEH42V3dZeyTnooAUAVkmAjsfgpXdQ@mail.gmail.com>
References: <CAFDmHdMU2AqJCG9_Ps8CM93iUS2pthDNFm3imot5LUE1+XXRHQ@mail.gmail.com>
	<8AC41936-B28F-4F26-AF39-51D7AC1C35D1@vmware.com>
	<CAFDmHdMWUXyfAOOxJjMpPEH42V3dZeyTnooAUAVkmAjsfgpXdQ@mail.gmail.com>
Message-ID: <9E830826-692A-4D36-8233-59B0385EA098@rabbitmq.com>

Elias,

Mea Culpa,

You are quite right. Your understanding of HA queues is better than
mine. However, AFAICS the STOMP adapter doesn't present
the consumer_cancel_notify capability to the (Erlang) connection, so
will not receive a notification when the consumer is cancelled.

The STOMP client will think that the subscription is sound even if the
underlying consumer was cancelled. We can probably do better than this.

Although the STOMP client will stop receiving messages, I would not
characterise this as 'dangerous', merely frustrating.

Can you say what you think the correct STOMP behaviour ought to be if a
subscription's consumer is unilaterally cancelled? I'm tempted to simply
send an ERROR frame and simulate an UNSUBSCRIBE,
leaving the STOMP client to recover however it thinks fit.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 2 Jul 2012, at 17:21, Elias Levy wrote:

> On Mon, Jul 2, 2012 at 8:50 AM, Steve Powell <spowell at vmware.com> wrote:
> STOMP doesn't know that a queue is HA and will not mend a broken
> subscription; however, the subscription shouldn't be broken unless the
> broker connected to goes down, in which case the connection will be
> lost, the STOMP session will fail, and the subscription with it.
> 
> Why do you say that the subscription will not be broken unless the broker connected to (I assume by the STOMP client) goes down?
> 
> My understanding is that with a HA queue if the node hosting the HA queue master goes down, the new promoted HA queue master considers all previous subscriptions to have been disconnected, and issues a consumer cancelation to all consumers of those subscriptions that support the feature.  Thus, a consumer that does not support consumer cancelation will believe his subscription to the HA queue is still valid and wait indefinitely for messages that will never arrive.
> 
> Am I wrong?
> 
> By this logic, if the RMQ STOMP proxy does not handle consumer cancelations, then its rather dangerous to use it to consume from a HA queue.
> 
> Elias Levy

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/3df388db/attachment.htm>

From aravindh86 at gmail.com  Tue Jul  3 17:45:31 2012
From: aravindh86 at gmail.com (Aravindh S)
Date: Tue, 3 Jul 2012 12:45:31 -0400
Subject: [rabbitmq-discuss] Issue in creating a RabbitMQ Cluster
In-Reply-To: <4FF2546C.2040408@rabbitmq.com>
References: <CAL696ubrR66MQnYUK_8KdOA6HDW3mFgHTW5BnWQ2mngCd7E2-g@mail.gmail.com>
	<4FF24350.4080001@rabbitmq.com> <4FF24DE2.5070504@rabbitmq.com>
	<4FF2539F.3030903@rabbitmq.com> <4FF2546C.2040408@rabbitmq.com>
Message-ID: <CAL696ubSkba0YFM0sT--U+j1Qm_9T1oheX+Fs69ne5OBTeL1uQ@mail.gmail.com>

Thanks Tim and Matthias for helping me out.

Clearing firewall rules and having the nodes address each other by
hostnames instead of IP Addresses resolved the issue.

- Aravindh.


On Mon, Jul 2, 2012 at 10:09 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 03/07/12 03:06, Tim Watson wrote:
>
>> "Error: unable to connect to node rabbit at rabbit3: nodedown"
>>
>> Saying that rabbitmqctl cannot connect to rabbit at rabbit3, which is the
>> local node!?
>>
>
> Correct. But that doesn't mean the node isn't running. 'nodedown' is the
> reason Erlang gives, and it covers a multitude of failures, hence we show
> the diagnostics info in order to help narrowing down the cause.
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 
Aravindh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/9bcf0da8/attachment.htm>

From fearsome.lucidity at gmail.com  Tue Jul  3 18:52:45 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Tue, 3 Jul 2012 10:52:45 -0700
Subject: [rabbitmq-discuss] STOMP plug-in, HA queues,
	and consumer cancelations
In-Reply-To: <9E830826-692A-4D36-8233-59B0385EA098@rabbitmq.com>
References: <CAFDmHdMU2AqJCG9_Ps8CM93iUS2pthDNFm3imot5LUE1+XXRHQ@mail.gmail.com>
	<8AC41936-B28F-4F26-AF39-51D7AC1C35D1@vmware.com>
	<CAFDmHdMWUXyfAOOxJjMpPEH42V3dZeyTnooAUAVkmAjsfgpXdQ@mail.gmail.com>
	<9E830826-692A-4D36-8233-59B0385EA098@rabbitmq.com>
Message-ID: <CAFDmHdMVjvJm_W4_FaQVsR+MuZDWG3Ai35FEwqB9N_15M3j92g@mail.gmail.com>

On Tue, Jul 3, 2012 at 9:06 AM, Steve Powell <steve at rabbitmq.com> wrote:

> You are quite right. Your understanding of HA queues is better than
> mine. However, AFAICS the STOMP adapter doesn't present
> the consumer_cancel_notify capability to the (Erlang) connection, so
> will not receive a notification when the consumer is cancelled.
>
> The STOMP client will think that the subscription is sound even if the
> underlying consumer was cancelled. We can probably do better than this.
>

And therein lies the problem.


> Although the STOMP client will stop receiving messages, I would not
> characterise this as 'dangerous', merely frustrating.
>

Maybe not dangerous, since there is no data loss, but certainly a lot worse
than frustrating.  If you have long lived STOMP connections with consumers
which suddenly stop receiving messages without any warning, depending on
the importance of those messages and the processes that consume them, the
loss of the subscription can be quite important from a business perspective.

E.g. if those messages are being used to monitor some business activity,
you are now flying blind until the STOMP connection is torn down and
reestablished.

Can you say what you think the correct STOMP behaviour ought to be if a
> subscription's consumer is unilaterally cancelled? I'm tempted to simply
> send an ERROR frame and simulate an UNSUBSCRIBE,
> leaving the STOMP client to recover however it thinks fit.
>

To resubscribe to the HA queues, obviously.  The HA queue consumer
cancelation is a rather ugly implementation detail.  In an ideal world, a
HA queue would behave just like a non-HA queue.  From a consumer
perspective whether a queue is HA or non-HA would be invisible.  A HA queue
would failover without consumers attached to the non-failing nodes
noticing. Alas, this is not the case, and I understand why that is given
the existing implementation.

So ideally the STOMP proxy would resubscribe when it receives a consumer
cancelation.  Any messages that consumers received that had not yet been
acked or for which acks where lost in flight wil be requeued and
retransmitted by the new queue master.  I believe thats OK.  RMQ and AMQP
already have an expectation that some messages may be delivered more than
once as it does not have a two-phase commit for acknowledgements, so
clients should already be ready for this eventuality.

But even sending an ERROR frame to the client to it knowns something went
wrong and giving it an opportunity to recover is much better than the
situation as it is right now.

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/fe2fd86c/attachment.htm>

From mpietrek at skytap.com  Tue Jul  3 20:17:01 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 3 Jul 2012 12:17:01 -0700
Subject: [rabbitmq-discuss] AMQP heartbeat - Expected behaviors
Message-ID: <CACLE7iz0UDBJhaAUVbrwAvjzYHbkoRaB8nm02iY1+kMiR=q=kA@mail.gmail.com>

We've recently started using the heartbeat connection option, and I need to
understand them precisely. I understand that both client and server side
can send heartbeat frames, that other activity can substitute for a
heartbeat frame, and that the intervals are negotiated during tuning.

What's confusing me is this:  Some threads such at this one imply that the
server "periodically sends heartbeat frames to the client and waits for its
response."
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014491.html

What exactly is the proper response from the client? I've searched for
hours looking for the format of the response and not found it.

Confounding matters, at least three client libraries I've looked at
(including Pika and .NET) explicitly check for heartbeat frame (i.e., 8)
and then do nothing with them. For instance in the Pika _on_data_available
method():

       while self._frame_buffer:

           # Try and build a frame
           consumed_count, frame =
pika.frame.decode_frame(self._frame_buffer)

           ...

           # We don't check for heartbeat frames because we can not count
           # atomic frames reliably due to different message behaviors
           # such as large content frames being transferred slowly
           elif isinstance(frame, pika.frame.Heartbeat):
               continue


Is this correct behavior or am I simply not understanding how the heartbeat
mechanism is supposed to work.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/0440e97e/attachment.htm>

From matthias at rabbitmq.com  Tue Jul  3 20:27:30 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 03 Jul 2012 20:27:30 +0100
Subject: [rabbitmq-discuss] AMQP heartbeat - Expected behaviors
In-Reply-To: <CACLE7iz0UDBJhaAUVbrwAvjzYHbkoRaB8nm02iY1+kMiR=q=kA@mail.gmail.com>
References: <CACLE7iz0UDBJhaAUVbrwAvjzYHbkoRaB8nm02iY1+kMiR=q=kA@mail.gmail.com>
Message-ID: <4FF347A2.8030408@rabbitmq.com>

Matt,

On 03/07/12 20:17, Matt Pietrek wrote:
> We've recently started using the heartbeat connection option, and I need
> to understand them precisely. I understand that both client and server
> side can send heartbeat frames, that other activity can substitute for a
> heartbeat frame, and that the intervals are negotiated during tuning.

Yep.

> What's confusing me is this:  Some threads such at this one imply that
> the server "periodically sends heartbeat frames to the client and waits
> for its response."
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014491.html

That's nonsense. Ignore. There is no response.

> Confounding matters, at least three client libraries I've looked at
> (including Pika and .NET) explicitly check for heartbeat frame (i.e., 8)
> and then do nothing with them.

I don't know enough about pika, but the .net client calls 
NotifyHeartbeatThread(); on each iteration of the frame reading loop. 
It's ok not to do anything special with heartbeat frames; what matters 
is that *a* frame arrives in time.


Matthias.

From evangeline.eleanor at gmail.com  Tue Jul  3 20:59:35 2012
From: evangeline.eleanor at gmail.com (eleanor)
Date: Tue, 3 Jul 2012 12:59:35 -0700 (PDT)
Subject: [rabbitmq-discuss] Authentication Backend HTTP
In-Reply-To: <CAMACij4TW3kUoPacOPg0PiF92iuUEixQkiTzCj8AesOE5UVDJg@mail.gmail.com>
References: <1341180077844-20476.post@n5.nabble.com>
	<87vci6pkpg.wl%francesco@rabbitmq.com>
	<4FF2DCAF.7060401@rabbitmq.com>
	<CAMACij4TW3kUoPacOPg0PiF92iuUEixQkiTzCj8AesOE5UVDJg@mail.gmail.com>
Message-ID: <1341345575909-20571.post@n5.nabble.com>

Axel, that would indeed be very useful. I'll use HTTP plugin to authenticate
against OAuth where username will be the email address of the user and
password will be the session token, which should be enough to provide the
identity of the user.

Btw: I wrote a simple tutorial about all this and posted it on my blog, if
somebody is interested: http://correlia.blogspot.com/ .

That's it.

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Authentication-Backend-HTTP-tp20476p20571.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From gmr at myyearbook.com  Tue Jul  3 21:14:11 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 3 Jul 2012 16:14:11 -0400
Subject: [rabbitmq-discuss] AMQP heartbeat - Expected behaviors
In-Reply-To: <4FF347A2.8030408@rabbitmq.com>
References: <CACLE7iz0UDBJhaAUVbrwAvjzYHbkoRaB8nm02iY1+kMiR=q=kA@mail.gmail.com>
	<4FF347A2.8030408@rabbitmq.com>
Message-ID: <09607808-2E70-4CCC-ACF2-9075B14A1E65@myyearbook.com>


On Jul 3, 2012, at 3:27 PM, Matthias Radestock wrote:

> 
>> Confounding matters, at least three client libraries I've looked at
>> (including Pika and .NET) explicitly check for heartbeat frame (i.e., 8)
>> and then do nothing with them.
> 
> I don't know enough about pika, but the .net client calls NotifyHeartbeatThread(); on each iteration of the frame reading loop. It's ok not to do anything special with heartbeat frames; what matters is that *a* frame arrives in time.

Right, in Pika we do not have any action to take, we're sending a Heartbeat frame and expecting the response. Pika runs heartbeats on an IOLoop timer and independent of the main frame processor and checks to make sure bytes/frames are moving.

From matthias at rabbitmq.com  Tue Jul  3 21:18:06 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 03 Jul 2012 21:18:06 +0100
Subject: [rabbitmq-discuss] AMQP heartbeat - Expected behaviors
In-Reply-To: <09607808-2E70-4CCC-ACF2-9075B14A1E65@myyearbook.com>
References: <CACLE7iz0UDBJhaAUVbrwAvjzYHbkoRaB8nm02iY1+kMiR=q=kA@mail.gmail.com>
	<4FF347A2.8030408@rabbitmq.com>
	<09607808-2E70-4CCC-ACF2-9075B14A1E65@myyearbook.com>
Message-ID: <4FF3537E.50001@rabbitmq.com>

On 03/07/12 21:14, Gavin M. Roy wrote:
> we're sending a Heartbeat frame and expecting the response.

Erhm. There is no response.

Matthias.

From gmr at myyearbook.com  Tue Jul  3 21:25:32 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 3 Jul 2012 16:25:32 -0400
Subject: [rabbitmq-discuss] AMQP heartbeat - Expected behaviors
In-Reply-To: <4FF3537E.50001@rabbitmq.com>
References: <CACLE7iz0UDBJhaAUVbrwAvjzYHbkoRaB8nm02iY1+kMiR=q=kA@mail.gmail.com>
	<4FF347A2.8030408@rabbitmq.com>
	<09607808-2E70-4CCC-ACF2-9075B14A1E65@myyearbook.com>
	<4FF3537E.50001@rabbitmq.com>
Message-ID: <EFC021B3-1434-48D6-8F4A-61A62D551667@myyearbook.com>


On Jul 3, 2012, at 4:18 PM, Matthias Radestock wrote:

> On 03/07/12 21:14, Gavin M. Roy wrote:
>> we're sending a Heartbeat frame and expecting the response.
> 
> Erhm. There is no response.

LOL well there you go, I'm going off memory (a bit rusty memory).  In looking at the code, it's sending the frame on an IOLoop timer and looking for byte counter changes.

Gavin

From mpietrek at skytap.com  Tue Jul  3 22:24:51 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 3 Jul 2012 14:24:51 -0700
Subject: [rabbitmq-discuss] AMQP heartbeat - Expected behaviors
In-Reply-To: <EFC021B3-1434-48D6-8F4A-61A62D551667@myyearbook.com>
References: <CACLE7iz0UDBJhaAUVbrwAvjzYHbkoRaB8nm02iY1+kMiR=q=kA@mail.gmail.com>
	<4FF347A2.8030408@rabbitmq.com>
	<09607808-2E70-4CCC-ACF2-9075B14A1E65@myyearbook.com>
	<4FF3537E.50001@rabbitmq.com>
	<EFC021B3-1434-48D6-8F4A-61A62D551667@myyearbook.com>
Message-ID: <CACLE7izcnAOO4hZ+WrHZj3x_wntz6DVifSkcK9Uvgvjuxkk04g@mail.gmail.com>

Thanks Mathias and Gavin!

Just to add some additional insight into the Pika case, we're actually
using heartbeat with the BlockingConnection.

There were a couple of minor bugs I had to fix in heartbeat. py, and yes, I
hope to file bugs/pull requests.

With this added info, I can better explain the original issue. When we read
a message, we may not ack it for hours. Since there's no other activity on
the queue connection, the heartbeat.py logic never gets a chance to
execute. Eventually the server times out our connection because it's sent
frames but no Pika code gets run while we're working away.

Matt

On Tue, Jul 3, 2012 at 1:25 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

>
> On Jul 3, 2012, at 4:18 PM, Matthias Radestock wrote:
>
> > On 03/07/12 21:14, Gavin M. Roy wrote:
> >> we're sending a Heartbeat frame and expecting the response.
> >
> > Erhm. There is no response.
>
> LOL well there you go, I'm going off memory (a bit rusty memory).  In
> looking at the code, it's sending the frame on an IOLoop timer and looking
> for byte counter changes.
>
> Gavin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/0defd18e/attachment.htm>

From rob at bsdsoftware.co.il  Wed Jul  4 13:12:34 2012
From: rob at bsdsoftware.co.il (Rob Woolfson)
Date: Wed, 4 Jul 2012 15:12:34 +0300
Subject: [rabbitmq-discuss] Problems installing LVC exchange
Message-ID: <CAEuJcXOADheQJM8WOfp6PunbApPrdgLEkOcpCZ4Yv6hcyiN-qw@mail.gmail.com>

I have successfully run make on the public umbrella and then make in
the lvc directory.
I have generated the *.ez file in dist/ and copied it to the rabbitmq
home directory.

When I got to the management gui in a browser, I can create and
exchange from the exchange tab.  I have the option of choosing "lvc".
When I do and I click create I get the message: "503 invalid exchange
type 'lvc'"

When I try it in the code, if I set the exchange type to "lvc" I get
an exception when I try to create the exchange.
If I set it to "x-lvc" it creates the exchange but in the browser gui,
it shows the created exchange in red and says that there is an error
with it.  When I try to write to the exchange I get an exception.

Do I need to enable something or do something else to get the external
exchange to work.  Note that I only copied the *.ez file do I need
anything else?

Thanks

-- 
Rob Woolfson

From simon at rabbitmq.com  Wed Jul  4 14:53:21 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jul 2012 14:53:21 +0100
Subject: [rabbitmq-discuss] Problems installing LVC exchange
In-Reply-To: <CAEuJcXOADheQJM8WOfp6PunbApPrdgLEkOcpCZ4Yv6hcyiN-qw@mail.gmail.com>
References: <CAEuJcXOADheQJM8WOfp6PunbApPrdgLEkOcpCZ4Yv6hcyiN-qw@mail.gmail.com>
Message-ID: <4FF44AD1.1010002@rabbitmq.com>

On 04/07/12 13:12, Rob Woolfson wrote:
> Do I need to enable something or do something else to get the external
> exchange to work.  Note that I only copied the *.ez file do I need
> anything else?

It looks like the LVC exchange hasn't been updated for some time. I have 
forked it and fixed it for some recent API changes; you should have more 
success with:

https://github.com/simonmacmullen/rabbitmq-lvc-plugin

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From rob at bsdsoftware.co.il  Wed Jul  4 15:08:44 2012
From: rob at bsdsoftware.co.il (Rob Woolfson)
Date: Wed, 4 Jul 2012 17:08:44 +0300
Subject: [rabbitmq-discuss] Problems installing LVC exchange
In-Reply-To: <4FF44AD1.1010002@rabbitmq.com>
References: <CAEuJcXOADheQJM8WOfp6PunbApPrdgLEkOcpCZ4Yv6hcyiN-qw@mail.gmail.com>
	<4FF44AD1.1010002@rabbitmq.com>
Message-ID: <CAEuJcXMCgeJixU8+_PnyfYPs_Pdc7g77Z8u2es4LxmJ6FpCmmw@mail.gmail.com>

This worked thanks.

You need to change this in the readme:
git clone git://github.com/squaremo/rabbitmq-lvc-plugin.git

to
git clone git://github.com/simonmacmullen/rabbitmq-lvc-plugin.git

On Wed, Jul 4, 2012 at 4:53 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 04/07/12 13:12, Rob Woolfson wrote:
>>
>> Do I need to enable something or do something else to get the external
>> exchange to work. ?Note that I only copied the *.ez file do I need
>> anything else?
>
>
> It looks like the LVC exchange hasn't been updated for some time. I have
> forked it and fixed it for some recent API changes; you should have more
> success with:
>
> https://github.com/simonmacmullen/rabbitmq-lvc-plugin
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware



-- 
Rob Woolfson - CTO
mobile:+972-544904157
office:+972-3-5353751

From simon at rabbitmq.com  Wed Jul  4 15:11:34 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Jul 2012 15:11:34 +0100
Subject: [rabbitmq-discuss] Problems installing LVC exchange
In-Reply-To: <CAEuJcXMCgeJixU8+_PnyfYPs_Pdc7g77Z8u2es4LxmJ6FpCmmw@mail.gmail.com>
References: <CAEuJcXOADheQJM8WOfp6PunbApPrdgLEkOcpCZ4Yv6hcyiN-qw@mail.gmail.com>	<4FF44AD1.1010002@rabbitmq.com>
	<CAEuJcXMCgeJixU8+_PnyfYPs_Pdc7g77Z8u2es4LxmJ6FpCmmw@mail.gmail.com>
Message-ID: <4FF44F16.5030409@rabbitmq.com>

On 04/07/12 15:08, Rob Woolfson wrote:
> You need to change this in the readme:

Good point; done.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Wed Jul  4 16:43:36 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 4 Jul 2012 16:43:36 +0100
Subject: [rabbitmq-discuss] STOMP plug-in, HA queues,
	and consumer cancelations
In-Reply-To: <CAFDmHdMVjvJm_W4_FaQVsR+MuZDWG3Ai35FEwqB9N_15M3j92g@mail.gmail.com>
References: <CAFDmHdMU2AqJCG9_Ps8CM93iUS2pthDNFm3imot5LUE1+XXRHQ@mail.gmail.com>
	<8AC41936-B28F-4F26-AF39-51D7AC1C35D1@vmware.com>
	<CAFDmHdMWUXyfAOOxJjMpPEH42V3dZeyTnooAUAVkmAjsfgpXdQ@mail.gmail.com>
	<9E830826-692A-4D36-8233-59B0385EA098@rabbitmq.com>
	<CAFDmHdMVjvJm_W4_FaQVsR+MuZDWG3Ai35FEwqB9N_15M3j92g@mail.gmail.com>
Message-ID: <AB1EF44E-8A23-4407-A7D1-CB159616CDDA@rabbitmq.com>

> And therein lies the problem.


Yes, I agree.  All good points, well argued.
I've raised a bug (25045) to address this problem.

Steve Powell  (a happy bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

On 3 Jul 2012, at 18:52, Elias Levy wrote:

> On Tue, Jul 3, 2012 at 9:06 AM, Steve Powell <steve at rabbitmq.com> wrote:
> You are quite right. Your understanding of HA queues is better than
> mine. However, AFAICS the STOMP adapter doesn't present
> the consumer_cancel_notify capability to the (Erlang) connection, so
> will not receive a notification when the consumer is cancelled.
> 
> The STOMP client will think that the subscription is sound even if the
> underlying consumer was cancelled. We can probably do better than this.
> 
> And therein lies the problem.
>  
> Although the STOMP client will stop receiving messages, I would not
> characterise this as 'dangerous', merely frustrating.
> 
> Maybe not dangerous, since there is no data loss, but certainly a lot worse than frustrating.  If you have long lived STOMP connections with consumers which suddenly stop receiving messages without any warning, depending on the importance of those messages and the processes that consume them, the loss of the subscription can be quite important from a business perspective.
> 
> E.g. if those messages are being used to monitor some business activity, you are now flying blind until the STOMP connection is torn down and reestablished.
> 
> Can you say what you think the correct STOMP behaviour ought to be if a
> subscription's consumer is unilaterally cancelled? I'm tempted to simply
> send an ERROR frame and simulate an UNSUBSCRIBE,
> leaving the STOMP client to recover however it thinks fit.
> 
> To resubscribe to the HA queues, obviously.  The HA queue consumer cancelation is a rather ugly implementation detail.  In an ideal world, a HA queue would behave just like a non-HA queue.  From a consumer perspective whether a queue is HA or non-HA would be invisible.  A HA queue would failover without consumers attached to the non-failing nodes noticing. Alas, this is not the case, and I understand why that is given the existing implementation.
> 
> So ideally the STOMP proxy would resubscribe when it receives a consumer cancelation.  Any messages that consumers received that had not yet been acked or for which acks where lost in flight wil be requeued and retransmitted by the new queue master.  I believe thats OK.  RMQ and AMQP already have an expectation that some messages may be delivered more than once as it does not have a two-phase commit for acknowledgements, so clients should already be ready for this eventuality.
> 
> But even sending an ERROR frame to the client to it knowns something went wrong and giving it an opportunity to recover is much better than the situation as it is right now.
> 
> Elias Levy


From carl.hoerberg at gmail.com  Wed Jul  4 21:12:23 2012
From: carl.hoerberg at gmail.com (=?ISO-8859-1?Q?Carl_H=F6rberg?=)
Date: Wed, 4 Jul 2012 22:12:23 +0200
Subject: [rabbitmq-discuss] can't set log_levels?
Message-ID: <CAFPidkMgfCjUv5aGA_q4CG_JZzJxLLQ5bFuANPDbaXV3h7Wp_A@mail.gmail.com>

Even if i turn down "log_levels", RabbitMQ still logs info/warning
messages for connections:

My rabbitmq.config:
[
  {log_levels, [{connection, error}]}
].

The logs:

Jul 04 22:07:49 h1 rabbitmq:  =INFO REPORT==== 4-Jul-2012::20:07:46 ===
Jul 04 22:07:49 h1 rabbitmq:  accepting AMQP connection <0.483.0>
(10.226.54.165:9469 -> 10.226.125.166:5672)
Jul 04 22:07:49 h1 rabbitmq:  =WARNING REPORT==== 4-Jul-2012::20:07:46 ===
Jul 04 22:07:49 h1 rabbitmq:  closing AMQP connection <0.483.0>
(10.226.54.165:9469 -> 10.226.125.166:5672):
Jul 04 22:07:49 h1 rabbitmq:  connection_closed_abruptly

RabbitMQ version 2.8.4 on Ubuntu 12.04

From carl.hoerberg at gmail.com  Wed Jul  4 21:36:45 2012
From: carl.hoerberg at gmail.com (=?ISO-8859-1?Q?Carl_H=F6rberg?=)
Date: Wed, 4 Jul 2012 22:36:45 +0200
Subject: [rabbitmq-discuss] can't set log_levels?
In-Reply-To: <CAFPidkMgfCjUv5aGA_q4CG_JZzJxLLQ5bFuANPDbaXV3h7Wp_A@mail.gmail.com>
References: <CAFPidkMgfCjUv5aGA_q4CG_JZzJxLLQ5bFuANPDbaXV3h7Wp_A@mail.gmail.com>
Message-ID: <CAFPidkNRsukZzoxY=Nvo3j0eDE9-Xc8DhNk78n+Bw4vZCEObEg@mail.gmail.com>

sorry, my bad. fast and wrong:

with this config i does indeed work:

[
  {rabbit, [
    {log_levels, [{connection, error}]}
  ]}
].


On Wed, Jul 4, 2012 at 10:12 PM, Carl H?rberg <carl.hoerberg at gmail.com> wrote:
> Even if i turn down "log_levels", RabbitMQ still logs info/warning
> messages for connections:
>
> My rabbitmq.config:
> [
>   {log_levels, [{connection, error}]}
> ].
>
> The logs:
>
> Jul 04 22:07:49 h1 rabbitmq:  =INFO REPORT==== 4-Jul-2012::20:07:46 ===
> Jul 04 22:07:49 h1 rabbitmq:  accepting AMQP connection <0.483.0>
> (10.226.54.165:9469 -> 10.226.125.166:5672)
> Jul 04 22:07:49 h1 rabbitmq:  =WARNING REPORT==== 4-Jul-2012::20:07:46 ===
> Jul 04 22:07:49 h1 rabbitmq:  closing AMQP connection <0.483.0>
> (10.226.54.165:9469 -> 10.226.125.166:5672):
> Jul 04 22:07:49 h1 rabbitmq:  connection_closed_abruptly
>
> RabbitMQ version 2.8.4 on Ubuntu 12.04

From evangeline.eleanor at gmail.com  Wed Jul  4 22:54:36 2012
From: evangeline.eleanor at gmail.com (eleanor)
Date: Wed, 4 Jul 2012 14:54:36 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Clustering Million of Users
Message-ID: <1341438876680-20583.post@n5.nabble.com>

Hi, I'm trying to determine how much rabbitmq nodes (in a cluster) would it
take to handle 1 million of users. I'm trying to compare that to Google
Appengine Instances. Let's say my application on GAE should process the
following:
  - 4000-5000 requests/second
  - 400-500 instances running

Now I'm not really an advanced user of GAE so I don't really know how to
compare those results with rabbitmq.

And I know you're not GAE users, so just ignore the first part of the
message and answer me this: 
1. How big cluster would I need to handle 4000-5000 requests/s?
2. Is it a good idea to rent the available servers on 6sync or some other
VPS hosting to build a cluster of RabbitMQ nodes there or is something else
really a better way of building a RabbitMQ cluster?

That's it. 

Thank you

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Clustering-Million-of-Users-tp20583.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ekirpichov at gmail.com  Thu Jul  5 00:15:16 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 4 Jul 2012 16:15:16 -0700
Subject: [rabbitmq-discuss] RabbitMQ Clustering Million of Users
In-Reply-To: <1341438876680-20583.post@n5.nabble.com>
References: <1341438876680-20583.post@n5.nabble.com>
Message-ID: <CANVKUrWxGehBRLA5p41EJB_uGkjTBUkTPJQiajoR+gM8V8B-vQ@mail.gmail.com>

Depends on the type of the requests and the usage pattern. E.g. if
you're fine with using non-zero prefetch, and the requests are just a
few hundred bytes or maybe a kilobyte, then 1 instance will be enough.

On Wed, Jul 4, 2012 at 2:54 PM, eleanor <evangeline.eleanor at gmail.com> wrote:
> Hi, I'm trying to determine how much rabbitmq nodes (in a cluster) would it
> take to handle 1 million of users. I'm trying to compare that to Google
> Appengine Instances. Let's say my application on GAE should process the
> following:
>   - 4000-5000 requests/second
>   - 400-500 instances running
>
> Now I'm not really an advanced user of GAE so I don't really know how to
> compare those results with rabbitmq.
>
> And I know you're not GAE users, so just ignore the first part of the
> message and answer me this:
> 1. How big cluster would I need to handle 4000-5000 requests/s?
> 2. Is it a good idea to rent the available servers on 6sync or some other
> VPS hosting to build a cluster of RabbitMQ nodes there or is something else
> really a better way of building a RabbitMQ cluster?
>
> That's it.
>
> Thank you
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Clustering-Million-of-Users-tp20583.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
Eugene Kirpichov
http://www.linkedin.com/in/eugenekirpichov

From gmr at myyearbook.com  Thu Jul  5 01:31:58 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 4 Jul 2012 20:31:58 -0400
Subject: [rabbitmq-discuss] RabbitMQ Clustering Million of Users
In-Reply-To: <1341438876680-20583.post@n5.nabble.com>
References: <1341438876680-20583.post@n5.nabble.com>
Message-ID: <F08EFE2C792E4BDFB927DC4DC17C6025@myyearbook.com>



On Wednesday, July 4, 2012 at 5:54 PM, eleanor wrote:

> And I know you're not GAE users, so just ignore the first part of the
> message and answer me this: 
> 1. How big cluster would I need to handle 4000-5000 requests/s?
> 
> 

I've found around 10k messages/s per node in a cluster as a reasonable number in my environment, but think I could get that to a higher velocity with some OS level tuning.
> 2. Is it a good idea to rent the available servers on 6sync or some other
> VPS hosting to build a cluster of RabbitMQ nodes there or is something else
> really a better way of building a RabbitMQ cluster?
> 
> 

Depends on how reliable you find resource availability in your VPS solutions. At high velocities, it's packets per second and network traffic that'll get you, not CPU. Also depending on queue depths, RAM could be an issue. 

Regards,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120704/5fc82cf7/attachment.htm>

From evangeline.eleanor at gmail.com  Thu Jul  5 05:42:25 2012
From: evangeline.eleanor at gmail.com (eleanor)
Date: Wed, 4 Jul 2012 21:42:25 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Clustering Million of Users
In-Reply-To: <F08EFE2C792E4BDFB927DC4DC17C6025@myyearbook.com>
References: <1341438876680-20583.post@n5.nabble.com>
	<F08EFE2C792E4BDFB927DC4DC17C6025@myyearbook.com>
Message-ID: <1341463345768-20586.post@n5.nabble.com>

jkff, so you're saying that each node in a cluster should have more workers
to do the dirty work for him.

Gavin, can you tell me more about the cluster you're talking about: how many
nodes/workers - how they are connected. And also, all the nodes should be on
LAN, so the connections are really fast (so that packets per second don't
cause too much delay when nodes are exchanging messages). And how much RAM
are we talking about. I would really like to know some specific numbers
about how to build such a cluster - which VPS provider (or any other provide
to chose from), what VPS to choose: how much CPU, RAM, disk, etc.

And also: the GAE instances are then really not that great. You're saying
that 1 node can compare to 400 GAE instances? Is there any link that
describes that in more detail, since I want to be really sure about this,
because I don't want to burn myself with it.

Thank you

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Clustering-Million-of-Users-tp20583p20586.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From gmr at myyearbook.com  Thu Jul  5 06:10:42 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 5 Jul 2012 01:10:42 -0400
Subject: [rabbitmq-discuss] RabbitMQ Clustering Million of Users
In-Reply-To: <1341463345768-20586.post@n5.nabble.com>
References: <1341438876680-20583.post@n5.nabble.com>
	<F08EFE2C792E4BDFB927DC4DC17C6025@myyearbook.com>
	<1341463345768-20586.post@n5.nabble.com>
Message-ID: <E3FD4A7D7AA54D2CB86699943168E91E@myyearbook.com>

On Thursday, July 5, 2012 at 12:42 AM, eleanor wrote:
> how many nodes/workers - how they are connected.
On average, I see between 500 and 1000 connections and channels per node in my infrastructure.
> And also, all the nodes should be on
> LAN, so the connections are really fast (so that packets per second don't
> cause too much delay when nodes are exchanging messages). 
> 
> 

Packets per second will be based upon how big your data is and how many messages you are pushing. I would be concerned about network infrastructure on a LAN if I were building out a high-veolicty messaging service. 
> And how much RAM
> are we talking about.
> 
> 

Depends on your use case, I usually have 16GB to 24GB per node to make sure that in the event that consumers die off, I can keep my queues in RAM while they are brought back online. My use-cases are generally much different than what I gather you are doing, however.
> I would really like to know some specific numbers
> about how to build such a cluster - 
> 
> 

You would really need to bench out your own use case, message size, publishing application, consuming application, network infrastructure all play a part. 
> which VPS provider (or any other provide
> to chose from), what VPS to choose: how much CPU, RAM, disk, etc.
> 
> 

I don't use virtual servers, so I can't offer any advice there. 
> And also: the GAE instances are then really not that great. You're saying
> that 1 node can compare to 400 GAE instances? 
> 
> 

Probably not. Your best bet is to bench what your app throughput is and emulate end-users talking to your application.

As you're running through this process, I would figure out your application architecture.

How is data going to be routed through your system? What is the upper-end performance for your publishers and consumers? Will you have multiple consumers per queue? How many queues will you have? Will you be using mirrored queues? Are you using persistent messages? What kind of exchange will you be using? How much of your publishing will be across the cluster vs on the node the user is connected to (i.e. sending messages to queues on different machines)? These questions (and more) really factor into performance and scaling.

Your best bet, as I mentioned before, is to simulate what you want to do. Setup a small scale test, based some assumptions upon that, tweak settings and make changes, re-test. Once you're happy with that, test at a larger scale. When going through this exercise, I often will test at multiples of my intended throughput or target scale.

Hope this helped,

Gavin






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120705/092c6eb8/attachment.htm>

From alvinzmho at gmail.com  Thu Jul  5 09:06:44 2012
From: alvinzmho at gmail.com (alvinRMQ)
Date: Thu, 5 Jul 2012 01:06:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Auto delete messages in Queue after queue size
 reaches a certain number
Message-ID: <1341475604189-20588.post@n5.nabble.com>

Hi,

Is there a way for the rabbitMQ broker to automatically throw away messages
in a Queue if the number of messages is above a certain number? It is
possible that a consumer may not be able to keep up with the publisher, and
cause the Rabbit Broker to slowly run out of disk space.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Auto-delete-messages-in-Queue-after-queue-size-reaches-a-certain-number-tp20588.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Thu Jul  5 09:34:45 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 05 Jul 2012 09:34:45 +0100
Subject: [rabbitmq-discuss] Auto delete messages in Queue after queue
 size reaches a certain number
In-Reply-To: <1341475604189-20588.post@n5.nabble.com>
References: <1341475604189-20588.post@n5.nabble.com>
Message-ID: <4FF551A5.7010207@rabbitmq.com>

On 05/07/12 09:06, alvinRMQ wrote:
> Is there a way for the rabbitMQ broker to automatically throw away messages
> in a Queue if the number of messages is above a certain number?

The closest RabbitMQ has to that is per-queue message ttl. See 
http://www.rabbitmq.com/extensions.html#queue-ttl. That is based on time 
rather than a count, which is arguably more useful - i.e. one can 
imagine that an app may not care about messages older than n seconds, 
whereas it is hard to conceive of an app that doesn't care about 
messages thrown away from the front (or back?) of the queue based on a 
count.

> It is possible that a consumer may not be able to keep up with the
> publisher, and cause the Rabbit Broker to slowly run out of disk space.

...at which point rabbit will block the producers until the consumers 
have drained enough messages to clear the disk alarm.

Regards,

Matthias.

From hackeron at gmail.com  Thu Jul  5 12:08:23 2012
From: hackeron at gmail.com (Roman Gaufman)
Date: Thu, 5 Jul 2012 12:08:23 +0100
Subject: [rabbitmq-discuss] Messages lost with RabbitMQ Federation
Message-ID: <CAAs9BZNe=onHQujquzWROYR_ckSf5Gm1+v2odHaW6xD9YQEq0Q@mail.gmail.com>

I have 2 RabbitMQ Nodes. One node is on a US server and one is on a UK
server. They are both connected to the same VPN.

I'm consuming the messages from the local nodes in both in the US and UK
with:

AMQP.start('amqp://guest:guest at localhost:25672') do |connection, open_ok|
  channel  = AMQP::Channel.new(connection)
  exchange = AMQP::Exchange.new(channel, "x-federation", "xanview",
:durable => true,
    :arguments => {"upstream-set" => "my-upstreams", "type" => "topic",
"durable" => "true"})
  channel.queue("testqueue_uk", :durable => true) do |queue| # testqueue_us
in the US
    queue.bind(exchange, :routing_key => '#')
    queue.subscribe do |metadata, payload|
      i+=1
      puts "#{i}: Recieved message: #{payload.inspect}."
    end
  end
end

I'm producing messages locally to the local nodes in both the US and UK
with:

EventMachine.run do
  AMQP.connect('amqp://guest:guest at localhost:25672') do |connection,
open_ok|
    channel = AMQP::Channel.new(connection)
    exchange = AMQP::Exchange.new(channel, "x-federation", "xanview",
:durable => true, :arguments => {"upstream-set" => "my-upstreams", "type"
=> "topic", "durable" => "true"})
    EventMachine.add_periodic_timer(0.1) do
      $i+=1
      puts "#{$i}: publishing msg"
      $exchange.publish("#{$i} this is a test message from the US",
:routing_key => "some.topic", :persistent => true )
    end
  end
end

This all seems to work reliably until I try to kill the connection: I
shutdown the VPN and see messages being queued in queues called:
"federation: xanview -> node2" (on the UK server) and "federation: xanview
-> node1" (on the US server) as expected.

However when I restart the VPN, the UK server has received 43737 messages
while the US only received 43708 messages. Where did 29 messages disappear?

Both node configs look like this with the only exception of the US
connecting to federation on 10.8.0.22 and the UK connecting to federation
on 10.8.0.33:

[
  {rabbit, [
    {tcp_listeners, [25672]}
  ]},
  {rabbitmq_mochiweb, [
    {listeners,        [{mgmt, [{port, 55555}]}]},
    {default_listener, [{port, 55550}]},
    {contexts,         [{rabbit_mgmt, mgmt}]}
  ]},

{rabbitmq_federation,
   [ {exchanges, [[{exchange,     "xanview"},
                   {virtual_host, "/"},
                   {type,         "topic"},
                   {durable,      true},
                   {auto_delete,  false},
                   {internal,     false},
                   {upstream_set, "my-upstreams"}]
                 ]},
     {upstream_sets, [{"my-upstreams", [[{connection,
"upstream-server"}]]}]},
     {connections, [{"upstream-server", [{host,            "10.8.0.22"},
                                         {protocol,        "amqp"},
                                         {port,            25672},
                                         {virtual_host,    "/"},
                                         {username,        "guest"},
                                         {password,        "guest"},
                                         {mechanism,       default},
                                         {prefetch_count,  1000},
                                         {reconnect_delay, 5},
                                         {ha_policy,       "all"}
                                        ]}
                   ]},
     {local_username, "guest"},
     {local_nodename, "node2"}
   ]
  }

].

Any ideas why messages are lost? What could be causing it?

Roman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120705/691b3103/attachment.htm>

From simon at rabbitmq.com  Thu Jul  5 13:58:49 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Jul 2012 13:58:49 +0100
Subject: [rabbitmq-discuss] Problems installing LVC exchange
In-Reply-To: <CAEuJcXPfnNZ=K1juimX669FKvLpWayRO2gvv0-P=kt5xf+taJQ@mail.gmail.com>
References: <CAEuJcXOADheQJM8WOfp6PunbApPrdgLEkOcpCZ4Yv6hcyiN-qw@mail.gmail.com>	<4FF44AD1.1010002@rabbitmq.com>	<CAEuJcXMCgeJixU8+_PnyfYPs_Pdc7g77Z8u2es4LxmJ6FpCmmw@mail.gmail.com>	<4FF44F16.5030409@rabbitmq.com>
	<CAEuJcXPfnNZ=K1juimX669FKvLpWayRO2gvv0-P=kt5xf+taJQ@mail.gmail.com>
Message-ID: <4FF58F89.4000004@rabbitmq.com>

Not at the moment, I think because it's not completely obvious what it 
should do.

The direct-exchange case is obvious: store a last message for every 
routing key that is ever published, and then look up the routing key 
when a new queue is bound.

But in the topic case if we do that then we would have to check each 
stored message and send it to the new queue if it matches the new 
routing key. So the queue could conceptually get a whole load of 
messages sent. Does this seem like a reasonable thing for it to do?

Cheers, Simon

On 05/07/12 11:20, Rob Woolfson wrote:
> Is there a way to change it to a topic exchange instead of a direct exchange?
>
> On Wed, Jul 4, 2012 at 5:11 PM, Simon MacMullen<simon at rabbitmq.com>  wrote:
>> On 04/07/12 15:08, Rob Woolfson wrote:
>>>
>>> You need to change this in the readme:
>>
>>
>> Good point; done.
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jul  5 14:09:01 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Jul 2012 14:09:01 +0100
Subject: [rabbitmq-discuss] Messages lost with RabbitMQ Federation
In-Reply-To: <CAAs9BZNe=onHQujquzWROYR_ckSf5Gm1+v2odHaW6xD9YQEq0Q@mail.gmail.com>
References: <CAAs9BZNe=onHQujquzWROYR_ckSf5Gm1+v2odHaW6xD9YQEq0Q@mail.gmail.com>
Message-ID: <4FF591ED.3010100@rabbitmq.com>

On 05/07/12 12:08, Roman Gaufman wrote:
> However when I restart the VPN, the UK server has received 43737
> messages while the US only received 43708 messages. Where did 29
> messages disappear?

Is it instead possible that 29 messages have been duplicated? Remember 
that when you kill an AMQP connection where A is consuming from B, A can 
have sent acknowledgements which B has not yet received. In this case 
when the federation link comes back up again, those messages will be 
retransmitted. You will be able to see this as there will be a 
redelivered flag set in the federation headers. (But don't just throw 
away redelivered messages - they might not have reached A when the 
connection went down.)

I suggest you modify your tests to send a fixed number of messages and 
see what happens.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From rob at bsdsoftware.co.il  Thu Jul  5 14:27:55 2012
From: rob at bsdsoftware.co.il (Rob Woolfson)
Date: Thu, 5 Jul 2012 16:27:55 +0300
Subject: [rabbitmq-discuss] Problems installing LVC exchange
In-Reply-To: <4FF58F89.4000004@rabbitmq.com>
References: <CAEuJcXOADheQJM8WOfp6PunbApPrdgLEkOcpCZ4Yv6hcyiN-qw@mail.gmail.com>
	<4FF44AD1.1010002@rabbitmq.com>
	<CAEuJcXMCgeJixU8+_PnyfYPs_Pdc7g77Z8u2es4LxmJ6FpCmmw@mail.gmail.com>
	<4FF44F16.5030409@rabbitmq.com>
	<CAEuJcXPfnNZ=K1juimX669FKvLpWayRO2gvv0-P=kt5xf+taJQ@mail.gmail.com>
	<4FF58F89.4000004@rabbitmq.com>
Message-ID: <CAEuJcXO36-v_hKxd+_zpCwrUEP0Jpkc6m7jKPTt6s4_giE7bpg@mail.gmail.com>

Simon,

Is the issue the number of messages that could be sent, because with a
large number of bindings I will receive a large number of messages to
the queue in a direct exchange too?

If I understand you correctly the problem is a new routing key could
match one or more messages stored, as opposed to in a direct exchange
where once it finds a match it can stop searching as it will match one
and only one message.

This is a problem if there are many potential routing keys especially
if they are segmented (not sure what to call it) x.y.z.a.b.c then
there is a lot more checking todo.  How much of a problem is this
though?

My problem is that I want to use this to track the status of a number
of different things.  With a topic style routing key I can send all
status message to a single exchange and have all process requiring to
know the status of a particular other process consume only the
relevant messages.  This is easiest with a topic exchange, anything I
do with a direct exchange will require more and possibly many more
exchanges and or parsing of complex routing keys.

On Thu, Jul 5, 2012 at 3:58 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> Not at the moment, I think because it's not completely obvious what it
> should do.
>
> The direct-exchange case is obvious: store a last message for every routing
> key that is ever published, and then look up the routing key when a new
> queue is bound.
>
> But in the topic case if we do that then we would have to check each stored
> message and send it to the new queue if it matches the new routing key. So
> the queue could conceptually get a whole load of messages sent. Does this
> seem like a reasonable thing for it to do?
>
> Cheers, Simon
>
>
> On 05/07/12 11:20, Rob Woolfson wrote:
>>
>> Is there a way to change it to a topic exchange instead of a direct
>> exchange?
>>
>> On Wed, Jul 4, 2012 at 5:11 PM, Simon MacMullen<simon at rabbitmq.com>
>> ?wrote:
>>>
>>> On 04/07/12 15:08, Rob Woolfson wrote:
>>>>
>>>>
>>>> You need to change this in the readme:
>>>
>>>
>>>
>>> Good point; done.
>>>
>>>
>>> Cheers, Simon
>>>
>>> --
>>> Simon MacMullen
>>> RabbitMQ, VMware
>>
>>
>>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware



-- 
Rob Woolfson - CTO
mobile:+972-544904157
office:+972-3-5353751

From roman at xanview.com  Thu Jul  5 14:43:01 2012
From: roman at xanview.com (Roman Gaufman | Xanview)
Date: Thu, 5 Jul 2012 14:43:01 +0100
Subject: [rabbitmq-discuss] Messages lost with RabbitMQ Federation
In-Reply-To: <4FF591ED.3010100@rabbitmq.com>
References: <CAAs9BZNe=onHQujquzWROYR_ckSf5Gm1+v2odHaW6xD9YQEq0Q@mail.gmail.com>
	<4FF591ED.3010100@rabbitmq.com>
Message-ID: <CAAs9BZP9nHHKzaKvDwScbHU5mmQUdXscuni82oiaLrCynOE1OA@mail.gmail.com>

Ah! - very possible, changing my tests :) - I tried to reproduce briefly
but wasn't able to - I will leave it running for a few hours randomly
killing the connection and report back.

On 5 July 2012 14:09, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 05/07/12 12:08, Roman Gaufman wrote:
>
>> However when I restart the VPN, the UK server has received 43737
>> messages while the US only received 43708 messages. Where did 29
>> messages disappear?
>>
>
> Is it instead possible that 29 messages have been duplicated? Remember
> that when you kill an AMQP connection where A is consuming from B, A can
> have sent acknowledgements which B has not yet received. In this case when
> the federation link comes back up again, those messages will be
> retransmitted. You will be able to see this as there will be a redelivered
> flag set in the federation headers. (But don't just throw away redelivered
> messages - they might not have reached A when the connection went down.)
>
> I suggest you modify your tests to send a fixed number of messages and see
> what happens.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120705/3915aa72/attachment.htm>

From jonathan.s.oliver42 at gmail.com  Thu Jul  5 16:13:31 2012
From: jonathan.s.oliver42 at gmail.com (Jonathan Oliver)
Date: Thu, 5 Jul 2012 08:13:31 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ .NET Client Bug?
Message-ID: <046bccbd-61ec-4353-8df5-9e128e759577@googlegroups.com>

First and foremost, is there a public issue tracker where I can post bug 
reports?

With the new .NET RabbitMQ.Client v2.8.4, I'm starting to receive these 
messages during the shutdown process in my application:

System.NotSupportedException: Stream does not support writing.
   at System.IO.BufferedStream.WriteByte(Byte value)
   at System.IO.BinaryWriter.Write(Byte value)
   at RabbitMQ.Client.Impl.Frame.WriteTo(NetworkBinaryWriter writer)
   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.WriteFrame(Frame frame)
   at RabbitMQ.Client.Impl.Command.Transmit(Int32 channelNumber, 
ConnectionBase connection)
   at RabbitMQ.Client.Impl.SessionBase.Transmit(Command cmd)
   at RabbitMQ.Client.Impl.MainSession.Transmit(Command cmd)
   at RabbitMQ.Client.Impl.ConnectionBase.Close(ShutdownEventArgs reason, 
Boolean abort, Int32 timeout)
   at RabbitMQ.Client.Impl.ConnectionBase.Abort(Int32 timeout)

The code I'm invoking which causes the behavior is 
"connection.Abort(3000);".  This is part of the shutdown code which waits 
about 3 seconds before forcefully terminating the connection.  Obviously 
this is fairly easy to work around on my end, but I wasn't sure if it was 
intended/expected behavior or if it was a regression of some kind.

Lastly, do you guys need an additional maintainer for the RabbitMQ.Client 
NuGet package? I've seen a few releases where the package wasn't released 
in a timely manner.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120705/35ac75b7/attachment.htm>

From simon at rabbitmq.com  Thu Jul  5 17:34:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Jul 2012 17:34:13 +0100
Subject: [rabbitmq-discuss] Problems installing LVC exchange
In-Reply-To: <CAEuJcXO36-v_hKxd+_zpCwrUEP0Jpkc6m7jKPTt6s4_giE7bpg@mail.gmail.com>
References: <CAEuJcXOADheQJM8WOfp6PunbApPrdgLEkOcpCZ4Yv6hcyiN-qw@mail.gmail.com>	<4FF44AD1.1010002@rabbitmq.com>	<CAEuJcXMCgeJixU8+_PnyfYPs_Pdc7g77Z8u2es4LxmJ6FpCmmw@mail.gmail.com>	<4FF44F16.5030409@rabbitmq.com>	<CAEuJcXPfnNZ=K1juimX669FKvLpWayRO2gvv0-P=kt5xf+taJQ@mail.gmail.com>	<4FF58F89.4000004@rabbitmq.com>
	<CAEuJcXO36-v_hKxd+_zpCwrUEP0Jpkc6m7jKPTt6s4_giE7bpg@mail.gmail.com>
Message-ID: <4FF5C205.2090808@rabbitmq.com>

On 05/07/12 14:27, Rob Woolfson wrote:
> Is the issue the number of messages that could be sent, because with a
> large number of bindings I will receive a large number of messages to
> the queue in a direct exchange too?

Yes, but with a direct exchange you will only receive one *per binding*.

> If I understand you correctly the problem is a new routing key could
> match one or more messages stored, as opposed to in a direct exchange
> where once it finds a match it can stop searching as it will match one
> and only one message.

Yes.

> This is a problem if there are many potential routing keys especially
> if they are segmented (not sure what to call it) x.y.z.a.b.c then
> there is a lot more checking todo.  How much of a problem is this
> though?

Well, it strikes me that this is not likely to be amazingly performant. 
But the LVC exchange is not that fast anyway.

> My problem is that I want to use this to track the status of a number
> of different things.  With a topic style routing key I can send all
> status message to a single exchange and have all process requiring to
> know the status of a particular other process consume only the
> relevant messages.  This is easiest with a topic exchange, anything I
> do with a direct exchange will require more and possibly many more
> exchanges and or parsing of complex routing keys.

So yes, this could happen. But I should point out that I only just 
adopted the LVC exchange, and only really had intended to get it working 
again. I will add this to the big pile of things to do, though :-)

Cheers, Simon

> On Thu, Jul 5, 2012 at 3:58 PM, Simon MacMullen<simon at rabbitmq.com>  wrote:
>> Not at the moment, I think because it's not completely obvious what it
>> should do.
>>
>> The direct-exchange case is obvious: store a last message for every routing
>> key that is ever published, and then look up the routing key when a new
>> queue is bound.
>>
>> But in the topic case if we do that then we would have to check each stored
>> message and send it to the new queue if it matches the new routing key. So
>> the queue could conceptually get a whole load of messages sent. Does this
>> seem like a reasonable thing for it to do?
>>
>> Cheers, Simon
>>
>>
>> On 05/07/12 11:20, Rob Woolfson wrote:
>>>
>>> Is there a way to change it to a topic exchange instead of a direct
>>> exchange?
>>>
>>> On Wed, Jul 4, 2012 at 5:11 PM, Simon MacMullen<simon at rabbitmq.com>
>>>   wrote:
>>>>
>>>> On 04/07/12 15:08, Rob Woolfson wrote:
>>>>>
>>>>>
>>>>> You need to change this in the readme:
>>>>
>>>>
>>>>
>>>> Good point; done.
>>>>
>>>>
>>>> Cheers, Simon
>>>>
>>>> --
>>>> Simon MacMullen
>>>> RabbitMQ, VMware
>>>
>>>
>>>
>>>
>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From mauryam at live.in  Thu Jul  5 17:55:47 2012
From: mauryam at live.in (Maurya M)
Date: Thu, 5 Jul 2012 22:25:47 +0530
Subject: [rabbitmq-discuss] Auto delete messages in Queue after queue
 size reaches a certain number
In-Reply-To: <4FF551A5.7010207@rabbitmq.com>
References: <1341475604189-20588.post@n5.nabble.com>,
	<4FF551A5.7010207@rabbitmq.com>
Message-ID: <SNT143-W2AE6BF8AE6D46028AA898BBEF0@phx.gbl>


Matthias,
 Setting the "ttl" on the publisher queue does work fine when the consumer also declares the queue with 'ttl' (using Java client tested)

Is it necessary for declaring the consumer queue to hold the configuration of ttl? My requirement is to drop the published messages which are older than X secs. Is there are way to achieve this using a Java publisher and C++ consumer? Appreciate your response.

Thnx,
Maurya

> Date: Thu, 5 Jul 2012 09:34:45 +0100
> From: matthias at rabbitmq.com
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Auto delete messages in Queue after queue size reaches a certain number
> 
> On 05/07/12 09:06, alvinRMQ wrote:
> > Is there a way for the rabbitMQ broker to automatically throw away messages
> > in a Queue if the number of messages is above a certain number?
> 
> The closest RabbitMQ has to that is per-queue message ttl. See 
> http://www.rabbitmq.com/extensions.html#queue-ttl. That is based on time 
> rather than a count, which is arguably more useful - i.e. one can 
> imagine that an app may not care about messages older than n seconds, 
> whereas it is hard to conceive of an app that doesn't care about 
> messages thrown away from the front (or back?) of the queue based on a 
> count.
> 
> > It is possible that a consumer may not be able to keep up with the
> > publisher, and cause the Rabbit Broker to slowly run out of disk space.
> 
> ...at which point rabbit will block the producers until the consumers 
> have drained enough messages to clear the disk alarm.
> 
> Regards,
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120705/1f1e3e5f/attachment.htm>

From matthias at rabbitmq.com  Thu Jul  5 18:44:57 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 05 Jul 2012 18:44:57 +0100
Subject: [rabbitmq-discuss] Auto delete messages in Queue after queue
 size reaches a certain number
In-Reply-To: <SNT143-W2AE6BF8AE6D46028AA898BBEF0@phx.gbl>
References: <1341475604189-20588.post@n5.nabble.com>,
	<4FF551A5.7010207@rabbitmq.com>
	<SNT143-W2AE6BF8AE6D46028AA898BBEF0@phx.gbl>
Message-ID: <4FF5D299.10403@rabbitmq.com>

Maurya,

On 05/07/12 17:55, Maurya M wrote:
> Is it necessary for declaring the consumer queue to hold the
> configuration of ttl?

All clients that declare the (same) queue must supply the same 
declaration arguments.

> Is there are way to achieve this using a Java publisher and C++
> consumer? Appreciate your response.

I don't know the C++ client, but iirc there have been some recent 
discussions on this list regarding the setting of queue declaration 
arguments, so I suggest you search the archives.

Regards,

Matthias.

From naveen.chwl at gmail.com  Thu Jul  5 13:57:57 2012
From: naveen.chwl at gmail.com (Navigateur)
Date: Thu, 5 Jul 2012 05:57:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Disconnecting vs failure of a disk node and
 reconnecting a new one...?
Message-ID: <5adadd84-8605-4f47-9557-81ca0e871516@googlegroups.com>

New to RabbitMQ. I want do to high-availability over 2 machines. Do I make 
them both disk nodes or just 1? If just 1, but its disk fails, does the 
other one automatically become a "disk node"? If not, and I replace the 
failed-disk machine with a brand new machine with the same name (e.g. 
rabbit at server1) and simply instruct it to join the cluster - will 
everything continue to work as if nothing happened? If not, which steps do 
I do to make it?

If I can't, then 2 disk nodes is the better solution, yes? And if I did 
that, is recovering from an abrupt failure of 1 of the machines simply to 
replace that machine, give it the same name (e.g. rabbit at server1) and call 
the rabbitmqctl cluster command? Is that all I would have to do? If not, 
which steps do I do to get things back up fully?

I also have a 3rd machine running, which doesn't have any local web app 
software which creates or listens for any RabbitMQ messages. Would I 
benefit from using that as an additional (3rd) RabbitMQ node still? For 
example, the 3rd non-web-app machine as a disk node, and the 2 
web-app-clustered (which load-balance) machines as RAM nodes? And maybe 
have a RAID disk in the 3rd non-web-app machine. Is this the best solution 
of all? Last question, how do I recover after explicitly removing a disk 
node (i.e. not through disk failure, this in addition do the disk-failure 
question)?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120705/7626288b/attachment.htm>

From evangeline.eleanor at gmail.com  Thu Jul  5 23:11:03 2012
From: evangeline.eleanor at gmail.com (eleanor)
Date: Thu, 5 Jul 2012 15:11:03 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Clustering Million of Users
In-Reply-To: <E3FD4A7D7AA54D2CB86699943168E91E@myyearbook.com>
References: <1341438876680-20583.post@n5.nabble.com>
	<F08EFE2C792E4BDFB927DC4DC17C6025@myyearbook.com>
	<1341463345768-20586.post@n5.nabble.com>
	<E3FD4A7D7AA54D2CB86699943168E91E@myyearbook.com>
Message-ID: <1341526263791-20600.post@n5.nabble.com>

Thank you, it certainly cleared some aspects, but some questions still
remain, since you're not using GAE or VPS. 

I really appreciate the time you've put into answering my question.

Thanks

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Clustering-Million-of-Users-tp20583p20600.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From hebin7611 at hotmail.com  Fri Jul  6 06:53:20 2012
From: hebin7611 at hotmail.com (=?gb2312?B?us6x8w==?=)
Date: Fri, 6 Jul 2012 13:53:20 +0800
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
	connected
Message-ID: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>


Hi all,

I installed RabbotMQ & tried to start it.

But I always got error as following:

{error_logger,{{2012,7,6},{13,32,21}},"Protocol: ~p: register error: ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,"inet_tcp_dist.erl"},{line,70}]},{net_kernel,start_protos,4,[{file,"net_kernel.erl"},{line,1314}]},{net_kernel,start_protos,3,[{file,"net_kernel.erl"},{line,1307}]},{net_kernel,init_node,2,[{file,"net_kernel.erl"},{line,1197}]},{net_kernel,init,1,[{file,"net_kernel.erl"},{line,357}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}]}
{error_logger,{{2012,7,6},{13,32,21}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.90>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,551}],[]]}
{error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch1077,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2012,7,6},{13,32,21}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})


I ran it on a server with public IP 183.*.*.* .

In Erlang src, I found that epmd checks connection src. 

      /* Determine if connection is from localhost */
      if (getpeername(s->fd,(struct sockaddr*) &si,&st) ||
          st < sizeof(si)) {
          /* Failure to get peername is regarded as non local host */
          s->local_peer = EPMD_FALSE;
      } else {
          /* Only 127.x.x.x and connections from the host's IP address
             allowed, no false positives */
          s->local_peer =
              (((((unsigned) ntohl(si.sin_addr.s_addr)) & 0xFF000000U) ==
               0x7F000000U) ||
               (getsockname(s->fd,(struct sockaddr*) &di,&st) ?
               EPMD_FALSE : si.sin_addr.s_addr == di.sin_addr.s_addr));
      }
      dbg_tty_printf(g,2,(s->local_peer) ? "Local peer connected" :
                     "Non-local peer connected");


But unfortunately, si.sin_addr.s_addr was 183.*.*.*, while di.sin_addr.s_addr was 127.0.0.1

My log?Checking peer address, getsockname ret: 0, si_addr=0xb7??????, di_addr=0x7f000001

Is there any way to force RabbitMQ server connect epmd via a specified address?

Thanks a lot.

He Bin

 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120706/ba3431fe/attachment.htm>

From emile at rabbitmq.com  Fri Jul  6 11:19:07 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 06 Jul 2012 11:19:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET Client Bug?
In-Reply-To: <046bccbd-61ec-4353-8df5-9e128e759577@googlegroups.com>
References: <046bccbd-61ec-4353-8df5-9e128e759577@googlegroups.com>
Message-ID: <4FF6BB9B.4020704@rabbitmq.com>


Hi Jonathan,

On 05/07/12 16:13, Jonathan Oliver wrote:
> First and foremost, is there a public issue tracker where I can post bug
> reports?

This mailing list is the preferred forum for reporting bugs.

> With the new .NET RabbitMQ.Client v2.8.4, I'm starting to receive these
> messages during the shutdown process in my application:
> 
> System.NotSupportedException: Stream does not support writing.

I notice that ConnectionBase.Close expects an IOException if the socket
write fails, and NotSupportedException is not an IOException. This is
probably not a regression, because the code in this area has not changed
recently. On what version of .NET did you observe this error? I will
file a bug internally to investigate and correct this.

> Lastly, do you guys need an additional maintainer for the
> RabbitMQ.Client NuGet package? I've seen a few releases where the
> package wasn't released in a timely manner.

I take note of your concern, and note that you pointed this out before
at the time of release of v2.7.0.. Thanks for the offer to help. We
actually already have a reserve maintainer for the NuGet package (Steve
Flitcroft). I will gladly add your name to the waiting list in case it
becomes necessary to appoint another maintainer.


Regards

Emile


From thiagoburgo at gmail.com  Fri Jul  6 14:21:21 2012
From: thiagoburgo at gmail.com (Thiago Burgo Belo)
Date: Fri, 6 Jul 2012 10:21:21 -0300
Subject: [rabbitmq-discuss] My cluter node (ram node) down in my performance
	test
Message-ID: <CABjKUK9j23ia9foMSDUTBXa+y6-ypF86d6Wzy9PZr=dAkxG-7Q@mail.gmail.com>

Hi All,

I'm doing performance tests with Rabbit 2.8.4 in cluter mode (2 nodes),
when I send 100000 (2 publishers 50K messages) messages with 1 client
(consumer) with .NET client, my "slave" node running at ram down suddenly.

Other problem (I dont know if correlated) is I lost messages, about 8% of
loss.

In attachment the server log.

Thanks,

Thiago Burgo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120706/c6271555/attachment.htm>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: log.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120706/c6271555/attachment.txt>

From matthias at rabbitmq.com  Fri Jul  6 15:07:11 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 06 Jul 2012 15:07:11 +0100
Subject: [rabbitmq-discuss] My cluter node (ram node) down in my
 performance test
In-Reply-To: <CABjKUK9j23ia9foMSDUTBXa+y6-ypF86d6Wzy9PZr=dAkxG-7Q@mail.gmail.com>
References: <CABjKUK9j23ia9foMSDUTBXa+y6-ypF86d6Wzy9PZr=dAkxG-7Q@mail.gmail.com>
Message-ID: <4FF6F10F.6080107@rabbitmq.com>

Thiago,

On 06/07/12 14:21, Thiago Burgo Belo wrote:
> I'm doing performance tests with Rabbit 2.8.4 in cluter mode (2 nodes),
> when I send 100000 (2 publishers 50K messages) messages with 1 client
> (consumer) with .NET client, my "slave" node running at ram down suddenly.
>
> Other problem (I dont know if correlated) is I lost messages, about 8%
> of loss.
>
> In attachment the server log.

That's some interesting errors you've got there. Could you please send us

- the *complete* log file (if it's huge just put it somewhere where we 
can download it)

- the output of 'rabbitmqctl report' on the ram node when your tests are 
running (but before the crash)

Regards,

Matthias.

From thiagoburgo at gmail.com  Fri Jul  6 15:15:16 2012
From: thiagoburgo at gmail.com (Thiago Burgo Belo)
Date: Fri, 6 Jul 2012 11:15:16 -0300
Subject: [rabbitmq-discuss] My cluter node (ram node) down in my
 performance test
In-Reply-To: <4FF6F10F.6080107@rabbitmq.com>
References: <CABjKUK9j23ia9foMSDUTBXa+y6-ypF86d6Wzy9PZr=dAkxG-7Q@mail.gmail.com>
	<4FF6F10F.6080107@rabbitmq.com>
Message-ID: <CABjKUK_Bfdo=Au1CR440YcEWkB6vTts-Le6G1HVYo7QqRXrWhA@mail.gmail.com>

Matthias,

I delete my log file (~200MB) =(, I will try reproduce problem (the problem
happens frequently), and after a send the log for you. Wait a 30 min to my
performance test run, in my test I simulate 100k messages sent by 60
concurrent users (using apache benchmark -ab.exe).


Thiago Burgo

2012/7/6 Matthias Radestock <matthias at rabbitmq.com>

> Thiago,
>
>
> On 06/07/12 14:21, Thiago Burgo Belo wrote:
>
>> I'm doing performance tests with Rabbit 2.8.4 in cluter mode (2 nodes),
>> when I send 100000 (2 publishers 50K messages) messages with 1 client
>> (consumer) with .NET client, my "slave" node running at ram down suddenly.
>>
>> Other problem (I dont know if correlated) is I lost messages, about 8%
>> of loss.
>>
>> In attachment the server log.
>>
>
> That's some interesting errors you've got there. Could you please send us
>
> - the *complete* log file (if it's huge just put it somewhere where we can
> download it)
>
> - the output of 'rabbitmqctl report' on the ram node when your tests are
> running (but before the crash)
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120706/3c7d0c15/attachment.htm>

From bkjones at gmail.com  Fri Jul  6 15:52:22 2012
From: bkjones at gmail.com (Brian Jones)
Date: Fri, 6 Jul 2012 10:52:22 -0400
Subject: [rabbitmq-discuss] Queue disappears after basic reject operation
	from client?
Message-ID: <CAM=1cjk7Zn6qhtro_qjDbQTcdubo5Hv=qv=xEE5z4W2xFDFUWg@mail.gmail.com>

Hi all,

We're running RabbitMQ/Erlang == 2.8.1 / R14A

We're (currently, don't get me started) using kombu to talk to RabbitMQ
from some Python code.

We've come across a strange issue where, best we can tell, a consumer
rejects a message, and that's followed by the complete disappearance of the
queue. I'm not even sure if these two events are actually correllated (more
testing is being done now to try and reliably reproduce the issue), but in
checking out the queue's configuration options, I don't see a reason in the
configuration that would point to something more obvious like, say, "queue
has a single consumer that crashes & it's configured w/ auto-delete=true"
or something.

Here's the only log information that seemed to be relevant. If anyone has
clues or pointers, they're much appreciated.

=ERROR REPORT==== 3-Jul-2012::18:34:28 ===
** Generic server <0.14335.436> terminating
** Last message in was {'$gen_cast',{gm,{fold,undefined,"\b"}}}

** When Server state == {state,
                         {amqqueue,
                          {resource,<<"/">>,queue,

                           <<"evo.workers.do_stuff.with_things">>},
                          true,false,none,
                          [{<<"x-ha-policy">>,longstr,<<"all">>}],
                          <7472.27433.653>,[],all},
                         <0.14337.436>,<7472.27433.653>,rabbit_variable_queue,

                         {vqstate,
                          {0,{[],[]}},
                          {0,{[],[]}},
                          {delta,undefined,0,undefined},
                          {0,{[],[]}},
                          {0,{[],[]}},
                          9,

                          {1,
                           {8,
                            {msg_status,8,
                             <<8,106,184,177,219,146,140,107,196,247,218,34,
                               138,15,137,90>>,
                             undefined,true,true,true,true,
                             {message_properties,undefined,false}},
                            nil,nil}},
                          undefined,
                          {0,nil},

                          {qistate,

"/var/lib/rabbitmq/mnesia/s-rabbit1/queues/6SK5DU9WSNS31F15H65PWTGEF",
                           {{dict,0,16,16,8,80,48,
                             {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            [{segment,0,

"/var/lib/rabbitmq/mnesia/s-rabbit1/queues/6SK5DU9WSNS31F15H65PWTGEF/0.idx",
                              {array,16384,0,undefined,
                               {{{{{undefined,undefined,undefined,undefined,

                                    undefined,undefined,undefined,undefined,
                                    {{<<8,106,184,177,219,146,140,107,196,247,

                                        218,34,138,15,137,90>>,
                                      {message_properties,undefined,true},
                                      true},
                                     del,no_ack},
                                    undefined},
                                   10,10,10,10,10,10,10,10,10,10},
                                  100,100,100,100,100,100,100,100,100,100},
                                 1000,1000,1000,1000,1000,1000,1000,1000,1000,
                                 1000},
                                10000,10000,10000,10000,10000,10000,10000,
                                10000,10000,10000}},
                              1}]},
                           #Ref<0.0.113.112114>,2,262144,
                           #Fun<rabbit_variable_queue.2.91259159>,
                           {0,nil}},
                          {{client_msstate,msg_store_persistent,
                            <<45,226,10,206,192,135,238,119,205,177,43,46,24,
                              159,170,52>>,
                            {dict,0,16,16,8,80,48,
                             {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,311369,

"/var/lib/rabbitmq/mnesia/s-rabbit1/msg_store_persistent"},
                            rabbit_msg_store_ets_index,

"/var/lib/rabbitmq/mnesia/s-rabbit1/msg_store_persistent",
                            <0.246.0>,315466,307272,319563,323660},
                           {client_msstate,msg_store_transient,
                            <<172,50,239,59,161,4,42,98,116,42,171,120,108,181,

                              1,76>>,
                            {dict,0,16,16,8,80,48,
                             {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,290884,

"/var/lib/rabbitmq/mnesia/s-rabbit1/msg_store_transient"},
                            rabbit_msg_store_ets_index,


"/var/lib/rabbitmq/mnesia/s-rabbit1/msg_store_transient",
                            <0.241.0>,294981,286787,299078,303175}},

                          true,0,#Fun<rabbit_mirror_queue_slave.3.29941254>,0,
                          1,infinity,0,0,0,0,0,
                          {rates,
                           {{1341,329623,60054},2},
                           {{1341,329623,60054},2},
                           1.8427213725389851e-4,1.8427213725389851e-4,
                           {1341,340467,310020}},
                          {0,nil},
                          {0,nil},

                          {0,nil},
                          {0,nil},
                          0,0,
                          {rates,
                           {{1341,329623,60054},0},
                           {{1341,329623,60054},2},
                           0.0,1.8427213725389851e-4,
                           {1341,340467,310020}}},
                         undefined,undefined,
                         {dict,2,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],
                            [[<7471.28937.766>|
                              {{[],[]},
                               {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}}}]],
                            [],
                            [[<7471.28955.766>|
                              {{[],[]},
                               {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}}}]],
                            [],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,1,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],
                            [[<<8,106,184,177,219,146,140,107,196,247,218,34,
                                138,15,137,90>>|
                              {9,8}]],
                            [],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         10,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,2,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],
                            [[<7471.28937.766>|#Ref<0.0.149.86308>]],
                            [],
                            [[<7471.28955.766>|#Ref<0.0.149.81297>]],
                            [],[],[],[],[],[],[],[],[],[],[]}}},

                         true}
** Reason for termination ==
** {function_clause,
       [{rabbit_variable_queue,fold,
            ["\b",undefined,
             {vqstate,
                 {0,{[],[]}},

                 {0,{[],[]}},
                 {delta,undefined,0,undefined},
                 {0,{[],[]}},
                 {0,{[],[]}},
                 9,
                 {1,
                  {8,
                   {msg_status,8,
                       <<8,106,184,177,219,146,140,107,196,247,218,34,138,15,
                         137,90>>,

                       undefined,true,true,true,true,
                       {message_properties,undefined,false}},
                   nil,nil}},

                 undefined,
                 {0,nil},
                 {qistate,

"/var/lib/rabbitmq/mnesia/s-rabbit1/queues/6SK5DU9WSNS31F15H65PWTGEF",
                     {{dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                      [{segment,0,

"/var/lib/rabbitmq/mnesia/s-rabbit1/queues/6SK5DU9WSNS31F15H65PWTGEF/0.idx",

                           {array,16384,0,undefined,
                               {{{{{undefined,undefined,undefined,undefined,
                                       undefined,undefined,undefined,
                                       undefined,
                                       {{<<8,106,184,177,219,146,140,107,196,

                                           247,218,34,138,15,137,90>>,
                                         {message_properties,undefined,true},

                                         true},
                                        del,no_ack},
                                       undefined},
                                   10,10,10,10,10,10,10,10,10,10},
                                  100,100,100,100,100,100,100,100,100,100},

                                 1000,1000,1000,1000,1000,1000,1000,1000,1000,
                                 1000},
                                10000,10000,10000,10000,10000,10000,10000,
                                10000,10000,10000}},
                           1}]},
                     #Ref<0.0.113.112114>,2,262144,
                     #Fun<rabbit_variable_queue.2.91259159>,
                     {0,nil}},
                 {{client_msstate,msg_store_persistent,
                      <<45,226,10,206,192,135,238,119,205,177,43,46,24,159,170,
                        52>>,
                      {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                      {state,311369,

"/var/lib/rabbitmq/mnesia/s-rabbit1/msg_store_persistent"},

                      rabbit_msg_store_ets_index,
                      "/var/lib/rabbitmq/mnesia/s-rabbit1/msg_store_persistent",
                      <0.246.0>,315466,307272,319563,323660},
                  {client_msstate,msg_store_transient,
                      <<172,50,239,59,161,4,42,98,116,42,171,120,108,181,1,76>>,

                      {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                      {state,290884,

"/var/lib/rabbitmq/mnesia/s-rabbit1/msg_store_transient"},

                      rabbit_msg_store_ets_index,
                      "/var/lib/rabbitmq/mnesia/s-rabbit1/msg_store_transient",
                      <0.241.0>,294981,286787,299078,303175}},
                 true,0,#Fun<rabbit_mirror_queue_slave.3.29941254>,0,1,
                 infinity,0,0,0,0,0,
                 {rates,
                     {{1341,329623,60054},2},
                     {{1341,329623,60054},2},
                     1.8427213725389851e-4,1.8427213725389851e-4,
                     {1341,340467,310020}},
                 {0,nil},
                 {0,nil},

                 {0,nil},
                 {0,nil},
                 0,0,
                 {rates,

                     {{1341,329623,60054},0},
                     {{1341,329623,60054},2},
                     0.0,1.8427213725389851e-4,

                     {1341,340467,310020}}}]},
        {rabbit_mirror_queue_slave,process_instruction,2},
        {rabbit_mirror_queue_slave,handle_cast,2},
        {gen_server2,handle_msg,2},
        {proc_lib,wake_up,3}]}



-- 
Brian K. Jones
My Blog          http://www.protocolostomy.com
Follow me      http://twitter.com/bkjones
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120706/174e2b49/attachment.htm>

From matthias at rabbitmq.com  Fri Jul  6 16:04:58 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 06 Jul 2012 16:04:58 +0100
Subject: [rabbitmq-discuss] Queue disappears after basic reject
 operation from client?
In-Reply-To: <CAM=1cjk7Zn6qhtro_qjDbQTcdubo5Hv=qv=xEE5z4W2xFDFUWg@mail.gmail.com>
References: <CAM=1cjk7Zn6qhtro_qjDbQTcdubo5Hv=qv=xEE5z4W2xFDFUWg@mail.gmail.com>
Message-ID: <4FF6FE9A.9030505@rabbitmq.com>

Brian,

On 06/07/12 15:52, Brian Jones wrote:
> We're running RabbitMQ/Erlang == 2.8.1 / R14A
> [...]
> ** {function_clause,
>         [{rabbit_variable_queue,fold,
>              ["\b",undefined,
>               {vqstate,

That bug got fixed in 2.8.2. Please upgrade to the latest rabbit version 
(2.8.4).

Matthias.

From meetprashanth437 at gmail.com  Fri Jul  6 18:07:59 2012
From: meetprashanth437 at gmail.com (Prashanth M)
Date: Fri, 6 Jul 2012 13:07:59 -0400
Subject: [rabbitmq-discuss] How do i stop the erlang node but keep the
	rabbitmq server running.
Message-ID: <CAE8G+ySK_X5eZUK5kdXNu+EG5aDFJPtAg96G9=xy6Hm8L3nEnw@mail.gmail.com>

Hello all,

I am trying to stop the erlang node but keep the rabbitmq server running.

or

I am trying to use rabbitmq with stomp. I want to test the clustering, is
there a good way / test case to test it.
I am using two nodes, one disc and other ram. In the server code of ram
node, i am addressing the disc node to create a new queue( is this correct)
I want to stop a node and check see how clustering works.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120706/458ec469/attachment.htm>

From tim at rabbitmq.com  Fri Jul  6 18:16:25 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 06 Jul 2012 18:16:25 +0100
Subject: [rabbitmq-discuss] How do i stop the erlang node but keep the
 rabbitmq server running.
In-Reply-To: <CAE8G+ySK_X5eZUK5kdXNu+EG5aDFJPtAg96G9=xy6Hm8L3nEnw@mail.gmail.com>
References: <CAE8G+ySK_X5eZUK5kdXNu+EG5aDFJPtAg96G9=xy6Hm8L3nEnw@mail.gmail.com>
Message-ID: <4FF71D69.9080000@rabbitmq.com>

Hi Prashanth,

On 06/07/2012 18:07, Prashanth M wrote:
> Hello all,
>
> I am trying to stop the erlang node but keep the rabbitmq server running.
>

That doesn't make any sense - rabbit is written in Erlang, so stopping 
the Erlang node implies stopping rabbit.

> or
>
> I am trying to use rabbitmq with stomp. I want to test the clustering,
> is there a good way / test case to test it.
> I am using two nodes, one disc and other ram. In the server code of ram
> node, i am addressing the disc node to create a new queue( is this correct)
> I want to stop a node and check see how clustering works.
>

Stopping a node requires stopping the rabbit application. We do some 
clustering tests ourselves, so perhaps we can assist you with this. What 
exactly does your test scenario look like? What do you need to prove to 
yourself?

Tim

From francesco at rabbitmq.com  Fri Jul  6 18:27:32 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 06 Jul 2012 18:27:32 +0100
Subject: [rabbitmq-discuss] Forward: Re: Disconnecting vs failure of a disk
	node and reconnecting a new one...?
References: <5adadd84-8605-4f47-9557-81ca0e871516@googlegroups.com>
	<87r4soby3p.wl%francesco@rabbitmq.com>
Message-ID: <87pq88by0r.wl%francesco@rabbitmq.com>

And of course I did not notice the Google groups address.

-------------- next part --------------
An embedded message was scrubbed...
From: Francesco Mazzoli <francesco at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Disconnecting vs failure of a disk node and reconnecting a new one...?
Date: Fri, 06 Jul 2012 18:25:45 +0100
Size: 3150
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120706/405acb9e/attachment.eml>

From tim at rabbitmq.com  Fri Jul  6 18:34:07 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 06 Jul 2012 18:34:07 +0100
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>
Message-ID: <4FF7218F.3090105@rabbitmq.com>

Hi there,

On 06/07/2012 06:53, ?? wrote:
> Hi all,
>
> I installed RabbotMQ & tried to start it.
>
> But I always got error as following:
>

Ok so first of all, let's see if we can get you to start a stand alone 
distributed Erlang node successfully. Normally stack traces like that 
occur when the host environment isn't set up quite right (from Erlang's 
perspective).

We need to be able to run `erl -sname rabbit` on the command line and 
see the Erlang emulator start successfully. It should look something 
like this:

##############

t4 at malachi:systest $ erl -sname rabbit
Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:2:2] [async-threads:0] 
[hipe] [kernel-poll:false]

Eshell V5.9.1  (abort with ^G)
(rabbit at malachi)1>

##############

Can you start Erlang like that successfully? I'm assuming not, but 
please let us know.

I'm also interested in understanding what your hosts configuration 
(e.g., /etc/hosts) looks like. On some Operating Systems (such as CentOS 
for example), failing to set an explicit host name prevents you from 
starting a distributed Erlang node.

> {error_logger,{{2012,7,6},{13,32,21}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,"inet_tcp_dist.erl"},{line,70}]},{net_kernel,start_protos,4,[{file,"net_kernel.erl"},{line,1314}]},{net_kernel,start_protos,3,[{file,"net_kernel.erl"},{line,1307}]},{net_kernel,init_node,2,[{file,"net_kernel.erl"},{line,1197}]},{net_kernel,init,1,[{file,"net_kernel.erl"},{line,357}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}]}
> {error_logger,{{2012,7,6},{13,32,21}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancest
> ors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.90>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,551}],[]]}
> {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch1077,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2012,7,6},{13,32,21}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kern el pid
> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>
>
> I ran it on a server with public IP 183.*.*.* .
>
> In Erlang src, I found that epmd checks connection src.
>
>        /* Determine if connection is from localhost */
>        if (getpeername(s->fd,(struct sockaddr*) &si,&st) ||
>            st < sizeof(si)) {
>            /* Failure to get peername is regarded as non local host */
>            s->local_peer = EPMD_FALSE;
>        } else {
>            /* Only 127.x.x.x and connections from the host's IP address
>               allowed, no false positives */
>            s->local_peer =
> (((((unsigned) ntohl(si.sin_addr.s_addr)) & 0xFF000000U) ==
>                 0x7F000000U) ||
> (getsockname(s->fd,(struct sockaddr*) &di,&st) ?
>                 EPMD_FALSE : si.sin_addr.s_addr == di.s in_addr.s_addr));
>        }
>        dbg_tty_printf(g,2,(s->local_peer) ? "Local peer connected" :
>                       "Non-local peer connected");
>
>
> But unfortunately, si.sin_addr.s_addr was 183.*.*.*, while
> di.sin_addr.s_addr was 127.0.0.1
>
> My log?Checking peer address, getsockname ret: 0, si_addr=0xb7??????,
> di_addr=0x7f000001
>
>

I could be wrong, but I suspect this is a red herring. You can restart 
epmd with -d to get debugging information as well, but I suspect this 
isn't relevant.

Is there any way to force RabbitMQ server connect epmd via a specified
> address?
>

I'm not really sure what you mean by this, but I'm fairly confident that 
it is not necessary to even attempt to do something like that. Erlang 
should be able to start up nodes with `-sname <name>` or `-name 
<name>@<host>` and if either doesn't work, a little tweaking of the host 
configuration should solve it.

Based on your original comment (starting rabbitmq but always getting an 
error) my understanding is that you're trying to start rabbit on this 
machine and it fails. AFAIK when a distributed Erlang node connects to 
EPMD on the localhost it should be treated as such. The rabbitmq-server 
script starts rabbit up with `-sname rabbit` which implies that the node 
name will be rabbit@<hostname> so you should make sure that `erl -sname 
rabbit` works first of all.

From tim at rabbitmq.com  Fri Jul  6 19:00:52 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 06 Jul 2012 19:00:52 +0100
Subject: [rabbitmq-discuss] Fwd: Re: How do i stop the erlang node but keep
 the rabbitmq server running.
In-Reply-To: <4FF727A7.7090002@rabbitmq.com>
References: <4FF727A7.7090002@rabbitmq.com>
Message-ID: <4FF727D4.1010502@rabbitmq.com>

Oh the irony - I forgot to cc the list. LMAO. :/


-------- Original Message --------
Subject: Re: [rabbitmq-discuss] How do i stop the erlang node but keep 
the rabbitmq server running.
Date: Fri, 06 Jul 2012 19:00:07 +0100
From: Tim Watson <tim at rabbitmq.com>
Organization: vmware
To: Prashanth M <meetprashanth437 at gmail.com>

Hi Prashanth,

This is a mailing list, so please keep your replies on-list. Thanks.

On 06/07/2012 18:36, Prashanth M wrote:
> Hi Tim,
>
> I am trying to see how clustering works. Esp. how it works when a
> running node goes down. As said before I have two nodes a disc and a ram
> node. Both are running. In the server code of ram node, I point to the
> rabbitmq server on disk node and creating queues ( or do i need to point
> it to the rabbitmq server on that machine itself).
>

Uhm, I'd suggest reading through the clustering guide as a first step:
http://www.rabbitmq.com/clustering.html.

You should also take note of
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021078.html
- you need to read the attachment (to that post) in particular.



From tim at rabbitmq.com  Fri Jul  6 19:06:11 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 06 Jul 2012 19:06:11 +0100
Subject: [rabbitmq-discuss] How do i stop the erlang node but keep the
 rabbitmq server running.
In-Reply-To: <CAE8G+yTw8isuNOLW5EW58tsFj0swA6AxVMd199pPTa8A_-MYzg@mail.gmail.com>
References: <CAE8G+ySK_X5eZUK5kdXNu+EG5aDFJPtAg96G9=xy6Hm8L3nEnw@mail.gmail.com>
	<4FF71D69.9080000@rabbitmq.com>
	<CAE8G+yQWAVbrsMMxh9LxLUgjtpzGjAReJr9_Fo1cM_2is5h4dw@mail.gmail.com>
	<CAE8G+yTw8isuNOLW5EW58tsFj0swA6AxVMd199pPTa8A_-MYzg@mail.gmail.com>
Message-ID: <4FF72913.7060804@rabbitmq.com>

Hi Prashanth,

Please keep replies on list, as I mentioned earlier (just before 
forgetting to do some myself!). :)		

On 06/07/2012 18:38, Prashanth M wrote:
> correct me if i am wrong. We proved the reliability of rabbitmq, we are
> planning to prove how clustering works out of box.
>

Ok that's fine, but *what* about clustering do you need to prove for 
your architecture? Are you wanting to know what happens if you've got 
two nodes and one goes down? The idea is that all the relevant parts 
that should be present on all nodes, should survive a crash. As the list 
entry I referred you to in my previous mail states, you've got to be 
careful when using ram nodes, as you *can* get yourself into a situation 
where data loss is *possible* under those circumstances.

Please read the clustering guide in detail and then feel free to come 
back ask any questions. If you want to stop rabbit on a node, without 
stopping the node itself, you'd use `rabbitmqctl stop_app` or 
`rabbitmqctl stop` to stop the rabbit application *and* the node.

Tim

From kot.begemot at gmail.com  Fri Jul  6 19:25:44 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Fri, 6 Jul 2012 11:25:44 -0700
Subject: [rabbitmq-discuss] .net client: memory problem follow up
Message-ID: <CAFWGgNEDfwYxwxb+NB6d-ADEgpOxqMq8sQQW+oYtfsG6C3QP5g@mail.gmail.com>

Hi all,

I've reported .net client bug some time ago: ".Net client: out of
memory when garbage on the wire"
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-April/019727.html

It has been addresses in mercurial repo as bug #24907 (hash
26aec7e2af4aabd98baf00edd5ca911a173f2df7) and merged into "junk"
branch but seems it never made it to the "default" branch and never
has been released. Did it fell through the crack or there are some
problems with the fix preventing releasing it?

Thanks,
Vadim.

--

From matthias at rabbitmq.com  Fri Jul  6 20:02:00 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 06 Jul 2012 20:02:00 +0100
Subject: [rabbitmq-discuss] .net client: memory problem follow up
In-Reply-To: <CAFWGgNEDfwYxwxb+NB6d-ADEgpOxqMq8sQQW+oYtfsG6C3QP5g@mail.gmail.com>
References: <CAFWGgNEDfwYxwxb+NB6d-ADEgpOxqMq8sQQW+oYtfsG6C3QP5g@mail.gmail.com>
Message-ID: <4FF73628.1060905@rabbitmq.com>

Vadim,

On 06/07/12 19:25, Vadim Chekan wrote:
> I've reported .net client bug some time ago: ".Net client: out of
> memory when garbage on the wire"
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-April/019727.html
>
> It has been addresses in mercurial repo as bug #24907 (hash
> 26aec7e2af4aabd98baf00edd5ca911a173f2df7) and merged into "junk"
> branch but seems it never made it to the "default" branch and never
> has been released. Did it fell through the crack or there are some
> problems with the fix preventing releasing it?

Our first take wasn't satisfactory (hence the junking), so this issue is 
still on our todo list.

Matthias.

From kot.begemot at gmail.com  Fri Jul  6 20:23:37 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Fri, 6 Jul 2012 12:23:37 -0700
Subject: [rabbitmq-discuss] .net: why main loop is not a background thread?
Message-ID: <CAFWGgNHe7z5=p2kcBwCJSjxFqCvg_7GL7c9R97Epv8xp2_Y9MQ@mail.gmail.com>

Rabbitmq .net client creates a main loop thread but it does not
specify thread's property IsBackground=true. As result, by default
this thread is foreground thread and if connection have not been
closed, it will prevent application from quit and application will
hang.
Are there any reasons why main loop thread can not be set to be background?

Thanks,
Vadim.

-- 

From naveen.chwl at gmail.com  Fri Jul  6 22:13:32 2012
From: naveen.chwl at gmail.com (Navigateur)
Date: Fri, 6 Jul 2012 14:13:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Disconnecting vs failure of a disk node and
 reconnecting a new one...?
In-Reply-To: <5adadd84-8605-4f47-9557-81ca0e871516@googlegroups.com>
References: <5adadd84-8605-4f47-9557-81ca0e871516@googlegroups.com>
Message-ID: <f56ec04d-ac76-410d-96a0-ff0171511639@googlegroups.com>

Hi Francesco, thanks for your answer (howcome it isn't showing up in this 
google group)? Can you give me an example of a durable resource 
creation/deletion operation that would benefit from a RAM node (so that I 
know what that means)? If I do have a lot of these, then would I benefit 
from using the 3rd (non-wep-app) machine as a RAM node, along with the 2 
(relevant web app containing) disc nodes? Also, how do I approximately 
calculate the maximum disk space the disc nodes may possibly need in the 
very worst case scenario, say when there are 1 Mb/s of messages?

On 6 July 2012 18:25, Francesco Mazzoli wrote:
> Hi Navigateur,
> At Thu, 5 Jul 2012 05:57:57 -0700 (PDT),
> Navigateur  wrote:
>> New to RabbitMQ. I want do to high-availability over 2 machines. Do I 
make
>> them both disk nodes or just 1?
>
> Having only one disc node in a cluster deprives you of the nicest 
characteristic
> of a cluster: you can be sure that if one database state gets corrupted 
for some
> reason, you still have the other one. This is even more relevant when 
using HA
> queues, which is what you want to do.
>
> Having only a RAM node online is a situation that you should avoid - 
losing data
> is really easy in that position.
>
>> If just 1, but its disk fails, does the other one automatically become a 
"disk
>> node"?
>
> No.
>
>> If not, and I replace the failed-disk machine with a brand new machine 
with
>> the same name (e.g. rabbit at server1) and simply instruct it to join the 
cluster
>> - will everything continue to work as if nothing happened?
>
> Yes, that should work.
>
>> If I can't, then 2 disk nodes is the better solution, yes? And if I did 
that,
>> is recovering from an abrupt failure of 1 of the machines simply to 
replace
>> that machine, give it the same name (e.g. rabbit at server1) and call the
>> rabbitmqctl cluster command? Is that all I would have to do?
>
> Again, that should be OK.
>
>> I also have a 3rd machine running, which doesn't have any local web app
>> software which creates or listens for any RabbitMQ messages. Would I 
benefit
>> from using that as an additional (3rd) RabbitMQ node still? For example, 
the
>> 3rd non-web-app machine as a disk node, and the 2 web-app-clustered 
(which
>> load-balance) machines as RAM nodes? And maybe have a RAID disk in the 
3rd
>> non-web-app machine. Is this the best solution of all? Last question, 
how do I
>> recover after explicitly removing a disk node (i.e. not through disk 
failure,
>> this in addition do the disk-failure question)?
>
> See my reply at the top of this message. In general you'd want to measure 
if RAM
> nodes give you a real benefit and consider them once you established 
that. RAM
> nodes do (durable) resource creation/deletion faster, so if you are using 
those
> operation intensively you might get something out of RAM nodes. 
Everything else
> is not affected - persistent queue still persist, and transient 
operations are
> transient on disc nodes too.
>
> --
> Francesco * Often in error, never in doubt

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120706/a7b153a1/attachment.htm>

From fabio.bat.silva at gmail.com  Fri Jul  6 22:54:29 2012
From: fabio.bat.silva at gmail.com (Fabio B. Silva)
Date: Fri, 6 Jul 2012 14:54:29 -0700 (PDT)
Subject: [rabbitmq-discuss] big messages
Message-ID: <88d2eefe-cecc-4b89-9887-e7443d952807@googlegroups.com>

Hi guys

i'm doing a study for my company.
we are thinking about use rabbitmq to transfer big messages..  (between 1MB 
and 2 MB)
Is there any restriction with big messages ?


Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120706/f9fdec22/attachment.htm>

From ekirpichov at gmail.com  Fri Jul  6 23:05:32 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 6 Jul 2012 15:05:32 -0700
Subject: [rabbitmq-discuss] big messages
In-Reply-To: <88d2eefe-cecc-4b89-9887-e7443d952807@googlegroups.com>
References: <88d2eefe-cecc-4b89-9887-e7443d952807@googlegroups.com>
Message-ID: <2B92CFBC-4A33-478D-9662-C47FB1D61B39@gmail.com>

Worked fine in my experience. Though you should be careful not to exhaust RAM and overload the server by stressing it too much with such big messages. What's the expected throughput?



06.07.2012, ? 14:54, "Fabio B. Silva" <fabio.bat.silva at gmail.com> ???????(?):

> Hi guys
> 
> i'm doing a study for my company.
> we are thinking about use rabbitmq to transfer big messages..  (between 1MB and 2 MB)
> Is there any restriction with big messages ?
> 
> 
> Thanks
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Fri Jul  6 23:17:37 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 06 Jul 2012 23:17:37 +0100
Subject: [rabbitmq-discuss] My cluter node (ram node) down in my
 performance test
In-Reply-To: <CABjKUK-8Gx_4Rt4Uu=VDg5-iXAHQ7HNUB=b8toeeCSdjBaO_zg@mail.gmail.com>
References: <CABjKUK9j23ia9foMSDUTBXa+y6-ypF86d6Wzy9PZr=dAkxG-7Q@mail.gmail.com>
	<4FF6F10F.6080107@rabbitmq.com>
	<CABjKUK_Bfdo=Au1CR440YcEWkB6vTts-Le6G1HVYo7QqRXrWhA@mail.gmail.com>
	<CABjKUK-8Gx_4Rt4Uu=VDg5-iXAHQ7HNUB=b8toeeCSdjBaO_zg@mail.gmail.com>
Message-ID: <4FF76401.1020900@rabbitmq.com>

Thiago,

On 06/07/12 22:18, Thiago Burgo Belo wrote:
> Server down again, see logs in attachement.

Thanks. You appear to have included the logs for the disk node twice 
whereas the logs for the ram node are missing. Do you have the latter?

I see your queues are durable and have an x-ha policy of 'all'. That's 
good to know since I was struggling to see how the errors shown in the 
logs could possibly occur for non-ha queues.

Btw, unrelated to the errors, I see the queues have an 'x-match' 
argument. That doesn't do anything; it should go into the binding.

Regards,

Matthias.

From fabio.bat.silva at gmail.com  Fri Jul  6 23:28:17 2012
From: fabio.bat.silva at gmail.com (Fabio B. Silva)
Date: Fri, 6 Jul 2012 19:28:17 -0300
Subject: [rabbitmq-discuss] big messages
In-Reply-To: <2B92CFBC-4A33-478D-9662-C47FB1D61B39@gmail.com>
References: <88d2eefe-cecc-4b89-9887-e7443d952807@googlegroups.com>
	<2B92CFBC-4A33-478D-9662-C47FB1D61B39@gmail.com>
Message-ID: <CAB1oaS5+JA98HCa1SqupwJJfAo3-Wp9d2OKLsaHKXt0vwsj6Kw@mail.gmail.com>

Thanks for answer Eugene..

Our expected trafic are about 25 queues and 200 messages between 1MB
and 2MB for each queue.

The RAM exactly is the point for us on the tests.
When we shutdown the consumer and keep producing messages the RAM is
exhausted..
This is a extreme case when happens some comunication problem.

Is there any way to avoid the server overload ?


Thanks



2012/7/6 Eugene Kirpichov <ekirpichov at gmail.com>:
> Worked fine in my experience. Though you should be careful not to exhaust RAM and overload the server by stressing it too much with such big messages. What's the expected throughput?
>
>
>
> 06.07.2012, ? 14:54, "Fabio B. Silva" <fabio.bat.silva at gmail.com> ???????(?):
>
>> Hi guys
>>
>> i'm doing a study for my company.
>> we are thinking about use rabbitmq to transfer big messages..  (between 1MB and 2 MB)
>> Is there any restriction with big messages ?
>>
>>
>> Thanks
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
Att: F?bio B. Silva

From ekirpichov at gmail.com  Fri Jul  6 23:38:24 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 6 Jul 2012 15:38:24 -0700
Subject: [rabbitmq-discuss] big messages
In-Reply-To: <CAB1oaS5+JA98HCa1SqupwJJfAo3-Wp9d2OKLsaHKXt0vwsj6Kw@mail.gmail.com>
References: <88d2eefe-cecc-4b89-9887-e7443d952807@googlegroups.com>
	<2B92CFBC-4A33-478D-9662-C47FB1D61B39@gmail.com>
	<CAB1oaS5+JA98HCa1SqupwJJfAo3-Wp9d2OKLsaHKXt0vwsj6Kw@mail.gmail.com>
Message-ID: <CANVKUrXtXyp+twC-2idFOfCNUsAe6Jr+-LtSZhLyvL3VuJUZWg@mail.gmail.com>

On Fri, Jul 6, 2012 at 3:28 PM, Fabio B. Silva
<fabio.bat.silva at gmail.com> wrote:
> Thanks for answer Eugene..
>
> Our expected trafic are about 25 queues and 200 messages between 1MB
> and 2MB for each queue.
You mean 200 messages per second?

>
> The RAM exactly is the point for us on the tests.
> When we shutdown the consumer and keep producing messages the RAM is
> exhausted..
> This is a extreme case when happens some comunication problem.
>
> Is there any way to avoid the server overload ?
You have to throttle the producer, i.e. avoid sending messages when
the server is too loaded.
A good way to do that is to use "publisher confirms".
In your server, keep track of how many of the messages you published
the server has not yet "confirmed" and do not let this number become
too large.

>
>
> Thanks
>
>
>
> 2012/7/6 Eugene Kirpichov <ekirpichov at gmail.com>:
>> Worked fine in my experience. Though you should be careful not to exhaust RAM and overload the server by stressing it too much with such big messages. What's the expected throughput?
>>
>>
>>
>> 06.07.2012, ? 14:54, "Fabio B. Silva" <fabio.bat.silva at gmail.com> ???????(?):
>>
>>> Hi guys
>>>
>>> i'm doing a study for my company.
>>> we are thinking about use rabbitmq to transfer big messages..  (between 1MB and 2 MB)
>>> Is there any restriction with big messages ?
>>>
>>>
>>> Thanks
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> --
> Att: F?bio B. Silva
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
Eugene Kirpichov
http://www.linkedin.com/in/eugenekirpichov

From fabio.bat.silva at gmail.com  Fri Jul  6 23:48:06 2012
From: fabio.bat.silva at gmail.com (Fabio B. Silva)
Date: Fri, 6 Jul 2012 19:48:06 -0300
Subject: [rabbitmq-discuss] big messages
In-Reply-To: <CANVKUrXtXyp+twC-2idFOfCNUsAe6Jr+-LtSZhLyvL3VuJUZWg@mail.gmail.com>
References: <88d2eefe-cecc-4b89-9887-e7443d952807@googlegroups.com>
	<2B92CFBC-4A33-478D-9662-C47FB1D61B39@gmail.com>
	<CAB1oaS5+JA98HCa1SqupwJJfAo3-Wp9d2OKLsaHKXt0vwsj6Kw@mail.gmail.com>
	<CANVKUrXtXyp+twC-2idFOfCNUsAe6Jr+-LtSZhLyvL3VuJUZWg@mail.gmail.com>
Message-ID: <CAB1oaS40b65PBkHrBL0=C4Exe5DxRJfHKscPq+_49QxavK7Wug@mail.gmail.com>

Thanks Eugene


About 25 queue, 200 messages between 1MB and 2MB for each queue per
day. (25 x 200 per day)
I think rabbit gonna be our choice. :)

Thanks alot for your help.
Cheers



2012/7/6 Eugene Kirpichov <ekirpichov at gmail.com>:
> On Fri, Jul 6, 2012 at 3:28 PM, Fabio B. Silva
> <fabio.bat.silva at gmail.com> wrote:
>> Thanks for answer Eugene..
>>
>> Our expected trafic are about 25 queues and 200 messages between 1MB
>> and 2MB for each queue.
> You mean 200 messages per second?
>
>>
>> The RAM exactly is the point for us on the tests.
>> When we shutdown the consumer and keep producing messages the RAM is
>> exhausted..
>> This is a extreme case when happens some comunication problem.
>>
>> Is there any way to avoid the server overload ?
> You have to throttle the producer, i.e. avoid sending messages when
> the server is too loaded.
> A good way to do that is to use "publisher confirms".
> In your server, keep track of how many of the messages you published
> the server has not yet "confirmed" and do not let this number become
> too large.
>
>>
>>
>> Thanks
>>
>>
>>
>> 2012/7/6 Eugene Kirpichov <ekirpichov at gmail.com>:
>>> Worked fine in my experience. Though you should be careful not to exhaust RAM and overload the server by stressing it too much with such big messages. What's the expected throughput?
>>>
>>>
>>>
>>> 06.07.2012, ? 14:54, "Fabio B. Silva" <fabio.bat.silva at gmail.com> ???????(?):
>>>
>>>> Hi guys
>>>>
>>>> i'm doing a study for my company.
>>>> we are thinking about use rabbitmq to transfer big messages..  (between 1MB and 2 MB)
>>>> Is there any restriction with big messages ?
>>>>
>>>>
>>>> Thanks
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>> --
>> Att: F?bio B. Silva
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> --
> Eugene Kirpichov
> http://www.linkedin.com/in/eugenekirpichov
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
Att: F?bio B. Silva

From ekirpichov at gmail.com  Sat Jul  7 01:03:36 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 6 Jul 2012 17:03:36 -0700
Subject: [rabbitmq-discuss] big messages
In-Reply-To: <CAB1oaS40b65PBkHrBL0=C4Exe5DxRJfHKscPq+_49QxavK7Wug@mail.gmail.com>
References: <88d2eefe-cecc-4b89-9887-e7443d952807@googlegroups.com>
	<2B92CFBC-4A33-478D-9662-C47FB1D61B39@gmail.com>
	<CAB1oaS5+JA98HCa1SqupwJJfAo3-Wp9d2OKLsaHKXt0vwsj6Kw@mail.gmail.com>
	<CANVKUrXtXyp+twC-2idFOfCNUsAe6Jr+-LtSZhLyvL3VuJUZWg@mail.gmail.com>
	<CAB1oaS40b65PBkHrBL0=C4Exe5DxRJfHKscPq+_49QxavK7Wug@mail.gmail.com>
Message-ID: <CANVKUrV5ERvG98XKE6pX15mOF9rP7H7SbY6adk69DFygt_x4OQ@mail.gmail.com>

Oh, 5000 per day! Then you have absolutely no problem. I guess just
about any message queue would handle this perfectly.

On Fri, Jul 6, 2012 at 3:48 PM, Fabio B. Silva
<fabio.bat.silva at gmail.com> wrote:
> Thanks Eugene
>
>
> About 25 queue, 200 messages between 1MB and 2MB for each queue per
> day. (25 x 200 per day)
> I think rabbit gonna be our choice. :)
>
> Thanks alot for your help.
> Cheers
>
>
>
> 2012/7/6 Eugene Kirpichov <ekirpichov at gmail.com>:
>> On Fri, Jul 6, 2012 at 3:28 PM, Fabio B. Silva
>> <fabio.bat.silva at gmail.com> wrote:
>>> Thanks for answer Eugene..
>>>
>>> Our expected trafic are about 25 queues and 200 messages between 1MB
>>> and 2MB for each queue.
>> You mean 200 messages per second?
>>
>>>
>>> The RAM exactly is the point for us on the tests.
>>> When we shutdown the consumer and keep producing messages the RAM is
>>> exhausted..
>>> This is a extreme case when happens some comunication problem.
>>>
>>> Is there any way to avoid the server overload ?
>> You have to throttle the producer, i.e. avoid sending messages when
>> the server is too loaded.
>> A good way to do that is to use "publisher confirms".
>> In your server, keep track of how many of the messages you published
>> the server has not yet "confirmed" and do not let this number become
>> too large.
>>
>>>
>>>
>>> Thanks
>>>
>>>
>>>
>>> 2012/7/6 Eugene Kirpichov <ekirpichov at gmail.com>:
>>>> Worked fine in my experience. Though you should be careful not to exhaust RAM and overload the server by stressing it too much with such big messages. What's the expected throughput?
>>>>
>>>>
>>>>
>>>> 06.07.2012, ? 14:54, "Fabio B. Silva" <fabio.bat.silva at gmail.com> ???????(?):
>>>>
>>>>> Hi guys
>>>>>
>>>>> i'm doing a study for my company.
>>>>> we are thinking about use rabbitmq to transfer big messages..  (between 1MB and 2 MB)
>>>>> Is there any restriction with big messages ?
>>>>>
>>>>>
>>>>> Thanks
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>>
>>> --
>>> Att: F?bio B. Silva
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>> --
>> Eugene Kirpichov
>> http://www.linkedin.com/in/eugenekirpichov
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> --
> Att: F?bio B. Silva
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
Eugene Kirpichov
http://www.linkedin.com/in/eugenekirpichov

From naveen.chwl at gmail.com  Sat Jul  7 11:55:16 2012
From: naveen.chwl at gmail.com (Navigateur)
Date: Sat, 7 Jul 2012 03:55:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Can't cluster 2 computers - "distribution port"
 changes on restart - how do I fix it to a certain port?
Message-ID: <fc73231c-36f9-4232-86d9-d511aa35a5fb@googlegroups.com>

Have a firewall so I need to pin the "distribution port" to a certain 
number (RabbitMQ changes it on restart). How do I do this in the latest 
version of RabbitMQ 2.7.1 and on Ubuntu Server (12.04)? Couldn't find the 
file which has the "SERVER_ERL_ARGS" setting specified. Brand new install 
of RabbitMQ.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120707/9674b6d7/attachment.htm>

From francesco at rabbitmq.com  Sat Jul  7 12:22:33 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Sat, 07 Jul 2012 12:22:33 +0100
Subject: [rabbitmq-discuss] Disconnecting vs failure of a disk node and
	reconnecting a new one...?
In-Reply-To: <f56ec04d-ac76-410d-96a0-ff0171511639@googlegroups.com>
References: <5adadd84-8605-4f47-9557-81ca0e871516@googlegroups.com>
	<f56ec04d-ac76-410d-96a0-ff0171511639@googlegroups.com>
Message-ID: <87wr2fbyti.wl%francesco@rabbitmq.com>

Hi Navigateur,
At Fri, 6 Jul 2012 14:13:32 -0700 (PDT),
Navigateur  wrote:
> Hi Francesco, thanks for your answer (howcome it isn't showing up in this
> google group)?

Sadly Google groups does not do 2-way mirroring of mailing lists - you can't
reply to the Google groups address. We advise to avoid the Google groups
interface anyway, since it is unreliable and outside our control.

> Can you give me an example of a durable resource creation/deletion operation
> that would benefit from a RAM node (so that I know what that means)?

Creating a queue/exchange/queue binding/vhost, stuff like that.

> If I do have a lot of these, then would I benefit from using the 3rd
> (non-wep-app) machine as a RAM node, along with the 2 (relevant web app
> containing) disc nodes?

I really can't predict this (and I don't have much experience in the difference
of performance between RAM and disc). The only reliable way for you to know is
to set up a test environment and measure.

> Also, how do I approximately calculate the maximum disk space the disc nodes
> may possibly need in the very worst case scenario, say when there are 1 Mb/s
> of messages?

I'm not sure what you are asking here - the maximum disc space needed will be
roughly the size of the messages that are being persisted. The maximum *number*
(not size) of messages that can be persisted is tied to memory anyway - there is
a 160 bytes overhead for each message persisted, which gives you > 26 million
messages with 4GB in memory. If that's not good enough, you can get around that
by using the `toke' plugin, which uses tokyocabinet as a message store.

Just to throw some additional information in that you might need, the
`vm_memory_high_watermark' and `disc_free_limit' environmental variables
regulate respectively the limit after which messages start to be persisted to
disc, and the amount of disc space that rabbit can use before starting to block
producers connections. See http://www.rabbitmq.com/configure.html for more info
on configuring rabbit.

--
Francesco * Often in error, never in doubt

From garland.binns at gmail.com  Sat Jul  7 18:10:10 2012
From: garland.binns at gmail.com (Garland W. Binns)
Date: Sat, 7 Jul 2012 11:10:10 -0600
Subject: [rabbitmq-discuss] Ubuntu 10.04: Unable to Start RabbitMQ Server
	Post-Installation
Message-ID: <ED48D7C450D2440283323954A86FD9D9@gmail.com>

After installing RabbitMQ on Ubuntu 10.04 I receive a failure message that the service was unable to start. Any insight into the issue would be greatly appreciated! Below are contents of startup_log and startup_err. 

Startup_log:

{error_logger,{{2012,7,7},{15,50,31}},"Protocol: ~p: register error: ~p~n",["inet_tcp",{{badmatch,{error,etimedout}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
{error_logger,{{2012,7,7},{15,50,31}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.100>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,512}],[]]}
{error_logger,{{2012,7,7},{15,50,31}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbitmqprelaunch877,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2012,7,7},{15,50,31}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2012,7,7},{15,50,31}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}



Startup_err:
Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})




--
Sent via Mobile






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120707/dbb63c7f/attachment.htm>

From videlalvaro at gmail.com  Sat Jul  7 19:04:25 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 7 Jul 2012 20:04:25 +0200
Subject: [rabbitmq-discuss] Ubuntu 10.04: Unable to Start RabbitMQ
	Server Post-Installation
In-Reply-To: <ED48D7C450D2440283323954A86FD9D9@gmail.com>
References: <ED48D7C450D2440283323954A86FD9D9@gmail.com>
Message-ID: <6FEE440F-ADDD-426C-9459-0020969FAD08@gmail.com>

Hi, 

You should check that there's no other broker running on port 5672

I think that is what this error means. You probably have a service already listening on that port

To RabbitMQ devs:

If this is the case, is it possible to catch that error and return something more meaningful to the non Erlang user?

Regards,

-Alvaro

Sent from my iPhone

On Jul 7, 2012, at 7:10 PM, "Garland W. Binns" <garland.binns at gmail.com> wrote:

> After installing RabbitMQ on Ubuntu 10.04 I receive a failure message that the service was unable to start. Any insight into the issue would be greatly appreciated! Below are contents of startup_log and startup_err.
> 
> Startup_log:
> 
> {error_logger,{{2012,7,7},{15,50,31}},"Protocol: ~p: register error: ~p~n",["inet_tcp",{{badmatch,{error,etimedout}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
> {error_logger,{{2012,7,7},{15,50,31}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.100>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,512}],[]]}
> {error_logger,{{2012,7,7},{15,50,31}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbitmqprelaunch877,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2012,7,7},{15,50,31}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2012,7,7},{15,50,31}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
> 
> Startup_err:
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller) ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> 
> --
> Sent via Mobile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120707/1e587474/attachment.htm>

From ask at celeryproject.org  Sat Jul  7 19:24:54 2012
From: ask at celeryproject.org (Ask Solem)
Date: Sat, 7 Jul 2012 19:24:54 +0100
Subject: [rabbitmq-discuss] ANN: Celery 3.0 (chiastic slide) released!
Message-ID: <27530E40-2C1E-4148-B165-EF633D271230@celeryproject.org>

===========================================
 Celery 3.0 (Chiastic Slide) Released!
===========================================

Celery is a simple, flexible and reliable distributed system to
process vast amounts of messages, while providing operations with
the tools required to maintain such a system.

It's a task queue with focus on real-time processing, while also
supporting task scheduling.

Celery has a large and diverse community of users and contributors,
you should come join us on IRC (freenode.net: #celery)
or our mailing-list (http://groups.google.com/group/celery-users).

To read more about Celery you should go read the introduction:
  - http://docs.celeryproject.org/en/latest/getting-started/introduction.html

If you use Celery in combination with Django you must also
read the django-celery changelog and upgrade to django-celery 3.0
  - http://github.com/celery/django-celery/tree/master/Changelog

This version is officially supported on CPython 2.5, 2.6, 2.7, 3.2 and 3.3,
as well as PyPy and Jython.

/*
You should read the full changelog which contains important notes at:

    - http://docs.celeryproject.org/en/latest/whatsnew-3.0.html
*/

Highlights
==========

- A new and improved API, that is both simpler and more powerful.

    Everyone must read the new "first-steps" tutorial,
    and the new "next-steps" tutorial

      - http://bit.ly/celery-first-steps
      - http://bit.ly/celery-next-steps

    Oh, and why not reread the user guide while you're at it :)

    There are no current plans to deprecate the old API,
    so you don't have to be in a hurry to port your applications.

- The worker is now thread-less, giving great performance improvements.

- The new "Canvas" makes it easy to define complex workflows.

    Ever wanted to chain tasks together? This is possible, but
    not just that, now you can even chain together groups and chords,
    or even combine multiple chains.

    Read more in the Canvas user guide:
      - http://docs.celeryproject.org/en/latest/userguide/canvas.html

- All of Celery's command line programs are now available from a single
    umbrella command: ``celery``.

- This is the last version to support Python 2.5.

    Starting with Celery 3.1, Python 2.6 or later is required.

- Support for the new librabbitmq C client.

    Celery will automatically use the librabbitmq module
    if installed, which is a very fast and memory-optimized
    replacement for the amqplib module.

- Redis support is more reliable with improved ack emulation.

- Celery now always uses UTC

- Over 600 commits, 30k additions/36k deletions.

    In comparison 1.0 to 2.0 had 18k additions/8k deletions.

Thank you to all users and contributors!

- http://celeryproject.org/



-- 
Ask Solem
twitter.com/asksol | +44 (0)7713357179

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120707/b08fcead/attachment.pgp>

From francesco at rabbitmq.com  Sat Jul  7 19:28:33 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Sat, 07 Jul 2012 19:28:33 +0100
Subject: [rabbitmq-discuss] Ubuntu 10.04: Unable to Start
	RabbitMQ	Server Post-Installation
In-Reply-To: <6FEE440F-ADDD-426C-9459-0020969FAD08@gmail.com>
References: <ED48D7C450D2440283323954A86FD9D9@gmail.com>
	<6FEE440F-ADDD-426C-9459-0020969FAD08@gmail.com>
Message-ID: <87r4snwhm6.wl%francesco@rabbitmq.com>

At Sat, 7 Jul 2012 20:04:25 +0200,
Alvaro Videla wrote:
> You should check that there's no other broker running on port 5672
> 
> I think that is what this error means. You probably have a service already
> listening on that port

I'm not sure what the OP problem is, but rabbit does print a better error
message in that case:


BOOT FAILED
===========

Error description:
   {could_not_start_tcp_listener,{"::",5672}}

Log files (may contain more information):
   /tmp/foo.log
   /tmp/foo-sasl.log

Stack trace:
   [{rabbit_networking,start_listener0,4,[]},
    {rabbit_networking,'-start_listener/4-lc$^0/1-0-',4,[]},
    {rabbit_networking,start_listener,4,[]},
    {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1,[]},
    {rabbit_networking,boot_tcp,0,[]},
    {rabbit_networking,boot,0,[]},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
    {rabbit,run_boot_step,1,[]}]


So unless this was different in older versions (and if the OP installed the
version that comes with Ubuntu 10.04, the version will be old), this is not the
problem. In any case, this is not the current behaviour.

--
Francesco * Often in error, never in doubt

From matthias at rabbitmq.com  Sat Jul  7 19:40:21 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 07 Jul 2012 19:40:21 +0100
Subject: [rabbitmq-discuss] Ubuntu 10.04: Unable to Start
 RabbitMQ	Server Post-Installation
In-Reply-To: <87r4snwhm6.wl%francesco@rabbitmq.com>
References: <ED48D7C450D2440283323954A86FD9D9@gmail.com>
	<6FEE440F-ADDD-426C-9459-0020969FAD08@gmail.com>
	<87r4snwhm6.wl%francesco@rabbitmq.com>
Message-ID: <4FF88295.60006@rabbitmq.com>

On 07/07/12 19:28, Francesco Mazzoli wrote:
> At Sat, 7 Jul 2012 20:04:25 +0200,
> Alvaro Videla wrote:
>> You should check that there's no other broker running on port 5672
>>
>> I think that is what this error means. You probably have a service already
>> listening on that port
>
> I'm not sure what the OP problem is, but rabbit does print a better error
> message in that case:

...and also in the case where there are problems starting Erlang's 
distribution protocol, which is what is happening here.

> So unless this was different in older versions (and if the OP installed the
> version that comes with Ubuntu 10.04, the version will be old),

This definitely looks like an old version of rabbit.

Though I suspect a newer rabbit would fail to start too, just with a 
prettier error message.

I suspect the underlying problem is DNS resolution of the machine's 
hostname timing out.


Matthias.

From videlalvaro at gmail.com  Sat Jul  7 20:23:45 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 7 Jul 2012 21:23:45 +0200
Subject: [rabbitmq-discuss] Ubuntu 10.04: Unable to Start
	RabbitMQ	Server Post-Installation
In-Reply-To: <4FF88295.60006@rabbitmq.com>
References: <ED48D7C450D2440283323954A86FD9D9@gmail.com>
	<6FEE440F-ADDD-426C-9459-0020969FAD08@gmail.com>
	<87r4snwhm6.wl%francesco@rabbitmq.com>
	<4FF88295.60006@rabbitmq.com>
Message-ID: <16ED1C5D-FD07-4045-8945-ACB2986D75C9@gmail.com>

Thanks for the explanation and my apologies for confusing matters.

-Alvaro

Sent from my iPhone

On Jul 7, 2012, at 8:40 PM, Matthias Radestock <matthias at rabbitmq.com> wrote:

> On 07/07/12 19:28, Francesco Mazzoli wrote:
>> At Sat, 7 Jul 2012 20:04:25 +0200,
>> Alvaro Videla wrote:
>>> You should check that there's no other broker running on port 5672
>>> 
>>> I think that is what this error means. You probably have a service already
>>> listening on that port
>> 
>> I'm not sure what the OP problem is, but rabbit does print a better error
>> message in that case:
> 
> ...and also in the case where there are problems starting Erlang's distribution protocol, which is what is happening here.
> 
>> So unless this was different in older versions (and if the OP installed the
>> version that comes with Ubuntu 10.04, the version will be old),
> 
> This definitely looks like an old version of rabbit.
> 
> Though I suspect a newer rabbit would fail to start too, just with a prettier error message.
> 
> I suspect the underlying problem is DNS resolution of the machine's hostname timing out.
> 
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mtlotfizad at gmail.com  Sun Jul  8 10:58:39 2012
From: mtlotfizad at gmail.com (Mohsen Lotfizad)
Date: Sun, 8 Jul 2012 14:28:39 +0430
Subject: [rabbitmq-discuss] there is a Consumer connected?
In-Reply-To: <CAJzgYrBzm4dUqeYmt2oVH6cHYNq=oE0Zu7_N9Yk_EB3X5j8kaQ@mail.gmail.com>
References: <CAJzgYrBzm4dUqeYmt2oVH6cHYNq=oE0Zu7_N9Yk_EB3X5j8kaQ@mail.gmail.com>
Message-ID: <CAJzgYrDzDhbJzOUSdO6Un98TvvxPxXh014dZZa2qkbUVXeRybA@mail.gmail.com>

Hi
I have a the same question!
and for the answer of "*why do you want the producer to know if there is a
consumer around?*" I should say: I have about 50 producer and 10 consumer.
each producer producing about 500,000 message per day:) In a day it become
about 25,000,000 message! I don't want my rabbitMQ server fail because of
absence of message consumer. I want to notify my producers to wait and save
message in db until consumers are up. so because there are many producers I
can't use a passive declare like discussed in
here<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-June/020553.html>
.
Did I could clarify my problem?
Is here any controller like Producer Flow
Control<http://activemq.apache.org/producer-flow-control.html>
available?

Message: 6
Date: Mon, 11 Jun 2012 11:10:47 +0100
From: Simon MacMullen <simon at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] there is a Consumer connected?
To: Yurisleidy Hern?ndez Moya <ymoya at uci.cu>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <4FD5C427.4010402 at rabbitmq.com
>
Content-Type: text/plain; charset=UTF-8; format=flowed

On 10/06/12 21:38, Yurisleidy Hern?ndez Moya wrote:
> The Producer can know if there is a Consumer connected to the queue
> before sending the message?

To answer your question literally: yes, use the mgmt HTTP API.

To answer your question slightly less literally, the point of a
messaging system is to let producers and consumers become decoupled -
why do you want the producer to know if there is a consumer around?

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware


-- 

Sincerely
ML




-- 

Sincerely
ML
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120708/a89af202/attachment.htm>

From matthias at rabbitmq.com  Sun Jul  8 15:55:38 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 08 Jul 2012 15:55:38 +0100
Subject: [rabbitmq-discuss] there is a Consumer connected?
In-Reply-To: <CAJzgYrDzDhbJzOUSdO6Un98TvvxPxXh014dZZa2qkbUVXeRybA@mail.gmail.com>
References: <CAJzgYrBzm4dUqeYmt2oVH6cHYNq=oE0Zu7_N9Yk_EB3X5j8kaQ@mail.gmail.com>
	<CAJzgYrDzDhbJzOUSdO6Un98TvvxPxXh014dZZa2qkbUVXeRybA@mail.gmail.com>
Message-ID: <4FF99F6A.7070601@rabbitmq.com>

On 08/07/12 10:58, Mohsen Lotfizad wrote:
> I have a the same question! and for the answer of "/why do you want
> the producer to know if there is a consumer around?/" I should say: I
> have about 50 producer and 10 consumer. each producer producing about
> 500,000 message per day:) In a day it become about 25,000,000
> message! I don't want my rabbitMQ server fail because of absence of
> message consumer.

Rabbit won't fail when you stuff it full of messages. It will block 
producers when it runs out of ram/disk space. See 
http://www.rabbitmq.com/memory.html

> because there are many producers I can't use a passive declare like
> discussed in here.

Why not? 50 producers is not a lot; each producer could happily do a 
passive declare of the queue(s) every minute w/o any measurable impact 
on performance.

This does require producers to know what queues their messages may get 
routed to, and also gets problematic when you have thousands of queues. 
But it doesn't look like these concerns apply to your set up.

> Is here any controller like Producer Flow Control
> <http://activemq.apache.org/producer-flow-control.html>  available?

See the flow control mechanism above.

Regards,

Matthias.

From russell.homeserver at gmail.com  Sat Jul  7 11:09:04 2012
From: russell.homeserver at gmail.com (Russell Allen)
Date: Sat, 7 Jul 2012 03:09:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Logging, searching,
 graphing and alerting on millions of log messages with RabbitMQ
Message-ID: <7d72b0d3-f4f1-4a81-b772-6557e0e56e54@googlegroups.com>

Hi all,

Thought some of you might be interested in a project I'm working on that's 
using RabbitMQ, a custom AMQP Log4Net appender (Gelf4Net) and a couple of 
subscribers to handle logs from a distributed IT infrastructure. I work in 
a .Net team, so the plan is to use Log4Net with Gelf4Net to log to a 
RabbitMQ queue. I'll then have two consumers, GrayLog2 and NEsper, giving 
me the ability to dig into historic log data and alert on certain critical 
messages respectively.

At the moment I've got two blog posts up:

Enterprise Logging and Alerting with Graylog2, RabbitMq and NEsper<http://russellallen.info/post/2012/06/24/Enterprise-Logging-and-Alerting-with-Graylog2-RabbitMq-and-NEsper.aspx>
Enterprise Logging Part 2 - Logging From .Net to RabbitMq via Log4Net<http://russellallen.info/post/2012/07/06/Enterprise-Logging-Part-2-Logging-From-Net-to-RabbitMq-via-Log4Net.aspx>

If anyone's interested, I'll be tweeting about things (over at @RussPAll), 
if people want me to keep this discussion list up to date as well let me 
know.

Thanks,

Russ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120707/20e18fba/attachment.htm>

From ekirpichov at gmail.com  Sun Jul  8 20:49:53 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Sun, 8 Jul 2012 12:49:53 -0700
Subject: [rabbitmq-discuss] Logging, searching,
 graphing and alerting on millions of log messages with RabbitMQ
In-Reply-To: <7d72b0d3-f4f1-4a81-b772-6557e0e56e54@googlegroups.com>
References: <7d72b0d3-f4f1-4a81-b772-6557e0e56e54@googlegroups.com>
Message-ID: <CANVKUrUurh_dOx45eJQkz4E37_5CLNUyA2axDmux7Czh_pOw0A@mail.gmail.com>

In this context let me to also advertise my project related to
distributed logging: http://code.google.com/p/greg/
It's an extremely efficient centralized logger with clock
synchronization (more precise than NTP). It's been used in a
production cluster environment with 10000 clients and handled up to
500,000 messages/sec throughput.
(more precisely, this is a from-scratch reimplementation of the
approach used in a closed-source tool I wrote for that cluster
computing project which had those performance characteristics, but
this one also got some testing in much smaller environments and showed
similar performance)

In comparison to your project, it doesn't have any advanced features
like alerts, but it has clock synchronization and is probably faster.

On Sat, Jul 7, 2012 at 3:09 AM, Russell Allen
<russell.homeserver at gmail.com> wrote:
> Hi all,
>
> Thought some of you might be interested in a project I'm working on that's
> using RabbitMQ, a custom AMQP Log4Net appender (Gelf4Net) and a couple of
> subscribers to handle logs from a distributed IT infrastructure. I work in a
> .Net team, so the plan is to use Log4Net with Gelf4Net to log to a RabbitMQ
> queue. I'll then have two consumers, GrayLog2 and NEsper, giving me the
> ability to dig into historic log data and alert on certain critical messages
> respectively.
>
> At the moment I've got two blog posts up:
>
> Enterprise Logging and Alerting with Graylog2, RabbitMq and NEsper
> Enterprise Logging Part 2 - Logging From .Net to RabbitMq via Log4Net
>
> If anyone's interested, I'll be tweeting about things (over at @RussPAll),
> if people want me to keep this discussion list up to date as well let me
> know.
>
> Thanks,
>
> Russ
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
http://www.linkedin.com/in/eugenekirpichov

From nimmavadiraj at gmail.com  Mon Jul  9 04:46:50 2012
From: nimmavadiraj at gmail.com (vadiraj hebbar)
Date: Mon, 9 Jul 2012 09:16:50 +0530
Subject: [rabbitmq-discuss] time to arrive in queue
Message-ID: <CALK6wMqrvet5MBb5bztx8SWNkyid4QLKre76DyKPetP5mEOwPw@mail.gmail.com>

Hi all

Is it posible to know what time message is arrived in queue? if yes how to
know that?



regards,

vadiraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/b98b0421/attachment.htm>

From gmr at myyearbook.com  Mon Jul  9 04:55:24 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sun, 8 Jul 2012 23:55:24 -0400
Subject: [rabbitmq-discuss] time to arrive in queue
In-Reply-To: <CALK6wMqrvet5MBb5bztx8SWNkyid4QLKre76DyKPetP5mEOwPw@mail.gmail.com>
References: <CALK6wMqrvet5MBb5bztx8SWNkyid4QLKre76DyKPetP5mEOwPw@mail.gmail.com>
Message-ID: <5B45A616E6474013840C2FE534853494@myyearbook.com>

While it's not when the message arrived in the queue, I find it helpful to populate the message properties timestamp value with the timestamp of when the message is published. As a generalization, the difference in time between publishing a message and it arriving in the queue, at least in a non-federated system, should be fairly insignificant.

Alternatively, I could see writing a custom exchange that overwrites this value in the properties when the message is routed, similar to how the Shovel plugin has the ability to override properties when publishing: http://www.rabbitmq.com/shovel.html -- See publish_properties.

Regards,

Gavin 

On Sunday, July 8, 2012 at 11:46 PM, vadiraj hebbar wrote:

> Hi all 
> 
> Is it posible to know what time message is arrived in queue? if yes how to know that?
> 
> 
> 
> regards,
> 
> vadiraj
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120708/4dedeafc/attachment.htm>

From nimmavadiraj at gmail.com  Mon Jul  9 06:39:03 2012
From: nimmavadiraj at gmail.com (vadiraj hebbar)
Date: Mon, 9 Jul 2012 11:09:03 +0530
Subject: [rabbitmq-discuss] time-stamps for messages
Message-ID: <CALK6wMrLkKQAQrZh5XXupypSmUbH9QqJ=Sc-AEtAmyZu8m3pvA@mail.gmail.com>

Is there a way to get the time-tamps when a message was placed on the
queue, from a Java publisher? Please explain with example.



regards,

vadiraj hebbar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/bfdaf269/attachment.htm>

From hebin7611 at hotmail.com  Mon Jul  9 07:32:25 2012
From: hebin7611 at hotmail.com (=?gb2312?B?us6x8w==?=)
Date: Mon, 9 Jul 2012 14:32:25 +0800
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <4FF7218F.3090105@rabbitmq.com>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>
Message-ID: <SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>



Hi Tim,

Thanks for your reply.

I tried "erl -sname rabbit", it's OK.

my /etc/hosts looks like following:
127.0.0.1    game-01 ZSWY76 localhost.localdomain localhost
::1        localhost6.localdomain6 localhost6

EPMD can be started successfully, but always reports "Non-local peer connected" then force disconnecting rabbit-server.

Did I forget any necessory configration for RabbitMQ to use loopback interface to connect epmd?

Thanks a lot.

He Bin


> Date: Fri, 6 Jul 2012 18:34:07 +0100
> From: tim at rabbitmq.com
> To: rabbitmq-discuss at lists.rabbitmq.com
> CC: hebin7611 at hotmail.com
> Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected
> 
> Hi there,
> 
> On 06/07/2012 06:53, ?? wrote:
> > Hi all,
> >
> > I installed RabbotMQ & tried to start it.
> >
> > But I always got error as following:
> >
> 
> Ok so first of all, let's see if we can get you to start a stand alone 
> distributed Erlang node successfully. Normally stack traces like that 
> occur when the host environment isn't set up quite right (from Erlang's 
> perspective).
> 
> We need to be able to run `erl -sname rabbit` on the command line and 
> see the Erlang emulator start successfully. It should look something 
> like this:
> 
> ##############
> 
> t4 at malachi:systest $ erl -sname rabbit
> Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:2:2] [async-threads:0] 
> [hipe] [kernel-poll:false]
> 
> Eshell V5.9.1  (abort with ^G)
> (rabbit at malachi)1>
> 
> ##############
> 
> Can you start Erlang like that successfully? I'm assuming not, but 
> please let us know.
> 
> I'm also interested in understanding what your hosts configuration 
> (e.g., /etc/hosts) looks like. On some Operating Systems (such as CentOS 
> for example), failing to set an explicit host name prevents you from 
> starting a distributed Erlang node.
> 
> > {error_logger,{{2012,7,6},{13,32,21}},"Protocol: ~p: register error:
> > ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,"inet_tcp_dist.erl"},{line,70}]},{net_kernel,start_protos,4,[{file,"net_kernel.erl"},{line,1314}]},{net_kernel,start_protos,3,[{file,"net_kernel.erl"},{line,1307}]},{net_kernel,init_node,2,[{file,"net_kernel.erl"},{line,1197}]},{net_kernel,init,1,[{file,"net_kernel.erl"},{line,357}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}]}
> > {error_logger,{{2012,7,6},{13,32,21}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancest
> > ors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.90>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,551}],[]]}
> > {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch1077,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> > {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> > {error_logger,{{2012,7,6},{13,32,21}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> > {"Kern el pid
> > terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
> >
> > Crash dump was written to: erl_crash.dump
> > Kernel pid terminated (application_controller)
> > ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> >
> >
> > I ran it on a server with public IP 183.*.*.* .
> >
> > In Erlang src, I found that epmd checks connection src.
> >
> >        /* Determine if connection is from localhost */
> >        if (getpeername(s->fd,(struct sockaddr*) &si,&st) ||
> >            st < sizeof(si)) {
> >            /* Failure to get peername is regarded as non local host */
> >            s->local_peer = EPMD_FALSE;
> >        } else {
> >            /* Only 127.x.x.x and connections from the host's IP address
> >               allowed, no false positives */
> >            s->local_peer =
> > (((((unsigned) ntohl(si.sin_addr.s_addr)) & 0xFF000000U) ==
> >                 0x7F000000U) ||
> > (getsockname(s->fd,(struct sockaddr*) &di,&st) ?
> >                 EPMD_FALSE : si.sin_addr.s_addr == di.s in_addr.s_addr));
> >        }
> >        dbg_tty_printf(g,2,(s->local_peer) ? "Local peer connected" :
> >                       "Non-local peer connected");
> >
> >
> > But unfortunately, si.sin_addr.s_addr was 183.*.*.*, while
> > di.sin_addr.s_addr was 127.0.0.1
> >
> > My log?Checking peer address, getsockname ret: 0, si_addr=0xb7??????,
> > di_addr=0x7f000001
> >
> >
> 
> I could be wrong, but I suspect this is a red herring. You can restart 
> epmd with -d to get debugging information as well, but I suspect this 
> isn't relevant.
> 
> Is there any way to force RabbitMQ server connect epmd via a specified
> > address?
> >
> 
> I'm not really sure what you mean by this, but I'm fairly confident that 
> it is not necessary to even attempt to do something like that. Erlang 
> should be able to start up nodes with `-sname <name>` or `-name 
> <name>@<host>` and if either doesn't work, a little tweaking of the host 
> configuration should solve it.
> 
> Based on your original comment (starting rabbitmq but always getting an 
> error) my understanding is that you're trying to start rabbit on this 
> machine and it fails. AFAIK when a distributed Erlang node connects to 
> EPMD on the localhost it should be treated as such. The rabbitmq-server 
> script starts rabbit up with `-sname rabbit` which implies that the node 
> name will be rabbit@<hostname> so you should make sure that `erl -sname 
> rabbit` works first of all.
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/6fcfba62/attachment.htm>

From michal at kiedys.net  Mon Jul  9 08:54:29 2012
From: michal at kiedys.net (=?ISO-8859-2?Q?Micha=B3_Ki=EAdy=B6?=)
Date: Mon, 9 Jul 2012 09:54:29 +0200
Subject: [rabbitmq-discuss] Startup error
Message-ID: <CAHFJS_V69x7WmnE_XzFR+nPzfFXJdZhR02jpYAwT7vz1QokNoA@mail.gmail.com>

Hi,

During the RabbitMQ 2.8.4 startup I encountered the following error:

-- BEGIN fail -f /var/log/rabbitmq/startup_log --
broker running
{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbitmq_management,{bad_return,{{rabbit_mgmt_app,start,[normal,[]]},{'EXIT',{{shutdown,[{noproc,{gen_server,call,[undefined,which_children,infinity]}}]},{gen_server2,call,[<0.293.0>,{init,<0.291.0>},infinity]}}}}}}"}
-- END --

What happened? IHMO It looks like management plugin problem.

Regards,
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/75576252/attachment.htm>

From thiagoburgo at gmail.com  Fri Jul  6 22:18:39 2012
From: thiagoburgo at gmail.com (Thiago Burgo Belo)
Date: Fri, 6 Jul 2012 18:18:39 -0300
Subject: [rabbitmq-discuss] My cluter node (ram node) down in my
 performance test
In-Reply-To: <CABjKUK_Bfdo=Au1CR440YcEWkB6vTts-Le6G1HVYo7QqRXrWhA@mail.gmail.com>
References: <CABjKUK9j23ia9foMSDUTBXa+y6-ypF86d6Wzy9PZr=dAkxG-7Q@mail.gmail.com>
	<4FF6F10F.6080107@rabbitmq.com>
	<CABjKUK_Bfdo=Au1CR440YcEWkB6vTts-Le6G1HVYo7QqRXrWhA@mail.gmail.com>
Message-ID: <CABjKUK-8Gx_4Rt4Uu=VDg5-iXAHQ7HNUB=b8toeeCSdjBaO_zg@mail.gmail.com>

Server down again, see logs in attachement.

Thiago Burgo

2012/7/6 Thiago Burgo Belo <thiagoburgo at gmail.com>

> Matthias,
>
> I delete my log file (~200MB) =(, I will try reproduce problem (the
> problem happens frequently), and after a send the log for you. Wait a 30
> min to my performance test run, in my test I simulate 100k messages sent by
> 60 concurrent users (using apache benchmark -ab.exe).
>
>
> Thiago Burgo
>
>
> 2012/7/6 Matthias Radestock <matthias at rabbitmq.com>
>
>> Thiago,
>>
>>
>> On 06/07/12 14:21, Thiago Burgo Belo wrote:
>>
>>> I'm doing performance tests with Rabbit 2.8.4 in cluter mode (2 nodes),
>>> when I send 100000 (2 publishers 50K messages) messages with 1 client
>>> (consumer) with .NET client, my "slave" node running at ram down
>>> suddenly.
>>>
>>> Other problem (I dont know if correlated) is I lost messages, about 8%
>>> of loss.
>>>
>>> In attachment the server log.
>>>
>>
>> That's some interesting errors you've got there. Could you please send us
>>
>> - the *complete* log file (if it's huge just put it somewhere where we
>> can download it)
>>
>> - the output of 'rabbitmqctl report' on the ram node when your tests are
>> running (but before the crash)
>>
>> Regards,
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120706/839207f3/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at APPSERVER02.zip
Type: application/zip
Size: 206508 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120706/839207f3/attachment-0004.zip>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: reports_disc.zip
Type: application/zip
Size: 9891 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120706/839207f3/attachment-0005.zip>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: reports_ram.zip
Type: application/zip
Size: 18391 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120706/839207f3/attachment-0006.zip>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at APPSERVER02-2.zip
Type: application/zip
Size: 744156 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120706/839207f3/attachment-0007.zip>

From mvikasetc at gmail.com  Sun Jul  8 20:32:43 2012
From: mvikasetc at gmail.com (Vikas)
Date: Sun, 8 Jul 2012 12:32:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Envelop redeliver question ( clustering ha
	redelivery question)
Message-ID: <d4ab5dd6-3062-4b23-a4dd-e6fcd7d97e35@h9g2000yqi.googlegroups.com>

Hello All,

I have setup rabbitmq cluster with 2 nodes and i am using joshdevins
rabbitmq ha client to consume messages - to simulate real scenario of
data processing i have added sleep for 10 seconds before sending ack.
On crashing(stopping) the master node - the connection is re
established with 2nd rabbitmq node However i do received the last un
acknowledged message which was failed to ack due to master node crash.

This is acceptable and expected.  To handle this scenario i thought to
use isRedeliver value from envelop but i observed different behavior
than documented about redeliver flag value.

On restarting the node which was down. I see all messages with
redelivered(delivery.getEnvelope().isRedeliver()) as true in my
consumer. The consumer was also restarted after restarting the node.

Why the redelivery value is true when the messages were not even
attempted to ack by consumer.
Is this a bug or am i doing something wrong?

java doc reference : redeliver - true if this is a redelivery
following a failed ack


Thanks
Vikas

From watson.timothy at gmail.com  Mon Jul  9 09:57:39 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 9 Jul 2012 09:57:39 +0100
Subject: [rabbitmq-discuss] time-stamps for messages
In-Reply-To: <CALK6wMrLkKQAQrZh5XXupypSmUbH9QqJ=Sc-AEtAmyZu8m3pvA@mail.gmail.com>
References: <CALK6wMrLkKQAQrZh5XXupypSmUbH9QqJ=Sc-AEtAmyZu8m3pvA@mail.gmail.com>
Message-ID: <126B95AA-43C8-48E4-B30A-218723725867@rabbitmq.com>

Have you noticed the message just before yours? Check the list archives - I'll send you a link in a minute when I'm back in front of my laptop! :)



On 9 Jul 2012, at 06:39, vadiraj hebbar <nimmavadiraj at gmail.com> wrote:

> Is there a way to get the time-tamps when a message was placed on the queue, from a Java publisher? Please explain with example.
> 
> 
> regards,
> vadiraj hebbar
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/d692b2ab/attachment.htm>

From watson.timothy at gmail.com  Mon Jul  9 10:00:33 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 9 Jul 2012 10:00:33 +0100
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
	connected
In-Reply-To: <SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>
	<4FF7218F.3090105@rabbitmq.com>
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>
Message-ID: <818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>

What OS and rabbit version are you running? I've not seen this happen before but I'll investigate.

On 9 Jul 2012, at 07:32, ?? <hebin7611 at hotmail.com> wrote:

> 
> Hi Tim,
> 
> Thanks for your reply.
> 
> I tried "erl -sname rabbit", it's OK.
> 
> my /etc/hosts looks like following:
> 127.0.0.1    game-01 ZSWY76 localhost.localdomain localhost
> ::1        localhost6.localdomain6 localhost6
> 
> EPMD can be started successfully, but always reports "Non-local peer connected" then force disconnecting rabbit-server.
> 
> Did I forget any necessory configration for RabbitMQ to use loopback interface to connect epmd?
> 
> Thanks a lot.
> 
> He Bin
> 
> 
> > Date: Fri, 6 Jul 2012 18:34:07 +0100
> > From: tim at rabbitmq.com
> > To: rabbitmq-discuss at lists.rabbitmq.com
> > CC: hebin7611 at hotmail.com
> > Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected
> > 
> > Hi there,
> > 
> > On 06/07/2012 06:53, ?? wrote:
> > > Hi all,
> > >
> > > I installed RabbotMQ & tried to start it.
> > >
> > > But I always got error as following:
> > >
> > 
> > Ok so first of all, let's see if we can get you to start a stand alone 
> > distributed Erlang node successfully. Normally stack traces like that 
> > occur when the host environment isn't set up quite right (from Erlang's 
> > perspective).
> > 
> > We need to be able to run `erl -sname rabbit` on the command line and 
> > see the Erlang emulator start successfully. It should look something 
> > like this:
> > 
> > ##############
> > 
> > t4 at malachi:systest $ erl -sname rabbit
> > Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:2:2] [async-threads:0] 
> > [hipe] [kernel-poll:false]
> > 
> > Eshell V5.9.1 (abort with ^G)
> > (rabbit at malachi)1>
> > 
> > ##############
> > 
> > Can you start Erlang like that successfully? I'm assuming not, but 
> > please let us k now.
> > 
> > I'm also interested in understanding what your hosts configuration 
> > (e.g., /etc/hosts) looks like. On some Operating Systems (such as CentOS 
> > for example), failing to set an explicit host name prevents you from 
> > starting a distributed Erlang node.
> > 
> > > {error_logger,{{2012,7,6},{13,32,21}},"Protocol: ~p: register error:
> > > ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,"inet_tcp_dist.erl"},{line,70}]},{net_kernel,start_protos,4,[{file,"net_kernel.erl"},{line,1314}]},{net_kernel,start_protos,3,[{file,"net_kernel.erl"},{line,1307}]},{net_kernel,init_node,2,[{file,"net_kernel.erl"},{line,1197}]},{net_kernel,init,1,[{file,"net_kernel.erl"},{line,357}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}]}
> > > {error_logger,{{2012,7,6},{13,32,21}},crash_report,[[{initial_call,{net_kernel,init, ['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancest
> > > ors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.90>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,551}],[]]}
> > > {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch1077,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> > > {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup}, {mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> > > {error_logger,{{2012,7,6},{13,32,21}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> > > {"Kern el pid
> > > terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
> > >
> > > Crash dump was written to: erl_crash.dump
> > > Kernel pid terminated (application_controller)
> > > ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> > >
> > >
> > > I ran it on a server with public IP 183.*.*.* .
> > >
> > > In Erlang src, I found that epmd checks connection src.
> > >
> > > /* Determine if connection is from localhost */
> > > if (getpeername(s->fd,(struct sockaddr*) &si,&st) ||
> > > s t < sizeof(si)) {
> > > /* Failure to get peername is regarded as non local host */
> > > s->local_peer = EPMD_FALSE;
> > > } else {
> > > /* Only 127.x.x.x and connections from the host's IP address
> > > allowed, no false positives */
> > > s->local_peer =
> > > (((((unsigned) ntohl(si.sin_addr.s_addr)) & 0xFF000000U) ==
> > > 0x7F000000U) ||
> > > (getsockname(s->fd,(struct sockaddr*) &di,&st) ?
> > > EPMD_FALSE : si.sin_addr.s_addr == di.s in_addr.s_addr));
> > > }
> > > dbg_tty_printf(g,2,(s->local_peer) ? "Local peer connected" :
> > > "Non-local peer connected");
> > >
> > >
> > > But unfortunately, si.sin_addr.s_addr was 183.*.*.*, while
> > > di.sin_addr.s_addr was 127.0.0.1
> > >
> & gt; > My log?Checking peer address, getsockname ret: 0, si_addr=0xb7??????,
> > > di_addr=0x7f000001
> > >
> > >
> > 
> > I could be wrong, but I suspect this is a red herring. You can restart 
> > epmd with -d to get debugging information as well, but I suspect this 
> > isn't relevant.
> > 
> > Is there any way to force RabbitMQ server connect epmd via a specified
> > > address?
> > >
> > 
> > I'm not really sure what you mean by this, but I'm fairly confident that 
> > it is not necessary to even attempt to do something like that. Erlang 
> > should be able to start up nodes with `-sname <name>` or `-name 
> > <name>@<host>` and if either doesn't work, a little tweaking of the host 
> > configuration should solve it.
> > 
> > Based on your original comment (starting rabbitmq but always getting an 
> > error) my understanding is that you're trying to start rabbit on this 
> > machine and it fails. AFAIK when a distributed Erlang node connects to 
> > EPMD on the localhost it should be treated as such. The rabbitmq-server 
> > script starts rabbit up with `-sname rabbit` which implies that the node 
> > name will be rabbit@<hostname> so you should make sure that `erl -sname 
> > rabbit` works first of all.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/302b9232/attachment.htm>

From tim at rabbitmq.com  Mon Jul  9 10:02:18 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 09 Jul 2012 10:02:18 +0100
Subject: [rabbitmq-discuss] time-stamps for messages
In-Reply-To: <126B95AA-43C8-48E4-B30A-218723725867@rabbitmq.com>
References: <CALK6wMrLkKQAQrZh5XXupypSmUbH9QqJ=Sc-AEtAmyZu8m3pvA@mail.gmail.com>
	<126B95AA-43C8-48E4-B30A-218723725867@rabbitmq.com>
Message-ID: <4FFA9E1A.5080500@rabbitmq.com>

On 07/09/2012 09:57 AM, Tim Watson wrote:
> Have you noticed the message just before yours? Check the list 
> archives - I'll send you a link in a minute when I'm back in front of 
> my laptop! :)

And indeed, you were the OP and the response was to you! Gavin is 
correct - you'll need to put a timestamp on this yourself AFAIK.

Tim

From hebin7611 at hotmail.com  Mon Jul  9 10:13:44 2012
From: hebin7611 at hotmail.com (=?gb2312?B?us6x8w==?=)
Date: Mon, 9 Jul 2012 17:13:44 +0800
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
Message-ID: <SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>


Hi,

My environment info:
OS: CentOS 5.6
Erlang: Compiled from otp_src_R15B01.tar.gz
RabbitMQ: Compiled from rabbitmq-server-2.8.4.tar.gz

ifconfig:
eth0      Link encap:Ethernet  HWaddr 84:2B:2B:73:88:28  
          inet addr:183.*.*.*  Bcast:183.60.44.127  Mask:255.255.255.192
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:77904379 errors:0 dropped:0 overruns:0 frame:0
          TX packets:65643095 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:11615134852 (10.8 GiB)  TX bytes:61820973373 (57.5 GiB)
          Interrupt:66 Memory:da000000-da012800 

eth0:0    Link encap:Ethernet  HWaddr 84:2B:2B:73:88:28  
          inet addr:112.*.*.*  Bcast:112.90.57.191  Mask:255.255.255.192
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          Interrupt:66 Memory:da000000-da012800 

eth1      Link encap:Ethernet  HWaddr 84:2B:2B:73:88:29  
          inet addr:10.20.30.1  Bcast:10.20.30.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:94328707 errors:0 dropped:0 overruns:0 frame:0
          TX packets:78961028 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:77337167993 (72.0 GiB)  TX bytes:15705231055 (14.6 GiB)
          Interrupt:74 Memory:dc000000-dc012800 

eth1:1    Link encap:Ethernet  HWaddr 84:2B:2B:73:88:29  
          inet addr:10.20.30.251  Bcast:10.20.30.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          Interrupt:74 Memory:dc000000-dc012800 

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:2530738 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2530738 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:155346660 (148.1 MiB)  TX bytes:155346660 (148.1 MiB)


Thank you again.


He Bin


From: watson.timothy at gmail.com
Date: Mon, 9 Jul 2012 10:00:33 +0100
CC: rabbitmq-discuss at lists.rabbitmq.com
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer	connected

What OS and rabbit version are you running? I've not seen this happen before but I'll investigate.

On 9 Jul 2012, at 07:32, ?? <hebin7611 at hotmail.com> wrote:






Hi Tim,

Thanks for your reply.

I tried "erl -sname rabbit", it's OK.

my /etc/hosts looks like following:
127.0.0.1    game-01 ZSWY76 localhost.localdomain localhost
::1        localhost6.localdomain6 localhost6

EPMD can be started successfully, but always reports "Non-local peer connected" then force disconnecting rabbit-server.

Did I forget any necessory configration for RabbitMQ to use loopback interface to connect epmd?

Thanks a lot.

He Bin


> Date: Fri, 6 Jul 2012 18:34:07 +0100
> From: tim at rabbitmq.com
> To: rabbitmq-discuss at lists.rabbitmq.com
> CC: hebin7611 at hotmail.com
> Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected
> 
> Hi there,
> 
> On 06/07/2012 06:53, ?? wrote:
> > Hi all,
> >
> > I installed 
 RabbotMQ & tried to start it.
> >
> > But I always got error as following:
> >
> 
> Ok so first of all, let's see if we can get you to start a stand alone 
> distributed Erlang node successfully. Normally stack traces like that 
> occur when the host environment isn't set up quite right (from Erlang's 
> perspective).
> 
> We need to be able to run `erl -sname rabbit` on the command line and 
> see the Erlang emulator start successfully. It should look something 
> like this:
> 
> ##############
> 
> t4 at malachi:systest $ erl -sname rabbit
> Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:2:2] [async-threads:0] 
> [hipe] [kernel-poll:false]
> 
> Eshell V5.9.1  (abort with ^G)
> (rabbit at malachi)1>
> 
> ##############
> 
> Can you start Erlang like that successfully? I'm assuming not, but 
> please let us k
 now.
> 
> I'm also interested in understanding what your hosts configuration 
> (e.g., /etc/hosts) looks like. On some Operating Systems (such as CentOS 
> for example), failing to set an explicit host name prevents you from 
> starting a distributed Erlang node.
> 
> > {error_logger,{{2012,7,6},{13,32,21}},"Protocol: ~p: register error:
> > ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,"inet_tcp_dist.erl"},{line,70}]},{net_kernel,start_protos,4,[{file,"net_kernel.erl"},{line,1314}]},{net_kernel,start_protos,3,[{file,"net_kernel.erl"},{line,1307}]},{net_kernel,init_node,2,[{file,"net_kernel.erl"},{line,1197}]},{net_kernel,init,1,[{file,"net_kernel.erl"},{line,357}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}]}
> > {error_logger,{{2012,7,6},{13,32,21}},crash_report,[[{initial_call,{net_kernel,init,
 ['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancest
> > ors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.90>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,551}],[]]}
> > {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch1077,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> > {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},
 {mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> > {error_logger,{{2012,7,6},{13,32,21}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> > {"Kern el pid
> > terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
> >
> > Crash dump was written to: erl_crash.dump
> > Kernel pid terminated (application_controller)
> > ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> >
> >
> > I ran it on a server with public IP 183.*.*.* .
> >
> > In Erlang src, I found that epmd checks connection src.
> >
> >        /* Determine if connection is from localhost */
> >        if (getpeername(s->fd,(struct sockaddr*) &si,&st) ||
> >            s
 t < sizeof(si)) {
> >            /* Failure to get peername is regarded as non local host */
> >            s->local_peer = EPMD_FALSE;
> >        } else {
> >            /* Only 127.x.x.x and connections from the host's IP address
> >               allowed, no false positives */
> >            s->local_peer =
> > (((((unsigned) ntohl(si.sin_addr.s_addr)) & 0xFF000000U) ==
> >                 0x7F000000U) ||
> > (getsockname(s->fd,(struct sockaddr*) &di,&st) ?
> >                 EPMD_FALSE : si.sin_addr.s_addr == di.s in_addr.s_addr));
> >        }
> >        dbg_tty_printf(g,2,(s->local_peer) ? "Local peer connected" :
> >                       "Non-local peer connected");
> >
> >
> > But unfortunately, si.sin_addr.s_addr was 183.*.*.*, while
> > di.sin_addr.s_addr was 127.0.0.1
> >
&
 gt; > My log?Checking peer address, getsockname ret: 0, si_addr=0xb7??????,
> > di_addr=0x7f000001
> >
> >
> 
> I could be wrong, but I suspect this is a red herring. You can restart 
> epmd with -d to get debugging information as well, but I suspect this 
> isn't relevant.
> 
> Is there any way to force RabbitMQ server connect epmd via a specified
> > address?
> >
> 
> I'm not really sure what you mean by this, but I'm fairly confident that 
> it is not necessary to even attempt to do something like that. Erlang 
> should be able to start up nodes with `-sname <name>` or `-name 
> <name>@<host>` and if either doesn't work, a little tweaking of the host 
> configuration should solve it.
> 
> Based on your original comment (starting rabbitmq but always getting an 
> error) my understanding is that you're trying to start 
 rabbit on this 
> machine and it fails. AFAIK when a distributed Erlang node connects to 
> EPMD on the localhost it should be treated as such. The rabbitmq-server 
> script starts rabbit up with `-sname rabbit` which implies that the node 
> name will be rabbit@<hostname> so you should make sure that `erl -sname 
> rabbit` works first of all.
 		 	   		  
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/cd7e9202/attachment.htm>

From tim at rabbitmq.com  Mon Jul  9 10:12:36 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 09 Jul 2012 10:12:36 +0100
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>
	<4FF7218F.3090105@rabbitmq.com>
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
Message-ID: <4FFAA084.8030805@rabbitmq.com>

I also wonder how the hostname is getting resolved. Rabbit actually 
passes the hostname to erl, so you get something more like `erl -sname 
rabbit@<hostname>` which is calculated something like this:

SCRIPT_DIR=`dirname $SCRIPT_PATH`
RABBITMQ_HOME="${SCRIPT_DIR}/.."
[ "x" = "x$HOSTNAME" ] && HOSTNAME=`env hostname`
NODENAME=rabbit@${HOSTNAME%%.*}

So what does `env hostname` return on your machine, and can you start an 
Erlang node with this using erl -sname rabbit@`env hostname` or some 
such construct?

On 07/09/2012 10:00 AM, Tim Watson wrote:
> What OS and rabbit version are you running? I've not seen this happen 
> before but I'll investigate.
>
> On 9 Jul 2012, at 07:32, ?? <hebin7611 at hotmail.com 
> <mailto:hebin7611 at hotmail.com>> wrote:
>
>>
>> Hi Tim,
>>
>> Thanks for your reply.
>>
>> I tried "erl -sname rabbit", it's OK.
>>
>> my /etc/hosts looks like following:
>> 127.0.0.1    game-01 ZSWY76 localhost.localdomain localhost
>> ::1        localhost6.localdomain6 localhost6
>>
>> EPMD can be started successfully, but always reports "Non-local peer 
>> connected" then force disconnecting rabbit-server.
>>
>> Did I forget any necessory configration for RabbitMQ to use loopback 
>> interface to connect epmd?
>>
>> Thanks a lot.
>>
>> He Bin
>>
>>
>> > Date: Fri, 6 Jul 2012 18:34:07 +0100
>> > From: tim at rabbitmq.com <mailto:tim at rabbitmq.com>
>> > To: rabbitmq-discuss at lists.rabbitmq.com 
>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>> > CC: hebin7611 at hotmail.com <mailto:hebin7611 at hotmail.com>
>> > Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: 
>> Non-local peer connected
>> >
>> > Hi there,
>> >
>> > On 06/07/2012 06:53, ?? wrote:
>> > > Hi all,
>> > >
>> > > I installed RabbotMQ & tried to start it.
>> > >
>> > > But I always got error as following:
>> > >
>> >
>> > Ok so first of all, let's see if we can get you to start a stand alone
>> > distributed Erlang node successfully. Normally stack traces like that
>> > occur when the host environment isn't set up quite right (from 
>> Erlang's
>> > perspective).
>> >
>> > We need to be able to run `erl -sname rabbit` on the command line and
>> > see the Erlang emulator start successfully. It should look something
>> > like this:
>> >
>> > ##############
>> >
>> > t4 at malachi:systest $ erl -sname rabbit
>> > Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:2:2] 
>> [async-threads:0]
>> > [hipe] [kernel-poll:false]
>> >
>> > Eshell V5.9.1 (abort with ^G)
>> > (rabbit at malachi)1>
>> >
>> > ##############
>> >
>> > Can you start Erlang like that successfully? I'm assuming not, but
>> > please let us k now.
>> >
>> > I'm also interested in understanding what your hosts configuration
>> > (e.g., /etc/hosts) looks like. On some Operating Systems (such as 
>> CentOS
>> > for example), failing to set an explicit host name prevents you from
>> > starting a distributed Erlang node.
>> >
>> > > {error_logger,{{2012,7,6},{13,32,21}},"Protocol: ~p: register error:
>> > > 
>> ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,"inet_tcp_dist.erl"},{line,70}]},{net_kernel,start_protos,4,[{file,"net_kernel.erl"},{line,1314}]},{net_kernel,start_protos,3,[{file,"net_kernel.erl"},{line,1307}]},{net_kernel,init_node,2,[{file,"net_kernel.erl"},{line,1197}]},{net_kernel,init,1,[{file,"net_kernel.erl"},{line,357}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}]}
>> > > 
>> {error_logger,{{2012,7,6},{13,32,21}},crash_report,[[{initial_call,{net_kernel,init, 
>> ['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancest
>> > > 
>> ors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.90>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,551}],[]]}
>> > > 
>> {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch1077,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>> > > 
>> {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup}, 
>> {mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>> > > 
>> {error_logger,{{2012,7,6},{13,32,21}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>> > > {"Kern el pid
>> > > 
>> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>> > >
>> > > Crash dump was written to: erl_crash.dump
>> > > Kernel pid terminated (application_controller)
>> > > 
>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>> > >
>> > >
>> > > I ran it on a server with public IP 183.*.*.* .
>> > >
>> > > In Erlang src, I found that epmd checks connection src.
>> > >
>> > > /* Determine if connection is from localhost */
>> > > if (getpeername(s->fd,(struct sockaddr*) &si,&st) ||
>> > > s t < sizeof(si)) {
>> > > /* Failure to get peername is regarded as non local host */
>> > > s->local_peer = EPMD_FALSE;
>> > > } else {
>> > > /* Only 127.x.x.x and connections from the host's IP address
>> > > allowed, no false positives */
>> > > s->local_peer =
>> > > (((((unsigned) ntohl(si.sin_addr.s_addr)) & 0xFF000000U) ==
>> > > 0x7F000000U) ||
>> > > (getsockname(s->fd,(struct sockaddr*) &di,&st) ?
>> > > EPMD_FALSE : si.sin_addr.s_addr == di.s in_addr.s_addr));
>> > > }
>> > > dbg_tty_printf(g,2,(s->local_peer) ? "Local peer connected" :
>> > > "Non-local peer connected");
>> > >
>> > >
>> > > But unfortunately, si.sin_addr.s_addr was 183.*.*.*, while
>> > > di.sin_addr.s_addr was 127.0.0.1
>> > >
>> & gt; > My log:Checking peer address, getsockname ret: 0, 
>> si_addr=0xb7??????,
>> > > di_addr=0x7f000001
>> > >
>> > >
>> >
>> > I could be wrong, but I suspect this is a red herring. You can restart
>> > epmd with -d to get debugging information as well, but I suspect this
>> > isn't relevant.
>> >
>> > Is there any way to force RabbitMQ server connect epmd via a specified
>> > > address?
>> > >
>> >
>> > I'm not really sure what you mean by this, but I'm fairly confident 
>> that
>> > it is not necessary to even attempt to do something like that. Erlang
>> > should be able to start up nodes with `-sname <name>` or `-name
>> > <name>@<host>` and if either doesn't work, a little tweaking of the 
>> host
>> > configuration should solve it.
>> >
>> > Based on your original comment (starting rabbitmq but always 
>> getting an
>> > error) my understanding is that you're trying to start rabbit on this
>> > machine and it fails. AFAIK when a distributed Erlang node connects to
>> > EPMD on the localhost it should be treated as such. The 
>> rabbitmq-server
>> > script starts rabbit up with `-sname rabbit` which implies that the 
>> node
>> > name will be rabbit@<hostname> so you should make sure that `erl 
>> -sname
>> > rabbit` works first of all.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com 
>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/db11af9b/attachment.htm>

From tim at rabbitmq.com  Mon Jul  9 10:17:54 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 09 Jul 2012 10:17:54 +0100
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>
Message-ID: <4FFAA1C2.4080006@rabbitmq.com>

Ah ok great. I'm on CentOS 6, and I found that setting up the hostname 
so that Erlang was *happy* with it took a bit of fiddling around.

My configuration looks like this:

t4 at iske $ cat /etc/hosts
127.0.0.1    localhost.localdomain localhost
127.0.0.1    iske
::1    localhost

t4 at iske $ cat /etc/sysconfig/network
NETWORKING=yes
NETWORKING_IPV6=no
HOSTNAME=iske

You can check this with system-config-network as well. Are you seeing 
something similar?

Tim

On 07/09/2012 10:13 AM, ?? wrote:
> Hi,
>
> My environment info:
> OS: CentOS 5.6
> Erlang: Compiled from otp_src_R15B01.tar.gz
> RabbitMQ: Compiled from rabbitmq-server-2.8.4.tar.gz
>
> ifconfig:
> eth0      Link encap:Ethernet  HWaddr 84:2B:2B:73:88:28
>           inet addr:183.*.*.*  Bcast:183.60.44.127  Mask:255.255.255.192
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>           RX packets:77904379 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:65643095 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:1000
>           RX bytes:11615134852 (10.8 GiB)  TX bytes:61820973373 (57.5 GiB)
> &nb sp;      Interrupt:66 Memory:da000000-da012800
>
> eth0:0    Link encap:Ethernet  HWaddr 84:2B:2B:73:88:28
>           inet addr:112.*.*.*  Bcast:112.90.57.191  Mask:255.255.255.192
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>           Interrupt:66 Memory:da000000-da012800
>
> eth1      Link encap:Ethernet  HWaddr 84:2B:2B:73:88:29
>           inet addr:10.20.30.1  Bcast:10.20.30.255  Mask:255.255.255.0
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>           RX packets:94328707 errors:0 dropped:0 overruns:0 frame:0
>            TX packets:78961028 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:1000
>           RX bytes:77337167993 (72.0 GiB)  TX bytes:15705231055 (14.6 GiB)
>           Interrupt:74 Memory:dc000000-dc012800
>
> eth1:1    Link encap:Ethernet  HWaddr 84:2B:2B:73:88:29
>           inet addr:10.20.30.251  Bcast:10.20.30.255  Mask:255.255.255.0
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>           Interrupt:74 Memory:dc000000-dc012800
>
> lo        Link encap:Local Loopback
>            inet addr:127.0.0.1  Mask:255.0.0.0
>           UP LOOPBACK RUNNING  MTU:16436  Metric:1
>           RX packets:2530738 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:2530738 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:155346660 (148.1 MiB)  TX bytes:155346660 (148.1 MiB)
>
>
> Thank you again.
>
>
> He Bin
>
>
> ------------------------------------------------------------------------
> From: watson.timothy at gmail.com
> Date: Mon, 9 Jul 2012 10:00:33 +0100
> CC: rabbitmq-discuss at lists.rabbitmq.com
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local 
> peer connected
>
> What OS and rabbit version are you running? I've not seen this happen 
> before but I'll investigate.
>
> On 9 Jul 2012, at 07:32, ?? <hebin7611 at hotmail.com 
> <mailto:hebin7611 at hotmail.com>> wrote:
>
>
>     Hi Tim,
>
>     Thanks for your reply.
>
>     I tried "erl -sname rabbit", it's OK.
>
>     my /etc/hosts looks like following:
>     127.0.0.1    game-01 ZSWY76 localhost.localdomain localhost
>     ::1        localhost6.localdomain6 localhost6
>
>     EPMD can be started successfully, but always reports "Non-local
>     peer connected" then force disconnecting rabbit-server.
>
>     Did I forget any necessory configration for RabbitMQ to use
>     loopback interface to connect epmd?
>
>     Thanks a lot.
>
>     He Bin
>
>
>     > Date: Fri, 6 Jul 2012 18:34:07 +0100
>     > From: tim at rabbitmq.com <mailto:tim at rabbitmq.com>
>     > To: rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     > CC: hebin7611 at hotmail.com <mailto:hebin7611 at hotmail.com>
>     > Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD:
>     Non-local peer conne cted
>     >
>     > Hi there,
>     >
>     > On 06/07/2012 06:53, ?? wrote:
>     > > Hi all,
>     > >
>     > > I installed RabbotMQ & tried to start it.
>     > >
>     > > But I always got error as following:
>     > >
>     >
>     > Ok so first of all, let's see if we can get you to start a stand
>     alone
>     > distributed Erlang node successfully. Normally stack traces like
>     that
>     > occur when the host environment isn't set up quite right (from
>     Erlang's
>     > perspective).
>     >
>     > We need to be able to run `erl -sname rabbit` on the command
>     line and
>     > see the Erlang emulator start successfully. It should look
>     something
>     > like this:
>     >
>     > ##############
>     >
>     > t4 at malachi:systest $ erl -sname rabbit
>     > Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:2:2]
>     [async-threads:0]
>     > [hipe] [kernel-poll:false]
>     >
>     > Eshell V5.9.1 (abort with ^G)
>     > (rabbit at malachi)1>
>     >
>     > ##############
>     >
>     > Can you start Erlang like that successfully? I'm assuming not, but
>     > please let us k now.
>     >
>     > I'm also interested in understanding what your hosts configuration
>     > (e.g., /etc/hosts) looks like. On some Operating Systems (such
>     as CentOS
>     > for example), failing to set an explicit host name prevents you
>     from
>     > starting a distributed Erlang node.
>     >
>     > > {error_logger,{{2012,7,6},{13,32,21}},"Protocol: ~p: register
>     error:
>     > >
>     ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,"inet_tcp_dist.erl"},{line,70}]},{net_kernel,start_protos,4,[{file,"net_kernel.erl"},{line,1314}]},{net_kernel,start_protos,3,[{file,"net_kernel.erl"},{line,1307}]},{net_kernel,init_node,2,[{file,"net_kernel.erl"},{line,1197}]},{net_kernel,init,1,[{file,"net_kernel.erl"},{line,357}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}]}
>     > >
>     {error_logger,{{2012,7,6},{13,32,21}},crash_report,[[{initial_call,{net_kernel,init,
>     ['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancest
>     > >
>     ors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.90>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,551}],[]]}
>     > >
>     {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch1077,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>     > >
>     {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},
>     {mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>     > >
>     {error_logger,{{2012,7,6},{13,32,21}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>     > > {"Kern el pid
>     > >
>     terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>     > >
>     > > Crash dump was written to: erl_crash.dump
>     > > Kernel pid terminated (application_controller)
>     > >
>     ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>     > >
>     > >
>     > > I ran it on a server with public IP 183.*.*.* .
>     > >
>     > > In Erlang src, I found that epmd checks connection src.
>     > >
>     > > /* Determine if connection is from localhost */
>     > > if (getpeername(s->fd,(struct sockaddr*) &si,&st) ||
>     > > s t < sizeof(si)) {
>     > > /* Failure to get peername is regarded as non local host */
>     > > s->local_peer = EPMD_FALSE;
>     > > } else {
>     > > /* Only 127.x.x.x and connections from the host's IP address
>     > > allowed, no false positives */
>     > > s->local_peer =
>     > > (((((unsigned) ntohl(si.sin_addr.s_addr)) & 0xFF000000U) ==
>     > > 0x7F000000U) ||
>     > > (getsockname(s->fd,(struct sockaddr*) &di,&st) ?
>     > > EPMD_FALSE : si.sin_addr.s_addr == di.s in_addr.s_addr));
>     > > }
>     > > dbg_tty_printf(g,2,(s->local_peer) ? "Local peer connected" :
>     > > "Non-local peer connected");
>     > >
>     > >
>     > > But unfortunately, si.sin_addr.s_addr was 183.*.*.*, while
>     > > di.sin_addr.s_addr was 127.0.0.1
>     > >
>     & amp; gt; > My log?Checking peer address, getsockname ret: 0,
>     si_addr=0xb7??????,
>     > > di_addr=0x7f000001
>     > >
>     > >
>     >
>     > I could be wrong, but I suspect this is a red herring. You can
>     restart
>     > epmd with -d to get debugging information as well, but I suspect
>     this
>     > isn't relevant.
>     >
>     > Is there any way to force RabbitMQ server connect epmd via a
>     specified
>     > > address?
>     > >
>     >
>     > I'm not really sure what you mean by this, but I'm fairly
>     confident that
>     > it is not necessary to even attempt to do something like that.
>     Erlang
>     > should be able to start up nodes with `-sname <name>` or `-name
>     > <name>@<host>` and if either doesn't work, a little tweaking of
>     the host
>     > configuration should solve it.
>     >
>     > Based on your original comment (starting rabbitmq but always
>     getting an
>     > error) my understanding is that you're trying to start rabbit on
>     this
>     > machine and it fails. AFAIK when a distributed Erlang node
>     connects to
>     > EPMD on the localhost it should be treated as such. The
>     rabbitmq-server
>     > script starts rabbit up with `-sname rabbit` which implies that
>     the node
>     > name will be rabbit@<hostname> so you should make sure that `erl
>     -sname
>     > rabbit` works first of all.
>
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________ rabbitmq-discuss 
> mailing list rabbitmq-discuss at lists.rabbitmq.com 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/013df493/attachment.htm>

From emile at rabbitmq.com  Mon Jul  9 10:27:19 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 09 Jul 2012 10:27:19 +0100
Subject: [rabbitmq-discuss] Envelop redeliver question ( clustering ha
 redelivery question)
In-Reply-To: <d4ab5dd6-3062-4b23-a4dd-e6fcd7d97e35@h9g2000yqi.googlegroups.com>
References: <d4ab5dd6-3062-4b23-a4dd-e6fcd7d97e35@h9g2000yqi.googlegroups.com>
Message-ID: <4FFAA3F7.4040409@rabbitmq.com>

Hi Vikas,

On 08/07/12 20:32, Vikas wrote:
> Why the redelivery value is true when the messages were not even
> attempted to ack by consumer.

If you want limit consumers to only one unacknowledged message at a time
then set the QoS prefetch count to 1:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos.prefetch-count

If the prefetch count is not limited then more than one message will
potentially have the redelivered flag set after a connection interruption.


-Emile


From hebin7611 at hotmail.com  Mon Jul  9 10:27:26 2012
From: hebin7611 at hotmail.com (=?gb2312?B?us6x8w==?=)
Date: Mon, 9 Jul 2012 17:27:26 +0800
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <4FFAA1C2.4080006@rabbitmq.com>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>,
	<4FFAA1C2.4080006@rabbitmq.com>
Message-ID: <SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>


Hi,

[root at game-01 woyogame]# cat /etc/hosts
# Do not remove the following line, or various programs
# that require network functionality will fail.
127.0.0.1    game-01 ZSWY76 localhost.localdomain localhost
::1        localhost6.localdomain6 localhost6


[root at game-01 woyogame]# cat /etc/sysconfig/network
NETWORKING=yes
NETWORKING_IPV6=no
HOSTNAME=game-01
GATEWAY=183.*.*.*


It seems OK.

He Bin


Date: Mon, 9 Jul 2012 10:17:54 +0100
From: tim at rabbitmq.com
To: rabbitmq-discuss at lists.rabbitmq.com
CC: hebin7611 at hotmail.com
Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected


  
    
  
  
    Ah ok great. I'm on CentOS 6, and I found that setting up the
    hostname so that Erlang was *happy* with it took a bit of fiddling
    around.

    

    My configuration looks like this:

    

    t4 at iske $ cat /etc/hosts

    127.0.0.1    localhost.localdomain localhost

    127.0.0.1    iske

    ::1    localhost

    

    t4 at iske $ cat /etc/sysconfig/network

    NETWORKING=yes

    NETWORKING_IPV6=no

    HOSTNAME=iske

    

    You can check this with system-config-network
    as well. Are you seeing something similar?

    

    Tim

    

    On 07/09/2012 10:13 AM, ?? wrote:
    
      
      
        Hi,

        

        My environment info:

        OS: CentOS 5.6

        Erlang: Compiled from otp_src_R15B01.tar.gz

        RabbitMQ: Compiled from rabbitmq-server-2.8.4.tar.gz

        

        ifconfig:

        eth0      Link encap:Ethernet  HWaddr 84:2B:2B:73:88:28  

                  inet addr:183.*.*.*  Bcast:183.60.44.127 
        Mask:255.255.255.192

                  UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1

                  RX packets:77904379 errors:0 dropped:0 overruns:0
        frame:0

                  TX packets:65643095 errors:0 dropped:0 overruns:0
        carrier:0

                  collisions:0 txqueuelen:1000 

                  RX bytes:11615134852 (10.8 GiB)  TX bytes:61820973373
        (57.5 GiB)

           &nb sp;      Interrupt:66 Memory:da000000-da012800 

        

        eth0:0    Link encap:Ethernet  HWaddr 84:2B:2B:73:88:28  

                  inet addr:112.*.*.*  Bcast:112.90.57.191 
        Mask:255.255.255.192

                  UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1

                  Interrupt:66 Memory:da000000-da012800 

        

        eth1      Link encap:Ethernet  HWaddr 84:2B:2B:73:88:29  

                  inet addr:10.20.30.1  Bcast:10.20.30.255 
        Mask:255.255.255.0

                  UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1

                  RX packets:94328707 errors:0 dropped:0 overruns:0
        frame:0

                   TX packets:78961028 errors:0 dropped:0 overruns:0
        carrier:0

                  collisions:0 txqueuelen:1000 

                  RX bytes:77337167993 (72.0 GiB)  TX bytes:15705231055
        (14.6 GiB)

                  Interrupt:74 Memory:dc000000-dc012800 

        

        eth1:1    Link encap:Ethernet  HWaddr 84:2B:2B:73:88:29  

                  inet addr:10.20.30.251  Bcast:10.20.30.255 
        Mask:255.255.255.0

                  UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1

                  Interrupt:74 Memory:dc000000-dc012800 

        

        lo        Link encap:Local Loopback  

                   inet addr:127.0.0.1  Mask:255.0.0.0

                  UP LOOPBACK RUNNING  MTU:16436  Metric:1

                  RX packets:2530738 errors:0 dropped:0 overruns:0
        frame:0

                  TX packets:2530738 errors:0 dropped:0 overruns:0
        carrier:0

                  collisions:0 txqueuelen:0 

                  RX bytes:155346660 (148.1 MiB)  TX bytes:155346660
        (148.1 MiB)

        

        

        Thank you again.

        

        

        He Bin

        

        

        
          From: watson.timothy at gmail.com

          Date: Mon, 9 Jul 2012 10:00:33 +0100

          CC: rabbitmq-discuss at lists.rabbitmq.com

          To: rabbitmq-discuss at lists.rabbitmq.com

          Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD:
          Non-local peer connected

          

          What OS and rabbit version are you running? I've not seen
            this happen before but I'll investigate.

            

          
          On 9 Jul 2012, at 07:32, ?? <hebin7611 at hotmail.com>
            wrote:

            

          
          
            
              
              
                

                Hi Tim,

                

                Thanks for your reply.

                

                I tried "erl -sname rabbit", it's OK.

                

                my /etc/hosts looks like following:

                127.0.0.1    game-01 ZSWY76 localhost.localdomain
                localhost

                ::1        localhost6.localdomain6 localhost6

                

                EPMD can be started successfully, but always reports
                "Non-local peer connected" then force disconnecting
                rabbit-server.

                

                Did I forget any necessory configration for RabbitMQ to
                use loopback interface to connect epmd?

                

                Thanks a lot.

                

                He Bin

                

                

                > Date: Fri, 6 Jul 2012 18:34:07 +0100

                  > From: tim at rabbitmq.com

                  > To: rabbitmq-discuss at lists.rabbitmq.com

                  > CC: hebin7611 at hotmail.com

                  > Subject: Re: [rabbitmq-discuss] Plz give me help
                  about EPMD: Non-local peer conne cted

                  > 

                  > Hi there,

                  > 

                  > On 06/07/2012 06:53, ?? wrote:

                  > > Hi all,

                  > >

                  > > I installed RabbotMQ & tried to start
                  it.

                  > >

                  > > But I always got error as following:

                  > >

                  > 

                  > Ok so first of all, let's see if we can get you
                  to start a stand alone 

                  > distributed Erlang node successfully. Normally
                  stack traces like that 

                  > occur when the host environment isn't set up
                  quite right (from Erlang's 

                  > perspective).

                  > 

                  > We need to be able to run `erl -sname rabbit` on
                  the command line and 

                  > see the Erlang emulator start successfully. It
                  should look something 

                  > like this:

                  > 

                  > ##############

                  > 

                  > t4 at malachi:systest $ erl -sname rabbit

                  > Erlang R15B01 (erts-5.9.1) [source] [64-bit]
                  [smp:2:2] [async-threads:0] 

                  > [hipe] [kernel-poll:false]

                  > 

                  > Eshell V5.9.1 (abort with ^G)

                  > (rabbit at malachi)1>

                  > 

                  > ##############

                  > 

                  > Can you start Erlang like that successfully? I'm
                  assuming not, but 

                  > please let us k now.

                  > 

                  > I'm also interested in understanding what your
                  hosts configuration 

                  > (e.g., /etc/hosts) looks like. On some Operating
                  Systems (such as CentOS 

                  > for example), failing to set an explicit host
                  name prevents you from 

                  > starting a distributed Erlang node.

                  > 

                  > >
                  {error_logger,{{2012,7,6},{13,32,21}},"Protocol: ~p:
                  register error:

                  > >
~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,"inet_tcp_dist.erl"},{line,70}]},{net_kernel,start_protos,4,[{file,"net_kernel.erl"},{line,1314}]},{net_kernel,start_protos,3,[{file,"net_kernel.erl"},{line,1307}]},{net_kernel,init_node,2,[{file,"net_kernel.erl"},{line,1197}]},{net_kernel,init,1,[{file,"net_kernel.erl"},{line,357}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}]}

                  > >
                  {error_logger,{{2012,7,6},{13,32,21}},crash_report,[[{initial_call,{net_kernel,init,

['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancest

                  > >
ors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.90>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,551}],[]]}

                  > >
{error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch1077,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}

                  > >
                  {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},

{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}

                  > >
{error_logger,{{2012,7,6},{13,32,21}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}

                  > > {"Kern el pid

                  > >
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

                  > >

                  > > Crash dump was written to: erl_crash.dump

                  > > Kernel pid terminated
                  (application_controller)

                  > >
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})

                  > >

                  > >

                  > > I ran it on a server with public IP
                  183.*.*.* .

                  > >

                  > > In Erlang src, I found that epmd checks
                  connection src.

                  > >

                  > > /* Determine if connection is from localhost
                  */

                  > > if (getpeername(s->fd,(struct sockaddr*)
                  &si,&st) ||

                  > > s t < sizeof(si)) {

                  > > /* Failure to get peername is regarded as
                  non local host */

                  > > s->local_peer = EPMD_FALSE;

                  > > } else {

                  > > /* Only 127.x.x.x and connections from the
                  host's IP address

                  > > allowed, no false positives */

                  > > s->local_peer =

                  > > (((((unsigned) ntohl(si.sin_addr.s_addr))
                  & 0xFF000000U) ==

                  > > 0x7F000000U) ||

                  > > (getsockname(s->fd,(struct sockaddr*)
                  &di,&st) ?

                  > > EPMD_FALSE : si.sin_addr.s_addr == di.s
                  in_addr.s_addr));

                  > > }

                  > > dbg_tty_printf(g,2,(s->local_peer) ?
                  "Local peer connected" :

                  > > "Non-local peer connected");

                  > >

                  > >

                  > > But unfortunately, si.sin_addr.s_addr was
                  183.*.*.*, while

                  > > di.sin_addr.s_addr was 127.0.0.1

                  > >

                  & amp; gt; > My log?Checking peer address,
                  getsockname ret: 0, si_addr=0xb7??????,

                  > > di_addr=0x7f000001

                  > >

                  > >

                  > 

                  > I could be wrong, but I suspect this is a red
                  herring. You can restart 

                  > epmd with -d to get debugging information as
                  well, but I suspect this 

                  > isn't relevant.

                  > 

                  > Is there any way to force RabbitMQ server connect
                  epmd via a specified

                  > > address?

                  > >

                  > 

                  > I'm not really sure what you mean by this, but
                  I'm fairly confident that 

                  > it is not necessary to even attempt to do
                  something like that. Erlang 

                  > should be able to start up nodes with `-sname
                  <name>` or `-name 

                  > <name>@<host>` and if either doesn't
                  work, a little tweaking of the host 

                  > configuration should solve it.

                  > 

                  > Based on your original comment (starting rabbitmq
                  but always getting an 

                  > error) my understanding is that you're trying to
                  start rabbit on this 

                  > machine and it fails. AFAIK when a distributed
                  Erlang node connects to 

                  > EPMD on the localhost it should be treated as
                  such. The rabbitmq-server 

                  > script starts rabbit up with `-sname rabbit`
                  which implies that the node 

                  > name will be rabbit@<hostname> so you
                  should make sure that `erl -sname 

                  > rabbit` works first of all.

                
              
            
          
          
            _______________________________________________

              rabbitmq-discuss mailing list

              rabbitmq-discuss at lists.rabbitmq.com

              https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

            
          
          

          _______________________________________________
          rabbitmq-discuss mailing list
          rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
      
      

      
      

      _______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

    
    
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/0c9a0ff7/attachment.htm>

From emile at rabbitmq.com  Mon Jul  9 10:45:11 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 09 Jul 2012 10:45:11 +0100
Subject: [rabbitmq-discuss] Can't cluster 2 computers - "distribution
 port" changes on restart - how do I fix it to a certain port?
In-Reply-To: <fc73231c-36f9-4232-86d9-d511aa35a5fb@googlegroups.com>
References: <fc73231c-36f9-4232-86d9-d511aa35a5fb@googlegroups.com>
Message-ID: <4FFAA827.4080606@rabbitmq.com>


Hi,

On 07/07/12 11:55, Navigateur wrote:
> Have a firewall so I need to pin the "distribution port" to a certain
> number (RabbitMQ changes it on restart). How do I do this in the latest
> version of RabbitMQ 2.7.1 and on Ubuntu Server (12.04)? Couldn't find
> the file which has the "SERVER_ERL_ARGS" setting specified. Brand new
> install of RabbitMQ.

You will need to constrain the inet_dist_listen_min and
inet_dist_listen_max kernel app settings. More details can be found here:

http://www.rabbitmq.com/clustering.html#firewall

For an example of a configuration file that specifies a distribution
port range see

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-June/007616.html

It is possible to specify this using the RABBITMQ_SERVER_ERL_ARGS
environment variable, but I would recommend using the config file instead.


-Emile


From simon at rabbitmq.com  Mon Jul  9 11:04:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 09 Jul 2012 11:04:36 +0100
Subject: [rabbitmq-discuss] Startup error
In-Reply-To: <CAHFJS_V69x7WmnE_XzFR+nPzfFXJdZhR02jpYAwT7vz1QokNoA@mail.gmail.com>
References: <CAHFJS_V69x7WmnE_XzFR+nPzfFXJdZhR02jpYAwT7vz1QokNoA@mail.gmail.com>
Message-ID: <4FFAACB4.1070303@rabbitmq.com>

On 09/07/12 08:54, Micha? Ki?dy? wrote:
> What happened? IHMO It looks like management plugin problem.

Hi. Thanks for the bug report, I'll look into it. Does this happen 
consistently? Is this in a cluster?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Mon Jul  9 11:24:33 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 09 Jul 2012 11:24:33 +0100
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>,
	<4FFAA1C2.4080006@rabbitmq.com>
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>
Message-ID: <4FFAB161.4080605@rabbitmq.com>

What does `env hostname` return on your system and is there a difference 
in starting erlang with -sname rabbit and -sname rabbit@`env hostname` ?

On 07/09/2012 10:27 AM, ?? wrote:
> Hi,
>
> [root at game-01 woyogame]# cat /etc/hosts
> # Do not remove the following line, or various programs
> # that require network functionality will fail.
> 127.0.0.1    game-01 ZSWY76 localhost.localdomain localhost
> ::1        localhost6.localdomain6 localhost6
>
>
> [root at game-01 woyogame]# cat /etc/sysconfig/network
> NETWORKING=yes
> NETWORKING_IPV6=no
> HOSTNAME=game-01
> GATEWAY=183.*.*.*
>
>
> It seems OK.
>
> He Bin
>
>
> ------------------------------------------------------------------------
> Date: Mon, 9 Jul 2012 10:17:54 +0100
> From: tim at rabbitmq.com
> To: rabbitmq-discuss at lists.rabbitmq.com
> CC: hebin7611 at hotmail.com
> Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local 
> peer connected
>
> Ah ok great. I'm on CentOS 6, and I found that setting up the hostname 
> so that Erlang was *happy* with it took a bit of fiddling around.
>
> My configuration looks like this:
>
> t4 at iske $ cat /etc/hosts
> 127.0.0.1    localhost.localdomain localhost
> 127.0.0.1    iske
> ::1    localhost
>
> t4 at iske $ cat /etc/sysconfig/network
> NETWORKING=yes
> NETWORKING_IPV6=no
> HOSTNAME=iske
>
> You can check this with system-config-network as well. Are you seeing 
> something similar?
>
> Tim
>
> On 07/09/2012 10:13 AM, ?? wrote:
>
>     Hi,
>
>     My environment info:
>     OS: CentOS 5.6
>     Erlang: Compiled from otp_src_R15B01.tar.gz
>     RabbitMQ: Compiled from rabbitmq-server-2.8.4.tar.gz
>
>     ifconfig:
>     eth0      Link encap:Ethernet  HWaddr 84:2B:2B:73:88:28
>               inet addr:183.*.*.*  Bcast:183.60.44.127 
>     Mask:255.255.255.192
>               UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>               RX packets:77904379 errors:0 dropped:0 overruns:0 frame:0
>               TX packets:65643095 errors:0 dropped:0 overruns:0 carrier:0
>               collisions:0 txqueuelen:1000
>               RX bytes:11615134852 (10.8 GiB)  TX bytes:61820973373
>     (57.5 GiB)
>     &nb sp;      Interrupt:66 Memory:da000000-da012800
>
>     eth0:0    Link encap:Ethernet  HWaddr 84:2B:2B:73:88:28
>               inet addr:112.*.*.*  Bcast:112.90.57.191 
>     Mask:255.255.255.192
>               UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>               Interrupt:66 Memory:da000000-da012800
>
>     eth1      Link encap:Ethernet  HWaddr 84:2B:2B:73:88:29
>               inet addr:10.20.30.1  Bcast:10.20.30.255  Mask:255.255.255.0
>               UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>               RX packets:94328707 errors:0 dropped:0 overruns:0 frame:0
>                TX packets:78961028 errors:0 dropped:0 overruns:0 carrier:0
>               collisions:0 txqueuelen:1000
>               RX bytes:77337167993 (72.0 GiB)  TX bytes:15705231055
>     (14.6 GiB)
>               Interrupt:74 Memory:dc000000-dc012800
>
>     eth1:1    Link encap:Ethernet  HWaddr 84:2B:2B:73:88:29
>               inet addr:10.20.30.251  Bcast:10.20.30.255 
>     Mask:255.255.255.0
>               UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>               Interrupt:74 Memory:dc000000-dc012800
>
>     lo        Link encap:Local Loopback
>                inet addr:127.0.0.1  Mask:255.0.0.0
>               UP LOOPBACK RUNNING  MTU:16436  Metric:1
>               RX packets:2530738 errors:0 dropped:0 overruns:0 frame:0
>               TX packets:2530738 errors:0 dropped:0 overruns:0 carrier:0
>               collisions:0 txqueuelen:0
>               RX bytes:155346660 (148.1 MiB)  TX bytes:155346660
>     (148.1 MiB)
>
>
>     Thank you again.
>
>
>     He Bin
>
>
>     ------------------------------------------------------------------------
>     From: watson.timothy at gmail.com <mailto:watson.timothy at gmail.com>
>     Date: Mon, 9 Jul 2012 10:00:33 +0100
>     CC: rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     To: rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD:
>     Non-local peer connected
>
>     What OS and rabbit version are you running? I've not seen this
>     happen before but I'll investigate.
>
>     On 9 Jul 2012, at 07:32, ?? <hebin7611 at hotmail.com
>     <mailto:hebin7611 at hotmail.com>> wrote:
>
>
>         Hi Tim,
>
>         Thanks for your reply.
>
>         I tried "erl -sname rabbit", it's OK.
>
>         my /etc/hosts looks like following:
>         127.0.0.1    game-01 ZSWY76 localhost.localdomain localhost
>         ::1        localhost6.localdomain6 localhost6
>
>         EPMD can be started successfully, but always reports
>         "Non-local peer connected" then force disconnecting rabbit-server.
>
>         Did I forget any necessory configration for RabbitMQ to use
>         loopback interface to connect epmd?
>
>         Thanks a lot.
>
>         He Bin
>
>
>         > Date: Fri, 6 Jul 2012 18:34:07 +0100
>         > From: tim at rabbitmq.com <mailto:tim at rabbitmq.com>
>         > To: rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         > CC: hebin7611 at hotmail.com <mailto:hebin7611 at hotmail.com>
>         > Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD:
>         Non-local peer conne cted
>         >
>         > Hi there,
>         >
>         > On 06/07/2012 06:53, ?? wrote:
>         > > Hi all,
>         > >
>         > > I installed RabbotMQ & tried to start it.
>         > >
>         > > But I always got error as following:
>         > >
>         >
>         > Ok so first of all, let's see if we can get you to start a
>         stand alone
>         > distributed Erlang node successfully. Normally stack traces
>         like that
>         > occur when the host environment isn't set up quite right
>         (from Erlang's
>         > perspective).
>         >
>         > We need to be able to run `erl -sname rabbit` on the command
>         line and
>         > see the Erlang emulator start successfully. It should look
>         something
>         > like this:
>         >
>         > ##############
>         >
>         > t4 at malachi:systest $ erl -sname rabbit
>         > Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:2:2]
>         [async-threads:0]
>         > [hipe] [kernel-poll:false]
>         >
>         > Eshell V5.9.1 (abort with ^G)
>         > (rabbit at malachi)1>
>         >
>         > ##############
>         >
>         > Can you start Erlang like that successfully? I'm assuming
>         not, but
>         > please let us k now.
>         >
>         > I'm also interested in understanding what your hosts
>         configuration
>         > (e.g., /etc/hosts) looks like. On some Operating Systems
>         (such as CentOS
>         > for example), failing to set an explicit host name prevents
>         you from
>         > starting a distributed Erlang node.
>         >
>         > > {error_logger,{{2012,7,6},{13,32,21}},"Protocol: ~p:
>         register error:
>         > >
>         ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,"inet_tcp_dist.erl"},{line,70}]},{net_kernel,start_protos,4,[{file,"net_kernel.erl"},{line,1314}]},{net_kernel,start_protos,3,[{file,"net_kernel.erl"},{line,1307}]},{net_kernel,init_node,2,[{file,"net_kernel.erl"},{line,1197}]},{net_kernel,init,1,[{file,"net_kernel.erl"},{line,357}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}]}
>         > >
>         {error_logger,{{2012,7,6},{13,32,21}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancest
>         > >
>         ors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.90>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,551}],[]]}
>         > >
>         {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch1077,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>         > >
>         {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>         > >
>         {error_logger,{{2012,7,6},{13,32,21}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>         > > {"Kern el pid
>         > >
>         terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>         > >
>         > > Crash dump was written to: erl_crash.dump
>         > > Kernel pid terminated (application_controller)
>         > >
>         ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>         > >
>         > >
>         > > I ran it on a server with public IP 183.*.*.* .
>         > >
>         > > In Erlang src, I found that epmd checks connection src.
>         > >
>         > > /* Determine if connection is from localhost */
>         > > if (getpeername(s->fd,(struct sockaddr*) &si,&st) ||
>         > > s t < sizeof(si)) {
>         > > /* Failure to get peername is regarded as non local host */
>         > > s->local_peer = EPMD_FALSE;
>         > > } else {
>         > > /* Only 127.x.x.x and connections from the host's IP address
>         > > allowed, no false positives */
>         > > s->local_peer =
>         > > (((((unsigned) ntohl(si.sin_addr.s_addr)) & 0xFF000000U) ==
>         > > 0x7F000000U) ||
>         > > (getsockname(s->fd,(struct sockaddr*) &di,&st) ?
>         > > EPMD_FALSE : si.sin_addr.s_addr == di.s in_addr.s_addr));
>         > > }
>         > > dbg_tty_printf(g,2,(s->local_peer) ? "Local peer connected" :
>         > > "Non-local peer connected");
>         > >
>         > >
>         > > But unfortunately, si.sin_addr.s_addr was 183.*.*.*, while
>         > > di.sin_addr.s_addr was 127.0.0.1
>         > >
>         & amp; gt; > My log?Checking peer address, getsockname ret:
>         0, si_addr=0xb7??????,
>         > > di_addr=0x7f000001
>         > >
>         > >
>         >
>         > I could be wrong, but I suspect this is a red herring. You
>         can restart
>         > epmd with -d to get debugging information as well, but I
>         suspect this
>         > isn't relevant.
>         >
>         > Is there any way to force RabbitMQ server connect epmd via a
>         specified
>         > > address?
>         > >
>         >
>         > I'm not really sure what you mean by this, but I'm fairly
>         confident that
>         > it is not necessary to even attempt to do something like
>         that. Erlang
>         > should be able to start up nodes with `-sname <name>` or `-name
>         > <name>@<host>` and if either doesn't work, a little tweaking
>         of the host
>         > configuration should solve it.
>         >
>         > Based on your original comment (starting rabbitmq but always
>         getting an
>         > error) my understanding is that you're trying to start
>         rabbit on this
>         > machine and it fails. AFAIK when a distributed Erlang node
>         connects to
>         > EPMD on the localhost it should be treated as such. The
>         rabbitmq-server
>         > script starts rabbit up with `-sname rabbit` which implies
>         that the node
>         > name will be rabbit@<hostname> so you should make sure that
>         `erl -sname
>         > rabbit` works first of all.
>
>         _______________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>     _______________________________________________ rabbitmq-discuss
>     mailing list rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com  <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/75f4d145/attachment.htm>

From sanjiv.kumar.jha at accenture.com  Mon Jul  9 11:38:07 2012
From: sanjiv.kumar.jha at accenture.com (sanjiv.kumar.jha at accenture.com)
Date: Mon, 9 Jul 2012 10:38:07 +0000
Subject: [rabbitmq-discuss] rabbitmq server slows down for cluster set up -
 (multiple stop_app scenario)
Message-ID: <EEA1DC407D5C23479BEAAF68C3D560400531A157@048-CH1MPN1-213.048d.mgd.msft.net>

Hi,

We have a RabbitMQ cluster of 2 nodes (say NODE-A and NODE-B) having mirrored queues running on 2 separate Linux servers.
We've multiple clients connecting to RabbitMQ cluster.
If NODE-A is brought down, the clients are able to connect to NODE-B successfully; no issues observed till this point.
Now if NODE-A is brought up and NODE-B is brought down, the rabbitmq server tends to slow down and does not even respond to simple command like rabbitmqctl list_queues - keeps waiting endlessly.

Please let us know, if there any clues or ideas to rectify this issue.

Thanks
Sanjiv.

________________________________
Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
______________________________________________________________________________________

www.accenture.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/3278c403/attachment.htm>

From hebin7611 at hotmail.com  Mon Jul  9 11:50:00 2012
From: hebin7611 at hotmail.com (=?gb2312?B?us6x8w==?=)
Date: Mon, 9 Jul 2012 18:50:00 +0800
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <4FFAB161.4080605@rabbitmq.com>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>,
	<4FFAA1C2.4080006@rabbitmq.com>
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>,
	<4FFAB161.4080605@rabbitmq.com>
Message-ID: <SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>


Hi Tim,

`env hostname` returns game-01.
No other epmd daemon runs, it's started by RabbitMQ automatically.
The same error occurs if start epmd manually by 'epmd -d -d -d' then run RabbitMQ.

Thanks!

He Bin


Date: Mon, 9 Jul 2012 11:24:33 +0100
From: tim at rabbitmq.com
To: rabbitmq-discuss at lists.rabbitmq.com
CC: hebin7611 at hotmail.com
Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected


  
    
  
  
    What does `env hostname` return on your system and is there a
    difference in starting erlang with -sname rabbit and -sname
    rabbit@`env hostname` ?

    

    On 07/09/2012 10:27 AM, ?? wrote:
    
      
      
        Hi,

        

        [root at game-01 woyogame]# cat /etc/hosts

        # Do not remove the following line, or various programs

        # that require network functionality will fail.

        127.0.0.1    game-01 ZSWY76 localhost.localdomain localhost

        ::1        localhost6.localdomain6 localhost6

        

        

        [root at game-01 woyogame]# cat /etc/sysconfig/network

        NETWORKING=yes

        NETWORKING_IPV6=no

        HOSTNAME=game-01

        GATEWAY=183.*.*.*

        

        

        It seems OK.

        

        He Bin

        

        

        
          Date: Mon, 9 Jul 2012 10:17:54 +0100

          From: tim at rabbitmq.com

          To: rabbitmq-discuss at lists.rabbitmq.com

          CC: hebin7611 at hotmail.com

          Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD:
          Non-local peer connected

          

          Ah ok great. I'm on CentOS 6, and I found that setting up the
          hostname so that Erlang was *happy* with it took a bit of
          fiddling around.

          

          My configuration looks like this:

          

          t4 at iske $ cat /etc/hosts

          127.0.0.1    localhost.localdomain localhost

          127.0.0.1    iske

          ::1    localhost

          

          t4 at iske $ cat /etc/sysconfig/network

          NETWORKING=yes

          NETWORKING_IPV6=no

          HOSTNAME=iske

          

          You can check this with system-config-network as well. Are you
          seeing something similar?

          

          Tim

          

          On 07/09/2012 10:13 AM, ?? wrote:
          
            
             Hi,

              

              My environment info:

              OS: CentOS 5.6

              Erlang: Compiled from otp_src_R15B01.tar.gz

              RabbitMQ: Compiled from rabbitmq-server-2.8.4.tar.gz

              

              ifconfig:

              eth0      Link encap:Ethernet  HWaddr 84:2B:2B:73:88:28  

                        inet addr:183.*.*.*  Bcast:183.60.44.127 
              Mask:255.255.255.192

                        UP BROADCAST RUNNING MULTICAST  MTU:1500 
              Metric:1

                        RX packets:77904379 errors:0 dropped:0
              overruns:0 frame:0

                        TX packets:65643095 errors:0 dropped:0
              overruns:0 carrier:0

                        collisions:0 txqueuelen:1000 

                        RX bytes:11615134852 (10.8 GiB)  TX
              bytes:61820973373 (57.5 GiB)

                 &nb sp;      Interrupt:66 Memory:da000000-da012800
              

              

              eth0:0    Link encap:Ethernet  HWaddr 84:2B:2B:73:88:28  

                        inet addr:112.*.*.*  Bcast:112.90.57.191 
              Mask:255.255.255.192

                        UP BROADCAST RUNNING MULTICAST  MTU:1500 
              Metric:1

                        Interrupt:66 Memory:da000000-da012800 

              

              eth1      Link encap:Ethernet  HWaddr 84:2B:2B:73:88:29  

                        inet addr:10.20.30.1  Bcast:10.20.30.255 
              Mask:255.255.255.0

                        UP BROADCAST RUNNING MULTICAST  MTU:1500 
              Metric:1

                        RX packets:94328707 errors:0 dropped:0
              overruns:0 frame:0

                         TX packets:78961028 errors:0 dropped:0
              overruns:0 carrier:0

                        collisions:0 txqueuelen:1000 

                        RX bytes:77337167993 (72.0 GiB)  TX
              bytes:15705231055 (14.6 GiB)

                        Interrupt:74 Memory:dc000000-dc012800 

              

              eth1:1    Link encap:Ethernet  HWaddr 84:2B:2B:73:88:29  

                        inet addr:10.20.30.251  Bcast:10.20.30.255 
              Mask:255.255.255.0

                        UP BROADCAST RUNNING MULTICAST  MTU:1500 
              Metric:1

                        Interrupt:74 Memory:dc000000-dc012800 

              

              lo        Link encap:Local Loopback  

                         inet addr:127.0.0.1  Mask:255.0.0.0

                        UP LOOPBACK RUNNING  MTU:16436  Metric:1

                        RX packets:2530738 errors:0 dropped:0 overruns:0
              frame:0

                        TX packets:2530738 errors:0 dropped:0 overruns:0
              carrier:0

                        collisions:0 txqueuelen:0 

                        RX bytes:155346660 (148.1 MiB)  TX
              bytes:155346660 (148.1 MiB)

              

              

              Thank you again.

              

              

              He Bin

              

              

              
                From: watson.timothy at gmail.com

                Date: Mon, 9 Jul 2012 10:00:33 +0100

                CC: rabbitmq-discuss at lists.rabbitmq.com

                To: rabbitmq-discuss at lists.rabbitmq.com

                Subject: Re: [rabbitmq-discuss] Plz give me help about
                EPMD: Non-local peer connected

                

                What OS and rabbit version are you running? I've
                  not seen this happen before but I'll investigate.

                  

                
                On 9 Jul 2012, at 07:32, ?? <hebin7611 at hotmail.com>

                  wrote:

                  

                
                
                  
                    
                     

                      Hi Tim,

                      

                      Thanks for your reply.

                      

                      I tried "erl -sname rabbit", it's OK.

                      

                      my /etc/hosts looks like following:

                      127.0.0.1    game-01 ZSWY76 localhost.localdomain
                      localhost

                      ::1        localhost6.localdomain6 localhost6

                      

                      EPMD can be started successfully, but always
                      reports "Non-local peer connected" then force
                      disconnecting rabbit-server.

                      

                      Did I forget any necessory configration for
                      RabbitMQ to use loopback interface to connect
                      epmd?

                      

                      Thanks a lot.

                      

                      He Bin

                      

                      

                      > Date: Fri, 6 Jul 2012 18:34:07 +0100

                        > From: tim at rabbitmq.com

                        > To: rabbitmq-discuss at lists.rabbitmq.com

                        > CC: hebin7611 at hotmail.com

                        > Subject: Re: [rabbitmq-discuss] Plz give me
                        help about EPMD: Non-local peer conne cted

                        > 

                        > Hi there,

                        > 

                        > On 06/07/2012 06:53, ?? wrote:

                        > > Hi all,

                        > >

                        > > I installed RabbotMQ & tried to
                        start it.

                        > >

                        > > But I always got error as following:

                        > >

                        > 

                        > Ok so first of all, let's see if we can get
                        you to start a stand alone 

                        > distributed Erlang node successfully.
                        Normally stack traces like that 

                        > occur when the host environment isn't set
                        up quite right (from Erlang's 

                        > perspective).

                        > 

                        > We need to be able to run `erl -sname
                        rabbit` on the command line and 

                        > see the Erlang emulator start successfully.
                        It should look something 

                        > like this:

                        > 

                        > ##############

                        > 

                        > t4 at malachi:systest $ erl -sname rabbit

                        > Erlang R15B01 (erts-5.9.1) [source]
                        [64-bit] [smp:2:2] [async-threads:0] 

                        > [hipe] [kernel-poll:false]

                        > 

                        > Eshell V5.9.1 (abort with ^G)

                        > (rabbit at malachi)1>

                        > 

                        > ##############

                        > 

                        > Can you start Erlang like that
                        successfully? I'm assuming not, but 

                        > please let us k now.

                        > 

                        > I'm also interested in understanding what
                        your hosts configuration 

                        > (e.g., /etc/hosts) looks like. On some
                        Operating Systems (such as CentOS 

                        > for example), failing to set an explicit
                        host name prevents you from 

                        > starting a distributed Erlang node.

                        > 

                        > >
                        {error_logger,{{2012,7,6},{13,32,21}},"Protocol:
                        ~p: register error:

                        > >
~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,"inet_tcp_dist.erl"},{line,70}]},{net_kernel,start_protos,4,[{file,"net_kernel.erl"},{line,1314}]},{net_kernel,start_protos,3,[{file,"net_kernel.erl"},{line,1307}]},{net_kernel,init_node,2,[{file,"net_kernel.erl"},{line,1197}]},{net_kernel,init,1,[{file,"net_kernel.erl"},{line,357}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}]}

                        > >
{error_logger,{{2012,7,6},{13,32,21}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancest

                        > >
ors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.90>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,551}],[]]}

                        > >
{error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch1077,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}

                        > >
{error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}

                        > >
{error_logger,{{2012,7,6},{13,32,21}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}

                        > > {"Kern el pid

                        > >
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

                        > >

                        > > Crash dump was written to:
                        erl_crash.dump

                        > > Kernel pid terminated
                        (application_controller)

                        > >
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})

                        > >

                        > >

                        > > I ran it on a server with public IP
                        183.*.*.* .

                        > >

                        > > In Erlang src, I found that epmd
                        checks connection src.

                        > >

                        > > /* Determine if connection is from
                        localhost */

                        > > if (getpeername(s->fd,(struct
                        sockaddr*) &si,&st) ||

                        > > s t < sizeof(si)) {

                        > > /* Failure to get peername is regarded
                        as non local host */

                        > > s->local_peer = EPMD_FALSE;

                        > > } else {

                        > > /* Only 127.x.x.x and connections from
                        the host's IP address

                        > > allowed, no false positives */

                        > > s->local_peer =

                        > > (((((unsigned)
                        ntohl(si.sin_addr.s_addr)) & 0xFF000000U) ==

                        > > 0x7F000000U) ||

                        > > (getsockname(s->fd,(struct
                        sockaddr*) &di,&st) ?

                        > > EPMD_FALSE : si.sin_addr.s_addr ==
                        di.s in_addr.s_addr));

                        > > }

                        > > dbg_tty_printf(g,2,(s->local_peer)
                        ? "Local peer connected" :

                        > > "Non-local peer connected");

                        > >

                        > >

                        > > But unfortunately, si.sin_addr.s_addr
                        was 183.*.*.*, while

                        > > di.sin_addr.s_addr was 127.0.0.1

                        > >

                        & amp; gt; > My log?Checking peer
                        address, getsockname ret: 0, si_addr=0xb7??????,

                        > > di_addr=0x7f000001

                        > >

                        > >

                        > 

                        > I could be wrong, but I suspect this is a
                        red herring. You can restart 

                        > epmd with -d to get debugging information
                        as well, but I suspect this 

                        > isn't relevant.

                        > 

                        > Is there any way to force RabbitMQ server
                        connect epmd via a specified

                        > > address?

                        > >

                        > 

                        > I'm not really sure what you mean by this,
                        but I'm fairly confident that 

                        > it is not necessary to even attempt to do
                        something like that. Erlang 

                        > should be able to start up nodes with
                        `-sname <name>` or `-name 

                        > <name>@<host>` and if either
                        doesn't work, a little tweaking of the host 

                        > configuration should solve it.

                        > 

                        > Based on your original comment (starting
                        rabbitmq but always getting an 

                        > error) my understanding is that you're
                        trying to start rabbit on this 

                        > machine and it fails. AFAIK when a
                        distributed Erlang node connects to 

                        > EPMD on the localhost it should be treated
                        as such. The rabbitmq-server 

                        > script starts rabbit up with `-sname
                        rabbit` which implies that the node 

                        > name will be rabbit@<hostname> so you
                        should make sure that `erl -sname 

                        > rabbit` works first of all.

                      
                    
                  
                
                
                  _______________________________________________

                    rabbitmq-discuss mailing list

                    rabbitmq-discuss at lists.rabbitmq.com

                    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

                  
                
                

                _______________________________________________
                rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
                https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
            
            

            
            

            _______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

          
          

        
      
      

      
      

      _______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

    
    
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/d512ace5/attachment.htm>

From francesco at rabbitmq.com  Mon Jul  9 11:50:28 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 09 Jul 2012 11:50:28 +0100
Subject: [rabbitmq-discuss] rabbitmq server slows down for cluster set
	up - (multiple stop_app scenario)
In-Reply-To: <EEA1DC407D5C23479BEAAF68C3D560400531A157@048-CH1MPN1-213.048d.mgd.msft.net>
References: <EEA1DC407D5C23479BEAAF68C3D560400531A157@048-CH1MPN1-213.048d.mgd.msft.net>
Message-ID: <87liit2op7.wl%francesco@rabbitmq.com>

Hi Sanjiv,
At Mon, 9 Jul 2012 10:38:07 +0000,
sanjiv kumar jha wrote:
> Hi,
> 
> We have a RabbitMQ cluster of 2 nodes (say NODE-A and NODE-B) having mirrored
> queues running on 2 separate Linux servers.
> 
> We?ve multiple clients connecting to RabbitMQ cluster.
> 
> If NODE-A is brought down, the clients are able to connect to NODE-B
> successfully; no issues observed till this point.
> 
> Now if NODE-A is brought up and NODE-B is brought down, the rabbitmq server
> tends to slow down and does not even respond to simple command like
> rabbitmqctl list_queues ? keeps waiting endlessly.
> 
> Please let us know, if there any clues or ideas to rectify this issue.

I'm not sure I understand what you're doing. My understanding is that

  * You have node A and B clustered and with HA queues on them
  * You bring down A
  * You bring up A
  * You bring down B *after you brought up A*

Is that correct? If that the case, that should be fine. My fear is that you are
bringing down B before A has fully started, in which case A will wait endlessly
for B since it needs its tables to get the most up-to-date data.

If you are making sure that A is fully started before stopping B, then what you
are observing should not happen and more information would help to investigate -
logs and `rabbitctl status'.

--
Francesco * Often in error, never in doubt

From emile at rabbitmq.com  Mon Jul  9 12:03:08 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 09 Jul 2012 12:03:08 +0100
Subject: [rabbitmq-discuss] Question about HA configuration
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD5A9A4E20@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD5A993309@G9W0721.americas.hpqcorp.net>
	<4FF2BDA8.3000204@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD5A9A4E20@G9W0721.americas.hpqcorp.net>
Message-ID: <4FFABA6C.7000805@rabbitmq.com>

Hi Andrea,

On 03/07/12 16:49, Rosa, Andrea (HP Cloud Services) wrote:
>> Shared storage has little value if messages are not durable
> 
> If I use a shared storage to put mnesia DB the two nodes (Active and
> passive) share the same username, password, vhosts. Is that correct?

Yes.

> In this case that's a good point to use shared storage even if
> messages are not durable.

Well, Mnesia is a distributed database which it is capable of
replicating information across multiple nodes, but the design of a
single Active/Passive HA setup does not make use of this capability.



-Emile


From mvikasetc at gmail.com  Mon Jul  9 12:58:45 2012
From: mvikasetc at gmail.com (Vikas)
Date: Mon, 9 Jul 2012 07:58:45 -0400
Subject: [rabbitmq-discuss] Envelop redeliver question ( clustering ha
	redelivery question)
In-Reply-To: <4FFAA3F7.4040409@rabbitmq.com>
References: <d4ab5dd6-3062-4b23-a4dd-e6fcd7d97e35@h9g2000yqi.googlegroups.com>
	<4FFAA3F7.4040409@rabbitmq.com>
Message-ID: <D89A6D05-D388-4615-9BAC-23565316FB62@gmail.com>

Hi Emile ,

Thanks for your reply . I've set QoS prefetch count set to one.

The problem is observed in only one scenario 

Node1 and Node2 are running in cluster ha
Stop Node2
Start Node2
Restart Consumer
All old messages are received with redeliver as true .


Regards
Vikas

Sent from my iPhone

On Jul 9, 2012, at 5:27 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Vikas,
> 
> On 08/07/12 20:32, Vikas wrote:
>> Why the redelivery value is true when the messages were not even
>> attempted to ack by consumer.
> 
> If you want limit consumers to only one unacknowledged message at a time
> then set the QoS prefetch count to 1:
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos.prefetch-count
> 
> If the prefetch count is not limited then more than one message will
> potentially have the redelivered flag set after a connection interruption.
> 
> 
> -Emile
> 

From tim at rabbitmq.com  Mon Jul  9 13:16:18 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 09 Jul 2012 13:16:18 +0100
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>,
	<4FFAA1C2.4080006@rabbitmq.com>
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>,
	<4FFAB161.4080605@rabbitmq.com>
	<SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>
Message-ID: <4FFACB92.3040508@rabbitmq.com>

On 07/09/2012 11:50 AM, ?? wrote:
> Hi Tim,
>
> `env hostname` returns game-01.

So does erl -sname rabbit@`env hostname` work then!?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/eda9d327/attachment.htm>

From meetprashanth437 at gmail.com  Mon Jul  9 13:45:25 2012
From: meetprashanth437 at gmail.com (Prashanth M)
Date: Mon, 9 Jul 2012 08:45:25 -0400
Subject: [rabbitmq-discuss] How do i stop the erlang node but keep the
 rabbitmq server running.
In-Reply-To: <4FF72913.7060804@rabbitmq.com>
References: <CAE8G+ySK_X5eZUK5kdXNu+EG5aDFJPtAg96G9=xy6Hm8L3nEnw@mail.gmail.com>
	<4FF71D69.9080000@rabbitmq.com>
	<CAE8G+yQWAVbrsMMxh9LxLUgjtpzGjAReJr9_Fo1cM_2is5h4dw@mail.gmail.com>
	<CAE8G+yTw8isuNOLW5EW58tsFj0swA6AxVMd199pPTa8A_-MYzg@mail.gmail.com>
	<4FF72913.7060804@rabbitmq.com>
Message-ID: <CAE8G+yQuNyGGSiPJ=4fbOFeDkvptPP7v9UHdEvDZWy7rvJCokg@mail.gmail.com>

Hi Tim,

Yes, I am trying to see what happens if you've got two nodes and one goes
down. Clustering doc describes about the cluster setup, it does not tell
how to test the cluster
I have two nodes, when I bring down a node with rabbitmqctl stop_app, my
web app stops working. I am not sure what I am doing wrong. But I can see
that the queues are duplicated between two nodes. my web app pointing to
the stomp on the node that is brought down.

Thanks


On Fri, Jul 6, 2012 at 2:06 PM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Prashanth,
>
> Please keep replies on list, as I mentioned earlier (just before
> forgetting to do some myself!). :)
>
> On 06/07/2012 18:38, Prashanth M wrote:
>
>> correct me if i am wrong. We proved the reliability of rabbitmq, we are
>> planning to prove how clustering works out of box.
>>
>>
> Ok that's fine, but *what* about clustering do you need to prove for your
> architecture? Are you wanting to know what happens if you've got two nodes
> and one goes down? The idea is that all the relevant parts that should be
> present on all nodes, should survive a crash. As the list entry I referred
> you to in my previous mail states, you've got to be careful when using ram
> nodes, as you *can* get yourself into a situation where data loss is
> *possible* under those circumstances.
>
> Please read the clustering guide in detail and then feel free to come back
> ask any questions. If you want to stop rabbit on a node, without stopping
> the node itself, you'd use `rabbitmqctl stop_app` or `rabbitmqctl stop` to
> stop the rabbit application *and* the node.
>
> Tim
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/65122191/attachment.htm>

From tim at rabbitmq.com  Mon Jul  9 14:04:01 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 09 Jul 2012 14:04:01 +0100
Subject: [rabbitmq-discuss] How do i stop the erlang node but keep the
 rabbitmq server running.
In-Reply-To: <CAE8G+yQuNyGGSiPJ=4fbOFeDkvptPP7v9UHdEvDZWy7rvJCokg@mail.gmail.com>
References: <CAE8G+ySK_X5eZUK5kdXNu+EG5aDFJPtAg96G9=xy6Hm8L3nEnw@mail.gmail.com>
	<4FF71D69.9080000@rabbitmq.com>
	<CAE8G+yQWAVbrsMMxh9LxLUgjtpzGjAReJr9_Fo1cM_2is5h4dw@mail.gmail.com>
	<CAE8G+yTw8isuNOLW5EW58tsFj0swA6AxVMd199pPTa8A_-MYzg@mail.gmail.com>
	<4FF72913.7060804@rabbitmq.com>
	<CAE8G+yQuNyGGSiPJ=4fbOFeDkvptPP7v9UHdEvDZWy7rvJCokg@mail.gmail.com>
Message-ID: <4FFAD6C1.2050900@rabbitmq.com>

On 07/09/2012 01:45 PM, Prashanth M wrote:
> Hi Tim,
>
> Yes, I am trying to see what happens if you've got two nodes and one 
> goes down. Clustering doc describes about the cluster setup, it does 
> not tell how to test the cluster
> I have two nodes, when I bring down a node with rabbitmqctl stop_app, 
> my web app stops working. I am not sure what I am doing wrong. But I 
> can see that the queues are duplicated between two nodes. my web app 
> pointing to the stomp on the node that is brought down.
>

Maybe you should connect your web app to the node you're *not* bringing 
down? Reliable though Rabbit is, clustering does not magically relocate 
client connections when nodes go down.

HTH!

Tim

From emile at rabbitmq.com  Mon Jul  9 14:15:32 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 09 Jul 2012 14:15:32 +0100
Subject: [rabbitmq-discuss] Envelop redeliver question ( clustering ha
 redelivery question)
In-Reply-To: <D89A6D05-D388-4615-9BAC-23565316FB62@gmail.com>
References: <d4ab5dd6-3062-4b23-a4dd-e6fcd7d97e35@h9g2000yqi.googlegroups.com>
	<4FFAA3F7.4040409@rabbitmq.com>
	<D89A6D05-D388-4615-9BAC-23565316FB62@gmail.com>
Message-ID: <4FFAD974.8070404@rabbitmq.com>

Hi,

On 09/07/12 12:58, Vikas wrote:
> Thanks for your reply . I've set QoS prefetch count set to one.
> 
> The problem is observed in only one scenario 
> 
> Node1 and Node2 are running in cluster ha
> Stop Node2
> Start Node2
> Restart Consumer
> All old messages are received with redeliver as true .

How are you stopping the node? It is not clear from your last email
whether nodes are being shutdown cleanly or forcibly. Disregarding HA
for the moment, if the broker is stopped forcibly then all recovered
queues will have their contents set to redelivered. The information
about which messages were delivered is held in RAM, so when the broker
starts up after crashing it must assume that all messages could have
been delivered, hence a redelivered flag on all messages.

The situation with HA is different, because another node can take over
the master role. But if the last node is shut down uncleanly then you
can also observe all messages being marked redelivered after the node
starts up and the queue is recovered.

In the scenario you describe, I would expect Node1 to be the master for
all queues when Node2 stops, and any unacknowledged messages held by the
consumer when it disconnects to be have the redelivered flag set. Does
that match up with what you are seeing? I'm not sure what you mean by
"old messages" - does this refer to messages that have not been
delivered before?


-Emile



From meetprashanth437 at gmail.com  Mon Jul  9 16:36:15 2012
From: meetprashanth437 at gmail.com (Prashanth M)
Date: Mon, 9 Jul 2012 11:36:15 -0400
Subject: [rabbitmq-discuss] How do i stop the erlang node but keep the
 rabbitmq server running.
In-Reply-To: <4FFAD6C1.2050900@rabbitmq.com>
References: <CAE8G+ySK_X5eZUK5kdXNu+EG5aDFJPtAg96G9=xy6Hm8L3nEnw@mail.gmail.com>
	<4FF71D69.9080000@rabbitmq.com>
	<CAE8G+yQWAVbrsMMxh9LxLUgjtpzGjAReJr9_Fo1cM_2is5h4dw@mail.gmail.com>
	<CAE8G+yTw8isuNOLW5EW58tsFj0swA6AxVMd199pPTa8A_-MYzg@mail.gmail.com>
	<4FF72913.7060804@rabbitmq.com>
	<CAE8G+yQuNyGGSiPJ=4fbOFeDkvptPP7v9UHdEvDZWy7rvJCokg@mail.gmail.com>
	<4FFAD6C1.2050900@rabbitmq.com>
Message-ID: <CAE8G+ySsiw6crJGVE2R8Mok1VsSzXSUmCKW9xyxBXXJKOMv=Zw@mail.gmail.com>

Thanks, I got it.

On Mon, Jul 9, 2012 at 9:04 AM, Tim Watson <tim at rabbitmq.com> wrote:

> On 07/09/2012 01:45 PM, Prashanth M wrote:
>
>> Hi Tim,
>>
>> Yes, I am trying to see what happens if you've got two nodes and one goes
>> down. Clustering doc describes about the cluster setup, it does not tell
>> how to test the cluster
>> I have two nodes, when I bring down a node with rabbitmqctl stop_app, my
>> web app stops working. I am not sure what I am doing wrong. But I can see
>> that the queues are duplicated between two nodes. my web app pointing to
>> the stomp on the node that is brought down.
>>
>>
> Maybe you should connect your web app to the node you're *not* bringing
> down? Reliable though Rabbit is, clustering does not magically relocate
> client connections when nodes go down.
>
> HTH!
>
> Tim
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/ec0483cb/attachment.htm>

From meetprashanth437 at gmail.com  Mon Jul  9 16:57:47 2012
From: meetprashanth437 at gmail.com (Prashanth M)
Date: Mon, 9 Jul 2012 11:57:47 -0400
Subject: [rabbitmq-discuss] Adding a node to cluster
Message-ID: <CAE8G+ySBnku-5cYT2p+rFV8-uLABecKb9-qS7y3FJ+L1DuK7PA@mail.gmail.com>

Hi all,

I have a cluster, when I am trying to add a new node to the cluster, with
the cluster command. The command does not respond. It just hangs there.
I copied the same erlang cookie to the new node. Am I missing something.

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/e700b74e/attachment.htm>

From thiagoburgo at gmail.com  Mon Jul  9 21:53:32 2012
From: thiagoburgo at gmail.com (Thiago Burgo Belo)
Date: Mon, 9 Jul 2012 17:53:32 -0300
Subject: [rabbitmq-discuss] How Reopen a closed connection?
Message-ID: <CABjKUK8Fo8YJYsSb+8tw4w1HPXxsMXmCKrh-UYQ6rxstmmdPEg@mail.gmail.com>

Hi,

I implemented a IConnection Pool, to minimize overhead of connection
creation in .NET Client, but when the server which my connection was
connected down, I wanna detect and reconnect without remove and recreate my
connection.

This is possible? How?


Thanks,

Thiago Burgo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/fadd3aea/attachment.htm>

From galmok at gmail.com  Mon Jul  9 15:13:26 2012
From: galmok at gmail.com (Galmok)
Date: Mon, 9 Jul 2012 07:13:26 -0700 (PDT)
Subject: [rabbitmq-discuss] After waking from standby Rabbit uses 100%
	cpu (Windows)
In-Reply-To: <23f5d674-adf9-4068-9469-9ff18063db83@googlegroups.com>
References: <23f5d674-adf9-4068-9469-9ff18063db83@googlegroups.com>
Message-ID: <e4626e06-36fe-4bd5-a211-5afa708f7d04@googlegroups.com>

On Monday, 2 July 2012 07:44:03 UTC+2, Christian Pedersen wrote:
>
> This seems to be the only place to file a bug report:
>
> I'm running RabbitMQ 2.8.4 on Windows. After waking the system after a 
> standby, RabbitMQ will often use 100% cpu (1 full core).
>
> Please let me know if you need more info.
>
>
I experienced the same issue with 2.8.2. Changelog didn't mention anything 
regarding this issue so I'd expect this issue to remain in 2.8.4.

Could it be related to erlang?

 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/a041be65/attachment.htm>

From galmok at gmail.com  Mon Jul  9 15:25:29 2012
From: galmok at gmail.com (Galmok)
Date: Mon, 9 Jul 2012 07:25:29 -0700 (PDT)
Subject: [rabbitmq-discuss] Lockup in QueueDeclare()
Message-ID: <d0bc1129-b6a1-42b9-baed-3c46b4488ad1@googlegroups.com>

I have an issue with QueueDeclare locking up on me. It works fine for the 
most part, but eventually, it locks up (no error, just doesn't return). I 
have tried to find out where it happens and this is the spot:

When running:

channel.QueueDeclare()

RabbitMQ enters an idle state at the line marked below:

namespace RabbitMQ.Client.Impl
{
    public class SimpleBlockingRpcContinuation : IRpcContinuation
    {
        public virtual Command GetReply()
        {
====>>>     Either result = (Either)m_cell.Value;
            switch (result.Alternative)
...

Now, I call QueueDeclare() from a callback created like this (I receive a 
message from AMQP and create/bind to a new queue):

        public string subscribe(string routingKey, BasicDeliverEventHandler 
e )
        {
            lock (channel)
            {
                string queueName = channel.QueueDeclare();
                EventingBasicConsumer consumer = new 
EventingBasicConsumer();
                consumer.Received += e;
                string consumerTag = channel.BasicConsume(queueName, true, 
consumer); // true; noAck
                channel.QueueBind(queueName, ExchangeName, routingKey);
                return queueName;
            }
        }

Is it not allowed to create/bind to a new queue when being called from this 
callback? Can I avoid the lockup somehow?

I use 'lock' to avoid triggering the non-multithread safe .NET 
implementation. Could this be an issue here?

Any hints would be nice here.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/5f9594c6/attachment.htm>

From handerson.gomes at gmail.com  Mon Jul  9 17:01:53 2012
From: handerson.gomes at gmail.com (Handerson Gomes)
Date: Mon, 9 Jul 2012 09:01:53 -0700 (PDT)
Subject: [rabbitmq-discuss] big messages
In-Reply-To: <88d2eefe-cecc-4b89-9887-e7443d952807@googlegroups.com>
References: <88d2eefe-cecc-4b89-9887-e7443d952807@googlegroups.com>
Message-ID: <24537136-18d5-40dd-a3e6-f9fdf1318370@googlegroups.com>

1MB and 2MB are not really that large, unless the volume of messages is 
really high.
If you have enough memory in the broker, if the volume is appropriate for 
your network throughput and the number of cluster instances is not too big 
you should be fine.

This message thread have a really good discussion about this topic 
http://comments.gmane.org/gmane.comp.networking.rabbitmq.general/14665, 
although the message size they're discussing is between 100MB and 1GB.

Abra?os,
Handerson


On Friday, July 6, 2012 5:54:29 PM UTC-4, Fabio B. Silva wrote:
>
> Hi guys
>
> i'm doing a study for my company.
> we are thinking about use rabbitmq to transfer big messages..  (between 
> 1MB and 2 MB)
> Is there any restriction with big messages ?
>
>
> Thanks
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/024db802/attachment.htm>

From juan.cerezuela at gmail.com  Mon Jul  9 20:41:54 2012
From: juan.cerezuela at gmail.com (Caerbannog)
Date: Mon, 9 Jul 2012 12:41:54 -0700 (PDT)
Subject: [rabbitmq-discuss] JSON-RPC: RPC endpoint responds with "not found"
Message-ID: <34ca1fe7-68a5-4f01-8f52-9e880ce4f8c9@googlegroups.com>

When I open http://localhost:55670/rpc <http://smuc1697:55670/rpc>  in the 
browser I get a blank page with the text "Not found."

http://localhost:55670/ <http://smuc1697:55670/>  shows
RabbitMQ Web Server

Contexts available:

   - JSON-RPC: RPC endpoint <http://smuc1697:55670/rpc>
   - JSON-RPC: JavaScript library <http://smuc1697:55670/rabbitmq_lib>
   - JSON-RPC: examples <http://smuc1697:55670/rpc-examples>

 
How do I debug this problem?

rabbitmq_server 2.8.4 on Windows Server 2008 R2
Erlang OTP R15B01 (x64)

and enabled the following plugins:
[e] amqp_client
[e] mochiweb
[e] rabbitmq_jsonrpc
[e]rabbitmq_jsonrpc_channel
[E]rabbitmq_jsonrpc_channel_examples
[E]rabbitmq_mochiweb
[e] rfc4627_jsonrpc
[e]webmachine




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/dc006268/attachment.htm>

From meetprashanth437 at gmail.com  Mon Jul  9 23:48:21 2012
From: meetprashanth437 at gmail.com (Prashanth M)
Date: Mon, 9 Jul 2012 18:48:21 -0400
Subject: [rabbitmq-discuss] Adding a node to cluster
In-Reply-To: <CAE8G+ySBnku-5cYT2p+rFV8-uLABecKb9-qS7y3FJ+L1DuK7PA@mail.gmail.com>
References: <CAE8G+ySBnku-5cYT2p+rFV8-uLABecKb9-qS7y3FJ+L1DuK7PA@mail.gmail.com>
Message-ID: <CAE8G+ySF5Wk=kKZbtKY8X6J1STMtFjt7P198siXdXec2FaKu6w@mail.gmail.com>

I got it.

On Mon, Jul 9, 2012 at 11:57 AM, Prashanth M <meetprashanth437 at gmail.com>wrote:

> Hi all,
>
> I have a cluster, when I am trying to add a new node to the cluster, with
> the cluster command. The command does not respond. It just hangs there.
> I copied the same erlang cookie to the new node. Am I missing something.
>
> Thanks.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/5511dfb1/attachment.htm>

From matthias at rabbitmq.com  Tue Jul 10 06:39:33 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 10 Jul 2012 06:39:33 +0100
Subject: [rabbitmq-discuss] My cluter node (ram node) down in my
 performance test
In-Reply-To: <4FF76401.1020900@rabbitmq.com>
References: <CABjKUK9j23ia9foMSDUTBXa+y6-ypF86d6Wzy9PZr=dAkxG-7Q@mail.gmail.com>
	<4FF6F10F.6080107@rabbitmq.com>
	<CABjKUK_Bfdo=Au1CR440YcEWkB6vTts-Le6G1HVYo7QqRXrWhA@mail.gmail.com>
	<CABjKUK-8Gx_4Rt4Uu=VDg5-iXAHQ7HNUB=b8toeeCSdjBaO_zg@mail.gmail.com>
	<4FF76401.1020900@rabbitmq.com>
Message-ID: <4FFBC015.1090506@rabbitmq.com>

Thiago,

On 06/07/12 23:17, Matthias Radestock wrote:
> Thanks. You appear to have included the logs for the disk node twice
> whereas the logs for the ram node are missing. Do you have the latter?

any progress on this? I really want to get to the bottom of this.


Matthias.

From hebin7611 at hotmail.com  Tue Jul 10 09:44:15 2012
From: hebin7611 at hotmail.com (=?gb2312?B?us6x8w==?=)
Date: Tue, 10 Jul 2012 16:44:15 +0800
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <4FFACB92.3040508@rabbitmq.com>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>,
	<4FFAA1C2.4080006@rabbitmq.com>
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>,
	<4FFAB161.4080605@rabbitmq.com>
	<SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>,
	<4FFACB92.3040508@rabbitmq.com>
Message-ID: <SNT115-W689CDE2F99F25433D94CFA6D20@phx.gbl>



It failed as following:

[root at game-01 otp_src_R15B01]# erl -sname rabbit@`env hostname`
{error_logger,{{2012,7,10},{16,40,48}},"Protocol: ~p: register error: ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,"inet_tcp_dist.erl"},{line,70}]},{net_kernel,start_protos,4,[{file,"net_kernel.erl"},{line,1314}]},{net_kernel,start_protos,3,[{file,"net_kernel.erl"},{line,1307}]},{net_kernel,init_node,2,[{file,"net_kernel.erl"},{line,1197}]},{net_kernel,init,1,[{file,"net_kernel.erl"},{line,357}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}]}
{error_logger,{{2012,7,10},{16,40,48}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.54>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,499}],[]]}
{error_logger,{{2012,7,10},{16,40,48}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[['rabbit at game-01',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2012,7,10},{16,40,48}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2012,7,10},{16,40,48}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})


BTW, epmd reported:
epmd: Tue Jul 10 16:42:48 2012: Non-local peer connected


He Bin

Date: Mon, 9 Jul 2012 13:16:18 +0100
From: tim at rabbitmq.com
To: rabbitmq-discuss at lists.rabbitmq.com
CC: hebin7611 at hotmail.com
Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected


  
    
  
  
    On 07/09/2012 11:50 AM, ?? wrote:
    
      
      
        Hi Tim,

        

        `env hostname` returns game-01.

      
    
    

    So does erl -sname rabbit@`env hostname` work then!?

    
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/4cbeeb57/attachment.htm>

From matthias at rabbitmq.com  Tue Jul 10 09:52:33 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 10 Jul 2012 09:52:33 +0100
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <SNT115-W689CDE2F99F25433D94CFA6D20@phx.gbl>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>,
	<4FFAA1C2.4080006@rabbitmq.com>
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>,
	<4FFAB161.4080605@rabbitmq.com>
	<SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>,
	<4FFACB92.3040508@rabbitmq.com>
	<SNT115-W689CDE2F99F25433D94CFA6D20@phx.gbl>
Message-ID: <4FFBED51.3010508@rabbitmq.com>

On 10/07/12 09:44, ?? wrote:
>
> [erl -sname rabbit@`env hostname`] failed as following: [...]

When running
   erl -sname rabbit
what node name is shown at the Erlang prompt?

Matthias.

From tim at rabbitmq.com  Tue Jul 10 09:52:52 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 10 Jul 2012 09:52:52 +0100
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
	connected
In-Reply-To: <SNT115-W689CDE2F99F25433D94CFA6D20@phx.gbl>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>,
	<4FFAA1C2.4080006@rabbitmq.com>
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>,
	<4FFAB161.4080605@rabbitmq.com>
	<SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>,
	<4FFACB92.3040508@rabbitmq.com>
	<SNT115-W689CDE2F99F25433D94CFA6D20@phx.gbl>
Message-ID: <A1CE8B77-7E1C-4D9E-97CE-2152E9005727@rabbitmq.com>

Hi,

On 10 Jul 2012, at 09:44, ?? wrote:

> 
> It failed as following:
> 
> [root at game-01 otp_src_R15B01]# erl -sname rabbit@`env hostname`
> {error_logger,{{2012,7,10},{16,40,48}},"Protocol: ~p: register error: ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,"inet_tcp_dist.erl"},{line,70}]},{net_kernel,start_protos,4,[{file,"net_kernel.erl"},{line,1314}]},{net_kernel,start_protos,3,[{file,"net_kernel.erl"},{line,1307}]},{net_kernel,init_node,2,[{file,"net_kernel.erl"},{line,1197}]},{net_kernel,init,1,[{file,"net_kernel.erl"},{line,357}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}]}
> {error_logger,{{2012,7,10},{16,40,48}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,[net_sup,ker nel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.54>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,499}],[]]}
> {error_logger,{{2012,7,10},{16,40,48}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[['rabbit at game-01',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2012,7,10},{16,40,48}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2012,7,10},{16,40,48}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid terminated",applica tion_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
> 
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller) ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> 

My suspicion about this is that it relates to either

(a) having two host names in /etc/hosts
(b) multiple interfaces (are they bonded by any chance?)

I am going to try and replicate this behaviour on CentOS 6.2 this afternoon and once I've done that then I'll get back to you. 

> 
> BTW, epmd reported:
> epmd: Tue Jul 10 16:42:48 2012: Non-local peer connected
> 

This is all to do with epmd not recognising the node id (rabbit at game-01) AFAICT. Have you tried removing the second host ID from your /etc/hosts configuration? I don't actually think that's going to work, but it's worth a try - don't forget to restart (or otherwise refresh your session properly to pick up the changes).

> 
> He Bin
> 
> Date: Mon, 9 Jul 2012 13:16:18 +0100
> From: tim at rabbitmq.com
> To: rabbitmq-discuss at lists.rabbitmq.com
> CC: hebin7611 at hotmail.com
> Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected
> 
> On 07/09/2012 11:50 AM, ?? wrote:
> Hi Tim,
> 
> `env hostname` returns game-01.
> 
> So does erl -sname rabbit@`env hostname` work then!?
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/0e428fcc/attachment.htm>

From emile at rabbitmq.com  Tue Jul 10 10:06:48 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 10 Jul 2012 10:06:48 +0100
Subject: [rabbitmq-discuss] How Reopen a closed connection?
In-Reply-To: <CABjKUK8Fo8YJYsSb+8tw4w1HPXxsMXmCKrh-UYQ6rxstmmdPEg@mail.gmail.com>
References: <CABjKUK8Fo8YJYsSb+8tw4w1HPXxsMXmCKrh-UYQ6rxstmmdPEg@mail.gmail.com>
Message-ID: <4FFBF0A8.1090204@rabbitmq.com>

Hi,

On 09/07/12 21:53, Thiago Burgo Belo wrote:
> I implemented a IConnection Pool, to minimize overhead of connection
> creation in .NET Client, but when the server which my connection was
> connected down, I wanna detect and reconnect without remove and recreate
> my connection.

AMQP connections are relatively cheap compared to database connections,
therefore it is unusual to require pooling. There is no simple way of
resurrecting a closed connection. It will be simpler to replace the
closed connection with a new one.

-Emile


From emile at rabbitmq.com  Tue Jul 10 10:28:45 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 10 Jul 2012 10:28:45 +0100
Subject: [rabbitmq-discuss] Lockup in QueueDeclare()
In-Reply-To: <d0bc1129-b6a1-42b9-baed-3c46b4488ad1@googlegroups.com>
References: <d0bc1129-b6a1-42b9-baed-3c46b4488ad1@googlegroups.com>
Message-ID: <4FFBF5CD.9090405@rabbitmq.com>

Hi,

On 09/07/12 15:25, Galmok wrote:
> Now, I call QueueDeclare() from a callback

The .NET guide contains information about this in the section "2.9.
Threading, deadlocks, and associated restrictions on
consumers". It explains that "Only asynchronous AMQP operations without
content are safe for use within callbacks [...]". Queue declare (without
the no-wait option) is a synchronous operation (queue.declare followed
by queue.declare-ok), and therefore not allowed in callbacks.

The recommended approach is to use the QueueingBasicConsumer to make
sure deliveries are processed in an application thread.

The RabbitMQ Java client is free from this restriction, but the .NET
client lags behind in this respect.


-Emile



From emile at rabbitmq.com  Tue Jul 10 10:50:48 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 10 Jul 2012 10:50:48 +0100
Subject: [rabbitmq-discuss] .net: why main loop is not a background
	thread?
In-Reply-To: <CAFWGgNHe7z5=p2kcBwCJSjxFqCvg_7GL7c9R97Epv8xp2_Y9MQ@mail.gmail.com>
References: <CAFWGgNHe7z5=p2kcBwCJSjxFqCvg_7GL7c9R97Epv8xp2_Y9MQ@mail.gmail.com>
Message-ID: <4FFBFAF8.10707@rabbitmq.com>

Hi Vadim,

On 06/07/12 20:23, Vadim Chekan wrote:
> Are there any reasons why main loop thread can not be set to be background?

Yes, this has been identified as a possible improvement and one that we
plan to make, though it enjoys a relatively low priority.


-Emile



From simon at rabbitmq.com  Tue Jul 10 11:36:38 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Jul 2012 11:36:38 +0100
Subject: [rabbitmq-discuss] JSON-RPC: RPC endpoint responds with "not
 found"
In-Reply-To: <34ca1fe7-68a5-4f01-8f52-9e880ce4f8c9@googlegroups.com>
References: <34ca1fe7-68a5-4f01-8f52-9e880ce4f8c9@googlegroups.com>
Message-ID: <4FFC05B6.3050607@rabbitmq.com>

On 09/07/12 20:41, Caerbannog wrote:
> When I open http://localhost:55670/rpc <http://smuc1697:55670/rpc> in
> the browser I get a blank page with the text "Not found."

Believe it or not, that's what it should do. The /rpc endpoint i9s not 
designed to be used via a browser. The /rpc-examples path should work...

... however, in looking at this I noticed that it doesn't. It looks like 
rabbitmq-jsonrpc-channel is broken in 2.8.4 (hurrah for automated tests 
that have to run in a browser and not a CI server).

If you need to use rabbitmq-jsonrpc-channel you'll have to downgrade to 
2.8.2. Or slightly more favourably, you can extract the file 
"rfc4627_jsonrpc-2.8.2-git.ez" from 
http://www.rabbitmq.com/releases/rabbitmq-server/v2.8.2/rabbitmq-server-windows-2.8.2.zip 
and use that to replace the equivalent plugin in C:\Program 
Files\RabbitMQ Server\rabbitmq_server-2.8.4\plugins

Bah.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From michal at kiedys.net  Tue Jul 10 12:59:52 2012
From: michal at kiedys.net (=?ISO-8859-2?Q?Micha=B3_Ki=EAdy=B6?=)
Date: Tue, 10 Jul 2012 13:59:52 +0200
Subject: [rabbitmq-discuss] Startup error
In-Reply-To: <4FFAACB4.1070303@rabbitmq.com>
References: <CAHFJS_V69x7WmnE_XzFR+nPzfFXJdZhR02jpYAwT7vz1QokNoA@mail.gmail.com>
	<4FFAACB4.1070303@rabbitmq.com>
Message-ID: <CAHFJS_Ufrrc4oU+qO_dWYo6J3zRUE7mz0krQbk42vy2hLAZU2Q@mail.gmail.com>

Simon,

Yes - this is part of a two-node server cluster.
Does not start only when the rabbitmq_management plugin is enabled.

Regards,
MK

2012/7/9 Simon MacMullen <simon at rabbitmq.com>

> On 09/07/12 08:54, Micha? Ki?dy? wrote:
>
>> What happened? IHMO It looks like management plugin problem.
>>
>
> Hi. Thanks for the bug report, I'll look into it. Does this happen
> consistently? Is this in a cluster?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/134b59dc/attachment.htm>

From michal at kiedys.net  Tue Jul 10 14:29:55 2012
From: michal at kiedys.net (=?ISO-8859-2?Q?Micha=B3_Ki=EAdy=B6?=)
Date: Tue, 10 Jul 2012 15:29:55 +0200
Subject: [rabbitmq-discuss] Some bugs in management plugin and HA
Message-ID: <CAHFJS_Vb0tO2Yz8JKfa6aXj+RQt=fobbzfe9C6sDjHe-LMBoGA@mail.gmail.com>

Hi

I found some bugs in management plugin and HA:

Configuration:
Cluster with 4 nodes:
arch-task-mq-1 (disk), arch-task-mq-2 (ram), arch-task-mq-3
(disk), arch-task-mq-4 (ram)
Version 2.8.4
Erlang R14A

1.
On node arch-task-mq-3 I execute iptables commands:

iptables -A INPUT -s arch-task-mq-1 -j DROP
iptables -A OUTPUT -p tcp -d arch-task-mq-1 -j DROP

Node mq-1 tells that mq-3 is not running, node mq-3 tells that mq-1 is not
running.
Other nodes raport that every node is running.

After 5 minutes I execute:

iptables -F

After a while the mq-3 returns to normal operation, but nothing change in
state displayed on Overview -> Nodes view on mq-1 and mq-3.
Node mq-3 is still raporting that mq-1 is not running and vice versa.
Information in mq-1 about state of mq-3 changes after mq-3 restart - not
before.

2.
After spliting servers using method described above Im trying to remove
queue "test" which resides only on mq-3 (HA is not used).
I push "Delete" button on "Queues" and after doing that I back to "Queues"
tab. But queue "test" is still there.
After clicking to queue "test" I see:

Ready*undefined*
Unacknowledged*undefined*
Total*undefined*







If I try to delete queue "test" again, server reports that queue not exists.
Screenshot: ss1.png

3.
After spliting servers using method described above and restoring
connection to mq-1 in mq-3, node mq-1 is reporting internal server errors
on "Connections" tab. Errors occurs periodically.
Screenshort: ss2.png

4.
After spliting servers using method described in 1. and restoring
connection to mq-1 from mq-3 Im not able to create HA queue.
I go to mq-3 and create HA queue named "test". Node mq-1 see that queue,
but is not synchronized.
Screenshots: ss2.png, ss3.png
MQ-1 is not able to deliver messages to that queue. Other nodes do it
without problems.
Restarting mq-3 causes the queue .. disappear. Even if there were
undelivered messages.


Regards,
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/3da336df/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ss1.png
Type: image/png
Size: 28506 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/3da336df/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ss2.png
Type: image/png
Size: 111077 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/3da336df/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ss3.png
Type: image/png
Size: 42796 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/3da336df/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ss4.png
Type: image/png
Size: 41259 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/3da336df/attachment-0003.png>

From simon at rabbitmq.com  Tue Jul 10 14:52:49 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Jul 2012 14:52:49 +0100
Subject: [rabbitmq-discuss] JSON-RPC: RPC endpoint responds with "not
 found"
In-Reply-To: <CA+i_dJKODTZGMO1a9S4U-cqKRjhMsq0wrHG+x_BaDaOc2ZQTng@mail.gmail.com>
References: <34ca1fe7-68a5-4f01-8f52-9e880ce4f8c9@googlegroups.com>
	<4FFC05B6.3050607@rabbitmq.com>
	<CA+i_dJKODTZGMO1a9S4U-cqKRjhMsq0wrHG+x_BaDaOc2ZQTng@mail.gmail.com>
Message-ID: <4FFC33B1.4050509@rabbitmq.com>

Are you sure you are definitely running 2.8.2? The version of 
rfc4627_jsonrpc_mochiweb in 2.8.2 definitely does not have references to 
mochiweb_request:accepts_content_type/2 in it, so I am quite suspicious.

Cheers, Simon

On 10/07/12 13:41, Juan Cerezuela wrote:
> Hi Simon
>
> I uninstalled 2.8.4, then I installed 2.8.2 and I still see the same
> problem. I see this in rabbit at myhost-sasl.log :
>
> =CRASH REPORT==== 10-Jul-2012::13:36:17 ===
>    crasher:
>      initial call: mochiweb_acceptor:init/3
>      pid: <0.509.14>
>      registered_name: []
>      exception error: undefined function
> mochiweb_request:accepts_content_type/2
>        in function  rfc4627_jsonrpc_mochiweb:handle/2
>        in call from rabbit_jsonrpc:'-start/2-fun-0-'/3
>        in call from mochiweb_http:headers/5
>      ancestors: ['rabbit_mochiweb_web_*',rabbit_mochiweb_sup,<0.126.0>]
>      messages: []
>      links: [<0.137.0>,#Port<0.10941>]
>      dictionary: [{mochiweb_request_body,undefined},
>                    {mochiweb_request_qs,[]},
>                    {mochiweb_request_path,"/rpc/tunnel"}]
>      trap_exit: false
>      status: running
>      heap_size: 1597
>      stack_size: 24
>      reductions: 2549
>    neighbours:
>
> Cheers
>
> On 10 July 2012 12:36, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 09/07/12 20:41, Caerbannog wrote:
>
>         When I open http://localhost:55670/rpc
>         <http://smuc1697:55670/rpc> in
>         the browser I get a blank page with the text "Not found."
>
>
>     Believe it or not, that's what it should do. The /rpc endpoint i9s
>     not designed to be used via a browser. The /rpc-examples path should
>     work...
>
>     ... however, in looking at this I noticed that it doesn't. It looks
>     like rabbitmq-jsonrpc-channel is broken in 2.8.4 (hurrah for
>     automated tests that have to run in a browser and not a CI server).
>
>     If you need to use rabbitmq-jsonrpc-channel you'll have to downgrade
>     to 2.8.2. Or slightly more favourably, you can extract the file
>     "rfc4627_jsonrpc-2.8.2-git.ez" from
>     http://www.rabbitmq.com/__releases/rabbitmq-server/v2.8.__2/rabbitmq-server-windows-2.8.__2.zip
>     <http://www.rabbitmq.com/releases/rabbitmq-server/v2.8.2/rabbitmq-server-windows-2.8.2.zip>
>     and use that to replace the equivalent plugin in C:\Program
>     Files\RabbitMQ Server\rabbitmq_server-2.8.4\__plugins
>
>     Bah.
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From eric.wood at lexisnexis.com  Tue Jul 10 15:08:38 2012
From: eric.wood at lexisnexis.com (Wood, Eric (LNG-RDU))
Date: Tue, 10 Jul 2012 14:08:38 +0000
Subject: [rabbitmq-discuss] Clustering issue: Error: unable to connect to
 node rabbit@CNTD3BWEB87O: nodedown
Message-ID: <587CA72CD3D0044E8AC7E34292AEE2EE5E73790D@retda2mbxp006.legal.regn.net>

I'm attempting to create a cluster and I have all three nodes created and running as "detached".  I copy the .erland cookie file from one of my servers to the other and restarted the service.  When I attempt to run a cluster status I get the following message:


    C:\Windows\system32>rabbitmqctl cluster_status
    Cluster status of node rabbit at CNTD3BWEB87O ...
    Error: unable to connect to node rabbit at CNTD3BWEB87O: nodedown

    DIAGNOSTICS
    ===========

    nodes in question: [rabbit at CNTD3BWEB87O]

    hosts, their running nodes and ports:
    - CNTD3BWEB87O: [{rabbit,50031},{rabbitmqctl26403,50035}]

    current node details:
    - node name: rabbitmqctl26403 at CNTD3BWEB87O
    - home dir: C:\Users\mgadmin
    - cookie hash: VWZk1leRufUBRYr1dwMuJg==

Why can't the server in question CNTD3BWEB87O no longer find its own node?

Thanks, Eric
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/81b60473/attachment.htm>

From emile at rabbitmq.com  Tue Jul 10 16:03:12 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 10 Jul 2012 16:03:12 +0100
Subject: [rabbitmq-discuss] Clustering issue: Error: unable to connect
 to node rabbit@CNTD3BWEB87O: nodedown
In-Reply-To: <587CA72CD3D0044E8AC7E34292AEE2EE5E73790D@retda2mbxp006.legal.regn.net>
References: <587CA72CD3D0044E8AC7E34292AEE2EE5E73790D@retda2mbxp006.legal.regn.net>
Message-ID: <4FFC4430.6080908@rabbitmq.com>

Hi,

On 10/07/12 15:08, Wood, Eric (LNG-RDU) wrote:
> Why can?t the server in question CNTD3BWEB87O no longer find its own node?

The diagnosis provided by the troubleshooting guide is that the Erlang
cookies are not synchronised:
http://www.rabbitmq.com/troubleshooting.html

Did you spell the name of the cookie file correctly? The correct name is
.erlang.cookie .

Is the cookie hash displayed in the startup banner on all hosts
"VWZk1leRufUBRYr1dwMuJg==" ?

For more information on how to copy the cookie file see the "Synchronise
Erlang Cookies" section on this page:
http://www.rabbitmq.com/install-windows-manual.html

-Emile



From eric.wood at lexisnexis.com  Tue Jul 10 17:24:43 2012
From: eric.wood at lexisnexis.com (Wood, Eric (LNG-RDU))
Date: Tue, 10 Jul 2012 16:24:43 +0000
Subject: [rabbitmq-discuss] Clustering issue: Error: unable to connect
 to node rabbit@CNTD3BWEB87O: nodedown
In-Reply-To: <4FFC4430.6080908@rabbitmq.com>
References: <587CA72CD3D0044E8AC7E34292AEE2EE5E73790D@retda2mbxp006.legal.regn.net>
	<4FFC4430.6080908@rabbitmq.com>
Message-ID: <587CA72CD3D0044E8AC7E34292AEE2EE5E737989@retda2mbxp006.legal.regn.net>

I have copied the .erlang.cookie  from server 1 to server2.  I restarted the windows service and when I run rabbitmqctl  cluster_status on server two I get the same error message:

    Error: unable to connect to node 'rabbit at LNGRDUV-FMQA01': nodedown

The cookie hash that is displayed with this command is the same across both servers (1 and 2).
Server 1:
    current node details:
    - node name: 'rabbitmqctl12663 at LNGRDUV-CSQA01'
    - home dir: C:\Users\svc-leglngbnasys001
    - cookie hash: 0xT5raNnyX73mPb3lJZWuQ==

Server 2:
    current node details:
    - node name: 'rabbitmqctl30045 at lngrduv-fmqa01'
    - home dir: C:\Users\svc-leglngbnasys001
    - cookie hash: 0xT5raNnyX73mPb3lJZWuQ==

The windows service is running as a system account, does it have to run under the user ID that I installed and is listed as the "home" directory?

I have tried this on several servers and get the same results.  What steps are required to execute when I copy the cookie file from one server to the next?  I copy it after both installations have been completed and both nodes are up and running as "detached" nodes.

Thanks, Eric
-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: Tuesday, July 10, 2012 11:03 AM
To: Wood, Eric (LNG-RDU)
Cc: RabbitMQ Discuss
Subject: Re: [rabbitmq-discuss] Clustering issue: Error: unable to connect to node rabbit at CNTD3BWEB87O: nodedown

Hi,

On 10/07/12 15:08, Wood, Eric (LNG-RDU) wrote:
> Why can't the server in question CNTD3BWEB87O no longer find its own node?

The diagnosis provided by the troubleshooting guide is that the Erlang cookies are not synchronised:
http://www.rabbitmq.com/troubleshooting.html

Did you spell the name of the cookie file correctly? The correct name is .erlang.cookie .

Is the cookie hash displayed in the startup banner on all hosts "VWZk1leRufUBRYr1dwMuJg==" ?

For more information on how to copy the cookie file see the "Synchronise Erlang Cookies" section on this page:
http://www.rabbitmq.com/install-windows-manual.html

-Emile



From eric.wood at lexisnexis.com  Tue Jul 10 17:33:07 2012
From: eric.wood at lexisnexis.com (Wood, Eric (LNG-RDU))
Date: Tue, 10 Jul 2012 16:33:07 +0000
Subject: [rabbitmq-discuss] Clustering issue: Error: unable to connect
 to node rabbit@CNTD3BWEB87O: nodedown
In-Reply-To: <587CA72CD3D0044E8AC7E34292AEE2EE5E737989@retda2mbxp006.legal.regn.net>
References: <587CA72CD3D0044E8AC7E34292AEE2EE5E73790D@retda2mbxp006.legal.regn.net>
	<4FFC4430.6080908@rabbitmq.com>
	<587CA72CD3D0044E8AC7E34292AEE2EE5E737989@retda2mbxp006.legal.regn.net>
Message-ID: <587CA72CD3D0044E8AC7E34292AEE2EE5E73799C@retda2mbxp006.legal.regn.net>

Also, any command I run via rabbitmgctl (stop_app, reset, etc), all produce the same message:

    Error: unable to connect to node 'rabbit at LNGRDUV-FMQA01': nodedown


Help.
-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Wood, Eric (LNG-RDU)
Sent: Tuesday, July 10, 2012 12:25 PM
To: Emile Joubert
Cc: RabbitMQ Discuss
Subject: Re: [rabbitmq-discuss] Clustering issue: Error: unable to connect to node rabbit at CNTD3BWEB87O: nodedown

I have copied the .erlang.cookie  from server 1 to server2.  I restarted the windows service and when I run rabbitmqctl  cluster_status on server two I get the same error message:

    Error: unable to connect to node 'rabbit at LNGRDUV-FMQA01': nodedown

The cookie hash that is displayed with this command is the same across both servers (1 and 2).
Server 1:
    current node details:
    - node name: 'rabbitmqctl12663 at LNGRDUV-CSQA01'
    - home dir: C:\Users\svc-leglngbnasys001
    - cookie hash: 0xT5raNnyX73mPb3lJZWuQ==

Server 2:
    current node details:
    - node name: 'rabbitmqctl30045 at lngrduv-fmqa01'
    - home dir: C:\Users\svc-leglngbnasys001
    - cookie hash: 0xT5raNnyX73mPb3lJZWuQ==

The windows service is running as a system account, does it have to run under the user ID that I installed and is listed as the "home" directory?

I have tried this on several servers and get the same results.  What steps are required to execute when I copy the cookie file from one server to the next?  I copy it after both installations have been completed and both nodes are up and running as "detached" nodes.

Thanks, Eric
-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: Tuesday, July 10, 2012 11:03 AM
To: Wood, Eric (LNG-RDU)
Cc: RabbitMQ Discuss
Subject: Re: [rabbitmq-discuss] Clustering issue: Error: unable to connect to node rabbit at CNTD3BWEB87O: nodedown

Hi,

On 10/07/12 15:08, Wood, Eric (LNG-RDU) wrote:
> Why can't the server in question CNTD3BWEB87O no longer find its own node?

The diagnosis provided by the troubleshooting guide is that the Erlang cookies are not synchronised:
http://www.rabbitmq.com/troubleshooting.html

Did you spell the name of the cookie file correctly? The correct name is .erlang.cookie .

Is the cookie hash displayed in the startup banner on all hosts "VWZk1leRufUBRYr1dwMuJg==" ?

For more information on how to copy the cookie file see the "Synchronise Erlang Cookies" section on this page:
http://www.rabbitmq.com/install-windows-manual.html

-Emile


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From monish.unni at gmail.com  Tue Jul 10 17:47:39 2012
From: monish.unni at gmail.com (cogitate)
Date: Tue, 10 Jul 2012 09:47:39 -0700 (PDT)
Subject: [rabbitmq-discuss] Handle Stale Connections on Clients
Message-ID: <1341938859568-20687.post@n5.nabble.com>

Hi Mathias et al:

Given:
-- java rabbitmq client 2.8.2
-- rabbitmq broker 2.8.2
-- wrote an amqp client library (java) that has the following semantics:
[1] setting up connection properties
 [1.1] username, password (authentication)
 [1.2] host, port ( endpoint )
 [1.3] # of threads(concurrent users), # of connections(conn.), conn.
timeout, receive timeout
 * # of usable clients effectively = threads x connections

[2] A manager sets up a pool for fair-sharing of resources per thread.
 [2.1] sets up a connection pool
 [2.2] sets up request/reply channels
 [2.3] sets up re-usable reply-queues

[3] A client class derived from the manager
 [3.1] this pre-configured (with properties in [2])
 [3.2] specify exchange(context), routing-key(service), payload(a message)
 

when a broker is shutdown and restarted, the stack i get is :
[ERROR:clean connection shutdown; reason: Attempt to use closed channel]
com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
reason: Attempt to use closed channel
	at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:190)
	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:223)
	at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:209)
	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118)
	at
com.rabbitmq.client.impl.ChannelN.exchangeDeclarePassive(ChannelN.java:660)
	at
com.rabbitmq.client.impl.ChannelN.exchangeDeclarePassive(ChannelN.java:61)
	at com.xx.s2.amqp.AmqpClient.doSend(AmqpClient.java:187)
	at com.xx.s2.amqp.AmqpClient.callService(AmqpClient.java:80)
	at
com.xx.s2.amqp.StaleConnectionTest.callLoopTest(StaleConnectionTest.java:132)
	at com.xx.s2.amqp.StaleConnectionTest.loopTest(StaleConnectionTest.java:86)

at this point, i have to shutdown the client using the library and restart
it. is there a way to handle this exception and re-establish the connection?
any utilities that will allow me to do this "automatically"?

thanks and regards,
-monish

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jerryk at rbcon.com  Tue Jul 10 17:52:04 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Tue, 10 Jul 2012 09:52:04 -0700
Subject: [rabbitmq-discuss] After waking from standby Rabbit uses 100%
	cpu (Windows)
In-Reply-To: <e4626e06-36fe-4bd5-a211-5afa708f7d04@googlegroups.com>
References: <23f5d674-adf9-4068-9469-9ff18063db83@googlegroups.com>
	<e4626e06-36fe-4bd5-a211-5afa708f7d04@googlegroups.com>
Message-ID: <CAE0Sz=ymB6PR+SU0Mog4VCwW60BAg8hUi4wLK2a2G6WEWHrD1Q@mail.gmail.com>

Hi, Galmok:

How long does the CPU stay busy in this way?  And what do you see in the
Rabbit logs?

I have noticed that Mnesia sometimes gets a bit hyperactive around
sleeps/wakes, in particular complaints about being "overloaded" in the
logs, but this usually relents fairly quickly.

Jerry

On Mon, Jul 9, 2012 at 7:13 AM, Galmok <galmok at gmail.com> wrote:

> On Monday, 2 July 2012 07:44:03 UTC+2, Christian Pedersen wrote:
>>
>> This seems to be the only place to file a bug report:
>>
>> I'm running RabbitMQ 2.8.4 on Windows. After waking the system after a
>> standby, RabbitMQ will often use 100% cpu (1 full core).
>>
>> Please let me know if you need more info.
>>
>>
> I experienced the same issue with 2.8.2. Changelog didn't mention anything
> regarding this issue so I'd expect this issue to remain in 2.8.4.
>
> Could it be related to erlang?
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/07522894/attachment.htm>

From jerryk at rbcon.com  Tue Jul 10 17:59:58 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Tue, 10 Jul 2012 09:59:58 -0700
Subject: [rabbitmq-discuss] Handle Stale Connections on Clients
In-Reply-To: <1341938859568-20687.post@n5.nabble.com>
References: <1341938859568-20687.post@n5.nabble.com>
Message-ID: <CAE0Sz=wVjM3XT2w_pe4bnxQ6de_xhh2aiaMh1jL-W0AhCv+PWg@mail.gmail.com>

Hi, Monish:

If you're using the naked Java client, you'll have to implement your own
reconnection logic.  If you're using Spring AMQP there's some helper code
that wraps your connections with some retry logic for you.

Best regards,
Jerry

On Tue, Jul 10, 2012 at 9:47 AM, cogitate <monish.unni at gmail.com> wrote:

> Hi Mathias et al:
>
> Given:
> -- java rabbitmq client 2.8.2
> -- rabbitmq broker 2.8.2
> -- wrote an amqp client library (java) that has the following semantics:
> [1] setting up connection properties
>  [1.1] username, password (authentication)
>  [1.2] host, port ( endpoint )
>  [1.3] # of threads(concurrent users), # of connections(conn.), conn.
> timeout, receive timeout
>  * # of usable clients effectively = threads x connections
>
> [2] A manager sets up a pool for fair-sharing of resources per thread.
>  [2.1] sets up a connection pool
>  [2.2] sets up request/reply channels
>  [2.3] sets up re-usable reply-queues
>
> [3] A client class derived from the manager
>  [3.1] this pre-configured (with properties in [2])
>  [3.2] specify exchange(context), routing-key(service), payload(a message)
>
>
> when a broker is shutdown and restarted, the stack i get is :
> [ERROR:clean connection shutdown; reason: Attempt to use closed channel]
> com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
> reason: Attempt to use closed channel
>         at
> com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:190)
>         at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:223)
>         at
> com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:209)
>         at
> com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118)
>         at
> com.rabbitmq.client.impl.ChannelN.exchangeDeclarePassive(ChannelN.java:660)
>         at
> com.rabbitmq.client.impl.ChannelN.exchangeDeclarePassive(ChannelN.java:61)
>         at com.xx.s2.amqp.AmqpClient.doSend(AmqpClient.java:187)
>         at com.xx.s2.amqp.AmqpClient.callService(AmqpClient.java:80)
>         at
>
> com.xx.s2.amqp.StaleConnectionTest.callLoopTest(StaleConnectionTest.java:132)
>         at
> com.xx.s2.amqp.StaleConnectionTest.loopTest(StaleConnectionTest.java:86)
>
> at this point, i have to shutdown the client using the library and restart
> it. is there a way to handle this exception and re-establish the
> connection?
> any utilities that will allow me to do this "automatically"?
>
> thanks and regards,
> -monish
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/8e2059be/attachment.htm>

From matthias at rabbitmq.com  Tue Jul 10 21:34:07 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 10 Jul 2012 21:34:07 +0100
Subject: [rabbitmq-discuss] My cluter node (ram node) down in my
 performance test
In-Reply-To: <CABjKUK-XNiYZZ1AY7=i+rHTdO9Y7zrHprMCG67ay7qQtgXnYaQ@mail.gmail.com>
References: <CABjKUK9j23ia9foMSDUTBXa+y6-ypF86d6Wzy9PZr=dAkxG-7Q@mail.gmail.com>
	<4FF6F10F.6080107@rabbitmq.com>
	<CABjKUK_Bfdo=Au1CR440YcEWkB6vTts-Le6G1HVYo7QqRXrWhA@mail.gmail.com>
	<CABjKUK-8Gx_4Rt4Uu=VDg5-iXAHQ7HNUB=b8toeeCSdjBaO_zg@mail.gmail.com>
	<4FF76401.1020900@rabbitmq.com> <4FFBC015.1090506@rabbitmq.com>
	<CABjKUK-XNiYZZ1AY7=i+rHTdO9Y7zrHprMCG67ay7qQtgXnYaQ@mail.gmail.com>
Message-ID: <4FFC91BF.6020309@rabbitmq.com>

Thiago,

On 10/07/12 21:30, Thiago Burgo Belo wrote:
> *reports_ram.zip is for disc node and **reports_disc.zip is for ram
> node, and **rabbit at APPSERVER02.zip and **rabbit at APPSERVER02-2.zip are
> both from ram node.*

Where are the logs (rather than reports) from the disk node?

Matthias.

From thiagoburgo at gmail.com  Tue Jul 10 22:15:45 2012
From: thiagoburgo at gmail.com (Thiago Burgo Belo)
Date: Tue, 10 Jul 2012 18:15:45 -0300
Subject: [rabbitmq-discuss] My cluter node (ram node) down in my
 performance test
In-Reply-To: <4FFC91BF.6020309@rabbitmq.com>
References: <CABjKUK9j23ia9foMSDUTBXa+y6-ypF86d6Wzy9PZr=dAkxG-7Q@mail.gmail.com>
	<4FF6F10F.6080107@rabbitmq.com>
	<CABjKUK_Bfdo=Au1CR440YcEWkB6vTts-Le6G1HVYo7QqRXrWhA@mail.gmail.com>
	<CABjKUK-8Gx_4Rt4Uu=VDg5-iXAHQ7HNUB=b8toeeCSdjBaO_zg@mail.gmail.com>
	<4FF76401.1020900@rabbitmq.com> <4FFBC015.1090506@rabbitmq.com>
	<CABjKUK-XNiYZZ1AY7=i+rHTdO9Y7zrHprMCG67ay7qQtgXnYaQ@mail.gmail.com>
	<4FFC91BF.6020309@rabbitmq.com>
Message-ID: <CABjKUK84uDdt=7oqT77b23Cqe6uvC2_NKe=NMJk1s8sZbLjb8A@mail.gmail.com>

All right, is missing...

I Will send for you tomorrow. Now I can`t get the logs.

Thiago Burgo


2012/7/10 Matthias Radestock <matthias at rabbitmq.com>

> Thiago,
>
> On 10/07/12 21:30, Thiago Burgo Belo wrote:
>
>> *reports_ram.zip is for disc node and **reports_disc.zip is for ram
>> node, and **rabbit at APPSERVER02.zip and **rabbit at APPSERVER02-2.zip are
>> both from ram node.*
>>
>
> Where are the logs (rather than reports) from the disk node?
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/15eb4f5e/attachment.htm>

From fearsome.lucidity at gmail.com  Wed Jul 11 00:11:12 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Tue, 10 Jul 2012 16:11:12 -0700
Subject: [rabbitmq-discuss] HA behavior during a network split
Message-ID: <CAFDmHdMA-7QCJLf=R3TjSorKf3R1EwnrEJvyj9RPsLPagCw4-w@mail.gmail.com>

I am curious as to what the behavior of HA queues during a network split
is.

The documentation states that when a mater fails a slave will be promoted
to master, but its silent under what conditions a slave will consider a
master to have failed.  Is there some timeout after which slaves will
consider a master to have failed?  If so, what is the time value?

Assuming that such timeout exists, if there is a network split you may end
up with two clusters, each one which now has a master.  Each may also have
publisher and consumers that continue to work happily against the split
cluster.

What happens when the network split is repaired?  Will the clusters join?
 If so, what will happen to the HA queue?  Will one of the existing master
be demoted to slave?  If so, what happens to its queue of messages that
originated within its split cluster?  Are they lost?

I suppose a lot of this depends on the underlaying Mnesia DB.
 I realize RMQ is CA system out the CAP theorem, but its not at all clear
what occurs in the face of a network partition.

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/1bd3a66a/attachment.htm>

From eric.ettes at gmail.com  Wed Jul 11 06:38:55 2012
From: eric.ettes at gmail.com (Eric Ettes)
Date: Wed, 11 Jul 2012 07:38:55 +0200
Subject: [rabbitmq-discuss] RabbitMQ shuts itself down every night?
Message-ID: <76282B0512BD48BB8D400BFBF5A7BD67@gmail.com>

Hey everyone,  

For a project I'm using RabbitMQ and I've encountered a strange problem that I'm unable to solve. The rabbit-server will automatically shut down every night with the following logging (I cleaned the log files and just waited for the next shutdown to occur :)):

shutdown_err:
Error: {'EXIT',{error,{could_not_read_pid,{error,enoent}}}}

shutdown_log:
Stopping and halting node rabbit at lukas ?

startup_err:
/usr/lib/rabbitmq/bin/rabbitmq-server: 90: erl: not found

startup_log is empty

rabbit at lukas-sasl.log.1:  
=SUPERVISOR REPORT==== 11-Jul-2012::04:33:51 ===
     Supervisor: {<0.720.0>,rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,<0.722.0>},
                  {name,channel_sup},
                  {mfa,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]


rabbit at lukas.log:
=INFO REPORT==== 10-Jul-2012::06:16:55 === <- This is when I started the server
accepting AMQP connection <0.721.0> (127.0.0.1:54219 -> 127.0.0.1:5672)

=INFO REPORT==== 11-Jul-2012::04:33:51 === <- From here, it went wrong
Stopping Rabbit

=INFO REPORT==== 11-Jul-2012::04:33:51 ===
    application: rabbitmq_management
    exited: stopped
    type: permanent

=INFO REPORT==== 11-Jul-2012::04:33:51 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: permanent

=INFO REPORT==== 11-Jul-2012::04:33:51 ===
stopped TCP Listener on [::]:5672

=INFO REPORT==== 11-Jul-2012::04:33:51 ===
    application: rabbit
    exited: stopped
    type: permanent

=INFO REPORT==== 11-Jul-2012::04:33:51 ===
    application: os_mon
    exited: stopped
    type: permanent

=INFO REPORT==== 11-Jul-2012::04:33:51 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 11-Jul-2012::04:33:51 ===
Halting Erlang VM




I'm using a plain version of RabbitMQ 2.8.2 on Ubuntu 10.04.4 LTS, so far I've only installed RabbitMQ without changing the configuration. Also, the app hasn't been released for testing yet, so there's been no traffic over RabbitMQ...  



After re-starting Rabbit, this is the output of rabbitmqctl status:

Status of node rabbit at lukas ...
[{pid,24404},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.8.2"},
      {xmerl,"XML parser","1.2.9"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.2"},
      {amqp_client,"RabbitMQ AMQP Client","2.8.2"},
      {rabbit,"RabbitMQ","2.8.2"},
      {os_mon,"CPO  CXC 138 46","2.2.6"},
      {sasl,"SASL  CXC 138 11","2.1.9.4"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.2"},
      {webmachine,"webmachine","1.7.0-rmq2.8.2-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.2-git"},
      {inets,"INETS  CXC 138 49","5.6"},
      {mnesia,"MNESIA  CXC 138 12","4.4.19"},
      {stdlib,"ERTS  CXC 138 10","1.17.4"},
      {kernel,"ERTS  CXC 138 10","2.14.4"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,34184288},
      {processes,11938464},
      {processes_used,11925920},
      {system,22245824},
      {atom,1545609},
      {atom_used,1533234},
      {binary,274032},
      {code,17459254},
      {ets,1181624}]},
 {vm_memory_high_watermark,0.39999999990469176},
 {vm_memory_limit,839381811},
 {disk_free_limit,2098454528},
 {disk_free,33166905344},
 {file_descriptors,
     [{total_limit,924},{total_used,4},{sockets_limit,829},{sockets_used,2}]},
 {processes,[{limit,1048576},{used,185}]},
 {run_queue,0},
 {uptime,20}]
...done.



I've searched the internet for a while now, but so far I wasn't able to find anything -- perhaps someone on this mailing encountered the same issue and has a solution?

Thanks!

Kind regards,

--  
Eric
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/6ca8c348/attachment.htm>

From watsont at vmware.com  Wed Jul 11 10:24:54 2012
From: watsont at vmware.com (Tim Watson)
Date: Wed, 11 Jul 2012 10:24:54 +0100
Subject: [rabbitmq-discuss] HA behavior during a network split
In-Reply-To: <CAFDmHdMA-7QCJLf=R3TjSorKf3R1EwnrEJvyj9RPsLPagCw4-w@mail.gmail.com>
References: <CAFDmHdMA-7QCJLf=R3TjSorKf3R1EwnrEJvyj9RPsLPagCw4-w@mail.gmail.com>
Message-ID: <4FFD4666.8070602@vmware.com>

Hi Elias,

As I'm fairly new around here, I'll try and share what I've learned so 
far and allow the more experienced folks to chip in and fill in the 
details (or correct me if I go astray).

On 07/11/2012 12:11 AM, Elias Levy wrote:
> I am curious as to what the behavior of HA queues during a network 
> split is.
>
> The documentation states that when a mater fails a slave will be 
> promoted to master, but its silent under what conditions a slave will 
> consider a master to have failed.  Is there some timeout after which 
> slaves will consider a master to have failed?  If so, what is the time 
> value?
>

This situation is not handled using a timeout. HA queues are based on a 
technology called Guaranteed Multicast (aka GM), which was developed 
independently by and for RabbitMQ. This provides an atomic broadcast 
capability which is similar to the work described by Levy et al 
(biblion.epfl.ch/EPFL/theses/2008/3999/EPFL_TH3999.pdf) though as I 
mentioned earlier (and as per the documentation), was developed 
independently.

You can take a look at the GM source code here: 
http://hg.rabbitmq.com/rabbitmq-server/file/default/src/gm.erl

A GM group forms a ring, in which members are connected to their 
immediate neighbours (in both directions) only. If this connection 
breaks then the death of the member is propagated around the ring and 
everything 'reshuffles' to compensate for this. The deaths are noticed 
because the Erlang processes involved are monitored (see the links under 
[monitors] at the bottom for technical details) and the guarantees and 
relative timings involved can be understood in that context.

In actual fact, mirror (i.e., HA) queues are implemented 'on top of' GM 
and also rely on Rabbit's clustering infrastructure, so additional 
(Erlang) process and node monitoring is in place at the level above GM 
which will also *notice* if a node goes down.

> Assuming that such timeout exists, if there is a network split you may 
> end up with two clusters, each one which now has a master.  Each may 
> also have publisher and consumers that continue to work happily 
> against the split cluster.
>

Now we're talking about two different things. Rabbit clustering is 
independent of mirror (HA) queues, though the two things are 
interdependent. If a netsplit occurs then the surviving nodes which are 
still connected to the extant master *should* continue happily on. What 
will happen to the nodes in the other 'half' of the split, I'm not so 
sure and will put my hand up and ask someone better versed in this to 
fill in the blanks.

> What happens when the network split is repaired?  Will the clusters 
> join?  If so, what will happen to the HA queue?  Will one of the 
> existing master be demoted to slave?  If so, what happens to its queue 
> of messages that originated within its split cluster?  Are they lost?
>

AFAIK it is possible for MNesia to heal itself after a netsplit, and 
therefore getting nodes to rejoin a cluster might work without 
intervention, possibly depending on what has happened independently on 
the two 'halves' of the split in the intervening time period. What I 
would not expect to happen (though I could be wrong here!) is for two 
distinct GM rings to join up and become one, promoting a new master or 
demoting an existing one, the latter behaviour being undefined (i.e., 
not implemented) AFAICT.

When a node rejoins a cluster, mnesia needs to reconcile the differences 
and I would expect to see mnesia fail when trying to rejoin the cluster 
if the (Erlang) process ID for the master was different between the two 
nodes.

> I suppose a lot of this depends on the underlaying Mnesia DB. 
>  I realize RMQ is CA system out the CAP theorem, but its not at all 
> clear what occurs in the face of a network partition.
>

Yes indeed - mnesia does not play nicely in this kind of scenario. There 
are some efforts underway to make it *easier* to deal with netsplits 
(for example 
https://github.com/uwiger/otp/commit/3f70f3def4e33828da4237b07cbee9f73121c661 
and https://github.com/uwiger/unsplit) but these are not mainstream or 
ready to production use just yet.

And even if some mechanism were available, we would have the dual 
problems of deciding on which mnesia record is the correct (system of 
record) *and* being able to join 2 GM rings back together, which sounds 
infeasibly hard to me.

[monitors]
http://www.erlang.org/doc/reference_manual/processes.html#id82613
http://www.erlang.org/doc/man/erlang.html#monitor-2
http://www.erlang.org/doc/man/net_kernel.html

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/c4b5a8a8/attachment.htm>

From emile at rabbitmq.com  Wed Jul 11 10:46:52 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 11 Jul 2012 10:46:52 +0100
Subject: [rabbitmq-discuss] Clustering issue: Error: unable to connect
 to node rabbit@CNTD3BWEB87O: nodedown
In-Reply-To: <587CA72CD3D0044E8AC7E34292AEE2EE5E73799C@retda2mbxp006.legal.regn.net>
References: <587CA72CD3D0044E8AC7E34292AEE2EE5E73790D@retda2mbxp006.legal.regn.net>
	<4FFC4430.6080908@rabbitmq.com>
	<587CA72CD3D0044E8AC7E34292AEE2EE5E737989@retda2mbxp006.legal.regn.net>
	<587CA72CD3D0044E8AC7E34292AEE2EE5E73799C@retda2mbxp006.legal.regn.net>
Message-ID: <4FFD4B8C.1020105@rabbitmq.com>

Hi,

On 10/07/12 17:33, Wood, Eric (LNG-RDU) wrote:
> Help.

Your earlier emails had
- cookie hash: VWZk1leRufUBRYr1dwMuJg==
but more recently you report
- cookie hash: 0xT5raNnyX73mPb3lJZWuQ==

If the cookie hash reported by rabbitmqctl differs from the hash that
appears in the startup banner then you will be unable to manage that
node. The startup banner contains an ASCII-art rabbit, platform version
numbers and some diagnostic information, such as the location of the
active config file, logfiles, etc. Amongst this diagnostic information
is the cookie hash. Compare this with the information reported by
rabbitmqctl - you will probably find they are different, which means the
cookie file was not copied over correctly. Make sure you follow the
instructions about Erlang cookies on this page:
http://www.rabbitmq.com/install-windows-manual.html

> I have tried this on several servers and get the same results.  What
> steps are required to execute when I copy the cookie file from one
> server to the next?  I copy it after both installations have been
> completed and both nodes are up and running as "detached" nodes.

You will need to restart the nodes after copying the cookie files. Their
contents is only read at startup, so modifications will not affect a
running broker.

You might be copying the cookie file to the wrong location. If you are
running the broker as a non-system user then the file should be copied
to %HOMEDRIVE%\%HOMEPATH%, or what the Windows API call
GetWindowsDirectory() would return. If running the broker as a service,
as a system user then use %windir% (typically C:\WINDOWS).



-Emile



From tim at rabbitmq.com  Wed Jul 11 10:42:59 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 11 Jul 2012 10:42:59 +0100
Subject: [rabbitmq-discuss] HA behavior during a network split
In-Reply-To: <4FFD4666.8070602@vmware.com>
References: <CAFDmHdMA-7QCJLf=R3TjSorKf3R1EwnrEJvyj9RPsLPagCw4-w@mail.gmail.com>
	<4FFD4666.8070602@vmware.com>
Message-ID: <4FFD4AA3.7060902@rabbitmq.com>

On 07/11/2012 10:24 AM, Tim Watson wrote:
>
> AFAIK it is possible for MNesia to heal itself after a netsplit, and 
> therefore getting nodes to rejoin a cluster might work without 
> intervention, possibly depending on what has happened independently on 
> the two 'halves' of the split in the intervening time period. What I 
> would not expect to happen (though I could be wrong here!) is for two 
> distinct GM rings to join up and become one, promoting a new master or 
> demoting an existing one, the latter behaviour being undefined (i.e., 
> not implemented) AFAICT.
>
> When a node rejoins a cluster, mnesia needs to reconcile the 
> differences and I would expect to see mnesia fail when trying to 
> rejoin the cluster if the (Erlang) process ID for the master was 
> different between the two nodes.
>

And I should probably have pointed out that the message store is 
independent from mnesia as well, and I'm pretty certain that if these 
got out of synch somehow then you'd be in trouble. Currently what 
happens when a node joins a cluster and needs to become a slave (in the 
HA sense) is that the mirror queue coordinator ensures that messages are 
forwarded to that node until its message queue length is the same as 
that of the master, at which point it is considered 'in-sync' with the 
master.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/5c6d5d0e/attachment.htm>

From wongkamhoong at gmail.com  Wed Jul 11 11:12:24 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Wed, 11 Jul 2012 18:12:24 +0800
Subject: [rabbitmq-discuss] RabbitMQ Cluster High CPU Usage 100-200%+
Message-ID: <CAHv8OSQE=bvFNW7=XEJM2Pc6w0hF6KSxpMTJT1bwDLAYoD4xTw@mail.gmail.com>

Hi,

Now i'm running RabbitMQ in 3 hosts in cluster mode, each Rabbit nodes run
in disc mode,
but I found that even there is no produce and consume operation going on,
the % cpu usage
remain very high especially on the master node.

Below are the TOP result captured in the hosts:

*Master Node*
PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
13994 rabbitmq  25   0  206m 114m 2304 S *205.0*  2.9 670:29.57 beam.smp

*1st Slave*
PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
13775 rabbitmq  25   0  136m  49m 2252 S *60.7*  1.3   7:02.15 beam.smp

*2nd Slave*
PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
23053 rabbitmq  25   0  135m  47m 2248 S  *8.7*  1.2   8:14.07 beam.smp


Based on the result captured on the hosts the memory usage is OK, but why
the
%cpu usage can be so high? Is it due to my server configuration?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/f916e4e1/attachment.htm>

From francesco at rabbitmq.com  Wed Jul 11 11:21:49 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 11 Jul 2012 11:21:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ Cluster High CPU Usage 100-200%+
In-Reply-To: <CAHv8OSQE=bvFNW7=XEJM2Pc6w0hF6KSxpMTJT1bwDLAYoD4xTw@mail.gmail.com>
References: <CAHv8OSQE=bvFNW7=XEJM2Pc6w0hF6KSxpMTJT1bwDLAYoD4xTw@mail.gmail.com>
Message-ID: <87a9z661j6.wl%francesco@rabbitmq.com>

At Wed, 11 Jul 2012 18:12:24 +0800,
Wong Kam Hoong wrote:
> Hi,
> 
> Now i'm running RabbitMQ in 3 hosts in cluster mode, each Rabbit nodes run in disc mode,?
> but I found that even there is no produce and consume operation going on, the % cpu usage?
> remain very high especially on the master node.?
> 
> Below are the TOP result captured in the hosts:
> 
> Master Node?
> PID USER ? ? ?PR ?NI ?VIRT ?RES ?SHR S %CPU %MEM ? ?TIME+ ?COMMAND
> 13994 rabbitmq ?25 ? 0 ?206m 114m 2304 S 205.0 ?2.9 670:29.57 beam.smp
> 
> 1st Slave
> PID USER ? ? ?PR ?NI ?VIRT ?RES ?SHR S %CPU %MEM ? ?TIME+ ?COMMAND
> 13775 rabbitmq ?25 ? 0 ?136m ?49m 2252 S 60.7 ?1.3 ? 7:02.15 beam.smp
> 
> 2nd Slave
> PID USER ? ? ?PR ?NI ?VIRT ?RES ?SHR S %CPU %MEM ? ?TIME+ ?COMMAND
> 23053 rabbitmq ?25 ? 0 ?135m ?47m 2248 S ?8.7 ?1.2 ? 8:14.07 beam.smp
> 
> Based on the result captured on the hosts the memory usage is OK, but why the?
> %cpu usage?can be so high? Is it due to my server configuration?

What version of rabbit are you using? We fixed a couple of bugs that could cause
things like this (I'm looking at you, gb_trees!).

--
Francesco * Often in error, never in doubt

From innocentliny at gmail.com  Wed Jul 11 10:50:37 2012
From: innocentliny at gmail.com (liny)
Date: Wed, 11 Jul 2012 02:50:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Subscription Recovery
Message-ID: <1342000237488-20697.post@n5.nabble.com>

Hi,

I am newbie to RabbitMQ and have questions.
Does RabbitMQ have feature like 
http://activemq.apache.org/subscription-recovery-policy.html ActiveMQ
subscription-recovery-policy ?
I need subscription recovery to let new or existed subscriber to get last
message from publisher, even restart MQ server, but ActiveMQ can't provide
recover after MQ server is restarted.
Thanks for reply.

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Subscription-Recovery-tp20697.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ankit.bhardwaj at esteeadvisors.com  Wed Jul 11 10:59:37 2012
From: ankit.bhardwaj at esteeadvisors.com (Ankit Bhardwaj)
Date: Wed, 11 Jul 2012 15:29:37 +0530
Subject: [rabbitmq-discuss] Problem in checkinh out rabbitMQ public umbrella
Message-ID: <00a301cd5f4b$e2626ea0$a7274be0$@esteeadvisors.com>

Hi,

 

I am not able to check out rabbitMQ public umbrella on my local windows
machine.

The message I am seeing is 'make is not an recognized command'.

 



 

Can somebody tell me what I need to do in order to resolve this problem. Do
I need to make some change in environment variables..?? Or I need to do
something else?

 

Thanks,

Ankit Bhardwaj

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/f00046a6/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 24347 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/f00046a6/attachment.png>

From simon at rabbitmq.com  Wed Jul 11 11:37:03 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Jul 2012 11:37:03 +0100
Subject: [rabbitmq-discuss] Problem in checkinh out rabbitMQ public
	umbrella
In-Reply-To: <00a301cd5f4b$e2626ea0$a7274be0$@esteeadvisors.com>
References: <00a301cd5f4b$e2626ea0$a7274be0$@esteeadvisors.com>
Message-ID: <4FFD574F.8010007@rabbitmq.com>

On 11/07/12 10:59, Ankit Bhardwaj wrote:
> I am not able to check out rabbitMQ public umbrella on my local windows
> machine.
>
> The message I am seeing is ?make is not an recognized command?.

Please see the email thread with your colleague Ashutosh Trivedi 
starting here:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-June/020638.html

In general, to build plugins on Windows you will need cygwin.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From sanjiv.kumar.jha at accenture.com  Wed Jul 11 11:43:46 2012
From: sanjiv.kumar.jha at accenture.com (sanjiv.kumar.jha at accenture.com)
Date: Wed, 11 Jul 2012 10:43:46 +0000
Subject: [rabbitmq-discuss] Cluster setup : rabbitmq server stops responding
 to rabbitmqctl commands
Message-ID: <EEA1DC407D5C23479BEAAF68C3D560400531C4CA@048-CH1MPN1-213.048d.mgd.msft.net>

Hi,

We have a RabbitMQ cluster of 2 nodes (say NODE-A and NODE-B) having mirrored queues running on 2 separate Linux servers (RabbitMQ-Server 2.7.1), but facing issues with RabbitMQ Server.
If NODE-A is brought down, the clients are able to connect to NODE-B successfully; no issues observed till this point.
Now if NODE-A is brought up and NODE-B is brought down, the rabbitmq server tends to slow down and does not even respond to simple command like rabbitmqctl list_queues - keeps waiting endlessly.

Please let us know, if there any clues or ideas to rectify this issue.

Thanks

Sanjiv

Startup_err:

Erlang has closed
Erlang has closed


Startup_log:


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.7.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at AD1SP1
app descriptor : /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : /etc/rabbitmq/rabbitmq.config
cookie hash    : pmUAo68V6W8JgxZU0MHCNw==
log            : /var/log/rabbitmq/rabbit at AD1SP1.log
sasl log       : /var/log/rabbitmq/rabbit at AD1SP1-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at AD1SP1
erlang version : 5.6.3

-- rabbit boot start
starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...

rabbit at NODE-A.log:

=INFO REPORT==== 9-Jul-2012::17:47:29 ===
closing TCP connection <0.7287.0> from 144.36.234.81:22348

=INFO REPORT==== 9-Jul-2012::17:47:29 ===
closing TCP connection <0.8371.0> from 144.36.234.81:22354

=INFO REPORT==== 9-Jul-2012::17:47:29 ===
    application: rabbit
    exited: stopped
    type: temporary

=INFO REPORT==== 9-Jul-2012::17:47:29 ===
    application: mnesia
    exited: stopped
    type: temporary

=INFO REPORT==== 9-Jul-2012::17:47:29 ===
    application: os_mon
    exited: stopped
    type: temporary

=INFO REPORT==== 9-Jul-2012::17:52:28 ===
Limiting to approx 924 file handles (829 sockets)

rabbit at NODE-A-sasl.log:

=SUPERVISOR REPORT==== 9-Jul-2012::17:47:29 ===
     Supervisor: {<0.8370.0>,rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,<0.10329.0>},
                  {name,channel_sup},
                  {mfa,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]

________________________________
Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
______________________________________________________________________________________

www.accenture.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/cdfe52cc/attachment.htm>

From wongkamhoong at gmail.com  Wed Jul 11 11:48:06 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Wed, 11 Jul 2012 18:48:06 +0800
Subject: [rabbitmq-discuss] RabbitMQ Cluster High CPU Usage 100-200%+
In-Reply-To: <87a9z661j6.wl%francesco@rabbitmq.com>
References: <CAHv8OSQE=bvFNW7=XEJM2Pc6w0hF6KSxpMTJT1bwDLAYoD4xTw@mail.gmail.com>
	<87a9z661j6.wl%francesco@rabbitmq.com>
Message-ID: <CAHv8OSTp+R11kXb6DCZnHD+GUt0t6CKDHW674j0Xpds66cJ1=g@mail.gmail.com>

Hi,

I'm using rabbitmq 2.8.3

Regards,
Wong

On Wed, Jul 11, 2012 at 6:21 PM, Francesco Mazzoli
<francesco at rabbitmq.com>wrote:

> At Wed, 11 Jul 2012 18:12:24 +0800,
> Wong Kam Hoong wrote:
> > Hi,
> >
> > Now i'm running RabbitMQ in 3 hosts in cluster mode, each Rabbit nodes
> run in disc mode,
> > but I found that even there is no produce and consume operation going
> on, the % cpu usage
> > remain very high especially on the master node.
> >
> > Below are the TOP result captured in the hosts:
> >
> > Master Node
> > PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
> > 13994 rabbitmq  25   0  206m 114m 2304 S 205.0  2.9 670:29.57 beam.smp
> >
> > 1st Slave
> > PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
> > 13775 rabbitmq  25   0  136m  49m 2252 S 60.7  1.3   7:02.15 beam.smp
> >
> > 2nd Slave
> > PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
> > 23053 rabbitmq  25   0  135m  47m 2248 S  8.7  1.2   8:14.07 beam.smp
> >
> > Based on the result captured on the hosts the memory usage is OK, but
> why the
> > %cpu usage can be so high? Is it due to my server configuration?
>
> What version of rabbit are you using? We fixed a couple of bugs that could
> cause
> things like this (I'm looking at you, gb_trees!).
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/ee76fee6/attachment.htm>

From simon at rabbitmq.com  Wed Jul 11 11:51:16 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Jul 2012 11:51:16 +0100
Subject: [rabbitmq-discuss] Subscription Recovery
In-Reply-To: <1342000237488-20697.post@n5.nabble.com>
References: <1342000237488-20697.post@n5.nabble.com>
Message-ID: <4FFD5AA4.7020805@rabbitmq.com>

On 11/07/12 10:50, liny wrote:
> I am newbie to RabbitMQ and have questions.
> Does RabbitMQ have feature like
> http://activemq.apache.org/subscription-recovery-policy.html  ActiveMQ
> subscription-recovery-policy ?
> I need subscription recovery to let new or existed subscriber to get last
> message from publisher, even restart MQ server, but ActiveMQ can't provide
> recover after MQ server is restarted.

There's no exact equivalent of that feature, but other features may give 
you what you want:

Assuming each subscriber needs its own set of messages (i.e. you're not 
round-robinning messages among subscribers) then they should each 
declare their own queue. This queue will still exist when they are 
disconnected, and if durable will exist across broker restarts.

By default messages will back up forever while the subscriber is 
disconnected; the x-message-ttl argument can be used to prevent messages 
above a certain age from being kept.

If you need subscribers to see messages that were sent before they ever 
connected to the broker in the first place, then the LVC plugin may 
help, although it is somewhat limited:

https://github.com/simonmacmullen/rabbitmq-lvc-plugin

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jul 11 11:53:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Jul 2012 11:53:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ Cluster High CPU Usage 100-200%+
In-Reply-To: <CAHv8OSTp+R11kXb6DCZnHD+GUt0t6CKDHW674j0Xpds66cJ1=g@mail.gmail.com>
References: <CAHv8OSQE=bvFNW7=XEJM2Pc6w0hF6KSxpMTJT1bwDLAYoD4xTw@mail.gmail.com>	<87a9z661j6.wl%francesco@rabbitmq.com>
	<CAHv8OSTp+R11kXb6DCZnHD+GUt0t6CKDHW674j0Xpds66cJ1=g@mail.gmail.com>
Message-ID: <4FFD5B38.4060508@rabbitmq.com>

On 11/07/12 11:48, Wong Kam Hoong wrote:
> I'm using rabbitmq 2.8.3

Please don't. 2.8.3 has a very nasty bug fixed in 2.8.4 (which might be 
responsible for what you're seeing, and anyway could bite you hard):

http://lists.rabbitmq.com/pipermail/rabbitmq-announce/2012-June/000048.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From francesco at rabbitmq.com  Wed Jul 11 12:00:30 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 11 Jul 2012 12:00:30 +0100
Subject: [rabbitmq-discuss] Cluster setup : rabbitmq server stops
	responding to rabbitmqctl commands
In-Reply-To: <EEA1DC407D5C23479BEAAF68C3D560400531C4CA@048-CH1MPN1-213.048d.mgd.msft.net>
References: <EEA1DC407D5C23479BEAAF68C3D560400531C4CA@048-CH1MPN1-213.048d.mgd.msft.net>
Message-ID: <878veq5zqp.wl%francesco@rabbitmq.com>

Hi Sanjiv,

You posted this exact message a few days ago, did you read my reply:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021127.html ?

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Wed Jul 11 12:02:25 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 11 Jul 2012 12:02:25 +0100
Subject: [rabbitmq-discuss] Cluster setup : rabbitmq server stops
	responding to rabbitmqctl commands
In-Reply-To: <EEA1DC407D5C23479BEAAF68C3D560400531C4CA@048-CH1MPN1-213.048d.mgd.msft.net>
References: <EEA1DC407D5C23479BEAAF68C3D560400531C4CA@048-CH1MPN1-213.048d.mgd.msft.net>
Message-ID: <877gua5zni.wl%francesco@rabbitmq.com>

Oh, I noticed that you did add some information to the old post:

At Wed, 11 Jul 2012 10:43:46 +0000,
sanjiv kumar jha wrote:
> (RabbitMQ-Server 2.7.1)

Please upgrade and try to reproduce with the latest rabbit (2.8.4) since
verifying bugs for old versions is very annoying for us.

--
Francesco * Often in error, never in doubt

From simon at rabbitmq.com  Wed Jul 11 12:23:53 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Jul 2012 12:23:53 +0100
Subject: [rabbitmq-discuss] Problem in checkinh out rabbitMQ
	public	umbrella
In-Reply-To: <00ac01cd5f52$de949990$9bbdccb0$@esteeadvisors.com>
References: <00a301cd5f4b$e2626ea0$a7274be0$@esteeadvisors.com>
	<4FFD574F.8010007@rabbitmq.com>
	<00ac01cd5f52$de949990$9bbdccb0$@esteeadvisors.com>
Message-ID: <4FFD6249.3080709@rabbitmq.com>

On 11/07/12 11:49, Ankit Bhardwaj wrote:
> Please tell me how can I resolve this problem?

I have already told you how to resolve this problem. Use Cygwin.

Look, I hope this is not too blunt, but if an error message like "'make' 
is not recognized as a command" is not comprehensible to you, you are 
really going to struggle to write a plugin.

And while we generally try to help out everyone who posts to this list, 
there *are* limits to what we can do. Individually hand-holding a bunch 
of developers from the same company through the steps required to write 
a plugin goes beyond that.

You guys should really think about whether you need to write a plugin 
for your security needs. Very very few people do.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From sanjiv.kumar.jha at accenture.com  Wed Jul 11 12:47:19 2012
From: sanjiv.kumar.jha at accenture.com (sanjiv.kumar.jha at accenture.com)
Date: Wed, 11 Jul 2012 11:47:19 +0000
Subject: [rabbitmq-discuss] Cluster setup : rabbitmq server
	stops	responding to rabbitmqctl commands
In-Reply-To: <877gua5zni.wl%francesco@rabbitmq.com>
References: <EEA1DC407D5C23479BEAAF68C3D560400531C4CA@048-CH1MPN1-213.048d.mgd.msft.net>
	<877gua5zni.wl%francesco@rabbitmq.com>
Message-ID: <EEA1DC407D5C23479BEAAF68C3D560400531C522@048-CH1MPN1-213.048d.mgd.msft.net>

Hi,

We will try replicating this on rabbit 2.8.4.

One more question, do we have any command to check if Node-A is fully started? (rabbitmqctl status?)

Thanks,

Sanjiv

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Francesco Mazzoli
Sent: 11 July 2012 16:32
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Cluster setup : rabbitmq server stops responding to rabbitmqctl commands

Oh, I noticed that you did add some information to the old post:

At Wed, 11 Jul 2012 10:43:46 +0000,
sanjiv kumar jha wrote:
> (RabbitMQ-Server 2.7.1)

Please upgrade and try to reproduce with the latest rabbit (2.8.4) since verifying bugs for old versions is very annoying for us.

--
Francesco * Often in error, never in doubt _______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
______________________________________________________________________________________

www.accenture.com


From francesco at rabbitmq.com  Wed Jul 11 13:03:59 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 11 Jul 2012 13:03:59 +0100
Subject: [rabbitmq-discuss] Cluster setup : rabbitmq
	server	stops	responding to rabbitmqctl commands
In-Reply-To: <EEA1DC407D5C23479BEAAF68C3D560400531C522@048-CH1MPN1-213.048d.mgd.msft.net>
References: <EEA1DC407D5C23479BEAAF68C3D560400531C4CA@048-CH1MPN1-213.048d.mgd.msft.net>
	<877gua5zni.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C522@048-CH1MPN1-213.048d.mgd.msft.net>
Message-ID: <87629u5wsw.wl%francesco@rabbitmq.com>

Hi Sanjiv,

At Wed, 11 Jul 2012 11:47:19 +0000,
sanjiv kumar jha wrote:
> One more question, do we have any command to check if Node-A is fully started?
> (rabbitmqctl status?)

You can use `rabbitmqctl wait'. See the rabbitmqctl manual for more details:
http://www.rabbitmq.com/man/rabbitmqctl.1.man.html .

--
Francesco * Often in error, never in doubt

From meetprashanth437 at gmail.com  Wed Jul 11 16:42:48 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Wed, 11 Jul 2012 11:42:48 -0400
Subject: [rabbitmq-discuss] Cluster with all memory nodes
Message-ID: <CAE8G+yQhFWQKvoVWHbRcFWZ5yBsNcO0s+2E0t3T6SpwHH24M7w@mail.gmail.com>

Hi all,

I am using the cluster command to form a cluster of three nodes.
Is it a cluster should have a disk node. Can I have a cluster with all ram
nodes.

Thanks!!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/72f3b549/attachment.htm>

From ankit.bhardwaj at esteeadvisors.com  Wed Jul 11 11:49:38 2012
From: ankit.bhardwaj at esteeadvisors.com (Ankit Bhardwaj)
Date: Wed, 11 Jul 2012 16:19:38 +0530
Subject: [rabbitmq-discuss] Problem in checkinh out rabbitMQ
	public	umbrella
In-Reply-To: <4FFD574F.8010007@rabbitmq.com>
References: <00a301cd5f4b$e2626ea0$a7274be0$@esteeadvisors.com>
	<4FFD574F.8010007@rabbitmq.com>
Message-ID: <00ac01cd5f52$de949990$9bbdccb0$@esteeadvisors.com>

Hi Simon,

I have already gone through this thread, but couldn't find anything useful
to me.
Please tell me how can I resolve this problem?

Thanks
Ankit Bhardwaj
M : +91 8750005100


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Wednesday, July 11, 2012 4:07 PM
To: Discussions about RabbitMQ
Cc: Ankit Bhardwaj; 'Binod Singh'; ankur.jain at esteeadvisors.com
Subject: Re: [rabbitmq-discuss] Problem in checkinh out rabbitMQ public
umbrella

On 11/07/12 10:59, Ankit Bhardwaj wrote:
> I am not able to check out rabbitMQ public umbrella on my local 
> windows machine.
>
> The message I am seeing is 'make is not an recognized command'.

Please see the email thread with your colleague Ashutosh Trivedi starting
here:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-June/020638.html

In general, to build plugins on Windows you will need cygwin.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware


From dgillies at brandscreen.com  Wed Jul 11 13:35:49 2012
From: dgillies at brandscreen.com (David Gillies)
Date: Wed, 11 Jul 2012 05:35:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Restarting/re-establising failed federation
	connections
Message-ID: <e5c07cc1-c5c2-4614-aef8-cee6dbcb64a7@googlegroups.com>

Hi, 

So I've got a simple federated setup where we have a bunch of rabbits in 
various data centres all publishing to a central upstream queue. This works 
well for most of them, except for one data centre which has particularly 
bad connectivity. I've found the upstream rabbitmq server gets into a 
situation where by it loses connectivity to the downstream rabbit and is 
never able to connect again which results me going to the lengths of 
restarting the upstream rabbitmq cluster (just two servers in a cluster). 
Is there a less heavy handed way of re-establising the connection to the 
downstream cluster for situations where the federation plugin can't seem to 
reconnect anymore?

Thanks,
David.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/76c44176/attachment.htm>

From anthony at lshift.net  Wed Jul 11 13:48:25 2012
From: anthony at lshift.net (Anthony Harris)
Date: Wed, 11 Jul 2012 13:48:25 +0100
Subject: [rabbitmq-discuss] rabbitmq-server process consumes 100% of 1 CPU
 (rabbitmq 2.8.4 on Erlang R14B04)
Message-ID: <4FFD7619.3010208@lshift.net>

Hi,

We've run into what appears to be the same issue as was reported
14-Jun-2012 in "rabbitmq 2.8.2 beam process consumes 100% of one cpu in
tight epoll_wait loop" with the following system configuration:
* RabbitMQ 2.8.4
* Erlang R14B04

There was no activity on the instance, but there were ~1400 queues left
open since starting (durable queues persisted through reboot).

We observed the following:
* CPU usage immediately jumped to more than 100% CPU utilisation (up to
300% on another affected four-way host)
* responsiveness of rabbitmqctl deteriorated quickly (up to 5 seconds
for a status report)

The output of etop (against the affected node) is listed at the end of
this email.

Whilst we were collecting the data below however, we also found that
etop would emit a huge volume of messages like this:

Erlang top got garbage {trace_ts,<4806.155.0>,out,
                                 {lists,foldl,3},
                                 {1342,6858,451064}}
The output was sufficiently voluminous to create ~40MB of output in a
minute or so.

When we ran strace over the beam.smp process, filtering out calls to
sched_yield, epoll_wait and futex, we noticed that the process seemed to
be continuously opening and closing mnesia journal files correlating to
it's queues (see attached file). To our eyes, this seems to correlate
with the activity of the file_handle_cache process in the etop output,
but don't know enough to say if that is definitely the case.

We've seen similar results on as system with the configuration:
* RabbitMQ 2.7.0
* Erlang R14B03

On that system, however, we observed only 100% CPU utilisation (on 1
core).  That behaviour more closely matches the symptoms observed in
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-June/020620.html

We also observed the same pattern of output from strace (EAGAIN from a
pipe, calls to epoll_wait in a tight loop).

We could spend a lot longer trying to trace the cause, but we'd greatly
appreciate if you could look into this, as it seems to not be an
isolated incident.


Regards,
Anthony


(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:44:39
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache
36681********80398152       0 gen_server2:loop/1
(etop at ci-slave-lin5)1> <4806.219.0>   proc_lib:init_p/5       6420
3468715  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5
144******** 7628376       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1603.0>  proc_lib:init_p/5        107
3483195  109264       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.912.0>   proc_lib:init_p/5        100
3463759  196928       2 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.1462.0>  proc_lib:init_p/5         93
3499173  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.331.0>   proc_lib:init_p/5         92
3509679  163416       0 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.220.0>   proc_lib:init_p/5         88
3493388  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1281.0>  proc_lib:init_p/5         82
3497526  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1597.0>  proc_lib:init_p/5         81
3525102  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:44:44
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     603362
6342434********     292 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      94480
1281752 7628376       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1517.0>  proc_lib:init_p/5      25444
3440  286992      80 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.1462.0>  proc_lib:init_p/5      14122
10484  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.251.0>   proc_lib:init_p/5       7711
1721  287504      96 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.199.0>   rabbit_memory_monito    6030
15909  129672       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.167.0>   rabbit_event            5913
11527   42224       0 gen_event:fetch_msg/
(etop at ci-slave-lin5)1> <4806.446.0>   proc_lib:init_p/5       5702
27798  196832       0 rabbit_variable_queu
(etop at ci-slave-lin5)1> <4806.699.0>   proc_lib:init_p/5       5562
27048  263728       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.314.0>   proc_lib:init_p/5       5473
27142  284432       1 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:44:49
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     354652
3760046********     136 lists:foldl/3
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      75034
1307713 4715224       8 proplists:get_value/
(etop at ci-slave-lin5)1> <4806.1462.0>  proc_lib:init_p/5      57904
10483  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1080.0>  proc_lib:init_p/5      15074
32069  196832       0 file_handle_cache:pu
(etop at ci-slave-lin5)1> <4806.1516.0>  proc_lib:init_p/5      12215
32832  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.848.0>   proc_lib:init_p/5      11437
32976  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.475.0>   proc_lib:init_p/5      11142
33599  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.801.0>   proc_lib:init_p/5      10391
32639  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.857.0>   proc_lib:init_p/5      10268
31693  196864       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.866.0>   proc_lib:init_p/5       8475
32597  163416       1 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:44:55
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     369157
3326079********     675 lists:foldl/3
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      35631
1333882 7628560       5 proplists:get_value/
(etop at ci-slave-lin5)1> <4806.1462.0>  proc_lib:init_p/5      33387
10131  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.530.0>   proc_lib:init_p/5      15506
39052  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.778.0>   proc_lib:init_p/5      15427
39348  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.785.0>   proc_lib:init_p/5      14875
40295  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.770.0>   proc_lib:init_p/5      14395
10096  284400       0 file_handle_cache:pu
(etop at ci-slave-lin5)1> <4806.1084.0>  proc_lib:init_p/5      13049
40911  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1324.0>  proc_lib:init_p/5      12875
39092  196864       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.740.0>   proc_lib:init_p/5      12281
40218  176160       0 file_handle_cache:pu
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:45:00
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     381061
3264868********     303 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      89767
1360720 7628784      12 proplists:get_value/
(etop at ci-slave-lin5)1> <4806.1462.0>  proc_lib:init_p/5      33557
9419  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1247.0>  proc_lib:init_p/5      21772
45062  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1586.0>  proc_lib:init_p/5      15283
9522  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1046.0>  proc_lib:init_p/5      12113
41757  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.809.0>   proc_lib:init_p/5      11990
45574  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.727.0>   proc_lib:init_p/5      11673
9425  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1123.0>  proc_lib:init_p/5      11220
8404  163832      13 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.710.0>   proc_lib:init_p/5      10278
38415  176192       1 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:45:05
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     373685
4510295********      73 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      60559
1370669 4714944       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1462.0>  proc_lib:init_p/5      56902
5711  177472      40 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.1072.0>  proc_lib:init_p/5      11439
9061  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.715.0>   proc_lib:init_p/5      10288
39610  163416       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.857.0>   proc_lib:init_p/5       9311
9060  163416       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1110.0>  proc_lib:init_p/5       8930
21719  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.809.0>   proc_lib:init_p/5       8710
9249  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1131.0>  proc_lib:init_p/5       8332
23505  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1187.0>  proc_lib:init_p/5       8121
9134  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:45:10
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     608264
639759941258408      85 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1586.0>  proc_lib:init_p/5      60486
10673  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      36301
1319523 4714944       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1095.0>  proc_lib:init_p/5       9594
10753  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.825.0>   proc_lib:init_p/5       9220
10855  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.778.0>   proc_lib:init_p/5       8858
10895  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.791.0>   proc_lib:init_p/5       7175
1711  200192     104 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.199.0>   rabbit_memory_monito    6389
17622  129672       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.167.0>   rabbit_event            5468
12555   34328       0 gen_event:fetch_msg/
(etop at ci-slave-lin5)1> <4806.1220.0>  proc_lib:init_p/5       5331
23649  426088       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:45:16
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     474511
402239458220816    1089 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      31989
1319504 7628472       3 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1586.0>  proc_lib:init_p/5      17757
11395  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.766.0>   proc_lib:init_p/5       9903
28407  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1467.0>  proc_lib:init_p/5       9435
11388  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.511.0>   proc_lib:init_p/5       8705
11209  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1318.0>  proc_lib:init_p/5       8139
11380  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1465.0>  proc_lib:init_p/5       8047
11396  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.750.0>   proc_lib:init_p/5       7996
31235  122040       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.851.0>   proc_lib:init_p/5       7305
 0  291600     224 gen:do_call/4
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:45:21
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     371042
337973358206400    1044 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      83579
1317230 7628376       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.308.0>   proc_lib:init_p/5      13238
37066  142712       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.736.0>   proc_lib:init_p/5      12227
37530  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1229.0>  proc_lib:init_p/5       9065
37208  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.914.0>   proc_lib:init_p/5       8477
10076  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1490.0>  proc_lib:init_p/5       8389
10124  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.376.0>   proc_lib:init_p/5       8271
35172  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.388.0>   proc_lib:init_p/5       7964
36146  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.787.0>   proc_lib:init_p/5       7347
10148  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:45:26
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     361567
344879058168176      74 file_handle_cache:'-
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      28719
1356844 4715328      12 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1517.0>  proc_lib:init_p/5      13391
10036  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.654.0>   proc_lib:init_p/5      10458
38215  176192       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.413.0>   proc_lib:init_p/5      10155
41685  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.452.0>   proc_lib:init_p/5       8858
10287  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1047.0>  proc_lib:init_p/5       8098
32497  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.496.0>   proc_lib:init_p/5       7991
37605  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1458.0>  proc_lib:init_p/5       7824
30971  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.221.0>   proc_lib:init_p/5       7706
39544  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:45:31
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     420465
460800491164200       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5     109975
1365688 4714944       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1517.0>  proc_lib:init_p/5      28722
9319  284432       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.969.0>   proc_lib:init_p/5      14990
33568  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.199.0>   rabbit_memory_monito   13184
21404  129672       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.369.0>   proc_lib:init_p/5      11974
36802  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.747.0>   proc_lib:init_p/5      11410
35004  196864       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1325.0>  proc_lib:init_p/5      10215
34080  263728       0 file_handle_cache:pu
(etop at ci-slave-lin5)1> <4806.933.0>   proc_lib:init_p/5      10068
9536  196832       0 file_handle_cache:pu
(etop at ci-slave-lin5)1> <4806.1048.0>  proc_lib:init_p/5       7904
9489  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:45:37
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     712420
650484191205136     553 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      83277
1324824 7628456       2 lists:'-concat/1-fun
(etop at ci-slave-lin5)1> <4806.1126.0>  proc_lib:init_p/5      19381
10400  101368       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1517.0>  proc_lib:init_p/5      15301
10389  284464       2 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.856.0>   proc_lib:init_p/5      12669
10408  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.858.0>   proc_lib:init_p/5      11553
10405  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1329.0>  proc_lib:init_p/5      11163
25310  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.904.0>   proc_lib:init_p/5      10211
21848  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.631.0>   proc_lib:init_p/5      10166
26370  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.949.0>   proc_lib:init_p/5      10095
25815  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:45:42
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     401679
414815191213376    1011 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      87918
1411556 2173056      16 rabbit_mgmt_format:f
(etop at ci-slave-lin5)1> <4806.858.0>   proc_lib:init_p/5      49060
11191  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.793.0>   proc_lib:init_p/5      23977
29512  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1208.0>  proc_lib:init_p/5      15211
27978  284432       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1316.0>  proc_lib:init_p/5      15067
11011  196864       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1517.0>  proc_lib:init_p/5      13764
11192  284432       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.895.0>   proc_lib:init_p/5      12133
28624  284432       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1464.0>  proc_lib:init_p/5      11427
11094  163416       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1231.0>  proc_lib:init_p/5      10371
11229  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:45:47
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     308855
352530291216168     987 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      94950
1659062 4117008      68 rabbit_mgmt_db:pget/
(etop at ci-slave-lin5)1> <4806.1200.0>  proc_lib:init_p/5      14179
38622  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.840.0>   proc_lib:init_p/5       9142
38574  263728       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.463.0>   proc_lib:init_p/5       8800
10681  109296       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1322.0>  proc_lib:init_p/5       8769
38403  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1210.0>  proc_lib:init_p/5       8310
10668  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1333.0>  proc_lib:init_p/5       7589
37860  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.167.0>   rabbit_event            6704
12760   42288       2 gen_event:fetch_msg/
(etop at ci-slave-lin5)1> <4806.1128.0>  proc_lib:init_p/5       6683
38314  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:45:53
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     272243
3182835********      56 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      70426
1291511 8238048      96 rabbit_mgmt_db:is_de
(etop at ci-slave-lin5)1> <4806.579.0>   proc_lib:init_p/5      16089
43407  101368       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.578.0>   proc_lib:init_p/5      12557
41333  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.253.0>   proc_lib:init_p/5      10648
41098  263728       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1517.0>  proc_lib:init_p/5      10296
9327  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.593.0>   proc_lib:init_p/5       8863
34641  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.682.0>   proc_lib:init_p/5       8538
15815  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1371.0>  proc_lib:init_p/5       8053
9344  109264       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.925.0>   proc_lib:init_p/5       8043
41693  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:45:58
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     398161
3901770********     830 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      59160
2078217 4714976       1 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1517.0>  proc_lib:init_p/5      19017
4528  286096      52 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.1161.0>  proc_lib:init_p/5      18239
9059  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1368.0>  proc_lib:init_p/5      18136
9042  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.407.0>   proc_lib:init_p/5      17377
33134  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1546.0>  proc_lib:init_p/5      11297
9050  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.826.0>   proc_lib:init_p/5      10419
8971  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.315.0>   proc_lib:init_p/5      10140
8986  176192       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1389.0>  proc_lib:init_p/5       8969
35056  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:46:03
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     579763
6033273********     274 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5     102043
1284933 7638512     119 rabbit_mgmt_format:t
(etop at ci-slave-lin5)1> <4806.787.0>   proc_lib:init_p/5      52241
23479  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1161.0>  proc_lib:init_p/5      28945
5084  177824      51 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.1422.0>  proc_lib:init_p/5       9509
92  201696     151 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.1307.0>  proc_lib:init_p/5       8631
9577  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1392.0>  proc_lib:init_p/5       8505
25367  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.167.0>   rabbit_event            8022
13152   55000       0 gen_event:fetch_msg/
(etop at ci-slave-lin5)1> <4806.684.0>   proc_lib:init_p/5       7884
9603  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.199.0>   rabbit_memory_monito    7638
19398  118760       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:46:08
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     466390
4306327********       0 gen_server2:handle_c
(etop at ci-slave-lin5)1> <4806.787.0>   proc_lib:init_p/5      48740
10396  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      31582
1349050 7628376       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.283.0>   proc_lib:init_p/5      14945
10580  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1311.0>  proc_lib:init_p/5      12190
25418  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.530.0>   proc_lib:init_p/5       9814
10507   88592       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.405.0>   proc_lib:init_p/5       9448
10497  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1061.0>  proc_lib:init_p/5       8796
10423  109264       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.888.0>   proc_lib:init_p/5       8726
10514  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.859.0>   proc_lib:init_p/5       7814
4463  199072      69 gen:do_call/4
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:46:13
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     430687
3898666********     805 gen_server2:in/3
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      82691
1356565 7628376       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1578.0>  proc_lib:init_p/5      21030
33457  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1024.0>  proc_lib:init_p/5      11178
33308  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.711.0>   proc_lib:init_p/5      10609
34540  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.787.0>   proc_lib:init_p/5      10541
11296  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.408.0>   proc_lib:init_p/5      10385
34241  142712       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.809.0>   proc_lib:init_p/5       9364
11314  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.336.0>   proc_lib:init_p/5       9111
11285  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1187.0>  proc_lib:init_p/5       8609
11305  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:46:19
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     287339
3311890********      11 gen_server2:handle_m
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      63553
1319976 7628656       8 proplists:get_value/
(etop at ci-slave-lin5)1> <4806.530.0>   proc_lib:init_p/5      23944
9876   63040       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.933.0>   proc_lib:init_p/5      19043
38142  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1586.0>  proc_lib:init_p/5      15096
9947  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.846.0>   proc_lib:init_p/5      14685
40333  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1448.0>  proc_lib:init_p/5      13976
9970  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1594.0>  proc_lib:init_p/5      10233
38359  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1175.0>  proc_lib:init_p/5       9865
41515  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1299.0>  proc_lib:init_p/5       9156
9951  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:46:24
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     328106
3701791********    1419 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      35864
1348673 4714944       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.412.0>   proc_lib:init_p/5      20773
36341  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1586.0>  proc_lib:init_p/5      16916
9423  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1231.0>  proc_lib:init_p/5      12504
34956  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.591.0>   proc_lib:init_p/5      11053
31353  142712       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1025.0>  proc_lib:init_p/5       9272
9658   88592       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1060.0>  proc_lib:init_p/5       9082
40103  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.389.0>   proc_lib:init_p/5       8408
36100  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1524.0>  proc_lib:init_p/5       8091
40976  142712       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:46:29
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     525547
5490099********      17 lists:foldl/3
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      57527
1348039 4714944       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1219.0>  proc_lib:init_p/5      15380
10038  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1517.0>  proc_lib:init_p/5      12887
22194  263728       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.787.0>   proc_lib:init_p/5      12530
10048  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.938.0>   proc_lib:init_p/5      12103
22718  101368       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1386.0>  proc_lib:init_p/5      10706
21631  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.249.0>   proc_lib:init_p/5      10472
25174  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1126.0>  proc_lib:init_p/5      10469
24285  109264       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.560.0>   proc_lib:init_p/5       9538
21873  263728       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:46:34
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     533337
519511658199768     754 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      76066
1311722 4714944       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1180.0>  proc_lib:init_p/5      58063
10021  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1517.0>  proc_lib:init_p/5      50387
10059  284432       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1126.0>  proc_lib:init_p/5      27804
10048  142712       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.745.0>   proc_lib:init_p/5      14248
25234  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.167.0>   rabbit_event           12832
11290   42256       1 gen_event:fetch_msg/
(etop at ci-slave-lin5)1> <4806.1004.0>  proc_lib:init_p/5      11063
25274  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1504.0>  proc_lib:init_p/5       8816
10136  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1294.0>  proc_lib:init_p/5       8590
6372  164792      43 gen:do_call/4
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:46:39
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     314909
374099458172336      25 lists:foldl/3
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      89405
1298368 4715040       3 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1126.0>  proc_lib:init_p/5      35143
10031  101368       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1386.0>  proc_lib:init_p/5      16413
10058  163416       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.858.0>   proc_lib:init_p/5      15065
9937  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1407.0>  proc_lib:init_p/5      11821
30788  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.935.0>   proc_lib:init_p/5      11022
29984  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1069.0>  proc_lib:init_p/5      10525
29881  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1250.0>  proc_lib:init_p/5       8800
9972  142744       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1217.0>  proc_lib:init_p/5       8143
10052  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:46:44
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     355578
344041358180832     317 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.858.0>   proc_lib:init_p/5      43828
10239  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1195.0>  proc_lib:init_p/5      28740
36075  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      20712
1337810 7628376       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1438.0>  proc_lib:init_p/5      19897
35354  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1227.0>  proc_lib:init_p/5      12504
37949  122040       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.242.0>   proc_lib:init_p/5      12279
35276  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1472.0>  proc_lib:init_p/5      11629
37350  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1424.0>  proc_lib:init_p/5      11420
36034  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.410.0>   proc_lib:init_p/5      11033
37948  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:46:49
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     336489
390343764345656       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      94420
1353540 7628376       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.858.0>   proc_lib:init_p/5      30558
9420  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.257.0>   proc_lib:init_p/5      11436
41548  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.728.0>   proc_lib:init_p/5      10861
34225  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.450.0>   proc_lib:init_p/5      10222
37727  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.175.0>   os_cmd_port_creator     9965
 6    5576       0 os:start_port_srv_lo
(etop at ci-slave-lin5)1> <4806.1297.0>  proc_lib:init_p/5       9850
12579  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.752.0>   proc_lib:init_p/5       8960
9410  196864       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1380.0>  proc_lib:init_p/5       8685
9590  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:46:54
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     413618
421532491216016    1021 gen_server2:drain/1
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      45104
1349170 4715008       2 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1517.0>  proc_lib:init_p/5      25616
9493  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.699.0>   proc_lib:init_p/5      11537
26576  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.259.0>   proc_lib:init_p/5      10517
24809  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1321.0>  proc_lib:init_p/5       9348
34490  263728       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.315.0>   proc_lib:init_p/5       9121
20500  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.605.0>   proc_lib:init_p/5       8443
9401  176352       5 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.199.0>   rabbit_memory_monito    7231
19696  110864       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1333.0>  proc_lib:init_p/5       6438
34163  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:47:00
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     467057
561699391178064     117 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5     102801
1326080 4714944       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1344.0>  proc_lib:init_p/5      24217
9676  196864       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1517.0>  proc_lib:init_p/5      20705
4234  265776      63 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.1458.0>  proc_lib:init_p/5      14414
9890  196864       0 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.354.0>   proc_lib:init_p/5      14346
7936  176864      21 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.882.0>   proc_lib:init_p/5      11355
25534  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.979.0>   proc_lib:init_p/5      10430
9096  197120       8 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.864.0>   proc_lib:init_p/5       8201
9599  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.167.0>   rabbit_event            6490
12320   67808       1 gen_event:fetch_msg/
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:47:05
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     452238
440276191187776     418 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.228.0>   proc_lib:init_p/5      63052
10845  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      45829
1301427 7628376       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.641.0>   proc_lib:init_p/5      14573
10808  196864       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1215.0>  proc_lib:init_p/5      10299
29131  109296       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.324.0>   proc_lib:init_p/5       7168
10918  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1443.0>  proc_lib:init_p/5       6647
27389  122040       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.293.0>   proc_lib:init_p/5       5614
31171  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.722.0>   proc_lib:init_p/5       5211
27052  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.216.0>   proc_lib:init_p/5       5083
22204  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:47:10
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     358625
354421291212936     451 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      33084
1304706 7628376       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.787.0>   proc_lib:init_p/5      30809
10389  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.300.0>   proc_lib:init_p/5      13210
35853  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1219.0>  proc_lib:init_p/5      11653
33969  176192       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1472.0>  proc_lib:init_p/5      10920
10332  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.920.0>   proc_lib:init_p/5      10246
35673  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.641.0>   proc_lib:init_p/5      10105
10130  163544       4 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.542.0>   proc_lib:init_p/5       9890
35877  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.780.0>   proc_lib:init_p/5       9228
31279  109264       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:47:15
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     335100
3392312********     456 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      54952
1355733 7628376       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1079.0>  proc_lib:init_p/5      17985
38010  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.416.0>   proc_lib:init_p/5      14833
39924  263728       0 file_handle_cache:wi
(etop at ci-slave-lin5)1> <4806.391.0>   proc_lib:init_p/5      14123
9587  109264       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1318.0>  proc_lib:init_p/5      13096
36218  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.956.0>   proc_lib:init_p/5      11993
40052  163416       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.261.0>   proc_lib:init_p/5      10772
39489  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.247.0>   proc_lib:init_p/5       9997
37634  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1462.0>  proc_lib:init_p/5       9536
6235  198144      40 gen:do_call/4
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:47:21
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     375103
4091283********    1179 rabbit_amqqueue:set_
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      59507
1363580 7628632       8 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1109.0>  proc_lib:init_p/5      19595
34180  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1244.0>  proc_lib:init_p/5      16177
37798  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.787.0>   proc_lib:init_p/5      14892
9575  196864       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.451.0>   proc_lib:init_p/5      11988
38706  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.716.0>   proc_lib:init_p/5      11104
39224  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1580.0>  proc_lib:init_p/5      10632
9719  196864       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.780.0>   proc_lib:init_p/5       9966
9696  142712       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.260.0>   proc_lib:init_p/5       9384
36353  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:47:26
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     567269
5844914********       2 gen_server2:loop/1
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      45727
1339452 7628376       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1072.0>  proc_lib:init_p/5      14708
10479  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.779.0>   proc_lib:init_p/5      11396
24223  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1602.0>  proc_lib:init_p/5      10849
25499  109264       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.783.0>   proc_lib:init_p/5       8785
10498   67920       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1419.0>  proc_lib:init_p/5       8272
10597  263728       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1221.0>  proc_lib:init_p/5       7388
9078  197408      17 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.310.0>   proc_lib:init_p/5       6403
23908  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.167.0>   rabbit_event            5282
13848   42224       0 gen_event:fetch_msg/
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:47:31
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     490370
4785283********     145 timer:now_diff/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      94384
1304098 7628504       4 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.787.0>   proc_lib:init_p/5      22252
10809  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1060.0>  proc_lib:init_p/5      11349
10772  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1072.0>  proc_lib:init_p/5       9479
10755  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.858.0>   proc_lib:init_p/5       9451
25206  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1149.0>  proc_lib:init_p/5       8466
10703  196832       0 file_handle_cache:pu
(etop at ci-slave-lin5)1> <4806.1022.0>  proc_lib:init_p/5       7014
 0  170328     216 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.1586.0>  proc_lib:init_p/5       6088
10743  196896       2 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1167.0>  proc_lib:init_p/5       5912
2080  287568      98 gen:do_call/4
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:47:36
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     359279
3668969********     882 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5     100054
1314192 4714976       1 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.1551.0>  proc_lib:init_p/5      17155
10653  263728       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.887.0>   proc_lib:init_p/5      15044
34552   67920       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.858.0>   proc_lib:init_p/5      14432
10582  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1261.0>  proc_lib:init_p/5      12231
35035  142744       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.876.0>   proc_lib:init_p/5       8872
30935  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1519.0>  proc_lib:init_p/5       7573
10554  176160       0 file_handle_cache:pu
(etop at ci-slave-lin5)1> <4806.1266.0>  proc_lib:init_p/5       7128
31939  109264       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1422.0>  proc_lib:init_p/5       6998
34228   88592       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:47:41
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     320963
3568928********     338 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      87663
1344643 4714944       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.858.0>   proc_lib:init_p/5      26699
9685  163384       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1517.0>  proc_lib:init_p/5      16175
9798  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.421.0>   proc_lib:init_p/5      11819
9608  196928       2 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.218.0>   proc_lib:init_p/5       9553
9669  284400       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.915.0>   proc_lib:init_p/5       9341
9704  122040       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.288.0>   proc_lib:init_p/5       9156
9685  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1357.0>  proc_lib:init_p/5       8442
9809  196864       1 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.361.0>   proc_lib:init_p/5       7763
9767  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:47:47
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     361707
3844289********     108 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      43057
1365655 7628376       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.338.0>   proc_lib:init_p/5      37397
9826   88592       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.826.0>   proc_lib:init_p/5      17902
25391  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.903.0>   proc_lib:init_p/5      12779
39566  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1466.0>  proc_lib:init_p/5      10386
34370  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.481.0>   proc_lib:init_p/5       9112
9688  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1504.0>  proc_lib:init_p/5       8971
9600  263728       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1399.0>  proc_lib:init_p/5       8804
9594  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.949.0>   proc_lib:init_p/5       8531
31619  176160       0 file_handle_cache:pu
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>  'rabbit at ci-slave-lin5'
                          11:47:52
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1> Pid            Name or Initial Func    Time
Reds  Memory    MsgQ Current Function
(etop at ci-slave-lin5)1>
----------------------------------------------------------------------------------------
(etop at ci-slave-lin5)1> <4806.155.0>   file_handle_cache     507389
5004720********     652 lists:foreach/2
(etop at ci-slave-lin5)1> <4806.944.0>   proc_lib:init_p/5      79844
9865  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1667.0>  proc_lib:init_p/5      33807
1340135 7628376       0 gen_server:loop/6
(etop at ci-slave-lin5)1> <4806.506.0>   proc_lib:init_p/5      14991
27482  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1364.0>  proc_lib:init_p/5      12434
 0  169272     183 gen:do_call/4
(etop at ci-slave-lin5)1> <4806.218.0>   proc_lib:init_p/5      11053
9849  263728       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1481.0>  proc_lib:init_p/5      10933
9785  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1469.0>  proc_lib:init_p/5      10213
9774  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.969.0>   proc_lib:init_p/5       9770
9873  176160       0 gen_server2:process_
(etop at ci-slave-lin5)1> <4806.1181.0>  proc_lib:init_p/5       9531
9765  196832       0 gen_server2:process_
(etop at ci-slave-lin5)1>
========================================================================================
(etop at ci-slave-lin5)1>
(etop at ci-slave-lin5)1>
-------------- next part --------------
[pid 27404] close(515)                  = 0
[pid 27405] close(622)                  = 0
[pid 27418] munmap(0x7fe45a828000, 974848) = 0
[pid 27418] mmap(NULL, 1572864, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fe45a796000
[pid 27409] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/5H5K8QOLA0KN5T7GDR018MEEW/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27409] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/5H5K8QOLA0KN5T7GDR018MEEW/journal.jif", O_RDWR|O_CREAT, 0666) = 424
[pid 27418] munmap(0x7fe448413000, 13463552) = 0
[pid 27418] munmap(0x7fe4989d6000, 974848) = 0
[pid 27407] close(624)                  = 0
[pid 27410] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/4G87PPYQ0THSMGCWZJAPIMMG/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27410] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/4G87PPYQ0THSMGCWZJAPIMMG/journal.jif", O_RDWR|O_CREAT, 0666) = 425
[pid 27419] mmap(NULL, 13463552, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fe448413000
[pid 27411] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/1MMKWVVBHX09XSNFA9WG02PRP/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27411] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/1MMKWVVBHX09XSNFA9WG02PRP/journal.jif", O_RDWR|O_CREAT, 0666) = 426
[pid 27406] close(623)                  = 0
[pid 27412] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/3BG1IP0TEK8BGZI6AMNS33S0H/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27412] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/3BG1IP0TEK8BGZI6AMNS33S0H/journal.jif", O_RDWR|O_CREAT, 0666) = 427
[pid 27413] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/5N52RIGNR8LZJ581O9P0W595M/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27413] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/5N52RIGNR8LZJ581O9P0W595M/journal.jif", O_RDWR|O_CREAT, 0666) = 428
[pid 27408] close(625)                  = 0
[pid 27414] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/1Y0KVTNBOPV5ENE7HWE7FANF1/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27414] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/1Y0KVTNBOPV5ENE7HWE7FANF1/journal.jif", O_RDWR|O_CREAT, 0666) = 429
[pid 27409] close(626)                  = 0
[pid 27415] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/73PV9BVSZIWW7Q2ZSE9I6BH2U/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27415] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/73PV9BVSZIWW7Q2ZSE9I6BH2U/journal.jif", O_RDWR|O_CREAT, 0666) = 430
[pid 27416] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/5NZWQY3OE6SS7S7XCHRBT6VV2/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27416] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/5NZWQY3OE6SS7S7XCHRBT6VV2/journal.jif", O_RDWR|O_CREAT, 0666) = 431
[pid 27388] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/8J125FN8OUOYF0XSPNBNWLFS3/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27388] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/8J125FN8OUOYF0XSPNBNWLFS3/journal.jif", O_RDWR|O_CREAT, 0666) = 432
[pid 27387] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/180EBH0Y63ND7RJT3V8G0ME73/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27387] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/180EBH0Y63ND7RJT3V8G0ME73/journal.jif", O_RDWR|O_CREAT, 0666) = 433
[pid 27389] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/M3JJOTHHCHSYRVPY4YWTWSKP/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27389] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/M3JJOTHHCHSYRVPY4YWTWSKP/journal.jif", O_RDWR|O_CREAT, 0666) = 434
[pid 27410] close(627)                  = 0
[pid 27411] close(516)                  = 0
[pid 27413] close(629)                  = 0
[pid 27390] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/BR0B92B3PSL683X3OQIL1GHQB/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27390] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/BR0B92B3PSL683X3OQIL1GHQB/journal.jif", O_RDWR|O_CREAT, 0666) = 435
[pid 27419] mmap(NULL, 974848, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fe4989d6000
[pid 27418] write(4, "!", 1)            = 1
[pid 27419] read(3, "!", 32)            = 1
[pid 27419] read(3, 0x7fe49ab232e0, 32) = -1 EAGAIN (Resource temporarily unavailable)
[pid 27391] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/1ABYJL08VJ8CVF4Y10SV689SF/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27391] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/1ABYJL08VJ8CVF4Y10SV689SF/journal.jif", O_RDWR|O_CREAT, 0666) = 436
[pid 27392] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/8X46WGNX2UAC3XDT1JJ43O50P/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27392] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/8X46WGNX2UAC3XDT1JJ43O50P/journal.jif", O_RDWR|O_CREAT, 0666) = 437
[pid 27419] munmap(0x7fe444d2d000, 13463552) = 0
[pid 27419] munmap(0x7fe45a796000, 1572864) = 0
[pid 27419] mmap(NULL, 100306944, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fe437201000
[pid 27393] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/4ZZ1M45UCGT7WRNCFBXMHPLBJ/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27393] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/4ZZ1M45UCGT7WRNCFBXMHPLBJ/journal.jif", O_RDWR|O_CREAT, 0666) = 438
[pid 27412] close(628)                  = 0
[pid 27419] write(4, "!", 1)            = 1
[pid 27418] read(3, "!", 32)            = 1
[pid 27418] read(3, 0x7fe49b3242e0, 32) = -1 EAGAIN (Resource temporarily unavailable)
[pid 27394] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/AD3IR47D0AH483EVVTVLBTIH3/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27394] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/AD3IR47D0AH483EVVTVLBTIH3/journal.jif", O_RDWR|O_CREAT, 0666) = 439
[pid 27395] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/BOXM3H4SCZDZADB4E5YPFW2RL/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27395] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/BOXM3H4SCZDZADB4E5YPFW2RL/journal.jif", O_RDWR|O_CREAT, 0666) = 440
[pid 27396] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/29572I5GN1BFLUI6HUOK67A97/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27396] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/29572I5GN1BFLUI6HUOK67A97/journal.jif", O_RDWR|O_CREAT, 0666) = 441
[pid 27397] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/C6TW9PD0E194ESWYTZILUGQ4H/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27397] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/C6TW9PD0E194ESWYTZILUGQ4H/journal.jif", O_RDWR|O_CREAT, 0666) = 442
[pid 27419] write(4, "!", 1 <unfinished ...>
[pid 27418] read(3, "!", 32)            = 1
[pid 27418] read(3, 0x7fe49b3242e0, 32) = -1 EAGAIN (Resource temporarily unavailable)
[pid 27419] <... write resumed> )       = 1
[pid 27418] write(4, "!", 1)            = 1
[pid 27419] read(3, "!", 32)            = 1
[pid 27419] read(3, 0x7fe49ab232e0, 32) = -1 EAGAIN (Resource temporarily unavailable)
[pid 27419] write(4, "!", 1)            = 1
[pid 27419] read(3, "!", 32)            = 1
[pid 27419] read(3, 0x7fe49ab232e0, 32) = -1 EAGAIN (Resource temporarily unavailable)
[pid 27419] write(4, "!", 1)            = 1
[pid 27418] read(3, "!", 32)            = 1
[pid 27418] read(3, 0x7fe49b3242e0, 32) = -1 EAGAIN (Resource temporarily unavailable)
[pid 27398] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/2XOYI61BMOL6WOBJBN9L1LYLF/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27398] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/2XOYI61BMOL6WOBJBN9L1LYLF/journal.jif", O_RDWR|O_CREAT, 0666) = 443
[pid 27418] write(4, "!", 1)            = 1
[pid 27419] read(3, "!", 32)            = 1
[pid 27419] read(3, 0x7fe49ab232e0, 32) = -1 EAGAIN (Resource temporarily unavailable)
[pid 27399] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/9GLI52BSC3ZYBP03SWJ8PUFYZ/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27399] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/9GLI52BSC3ZYBP03SWJ8PUFYZ/journal.jif", O_RDWR|O_CREAT, 0666) = 444
[pid 27418] munmap(0x7fe43a2fc000, 48947200) = 0
[pid 27418] mmap(NULL, 1572864, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fe45a796000
[pid 27400] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/AR6K5E9O5KBRZ2M7INFUY928X/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27400] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/AR6K5E9O5KBRZ2M7INFUY928X/journal.jif", O_RDWR|O_CREAT, 0666) = 445
[pid 27401] stat("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/CCBHE5A8W1714FPEV3UMJGIW1/journal.jif", {st_mode=S_IFREG|0644, st_size=0, ...}) = 0
[pid 27401] open("/var/lib/rabbitmq/mnesia/rabbit at ci-slave-lin5/queues/CCBHE5A8W1714FPEV3UMJGIW1/journal.jif", O_RDWR|O_CREAT, 0666) = 446

From francesco at rabbitmq.com  Wed Jul 11 17:21:14 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 11 Jul 2012 17:21:14 +0100
Subject: [rabbitmq-discuss] Cluster with all memory nodes
In-Reply-To: <CAE8G+yQhFWQKvoVWHbRcFWZ5yBsNcO0s+2E0t3T6SpwHH24M7w@mail.gmail.com>
References: <CAE8G+yQhFWQKvoVWHbRcFWZ5yBsNcO0s+2E0t3T6SpwHH24M7w@mail.gmail.com>
Message-ID: <874npe5kw5.wl%francesco@rabbitmq.com>

Hi Prashanth,
At Wed, 11 Jul 2012 11:42:48 -0400,
Prashanth  wrote:
> Hi all,
> 
> I am using the cluster command to form a cluster of three nodes.?
> Is it a cluster should have a disk node. Can I have a cluster with all ram nodes.

No, a cluster with just RAM node is very fragile and largely useless - it will
be faster for certain operations but it will use disc space anyway, see this
recent post for details:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021096.html .

If you are really sure of what you're doing, you can simply stop & reset the
disc node to have a cluster with only RAM nodes - but you most certainly don't
want that.

--
Francesco * Often in error, never in doubt

From meetprashanth437 at gmail.com  Wed Jul 11 17:50:35 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Wed, 11 Jul 2012 12:50:35 -0400
Subject: [rabbitmq-discuss] Cluster with all memory nodes
In-Reply-To: <874npe5kw5.wl%francesco@rabbitmq.com>
References: <CAE8G+yQhFWQKvoVWHbRcFWZ5yBsNcO0s+2E0t3T6SpwHH24M7w@mail.gmail.com>
	<874npe5kw5.wl%francesco@rabbitmq.com>
Message-ID: <CAE8G+ySNverOuEnOzfs_y8ro9=mzM6pe0YCYkVSJ-j8U9yhj=w@mail.gmail.com>

Hi Francesco ,

I am testing performance with and with out disk node. when you say ram node
uses dick space anyways, you mean when the memory is full, it tries to
store messages in disk ?
stop and reset will make the node a standalone, node is no more in the
cluster.

Thanks!!


On Wed, Jul 11, 2012 at 12:21 PM, Francesco Mazzoli
<francesco at rabbitmq.com>wrote:set

> Hi Prashanth,
> At Wed, 11 Jul 2012 11:42:48 -0400,
> Prashanth  wrote:
> > Hi all,
> >
> > I am using the cluster command to form a cluster of three nodes.
> > Is it a cluster should have a disk node. Can I have a cluster with all
> ram nodes.
>
> No, a cluster with just RAM node is very fragile and largely useless - it
> will
> be faster for certain operations but it will use disc space anyway, see
> this
> recent post for details:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021096.html.
>
> If you are really sure of what you're doing, you can simply stop & reset
> the
> disc node to have a cluster with only RAM nodes - but you most certainly
> don't
> want that.
>
> --
> Francesco * Often in error, never in doubt
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/ce7d316a/attachment.htm>

From eric.wood at lexisnexis.com  Wed Jul 11 17:55:08 2012
From: eric.wood at lexisnexis.com (Wood, Eric (LNG-RDU))
Date: Wed, 11 Jul 2012 16:55:08 +0000
Subject: [rabbitmq-discuss] Clustering issue: Error: unable to connect
 to node rabbit@CNTD3BWEB87O: nodedown
In-Reply-To: <4FFD4B8C.1020105@rabbitmq.com>
References: <587CA72CD3D0044E8AC7E34292AEE2EE5E73790D@retda2mbxp006.legal.regn.net>
	<4FFC4430.6080908@rabbitmq.com>
	<587CA72CD3D0044E8AC7E34292AEE2EE5E737989@retda2mbxp006.legal.regn.net>
	<587CA72CD3D0044E8AC7E34292AEE2EE5E73799C@retda2mbxp006.legal.regn.net>
	<4FFD4B8C.1020105@rabbitmq.com>
Message-ID: <587CA72CD3D0044E8AC7E34292AEE2EE5E7384A0@retda2mbxp006.legal.regn.net>

Here was the issue that I had ...
When I installed Rabbit MQ on my windows server, it created a .erland.cookie file in both:
   1) c:\Windows
   2) c:\users\<adminUser>

I installed the software under the user <adminUser>, but the service that it created was running under a system account and creating a cookie file under the c:\windows folder.  I changed the service to run under the <adminUser> account and then copied the .erlang.cokkie file to the c:\users\<adminuser> folder on all servers abnd was able to successfully cluster my nodes.



-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: Wednesday, July 11, 2012 5:47 AM
To: Wood, Eric (LNG-RDU)
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Clustering issue: Error: unable to connect to node rabbit at CNTD3BWEB87O: nodedown

Hi,

On 10/07/12 17:33, Wood, Eric (LNG-RDU) wrote:
> Help.

Your earlier emails had
- cookie hash: VWZk1leRufUBRYr1dwMuJg==
but more recently you report
- cookie hash: 0xT5raNnyX73mPb3lJZWuQ==

If the cookie hash reported by rabbitmqctl differs from the hash that appears in the startup banner then you will be unable to manage that node. The startup banner contains an ASCII-art rabbit, platform version numbers and some diagnostic information, such as the location of the active config file, logfiles, etc. Amongst this diagnostic information is the cookie hash. Compare this with the information reported by rabbitmqctl - you will probably find they are different, which means the cookie file was not copied over correctly. Make sure you follow the instructions about Erlang cookies on this page:
http://www.rabbitmq.com/install-windows-manual.html

> I have tried this on several servers and get the same results.  What 
> steps are required to execute when I copy the cookie file from one 
> server to the next?  I copy it after both installations have been 
> completed and both nodes are up and running as "detached" nodes.

You will need to restart the nodes after copying the cookie files. Their contents is only read at startup, so modifications will not affect a running broker.

You might be copying the cookie file to the wrong location. If you are running the broker as a non-system user then the file should be copied to %HOMEDRIVE%\%HOMEPATH%, or what the Windows API call
GetWindowsDirectory() would return. If running the broker as a service, as a system user then use %windir% (typically C:\WINDOWS).



-Emile



From francesco at rabbitmq.com  Wed Jul 11 18:05:02 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 11 Jul 2012 18:05:02 +0100
Subject: [rabbitmq-discuss] Cluster with all memory nodes
In-Reply-To: <CAE8G+ySNverOuEnOzfs_y8ro9=mzM6pe0YCYkVSJ-j8U9yhj=w@mail.gmail.com>
References: <CAE8G+yQhFWQKvoVWHbRcFWZ5yBsNcO0s+2E0t3T6SpwHH24M7w@mail.gmail.com>
	<874npe5kw5.wl%francesco@rabbitmq.com>
	<CAE8G+ySNverOuEnOzfs_y8ro9=mzM6pe0YCYkVSJ-j8U9yhj=w@mail.gmail.com>
Message-ID: <87394y5iv5.wl%francesco@rabbitmq.com>

Hi Prashanth,
At Wed, 11 Jul 2012 12:50:35 -0400,
Prashanth  wrote:
> I am testing performance?with?and with out disk node. when you say ram node
> uses dick space anyways, you mean when the memory is full, it tries to store
> messages in disk ?

Yes.

> stop and reset will make the node a standalone, node is no more in the cluster.

Yes, so you can start with a dummy disc node that you'll remove in the
future. But really, don't do that.

Francesco.

--
Francesco * Often in error, never in doubt

From emile at rabbitmq.com  Wed Jul 11 18:18:23 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 11 Jul 2012 18:18:23 +0100
Subject: [rabbitmq-discuss] rabbitmq-server process consumes 100% of 1
 CPU (rabbitmq 2.8.4 on Erlang R14B04)
In-Reply-To: <4FFD7619.3010208@lshift.net>
References: <4FFD7619.3010208@lshift.net>
Message-ID: <4FFDB55F.1090409@rabbitmq.com>

Hi Anthony,

On 11/07/12 13:48, Anthony Harris wrote:
> We've run into what appears to be the same issue as was reported
> 14-Jun-2012 in "rabbitmq 2.8.2 beam process consumes 100% of one cpu in
> tight epoll_wait loop" with the following system configuration:

Thanks for this very detailed diagnostic information. Could you perhaps
supply the output of "rabbitmqctl report" as well? Feel free to compress
and send to me directly if it is too large.

I have not been able to reproduce the problem - does this happen each
time you start the cluster? does stopping and starting the slave nodes
make any difference? Have you discovered a sequence of actions that is
likely to reproduce the problem?


-Emile


From meetprashanth437 at gmail.com  Wed Jul 11 18:51:10 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Wed, 11 Jul 2012 13:51:10 -0400
Subject: [rabbitmq-discuss] Per-Queue Message TTL and Queue Expiry in perl
	client
Message-ID: <CAE8G+yQ7bmneCSs1D+-0mwcjQ97ziiyWhuRNWgWnJttCS=iKOg@mail.gmail.com>

Hi all,

Is there a way to specify the queue declare options Per-Queue Message TTL
and Queue Expiry in Perl client.
I am using Net::rabbitMQ module.

Thanks!!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/bcf661b8/attachment.htm>

From monish.unni at gmail.com  Wed Jul 11 19:16:08 2012
From: monish.unni at gmail.com (cogitate)
Date: Wed, 11 Jul 2012 11:16:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Handle Stale Connections on Clients
In-Reply-To: <CAE0Sz=wVjM3XT2w_pe4bnxQ6de_xhh2aiaMh1jL-W0AhCv+PWg@mail.gmail.com>
References: <1341938859568-20687.post@n5.nabble.com>
	<CAE0Sz=wVjM3XT2w_pe4bnxQ6de_xhh2aiaMh1jL-W0AhCv+PWg@mail.gmail.com>
Message-ID: <1342030568666-20721.post@n5.nabble.com>


Jerry Kuch-2 wrote
> 
> Hi, Monish:
> 
> If you're using the naked Java client, you'll have to implement your own
> reconnection logic.  If you're using Spring AMQP there's some helper code
> that wraps your connections with some retry logic for you.
> 
> Best regards,
> Jerry
> 
thanks much Jerry for such a prompt reply. I would love to re-use
spring-amqp and use the wrapped connection( it seems CachedConnectionFactory
+ SimpleListenerContainer ). 
what i am wondering for a simple amqp client that simply wants to re-connect
when a broker shutsdown, is there any way i can re-initialize all my
reply-queues( i have uuids associated with them), channels (wrapped channel
objects associated with connections) without having to re-write the code
with spring-amqp?

sorry to be presume that you would know the answer to this.....but a simple
logic/example would be great of how to go about it. 
the spring-amqp project seems to be quite complicated as it seems to have
logic for transactions ( also it's not entirely clear to me if i need to
write a listener container or just register a shutdownlistener etc).

thanks and regards,
-monish



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687p20721.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Wed Jul 11 19:35:39 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 11 Jul 2012 19:35:39 +0100
Subject: [rabbitmq-discuss] Cluster with all memory nodes
In-Reply-To: <87394y5iv5.wl%francesco@rabbitmq.com>
References: <CAE8G+yQhFWQKvoVWHbRcFWZ5yBsNcO0s+2E0t3T6SpwHH24M7w@mail.gmail.com>
	<874npe5kw5.wl%francesco@rabbitmq.com>
	<CAE8G+ySNverOuEnOzfs_y8ro9=mzM6pe0YCYkVSJ-j8U9yhj=w@mail.gmail.com>
	<87394y5iv5.wl%francesco@rabbitmq.com>
Message-ID: <4FFDC77B.9000008@rabbitmq.com>

On 11/07/12 18:05, Francesco Mazzoli wrote:
> At Wed, 11 Jul 2012 12:50:35 -0400,
> Prashanth  wrote:
>> I am testing performance with and with out disk node. when you say ram node
>> uses dick space anyways, you mean when the memory is full, it tries to store
>> messages in disk ?
>
> Yes.

Paging isn't the only source of disk space usage on ram nodes. 
Persistent messages that are routed to durable queues residing on RAM 
nodes are stored on disk took.

Matthias.

From grussell at vmware.com  Wed Jul 11 19:53:30 2012
From: grussell at vmware.com (Gary Russell)
Date: Wed, 11 Jul 2012 11:53:30 -0700
Subject: [rabbitmq-discuss] Handle Stale Connections on Clients
In-Reply-To: <1342030568666-20721.post@n5.nabble.com>
References: <1341938859568-20687.post@n5.nabble.com>
	<CAE0Sz=wVjM3XT2w_pe4bnxQ6de_xhh2aiaMh1jL-W0AhCv+PWg@mail.gmail.com>
	<1342030568666-20721.post@n5.nabble.com>
Message-ID: <4FFDCBAA.1070001@vmware.com>

See http://static.springsource.org/spring-amqp/docs/1.1.1.RELEASE/reference/html/#d0e999

It shouldn't take much heavy lifting to use spring-amqp instead of the raw apis, and it will take care of reconnecting, setting up queues etc, via the ConnectionListener callback in the RabbitAdmin class.

On the receiving side, you don't have to write any special listeners etc to use spring-amqp; you can just write your code as a POJO and the container uses an adapter to call your code. On the outbound side just use a RabbitTemplate; in most cases you can use high-level APIs, while still having access to the low level APIs (channel) if you ever need them.

If you can't move to spring-amqp, you might be able to leverage some of the code from RabbitAdmin.

Gary


On 07/11/2012 02:16 PM, cogitate wrote:


Jerry Kuch-2 wrote



Hi, Monish:

If you're using the naked Java client, you'll have to implement your own
reconnection logic.  If you're using Spring AMQP there's some helper code
that wraps your connections with some retry logic for you.

Best regards,
Jerry



thanks much Jerry for such a prompt reply. I would love to re-use
spring-amqp and use the wrapped connection( it seems CachedConnectionFactory
+ SimpleListenerContainer ).
what i am wondering for a simple amqp client that simply wants to re-connect
when a broker shutsdown, is there any way i can re-initialize all my
reply-queues( i have uuids associated with them), channels (wrapped channel
objects associated with connections) without having to re-write the code
with spring-amqp?

sorry to be presume that you would know the answer to this.....but a simple
logic/example would be great of how to go about it.
the spring-amqp project seems to be quite complicated as it seems to have
logic for transactions ( also it's not entirely clear to me if i need to
write a listener container or just register a shutdownlistener etc).

thanks and regards,
-monish



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687p20721.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/99c589bc/attachment.htm>

From meetprashanth437 at gmail.com  Wed Jul 11 22:35:25 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Wed, 11 Jul 2012 17:35:25 -0400
Subject: [rabbitmq-discuss] Rabbitmq max-publish
Message-ID: <CAE8G+yTEpfFH8KBp6R25H9XsYo5QQDKcWRQU4OJCrkbZg4W69A@mail.gmail.com>

Hi all,

I am using Perl Net::RabbitMQ to test the max-publish rate. I get around
45k messages/sec each message of size 256Bytes.
RabbitMQ max-publish rate 149K messages/sec @
http://www.rabbitmq.com/blog/2012/04/25/rabbitmq-performance-measurements-part-2/

Something else I have to do to see the increase in the performance.


Thanks!!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/3d15aa38/attachment.htm>

From monish.unni at gmail.com  Wed Jul 11 22:38:27 2012
From: monish.unni at gmail.com (cogitate)
Date: Wed, 11 Jul 2012 14:38:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Handle Stale Connections on Clients
In-Reply-To: <4FFDCBAA.1070001@vmware.com>
References: <1341938859568-20687.post@n5.nabble.com>
	<CAE0Sz=wVjM3XT2w_pe4bnxQ6de_xhh2aiaMh1jL-W0AhCv+PWg@mail.gmail.com>
	<1342030568666-20721.post@n5.nabble.com>
	<4FFDCBAA.1070001@vmware.com>
Message-ID: <1342042707718-20725.post@n5.nabble.com>

Thanks Gary! 
i also use spring-amqp and amqp inbound listener in spring-integration.
however, my issue is with reply-queue implementation of spring-amqp. i need
pre-made reply-queues that can be re-used (setup by configuration) even for
RPC semantics. i believe spring-amqp for RPC uses anonymous reply-queues and
also does consumer.cancel(benchmarks showed a 5ms delay for this on 24 core
cpu with broker and client running on the same box), which turns out to have
performance impact. thus, this rules out use of RabbitTemplate ( i wish it
had a way to use pre-made reply-queues that could be re-used).

thus, my wrappers around raw rabbitmq apis and even if i use
CachingConnectionFactory, i'd need to register a callback listener to
re-register my channels and reply-queues.

will definitely look at RabbitAdmin to learn how to do this.

thanks and regards,
-monish


Gary Russell wrote
> 
> See
> http://static.springsource.org/spring-amqp/docs/1.1.1.RELEASE/reference/html/#d0e999
> 
> It shouldn't take much heavy lifting to use spring-amqp instead of the raw
> apis, and it will take care of reconnecting, setting up queues etc, via
> the ConnectionListener callback in the RabbitAdmin class.
> 
> On the receiving side, you don't have to write any special listeners etc
> to use spring-amqp; you can just write your code as a POJO and the
> container uses an adapter to call your code. On the outbound side just use
> a RabbitTemplate; in most cases you can use high-level APIs, while still
> having access to the low level APIs (channel) if you ever need them.
> 
> If you can't move to spring-amqp, you might be able to leverage some of
> the code from RabbitAdmin.
> 
> Gary
> 


--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687p20725.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jerryk at rbcon.com  Wed Jul 11 23:11:02 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Wed, 11 Jul 2012 15:11:02 -0700
Subject: [rabbitmq-discuss] Rabbitmq max-publish
In-Reply-To: <CAE8G+yTEpfFH8KBp6R25H9XsYo5QQDKcWRQU4OJCrkbZg4W69A@mail.gmail.com>
References: <CAE8G+yTEpfFH8KBp6R25H9XsYo5QQDKcWRQU4OJCrkbZg4W69A@mail.gmail.com>
Message-ID: <CAE0Sz=zmg8yZ5BK0M8H0ue-Xt_LXbuGD3DxKts-NU_8kZuEvZQ@mail.gmail.com>

Hi, Prashanth:

Performance depends on a lot of variables.  For example are your server and
clients running on hardware comparable to the gear Simon used to produce
his numbers?

Also, IIRC Simon used the Java client to generate his traffic.  It's very
unlikely you're going to be able to hold a candle to that using traffic
generators/consumers writtein in Perl or one of the other scripting
languages due to their interpreted nature...

Best regards,
Jerry

On Wed, Jul 11, 2012 at 2:35 PM, Prashanth <meetprashanth437 at gmail.com>wrote:

> Hi all,
>
> I am using Perl Net::RabbitMQ to test the max-publish rate. I get around
> 45k messages/sec each message of size 256Bytes.
> RabbitMQ max-publish rate 149K messages/sec @
> http://www.rabbitmq.com/blog/2012/04/25/rabbitmq-performance-measurements-part-2/
>
> Something else I have to do to see the increase in the performance.
>
>
> Thanks!!
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/ee0320fd/attachment.htm>

From parkerconrad at gmail.com  Thu Jul 12 03:42:27 2012
From: parkerconrad at gmail.com (Parker Conrad)
Date: Wed, 11 Jul 2012 19:42:27 -0700
Subject: [rabbitmq-discuss] Shovel can't establish connection
Message-ID: <CAEbZLp+cC-5KeoD71wAtA04b5qnoD7X0ABUp8fAkniNCJYwu8Q@mail.gmail.com>

Hi - I'm having trouble getting Shovel to work. I have two machines, both
on Amazon EC2, one running Amazon Linux and the other running windows 2008
server. I am trying to shovel from the linux instance to the windows
instance. Ports 5672 and 5673 are open and accepting connections on both
machines. Running "rabbitmqctl status" on both machines shows that each
broker is up and running fine. However, Shovel is unable to establish a
connection from one to the other.

Here's the error I get when I check on Shovel's status:

sudo rabbitmqctl eval 'rabbit_shovel_status:status().'
[{scrape_request_shovel,
     {terminated,
         {{badmatch,{error,access_refused}},
          [{rabbit_shovel_worker,make_conn_and_chan,1},
           {rabbit_shovel_worker,handle_cast,2},
           {gen_server2,handle_msg,2},
           {proc_lib,init_p_do_apply,3}]}},
     {{2012,7,12},{2,7,30}}}]
...done.

Here's my rabbitmq.config file (with some numbers in the remote host
blotted out):

[{rabbitmq_shovel,
  [{shovels,
    [{scrape_request_shovel,
      [{sources,      [{broker,"amqp://test_user:test_password at localhost
"}]},
       {destinations, [{broker, "amqp://
test_user:test_password at ec2-XXX-XX-XXX-224.compute-1.amazonaws.com"}]},
       {queue, <<"scrape_request">>},
       {ack_mode, on_confirm},
       {publish_properties, [{delivery_mode, 2}]},
       {publish_fields, [{exchange, <<"">>},
                         {routing_key, <<"scrape_request">>}]},
       {reconnect_delay, 0}
      ]}
     ]
   }]
}].

Any ideas what could be causing this or what I could do to try to fix it?
Many thanks, in advance, for any help you guys can provide...

/prc
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120711/303d6e83/attachment.htm>

From matthias at rabbitmq.com  Thu Jul 12 07:00:11 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 12 Jul 2012 07:00:11 +0100
Subject: [rabbitmq-discuss] Rabbitmq max-publish
In-Reply-To: <CAE0Sz=zmg8yZ5BK0M8H0ue-Xt_LXbuGD3DxKts-NU_8kZuEvZQ@mail.gmail.com>
References: <CAE8G+yTEpfFH8KBp6R25H9XsYo5QQDKcWRQU4OJCrkbZg4W69A@mail.gmail.com>
	<CAE0Sz=zmg8yZ5BK0M8H0ue-Xt_LXbuGD3DxKts-NU_8kZuEvZQ@mail.gmail.com>
Message-ID: <4FFE67EB.7090008@rabbitmq.com>

On 11/07/12 23:11, Jerry Kuch wrote:
> Performance depends on a lot of variables.  For example are your server
> and clients running on hardware comparable to the gear Simon used to
> produce his numbers?

Also, are the tests reproduced faithfully? For example, the 150kHz 
headline-grabbing figure was obtained with:

- the latest Erlang (R15B at the time; R15B01 right now)
- RabbitMQ HiPE compilation enabled
- several producers running in parallel
- no queues, no consumers, i.e. published messages get routed nowhere

Matthias.

From hebin7611 at hotmail.com  Thu Jul 12 07:26:22 2012
From: hebin7611 at hotmail.com (=?gb2312?B?us6x8w==?=)
Date: Thu, 12 Jul 2012 14:26:22 +0800
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <A1CE8B77-7E1C-4D9E-97CE-2152E9005727@rabbitmq.com>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>,
	<4FFAA1C2.4080006@rabbitmq.com>
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>,
	<4FFAB161.4080605@rabbitmq.com>
	<SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>,
	<4FFACB92.3040508@rabbitmq.com>
	<SNT115-W689CDE2F99F25433D94CFA6D20@phx.gbl>,
	<A1CE8B77-7E1C-4D9E-97CE-2152E9005727@rabbitmq.com>
Message-ID: <SNT115-W32050243214FAFF043A6A4A6D00@phx.gbl>



Hi Tim,

I tried remove host name, it was the same.

# cat /etc/hosts
# Do not remove the following line, or various programs
# that require network functionality will fail.
127.0.0.1    game-01 localhost.localdomain localhost
::1        localhost6.localdomain6 localhost6
10.20.1.1    install.zs.woyo.com
10.20.10.202    ldap1.woyo.com
10.20.10.211    ldap2.woyo.com


Thanks a lot!



Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected
From: tim at rabbitmq.com
Date: Tue, 10 Jul 2012 09:52:52 +0100
CC: rabbitmq-discuss at lists.rabbitmq.com
To: hebin7611 at hotmail.com

Hi,
On 10 Jul 2012, at 09:44, ?? wrote:
It failed as following:

[root at game-01 otp_src_R15B01]# erl -sname rabbit@`env hostname`
{error_logger,{{2012,7,10},{16,40,48}},"Protocol: ~p: register error: ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,"inet_tcp_dist.erl"},{line,70}]},{net_kernel,start_protos,4,[{file,"net_kernel.erl"},{line,1314}]},{net_kernel,start_protos,3,[{file,"net_kernel.erl"},{line,1307}]},{net_kernel,init_node,2,[{file,"net_kernel.erl"},{line,1197}]},{net_kernel,init,1,[{file,"net_kernel.erl"},{line,357}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}]}
{error_logger,{{2012,7,10},{16,40,48}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,[net_sup,ker nel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.54>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,499}],[]]}
{error_logger,{{2012,7,10},{16,40,48}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[['rabbit at game-01',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2012,7,10},{16,40,48}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2012,7,10},{16,40,48}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid terminated",applica tion_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})


My suspicion about this is that it relates to either
(a) having two host names in /etc/hosts(b) multiple interfaces (are they bonded by any chance?)
I am going to try and replicate this behaviour on CentOS 6.2 this afternoon and once I've done that then I'll get back to you. 

BTW, epmd reported:
epmd: Tue Jul 10 16:42:48 2012: Non-local peer connected


This is all to do with epmd not recognising the node id (rabbit at game-01) AFAICT. Have you tried removing the second host ID from your /etc/hosts configuration? I don't actually think that's going to work, but it's worth a try - don't forget to restart (or otherwise refresh your session properly to pick up the changes).

He Bin

Date: Mon, 9 Jul 2012 13:16:18 +0100
From: tim at rabbitmq.com
To: rabbitmq-discuss at lists.rabbitmq.com
CC: hebin7611 at hotmail.com
Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected

On 07/09/2012 11:50 AM, ?? wrote:Hi Tim,

`env hostname` returns game-01.

So does erl -sname rabbit@`env hostname` work then!?


 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/4129be77/attachment.htm>

From matthias at rabbitmq.com  Thu Jul 12 07:30:53 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 12 Jul 2012 07:30:53 +0100
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <SNT115-W32050243214FAFF043A6A4A6D00@phx.gbl>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>,
	<4FFAA1C2.4080006@rabbitmq.com>
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>,
	<4FFAB161.4080605@rabbitmq.com>
	<SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>,
	<4FFACB92.3040508@rabbitmq.com>
	<SNT115-W689CDE2F99F25433D94CFA6D20@phx.gbl>,
	<A1CE8B77-7E1C-4D9E-97CE-2152E9005727@rabbitmq.com>
	<SNT115-W32050243214FAFF043A6A4A6D00@phx.gbl>
Message-ID: <4FFE6F1D.8070703@rabbitmq.com>

On 12/07/12 07:26, ?? wrote:
> I tried remove host name, it was the same.

Please answer my earlier question:
<quote>
When running
   erl -sname rabbit
what node name is shown at the Erlang prompt?
</quote>

Regards,

Matthias.

From hebin7611 at hotmail.com  Thu Jul 12 07:40:57 2012
From: hebin7611 at hotmail.com (=?gb2312?B?us6x8w==?=)
Date: Thu, 12 Jul 2012 14:40:57 +0800
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <4FFE6F1D.8070703@rabbitmq.com>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>,
	<4FFAA1C2.4080006@rabbitmq.com>
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>,
	<4FFAB161.4080605@rabbitmq.com>
	<SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>,
	<4FFACB92.3040508@rabbitmq.com>
	<SNT115-W689CDE2F99F25433D94CFA6D20@phx.gbl>,
	<A1CE8B77-7E1C-4D9E-97CE-2152E9005727@rabbitmq.com>
	<SNT115-W32050243214FAFF043A6A4A6D00@phx.gbl>,
	<4FFE6F1D.8070703@rabbitmq.com>
Message-ID: <SNT115-W4FD14C6F0FEBFA7AD80C5A6D00@phx.gbl>



The same:

# erl -sname rabbit
{error_logger,{{2012,7,12},{14,39,12}},"Protocol: ~p: register error: ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,"inet_tcp_dist.erl"},{line,70}]},{net_kernel,start_protos,4,[{file,"net_kernel.erl"},{line,1314}]},{net_kernel,start_protos,3,[{file,"net_kernel.erl"},{line,1307}]},{net_kernel,init_node,2,[{file,"net_kernel.erl"},{line,1197}]},{net_kernel,init,1,[{file,"net_kernel.erl"},{line,357}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}]}
{error_logger,{{2012,7,12},{14,39,12}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.54>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,499}],[]]}
{error_logger,{{2012,7,12},{14,39,12}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2012,7,12},{14,39,12}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2012,7,12},{14,39,12}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})


Thanks!


> Date: Thu, 12 Jul 2012 07:30:53 +0100
> From: matthias at rabbitmq.com
> To: rabbitmq-discuss at lists.rabbitmq.com
> CC: hebin7611 at hotmail.com; tim at rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected
> 
> On 12/07/12 07:26, ?? wrote:
> > I tried remove host name, it was the same.
> 
> Please answer my earlier question:
> <quote>
> When running
>    erl -sname rabbit
> what node name is shown at the Erlang prompt?
> </quote>
> 
> Regards,
> 
> Matthias.
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/c142f27e/attachment.htm>

From matthias at rabbitmq.com  Thu Jul 12 07:46:52 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 12 Jul 2012 07:46:52 +0100
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <SNT115-W4FD14C6F0FEBFA7AD80C5A6D00@phx.gbl>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>,
	<4FFAA1C2.4080006@rabbitmq.com>
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>,
	<4FFAB161.4080605@rabbitmq.com>
	<SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>,
	<4FFACB92.3040508@rabbitmq.com>
	<SNT115-W689CDE2F99F25433D94CFA6D20@phx.gbl>,
	<A1CE8B77-7E1C-4D9E-97CE-2152E9005727@rabbitmq.com>
	<SNT115-W32050243214FAFF043A6A4A6D00@phx.gbl>,
	<4FFE6F1D.8070703@rabbitmq.com>
	<SNT115-W4FD14C6F0FEBFA7AD80C5A6D00@phx.gbl>
Message-ID: <4FFE72DC.6060806@rabbitmq.com>

On 12/07/12 07:40, ?? wrote:
> The same:
>
> # erl -sname rabbit
> {error_logger,{{2012,7,12},{14,39,12}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},

Earlier on 
(http://rabbitmq.1065348.n5.nabble.com/Plz-give-me-help-about-EPMD-Non-local-peer-connected-tp20601p20640.html) 
you said
<quote>
I tried "erl -sname rabbit", it's OK.
</quote>

So has this somehow *stopped* working now, or was your above statement 
incorrect?

Matthias.

From a.d.prokofiev at gmail.com  Thu Jul 12 09:56:56 2012
From: a.d.prokofiev at gmail.com (anton prokofiev)
Date: Thu, 12 Jul 2012 01:56:56 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem: erlang ssl
	handshake_recv_unexpected_message
Message-ID: <aedbf3bf-9804-4d7f-a3ba-723e216a7ed4@googlegroups.com>

Hello, All!
I try to connect to the external RabbitMQ server  using SSL connection.
 
I use the following code:
=======================================
-module(test).
-include_lib("amqp_client/include/amqp_client.hrl").
-export([test/0]).

test()->
   UserName = <<"user>>,
   Password = <<"password">>,
   Port = 50000,
   HostName = "test2.connect.xxx.com",
   VirtualHost = <<"/">>,
   HeartBit = 10,
   ConnectionTimeout = 20000 , 

   CertPath ="/cert/new/",
   CertSuffix = "TEST.pem",
   ClientCertFile = CertPath ++ "client." ++ CertSuffix,
   ClientKeyFile  = CertPath ++ "clientkey."  ++ CertSuffix,
   CACertFile     = CertPath ++ "cacert."     ++ CertSuffix,
   ClientCertPassword = "test",
   SSLOptions = [{certfile,ClientCertFile}
                ,{keyfile,ClientKeyFile}
                ,{password,ClientCertPassword}
                ,{cacertfile,CACertFile}
                % ,{verify, verify_peer}
                ,{fail_if_no_peer_cert, true}
         ],
   Connection = #amqp_params_network{username    = UserName,
                              password           = Password,
                              virtual_host       = VirtualHost,
                              host               = HostName,
                              port               = Port,
                              heartbeat          = HeartBit,
                              connection_timeout = ConnectionTimeout,
                              ssl_options        = SSLOptions ,
                              client_properties = []
                            },


  {ok,Conn}  = amqp_connection:start(Connection).

=======================================

And got following error:

=======================================

** exception exit: 
{{bad_return_value,{handshake_recv_unexpected_message,{#Ref<0.0.0.169>,
                                                                          
{error,closed}}}},
                    {gen_server,call,[<0.77.0>,connect,infinity]}}
     in function  gen_server:call/3 (gen_server.erl, line 188)
     in call from test:test/0 (src/test.erl, line 43)

=ERROR REPORT==== 12-Jul-2012::10:44:56 ===
** Generic server <0.77.0> terminating 
** Last message in was connect
** When Server state == {state,amqp_network_connection,
                            {state,undefined,undefined,undefined,undefined,
                                undefined,false},
                            <0.76.0>,undefined,
                            {amqp_params_network,<<"user">>,
                                <<"password">>,<<"/">>,
                                "test2.connect.xxx.com",50000,0,0,10,
                                20000,
                                [{certfile,
                                     "/home/a/src/new/client.TEST.pem"},
                                 {keyfile,
                                     "/home/a/src//new/clientkey.TEST.pem"},
                                 {password,"test"},
                                 {cacertfile,
                                     "/home/a/src/new/cacert.TEST.pem"},
                                 {fail_if_no_peer_cert,true}],
                                [#Fun<amqp_auth_mechanisms.plain.3>,
                                 #Fun<amqp_auth_mechanisms.amqplain.3>],
                                [],[]},
                            undefined,undefined,
                            #Fun<amqp_connection_sup.0.39273983>,
                            #Fun<amqp_connection_sup.2.54430129>,false}
** Reason for termination == 
** {bad_return_value,
       {handshake_recv_unexpected_message,{#Ref<0.0.0.169>,{error,closed}}}}

====================================

I have checked  execution with the debugger.
 I receive *connection.start* from the server
Application crashed with *handshake_recv_unexpected_message* when it try to 
tune the connection: (waiting for *connection.tune *message from the server)
.

Any idea?

I use Erlang Erlang R15B01
RabbitMQ client lib: 2.8.2


Thanks in advance.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/ef75745d/attachment.htm>

From matthias at rabbitmq.com  Thu Jul 12 10:58:01 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 12 Jul 2012 10:58:01 +0100
Subject: [rabbitmq-discuss] Problem: erlang ssl
	handshake_recv_unexpected_message
In-Reply-To: <aedbf3bf-9804-4d7f-a3ba-723e216a7ed4@googlegroups.com>
References: <aedbf3bf-9804-4d7f-a3ba-723e216a7ed4@googlegroups.com>
Message-ID: <4FFE9FA9.3060306@rabbitmq.com>

On 12/07/12 09:56, anton prokofiev wrote:
> ** {bad_return_value,
> {handshake_recv_unexpected_message,{#Ref<0.0.0.169>,{error,closed}}}}
>
> ====================================
>
> Ihave checked execution with the debugger.
> I receive *connection.start*from the server
> Application crashed with *handshake_recv_unexpected_message*when it try
> to tune the connection: (waiting for *connection.tune *message from the
> server).

Looks like the server is closing the connection. Check the server logs.

The weird error message is due to a bug in Erlang's ssl library.

Matthias.

From matthias at rabbitmq.com  Thu Jul 12 11:27:07 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 12 Jul 2012 11:27:07 +0100
Subject: [rabbitmq-discuss] Problem: erlang ssl
	handshake_recv_unexpected_message
In-Reply-To: <CAH1Y1shE1Z2f4LVVinUt0Ru2sEQu9X33Ldrvtn6L1YYj=L65cw@mail.gmail.com>
References: <aedbf3bf-9804-4d7f-a3ba-723e216a7ed4@googlegroups.com>
	<4FFE9FA9.3060306@rabbitmq.com>
	<CAH1Y1shE1Z2f4LVVinUt0Ru2sEQu9X33Ldrvtn6L1YYj=L65cw@mail.gmail.com>
Message-ID: <4FFEA67B.8060401@rabbitmq.com>

Anton,

please keep the rabbitmq-discuss list on cc.

On 12/07/12 11:23, anton prokofiev wrote:
> Thanks for reply. I have the same feeling.
> Unfortunately,  server is out of my control :(
>
> I have made test  .NET application under Windows (RabitMQ client 2.7.0).
> Looks like it works. In this case I use original pkcs12 certificate that
> I got from the external party.
>
> In this case I could open a  connection.
>
> Any Idea why it works with WIN + .NET and did not work with Linux + Erlang?

You said that your debugging indicated that the client received the 
connection.start from the server. If so the SSL handshake must have 
completed successfully and the connection is dropped for another reason, 
such as invalid credentials.

Regards,

Matthias.

From a.d.prokofiev at gmail.com  Thu Jul 12 11:47:37 2012
From: a.d.prokofiev at gmail.com (anton prokofiev)
Date: Thu, 12 Jul 2012 03:47:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem: erlang ssl
	handshake_recv_unexpected_message
In-Reply-To: <aedbf3bf-9804-4d7f-a3ba-723e216a7ed4@googlegroups.com>
References: <aedbf3bf-9804-4d7f-a3ba-723e216a7ed4@googlegroups.com>
Message-ID: <f0baa40d-2fad-4599-a666-2b0d0b710822@googlegroups.com>

Sorry for misleading. It was my fault. Wrong user name :(

Not it is up and running !!!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/80640495/attachment.htm>

From nimmavadiraj at gmail.com  Thu Jul 12 13:05:09 2012
From: nimmavadiraj at gmail.com (vadiraj hebbar)
Date: Thu, 12 Jul 2012 17:35:09 +0530
Subject: [rabbitmq-discuss] queue declaration in amqp c++ client
Message-ID: <CALK6wMroQAqB62DjNrhouYWZzDHUWXq=jSnUB-o03=siwYLhQg@mail.gmail.com>

Hi all

how to make the queue as durable in amqp C++ client?
explain with example.


regards,

Vadiraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/7eb41a6c/attachment.htm>

From ceri at lshift.net  Thu Jul 12 13:07:38 2012
From: ceri at lshift.net (Ceri Storey)
Date: Thu, 12 Jul 2012 13:07:38 +0100
Subject: [rabbitmq-discuss] rabbitmq-server process consumes 100% of 1
 CPU (rabbitmq 2.8.4 on Erlang R14B04)
Message-ID: <4FFEBE0A.7070400@lshift.net>

Hi Emile,

I'm one of Anthony's Colleagues here at LShift, who assisted in the
initial investigation.

    Thanks for this very detailed diagnostic information. Could you perhaps
    supply the output of "rabbitmqctl report" as well? Feel free to compress
    and send to me directly if it is too large.

Size of the report isn't the main issue in this case--sadly, it looks
like even the process of getting a queue listing wasn't going to
terminate any time soon (I gave up after ~10 minutes). I've attached the
output from a broken rabbit (although that only lists "rabbitmqctl
status") and a report from the same rabbit with an increased file
descriptor limit.

     I have not been able to reproduce the problem - does this happen each
    time you start the cluster? does stopping and starting the slave nodes
    make any difference? Have you discovered a sequence of actions that is
    likely to reproduce the problem?

In the example I'm seeing (on our internal build slaves that the earlier
etop results were derived from), we have about 1400 queues left over
from a set of rather unhygenic integration tests, so I'd infer that
there's some kind of pathological interaction between the mnesia queue
configuration database resource management and the file_handle_cache
module. So, it does indeed happen every time we restart the single
instance (on our CI machines, they're single instances).

On this hunch, I've bumped our file descriptor limit on one machine to
8192 from 1024 files, and it does indeed that the resource usage does
drop dramatically once the instance has started up. So, I think that
brings us to a work around for one case, if not an explanation of the
underlying behaviour.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/739f6a02/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmqctl-report-spinning.txt.xz
Type: application/x-xz
Size: 1244 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/739f6a02/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmqctl-report-stable.txt.xz
Type: application/x-xz
Size: 27020 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/739f6a02/attachment-0001.bin>

From francesco at rabbitmq.com  Thu Jul 12 13:19:10 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 12 Jul 2012 13:19:10 +0100
Subject: [rabbitmq-discuss] queue declaration in amqp c++ client
In-Reply-To: <CALK6wMroQAqB62DjNrhouYWZzDHUWXq=jSnUB-o03=siwYLhQg@mail.gmail.com>
References: <CALK6wMroQAqB62DjNrhouYWZzDHUWXq=jSnUB-o03=siwYLhQg@mail.gmail.com>
Message-ID: <871ukh5g01.wl%francesco@rabbitmq.com>

At Thu, 12 Jul 2012 17:35:09 +0530,
vadiraj hebbar wrote:
> how to make the queue as durable in amqp C++ client?
> explain with example.

Which C++ client are you using? If you are using SimpleAmqpClient, the
`DeclareQueue' method in the class `Channel' has a flag to set the queue as
durable.

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Thu Jul 12 13:29:26 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 12 Jul 2012 13:29:26 +0100
Subject: [rabbitmq-discuss] Shovel can't establish connection
In-Reply-To: <CAEbZLp+cC-5KeoD71wAtA04b5qnoD7X0ABUp8fAkniNCJYwu8Q@mail.gmail.com>
References: <CAEbZLp+cC-5KeoD71wAtA04b5qnoD7X0ABUp8fAkniNCJYwu8Q@mail.gmail.com>
Message-ID: <87zk7540yh.wl%francesco@rabbitmq.com>

Hi Parker,
At Wed, 11 Jul 2012 19:42:27 -0700,
Parker Conrad wrote:
> Here's the error I get when I check on Shovel's status:
> 
> sudo rabbitmqctl eval 'rabbit_shovel_status:status().'
> [{scrape_request_shovel,
> ? ? ?{terminated,
> ? ? ? ? ?{{badmatch,{error,access_refused}},
> ? ? ? ? ? [{rabbit_shovel_worker,make_conn_and_chan,1},
> ? ? ? ? ? ?{rabbit_shovel_worker,handle_cast,2},
> ? ? ? ? ? ?{gen_server2,handle_msg,2},
> ? ? ? ? ? ?{proc_lib,init_p_do_apply,3}]}},
> ? ? ?{{2012,7,12},{2,7,30}}}]
> ...done.

It looks like the authentication is failing. Could you double check that the
credentials you configured shovel with are correct? The logs on the broker will
help understanding what's going on. Also, don't forget to tell us what version
of rabbit you are using when posting to the mailing list.

--
Francesco * Often in error, never in doubt

From simon at rabbitmq.com  Thu Jul 12 13:28:41 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Jul 2012 13:28:41 +0100
Subject: [rabbitmq-discuss] rabbitmq-server process consumes 100% of 1
 CPU (rabbitmq 2.8.4 on Erlang R14B04)
In-Reply-To: <4FFEBE0A.7070400@lshift.net>
References: <4FFEBE0A.7070400@lshift.net>
Message-ID: <4FFEC2F9.9090507@rabbitmq.com>

On 12/07/12 13:07, Ceri Storey wrote:
> On this hunch, I've bumped our file descriptor limit on one machine to
> 8192 from 1024 files, and it does indeed that the resource usage does
> drop dramatically once the instance has started up. So, I think that
> brings us to a work around for one case, if not an explanation of the
> underlying behaviour.

Hi Ceri. Thanks for this additional information. Just to update you, 
I've just managed to replicate this and am now poking at it. Thanks again.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From francesco at rabbitmq.com  Thu Jul 12 13:34:21 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 12 Jul 2012 13:34:21 +0100
Subject: [rabbitmq-discuss] Per-Queue Message TTL and Queue Expiry in
	perl	client
In-Reply-To: <CAE8G+yQ7bmneCSs1D+-0mwcjQ97ziiyWhuRNWgWnJttCS=iKOg@mail.gmail.com>
References: <CAE8G+yQ7bmneCSs1D+-0mwcjQ97ziiyWhuRNWgWnJttCS=iKOg@mail.gmail.com>
Message-ID: <87y5mp40qa.wl%francesco@rabbitmq.com>

At Wed, 11 Jul 2012 13:51:10 -0400,
Prashanth  wrote:
> Is there a way to specify the queue declare options?Per-Queue Message TTL and
> Queue Expiry in?Perl?client.  I am using Net::rabbitMQ module.

Disclaimer: I don't know much about Perl, and nothing about Net::RabbitMQ.

That said, I took a look at
http://search.cpan.org/~jesus/Net-RabbitMQ-0.0.1/RabbitMQ.pm , and it looks like
the `options' argument in `queue_declare' only supports a specific set of
keys. In other words, it looks like setting custom arguments when declaring
queues => no per-queue message TTL, and no queue expiry.

--
Francesco * Often in error, never in doubt

From grussell at vmware.com  Thu Jul 12 13:35:44 2012
From: grussell at vmware.com (Gary Russell)
Date: Thu, 12 Jul 2012 05:35:44 -0700
Subject: [rabbitmq-discuss] Handle Stale Connections on Clients
In-Reply-To: <1342042707718-20725.post@n5.nabble.com>
References: <1341938859568-20687.post@n5.nabble.com>
	<CAE0Sz=wVjM3XT2w_pe4bnxQ6de_xhh2aiaMh1jL-W0AhCv+PWg@mail.gmail.com>
	<1342030568666-20721.post@n5.nabble.com>	<4FFDCBAA.1070001@vmware.com>
	<1342042707718-20725.post@n5.nabble.com>
Message-ID: <4FFEC4A0.1010107@vmware.com>

Sorry for the delay.

The current spring-amqp (1.1.1) now supports a 'fixed' reply queue for request/reply scenarios.

See

http://static.springsource.org/spring-amqp/docs/1.1.1.RELEASE/reference/html/#request-reply

We added this specifically for the performance impact you cite.

Gary


On 07/11/2012 05:38 PM, cogitate wrote:

Thanks Gary!
i also use spring-amqp and amqp inbound listener in spring-integration.
however, my issue is with reply-queue implementation of spring-amqp. i need
pre-made reply-queues that can be re-used (setup by configuration) even for
RPC semantics. i believe spring-amqp for RPC uses anonymous reply-queues and
also does consumer.cancel(benchmarks showed a 5ms delay for this on 24 core
cpu with broker and client running on the same box), which turns out to have
performance impact. thus, this rules out use of RabbitTemplate ( i wish it
had a way to use pre-made reply-queues that could be re-used).

thus, my wrappers around raw rabbitmq apis and even if i use
CachingConnectionFactory, i'd need to register a callback listener to
re-register my channels and reply-queues.

will definitely look at RabbitAdmin to learn how to do this.

thanks and regards,
-monish


Gary Russell wrote



See
http://static.springsource.org/spring-amqp/docs/1.1.1.RELEASE/reference/html/#d0e999

It shouldn't take much heavy lifting to use spring-amqp instead of the raw
apis, and it will take care of reconnecting, setting up queues etc, via
the ConnectionListener callback in the RabbitAdmin class.

On the receiving side, you don't have to write any special listeners etc
to use spring-amqp; you can just write your code as a POJO and the
container uses an adapter to call your code. On the outbound side just use
a RabbitTemplate; in most cases you can use high-level APIs, while still
having access to the low level APIs (channel) if you ever need them.

If you can't move to spring-amqp, you might be able to leverage some of
the code from RabbitAdmin.

Gary





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687p20725.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/1e097e75/attachment.htm>

From watson.timothy at gmail.com  Thu Jul 12 13:52:52 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 12 Jul 2012 13:52:52 +0100
Subject: [rabbitmq-discuss] queue declaration in amqp c++ client
In-Reply-To: <CALK6wMroQAqB62DjNrhouYWZzDHUWXq=jSnUB-o03=siwYLhQg@mail.gmail.com>
References: <CALK6wMroQAqB62DjNrhouYWZzDHUWXq=jSnUB-o03=siwYLhQg@mail.gmail.com>
Message-ID: <87F26477-66CC-49B8-A280-0FF682721782@rabbitmq.com>

On 12 Jul 2012, at 13:05, vadiraj hebbar <nimmavadiraj at gmail.com> wrote:

> Hi all
> 
> how to make the queue as durable in amqp C++ client?
> explain with example.
> 

Which C++ client?

> 
> regards,
> 
> Vadiraj
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From sanjiv.kumar.jha at accenture.com  Thu Jul 12 13:57:31 2012
From: sanjiv.kumar.jha at accenture.com (sanjiv.kumar.jha at accenture.com)
Date: Thu, 12 Jul 2012 12:57:31 +0000
Subject: [rabbitmq-discuss] Cluster setup :
	rabbitmq	server	stops	responding to rabbitmqctl commands
In-Reply-To: <87629u5wsw.wl%francesco@rabbitmq.com>
References: <EEA1DC407D5C23479BEAAF68C3D560400531C4CA@048-CH1MPN1-213.048d.mgd.msft.net>
	<877gua5zni.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C522@048-CH1MPN1-213.048d.mgd.msft.net>
	<87629u5wsw.wl%francesco@rabbitmq.com>
Message-ID: <EEA1DC407D5C23479BEAAF68C3D560400531C770@048-CH1MPN1-213.048d.mgd.msft.net>


Hi Francesco,

I tried replicating this using rabbitmq-server 2.8.4 version, but noticed a different kind of issue. In current setup, 'rabbitmqctl list_queues' is working whereas 'rabbitmqctl status' is not responding. Even 'rabbitmqctl wait /var/run/rabbitmq/pid' does not respond, keeps waiting.

Thanks,

Sanjiv


rabbit at NODE-A.log:

=INFO REPORT==== 12-Jun-2012::17:33:00 ===
Mirrored-queue (queue 'WFI_VerifyMatchRequestQ' in vhost '/'): Master <rabbit at DV1SP001.3.646.0> saw deaths of mirrors <rabbit at BSPDEVSDK001.1.13125.0>

=INFO REPORT==== 12-Jun-2012::17:33:00 ===
Mirrored-queue (queue 'WFI_DeleteResponseQ' in vhost '/'): Master <rabbit at DV1SP001.3.696.0> saw deaths of mirrors <rabbit at BSPDEVSDK001.1.13175.0>

=INFO REPORT==== 12-Jun-2012::17:33:00 ===
Mirrored-queue (queue 'WFI_UIDAuthRspQ' in vhost '/'): Master <rabbit at DV1SP001.3.648.0> saw deaths of mirrors <rabbit at BSPDEVSDK001.1.13127.0>

=INFO REPORT==== 12-Jun-2012::17:33:00 ===
rabbit on node rabbit at BSPDEVSDK001 down

=INFO REPORT==== 12-Jun-2012::17:33:43 ===
rabbit on node rabbit at BSPDEVSDK001 up

=INFO REPORT==== 12-Jun-2012::17:35:22 ===
Stopping Rabbit


startup_log:

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.8.4  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2012 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at DV1SP001
app descriptor : /usr/lib/rabbitmq/lib/rabbitmq_server-2.8.4/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : /etc/rabbitmq/rabbitmq.config
cookie hash    : u91LYpKydpXKpm6gcI0Zrg==
log            : /var/log/rabbitmq/rabbit at DV1SP001.log
sasl log       : /var/log/rabbitmq/rabbit at DV1SP001-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at DV1SP001
erlang version : 5.6.3

-- rabbit boot start
starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...done
starting database sync                                                ...done
starting codec correctness check                                      ...done
-- external infrastructure ready
starting statistics event manager                                     ...done
starting logging server                                               ...done
starting plugin registry                                              ...done
starting auth mechanism amqplain                                      ...done
starting auth mechanism cr-demo                                       ...done
starting auth mechanism plain                                         ...done
starting exchange type direct                                         ...done
starting exchange type fanout                                         ...done
starting exchange type headers                                        ...done
starting exchange type topic                                          ...done
-- kernel ready
starting node monitor                                                 ...done
starting cluster delegate                                             ...done
starting guid generator                                               ...done
starting alarm handler                                                ...done
starting memory monitor                                               ...done
-- core initialized

starting empty DB check                                               ...done
starting exchange, queue and binding recovery                         ...done
starting mirror queue slave sup                                       ...done
starting adding mirrors to queues                                     ...done
-- message delivery logic ready
starting error log relay                                              ...done
starting networking                                                   ...done
starting notify cluster nodes                                         ...done
starting direct client                                                ...done

broker running

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Francesco Mazzoli
Sent: 11 July 2012 17:34
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Cluster setup : rabbitmq server stops responding to rabbitmqctl commands

Hi Sanjiv,

At Wed, 11 Jul 2012 11:47:19 +0000,
sanjiv kumar jha wrote:
> One more question, do we have any command to check if Node-A is fully started?
> (rabbitmqctl status?)

You can use `rabbitmqctl wait'. See the rabbitmqctl manual for more details:
http://www.rabbitmq.com/man/rabbitmqctl.1.man.html .

--
Francesco * Often in error, never in doubt _______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
______________________________________________________________________________________

www.accenture.com


From francesco at rabbitmq.com  Thu Jul 12 14:26:15 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 12 Jul 2012 14:26:15 +0100
Subject: [rabbitmq-discuss] Cluster setup
	:	rabbitmq	server	stops	responding to rabbitmqctl commands
In-Reply-To: <EEA1DC407D5C23479BEAAF68C3D560400531C770@048-CH1MPN1-213.048d.mgd.msft.net>
References: <EEA1DC407D5C23479BEAAF68C3D560400531C4CA@048-CH1MPN1-213.048d.mgd.msft.net>
	<877gua5zni.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C522@048-CH1MPN1-213.048d.mgd.msft.net>
	<87629u5wsw.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C770@048-CH1MPN1-213.048d.mgd.msft.net>
Message-ID: <87wr293ybs.wl%francesco@rabbitmq.com>

At Thu, 12 Jul 2012 12:57:31 +0000,
sanjiv kumar jha wrote:
> I tried replicating this using rabbitmq-server 2.8.4 version, but noticed a
> different kind of issue. In current setup, 'rabbitmqctl list_queues' is
> working whereas 'rabbitmqctl status' is not responding. Even 'rabbitmqctl wait
> /var/run/rabbitmq/pid' does not respond, keeps waiting.

If I understand correctly the log you posted is on node-A *after* you brought
down node-B, right? In any case, things look OK. Could you attach the logs
in their entirety (both node A and B)?

The best thing would be for you to post a script that replicates what you're
trying to do and reproduces the behaviour you're seeing. Needless to say I have
tried to replicate your problem to no avail.

--
Francesco * Often in error, never in doubt

From meetprashanth437 at gmail.com  Thu Jul 12 14:25:24 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Thu, 12 Jul 2012 09:25:24 -0400
Subject: [rabbitmq-discuss] Rabbitmq max-publish
In-Reply-To: <4FFE67EB.7090008@rabbitmq.com>
References: <CAE8G+yTEpfFH8KBp6R25H9XsYo5QQDKcWRQU4OJCrkbZg4W69A@mail.gmail.com>
	<CAE0Sz=zmg8yZ5BK0M8H0ue-Xt_LXbuGD3DxKts-NU_8kZuEvZQ@mail.gmail.com>
	<4FFE67EB.7090008@rabbitmq.com>
Message-ID: <CAE8G+yT=VQMfNvexDGrm89rA11kYqhLKX-fGQ65Xr2zR_6iQ_w@mail.gmail.com>

Hello Matthias,

I have the latest erlang. R13B01.
Hipe is enabled.
Yes, I am testing both 1 producer and 2 producers cases.
Yes, I have no consumer. no queue? what do you mean by no queue, if there
is no queue, where are the messages published.

Thanks,
Prashanth.

On Thu, Jul 12, 2012 at 2:00 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 11/07/12 23:11, Jerry Kuch wrote:
>
>> Performance depends on a lot of variables.  For example are your server
>> and clients running on hardware comparable to the gear Simon used to
>> produce his numbers?
>>
>
> Also, are the tests reproduced faithfully? For example, the 150kHz
> headline-grabbing figure was obtained with:
>
> - the latest Erlang (R15B at the time; R15B01 right now)
> - RabbitMQ HiPE compilation enabled
> - several producers running in parallel
> - no queues, no consumers, i.e. published messages get routed nowhere
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/b1a2c338/attachment.htm>

From meetprashanth437 at gmail.com  Thu Jul 12 14:29:46 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Thu, 12 Jul 2012 09:29:46 -0400
Subject: [rabbitmq-discuss] Per-Queue Message TTL and Queue Expiry in
	perl client
In-Reply-To: <87y5mp40qa.wl%francesco@rabbitmq.com>
References: <CAE8G+yQ7bmneCSs1D+-0mwcjQ97ziiyWhuRNWgWnJttCS=iKOg@mail.gmail.com>
	<87y5mp40qa.wl%francesco@rabbitmq.com>
Message-ID: <CAE8G+yQiVErAV620d8AwXgqQDFVWEfsCDh3MrvTJBvXOhZp25A@mail.gmail.com>

that is sad :(

On Thu, Jul 12, 2012 at 8:34 AM, Francesco Mazzoli
<francesco at rabbitmq.com>wrote:

> At Wed, 11 Jul 2012 13:51:10 -0400,
> Prashanth  wrote:
> > Is there a way to specify the queue declare options Per-Queue Message
> TTL and
> > Queue Expiry in Perl client.  I am using Net::rabbitMQ module.
>
> Disclaimer: I don't know much about Perl, and nothing about Net::RabbitMQ.
>
> That said, I took a look at
> http://search.cpan.org/~jesus/Net-RabbitMQ-0.0.1/RabbitMQ.pm , and it
> looks like
> the `options' argument in `queue_declare' only supports a specific set of
> keys. In other words, it looks like setting custom arguments when declaring
> queues => no per-queue message TTL, and no queue expiry.
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/17584a73/attachment.htm>

From francesco at rabbitmq.com  Thu Jul 12 14:32:39 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 12 Jul 2012 14:32:39 +0100
Subject: [rabbitmq-discuss] Some bugs in management plugin and HA
In-Reply-To: <CAHFJS_Vb0tO2Yz8JKfa6aXj+RQt=fobbzfe9C6sDjHe-LMBoGA@mail.gmail.com>
References: <CAHFJS_Vb0tO2Yz8JKfa6aXj+RQt=fobbzfe9C6sDjHe-LMBoGA@mail.gmail.com>
Message-ID: <87vcht3y14.wl%francesco@rabbitmq.com>

Hi Micha?,
At Tue, 10 Jul 2012 15:29:55 +0200,
Micha? Ki?dy? wrote:
> I found some bugs in management plugin and HA:
> 
> Configuration:
> Cluster with 4 nodes:
> arch-task-mq-1 (disk),?arch-task-mq-2 (ram),?arch-task-mq-3 (disk),?arch-task-mq-4 (ram)
> Version 2.8.4
> Erlang R14A
> 
> 1.
> On node?arch-task-mq-3 I execute iptables commands:
> 
> iptables -A INPUT -s arch-task-mq-1 -j DROP
> iptables -A OUTPUT -p tcp -d arch-task-mq-1 -j DROP
> [...]

What you're doing here is simulating a netsplit with iptables. RabbitMQ clusters
(or in other words, mnesia clusters) are not tolerant to that, as we state
clearly: http://www.rabbitmq.com/clustering.html . The behaviour if that happens
is pretty much undefined but it'll definitely lead to bad things. If you are
expecting netsplits, use federation or shovel.

--
Francesco * Often in error, never in doubt

From matthias at rabbitmq.com  Thu Jul 12 14:35:09 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 12 Jul 2012 14:35:09 +0100
Subject: [rabbitmq-discuss] Rabbitmq max-publish
In-Reply-To: <CAE8G+yT=VQMfNvexDGrm89rA11kYqhLKX-fGQ65Xr2zR_6iQ_w@mail.gmail.com>
References: <CAE8G+yTEpfFH8KBp6R25H9XsYo5QQDKcWRQU4OJCrkbZg4W69A@mail.gmail.com>
	<CAE0Sz=zmg8yZ5BK0M8H0ue-Xt_LXbuGD3DxKts-NU_8kZuEvZQ@mail.gmail.com>
	<4FFE67EB.7090008@rabbitmq.com>
	<CAE8G+yT=VQMfNvexDGrm89rA11kYqhLKX-fGQ65Xr2zR_6iQ_w@mail.gmail.com>
Message-ID: <4FFED28D.8080004@rabbitmq.com>

Prashanth,

On 12/07/12 14:25, Prashanth wrote:
> I have the latest erlang. R13B01.

That is *not* the latest Erlang. R15B01 is.

> Hipe is enabled.

in the rabbitmq.config, right?

> Yes, I am testing both 1 producer and 2 producers cases.

2 won't be enough. Simon ran that benchmark with something like 10.

> Yes, I have no consumer. no queue? what do you mean by no queue, if
> there is no queue, where are the messages published.

In AMQP, messages get published to an exchange. See 
http://www.rabbitmq.com/tutorials/amqp-concepts.html. If that exchange 
has no (matching) bindings from queues then the messages are dropped at 
the routing stage, which is what is happening in the 150kHz benchmark.


Matthias.

From matthias at rabbitmq.com  Thu Jul 12 14:38:38 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 12 Jul 2012 14:38:38 +0100
Subject: [rabbitmq-discuss] Per-Queue Message TTL and Queue Expiry in
 perl client
In-Reply-To: <CAE8G+yQiVErAV620d8AwXgqQDFVWEfsCDh3MrvTJBvXOhZp25A@mail.gmail.com>
References: <CAE8G+yQ7bmneCSs1D+-0mwcjQ97ziiyWhuRNWgWnJttCS=iKOg@mail.gmail.com>
	<87y5mp40qa.wl%francesco@rabbitmq.com>
	<CAE8G+yQiVErAV620d8AwXgqQDFVWEfsCDh3MrvTJBvXOhZp25A@mail.gmail.com>
Message-ID: <4FFED35E.3030304@rabbitmq.com>

On 12/07/12 14:29, Prashanth wrote:
> that is sad :(

I suggest you contact the author / file a bug.

Matthias.

From francesco at rabbitmq.com  Thu Jul 12 14:42:46 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 12 Jul 2012 14:42:46 +0100
Subject: [rabbitmq-discuss] Per-Queue Message TTL and Queue Expiry in
	perl client
In-Reply-To: <CAE8G+yQiVErAV620d8AwXgqQDFVWEfsCDh3MrvTJBvXOhZp25A@mail.gmail.com>
References: <CAE8G+yQ7bmneCSs1D+-0mwcjQ97ziiyWhuRNWgWnJttCS=iKOg@mail.gmail.com>
	<87y5mp40qa.wl%francesco@rabbitmq.com>
	<CAE8G+yQiVErAV620d8AwXgqQDFVWEfsCDh3MrvTJBvXOhZp25A@mail.gmail.com>
Message-ID: <87txxd3xk9.wl%francesco@rabbitmq.com>

At Thu, 12 Jul 2012 09:29:46 -0400,
Prashanth  wrote:
> that is sad :(

Quite sad indeed. I'd so some more exploring before giving up because mine was
just a cursory glance. I took a look at rabbitmq-c, which the Perl client is
based on, and it looks like it supports arbitrary arguments.

--
Francesco * Often in error, never in doubt

From meetprashanth437 at gmail.com  Thu Jul 12 14:59:15 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Thu, 12 Jul 2012 09:59:15 -0400
Subject: [rabbitmq-discuss] Per-Queue Message TTL and Queue Expiry in
	perl client
In-Reply-To: <87txxd3xk9.wl%francesco@rabbitmq.com>
References: <CAE8G+yQ7bmneCSs1D+-0mwcjQ97ziiyWhuRNWgWnJttCS=iKOg@mail.gmail.com>
	<87y5mp40qa.wl%francesco@rabbitmq.com>
	<CAE8G+yQiVErAV620d8AwXgqQDFVWEfsCDh3MrvTJBvXOhZp25A@mail.gmail.com>
	<87txxd3xk9.wl%francesco@rabbitmq.com>
Message-ID: <CAE8G+yS8iuOrfqCqtcSCNC+Udimp7B4B5QJxnsYRamAZFb=bWw@mail.gmail.com>

Thank you all. I will research into it.

On Thu, Jul 12, 2012 at 9:42 AM, Francesco Mazzoli
<francesco at rabbitmq.com>wrote:

> At Thu, 12 Jul 2012 09:29:46 -0400,
> Prashanth  wrote:
> > that is sad :(
>
> Quite sad indeed. I'd so some more exploring before giving up because mine
> was
> just a cursory glance. I took a look at rabbitmq-c, which the Perl client
> is
> based on, and it looks like it supports arbitrary arguments.
>
> --
> Francesco * Often in error, never in doubt
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/1645a2cb/attachment.htm>

From tim at rabbitmq.com  Thu Jul 12 14:56:21 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 12 Jul 2012 14:56:21 +0100
Subject: [rabbitmq-discuss] RabbitMQ shuts itself down every night?
In-Reply-To: <76282B0512BD48BB8D400BFBF5A7BD67@gmail.com>
References: <76282B0512BD48BB8D400BFBF5A7BD67@gmail.com>
Message-ID: <4FFED785.9060302@rabbitmq.com>

On 07/11/2012 06:38 AM, Eric Ettes wrote:
>
> I've searched the internet for a while now, but so far I wasn't able 
> to find anything -- perhaps someone on this mailing encountered the 
> same issue and has a solution?
>

Hi Eric,

Have you checked the (OS) system logs to see if there's anything 
indicative in there? Could it be that you have a cron job set up that is 
causing rabbit to get restarted (apt update or something like that perhaps)?

From spowell at rbcon.com  Thu Jul 12 14:50:56 2012
From: spowell at rbcon.com (Steve Powell)
Date: Thu, 12 Jul 2012 14:50:56 +0100
Subject: [rabbitmq-discuss] Restarting/re-establising failed federation
	connections
In-Reply-To: <e5c07cc1-c5c2-4614-aef8-cee6dbcb64a7@googlegroups.com>
References: <e5c07cc1-c5c2-4614-aef8-cee6dbcb64a7@googlegroups.com>
Message-ID: <9F05622A-2DB9-4165-AC1D-E550E479B718@rabbitmq.com>

Hi David,

Federated exchanges establish AMQP connections upstream, so it is the
downstream Rabbit server which is connecting to the upstream one, not
the other way around.

What is probably happening when you restart the upstream cluster is that
the downstream federation recovery process is able to re-start. Why it
is blocking, I cannot tell.

Please can you tell me what versions of RabbitMQ you are running on the
upstream and downstream clusters? Although these are allowed to be
different, some changes were made in 2.8.2 which try to take advantage
of upstream exchange mods if they are detected. If the upstream exchange
and downstream exchange have versions which straddle 2.8.2, I might
expect some odd behaviour in recovery scenarios (though we should be
fine :-).

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 11 Jul 2012, at 13:35, David Gillies wrote:

> Hi, 
> 
> So I've got a simple federated setup where we have a bunch of rabbits in various data centres all publishing to a central upstream queue. This works well for most of them, except for one data centre which has particularly bad connectivity. I've found the upstream rabbitmq server gets into a situation where by it loses connectivity to the downstream rabbit and is never able to connect again which results me going to the lengths of restarting the upstream rabbitmq cluster (just two servers in a cluster). Is there a less heavy handed way of re-establising the connection to the downstream cluster for situations where the federation plugin can't seem to reconnect anymore?
> 
> Thanks,
> David.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Thu Jul 12 15:06:25 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 12 Jul 2012 15:06:25 +0100
Subject: [rabbitmq-discuss] RabbitMQ shuts itself down every night?
In-Reply-To: <76282B0512BD48BB8D400BFBF5A7BD67@gmail.com>
References: <76282B0512BD48BB8D400BFBF5A7BD67@gmail.com>
Message-ID: <4FFED9E1.4070506@rabbitmq.com>

On 07/11/2012 06:38 AM, Eric Ettes wrote:
> Hey everyone,
>
> For a project I'm using RabbitMQ and I've encountered a strange 
> problem that I'm unable to solve. The rabbit-server will automatically 
> shut down every night with the following logging (I cleaned the log 
> files and just waited for the next shutdown to occur :)):
>

Also.....

> *shutdown_err:*
> Error: {'EXIT',{error,{could_not_read_pid,{error,enoent}}}}
>

Why can't the pid file be read? Where is rabbit installed and which user 
is running this command?

> *shutdown_log:*
> Stopping and halting node rabbit at lukas ...
>
> *startup_err:*
> /usr/lib/rabbitmq/bin/rabbitmq-server: 90: erl: not found
>

Well this is very odd. Definitely looks like the user which initiated 
the startup/shutdown isn't the rabbitmq user, as it appears that the 
'erl' program isn't found on this user's path.

> I'm using a plain version of RabbitMQ 2.8.2 on Ubuntu 10.04.4 LTS, so 
> far I've only installed RabbitMQ without changing the configuration. 
> Also, the app hasn't been released for testing yet, so there's been no 
> traffic over RabbitMQ...
>
>
>
> After re-starting Rabbit, this is the output of rabbitmqctl status:
>
> Status of node rabbit at lukas ...
> [{pid,24404},
>  {running_applications,
>      [{rabbitmq_management,"RabbitMQ Management Console","2.8.2"},
>       {xmerl,"XML parser","1.2.9"},
>       {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.2"},
>       {amqp_client,"RabbitMQ AMQP Client","2.8.2"},
>       {rabbit,"RabbitMQ","2.8.2"},
>       {os_mon,"CPO  CXC 138 46","2.2.6"},
>       {sasl,"SASL  CXC 138 11","2.1.9.4"},
>       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.2"},
>       {webmachine,"webmachine","1.7.0-rmq2.8.2-hg"},
>       {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.2-git"},
>       {inets,"INETS  CXC 138 49","5.6"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.19"},
>       {stdlib,"ERTS  CXC 138 10","1.17.4"},
>       {kernel,"ERTS  CXC 138 10","2.14.4"}]},

Unless I'm mistaken, these plugins should not be automatically enabled 
with a stock rabbit. So have you really installed RabbitMQ "without 
changing the configuration" at all?

>
> I've searched the internet for a while now, but so far I wasn't able 
> to find anything -- perhaps someone on this mailing encountered the 
> same issue and has a solution?
>

I strongly suspect some other agent on your system is attempting to shut 
down rabbit, though clearly making a botched job of it as 'erl' isn't 
found at some point and the pid file isn't where it is expected to be.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/152b46ee/attachment.htm>

From meetprashanth437 at gmail.com  Thu Jul 12 15:11:52 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Thu, 12 Jul 2012 10:11:52 -0400
Subject: [rabbitmq-discuss] Rabbitmq max-publish
In-Reply-To: <4FFED28D.8080004@rabbitmq.com>
References: <CAE8G+yTEpfFH8KBp6R25H9XsYo5QQDKcWRQU4OJCrkbZg4W69A@mail.gmail.com>
	<CAE0Sz=zmg8yZ5BK0M8H0ue-Xt_LXbuGD3DxKts-NU_8kZuEvZQ@mail.gmail.com>
	<4FFE67EB.7090008@rabbitmq.com>
	<CAE8G+yT=VQMfNvexDGrm89rA11kYqhLKX-fGQ65Xr2zR_6iQ_w@mail.gmail.com>
	<4FFED28D.8080004@rabbitmq.com>
Message-ID: <CAE8G+yTRVjiwXiYrUbL59nj0b2NVreujYR04aSsv10NLhWu3FA@mail.gmail.com>

Ok thanks, I will try that.

my config file

%% -*- erlang -*-
[
  {rabbit,
    [{tcp_listeners, [5673]},
     {ssl_listeners, [5671]},
     {ssl_options, [{cacertfile,"/home/demo/testca/cacert.pem"},
                    {certfile,"/home/demo/server/cert.pem"},
                    {keyfile,"/home/demo/server/key.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,false}]},
     {hipe_compile, true}
  ]},
  {rabbitmq_stomp, [{default_user, [{login, "guest"},
                                    {passcode, "guest"}]}]}
].

I am not using SSL, for now I am using port 5673

I set the hipe_compile to true, It was working yesterday. today I get an
error when starting the server

Error: {cannot_start_application,os_mon,{not_started,sasl}}

any idea?

Thanks,
Prashanth.


On Thu, Jul 12, 2012 at 9:35 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Prashanth,
>
>
> On 12/07/12 14:25, Prashanth wrote:
>
>> I have the latest erlang. R13B01.
>>
>
> That is *not* the latest Erlang. R15B01 is.
>
>  Hipe is enabled.
>>
>
> in the rabbitmq.config, right?
>
>
>  Yes, I am testing both 1 producer and 2 producers cases.
>>
>
> 2 won't be enough. Simon ran that benchmark with something like 10.
>
>
>  Yes, I have no consumer. no queue? what do you mean by no queue, if
>> there is no queue, where are the messages published.
>>
>
> In AMQP, messages get published to an exchange. See
> http://www.rabbitmq.com/**tutorials/amqp-concepts.html<http://www.rabbitmq.com/tutorials/amqp-concepts.html>.
> If that exchange has no (matching) bindings from queues then the messages
> are dropped at the routing stage, which is what is happening in the 150kHz
> benchmark.
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/73fb949d/attachment.htm>

From jwu2 at lifetouch.com  Thu Jul 12 17:02:58 2012
From: jwu2 at lifetouch.com (jimwu)
Date: Thu, 12 Jul 2012 09:02:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Mirrored queue "requeue" un-acknolwedged message
	in failover
Message-ID: <1342108978261-20758.post@n5.nabble.com>

Hi, 

I am new to rabbitMQ, and doing research and prototype on using rabbitMQ HA
mirrored queue for real-time control systems.  Setting up the cluster (using
2 physical hosts) and mirroed queue worked very well and smooth for us in
the protoptye.

However, the documented Mirrored Queue Behaviour during failover (re-queuing
of un-acknolwedged messages to the tail in the new master node) concerned
us.  If our app re-consumes past messges  during the failover, it may cause
unwanted/harmful action in the real-time systems.  

We can build "guard" in our applicaiton to check if we re-consume previous
messages; but that is almost prohibiting because the real-time systems can
have high volume messages related to different work stauts at any given
time. Littering the "guard" code and checking a previous state (even in
memory) is hard to engineer to achieve consistency, as the real-time systems
is is highly distributed.

Wonder if RabbitMQ broker can add a "flag" attaribute to the requeued
messages in failover, so our consumer application can see a requeued message
comoing. I imagine this can be done in RabbitMQ. Since the broker does the
work of requeuing already, it can (easily?) add a flag to those messges.  
That way, our app will have an easier time to handle requeued message.

Of course, I am open to advice if there are better/proven ways to handles
the requeued message in mirroed queue during fail over. 

Thanks for your input,

JW
 

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Mirrored-queue-requeue-un-acknolwedged-message-in-failover-tp20758.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From francesco at rabbitmq.com  Thu Jul 12 17:39:00 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 12 Jul 2012 17:39:00 +0100
Subject: [rabbitmq-discuss] Mirrored queue "requeue" un-acknolwedged
	message	in failover
In-Reply-To: <1342108978261-20758.post@n5.nabble.com>
References: <1342108978261-20758.post@n5.nabble.com>
Message-ID: <87sjcx3pej.wl%francesco@rabbitmq.com>

Hi jimwu,
At Thu, 12 Jul 2012 09:02:58 -0700 (PDT),
jimwu  wrote:
> Wonder if RabbitMQ broker can add a "flag" attaribute to the requeued
> messages in failover, so our consumer application can see a requeued message
> comoing. I imagine this can be done in RabbitMQ. Since the broker does the
> work of requeuing already, it can (easily?) add a flag to those messges.  
> That way, our app will have an easier time to handle requeued message.

Well the issue here is that the slave does not know if the consumer has seen the
unacked messages that it will requeue. If repeated messages are unacceptable you
are going to have to do some bookkeeping on the consumer side anyway, since that
hypothetical flag would not guarantee you anything.

Are you asking for a flag like that just to make the bookkeeping less resource
intensive? In that case, I doubt it'd make much of a difference, since you are
going to have to take track of all the messages anyway - the only thing that
you'll save is the checking of some messages, but that's likely not to be the
main problem anyway.

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Thu Jul 12 17:51:07 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 12 Jul 2012 17:51:07 +0100
Subject: [rabbitmq-discuss] Mirrored queue "requeue"
	un-acknolwedged	message	in failover
In-Reply-To: <87sjcx3pej.wl%francesco@rabbitmq.com>
References: <1342108978261-20758.post@n5.nabble.com>
	<87sjcx3pej.wl%francesco@rabbitmq.com>
Message-ID: <87r4sg53es.wl%francesco@rabbitmq.com>

At Thu, 12 Jul 2012 17:39:00 +0100,
Francesco Mazzoli wrote:
> Well the issue here is that the slave does not know if the consumer has seen the
> unacked messages that it will requeue. If repeated messages are unacceptable you
> are going to have to do some bookkeeping on the consumer side anyway, since that
> hypothetical flag would not guarantee you anything.
> 
> Are you asking for a flag like that just to make the bookkeeping less resource
> intensive? In that case, I doubt it'd make much of a difference, since you are
> going to have to take track of all the messages anyway - the only thing that
> you'll save is the checking of some messages, but that's likely not to be the
> main problem anyway.

Turns out that a flag like this does exist in AMQP, and I had completely forgot
about it:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.deliver.redelivered .

This does not change the rest of my comment, that flag is going to save you from
doing a considerable amount of bookkeeping.

Another thing:

> (re-queuing of un-acknolwedged messages to the tail in the new master node)

Requeuing maintains publication order, so the are not put back at the tail of
the queue. See http://www.rabbitmq.com/semantics.html#ordering for more info.

--
Francesco * Often in error, never in doubt

From monish.unni at gmail.com  Thu Jul 12 18:03:05 2012
From: monish.unni at gmail.com (cogitate)
Date: Thu, 12 Jul 2012 10:03:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Handle Stale Connections on Clients
In-Reply-To: <4FFEC4A0.1010107@vmware.com>
References: <1341938859568-20687.post@n5.nabble.com>
	<CAE0Sz=wVjM3XT2w_pe4bnxQ6de_xhh2aiaMh1jL-W0AhCv+PWg@mail.gmail.com>
	<1342030568666-20721.post@n5.nabble.com>
	<4FFDCBAA.1070001@vmware.com>
	<1342042707718-20725.post@n5.nabble.com>
	<4FFEC4A0.1010107@vmware.com>
Message-ID: <1342112585500-20761.post@n5.nabble.com>

Thanks Gary again for pointers!

** ah, so all i have to do is pool rabbit-template objects and i'll get the
benefit of re-connecting? 
** do you think we could have a hard reconnect after every "x" minutes so
that if the brokers are behind a VIP and some are brought down and brought
back up, the VIP will do fair-load-balancing?

regards,
-monish


Gary Russell wrote
> 
> Sorry for the delay.
> 
> The current spring-amqp (1.1.1) now supports a 'fixed' reply queue for
> request/reply scenarios.
> 
> See
> 
> http://static.springsource.org/spring-amqp/docs/1.1.1.RELEASE/reference/html/#request-reply
> 
> We added this specifically for the performance impact you cite.
> 
> Gary
> 




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687p20761.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Thu Jul 12 18:12:24 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 12 Jul 2012 18:12:24 +0100
Subject: [rabbitmq-discuss] Rabbitmq max-publish
In-Reply-To: <CAE8G+yTRVjiwXiYrUbL59nj0b2NVreujYR04aSsv10NLhWu3FA@mail.gmail.com>
References: <CAE8G+yTEpfFH8KBp6R25H9XsYo5QQDKcWRQU4OJCrkbZg4W69A@mail.gmail.com>
	<CAE0Sz=zmg8yZ5BK0M8H0ue-Xt_LXbuGD3DxKts-NU_8kZuEvZQ@mail.gmail.com>
	<4FFE67EB.7090008@rabbitmq.com>
	<CAE8G+yT=VQMfNvexDGrm89rA11kYqhLKX-fGQ65Xr2zR_6iQ_w@mail.gmail.com>
	<4FFED28D.8080004@rabbitmq.com>
	<CAE8G+yTRVjiwXiYrUbL59nj0b2NVreujYR04aSsv10NLhWu3FA@mail.gmail.com>
Message-ID: <4FFF0578.5000601@rabbitmq.com>

On 12/07/12 15:11, Prashanth wrote:
> I set the hipe_compile to true, It was working yesterday. today I get an
> error when starting the server
>
> Error: {cannot_start_application,os_mon,{not_started,sasl}}
>
> any idea?

Nope.

Matthias.

From grussell at vmware.com  Thu Jul 12 18:19:35 2012
From: grussell at vmware.com (Gary Russell)
Date: Thu, 12 Jul 2012 10:19:35 -0700
Subject: [rabbitmq-discuss] Handle Stale Connections on Clients
In-Reply-To: <1342112585500-20761.post@n5.nabble.com>
References: <1341938859568-20687.post@n5.nabble.com>
	<CAE0Sz=wVjM3XT2w_pe4bnxQ6de_xhh2aiaMh1jL-W0AhCv+PWg@mail.gmail.com>
	<1342030568666-20721.post@n5.nabble.com>	<4FFDCBAA.1070001@vmware.com>
	<1342042707718-20725.post@n5.nabble.com>	<4FFEC4A0.1010107@vmware.com>
	<1342112585500-20761.post@n5.nabble.com>
Message-ID: <4FFF0727.909@vmware.com>

You'll have to catch the exception on the  *sendAndReceive() but, yes, 
it will reconnect if you try again.

There's no out-of-the-box mechanism to recycle the connection; you could 
add a connection listener to get a reference to the connection and close 
it from time to time, but this will likely impact in-flight messages.

Gary

On 07/12/2012 01:03 PM, cogitate wrote:
> Thanks Gary again for pointers!
>
> ** ah, so all i have to do is pool rabbit-template objects and i'll get the
> benefit of re-connecting?
> ** do you think we could have a hard reconnect after every "x" minutes so
> that if the brokers are behind a VIP and some are brought down and brought
> back up, the VIP will do fair-load-balancing?
>
> regards,
> -monish
>
>
> Gary Russell wrote
>> Sorry for the delay.
>>
>> The current spring-amqp (1.1.1) now supports a 'fixed' reply queue for
>> request/reply scenarios.
>>
>> See
>>
>> http://static.springsource.org/spring-amqp/docs/1.1.1.RELEASE/reference/html/#request-reply
>>
>> We added this specifically for the performance impact you cite.
>>
>> Gary
>>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687p20761.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From srikanthtns at gmail.com  Thu Jul 12 19:57:32 2012
From: srikanthtns at gmail.com (srikanth tns)
Date: Thu, 12 Jul 2012 11:57:32 -0700
Subject: [rabbitmq-discuss] RabbitMQ replies not received to client
In-Reply-To: <CAOU_jKBEcVmRYsdqoHtuS=sdSqx7-tFjgwzNzKVr=SD_1Be8nw@mail.gmail.com>
References: <CAOU_jKBEcVmRYsdqoHtuS=sdSqx7-tFjgwzNzKVr=SD_1Be8nw@mail.gmail.com>
Message-ID: <CAOU_jKD-8V-N-PkVVexCmkOor7EVBPd=awbC2e7H=VsZEAmtEg@mail.gmail.com>

Hello
I am using RabbitMQ 2.3.1 ,Erlang 5.6.5 on linux systems along with
Mcollective for our infrastructure.
The infrastructure was working fine when we have like 250 nodes connected
to the rabbit_stomp . When we increase the nodes to 300+ , we started
seeing issues.
The nodes are pushing the messages onto the rabbitmq topic , but somehow
client is not receiving the messages. Looks like the connection object the
rabbit_stomp uses on the client is not responding.

We have like 8GB RAM of memory with 2 Core CPUs each 2.93 GHz and rabbitmq
is using 40% of the RAM.
I tried playing with vm_high_memory_benchmark from 0.2 - 0.7 but still the
same issue.
The rabbitmq logs say no ERRORs or memory issues , not even the sasl logs.

Any advice on this issue is greatly appreciated.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/52032909/attachment.htm>

From jwu2 at lifetouch.com  Thu Jul 12 21:33:14 2012
From: jwu2 at lifetouch.com (jimwu)
Date: Thu, 12 Jul 2012 13:33:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Mirrored queue "requeue"
	un-acknolwedged	message	in failover
In-Reply-To: <87r4sg53es.wl%francesco@rabbitmq.com>
References: <1342108978261-20758.post@n5.nabble.com>
	<87sjcx3pej.wl%francesco@rabbitmq.com>
	<87r4sg53es.wl%francesco@rabbitmq.com>
Message-ID: <1342125194989-20765.post@n5.nabble.com>

Francesco,
Thanks for the quick feedback.  It is exactly what i look for.  
JW

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Mirrored-queue-requeue-un-acknolwedged-message-in-failover-tp20758p20765.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From Bin.Chen at kla-tencor.com  Fri Jul 13 00:18:20 2012
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Thu, 12 Jul 2012 16:18:20 -0700
Subject: [rabbitmq-discuss] Event Handle Leaks in RabbotMQ .NET Client
Message-ID: <BCC407A444557E41B0D8B0260D68499205236E0D@CA1EXCLV07.adcorp.kla-tencor.com>

Hello All,

 

We are using RabbitMQ .NET client. 

When I ran memory leaks profiler, I found some event handle leaks.

The profiler points the leak to class ConnectionBase.

The AutoResetEvent variables m_heartbeatRead and m_heartbeatWrite are
leaked.

It seems they are not disposed when the connection is closed or aborted.

 

Best regards,

--Bin Chen

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/b7846b0d/attachment.htm>

From sanjiv.kumar.jha at accenture.com  Fri Jul 13 07:05:51 2012
From: sanjiv.kumar.jha at accenture.com (sanjiv.kumar.jha at accenture.com)
Date: Fri, 13 Jul 2012 06:05:51 +0000
Subject: [rabbitmq-discuss] Cluster
	setup	:	rabbitmq	server	stops	responding to rabbitmqctl commands
In-Reply-To: <87wr293ybs.wl%francesco@rabbitmq.com>
References: <EEA1DC407D5C23479BEAAF68C3D560400531C4CA@048-CH1MPN1-213.048d.mgd.msft.net>
	<877gua5zni.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C522@048-CH1MPN1-213.048d.mgd.msft.net>
	<87629u5wsw.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C770@048-CH1MPN1-213.048d.mgd.msft.net>
	<87wr293ybs.wl%francesco@rabbitmq.com>
Message-ID: <EEA1DC407D5C23479BEAAF68C3D560400531C8C8@048-CH1MPN1-213.048d.mgd.msft.net>

Thanks Francesco for quick response!!

I don't have script as such to reproduce this issue and all these tests are performed manually.

However, I am repeating the following steps in order to reproduce this issue:

I have node A and B clustered and with HA queues on them

1st iteration:
  * Bring down A
  * Bring up A
  * Bring down B after A is brought up

2nd iteration:
  * Bring up B
  * Bring down A after B is brought up

3rd iteration:
  * Bring up A
  * Bring down B after A is brought up

Attaching logs for both the nodes.

Thanks,

Sanjiv


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Francesco Mazzoli
Sent: 12 July 2012 18:56
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Cluster setup : rabbitmq server stops responding to rabbitmqctl commands

At Thu, 12 Jul 2012 12:57:31 +0000,
sanjiv kumar jha wrote:
> I tried replicating this using rabbitmq-server 2.8.4 version, but
> noticed a different kind of issue. In current setup, 'rabbitmqctl
> list_queues' is working whereas 'rabbitmqctl status' is not
> responding. Even 'rabbitmqctl wait /var/run/rabbitmq/pid' does not respond, keeps waiting.

If I understand correctly the log you posted is on node-A *after* you brought down node-B, right? In any case, things look OK. Could you attach the logs in their entirety (both node A and B)?

The best thing would be for you to post a script that replicates what you're trying to do and reproduces the behaviour you're seeing. Needless to say I have tried to replicate your problem to no avail.

--
Francesco * Often in error, never in doubt _______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
______________________________________________________________________________________

www.accenture.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQ_HA_Issue_Node-A_startup_log
Type: application/octet-stream
Size: 6557 bytes
Desc: RabbitMQ_HA_Issue_Node-A_startup_log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/31f235fb/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQ_HA_Issue_Node-B_startup_log
Type: application/octet-stream
Size: 12795 bytes
Desc: RabbitMQ_HA_Issue_Node-B_startup_log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/31f235fb/attachment-0001.obj>

From ivan.lysov at gmail.com  Fri Jul 13 08:08:57 2012
From: ivan.lysov at gmail.com (ivan.lysov)
Date: Fri, 13 Jul 2012 00:08:57 -0700 (PDT)
Subject: [rabbitmq-discuss] what is the best way of implementing
	client-server arcitecture?
Message-ID: <1342163337960-20768.post@n5.nabble.com>

Hello,
I'm wondering how the server should consume the messages. 
1. There is one queue where all the messages from all the clients are
delivered.
 a) would it be a bottleneck especially when the size of messages is pretty
large?
 b) is it the size that really matters in this case?
2. There are many queues, one for each client.
 a) would it be a performance issue to keep on listening all the queues?
 b) is it the number of clients that matter in this case?
3. There are several queues that server listens to, the messages are
delivered by some special algorithm (for example, grouped by categories or
size)
 a) does it make sense at all? And if it does, what is the best practices
algorithm for such message distributing?

Sure, there is no big deal in trying all these cases in test projects (what
i'm going to do right now), measuring performance etc., but i'm also sure
that there is a best way of implementing this. So i need your help.

Thank you!
Ivan.

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/what-is-the-best-way-of-implementing-client-server-arcitecture-tp20768.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From hebin7611 at hotmail.com  Fri Jul 13 08:17:41 2012
From: hebin7611 at hotmail.com (=?gb2312?B?us6x8w==?=)
Date: Fri, 13 Jul 2012 15:17:41 +0800
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <4FFE72DC.6060806@rabbitmq.com>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>,
	<4FFAA1C2.4080006@rabbitmq.com>
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>,
	<4FFAB161.4080605@rabbitmq.com>
	<SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>,
	<4FFACB92.3040508@rabbitmq.com>
	<SNT115-W689CDE2F99F25433D94CFA6D20@phx.gbl>,
	<A1CE8B77-7E1C-4D9E-97CE-2152E9005727@rabbitmq.com>
	<SNT115-W32050243214FAFF043A6A4A6D00@phx.gbl>,
	<4FFE6F1D.8070703@rabbitmq.com>
	<SNT115-W4FD14C6F0FEBFA7AD80C5A6D00@phx.gbl>,
	<4FFE72DC.6060806@rabbitmq.com>
Message-ID: <SNT115-W53BF2AEB973A782DBAA2D7A6D70@phx.gbl>


Sorry, I tried  I tried "erl -sname rabbit" with a hacked version.
With the official release version of epmd, I got error.

Thanks!


> Date: Thu, 12 Jul 2012 07:46:52 +0100
> From: matthias at rabbitmq.com
> To: rabbitmq-discuss at lists.rabbitmq.com
> CC: hebin7611 at hotmail.com
> Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected
> 
> On 12/07/12 07:40, ?? wrote:
> > The same:
> >
> > # erl -sname rabbit
> > {error_logger,{{2012,7,12},{14,39,12}},"Protocol: ~p: register error:
> > ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},
> 
> Earlier on 
> (http://rabbitmq.1065348.n5.nabble.com/Plz-give-me-help-about-EPMD-Non-local-peer-connected-tp20601p20640.html) 
> you said
> <quote>
> I tried "erl -sname rabbit", it's OK.
> </quote>
> 
> So has this somehow *stopped* working now, or was your above statement 
> incorrect?
> 
> Matthias.
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/44c00dd0/attachment.htm>

From emile at rabbitmq.com  Fri Jul 13 09:24:29 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 13 Jul 2012 09:24:29 +0100
Subject: [rabbitmq-discuss] Event Handle Leaks in RabbotMQ .NET Client
In-Reply-To: <BCC407A444557E41B0D8B0260D68499205236E0D@CA1EXCLV07.adcorp.kla-tencor.com>
References: <BCC407A444557E41B0D8B0260D68499205236E0D@CA1EXCLV07.adcorp.kla-tencor.com>
Message-ID: <4FFFDB3D.3000607@rabbitmq.com>

Hi,

On 13/07/12 00:18, Chen, Bin wrote:
> The AutoResetEvent variables m_heartbeatRead and m_heartbeatWrite are
> leaked.

Thanks for reporting this. I will file a bug to confirm and fix this.



-Emile


From tim at tenkan.org  Fri Jul 13 07:58:17 2012
From: tim at tenkan.org (Tim Daly, Jr)
Date: Thu, 12 Jul 2012 23:58:17 -0700 (PDT)
Subject: [rabbitmq-discuss] crash while starting alarm handler
Message-ID: <6bfe04a0-8866-477d-8b62-768c13e0e672@googlegroups.com>

Hi!  I'm new to rabbitmq, and I find myself faced with a startup failure 
that I'm not sure how to debug.  I'm on RHEL 6.3, using rabbitmq 2.6.1.  
I've included the logs below... I didn't see the same crash in the mailing 
list archives.  I'd be grateful for any clues, or suggestions for debugging 
it.

Here's my startup log:

Activating RabbitMQ plugins ...
0 plugins activated:


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.6.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at nodename
app descriptor : 
/usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : sE2FCwoGmnSTLgBS8Oq2iw==
log            : /var/log/rabbitmq/rabbit at nodename.log
sasl log       : /var/log/rabbitmq/rabbit at nodename-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at nodename
erlang version : 5.8.5

-- rabbit boot start
starting file handle cache server                                     
...done
starting worker pool                                                  
...done
starting database                                                     
...done
starting codec correctness check                                      
...done
-- external infrastructure ready
starting statistics event manager                                     
...done
starting logging server                                               
...done
starting plugin registry                                              
...done
starting auth mechanism amqplain                                      
...done
starting auth mechanism cr-demo                                       
...done
starting auth mechanism plain                                         
...done
starting exchange type direct                                         
...done
starting exchange type fanout                                         
...done
starting exchange type headers                                        
...done
starting exchange type topic                                          
...done
-- kernel ready
starting node monitor                                                 
...done
starting cluster delegate                                             
...done
starting guid generator                                               
...done
starting alarm handler                                                
...BOOT ERROR: FAILED
Reason: {badmatch,
            {error,
                {shutdown,
                    {child,undefined,vm_memory_monitor_sup,
                        {rabbit_restartable_sup,start_link,
                            [vm_memory_monitor_sup,
                             {vm_memory_monitor,start_link,[0.4]}]},
                        transient,infinity,supervisor,
                        [rabbit_restartable_sup]}}}}
Stacktrace: [{rabbit_sup,start_restartable_child,2},
             {rabbit_alarm,start,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2},
             {application_master,start_it_old,4}]
{"Kernel pid 
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}


And here is my sasl log:


=CRASH REPORT==== 13-Jul-2012::00:11:17 ===
  crasher:
    initial call: vm_memory_monitor:init/1
    pid: <0.165.0>
    registered_name: []
    exception exit: {{badmatch,{error,enoent}},
                     [{vm_memory_monitor,read_proc_file,1},
                      {vm_memory_monitor,get_total_memory,1},
                      {vm_memory_monitor,init,1},
                      {gen_server,init_it,6},
                      {proc_lib,init_p_do_apply,3}]}
      in function  gen_server:init_it/6
    ancestors: [vm_memory_monitor_sup,rabbit_sup,<0.104.0>]
    messages: []
    links: [<0.164.0>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 377
    stack_size: 24
    reductions: 265
  neighbours:

=SUPERVISOR REPORT==== 13-Jul-2012::00:11:17 ===
     Supervisor: {local,vm_memory_monitor_sup}
     Context:    start_error
     Reason:     {{badmatch,{error,enoent}},
                  [{vm_memory_monitor,read_proc_file,1},
                   {vm_memory_monitor,get_total_memory,1},
                   {vm_memory_monitor,init,1},
                   {gen_server,init_it,6},
                   {proc_lib,init_p_do_apply,3}]}
     Offender:   [{pid,undefined},
                  {name,vm_memory_monitor},
                  {mfargs,{vm_memory_monitor,start_link,[0.4]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=CRASH REPORT==== 13-Jul-2012::00:11:18 ===
  crasher:
    initial call: application_master:init/4
    pid: <0.101.0>
    registered_name: []
    exception exit: {bad_return,{{rabbit,start,[normal,[]]},
                                 {'EXIT',{rabbit,failure_during_boot}}}}
      in function  application_master:init/4
    ancestors: [<0.100.0>]
    messages: [{'EXIT',<0.104.0>,normal}]
    links: [<0.100.0>,<0.7.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 205
  neighbours:


Thanks,
Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/21d73217/attachment.htm>

From anton.kirilenko at rosalab.ru  Fri Jul 13 09:32:33 2012
From: anton.kirilenko at rosalab.ru (Anton Kirilenko)
Date: Fri, 13 Jul 2012 12:32:33 +0400
Subject: [rabbitmq-discuss] building system architecture
Message-ID: <4FFFDD21.8030205@rosalab.ru>

Hello,
I'm involved in developing of the automated package building system. 
I've got some working version
1) Every building client can process its task for an hour or more. Is it 
correct to send ACK only after the building is done?
2) Now I've got one queue for each combination of building platform and 
architecture. Lots of client consume from it. But I need a task 
scheduling mechanism (send all the task to queue when we get them is not 
a good idea), ability to stop building... It looks like I need separate 
queue for every client (it can be exclusive consumer for every queue). 
Is it possible to configure RabbitMQ to close the queue and notify 
building server (that have sent the message) about it?
The important thing: it's very bad for the system to loose building 
tasks. In case of client failure RabbitMQ should notify server, in case 
of RabbitMQ failure (or connection failure) server should know that the 
task was not processed well and resend it to another client.
In other words - after building server have sent the message, it should 
be notified if the task was not (and will never be) processed.

Thanks.
Anton.

From tim at rabbitmq.com  Fri Jul 13 09:46:18 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 13 Jul 2012 09:46:18 +0100
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
	connected
In-Reply-To: <SNT115-W53BF2AEB973A782DBAA2D7A6D70@phx.gbl>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>,
	<4FF7218F.3090105@rabbitmq.com>,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>,
	<4FFAA1C2.4080006@rabbitmq.com>
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>,
	<4FFAB161.4080605@rabbitmq.com>
	<SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>,
	<4FFACB92.3040508@rabbitmq.com>
	<SNT115-W689CDE2F99F25433D94CFA6D20@phx.gbl>,
	<A1CE8B77-7E1C-4D9E-97CE-2152E9005727@rabbitmq.com>
	<SNT115-W32050243214FAFF043A6A4A6D00@phx.gbl>,
	<4FFE6F1D.8070703@rabbitmq.com>
	<SNT115-W4FD14C6F0FEBFA7AD80C5A6D00@phx.gbl>,
	<4FFE72DC.6060806@rabbitmq.com>
	<SNT115-W53BF2AEB973A782DBAA2D7A6D70@phx.gbl>
Message-ID: <66C66888-2E08-4D5C-A294-825F004EC6B9@rabbitmq.com>

On 13 Jul 2012, at 08:17, ?? wrote:

> Sorry, I tried I tried "erl -sname rabbit" with a hacked version.
> With the official release version of epmd, I got error.
> 

You should really take this issue to the erlang-questions mailing list, as it is not rabbit specific and sounds like something that ought to be documented for CentOS users in general. My own networking configuration on CentOS did not work OOTB and I had to add the (single) hostname entry on a separate line to the localhost.localdomain setup, as well as editing the sysconfig/net* entry, before I got distributed Erlang nodes to start up. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/2d26bb10/attachment.htm>

From emile at rabbitmq.com  Fri Jul 13 09:50:52 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 13 Jul 2012 09:50:52 +0100
Subject: [rabbitmq-discuss] crash while starting alarm handler
In-Reply-To: <6bfe04a0-8866-477d-8b62-768c13e0e672@googlegroups.com>
References: <6bfe04a0-8866-477d-8b62-768c13e0e672@googlegroups.com>
Message-ID: <4FFFE16C.9070704@rabbitmq.com>

Hi,

On 13/07/12 07:58, Tim Daly, Jr wrote:
>      Reason:     {{badmatch,{error,enoent}},
>                   [{vm_memory_monitor,read_proc_file,1},

This would indicate that you don't have a /proc/meminfo file, which is
very unusual - can you confirm? It does exist on RHEL5.5.


-Emile


From srikanthtns at gmail.com  Thu Jul 12 19:47:20 2012
From: srikanthtns at gmail.com (srikanth tns)
Date: Thu, 12 Jul 2012 11:47:20 -0700
Subject: [rabbitmq-discuss] RabbitMQ replies not received to client
Message-ID: <CAOU_jKBEcVmRYsdqoHtuS=sdSqx7-tFjgwzNzKVr=SD_1Be8nw@mail.gmail.com>

Hi

I am using RabbitMQ 2.3.1 ,Erlang 5.6.5 on linux systems along with
Mcollective for our infrastructure.
The infrastructure was working fine when we have like 250 nodes connected
to the rabbit_stomp . When we increase the nodes to 300+ , we started
seeing issues.
The nodes are pushing the messages onto the rabbitmq topic , but somehow
client is not receiving the messages. Looks like the connection object the
rabbit_stomp uses on the client is not responding.

We have like 8GB RAM of memory with 2 Core CPUs each 2.93 GHz and rabbitmq
is using 40% of the RAM.
I tried playing with vm_high_memory_benchmark from 0.2 - 0.7 but still the
same issue.
The rabbitmq logs say no ERRORs or memory issues , not even the sasl logs.

Any advice on this issue is greatly appreciated.

Thanks
Srikanth
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120712/5a6a2a7d/attachment.htm>

From matthias at rabbitmq.com  Fri Jul 13 10:33:58 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 13 Jul 2012 10:33:58 +0100
Subject: [rabbitmq-discuss] RabbitMQ replies not received to client
In-Reply-To: <CAOU_jKD-8V-N-PkVVexCmkOor7EVBPd=awbC2e7H=VsZEAmtEg@mail.gmail.com>
References: <CAOU_jKBEcVmRYsdqoHtuS=sdSqx7-tFjgwzNzKVr=SD_1Be8nw@mail.gmail.com>
	<CAOU_jKD-8V-N-PkVVexCmkOor7EVBPd=awbC2e7H=VsZEAmtEg@mail.gmail.com>
Message-ID: <4FFFEB86.10905@rabbitmq.com>

On 12/07/12 19:57, srikanth tns wrote:
> I am using RabbitMQ 2.3.1 ,Erlang 5.6.5 on linux systems

Those are ancient versions. There have been many improvements and bug 
fixes to Rabbit and Erlang since then. Please upgrade.

> The infrastructure was working fine when we have like 250 nodes
> connected to the rabbit_stomp . When we increase the nodes to 300+ , we
> started seeing issues.
> The nodes are pushing the messages onto the rabbitmq topic , but somehow
> client is not receiving the messages. Looks like the connection object
> the rabbit_stomp uses on the client is not responding.

I recommend you explore the state of your rabbit with the management ui. 
That should hopefully provide some clues as to where the messages are 
going astray.

Regards,

Matthias.

From francesco at rabbitmq.com  Fri Jul 13 10:47:43 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 13 Jul 2012 10:47:43 +0100
Subject: [rabbitmq-discuss]
	Cluster	setup	:	rabbitmq	server	stops	responding to
	rabbitmqctl commands
In-Reply-To: <EEA1DC407D5C23479BEAAF68C3D560400531C8C8@048-CH1MPN1-213.048d.mgd.msft.net>
References: <EEA1DC407D5C23479BEAAF68C3D560400531C4CA@048-CH1MPN1-213.048d.mgd.msft.net>
	<877gua5zni.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C522@048-CH1MPN1-213.048d.mgd.msft.net>
	<87629u5wsw.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C770@048-CH1MPN1-213.048d.mgd.msft.net>
	<87wr293ybs.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C8C8@048-CH1MPN1-213.048d.mgd.msft.net>
Message-ID: <87pq80ouv4.wl%francesco@rabbitmq.com>

Hi Sanjiv,

I'm going to try to reproduce again now. However the logs you posted are not
that useful (they just record the startup sequence). Can you post the logs named
as the node names, which are the ones that actually record error/warnings? They
should be in the same directory as the other logs, and in your case will be
named rabbit at DV1SP001.log and rabbit at BSPDEVSDK001.log .

--
Francesco * Often in error, never in doubt

From sanjiv.kumar.jha at accenture.com  Fri Jul 13 11:23:15 2012
From: sanjiv.kumar.jha at accenture.com (sanjiv.kumar.jha at accenture.com)
Date: Fri, 13 Jul 2012 10:23:15 +0000
Subject: [rabbitmq-discuss]
	Cluster	setup	:	rabbitmq	server	stops	responding
	to	rabbitmqctl commands
In-Reply-To: <87pq80ouv4.wl%francesco@rabbitmq.com>
References: <EEA1DC407D5C23479BEAAF68C3D560400531C4CA@048-CH1MPN1-213.048d.mgd.msft.net>
	<877gua5zni.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C522@048-CH1MPN1-213.048d.mgd.msft.net>
	<87629u5wsw.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C770@048-CH1MPN1-213.048d.mgd.msft.net>
	<87wr293ybs.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C8C8@048-CH1MPN1-213.048d.mgd.msft.net>
	<87pq80ouv4.wl%francesco@rabbitmq.com>
Message-ID: <EEA1DC407D5C23479BEAAF68C3D560400531C9A1@048-CH1MPN1-213.048d.mgd.msft.net>

Hi Francesco,

Please find the logs attached.

Thanks,

Sanjiv

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Francesco Mazzoli
Sent: 13 July 2012 15:18
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Cluster setup : rabbitmq server stops responding to rabbitmqctl commands

Hi Sanjiv,

I'm going to try to reproduce again now. However the logs you posted are not that useful (they just record the startup sequence). Can you post the logs named as the node names, which are the ones that actually record error/warnings? They should be in the same directory as the other logs, and in your case will be named rabbit at DV1SP001.log and rabbit at BSPDEVSDK001.log .

--
Francesco * Often in error, never in doubt _______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
______________________________________________________________________________________

www.accenture.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at BSPDEVSDK001.log
Type: application/octet-stream
Size: 49134 bytes
Desc: rabbit at BSPDEVSDK001.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/9d7a9577/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at DV1SP001.log
Type: application/octet-stream
Size: 37352 bytes
Desc: rabbit at DV1SP001.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/9d7a9577/attachment-0001.obj>

From hebin7611 at hotmail.com  Fri Jul 13 11:29:02 2012
From: hebin7611 at hotmail.com (=?gb2312?B?us6x8w==?=)
Date: Fri, 13 Jul 2012 18:29:02 +0800
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
 connected
In-Reply-To: <66C66888-2E08-4D5C-A294-825F004EC6B9@rabbitmq.com>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>, ,
	<4FF7218F.3090105@rabbitmq.com>, ,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>, ,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>,
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>, ,
	<4FFAA1C2.4080006@rabbitmq.com>,
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>, ,
	<4FFAB161.4080605@rabbitmq.com>,
	<SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>, ,
	<4FFACB92.3040508@rabbitmq.com>,
	<SNT115-W689CDE2F99F25433D94CFA6D20@phx.gbl>, ,
	<A1CE8B77-7E1C-4D9E-97CE-2152E9005727@rabbitmq.com>,
	<SNT115-W32050243214FAFF043A6A4A6D00@phx.gbl>, ,
	<4FFE6F1D.8070703@rabbitmq.com>,
	<SNT115-W4FD14C6F0FEBFA7AD80C5A6D00@phx.gbl>, ,
	<4FFE72DC.6060806@rabbitmq.com>,
	<SNT115-W53BF2AEB973A782DBAA2D7A6D70@phx.gbl>,
	<66C66888-2E08-4D5C-A294-825F004EC6B9@rabbitmq.com>
Message-ID: <SNT115-W397B81E80EB014D6FAAF0BA6D70@phx.gbl>



Hi all,

Yes, I guess the problem is caused by erlang. It does not support multi interface?

I hacked epmd with following codes:

          s->local_peer =
              (((((unsigned) ntohl(si.sin_addr.s_addr)) & 0xFF000000U) == 0x7F000000U) ||
              (getsockname(s->fd,(struct sockaddr*) &di,&st) ? EPMD_FALSE : (((((unsigned) ntohl(di.sin_addr.s_addr)) & 0xFF000000U) == 0x7F000000U) || si.sin_addr.s_addr == di.sin_addr.s_addr)));

But I am not sure it's secure.




From: tim at rabbitmq.com
Date: Fri, 13 Jul 2012 09:46:18 +0100
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer	connected

On 13 Jul 2012, at 08:17, ?? wrote:Sorry, I tried I tried "erl -sname rabbit" with a hacked version.
With the official release version of epmd, I got error.


You should really take this issue to the erlang-questions mailing list, as it is not rabbit specific and sounds like something that ought to be documented for CentOS users in general. My own networking configuration on CentOS did not work OOTB and I had to add the (single) hostname entry on a separate line to the localhost.localdomain setup, as well as editing the sysconfig/net* entry, before I got distributed Erlang nodes to start up. 
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/be955c97/attachment.htm>

From tim at rabbitmq.com  Fri Jul 13 11:32:19 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 13 Jul 2012 11:32:19 +0100
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
	connected
In-Reply-To: <SNT115-W397B81E80EB014D6FAAF0BA6D70@phx.gbl>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>, ,
	<4FF7218F.3090105@rabbitmq.com>, ,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>, ,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>,
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>, ,
	<4FFAA1C2.4080006@rabbitmq.com>,
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>, ,
	<4FFAB161.4080605@rabbitmq.com>,
	<SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>, ,
	<4FFACB92.3040508@rabbitmq.com>,
	<SNT115-W689CDE2F99F25433D94CFA6D20@phx.gbl>, ,
	<A1CE8B77-7E1C-4D9E-97CE-2152E9005727@rabbitmq.com>,
	<SNT115-W32050243214FAFF043A6A4A6D00@phx.gbl>, ,
	<4FFE6F1D.8070703@rabbitmq.com>,
	<SNT115-W4FD14C6F0FEBFA7AD80C5A6D00@phx.gbl>, ,
	<4FFE72DC.6060806@rabbitmq.com>,
	<SNT115-W53BF2AEB973A782DBAA2D7A6D70@phx.gbl>,
	<66C66888-2E08-4D5C-A294-825F004EC6B9@rabbitmq.com>
	<SNT115-W397B81E80EB014D6FAAF0BA6D70@phx.gbl>
Message-ID: <16AE892A-1C0A-4945-8F23-53B5999C2690@rabbitmq.com>

On 13 Jul 2012, at 11:29, ?? wrote:

> 
> Hi all,
> 
> Yes, I guess the problem is caused by erlang. It does not support multi interface?
> 

Please go and ask this on the erlang-questions mailing list. There have been discussions about multi-homing and dual/bonded interfaces there quite recently, although I'm not clear on whether they relate to your issue or not, so you may wish to check the erlang-questions mailing list archives too.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/abe9f06b/attachment.htm>

From steve at rabbitmq.com  Fri Jul 13 11:33:29 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 13 Jul 2012 11:33:29 +0100
Subject: [rabbitmq-discuss] what is the best way of implementing
	client-server arcitecture?
In-Reply-To: <1342163337960-20768.post@n5.nabble.com>
References: <1342163337960-20768.post@n5.nabble.com>
Message-ID: <C1F14C9D-85A2-4732-8521-AD36005C5879@rabbitmq.com>

Ivan,

This is a very good question. However, I'm bound to say it is not really
a RabbitMQ question.

A full answer would occupy a book (and indeed, you can find books on
this subject) and boil down to analysing:

a) what do you mean by 'best'?  That is, precisely what are your goals?
b) what really matters to you? That is, precisely what are your
   requirements?

These can have so many answers it is not possible to say what
arrangement is 'best'. I'll just give a small selection of problem
differentiators:

1. what size requests? (what is 'pretty large'??)
2. what size replies?
3. are there server/application affinity rules?
4. are the requests transactional? serialised?
5. are there response guarantees? what are they?
6. what message rate? variability?
7. what service rate? variability?
8. what hardware?

I recommend you go find a good book. I could be wrong but you probably
won't find any definitive answers on a forum like this.

Good luck,
Steve Powell  (a happy bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

On 13 Jul 2012, at 08:08, ivan.lysov wrote:

> Hello,
> I'm wondering how the server should consume the messages. 
> 1. There is one queue where all the messages from all the clients are
> delivered.
> a) would it be a bottleneck especially when the size of messages is pretty
> large?
> b) is it the size that really matters in this case?
> 2. There are many queues, one for each client.
> a) would it be a performance issue to keep on listening all the queues?
> b) is it the number of clients that matter in this case?
> 3. There are several queues that server listens to, the messages are
> delivered by some special algorithm (for example, grouped by categories or
> size)
> a) does it make sense at all? And if it does, what is the best practices
> algorithm for such message distributing?
> 
> Sure, there is no big deal in trying all these cases in test projects (what
> i'm going to do right now), measuring performance etc., but i'm also sure
> that there is a best way of implementing this. So i need your help.
> 
> Thank you!
> Ivan.
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/what-is-the-best-way-of-implementing-client-server-arcitecture-tp20768.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Fri Jul 13 11:36:30 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 13 Jul 2012 11:36:30 +0100
Subject: [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer
	connected
In-Reply-To: <16AE892A-1C0A-4945-8F23-53B5999C2690@rabbitmq.com>
References: <SNT115-W43D7BDC3437EE90BC11667A6EE0@phx.gbl>, ,
	<4FF7218F.3090105@rabbitmq.com>, ,
	<SNT115-W16442C5F622F1BD9938E09A6D30@phx.gbl>, ,
	<818EBB58-EEEC-4382-8319-7291C1A2EF4D@rabbitmq.com>,
	<SNT115-W144BA91DB06F5BFE83E0ADA6D30@phx.gbl>, ,
	<4FFAA1C2.4080006@rabbitmq.com>,
	<SNT115-W5783D62802EDC2E215DEBDA6D30@phx.gbl>, ,
	<4FFAB161.4080605@rabbitmq.com>,
	<SNT115-W15D1447EFB7C95C63ED064A6D30@phx.gbl>, ,
	<4FFACB92.3040508@rabbitmq.com>,
	<SNT115-W689CDE2F99F25433D94CFA6D20@phx.gbl>, ,
	<A1CE8B77-7E1C-4D9E-97CE-2152E9005727@rabbitmq.com>,
	<SNT115-W32050243214FAFF043A6A4A6D00@phx.gbl>, ,
	<4FFE6F1D.8070703@rabbitmq.com>,
	<SNT115-W4FD14C6F0FEBFA7AD80C5A6D00@phx.gbl>, ,
	<4FFE72DC.6060806@rabbitmq.com>,
	<SNT115-W53BF2AEB973A782DBAA2D7A6D70@phx.gbl>,
	<66C66888-2E08-4D5C-A294-825F004EC6B9@rabbitmq.com>
	<SNT115-W397B81E80EB014D6FAAF0BA6D70@phx.gbl>
	<16AE892A-1C0A-4945-8F23-53B5999C2690@rabbitmq.com>
Message-ID: <1507431E-0537-4C90-B732-33023C5E4400@rabbitmq.com>

For example: http://erlang.org/pipermail/erlang-questions/2012-January/063761.html

On 13 Jul 2012, at 11:32, Tim Watson wrote:

> On 13 Jul 2012, at 11:29, ?? wrote:
> 
>> 
>> Hi all,
>> 
>> Yes, I guess the problem is caused by erlang. It does not support multi interface?
>> 
> 
> Please go and ask this on the erlang-questions mailing list. There have been discussions about multi-homing and dual/bonded interfaces there quite recently, although I'm not clear on whether they relate to your issue or not, so you may wish to check the erlang-questions mailing list archives too.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/80096ed0/attachment.htm>

From francesco at rabbitmq.com  Fri Jul 13 12:15:12 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 13 Jul 2012 12:15:12 +0100
Subject: [rabbitmq-discuss]
	Cluster	setup	:	rabbitmq	server	stops	responding	to	rabbitmqctl
	commands
In-Reply-To: <EEA1DC407D5C23479BEAAF68C3D560400531C9A1@048-CH1MPN1-213.048d.mgd.msft.net>
References: <EEA1DC407D5C23479BEAAF68C3D560400531C4CA@048-CH1MPN1-213.048d.mgd.msft.net>
	<877gua5zni.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C522@048-CH1MPN1-213.048d.mgd.msft.net>
	<87629u5wsw.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C770@048-CH1MPN1-213.048d.mgd.msft.net>
	<87wr293ybs.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C8C8@048-CH1MPN1-213.048d.mgd.msft.net>
	<87pq80ouv4.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C9A1@048-CH1MPN1-213.048d.mgd.msft.net>
Message-ID: <87obnjq5dr.wl%francesco@rabbitmq.com>

At Fri, 13 Jul 2012 10:23:15 +0000,
Hi Sanjiv,

I have hacked up a quick script to try to reproduce your problem. It is a bash
script that starts/stops/cluster and a python script used by the bash script to
declare 100 HA queues; I have attached them. I'm running the two nodes on the
same machine, this makes a difference but hopefully the problem is not there.

Looking at your logs, it looks like DV1SP001 sees BSPEVSDK001 going down, but
there is no trace of that in the BSPEVSDK001 logs, which looks like it's running
all the way through. Are the clocks on the two nodes synchronised?  If they are,
what I see in the logs looks like a netsplit, which is a bad thing for rabbit
clusters, and can cause mnesia to act funny.

It's also not clear from your email and the logs how you set up the cluster in
the first place.

Can you confirm that what I do in the script is more or less what you are doing?
If it's not, can you give more details on your setup?

--
Francesco * Often in error, never in doubt

-------------- next part --------------
A non-text attachment was scrubbed...
Name: test
Type: application/octet-stream
Size: 1165 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/9184c92c/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: declare.py
Type: application/octet-stream
Size: 330 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/9184c92c/attachment-0001.obj>

From meetprashanth437 at gmail.com  Fri Jul 13 14:15:32 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Fri, 13 Jul 2012 09:15:32 -0400
Subject: [rabbitmq-discuss] Rabbitmq max-publish
In-Reply-To: <4FFF0578.5000601@rabbitmq.com>
References: <CAE8G+yTEpfFH8KBp6R25H9XsYo5QQDKcWRQU4OJCrkbZg4W69A@mail.gmail.com>
	<CAE0Sz=zmg8yZ5BK0M8H0ue-Xt_LXbuGD3DxKts-NU_8kZuEvZQ@mail.gmail.com>
	<4FFE67EB.7090008@rabbitmq.com>
	<CAE8G+yT=VQMfNvexDGrm89rA11kYqhLKX-fGQ65Xr2zR_6iQ_w@mail.gmail.com>
	<4FFED28D.8080004@rabbitmq.com>
	<CAE8G+yTRVjiwXiYrUbL59nj0b2NVreujYR04aSsv10NLhWu3FA@mail.gmail.com>
	<4FFF0578.5000601@rabbitmq.com>
Message-ID: <CAE8G+yRePYdRHREJJeTnbjN8v_C5jockp7YwDaYi_tXN0iA+Xg@mail.gmail.com>

Got it, If i enable Hipe on a node, I need to do it on every node on the
cluster.

On Thu, Jul 12, 2012 at 1:12 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 12/07/12 15:11, Prashanth wrote:
>
>> I set the hipe_compile to true, It was working yesterday. today I get an
>> error when starting the server
>>
>> Error: {cannot_start_application,os_**mon,{not_started,sasl}}
>>
>> any idea?
>>
>
> Nope.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/c309bc99/attachment.htm>

From meetprashanth437 at gmail.com  Fri Jul 13 15:02:50 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Fri, 13 Jul 2012 10:02:50 -0400
Subject: [rabbitmq-discuss] RabbitMQ SSL
Message-ID: <CAE8G+ySr0MaTgqoWkuoDxW0P1N=7HKmfKKACGOLtj1pi1xUpxA@mail.gmail.com>

Hi all,

I followed the http://www.rabbitmq.com/ssl.html to set up SSL.
When I try to use the SSL port to communicate to RabbitMQ Server.

I get a message Logging in: (end-of-stream)
connecting to server fails.

Thanks!!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/eee78de1/attachment.htm>

From matthias at rabbitmq.com  Fri Jul 13 15:07:09 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 13 Jul 2012 15:07:09 +0100
Subject: [rabbitmq-discuss] Rabbitmq max-publish
In-Reply-To: <CAE8G+yRePYdRHREJJeTnbjN8v_C5jockp7YwDaYi_tXN0iA+Xg@mail.gmail.com>
References: <CAE8G+yTEpfFH8KBp6R25H9XsYo5QQDKcWRQU4OJCrkbZg4W69A@mail.gmail.com>
	<CAE0Sz=zmg8yZ5BK0M8H0ue-Xt_LXbuGD3DxKts-NU_8kZuEvZQ@mail.gmail.com>
	<4FFE67EB.7090008@rabbitmq.com>
	<CAE8G+yT=VQMfNvexDGrm89rA11kYqhLKX-fGQ65Xr2zR_6iQ_w@mail.gmail.com>
	<4FFED28D.8080004@rabbitmq.com>
	<CAE8G+yTRVjiwXiYrUbL59nj0b2NVreujYR04aSsv10NLhWu3FA@mail.gmail.com>
	<4FFF0578.5000601@rabbitmq.com>
	<CAE8G+yRePYdRHREJJeTnbjN8v_C5jockp7YwDaYi_tXN0iA+Xg@mail.gmail.com>
Message-ID: <50002B8D.8040505@rabbitmq.com>

Prashanth,

On 13/07/12 14:15, Prashanth wrote:
> If i enable Hipe on a node, I need to do it on every node on the
> cluster.

That is highly unlikely, and I cannot reproduce this.

Matthias.

From emile at rabbitmq.com  Fri Jul 13 15:14:05 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 13 Jul 2012 15:14:05 +0100
Subject: [rabbitmq-discuss] RabbitMQ SSL
In-Reply-To: <CAE8G+ySr0MaTgqoWkuoDxW0P1N=7HKmfKKACGOLtj1pi1xUpxA@mail.gmail.com>
References: <CAE8G+ySr0MaTgqoWkuoDxW0P1N=7HKmfKKACGOLtj1pi1xUpxA@mail.gmail.com>
Message-ID: <50002D2D.7020907@rabbitmq.com>

Hi,

On 13/07/12 15:02, Prashanth wrote:
> I get a message Logging in: (end-of-stream)
> connecting to server fails. 

It is challenging to assist here, given how little information you have
provided. As a first step could you try to verify your setup using the
troubleshooting steps outlined here:

http://www.rabbitmq.com/troubleshooting-ssl.html

Let us know how far you get, which of the steps fail and the diagnostic
output.


Thanks


Emile


From Michael.Laing at nytimes.com  Fri Jul 13 16:55:50 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Fri, 13 Jul 2012 11:55:50 -0400
Subject: [rabbitmq-discuss] Federation: global exchange
Message-ID: <CC25BD46.3361%Michael.Laing@nytimes.com>

I have been experimenting with federation and thought I would report on the experience as input to development of the capability.

My goal was to create a 'global exchange' that could reside in any or all of the virtual hosts in my rabbitmq clusters. The purpose of the global exchanges is to provide a 'control bus'-like capability wherein messages published to the exchange in any vhost in any cluster appear in the corresponding exchange in every vhost in every cluster. The messages will be relatively small and message rates relatively low, under 100 per second ? probably well under.

To implement this I created a 'reflector' vhost in each cluster. Within the cluster, I use federation to create bidirectional links in a star configuration between 'reflector' and each other participating vhost in the cluster. We segregate products/projects etc into their own vhosts so there can be many of them in each cluster.

The clusters in turn are fully connected (link from each cluster to every other cluster) in a federated network using their 'reflector' vhosts.

For simplicity I use a hop count of 3 for each link. Duplicate messages are ignored.

Here are 2 message paths of the many that occur, one within the cluster and one between clusters:

Message -> exchange:Global/vhost:A/cluster:X
(hop 1) -> exchange:Global/vhost:Reflector/cluster:X
(hop 2) -> exchange:Global/vhost:Reflector/cluster:Y
(hop 3) -> exchange:Global/vhost:B/cluster:Y

Message -> exchange:Global/vhost:A/cluster:X
(hop 1) -> exchange:Global/vhost:Reflector/cluster:X
(hop 2) -> exchange:Global/vhost:C/cluster:X
(hop 3) -> exchange:Global/vhost:Reflector/cluster:X

A useful application is a 'confirm' service: when an object is updated in S3 in a region, is the updated version confirmed to be available from clusters in other regions? There is variable lag in consistency in S3 which can cause problems, yet we want to publish a URL to the object as soon as possible.

To confirm availability, the service publishes a 'poll' message to the global exchange. Agents are listening in an 'admin' vhost in each cluster for this poll and attempt (repetitively if need be) to access the S3 object and check its version. They report back and a consolidated report is returned to the requesting app as JSON.

Here's a sample printed version ? the object was published by me using my mac in NYC to S3 in us-east-1 via the 'confirm' service running in a vhost in my us-east-1 cluster:

Respond Success Tries Elapsed ms Finish/Start

Overall 1385 2012-07-12T19:29:34.488206Z
2012-07-12T19:29:33.103081Z

Put to s3 227 2012-07-12T19:29:33.330069Z
2012-07-12T19:29:33.103081Z

Poll/Response 1158 2012-07-12T19:29:34.488206Z
2012-07-12T19:29:33.330069Z

?us-east-1 true true 1 122 2012-07-12T19:29:33.460626Z
2012-07-12T19:29:33.338701Z

?ap-northeast-1 true true 1 957 2012-07-12T19:29:34.399986Z
2012-07-12T19:29:33.442609Z

?sa-east-1 true true 1 736 2012-07-12T19:29:34.200525Z
2012-07-12T19:29:33.464345Z

?eu-west-1 true true 1 463 2012-07-12T19:29:33.861053Z
2012-07-12T19:29:33.398861Z

?us-west-1 true true 1 404 2012-07-12T19:29:33.788365Z
2012-07-12T19:29:33.384557Z

An advantage of this approach is that I can run the 'confirm' service in any vhost in any cluster and not have to worry about explicitly federating it across my clusters ? I can use this general purpose capability.

We have many similar low-bandwidth general services in mind, e.g. for monitoring. We'll probably upgrade our hosts to Precision Time Service (PTP) to get more accurate timings.

Opportunities for improvement:

. Static configuration is a pain ? my understanding is that this is being remedied. This is most important.
. Lots of 'extra' messages are sent in my scenario ? perhaps this could be optimized. Not too important.
. Federation within a cluster could perhaps be optimized ? actually it is not even documented as a capability. Not too important.

We have some high volume uses as well for which we will use additional, more tailored federated links. However we are finding this general purpose, low volume capability quite useful both in limited practice and as an architectural concept supporting new services.


Michael Laing
NYTimes Media Group
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/e418a70d/attachment.htm>

From matt.sherborne at rackspace.com  Fri Jul 13 17:00:16 2012
From: matt.sherborne at rackspace.com (Matthew Sherborne)
Date: Sat, 14 Jul 2012 02:00:16 +1000
Subject: [rabbitmq-discuss] Bug report for librabbitmq-c client
Message-ID: <CADf4zRL6EOC1o_fOeykse+oD1OjgGSt19RXiVjz9PGEgj0L0og@mail.gmail.com>

Hi guys,

I found a bug in librabbitmq-c client, but wasn't able to get a super
amount of information about it unfortunately.

It appears to be an integer overflow bug.

I had one certain message, and when the client tried to consume it,
it interpreted the message size to be 172 Terra-bytes and proceeded to sit
on socket.recv forever. The actual message size was between 1-2 MB.

I tested it with the trunk of the lib as of a few days ago.

I could re-produce the error with 3 different librabbitmq-c based client
libraries:

 * python kombu
 * c++ amqpcpp/AMQPcpp.h
 * c++ SimpleAmqpClient

I tested against the rabbit mq broker 1.8.1 and 2.8.4.

Unfortunately, I switched to py-amqplib and it ate the message that was
causing the error, so I don't have that test data anymore :*(

Here are some fun tracebacks, but they're not where it reads the size;
they're just where it's sitting trying to read a kagillion bytes:

http://pastebin.com/m1JPPSHw
http://pastebin.com/A6CZMDvj
http://pastebin.com/qQmjGD4Y
http://pastebin.com/DBZuUin5

I think the way to find the bug would be to compile with CMAKE_C_FLAGS
               -Wconversion

there's a lot of warnings coming out, I tried a few changes myself, but
couldn't fix the darn thing.

I hope this is useful to someone who knows the code better.

Let me know if I can help answer any Qs.

Kind Regards
Matthew Sherborne
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120714/dc21d557/attachment.htm>

From francesco at rabbitmq.com  Fri Jul 13 17:23:30 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 13 Jul 2012 17:23:30 +0100
Subject: [rabbitmq-discuss] Bug report for librabbitmq-c client
In-Reply-To: <CADf4zRL6EOC1o_fOeykse+oD1OjgGSt19RXiVjz9PGEgj0L0og@mail.gmail.com>
References: <CADf4zRL6EOC1o_fOeykse+oD1OjgGSt19RXiVjz9PGEgj0L0og@mail.gmail.com>
Message-ID: <87liinpr3x.wl%francesco@rabbitmq.com>

I haven't read your message in full, but since rabbitmq-c is not an official
client you'll probably have more luck reporting the bug on github:
https://github.com/alanxz/rabbitmq-c
--
Francesco * Often in error, never in doubt

From parkerconrad at gmail.com  Fri Jul 13 18:42:18 2012
From: parkerconrad at gmail.com (Parker Conrad)
Date: Fri, 13 Jul 2012 10:42:18 -0700
Subject: [rabbitmq-discuss] Shovel can't establish connection
In-Reply-To: <87zk7540yh.wl%francesco@rabbitmq.com>
References: <CAEbZLp+cC-5KeoD71wAtA04b5qnoD7X0ABUp8fAkniNCJYwu8Q@mail.gmail.com>
	<87zk7540yh.wl%francesco@rabbitmq.com>
Message-ID: <CAEbZLpJUBMKMmJLGyBHzWr02bJi6iOP0oPrQLmEiXLU_fVZdBQ@mail.gmail.com>

Hey guys - thanks everyone for your help. Thought I'd update the list with
resolution, in case others have the same problem and are searching the list
archives. There were two different dumb things I was doing.

The first (REALLY dumb) was that I had stopped and started one of my EC2
instance and the DNS / IP had changed. Make sure you've got elastic IPs set
up so that the IP address isn't changing on you.

After that, I was still getting timeout errors with Shovel. The issue was
that I had to open up port 5672 on windows firewall on my windows server.
Remember that, for windows servers on EC2, there are effectively
two separate places that access is locked down -- EC2 security groups and
windows firewall; both need to be configured to allow access on 5672.

/prc

On Thu, Jul 12, 2012 at 5:29 AM, Francesco Mazzoli
<francesco at rabbitmq.com>wrote:

> Hi Parker,
> At Wed, 11 Jul 2012 19:42:27 -0700,
> Parker Conrad wrote:
> > Here's the error I get when I check on Shovel's status:
> >
> > sudo rabbitmqctl eval 'rabbit_shovel_status:status().'
> > [{scrape_request_shovel,
> >      {terminated,
> >          {{badmatch,{error,access_refused}},
> >           [{rabbit_shovel_worker,make_conn_and_chan,1},
> >            {rabbit_shovel_worker,handle_cast,2},
> >            {gen_server2,handle_msg,2},
> >            {proc_lib,init_p_do_apply,3}]}},
> >      {{2012,7,12},{2,7,30}}}]
> > ...done.
>
> It looks like the authentication is failing. Could you double check that
> the
> credentials you configured shovel with are correct? The logs on the broker
> will
> help understanding what's going on. Also, don't forget to tell us what
> version
> of rabbit you are using when posting to the mailing list.
>
> --
> Francesco * Often in error, never in doubt
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/0cf24d5a/attachment.htm>

From matthias at rabbitmq.com  Fri Jul 13 19:46:35 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 13 Jul 2012 19:46:35 +0100
Subject: [rabbitmq-discuss] Failure starting up after power pulled from
 machine
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD7903874224E47@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD790385F1CB0DC@vmexchange02.seegrid.local>,
	<4FF1930C.6020702@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD790385F1CB622@vmexchange02.seegrid.local>,
	<4FF1B16F.5060504@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD7903874224E47@vmexchange02.seegrid.local>
Message-ID: <50006D0B.4070703@rabbitmq.com>

On 13/07/12 18:59, Elizabeth Liao wrote:
> We can consistently reproduce this problem by pulling the power.
> Attached are the logs from the $RABBITMQ_MNESIA_BASE dir
> (home/rabbit/db) and  /var/log/rabbitmq.  We are running RabbitMQ
> 2.8.2 on  FC 11.  Hopefully, you don't mind that I sent this directly
> to you. I felt uncomfortable sending this out to the mailing list
> since it I wasn't sure how to make all the logs anonymous.

No problem. I am putting the list back on cc...

A few questions:

- the .tar.gz looks a bit odd in that all the files in it are themselves 
compressed. Please confirm that you did that yourself and just for 
sending me the data - if the filesystem actually had all the files 
compressed then things would certainly go wrong.

- there appear to be *two* mnesia base dirs - one in 
/var/lib/rabbitmq/mnesia, and one in /home/rabbit/db. Which one are you 
using? I suspect it's the latter since it has more recent timestamps.

- with the exact mnesia dirs you sent, what error do you get when 
starting rabbit?


Matthias

From matthias at rabbitmq.com  Fri Jul 13 20:06:44 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 13 Jul 2012 20:06:44 +0100
Subject: [rabbitmq-discuss] Failure starting up after power pulled from
 machine
In-Reply-To: <50006D0B.4070703@rabbitmq.com>
References: <E94F626F5C43D14F8B8479C5EBD790385F1CB0DC@vmexchange02.seegrid.local>,
	<4FF1930C.6020702@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD790385F1CB622@vmexchange02.seegrid.local>,
	<4FF1B16F.5060504@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD7903874224E47@vmexchange02.seegrid.local>
	<50006D0B.4070703@rabbitmq.com>
Message-ID: <500071C4.5060300@rabbitmq.com>

On 13/07/12 19:46, Matthias Radestock wrote:
> - with the exact mnesia dirs you sent, what error do you get when
> starting rabbit?

fwiw, I get *no* errors when starting rabbit with the data you sent me. 
It happily recovers a whole bunch of queues, exchanges, bindings and 
messages.

Regards,

Matthias.

From michael.kempe at googlemail.com  Fri Jul 13 12:20:26 2012
From: michael.kempe at googlemail.com (Micha)
Date: Fri, 13 Jul 2012 04:20:26 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ C# Client - Dispose() hangs
Message-ID: <d67e92d9-32b8-43b4-8b4d-0a153c5565e8@googlegroups.com>

Hello everybody,
 
when hosting the RabbitMQClient in a Winform and call .Dispose() and 
subscribe to an Exchange my Winform hangs. After checking, I investigated 
that the a call in ShutdownContinuation.Wait()  caused to hang in 
BlockingCell.Value -> Monitor.Wait(this); and never returns.
Can anybody help me to solve my problem. What can be the reason for this.
 
Thanks in advance.
 
Micha
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120713/07586949/attachment.htm>

From vijjivinay at gmail.com  Sat Jul 14 15:35:26 2012
From: vijjivinay at gmail.com (Vijay Lakshmi)
Date: Sat, 14 Jul 2012 20:05:26 +0530
Subject: [rabbitmq-discuss] RabbitMQ Client 2.7.1 Memory Leak?
Message-ID: <CAHPrJT1spJk_tECuv4ZvBH3gd3PkQ-O6=37uyi_x73GpaxrJsg@mail.gmail.com>

Hi,

We are using RabbitMQ 2.7.1 Java Client and Server 2.7.1.
While we were running load tests using our clients we observed that our
memory has reached to 2GB.

Below is the snapshot of heap analysis.

We are closing the channels properly using channel.close().
Could someone suggest what could be the problem for this memory leak. Do
the later versions of RabbitMQ solve this problem?


Instance Counts for All Classes (excluding platform)

311681 instances<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c6f06a0>
 of class com.rabbitmq.client.impl.AMQCommand<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c6f06a0>

311681 instances<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c6f3228>
 of class com.rabbitmq.client.impl.CommandAssembler<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c6f3228>

295730 instances<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d438380>
 of class com.rabbitmq.client.impl.ChannelN<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d438380>

295730 instances<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d43ff30>
 of class com.rabbitmq.client.impl.ConsumerDispatcher<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d43ff30>

295715 instances<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c60b280>
 of class com.rabbitmq.client.ShutdownSignalException<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c60b280>

295703 instances<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c75a540>
 of class com.rabbitmq.client.impl.AMQImpl$Channel$Close<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c75a540>

271315 instances<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4d5590>
 of class com.rabbitmq.client.QueueingConsumer<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4d5590>

60523 instances<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77cea18a0>
 of class org.json.simple.parser.Yytoken<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77cea18a0>

31600 instances<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c73fa58>
 of class com.rabbitmq.client.AMQP$BasicProperties<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c73fa58>

31210 instances<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4d7358>
 of class com.rabbitmq.client.QueueingConsumer$Delivery<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4d7358>

31209 instances<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4dc1d0>
 of class com.rabbitmq.client.Envelope<redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4dc1d0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120714/53264700/attachment.htm>

From jerryk at rbcon.com  Sat Jul 14 17:26:31 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Sat, 14 Jul 2012 09:26:31 -0700
Subject: [rabbitmq-discuss] RabbitMQ Client 2.7.1 Memory Leak?
In-Reply-To: <CAHPrJT1spJk_tECuv4ZvBH3gd3PkQ-O6=37uyi_x73GpaxrJsg@mail.gmail.com>
References: <CAHPrJT1spJk_tECuv4ZvBH3gd3PkQ-O6=37uyi_x73GpaxrJsg@mail.gmail.com>
Message-ID: <CAE0Sz=yJi7Zv8DbUw4eLNvNjF4LkQw8CdaKS96+D_CLp+yJ40g@mail.gmail.com>

Hi, Vijay:

You may want to upgrade from 2.7.1.  The 2.7.1 Java client had a known and
now fixed memory leak that might account for what you're seeing:

https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723

Best regards,
Jerry

On Sat, Jul 14, 2012 at 7:35 AM, Vijay Lakshmi <vijjivinay at gmail.com> wrote:

> Hi,
>
> We are using RabbitMQ 2.7.1 Java Client and Server 2.7.1.
> While we were running load tests using our clients we observed that our
> memory has reached to 2GB.
>
> Below is the snapshot of heap analysis.
>
> We are closing the channels properly using channel.close().
> Could someone suggest what could be the problem for this memory leak. Do
> the later versions of RabbitMQ solve this problem?
>
>
> Instance Counts for All Classes (excluding platform)
>
> 311681 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c6f06a0>
>  of class com.rabbitmq.client.impl.AMQCommand<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c6f06a0>
>
> 311681 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c6f3228>
>  of class com.rabbitmq.client.impl.CommandAssembler<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c6f3228>
>
> 295730 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d438380>
>  of class com.rabbitmq.client.impl.ChannelN<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d438380>
>
> 295730 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d43ff30>
>  of class com.rabbitmq.client.impl.ConsumerDispatcher<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d43ff30>
>
> 295715 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c60b280>
>  of class com.rabbitmq.client.ShutdownSignalException<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c60b280>
>
> 295703 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c75a540>
>  of class com.rabbitmq.client.impl.AMQImpl$Channel$Close<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c75a540>
>
> 271315 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4d5590>
>  of class com.rabbitmq.client.QueueingConsumer<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4d5590>
>
> 60523 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77cea18a0>
>  of class org.json.simple.parser.Yytoken<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77cea18a0>
>
> 31600 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c73fa58>
>  of class com.rabbitmq.client.AMQP$BasicProperties<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c73fa58>
>
> 31210 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4d7358>
>  of class com.rabbitmq.client.QueueingConsumer$Delivery<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4d7358>
>
> 31209 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4dc1d0>
>  of class com.rabbitmq.client.Envelope<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4dc1d0>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120714/c73be504/attachment.htm>

From vijjivinay at gmail.com  Sat Jul 14 21:00:03 2012
From: vijjivinay at gmail.com (Vijay Lakshmi)
Date: Sun, 15 Jul 2012 01:30:03 +0530
Subject: [rabbitmq-discuss] RabbitMQ Client 2.7.1 Memory Leak?
In-Reply-To: <CAE0Sz=yJi7Zv8DbUw4eLNvNjF4LkQw8CdaKS96+D_CLp+yJ40g@mail.gmail.com>
References: <CAHPrJT1spJk_tECuv4ZvBH3gd3PkQ-O6=37uyi_x73GpaxrJsg@mail.gmail.com>
	<CAE0Sz=yJi7Zv8DbUw4eLNvNjF4LkQw8CdaKS96+D_CLp+yJ40g@mail.gmail.com>
Message-ID: <CAHPrJT1GHsoPYL4DHR5sp3TnD=oeOogOtZAUxNQHE0cK0YcSMg@mail.gmail.com>

Hi Jerry,

Thanks for the response.
I can not browse the bug 24723 (it says access denied), can you please
provide the details.

Regards,
Vinay

On Sat, Jul 14, 2012 at 9:56 PM, Jerry Kuch <jerryk at rbcon.com> wrote:

> Hi, Vijay:
>
> You may want to upgrade from 2.7.1.  The 2.7.1 Java client had a known and
> now fixed memory leak that might account for what you're seeing:
>
> https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723
>
> Best regards,
> Jerry
>
> On Sat, Jul 14, 2012 at 7:35 AM, Vijay Lakshmi <vijjivinay at gmail.com>wrote:
>
>> Hi,
>>
>> We are using RabbitMQ 2.7.1 Java Client and Server 2.7.1.
>> While we were running load tests using our clients we observed that our
>> memory has reached to 2GB.
>>
>> Below is the snapshot of heap analysis.
>>
>> We are closing the channels properly using channel.close().
>> Could someone suggest what could be the problem for this memory leak. Do
>> the later versions of RabbitMQ solve this problem?
>>
>>
>> Instance Counts for All Classes (excluding platform)
>>
>> 311681 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c6f06a0>
>>  of class com.rabbitmq.client.impl.AMQCommand<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c6f06a0>
>>
>> 311681 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c6f3228>
>>  of class com.rabbitmq.client.impl.CommandAssembler<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c6f3228>
>>
>> 295730 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d438380>
>>  of class com.rabbitmq.client.impl.ChannelN<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d438380>
>>
>> 295730 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d43ff30>
>>  of class com.rabbitmq.client.impl.ConsumerDispatcher<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d43ff30>
>>
>> 295715 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c60b280>
>>  of class com.rabbitmq.client.ShutdownSignalException<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c60b280>
>>
>> 295703 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c75a540>
>>  of class com.rabbitmq.client.impl.AMQImpl$Channel$Close<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c75a540>
>>
>> 271315 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4d5590>
>>  of class com.rabbitmq.client.QueueingConsumer<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4d5590>
>>
>> 60523 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77cea18a0>
>>  of class org.json.simple.parser.Yytoken<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77cea18a0>
>>
>> 31600 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c73fa58>
>>  of class com.rabbitmq.client.AMQP$BasicProperties<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c73fa58>
>>
>> 31210 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4d7358>
>>  of class com.rabbitmq.client.QueueingConsumer$Delivery<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4d7358>
>>
>> 31209 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4dc1d0>
>>  of class com.rabbitmq.client.Envelope<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4dc1d0>
>>
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120715/d24c2ef3/attachment.htm>

From jerryk at rbcon.com  Sat Jul 14 21:32:23 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Sat, 14 Jul 2012 13:32:23 -0700
Subject: [rabbitmq-discuss] RabbitMQ Client 2.7.1 Memory Leak?
In-Reply-To: <CAHPrJT1GHsoPYL4DHR5sp3TnD=oeOogOtZAUxNQHE0cK0YcSMg@mail.gmail.com>
References: <CAHPrJT1spJk_tECuv4ZvBH3gd3PkQ-O6=37uyi_x73GpaxrJsg@mail.gmail.com>
	<CAE0Sz=yJi7Zv8DbUw4eLNvNjF4LkQw8CdaKS96+D_CLp+yJ40g@mail.gmail.com>
	<CAHPrJT1GHsoPYL4DHR5sp3TnD=oeOogOtZAUxNQHE0cK0YcSMg@mail.gmail.com>
Message-ID: <CAE0Sz=yDr7apk3s99Y7P4JBHXoPn7PLZZYN1dbELgo53a-xa0w@mail.gmail.com>

Hi, Vijay:

Initial segment of the discussion from the bug pasted here:

Steve Powell <steve at rabbitmq.com> 2012-02-01 10:41:32 GMT

See link, main part here:

public static void main(String[] argv) throws IOException {
   ConnectionFactory f = new ConnectionFactory();
   Connection c = f.newConnection();
   for(int i = 0; i < 20000; ++i) {
       Channel ch = c.createChannel();
       ch.close();
   }
   System.gc();
   while(true) {}
}

While program is running, observe the memory usage, it keeps on increasing

Get process id and do following
jmap -dump:format=b,file=yo.bin  <pid>
jhat jhat -J-mx768m -stack false yo.bin
Once jhat brings up http server, go
herehttp://localhost:7000/showInstanceCounts/

20001 instances of class com.rabbitmq.client.impl.AMQCommand
20001 instances of class com.rabbitmq.client.impl.CommandAssembler
20000 instances of class com.rabbitmq.client.ShutdownSignalException
20000 instances of class com.rabbitmq.client.impl.AMQImpl$Channel$Close
20000 instances of class com.rabbitmq.client.impl.ChannelN
20000 instances of class com.rabbitmq.client.impl.ConsumerDispatcher

[reply <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#add_comment>]
[-] <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#>Comment
1<https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#c1>Steve
Powell <steve at rabbitmq.com> 2012-02-01 11:09:17 GMT

(In reply to comment #0
<https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#c0>)

Ran sample test main under debug, and found the WorkPool in the
ConsumerWorkService contains all the AMQChannel objects!

[reply <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#add_comment>]
[-] <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#>Comment
2<https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#c2>Steve
Powell <steve at rabbitmq.com> 2012-02-01 11:58:46 GMT

Problem is we never issue stopWork(channel) on the ConsumerWorkService.  This
means that the stuff in the WorkPool stays there.

Difficulty is that issuing this too early may mean that the last pieces of work
to be executed for a channel may be chopped.  We may need to have a thread that
runs after channel.close() to tidy up when the last piece of work for that
channel is finished.  This is only necessary if there is work in the pool for
that channel, otherwise we may simply stop work immediately.

Solution -- check WorkPool for work -- if there is none, there won't be any
more later.  stopWork() and that's it.

If there is some work to be done, then schedule some more work which
automatically removes the channel from the work pool.

[reply <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#add_comment>]
[-] <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#>Comment
3<https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#c3>Steve
Powell <steve at rabbitmq.com> 2012-02-01 14:59:50 GMT

(In reply to comment #2
<https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#c2>)> Solution --
check WorkPool for work -- if there is none, there won't be any
> more later.  stopWork() and that's it.
> If there is some work to be done, then schedule some more work which
> automatically removes the channel from the work pool.

Actually, no, better is to hook into broadcastShutdownSignal() which calls
handleShutdownSignal even if there are no consumers.  handleShutdownSignal()
can remove the work from the queue as it's last act.

[reply <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#add_comment>]
[-] <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#>Comment
4<https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#c4>Steve
Powell <steve at rabbitmq.com> 2012-02-01 15:15:41 GMT

Changeset http://hg.rabbitmq.com/rabbitmq-java-client/rev/0d949ba17115

Stop channel consumer work pool after channel.close()

[reply <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#add_comment>]
[-] <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#>Comment
5<https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#c5>Steve
Powell <steve at rabbitmq.com> 2012-02-01 15:48:04 GMT

Repeating tests for java client -- all appears well;
Reproducing debug run -- all appears cleared up;
Running jmap and jhat as shown -- we get lots of unresolved instance references
when running jhat (?), and shows:

10 instances of class
com.rabbitmq.client.impl.LongStringHelper$ByteArrayLongString
4 instances of class com.rabbitmq.client.impl.CommandAssembler$CAState
2 instances of class com.rabbitmq.client.DefaultSaslConfig

at top of instance counts list.

It looks fixed.



On Sat, Jul 14, 2012 at 1:00 PM, Vijay Lakshmi <vijjivinay at gmail.com> wrote:

> Hi Jerry,
>
> Thanks for the response.
> I can not browse the bug 24723 (it says access denied), can you please
> provide the details.
>
> Regards,
> Vinay
>
> On Sat, Jul 14, 2012 at 9:56 PM, Jerry Kuch <jerryk at rbcon.com> wrote:
>
>> Hi, Vijay:
>>
>> You may want to upgrade from 2.7.1.  The 2.7.1 Java client had a known
>> and now fixed memory leak that might account for what you're seeing:
>>
>> https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723
>>
>> Best regards,
>> Jerry
>>
>> On Sat, Jul 14, 2012 at 7:35 AM, Vijay Lakshmi <vijjivinay at gmail.com>wrote:
>>
>>> Hi,
>>>
>>> We are using RabbitMQ 2.7.1 Java Client and Server 2.7.1.
>>> While we were running load tests using our clients we observed that our
>>> memory has reached to 2GB.
>>>
>>> Below is the snapshot of heap analysis.
>>>
>>> We are closing the channels properly using channel.close().
>>> Could someone suggest what could be the problem for this memory leak. Do
>>> the later versions of RabbitMQ solve this problem?
>>>
>>>
>>> Instance Counts for All Classes (excluding platform)
>>>
>>> 311681 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c6f06a0>
>>>  of class com.rabbitmq.client.impl.AMQCommand<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c6f06a0>
>>>
>>> 311681 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c6f3228>
>>>  of class com.rabbitmq.client.impl.CommandAssembler<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c6f3228>
>>>
>>> 295730 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d438380>
>>>  of class com.rabbitmq.client.impl.ChannelN<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d438380>
>>>
>>> 295730 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d43ff30>
>>>  of class com.rabbitmq.client.impl.ConsumerDispatcher<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d43ff30>
>>>
>>> 295715 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c60b280>
>>>  of class com.rabbitmq.client.ShutdownSignalException<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c60b280>
>>>
>>> 295703 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c75a540>
>>>  of class com.rabbitmq.client.impl.AMQImpl$Channel$Close<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c75a540>
>>>
>>> 271315 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4d5590>
>>>  of class com.rabbitmq.client.QueueingConsumer<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4d5590>
>>>
>>> 60523 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77cea18a0>
>>>  of class org.json.simple.parser.Yytoken<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77cea18a0>
>>>
>>> 31600 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c73fa58>
>>>  of class com.rabbitmq.client.AMQP$BasicProperties<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c73fa58>
>>>
>>> 31210 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4d7358>
>>>  of class com.rabbitmq.client.QueueingConsumer$Delivery<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4d7358>
>>>
>>> 31209 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4dc1d0>
>>>  of class com.rabbitmq.client.Envelope<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4dc1d0>
>>>
>>>
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120714/67074802/attachment.htm>

From rotemtamir at gmail.com  Sat Jul 14 11:52:30 2012
From: rotemtamir at gmail.com (Rotem Tamir)
Date: Sat, 14 Jul 2012 03:52:30 -0700 (PDT)
Subject: [rabbitmq-discuss] error while installing RabbitMQ from your APT
	repo
Message-ID: <f595f5c4-4bfb-4cd6-9d57-19945bbdefec@googlegroups.com>

Hi 

I used the method described here:
http://www.rabbitmq.com/install-debian.html 

to try and install rabbitmq.

I get this error:
/usr/lib/erlang/erts-5.9.1/bin/beam: /usr/lib/libz.so.1: version 
`ZLIB_1.2.3.3' not found (required by /usr/lib/erlang/erts-5.9.1/bin/beam)


What should I do?

Rotem Tamir
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120714/a3f1e7d4/attachment.htm>

From vijjivinay at gmail.com  Sat Jul 14 22:04:38 2012
From: vijjivinay at gmail.com (Vijay Lakshmi)
Date: Sun, 15 Jul 2012 02:34:38 +0530
Subject: [rabbitmq-discuss] RabbitMQ Client 2.7.1 Memory Leak?
In-Reply-To: <CAE0Sz=yDr7apk3s99Y7P4JBHXoPn7PLZZYN1dbELgo53a-xa0w@mail.gmail.com>
References: <CAHPrJT1spJk_tECuv4ZvBH3gd3PkQ-O6=37uyi_x73GpaxrJsg@mail.gmail.com>
	<CAE0Sz=yJi7Zv8DbUw4eLNvNjF4LkQw8CdaKS96+D_CLp+yJ40g@mail.gmail.com>
	<CAHPrJT1GHsoPYL4DHR5sp3TnD=oeOogOtZAUxNQHE0cK0YcSMg@mail.gmail.com>
	<CAE0Sz=yDr7apk3s99Y7P4JBHXoPn7PLZZYN1dbELgo53a-xa0w@mail.gmail.com>
Message-ID: <CAHPrJT0vajE2b7DCVOugRLfDhtjs=GCcQ1cnTterciSAkHUScg@mail.gmail.com>

Thanks Jerry!
In which version it is fixed, can you please let me know.

Also, how do we get permission to see the bug details.

Regards,
Vinay

On Sun, Jul 15, 2012 at 2:02 AM, Jerry Kuch <jerryk at rbcon.com> wrote:

> Hi, Vijay:
>
> Initial segment of the discussion from the bug pasted here:
>
> Steve Powell <steve at rabbitmq.com> 2012-02-01 10:41:32 GMT
>
> See link, main part here:
>
> public static void main(String[] argv) throws IOException {
>    ConnectionFactory f = new ConnectionFactory();
>    Connection c = f.newConnection();
>    for(int i = 0; i < 20000; ++i) {
>        Channel ch = c.createChannel();
>        ch.close();
>    }
>    System.gc();
>    while(true) {}
> }
>
> While program is running, observe the memory usage, it keeps on increasing
>
> Get process id and do following
> jmap -dump:format=b,file=yo.bin  <pid>
> jhat jhat -J-mx768m -stack false yo.bin
> Once jhat brings up http server, go herehttp://localhost:7000/showInstanceCounts/
>
> 20001 instances of class com.rabbitmq.client.impl.AMQCommand
> 20001 instances of class com.rabbitmq.client.impl.CommandAssembler
> 20000 instances of class com.rabbitmq.client.ShutdownSignalException
> 20000 instances of class com.rabbitmq.client.impl.AMQImpl$Channel$Close
> 20000 instances of class com.rabbitmq.client.impl.ChannelN
> 20000 instances of class com.rabbitmq.client.impl.ConsumerDispatcher
>
> [reply <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#add_comment>]
> [-] <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#>Comment 1<https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#c1>Steve
> Powell <steve at rabbitmq.com> 2012-02-01 11:09:17 GMT
>
> (In reply to comment #0 <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#c0>)
>
> Ran sample test main under debug, and found the WorkPool in the
> ConsumerWorkService contains all the AMQChannel objects!
>
> [reply <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#add_comment>]
> [-] <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#>Comment 2<https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#c2>Steve
> Powell <steve at rabbitmq.com> 2012-02-01 11:58:46 GMT
>
> Problem is we never issue stopWork(channel) on the ConsumerWorkService.  This
> means that the stuff in the WorkPool stays there.
>
> Difficulty is that issuing this too early may mean that the last pieces of work
> to be executed for a channel may be chopped.  We may need to have a thread that
> runs after channel.close() to tidy up when the last piece of work for that
> channel is finished.  This is only necessary if there is work in the pool for
> that channel, otherwise we may simply stop work immediately.
>
> Solution -- check WorkPool for work -- if there is none, there won't be any
> more later.  stopWork() and that's it.
>
> If there is some work to be done, then schedule some more work which
> automatically removes the channel from the work pool.
>
> [reply <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#add_comment>]
> [-] <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#>Comment 3<https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#c3>Steve
> Powell <steve at rabbitmq.com> 2012-02-01 14:59:50 GMT
>
> (In reply to comment #2 <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#c2>)> Solution -- check WorkPool for work -- if there is none, there won't be any
> > more later.  stopWork() and that's it.
> > If there is some work to be done, then schedule some more work which
> > automatically removes the channel from the work pool.
>
> Actually, no, better is to hook into broadcastShutdownSignal() which calls
> handleShutdownSignal even if there are no consumers.  handleShutdownSignal()
> can remove the work from the queue as it's last act.
>
> [reply <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#add_comment>]
> [-] <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#>Comment 4<https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#c4>Steve
> Powell <steve at rabbitmq.com> 2012-02-01 15:15:41 GMT
>
> Changeset http://hg.rabbitmq.com/rabbitmq-java-client/rev/0d949ba17115
>
> Stop channel consumer work pool after channel.close()
>
> [reply <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#add_comment>]
> [-] <https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#>Comment 5<https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723#c5>Steve
> Powell <steve at rabbitmq.com> 2012-02-01 15:48:04 GMT
>
> Repeating tests for java client -- all appears well;
> Reproducing debug run -- all appears cleared up;
> Running jmap and jhat as shown -- we get lots of unresolved instance references
> when running jhat (?), and shows:
>
> 10 instances of class
> com.rabbitmq.client.impl.LongStringHelper$ByteArrayLongString
> 4 instances of class com.rabbitmq.client.impl.CommandAssembler$CAState
> 2 instances of class com.rabbitmq.client.DefaultSaslConfig
>
> at top of instance counts list.
>
> It looks fixed.
>
>
>
> On Sat, Jul 14, 2012 at 1:00 PM, Vijay Lakshmi <vijjivinay at gmail.com>wrote:
>
>> Hi Jerry,
>>
>> Thanks for the response.
>> I can not browse the bug 24723 (it says access denied), can you please
>> provide the details.
>>
>> Regards,
>> Vinay
>>
>> On Sat, Jul 14, 2012 at 9:56 PM, Jerry Kuch <jerryk at rbcon.com> wrote:
>>
>>> Hi, Vijay:
>>>
>>> You may want to upgrade from 2.7.1.  The 2.7.1 Java client had a known
>>> and now fixed memory leak that might account for what you're seeing:
>>>
>>> https://bugzilla.rabbitmq.com/show_bug.cgi?id=24723
>>>
>>> Best regards,
>>> Jerry
>>>
>>> On Sat, Jul 14, 2012 at 7:35 AM, Vijay Lakshmi <vijjivinay at gmail.com>wrote:
>>>
>>>> Hi,
>>>>
>>>> We are using RabbitMQ 2.7.1 Java Client and Server 2.7.1.
>>>> While we were running load tests using our clients we observed that our
>>>> memory has reached to 2GB.
>>>>
>>>> Below is the snapshot of heap analysis.
>>>>
>>>> We are closing the channels properly using channel.close().
>>>> Could someone suggest what could be the problem for this memory leak.
>>>> Do the later versions of RabbitMQ solve this problem?
>>>>
>>>>
>>>> Instance Counts for All Classes (excluding platform)
>>>>
>>>> 311681 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c6f06a0>
>>>>  of class com.rabbitmq.client.impl.AMQCommand<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c6f06a0>
>>>>
>>>> 311681 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c6f3228>
>>>>  of class com.rabbitmq.client.impl.CommandAssembler<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c6f3228>
>>>>
>>>> 295730 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d438380>
>>>>  of class com.rabbitmq.client.impl.ChannelN<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d438380>
>>>>
>>>> 295730 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d43ff30>
>>>>  of class com.rabbitmq.client.impl.ConsumerDispatcher<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d43ff30>
>>>>
>>>> 295715 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c60b280>
>>>>  of class com.rabbitmq.client.ShutdownSignalException<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c60b280>
>>>>
>>>> 295703 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c75a540>
>>>>  of class com.rabbitmq.client.impl.AMQImpl$Channel$Close<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c75a540>
>>>>
>>>> 271315 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4d5590>
>>>>  of class com.rabbitmq.client.QueueingConsumer<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4d5590>
>>>>
>>>> 60523 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77cea18a0>
>>>>  of class org.json.simple.parser.Yytoken<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77cea18a0>
>>>>
>>>> 31600 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77c73fa58>
>>>>  of class com.rabbitmq.client.AMQP$BasicProperties<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77c73fa58>
>>>>
>>>> 31210 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4d7358>
>>>>  of class com.rabbitmq.client.QueueingConsumer$Delivery<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4d7358>
>>>>
>>>> 31209 instances<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2finstances%2f0x77d4dc1d0>
>>>>  of class com.rabbitmq.client.Envelope<http://redir.aspx?C=dba9a335a30e4feb822ceaa30de7f654&URL=http%3a%2f%2flocalhost%3a7000%2fclass%2f0x77d4dc1d0>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120715/dc8122ab/attachment.htm>

From matthias at rabbitmq.com  Sat Jul 14 23:57:58 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 14 Jul 2012 23:57:58 +0100
Subject: [rabbitmq-discuss] RabbitMQ Client 2.7.1 Memory Leak?
In-Reply-To: <CAHPrJT0vajE2b7DCVOugRLfDhtjs=GCcQ1cnTterciSAkHUScg@mail.gmail.com>
References: <CAHPrJT1spJk_tECuv4ZvBH3gd3PkQ-O6=37uyi_x73GpaxrJsg@mail.gmail.com>
	<CAE0Sz=yJi7Zv8DbUw4eLNvNjF4LkQw8CdaKS96+D_CLp+yJ40g@mail.gmail.com>
	<CAHPrJT1GHsoPYL4DHR5sp3TnD=oeOogOtZAUxNQHE0cK0YcSMg@mail.gmail.com>
	<CAE0Sz=yDr7apk3s99Y7P4JBHXoPn7PLZZYN1dbELgo53a-xa0w@mail.gmail.com>
	<CAHPrJT0vajE2b7DCVOugRLfDhtjs=GCcQ1cnTterciSAkHUScg@mail.gmail.com>
Message-ID: <5001F976.50804@rabbitmq.com>

Vinay,

On 14/07/12 22:04, Vijay Lakshmi wrote:
> In which version it is fixed, can you please let me know.

2.8.0, though you really should upgrade to the latest.

> Also, how do we get permission to see the bug details.

You can't.

Matthias.

From gray at mix.wvu.edu  Sun Jul 15 04:03:46 2012
From: gray at mix.wvu.edu (George)
Date: Sat, 14 Jul 2012 20:03:46 -0700 (PDT)
Subject: [rabbitmq-discuss] ConnectionFactory Class not found in Java
Message-ID: <ffec150e-a50d-4fa6-8cda-14281cdfbed8@googlegroups.com>

I am attempting to run a Java class I developed called Send to publish 
messages. It breaks on creating a connection. This is on a Windows server 
with the RabbitMQ service running successfully - I can use it fine with 
Node. 

Here is my Java compile statement:
C:\java>javac -classpath 
commons-io-1.2.jar;commons-cli-1.1.jar;junit.jar;rabbitmq-client.jar;rabbitmq-client-tests.jar 
Send.java

Here is the code
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.*;

public class Send {

  public static void main(String[] argv) throws Exception {

      ConnectionFactory factory = new ConnectionFactory();

  }
}

Here are the results
C:\java>java Send
Exception in thread "main" java.lang.NoClassDefFoundError: 
com/rabbitmq/client/ConnectionFactory
        at Send.main(Send.java:10)
Caused by: java.lang.ClassNotFoundException: 
com.rabbitmq.client.ConnectionFactory
        at java.net.URLClassLoader$1.run(Unknown Source)
        at java.net.URLClassLoader$1.run(Unknown Source)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(Unknown Source)
        at java.lang.ClassLoader.loadClass(Unknown Source)
        at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source)
        at java.lang.ClassLoader.loadClass(Unknown Source)

Has anyone encountered and resolved this issue? Two thoughts I have are 
ConnectionFactory is dependent on classes not in my compile command and 
that ConnectionFactory has no parameter-less definitions. 

Thanks for any help,

George


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120714/96f6166b/attachment.htm>

From watson.timothy at gmail.com  Sun Jul 15 12:25:35 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Sun, 15 Jul 2012 12:25:35 +0100
Subject: [rabbitmq-discuss] RabbitMQ C# Client - Dispose() hangs
In-Reply-To: <d67e92d9-32b8-43b4-8b4d-0a153c5565e8@googlegroups.com>
References: <d67e92d9-32b8-43b4-8b4d-0a153c5565e8@googlegroups.com>
Message-ID: <E52322B3-CB83-40F6-9EA5-850F8AA04F32@rabbitmq.com>

Hi Micha

On 13 Jul 2012, at 12:20, Micha <michael.kempe at googlemail.com> wrote:

> Hello everybody,
> 
> when hosting the RabbitMQClient in a Winform and call .Dispose() and

You mean adding the client as a member variable? On what object are you calling dispose, the form or the client instance?

> subscribe to an Exchange my Winform hangs. After checking, I

Well after you have called dispose you shouldn't be using an object. I don't really understand what you find unexpected about this?

> investigated that the a call in ShutdownContinuation.Wait()  caused to hang in BlockingCell.Value -> Monitor.Wait(this); and never returns.
> Can anybody help me to solve my problem. What can be the reason for this.
> 
> Thanks in advance.
> 
> Micha
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From gray at mix.wvu.edu  Sun Jul 15 12:32:09 2012
From: gray at mix.wvu.edu (George)
Date: Sun, 15 Jul 2012 04:32:09 -0700 (PDT)
Subject: [rabbitmq-discuss] ConnectionFactory Class not found in Java
In-Reply-To: <ffec150e-a50d-4fa6-8cda-14281cdfbed8@googlegroups.com>
References: <ffec150e-a50d-4fa6-8cda-14281cdfbed8@googlegroups.com>
Message-ID: <6945fada-dcc8-4945-8ef1-11f5c6d7b7f7@googlegroups.com>

I resolved the issue. It needed the -classpath option on the java run 
command also. 

On Saturday, July 14, 2012 8:03:46 PM UTC-7, George wrote:
>
> I am attempting to run a Java class I developed called Send to publish 
> messages. It breaks on creating a connection. This is on a Windows server 
> with the RabbitMQ service running successfully - I can use it fine with 
> Node. 
>
> Here is my Java compile statement:
> C:\java>javac -classpath 
> commons-io-1.2.jar;commons-cli-1.1.jar;junit.jar;rabbitmq-client.jar;rabbitmq-client-tests.jar 
> Send.java
>
> Here is the code
> import com.rabbitmq.client.ConnectionFactory;
> import com.rabbitmq.client.Connection;
> import com.rabbitmq.client.Channel;
> import com.rabbitmq.client.*;
>
> public class Send {
>
>   public static void main(String[] argv) throws Exception {
>
>       ConnectionFactory factory = new ConnectionFactory();
>
>   }
> }
>
> Here are the results
> C:\java>java Send
> Exception in thread "main" java.lang.NoClassDefFoundError: 
> com/rabbitmq/client/ConnectionFactory
>         at Send.main(Send.java:10)
> Caused by: java.lang.ClassNotFoundException: 
> com.rabbitmq.client.ConnectionFactory
>         at java.net.URLClassLoader$1.run(Unknown Source)
>         at java.net.URLClassLoader$1.run(Unknown Source)
>         at java.security.AccessController.doPrivileged(Native Method)
>         at java.net.URLClassLoader.findClass(Unknown Source)
>         at java.lang.ClassLoader.loadClass(Unknown Source)
>         at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source)
>         at java.lang.ClassLoader.loadClass(Unknown Source)
>
> Has anyone encountered and resolved this issue? Two thoughts I have are 
> ConnectionFactory is dependent on classes not in my compile command and 
> that ConnectionFactory has no parameter-less definitions. 
>
> Thanks for any help,
>
> George
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120715/46bb273f/attachment.htm>

From milan at m-i.com.au  Sun Jul 15 15:21:21 2012
From: milan at m-i.com.au (mrajkovic)
Date: Sun, 15 Jul 2012 07:21:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster Setup
Message-ID: <1342362081660-20805.post@n5.nabble.com>

Hi Everyone, i have been trying to setup a cluster for the better part of two
weeks now, i am ready to almost give up... and then i discovered there is a
mailing list!

i have two servers, i will list each of the configs below, 

When i run the cluster commands this is what i get...

root at mf-02:~# rabbitmqctl cluster rabbit at mf-01
Clustering node 'rabbit at mf-02' with ['rabbit at mf-01'] ...
Error: {failed_to_cluster_with,['rabbit at mf-01'],
                               "Mnesia could not connect to some nodes."}

root at mf-02:~# rabbitmqctl -n rabbit at mf-01 status
Status of node 'rabbit at mf-01' ...
Error: unable to connect to node 'rabbit at mf-01': nodedown
diagnostics:
- unable to connect to epmd on mf-01: address
- current node: 'rabbitmqctl26839 at mf-02'
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: =========== REMOVED=========

i can ping each server 
root at mf-01:~# ping mf-02
PING mf-02.cloud.m-i.com.au (119.31.227.106) 56(84) bytes of data.
64 bytes from mf-02.cloud.m-i.com.au (119.31.227.106): icmp_req=1 ttl=64
time=0.410 ms
64 bytes from mf-02.cloud.m-i.com.au (119.31.227.106): icmp_req=2 ttl=64
time=0.520 ms


root at mf-02:~# ping mf-01
PING mf-01.vic.cloud.m-i.com.au (119.31.227.103) 56(84) bytes of data.
64 bytes from mf-01.vic.cloud.m-i.com.au (119.31.227.103): icmp_req=1 ttl=64
time=2.75 ms
64 bytes from mf-01.vic.cloud.m-i.com.au (119.31.227.103): icmp_req=2 ttl=64
time=0.416 ms


Config on mf-02 /etc/rabbitmq/rabbitmq.conf
export RABBITMQ_NODENAME=rabbit at mf-02
export RABBITMQ_NODE_IP_ADDRESS=
export ERL_EPMD_ADDRESS=

Config on mf-01 /etc/rabbitmq/rabbitmq.conf
export RABBITMQ_NODENAME=rabbit at mf-01
export RABBITMQ_NODE_IP_ADDRESS=
export ERL_EPMD_ADDRESS=

Would appriciate any help...

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Sun Jul 15 17:44:05 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 15 Jul 2012 17:44:05 +0100
Subject: [rabbitmq-discuss] Cluster Setup
In-Reply-To: <1342362081660-20805.post@n5.nabble.com>
References: <1342362081660-20805.post@n5.nabble.com>
Message-ID: <5002F355.4060308@rabbitmq.com>

On 15/07/12 15:21, mrajkovic wrote:
> - unable to connect to epmd on mf-01: address

Check that rabbit is running on mf-01.

Assuming it is then check that access to epmd isn't blocked by some 
firewall. See http://www.rabbitmq.com/clustering.html#firewall

Matthias.

From emile at rabbitmq.com  Mon Jul 16 10:05:56 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 Jul 2012 10:05:56 +0100
Subject: [rabbitmq-discuss] error while installing RabbitMQ from your
 APT repo
In-Reply-To: <f595f5c4-4bfb-4cd6-9d57-19945bbdefec@googlegroups.com>
References: <f595f5c4-4bfb-4cd6-9d57-19945bbdefec@googlegroups.com>
Message-ID: <5003D974.60906@rabbitmq.com>

Hi,

On 14/07/12 11:52, Rotem Tamir wrote:
> I get this error:
> /usr/lib/erlang/erts-5.9.1/bin/beam: /usr/lib/libz.so.1: version
> `ZLIB_1.2.3.3' not found (required by /usr/lib/erlang/erts-5.9.1/bin/beam)

This error is more likely due to a problem with your Erlang installation
than with RabbitMQ. Can you run the Erlang shell by itself (erl) ? This
is a prerequisite for the broker to run.



-Emile



From emile at rabbitmq.com  Mon Jul 16 10:14:59 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 Jul 2012 10:14:59 +0100
Subject: [rabbitmq-discuss] rabbitmq-server process consumes 100% of 1
 CPU (rabbitmq 2.8.4 on Erlang R14B04)
In-Reply-To: <4FFEC2F9.9090507@rabbitmq.com>
References: <4FFEBE0A.7070400@lshift.net> <4FFEC2F9.9090507@rabbitmq.com>
Message-ID: <5003DB93.8080900@rabbitmq.com>

Hi Ceri,

On 12/07/12 13:28, Simon MacMullen wrote:
> On 12/07/12 13:07, Ceri Storey wrote:
>> On this hunch, I've bumped our file descriptor limit on one machine to
>> 8192 from 1024 files, and it does indeed that the resource usage does
>> drop dramatically once the instance has started up. So, I think that
>> brings us to a work around for one case, if not an explanation of the
>> underlying behaviour.
> 
> Hi Ceri. Thanks for this additional information. Just to update you, 
> I've just managed to replicate this and am now poking at it. Thanks again.

A fix for this problem has reached the default branch of the source
repository. This fix will be included in the next release, or you can
build the broker from source as described here:

http://www.rabbitmq.com/build-server.html


-Emile

From emile at rabbitmq.com  Mon Jul 16 10:18:06 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 Jul 2012 10:18:06 +0100
Subject: [rabbitmq-discuss] RabbitMQ Cluster High CPU Usage 100-200%+
In-Reply-To: <CAHv8OSTp+R11kXb6DCZnHD+GUt0t6CKDHW674j0Xpds66cJ1=g@mail.gmail.com>
References: <CAHv8OSQE=bvFNW7=XEJM2Pc6w0hF6KSxpMTJT1bwDLAYoD4xTw@mail.gmail.com>
	<87a9z661j6.wl%francesco@rabbitmq.com>
	<CAHv8OSTp+R11kXb6DCZnHD+GUt0t6CKDHW674j0Xpds66cJ1=g@mail.gmail.com>
Message-ID: <5003DC4E.6040603@rabbitmq.com>

Hi,

>     At Wed, 11 Jul 2012 18:12:24 +0800,
>     Wong Kam Hoong wrote:

>     > Master Node 
>     > PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
>     > 13994 rabbitmq  25   0  206m 114m 2304 S 205.0  2.9 670:29.57 beam.smp

A fix for a problem that closely matches your description has just been
made and will be available in the next release.


-Emile


From lars.strojny at internations.org  Mon Jul 16 11:32:24 2012
From: lars.strojny at internations.org (Lars Strojny)
Date: Mon, 16 Jul 2012 12:32:24 +0200
Subject: [rabbitmq-discuss] Crash with active-active setup,
	durable and mirrored queues and persistent messages
Message-ID: <6B5EF8EE-2111-4249-BBA6-D7D9F7C37596@internations.org>

Hi everybody,

as discussed on IRC, we had a crash with our active/active setup. We have two servers, rabbit01 and rabbit02, both disk nodes. Our queues are all durable and mirrored. All messages have the X-HA-Policy of "all". We use haproxy as a load balancer.

Unfortunately I was not able to reproduce the crash. A little context as a long shot: we were deploying a new version of our software. Our deployment process does queue housekeeping (creating queues and exchanges, adding routing keys). During the deployment at least one consumer was running that processed messages. The consumer does the usual read, accept/reject pattern.

RabbitMQ Log message: http://pastebin.com/wjYjz4H4
Our application log messages (not sure if that is helpful): http://pastebin.com/DrQwKuwL
rabbitmq-server --version: http://pastebin.com/nX3PuaTU

Best regards,
-- 
Lars Strojny
Chief Technical Officer

InterNations GmbH
Schwanthalerstrasse 39
80336 M?nchen
Germany
 
Phone:        +49 - (0)89 - 46 133 24 - 63
Fax:          +49 - (0)89 - 46 133 24 - 99
Mobile:       +49 - (0)151 - 2351 5701
Email:        lars.strojny at internations.org
 
www.internations.org

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120716/58f1e99e/attachment.pgp>

From ernest.staszuk at comarch.pl  Mon Jul 16 11:37:44 2012
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Mon, 16 Jul 2012 12:37:44 +0200
Subject: [rabbitmq-discuss] Vanishing of persistent messages on durable,
 auto-deleting queue with dead-lettering
In-Reply-To: <4FF09592.20302@rabbitmq.com>
References: <4FEDD75D.1030808@comarch.pl> <4FF09592.20302@rabbitmq.com>
Message-ID: <5003EEF8.1070000@comarch.pl>

First thank you for your answer. I spend some time thinking about actual 
behavior, consequences
of this status quo and also how I can achieve my goal.

2012-07-01 20:23, Matthias Radestock writes:
>
> We deliberately kept the set of operations susceptible to 
> dead-lettering small, to avoid unintended consequences. It is possible 
> that actions like auto-deletion, queue lease expiry, explicit deletion 
> and purging should all trigger the dead-letter mechanism, but I'd like 
> to see compelling use cases first before making such a change. 

I will describe the case I am dealing with:
We send some tasks to rabbit's exchange. To achieve load balancing at 
rpc servers x-consistent-hash
is used. Auto-deleting queues with dead-lettering are fitting there 
perfectly, because when one
of consuments goes down his queue is deleted and then new messages are 
distributed only between
active consumers (due to auto-deleting) and also we can preserve badly 
processed commands
for another try or examination in another queue (due to dead-lettering).

But as consequence of choosing auto-deleting queue also some part of 
messages (which won't be
dead-lettered when queue will be discarded). As there are cases when 
loosing messages is not
an option I think if actual behavior is consistent with spirit of 
dead-lettering's aims (imho to save
undeliverable messages).

I would appreciate if you could submit your view on this case.

Regards,
Ernest

From matthias at rabbitmq.com  Mon Jul 16 11:41:02 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Jul 2012 11:41:02 +0100
Subject: [rabbitmq-discuss] Crash with active-active setup,
 durable and mirrored queues and persistent messages
In-Reply-To: <6B5EF8EE-2111-4249-BBA6-D7D9F7C37596@internations.org>
References: <6B5EF8EE-2111-4249-BBA6-D7D9F7C37596@internations.org>
Message-ID: <5003EFBE.7030505@rabbitmq.com>

Lars,

On 16/07/12 11:32, Lars Strojny wrote:
> as discussed on IRC, we had a crash with our active/active setup.

I see you are running 2.8.2. Please upgrade to 2.8.4, which contains 
several bug fixes in relation to HA queues.

Regards,

Matthias.

From lars.strojny at internations.org  Mon Jul 16 11:41:34 2012
From: lars.strojny at internations.org (Lars Strojny)
Date: Mon, 16 Jul 2012 12:41:34 +0200
Subject: [rabbitmq-discuss] Crash with active-active setup,
	durable and mirrored queues and persistent messages
In-Reply-To: <5003EFBE.7030505@rabbitmq.com>
References: <6B5EF8EE-2111-4249-BBA6-D7D9F7C37596@internations.org>
	<5003EFBE.7030505@rabbitmq.com>
Message-ID: <35DCF4BD-ED51-4979-9D6C-52B2C06F09F4@internations.org>

Hi Matthias,

did that already, let?s see if it happens again.

Am 16.07.2012 um 12:41 schrieb Matthias Radestock:

> Lars,
> 
> On 16/07/12 11:32, Lars Strojny wrote:
>> as discussed on IRC, we had a crash with our active/active setup.
> 
> I see you are running 2.8.2. Please upgrade to 2.8.4, which contains several bug fixes in relation to HA queues.
> 
> Regards,
> 
> Matthias.

Best regards,
-- 
Lars Strojny
Chief Technical Officer

InterNations GmbH
Schwanthalerstrasse 39
80336 M?nchen
Germany
 
Phone:        +49 - (0)89 - 46 133 24 - 63
Fax:          +49 - (0)89 - 46 133 24 - 99
Mobile:       +49 - (0)151 - 2351 5701
Email:        lars.strojny at internations.org
 
www.internations.org

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120716/8908038d/attachment.pgp>

From ivan.dyachkoff at gmail.com  Mon Jul 16 12:28:51 2012
From: ivan.dyachkoff at gmail.com (Ivan Dyachkoff)
Date: Mon, 16 Jul 2012 13:28:51 +0200
Subject: [rabbitmq-discuss] Erlang client: unregistering confirm/return/flow
	handler
Message-ID: <CAAmzGHSe=rg+91vWhLADgNeHMqP2c4z__On3-tPVzU2t7z9xxg@mail.gmail.com>

Hi guys.

Currently the only way to unregister any type of handler mentioned in
subject is to kill pid that was registered as handler. That gives us error
message in log "Channel (<...>): Unregistering confirm handler <...>
because it died." which is not actually an error.
Would be nice to have methods in amqp_channel module to unregister 3 types
of handlers, so in 'terminate' we can call say "unregister_confirm_handler"
and terminate gracefully.
What do you think?

/Ivan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120716/20289eaf/attachment.htm>

From anton.kirilenko at rosalab.ru  Mon Jul 16 13:54:40 2012
From: anton.kirilenko at rosalab.ru (Anton Kirilenko)
Date: Mon, 16 Jul 2012 16:54:40 +0400
Subject: [rabbitmq-discuss] return callback works only once
Message-ID: <50040F10.60207@rosalab.ru>

When I send a message to queue that doesn't exist, the return_callback 
is called in my program. But when I do it the second time (to the same 
queue or to another) - nothing happens! What am I doing wrong?
I can't provide the code sample, because the code is huge and it's not 
easy to get the short piece from it.

From sanjiv.kumar.jha at accenture.com  Mon Jul 16 14:14:05 2012
From: sanjiv.kumar.jha at accenture.com (sanjiv.kumar.jha at accenture.com)
Date: Mon, 16 Jul 2012 13:14:05 +0000
Subject: [rabbitmq-discuss]
	Cluster	setup	:	rabbitmq	server	stops	responding	to	rabbitmqctl	commands
In-Reply-To: <87obnjq5dr.wl%francesco@rabbitmq.com>
References: <EEA1DC407D5C23479BEAAF68C3D560400531C4CA@048-CH1MPN1-213.048d.mgd.msft.net>
	<877gua5zni.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C522@048-CH1MPN1-213.048d.mgd.msft.net>
	<87629u5wsw.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C770@048-CH1MPN1-213.048d.mgd.msft.net>
	<87wr293ybs.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C8C8@048-CH1MPN1-213.048d.mgd.msft.net>
	<87pq80ouv4.wl%francesco@rabbitmq.com>
	<EEA1DC407D5C23479BEAAF68C3D560400531C9A1@048-CH1MPN1-213.048d.mgd.msft.net>
	<87obnjq5dr.wl%francesco@rabbitmq.com>
Message-ID: <EEA1DC407D5C23479BEAAF68C3D560400531CB87@048-CH1MPN1-213.048d.mgd.msft.net>

Hi Francesco,

I am using the rabbitmq.config file to setup the cluster:


[{rabbit, [{cluster_nodes, ['rabbit at rabbit1', 'rabbit at rabbit2']}]}].


I am doing the similar steps (more or less) as described in your script. Also, this cluster sits on two different VMs.

I am checking on whether two clocks are in synch or not and will get back to you.

Thanks,

Sanjiv



-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Francesco Mazzoli
Sent: 13 July 2012 16:45
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Cluster setup : rabbitmq server stops responding to rabbitmqctl commands

At Fri, 13 Jul 2012 10:23:15 +0000,
Hi Sanjiv,

I have hacked up a quick script to try to reproduce your problem. It is a bash script that starts/stops/cluster and a python script used by the bash script to declare 100 HA queues; I have attached them. I'm running the two nodes on the same machine, this makes a difference but hopefully the problem is not there.

Looking at your logs, it looks like DV1SP001 sees BSPEVSDK001 going down, but there is no trace of that in the BSPEVSDK001 logs, which looks like it's running all the way through. Are the clocks on the two nodes synchronised?  If they are, what I see in the logs looks like a netsplit, which is a bad thing for rabbit clusters, and can cause mnesia to act funny.

It's also not clear from your email and the logs how you set up the cluster in the first place.

Can you confirm that what I do in the script is more or less what you are doing?
If it's not, can you give more details on your setup?

--
Francesco * Often in error, never in doubt


Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
______________________________________________________________________________________

www.accenture.com


From francesco at rabbitmq.com  Mon Jul 16 14:32:46 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 16 Jul 2012 14:32:46 +0100
Subject: [rabbitmq-discuss] Erlang client: unregistering
	confirm/return/flow	handler
In-Reply-To: <CAAmzGHSe=rg+91vWhLADgNeHMqP2c4z__On3-tPVzU2t7z9xxg@mail.gmail.com>
References: <CAAmzGHSe=rg+91vWhLADgNeHMqP2c4z__On3-tPVzU2t7z9xxg@mail.gmail.com>
Message-ID: <87bojf4yrl.wl%francesco@rabbitmq.com>

Hi Ivan,
At Mon, 16 Jul 2012 13:28:51 +0200,
Ivan Dyachkoff wrote:
> Currently the only way to unregister any type of handler mentioned in subject
> is to kill pid that was registered as handler. That gives us error message in
> log "Channel (<...>): Unregistering confirm handler <...> because it died."
> which is not actually an error.
> Would be nice to have methods in amqp_channel module to unregister 3 types of
> handlers, so in 'terminate' we can call say "unregister_confirm_handler" and
> terminate gracefully.
> What do you think?

That sounds reasonable, I'll file a bug.

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Mon Jul 16 14:51:59 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 16 Jul 2012 14:51:59 +0100
Subject: [rabbitmq-discuss] return callback works only once
In-Reply-To: <50040F10.60207@rosalab.ru>
References: <50040F10.60207@rosalab.ru>
Message-ID: <87a9yz4xvk.wl%francesco@rabbitmq.com>

At Mon, 16 Jul 2012 16:54:40 +0400,
Anton Kirilenko wrote:
> 
> When I send a message to queue that doesn't exist, the return_callback is
> called in my program. But when I do it the second time (to the same queue or
> to another) - nothing happens! What am I doing wrong?  I can't provide the
> code sample, because the code is huge and it's not easy to get the short piece
> from it.

I took a look at the code, and it is extremely simple. The only time in which we
remove the handler is when the handler dies. Are you sure that the handler is
actually looping to always receive messages, and not just receiving once? You
can check the logs to see if the client has noticed that it went down.

--
Francesco * Often in error, never in doubt

From anton.kirilenko at rosalab.ru  Mon Jul 16 15:02:33 2012
From: anton.kirilenko at rosalab.ru (Anton Kirilenko)
Date: Mon, 16 Jul 2012 18:02:33 +0400
Subject: [rabbitmq-discuss] return callback works only once
In-Reply-To: <87a9yz4xvk.wl%francesco@rabbitmq.com>
References: <50040F10.60207@rosalab.ru> <87a9yz4xvk.wl%francesco@rabbitmq.com>
Message-ID: <50041EF9.1010201@rosalab.ru>

On 07/16/2012 05:51 PM, Francesco Mazzoli wrote:
> I took a look at the code, and it is extremely simple. The only time in which we
> remove the handler is when the handler dies. Are you sure that the handler is
> actually looping to always receive messages, and not just receiving once? You
> can check the logs to see if the client has noticed that it went down.
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
def return_callback(self, method, header, body):
         try:
             log.debug(str(method))
             log.debug(str(header))
             log.debug(str(body))
         except:
             log.exception('something happened')

This is my callback function (I'm using python/pika). It raises no 
exceptions and it is called only once. Should I add something else in 
order to 'loop to always receive messages'?

From anton.kirilenko at rosalab.ru  Mon Jul 16 15:04:37 2012
From: anton.kirilenko at rosalab.ru (Anton Kirilenko)
Date: Mon, 16 Jul 2012 18:04:37 +0400
Subject: [rabbitmq-discuss] return callback works only once
In-Reply-To: <87a9yz4xvk.wl%francesco@rabbitmq.com>
References: <50040F10.60207@rosalab.ru> <87a9yz4xvk.wl%francesco@rabbitmq.com>
Message-ID: <50041F75.8090104@rosalab.ru>

On 07/16/2012 05:51 PM, Francesco Mazzoli wrote:
> I took a look at the code, and it is extremely simple. The only time 
> in which we remove the handler is when the handler dies. Are you sure 
> that the handler is actually looping to always receive messages, and 
> not just receiving once? You can check the logs to see if the client 
> has noticed that it went down. -- Francesco * Often in error, never in 
> doubt
I've checked logs. There is nothing except

=INFO REPORT==== 16-Jul-2012::18:03:38 ===
accepting AMQP connection <0.3406.0> (127.0.0.1:44679 -> 127.0.0.1:5672)

for every connection I've created.

From francesco at rabbitmq.com  Mon Jul 16 15:06:40 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 16 Jul 2012 15:06:40 +0100
Subject: [rabbitmq-discuss] return callback works only once
In-Reply-To: <87a9yz4xvk.wl%francesco@rabbitmq.com>
References: <50040F10.60207@rosalab.ru> <87a9yz4xvk.wl%francesco@rabbitmq.com>
Message-ID: <878vej4x73.wl%francesco@rabbitmq.com>

At Mon, 16 Jul 2012 14:51:59 +0100,
Francesco Mazzoli wrote:
> 
> At Mon, 16 Jul 2012 16:54:40 +0400,
> Anton Kirilenko wrote:
> > 
> > When I send a message to queue that doesn't exist, the return_callback is
> > called in my program. But when I do it the second time (to the same queue or
> > to another) - nothing happens! What am I doing wrong?  I can't provide the
> > code sample, because the code is huge and it's not easy to get the short piece
> > from it.
> 
> I took a look at the code, and it is extremely simple. The only time in which we
> remove the handler is when the handler dies. Are you sure that the handler is
> actually looping to always receive messages, and not just receiving once? You
> can check the logs to see if the client has noticed that it went down.

By the way, I assumed you were talking about the return *handler* in the Erlang
client. If you meant to say "callback", then I'm not sure what you are referring
to.

--
Francesco * Often in error, never in doubt

From anton.kirilenko at rosalab.ru  Mon Jul 16 15:08:15 2012
From: anton.kirilenko at rosalab.ru (Anton Kirilenko)
Date: Mon, 16 Jul 2012 18:08:15 +0400
Subject: [rabbitmq-discuss] return callback works only once
In-Reply-To: <878vej4x73.wl%francesco@rabbitmq.com>
References: <50040F10.60207@rosalab.ru> <87a9yz4xvk.wl%francesco@rabbitmq.com>
	<878vej4x73.wl%francesco@rabbitmq.com>
Message-ID: <5004204F.9000800@rosalab.ru>


> By the way, I assumed you were talking about the return *handler* in the Erlang
> client. If you meant to say "callback", then I'm not sure what you are referring
> to.
>
>
It looks like the problem have been solved. I have to register the 
callback again on receiving the message. Unexpected behavior for me.

From francesco at rabbitmq.com  Mon Jul 16 15:11:01 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 16 Jul 2012 15:11:01 +0100
Subject: [rabbitmq-discuss] return callback works only once
In-Reply-To: <50041EF9.1010201@rosalab.ru>
References: <50040F10.60207@rosalab.ru> <87a9yz4xvk.wl%francesco@rabbitmq.com>
	<50041EF9.1010201@rosalab.ru>
Message-ID: <877gu34wzu.wl%francesco@rabbitmq.com>

At Mon, 16 Jul 2012 18:02:33 +0400,
Anton Kirilenko wrote:
> def return_callback(self, method, header, body):
>          try:
>              log.debug(str(method))
>              log.debug(str(header))
>              log.debug(str(body))
>          except:
>              log.exception('something happened')
> 
> This is my callback function (I'm using python/pika). It raises no 
> exceptions and it is called only once. Should I add something else in 
> order to 'loop to always receive messages'?

Ignore my previous message, I was thinking about the Erlang client's return
handler, sorry about that. I haven't got much experience with pika, but if this
is a bug it is most likely to be pika's fault, so you should report to the
author as well.

--
Francesco * Often in error, never in doubt

From anton.kirilenko at rosalab.ru  Mon Jul 16 15:20:12 2012
From: anton.kirilenko at rosalab.ru (Anton Kirilenko)
Date: Mon, 16 Jul 2012 18:20:12 +0400
Subject: [rabbitmq-discuss] return callback works only once
In-Reply-To: <877gu34wzu.wl%francesco@rabbitmq.com>
References: <50040F10.60207@rosalab.ru> <87a9yz4xvk.wl%francesco@rabbitmq.com>
	<50041EF9.1010201@rosalab.ru>
	<877gu34wzu.wl%francesco@rabbitmq.com>
Message-ID: <5004231C.3060207@rosalab.ru>

On 07/16/2012 06:11 PM, Francesco Mazzoli wrote:
> At Mon, 16 Jul 2012 18:02:33 +0400,
> Anton Kirilenko wrote:
>> def return_callback(self, method, header, body):
>>           try:
>>               log.debug(str(method))
>>               log.debug(str(header))
>>               log.debug(str(body))
>>           except:
>>               log.exception('something happened')
>>
>> This is my callback function (I'm using python/pika). It raises no
>> exceptions and it is called only once. Should I add something else in
>> order to 'loop to always receive messages'?
> Ignore my previous message, I was thinking about the Erlang client's return
> handler, sorry about that. I haven't got much experience with pika, but if this
> is a bug it is most likely to be pika's fault, so you should report to the
> author as well.
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
Thanks for your help anyway :) The problem is solved as it's written in 
another message.

From meetprashanth437 at gmail.com  Mon Jul 16 16:18:29 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Mon, 16 Jul 2012 11:18:29 -0400
Subject: [rabbitmq-discuss] RabbitMQ SSL
In-Reply-To: <50002D2D.7020907@rabbitmq.com>
References: <CAE8G+ySr0MaTgqoWkuoDxW0P1N=7HKmfKKACGOLtj1pi1xUpxA@mail.gmail.com>
	<50002D2D.7020907@rabbitmq.com>
Message-ID: <CAE8G+yS99=RyFSZgL-Ldnf-hriN885xK2i0V6_kvwsVeAzoTdA@mail.gmail.com>

Emile,

Thank you for the response. I tried all the steps from SSL troubleshoot
document.

In SSL connection to broker

when I make a connection, connection gets closed after a couple of seconds.
I tried sending 8 bytes my response is a string AMQP and it closes the
connection immediately.

Copied by response.

openssl s_client -connect localhost:5671 -cert client/cert.pem -key
client/key.pem -CAfile testca/cacert.pem
CONNECTED(00000003)
depth=1 CN = MyTestCA
verify return:1
depth=0 CN = Core28, O = server
verify return:1
---
Certificate chain
 0 s:/CN=Core28/O=server
   i:/CN=MyTestCA
 1 s:/CN=MyTestCA
   i:/CN=MyTestCA
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhNeVRl
c3RDQTAeFw0xMjA3MTMxMzE0MDFaFw0xMzA3MTMxMzE0MDFaMCQxETAPBgNVBAMM
CEdYQ29yZTI4MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
DwAwggEKAoIBAQDBQpQ/dR8Aim9qqP2EfxStf+F6rME4soPxjY0PzFUzXKslNkTl
hCeoRSElnpOKwqK16SzOr2N9HNxivkqjmCvB3WSwqf6LT1gRuVzCB36zwD2dOIZ1
5JU4JWtAcpNZMhwMLkReE1h3L5UBXSjqKhpyuKdYqWKTMzFJiu28WFOLS/XMz6K2
Y9gk5O7zWu5AcJyJssr2xMisoNFmq5USfHkt5UWoHd3YzReUfxZmjhzSRT9TRvBY
NIlNm41JljtXBea9sITIuGq8eSgvO87+N70uSRcuXBCk9fn5S8I0TUh+4bUVnP8F
Ryg/uSO+WkNeOzjYUpaBAR/4v2UQTl4QlkgTAgMBAAGjLzAtMAkGA1UdEwQCMAAw
CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
A4IBAQCI41d129BaDyzihtGH6yu0dOT9mT0U1Mv5FcBTERmYsyn+Adjmo/+jF9HZ
Q3m1Wc7hV30nSnhJPUKV8dgDPKUNt4Mj3ZRsPZUEFv128rbkk9der+t3Z1tYKcrX
0HiYNqdsKyuhXUB8P4g1TW0t/pLhvsO734+eQDtjmi//K4AevS/hz+9cVhx9Asrk
ca/EdIw+xtRxNFbGCACZW8CUlP24z7YL3QYbZA44H9jKMHNN0vwkeJ4nDiby0ySJ
FX5xDWMksSON636pachSqMzZL8dj3ijTfBEV7jLeH/fYkcK8K0rzzZVFhVrBnK+O
k/Uc5ZRhf9E5F9U3cLy0f7Br2eFp
-----END CERTIFICATE-----
subject=/CN=Core28/O=server
issuer=/CN=MyTestCA
---
Acceptable client certificate CA names
/CN=MyTestCA
---
SSL handshake has read 1663 bytes and written 2179 bytes
---
New, TLSv1/SSLv3, Cipher is AES256-SHA
Server public key is 2048 bit
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol  : TLSv1
    Cipher    : AES256-SHA
    Session-ID:
60281E9B3DA64177D15C7DC4E0F2C5467A76170ADFFF9C23C9A6AFEE3F8D5129
    Session-ID-ctx:
    Master-Key:
4111FDE14CC847C17445136C3057CBBDB5D23752AF61F2481BB6F259CBAE94C75E23FE85F20E83E12AD1EA3674709FDB
    Key-Arg   : None
    Krb5 Principal: None
    PSK identity: None
    PSK identity hint: None
    Start Time: 1342449654
    Timeout   : 300 (sec)
    Verify return code: 0 (ok)
---
closed

Thanks,
Prashanth.

On Fri, Jul 13, 2012 at 10:14 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 13/07/12 15:02, Prashanth wrote:
> > I get a message Logging in: (end-of-stream)
> > connecting to server fails.
>
> It is challenging to assist here, given how little information you have
> provided. As a first step could you try to verify your setup using the
> troubleshooting steps outlined here:
>
> http://www.rabbitmq.com/troubleshooting-ssl.html
>
> Let us know how far you get, which of the steps fail and the diagnostic
> output.
>
>
> Thanks
>
>
> Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120716/90045fe5/attachment.htm>

From emile at rabbitmq.com  Mon Jul 16 16:45:29 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 Jul 2012 16:45:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ SSL
In-Reply-To: <CAE8G+yS99=RyFSZgL-Ldnf-hriN885xK2i0V6_kvwsVeAzoTdA@mail.gmail.com>
References: <CAE8G+ySr0MaTgqoWkuoDxW0P1N=7HKmfKKACGOLtj1pi1xUpxA@mail.gmail.com>
	<50002D2D.7020907@rabbitmq.com>
	<CAE8G+yS99=RyFSZgL-Ldnf-hriN885xK2i0V6_kvwsVeAzoTdA@mail.gmail.com>
Message-ID: <50043719.1080900@rabbitmq.com>

Hi,

On 16/07/12 16:18, Prashanth wrote:
> when I make a connection, connection gets closed after a couple of
> seconds. I tried sending 8 bytes my response is a string AMQP and it
> closes the connection immediately.

What you described here is a successful test. The broker will close the
connection after a few seconds, but if you received the "AMQP" protocol
string then it means the broker is listening on the SSL connection.

Does the AMQP client making a connection to the same broker over SSL
(port 5671) succeed in completing the SSL handshake before it quits?
"ssldump" or an SSL-aware network analyser could help determine this.
Does the broker log contain anything when the attempt is made?



-Emile


From meetprashanth437 at gmail.com  Mon Jul 16 16:48:24 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Mon, 16 Jul 2012 11:48:24 -0400
Subject: [rabbitmq-discuss] RabbitMQ SSL
In-Reply-To: <50043719.1080900@rabbitmq.com>
References: <CAE8G+ySr0MaTgqoWkuoDxW0P1N=7HKmfKKACGOLtj1pi1xUpxA@mail.gmail.com>
	<50002D2D.7020907@rabbitmq.com>
	<CAE8G+yS99=RyFSZgL-Ldnf-hriN885xK2i0V6_kvwsVeAzoTdA@mail.gmail.com>
	<50043719.1080900@rabbitmq.com>
Message-ID: <CAE8G+ySbTZYj1jiZPjd_BixnSZnULv85Hpg26x1om8ZzZfAWhQ@mail.gmail.com>

Emile,

Here is the log message.

=INFO REPORT==== 16-Jul-2012::10:47:33 ===
accepting AMQP connection <0.11506.0> ([::1]:55514 -> [::1]:5671)

=ERROR REPORT==== 16-Jul-2012::10:47:43 ===
closing AMQP connection <0.11506.0> ([::1]:55514 -> [::1]:5671):
{handshake_timeout,handshake}

my client is a Perl client, it uses Net::RabbitMQ
It connects to the RabbitMQ server and declares a queue and pushes messages
to the queue. I am doing nothing on the client side for ssl, except that
now it connects to the ssl port.
Do client has to do something else.

Thanks,
Prashanth.


On Mon, Jul 16, 2012 at 11:45 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 16/07/12 16:18, Prashanth wrote:
> > when I make a connection, connection gets closed after a couple of
> > seconds. I tried sending 8 bytes my response is a string AMQP and it
> > closes the connection immediately.
>
> What you described here is a successful test. The broker will close the
> connection after a few seconds, but if you received the "AMQP" protocol
> string then it means the broker is listening on the SSL connection.
>
> Does the AMQP client making a connection to the same broker over SSL
> (port 5671) succeed in completing the SSL handshake before it quits?
> "ssldump" or an SSL-aware network analyser could help determine this.
> Does the broker log contain anything when the attempt is made?
>
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120716/6e646248/attachment.htm>

From emile at rabbitmq.com  Mon Jul 16 17:16:01 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 Jul 2012 17:16:01 +0100
Subject: [rabbitmq-discuss] RabbitMQ SSL
In-Reply-To: <CAE8G+ySbTZYj1jiZPjd_BixnSZnULv85Hpg26x1om8ZzZfAWhQ@mail.gmail.com>
References: <CAE8G+ySr0MaTgqoWkuoDxW0P1N=7HKmfKKACGOLtj1pi1xUpxA@mail.gmail.com>
	<50002D2D.7020907@rabbitmq.com>
	<CAE8G+yS99=RyFSZgL-Ldnf-hriN885xK2i0V6_kvwsVeAzoTdA@mail.gmail.com>
	<50043719.1080900@rabbitmq.com>
	<CAE8G+ySbTZYj1jiZPjd_BixnSZnULv85Hpg26x1om8ZzZfAWhQ@mail.gmail.com>
Message-ID: <50043E41.4020605@rabbitmq.com>

Hi,

On 16/07/12 16:48, Prashanth wrote:
> I am doing nothing on the client side for ssl,
> except that now it connects to the ssl port.

You have to use a client that is able to establish an SSL connection.
Using a regular AMQP connection without any additional configuration and
pointing it to port 5671 on the broker will not work. You might be able
to use "stunnel" to provide encryption for a regular AMQP client.

-Emile



From srikanthtns at gmail.com  Mon Jul 16 18:09:57 2012
From: srikanthtns at gmail.com (srikanth tns)
Date: Mon, 16 Jul 2012 10:09:57 -0700
Subject: [rabbitmq-discuss] RabbitMQ replies not received to client
In-Reply-To: <4FFFEB86.10905@rabbitmq.com>
References: <CAOU_jKBEcVmRYsdqoHtuS=sdSqx7-tFjgwzNzKVr=SD_1Be8nw@mail.gmail.com>
	<CAOU_jKD-8V-N-PkVVexCmkOor7EVBPd=awbC2e7H=VsZEAmtEg@mail.gmail.com>
	<4FFFEB86.10905@rabbitmq.com>
Message-ID: <CAOU_jKBpKmDaahzSzDt3L3Na8FsL0Op92C98T9gknEpJo=yr4A@mail.gmail.com>

I was able to reproduce the issue on the rabbitmq log , I see this message
reported for different channels on the log.
Can you advice what is the issue and how can it be resolved?


Channel (<0.24663.10>): dropping method {{'basic.deliver',

<<"Q_/topic/mcollective.discovery.reply">>,
                                          86,false,<<"amq.topic">>,

<<"mcollective.discovery.reply">>},
                                         {content,60,
                                          {'P_basic',
                                           <<" text/plain; charset=UTF-8">>,
                                           undefined,
                                           [{<<"content-length">>,longstr,
                                             <<"212">>}],
                                           undefined,undefined,undefined,
                                           undefined,undefined,undefined,
                                           undefined,undefined,undefined,
                                           undefined,undefined},
                                          none,none,
                                          [[<<4,8,123,12,58,13,115,101,110,
                                              100,101,114,105,100,34,13,
                                              117,110,105,116,51,55,51,54,
                                              58,9,104,97,115,104,34,37,54,
                                              53,101,53,52,98,50,51,55,52,
                                              97,54,101,48,55,98,100,49,48,
                                              101,55,52,102,98,53,101,56,
                                              51,97,49,101,56,58,16,115,
                                              101,110,100,101,114,97,103,
                                              101,110,116,34,14,100,105,
                                              115,99,111,118,101,114,121,
                                              58,14,114,101,113,117,101,
                                              115,116,105,100,34,37,57,57,
                                              55,101,98,99,54,100,100,56,
                                              55,52,53,100,54,54,54,99,102,
                                              99,49,56,57,52,57,98,51,49,
                                              54,48,51,54,58,14,109,115,
                                              103,116,97,114,103,101,116,
                                              34,39,47,116,111,112,105,99,
                                              47,109,99,111,108,108,101,99,
                                              116,105,118,101,46,100,105,
                                              115,99,111,118,101,114,121,
                                              46,114,101,112,108,121,58,9,
                                              98,111,100,121,34,13,4,8,34,
                                              9,112,111,110,103,58,12,109,
                                              115,103,116,105,109,101,108,
                                              43,7,44,67,4,80>>]]}} from
server because channel is closing




On Fri, Jul 13, 2012 at 2:33 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 12/07/12 19:57, srikanth tns wrote:
>
>> I am using RabbitMQ 2.3.1 ,Erlang 5.6.5 on linux systems
>>
>
> Those are ancient versions. There have been many improvements and bug
> fixes to Rabbit and Erlang since then. Please upgrade.
>
>
>  The infrastructure was working fine when we have like 250 nodes
>> connected to the rabbit_stomp . When we increase the nodes to 300+ , we
>> started seeing issues.
>> The nodes are pushing the messages onto the rabbitmq topic , but somehow
>> client is not receiving the messages. Looks like the connection object
>> the rabbit_stomp uses on the client is not responding.
>>
>
> I recommend you explore the state of your rabbit with the management ui.
> That should hopefully provide some clues as to where the messages are going
> astray.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120716/d065eb20/attachment.htm>

From meetprashanth437 at gmail.com  Mon Jul 16 18:15:48 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Mon, 16 Jul 2012 13:15:48 -0400
Subject: [rabbitmq-discuss] RabbitMQ SSL
In-Reply-To: <50043E41.4020605@rabbitmq.com>
References: <CAE8G+ySr0MaTgqoWkuoDxW0P1N=7HKmfKKACGOLtj1pi1xUpxA@mail.gmail.com>
	<50002D2D.7020907@rabbitmq.com>
	<CAE8G+yS99=RyFSZgL-Ldnf-hriN885xK2i0V6_kvwsVeAzoTdA@mail.gmail.com>
	<50043719.1080900@rabbitmq.com>
	<CAE8G+ySbTZYj1jiZPjd_BixnSZnULv85Hpg26x1om8ZzZfAWhQ@mail.gmail.com>
	<50043E41.4020605@rabbitmq.com>
Message-ID: <CAE8G+yTDbxhqkYBZb6AojbmG+s0-xOnvKQGjY4xSV_QFSY-T3g@mail.gmail.com>

Emile,

In the Perl module I am using
http://search.cpan.org/~jesus/Net-RabbitMQ-0.0.1/RabbitMQ.pm . I do not
have any ssl related configuration.
BTW I do not want any client authentication.
my purpose is just to encrypt the messages.

Thanks,
Prashanth.




On Mon, Jul 16, 2012 at 12:16 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 16/07/12 16:48, Prashanth wrote:
> > I am doing nothing on the client side for ssl,
> > except that now it connects to the ssl port.
>
> You have to use a client that is able to establish an SSL connection.
> Using a regular AMQP connection without any additional configuration and
> pointing it to port 5671 on the broker will not work. You might be able
> to use "stunnel" to provide encryption for a regular AMQP client.
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120716/1ec89af3/attachment.htm>

From francesco at rabbitmq.com  Mon Jul 16 18:24:04 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 16 Jul 2012 18:24:04 +0100
Subject: [rabbitmq-discuss] RabbitMQ SSL
In-Reply-To: <CAE8G+yTDbxhqkYBZb6AojbmG+s0-xOnvKQGjY4xSV_QFSY-T3g@mail.gmail.com>
References: <CAE8G+ySr0MaTgqoWkuoDxW0P1N=7HKmfKKACGOLtj1pi1xUpxA@mail.gmail.com>
	<50002D2D.7020907@rabbitmq.com>
	<CAE8G+yS99=RyFSZgL-Ldnf-hriN885xK2i0V6_kvwsVeAzoTdA@mail.gmail.com>
	<50043719.1080900@rabbitmq.com>
	<CAE8G+ySbTZYj1jiZPjd_BixnSZnULv85Hpg26x1om8ZzZfAWhQ@mail.gmail.com>
	<50043E41.4020605@rabbitmq.com>
	<CAE8G+yTDbxhqkYBZb6AojbmG+s0-xOnvKQGjY4xSV_QFSY-T3g@mail.gmail.com>
Message-ID: <87a9yz62mj.wl%francesco@rabbitmq.com>

At Mon, 16 Jul 2012 13:15:48 -0400,
Prashanth wrote:
> In the?Perl?module I am using?
> http://search.cpan.org/~jesus/Net-RabbitMQ-0.0.1/RabbitMQ.pm?. I do not have
> any ssl related configuration.
> BTW?I do not want any client?authentication. my?purpose?is?just?to?encrypt?the
> messages.

That Perl module does not support SSL. Same for rabbitmq-c, which Net::RabbitMQ
is based on.

--
Francesco * Often in error, never in doubt

From matthias at rabbitmq.com  Mon Jul 16 18:38:59 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Jul 2012 18:38:59 +0100
Subject: [rabbitmq-discuss] RabbitMQ replies not received to client
In-Reply-To: <CAOU_jKBpKmDaahzSzDt3L3Na8FsL0Op92C98T9gknEpJo=yr4A@mail.gmail.com>
References: <CAOU_jKBEcVmRYsdqoHtuS=sdSqx7-tFjgwzNzKVr=SD_1Be8nw@mail.gmail.com>
	<CAOU_jKD-8V-N-PkVVexCmkOor7EVBPd=awbC2e7H=VsZEAmtEg@mail.gmail.com>
	<4FFFEB86.10905@rabbitmq.com>
	<CAOU_jKBpKmDaahzSzDt3L3Na8FsL0Op92C98T9gknEpJo=yr4A@mail.gmail.com>
Message-ID: <500451B3.1040401@rabbitmq.com>

On 16/07/12 18:09, srikanth tns wrote:
> I was able to reproduce the issue on the rabbitmq log , I see this
> message reported for different channels on the log.
> Can you advice what is the issue and how can it be resolved?

Hard to tell from just a single log snippet. Please send a complete log 
file covering the period from starting the broker to when you first 
notice any problems.

Did you follow my suggestion and use the management UI to explore the 
state of the system?

Regards,

Matthias.

From matthias at rabbitmq.com  Mon Jul 16 19:03:29 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Jul 2012 19:03:29 +0100
Subject: [rabbitmq-discuss] Vanishing of persistent messages on durable,
 auto-deleting queue with dead-lettering
In-Reply-To: <5003EEF8.1070000@comarch.pl>
References: <4FEDD75D.1030808@comarch.pl> <4FF09592.20302@rabbitmq.com>
	<5003EEF8.1070000@comarch.pl>
Message-ID: <50045771.1070201@rabbitmq.com>

Ernest,

On 16/07/12 11:37, Ernest Staszuk wrote:
> 2012-07-01 20:23, Matthias Radestock writes:
>>
>> We deliberately kept the set of operations susceptible to
>> dead-lettering small, to avoid unintended consequences. It is possible
>> that actions like auto-deletion, queue lease expiry, explicit deletion
>> and purging should all trigger the dead-letter mechanism, but I'd like
>> to see compelling use cases first before making such a change.
>
> I will describe the case I am dealing with: We send some tasks to
> rabbit's exchange. To achieve load balancing at rpc servers
> x-consistent-hash is used. Auto-deleting queues with dead-lettering
> are fitting there perfectly, because when one of consuments goes down
> his queue is deleted and then new messages are distributed only
> between active consumers (due to auto-deleting) and also we can
> preserve badly processed commands for another try or examination in
> another queue (due to dead-lettering).

You do know that x-consistent-hash may lose some new messages when 
queues are deleted, right? See the docs for details.

Anyway, leaving that issue aside for the moment...

> But as consequence of choosing auto-deleting queue also some part of
> messages (which won't be dead-lettered when queue will be discarded).
> As there are cases when loosing messages is not an option I think if
> actual behavior is consistent with spirit of dead-lettering's aims
> (imho to save undeliverable messages).

Sounds reasonable. And I guess a similar case could be made for queue 
lease expiry. What about explicit deletion (i.e. invoking queue.delete) 
or purging (queue.purge)?

Regards,

Matthias.

From mpietrek at skytap.com  Mon Jul 16 21:23:31 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 16 Jul 2012 13:23:31 -0700
Subject: [rabbitmq-discuss] Hang while waiting for shutdown of last node in
	an HA cluster
Message-ID: <CACLE7ixB4mtMstpH8rpFxSfcc9VpQpE4ScA20P3EKu2BFFF2Ew@mail.gmail.com>

We have a 3 node cluster running 2.8.4 supporting a small number of HA
queues. During a controlled shutdown, we bring down each broker (play,
play2, util) in sequence using something along the lines of

rabbitmqctl stop <pidfile>

The first two brokers shut down without incident. The last shutdown gets
stuck and never finishes.

I see the beam.smp processes running for both the broker and rabbitmqctl
instance.

The log file has the following:

=INFO REPORT==== 16-Jul-2012::13:06:19 ===
rabbit on node rabbit at play2 down

=INFO REPORT==== 16-Jul-2012::13:06:19 ===
Mirrored-queue (queue 'unit_test' in vhost '/'): Master <rabbit at play.2.271.0>
saw deaths of mirrors <rabbit at play2.3.296.0>

=ERROR REPORT==== 16-Jul-2012::13:06:19 ===
** Generic server rabbit_node_monitor terminating
** Last message in was {'DOWN',#Ref<0.0.0.1578>,process,
                               {rabbit,rabbit at play2},
                               normal}
** When Server state == [rabbit at play2]
** Reason for termination ==
** {bad_return_value,
       {error,
           {badarg,
               [{erlang,is_process_alive,[<3173.371.0>]},
                {rabbit_amqqueue,'-on_node_down/1-fun-1-',8},
                {qlc,collect,1},
                {qlc,eval,2},
                {rabbit_amqqueue,'-on_node_down/1-fun-16-',1},
                {mnesia_tm,apply_fun,3},
                {mnesia_tm,execute_transaction,5},
                {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1}]}}}

=INFO REPORT==== 16-Jul-2012::13:06:19 ===
Mirrored-queue (queue 'fake_munger_queue' in vhost '/'): Master
<rabbit at play.2.270.0> saw deaths of mirrors <rabbit at play2.3.287.0>

=INFO REPORT==== 16-Jul-2012::13:06:19 ===
Mirrored-queue (queue 'random' in vhost '/'): Master <rabbit at play.2.269.0>
saw deaths of mirrors <rabbit at play2.3.278.0>

=INFO REPORT==== 16-Jul-2012::13:06:19 ===
Mirrored-queue (queue 'charon' in vhost '/'): Master <rabbit at play.2.276.0>
saw deaths of mirrors <rabbit at play2.3.291.0>

=INFO REPORT==== 16-Jul-2012::13:06:19 ===
Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Master
<rabbit at play.2.275.0> saw deaths of mirrors <rabbit at play2.3.289.0>

=INFO REPORT==== 16-Jul-2012::13:06:19 ===
Mirrored-queue (queue 'fake_service_2' in vhost '/'): Master
<rabbit at play.2.272.0> saw deaths of mirrors <rabbit at play2.3.275.0>

=INFO REPORT==== 16-Jul-2012::13:06:19 ===
Mirrored-queue (queue 'system_test' in vhost '/'): Master
<rabbit at play.2.277.0> saw deaths of mirrors <rabbit at play2.3.293.0>

=INFO REPORT==== 16-Jul-2012::13:06:19 ===
Mirrored-queue (queue 'fake_configmgr' in vhost '/'): Master
<rabbit at play.2.273.0> saw deaths of mirrors <rabbit at play2.3.281.0>

=INFO REPORT==== 16-Jul-2012::13:06:32 ===
    application: rabbitmq_tracing
    exited: stopped
    type: permanent

=INFO REPORT==== 16-Jul-2012::13:06:32 ===
Stopping Rabbit

--------

Since I've turned on Mnesia logging, the rabbitmq-server console spew is:

Mnesia(rabbit at play): Logging mnesia_down rabbit at play2
Mnesia(rabbit at play): Got mnesia_down from rabbit at play2, reconfiguring...
Mnesia(rabbit at play): Transaction {tid,1786,<0.176.0>} calling
#Fun<rabbit_mirror_queue_misc.0.102623438> with [] failed:
 {bad_commit,rabbit at play2}
Mnesia(rabbit at play): Restarting transaction {tid,1786,<0.176.0>}: in 2ms
{bad_commit,rabbit at play2}
Mnesia(rabbit at play): Transaction {tid,1785,<0.175.0>} calling
#Fun<rabbit_mirror_queue_misc.0.102623438> with [] failed:
 {bad_commit,rabbit at play2}
Mnesia(rabbit at play): Restarting transaction {tid,1785,<0.175.0>}: in 2ms
{bad_commit,rabbit at play2}
Mnesia(rabbit at play): write performed by {tid,1787,<0.176.0>} on record:
        {rabbit_queue,{resource,<<"/">>,queue,<<"fake_service_2">>},
                      true,false,none,
                      [{<<"x-ha-policy">>,longstr,<<"all">>}],
                      <0.272.0>,[],all}
Mnesia(rabbit at play): write performed by {tid,1787,<0.176.0>} on record:
        {rabbit_durable_queue,{resource,<<"/">>,queue,<<"fake_service_2">>},
                              true,false,none,
                              [{<<"x-ha-policy">>,longstr,<<"all">>}],
                              <0.272.0>,[],all}
Mnesia(rabbit at play): write performed by {tid,1788,<0.176.0>} on record:
        {rabbit_queue,{resource,<<"/">>,queue,<<"fake_queue">>},
                      true,false,none,
                      [{<<"x-ha-policy">>,longstr,<<"all">>}],
                      <0.270.0>,[],all}
Mnesia(rabbit at play): write performed by {tid,1788,<0.176.0>} on record:
        {rabbit_durable_queue,{resource,<<"/">>,queue,<<"fake_queue">>},
                              true,false,none,
                              [{<<"x-ha-policy">>,longstr,<<"all">>}],
                              <0.270.0>,[],all}
Mnesia(rabbit at play): write performed by {tid,1789,<0.175.0>} on record:
        {rabbit_queue,{resource,<<"/">>,queue,<<"CM">>},
                      true,false,none,
                      [{<<"x-ha-policy">>,longstr,<<"all">>}],
                      <0.275.0>,[],all}
Mnesia(rabbit at play): write performed by {tid,1789,<0.175.0>} on record:
        {rabbit_durable_queue,
            {resource,<<"/">>,queue,<<"CM">>},
            true,false,none,
            [{<<"x-ha-policy">>,longstr,<<"all">>}],
            <0.275.0>,[],all}
Mnesia(rabbit at play): write performed by {tid,1790,<0.175.0>} on record:
        {rabbit_queue,{resource,<<"/">>,queue,<<"cha">>},
                      true,false,none,
                      [{<<"x-ha-policy">>,longstr,<<"all">>}],
                      <0.276.0>,[],all}
Mnesia(rabbit at play): write performed by {tid,1790,<0.175.0>} on record:
        {rabbit_durable_queue,{resource,<<"/">>,queue,<<"cha">>},
                              true,false,none,
                              [{<<"x-ha-policy">>,longstr,<<"all">>}],
                              <0.276.0>,[],all}
Mnesia(rabbit at play): write performed by {tid,1791,<0.175.0>} on record:
        {rabbit_queue,{resource,<<"/">>,queue,<<"random">>},
                      true,false,none,
                      [{<<"x-ha-policy">>,longstr,<<"all">>}],
                      <0.269.0>,[],all}
Mnesia(rabbit at play): write performed by {tid,1791,<0.175.0>} on record:
        {rabbit_durable_queue,{resource,<<"/">>,queue,<<"random">>},
                              true,false,none,
                              [{<<"x-ha-policy">>,longstr,<<"all">>}],
                              <0.269.0>,[],all}
Mnesia(rabbit at play): write performed by {tid,1793,<0.175.0>} on record:
        {rabbit_queue,{resource,<<"/">>,queue,<<"system_test">>},
                      true,false,none,
                      [{<<"x-ha-policy">>,longstr,<<"all">>}],
                      <0.277.0>,[],all}
Mnesia(rabbit at play): write performed by {tid,1793,<0.175.0>} on record:
        {rabbit_durable_queue,{resource,<<"/">>,queue,<<"system_test">>},
                              true,false,none,
                              [{<<"x-ha-policy">>,longstr,<<"all">>}],
                              <0.277.0>,[],all}
Mnesia(rabbit at play): Transaction {tid,1794,<0.175.0>} calling
#Fun<rabbit_amqqueue.22.63484291> with [] failed:
 {badarg,[{erlang,is_process_alive,[<3173.371.0>]},
          {rabbit_amqqueue,'-on_node_down/1-fun-1-',8},
          {qlc,collect,1},
          {qlc,eval,2},
          {rabbit_amqqueue,'-on_node_down/1-fun-16-',1},
          {mnesia_tm,apply_fun,3},
          {mnesia_tm,execute_transaction,5},
          {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1}]}
Mnesia(rabbit at play): write performed by {tid,1792,<0.176.0>} on record:
        {rabbit_queue,{resource,<<"/">>,queue,<<"fake_CM">>},
                      true,false,none,
                      [{<<"x-ha-policy">>,longstr,<<"all">>}],
                      <0.273.0>,[],all}
Mnesia(rabbit at play): write performed by {tid,1792,<0.176.0>} on record:
        {rabbit_durable_queue,{resource,<<"/">>,queue,<<"fake_CM">>},
                              true,false,none,
                              [{<<"x-ha-policy">>,longstr,<<"all">>}],
                              <0.273.0>,[],all}
Mnesia(rabbit at play): Transaction log dump initiated by time_threshold:
{needs_dump,45}
Mnesia(rabbit at play): Transaction log dump initiated by time_threshold:
already_dumped
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120716/7aed47de/attachment.htm>

From JasonWainwright at gamestop.com  Mon Jul 16 21:24:24 2012
From: JasonWainwright at gamestop.com (Jason Wainwright)
Date: Mon, 16 Jul 2012 20:24:24 +0000
Subject: [rabbitmq-discuss] Sorry if this is a newbie question.
Message-ID: <5C5ED9BB2C04B943BD729B82E9B6C8CE22CDAE8D@GV1HQPEX03.babgsetc.pvt>

I have researching Federations and Shovels for a week or so now, but neither seem to fit or work the way I expect them to.  Which is probably a misunderstanding on my part of how they were intended to be used.
I want to create a distributed pub\sub messaging system that talks broker to broker in a one to many fashion. In essence, I would like Broker A to publish messages on Queue 1, which, in turn, pushes messages to Broker B and C on Queue 1.  A pub\sub on the broker level.
After reading these Federation notes and reviews:
http://hg.rabbitmq.com/rabbitmq-federation/file/rabbitmq_v2_5_0_preview/README
http://www.rabbitmq.com/blog/2011/06/22/federation-plugin-preview-release/
http://www.rabbitmq.com/federation.html
, I have come to the, possibly misguided, conclusion that the federation is designed in the reverse. (i.e. Brokers B and C publish to Queue 1 which in turn pushes messages to Broker A on Queue 1) More of a many to one design.
During my research I thought Shovel might have been the answer, but I found the it worked well creating a one to one connection, not one to many.
Is this correct, or am I missing something?

I have been successful in installing and configuring both of these plugins in a basic configuration, it was the behavior that was unexpected. I have not ruled out misconfiguration.
Any help would be appreciated.
Thanks,
Jason

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120716/013ea983/attachment.htm>

From matthias at rabbitmq.com  Mon Jul 16 21:26:03 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Jul 2012 21:26:03 +0100
Subject: [rabbitmq-discuss] RabbitMQ replies not received to client
In-Reply-To: <CAOU_jKDZzPEFu5bEuTdA_Y9bNA_tF1SftkSBeFs_Sdng940wMQ@mail.gmail.com>
References: <CAOU_jKBEcVmRYsdqoHtuS=sdSqx7-tFjgwzNzKVr=SD_1Be8nw@mail.gmail.com>
	<CAOU_jKD-8V-N-PkVVexCmkOor7EVBPd=awbC2e7H=VsZEAmtEg@mail.gmail.com>
	<4FFFEB86.10905@rabbitmq.com>
	<CAOU_jKBpKmDaahzSzDt3L3Na8FsL0Op92C98T9gknEpJo=yr4A@mail.gmail.com>
	<500451B3.1040401@rabbitmq.com>
	<CAOU_jKDZzPEFu5bEuTdA_Y9bNA_tF1SftkSBeFs_Sdng940wMQ@mail.gmail.com>
Message-ID: <500478DB.9030904@rabbitmq.com>

(putting the list back on cc)

On 16/07/12 21:16, srikanth tns wrote:
> Here is the complete log file attached.

Thanks. There isn't anything unusual in there. Looks like the "dropping 
method ..." log entries are just due to clients disconnecting.

> I have tried installing the management UI and got this error. Looks like
> I need to update my Erlang . Is it so?

Yes. As I mentioned earlier, please upgrade. R15B01 is the latest; grab 
that if you can.


Matthias.

From srikanthtns at gmail.com  Mon Jul 16 21:33:38 2012
From: srikanthtns at gmail.com (srikanth tns)
Date: Mon, 16 Jul 2012 13:33:38 -0700
Subject: [rabbitmq-discuss] RabbitMQ replies not received to client
In-Reply-To: <500478DB.9030904@rabbitmq.com>
References: <CAOU_jKBEcVmRYsdqoHtuS=sdSqx7-tFjgwzNzKVr=SD_1Be8nw@mail.gmail.com>
	<CAOU_jKD-8V-N-PkVVexCmkOor7EVBPd=awbC2e7H=VsZEAmtEg@mail.gmail.com>
	<4FFFEB86.10905@rabbitmq.com>
	<CAOU_jKBpKmDaahzSzDt3L3Na8FsL0Op92C98T9gknEpJo=yr4A@mail.gmail.com>
	<500451B3.1040401@rabbitmq.com>
	<CAOU_jKDZzPEFu5bEuTdA_Y9bNA_tF1SftkSBeFs_Sdng940wMQ@mail.gmail.com>
	<500478DB.9030904@rabbitmq.com>
Message-ID: <CAOU_jKANW+ZMvRGKUszYqMJNGo7SDb6RyPnSzeXP=DDqu_S+Hw@mail.gmail.com>

Thanks Matthias , do we know why the clients are disconnecting ?
Also when I upgrade the Erlang version , should I upgrade rabbitmq server
also to the latest ?

On Mon, Jul 16, 2012 at 1:26 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> (putting the list back on cc)
>
>
> On 16/07/12 21:16, srikanth tns wrote:
>
>> Here is the complete log file attached.
>>
>
> Thanks. There isn't anything unusual in there. Looks like the "dropping
> method ..." log entries are just due to clients disconnecting.
>
>
>  I have tried installing the management UI and got this error. Looks like
>> I need to update my Erlang . Is it so?
>>
>
> Yes. As I mentioned earlier, please upgrade. R15B01 is the latest; grab
> that if you can.
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120716/8da18bc9/attachment.htm>

From matthias at rabbitmq.com  Mon Jul 16 21:39:47 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Jul 2012 21:39:47 +0100
Subject: [rabbitmq-discuss] RabbitMQ replies not received to client
In-Reply-To: <CAOU_jKANW+ZMvRGKUszYqMJNGo7SDb6RyPnSzeXP=DDqu_S+Hw@mail.gmail.com>
References: <CAOU_jKBEcVmRYsdqoHtuS=sdSqx7-tFjgwzNzKVr=SD_1Be8nw@mail.gmail.com>
	<CAOU_jKD-8V-N-PkVVexCmkOor7EVBPd=awbC2e7H=VsZEAmtEg@mail.gmail.com>
	<4FFFEB86.10905@rabbitmq.com>
	<CAOU_jKBpKmDaahzSzDt3L3Na8FsL0Op92C98T9gknEpJo=yr4A@mail.gmail.com>
	<500451B3.1040401@rabbitmq.com>
	<CAOU_jKDZzPEFu5bEuTdA_Y9bNA_tF1SftkSBeFs_Sdng940wMQ@mail.gmail.com>
	<500478DB.9030904@rabbitmq.com>
	<CAOU_jKANW+ZMvRGKUszYqMJNGo7SDb6RyPnSzeXP=DDqu_S+Hw@mail.gmail.com>
Message-ID: <50047C13.2080307@rabbitmq.com>

On 16/07/12 21:33, srikanth tns wrote:
> Thanks Matthias , do we know why the clients are disconnecting ?

Nope. You'd have to look at the client end.

> Also when I upgrade the Erlang version , should I upgrade rabbitmq
> server also to the latest ?

For some reason I thought you had done so already. Yes, please upgrade. 
As I mentioned, there have been many important bug fixes and 
improvements since 2.3.1.

Regards,

Matthias.

From matthias at rabbitmq.com  Mon Jul 16 22:33:15 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Jul 2012 22:33:15 +0100
Subject: [rabbitmq-discuss] Hang while waiting for shutdown of last node
 in an HA cluster
In-Reply-To: <CACLE7ixB4mtMstpH8rpFxSfcc9VpQpE4ScA20P3EKu2BFFF2Ew@mail.gmail.com>
References: <CACLE7ixB4mtMstpH8rpFxSfcc9VpQpE4ScA20P3EKu2BFFF2Ew@mail.gmail.com>
Message-ID: <5004889B.7010306@rabbitmq.com>

Matt,

On 16/07/12 21:23, Matt Pietrek wrote:
> We have a 3 node cluster running 2.8.4 supporting a small number of HA
> queues. During a controlled shutdown, we bring down each broker (play,
> play2, util) in sequence using something along the lines of
>
> rabbitmqctl stop <pidfile>
>
> The first two brokers shut down without incident. The last shutdown gets
> stuck and never finishes.
> [...]
> =ERROR REPORT==== 16-Jul-2012::13:06:19 ===
> ** Generic server rabbit_node_monitor terminating
> ** Last message in was {'DOWN',#Ref<0.0.0.1578>,process,
>                                 {rabbit,rabbit at play2},
>                                 normal}
> ** When Server state == [rabbit at play2]
> ** Reason for termination ==
> ** {bad_return_value,
>         {error,
>             {badarg,
>                 [{erlang,is_process_alive,[<3173.371.0>]},
>                  {rabbit_amqqueue,'-on_node_down/1-fun-1-',8},

Eeek. That's a bug that got introduced in 2.8.3. I cannot see atm why 
that would cause 'stop' to get stuck, but I wouldn't rule it out. Thanks 
for reporting this.

Regards,

Matthias.

From Saravana.Prabhu at emc.com  Tue Jul 17 08:21:45 2012
From: Saravana.Prabhu at emc.com (Saravana.Prabhu at emc.com)
Date: Tue, 17 Jul 2012 03:21:45 -0400
Subject: [rabbitmq-discuss] RabbitMQ Aliveness Test vs Monitoring RabbitMQ
	Process
Message-ID: <978435FA08D0814BAD1CBA3899FE9FB4046B603AED@MX26A.corp.emc.com>

Hi,

We are planning to use Aliveness Test to verify the status of the RabbitMQ Message Broker and initiate corrective action if the aliveness test has not succeeded.

The other thought is to develop a Process Monitor that monitors RabbitMQ process and initiate Broker Restart when necessary.

I would like to know if we can have scenarios where Broker Process will be up and running, but it could not be able to publish and receive messages due to unknown reasons.

Please clarify what value-add the Aliveness Test provides to system than monitoring the RabbitMQ process and restarting it when necessary.

Thanks,
Prabhu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120717/6a12b291/attachment.htm>

From jpcustin at gmail.com  Tue Jul 17 00:41:52 2012
From: jpcustin at gmail.com (SenseiC)
Date: Mon, 16 Jul 2012 16:41:52 -0700 (PDT)
Subject: [rabbitmq-discuss] So who's Judy and what does she have to do with
 the High Speed TCP driver for Erlang?
Message-ID: <201c004f-5a1a-4b84-841c-ec8123f413d4@googlegroups.com>





 Line 20 of hstcp/c_src/hstcp.c has:

#include <Judy.h>

Comes as no surprise... that file doesn't exist and the build comes to a 
grinding halt.


SenseiC
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120716/71fda8a2/attachment.htm>

From matwey.kornilov at gmail.com  Tue Jul 17 10:30:00 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Tue, 17 Jul 2012 13:30 +0400
Subject: [rabbitmq-discuss] JSON-RPC plugin crash
Message-ID: <ju3bap$cat$1@dough.gmane.org>


Hi,

I am experiencing troubles with the plugin.

I am running erlang R15B01 (from esl-erlang package for lucid ubuntu) and 
rabbitmq-server-2.8.4 (deb package from rabbitmq.com).
Crash reposrt is the following. How to cope with this issue?

=CRASH REPORT==== 17-Jul-2012::13:14:29 ===
  crasher:
    initial call: mochiweb_acceptor:init/3
    pid: <0.7285.0>
    registered_name: []
    exception error: undefined function 
mochiweb_request:accepts_content_type/2
      in function  rfc4627_jsonrpc_mochiweb:handle/2 
      in call from rabbit_jsonrpc:'-start/2-fun-0-'/3 
      in call from mochiweb_http:headers/5 
    ancestors: ['rabbit_mochiweb_web_*',rabbit_mochiweb_sup,<0.136.0>]
    messages: []
    links: [<0.147.0>,#Port<0.6461>]
    dictionary: [{mochiweb_request_body,undefined},
                  {mochiweb_request_qs,[]},
                  {mochiweb_request_path,"/rpc/rabbitmq"}]
    trap_exit: false
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 2433
  neighbours:


From emile at rabbitmq.com  Tue Jul 17 10:34:23 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 17 Jul 2012 10:34:23 +0100
Subject: [rabbitmq-discuss] So who's Judy and what does she have to do
 with the High Speed TCP driver for Erlang?
In-Reply-To: <201c004f-5a1a-4b84-841c-ec8123f413d4@googlegroups.com>
References: <201c004f-5a1a-4b84-841c-ec8123f413d4@googlegroups.com>
Message-ID: <5005319F.6090305@rabbitmq.com>

Hi,

On 17/07/12 00:41, SenseiC wrote:
>  Line 20 of hstcp/c_src/hstcp.c has:
> 
> #include <Judy.h>
> 
> Comes as no surprise... that file doesn't exist and the build comes to a
> grinding halt.

See her page here: http://judy.sourceforge.net/
On Debian (and derived distributions) the required package name is
libJudy-dev. Make sure you get libev at the same time:
http://software.schmorp.de/pkg/libev.html


-Emile


From simon at rabbitmq.com  Tue Jul 17 10:59:25 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jul 2012 10:59:25 +0100
Subject: [rabbitmq-discuss] So who's Judy and what does she have to do
 with the High Speed TCP driver for Erlang?
In-Reply-To: <5005319F.6090305@rabbitmq.com>
References: <201c004f-5a1a-4b84-841c-ec8123f413d4@googlegroups.com>
	<5005319F.6090305@rabbitmq.com>
Message-ID: <5005377D.6000409@rabbitmq.com>

On 17/07/12 10:34, Emile Joubert wrote:
> On 17/07/12 00:41, SenseiC wrote:
>>   Line 20 of hstcp/c_src/hstcp.c has:
>>
>> #include<Judy.h>
>>
>> Comes as no surprise... that file doesn't exist and the build comes to a
>> grinding halt.
>
> See her page here: http://judy.sourceforge.net/
> On Debian (and derived distributions) the required package name is
> libJudy-dev. Make sure you get libev at the same time:
> http://software.schmorp.de/pkg/libev.html

However: it's worth pointing out that hstcp is experimental, does not 
form part of any release, and will be removed altogether in the future. 
So if the OP is just trying to build all the plugins from 
rabbitmq-public-umbrella, rather than being genuinely interested in 
hstcp, it may be easier just to invoke "make release" in the umbrella 
rather than "make all".

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From joeydewd at gmail.com  Tue Jul 17 10:46:17 2012
From: joeydewd at gmail.com (JoeyAdmin)
Date: Tue, 17 Jul 2012 02:46:17 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and Powershell via PoshRabbit,
	not working correctly
Message-ID: <c0c6a034-bec6-45d7-9121-a65fe26d1e77@googlegroups.com>

Hey everyone!

I'm working on a project where I need to connect two powershells via each 
other using RabbitMQ. I'm using an opensource module called PoshRabbit 
(http://poshrabbit.codeplex.com/) and
I'm hoping any one of you has experience with this module or can see what 
I'm doing wrong without knowing the module. 

I am making connections and can see the queue's being created but for some 
reason I can't publish or retrieve any messages from my queues. Can you see 
what I'm doing wrong since I'm following every step.

import-module poshrabbit;
$pass = ConvertTo-SecureString "pass" -AsPlainText -Force;
$q = start-consumer -queuename 'Test' -name 'Testing' -hostname 'localhost' 
-username 'Joey2' -password $pass -exchange posh -routingkey 'prefix.#';

$a=@{
hostname = 'localhost';
exchange = 'posh';
routingkey = 'prefix.#';
};

this works fine without returning any errors and calling $q returns info 
about the queue so that should be fine.

However, 
publish-string @a -message 'hoi'; 

returns the following error:

Publish-RabbitMessage : None of the specified endpoints were reacable
at ...... \poshrabbit-functions.ps1:717 char:24
+    public-rabbitMessage <<<<  local :a;
....

Any help would be much appreciated since I'm stuck here!

Thanks in advance!
-Joey :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120717/cdd365a8/attachment.htm>

From emile at rabbitmq.com  Tue Jul 17 11:11:36 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 17 Jul 2012 11:11:36 +0100
Subject: [rabbitmq-discuss] RabbitMQ Aliveness Test vs Monitoring
 RabbitMQ Process
In-Reply-To: <978435FA08D0814BAD1CBA3899FE9FB4046B603AED@MX26A.corp.emc.com>
References: <978435FA08D0814BAD1CBA3899FE9FB4046B603AED@MX26A.corp.emc.com>
Message-ID: <50053A58.4020400@rabbitmq.com>

Hi,

On 17/07/12 08:21, Saravana.Prabhu at emc.com wrote:
> I would like to know if we can have scenarios where Broker Process will
> be up and running, but it could not be able to publish and receive
> messages due to unknown reasons.

The API documentation has an explanation of what it does:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/default/priv/www/api/index.html

The aliveness test sends and receives a message. This is a more
meaningful (and more expensive) test than checking an OS PID. It only
makes sense to monitor the OS PID if you expect a crash so dramatic that
the entire Erlang VM crashes. This can happen e.g. in an out-of-memory
scenario, but there are many failure modes that could cause the broker
to stop working while the OS PID of the Erlang VM remains running. So I
suggest using the aliveness test instead.


-Emile


From emile at rabbitmq.com  Tue Jul 17 11:33:53 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 17 Jul 2012 11:33:53 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Powershell via PoshRabbit,
 not working correctly
In-Reply-To: <c0c6a034-bec6-45d7-9121-a65fe26d1e77@googlegroups.com>
References: <c0c6a034-bec6-45d7-9121-a65fe26d1e77@googlegroups.com>
Message-ID: <50053F91.9080001@rabbitmq.com>

Hi,

On 17/07/12 10:46, JoeyAdmin wrote:
> $a=@{
> hostname = 'localhost';
> exchange = 'posh';
> routingkey = 'prefix.#';
> };

> publish-string @a -message 'hoi';

I think you have used different snippets together incorrectly. The
example from the blog has a valid publishing routing key:

  routingkey = 'prefix.batch-0_o';


I found that here:

http://www.beefycode.com/post/consuming-rabbitmq-messages-in-powershell.aspx


-Emile


From Saravana.Prabhu at emc.com  Tue Jul 17 11:38:23 2012
From: Saravana.Prabhu at emc.com (Saravana.Prabhu at emc.com)
Date: Tue, 17 Jul 2012 06:38:23 -0400
Subject: [rabbitmq-discuss] RabbitMQ Aliveness Test vs Monitoring
 RabbitMQ Process
In-Reply-To: <50053A58.4020400@rabbitmq.com>
References: <978435FA08D0814BAD1CBA3899FE9FB4046B603AED@MX26A.corp.emc.com>
	<50053A58.4020400@rabbitmq.com>
Message-ID: <978435FA08D0814BAD1CBA3899FE9FB4046B603B10@MX26A.corp.emc.com>

Thanks a ton for the response...

Regards,
Prabhu

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: Tuesday, July 17, 2012 3:42 PM
To: Discussions about RabbitMQ
Cc: Prabhu, Saravana
Subject: Re: [rabbitmq-discuss] RabbitMQ Aliveness Test vs Monitoring RabbitMQ Process

Hi,

On 17/07/12 08:21, Saravana.Prabhu at emc.com wrote:
> I would like to know if we can have scenarios where Broker Process will
> be up and running, but it could not be able to publish and receive
> messages due to unknown reasons.

The API documentation has an explanation of what it does:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/default/priv/www/api/index.html

The aliveness test sends and receives a message. This is a more
meaningful (and more expensive) test than checking an OS PID. It only
makes sense to monitor the OS PID if you expect a crash so dramatic that
the entire Erlang VM crashes. This can happen e.g. in an out-of-memory
scenario, but there are many failure modes that could cause the broker
to stop working while the OS PID of the Erlang VM remains running. So I
suggest using the aliveness test instead.


-Emile



From zabrane3 at gmail.com  Tue Jul 17 11:46:36 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Tue, 17 Jul 2012 12:46:36 +0200
Subject: [rabbitmq-discuss] So who's Judy and what does she have to do
	with the High Speed TCP driver for Erlang?
In-Reply-To: <5005377D.6000409@rabbitmq.com>
References: <201c004f-5a1a-4b84-841c-ec8123f413d4@googlegroups.com>
	<5005319F.6090305@rabbitmq.com> <5005377D.6000409@rabbitmq.com>
Message-ID: <9E6CC7A7-8F1E-4107-8083-CFAF1A9B4298@gmail.com>

Hi guys,

HSTCP was designed for what?
Could someone explain its purpose and how one can build it outside RabbitMQ?

Regards,
Zabrane

On Jul 17, 2012, at 11:59 AM, Simon MacMullen wrote:

> On 17/07/12 10:34, Emile Joubert wrote:
>> On 17/07/12 00:41, SenseiC wrote:
>>>  Line 20 of hstcp/c_src/hstcp.c has:
>>> 
>>> #include<Judy.h>
>>> 
>>> Comes as no surprise... that file doesn't exist and the build comes to a
>>> grinding halt.
>> 
>> See her page here: http://judy.sourceforge.net/
>> On Debian (and derived distributions) the required package name is
>> libJudy-dev. Make sure you get libev at the same time:
>> http://software.schmorp.de/pkg/libev.html
> 
> However: it's worth pointing out that hstcp is experimental, does not form part of any release, and will be removed altogether in the future. So if the OP is just trying to build all the plugins from rabbitmq-public-umbrella, rather than being genuinely interested in hstcp, it may be easier just to invoke "make release" in the umbrella rather than "make all".
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Tue Jul 17 14:22:30 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Jul 2012 14:22:30 +0100
Subject: [rabbitmq-discuss] So who's Judy and what does she have to do
 with the High Speed TCP driver for Erlang?
In-Reply-To: <9E6CC7A7-8F1E-4107-8083-CFAF1A9B4298@gmail.com>
References: <201c004f-5a1a-4b84-841c-ec8123f413d4@googlegroups.com>	<5005319F.6090305@rabbitmq.com>
	<5005377D.6000409@rabbitmq.com>
	<9E6CC7A7-8F1E-4107-8083-CFAF1A9B4298@gmail.com>
Message-ID: <50056716.7090302@rabbitmq.com>

On 17/07/12 11:46, Zabrane Mickael wrote:
> HSTCP was designed for what?

At one point we believed that the standard Erlang TCP implementation was 
not fast enough. hstcp was an attempt to get TCP to go faster.

However, recent improvements to our use of the standard Erlang TCP 
implementation have improved Rabbit's performance to the point where 
hstcp doesn't gain anything, so we're abandoning hstcp.

> Could someone explain its purpose and how one can build it outside RabbitMQ?

It requires the public umbrella - you can build it like any other 
plugin. But I wouldn't bother.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From zabrane3 at gmail.com  Tue Jul 17 14:34:10 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Tue, 17 Jul 2012 15:34:10 +0200
Subject: [rabbitmq-discuss] So who's Judy and what does she have to do
	with the High Speed TCP driver for Erlang?
In-Reply-To: <50056716.7090302@rabbitmq.com>
References: <201c004f-5a1a-4b84-841c-ec8123f413d4@googlegroups.com>	<5005319F.6090305@rabbitmq.com>
	<5005377D.6000409@rabbitmq.com>
	<9E6CC7A7-8F1E-4107-8083-CFAF1A9B4298@gmail.com>
	<50056716.7090302@rabbitmq.com>
Message-ID: <134FCEEF-BDC9-4F68-97BD-42D6A57A010F@gmail.com>

Hi Simon,

> At one point we believed that the standard Erlang TCP implementation was not fast enough. hstcp was an attempt to get TCP to go faster.

OK I see.

> However, recent improvements to our use of the standard Erlang TCP implementation have improved Rabbit's performance to the point where hstcp doesn't gain anything, so we're abandoning hstcp.

Are these improvements documented somewhere?
Even source files I can have look into.

Regards,
Zabrane


From emile at rabbitmq.com  Tue Jul 17 14:51:43 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 17 Jul 2012 14:51:43 +0100
Subject: [rabbitmq-discuss] JSON-RPC plugin crash
In-Reply-To: <ju3bap$cat$1@dough.gmane.org>
References: <ju3bap$cat$1@dough.gmane.org>
Message-ID: <50056DEF.6070005@rabbitmq.com>

Hi,

On 17/07/12 10:30, Matwey V. Kornilov wrote:
> I am running erlang R15B01 (from esl-erlang package for lucid ubuntu) and 
> rabbitmq-server-2.8.4 (deb package from rabbitmq.com).
> Crash reposrt is the following. How to cope with this issue?

Thanks for reporting this. This report looks very similar to a bug that
was fixed recently. These fixes were made on branches named "bug25050"
and will be included in a future release.


-Emile



From francesco at rabbitmq.com  Tue Jul 17 15:02:20 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 17 Jul 2012 15:02:20 +0100
Subject: [rabbitmq-discuss] building system architecture
In-Reply-To: <4FFFDD21.8030205@rosalab.ru>
References: <4FFFDD21.8030205@rosalab.ru>
Message-ID: <87r4sapjtf.wl%francesco@rabbitmq.com>

Hi Anton,

At Fri, 13 Jul 2012 12:32:33 +0400,
Anton Kirilenko wrote:
> 1) Every building client can process its task for an hour or more. Is it 
> correct to send ACK only after the building is done?

That should not pose any particular problem, unless you have a considerable
amount of acks piling up and thus occupying memory on the broker.

> 2) Now I've got one queue for each combination of building platform and
> architecture. Lots of client consume from it. But I need a task scheduling
> mechanism (send all the task to queue when we get them is not a good idea),
> ability to stop building... It looks like I need separate queue for every
> client (it can be exclusive consumer for every queue).  Is it possible to
> configure RabbitMQ to close the queue and notify building server (that have
> sent the message) about it?

Check the `auto-delete' field in the AMQP `queue.declare' method. I am not sure
what you mean with "notifying the building server".

If you mean that you want to notify the publisher when the queue the published
on has been deleted, then you can't do that - the publisher has no knowledge
about which queue(s) he's publishing in anyway. In general the only messages
you'll get from the broker to a publisher are return messages after a publish.

You can, however, be notified if the message you are publishing could not be
routed using the `mandatory' flag.

You can also be notified on the consumer side about queue deletion, see
http://www.rabbitmq.com/extensions.html#consumer-cancel-notify .

> The important thing: it's very bad for the system to loose building 
> tasks. In case of client failure RabbitMQ should notify server,

As said before, publishers and consumers are very decoupled, so this is not
possible.

> in case of RabbitMQ failure (or connection failure) server should know that
> the task was not processed well and resend it to another client.

It seems here that you are referring to RabbitMQ and "server" as different
entities, when they are the same thing.

In any case, you can have strong guarantees about the delivery of messages, for
example using durable queues and publisher confirms:
http://www.rabbitmq.com/extensions.html#publishing .

> In other words - after building server have sent the message, it should be
> notified if the task was not (and will never be) processed.

Again it's not clear to me what you mean here. It seems to me that a
one-queue-per-client solution with publisher confirms would suffice in your
case. You have strong guarantees against the loss of messages, and you can ack
the messages once you've finished building. If rabbit fails, you know that the
messages are persisted and thus they won't be lost. If the consumer fails, the
messages pending acks will be redelivered to the next consumer (with a
`redeliver' flag to indicate that the messages was sent before).

--
Francesco * Often in error, never in doubt

From matthias at rabbitmq.com  Tue Jul 17 15:11:42 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 17 Jul 2012 15:11:42 +0100
Subject: [rabbitmq-discuss] JSON-RPC plugin crash
In-Reply-To: <50056DEF.6070005@rabbitmq.com>
References: <ju3bap$cat$1@dough.gmane.org> <50056DEF.6070005@rabbitmq.com>
Message-ID: <5005729E.7020400@rabbitmq.com>

Matwey,

On 17/07/12 14:51, Emile Joubert wrote:
> On 17/07/12 10:30, Matwey V. Kornilov wrote:
>> I am running erlang R15B01 (from esl-erlang package for lucid ubuntu) and
>> rabbitmq-server-2.8.4 (deb package from rabbitmq.com).
>> Crash reposrt is the following. How to cope with this issue?
>
> Thanks for reporting this. This report looks very similar to a bug that
> was fixed recently. These fixes were made on branches named "bug25050"
> and will be included in a future release.

There's a workaround described at 
http://rabbitmq.1065348.n5.nabble.com/JSON-RPC-RPC-endpoint-responds-with-not-found-tp20670p20679.html

However, I strongly recommend looking at 
http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/ 
as an alternative to the rabbitmq-jsonrpc-channel plug-in.

Regards,

Matthias.

From emile at rabbitmq.com  Tue Jul 17 15:27:28 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 17 Jul 2012 15:27:28 +0100
Subject: [rabbitmq-discuss] Sorry if this is a newbie question.
In-Reply-To: <5C5ED9BB2C04B943BD729B82E9B6C8CE22CDAE8D@GV1HQPEX03.babgsetc.pvt>
References: <5C5ED9BB2C04B943BD729B82E9B6C8CE22CDAE8D@GV1HQPEX03.babgsetc.pvt>
Message-ID: <50057650.5020503@rabbitmq.com>

Hi,

On 16/07/12 21:24, Jason Wainwright wrote:
> I want to create a distributed pub\sub messaging system that talks
> broker to broker in a one to many fashion. In essence, I would like
> Broker A to publish messages on Queue 1, which, in turn, pushes messages
> to Broker B and C on Queue 1.  A pub\sub on the broker level.

Remember that messages are published to an exchange, not a queue.

> http://hg.rabbitmq.com/rabbitmq-federation/file/rabbitmq_v2_5_0_preview/README
> http://www.rabbitmq.com/blog/2011/06/22/federation-plugin-preview-release/
> http://www.rabbitmq.com/federation.html

For a useful comparison of different distribution methods also look at
http://www.rabbitmq.com/distributed.html

> , I have come to the, possibly misguided, conclusion that the federation
> is designed in the reverse. (i.e. Brokers B and C publish to Queue 1
> which in turn pushes messages to Broker A on Queue 1) More of a many to
> one design.

Federation supports many topologies, including fanout, which is what you
are aiming for. For examples of this and other topologies see
http://www.rabbitmq.com/federation.html#topology-diagrams

> During my research I thought Shovel might have been the answer, but I
> found the it worked well creating a one to one connection, not one to many.

It is possible to set up separate shovels for multiple downstream
brokers and configure a binding and queue for each in such a way that a
message to the upstream exchange gets relayed by each shovel.


-Emile



From thiagoburgo at gmail.com  Tue Jul 17 16:09:37 2012
From: thiagoburgo at gmail.com (Thiago Burgo Belo)
Date: Tue, 17 Jul 2012 12:09:37 -0300
Subject: [rabbitmq-discuss] My cluter node (ram node) down in my
 performance test
In-Reply-To: <CABjKUK_wqPdASfmjnFopWLr6tw109DKypqZ-XPwSHVTaCQ38ew@mail.gmail.com>
References: <CABjKUK9j23ia9foMSDUTBXa+y6-ypF86d6Wzy9PZr=dAkxG-7Q@mail.gmail.com>
	<4FF6F10F.6080107@rabbitmq.com>
	<CABjKUK_Bfdo=Au1CR440YcEWkB6vTts-Le6G1HVYo7QqRXrWhA@mail.gmail.com>
	<CABjKUK-8Gx_4Rt4Uu=VDg5-iXAHQ7HNUB=b8toeeCSdjBaO_zg@mail.gmail.com>
	<4FF76401.1020900@rabbitmq.com> <4FFBC015.1090506@rabbitmq.com>
	<CABjKUK-XNiYZZ1AY7=i+rHTdO9Y7zrHprMCG67ay7qQtgXnYaQ@mail.gmail.com>
	<4FFC91BF.6020309@rabbitmq.com>
	<CABjKUK84uDdt=7oqT77b23Cqe6uvC2_NKe=NMJk1s8sZbLjb8A@mail.gmail.com>
	<CABjKUK_wqPdASfmjnFopWLr6tw109DKypqZ-XPwSHVTaCQ38ew@mail.gmail.com>
Message-ID: <CABjKUK_Q-eJHvss3Hnmq9A-irz3vqTVYSWZVEk5Amxq04s=GaA@mail.gmail.com>

Link to log

https://skydrive.live.com/redir?resid=E7129E57616CE33A!4492&authkey=!AB9nHGtNRRUeC94

2012/7/17 Thiago Burgo Belo <thiagoburgo at gmail.com>

> Matthias,
>
> See the log in attachment, if you discover the problem publish the
> solution here ;)
>
> Thanks,
> Thiago Burgo
>
> 2012/7/10 Thiago Burgo Belo <thiagoburgo at gmail.com>
>
>> All right, is missing...
>>
>> I Will send for you tomorrow. Now I can`t get the logs.
>>
>> Thiago Burgo
>>
>>
>> 2012/7/10 Matthias Radestock <matthias at rabbitmq.com>
>>
>>> Thiago,
>>>
>>> On 10/07/12 21:30, Thiago Burgo Belo wrote:
>>>
>>>> *reports_ram.zip is for disc node and **reports_disc.zip is for ram
>>>> node, and **rabbit at APPSERVER02.zip and **rabbit at APPSERVER02-2.zip are
>>>> both from ram node.*
>>>>
>>>
>>> Where are the logs (rather than reports) from the disk node?
>>>
>>> Matthias.
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120717/24b040c2/attachment.htm>

From eliao at seegrid.com  Tue Jul 17 16:51:18 2012
From: eliao at seegrid.com (Elizabeth Liao)
Date: Tue, 17 Jul 2012 15:51:18 +0000
Subject: [rabbitmq-discuss] Failure starting up after power pulled from
 machine
In-Reply-To: <50006D0B.4070703@rabbitmq.com>
References: <E94F626F5C43D14F8B8479C5EBD790385F1CB0DC@vmexchange02.seegrid.local>,
	<4FF1930C.6020702@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD790385F1CB622@vmexchange02.seegrid.local>,
	<4FF1B16F.5060504@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD7903874224E47@vmexchange02.seegrid.local>,
	<50006D0B.4070703@rabbitmq.com>
Message-ID: <E94F626F5C43D14F8B8479C5EBD790387422BEB8@vmexchange02.seegrid.local>

Hi,

I just wanted to a give an update to the list.  It looks like my issue was resolved but it's unclear what specific change fixed the issue.  The main change that was made was that we previously had a shovel and federation (there was a shovel in one direction and a federated exchange in the other) connection between 2 RabbitMQ servers but then recently switched over to a two-way shovel connection.   I suspect though that it was configuration change during the switch that fixed the issue.

Thanks! 

Liz

From brents at activestate.com  Tue Jul 17 17:30:51 2012
From: brents at activestate.com (Brent Smithurst)
Date: Tue, 17 Jul 2012 09:30:51 -0700 (PDT)
Subject: [rabbitmq-discuss] upgrade to MPL 2.0 ?
In-Reply-To: <CAA-SZJGvKFzS=fDX97hFrOyuyLpJFr0oFeTgrMAw8Q+BK_vO+w@mail.gmail.com>
References: <22713750.17.1330714058839.JavaMail.geo-discussion-forums@vbtw24>
	<4F54E16C.9090302@rabbitmq.com>
	<CAA-SZJGvKFzS=fDX97hFrOyuyLpJFr0oFeTgrMAw8Q+BK_vO+w@mail.gmail.com>
Message-ID: <c3b323f8-83dc-4601-99ee-a2a25cb2ec1f@googlegroups.com>

Has there been any movement on this? What options are available if the MPL 
1.1 license simply is not acceptable for a project, but MPL 2.0 is?

Thanks,

Brent

On Monday, March 5, 2012 9:34:52 AM UTC-8, RubyTuesdayDONO wrote:
>
> thanks, Alexis and Simon, for responding.
>
> there's no pressure from my end, and i appreciate your being open to
> the consideration regardless of whether it can be implemented soon or
> at all.  i just wanted to raise awareness between the Apache Camel and
> RabbitMQ communities in case the licensing issue was not a foregone
> conclusion after all.
>
> best regards,
> Reuben Garrett
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120717/dd0620cf/attachment.htm>

From brents at activestate.com  Tue Jul 17 17:30:51 2012
From: brents at activestate.com (Brent Smithurst)
Date: Tue, 17 Jul 2012 09:30:51 -0700 (PDT)
Subject: [rabbitmq-discuss] upgrade to MPL 2.0 ?
In-Reply-To: <CAA-SZJGvKFzS=fDX97hFrOyuyLpJFr0oFeTgrMAw8Q+BK_vO+w@mail.gmail.com>
References: <22713750.17.1330714058839.JavaMail.geo-discussion-forums@vbtw24>
	<4F54E16C.9090302@rabbitmq.com>
	<CAA-SZJGvKFzS=fDX97hFrOyuyLpJFr0oFeTgrMAw8Q+BK_vO+w@mail.gmail.com>
Message-ID: <c3b323f8-83dc-4601-99ee-a2a25cb2ec1f@googlegroups.com>

Has there been any movement on this? What options are available if the MPL 
1.1 license simply is not acceptable for a project, but MPL 2.0 is?

Thanks,

Brent

On Monday, March 5, 2012 9:34:52 AM UTC-8, RubyTuesdayDONO wrote:
>
> thanks, Alexis and Simon, for responding.
>
> there's no pressure from my end, and i appreciate your being open to
> the consideration regardless of whether it can be implemented soon or
> at all.  i just wanted to raise awareness between the Apache Camel and
> RabbitMQ communities in case the licensing issue was not a foregone
> conclusion after all.
>
> best regards,
> Reuben Garrett
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120717/dd0620cf/attachment-0001.htm>

From matthias at rabbitmq.com  Tue Jul 17 18:24:08 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 17 Jul 2012 18:24:08 +0100
Subject: [rabbitmq-discuss] My cluter node (ram node) down in my
 performance test
In-Reply-To: <CABjKUK_Q-eJHvss3Hnmq9A-irz3vqTVYSWZVEk5Amxq04s=GaA@mail.gmail.com>
References: <CABjKUK9j23ia9foMSDUTBXa+y6-ypF86d6Wzy9PZr=dAkxG-7Q@mail.gmail.com>
	<4FF6F10F.6080107@rabbitmq.com>
	<CABjKUK_Bfdo=Au1CR440YcEWkB6vTts-Le6G1HVYo7QqRXrWhA@mail.gmail.com>
	<CABjKUK-8Gx_4Rt4Uu=VDg5-iXAHQ7HNUB=b8toeeCSdjBaO_zg@mail.gmail.com>
	<4FF76401.1020900@rabbitmq.com> <4FFBC015.1090506@rabbitmq.com>
	<CABjKUK-XNiYZZ1AY7=i+rHTdO9Y7zrHprMCG67ay7qQtgXnYaQ@mail.gmail.com>
	<4FFC91BF.6020309@rabbitmq.com>
	<CABjKUK84uDdt=7oqT77b23Cqe6uvC2_NKe=NMJk1s8sZbLjb8A@mail.gmail.com>
	<CABjKUK_wqPdASfmjnFopWLr6tw109DKypqZ-XPwSHVTaCQ38ew@mail.gmail.com>
	<CABjKUK_Q-eJHvss3Hnmq9A-irz3vqTVYSWZVEk5Amxq04s=GaA@mail.gmail.com>
Message-ID: <50059FB8.1060405@rabbitmq.com>

Thiago,

On 17/07/12 16:09, Thiago Burgo Belo wrote:
> https://skydrive.live.com/redir?resid=E7129E57616CE33A!4492&authkey=!AB9nHGtNRRUeC94

Thank you.

We think we know what the problem is: a race condition when repeatedly 
declaring and deleting the same HA queue. This got fixed on 'default' a 
couple of weeks ago and will appear in the next release.

Btw, one oddity I spotted in your logs is that at one point a queue 
appeared to have ~1200 channels that each had published a message to it 
and where all still alive. That may be perfectly ok of course, but it is 
quite unusual.

Regards,

Matthias.

From anton.kirilenko at rosalab.ru  Tue Jul 17 19:48:06 2012
From: anton.kirilenko at rosalab.ru (Anton Kirilenko)
Date: Tue, 17 Jul 2012 22:48:06 +0400
Subject: [rabbitmq-discuss] building system architecture
In-Reply-To: <87r4sapjtf.wl%francesco@rabbitmq.com>
References: <4FFFDD21.8030205@rosalab.ru>
	<87r4sapjtf.wl%francesco@rabbitmq.com>
Message-ID: <5005B366.1060601@rosalab.ru>


> Again it's not clear to me what you mean here. It seems to me that a
> one-queue-per-client solution with publisher confirms would suffice in your
> case. You have strong guarantees against the loss of messages, and you can ack
> the messages once you've finished building. If rabbit fails, you know that the
> messages are persisted and thus they won't be lost. If the consumer fails, the
> messages pending acks will be redelivered to the next consumer (with a
> `redeliver' flag to indicate that the messages was sent before).
>
>
I've done one queue by client. While client is free - it sends special 
messages every 10 seconds, server will receive it and send tasks to 
client if possible. Server sends special immideate message to every 
online client every 10 seconds too. When client dies, its queue will be 
deleted (thanks to queue declaration flags) and message will be reterned 
to server, server will now the client is dead. It looks workable, but 
it's not implemented yet. I'll keep you informed :)

From jasonjwwilliams at gmail.com  Tue Jul 17 21:48:49 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 17 Jul 2012 13:48:49 -0700
Subject: [rabbitmq-discuss] LA & RabbitMQ
Message-ID: <CAHZAEpfHQF0bNuipEupQd6u4h5aRq5C=KLvO=2dtewV+LTxbmA@mail.gmail.com>

Anyone in the LA area interested in grabbing some beers and talking
about RabbitMQ?  I'd be happy to take the mantle of setting it up.

-J

From mailrohitp at gmail.com  Tue Jul 17 21:55:31 2012
From: mailrohitp at gmail.com (rohit)
Date: Tue, 17 Jul 2012 13:55:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Publisher Confirms support in Rabbitmq-c client.
Message-ID: <1342558531224-20862.post@n5.nabble.com>


Hi,

After looking in rabbitmq-c client source code, I feel there is no
implementation of Publisher confirms in the client. Can someone confirm
this?
Also does anyone know if it is ever going to be implemented as part of the
client, or a third party patch to achieve this.

Thanks in advance.

--Rohit

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Publisher-Confirms-support-in-Rabbitmq-c-client-tp20862.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mailrohitp at gmail.com  Tue Jul 17 21:58:29 2012
From: mailrohitp at gmail.com (rohit)
Date: Tue, 17 Jul 2012 13:58:29 -0700 (PDT)
Subject: [rabbitmq-discuss] Status of RabbitMQ-C
In-Reply-To: <CAHZsVQZZABQwZkskW8=4iiMR1STjy9Mum2c6PfvAQH7R0vpW7A@mail.gmail.com>
References: <CAHZsVQb8PTxjmvdB+_JCL2p8_f_cWbjLsitsSNOfZCs4D+Sfsw@mail.gmail.com>
	<CAAt2poKcaBb-r2knMfkNru7iAM6f7v8k2-kf8-OaO_+sHFK+Sg@mail.gmail.com>
	<CAHZsVQZZABQwZkskW8=4iiMR1STjy9Mum2c6PfvAQH7R0vpW7A@mail.gmail.com>
Message-ID: <1342558709963-20863.post@n5.nabble.com>


Hey Alan,
Can you confirm that Rabbitmq-c client does not support Publisher-confirms.
If there are thirty party implementations, please point me to them, else I
would want to go ahead and implement it, as we want to use it in production.

Thanks,
Rohit

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Status-of-RabbitMQ-C-tp4199p20863.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From thiagoburgo at gmail.com  Tue Jul 17 22:42:01 2012
From: thiagoburgo at gmail.com (Thiago Burgo Belo)
Date: Tue, 17 Jul 2012 18:42:01 -0300
Subject: [rabbitmq-discuss] My cluter node (ram node) down in my
 performance test
In-Reply-To: <50059FB8.1060405@rabbitmq.com>
References: <CABjKUK9j23ia9foMSDUTBXa+y6-ypF86d6Wzy9PZr=dAkxG-7Q@mail.gmail.com>
	<4FF6F10F.6080107@rabbitmq.com>
	<CABjKUK_Bfdo=Au1CR440YcEWkB6vTts-Le6G1HVYo7QqRXrWhA@mail.gmail.com>
	<CABjKUK-8Gx_4Rt4Uu=VDg5-iXAHQ7HNUB=b8toeeCSdjBaO_zg@mail.gmail.com>
	<4FF76401.1020900@rabbitmq.com> <4FFBC015.1090506@rabbitmq.com>
	<CABjKUK-XNiYZZ1AY7=i+rHTdO9Y7zrHprMCG67ay7qQtgXnYaQ@mail.gmail.com>
	<4FFC91BF.6020309@rabbitmq.com>
	<CABjKUK84uDdt=7oqT77b23Cqe6uvC2_NKe=NMJk1s8sZbLjb8A@mail.gmail.com>
	<CABjKUK_wqPdASfmjnFopWLr6tw109DKypqZ-XPwSHVTaCQ38ew@mail.gmail.com>
	<CABjKUK_Q-eJHvss3Hnmq9A-irz3vqTVYSWZVEk5Amxq04s=GaA@mail.gmail.com>
	<50059FB8.1060405@rabbitmq.com>
Message-ID: <CABjKUK9bvce38d+q=36Jwnb2+8zFjxxp1Ex3VGvhi3jBbpF6_g@mail.gmail.com>

The channels (~1200) was created by a problem in my tests with a
IConnection Pool, where I opened a channel (CreateModel) and I forgot
dispose.

You know when a new version with this bug fix will be avaiable?

Thanks for help,

2012/7/17 Matthias Radestock <matthias at rabbitmq.com>

> Thiago,
>
> On 17/07/12 16:09, Thiago Burgo Belo wrote:
>
>> https://skydrive.live.com/**redir?resid=E7129E57616CE33A!**
>> 4492&authkey=!AB9nHGtNRRUeC94<https://skydrive.live.com/redir?resid=E7129E57616CE33A%214492&authkey=%21AB9nHGtNRRUeC94>
>>
>
> Thank you.
>
> We think we know what the problem is: a race condition when repeatedly
> declaring and deleting the same HA queue. This got fixed on 'default' a
> couple of weeks ago and will appear in the next release.
>
> Btw, one oddity I spotted in your logs is that at one point a queue
> appeared to have ~1200 channels that each had published a message to it and
> where all still alive. That may be perfectly ok of course, but it is quite
> unusual.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120717/0f63322c/attachment.htm>

From jerryk at rbcon.com  Tue Jul 17 23:28:42 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Tue, 17 Jul 2012 15:28:42 -0700
Subject: [rabbitmq-discuss] Publisher Confirms support in Rabbitmq-c
	client.
In-Reply-To: <1342558531224-20862.post@n5.nabble.com>
References: <1342558531224-20862.post@n5.nabble.com>
Message-ID: <40ACD542-7A9E-435A-84D6-7FEC8E41078C@rbcon.com>

Publisher confirms are a quite recent Rabbit extension to AMQP and the C clients tend to lag behind a bit, unfortunately. 

I'm not aware of current plans to support them or any existing patches.  Anybody else?  What happens at the wire level is pretty straightforward so really the work will all be in handling them asynchronously I'd think. 


Sent from my iPad.

On Jul 17, 2012, at 1:55 PM, rohit <mailrohitp at gmail.com> wrote:

> 
> Hi,
> 
> After looking in rabbitmq-c client source code, I feel there is no
> implementation of Publisher confirms in the client. Can someone confirm
> this?
> Also does anyone know if it is ever going to be implemented as part of the
> client, or a third party patch to achieve this.
> 
> Thanks in advance.
> 
> --Rohit
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Publisher-Confirms-support-in-Rabbitmq-c-client-tp20862.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alan.antonuk at gmail.com  Wed Jul 18 04:38:20 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 17 Jul 2012 23:38:20 -0400
Subject: [rabbitmq-discuss] Status of RabbitMQ-C
In-Reply-To: <1342558709963-20863.post@n5.nabble.com>
References: <CAHZsVQb8PTxjmvdB+_JCL2p8_f_cWbjLsitsSNOfZCs4D+Sfsw@mail.gmail.com>
	<CAAt2poKcaBb-r2knMfkNru7iAM6f7v8k2-kf8-OaO_+sHFK+Sg@mail.gmail.com>
	<CAHZsVQZZABQwZkskW8=4iiMR1STjy9Mum2c6PfvAQH7R0vpW7A@mail.gmail.com>
	<1342558709963-20863.post@n5.nabble.com>
Message-ID: <CAAt2poL+j9cRXcQdT_CUQWEVY8JQh=QR1e1ALo8ft2Q1HzmP6A@mail.gmail.com>

rabbitmq-c does support publisher confirms, it requires a bit more effort
to work with them, but they do work.

SimpleAmqpClient (a rabbitmq-c wrapper) uses them.

-Alan

On Tue, Jul 17, 2012 at 4:58 PM, rohit <mailrohitp at gmail.com> wrote:

>
> Hey Alan,
> Can you confirm that Rabbitmq-c client does not support Publisher-confirms.
> If there are thirty party implementations, please point me to them, else I
> would want to go ahead and implement it, as we want to use it in
> production.
>
> Thanks,
> Rohit
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Status-of-RabbitMQ-C-tp4199p20863.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120717/2f920559/attachment.htm>

From alan.antonuk at gmail.com  Wed Jul 18 05:04:00 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 18 Jul 2012 00:04:00 -0400
Subject: [rabbitmq-discuss] Publisher Confirms support in Rabbitmq-c
	client.
In-Reply-To: <40ACD542-7A9E-435A-84D6-7FEC8E41078C@rbcon.com>
References: <1342558531224-20862.post@n5.nabble.com>
	<40ACD542-7A9E-435A-84D6-7FEC8E41078C@rbcon.com>
Message-ID: <CAAt2poJAiH19FxCnGp4tnVsa51=xzpYOJkesws88nGBWQ5eb1g@mail.gmail.com>

rabbitmq-c does support publisher confirms, its not as easy to use as on
the other clients.

On the channel you want to turn on confirms (error handling elided):
amqp_channel_t channel = 1;
amqp_channel_open(conn, channel);
amqp_confirm_select(conn, channel);

Then to handle the publish confirms:
amqp_basic_publish(...);
// You then need to wait for either a basic.ack or then a basic.return
followed by a message, followed by basic.ack in the case of a delivery
failure:

amqp_frame_t frame;
amqp_simple_wait_frame(conn, &frame);
// Check that frame is on channel 1
if (frame.method == AMQP_BASIC_ACK)
{
  // Message successfully delivered
}
else
{
 // Read properties
 amqp_simple_wait_frame(conn, &frame);
 // Check that frame is on channel 1, and that its a properties type
 uint64_t body_size = frame.properties.body_size;

 uint64_t body_read = 0;
 // Read body frame
 while (body_read < body_size)
 {
   amqp_simple_wait_frame(conn, &frame);
   // Check frame is on channel 1, and that is a body frame
   body_read += frame.body_fragment.len;
 }

 // Read basic.ack
 amqp_simple_wait_frame(conn, &frame);
 // Check frame is on channel 1, and that its a basic.ack
}


This is used in SimpleAmqpClient, see BasicPublish function for details:
https://github.com/alanxz/SimpleAmqpClient/blob/master/src/Channel.cpp#L287

-Alan

On Tue, Jul 17, 2012 at 6:28 PM, Jerry Kuch <jerryk at rbcon.com> wrote:

> Publisher confirms are a quite recent Rabbit extension to AMQP and the C
> clients tend to lag behind a bit, unfortunately.
>
> I'm not aware of current plans to support them or any existing patches.
>  Anybody else?  What happens at the wire level is pretty straightforward so
> really the work will all be in handling them asynchronously I'd think.
>
>
> Sent from my iPad.
>
> On Jul 17, 2012, at 1:55 PM, rohit <mailrohitp at gmail.com> wrote:
>
> >
> > Hi,
> >
> > After looking in rabbitmq-c client source code, I feel there is no
> > implementation of Publisher confirms in the client. Can someone confirm
> > this?
> > Also does anyone know if it is ever going to be implemented as part of
> the
> > client, or a third party patch to achieve this.
> >
> > Thanks in advance.
> >
> > --Rohit
> >
> > --
> > View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Publisher-Confirms-support-in-Rabbitmq-c-client-tp20862.html
> > Sent from the RabbitMQ mailing list archive at Nabble.com.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/84075fa7/attachment.htm>

From jerryk at rbcon.com  Wed Jul 18 05:10:03 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Tue, 17 Jul 2012 21:10:03 -0700
Subject: [rabbitmq-discuss] Publisher Confirms support in Rabbitmq-c
	client.
In-Reply-To: <CAAt2poJAiH19FxCnGp4tnVsa51=xzpYOJkesws88nGBWQ5eb1g@mail.gmail.com>
References: <1342558531224-20862.post@n5.nabble.com>
	<40ACD542-7A9E-435A-84D6-7FEC8E41078C@rbcon.com>
	<CAAt2poJAiH19FxCnGp4tnVsa51=xzpYOJkesws88nGBWQ5eb1g@mail.gmail.com>
Message-ID: <23CDDDF0-1641-4442-8D47-F156C0B2A3AE@rbcon.com>

Very cool... I hadn't realized that was there!

Jerry

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On Jul 17, 2012, at 9:04 PM, Alan Antonuk <alan.antonuk at gmail.com> wrote:

> rabbitmq-c does support publisher confirms, its not as easy to use as on the other clients.
> 
> On the channel you want to turn on confirms (error handling elided):
> amqp_channel_t channel = 1;
> amqp_channel_open(conn, channel);
> amqp_confirm_select(conn, channel);
> 
> Then to handle the publish confirms:
> amqp_basic_publish(...);
> // You then need to wait for either a basic.ack or then a basic.return followed by a message, followed by basic.ack in the case of a delivery failure:
> 
> amqp_frame_t frame;
> amqp_simple_wait_frame(conn, &frame);
> // Check that frame is on channel 1
> if (frame.method == AMQP_BASIC_ACK)
> {
>   // Message successfully delivered
> }
> else
> {
>  // Read properties
>  amqp_simple_wait_frame(conn, &frame);
>  // Check that frame is on channel 1, and that its a properties type
>  uint64_t body_size = frame.properties.body_size;
>   
>  uint64_t body_read = 0;
>  // Read body frame
>  while (body_read < body_size)
>  {
>    amqp_simple_wait_frame(conn, &frame);
>    // Check frame is on channel 1, and that is a body frame
>    body_read += frame.body_fragment.len;
>  }   
>  
>  // Read basic.ack
>  amqp_simple_wait_frame(conn, &frame);
>  // Check frame is on channel 1, and that its a basic.ack
> }
> 
> 
> This is used in SimpleAmqpClient, see BasicPublish function for details:
> https://github.com/alanxz/SimpleAmqpClient/blob/master/src/Channel.cpp#L287
> 
> -Alan
> 
> On Tue, Jul 17, 2012 at 6:28 PM, Jerry Kuch <jerryk at rbcon.com> wrote:
> Publisher confirms are a quite recent Rabbit extension to AMQP and the C clients tend to lag behind a bit, unfortunately.
> 
> I'm not aware of current plans to support them or any existing patches.  Anybody else?  What happens at the wire level is pretty straightforward so really the work will all be in handling them asynchronously I'd think.
> 
> 
> Sent from my iPad.
> 
> On Jul 17, 2012, at 1:55 PM, rohit <mailrohitp at gmail.com> wrote:
> 
> >
> > Hi,
> >
> > After looking in rabbitmq-c client source code, I feel there is no
> > implementation of Publisher confirms in the client. Can someone confirm
> > this?
> > Also does anyone know if it is ever going to be implemented as part of the
> > client, or a third party patch to achieve this.
> >
> > Thanks in advance.
> >
> > --Rohit
> >
> > --
> > View this message in context: http://rabbitmq.1065348.n5.nabble.com/Publisher-Confirms-support-in-Rabbitmq-c-client-tp20862.html
> > Sent from the RabbitMQ mailing list archive at Nabble.com.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120717/0491f91f/attachment.htm>

From prudhviy at gmail.com  Wed Jul 18 06:41:07 2012
From: prudhviy at gmail.com (Bhaskar teja)
Date: Wed, 18 Jul 2012 11:11:07 +0530
Subject: [rabbitmq-discuss] help - design pattern for an our use case
Message-ID: <CAEMO9cBFeuTCn-fbftXjGeGTBY2vRXBQEKr3mpk4sDVo+7G5KA@mail.gmail.com>

Hi All,

Our website have daily active users around 50,000 and we want use rabbitmq
as message broker for "~real time web notifications" for lot of events
generated by users.
Need some help in designing for our use case. our requirements are as
follows,

1. Users are part of different communities, a user can be part of multiple
communities.
2. when a user uploads a Image, all the users in that community need to be
notified like on facebook.
3. users can form groups inside each community. the targeted group alone
need to be notified based on scenario.

here, user uploading an image is just one of the scenarios we have.
right now we have designed the following way,

Producer -
      Exchange name - "web notifications"
      Exchange Type - "direct"
      Routing key - "gallery"
      message body - { producer_user_Id: 123, target_user_Ids: [23, 45,
56], type: "image_upload" }
Consumer -
      Exchange name - "web notifications"
      Exchange type - "direct"
      Routing key - "gallery"
      queue name - no name given - auto generated
we are consuming the messages and processing them based on type in message
body and storing it in redis for each user in target_user_Ids,
so regardless of user being online or offline we are persisting
notifications and delivering them once user logs in.
we are not sure if the current design is proper since all messages from 50k
users are routed to only few queues( < 10 ) and few worker-consumers.
we also need to notify the users via e-mail about the events.
What is a good design pattern for our use case - like number of queues?,
exchange type?, number of exchanges( web, e-mail ) ??
Please let me know if anyone need more information.

Thank you,
Bhaskar teja
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/2ede5294/attachment.htm>

From nimmavadiraj at gmail.com  Wed Jul 18 09:27:13 2012
From: nimmavadiraj at gmail.com (vadiraj hebbar)
Date: Wed, 18 Jul 2012 13:57:13 +0530
Subject: [rabbitmq-discuss] regards channel in rabbitmq
Message-ID: <CALK6wMoh8CQ_awSsrCsymTmtVHY=i=2TuaMFvt-8uHvhmDbKfw@mail.gmail.com>

Hi All,

I knew that i am asking simple question, why channel is required? is it
possible to set channel explicitly for like that  channel=10? if yes how
can we set it in java ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/88308dc7/attachment.htm>

From justin.field at cbsinteractive.com  Tue Jul 17 18:47:53 2012
From: justin.field at cbsinteractive.com (Justin Field)
Date: Tue, 17 Jul 2012 10:47:53 -0700 (PDT)
Subject: [rabbitmq-discuss] Creating New Consumers When a Consumer Dies
	Prematurely
Message-ID: <519323b9-9c0d-44c7-b4c2-1a524ee6b49b@googlegroups.com>

Hello,

I am trying to use rabbitMQ to rebuild complete index's from a database 
with 800,000+ entries to new databases that stores the data differently.
My goal is to have 

   - 1 Producer that sends msgs to the queue.
   - A fixed number of consumers to process the messages from the queue.
   - Make new consumers to replace any consumers that prematurely die.
   

I did some research and wanted to use newFixedThreadPool 
<http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/Executors.html#newFixedThreadPool(int)>from 
the Executers Class but I am not sure how to go about it,
or if it is possible to use with rabbitMQ.

in my experiment so far I start things like so
     
// create the consumers thread pool
ExecutorService execSvc = Executors.newFixedThreadPool(4);

// give the thread pool some consumers
for (int i = 0; i < 4; i++) {

execSvc.execute(new RebuilderConsumer());

}

However when a thread dies no new thread is created.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120717/e6706d7a/attachment.htm>

From dgillies at brandscreen.com  Wed Jul 18 01:56:03 2012
From: dgillies at brandscreen.com (David Gillies)
Date: Wed, 18 Jul 2012 10:56:03 +1000
Subject: [rabbitmq-discuss] Restarting/re-establising failed federation
	connections
In-Reply-To: <9F05622A-2DB9-4165-AC1D-E550E479B718@rabbitmq.com>
References: <e5c07cc1-c5c2-4614-aef8-cee6dbcb64a7@googlegroups.com>
	<9F05622A-2DB9-4165-AC1D-E550E479B718@rabbitmq.com>
Message-ID: <CAO70NwvM3Zq1=jX=iMaFupSb1Hct2gVsWojiw+L_Di5_f=XgyQ@mail.gmail.com>

Hi Steve,

On 12 July 2012 23:50, Steve Powell <spowell at rbcon.com> wrote:

>
> Please can you tell me what versions of RabbitMQ you are running on the
> upstream and downstream clusters? Although these are allowed to be
> different, some changes were made in 2.8.2 which try to take advantage
> of upstream exchange mods if they are detected. If the upstream exchange
> and downstream exchange have versions which straddle 2.8.2, I might
> expect some odd behaviour in recovery scenarios (though we should be
> fine :-).
>
>
>
So I've just recently upgraded all my rabbits to 2.8.4. All servers are
running on ubuntu 10.04, except for the  downstream servers, which are on
ubuntu 12.04.

I've posted up the logs from the downstream server from around the time
that one of the upstream servers lose connectivity and the downstream
server is never able to connect again here:
https://gist.github.com/85da45443b92e69e29a0

Thanks,
-- 
David Gillies
Senior Systems Engineer, Brandscreen
dgillies at brandscreen.com

Australia: Level 2, 30 Alfred Street, Milsons Point NSW 2061 Australia
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/438383e9/attachment.htm>

From emile at rabbitmq.com  Wed Jul 18 11:04:59 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 18 Jul 2012 11:04:59 +0100
Subject: [rabbitmq-discuss] regards channel in rabbitmq
In-Reply-To: <CALK6wMoh8CQ_awSsrCsymTmtVHY=i=2TuaMFvt-8uHvhmDbKfw@mail.gmail.com>
References: <CALK6wMoh8CQ_awSsrCsymTmtVHY=i=2TuaMFvt-8uHvhmDbKfw@mail.gmail.com>
Message-ID: <50068A4B.7050907@rabbitmq.com>

Hi,

On 18/07/12 09:27, vadiraj hebbar wrote:
> I knew that i am asking simple question, why channel is required? is it
> possible to set channel explicitly for like that  channel=10? if yes how
> can we set it in java ?  

Channels are the scope for errors, transactions, ordering guarantee and
acks. There are libraries such as Puka that eschew the concept of
channels. See
http://www.rabbitmq.com/blog/2011/07/08/puka-rethinking-amqp-clients/

The RabbitMQ Java client allocates channel numbers internally, so you
can't choose your own channel number - but why would you want to?


-Emile


From emile at rabbitmq.com  Wed Jul 18 11:36:57 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 18 Jul 2012 11:36:57 +0100
Subject: [rabbitmq-discuss] regards channel in rabbitmq
In-Reply-To: <50068A4B.7050907@rabbitmq.com>
References: <CALK6wMoh8CQ_awSsrCsymTmtVHY=i=2TuaMFvt-8uHvhmDbKfw@mail.gmail.com>
	<50068A4B.7050907@rabbitmq.com>
Message-ID: <500691C9.1050801@rabbitmq.com>


Hi,

On 18/07/12 11:04, Emile Joubert wrote:
> The RabbitMQ Java client allocates channel numbers internally, so you
> can't choose your own channel number - but why would you want to?

This was a mistake - it *is* possible to choose your own channel number,
using Connection.createChannel(int channelNumber). But there are few
good reasons to use this method.

-Emile


From emile at rabbitmq.com  Wed Jul 18 12:23:05 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 18 Jul 2012 12:23:05 +0100
Subject: [rabbitmq-discuss] help - design pattern for an our use case
In-Reply-To: <CAEMO9cBFeuTCn-fbftXjGeGTBY2vRXBQEKr3mpk4sDVo+7G5KA@mail.gmail.com>
References: <CAEMO9cBFeuTCn-fbftXjGeGTBY2vRXBQEKr3mpk4sDVo+7G5KA@mail.gmail.com>
Message-ID: <50069C99.2010607@rabbitmq.com>

Hi,

On 18/07/12 06:41, Bhaskar teja wrote:
> What is a good design pattern for our use case - like number of queues?,
> exchange type?, number of exchanges( web, e-mail ) ??

This looks like a potential application of topics and a topic exchange.
Allocate a queue for each user. Bind each user queue with appropriate
routing keys. So a queue for user "alice" belonging to two communities
might have these bindings:

users.alice
communities.pet-owners
communities.music-collectors

When "alice" takes an action that her communities may be interested in
then a message must be sent to the topic exchange with a routing key for
each of the communities that she belongs to. It is possible to do this
in a single operation using CC routing. See
http://www.rabbitmq.com/extensions.html#sender-selected-distribution

Depending on the complexity of when groups are notified you could
implement groups as sub-topics, so a group within pet-owners might be:

communities.pet-owners.dog-lovers

Depending on the rules for email notifications you could use a
combination of dead letter exchanges and queue-TTL to detect when
notifications have been waiting in the queue for too long and send them
to the user by email. See:

http://www.rabbitmq.com/extensions.html#dead-letter-exchanges
http://www.rabbitmq.com/extensions.html#queue-ttl

A possible problem with this design is the large number of bindings
involved. This could be slow and difficult to manage, depending on the
branching factor. You could contain the complexity by using
exchange-to-exchange bindings and internal exchanges for groups (and
communities).

-Emile


From francesco at rabbitmq.com  Wed Jul 18 14:02:06 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 18 Jul 2012 14:02:06 +0100
Subject: [rabbitmq-discuss] Creating New Consumers When a Consumer
	Dies	Prematurely
In-Reply-To: <519323b9-9c0d-44c7-b4c2-1a524ee6b49b@googlegroups.com>
References: <519323b9-9c0d-44c7-b4c2-1a524ee6b49b@googlegroups.com>
Message-ID: <87a9yxxlwx.wl%francesco@rabbitmq.com>

Hi Justin,
At Tue, 17 Jul 2012 10:47:53 -0700 (PDT),
Justin Field wrote:
> Hello,
> 
> I am trying to use rabbitMQ to rebuild complete index's from a database with
> 800,000+ entries to new databases that stores the data differently.  My goal
> is to have
> 
>   ? 1 Producer that sends msgs to the queue.
>   ? A fixed number of consumers to process the messages from the queue.
>   ? Make new consumers to replace any consumers that prematurely die.
> 
> I did some research and wanted to use newFixedThreadPool from the Executers
> Class but I am not sure how to go about it, or if it is possible to use with
> rabbitMQ.
> 
> [...]

We do not currently use the Executors framework in our Java client, and it looks
like it would be a reasonable solution - I don't see any reason why you would
not be able to use it with our client. I would suggest to look at the javadoc
page (
http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Executors.html )
for the Executors class, since your doubts are probably answered there and this
mailing list is not the right outlet to talk about the Java standard APIs.

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Wed Jul 18 14:08:36 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 18 Jul 2012 14:08:36 +0100
Subject: [rabbitmq-discuss] Creating New Consumers When a
	Consumer	Dies	Prematurely
In-Reply-To: <87a9yxxlwx.wl%francesco@rabbitmq.com>
References: <519323b9-9c0d-44c7-b4c2-1a524ee6b49b@googlegroups.com>
	<87a9yxxlwx.wl%francesco@rabbitmq.com>
Message-ID: <878vehxlm3.wl%francesco@rabbitmq.com>

At Wed, 18 Jul 2012 14:02:06 +0100,
Francesco Mazzoli wrote:
> We do not currently use the Executors framework in our Java client, [...]

Actually, we *do* have facilities to do what you want, that use the Executors
class, see: http://www.rabbitmq.com/api-guide.html#advanced-connection . That
might serve your needs. Sorry about the confusion.

--
Francesco * Often in error, never in doubt

From milan at m-i.com.au  Wed Jul 18 14:12:28 2012
From: milan at m-i.com.au (mrajkovic)
Date: Wed, 18 Jul 2012 06:12:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster Setup
In-Reply-To: <5002F355.4060308@rabbitmq.com>
References: <1342362081660-20805.post@n5.nabble.com>
	<5002F355.4060308@rabbitmq.com>
Message-ID: <1342617148033-20878.post@n5.nabble.com>

Hi Matthias,

I did a netstat -p -l and i got the following:-


Proto Recv-Q Send-Q Local Address           Foreign Address         State      
PID/Program name
tcp        0      0 127.0.0.1:4369          0.0.0.0:*               LISTEN     
1872/epmd

i'm not sure why it is only listening on 127.0.0.1 ...

Any ideas?

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805p20878.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Wed Jul 18 15:03:42 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 18 Jul 2012 15:03:42 +0100
Subject: [rabbitmq-discuss] Cluster Setup
In-Reply-To: <1342617148033-20878.post@n5.nabble.com>
References: <1342362081660-20805.post@n5.nabble.com>
	<5002F355.4060308@rabbitmq.com>
	<1342617148033-20878.post@n5.nabble.com>
Message-ID: <BA2B858E-BD33-4BA4-B615-E985DBAB7E69@rabbitmq.com>

On 18 Jul 2012, at 14:12, mrajkovic wrote:

> Hi Matthias,
> 
> I did a netstat -p -l and i got the following:-
> 
> 
> Proto Recv-Q Send-Q Local Address           Foreign Address         State      
> PID/Program name
> tcp        0      0 127.0.0.1:4369          0.0.0.0:*               LISTEN     
> 1872/epmd
> 

How exactly did you run netstat to get this? You might something like *:epmd *:* LISTEN when running on Linux and something quite different on BSD (and derivatives like Darwin) so it'd help to know what OS/version you're running on that machine.

> i'm not sure why it is only listening on 127.0.0.1 ...
> 

I wouldn't be too concerned about that. For example, on two machines I'm running iske and frigg, I get:

+++++

t4 at iske $ netstat | grep LISTEN
t4 at iske $ netstat | grep epmd
tcp4       0      0  localhost.62696        localhost.epmd         CLOSE_WAIT 

+++++

t4 at frigg:~ $ telnet iske 4369
Trying 10.20.218.219...
Connected to iske.
Escape character is '^]'.

+++++

t4 at iske $ netstat | grep epmd
tcp4       0      0  10.20.xxx.219.epmd     10.20.xxx.230.52475    ESTABLISHED
tcp4       0      0  localhost.62696        localhost.epmd         CLOSE_WAIT 

+++++

Can you telnet similarly between machines? If not then you've almost certainly got either firewall/iptables configuration getting in the way, or the network configuration on mf-01 isn't quite right. What OS is that machine running and what does it's /etc/hosts configuration look like? Erlang sometimes needs a bit of convincing to get machines talking to each other, depending on the OS and network config. 

> Any ideas?
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805p20878.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From milan at m-i.com.au  Wed Jul 18 15:13:54 2012
From: milan at m-i.com.au (mrajkovic)
Date: Wed, 18 Jul 2012 07:13:54 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster Setup
In-Reply-To: <BA2B858E-BD33-4BA4-B615-E985DBAB7E69@rabbitmq.com>
References: <1342362081660-20805.post@n5.nabble.com>
	<5002F355.4060308@rabbitmq.com>
	<1342617148033-20878.post@n5.nabble.com>
	<BA2B858E-BD33-4BA4-B615-E985DBAB7E69@rabbitmq.com>
Message-ID: <DCAA63C5E787D7428471C0F93BEBFBBAC647A0AB@MI-EX-01.sgc.m-i.local>

root at mf-01:~# cat /etc/hosts
127.0.0.1       localhost
119.31.227.103  mf-01.cloud.m-i.com.au
119.31.227.106  mf-02.cloud.m-i.com.au  mf-02
127.0.0.1       mf-01

root at mf-02:~# cat /etc/hosts
127.0.0.1       localhost
119.31.227.103  mf-01.vic.cloud.m-i.com.au      mf-01
119.31.227.106  mf-02.cloud.m-i.com.au
127.0.0.1       mf-02


From: Tim Watson-6 [via RabbitMQ] [mailto:ml-node+s1065348n20879h0 at n5.nabble.com]
Sent: Thursday, 19 July 2012 12:05 AM
To: Milan Rajkovic
Subject: Re: Cluster Setup

On 18 Jul 2012, at 14:12, mrajkovic wrote:

> Hi Matthias,
>
> I did a netstat -p -l and i got the following:-
>
>
> Proto Recv-Q Send-Q Local Address           Foreign Address         State
> PID/Program name
> tcp        0      0 127.0.0.1:4369          0.0.0.0:*               LISTEN
> 1872/epmd
>

How exactly did you run netstat to get this? You might something like *:epmd *:* LISTEN when running on Linux and something quite different on BSD (and derivatives like Darwin) so it'd help to know what OS/version you're running on that machine.

> i'm not sure why it is only listening on 127.0.0.1 ...
>

I wouldn't be too concerned about that. For example, on two machines I'm running iske and frigg, I get:

+++++

t4 at iske $ netstat | grep LISTEN
t4 at iske $ netstat | grep epmd
tcp4       0      0  localhost.62696        localhost.epmd         CLOSE_WAIT

+++++

t4 at frigg:~ $ telnet iske 4369
Trying 10.20.218.219...
Connected to iske.
Escape character is '^]'.

+++++

t4 at iske $ netstat | grep epmd
tcp4       0      0  10.20.xxx.219.epmd     10.20.xxx.230.52475    ESTABLISHED
tcp4       0      0  localhost.62696        localhost.epmd         CLOSE_WAIT

+++++

Can you telnet similarly between machines? If not then you've almost certainly got either firewall/iptables configuration getting in the way, or the network configuration on mf-01 isn't quite right. What OS is that machine running and what does it's /etc/hosts configuration look like? Erlang sometimes needs a bit of convincing to get machines talking to each other, depending on the OS and network config.

> Any ideas?
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805p20878.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email]</user/SendEmail.jtp?type=node&node=20879&i=0>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
[hidden email]</user/SendEmail.jtp?type=node&node=20879&i=1>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

________________________________
If you reply to this email, your message will be added to the discussion below:
http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805p20879.html
To unsubscribe from Cluster Setup, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=20805&code=bWlsYW5AbS1pLmNvbS5hdXwyMDgwNXwtNTM2MTU2Mjk=>.
NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>

--
This message has been scanned for viruses and dangerous content by Milan Industries Cloud Email Security<http://www.m-i.com.au>

-- 
This message has been scanned for viruses and dangerous content by Milan Industries Cloud Email Security



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805p20880.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/ab1f7aa6/attachment.htm>

From milan at m-i.com.au  Wed Jul 18 15:14:24 2012
From: milan at m-i.com.au (mrajkovic)
Date: Wed, 18 Jul 2012 07:14:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster Setup
In-Reply-To: <BA2B858E-BD33-4BA4-B615-E985DBAB7E69@rabbitmq.com>
References: <1342362081660-20805.post@n5.nabble.com>
	<5002F355.4060308@rabbitmq.com>
	<1342617148033-20878.post@n5.nabble.com>
	<BA2B858E-BD33-4BA4-B615-E985DBAB7E69@rabbitmq.com>
Message-ID: <DCAA63C5E787D7428471C0F93BEBFBBAC647A0C0@MI-EX-01.sgc.m-i.local>

And yes I can communicate between machines... I don't think its iptables I did a iptables list and there are no rules set...

From: Tim Watson-6 [via RabbitMQ] [mailto:ml-node+s1065348n20879h0 at n5.nabble.com]
Sent: Thursday, 19 July 2012 12:05 AM
To: Milan Rajkovic
Subject: Re: Cluster Setup

On 18 Jul 2012, at 14:12, mrajkovic wrote:

> Hi Matthias,
>
> I did a netstat -p -l and i got the following:-
>
>
> Proto Recv-Q Send-Q Local Address           Foreign Address         State
> PID/Program name
> tcp        0      0 127.0.0.1:4369          0.0.0.0:*               LISTEN
> 1872/epmd
>

How exactly did you run netstat to get this? You might something like *:epmd *:* LISTEN when running on Linux and something quite different on BSD (and derivatives like Darwin) so it'd help to know what OS/version you're running on that machine.

> i'm not sure why it is only listening on 127.0.0.1 ...
>

I wouldn't be too concerned about that. For example, on two machines I'm running iske and frigg, I get:

+++++

t4 at iske $ netstat | grep LISTEN
t4 at iske $ netstat | grep epmd
tcp4       0      0  localhost.62696        localhost.epmd         CLOSE_WAIT

+++++

t4 at frigg:~ $ telnet iske 4369
Trying 10.20.218.219...
Connected to iske.
Escape character is '^]'.

+++++

t4 at iske $ netstat | grep epmd
tcp4       0      0  10.20.xxx.219.epmd     10.20.xxx.230.52475    ESTABLISHED
tcp4       0      0  localhost.62696        localhost.epmd         CLOSE_WAIT

+++++

Can you telnet similarly between machines? If not then you've almost certainly got either firewall/iptables configuration getting in the way, or the network configuration on mf-01 isn't quite right. What OS is that machine running and what does it's /etc/hosts configuration look like? Erlang sometimes needs a bit of convincing to get machines talking to each other, depending on the OS and network config.

> Any ideas?
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805p20878.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email]</user/SendEmail.jtp?type=node&node=20879&i=0>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
[hidden email]</user/SendEmail.jtp?type=node&node=20879&i=1>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

________________________________
If you reply to this email, your message will be added to the discussion below:
http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805p20879.html
To unsubscribe from Cluster Setup, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=20805&code=bWlsYW5AbS1pLmNvbS5hdXwyMDgwNXwtNTM2MTU2Mjk=>.
NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>

--
This message has been scanned for viruses and dangerous content by Milan Industries Cloud Email Security<http://www.m-i.com.au>

-- 
This message has been scanned for viruses and dangerous content by Milan Industries Cloud Email Security



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805p20881.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/42553bc7/attachment.htm>

From tim at rabbitmq.com  Wed Jul 18 15:16:04 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 18 Jul 2012 15:16:04 +0100
Subject: [rabbitmq-discuss] Cluster Setup
In-Reply-To: <BA2B858E-BD33-4BA4-B615-E985DBAB7E69@rabbitmq.com>
References: <1342362081660-20805.post@n5.nabble.com>
	<5002F355.4060308@rabbitmq.com>
	<1342617148033-20878.post@n5.nabble.com>
	<BA2B858E-BD33-4BA4-B615-E985DBAB7E69@rabbitmq.com>
Message-ID: <820CDF3D-AB9E-413C-9EF1-3BA9F398833D@rabbitmq.com>


On 18 Jul 2012, at 15:03, Tim Watson wrote:

> On 18 Jul 2012, at 14:12, mrajkovic wrote:
> 
>> Hi Matthias,
>> 
>> I did a netstat -p -l and i got the following:-
>> 
>> 
>> Proto Recv-Q Send-Q Local Address           Foreign Address         State      
>> PID/Program name
>> tcp        0      0 127.0.0.1:4369          0.0.0.0:*               LISTEN     
>> 1872/epmd
>> 
> 
> How exactly did you run netstat to get this? You might something like *:epmd *:* LISTEN when running on Linux and something quite different on BSD (and derivatives like Darwin) so it'd help to know what OS/version you're running on that machine.
> 
>> i'm not sure why it is only listening on 127.0.0.1 ...
>> 
> 
> I wouldn't be too concerned about that. For example, on two machines I'm running iske and frigg, I get:
> 

Although admittedly I was being forgetful and not running as root. *but* there are some differences between BSD and Linux based netstat anyway, so it'd help to know what you're running on.


From milan at m-i.com.au  Wed Jul 18 15:18:27 2012
From: milan at m-i.com.au (mrajkovic)
Date: Wed, 18 Jul 2012 07:18:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster Setup
In-Reply-To: <820CDF3D-AB9E-413C-9EF1-3BA9F398833D@rabbitmq.com>
References: <1342362081660-20805.post@n5.nabble.com>
	<5002F355.4060308@rabbitmq.com>
	<1342617148033-20878.post@n5.nabble.com>
	<BA2B858E-BD33-4BA4-B615-E985DBAB7E69@rabbitmq.com>
	<820CDF3D-AB9E-413C-9EF1-3BA9F398833D@rabbitmq.com>
Message-ID: <DCAA63C5E787D7428471C0F93BEBFBBAC647A161@MI-EX-01.sgc.m-i.local>

Ubuntu 12.04 LTS (GNU/Linux 3.2.0-26-generic x86_64)

From: Tim Watson-6 [via RabbitMQ] [mailto:ml-node+s1065348n20882h93 at n5.nabble.com]
Sent: Thursday, 19 July 2012 12:17 AM
To: Milan Rajkovic
Subject: Re: Cluster Setup


On 18 Jul 2012, at 15:03, Tim Watson wrote:

> On 18 Jul 2012, at 14:12, mrajkovic wrote:
>
>> Hi Matthias,
>>
>> I did a netstat -p -l and i got the following:-
>>
>>
>> Proto Recv-Q Send-Q Local Address           Foreign Address         State
>> PID/Program name
>> tcp        0      0 127.0.0.1:4369          0.0.0.0:*               LISTEN
>> 1872/epmd
>>
>
> How exactly did you run netstat to get this? You might something like *:epmd *:* LISTEN when running on Linux and something quite different on BSD (and derivatives like Darwin) so it'd help to know what OS/version you're running on that machine.
>
>> i'm not sure why it is only listening on 127.0.0.1 ...
>>
>
> I wouldn't be too concerned about that. For example, on two machines I'm running iske and frigg, I get:
>

Although admittedly I was being forgetful and not running as root. *but* there are some differences between BSD and Linux based netstat anyway, so it'd help to know what you're running on.

_______________________________________________
rabbitmq-discuss mailing list
[hidden email]</user/SendEmail.jtp?type=node&node=20882&i=0>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

________________________________
If you reply to this email, your message will be added to the discussion below:
http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805p20882.html
To unsubscribe from Cluster Setup, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=20805&code=bWlsYW5AbS1pLmNvbS5hdXwyMDgwNXwtNTM2MTU2Mjk=>.
NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>

--
This message has been scanned for viruses and dangerous content by Milan Industries Cloud Email Security<http://www.m-i.com.au>

-- 
This message has been scanned for viruses and dangerous content by Milan Industries Cloud Email Security



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805p20883.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/d2707778/attachment.htm>

From tim at rabbitmq.com  Wed Jul 18 15:23:25 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 18 Jul 2012 15:23:25 +0100
Subject: [rabbitmq-discuss] Cluster Setup
In-Reply-To: <DCAA63C5E787D7428471C0F93BEBFBBAC647A0C0@MI-EX-01.sgc.m-i.local>
References: <1342362081660-20805.post@n5.nabble.com>
	<5002F355.4060308@rabbitmq.com>
	<1342617148033-20878.post@n5.nabble.com>
	<BA2B858E-BD33-4BA4-B615-E985DBAB7E69@rabbitmq.com>
	<DCAA63C5E787D7428471C0F93BEBFBBAC647A0C0@MI-EX-01.sgc.m-i.local>
Message-ID: <38DE1FE1-DE99-4FA1-8603-0465595E2CCD@rabbitmq.com>

On 18 Jul 2012, at 15:14, mrajkovic wrote:

> And yes I can communicate between machines? I don?t think its iptables I did a iptables list and there are no rules set?
> 

Ok thanks for checking. When you say you can communicate between machines, can you explicitly telnet onto the port on which epmd is running? I'm assuming not (as it isn't listening). Is it very silly of me not to have asked this, but are the $HOME/.erlang.cookie files on all machines identical? Running rabbitmqctl status should show exactly the same cookie hash on each machine.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/bef383da/attachment.htm>

From milan at m-i.com.au  Wed Jul 18 15:31:11 2012
From: milan at m-i.com.au (mrajkovic)
Date: Wed, 18 Jul 2012 07:31:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster Setup
In-Reply-To: <38DE1FE1-DE99-4FA1-8603-0465595E2CCD@rabbitmq.com>
References: <1342362081660-20805.post@n5.nabble.com>
	<5002F355.4060308@rabbitmq.com>
	<1342617148033-20878.post@n5.nabble.com>
	<BA2B858E-BD33-4BA4-B615-E985DBAB7E69@rabbitmq.com>
	<DCAA63C5E787D7428471C0F93BEBFBBAC647A0C0@MI-EX-01.sgc.m-i.local>
	<38DE1FE1-DE99-4FA1-8603-0465595E2CCD@rabbitmq.com>
Message-ID: <DCAA63C5E787D7428471C0F93BEBFBBAC647A286@MI-EX-01.sgc.m-i.local>

root at mf-01:~# telnet
telnet> open mf-02 5672
Trying 119.31.227.106...
Connected to mf-02.cloud.m-i.com.au.
Escape character is '^]'.

a
asd
AMQP    Connection closed by foreign host.


telnet works?

whats the directory / file path for the erlang cookie?

Running the following doesn?t really say much..

root at mf-01:~# rabbitmqctl status
Status of node 'rabbit at mf-01' ...
[{running_applications,[{rabbit,"RabbitMQ","2.2.0"},
                        {os_mon,"CPO  CXC 138 46","2.2.7"},
                        {sasl,"SASL  CXC 138 11","2.1.10"},
                        {mnesia,"MNESIA  CXC 138 12","4.5"},
                        {stdlib,"ERTS  CXC 138 10","1.17.5"},
                        {kernel,"ERTS  CXC 138 10","2.14.5"}]},
{nodes,[{disc,['rabbit at mf-01']}]},
{running_nodes,['rabbit at mf-01']}]
...done.

Milan.
From: Tim Watson-6 [via RabbitMQ] [mailto:ml-node+s1065348n20884h55 at n5.nabble.com]
Sent: Thursday, 19 July 2012 12:25 AM
To: Milan Rajkovic
Subject: Re: Cluster Setup

On 18 Jul 2012, at 15:14, mrajkovic wrote:


And yes I can communicate between machines? I don?t think its iptables I did a iptables list and there are no rules set?

Ok thanks for checking. When you say you can communicate between machines, can you explicitly telnet onto the port on which epmd is running? I'm assuming not (as it isn't listening). Is it very silly of me not to have asked this, but are the $HOME/.erlang.cookie files on all machines identical? Running rabbitmqctl status should show exactly the same cookie hash on each machine.


_______________________________________________
rabbitmq-discuss mailing list
[hidden email]</user/SendEmail.jtp?type=node&node=20884&i=0>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

________________________________
If you reply to this email, your message will be added to the discussion below:
http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805p20884.html
To unsubscribe from Cluster Setup, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=20805&code=bWlsYW5AbS1pLmNvbS5hdXwyMDgwNXwtNTM2MTU2Mjk=>.
NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>

--
This message has been scanned for viruses and dangerous content by Milan Industries Cloud Email Security<http://www.m-i.com.au>

-- 
This message has been scanned for viruses and dangerous content by Milan Industries Cloud Email Security



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805p20885.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/0a89ddd1/attachment.htm>

From matthias at rabbitmq.com  Wed Jul 18 15:39:41 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 18 Jul 2012 15:39:41 +0100
Subject: [rabbitmq-discuss] So who's Judy and what does she have to do
 with the High Speed TCP driver for Erlang?
In-Reply-To: <134FCEEF-BDC9-4F68-97BD-42D6A57A010F@gmail.com>
References: <201c004f-5a1a-4b84-841c-ec8123f413d4@googlegroups.com>	<5005319F.6090305@rabbitmq.com>
	<5005377D.6000409@rabbitmq.com>
	<9E6CC7A7-8F1E-4107-8083-CFAF1A9B4298@gmail.com>
	<50056716.7090302@rabbitmq.com>
	<134FCEEF-BDC9-4F68-97BD-42D6A57A010F@gmail.com>
Message-ID: <5006CAAD.10005@rabbitmq.com>

Zabrane,

On 17/07/12 14:34, Zabrane Mickael wrote:
>Simon wrote:
>> However, recent improvements to our use of the standard Erlang TCP
>> implementation have improved Rabbit's performance to the point
>> where hstcp doesn't gain anything
>
> Are these improvements documented somewhere? Even source files I can
> have look into.

Take a look at rabbit_reader.erl, in particular the recvloop and 
mainloop, and rabbit_net.erl.

Regards,

Matthias.

From tim at rabbitmq.com  Wed Jul 18 15:43:57 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 18 Jul 2012 15:43:57 +0100
Subject: [rabbitmq-discuss] Cluster Setup
In-Reply-To: <DCAA63C5E787D7428471C0F93BEBFBBAC647A286@MI-EX-01.sgc.m-i.local>
References: <1342362081660-20805.post@n5.nabble.com>
	<5002F355.4060308@rabbitmq.com>
	<1342617148033-20878.post@n5.nabble.com>
	<BA2B858E-BD33-4BA4-B615-E985DBAB7E69@rabbitmq.com>
	<DCAA63C5E787D7428471C0F93BEBFBBAC647A0C0@MI-EX-01.sgc.m-i.local>
	<38DE1FE1-DE99-4FA1-8603-0465595E2CCD@rabbitmq.com>
	<DCAA63C5E787D7428471C0F93BEBFBBAC647A286@MI-EX-01.sgc.m-i.local>
Message-ID: <2E73A2B2-D7C7-4D09-AA13-D3156ADAED69@rabbitmq.com>

On 18 Jul 2012, at 15:31, mrajkovic wrote:
> telnet works?
> 
> 

Good!
>  
> 
> whats the directory / file path for the erlang cookie?
> 
>  
> 
> 

t4 at iske:~ $ ls -la ~/.erlang.cookie 
-r--------  1 t4  staff  20 22 May 21:22 /Users/t4/.erlang.cookie

Make sure the permissions are restricted like that.

> Running the following doesn?t really say much..
> 
> 

Sorry, I meant `rabbitmqctl environment` - which shows the cookie hash.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/be270bcc/attachment.htm>

From tim at rabbitmq.com  Wed Jul 18 15:49:51 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 18 Jul 2012 15:49:51 +0100
Subject: [rabbitmq-discuss] Cluster Setup
In-Reply-To: <DCAA63C5E787D7428471C0F93BEBFBBAC647A286@MI-EX-01.sgc.m-i.local>
References: <1342362081660-20805.post@n5.nabble.com>
	<5002F355.4060308@rabbitmq.com>
	<1342617148033-20878.post@n5.nabble.com>
	<BA2B858E-BD33-4BA4-B615-E985DBAB7E69@rabbitmq.com>
	<DCAA63C5E787D7428471C0F93BEBFBBAC647A0C0@MI-EX-01.sgc.m-i.local>
	<38DE1FE1-DE99-4FA1-8603-0465595E2CCD@rabbitmq.com>
	<DCAA63C5E787D7428471C0F93BEBFBBAC647A286@MI-EX-01.sgc.m-i.local>
Message-ID: <EC965831-7513-4BB2-AF39-009E79FACE1A@rabbitmq.com>

On 18 Jul 2012, at 15:31, mrajkovic wrote:
> root at mf-01:~# telnet
> 
> telnet> open mf-02 5672
> 
> Trying 119.31.227.106...
> 
> Connected to mf-02.cloud.m-i.com.au.
> 
> Escape character is '^]'.
> 
>  
> 
> a
> 
> asd
> 
> AMQP    Connection closed by foreign host.
> 
>  
> 
>  
> 
> telnet works?
> 

No sorry, I'm clearly having concentration problems this afternoon. You need to telnet onto the epmd port 4369. I'm assuming you cannot do that? Unless you've set ERL_EPMD_ADDRESS or you have some local configuration on that machine preventing epmd from listening to anything but localhost, I can't see why this would be happening. Please confirm that telnet is *not* working as expected.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/005bcdac/attachment.htm>

From matthias at rabbitmq.com  Wed Jul 18 15:49:26 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 18 Jul 2012 15:49:26 +0100
Subject: [rabbitmq-discuss] My cluter node (ram node) down in my
 performance test
In-Reply-To: <CABjKUK9bvce38d+q=36Jwnb2+8zFjxxp1Ex3VGvhi3jBbpF6_g@mail.gmail.com>
References: <CABjKUK9j23ia9foMSDUTBXa+y6-ypF86d6Wzy9PZr=dAkxG-7Q@mail.gmail.com>
	<4FF6F10F.6080107@rabbitmq.com>
	<CABjKUK_Bfdo=Au1CR440YcEWkB6vTts-Le6G1HVYo7QqRXrWhA@mail.gmail.com>
	<CABjKUK-8Gx_4Rt4Uu=VDg5-iXAHQ7HNUB=b8toeeCSdjBaO_zg@mail.gmail.com>
	<4FF76401.1020900@rabbitmq.com> <4FFBC015.1090506@rabbitmq.com>
	<CABjKUK-XNiYZZ1AY7=i+rHTdO9Y7zrHprMCG67ay7qQtgXnYaQ@mail.gmail.com>
	<4FFC91BF.6020309@rabbitmq.com>
	<CABjKUK84uDdt=7oqT77b23Cqe6uvC2_NKe=NMJk1s8sZbLjb8A@mail.gmail.com>
	<CABjKUK_wqPdASfmjnFopWLr6tw109DKypqZ-XPwSHVTaCQ38ew@mail.gmail.com>
	<CABjKUK_Q-eJHvss3Hnmq9A-irz3vqTVYSWZVEk5Amxq04s=GaA@mail.gmail.com>
	<50059FB8.1060405@rabbitmq.com>
	<CABjKUK9bvce38d+q=36Jwnb2+8zFjxxp1Ex3VGvhi3jBbpF6_g@mail.gmail.com>
Message-ID: <5006CCF6.7000605@rabbitmq.com>

On 17/07/12 22:42, Thiago Burgo Belo wrote:
> You know when a new version with this bug fix will be available?

Within weeks rather than months, hopefully.

Meanwhile, you should be able to work around the problem if you can 
modify your test so that they do not create & delete queues with 
identical names ('a' in your case) in rapid succession.

Regards,

Matthias.

From zabrane3 at gmail.com  Wed Jul 18 15:59:33 2012
From: zabrane3 at gmail.com (Zabrane Mickael)
Date: Wed, 18 Jul 2012 16:59:33 +0200
Subject: [rabbitmq-discuss] So who's Judy and what does she have to do
	with the High Speed TCP driver for Erlang?
In-Reply-To: <5006CAAD.10005@rabbitmq.com>
References: <201c004f-5a1a-4b84-841c-ec8123f413d4@googlegroups.com>	<5005319F.6090305@rabbitmq.com>
	<5005377D.6000409@rabbitmq.com>
	<9E6CC7A7-8F1E-4107-8083-CFAF1A9B4298@gmail.com>
	<50056716.7090302@rabbitmq.com>
	<134FCEEF-BDC9-4F68-97BD-42D6A57A010F@gmail.com>
	<5006CAAD.10005@rabbitmq.com>
Message-ID: <5B5E162B-BA86-4229-A058-3D094800AB7D@gmail.com>

Hi Matthias,

After a lot of benchs, I can confirm that "hstcp" performs very badly on both Linux (F17)and OSX (Lion) R15B01.
I'll have a look to your pointers.

Thanks,
Zabrane


On Jul 18, 2012, at 4:39 PM, Matthias Radestock wrote:

> Zabrane,
> 
> On 17/07/12 14:34, Zabrane Mickael wrote:
>> Simon wrote:
>>> However, recent improvements to our use of the standard Erlang TCP
>>> implementation have improved Rabbit's performance to the point
>>> where hstcp doesn't gain anything
>> 
>> Are these improvements documented somewhere? Even source files I can
>> have look into.
> 
> Take a look at rabbit_reader.erl, in particular the recvloop and mainloop, and rabbit_net.erl.
> 
> Regards,
> 
> Matthias.



From tonygarnockjones+rabbitmq at gmail.com  Wed Jul 18 16:04:17 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Wed, 18 Jul 2012 11:04:17 -0400
Subject: [rabbitmq-discuss] So who's Judy and what does she have to do
 with the High Speed TCP driver for Erlang?
In-Reply-To: <5006CAAD.10005@rabbitmq.com>
References: <201c004f-5a1a-4b84-841c-ec8123f413d4@googlegroups.com>
	<5005319F.6090305@rabbitmq.com> <5005377D.6000409@rabbitmq.com>
	<9E6CC7A7-8F1E-4107-8083-CFAF1A9B4298@gmail.com>
	<50056716.7090302@rabbitmq.com>
	<134FCEEF-BDC9-4F68-97BD-42D6A57A010F@gmail.com>
	<5006CAAD.10005@rabbitmq.com>
Message-ID: <CAM8fPiRZ5u_9qGEaU9cjjkwgYNfm_j8_iUjd7vyn=8mgVG5xfA@mail.gmail.com>

On 18 July 2012 10:39, Matthias Radestock <matthias at rabbitmq.com> wrote:

> Take a look at rabbit_reader.erl, in particular the recvloop and mainloop,
> and rabbit_net.erl.
>

It looks like you could summarise the improvements as: instead of
requesting an exact number of bytes in the reader loop, and waiting for
that exact number to be delivered, when you need more input you set
active_once, which feeds you whatever's available. You take what's given,
and if it's (more than) enough, consume it up until it is no longer
sufficient, at which point you set active_once again.

Even shorter: the new code avoids use of async_recv and instead sets
active_once when it wants more input, until it has enough to work with.

Is that right?

Can you say anything about how much better things are this way? E.g. some
percentage improvement to throughput, presumably?

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/dda7ab18/attachment.htm>

From matthias at rabbitmq.com  Wed Jul 18 16:11:13 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 18 Jul 2012 16:11:13 +0100
Subject: [rabbitmq-discuss] So who's Judy and what does she have to do
 with the High Speed TCP driver for Erlang?
In-Reply-To: <CAM8fPiRZ5u_9qGEaU9cjjkwgYNfm_j8_iUjd7vyn=8mgVG5xfA@mail.gmail.com>
References: <201c004f-5a1a-4b84-841c-ec8123f413d4@googlegroups.com>
	<5005319F.6090305@rabbitmq.com> <5005377D.6000409@rabbitmq.com>
	<9E6CC7A7-8F1E-4107-8083-CFAF1A9B4298@gmail.com>
	<50056716.7090302@rabbitmq.com>
	<134FCEEF-BDC9-4F68-97BD-42D6A57A010F@gmail.com>
	<5006CAAD.10005@rabbitmq.com>
	<CAM8fPiRZ5u_9qGEaU9cjjkwgYNfm_j8_iUjd7vyn=8mgVG5xfA@mail.gmail.com>
Message-ID: <5006D211.4040909@rabbitmq.com>

On 18/07/12 16:04, Tony Garnock-Jones wrote:
> It looks like you could summarise the improvements as: instead of
> requesting an exact number of bytes in the reader loop, and waiting for
> that exact number to be delivered, when you need more input you set
> active_once, which feeds you whatever's available. You take what's
> given, and if it's (more than) enough, consume it up until it is no
> longer sufficient, at which point you set active_once again.
>
> Even shorter: the new code avoids use of async_recv and instead sets
> active_once when it wants more input, until it has enough to work with.
>
> Is that right?

Sounds plausible, though I think there's more to it. Note the 
tune_buffer_size, for example.

> Can you say anything about how much better things are this way? E.g.
> some percentage improvement to throughput, presumably?

I don't remember and it would take me a while to dredge up the information.

Matthias.

From simon at rabbitmq.com  Wed Jul 18 16:25:41 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 18 Jul 2012 16:25:41 +0100
Subject: [rabbitmq-discuss] So who's Judy and what does she have to do
 with the High Speed TCP driver for Erlang?
In-Reply-To: <5006D211.4040909@rabbitmq.com>
References: <201c004f-5a1a-4b84-841c-ec8123f413d4@googlegroups.com>	<5005319F.6090305@rabbitmq.com>
	<5005377D.6000409@rabbitmq.com>	<9E6CC7A7-8F1E-4107-8083-CFAF1A9B4298@gmail.com>	<50056716.7090302@rabbitmq.com>	<134FCEEF-BDC9-4F68-97BD-42D6A57A010F@gmail.com>	<5006CAAD.10005@rabbitmq.com>	<CAM8fPiRZ5u_9qGEaU9cjjkwgYNfm_j8_iUjd7vyn=8mgVG5xfA@mail.gmail.com>
	<5006D211.4040909@rabbitmq.com>
Message-ID: <5006D575.4010708@rabbitmq.com>

On 18/07/12 16:11, Matthias Radestock wrote:
>> Can you say anything about how much better things are this way? E.g.
>> some percentage improvement to throughput, presumably?
>
> I don't remember and it would take me a while to dredge up the information.

...and the changes:

a) Came in a bit at a time over several releases.
b) Vary in benefit hugely depending on message size (and to a lesser 
extent on other things).

As a one-off example, on my machine (Dell Precision T3500), single 
producer, single consumer with no acks or persistence, I get end to end:

RabbitMQ 2.8.0, 100 byte messages: ~27,000 msg/s
RabbitMQ 2.8.4, 100 byte messages: ~29,000 msg/s

RabbitMQ 2.8.0, 100 kilobyte messages: ~1,200 msg/s
RabbitMQ 2.8.4, 100 kilobyte messages: ~4,200 msg/s

So that's either a 7% improvement or a 250% improvement. Your pick.

Note that we started on the latest round of reader tuning before 2.8.0, 
but that's the first version that's easy to benchmark due to flow control.

But as usual, the moral is: There Are Tons Of Variables, Do Your Own 
Testing :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tonygarnockjones+rabbitmq at gmail.com  Wed Jul 18 16:54:18 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Wed, 18 Jul 2012 11:54:18 -0400
Subject: [rabbitmq-discuss] So who's Judy and what does she have to do
 with the High Speed TCP driver for Erlang?
In-Reply-To: <5006D575.4010708@rabbitmq.com>
References: <201c004f-5a1a-4b84-841c-ec8123f413d4@googlegroups.com>
	<5005319F.6090305@rabbitmq.com> <5005377D.6000409@rabbitmq.com>
	<9E6CC7A7-8F1E-4107-8083-CFAF1A9B4298@gmail.com>
	<50056716.7090302@rabbitmq.com>
	<134FCEEF-BDC9-4F68-97BD-42D6A57A010F@gmail.com>
	<5006CAAD.10005@rabbitmq.com>
	<CAM8fPiRZ5u_9qGEaU9cjjkwgYNfm_j8_iUjd7vyn=8mgVG5xfA@mail.gmail.com>
	<5006D211.4040909@rabbitmq.com> <5006D575.4010708@rabbitmq.com>
Message-ID: <CAM8fPiR0Z+WUmWmXn2ZtaPdJZqwVrgA5fXYP_cuNmAZMxktcqw@mail.gmail.com>

On 18 July 2012 11:25, Simon MacMullen <simon at rabbitmq.com> wrote:

> So that's either a 7% improvement or a 250% improvement. Your pick.
>

Very impressive, either way. :-) Thanks!

But as usual, the moral is: There Are Tons Of Variables, Do Your Own
> Testing :-)
>

Yep!

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/5e8d186f/attachment.htm>

From meetprashanth437 at gmail.com  Wed Jul 18 20:15:17 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Wed, 18 Jul 2012 15:15:17 -0400
Subject: [rabbitmq-discuss] Publisher Confirms in mirrored queues
Message-ID: <CAE8G+yQ2BPz=+EUbo=LkAjm26TYLORAsXs=NENcmvyc=B17B_w@mail.gmail.com>

Hi all,

I was confused after reading the publisher confirm documentation.

Similarly, messages published by clients using publisher
confirms<http://www.rabbitmq.com/extensions.html#confirms> will
still be confirmed correctly even if the master (or any slaves) fail
between the message being published and the message being able to be
confirmed to the publisher. Thus from the point of view of the publisher,
publishing to a mirrored-queue is no different from publishing to any other
sort of queue. It is only consumers that need to be aware of the
possibility of needing to re-consume from a mirrored-queue upon receipt of
a Consumer Cancellation
Notification<http://www.rabbitmq.com/extensions.html#consumer-cancel-notify>
.

Equally, in the case of publisher confirms, a message will only be
confirmed to the publisher when it has been accepted by all of the mirrors.
It is correct to think of the semantics as being the same as a message
being routed to multiple normal queues, and of a transaction with
publications within that similarly are routed to multiple queues.

After reading the above lines. Now I am confused about the publisher
confirms. The first paragraph says that publishing to mirrored queues is
like publishing to each individual queue. Messages are published to all the
queues and each queue sends publisher confirms. In the second paragraph it
says a message will only be confirmed to the publisher when it has been
accepted by all of the mirrors.
Those two paragraph looks like they say two opposite things.

Please, correct me if I am wrong.


Thanks,
Prashanth.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/34d20521/attachment.htm>

From watson.timothy at gmail.com  Wed Jul 18 21:52:33 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 18 Jul 2012 21:52:33 +0100
Subject: [rabbitmq-discuss] Publisher Confirms in mirrored queues
In-Reply-To: <CAE8G+yQ2BPz=+EUbo=LkAjm26TYLORAsXs=NENcmvyc=B17B_w@mail.gmail.com>
References: <CAE8G+yQ2BPz=+EUbo=LkAjm26TYLORAsXs=NENcmvyc=B17B_w@mail.gmail.com>
Message-ID: <6092C8DC-E378-4CE1-8E53-F88315333F18@rabbitmq.com>


On 18 Jul 2012, at 20:15, Prashanth <meetprashanth437 at gmail.com> wrote:

> Hi all,
> 

Hi

> I was confused after reading the publisher confirm documentation.
> 
> Similarly, messages published by clients using publisher confirms will still be confirmed correctly even if the master (or any slaves) fail between the message being published and the message being able to be confirmed to the publisher. Thus from the point of view of the publisher, publishing to a mirrored-queue is no different from publishing to any other sort of queue. It is only consumers that need to be aware of the possibility of needing to re-consume from a mirrored-queue upon receipt of a Consumer Cancellation Notification.
> 

So from the publisher's point of view, it looks like just one queue and the confirm means every surviving mirror has received and accepted the message.

> Equally, in the case of publisher confirms, a message will only be confirmed to the publisher when it has been accepted by all of the mirrors. It is correct to think of the semantics as being the same as a message being routed to multiple normal queues, and of a transaction with publications within that similarly are routed to multiple queues.
> 
> After reading the above lines. Now I am confused about the publisher confirms. The first paragraph says that publishing to mirrored queues is like publishing to each individual queue.

Where does it say that? It says that publishing to mirrored queues is atomic with respect to confirms.

> Messages are published to all the queues and each queue sends publisher confirms.

That's not what it says. It says that all queues will have the message before a confirm is sent to the publisher from the queue to which it originally published.

The publisher knows next to nothing about the mirrors.

> In the second paragraph it says a message will only be confirmed to the publisher when it has been accepted by all of the mirrors.
> Those two paragraph looks like they say two opposite things.
> 
> Please, correct me if I am wrong.
> 
> 
> Thanks,
> Prashanth.
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/03ae5de7/attachment.htm>

From milan at m-i.com.au  Thu Jul 19 02:15:44 2012
From: milan at m-i.com.au (mrajkovic)
Date: Wed, 18 Jul 2012 18:15:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster Setup
In-Reply-To: <EC965831-7513-4BB2-AF39-009E79FACE1A@rabbitmq.com>
References: <1342362081660-20805.post@n5.nabble.com>
	<5002F355.4060308@rabbitmq.com>
	<1342617148033-20878.post@n5.nabble.com>
	<BA2B858E-BD33-4BA4-B615-E985DBAB7E69@rabbitmq.com>
	<DCAA63C5E787D7428471C0F93BEBFBBAC647A0C0@MI-EX-01.sgc.m-i.local>
	<38DE1FE1-DE99-4FA1-8603-0465595E2CCD@rabbitmq.com>
	<DCAA63C5E787D7428471C0F93BEBFBBAC647A286@MI-EX-01.sgc.m-i.local>
	<EC965831-7513-4BB2-AF39-009E79FACE1A@rabbitmq.com>
Message-ID: <DCAA63C5E787D7428471C0F93BEBFBBAC647DB80@MI-EX-01.sgc.m-i.local>

Hi Tim,

Sorry it was 1am locally here when we were emailing last night, and I needed to getup for an early morning appointment?.

telnet has blocked it on that port?
root at mf-01:~# telnet mf-02 4369
Trying 119.31.227.106...
telnet: Unable to connect to remote host: Connection refused

then I ran netstat on mf-02
root at mf-02:~# netstat -p -l --numeric-ports
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      995/mysqld
tcp        0      0 0.0.0.0:10000           0.0.0.0:*               LISTEN      2028/perl
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1982/apache2
tcp        0      0 127.0.0.1:4369          0.0.0.0:*               LISTEN      1868/epmd
tcp        0      0 0.0.0.0:53              0.0.0.0:*               LISTEN      935/dnsmasq
tcp        0      0 0.0.0.0:21              0.0.0.0:*               LISTEN      764/vsftpd
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      800/sshd
tcp        0      0 0.0.0.0:25              0.0.0.0:*               LISTEN      1755/master
tcp        0      0 0.0.0.0:39616           0.0.0.0:*               LISTEN      26602/beam.smp
tcp        0      0 119.31.227.106:5672     0.0.0.0:*               LISTEN      26602/beam.smp
tcp6       0      0 :::53                   :::*                    LISTEN      935/dnsmasq
tcp6       0      0 :::22                   :::*                    LISTEN      800/sshd
tcp6       0      0 :::25                   :::*                    LISTEN      1755/master
udp        0      0 0.0.0.0:53              0.0.0.0:*                           935/dnsmasq
udp        0      0 0.0.0.0:43242           0.0.0.0:*                           1613/dccifd
udp        0      0 0.0.0.0:10000           0.0.0.0:*                           2028/perl
udp6       0      0 :::53                   :::*                                935/dnsmasq

it looks like its only listening on localhost and not all ports

--------------
Milan Rajkovic - Managing Director
Victoria Office

[Description: cid:image001.png at 01CCB47A.7C40E7E0]<http://m-i.com.au/>





Tel:

1300 022 735





Fax:

1300 022 751





Email:

milan at m-i.com.au<mailto:milan at m-i.com.au>





Website:

www.m-i.com.au<http://www.m-i.com.au/>





Office Address:

Level 1 / 355 High Street Northcote VIC 3070 Australia





Mailing Address:

P.O.Box 84 Northcote VIC 3070 Australia


[Description: cid:image002.jpg at 01CCB47A.7C40E7E0][Description: cid:image003.jpg at 01CCB47A.7C40E7E0]<https://www.tenders.gov.au/?event=ICTMUL:public.ICTMUL.participant.searchView&participantUUID=E72C0627-D418-A121-32C3729E4238C493>
P Milan Industries is committed to the environment, so please consider the future before printing this email.
________________________________
IMPORTANT NOTICE:
The contents of this email are intended for the named recipient(s) only! This email may include personal or sensitive information, such information must be handled in accordance with the Information Privacy Act 2000 (Victoria), Privacy Act 1988 (commonwealth) and Spam Act 2003 (Commonwealth), as applicable. The information in this email is confidential to the intended recipient and may be the subject of legal professional privilege and copyright. Any such privilege is not waived by mistaken delivery of this email. If you are not the intended recipient you must not copy, distribute, disclose to anyone or take any action in reliance upon this email or its attachments. Milan Industries does not accept any responsibility for any loss or damage arising in any way from reliance upon, or use of this email or any attachments by any party not authorised to receive it.  If you believe you have received this e-mail in error, or have not given consent to receive this email as defined by the Spam Act 2003 (Commonwealth), please notify the sender immediately by return email and your email address will be removed within 5 days or telephone Milan Industries on +61 3 9948 4040 and then delete the email and any attachments.  Milan Industries does not warrant that this email and any attachments are virus free and recommends that all emails and attachments be checked for computer viruses.
________________________________

From: Tim Watson-6 [via RabbitMQ] [mailto:ml-node+s1065348n20888h79 at n5.nabble.com]
Sent: Thursday, 19 July 2012 12:51 AM
To: Milan Rajkovic
Subject: Re: Cluster Setup

On 18 Jul 2012, at 15:31, mrajkovic wrote:
root at mf-01:~# telnet
telnet> open mf-02 5672
Trying 119.31.227.106...
Connected to mf-02.cloud.m-i.com.au.
Escape character is '^]'.

a
asd
AMQP    Connection closed by foreign host.


telnet works?

No sorry, I'm clearly having concentration problems this afternoon. You need to telnet onto the epmd port 4369. I'm assuming you cannot do that? Unless you've set ERL_EPMD_ADDRESS or you have some local configuration on that machine preventing epmd from listening to anything but localhost, I can't see why this would be happening. Please confirm that telnet is *not* working as expected.


_______________________________________________
rabbitmq-discuss mailing list
[hidden email]</user/SendEmail.jtp?type=node&node=20888&i=0>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

________________________________
If you reply to this email, your message will be added to the discussion below:
http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805p20888.html
To unsubscribe from Cluster Setup, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=20805&code=bWlsYW5AbS1pLmNvbS5hdXwyMDgwNXwtNTM2MTU2Mjk=>.
NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>

--
This message has been scanned for viruses and dangerous content by Milan Industries Cloud Email Security<http://www.m-i.com.au>

-- 
This message has been scanned for viruses and dangerous content by Milan Industries Cloud Email Security



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cluster-Setup-tp20805p20897.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/917ff6f0/attachment.htm>

From tim at rabbitmq.com  Thu Jul 19 03:57:24 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 19 Jul 2012 03:57:24 +0100
Subject: [rabbitmq-discuss] Cluster Setup
In-Reply-To: <DCAA63C5E787D7428471C0F93BEBFBBAC647DB80@MI-EX-01.sgc.m-i.local>
References: <1342362081660-20805.post@n5.nabble.com>
	<5002F355.4060308@rabbitmq.com>
	<1342617148033-20878.post@n5.nabble.com>
	<BA2B858E-BD33-4BA4-B615-E985DBAB7E69@rabbitmq.com>
	<DCAA63C5E787D7428471C0F93BEBFBBAC647A0C0@MI-EX-01.sgc.m-i.local>
	<38DE1FE1-DE99-4FA1-8603-0465595E2CCD@rabbitmq.com>
	<DCAA63C5E787D7428471C0F93BEBFBBAC647A286@MI-EX-01.sgc.m-i.local>
	<EC965831-7513-4BB2-AF39-009E79FACE1A@rabbitmq.com>
	<DCAA63C5E787D7428471C0F93BEBFBBAC647DB80@MI-EX-01.sgc.m-i.local>
Message-ID: <FAB529FB-82AD-4764-ADEB-4A1CDE6DAF13@rabbitmq.com>

On 19 Jul 2012, at 02:15, mrajkovic wrote:
> Hi Tim,
> 
>  
> 
> Sorry it was 1am locally here when we were emailing last night, and I needed to getup for an early morning appointment?.
> 
> 

Sleeping is pretty important, so fair enough! :)
>  
> 
> 
> telnet has blocked it on that port?
> 
> root at mf-01:~# telnet mf-02 4369
> 
> Trying 119.31.227.106...
> 
> telnet: Unable to connect to remote host: Connection refused
> 
> 

That's more like what we'd expect, given that epmd isn't listening other than on localhost.

>  
> 
> then I ran netstat on mf-02
> 
> root at mf-02:~# netstat -p -l --numeric-ports
> 
> Active Internet connections (only servers)
> 
> Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
> 
> tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      995/mysqld
> 
> tcp        0      0 0.0.0.0:10000           0.0.0.0:*               LISTEN      2028/perl
> 
> tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1982/apache2
> 
> tcp        0      0 127.0.0.1:4369          0.0.0.0:*               LISTEN      1868/epmd
> 

So only listening for local traffic. That's not what we should be seeing:

iske:~ root# netstat -a | grep LISTEN
tcp4       0      0  *.epmd                 *.*                    LISTEN     
tcp4       0      0  *.62693                *.*                    LISTEN     
tcp4       0      0  localhost.ipp          *.*                    LISTEN     
tcp6       0      0  localhost.ipp          *.*                    LISTEN     
iske:~ root# 

> tcp        0      0 0.0.0.0:53              0.0.0.0:*               LISTEN      935/dnsmasq
> 
> tcp        0      0 0.0.0.0:21              0.0.0.0:*               LISTEN      764/vsftpd
> 
> tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      800/sshd
> 
> tcp        0      0 0.0.0.0:25              0.0.0.0:*               LISTEN      1755/master
> 
> tcp        0      0 0.0.0.0:39616           0.0.0.0:*               LISTEN      26602/beam.smp
> 
> tcp        0      0 119.31.227.106:5672     0.0.0.0:*               LISTEN      26602/beam.smp
> 

And clearly not all programs are having this problem. Indeed beam is running and listening happily enough.

> tcp6       0      0 :::53                   :::*                    LISTEN      935/dnsmasq
> 
> tcp6       0      0 :::22                   :::*                    LISTEN      800/sshd
> 
> tcp6       0      0 :::25                   :::*                    LISTEN      1755/master
> 
> udp        0      0 0.0.0.0:53              0.0.0.0:*                           935/dnsmasq
> 
> udp        0      0 0.0.0.0:43242           0.0.0.0:*                           1613/dccifd
> 
> udp        0      0 0.0.0.0:10000           0.0.0.0:*                           2028/perl
> 
> udp6       0      0 :::53                   :::*                                935/dnsmasq
> 
>  
> 
> it looks like its only listening on localhost and not all ports
> 
> 
Clearly. The environment variables that govern epmd's behaviour (taken from http://www.erlang.org/doc/man/epmd.html) are:

ERL_EPMD_ADDRESS
This environment variable may be set to a comma-separated list of IP addresses, in which case the epmd daemon will listen only on the specified address(es) and on the loopback address (which is implicitly added to the list if it           has not been specified). The default behaviour is to listen on all available IP addresses.

And in terms of access restrictions, the same source gives us: 

<quote>
Access restrictions
The epmd daemon accepts messages from both localhost and remote hosts. However, only the query commands are answered (and acted upon) if the query comes from a remote host. It is always an error to try to register a nodename if the client is not a process located on the same host as the epmd instance is running on, why such requests are considered hostile and the connection is immediately closed.

The queries accepted from remote nodes are:

Port queries - i.e. on which port does the node with a given name listen

Name listing - i.e. give a list of all names registered on the host

To restrict access further, firewall software has to be used.

</quote>

Finally, you can control the list of IP addresses epmd will listen on using the `-address List` flags on startup. Rabbit does not do any of these things, your environment config file isn't doing this and so I'm left a little confused. For the beam (emulator) you can set a parameter in the kernel application (inet_dist_use_interface) to control this, but you're not doing that AFAICT - you don't have any other config files (e.g., in wherever RABBITMQ_CONFIG_FILE is pointing) do you? /etc/rabbitmq can contain a rabbitmq.config file as well as the environment config file you posted originally. Is there anything in there? Even so, inet_dist_use_interface doesn't actually affect what addresses epmd will LISTEN on anyway AFAICT.

Is it possible that some other software in your environment could be starting epmd with -address *before* the rabbit nodes are started up? So really I'm at a bit of a loss here. Could you add to the mix by letting me know what Erlang/OTP version you've got installed, where it came from (i.e., apt, compiled from source, etc)? 

Having looked at the epmd source code, if there are no explicit addresses passed to the server then epmd uses INADDR_ANY, which listens on all interfaces (on most linux variants anyway). Unless you can find something in the configuration and/or environment, or there is something going on that causes INADDR_ANY to only bind to localhost (the result of muti-homing or some such) then I don't know what's going on with this one. Unless someone else has any light to shed, or you're able to locate some extraneous config/environment then we might have to take a wander over to the erlang-questions mailing list and ask there, though I will need you to come along and ask the question initially as I'm not the one who's able to replicate this behaviour.

One last question. You're not trying to run rabbit in a restricted environment (i.e., in a jail) are you? It could just be possible that security permissions are restricting the available addresses you can bind to. 

Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120719/fa622b7d/attachment.htm>

From clemens.kol at gmail.com  Wed Jul 18 22:16:06 2012
From: clemens.kol at gmail.com (Clemens Kolbitsch)
Date: Wed, 18 Jul 2012 14:16:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Build deb package including plugins
Message-ID: <c750c7b0-ee78-41b0-8dc6-fc0fcbcb1c83@googlegroups.com>

Hi,

I'm trying to build the latest mecurial version into a deb package and 
include specific plugins in the deb. I've followed the build instructions, 
and although the build works, no plugins are included in the deb (and I 
have to copy them manually into the plugins directory). I guess I have to 
add the plugins in some build config or link them somewhere else, but I 
don't know where.

Here is what I do:

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
cd rabbitmq-public-umbrella
make co

export VERSION=2.8.4

cd rabbitmq-management
make
cd ..

cd rabbitmq-shovel
make
cd ..

cd rabbitmq-shovel-management
make
cd ..

cd rabbitmq-server

mkdir plugins
cd plugins
ln -s ../../rabbitmq-shovel
ln -s ../../rabbitmq-shovel-management/
ln -s ../../rabbitmq-management/
cd ..

make
make srcdist

cd packaging/debs/Debian/
dch -i
make package


Any hint is greatly appreciated!
thanks,
Clemens
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120718/e28d4148/attachment.htm>

From clemens.kol at gmail.com  Wed Jul 18 22:22:19 2012
From: clemens.kol at gmail.com (Clemens Kolbitsch)
Date: Wed, 18 Jul 2012 14:22:19 -0700
Subject: [rabbitmq-discuss] Build deb package including plugins
Message-ID: <CACDZx9j=r-nNz=KC5HKYmjgvOt3h7TEBLR=pVHjs969XOhVT-w@mail.gmail.com>

Hi,

I'm trying to build the latest mecurial version into a deb package and
include specific plugins in the deb. I've followed the build
instructions, and although the build works, no plugins are included in
the deb (and I have to copy them manually into the plugins directory).
I guess I have to add the plugins in some build config or link them
somewhere else, but I don't know where.

Here is what I do:

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella
cd rabbitmq-public-umbrella
make co

export VERSION=2.8.4

cd rabbitmq-management
make
cd ..

cd rabbitmq-shovel
make
cd ..

cd rabbitmq-shovel-management
make
cd ..

cd rabbitmq-server

mkdir plugins
cd plugins
ln -s ../../rabbitmq-shovel
ln -s ../../rabbitmq-shovel-management/
ln -s ../../rabbitmq-management/
cd ..

make
make srcdist

cd packaging/debs/Debian/
dch -i
make package


Any hint is greatly appreciated!
thanks,
Clemens


BTW: sorry for double-posting, I was not on the mailing list initially

From wenhui.li at quanshi.com  Thu Jul 19 03:44:46 2012
From: wenhui.li at quanshi.com (Li, Wenhui)
Date: Thu, 19 Jul 2012 10:44:46 +0800
Subject: [rabbitmq-discuss] Can you give me some advices About RabbitMQ
Message-ID: <000c01cd6558$7809fba0$681df2e0$@li@quanshi.com>

Hi Guys,

 

How are you?  I am sorry to bother you! I am a BlackBerry developer, now we
have a BlackBerry project need use your product RabbitMQ.

But, when we download the latest RabbitMQ client zip and import our project,
we found many error.

Through research we found that these errors are due to Java jdk version. The
Blackberry jdk base on the j2me, in other words, the blackberry api

Just only support j2me sdk, but your RabbitMQ client code base on the j2se
sdk, so, some RabbitMQ use the API can't be support by RIM, such as

HashMap. Cloneable interface, EvevntListener interface and so on. I have
tried to modify those errors, but found it is very difficult, because change
this will make some 

More error in other class.

 

Can you give some advice or idea for this problem? Please..

 

I am very appreciate, thank you very much.

 

 

Thanks,

 

Kevin Lee

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120719/8a392753/attachment.htm>

From avinash0601 at gmail.com  Thu Jul 19 05:08:00 2012
From: avinash0601 at gmail.com (avinash0601)
Date: Wed, 18 Jul 2012 21:08:00 -0700 (PDT)
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
Message-ID: <1342670880360-20899.post@n5.nabble.com>

Hi all,
I am new to rabbitmq & i have tried configuring a rabbitmq cluster locally &
i was successful but now i m not able able to configure it on ec2.
can anybody provide complete steps which would help me to setup rabbitmq
cluster on ec2.

Thanks.

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/unable-to-cluster-rabbitmq-on-ec2-tp20899.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From watson.timothy at gmail.com  Thu Jul 19 10:08:08 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 19 Jul 2012 10:08:08 +0100
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <1342670880360-20899.post@n5.nabble.com>
References: <1342670880360-20899.post@n5.nabble.com>
Message-ID: <0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>


On 19 Jul 2012, at 05:08, avinash0601 <avinash0601 at gmail.com> wrote:

> Hi all,
> I am new to rabbitmq & i have tried configuring a rabbitmq cluster locally &
> i was successful but now i m not able able to configure it on ec2.
> can anybody provide complete steps which would help me to setup rabbitmq
> cluster on ec2.
> 

Well I can't do this for you, but if you provide a bit more information about what is not working for you on ec2, then we might be able to help diagnose the problem.

> Thanks.
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/unable-to-cluster-rabbitmq-on-ec2-tp20899.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From avinash0601 at gmail.com  Thu Jul 19 10:18:29 2012
From: avinash0601 at gmail.com (avinash0601)
Date: Thu, 19 Jul 2012 02:18:29 -0700 (PDT)
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>
References: <1342670880360-20899.post@n5.nabble.com>
	<0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>
Message-ID: <1342689509712-20904.post@n5.nabble.com>

hey Tim,
i have 3 instances for clustering on ec2.
i dont want to use the hostnames provided by amazon so my hostnames now are
rabbit1, rabbit2 & rabbit3.
i have restricted epmd communication to ports 9100-9105 in
/usr/lib/erlang/bin/sys.config by making en entry
*[{kernel,[{inet_dist_listen_min, 9100},{inet_dist_listen_max,9105}]}].*
opened ports 5672, 55672, 4369, 9100-9105 on all 3 instances.
so on rabbit1 i did stop_app, reset & then trying to create a cluster by
*rabbitmqctl cluster rabbit at rabbit2 rabbit at rabbit1* its saying 
*Clustering node rabbit at rabbit1 with [rabbit at rabbit2,rabbit at rabbit1] ...
Error: {no_running_cluster_nodes,[rabbit at rabbit2],[rabbit at rabbit2]}*
do i need to do something else.

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/unable-to-cluster-rabbitmq-on-ec2-tp20899p20904.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mtlotfizad at gmail.com  Thu Jul 19 10:25:49 2012
From: mtlotfizad at gmail.com (Mohsen Lotfizad)
Date: Thu, 19 Jul 2012 13:55:49 +0430
Subject: [rabbitmq-discuss] Consumer's confirm
Message-ID: <CAJzgYrB_E97bCkvyOFy9BgKFy=s=R0UU-9FXhQk0d3jvJdXmRg@mail.gmail.com>

Hi

I have a project that producers want to assure their message are delivered
to consumers.
I make a Google search and find rabbitMQ transaction and confirm from (
http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/) .
I download discussed examples and run them. But I comment the consumer
part. with my surprise producer gives ack, even if I uncomment  consumer
part and send NACK instead of ack!

what should I do to route consumers ack to producer?

ps: does com.rabbitmq.client.Channel#addReturnListener helps me?

-- 

Sincerely
ML
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120719/118c9f0d/attachment.htm>

From francesco at rabbitmq.com  Thu Jul 19 10:26:54 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 19 Jul 2012 10:26:54 +0100
Subject: [rabbitmq-discuss] Can you give me some advices About RabbitMQ
In-Reply-To: <000c01cd6558$7809fba0$681df2e0$@li@quanshi.com>
Message-ID: <87d33skso1.wl%francesco@rabbitmq.com>

At Thu, 19 Jul 2012 10:44:46 +0800,
Li, Wenhui wrote:
> Hi Guys,
> 
> How are you?  I am sorry to bother you! I am a BlackBerry developer, now we
> have a BlackBerry project need use your product RabbitMQ.
> 
> But, when we download the latest RabbitMQ client zip and import our project,
> we found many error.
> 
> Through research we found that these errors are due to Java jdk version. The
> Blackberry jdk base on the j2me, in other words, the blackberry api
> 
> Just only support j2me sdk, but your RabbitMQ client code base on the j2se
> sdk, so, some RabbitMQ use the API can?t be support by RIM, such as
> 
> HashMap. Cloneable interface, EvevntListener interface and so on. I have tried
> to modify those errors, but found it is very difficult, because change this
> will make some
> 
> More error in other class.
> 
> Can you give some advice or idea for this problem? Please?.
> 
> I am very appreciate, thank you very much?

If I understand correctly, you are trying to install the Java client on a
BlackBerry and you are encountering problems because the Java client is not
compatible with the jdk available on BlackBerry (j2me).

In that case, I don't know what the j2me is like, but if it really lacks the
basic classes that you mentioned, I doubt that porting the Java client is an
option.

What I can suggest to do if you can't find an AMQP client that runs on
BlackBerry is to try with STOMP, which is a far simpler protocol supported by
RabbitMQ via a plugin.

--
Francesco * Often in error, never in doubt

From tim at rabbitmq.com  Thu Jul 19 11:13:27 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 19 Jul 2012 11:13:27 +0100
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <1342689509712-20904.post@n5.nabble.com>
References: <1342670880360-20899.post@n5.nabble.com>
	<0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>
	<1342689509712-20904.post@n5.nabble.com>
Message-ID: <5007DDC7.6080902@rabbitmq.com>

On 07/19/2012 10:18 AM, avinash0601 wrote:
> hey Tim,

Hi!

> i have 3 instances for clustering on ec2.
> i dont want to use the hostnames provided by amazon so my hostnames now are
> rabbit1, rabbit2&  rabbit3.

Ok. You've set this up how? What OS are you running, what does the 
/etc/hosts look like?

> i have restricted epmd communication to ports 9100-9105 in
> /usr/lib/erlang/bin/sys.config by making en entry
> *[{kernel,[{inet_dist_listen_min, 9100},{inet_dist_listen_max,9105}]}].*

Well that doesn't actually control what ports epmd uses, but the ports 
on which the node started with these kernel parameters will accept 
connections from other nodes that are registered with the port mapper 
daemon. The port on which epmd listens is controlled by either passing 
-port <port-num: default=4369> or setting tghe ERL_EPMD_PORT environment 
variable.

> opened ports 5672, 55672, 4369, 9100-9105 on all 3 instances.

On each machine that will host distributed Erlang nodes, the naming 
server (epmd) must be running. If you wish to inter-connect nodes 
between these machines, their epmd instances must be accessible to the 
outside world (on whatever port(s) they're running on). These (epmd) 
ports have to be open, and the cookie security system ensures that 
unauthorised connections to nodes on the individual hosts are disallowed.

If the port that epmd is running on for each of these instances is not 
open, then clustering will not work, as the nodes will not be able to 
communicate.
> so on rabbit1 i did stop_app, reset&  then trying to create a cluster by
> *rabbitmqctl cluster rabbit at rabbit2 rabbit at rabbit1* its saying
> *Clustering node rabbit at rabbit1 with [rabbit at rabbit2,rabbit at rabbit1] ...
> Error: {no_running_cluster_nodes,[rabbit at rabbit2],[rabbit at rabbit2]}*
> do i need to do something else.

Check that epmd on each node is accessible from all the others. You can 
do this by attempting to telnet from the other nodes: `telnet rabbit1 
4369` should succeed.


From tim at rabbitmq.com  Thu Jul 19 11:19:17 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 19 Jul 2012 11:19:17 +0100
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <5007DDC7.6080902@rabbitmq.com>
References: <1342670880360-20899.post@n5.nabble.com>
	<0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>
	<1342689509712-20904.post@n5.nabble.com>
	<5007DDC7.6080902@rabbitmq.com>
Message-ID: <5007DF25.9010802@rabbitmq.com>

Also, have you been through http://www.rabbitmq.com/troubleshooting.html 
and http://www.rabbitmq.com/clustering.html in detail to make sure 
you're not missing any steps?

On 07/19/2012 11:13 AM, Tim Watson wrote:
> On 07/19/2012 10:18 AM, avinash0601 wrote:
>> hey Tim,
>
> Hi!
>
>> i have 3 instances for clustering on ec2.
>> i dont want to use the hostnames provided by amazon so my hostnames 
>> now are
>> rabbit1, rabbit2&  rabbit3.
>
> Ok. You've set this up how? What OS are you running, what does the 
> /etc/hosts look like?
>
>> i have restricted epmd communication to ports 9100-9105 in
>> /usr/lib/erlang/bin/sys.config by making en entry
>> *[{kernel,[{inet_dist_listen_min, 9100},{inet_dist_listen_max,9105}]}].*
>
> Well that doesn't actually control what ports epmd uses, but the ports 
> on which the node started with these kernel parameters will accept 
> connections from other nodes that are registered with the port mapper 
> daemon. The port on which epmd listens is controlled by either passing 
> -port <port-num: default=4369> or setting tghe ERL_EPMD_PORT 
> environment variable.
>
>> opened ports 5672, 55672, 4369, 9100-9105 on all 3 instances.
>
> On each machine that will host distributed Erlang nodes, the naming 
> server (epmd) must be running. If you wish to inter-connect nodes 
> between these machines, their epmd instances must be accessible to the 
> outside world (on whatever port(s) they're running on). These (epmd) 
> ports have to be open, and the cookie security system ensures that 
> unauthorised connections to nodes on the individual hosts are disallowed.
>
> If the port that epmd is running on for each of these instances is not 
> open, then clustering will not work, as the nodes will not be able to 
> communicate.
>> so on rabbit1 i did stop_app, reset&  then trying to create a cluster by
>> *rabbitmqctl cluster rabbit at rabbit2 rabbit at rabbit1* its saying
>> *Clustering node rabbit at rabbit1 with [rabbit at rabbit2,rabbit at rabbit1] ...
>> Error: {no_running_cluster_nodes,[rabbit at rabbit2],[rabbit at rabbit2]}*
>> do i need to do something else.
>
> Check that epmd on each node is accessible from all the others. You 
> can do this by attempting to telnet from the other nodes: `telnet 
> rabbit1 4369` should succeed.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Thu Jul 19 11:30:10 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 19 Jul 2012 11:30:10 +0100
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <5007DF25.9010802@rabbitmq.com>
References: <1342670880360-20899.post@n5.nabble.com>
	<0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>
	<1342689509712-20904.post@n5.nabble.com>
	<5007DDC7.6080902@rabbitmq.com> <5007DF25.9010802@rabbitmq.com>
Message-ID: <5007E1B2.3040206@rabbitmq.com>

On 07/19/2012 11:19 AM, Tim Watson wrote:
> Also, have you been through 
> http://www.rabbitmq.com/troubleshooting.html and 
> http://www.rabbitmq.com/clustering.html in detail to make sure you're 
> not missing any steps?
>

And BTW, if you do add the inet_dist_listen_min and inet_dist_listen_max 
entries to riak/etc/app.config, you need to restart any running epmd on 
those hosts.

From tim at rabbitmq.com  Thu Jul 19 11:33:42 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 19 Jul 2012 11:33:42 +0100
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <5007E1B2.3040206@rabbitmq.com>
References: <1342670880360-20899.post@n5.nabble.com>
	<0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>
	<1342689509712-20904.post@n5.nabble.com>
	<5007DDC7.6080902@rabbitmq.com> <5007DF25.9010802@rabbitmq.com>
	<5007E1B2.3040206@rabbitmq.com>
Message-ID: <5007E286.2090607@rabbitmq.com>

On 07/19/2012 11:30 AM, Tim Watson wrote:
> On 07/19/2012 11:19 AM, Tim Watson wrote:
>> Also, have you been through 
>> http://www.rabbitmq.com/troubleshooting.html and 
>> http://www.rabbitmq.com/clustering.html in detail to make sure you're 
>> not missing any steps?
>>
>
> And BTW, if you do add the inet_dist_listen_min and 
> inet_dist_listen_max entries to riak/etc/app.config, you need to 
> restart any running epmd on those hosts.

Sorry, cut+paste error there: /etc/rabbitmq obviously not riak. And BTW 
you should look at 
http://comments.gmane.org/gmane.comp.networking.rabbitmq.general/14867 
if you're on EC2 and have recently made security changes, as by the 
sounds of things this might need a bit of encouragement to get applied.

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Thu Jul 19 11:38:45 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 19 Jul 2012 11:38:45 +0100
Subject: [rabbitmq-discuss] Consumer's confirm
In-Reply-To: <CAJzgYrB_E97bCkvyOFy9BgKFy=s=R0UU-9FXhQk0d3jvJdXmRg@mail.gmail.com>
References: <CAJzgYrB_E97bCkvyOFy9BgKFy=s=R0UU-9FXhQk0d3jvJdXmRg@mail.gmail.com>
Message-ID: <037FFC17-EA00-4079-B26E-B41E7D19A152@rabbitmq.com>

ML,

The definitive guide to Publish-confirms is in the extensions
documentation [1], where it says:

> By confirming a message the broker assumes responsibility for it and
> indicates that it has done something it deems reasonable with it.
> Unroutable mandatory or immediate messages are confirmed right after
> thebasic.return. Transient messages are confirmed as soon as they arrive
> on all the queues they were routed to. Persistent messages are confirmed
> when all queues have either delivered the message and received an
> acknowledgement (if required), or persisted the message.

Notice that a confirmation does not necessarily mean that a consumer has
received and acknowledged the message; in general it means that RabbitMQ
has successfully 'processed' the message, which might mean 'persisted' it, if
it is persistent, or returned it, if it was unroutable (and marked
mandatory), etc.

You may wish to investigate the 'immediate' and 'mandatory' flags. Be
aware that you cannot use 'publisher confirms' on a transactional
channel.

[1] http://www.rabbitmq.com/extensions.html#confirms

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 19 Jul 2012, at 10:25, Mohsen Lotfizad wrote:

> Hi
> 
> I have a project that producers want to assure their message are delivered to consumers.
> I make a Google search and find rabbitMQ transaction and confirm from (http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/) . I download discussed examples and run them. But I comment the consumer part. with my surprise producer gives ack, even if I uncomment  consumer part and send NACK instead of ack!
> 
> what should I do to route consumers ack to producer?
> 
> ps: does com.rabbitmq.client.Channel#addReturnListener helps me?
> 
> -- 
> 
> Sincerely 
> ML
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Thu Jul 19 11:41:17 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 19 Jul 2012 11:41:17 +0100
Subject: [rabbitmq-discuss] Restarting/re-establising failed federation
 connections
In-Reply-To: <CAO70NwvM3Zq1=jX=iMaFupSb1Hct2gVsWojiw+L_Di5_f=XgyQ@mail.gmail.com>
References: <e5c07cc1-c5c2-4614-aef8-cee6dbcb64a7@googlegroups.com>
	<9F05622A-2DB9-4165-AC1D-E550E479B718@rabbitmq.com>
	<CAO70NwvM3Zq1=jX=iMaFupSb1Hct2gVsWojiw+L_Di5_f=XgyQ@mail.gmail.com>
Message-ID: <5007E44D.5090608@rabbitmq.com>

David,

On 18/07/12 01:56, David Gillies wrote:
> I've posted up the logs from the downstream server from around the time
> that one of the upstream servers lose connectivity and the downstream
> server is never able to connect again here:
> https://gist.github.com/85da45443b92e69e29a0

Please use the correct terminology, it gets really confusing otherwise. 
In federation, messages flow from the upstream to the downstream (makes 
sense, doesn't it?), and connections are established from the downstream 
to the upstream.

Anyway, There is nothing unusual in the logs...the downstreams (using 
the correct terminology) lose connectivity and try to re-establish it. 
They *should* keep trying indefinitely. Is there any evidence that they 
don't?

There is nothing special about the way federation establishes 
connections, so if at some point you think that a downstream should be 
able to connect to the upstream but doesn't, then run an ordinary amqp 
client on the downstream machine and see whether it can connect to the 
upstream.

Regards,

Matthias.

From steve at rabbitmq.com  Thu Jul 19 12:11:56 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 19 Jul 2012 12:11:56 +0100
Subject: [rabbitmq-discuss] Consumer's confirm
In-Reply-To: <037FFC17-EA00-4079-B26E-B41E7D19A152@rabbitmq.com>
References: <CAJzgYrB_E97bCkvyOFy9BgKFy=s=R0UU-9FXhQk0d3jvJdXmRg@mail.gmail.com>
	<037FFC17-EA00-4079-B26E-B41E7D19A152@rabbitmq.com>
Message-ID: <C3838973-C151-41C9-9423-7D5798048155@rabbitmq.com>

ML,

I realise that I haven't really answered your question:

>> what should I do to route consumers ack to producer?


The RabbitMQ broker isolates the publishers from knowledge of the
consumers and vice versa; this includes knowing if there are there and
have acknowledged the message. This makes it tricky to get RabbitMQ to
do what you want directly.

One way to achieve it is to use reply-to queues: temporary queues which
the publisher sets up (for a particular message, or for many messages)
which the consumer can then publish a response to. If the reply-to queue
is provided to the consumer with the published message, the consumer can
programmatically respond to the publisher without having to know who the
publisher is (or if it is available, etc.).

This mechanism is exploited in the RPC tutorial [1], which you should
read. With RPC, the client (caller) blocks until the reply is received;
but you might not want to do that. I'm sure this will help you to
implement a solution for your case.

Good luck,

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

[1] http://www.rabbitmq.com/tutorials/tutorial-six-java.html

> ML,
> 
> The definitive guide to Publish-confirms is in the extensions
> documentation [1], where it says:
> 
>> By confirming a message the broker assumes responsibility for it and
>> indicates that it has done something it deems reasonable with it.
>> Unroutable mandatory or immediate messages are confirmed right after
>> thebasic.return. Transient messages are confirmed as soon as they arrive
>> on all the queues they were routed to. Persistent messages are confirmed
>> when all queues have either delivered the message and received an
>> acknowledgement (if required), or persisted the message.
> 
> Notice that a confirmation does not necessarily mean that a consumer has
> received and acknowledged the message; in general it means that RabbitMQ
> has successfully 'processed' the message, which might mean 'persisted' it, if
> it is persistent, or returned it, if it was unroutable (and marked
> mandatory), etc.
> 
> You may wish to investigate the 'immediate' and 'mandatory' flags. Be
> aware that you cannot use 'publisher confirms' on a transactional
> channel.
> 
> [1] http://www.rabbitmq.com/extensions.html#confirms
> 
> Steve Powell
> steve at rabbitmq.com
> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
> 
> On 19 Jul 2012, at 10:25, Mohsen Lotfizad wrote:
> 
>> Hi
>> 
>> I have a project that producers want to assure their message are delivered to consumers.
>> I make a Google search and find rabbitMQ transaction and confirm from (http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/) . I download discussed examples and run them. But I comment the consumer part. with my surprise producer gives ack, even if I uncomment  consumer part and send NACK instead of ack!
>> 
>> what should I do to route consumers ack to producer?
>> 
>> ps: does com.rabbitmq.client.Channel#addReturnListener helps me?
>> 
>> -- 
>> 
>> Sincerely 
>> ML
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emamdouh at cloud9ers.com  Thu Jul 19 14:01:45 2012
From: emamdouh at cloud9ers.com (Eslam Mamdouh El Husseiny)
Date: Thu, 19 Jul 2012 16:01:45 +0300
Subject: [rabbitmq-discuss] can't start rabbitmq-server
Message-ID: <CAHAaT5uQ+zhaCO1qFLxP-kZyYXMRav=Tp3wHYFvej2TiDwA4fw@mail.gmail.com>

hi,
i have a mysterious problem with rabbitmq "2.7.1-0ubuntu4"
sometimes it refuses to start and come out with this error message :

> melzalabany at Ubuntu-11:web_tier$  rabbitmq-server
> {error_logger,{{2012,7,19},{14,32,18}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
>
> {error_logger,{{2012,7,19},{14,32,18}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.90>,<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,518}],[]]}
>
> {error_logger,{{2012,7,19},{14,32,18}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch26569,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>
> {error_logger,{{2012,7,19},{14,32,18}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>
> {error_logger,{{2012,7,19},{14,32,18}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
> Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>
> Only root or rabbitmq should run rabbitmq-server
>

and i resolve this error with restarting system

So i'd like to know if there is a reason for this error and how to avoid
this problem without rebooting machine

Thanks in advance

-- 
Best Regards,
Eslam Mamdouh El Husseiny
*Systems Administrator**
Cloud Niners Ltd.

*
*Cellular: (+2) 011 198 40 40
Mansoura: (+2) 050 234 70 81
Cairo:    (+2) 022 *268 34 60
Fax:      (+2) 022 268 34 63
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120719/60dd3717/attachment.htm>

From tim at rabbitmq.com  Thu Jul 19 14:02:55 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 19 Jul 2012 14:02:55 +0100
Subject: [rabbitmq-discuss] can't start rabbitmq-server
In-Reply-To: <CAHAaT5uQ+zhaCO1qFLxP-kZyYXMRav=Tp3wHYFvej2TiDwA4fw@mail.gmail.com>
References: <CAHAaT5uQ+zhaCO1qFLxP-kZyYXMRav=Tp3wHYFvej2TiDwA4fw@mail.gmail.com>
Message-ID: <5008057F.9060003@rabbitmq.com>

On 07/19/2012 02:01 PM, Eslam Mamdouh El Husseiny wrote:
> hi,
> i have a mysterious problem with rabbitmq"2.7.1-0ubuntu4"
> sometimes it refuses to start and come out with this error message :
>
>     melzalabany at Ubuntu-11:web_tier$  rabbitmq-server
>     Only root or rabbitmq should run rabbitmq-server
>
>

That looks like the reason there: 'only root or rabbitmq should run 
rabbitmq-server'.....

> and i resolve this error with restarting system
>

Not sure how this helps, but perhaps I'm missing something?

> So i'd like to know if there is a reason for this error and how to 
> avoid this problem without rebooting machine
>

Does this happen if you try and start the server the correct user?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120719/389a6632/attachment.htm>

From vijjivinay at gmail.com  Thu Jul 19 14:27:27 2012
From: vijjivinay at gmail.com (Vijay Lakshmi)
Date: Thu, 19 Jul 2012 18:57:27 +0530
Subject: [rabbitmq-discuss] Need to close channel to get consume message
Message-ID: <CAHPrJT0FsV5g9tRf7R23hnms7GrwcWpvHPw_WPPhnnJt4U93LA@mail.gmail.com>

We have created,


- 1  connection and channel pool on that connection ( with 500 channels )
for subscribe

- 1 connection and channel pool on that connection ( with 500 channels )
for Consume


Our subscribe operation works fine.

However, consumer does not work. We are using QueuingConsumer like below.


Channel channel = getTheChannelFromPool();

QueueingConsumer consumer = new QueueingConsumer(channel);

channel.basicConsume(ourQueueName, false, consumer);

QueueingConsumer.Delivery delivery = consumer.nextDelivery(timeout);


//after that keep the channel back to pool



In this case, the delivery is coming as null.


Surprisingly when we close the channel, we are getting the message. ( i.e/
delivery  is not null )


Can someone please help in solving this problem.


Regards,

Vinay
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120719/2943dc4a/attachment.htm>

From steve at rabbitmq.com  Thu Jul 19 15:18:17 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 19 Jul 2012 15:18:17 +0100
Subject: [rabbitmq-discuss] Consumer's confirm
In-Reply-To: <C3838973-C151-41C9-9423-7D5798048155@rabbitmq.com>
References: <CAJzgYrB_E97bCkvyOFy9BgKFy=s=R0UU-9FXhQk0d3jvJdXmRg@mail.gmail.com>
	<037FFC17-EA00-4079-B26E-B41E7D19A152@rabbitmq.com>
	<C3838973-C151-41C9-9423-7D5798048155@rabbitmq.com>
Message-ID: <FCAA985E-79B2-471B-A31D-35FAB7BBF7FF@rabbitmq.com>

(Copy for the discussion list.)

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

------reply from ML 	Date: 	19 July 2012 14:48:02 GMT+01:00
Dear Steve,
Thanks for your help :)
I read that tutorial before and developed a project-specific usage of rabbitMQ.
your answer was very helpful to me.
-- 
Sincerely 
ML

On 19 Jul 2012, at 12:11, Steve Powell wrote:

> ML,
> 
> I realise that I haven't really answered your question:
> 
>>> what should I do to route consumers ack to producer?
> 
> 
> The RabbitMQ broker isolates the publishers from knowledge of the
> consumers and vice versa; this includes knowing if there are there and
> have acknowledged the message. This makes it tricky to get RabbitMQ to
> do what you want directly.
> 
> One way to achieve it is to use reply-to queues: temporary queues which
> the publisher sets up (for a particular message, or for many messages)
> which the consumer can then publish a response to. If the reply-to queue
> is provided to the consumer with the published message, the consumer can
> programmatically respond to the publisher without having to know who the
> publisher is (or if it is available, etc.).
> 
> This mechanism is exploited in the RPC tutorial [1], which you should
> read. With RPC, the client (caller) blocks until the reply is received;
> but you might not want to do that. I'm sure this will help you to
> implement a solution for your case.
> 
> Good luck,
> 
> Steve Powell
> steve at rabbitmq.com
> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
> 
> [1] http://www.rabbitmq.com/tutorials/tutorial-six-java.html
> 
>> ML,
>> 
>> The definitive guide to Publish-confirms is in the extensions
>> documentation [1], where it says:
>> 
>>> By confirming a message the broker assumes responsibility for it and
>>> indicates that it has done something it deems reasonable with it.
>>> Unroutable mandatory or immediate messages are confirmed right after
>>> thebasic.return. Transient messages are confirmed as soon as they arrive
>>> on all the queues they were routed to. Persistent messages are confirmed
>>> when all queues have either delivered the message and received an
>>> acknowledgement (if required), or persisted the message.
>> 
>> Notice that a confirmation does not necessarily mean that a consumer has
>> received and acknowledged the message; in general it means that RabbitMQ
>> has successfully 'processed' the message, which might mean 'persisted' it, if
>> it is persistent, or returned it, if it was unroutable (and marked
>> mandatory), etc.
>> 
>> You may wish to investigate the 'immediate' and 'mandatory' flags. Be
>> aware that you cannot use 'publisher confirms' on a transactional
>> channel.
>> 
>> [1] http://www.rabbitmq.com/extensions.html#confirms
>> 
>> Steve Powell
>> steve at rabbitmq.com
>> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
>> 
>> On 19 Jul 2012, at 10:25, Mohsen Lotfizad wrote:
>> 
>>> Hi
>>> 
>>> I have a project that producers want to assure their message are delivered to consumers.
>>> I make a Google search and find rabbitMQ transaction and confirm from (http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/) . I download discussed examples and run them. But I comment the consumer part. with my surprise producer gives ack, even if I uncomment  consumer part and send NACK instead of ack!
>>> 
>>> what should I do to route consumers ack to producer?
>>> 
>>> ps: does com.rabbitmq.client.Channel#addReturnListener helps me?
>>> 
>>> -- 
>>> 
>>> Sincerely 
>>> ML
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120719/e91dea8a/attachment.htm>

From Michael.Laing at nytimes.com  Thu Jul 19 16:04:18 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Thu, 19 Jul 2012 11:04:18 -0400
Subject: [rabbitmq-discuss] Restarting/re-establising failed federation
 connections
In-Reply-To: <5007E44D.5090608@rabbitmq.com>
Message-ID: <CC2D9509.34D3%Michael.Laing@nytimes.com>

I am getting similar failures to reconnect.

My Virginia cluster is upstream from my California cluster. And there is a
link the other way, making the federation bi-directional.

After some days of idleness (still in testing mode) both links went down.

Restarting the California rabbit reestablished the link to Virginia and I
could send federated messages from Virginia to California.

The California to Virginia link was still down, however. I ran an AMQP
client on the Virginia machine and could connect to California.

This actually happened previously. In response I upgraded all my rabbits
to 2.8.4 and Erlang R14B04.

Now that it has happened again I will restart everything and capture clean
logs etc.

In fact, the situation appears to be consistent as Virginia is the center
of a star federation network that includes California, Brazil, Dublin, and
Tokyo, all configured identically.

All links have failed in exactly the same manner.

Michael

On 7/19/12 6:41 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>David,
>
>On 18/07/12 01:56, David Gillies wrote:
>> I've posted up the logs from the downstream server from around the time
>> that one of the upstream servers lose connectivity and the downstream
>> server is never able to connect again here:
>> https://gist.github.com/85da45443b92e69e29a0
>
>Please use the correct terminology, it gets really confusing otherwise.
>In federation, messages flow from the upstream to the downstream (makes
>sense, doesn't it?), and connections are established from the downstream
>to the upstream.
>
>Anyway, There is nothing unusual in the logs...the downstreams (using
>the correct terminology) lose connectivity and try to re-establish it.
>They *should* keep trying indefinitely. Is there any evidence that they
>don't?
>
>There is nothing special about the way federation establishes
>connections, so if at some point you think that a downstream should be
>able to connect to the upstream but doesn't, then run an ordinary amqp
>client on the downstream machine and see whether it can connect to the
>upstream.
>
>Regards,
>
>Matthias.
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Thu Jul 19 16:35:48 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 19 Jul 2012 16:35:48 +0100
Subject: [rabbitmq-discuss] Restarting/re-establising failed federation
 connections
In-Reply-To: <CC2D9509.34D3%Michael.Laing@nytimes.com>
References: <CC2D9509.34D3%Michael.Laing@nytimes.com>
Message-ID: <50082954.8080600@rabbitmq.com>

Michael,

On 19/07/12 16:04, Laing, Michael P. wrote:
> My Virginia cluster is upstream from my California cluster. And there is a
> link the other way, making the federation bi-directional.
>
> After some days of idleness (still in testing mode) both links went down.

Do the rabbit logs on the downstreams indicate that the connection went 
down? It is possible for network connections to vanish w/o rabbit 
noticing; if that's the case then you may want to enable heartbeats in 
your federation configs.

Matthias.

From cal5101 at yahoo.com  Thu Jul 19 17:08:18 2012
From: cal5101 at yahoo.com (Al Al)
Date: Thu, 19 Jul 2012 09:08:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Declaring an exchange without a plugin or client
Message-ID: <1342714098.36812.YahooMailClassic@web161504.mail.bf1.yahoo.com>

I have a use-case where I need to declare Exchanges on RabbitMQ after it is first installed, configured, and started. The properties of the Exchanges (name, type, durable, etc) are located in a file (or files).

This has to be automated and installing the Management Plugin or any other plugin is not an option (not yet).

Is it possible to do this without a client (Java, Erlang, etc)?

I am running CentOS.


Thanks,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120719/fe828b88/attachment.htm>

From matthias at rabbitmq.com  Thu Jul 19 17:11:32 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 19 Jul 2012 17:11:32 +0100
Subject: [rabbitmq-discuss] Restarting/re-establising failed federation
 connections
In-Reply-To: <CC2DA815.3509%Michael.Laing@nytimes.com>
References: <CC2DA815.3509%Michael.Laing@nytimes.com>
Message-ID: <500831B4.6040309@rabbitmq.com>

(putting list back on cc)

On 19/07/12 17:05, Laing, Michael P. wrote:
> Yes it looks connections vanish?
>
> And I forgot to enable heartbeats!
>
> So now they are all back up w heartbeats configured and we'll see how it
> goes.

Let us know the results.

Matthias.

From matthias at rabbitmq.com  Thu Jul 19 17:19:02 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 19 Jul 2012 17:19:02 +0100
Subject: [rabbitmq-discuss] Declaring an exchange without a plugin or
 client
In-Reply-To: <1342714098.36812.YahooMailClassic@web161504.mail.bf1.yahoo.com>
References: <1342714098.36812.YahooMailClassic@web161504.mail.bf1.yahoo.com>
Message-ID: <50083376.3070403@rabbitmq.com>

On 19/07/12 17:08, Al Al wrote:
> I have a use-case where I need to declare Exchanges on RabbitMQ after it
> is first installed, configured, and started. The properties of the
> Exchanges (name, type, durable, etc) are located in a file (or files).
>
> This has to be automated and installing the Management Plugin or any
> other plugin is not an option (not yet).
>
> Is it possible to do this without a client (Java, Erlang, etc)?

The way to do this *is* to enable the management plug-in (no need to 
"install" it since all recent versions of rabbit come with the plug-ins 
included) and use http://www.rabbitmq.com/management.html#load-definitions.

Matthias.

From meetprashanth437 at gmail.com  Thu Jul 19 18:43:51 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Thu, 19 Jul 2012 13:43:51 -0400
Subject: [rabbitmq-discuss] Publisher Confirms in mirrored queues
In-Reply-To: <6092C8DC-E378-4CE1-8E53-F88315333F18@rabbitmq.com>
References: <CAE8G+yQ2BPz=+EUbo=LkAjm26TYLORAsXs=NENcmvyc=B17B_w@mail.gmail.com>
	<6092C8DC-E378-4CE1-8E53-F88315333F18@rabbitmq.com>
Message-ID: <CAE8G+yRp=My2as6dCvdPA94VGi_9bMub-rM-PNErY5Ku0EC-QA@mail.gmail.com>

Thank You Tim.

On Wed, Jul 18, 2012 at 4:52 PM, Tim Watson <watson.timothy at gmail.com>wrote:

>
> On 18 Jul 2012, at 20:15, Prashanth <meetprashanth437 at gmail.com> wrote:
>
> Hi all,
>
>
> Hi
>
> I was confused after reading the publisher confirm documentation.
>
> Similarly, messages published by clients using publisher confirms<http://www.rabbitmq.com/extensions.html#confirms> will
> still be confirmed correctly even if the master (or any slaves) fail
> between the message being published and the message being able to be
> confirmed to the publisher. Thus from the point of view of the publisher,
> publishing to a mirrored-queue is no different from publishing to any other
> sort of queue. It is only consumers that need to be aware of the
> possibility of needing to re-consume from a mirrored-queue upon receipt of
> a Consumer Cancellation Notification<http://www.rabbitmq.com/extensions.html#consumer-cancel-notify>
> .
>
>
> So from the publisher's point of view, it looks like just one queue and
> the confirm means every surviving mirror has received and accepted the
> message.
>
> Equally, in the case of publisher confirms, a message will only be
> confirmed to the publisher when it has been accepted by all of the mirrors.
> It is correct to think of the semantics as being the same as a message
> being routed to multiple normal queues, and of a transaction with
> publications within that similarly are routed to multiple queues.
>
> After reading the above lines. Now I am confused about the publisher
> confirms. The first paragraph says that publishing to mirrored queues is
> like publishing to each individual queue.
>
>
> Where does it say that? It says that publishing to mirrored queues is
> atomic with respect to confirms.
>
> Messages are published to all the queues and each queue sends publisher
> confirms.
>
>
> That's not what it says. It says that all queues will have the message
> before a confirm is sent to the publisher from the queue to which it
> originally published.
>
> The publisher knows next to nothing about the mirrors.
>
> In the second paragraph it says a message will only be confirmed to the
> publisher when it has been accepted by all of the mirrors.
> Those two paragraph looks like they say two opposite things.
>
> Please, correct me if I am wrong.
>
>
> Thanks,
> Prashanth.
>
>
>  _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120719/63065785/attachment.htm>

From meetprashanth437 at gmail.com  Thu Jul 19 19:01:31 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Thu, 19 Jul 2012 14:01:31 -0400
Subject: [rabbitmq-discuss] Publisher Confirms in mirrored queues
In-Reply-To: <CAE8G+yRp=My2as6dCvdPA94VGi_9bMub-rM-PNErY5Ku0EC-QA@mail.gmail.com>
References: <CAE8G+yQ2BPz=+EUbo=LkAjm26TYLORAsXs=NENcmvyc=B17B_w@mail.gmail.com>
	<6092C8DC-E378-4CE1-8E53-F88315333F18@rabbitmq.com>
	<CAE8G+yRp=My2as6dCvdPA94VGi_9bMub-rM-PNErY5Ku0EC-QA@mail.gmail.com>
Message-ID: <CAE8G+yS9SqKSuDqEFGyneqmqnb30HgCZ7efn0G3wsg7A-Xy=9g@mail.gmail.com>

Hi,

I might be missing some configuration.
I have two consumers(Two nodes from two different clusters) for a queue,
waiting on the queue.
When I push data to the queue, each consumer receive alternative messages.
My requirement is all consumers should receive all messages.

Thanks,
Prashanth.

On Thu, Jul 19, 2012 at 1:43 PM, Prashanth <meetprashanth437 at gmail.com>wrote:

> Thank You Tim.
>
>
> On Wed, Jul 18, 2012 at 4:52 PM, Tim Watson <watson.timothy at gmail.com>wrote:
>
>>
>> On 18 Jul 2012, at 20:15, Prashanth <meetprashanth437 at gmail.com> wrote:
>>
>> Hi all,
>>
>>
>> Hi
>>
>> I was confused after reading the publisher confirm documentation.
>>
>> Similarly, messages published by clients using publisher confirms<http://www.rabbitmq.com/extensions.html#confirms> will
>> still be confirmed correctly even if the master (or any slaves) fail
>> between the message being published and the message being able to be
>> confirmed to the publisher. Thus from the point of view of the publisher,
>> publishing to a mirrored-queue is no different from publishing to any other
>> sort of queue. It is only consumers that need to be aware of the
>> possibility of needing to re-consume from a mirrored-queue upon receipt of
>> a Consumer Cancellation Notification<http://www.rabbitmq.com/extensions.html#consumer-cancel-notify>
>> .
>>
>>
>> So from the publisher's point of view, it looks like just one queue and
>> the confirm means every surviving mirror has received and accepted the
>> message.
>>
>> Equally, in the case of publisher confirms, a message will only be
>> confirmed to the publisher when it has been accepted by all of the mirrors.
>> It is correct to think of the semantics as being the same as a message
>> being routed to multiple normal queues, and of a transaction with
>> publications within that similarly are routed to multiple queues.
>>
>> After reading the above lines. Now I am confused about the publisher
>> confirms. The first paragraph says that publishing to mirrored queues is
>> like publishing to each individual queue.
>>
>>
>> Where does it say that? It says that publishing to mirrored queues is
>> atomic with respect to confirms.
>>
>> Messages are published to all the queues and each queue sends publisher
>> confirms.
>>
>>
>> That's not what it says. It says that all queues will have the message
>> before a confirm is sent to the publisher from the queue to which it
>> originally published.
>>
>> The publisher knows next to nothing about the mirrors.
>>
>> In the second paragraph it says a message will only be confirmed to the
>> publisher when it has been accepted by all of the mirrors.
>> Those two paragraph looks like they say two opposite things.
>>
>> Please, correct me if I am wrong.
>>
>>
>> Thanks,
>> Prashanth.
>>
>>
>>  _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120719/f9a25b08/attachment.htm>

From matthias at rabbitmq.com  Thu Jul 19 19:06:57 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 19 Jul 2012 19:06:57 +0100
Subject: [rabbitmq-discuss] AMQP routing 101 [was Re: Publisher Confirms in
 mirrored queues]
In-Reply-To: <CAE8G+yS9SqKSuDqEFGyneqmqnb30HgCZ7efn0G3wsg7A-Xy=9g@mail.gmail.com>
References: <CAE8G+yQ2BPz=+EUbo=LkAjm26TYLORAsXs=NENcmvyc=B17B_w@mail.gmail.com>
	<6092C8DC-E378-4CE1-8E53-F88315333F18@rabbitmq.com>
	<CAE8G+yRp=My2as6dCvdPA94VGi_9bMub-rM-PNErY5Ku0EC-QA@mail.gmail.com>
	<CAE8G+yS9SqKSuDqEFGyneqmqnb30HgCZ7efn0G3wsg7A-Xy=9g@mail.gmail.com>
Message-ID: <50084CC1.4010109@rabbitmq.com>

On 19/07/12 19:01, Prashanth wrote:
> I have two consumers(Two nodes from two different clusters) for a queue,
> waiting on the queue.
> When I push data to the queue, each consumer receive alternative messages.
> My requirement is all consumers should receive all messages.

http://www.rabbitmq.com/tutorials/tutorial-three-python.html

Matthias.

From meetprashanth437 at gmail.com  Thu Jul 19 19:08:40 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Thu, 19 Jul 2012 14:08:40 -0400
Subject: [rabbitmq-discuss] AMQP routing 101 [was Re: Publisher Confirms
 in mirrored queues]
In-Reply-To: <50084CC1.4010109@rabbitmq.com>
References: <CAE8G+yQ2BPz=+EUbo=LkAjm26TYLORAsXs=NENcmvyc=B17B_w@mail.gmail.com>
	<6092C8DC-E378-4CE1-8E53-F88315333F18@rabbitmq.com>
	<CAE8G+yRp=My2as6dCvdPA94VGi_9bMub-rM-PNErY5Ku0EC-QA@mail.gmail.com>
	<CAE8G+yS9SqKSuDqEFGyneqmqnb30HgCZ7efn0G3wsg7A-Xy=9g@mail.gmail.com>
	<50084CC1.4010109@rabbitmq.com>
Message-ID: <CAE8G+yQ+X3x-EB6a7hkxW7VZKOkox7VQvM5zeawnj5WjgxPYRA@mail.gmail.com>

Oh, really sorry. forgot about this document.

Thanks,
Prashanth.

On Thu, Jul 19, 2012 at 2:06 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 19/07/12 19:01, Prashanth wrote:
>
>> I have two consumers(Two nodes from two different clusters) for a queue,
>> waiting on the queue.
>> When I push data to the queue, each consumer receive alternative messages.
>> My requirement is all consumers should receive all messages.
>>
>
> http://www.rabbitmq.com/**tutorials/tutorial-three-**python.html<http://www.rabbitmq.com/tutorials/tutorial-three-python.html>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120719/14db610b/attachment.htm>

From Michael.Laing at nytimes.com  Thu Jul 19 19:21:08 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Thu, 19 Jul 2012 14:21:08 -0400
Subject: [rabbitmq-discuss] Federation: Superfluous bindings in Exchanges
Message-ID: <CC2DC854.3545%Michael.Laing@nytimes.com>

I see that federation creates many bindings to facilitate sending only relevant messages.

However, I note that at least some bindings do not get removed when no longer applicable.

In my current environment, described previously, participating apps create exclusive queues on the global exchange in their vhost; they typically bind with a uuid in addition to other bindings.

This works fine, except I notice that, although some bindings go away when the exclusive queue is deleted, lots more remain with that uuid.

This cruft is building up.

Hopefully this will be addressed in an upcoming release ? it's not critical, at least for me, at the moment.

Michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120719/4b714a36/attachment.htm>

From matthias at rabbitmq.com  Thu Jul 19 19:25:32 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 19 Jul 2012 19:25:32 +0100
Subject: [rabbitmq-discuss] AMQP routing 101 [was Re: Publisher Confirms
 in mirrored queues]
In-Reply-To: <CAE8G+yQTAe78QrBQO_wwAeQLcnoD5ZDsPKzwP0oWvDW5m1wjQA@mail.gmail.com>
References: <CAE8G+yQ2BPz=+EUbo=LkAjm26TYLORAsXs=NENcmvyc=B17B_w@mail.gmail.com>
	<6092C8DC-E378-4CE1-8E53-F88315333F18@rabbitmq.com>
	<CAE8G+yRp=My2as6dCvdPA94VGi_9bMub-rM-PNErY5Ku0EC-QA@mail.gmail.com>
	<CAE8G+yS9SqKSuDqEFGyneqmqnb30HgCZ7efn0G3wsg7A-Xy=9g@mail.gmail.com>
	<50084CC1.4010109@rabbitmq.com>
	<CAE8G+yQTAe78QrBQO_wwAeQLcnoD5ZDsPKzwP0oWvDW5m1wjQA@mail.gmail.com>
Message-ID: <5008511C.4040504@rabbitmq.com>

Prashanth,

please keep the list on cc.

On 19/07/12 19:19, Prashanth wrote:
> Just to be sure.
> I cannot have more than two consumers reading from a single queue.

Yes you can, but each message in a queue will only go to one consumer. 
As explained in the 2nd tutorial, 
http://www.rabbitmq.com/tutorials/tutorial-two-python.html.

> I should so something similar to the example in link.

Yes, if you want to the same message to go to multiple consumers then 
you need to set up multiple queues.


Regards,

Matthias.

From matthias at rabbitmq.com  Thu Jul 19 19:36:00 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 19 Jul 2012 19:36:00 +0100
Subject: [rabbitmq-discuss] Federation: Superfluous bindings in Exchanges
In-Reply-To: <CC2DC854.3545%Michael.Laing@nytimes.com>
References: <CC2DC854.3545%Michael.Laing@nytimes.com>
Message-ID: <50085390.4050400@rabbitmq.com>

Michael,

On 19/07/12 19:21, Laing, Michael P. wrote:
> I see that federation creates many bindings to facilitate sending only
> relevant messages.
>
> However, I note that at least some bindings do not get removed when no
> longer applicable.
>
> In my current environment, described previously, participating apps
> create exclusive queues on the global exchange in their vhost; they
> typically bind with a uuid in addition to other bindings.
>
> This works fine, except I notice that, although some bindings go away
> when the exclusive queue is deleted, lots more remain with that uuid.
>
> This cruft is building up.

Needless to say that shouldn't happen. This is the first report of such 
a problem we have received. Please get us a copy of 'rabbitmqctl report' 
run against both the downstream and the upstream when the above has 
happened.

Regards,

Matthias.

From Michael.Laing at nytimes.com  Thu Jul 19 20:01:06 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Thu, 19 Jul 2012 15:01:06 -0400
Subject: [rabbitmq-discuss] Federation: Superfluous bindings in Exchanges
In-Reply-To: <50085390.4050400@rabbitmq.com>
Message-ID: <CC2DD18A.3563%Michael.Laing@nytimes.com>

Thanks Mathias, I have sent reports to you separately. -ml

On 7/19/12 2:36 PM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Michael,
>
>On 19/07/12 19:21, Laing, Michael P. wrote:
>> I see that federation creates many bindings to facilitate sending only
>> relevant messages.
>>
>> However, I note that at least some bindings do not get removed when no
>> longer applicable.
>>
>> In my current environment, described previously, participating apps
>> create exclusive queues on the global exchange in their vhost; they
>> typically bind with a uuid in addition to other bindings.
>>
>> This works fine, except I notice that, although some bindings go away
>> when the exclusive queue is deleted, lots more remain with that uuid.
>>
>> This cruft is building up.
>
>Needless to say that shouldn't happen. This is the first report of such
>a problem we have received. Please get us a copy of 'rabbitmqctl report'
>run against both the downstream and the upstream when the above has
>happened.
>
>Regards,
>
>Matthias.


From meetprashanth437 at gmail.com  Thu Jul 19 20:03:49 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Thu, 19 Jul 2012 15:03:49 -0400
Subject: [rabbitmq-discuss] AMQP routing 101 [was Re: Publisher Confirms
 in mirrored queues]
In-Reply-To: <5008511C.4040504@rabbitmq.com>
References: <CAE8G+yQ2BPz=+EUbo=LkAjm26TYLORAsXs=NENcmvyc=B17B_w@mail.gmail.com>
	<6092C8DC-E378-4CE1-8E53-F88315333F18@rabbitmq.com>
	<CAE8G+yRp=My2as6dCvdPA94VGi_9bMub-rM-PNErY5Ku0EC-QA@mail.gmail.com>
	<CAE8G+yS9SqKSuDqEFGyneqmqnb30HgCZ7efn0G3wsg7A-Xy=9g@mail.gmail.com>
	<50084CC1.4010109@rabbitmq.com>
	<CAE8G+yQTAe78QrBQO_wwAeQLcnoD5ZDsPKzwP0oWvDW5m1wjQA@mail.gmail.com>
	<5008511C.4040504@rabbitmq.com>
Message-ID: <CAE8G+yRRz=JiAEWwyMa2mFzLJm1Q41hbY-riEaowumDj4HUn6Q@mail.gmail.com>

Hello,

When subscribing to queue I have set the no_ack => 0 and I am sending an
ack on receiving the message. Is this what I need to do for publisher
confirm?

Also if i don't send an ack, I receive the next messages in the queue. I
thought messages will not be sent until previous ack is received.

Also no ack messages is not re-transmitted, it is just sitting on the queue.

Thanks.

On Thu, Jul 19, 2012 at 2:25 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Prashanth,
>
> please keep the list on cc.
>
>
> On 19/07/12 19:19, Prashanth wrote:
>
>> Just to be sure.
>> I cannot have more than two consumers reading from a single queue.
>>
>
> Yes you can, but each message in a queue will only go to one consumer. As
> explained in the 2nd tutorial, http://www.rabbitmq.com/**
> tutorials/tutorial-two-python.**html<http://www.rabbitmq.com/tutorials/tutorial-two-python.html>
> .
>
>
>  I should so something similar to the example in link.
>>
>
> Yes, if you want to the same message to go to multiple consumers then you
> need to set up multiple queues.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120719/8e60e25e/attachment.htm>

From matthias at rabbitmq.com  Thu Jul 19 20:42:18 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 19 Jul 2012 20:42:18 +0100
Subject: [rabbitmq-discuss] AMQP routing 101 [was Re: Publisher Confirms
 in mirrored queues]
In-Reply-To: <CAE8G+yRRz=JiAEWwyMa2mFzLJm1Q41hbY-riEaowumDj4HUn6Q@mail.gmail.com>
References: <CAE8G+yQ2BPz=+EUbo=LkAjm26TYLORAsXs=NENcmvyc=B17B_w@mail.gmail.com>
	<6092C8DC-E378-4CE1-8E53-F88315333F18@rabbitmq.com>
	<CAE8G+yRp=My2as6dCvdPA94VGi_9bMub-rM-PNErY5Ku0EC-QA@mail.gmail.com>
	<CAE8G+yS9SqKSuDqEFGyneqmqnb30HgCZ7efn0G3wsg7A-Xy=9g@mail.gmail.com>
	<50084CC1.4010109@rabbitmq.com>
	<CAE8G+yQTAe78QrBQO_wwAeQLcnoD5ZDsPKzwP0oWvDW5m1wjQA@mail.gmail.com>
	<5008511C.4040504@rabbitmq.com>
	<CAE8G+yRRz=JiAEWwyMa2mFzLJm1Q41hbY-riEaowumDj4HUn6Q@mail.gmail.com>
Message-ID: <5008631A.4070405@rabbitmq.com>

Prashanth,

in future please start a fresh thread when asking a new question.

On 19/07/12 20:03, Prashanth wrote:
> When subscribing to queue I have set the no_ack => 0 and I am
> sending an ack on receiving the message. Is this what I need to do
> for publisher confirm?

Consumers acks have nothing to do with publisher confirms.

I suggest you
read http://www.rabbitmq.com/tutorials/tutorial-two-python.html, in
particular the section on 'Message acknowledgement', to understand the
former.

> Also if i don't send an ack, I receive the next messages in the
> queue. I thought messages will not be sent until previous ack is
> received.

See the 'Fair dispatch' section in the aforementioned tutorials.

> Also no ack messages is not re-transmitted, it is just sitting on
> the queue.

That too is explained in the 'Message acknowledgement' section.


Regards,

Matthias.

From meetprashanth437 at gmail.com  Thu Jul 19 22:11:15 2012
From: meetprashanth437 at gmail.com (Prashanth)
Date: Thu, 19 Jul 2012 17:11:15 -0400
Subject: [rabbitmq-discuss] Consumer acknowledgement
Message-ID: <CAE8G+yQWNjLaNRRTL-2Tqj_F7air0VsWheU571SimpJrCmoxqg@mail.gmail.com>

Hi,

My test case.

I have a consumer, with no_ack =>0, prefetch_count is default, consumer
receives messages, even if previous messages are not acknowledge.
If the message is never acknowledge or ack message is lost in transit and
if consumer never goes down, This message is never acknowledged or is
resent again, its in the queue forever. I don't want to timeout the message.
Instead I want the message to resend after a specified timeout may be to
the same consumer.

Is there a way to do this.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120719/08dc4bff/attachment.htm>

From dgillies at brandscreen.com  Fri Jul 20 01:58:26 2012
From: dgillies at brandscreen.com (David Gillies)
Date: Fri, 20 Jul 2012 10:58:26 +1000
Subject: [rabbitmq-discuss] Restarting/re-establising failed federation
	connections
In-Reply-To: <5007E44D.5090608@rabbitmq.com>
References: <e5c07cc1-c5c2-4614-aef8-cee6dbcb64a7@googlegroups.com>
	<9F05622A-2DB9-4165-AC1D-E550E479B718@rabbitmq.com>
	<CAO70NwvM3Zq1=jX=iMaFupSb1Hct2gVsWojiw+L_Di5_f=XgyQ@mail.gmail.com>
	<5007E44D.5090608@rabbitmq.com>
Message-ID: <CAO70Nwt22doG6WDST+n_csgM0M7E0=knZfFK5q77dnmT1k0xgA@mail.gmail.com>

On 19 July 2012 20:41, Matthias Radestock <matthias at rabbitmq.com> wrote:

> David,
>
>
> On 18/07/12 01:56, David Gillies wrote:
>
>> I've posted up the logs from the downstream server from around the time
>> that one of the upstream servers lose connectivity and the downstream
>> server is never able to connect again here:
>> https://gist.github.com/**85da45443b92e69e29a0<https://gist.github.com/85da45443b92e69e29a0>
>>
>
> Please use the correct terminology, it gets really confusing otherwise. In
> federation, messages flow from the upstream to the downstream (makes sense,
> doesn't it?), and connections are established from the downstream to the
> upstream.
>
> Anyway, There is nothing unusual in the logs...the downstreams (using the
> correct terminology) lose connectivity and try to re-establish it. They
> *should* keep trying indefinitely. Is there any evidence that they don't?
>

After leaving the downstream servers to (supposedly) reconnect for hours (I
think the longest I've left them is approximately 36 hours without
intervention) I see no messages leaving the upstream queue and eventually
the filesystem fills up from queue banking up (I've set a TTL on the queue
for now but I'd rather not have to do that).


>
> There is nothing special about the way federation establishes connections,
> so if at some point you think that a downstream should be able to connect
> to the upstream but doesn't, then run an ordinary amqp client on the
> downstream machine and see whether it can connect to the upstream.
>

I've been doing exactly that and I've had no issues with connecting to the
upstream using an amqp client.


-- 
David Gillies
Senior Systems Engineer, Brandscreen
dgillies at brandscreen.com

Australia: Level 2, 30 Alfred Street, Milsons Point NSW 2061 Australia
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120720/ed2a9c49/attachment.htm>

From matthias at rabbitmq.com  Fri Jul 20 03:38:10 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 20 Jul 2012 03:38:10 +0100
Subject: [rabbitmq-discuss] Restarting/re-establising failed federation
 connections
In-Reply-To: <CAO70Nwt22doG6WDST+n_csgM0M7E0=knZfFK5q77dnmT1k0xgA@mail.gmail.com>
References: <e5c07cc1-c5c2-4614-aef8-cee6dbcb64a7@googlegroups.com>
	<9F05622A-2DB9-4165-AC1D-E550E479B718@rabbitmq.com>
	<CAO70NwvM3Zq1=jX=iMaFupSb1Hct2gVsWojiw+L_Di5_f=XgyQ@mail.gmail.com>
	<5007E44D.5090608@rabbitmq.com>
	<CAO70Nwt22doG6WDST+n_csgM0M7E0=knZfFK5q77dnmT1k0xgA@mail.gmail.com>
Message-ID: <5008C492.6000203@rabbitmq.com>

David,

On 20/07/12 01:58, David Gillies wrote:
> After leaving the downstream servers to (supposedly) reconnect for hours
> (I think the longest I've left them is approximately 36 hours without
> intervention) I see no messages leaving the upstream queue and
> eventually the filesystem fills up from queue banking up (I've set a TTL
> on the queue for now but I'd rather not have to do that).

As I mentioned to Michael, I suggest you enable heartbeats in your 
federation config.

Matthias.

From dgillies at brandscreen.com  Fri Jul 20 04:01:18 2012
From: dgillies at brandscreen.com (David Gillies)
Date: Fri, 20 Jul 2012 13:01:18 +1000
Subject: [rabbitmq-discuss] Restarting/re-establising failed federation
	connections
In-Reply-To: <5008C492.6000203@rabbitmq.com>
References: <e5c07cc1-c5c2-4614-aef8-cee6dbcb64a7@googlegroups.com>
	<9F05622A-2DB9-4165-AC1D-E550E479B718@rabbitmq.com>
	<CAO70NwvM3Zq1=jX=iMaFupSb1Hct2gVsWojiw+L_Di5_f=XgyQ@mail.gmail.com>
	<5007E44D.5090608@rabbitmq.com>
	<CAO70Nwt22doG6WDST+n_csgM0M7E0=knZfFK5q77dnmT1k0xgA@mail.gmail.com>
	<5008C492.6000203@rabbitmq.com>
Message-ID: <CAO70Nwsiv3SBebnpOCbGZdGFvFG-9Sp0dqx9h38Lt_3wmYt3TA@mail.gmail.com>

Matthias,

On 20 July 2012 12:38, Matthias Radestock <matthias at rabbitmq.com> wrote:

> David,
>
>
> On 20/07/12 01:58, David Gillies wrote:
>
>> After leaving the downstream servers to (supposedly) reconnect for hours
>> (I think the longest I've left them is approximately 36 hours without
>> intervention) I see no messages leaving the upstream queue and
>> eventually the filesystem fills up from queue banking up (I've set a TTL
>> on the queue for now but I'd rather not have to do that).
>>
>
> As I mentioned to Michael, I suggest you enable heartbeats in your
> federation config.
>

I've had heartbeat enabled in my config from the start:

https://gist.github.com/3c2c45029a15be980b90

-- 
David Gillies
Senior Systems Engineer, Brandscreen
dgillies at brandscreen.com

Australia: Level 2, 30 Alfred Street, Milsons Point NSW 2061 Australia
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120720/6fd9628a/attachment.htm>

From avinash0601 at gmail.com  Fri Jul 20 04:19:13 2012
From: avinash0601 at gmail.com (avinash0601)
Date: Thu, 19 Jul 2012 20:19:13 -0700 (PDT)
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <5007E286.2090607@rabbitmq.com>
References: <1342670880360-20899.post@n5.nabble.com>
	<0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>
	<1342689509712-20904.post@n5.nabble.com>
	<5007DDC7.6080902@rabbitmq.com> <5007DF25.9010802@rabbitmq.com>
	<5007E1B2.3040206@rabbitmq.com> <5007E286.2090607@rabbitmq.com>
Message-ID: <1342754353459-20937.post@n5.nabble.com>

I am using ubuntu 12.04 LTS, epmd 5.8.5 & rabbitmq 2.8.4.
Regarding ports & firewall, i have opened all ports between the 3 instances
& port 4369 to all. so now i removed the entry 'inet_dist_listen_max/max'
from config file.

my /etc/hosts is below;
*127.0.0.1       rabbit1
54.251.XX.XX    rabbit2
54.251.XX.XX    rabbit3*

First of all i am not able to ping or telnet from one node to another.

Do i need to change 'sname' to 'name' in
/usr/lib/rabbitmq/bin/rabbitmq-server & rabbitmqctl?
Do i need to change node name initialization in rabbitmq-env from
*NODENAME=rabbit@${HOSTNAME%%.*}* to *NODENAME=rabbit@${HOSTNAME}*

--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/unable-to-cluster-rabbitmq-on-ec2-tp20899p20937.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Fri Jul 20 08:19:46 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 20 Jul 2012 08:19:46 +0100
Subject: [rabbitmq-discuss] Restarting/re-establising failed federation
 connections
In-Reply-To: <CAO70Nwsiv3SBebnpOCbGZdGFvFG-9Sp0dqx9h38Lt_3wmYt3TA@mail.gmail.com>
References: <e5c07cc1-c5c2-4614-aef8-cee6dbcb64a7@googlegroups.com>
	<9F05622A-2DB9-4165-AC1D-E550E479B718@rabbitmq.com>
	<CAO70NwvM3Zq1=jX=iMaFupSb1Hct2gVsWojiw+L_Di5_f=XgyQ@mail.gmail.com>
	<5007E44D.5090608@rabbitmq.com>
	<CAO70Nwt22doG6WDST+n_csgM0M7E0=knZfFK5q77dnmT1k0xgA@mail.gmail.com>
	<5008C492.6000203@rabbitmq.com>
	<CAO70Nwsiv3SBebnpOCbGZdGFvFG-9Sp0dqx9h38Lt_3wmYt3TA@mail.gmail.com>
Message-ID: <50090692.4040402@rabbitmq.com>

David,

On 20/07/12 04:01, David Gillies wrote:
> I've had heartbeat enabled in my config from the start:

ah ok.

What status is shown for the federation in the management ui when the 
problem occurs? You'll need to have the rabbitmq_federation_management 
plug-in enabled.

Also, the output of 'rabbitmqctl report' from both the downstream and 
upstream at the time of the problem might help diagnose the issue.


Regards,

Matthias.

From 7xerocha at gmail.com  Fri Jul 20 09:33:23 2012
From: 7xerocha at gmail.com (=?UTF-8?B?6buE5aSn6bmP?=)
Date: Fri, 20 Jul 2012 16:33:23 +0800
Subject: [rabbitmq-discuss] publishing confirms with persistent messages?
Message-ID: <CAB6nogK3d9jZDfWd3v_GqcBy3MiGVN360dpmnTMUvShPgjACrw@mail.gmail.com>

Hi all,
   I read this  "Persistent messages are confirmed when all queues have
either delivered the message and received an acknowledgement (if required),
*or **persisted the message**.*" on the offical blog. but when i read the
source code, I found maybe it's not true.
    in rabbit_msg_store.erl , when write a message to a file, it will
record pending confirms,.and sync these confirms very 25 milliseconds, the
problem is the file is cached file, so after sended the confirms, the
messages may not have been written to disk. am i correct?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120720/11f3b3d0/attachment.htm>

From francesco at rabbitmq.com  Fri Jul 20 09:48:13 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 20 Jul 2012 09:48:13 +0100
Subject: [rabbitmq-discuss] publishing confirms with persistent messages?
In-Reply-To: <CAB6nogK3d9jZDfWd3v_GqcBy3MiGVN360dpmnTMUvShPgjACrw@mail.gmail.com>
References: <CAB6nogK3d9jZDfWd3v_GqcBy3MiGVN360dpmnTMUvShPgjACrw@mail.gmail.com>
Message-ID: <878veelsxe.wl%francesco@rabbitmq.com>

At Fri, 20 Jul 2012 16:33:23 +0800,
??? wrote:
> Hi all,
> ? ?I read this ?"Persistent messages are confirmed when all queues have either
> delivered the message and received an acknowledgement (if required), or
> persisted the message." on the offical blog. but when i read the source code,
> I found maybe it's not true.
> ? ? in rabbit_msg_store.erl , when?write a message to a file, it will record
> pending confirms,.and sync these confirms very 25?milliseconds, the problem is
> the file is cached file, so after sended the confirms, the messages may not
> have been written to disk. am i correct??

The confirm is sent after fsyncing the msg store file (via
`file_handle_cache:sync/1'), which flushes all the in-memory changes to
disc. I'm not sure what you mean by "the file is a cached file".

--
Francesco * Often in error, never in doubt

From watson.timothy at gmail.com  Fri Jul 20 10:05:44 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 20 Jul 2012 10:05:44 +0100
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <1342754353459-20937.post@n5.nabble.com>
References: <1342670880360-20899.post@n5.nabble.com>
	<0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>
	<1342689509712-20904.post@n5.nabble.com>
	<5007DDC7.6080902@rabbitmq.com> <5007DF25.9010802@rabbitmq.com>
	<5007E1B2.3040206@rabbitmq.com> <5007E286.2090607@rabbitmq.com>
	<1342754353459-20937.post@n5.nabble.com>
Message-ID: <D73A6FF7-604D-4FBB-B33A-DC7576D03EB7@rabbitmq.com>


On 20 Jul 2012, at 04:19, avinash0601 <avinash0601 at gmail.com> wrote:

> I am using ubuntu 12.04 LTS, epmd 5.8.5 & rabbitmq 2.8.4.
> Regarding ports & firewall, i have opened all ports between the 3 instances
> & port 4369 to all. so now i removed the entry 'inet_dist_listen_max/max'
> from config file.
> 
> my /etc/hosts is below;
> *127.0.0.1       rabbit1
> 54.251.XX.XX    rabbit2
> 54.251.XX.XX    rabbit3*
> 
> First of all i am not able to ping or telnet from one node to another.
> 

Well that is an EC2 network configuration problem and I'm afraid we can't help with that. I'd suggest trying the EC2 forums or support. Once you've fixed that problem, you should be able to cluster.

> Do i need to change 'sname' to 'name' in
> /usr/lib/rabbitmq/bin/rabbitmq-server & rabbitmqctl?
> Do i need to change node name initialization in rabbitmq-env from
> *NODENAME=rabbit@${HOSTNAME%%.*}* to *NODENAME=rabbit@${HOSTNAME}*
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/unable-to-cluster-rabbitmq-on-ec2-tp20899p20937.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mward at globalpersonals.co.uk  Fri Jul 20 10:06:08 2012
From: mward at globalpersonals.co.uk (Matthew Ward)
Date: Fri, 20 Jul 2012 10:06:08 +0100
Subject: [rabbitmq-discuss] Frequent crashes on one cluster node but not the
	other
Message-ID: <204EC7CB-DF27-49F7-84A7-50CAD03B0A3C@globalpersonals.co.uk>

I've just brought a two-node RabbitMQ cluster online after updating it to RabbitMQ 2.8.2 and we're seeing an issue with the first node that was brought up where it seems to be constantly crashing (but not actually bringing RabbitMQ down, as it continues to function throughout) with the following repeating set of errors - just wondering if anyone can give a heads-up as to what the error message for the original crash indicates, and whether we can do anything to mitigate the child termination/shutdown?

=CRASH REPORT==== 20-Jul-2012::09:58:15 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.29185.2>
    registered_name: []
    exception exit: {function_clause,
                        [{rabbit_binary_parser,parse_field_value,
                             [<<"\tlongitude">>],
                             []},
                         {rabbit_binary_parser,parse_table,1,[]},
                         {rabbit_binary_parser,parse_table,1,[]},
                         {rabbit_framing_amqp_0_9_1,decode_properties,2,[]},
                         {rabbit_binary_parser,ensure_content_decoded,1,[]},
                         {rabbit_channel,handle_method,3,[]},
                         {rabbit_channel,handle_cast,2,[]},
                         {gen_server2,handle_msg,2,[]}]}
      in function  gen_server2:terminate/3 
    ancestors: [<0.29182.2>,<0.29180.2>,<0.29178.2>,rabbit_tcp_client_sup,
                  rabbit_sup,<0.201.0>]
    messages: []
    links: [<0.29182.2>]
    dictionary: [{{credit_to,<0.29181.2>},49},
                  {{xtype_to_module,topic},rabbit_exchange_type_topic},
                  {permission_cache,[{{resource,<<"/">>,exchange,<<"event">>},
                                      write},
                                     {{resource,<<"/">>,exchange,<<"event">>},
                                      configure}]}]
    trap_exit: true
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 1189
  neighbours:

=SUPERVISOR REPORT==== 20-Jul-2012::09:58:15 ===
     Supervisor: {<0.29182.2>,rabbit_channel_sup}
     Context:    child_terminated
     Reason:     {function_clause,
                     [{rabbit_binary_parser,parse_field_value,
                          [<<"\tlongitude">>],
                          []},
                      {rabbit_binary_parser,parse_table,1,[]},
                      {rabbit_binary_parser,parse_table,1,[]},
                      {rabbit_framing_amqp_0_9_1,decode_properties,2,[]},
                      {rabbit_binary_parser,ensure_content_decoded,1,[]},
                      {rabbit_channel,handle_method,3,[]},
                      {rabbit_channel,handle_cast,2,[]},
                      {gen_server2,handle_msg,2,[]}]}
     Offender:   [{pid,<0.29185.2>},
                  {name,channel},
                  {mfa,
                      {rabbit_channel,start_link,
                          [1,<0.29181.2>,<0.29183.2>,<0.29181.2>,
                           "10.177.131.144:34764 -> 192.168.1.56:5672",
                           rabbit_framing_amqp_0_9_1,
                           {user,<<"wld">>,[],rabbit_auth_backend_internal,
                               {internal_user,<<"wld">>,
                                   <<202,1,90,179,53,221,214,208,253,59,77,117,
                                     206,159,235,145,183,209,199,210>>,
                                   []}},
                           <<"/">>,[],<0.29179.2>,
                           {token,<0.29184.2>,false}]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 20-Jul-2012::09:58:15 ===
     Supervisor: {<0.29182.2>,rabbit_channel_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.29185.2>},
                  {name,channel},
                  {mfa,
                      {rabbit_channel,start_link,
                          [1,<0.29181.2>,<0.29183.2>,<0.29181.2>,
                           "10.177.131.144:34764 -> 192.168.1.56:5672",
                           rabbit_framing_amqp_0_9_1,
                           {user,<<"wld">>,[],rabbit_auth_backend_internal,
                               {internal_user,<<"wld">>,
                                   <<202,1,90,179,53,221,214,208,253,59,77,117,
                                     206,159,235,145,183,209,199,210>>,
                                   []}},
                           <<"/">>,[],<0.29179.2>,
                           {token,<0.29184.2>,false}]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]



---
Matthew Ward
Operations Engineer
Global Personals Limited

Email: mward at globalpersonals.co.uk
Phone: +44 1753 757552 (x406)


-- 


Global Personals is a limited company registered in England and Wales.

Registered number: 04880697

Registered office: Minton Place, Victoria Street, Windsor, Berkshire, SL4 
1EG, United Kingdom
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120720/e0f1a68c/attachment.htm>

From avinash0601 at gmail.com  Fri Jul 20 10:14:07 2012
From: avinash0601 at gmail.com (avinash0601)
Date: Fri, 20 Jul 2012 02:14:07 -0700 (PDT)
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <D73A6FF7-604D-4FBB-B33A-DC7576D03EB7@rabbitmq.com>
References: <1342670880360-20899.post@n5.nabble.com>
	<0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>
	<1342689509712-20904.post@n5.nabble.com>
	<5007DDC7.6080902@rabbitmq.com> <5007DF25.9010802@rabbitmq.com>
	<5007E1B2.3040206@rabbitmq.com> <5007E286.2090607@rabbitmq.com>
	<1342754353459-20937.post@n5.nabble.com>
	<D73A6FF7-604D-4FBB-B33A-DC7576D03EB7@rabbitmq.com>
Message-ID: <1342775647513-20942.post@n5.nabble.com>

but Do i need to change 'sname' to 'name' in
/usr/lib/rabbitmq/bin/rabbitmq-server & rabbitmqctl?
Do i need to change node name initialization in rabbitmq-env from
NODENAME=rabbit@${HOSTNAME%%.*} to NODENAME=rabbit@${HOSTNAME}



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/unable-to-cluster-rabbitmq-on-ec2-tp20899p20942.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Fri Jul 20 10:30:56 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 20 Jul 2012 10:30:56 +0100
Subject: [rabbitmq-discuss] Consumer acknowledgement
In-Reply-To: <CAE8G+yQWNjLaNRRTL-2Tqj_F7air0VsWheU571SimpJrCmoxqg@mail.gmail.com>
References: <CAE8G+yQWNjLaNRRTL-2Tqj_F7air0VsWheU571SimpJrCmoxqg@mail.gmail.com>
Message-ID: <50092550.3030903@rabbitmq.com>

Hi,

On 19/07/12 22:11, Prashanth wrote:
> If the message is never acknowledge or ack message is lost in transit
> and if consumer never goes down

I don't think that scenario is possible in the presence of reliability
guarantees offered by TCP. If packets get dropped then TCP will
compensate transparently. The only way an ack can get lost is if the
connection terminates, in which case the unacknowledged message becomes
available for redelivery.


-Emile



From mward at globalpersonals.co.uk  Fri Jul 20 10:29:20 2012
From: mward at globalpersonals.co.uk (Matthew Ward)
Date: Fri, 20 Jul 2012 10:29:20 +0100
Subject: [rabbitmq-discuss] Frequent crashes on one cluster node but not the
	other
Message-ID: <7C1B2836-6957-4410-B3E3-45A1C1A3D08B@globalpersonals.co.uk>

I've just brought a two-node RabbitMQ cluster online after updating it to RabbitMQ 2.8.2 and we're seeing an issue with the first node that was brought up where it seems to be constantly crashing (but not actually bringing RabbitMQ down, as it continues to function throughout) with the following repeating set of errors - just wondering if anyone can give a heads-up as to what the error message for the original crash indicates, and whether we can do anything to mitigate the child termination/shutdown?

=CRASH REPORT==== 20-Jul-2012::09:58:15 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.29185.2>
    registered_name: []
    exception exit: {function_clause,
                        [{rabbit_binary_parser,parse_field_value,
                             [<<"\tlongitude">>],
                             []},
                         {rabbit_binary_parser,parse_table,1,[]},
                         {rabbit_binary_parser,parse_table,1,[]},
                         {rabbit_framing_amqp_0_9_1,decode_properties,2,[]},
                         {rabbit_binary_parser,ensure_content_decoded,1,[]},
                         {rabbit_channel,handle_method,3,[]},
                         {rabbit_channel,handle_cast,2,[]},
                         {gen_server2,handle_msg,2,[]}]}
      in function  gen_server2:terminate/3 
    ancestors: [<0.29182.2>,<0.29180.2>,<0.29178.2>,rabbit_tcp_client_sup,
                  rabbit_sup,<0.201.0>]
    messages: []
    links: [<0.29182.2>]
    dictionary: [{{credit_to,<0.29181.2>},49},
                  {{xtype_to_module,topic},rabbit_exchange_type_topic},
                  {permission_cache,[{{resource,<<"/">>,exchange,<<"event">>},
                                      write},
                                     {{resource,<<"/">>,exchange,<<"event">>},
                                      configure}]}]
    trap_exit: true
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 1189
  neighbours:

=SUPERVISOR REPORT==== 20-Jul-2012::09:58:15 ===
     Supervisor: {<0.29182.2>,rabbit_channel_sup}
     Context:    child_terminated
     Reason:     {function_clause,
                     [{rabbit_binary_parser,parse_field_value,
                          [<<"\tlongitude">>],
                          []},
                      {rabbit_binary_parser,parse_table,1,[]},
                      {rabbit_binary_parser,parse_table,1,[]},
                      {rabbit_framing_amqp_0_9_1,decode_properties,2,[]},
                      {rabbit_binary_parser,ensure_content_decoded,1,[]},
                      {rabbit_channel,handle_method,3,[]},
                      {rabbit_channel,handle_cast,2,[]},
                      {gen_server2,handle_msg,2,[]}]}
     Offender:   [{pid,<0.29185.2>},
                  {name,channel},
                  {mfa,
                      {rabbit_channel,start_link,
                          [1,<0.29181.2>,<0.29183.2>,<0.29181.2>,
                           "10.177.131.144:34764 -> 192.168.1.56:5672",
                           rabbit_framing_amqp_0_9_1,
                           {user,<<"wld">>,[],rabbit_auth_backend_internal,
                               {internal_user,<<"wld">>,
                                   <<202,1,90,179,53,221,214,208,253,59,77,117,
                                     206,159,235,145,183,209,199,210>>,
                                   []}},
                           <<"/">>,[],<0.29179.2>,
                           {token,<0.29184.2>,false}]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 20-Jul-2012::09:58:15 ===
     Supervisor: {<0.29182.2>,rabbit_channel_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.29185.2>},
                  {name,channel},
                  {mfa,
                      {rabbit_channel,start_link,
                          [1,<0.29181.2>,<0.29183.2>,<0.29181.2>,
                           "10.177.131.144:34764 -> 192.168.1.56:5672",
                           rabbit_framing_amqp_0_9_1,
                           {user,<<"wld">>,[],rabbit_auth_backend_internal,
                               {internal_user,<<"wld">>,
                                   <<202,1,90,179,53,221,214,208,253,59,77,117,
                                     206,159,235,145,183,209,199,210>>,
                                   []}},
                           <<"/">>,[],<0.29179.2>,
                           {token,<0.29184.2>,false}]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]


---
Matthew Ward
Operations Engineer
Global Personals Limited

Email: mward at globalpersonals.co.uk
Phone: +44 1753 757552 (x406)


-- 


Global Personals is a limited company registered in England and Wales.

Registered number: 04880697

Registered office: Minton Place, Victoria Street, Windsor, Berkshire, SL4 
1EG, United Kingdom
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120720/41a2e1dc/attachment.htm>

From emile at rabbitmq.com  Fri Jul 20 10:58:35 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 20 Jul 2012 10:58:35 +0100
Subject: [rabbitmq-discuss] Build deb package including plugins
In-Reply-To: <CACDZx9j=r-nNz=KC5HKYmjgvOt3h7TEBLR=pVHjs969XOhVT-w@mail.gmail.com>
References: <CACDZx9j=r-nNz=KC5HKYmjgvOt3h7TEBLR=pVHjs969XOhVT-w@mail.gmail.com>
Message-ID: <50092BCB.4040102@rabbitmq.com>

Hi,

On 18/07/12 22:22, Clemens Kolbitsch wrote:
> I'm trying to build the latest mecurial version into a deb package and
> include specific plugins in the deb.

You can accomplish this by transplanting the "debian" folder from a
Debian source package to a checked out version of the rabbitmq-server
repository.

For the plugins you need to check out the public umbrella (as you have
done) and define the PLUGINS_SRC_DIST_DIR Make variable to point to the
"plugins-src" directory within the rabbitmq-server directory and run the
plugins-srcdist Makefile target from the public umbrella.


-Emile


From tim at rabbitmq.com  Fri Jul 20 10:54:43 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 20 Jul 2012 10:54:43 +0100
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <1342775647513-20942.post@n5.nabble.com>
References: <1342670880360-20899.post@n5.nabble.com>
	<0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>
	<1342689509712-20904.post@n5.nabble.com>
	<5007DDC7.6080902@rabbitmq.com> <5007DF25.9010802@rabbitmq.com>
	<5007E1B2.3040206@rabbitmq.com> <5007E286.2090607@rabbitmq.com>
	<1342754353459-20937.post@n5.nabble.com>
	<D73A6FF7-604D-4FBB-B33A-DC7576D03EB7@rabbitmq.com>
	<1342775647513-20942.post@n5.nabble.com>
Message-ID: <50092AE3.7040001@rabbitmq.com>

On 07/20/2012 10:14 AM, avinash0601 wrote:
> but Do i need to change 'sname' to 'name' in
> /usr/lib/rabbitmq/bin/rabbitmq-server&  rabbitmqctl?
> Do i need to change node name initialization in rabbitmq-env from
> NODENAME=rabbit@${HOSTNAME%%.*} to NODENAME=rabbit@${HOSTNAME}
>

No you shouldn't need to change that. The choice between long and 
shortnames is about whether or not you're fully qualifying your hostname 
with the domain or not. This is *not* why you cannot cluster your 
rabbits. You can't cluster them because they cannot talk to the epmd 
daemons on one another's nodes, as evidenced by the fact that you cannot 
telnet onto it. If *this* works, then you should be able to cluster 
without changing too much: `telnet <hostname> <epmd-port>`

Tim

From avinash0601 at gmail.com  Fri Jul 20 11:17:32 2012
From: avinash0601 at gmail.com (avinash0601)
Date: Fri, 20 Jul 2012 03:17:32 -0700 (PDT)
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <50092AE3.7040001@rabbitmq.com>
References: <0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>
	<1342689509712-20904.post@n5.nabble.com>
	<5007DDC7.6080902@rabbitmq.com> <5007DF25.9010802@rabbitmq.com>
	<5007E1B2.3040206@rabbitmq.com> <5007E286.2090607@rabbitmq.com>
	<1342754353459-20937.post@n5.nabble.com>
	<D73A6FF7-604D-4FBB-B33A-DC7576D03EB7@rabbitmq.com>
	<1342775647513-20942.post@n5.nabble.com>
	<50092AE3.7040001@rabbitmq.com>
Message-ID: <1342779452586-20948.post@n5.nabble.com>

ok i have not made any changes to rabbitctl, rabbitmq-server & rabbitmq-env.
I am now able to telnet <hostname> 4369 between all 3 nodes.

below is the error when i am trying to check the status of node2 from node1

root at rabbit1:~# rabbitmqctl -n rabbit at rabbit2 status
Status of node rabbit at rabbit2 ...
Error: unable to connect to node rabbit at rabbit2: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at rabbit2]

hosts, their running nodes and ports:
- rabbit2: [{rabbit,53717}]

current node details:
- node name: rabbitmqctl5759 at rabbit1
- home dir: /var/lib/rabbitmq
- cookie hash: 5jktLfwA+Tbs8ASMtK9mHg==



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/unable-to-cluster-rabbitmq-on-ec2-tp20899p20948.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Fri Jul 20 11:21:55 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 20 Jul 2012 11:21:55 +0100
Subject: [rabbitmq-discuss] Need to close channel to get consume message
In-Reply-To: <CAHPrJT0FsV5g9tRf7R23hnms7GrwcWpvHPw_WPPhnnJt4U93LA@mail.gmail.com>
References: <CAHPrJT0FsV5g9tRf7R23hnms7GrwcWpvHPw_WPPhnnJt4U93LA@mail.gmail.com>
Message-ID: <50093143.2060702@rabbitmq.com>

Hi,

On 19/07/12 14:27, Vijay Lakshmi wrote:
> - 1  connection and channel pool on that connection ( with 500 channels
> ) for subscribe
> 
> - 1 connection and channel pool on that connection ( with 500 channels )
> for Consume

It is not normally necessary to pool channels. Channels are cheap to
create compared to database connections. If you do decide to use pooling
then bear in mind that some channel state (whether it is transactional
or has confirms enabled) is irreversible.

"subscribe" and "consume" are usually used as interchangeably, so I'm
not sure what your aim is to create separate channels for each.

> Surprisingly when we close the channel, we are getting the message. (
> i.e/ delivery  is not null )

A message coming back to life after closing a channel is normally a sign
of faulty acknowledgement logic in your application. You will probably
find an error if you focus on that.


-Emile



From tim at rabbitmq.com  Fri Jul 20 11:17:02 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 20 Jul 2012 11:17:02 +0100
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <1342779452586-20948.post@n5.nabble.com>
References: <0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>
	<1342689509712-20904.post@n5.nabble.com>
	<5007DDC7.6080902@rabbitmq.com> <5007DF25.9010802@rabbitmq.com>
	<5007E1B2.3040206@rabbitmq.com> <5007E286.2090607@rabbitmq.com>
	<1342754353459-20937.post@n5.nabble.com>
	<D73A6FF7-604D-4FBB-B33A-DC7576D03EB7@rabbitmq.com>
	<1342775647513-20942.post@n5.nabble.com>
	<50092AE3.7040001@rabbitmq.com>
	<1342779452586-20948.post@n5.nabble.com>
Message-ID: <5009301E.40709@rabbitmq.com>

On 07/20/2012 11:17 AM, avinash0601 wrote:
> ok i have not made any changes to rabbitctl, rabbitmq-server&  rabbitmq-env.
> I am now able to telnet<hostname>  4369 between all 3 nodes.
>
> below is the error when i am trying to check the status of node2 from node1
>
> root at rabbit1:~# rabbitmqctl -n rabbit at rabbit2 status
> Status of node rabbit at rabbit2 ...
> Error: unable to connect to node rabbit at rabbit2: nodedown
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit at rabbit2]
>
> hosts, their running nodes and ports:
> - rabbit2: [{rabbit,53717}]
>
> current node details:
> - node name: rabbitmqctl5759 at rabbit1
> - home dir: /var/lib/rabbitmq
> - cookie hash: 5jktLfwA+Tbs8ASMtK9mHg==

Checked all the cookies are the same on each machine, so that 
rabbitmqctl status on each (local) node shows the same cookie hash?


From tim at rabbitmq.com  Fri Jul 20 11:18:57 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 20 Jul 2012 11:18:57 +0100
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <5009301E.40709@rabbitmq.com>
References: <0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>
	<1342689509712-20904.post@n5.nabble.com>
	<5007DDC7.6080902@rabbitmq.com> <5007DF25.9010802@rabbitmq.com>
	<5007E1B2.3040206@rabbitmq.com> <5007E286.2090607@rabbitmq.com>
	<1342754353459-20937.post@n5.nabble.com>
	<D73A6FF7-604D-4FBB-B33A-DC7576D03EB7@rabbitmq.com>
	<1342775647513-20942.post@n5.nabble.com>
	<50092AE3.7040001@rabbitmq.com>
	<1342779452586-20948.post@n5.nabble.com>
	<5009301E.40709@rabbitmq.com>
Message-ID: <50093091.4060706@rabbitmq.com>

On 07/20/2012 11:17 AM, Tim Watson wrote:
> On 07/20/2012 11:17 AM, avinash0601 wrote:
>> ok i have not made any changes to rabbitctl, rabbitmq-server&  
>> rabbitmq-env.
>> I am now able to telnet<hostname>  4369 between all 3 nodes.
>>
>> below is the error when i am trying to check the status of node2 from 
>> node1
>>
>> root at rabbit1:~# rabbitmqctl -n rabbit at rabbit2 status
>> Status of node rabbit at rabbit2 ...
>> Error: unable to connect to node rabbit at rabbit2: nodedown
>>
>> DIAGNOSTICS
>> ===========
>>
>> nodes in question: [rabbit at rabbit2]
>>
>> hosts, their running nodes and ports:
>> - rabbit2: [{rabbit,53717}]
>>
>> current node details:
>> - node name: rabbitmqctl5759 at rabbit1
>> - home dir: /var/lib/rabbitmq
>> - cookie hash: 5jktLfwA+Tbs8ASMtK9mHg==
>
> Checked all the cookies are the same on each machine, so that 
> rabbitmqctl status on each (local) node shows the same cookie hash?
>

You should be running rabbitmqctl as the rabbit(mq) user BTW, otherwise 
cookies get picked up from the wrong $HOME folder.

From tim at rabbitmq.com  Fri Jul 20 11:22:15 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 20 Jul 2012 11:22:15 +0100
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <50093091.4060706@rabbitmq.com>
References: <0601619E-75F5-4796-9080-26CE7286C4FD@rabbitmq.com>
	<1342689509712-20904.post@n5.nabble.com>
	<5007DDC7.6080902@rabbitmq.com> <5007DF25.9010802@rabbitmq.com>
	<5007E1B2.3040206@rabbitmq.com> <5007E286.2090607@rabbitmq.com>
	<1342754353459-20937.post@n5.nabble.com>
	<D73A6FF7-604D-4FBB-B33A-DC7576D03EB7@rabbitmq.com>
	<1342775647513-20942.post@n5.nabble.com>
	<50092AE3.7040001@rabbitmq.com>
	<1342779452586-20948.post@n5.nabble.com>
	<5009301E.40709@rabbitmq.com> <50093091.4060706@rabbitmq.com>
Message-ID: <50093157.40307@rabbitmq.com>

On 07/20/2012 11:18 AM, Tim Watson wrote:
>>> current node details:
>>> - node name: rabbitmqctl5759 at rabbit1
>>> - home dir: /var/lib/rabbitmq
>>> - cookie hash: 5jktLfwA+Tbs8ASMtK9mHg==
>>
>> Checked all the cookies are the same on each machine, so that 
>> rabbitmqctl status on each (local) node shows the same cookie hash?
>>
>
> You should be running rabbitmqctl as the rabbit(mq) user BTW, 
> otherwise cookies get picked up from the wrong $HOME folder.

Sorry I'm feeding you the wrong information there! In fact, when 
installed via packages (e.g., on deb/rpm based linux) this is dealt with 
transparently, as evidenced by the *correct* home dir entry that 
rabbitmqctl is printing out! Sorry for the confusion there. Check your 
cookies are the same on all machines though.

From emile at rabbitmq.com  Fri Jul 20 11:38:17 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 20 Jul 2012 11:38:17 +0100
Subject: [rabbitmq-discuss] Frequent crashes on one cluster node but not
 the other
In-Reply-To: <7C1B2836-6957-4410-B3E3-45A1C1A3D08B@globalpersonals.co.uk>
References: <7C1B2836-6957-4410-B3E3-45A1C1A3D08B@globalpersonals.co.uk>
Message-ID: <50093519.4050600@rabbitmq.com>

Hi,

On 20/07/12 10:29, Matthew Ward wrote:
>                         [{rabbit_binary_parser,parse_field_value,
>                              [<<"\tlongitude">>],

I would not expect clustering to be relevant, as this error indicates a
possible AMQP frame encoding issue. "\t" is not a valid table field
value prefix. See "Q3 field types" for a list of accepted prefixes.

Which AMQP client are you using?



-Emile



From avinash0601 at gmail.com  Fri Jul 20 11:48:11 2012
From: avinash0601 at gmail.com (avinash0601)
Date: Fri, 20 Jul 2012 03:48:11 -0700 (PDT)
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <50093157.40307@rabbitmq.com>
References: <5007E1B2.3040206@rabbitmq.com> <5007E286.2090607@rabbitmq.com>
	<1342754353459-20937.post@n5.nabble.com>
	<D73A6FF7-604D-4FBB-B33A-DC7576D03EB7@rabbitmq.com>
	<1342775647513-20942.post@n5.nabble.com>
	<50092AE3.7040001@rabbitmq.com>
	<1342779452586-20948.post@n5.nabble.com>
	<5009301E.40709@rabbitmq.com> <50093091.4060706@rabbitmq.com>
	<50093157.40307@rabbitmq.com>
Message-ID: <1342781291262-20954.post@n5.nabble.com>

>Checked all the cookies are the same on each machine, so that
>rabbitmqctl status on each (local) node shows the same cookie hash? 

yes tim,
the cookie hash(5jktLfwA+Tbs8ASMtK9mHg==) is same over all 3 nodes.


>You should be running rabbitmqctl as the rabbit(mq) user BTW, otherwise
>cookies get picked up from the wrong $HOME folder. 

i have copied .erlang.cookie to /root/



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/unable-to-cluster-rabbitmq-on-ec2-tp20899p20954.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Fri Jul 20 14:04:22 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 20 Jul 2012 14:04:22 +0100
Subject: [rabbitmq-discuss] unable to cluster rabbitmq on ec2
In-Reply-To: <1342781291262-20954.post@n5.nabble.com>
References: <5007E1B2.3040206@rabbitmq.com> <5007E286.2090607@rabbitmq.com>
	<1342754353459-20937.post@n5.nabble.com>
	<D73A6FF7-604D-4FBB-B33A-DC7576D03EB7@rabbitmq.com>
	<1342775647513-20942.post@n5.nabble.com>
	<50092AE3.7040001@rabbitmq.com>
	<1342779452586-20948.post@n5.nabble.com>
	<5009301E.40709@rabbitmq.com> <50093091.4060706@rabbitmq.com>
	<50093157.40307@rabbitmq.com>
	<1342781291262-20954.post@n5.nabble.com>
Message-ID: <50095756.4020602@rabbitmq.com>

On 20/07/12 11:48, avinash0601 wrote:
> the cookie hash(5jktLfwA+Tbs8ASMtK9mHg==) is same over all 3 nodes.

check that you can connect from each node to the other nodes' erlang 
distribution port. e.g. previously you showed us the following...

> root at rabbit1:~# rabbitmqctl -n rabbit at rabbit2 status
> Status of node rabbit at rabbit2 ...
> Error: unable to connect to node rabbit at rabbit2: nodedown
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit at rabbit2]
>
> hosts, their running nodes and ports:
> - rabbit2: [{rabbit,53717}]
>
> current node details:
> - node name: rabbitmqctl5759 at rabbit1
> - home dir: /var/lib/rabbitmq
> - cookie hash: 5jktLfwA+Tbs8ASMtK9mHg==

The "hosts, their running nodes and ports" section tells you that erlang 
is listening on port 53717 on rabbit2, so try to connecting to that port 
from rabbit1.

Matthias.

From clemens.kol at gmail.com  Fri Jul 20 18:11:12 2012
From: clemens.kol at gmail.com (Clemens Kolbitsch)
Date: Fri, 20 Jul 2012 10:11:12 -0700
Subject: [rabbitmq-discuss] Build deb package including plugins
In-Reply-To: <50092BCB.4040102@rabbitmq.com>
References: <CACDZx9j=r-nNz=KC5HKYmjgvOt3h7TEBLR=pVHjs969XOhVT-w@mail.gmail.com>
	<50092BCB.4040102@rabbitmq.com>
Message-ID: <CACDZx9gw9NG4yHPMTDsrNn8Nvd5ZDSUs-7dq77iJk6SuJ++ang@mail.gmail.com>

Hi Emile,

thanks a lot for getting back to me!

On Fri, Jul 20, 2012 at 2:58 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi,
>
> On 18/07/12 22:22, Clemens Kolbitsch wrote:
>> I'm trying to build the latest mecurial version into a deb package and
>> include specific plugins in the deb.
>
> You can accomplish this by transplanting the "debian" folder from a
> Debian source package to a checked out version of the rabbitmq-server
> repository.

Wait, just to make sure, so I cannot build the deb package from
umbrella alone? That seemed to have worked fine in the past.

> For the plugins you need to check out the public umbrella (as you have
> done) and define the PLUGINS_SRC_DIST_DIR Make variable to point to the
> "plugins-src" directory within the rabbitmq-server directory and run the
> plugins-srcdist Makefile target from the public umbrella.

I'm sorry, but I completely cannot follow. What/where is the
"plugins-src" directory? In the entire umbrella tree I cannot find
such a directory. If I point it to "rabbitmq-server/plugins" (the dir
I created with the links, just to try) and run "make plugins-srcdist",
I don't see changes.

Thanks for helping me out, I really appreciate it. BTW, is this
documented anywhere? I grepped the entire umbrella dir for
PLUGINS_SRC_DIST_DIR and cannot find anything (outside the Makefile of
course)

-Clemens

From dseltzer at tveyes.com  Fri Jul 20 19:06:55 2012
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Fri, 20 Jul 2012 14:06:55 -0400
Subject: [rabbitmq-discuss] Security Exception in IIS using RabbitMQ Client
Message-ID: <1bf0da2d77a8dde3045f42fbb98de912@mail.gmail.com>

I'm having a bit of trouble using the .NET RabbitMQ client in IIS, maybe
someone knows what I'm running into.

Here's the code I'm trying to run:

    ConnectionFactory rabbitConFactory = new ConnectionFactory();
    rabbitConFactory.Address = "hostname";
    rabbitConFactory.VirtualHost = "/path";
    rabbitConFactory.UserName = "user";
    rabbitConFactory.Password = "password";

    IConnection connection = rabbitConFactory.CreateConnection();

    IModel channel = connection.CreateModel();

    Dictionary<String, Object> args = new Dictionary<string, object>();
    args.Add("x-ha-policy", "all");
    String ExchangeName = "SearchInstructions";
    channel.ExchangeDeclare(ExchangeName, "topic", true, false, args);

    Guid myId = new Guid();
    String RoutingKey = myId.ToString() + ".Instruction";
    IBasicProperties MessageProperties = channel.CreateBasicProperties();
    MessageProperties.SetPersistent(true);
    MessageProperties.ContentEncoding = "UTF-8";
    MessageProperties.ContentType = "text/xml";
    MessageProperties.Headers.Add("x-origin",
Request.ServerVariables["ServerName"]);

    String messageContent = "<foo />";
    byte[] data = System.Text.Encoding.UTF8.GetBytes(messageContent);
    channel.BasicPublish(ExchangeName,RoutingKey, MessageProperties,
data);

    channel.Close();
    connection.Close();

When I run the code in an ASPX page I receive the following Security
Exception:
    Security Exception

    Description: The application attempted to perform an operation not
allowed by the security policy.  To grant this application the required
permission please contact your system administrator or change the
application's trust level in the configuration file.

    Exception Details: System.Security.SecurityException: Request for the
permission of type 'System.Security.Permissions.FileIOPermission,
mscorlib, Version=2.0.0.0, Culture=neutral,
PublicKeyToken=b77a5c561934e089' failed.

I'm not really sure how to proceed. This sounds like an IIS issue, but
someone here must have tackled this problem before.

Thanks much!

-Dave

From watson.timothy at gmail.com  Fri Jul 20 19:28:55 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 20 Jul 2012 19:28:55 +0100
Subject: [rabbitmq-discuss] Security Exception in IIS using RabbitMQ
	Client
In-Reply-To: <1bf0da2d77a8dde3045f42fbb98de912@mail.gmail.com>
References: <1bf0da2d77a8dde3045f42fbb98de912@mail.gmail.com>
Message-ID: <9D0B20A0-D068-4BB5-89F3-161E53F96D03@rabbitmq.com>


On 20 Jul 2012, at 19:06, Dave Seltzer <dseltzer at tveyes.com> wrote:

> I'm having a bit of trouble using the .NET RabbitMQ client in IIS, maybe
> someone knows what I'm running into.
> 
> Here's the code I'm trying to run:
> 
>    ConnectionFactory rabbitConFactory = new ConnectionFactory();
>    rabbitConFactory.Address = "hostname";
>    rabbitConFactory.VirtualHost = "/path";
>    rabbitConFactory.UserName = "user";
>    rabbitConFactory.Password = "password";
> 
>    IConnection connection = rabbitConFactory.CreateConnection();
> 
>    IModel channel = connection.CreateModel();
> 
>    Dictionary<String, Object> args = new Dictionary<string, object>();
>    args.Add("x-ha-policy", "all");
>    String ExchangeName = "SearchInstructions";
>    channel.ExchangeDeclare(ExchangeName, "topic", true, false, args);
> 
>    Guid myId = new Guid();
>    String RoutingKey = myId.ToString() + ".Instruction";
>    IBasicProperties MessageProperties = channel.CreateBasicProperties();
>    MessageProperties.SetPersistent(true);
>    MessageProperties.ContentEncoding = "UTF-8";
>    MessageProperties.ContentType = "text/xml";
>    MessageProperties.Headers.Add("x-origin",
> Request.ServerVariables["ServerName"]);
> 
>    String messageContent = "<foo />";
>    byte[] data = System.Text.Encoding.UTF8.GetBytes(messageContent);
>    channel.BasicPublish(ExchangeName,RoutingKey, MessageProperties,
> data);
> 
>    channel.Close();
>    connection.Close();
> 
> When I run the code in an ASPX page I receive the following Security
> Exception:
>    Security Exception
> 
>    Description: The application attempted to perform an operation not
> allowed by the security policy.  To grant this application the required
> permission please contact your system administrator or change the
> application's trust level in the configuration file.
> 
>    Exception Details: System.Security.SecurityException: Request for the
> permission of type 'System.Security.Permissions.FileIOPermission,
> mscorlib, Version=2.0.0.0, Culture=neutral,
> PublicKeyToken=b77a5c561934e089' failed.
> 
> I'm not really sure how to proceed. This sounds like an IIS issue, but
> someone here must have tackled this problem before.
> 

This is indeed an IIS configuration issue. You need to grant the assembly the appropriate code access permissions. It's been a long time since I looked at IIS, so I can't tell you exactly where to set this up until I'm in front of a browser, but checking msdn for Code Access, FileIOPermission, assemblies and IIS is where I'd start if you want to get a head start. Post the list if you figure it out first please! :)

> Thanks much!
> 
> -Dave
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From watson.timothy at gmail.com  Fri Jul 20 19:31:33 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 20 Jul 2012 19:31:33 +0100
Subject: [rabbitmq-discuss] Security Exception in IIS using RabbitMQ
	Client
In-Reply-To: <9D0B20A0-D068-4BB5-89F3-161E53F96D03@rabbitmq.com>
References: <1bf0da2d77a8dde3045f42fbb98de912@mail.gmail.com>
	<9D0B20A0-D068-4BB5-89F3-161E53F96D03@rabbitmq.com>
Message-ID: <AC353482-9EF9-4B96-815F-A6346530FDEE@rabbitmq.com>

http://stackoverflow.com/questions/4925331/system-security-permissions-fileiopermission-when-accessing-folder-outside-web-s



On 20 Jul 2012, at 19:28, Tim Watson <watson.timothy at gmail.com> wrote:

> 
> On 20 Jul 2012, at 19:06, Dave Seltzer <dseltzer at tveyes.com> wrote:
> 
>> I'm having a bit of trouble using the .NET RabbitMQ client in IIS, maybe
>> someone knows what I'm running into.
>> 
>> Here's the code I'm trying to run:
>> 
>>   ConnectionFactory rabbitConFactory = new ConnectionFactory();
>>   rabbitConFactory.Address = "hostname";
>>   rabbitConFactory.VirtualHost = "/path";
>>   rabbitConFactory.UserName = "user";
>>   rabbitConFactory.Password = "password";
>> 
>>   IConnection connection = rabbitConFactory.CreateConnection();
>> 
>>   IModel channel = connection.CreateModel();
>> 
>>   Dictionary<String, Object> args = new Dictionary<string, object>();
>>   args.Add("x-ha-policy", "all");
>>   String ExchangeName = "SearchInstructions";
>>   channel.ExchangeDeclare(ExchangeName, "topic", true, false, args);
>> 
>>   Guid myId = new Guid();
>>   String RoutingKey = myId.ToString() + ".Instruction";
>>   IBasicProperties MessageProperties = channel.CreateBasicProperties();
>>   MessageProperties.SetPersistent(true);
>>   MessageProperties.ContentEncoding = "UTF-8";
>>   MessageProperties.ContentType = "text/xml";
>>   MessageProperties.Headers.Add("x-origin",
>> Request.ServerVariables["ServerName"]);
>> 
>>   String messageContent = "<foo />";
>>   byte[] data = System.Text.Encoding.UTF8.GetBytes(messageContent);
>>   channel.BasicPublish(ExchangeName,RoutingKey, MessageProperties,
>> data);
>> 
>>   channel.Close();
>>   connection.Close();
>> 
>> When I run the code in an ASPX page I receive the following Security
>> Exception:
>>   Security Exception
>> 
>>   Description: The application attempted to perform an operation not
>> allowed by the security policy.  To grant this application the required
>> permission please contact your system administrator or change the
>> application's trust level in the configuration file.
>> 
>>   Exception Details: System.Security.SecurityException: Request for the
>> permission of type 'System.Security.Permissions.FileIOPermission,
>> mscorlib, Version=2.0.0.0, Culture=neutral,
>> PublicKeyToken=b77a5c561934e089' failed.
>> 
>> I'm not really sure how to proceed. This sounds like an IIS issue, but
>> someone here must have tackled this problem before.
>> 
> 
> This is indeed an IIS configuration issue. You need to grant the assembly the appropriate code access permissions. It's been a long time since I looked at IIS, so I can't tell you exactly where to set this up until I'm in front of a browser, but checking msdn for Code Access, FileIOPermission, assemblies and IIS is where I'd start if you want to get a head start. Post the list if you figure it out first please! :)
> 
>> Thanks much!
>> 
>> -Dave
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From watson.timothy at gmail.com  Fri Jul 20 19:32:56 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 20 Jul 2012 19:32:56 +0100
Subject: [rabbitmq-discuss] Security Exception in IIS using RabbitMQ
	Client
In-Reply-To: <9D0B20A0-D068-4BB5-89F3-161E53F96D03@rabbitmq.com>
References: <1bf0da2d77a8dde3045f42fbb98de912@mail.gmail.com>
	<9D0B20A0-D068-4BB5-89F3-161E53F96D03@rabbitmq.com>
Message-ID: <C5A285C7-9D90-4177-B952-8042A49534DA@rabbitmq.com>


http://stackoverflow.com/questions/4925331/system-security-permissions-fileiopermission-when-accessing-folder-outside-web-s


On 20 Jul 2012, at 19:28, Tim Watson <watson.timothy at gmail.com> wrote:

> 
> On 20 Jul 2012, at 19:06, Dave Seltzer <dseltzer at tveyes.com> wrote:
> 
>> I'm having a bit of trouble using the .NET RabbitMQ client in IIS, maybe
>> someone knows what I'm running into.
>> 
>> Here's the code I'm trying to run:
>> 
>>   ConnectionFactory rabbitConFactory = new ConnectionFactory();
>>   rabbitConFactory.Address = "hostname";
>>   rabbitConFactory.VirtualHost = "/path";
>>   rabbitConFactory.UserName = "user";
>>   rabbitConFactory.Password = "password";
>> 
>>   IConnection connection = rabbitConFactory.CreateConnection();
>> 
>>   IModel channel = connection.CreateModel();
>> 
>>   Dictionary<String, Object> args = new Dictionary<string, object>();
>>   args.Add("x-ha-policy", "all");
>>   String ExchangeName = "SearchInstructions";
>>   channel.ExchangeDeclare(ExchangeName, "topic", true, false, args);
>> 
>>   Guid myId = new Guid();
>>   String RoutingKey = myId.ToString() + ".Instruction";
>>   IBasicProperties MessageProperties = channel.CreateBasicProperties();
>>   MessageProperties.SetPersistent(true);
>>   MessageProperties.ContentEncoding = "UTF-8";
>>   MessageProperties.ContentType = "text/xml";
>>   MessageProperties.Headers.Add("x-origin",
>> Request.ServerVariables["ServerName"]);
>> 
>>   String messageContent = "<foo />";
>>   byte[] data = System.Text.Encoding.UTF8.GetBytes(messageContent);
>>   channel.BasicPublish(ExchangeName,RoutingKey, MessageProperties,
>> data);
>> 
>>   channel.Close();
>>   connection.Close();
>> 
>> When I run the code in an ASPX page I receive the following Security
>> Exception:
>>   Security Exception
>> 
>>   Description: The application attempted to perform an operation not
>> allowed by the security policy.  To grant this application the required
>> permission please contact your system administrator or change the
>> application's trust level in the configuration file.
>> 
>>   Exception Details: System.Security.SecurityException: Request for the
>> permission of type 'System.Security.Permissions.FileIOPermission,
>> mscorlib, Version=2.0.0.0, Culture=neutral,
>> PublicKeyToken=b77a5c561934e089' failed.
>> 
>> I'm not really sure how to proceed. This sounds like an IIS issue, but
>> someone here must have tackled this problem before.
>> 
> 
> This is indeed an IIS configuration issue. You need to grant the assembly the appropriate code access permissions. It's been a long time since I looked at IIS, so I can't tell you exactly where to set this up until I'm in front of a browser, but checking msdn for Code Access, FileIOPermission, assemblies and IIS is where I'd start if you want to get a head start. Post the list if you figure it out first please! :)
> 
>> Thanks much!
>> 
>> -Dave
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Fri Jul 20 19:40:03 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 20 Jul 2012 19:40:03 +0100
Subject: [rabbitmq-discuss] Federation: Superfluous bindings in Exchanges
In-Reply-To: <CC2DD18A.3563%Michael.Laing@nytimes.com>
References: <CC2DD18A.3563%Michael.Laing@nytimes.com>
Message-ID: <5009A603.2020707@rabbitmq.com>

Michael,

On 19/07/12 20:01, Laing, Michael P. wrote:
> I have sent reports to you separately. -ml

Thanks.

It's a bug. Cyclic topologies leak bindings.

I am amazed that this a) was missed by us (since we definitely 
considered cycles during the federation design), b) hasn't been reported 
before. Oh well.

Regards,

Matthias.

From dseltzer at tveyes.com  Fri Jul 20 19:43:17 2012
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Fri, 20 Jul 2012 14:43:17 -0400
Subject: [rabbitmq-discuss] Security Exception in IIS using RabbitMQ
	Client
In-Reply-To: <C5A285C7-9D90-4177-B952-8042A49534DA@rabbitmq.com>
References: <1bf0da2d77a8dde3045f42fbb98de912@mail.gmail.com>
	<9D0B20A0-D068-4BB5-89F3-161E53F96D03@rabbitmq.com>
	<C5A285C7-9D90-4177-B952-8042A49534DA@rabbitmq.com>
Message-ID: <5ccfe77e7c0675abad274e4ca06a91ce@mail.gmail.com>

Thanks for your help Tim,

It seems like this isn't an issue with actual file IO, but rather Code
Security.

I've tried setting <trust level="Full" originUrl="" /> in the web.config,
but it doesn't seem to help.

The full stacktrace is below.

-D

[SecurityException: Request for the permission of type
'System.Security.Permissions.FileIOPermission, mscorlib, Version=2.0.0.0,
Culture=neutral, PublicKeyToken=b77a5c561934e089' failed.]
   System.Security.CodeAccessSecurityEngine.Check(Object demand,
StackCrawlMark& stackMark, Boolean isPermSet) +0
   System.Security.CodeAccessPermission.Demand() +54
   System.Reflection.Assembly.VerifyCodeBaseDiscovery(String codeBase)
+162
   System.Reflection.Assembly.GetName(Boolean copiedName) +117
   RabbitMQ.Client.Impl.ConnectionBase.DefaultClientProperties() +42
   RabbitMQ.Client.ConnectionFactory..ctor() +70
   ASP.api_messagesearch_aspx.__Render__control1(HtmlTextWriter __w,
Control parameterContainer) in \\[snip]\api\MessageSearch.aspx:9
   System.Web.UI.Control.RenderChildrenInternal(HtmlTextWriter writer,
ICollection children) +115
   System.Web.UI.Page.Render(HtmlTextWriter writer) +38
   System.Web.UI.Page.ProcessRequestMain(Boolean
includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
+11070247
   System.Web.UI.Page.ProcessRequest(Boolean
includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
+11069786
   System.Web.UI.Page.ProcessRequest() +91
   System.Web.UI.Page.ProcessRequest(HttpContext context) +240
   ASP.api_messagesearch_aspx.ProcessRequest(HttpContext context) in
c:\Windows\Microsoft.NET\Framework64\v2.0.50727\Temporary ASP.NET
Files\root\cb973a2c\79ccea1e\App_Web_nkfbtca4.9.cs:0

System.Web.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionS
tep.Execute() +599
   System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&
completedSynchronously) +171

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim
Watson
Sent: Friday, July 20, 2012 2:33 PM
To: Discussions about RabbitMQ
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Security Exception in IIS using RabbitMQ
Client


http://stackoverflow.com/questions/4925331/system-security-permissions-fil
eiopermission-when-accessing-folder-outside-web-s


On 20 Jul 2012, at 19:28, Tim Watson <watson.timothy at gmail.com> wrote:

>
> On 20 Jul 2012, at 19:06, Dave Seltzer <dseltzer at tveyes.com> wrote:
>
>> I'm having a bit of trouble using the .NET RabbitMQ client in IIS,
maybe
>> someone knows what I'm running into.
>>
>> Here's the code I'm trying to run:
>>
>>   ConnectionFactory rabbitConFactory = new ConnectionFactory();
>>   rabbitConFactory.Address = "hostname";
>>   rabbitConFactory.VirtualHost = "/path";
>>   rabbitConFactory.UserName = "user";
>>   rabbitConFactory.Password = "password";
>>
>>   IConnection connection = rabbitConFactory.CreateConnection();
>>
>>   IModel channel = connection.CreateModel();
>>
>>   Dictionary<String, Object> args = new Dictionary<string, object>();
>>   args.Add("x-ha-policy", "all");
>>   String ExchangeName = "SearchInstructions";
>>   channel.ExchangeDeclare(ExchangeName, "topic", true, false, args);
>>
>>   Guid myId = new Guid();
>>   String RoutingKey = myId.ToString() + ".Instruction";
>>   IBasicProperties MessageProperties = channel.CreateBasicProperties();
>>   MessageProperties.SetPersistent(true);
>>   MessageProperties.ContentEncoding = "UTF-8";
>>   MessageProperties.ContentType = "text/xml";
>>   MessageProperties.Headers.Add("x-origin",
>> Request.ServerVariables["ServerName"]);
>>
>>   String messageContent = "<foo />";
>>   byte[] data = System.Text.Encoding.UTF8.GetBytes(messageContent);
>>   channel.BasicPublish(ExchangeName,RoutingKey, MessageProperties,
>> data);
>>
>>   channel.Close();
>>   connection.Close();
>>
>> When I run the code in an ASPX page I receive the following Security
>> Exception:
>>   Security Exception
>>
>>   Description: The application attempted to perform an operation not
>> allowed by the security policy.  To grant this application the required
>> permission please contact your system administrator or change the
>> application's trust level in the configuration file.
>>
>>   Exception Details: System.Security.SecurityException: Request for the
>> permission of type 'System.Security.Permissions.FileIOPermission,
>> mscorlib, Version=2.0.0.0, Culture=neutral,
>> PublicKeyToken=b77a5c561934e089' failed.
>>
>> I'm not really sure how to proceed. This sounds like an IIS issue, but
>> someone here must have tackled this problem before.
>>
>
> This is indeed an IIS configuration issue. You need to grant the
assembly the appropriate code access permissions. It's been a long time
since I looked at IIS, so I can't tell you exactly where to set this up
until I'm in front of a browser, but checking msdn for Code Access,
FileIOPermission, assemblies and IIS is where I'd start if you want to get
a head start. Post the list if you figure it out first please! :)
>
>> Thanks much!
>>
>> -Dave
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Michael.Laing at nytimes.com  Fri Jul 20 19:52:31 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Fri, 20 Jul 2012 14:52:31 -0400
Subject: [rabbitmq-discuss] Federation: Superfluous bindings in Exchanges
In-Reply-To: <5009A603.2020707@rabbitmq.com>
Message-ID: <CC2F2021.35FC%Michael.Laing@nytimes.com>

Thanks Matthias, 

I plan to keeping pushing on federation as it is becoming foundational to
our messaging architecture.

Thanks very much for your prompt and effective assistance!

Best regards,

Michael

On 7/20/12 2:40 PM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Michael,
>
>On 19/07/12 20:01, Laing, Michael P. wrote:
>> I have sent reports to you separately. -ml
>
>Thanks.
>
>It's a bug. Cyclic topologies leak bindings.
>
>I am amazed that this a) was missed by us (since we definitely
>considered cycles during the federation design), b) hasn't been reported
>before. Oh well.
>
>Regards,
>
>Matthias.


From eliao at seegrid.com  Fri Jul 20 20:53:55 2012
From: eliao at seegrid.com (Elizabeth Liao)
Date: Fri, 20 Jul 2012 19:53:55 +0000
Subject: [rabbitmq-discuss] changing hostnames
Message-ID: <E94F626F5C43D14F8B8479C5EBD790387453AF6B@vmexchange02.seegrid.local>

Hi,

I'm trying to change the hostname of a machine that is running rabbitmq-server without logging out but I've been unsuccessful so far.

I've tried the following sequence of commands:
1. rabbitmqctl stop
2. /etc/init.d/rabbitmq-server stop
3. Set hostname in /etc/hosts and /etc/sysconfig/network
4. Set hostname using /bin/hostname
5. /etc/init.d/rabbitmq-server start  ends up failing

The following are the contents of the startup_log file:
Activating RabbitMQ plugins ...

********************************************************************************
*WARNING* Undefined function ssl:ssl_accept/3
*WARNING* Undefined function unicode:characters_to_binary/3
********************************************************************************

4 plugins activated:
* amqp_client-2.8.2
* erlando-2.8.2
* rabbitmq_federation-2.8.2
* rabbitmq_shovel-2.8.2

ERROR: epmd error for host "OldHostname": nxdomain (non-existing domain)
------------------------
Additionally, env hostname correctly returns the the new hostname.  Is there something that needs to be restarted or is the old hostname getting cached somewhere?  Thanks

I am running rabbitmq-server-2.8.2 on FC11

Liz

From iain.hull at workday.com  Fri Jul 20 21:46:53 2012
From: iain.hull at workday.com (Iain Hull)
Date: Fri, 20 Jul 2012 21:46:53 +0100
Subject: [rabbitmq-discuss] changing hostnames
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD790387453AF6B@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD790387453AF6B@vmexchange02.seegrid.local>
Message-ID: <CANum3oVbQV4tXf344GR3rnn2cg3sYga6L6Annn10t1QY5c_b+w@mail.gmail.com>

Hi Liz,

I have just done this recently.  You also have to change the NODENAME
setting in the /etc/rabbitmq/rabbitmq-env file.

Regards,
Iain.

On 20 July 2012 20:53, Elizabeth Liao <eliao at seegrid.com> wrote:

> Hi,
>
> I'm trying to change the hostname of a machine that is running
> rabbitmq-server without logging out but I've been unsuccessful so far.
>
> I've tried the following sequence of commands:
> 1. rabbitmqctl stop
> 2. /etc/init.d/rabbitmq-server stop
> 3. Set hostname in /etc/hosts and /etc/sysconfig/network
> 4. Set hostname using /bin/hostname
> 5. /etc/init.d/rabbitmq-server start  ends up failing
>
> The following are the contents of the startup_log file:
> Activating RabbitMQ plugins ...
>
>
> ********************************************************************************
> *WARNING* Undefined function ssl:ssl_accept/3
> *WARNING* Undefined function unicode:characters_to_binary/3
>
> ********************************************************************************
>
> 4 plugins activated:
> * amqp_client-2.8.2
> * erlando-2.8.2
> * rabbitmq_federation-2.8.2
> * rabbitmq_shovel-2.8.2
>
> ERROR: epmd error for host "OldHostname": nxdomain (non-existing domain)
> ------------------------
> Additionally, env hostname correctly returns the the new hostname.  Is
> there something that needs to be restarted or is the old hostname getting
> cached somewhere?  Thanks
>
> I am running rabbitmq-server-2.8.2 on FC11
>
> Liz
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120720/bfd04a98/attachment.htm>

From watson.timothy at gmail.com  Fri Jul 20 22:56:35 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 20 Jul 2012 22:56:35 +0100
Subject: [rabbitmq-discuss] Security Exception in IIS using RabbitMQ
	Client
In-Reply-To: <5ccfe77e7c0675abad274e4ca06a91ce@mail.gmail.com>
References: <1bf0da2d77a8dde3045f42fbb98de912@mail.gmail.com>
	<9D0B20A0-D068-4BB5-89F3-161E53F96D03@rabbitmq.com>
	<C5A285C7-9D90-4177-B952-8042A49534DA@rabbitmq.com>
	<5ccfe77e7c0675abad274e4ca06a91ce@mail.gmail.com>
Message-ID: <4FF1DB3B-E711-4E36-BD47-7E5D2BF332A6@rabbitmq.com>


On 20 Jul 2012, at 19:43, Dave Seltzer <dseltzer at tveyes.com> wrote:

> Thanks for your help Tim,
> 
> It seems like this isn't an issue with actual file IO, but rather Code
> Security.
> 
> I've tried setting <trust level="Full" originUrl="" /> in the web.config,
> but it doesn't seem to help.
> 

Yes that was my first suspicion. There is a way of setting policy for your web app and for assemblies your linking to but I don't remember off-hand how to set up policies for assemblies outside the GAC. How do you reference the rabbit client assembly in your project? Is this just being done in visual studio or are there settings in the web.config? Forgive my .NET being a bit rusty these days!

> The full stacktrace is below.
> 
> -D
> 
> [SecurityException: Request for the permission of type
> 'System.Security.Permissions.FileIOPermission, mscorlib, Version=2.0.0.0,
> Culture=neutral, PublicKeyToken=b77a5c561934e089' failed.]
>   System.Security.CodeAccessSecurityEngine.Check(Object demand,
> StackCrawlMark& stackMark, Boolean isPermSet) +0
>   System.Security.CodeAccessPermission.Demand() +54
>   System.Reflection.Assembly.VerifyCodeBaseDiscovery(String codeBase)
> +162
>   System.Reflection.Assembly.GetName(Boolean copiedName) +117
>   RabbitMQ.Client.Impl.ConnectionBase.DefaultClientProperties() +42
>   RabbitMQ.Client.ConnectionFactory..ctor() +70
>   ASP.api_messagesearch_aspx.__Render__control1(HtmlTextWriter __w,
> Control parameterContainer) in \\[snip]\api\MessageSearch.aspx:9
>   System.Web.UI.Control.RenderChildrenInternal(HtmlTextWriter writer,
> ICollection children) +115
>   System.Web.UI.Page.Render(HtmlTextWriter writer) +38
>   System.Web.UI.Page.ProcessRequestMain(Boolean
> includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
> +11070247
>   System.Web.UI.Page.ProcessRequest(Boolean
> includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
> +11069786
>   System.Web.UI.Page.ProcessRequest() +91
>   System.Web.UI.Page.ProcessRequest(HttpContext context) +240
>   ASP.api_messagesearch_aspx.ProcessRequest(HttpContext context) in
> c:\Windows\Microsoft.NET\Framework64\v2.0.50727\Temporary ASP.NET
> Files\root\cb973a2c\79ccea1e\App_Web_nkfbtca4.9.cs:0
> 
> System.Web.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionS
> tep.Execute() +599
>   System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&
> completedSynchronously) +171
> 
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim
> Watson
> Sent: Friday, July 20, 2012 2:33 PM
> To: Discussions about RabbitMQ
> Cc: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Security Exception in IIS using RabbitMQ
> Client
> 
> 
> http://stackoverflow.com/questions/4925331/system-security-permissions-fil
> eiopermission-when-accessing-folder-outside-web-s
> 
> 
> On 20 Jul 2012, at 19:28, Tim Watson <watson.timothy at gmail.com> wrote:
> 
>> 
>> On 20 Jul 2012, at 19:06, Dave Seltzer <dseltzer at tveyes.com> wrote:
>> 
>>> I'm having a bit of trouble using the .NET RabbitMQ client in IIS,
> maybe
>>> someone knows what I'm running into.
>>> 
>>> Here's the code I'm trying to run:
>>> 
>>>  ConnectionFactory rabbitConFactory = new ConnectionFactory();
>>>  rabbitConFactory.Address = "hostname";
>>>  rabbitConFactory.VirtualHost = "/path";
>>>  rabbitConFactory.UserName = "user";
>>>  rabbitConFactory.Password = "password";
>>> 
>>>  IConnection connection = rabbitConFactory.CreateConnection();
>>> 
>>>  IModel channel = connection.CreateModel();
>>> 
>>>  Dictionary<String, Object> args = new Dictionary<string, object>();
>>>  args.Add("x-ha-policy", "all");
>>>  String ExchangeName = "SearchInstructions";
>>>  channel.ExchangeDeclare(ExchangeName, "topic", true, false, args);
>>> 
>>>  Guid myId = new Guid();
>>>  String RoutingKey = myId.ToString() + ".Instruction";
>>>  IBasicProperties MessageProperties = channel.CreateBasicProperties();
>>>  MessageProperties.SetPersistent(true);
>>>  MessageProperties.ContentEncoding = "UTF-8";
>>>  MessageProperties.ContentType = "text/xml";
>>>  MessageProperties.Headers.Add("x-origin",
>>> Request.ServerVariables["ServerName"]);
>>> 
>>>  String messageContent = "<foo />";
>>>  byte[] data = System.Text.Encoding.UTF8.GetBytes(messageContent);
>>>  channel.BasicPublish(ExchangeName,RoutingKey, MessageProperties,
>>> data);
>>> 
>>>  channel.Close();
>>>  connection.Close();
>>> 
>>> When I run the code in an ASPX page I receive the following Security
>>> Exception:
>>>  Security Exception
>>> 
>>>  Description: The application attempted to perform an operation not
>>> allowed by the security policy.  To grant this application the required
>>> permission please contact your system administrator or change the
>>> application's trust level in the configuration file.
>>> 
>>>  Exception Details: System.Security.SecurityException: Request for the
>>> permission of type 'System.Security.Permissions.FileIOPermission,
>>> mscorlib, Version=2.0.0.0, Culture=neutral,
>>> PublicKeyToken=b77a5c561934e089' failed.
>>> 
>>> I'm not really sure how to proceed. This sounds like an IIS issue, but
>>> someone here must have tackled this problem before.
>>> 
>> 
>> This is indeed an IIS configuration issue. You need to grant the
> assembly the appropriate code access permissions. It's been a long time
> since I looked at IIS, so I can't tell you exactly where to set this up
> until I'm in front of a browser, but checking msdn for Code Access,
> FileIOPermission, assemblies and IIS is where I'd start if you want to get
> a head start. Post the list if you figure it out first please! :)
>> 
>>> Thanks much!
>>> 
>>> -Dave
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From joao.paul at braganca.name  Fri Jul 20 22:57:24 2012
From: joao.paul at braganca.name (=?ISO-8859-1?Q?Jo=E3o_Bragan=E7a?=)
Date: Fri, 20 Jul 2012 14:57:24 -0700
Subject: [rabbitmq-discuss] LA & RabbitMQ
In-Reply-To: <CAHZAEpfHQF0bNuipEupQd6u4h5aRq5C=KLvO=2dtewV+LTxbmA@mail.gmail.com>
References: <CAHZAEpfHQF0bNuipEupQd6u4h5aRq5C=KLvO=2dtewV+LTxbmA@mail.gmail.com>
Message-ID: <CACxseT4FeUWh9DDdmojsBTFbyAr2mcGjNJTYX+ygC4-4R7+qPg@mail.gmail.com>

I live in LA, I like beer and I've used rabbitmq in production once. I'm down!

On Tue, Jul 17, 2012 at 1:48 PM, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
> Anyone in the LA area interested in grabbing some beers and talking
> about RabbitMQ?  I'd be happy to take the mantle of setting it up.
>
> -J
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jasonjwwilliams at gmail.com  Fri Jul 20 23:00:35 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 20 Jul 2012 15:00:35 -0700
Subject: [rabbitmq-discuss] LA & RabbitMQ
In-Reply-To: <CACxseT4FeUWh9DDdmojsBTFbyAr2mcGjNJTYX+ygC4-4R7+qPg@mail.gmail.com>
References: <CAHZAEpfHQF0bNuipEupQd6u4h5aRq5C=KLvO=2dtewV+LTxbmA@mail.gmail.com>
	<CACxseT4FeUWh9DDdmojsBTFbyAr2mcGjNJTYX+ygC4-4R7+qPg@mail.gmail.com>
Message-ID: <CAHZAEpf=fmJc1L+ocUrCqM=H-JB4nhfFw4gqOaR67zKM-nFwsw@mail.gmail.com>

Awesome that's two! I'll email you off list.

-J

On Fri, Jul 20, 2012 at 2:57 PM, Jo?o Bragan?a <joao.paul at braganca.name> wrote:
> I live in LA, I like beer and I've used rabbitmq in production once. I'm down!
>
> On Tue, Jul 17, 2012 at 1:48 PM, Jason J. W. Williams
> <jasonjwwilliams at gmail.com> wrote:
>> Anyone in the LA area interested in grabbing some beers and talking
>> about RabbitMQ?  I'd be happy to take the mantle of setting it up.
>>
>> -J
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tim at rabbitmq.com  Fri Jul 20 23:39:46 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 20 Jul 2012 23:39:46 +0100
Subject: [rabbitmq-discuss] Security Exception in IIS using RabbitMQ
	Client
In-Reply-To: <4FF1DB3B-E711-4E36-BD47-7E5D2BF332A6@rabbitmq.com>
References: <1bf0da2d77a8dde3045f42fbb98de912@mail.gmail.com>
	<9D0B20A0-D068-4BB5-89F3-161E53F96D03@rabbitmq.com>
	<C5A285C7-9D90-4177-B952-8042A49534DA@rabbitmq.com>
	<5ccfe77e7c0675abad274e4ca06a91ce@mail.gmail.com>
	<4FF1DB3B-E711-4E36-BD47-7E5D2BF332A6@rabbitmq.com>
Message-ID: <CE935BAB-1E50-4A86-8365-7629CFF533AF@rabbitmq.com>


On 20 Jul 2012, at 22:56, Tim Watson wrote:

> 
> On 20 Jul 2012, at 19:43, Dave Seltzer <dseltzer at tveyes.com> wrote:
> 
>> Thanks for your help Tim,
>> 
>> It seems like this isn't an issue with actual file IO, but rather Code
>> Security.
>> 
>> I've tried setting <trust level="Full" originUrl="" /> in the web.config,
>> but it doesn't seem to help.
>> 
> 

Ok so according to msdn, FULL is the default level anyway, but these are only partially trusted app domains. Hmn, this will require a bit more configuration I think.

Two things to bare in mind. Firstly, you don't need to set the originUrl to "" and secondly, just setting the appilcation's trust level may not be enough if the server or .NET framework installation have settings (on the host machine) overriding this. I'm assuming you're using ASP.NET 4, which seems to have a slightly different interpretation of the trust level(s) than I remember. Certainly though the central IIS configuration can refuse to give applications (lower down) Full trust, so you need to check with the IIS admin (unless that's you, in which case consult MSDN to figure out where this would be configured).  

Normally I'd also suggest setting a FileIOPermission attribute around the handler that's failing (or inserting a CAS assertion in the code) but I'm still a little unclear what's going on here. My reading of the situation is that as the connection factory instance is initialising, it accesses the DefaultClientProperties property in ConnectionBase, which in turn introspects the assembly itself using reflection. Incidentally, this might be a bit gratuitous, and should certainly assert its own CAS demands - I will file a bug for that. 

Nonetheless, this shouldn't actually prevent you from using the assembly in an ASP.NET application. Interestingly, I would've expected to see a CAS demand for ReflectionPermission (or whatever it's called) rather than FileIOPermission! Please check a few things

- Is the assembly in the GAC? That might not be the panacea it ought to be and a local reference in the bin directory of your webapp might be preferable.
- Is this failing for you locally or only on a remote IIS that you're working with? If you have control over the IIS server, make sure Full trust is available everywhere or at least can be overridden by applications

If you have put the client assembly in the GAC then the calls to Assembly.GetName (that are made in ConnectionBase) will demand FileIOPermission, so that's one to bare in mind.

From matwey.kornilov at gmail.com  Sat Jul 21 07:29:40 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Sat, 21 Jul 2012 10:29:40 +0400
Subject: [rabbitmq-discuss] JSON-RPC plugin crash
References: <ju3bap$cat$1@dough.gmane.org> <50056DEF.6070005@rabbitmq.com>
	<5005729E.7020400@rabbitmq.com>
Message-ID: <judi8l$bse$1@dough.gmane.org>


Hi,

Looks nice. I am failed to make it running too :(
This is web-stomp stuff from from hg.rabbitmq.com and rabbitmq-server 2.8.4:


=CRASH REPORT==== 21-Jul-2012::10:16:10 ===
  crasher:
    initial call: rabbit_ws_client:init/1
    pid: <0.577.0>
    registered_name: []
    exception exit: {{case_clause,
                         {{case_clause,
                              {more,
                                  {resume,
                                      #Fun<rabbit_stomp_frame.0.106916106>},
                                  0}},
                          [{rabbit_ws_client,process_received_bytes,3,
                               [{file,
                                    "rabbitmq-web-
stomp/src/rabbit_ws_client.erl"},
                                {line,88}]},
                           {rabbit_ws_client,handle_cast,2,
                               [{file,
                                    "rabbitmq-web-
stomp/src/rabbit_ws_client.erl"},
                                {line,50}]},
                           {gen_server,handle_msg,5,
                               [{file,"gen_server.erl"},{line,607}]},
                           {proc_lib,init_p_do_apply,3,
                               [{file,"proc_lib.erl"},{line,227}]}]}},
                     [{rabbit_ws_client,terminate,2,
                          [{file,
                               "rabbitmq-web-
stomp/src/rabbit_ws_client.erl"},
                           {line,73}]},
                      {gen_server,terminate,6,
                          [{file,"gen_server.erl"},{line,722}]},
                      {proc_lib,init_p_do_apply,3,
                          [{file,"proc_lib.erl"},{line,227}]}]}
      in function  gen_server:terminate/6 (gen_server.erl, line 725)
    ancestors: [<0.575.0>,rabbit_ws_sup,<0.217.0>]
    messages: []
    links: [<0.575.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 987
    stack_size: 24
    reductions: 261
  neighbours:


Matthias Radestock wrote:
> However, I strongly recommend looking at
> http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/
> as an alternative to the rabbitmq-jsonrpc-channel plug-in.



From wizaerd at gmail.com  Fri Jul 20 22:07:17 2012
From: wizaerd at gmail.com (Wizaerd)
Date: Fri, 20 Jul 2012 14:07:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Looking for some specific & complete C# examples
Message-ID: <0fa4a463-7dfc-45f5-8772-3b680cb0e53a@googlegroups.com>

It's great that you guys (RabbitMQ) have the tutorials for Python and Java, 
but I'm looking for some complete examples for C#, specifically synchronous 
request-reply and asynchronous re-quest-reply message patterns.  I've been 
searching the net for a while now, and keep seeing examples for EasyNetQ 
(which I am not too interested in using (plus the documentation is fairly 
poor for, it's only documents snippets, but no complete samples).  I was 
able to put together a simple pusher app, that publishes messages to an 
exchange, and a puller component that successfully pulls those messages, 
and it was fairly simple to use, but has little to no relevance to the real 
world.

So where could I get some good examples of request-reply patterns, both 
synchronous and asynchronous?  Something that's actually versbose in it's 
explanations as opposed to something that just shows a snippet or two of 
code?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120720/275e47c9/attachment.htm>

From fmeshkinpour at fonality.com  Sat Jul 21 02:26:46 2012
From: fmeshkinpour at fonality.com (Farshad Meshkinpour)
Date: Fri, 20 Jul 2012 18:26:46 -0700
Subject: [rabbitmq-discuss] rabbitmqctl stop_app start_app loses all messages
Message-ID: <CAO4q6_8LY68cUxx4RQKj8KSgGP+aOT0x=Wdsm3-i_vQED3hK6w@mail.gmail.com>

Hi,
I have a two node cluster (RMQ 2.8.2 Erlang R14B03) and testing HA for
production release. Both nodes configured as disc in the cluster. I have
several mirrored queues.  All queues are durable and auto delete off.
 Messages are posted with delivery_mode 2 (persistent).  I publish some
messages (less than 100).  I see all my messages in the queues via the
management GUI.

I run rabbitmqctl stop_app on node1.
The  /var/lib/rabbitmq/mnesia/rabbit at rmq1-test/msg_store_persistent before
stop_app is:
-rw-r--r-- 1 rabbitmq rabbitmq 472724 Jul 20 15:09 0.rdq

After the stop_app:
-rw-r--r-- 1 rabbitmq rabbitmq 472724 Jul 20 15:09 0.rdq
-rw-r--r-- 1 rabbitmq rabbitmq   1664 Jul 20 15:15 clean.dot
-rw-r--r-- 1 rabbitmq rabbitmq    474 Jul 20 15:15 file_summary.ets
-rw-r--r-- 1 rabbitmq rabbitmq  48953 Jul 20 15:15 msg_store_index.ets

Then I run rabbitmqctl start_app (without publishing any message) and
msg_store_persistent is cleared.

-rw-r--r-- 1 rabbitmq rabbitmq 0 Jul 20 15:16 0.rdq

After I do app_stop&app_start on node1  all my queues become unsynchronised
(without publishing any new msgs).  The management interfaces says all msgs
are only on node2 only.
If I go through the same sequence of app_stop&app_start on node2, then all
msgs are lost!

Note, I get the same result if use /etc/init.d/rabbitmq-server start/stop.

Could someone let me know what might be wrong with my configuration or what
I am doing wrong?


Thanks,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120720/c9759d0a/attachment.htm>

From emile at rabbitmq.com  Sat Jul 21 09:45:49 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Sat, 21 Jul 2012 09:45:49 +0100
Subject: [rabbitmq-discuss] Looking for some specific & complete C#
	examples
In-Reply-To: <0fa4a463-7dfc-45f5-8772-3b680cb0e53a@googlegroups.com>
References: <0fa4a463-7dfc-45f5-8772-3b680cb0e53a@googlegroups.com>
Message-ID: <500A6C3D.3090902@rabbitmq.com>

Hi,

On 20/07/12 22:07, Wizaerd wrote:
> It's great that you guys (RabbitMQ) have the tutorials for Python and
> Java, but I'm looking for some complete examples for C#, specifically
> synchronous request-reply and asynchronous re-quest-reply message
> patterns.

Have you looked at the C? tutorial examples?
https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/dotnet

You will also find some examples in the RabbitMQ C? library sources
http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/projects/examples/client

Also look at the .NET section of the developer tools webpage:
http://www.rabbitmq.com/devtools.html#dotnet-dev


-Emile



From emile at rabbitmq.com  Sat Jul 21 10:11:00 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Sat, 21 Jul 2012 10:11:00 +0100
Subject: [rabbitmq-discuss] Build deb package including plugins
In-Reply-To: <CACDZx9gw9NG4yHPMTDsrNn8Nvd5ZDSUs-7dq77iJk6SuJ++ang@mail.gmail.com>
References: <CACDZx9j=r-nNz=KC5HKYmjgvOt3h7TEBLR=pVHjs969XOhVT-w@mail.gmail.com>
	<50092BCB.4040102@rabbitmq.com>
	<CACDZx9gw9NG4yHPMTDsrNn8Nvd5ZDSUs-7dq77iJk6SuJ++ang@mail.gmail.com>
Message-ID: <500A7224.9030908@rabbitmq.com>

Hi,

On 20/07/12 18:11, Clemens Kolbitsch wrote:
> Wait, just to make sure, so I cannot build the deb package from
> umbrella alone? That seemed to have worked fine in the past.

The umbrella, and all the sub-repositories contained within are sufficient.

> I'm sorry, but I completely cannot follow. What/where is the
> "plugins-src" directory?

This contains the sources for all the plugins. The instructions will
make more sense if you look at the Debian source, which also contains a
plugins-src directory. The instructions re-constitute a Debian source
directory, but with the latest sources from mercurial.


-Emile




From matthias at rabbitmq.com  Sat Jul 21 10:27:37 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 21 Jul 2012 10:27:37 +0100
Subject: [rabbitmq-discuss] JSON-RPC plugin crash
In-Reply-To: <judi8l$bse$1@dough.gmane.org>
References: <ju3bap$cat$1@dough.gmane.org> <50056DEF.6070005@rabbitmq.com>
	<5005729E.7020400@rabbitmq.com> <judi8l$bse$1@dough.gmane.org>
Message-ID: <500A7609.5090102@rabbitmq.com>

On 21/07/12 07:29, Matwey V. Kornilov wrote:
> Looks nice. I am failed to make it running too :(
> This is web-stomp stuff from from hg.rabbitmq.com and rabbitmq-server 2.8.4:

Don't use the version from hg; that will only work with rabbit from hg.

Instead deploy the "binary" web-stomp plugin packages we released for 
2.8.2, as show in the web-stomp article. These should work with the 
2.8.4 broker, though I don't remember whether we tested that. If they 
don't then you'll need to install the 2.8.2 broker.

Matthias.

From emamdouh at cloud9ers.com  Sat Jul 21 23:52:03 2012
From: emamdouh at cloud9ers.com (Eslam Mamdouh El Husseiny)
Date: Sun, 22 Jul 2012 00:52:03 +0200
Subject: [rabbitmq-discuss] can't start rabbitmq-server
In-Reply-To: <5008057F.9060003@rabbitmq.com>
References: <CAHAaT5uQ+zhaCO1qFLxP-kZyYXMRav=Tp3wHYFvej2TiDwA4fw@mail.gmail.com>
	<5008057F.9060003@rabbitmq.com>
Message-ID: <CAHAaT5uB+jkP165sMdsXAF4OEzoa-iDZ1tiTNJ0ay-9kUHWrcQ@mail.gmail.com>

btw normal user can start rabbitmq-server ,moreover when i'm trying to
start rabbitmq-server using root, the same error appears except that line

> Only root or rabbitmq should run rabbitmq-server


any ideas ?

Thanks

On Thu, Jul 19, 2012 at 3:02 PM, Tim Watson <tim at rabbitmq.com> wrote:

>  On 07/19/2012 02:01 PM, Eslam Mamdouh El Husseiny wrote:
>
> hi,
> i have a mysterious problem with rabbitmq "2.7.1-0ubuntu4"
> sometimes it refuses to start and come out with this error message :
>
>> melzalabany at Ubuntu-11:web_tier$  rabbitmq-server
>> Only root or rabbitmq should run rabbitmq-server
>>
>
>
> That looks like the reason there: 'only root or rabbitmq should run
> rabbitmq-server'.....
>
>
>  and i resolve this error with restarting system
>
>
> Not sure how this helps, but perhaps I'm missing something?
>
>
>  So i'd like to know if there is a reason for this error and how to avoid
> this problem without rebooting machine
>
>
> Does this happen if you try and start the server the correct user?
>



-- 
Best Regards,
Eslam Mamdouh El Husseiny
*Systems Administrator**
Cloud Niners Ltd.

*
*Cellular: (+2) 011 198 40 40
Mansoura: (+2) 050 234 70 81
Cairo:    (+2) 022 *268 34 60
Fax:      (+2) 022 268 34 63
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120722/32e6cbc7/attachment.htm>

From jaugenstine at gmail.com  Sun Jul 22 06:43:50 2012
From: jaugenstine at gmail.com (jonathan augenstine)
Date: Sat, 21 Jul 2012 22:43:50 -0700
Subject: [rabbitmq-discuss] LA & RabbitMQ
In-Reply-To: <CAHZAEpf=fmJc1L+ocUrCqM=H-JB4nhfFw4gqOaR67zKM-nFwsw@mail.gmail.com>
References: <CAHZAEpfHQF0bNuipEupQd6u4h5aRq5C=KLvO=2dtewV+LTxbmA@mail.gmail.com>
	<CACxseT4FeUWh9DDdmojsBTFbyAr2mcGjNJTYX+ygC4-4R7+qPg@mail.gmail.com>
	<CAHZAEpf=fmJc1L+ocUrCqM=H-JB4nhfFw4gqOaR67zKM-nFwsw@mail.gmail.com>
Message-ID: <CAAq2U1AWk0aru-QF2H+cR8aiX=ZeVWmuSuDpPACqDLxTZAxH3g@mail.gmail.com>

I live near LA also and would be interested in meeting up to discuss
RabbitMQ.

Jonathan

On Fri, Jul 20, 2012 at 3:00 PM, Jason J. W. Williams <
jasonjwwilliams at gmail.com> wrote:

> Awesome that's two! I'll email you off list.
>
> -J
>
> On Fri, Jul 20, 2012 at 2:57 PM, Jo?o Bragan?a <joao.paul at braganca.name>
> wrote:
> > I live in LA, I like beer and I've used rabbitmq in production once. I'm
> down!
> >
> > On Tue, Jul 17, 2012 at 1:48 PM, Jason J. W. Williams
> > <jasonjwwilliams at gmail.com> wrote:
> >> Anyone in the LA area interested in grabbing some beers and talking
> >> about RabbitMQ?  I'd be happy to take the mantle of setting it up.
> >>
> >> -J
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120721/b9e764f8/attachment.htm>

From erik.pragt at jworks.nl  Sun Jul 22 03:52:46 2012
From: erik.pragt at jworks.nl (erikpragt)
Date: Sat, 21 Jul 2012 19:52:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Cannot send message to RabbitMQ
Message-ID: <1342925566965-20977.post@n5.nabble.com>

Hello all,

I'm trying a trivial RabbitMQ example, and everything works (eg, I can
receive messages using Spring/Java), plus I can send messages using the
RabbitMQ cli and web interface. The only thing which doesn't work is sending
messages using the Java client, and it's driving me nuts :-)

Anyone any idea what I'm missing here? I've attached a sample project below.

Thanks,

Erik

http://rabbitmq.1065348.n5.nabble.com/file/n20977/epub-organizer-amqp-rabbitmq.zip
epub-organizer-amqp-rabbitmq.zip 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cannot-send-message-to-RabbitMQ-tp20977.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From od.ravani at gmail.com  Sun Jul 22 05:29:52 2012
From: od.ravani at gmail.com (thesilentman)
Date: Sat, 21 Jul 2012 21:29:52 -0700 (PDT)
Subject: [rabbitmq-discuss] active-active implementation in php
In-Reply-To: <59F27BFB-A3BB-48A8-B139-E6EA7A82E32E@gmail.com>
References: <CAG=PQNMCf60_QrTZS3-tCHxBzrmAzXrLLGGz8A2mE6tmQ0HRyg@mail.gmail.com>
	<4F0317FE.2050802@rabbitmq.com>
	<CAMcAHLWt7XnCBu7q4sA2PQNQ_xAx8gHMg2rWqgVH5-RWo4Pw-A@mail.gmail.com>
	<CAOvN6FCu7dWWCSPqnfWu5OgZBGMm-nq-UWhVtn-rWEd9+1RPhQ@mail.gmail.com>
	<59F27BFB-A3BB-48A8-B139-E6EA7A82E32E@gmail.com>
Message-ID: <ef43492b-92a0-4a7c-923a-780457d5dff4@googlegroups.com>

Hello Alvaro,

did you find time to test this? I am evaluating rabbitmq for a php project 
and need to know what lib I can use?

Thanks,
Frank


On Tuesday, January 3, 2012 11:00:22 PM UTC+2, Alvaro Videla wrote:
>
> Hi Robin,
>
> The library implements the basic.cancel method but I haven't tested this 
> yet.
>
> I think I will try to set up a Demo and implement any missing features in 
> case they are needed.
>
> Alvaro
>
> On Jan 3, 2012, at 9:03 PM, Robin Harvey wrote:
>
> Alvaro - does php-amqplib support incoming consumer cancels?
>
>
> Out of interest, how does the client know where to re-connect to when a 
> queue fails (i.e. which slave got promoted)?  I've seen the following 
> (here: http://www.rabbitmq.com/ha.html):
>
> > Clients that were consuming from the mirrored-queue and support our Consumer 
> Cancellation Notifications<http://www.rabbitmq.com/extensions.html#consumer-cancel-notify>extension will receive a notification that their subscription to the 
> mirrored-queue has been abruptly cancelled. At this point they should 
> re-consume from the queue, which will pick up the new master
>
> ...but this doesn't give much detail.  Are the reconnection parameters in 
> the consumer.cancel method?
>
>
> Thanks,
> --Robin
>
> On 3 January 2012 15:07, Alvaro Videla <videlalvaro at gmail.com> wrote:
>
>> Hi,
>>
>> Yes? it should support the arguments parameter. 
>>
>> BTW? I recommend that you use this version of the library: 
>> https://github.com/videlalvaro/php-amqplib for the reasons stated here: 
>> http://videlalvaro.github.com/2011/11/php-amqplib-future.html
>>
>> Regards,
>>
>> Alvaro
>>
>>
>> On Tue, Jan 3, 2012 at 4:00 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>>
>>> Hi Dhaneesh,
>>>
>>> On 30/12/11 04:25, Dhaneesh Radhakrishnan wrote:
>>> > Hi
>>> >
>>> >  Is it possible to  implement Mirrored Queue ( active-active )using
>>> > php-ampliqb  for
>>> > HA
>>>
>>> Judging by the queue_declare() function, php-amqplib does support
>>> arguments, so it is possible to make use of mirrored queues using this
>>> library.
>>>
>>> See http://www.rabbitmq.com/ha.html for details on how to set the
>>> "x-ha-policy" argument.
>>>
>>>
>>>
>>> -Emile
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> Sent form my Nokia 1100
>
>
>  
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120721/6b22b348/attachment.htm>

From harvey.robin at gmail.com  Sun Jul 22 12:36:21 2012
From: harvey.robin at gmail.com (Robin Harvey)
Date: Sun, 22 Jul 2012 12:36:21 +0100
Subject: [rabbitmq-discuss] active-active implementation in php
In-Reply-To: <ef43492b-92a0-4a7c-923a-780457d5dff4@googlegroups.com>
References: <CAG=PQNMCf60_QrTZS3-tCHxBzrmAzXrLLGGz8A2mE6tmQ0HRyg@mail.gmail.com>
	<4F0317FE.2050802@rabbitmq.com>
	<CAMcAHLWt7XnCBu7q4sA2PQNQ_xAx8gHMg2rWqgVH5-RWo4Pw-A@mail.gmail.com>
	<CAOvN6FCu7dWWCSPqnfWu5OgZBGMm-nq-UWhVtn-rWEd9+1RPhQ@mail.gmail.com>
	<59F27BFB-A3BB-48A8-B139-E6EA7A82E32E@gmail.com>
	<ef43492b-92a0-4a7c-923a-780457d5dff4@googlegroups.com>
Message-ID: <CAOvN6FAUT+dOd034VfCWqPbCY=B=P-YCSZUWMTGuHst-bR6xQQ@mail.gmail.com>

Hello Frank,

I'll reply on behalf of my Amqp bindings, Amqphp.

Amqphp doesn't support active-active "out of the box", but there is support
for incoming consumer.cancel messages, which AFAIK is one of
the prerequisites for AA.  I'm still unsure how this feature is implemented
in Rabbit, as per my question further up this thread:

Out of interest, how does the client know where to re-connect to when a
> queue fails (i.e. which slave got promoted)?  I've seen the following
> (here: http://www.rabbitmq.com/ha.html):
> > Clients that were consuming from the mirrored-queue and support our
> Consumer Cancellation Notifications extension will receive a notification
> that their subscription to the mirrored-queue has been abruptly cancelled.
> At this point they should re-consume from the queue, which will pick up the
> new master
> ...but this doesn't give much detail.  Are the reconnection parameters in
> the consumer.cancel method?



I must admit that there hasn't been much interest for AA in Amqphp, so I've
left it for now (as I'm working on a new project!).  If people are now
becoming interested in this I would happily look in to what's involved in
setting this up.


Thanks,
--Robin

On 22 July 2012 05:29, thesilentman <od.ravani at gmail.com> wrote:

> Hello Alvaro,
>
> did you find time to test this? I am evaluating rabbitmq for a php project
> and need to know what lib I can use?
>
> Thanks,
> Frank
>
>
> On Tuesday, January 3, 2012 11:00:22 PM UTC+2, Alvaro Videla wrote:
>>
>> Hi Robin,
>>
>> The library implements the basic.cancel method but I haven't tested this
>> yet.
>>
>> I think I will try to set up a Demo and implement any missing features in
>> case they are needed.
>>
>> Alvaro
>>
>> On Jan 3, 2012, at 9:03 PM, Robin Harvey wrote:
>>
>> Alvaro - does php-amqplib support incoming consumer cancels?
>>
>>
>> Out of interest, how does the client know where to re-connect to when a
>> queue fails (i.e. which slave got promoted)?  I've seen the following
>> (here: http://www.rabbitmq.com/ha.**html<http://www.rabbitmq.com/ha.html>
>> ):
>>
>> > Clients that were consuming from the mirrored-queue and support our Consumer
>> Cancellation Notifications<http://www.rabbitmq.com/extensions.html#consumer-cancel-notify>extension will receive a notification that their subscription to the
>> mirrored-queue has been abruptly cancelled. At this point they should
>> re-consume from the queue, which will pick up the new master
>>
>> ...but this doesn't give much detail.  Are the reconnection parameters in
>> the consumer.cancel method?
>>
>>
>> Thanks,
>> --Robin
>>
>> On 3 January 2012 15:07, Alvaro Videla <videlalvaro at gmail.com> wrote:
>>
>>> Hi,
>>>
>>> Yes? it should support the arguments parameter.
>>>
>>> BTW? I recommend that you use this version of the library:
>>> https://github.com/**videlalvaro/php-amqplib<https://github.com/videlalvaro/php-amqplib>for the reasons stated here:
>>> http://videlalvaro.**github.com/2011/11/php-**amqplib-future.html<http://videlalvaro.github.com/2011/11/php-amqplib-future.html>
>>>
>>> Regards,
>>>
>>> Alvaro
>>>
>>>
>>> On Tue, Jan 3, 2012 at 4:00 PM, Emile Joubert <emile at rabbitmq.com>wrote:
>>>
>>>> Hi Dhaneesh,
>>>>
>>>> On 30/12/11 04:25, Dhaneesh Radhakrishnan wrote:
>>>> > Hi
>>>> >
>>>> >  Is it possible to  implement Mirrored Queue ( active-active )using
>>>> > php-ampliqb  for
>>>> > HA
>>>>
>>>> Judging by the queue_declare() function, php-amqplib does support
>>>> arguments, so it is possible to make use of mirrored queues using this
>>>> library.
>>>>
>>>> See http://www.rabbitmq.com/ha.**html <http://www.rabbitmq.com/ha.html>for details on how to set the
>>>> "x-ha-policy" argument.
>>>>
>>>>
>>>>
>>>> -Emile
>>>> ______________________________**_________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>>>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>>>
>>>
>>>
>>> ______________________________**_________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>>
>>>
>>
>> Sent form my Nokia 1100
>>
>>
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120722/e5347482/attachment.htm>

From videlalvaro at gmail.com  Sun Jul 22 12:41:55 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 22 Jul 2012 13:41:55 +0200
Subject: [rabbitmq-discuss] active-active implementation in php
In-Reply-To: <ef43492b-92a0-4a7c-923a-780457d5dff4@googlegroups.com>
References: <CAG=PQNMCf60_QrTZS3-tCHxBzrmAzXrLLGGz8A2mE6tmQ0HRyg@mail.gmail.com>
	<4F0317FE.2050802@rabbitmq.com>
	<CAMcAHLWt7XnCBu7q4sA2PQNQ_xAx8gHMg2rWqgVH5-RWo4Pw-A@mail.gmail.com>
	<CAOvN6FCu7dWWCSPqnfWu5OgZBGMm-nq-UWhVtn-rWEd9+1RPhQ@mail.gmail.com>
	<59F27BFB-A3BB-48A8-B139-E6EA7A82E32E@gmail.com>
	<ef43492b-92a0-4a7c-923a-780457d5dff4@googlegroups.com>
Message-ID: <086DFC60-0A54-4133-9267-44D4D6E04D6D@gmail.com>

Hi,

I haven't done any work into php-amqplib regarding the HA features supported by RabbitMQ. As far as I remember you can declare queues with extra arguments and so on, but that is as far as it went.

-Alvaro

On Jul 22, 2012, at 6:29 AM, thesilentman wrote:

> Hello Alvaro,
> 
> did you find time to test this? I am evaluating rabbitmq for a php project and need to know what lib I can use?
> 
> Thanks,
> Frank
> 
> 
> On Tuesday, January 3, 2012 11:00:22 PM UTC+2, Alvaro Videla wrote:
> Hi Robin,
> 
> The library implements the basic.cancel method but I haven't tested this yet.
> 
> I think I will try to set up a Demo and implement any missing features in case they are needed.
> 
> Alvaro
> 
> On Jan 3, 2012, at 9:03 PM, Robin Harvey wrote:
> 
>> Alvaro - does php-amqplib support incoming consumer cancels?
>> 
>> 
>> Out of interest, how does the client know where to re-connect to when a queue fails (i.e. which slave got promoted)?  I've seen the following (here: http://www.rabbitmq.com/ha.html):
>> 
>> > Clients that were consuming from the mirrored-queue and support our Consumer Cancellation Notifications extension will receive a notification that their subscription to the mirrored-queue has been abruptly cancelled. At this point they should re-consume from the queue, which will pick up the new master
>> 
>> ...but this doesn't give much detail.  Are the reconnection parameters in the consumer.cancel method?
>> 
>> 
>> Thanks,
>> --Robin
>> 
>> On 3 January 2012 15:07, Alvaro Videla <videlalvaro at gmail.com> wrote:
>> Hi,
>> 
>> Yes? it should support the arguments parameter. 
>> 
>> BTW? I recommend that you use this version of the library: https://github.com/videlalvaro/php-amqplib for the reasons stated here: http://videlalvaro.github.com/2011/11/php-amqplib-future.html
>> 
>> Regards,
>> 
>> Alvaro
>> 
>> 
>> On Tue, Jan 3, 2012 at 4:00 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>> Hi Dhaneesh,
>> 
>> On 30/12/11 04:25, Dhaneesh Radhakrishnan wrote:
>> > Hi
>> >
>> >  Is it possible to  implement Mirrored Queue ( active-active )using
>> > php-ampliqb  for
>> > HA
>> 
>> Judging by the queue_declare() function, php-amqplib does support
>> arguments, so it is possible to make use of mirrored queues using this
>> library.
>> 
>> See http://www.rabbitmq.com/ha.html for details on how to set the
>> "x-ha-policy" argument.
>> 
>> 
>> 
>> -Emile
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> Sent form my Nokia 1100
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120722/bdcfcdbd/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120722/bdcfcdbd/attachment.pgp>

From praveena at cumulations.com  Sun Jul 22 18:46:10 2012
From: praveena at cumulations.com (Praveena Kumara)
Date: Sun, 22 Jul 2012 10:46:10 -0700 (PDT)
Subject: [rabbitmq-discuss] Simple Sender and Receiver in java
Message-ID: <bf61ff53-516a-42b5-8756-f98e89b20715@googlegroups.com>

hi 

 
  I am trying to understand the RabitMq server with a sender and a receiver 
program. Now the entire setup works well when the sender sends a single 
message and the same would be received by the receiver.

however when i send two messages( by running sender twice) and run the 
receiver program twice i get only the first message. 

Sender

  ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("localhost");
        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();


        channel.queueDeclare(QUEUE_NAME, true, false, false, null);
        String message = "He12!";
        channel.basicPublish("", QUEUE_NAME, null, message.getBytes());
        System.out.println("Sent "+message);
        channel.close();
        connection.close();

Receiver

    ConnectionFactory factory = new ConnectionFactory();
    factory.setHost("localhost");
    Connection connection = factory.newConnection();
    Channel channel = connection.createChannel();

    channel.queueDeclare(QUEUE_NAME, true, false, false, null);

    QueueingConsumer consumer = new QueueingConsumer(channel);
    channel.basicConsume(QUEUE_NAME, true, consumer);
    QueueingConsumer.Delivery delivery = consumer.nextDelivery();
   

    String message;
     if (delivery != null) {
        message = new String(delivery.getBody());
        System.out.println("Reciever .."+message);

    }

    channel.close();
    connection.close();


I dont have a  infinite while loop in the receiver code (as shown in the 
getting started page in the rabbitMq site ) because i want to expose  this 
receiver as a web service sending one message at a time.

I also noticed by executing the commond rabbitMqctl list_queues that the 
entire queue contents become zero as and when the control reaches 

    channel.basicConsume(QUEUE_NAME, true, consumer);


Kindly let me know if i am missing something.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120722/31ab0b8f/attachment.htm>

From jzhihui521 at gmail.com  Mon Jul 23 02:37:02 2012
From: jzhihui521 at gmail.com (=?utf-8?B?WmhpaHVpIEppYW8=?=)
Date: Mon, 23 Jul 2012 09:37:02 +0800
Subject: [rabbitmq-discuss]
	=?utf-8?q?Simple_Sender_and_Receiver_in_java?=
Message-ID: <201207230937007151504@gmail.com>

 channel.basicConsume(QUEUE_NAME, true, consumer);

The second parameter says that autoAck=true, that means the server consider
the message as acked when it send it out to the cosumer.

 In your test scenario, rabbit will send all the two message to your consumer, but
you only consume one, the other are simple lost(or discarded) because of the 
temination of your consumer.  

------------------				 
Zhihui Jiao
2012-07-23

-------------------------------------------------------------
On 2012-07-23 Praveena Kumara <praveena at cumulations.com> wrote:

>hi 
>
> 
>  I am trying to understand the RabitMq server with a sender and a receiver 
>program. Now the entire setup works well when the sender sends a single 
>message and the same would be received by the receiver.
>
>however when i send two messages( by running sender twice) and run the 
>receiver program twice i get only the first message. 
>
>Sender
>
>  ConnectionFactory factory = new ConnectionFactory();
>        factory.setHost("localhost");
>        Connection connection = factory.newConnection();
>        Channel channel = connection.createChannel();
>
>
>        channel.queueDeclare(QUEUE_NAME, true, false, false, null);
>        String message = "He12!";
>        channel.basicPublish("", QUEUE_NAME, null, message.getBytes());
>        System.out.println("Sent "+message);
>        channel.close();
>        connection.close();
>
>Receiver
>
>    ConnectionFactory factory = new ConnectionFactory();
>    factory.setHost("localhost");
>    Connection connection = factory.newConnection();
>    Channel channel = connection.createChannel();
>
>    channel.queueDeclare(QUEUE_NAME, true, false, false, null);
>
>    QueueingConsumer consumer = new QueueingConsumer(channel);
>    channel.basicConsume(QUEUE_NAME, true, consumer);
>    QueueingConsumer.Delivery delivery = consumer.nextDelivery();
>   
>
>    String message;
>     if (delivery != null) {
>        message = new String(delivery.getBody());
>        System.out.println("Reciever .."+message);
>
>    }
>
>    channel.close();
>    connection.close();
>
>
>I dont have a  infinite while loop in the receiver code (as shown in the 
>getting started page in the rabbitMq site ) because i want to expose  this 
>receiver as a web service sending one message at a time.
>
>I also noticed by executing the commond rabbitMqctl list_queues that the 
>entire queue contents become zero as and when the control reaches 
>
>    channel.basicConsume(QUEUE_NAME, true, consumer);
>
>
>Kindly let me know if i am missing something.
>
>
>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From praveena at cumulations.com  Mon Jul 23 09:09:08 2012
From: praveena at cumulations.com (Praveena Kumara)
Date: Mon, 23 Jul 2012 01:09:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Simple Sender and Receiver in java
In-Reply-To: <bf61ff53-516a-42b5-8756-f98e89b20715@googlegroups.com>
References: <bf61ff53-516a-42b5-8756-f98e89b20715@googlegroups.com>
Message-ID: <354d5912-87f9-4768-8ed4-8e9dcf2155ec@googlegroups.com>



The issue was solved for me when i modified the Receiver with no_Ack = 
false and a call to BasicAck. Thanks to @robthewolf and @Card(by twitter) 
for helping .

PFB the modified receiver now.

        ConnectionFactory factory = new ConnectionFactory();
    factory.setHost("localhost");
    Connection connection = factory.newConnection();
    Channel channel = connection.createChannel();

    channel.queueDeclare(QUEUE_NAME, true, false, false, null);

    QueueingConsumer consumer = new QueueingConsumer(channel);
    channel.basicConsume(QUEUE_NAME, false, consumer);
    QueueingConsumer.Delivery delivery = consumer.nextDelivery(10);
    /*channel.basicCancel(consumer.getConsumerTag());   */

    String message = null;

     if (delivery != null) {
        message = new String(delivery.getBody());
        System.out.println("Reciever .."+message);
        channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
    }

    channel.close();
    connection.close();
    return message;



On Sunday, July 22, 2012 10:46:10 AM UTC-7, Praveena Kumara wrote:
>
> hi 
>
>  
>   I am trying to understand the RabitMq server with a sender and a 
> receiver program. Now the entire setup works well when the sender sends a 
> single message and the same would be received by the receiver.
>
> however when i send two messages( by running sender twice) and run the 
> receiver program twice i get only the first message. 
>
> Sender
>
>   ConnectionFactory factory = new ConnectionFactory();
>         factory.setHost("localhost");
>         Connection connection = factory.newConnection();
>         Channel channel = connection.createChannel();
>
>
>         channel.queueDeclare(QUEUE_NAME, true, false, false, null);
>         String message = "He12!";
>         channel.basicPublish("", QUEUE_NAME, null, message.getBytes());
>         System.out.println("Sent "+message);
>         channel.close();
>         connection.close();
>
> Receiver
>
>     ConnectionFactory factory = new ConnectionFactory();
>     factory.setHost("localhost");
>     Connection connection = factory.newConnection();
>     Channel channel = connection.createChannel();
>
>     channel.queueDeclare(QUEUE_NAME, true, false, false, null);
>
>     QueueingConsumer consumer = new QueueingConsumer(channel);
>     channel.basicConsume(QUEUE_NAME, true, consumer);
>     QueueingConsumer.Delivery delivery = consumer.nextDelivery();
>    
>
>     String message;
>      if (delivery != null) {
>         message = new String(delivery.getBody());
>         System.out.println("Reciever .."+message);
>
>     }
>
>     channel.close();
>     connection.close();
>
>
> I dont have a  infinite while loop in the receiver code (as shown in the 
> getting started page in the rabbitMq site ) because i want to expose  this 
> receiver as a web service sending one message at a time.
>
> I also noticed by executing the commond rabbitMqctl list_queues that the 
> entire queue contents become zero as and when the control reaches 
>
>     channel.basicConsume(QUEUE_NAME, true, consumer);
>
>
> Kindly let me know if i am missing something.
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/0fb178a0/attachment.htm>

From matthias at rabbitmq.com  Mon Jul 23 09:57:17 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 23 Jul 2012 09:57:17 +0100
Subject: [rabbitmq-discuss] Simple Sender and Receiver in java
In-Reply-To: <354d5912-87f9-4768-8ed4-8e9dcf2155ec@googlegroups.com>
References: <bf61ff53-516a-42b5-8756-f98e89b20715@googlegroups.com>
	<354d5912-87f9-4768-8ed4-8e9dcf2155ec@googlegroups.com>
Message-ID: <500D11ED.4030306@rabbitmq.com>

On 23/07/12 09:09, Praveena Kumara wrote:
> The issue was solved for me when i modified the Receiver with no_Ack =
> false and a call to BasicAck.

Glad you got it to work. Btw, if you really want to implement the 
equivalent of "of wait for (just) one message", you should also set 
prefetch to 1. See 
http://www.rabbitmq.com/tutorials/tutorial-two-python.html. That way 
only one message is sent to the client - rather than, potentially, the 
entire queue contents - and at most one message will end up getting 
requeued when the channel is closed.


Regards,

Matthias.

From emile at rabbitmq.com  Mon Jul 23 10:26:44 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 23 Jul 2012 10:26:44 +0100
Subject: [rabbitmq-discuss] rabbitmqctl stop_app start_app loses all
	messages
In-Reply-To: <CAO4q6_8LY68cUxx4RQKj8KSgGP+aOT0x=Wdsm3-i_vQED3hK6w@mail.gmail.com>
References: <CAO4q6_8LY68cUxx4RQKj8KSgGP+aOT0x=Wdsm3-i_vQED3hK6w@mail.gmail.com>
Message-ID: <500D18D4.20400@rabbitmq.com>

Hi,

On 21/07/12 02:26, Farshad Meshkinpour wrote:
> Could someone let me know what might be wrong with my configuration or
> what I am doing wrong?

This is expected behaviour. When slaves join they are cleared. Queue
contents is not eagerly synchronised, so slaves will only become
synchronised when the contents of the master queue is completely
replaced with new messages. If you restart each node in the cluster too
quickly for slaves to synchronise then messages will be lost.

If you expect multiple failures then you should ensure that you have
even greater redundancy. If you need to restart nodes for administrative
purposes then you should wait for the last slave to become synchronised
before restarting the next one.


-Emile



From ernest.staszuk at comarch.pl  Mon Jul 23 10:33:40 2012
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Mon, 23 Jul 2012 11:33:40 +0200
Subject: [rabbitmq-discuss] publishing confirms with persistent messages?
In-Reply-To: <878veelsxe.wl%francesco@rabbitmq.com>
References: <CAB6nogK3d9jZDfWd3v_GqcBy3MiGVN360dpmnTMUvShPgjACrw@mail.gmail.com>
	<878veelsxe.wl%francesco@rabbitmq.com>
Message-ID: <500D1A74.1040109@comarch.pl>

In fact it is possible that rabbit sends confirmation and data
is not stored. The fsync does NOT guarantee that data has been
actually written. What it does is a assurance that hard disk
reported completion of data transfer. Due to writing cashe
of hard memory there could exist a time window when
data has not been permanently stored yet. This could be
prevented by disabling hard disk's writing cache.


W dniu 2012-07-20 10:48, Francesco Mazzoli pisze:
> At Fri, 20 Jul 2012 16:33:23 +0800,
> ??? wrote:
>> Hi all,
>>     I read this  "Persistent messages are confirmed when all queues have either
>> delivered the message and received an acknowledgement (if required), or
>> persisted the message." on the offical blog. but when i read the source code,
>> I found maybe it's not true.
>>      in rabbit_msg_store.erl , when write a message to a file, it will record
>> pending confirms,.and sync these confirms very 25 milliseconds, the problem is
>> the file is cached file, so after sended the confirms, the messages may not
>> have been written to disk. am i correct?
> The confirm is sent after fsyncing the msg store file (via
> `file_handle_cache:sync/1'), which flushes all the in-memory changes to
> disc. I'm not sure what you mean by "the file is a cached file".
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From ernest.staszuk at comarch.pl  Mon Jul 23 10:39:27 2012
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Mon, 23 Jul 2012 11:39:27 +0200
Subject: [rabbitmq-discuss] publishing confirms with persistent messages?
In-Reply-To: <500D1A74.1040109@comarch.pl>
References: <CAB6nogK3d9jZDfWd3v_GqcBy3MiGVN360dpmnTMUvShPgjACrw@mail.gmail.com>
	<878veelsxe.wl%francesco@rabbitmq.com>
	<500D1A74.1040109@comarch.pl>
Message-ID: <500D1BCF.1020802@comarch.pl>

And there you could read about this possibility:

http://www.jasonbrome.com/blog/archives/2004/04/03/writecache_enabled.html


From matthias at rabbitmq.com  Mon Jul 23 10:47:36 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 23 Jul 2012 10:47:36 +0100
Subject: [rabbitmq-discuss] publishing confirms with persistent messages?
In-Reply-To: <500D1A74.1040109@comarch.pl>
References: <CAB6nogK3d9jZDfWd3v_GqcBy3MiGVN360dpmnTMUvShPgjACrw@mail.gmail.com>
	<878veelsxe.wl%francesco@rabbitmq.com>
	<500D1A74.1040109@comarch.pl>
Message-ID: <500D1DB8.2040006@rabbitmq.com>

On 23/07/12 10:33, Ernest Staszuk wrote:
> In fact it is possible that rabbit sends confirmation and data
> is not stored. The fsync does NOT guarantee that data has been
> actually written. What it does is a assurance that hard disk
> reported completion of data transfer. Due to writing cashe
> of hard memory there could exist a time window when
> data has not been permanently stored yet. This could be
> prevented by disabling hard disk's writing cache.

Sure, that's reasonably well-known, and outside rabbit's control.

Matthias.

From ernest.staszuk at comarch.pl  Mon Jul 23 10:49:03 2012
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Mon, 23 Jul 2012 11:49:03 +0200
Subject: [rabbitmq-discuss] Consumer acknowledgement
In-Reply-To: <CAE8G+yQWNjLaNRRTL-2Tqj_F7air0VsWheU571SimpJrCmoxqg@mail.gmail.com>
References: <CAE8G+yQWNjLaNRRTL-2Tqj_F7air0VsWheU571SimpJrCmoxqg@mail.gmail.com>
Message-ID: <500D1E0F.1090404@comarch.pl>

You could resend non acked messages without closing connection
by basic.recover. Also you could possibly apply timeout to the messages
in companion of dead-lettering (in your case dead-lettering to the same
queue should be just right choice). This would redeliver messages after
their expiration.

Does my answer cover your needs?

W dniu 2012-07-19 23:11, Prashanth pisze:
> Hi,
>
> My test case.
>
> I have a consumer, with no_ack =>0, prefetch_count is default, 
> consumer receives messages, even if previous messages are not acknowledge.
> If the message is never acknowledge or ack message is lost in transit 
> and if consumer never goes down, This message is never acknowledged or 
> is resent again, its in the queue forever. I don't want to timeout the 
> message.
> Instead I want the message to resend after a specified timeout may be 
> to the same consumer.
>
> Is there a way to do this.
>
> Thanks
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/255007aa/attachment.htm>

From matthias at rabbitmq.com  Mon Jul 23 10:50:32 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 23 Jul 2012 10:50:32 +0100
Subject: [rabbitmq-discuss] rabbitmqctl stop_app start_app loses all
	messages
In-Reply-To: <500D18D4.20400@rabbitmq.com>
References: <CAO4q6_8LY68cUxx4RQKj8KSgGP+aOT0x=Wdsm3-i_vQED3hK6w@mail.gmail.com>
	<500D18D4.20400@rabbitmq.com>
Message-ID: <500D1E68.7090601@rabbitmq.com>

Farshad,

On 23/07/12 10:26, Emile Joubert wrote:
> On 21/07/12 02:26, Farshad Meshkinpour wrote:
>> Could someone let me know what might be wrong with my configuration or
>> what I am doing wrong?
>
> This is expected behaviour. When slaves join they are cleared. Queue
> contents is not eagerly synchronised, so slaves will only become
> synchronised when the contents of the master queue is completely
> replaced with new messages. If you restart each node in the cluster too
> quickly for slaves to synchronise then messages will be lost.

...as explained at 
http://www.rabbitmq.com/ha.html#unsynchronised-slaves. I am assuming 
you've read the HA docs; is the explanation on that page unclear?

Regards,

Matthias.

From alexis at rabbitmq.com  Mon Jul 23 10:59:55 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 23 Jul 2012 10:59:55 +0100
Subject: [rabbitmq-discuss] can't start rabbitmq-server
In-Reply-To: <CAHAaT5uB+jkP165sMdsXAF4OEzoa-iDZ1tiTNJ0ay-9kUHWrcQ@mail.gmail.com>
References: <CAHAaT5uQ+zhaCO1qFLxP-kZyYXMRav=Tp3wHYFvej2TiDwA4fw@mail.gmail.com>
	<5008057F.9060003@rabbitmq.com>
	<CAHAaT5uB+jkP165sMdsXAF4OEzoa-iDZ1tiTNJ0ay-9kUHWrcQ@mail.gmail.com>
Message-ID: <CACOPnvfFF9PD23JwjKuKRmK4Vaxr+84M0B0rG5nkRpxwMwP4Zg@mail.gmail.com>

On Sat, Jul 21, 2012 at 11:52 PM, Eslam Mamdouh El Husseiny <
emamdouh at cloud9ers.com> wrote:

> btw normal user can start rabbitmq-server ,moreover when i'm trying to
> start rabbitmq-server using root, the same error appears except that line
>
>> Only root or rabbitmq should run rabbitmq-server
>
>
> any ideas ?
>

Eslam, there is not much to add to this.  Are you logged in as root?




>
> Thanks
>
> On Thu, Jul 19, 2012 at 3:02 PM, Tim Watson <tim at rabbitmq.com> wrote:
>
>>  On 07/19/2012 02:01 PM, Eslam Mamdouh El Husseiny wrote:
>>
>> hi,
>> i have a mysterious problem with rabbitmq "2.7.1-0ubuntu4"
>> sometimes it refuses to start and come out with this error message :
>>
>>> melzalabany at Ubuntu-11:web_tier$  rabbitmq-server
>>> Only root or rabbitmq should run rabbitmq-server
>>>
>>
>>
>> That looks like the reason there: 'only root or rabbitmq should run
>> rabbitmq-server'.....
>>
>>
>>  and i resolve this error with restarting system
>>
>>
>> Not sure how this helps, but perhaps I'm missing something?
>>
>>
>>  So i'd like to know if there is a reason for this error and how to
>> avoid this problem without rebooting machine
>>
>>
>> Does this happen if you try and start the server the correct user?
>>
>
>
>
> --
> Best Regards,
> Eslam Mamdouh El Husseiny
> *Systems Administrator**
> Cloud Niners Ltd.
>
> *
> *Cellular: (+2) 011 198 40 40
> Mansoura: (+2) 050 234 70 81
> Cairo:    (+2) 022 *268 34 60
> Fax:      (+2) 022 268 34 63
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/a2a92b6c/attachment.htm>

From ernest.staszuk at comarch.pl  Mon Jul 23 11:29:51 2012
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Mon, 23 Jul 2012 12:29:51 +0200
Subject: [rabbitmq-discuss] Vanishing of persistent messages on durable,
 auto-deleting queue with dead-lettering
In-Reply-To: <50045771.1070201@rabbitmq.com>
References: <4FEDD75D.1030808@comarch.pl> <4FF09592.20302@rabbitmq.com>
	<5003EEF8.1070000@comarch.pl> <50045771.1070201@rabbitmq.com>
Message-ID: <500D279F.8030108@comarch.pl>

W dniu 2012-07-16 20:03, Matthias Radestock pisze:
> Ernest,
>
> You do know that x-consistent-hash may lose some new messages when 
> queues are deleted, right? See the docs for details.
>
> Anyway, leaving that issue aside for the moment...
>
> (...)
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Glad you mentioned that. I just forgot about that.

Thank you for your answers and all the effort you are constantly putting 
into RabbitMQ.

Best regards,
Ernest Staszuk



From francesco at rabbitmq.com  Mon Jul 23 11:47:57 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 23 Jul 2012 11:47:57 +0100
Subject: [rabbitmq-discuss] Cannot send message to RabbitMQ
In-Reply-To: <1342925566965-20977.post@n5.nabble.com>
References: <1342925566965-20977.post@n5.nabble.com>
Message-ID: <87fw8izrc2.wl%francesco@rabbitmq.com>


Could you post the bit of code that you are using to send the message, along
with the rabbit logs and a description of your setup, instead of the whole
project?  That would make helping you much easier.

--
Francesco * Often in error, never in doubt

From erik.pragt at jworks.nl  Mon Jul 23 12:05:51 2012
From: erik.pragt at jworks.nl (erikpragt)
Date: Mon, 23 Jul 2012 04:05:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Cannot send message to RabbitMQ
In-Reply-To: <87fw8izrc2.wl%francesco@rabbitmq.com>
References: <1342925566965-20977.post@n5.nabble.com>
	<87fw8izrc2.wl%francesco@rabbitmq.com>
Message-ID: <CAPGiXQbc7CwSH3gY-A0MNc0R3JPrL_FL3-iB=47NOk2FeNgCXg@mail.gmail.com>

Hi Francesco,

Thanks for the reply. I fixed it, RabbitMQ was misbehaving, and I
reinstalled and upgraded RabbitMQ, and it worked after that!

Thanks,

Erik

On Mon, Jul 23, 2012 at 12:47 PM, Francesco Mazzoli-2 [via RabbitMQ] <
ml-node+s1065348n20994h80 at n5.nabble.com> wrote:

>
> Could you post the bit of code that you are using to send the message,
> along
> with the rabbit logs and a description of your setup, instead of the whole
> project?  That would make helping you much easier.
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=20994&i=0>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/Cannot-send-message-to-RabbitMQ-tp20977p20994.html
>  To unsubscribe from Cannot send message to RabbitMQ, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=20977&code=ZXJpay5wcmFndEBqd29ya3Mubmx8MjA5Nzd8LTEyMTk4MjgzMjU=>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cannot-send-message-to-RabbitMQ-tp20977p20995.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/21bf13e3/attachment.htm>

From cao at ll.mit.edu  Mon Jul 23 15:02:30 2012
From: cao at ll.mit.edu (Cao, Yican - 0661 - MITLL)
Date: Mon, 23 Jul 2012 10:02:30 -0400
Subject: [rabbitmq-discuss] pile up messages on queue
Message-ID: <2831333F-8100-4B2F-B964-0124F611C6BD@ll.mit.edu>

Hi, 

I have a producer publishes messages at routing key a.b.c.
Meantime a consumer is consume at #.

There is no problem to get those messages. But queue is piling up, never been cleaned or purged.
I'm using 2.7.1 server. 

Does anyone experience this? Thanks.


Yican Cao
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 6299 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/06ed869d/attachment.bin>

From francesco at rabbitmq.com  Mon Jul 23 15:16:42 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 23 Jul 2012 15:16:42 +0100
Subject: [rabbitmq-discuss] pile up messages on queue
In-Reply-To: <2831333F-8100-4B2F-B964-0124F611C6BD@ll.mit.edu>
References: <2831333F-8100-4B2F-B964-0124F611C6BD@ll.mit.edu>
Message-ID: <87eho2zho5.wl%francesco@rabbitmq.com>

Hi Yican,
At Mon, 23 Jul 2012 10:02:30 -0400,
Cao, Yican - 0661 - MITLL wrote:
> Hi, 
> 
> I have a producer publishes messages at routing key a.b.c.
> Meantime a consumer is consume at #.
> 
> There is no problem to get those messages. But queue is piling up, never been
> cleaned or purged.
> I'm using 2.7.1 server. 
> 
> Does anyone experience this? Thanks.
> 
> Yican Cao

It's not clear to me what you are trying to do and what the issue here.
Specifically, I'm not sure what you mean by "getting" from the queue and
"cleaning" the queue.

If you are consuming from the queue, logically the messages should not appear
again on the queue (unless you are rejecting them). Are you experiencing
redelivery of messages that you have consumed already?

--
Francesco * Often in error, never in doubt

From Michael.Laing at nytimes.com  Mon Jul 23 15:25:48 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Mon, 23 Jul 2012 10:25:48 -0400
Subject: [rabbitmq-discuss] Federation configuration for clusters - failover
Message-ID: <CC32D72C.36B0%Michael.Laing@nytimes.com>

I currently have the same configuration for each node in the cluster. Is this correct?

Also, what is the expected behavior when a node in the cluster goes down? If it is the node on which the federation plugin has created its queues etc, I would think it should recreate them on another node and keep on going. We will test this but it would be nice to know what to expect. Perhaps we should we set the HA option? Currently losing messages is not an issue for us but en futuro it will be as we implement high volume applications.

Best regards,

Michael
Infrastructure Architect
NYTimes Media Group
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/6e3f5f0b/attachment.htm>

From james.mcmahon at TASC.COM  Mon Jul 23 15:29:29 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Mon, 23 Jul 2012 14:29:29 +0000
Subject: [rabbitmq-discuss] Configuring beyond rabbitmq server on localhost
Message-ID: <C974010E949511448F6DC6F748F604D90FF1B0EB@TSEAMB01>

     Working through the introductory examples, I have only configured the rabbitmq server on localhost. I run Java classes in various consoles, and they exchange messages through rabbitMQ direct exchanges. Nice and tidy, and it seems to work.

     I'd now like to configure it on a remote physical server that will field messages from other networked resources. In other words many machines may be running local instances of EmitLogDirect.class and ReceiveLogsDirect.class, and all of these would be served by one (or more?) rabbitmq server(s) on a remote host.

     How is this done? I'm guessing that I need to replace all my localhost references with some form of a URL for my remote host, and I suspect there will be rabbitmq and/or erlang configuration files that need to be modified on the server host and client machines so that they can communicate with the rabbitmq remote server. Is there an example?

     Do people typically have multiple rabbitMQ servers running in some federated fashion, serving as backup instances for fault tolerance and fail over?

     Thank you in advance for your comments and help.

Jim

CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/5b415bf9/attachment.htm>

From langalaxy at gmail.com  Mon Jul 23 14:35:26 2012
From: langalaxy at gmail.com (Christoph)
Date: Mon, 23 Jul 2012 06:35:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Looking for some specific & complete C#
	examples
In-Reply-To: <0fa4a463-7dfc-45f5-8772-3b680cb0e53a@googlegroups.com>
References: <0fa4a463-7dfc-45f5-8772-3b680cb0e53a@googlegroups.com>
Message-ID: <a0c75a8f-42b8-4a68-ac61-31ee931a4db0@googlegroups.com>

I'm not sure if you have already found these, but there are also Code 
Examples of the book "RabbitMQ in Action" available on GitHub:  
https://github.com/rabbitinaction/sourcecode/tree/master/csharp/appendix-a
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/585123b1/attachment.htm>

From curylod at asme.org  Mon Jul 23 16:57:22 2012
From: curylod at asme.org (Dave Curylo)
Date: Mon, 23 Jul 2012 11:57:22 -0400
Subject: [rabbitmq-discuss] Looking for some specific & complete C#
	examples
In-Reply-To: <a0c75a8f-42b8-4a68-ac61-31ee931a4db0@googlegroups.com>
References: <0fa4a463-7dfc-45f5-8772-3b680cb0e53a@googlegroups.com>
	<a0c75a8f-42b8-4a68-ac61-31ee931a4db0@googlegroups.com>
Message-ID: <CAAqmy6N6rumftMbyo+NDwks6Y6TBU994VaohwwrFcBGjb+F4Fg@mail.gmail.com>

I also find these samples to be a little simplistic.

1. They never include heartbeat settings, and the .NET documentation is
pretty thin on these as well.  Setting a heartbeat is pretty important,
otherwise if there is a network problem and your client loses connectivity,
neither your client or the message broker seem to know about it.  Samples
never seem to do this.
2. They never include error handling - there are some useful exceptions
raised if connections drop, killing a subscription.
3. They never include multithreading concerns.  It isn't always possible or
efficient to spin up multiple consumer processes to achieve concurrency.
 It seems important to note that sharing a Connection is OK (and probably a
good thing since Connections use a limited OS resource), but sharing a
Model is not OK.  From 2.10 of the API guide:

If more than one thread needs to access a particular IModel instances, the
application should enforce mutual exclusion itself. One way of achieving
this is for all users of an IModel to lock the instance itself:
IModel ch = RetrieveSomeSharedIModelInstance();
lock (ch) {
ch.BasicPublish(...);
}

I wish these samples would go into more detail about these scenarios.

On Mon, Jul 23, 2012 at 9:35 AM, Christoph <langalaxy at gmail.com> wrote:

> I'm not sure if you have already found these, but there are also Code
> Examples of the book "RabbitMQ in Action" available on GitHub:
> https://github.com/rabbitinaction/sourcecode/tree/master/csharp/appendix-a
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/b8812c3c/attachment.htm>

From francesco at rabbitmq.com  Mon Jul 23 17:13:22 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 23 Jul 2012 17:13:22 +0100
Subject: [rabbitmq-discuss] Configuring beyond rabbitmq server on
	localhost
In-Reply-To: <C974010E949511448F6DC6F748F604D90FF1B0EB@TSEAMB01>
References: <C974010E949511448F6DC6F748F604D90FF1B0EB@TSEAMB01>
Message-ID: <87d33mzc9p.wl%francesco@rabbitmq.com>

Hi Jim,
At Mon, 23 Jul 2012 14:29:29 +0000,
McMahon, James S (TASC) wrote:
>      How is this done? I'm guessing that I need to replace all my localhost
> references with some form of a URL for my remote host, and I suspect there
> will be rabbitmq and/or erlang configuration files that need to be modified on
> the server host and client machines so that they can communicate with the
> rabbitmq remote server. Is there an example?

To communicate with a remote rabbit server you need, as you guessed, to specify
the remote host and port when establishing a connection to the broker.  In the
case of the Java client you can do that with the relevant `ConnectionFactory'
methods.

Rabbit will bind on all interfaces by default, so the broker will be accessible
remotely.

>      Do people typically have multiple rabbitMQ servers running in some
>      federated fashion, serving as backup instances for fault tolerance and
>      fail over?

There are various way to cluster/federate rabbit brokers, see
http://www.rabbitmq.com/distributed.html for a comparison between the various
approaches.

--
Francesco * Often in error, never in doubt

From james.mcmahon at TASC.COM  Mon Jul 23 17:41:53 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Mon, 23 Jul 2012 16:41:53 +0000
Subject: [rabbitmq-discuss] Configuring beyond rabbitmq server
	on	localhost
In-Reply-To: <87d33mzc9p.wl%francesco@rabbitmq.com>
References: <C974010E949511448F6DC6F748F604D90FF1B0EB@TSEAMB01>,
	<87d33mzc9p.wl%francesco@rabbitmq.com>
Message-ID: <C974010E949511448F6DC6F748F604D90FF1B159@TSEAMB01>

Thank you for your help, Francesco. I have a follow-up question.

On the server running my rabbitmq instance, how do I tell it "service incoming requests to send or read messages by listening on port 1234"? When you say Rabbit binds on all interfaces by default, that doesn't mean it monitors all ports does it? There must be some need to have rabbitMQ listen on a specific port restricted only to its appropriate traffic.

Jim
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Francesco Mazzoli [francesco at rabbitmq.com]
Sent: Monday, July 23, 2012 12:13 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuring beyond rabbitmq server on   localhost

Hi Jim,
At Mon, 23 Jul 2012 14:29:29 +0000,
McMahon, James S (TASC) wrote:
>      How is this done? I'm guessing that I need to replace all my localhost
> references with some form of a URL for my remote host, and I suspect there
> will be rabbitmq and/or erlang configuration files that need to be modified on
> the server host and client machines so that they can communicate with the
> rabbitmq remote server. Is there an example?

To communicate with a remote rabbit server you need, as you guessed, to specify
the remote host and port when establishing a connection to the broker.  In the
case of the Java client you can do that with the relevant `ConnectionFactory'
methods.

Rabbit will bind on all interfaces by default, so the broker will be accessible
remotely.

>      Do people typically have multiple rabbitMQ servers running in some
>      federated fashion, serving as backup instances for fault tolerance and
>      fail over?

There are various way to cluster/federate rabbit brokers, see
http://www.rabbitmq.com/distributed.html for a comparison between the various
approaches.

--
Francesco * Often in error, never in doubt
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.

From francesco at rabbitmq.com  Mon Jul 23 17:58:46 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 23 Jul 2012 17:58:46 +0100
Subject: [rabbitmq-discuss] Configuring beyond rabbitmq
	server	on	localhost
In-Reply-To: <C974010E949511448F6DC6F748F604D90FF1B159@TSEAMB01>
References: <C974010E949511448F6DC6F748F604D90FF1B0EB@TSEAMB01>
Message-ID: <87boj6za61.wl%francesco@rabbitmq.com>

At Mon, 23 Jul 2012 16:41:53 +0000,
McMahon, James S (TASC) wrote:
> On the server running my rabbitmq instance, how do I tell it "service incoming
> requests to send or read messages by listening on port 1234"?

By changing the RABBITMQ_NODE_PORT environmental variable, see
http://www.rabbitmq.com/configure.html .

> When you say Rabbit binds on all interfaces by default, that doesn't mean it
> monitors all ports does it?

It obviously doesn't (that would be an odd thing to do), I meant that rabbitmq
will receive all incoming connection and not just local one (in other words it
won't bind to the loopback interface only).

--
Francesco * Often in error, never in doubt

From justin.adam.miller at gmail.com  Mon Jul 23 18:04:23 2012
From: justin.adam.miller at gmail.com (justin.adam.miller at gmail.com)
Date: Mon, 23 Jul 2012 10:04:23 -0700 (PDT)
Subject: [rabbitmq-discuss] fine_grained_statistics
Message-ID: <ea7a0709-fc7c-4c6b-a632-a8d4197823a4@googlegroups.com>

Is there ever a time when fine_grained_statistics are dynamically turned 
off by the management plugin? By dynamic, I mean they're enabled by 
default, but then at some point during operation, they're shut off due to 
CPU load or throughput or some other trigger?

Thanks,
Justin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/16869a74/attachment.htm>

From curylod at asme.org  Mon Jul 23 18:10:27 2012
From: curylod at asme.org (Dave Curylo)
Date: Mon, 23 Jul 2012 13:10:27 -0400
Subject: [rabbitmq-discuss] Looking for some specific & complete C#
	examples
In-Reply-To: <a0c75a8f-42b8-4a68-ac61-31ee931a4db0@googlegroups.com>
References: <0fa4a463-7dfc-45f5-8772-3b680cb0e53a@googlegroups.com>
	<a0c75a8f-42b8-4a68-ac61-31ee931a4db0@googlegroups.com>
Message-ID: <45A90BC0-9B1C-4822-A5A0-4FB5FD06172E@asme.org>

I apologize if you get a duplicate of this?I sent from the wrong account last time:

I find these samples to be a little simplistic.

1. They never include heartbeat settings, and the .NET documentation is pretty thin on these as well.  Setting a heartbeat is pretty important, otherwise if there is a network problem and your client loses connectivity, neither your client or the message broker seem to know about it.  Samples never seem to do this.
2. They never include error handling - there are some useful exceptions raised if connections drop, killing a subscription.
3. They never include multithreading concerns.  It isn't always possible or efficient to spin up multiple consumer processes to achieve concurrency. It seems important to note that sharing a Connection is OK (and probably a good thing since Connections use a limited OS resource), but sharing a Model is not OK.  From 2.10 of the API guide:

If more than one thread needs to access a particular IModel instances, the application should enforce mutual exclusion itself. One way of achieving this is for all users of an IModel to lock the instance itself:
IModel ch = RetrieveSomeSharedIModelInstance();
lock (ch) {
ch.BasicPublish(...);
}

I wish these samples and/or documentation would go into more detail about these scenarios.  I've figured them out through trial and error or reading through driver code.

On Jul 23, 2012, at 9:35 AM, Christoph wrote:

> I'm not sure if you have already found these, but there are also Code Examples of the book "RabbitMQ in Action" available on GitHub:  https://github.com/rabbitinaction/sourcecode/tree/master/csharp/appendix-a_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/b8725343/attachment.htm>

From jaaaelpumuki at gmail.com  Mon Jul 23 18:20:10 2012
From: jaaaelpumuki at gmail.com (=?UTF-8?Q?F=C3=A9lix?=)
Date: Mon, 23 Jul 2012 10:20:10 -0700 (PDT)
Subject: [rabbitmq-discuss] Exchange with throttling
Message-ID: <1ccea2bc-4d26-427f-b174-ff78de0de8c7@googlegroups.com>

Hi,

I'm thinking of making an exchange that supports throttling. The idea is 
that you can set the rate in a header, and the exchange checks if it has to 
wait before dispatch  the message. 

Is there anything similar in rabbitmq?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/d4fbaa89/attachment.htm>

From matthias at rabbitmq.com  Mon Jul 23 19:08:16 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 23 Jul 2012 19:08:16 +0100
Subject: [rabbitmq-discuss] rabbitmqctl stop_app start_app loses all
	messages
In-Reply-To: <CAO4q6__Ef+kQJi6RF=BRhMfW2c-Fqp0m23wz2Ly5Xrkz-GKy3A@mail.gmail.com>
References: <CAO4q6_8LY68cUxx4RQKj8KSgGP+aOT0x=Wdsm3-i_vQED3hK6w@mail.gmail.com>
	<500D18D4.20400@rabbitmq.com> <500D1E68.7090601@rabbitmq.com>
	<CAO4q6__Ef+kQJi6RF=BRhMfW2c-Fqp0m23wz2Ly5Xrkz-GKy3A@mail.gmail.com>
Message-ID: <500D9310.903@rabbitmq.com>

Farshad,

please keep the list on 'cc'...

On 23/07/12 18:18, Farshad Meshkinpour wrote:
> Thanks for your response.  I read this document and I am still a bit
>  puzzled.  The document says:
>
> If the mirrored-queue was declared /durable/ then, if its last
> remaining node is shutdown, durable messages in the queue will
> survive the restart of that node.
>
> But I noticed if stop and start the second node in the cluster (last
>  node), the messages do not survive.

So you are doing the following?

1) start two nodes (A&B)
2) declare a durable mirrored queue, mirrored on all nodes
3) publish messages that get routed to the queue
4) shut down node A
5) shut down node B
6) start up node B

?

That should not lose any messages provided the messages are published as
*persistent*. See the 'Message durability' section in 
http://www.rabbitmq.com/tutorials/tutorial-two-python.html. Are you 
doing that?

> It seems that there needs to be some wait time before
> stopping/starting of last node.  Otherwise, the last node does not
> know that it is the last node.   Is it correct?  If so, what is this
> time period.

Publishing is async, so in general a client doesn't know when the
server has taken responsibility for a message. The time it takes for
that to happen is typically very short though, unless the server is
heavily loaded. Publisher confirms - 
http://www.rabbitmq.com/extensions.html#confirms - notify the publishing 
client when messages have been accepted by the server.

Regards,

Matthias.

From fmeshkinpour at fonality.com  Mon Jul 23 19:20:31 2012
From: fmeshkinpour at fonality.com (Farshad Meshkinpour)
Date: Mon, 23 Jul 2012 11:20:31 -0700
Subject: [rabbitmq-discuss] rabbitmqctl stop_app start_app loses all
	messages
In-Reply-To: <500D9310.903@rabbitmq.com>
References: <CAO4q6_8LY68cUxx4RQKj8KSgGP+aOT0x=Wdsm3-i_vQED3hK6w@mail.gmail.com>
	<500D18D4.20400@rabbitmq.com> <500D1E68.7090601@rabbitmq.com>
	<CAO4q6__Ef+kQJi6RF=BRhMfW2c-Fqp0m23wz2Ly5Xrkz-GKy3A@mail.gmail.com>
	<500D9310.903@rabbitmq.com>
Message-ID: <CAO4q6_8nfHM+HaLEYvojZ34i1fnm4PDAzsZh2XR441QkZf5kYg@mail.gmail.com>

Hi Matthias,

Thanks for quick response. My scenarios is a bit different.  Here is what I
have tried which causes that all messages to be deleted.

1) start two nodes (A&B)
2) declare a durable mirrored queue, mirrored on all nodes
3) publish messages that get routed to the queue
   * -- messages are on both A & B*
4) shut down node A
*5) startup node A*
*    -- messages are deleted on A*
*    -- messages are unsynchronized on B
*6) shut down node B
7) start up node B
    *-- messages are deleted  on B*


Yes, the message are published persistently.

Thanks,

On Mon, Jul 23, 2012 at 11:08 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Farshad,
>
> please keep the list on 'cc'...
>
>
> On 23/07/12 18:18, Farshad Meshkinpour wrote:
>
>> Thanks for your response.  I read this document and I am still a bit
>>  puzzled.  The document says:
>>
>> If the mirrored-queue was declared /durable/ then, if its last
>>
>> remaining node is shutdown, durable messages in the queue will
>> survive the restart of that node.
>>
>> But I noticed if stop and start the second node in the cluster (last
>>  node), the messages do not survive.
>>
>
> So you are doing the following?
>
> 1) start two nodes (A&B)
> 2) declare a durable mirrored queue, mirrored on all nodes
> 3) publish messages that get routed to the queue
> 4) shut down node A
> 5) shut down node B
> 6) start up node B
>
> ?
>
> That should not lose any messages provided the messages are published as
> *persistent*. See the 'Message durability' section in
> http://www.rabbitmq.com/**tutorials/tutorial-two-python.**html<http://www.rabbitmq.com/tutorials/tutorial-two-python.html>.
> Are you doing that?
>
>
>  It seems that there needs to be some wait time before
>> stopping/starting of last node.  Otherwise, the last node does not
>> know that it is the last node.   Is it correct?  If so, what is this
>> time period.
>>
>
> Publishing is async, so in general a client doesn't know when the
> server has taken responsibility for a message. The time it takes for
> that to happen is typically very short though, unless the server is
> heavily loaded. Publisher confirms - http://www.rabbitmq.com/**
> extensions.html#confirms<http://www.rabbitmq.com/extensions.html#confirms>- notify the publishing client when messages have been accepted by the
> server.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/07fd22cb/attachment.htm>

From matthias at rabbitmq.com  Mon Jul 23 19:26:46 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 23 Jul 2012 19:26:46 +0100
Subject: [rabbitmq-discuss] rabbitmqctl stop_app start_app loses all
	messages
In-Reply-To: <CAO4q6_8nfHM+HaLEYvojZ34i1fnm4PDAzsZh2XR441QkZf5kYg@mail.gmail.com>
References: <CAO4q6_8LY68cUxx4RQKj8KSgGP+aOT0x=Wdsm3-i_vQED3hK6w@mail.gmail.com>
	<500D18D4.20400@rabbitmq.com> <500D1E68.7090601@rabbitmq.com>
	<CAO4q6__Ef+kQJi6RF=BRhMfW2c-Fqp0m23wz2Ly5Xrkz-GKy3A@mail.gmail.com>
	<500D9310.903@rabbitmq.com>
	<CAO4q6_8nfHM+HaLEYvojZ34i1fnm4PDAzsZh2XR441QkZf5kYg@mail.gmail.com>
Message-ID: <500D9766.8000304@rabbitmq.com>

Farshad,

On 23/07/12 19:20, Farshad Meshkinpour wrote:
> Thanks for quick response. My scenarios is a bit different.  Here is
> what I have tried which causes that all messages to be deleted.
>
> 1) start two nodes (A&B)
> 2) declare a durable mirrored queue, mirrored on all nodes
> 3) publish messages that get routed to the queue
> *-- messages are on both A & B*
> 4) shut down node A
> *5) startup node A*
> *    -- messages are deleted on A*
> *    -- messages are unsynchronized on B
> *6) shut down node B
> 7) start up node B
> *-- messages are deleted  on B*

That's precisely the situation Emile talked about, which is explained in 
http://www.rabbitmq.com/ha.html#unsynchronised-slaves.

Suggestions on how we can improve the docs to make that clearer are welcome.

Regards,

Matthias.

From frank at frankmayer.net  Mon Jul 23 19:05:16 2012
From: frank at frankmayer.net (Frank Mayer)
Date: Mon, 23 Jul 2012 11:05:16 -0700 (PDT)
Subject: [rabbitmq-discuss] active-active implementation in php
In-Reply-To: <086DFC60-0A54-4133-9267-44D4D6E04D6D@gmail.com>
References: <CAG=PQNMCf60_QrTZS3-tCHxBzrmAzXrLLGGz8A2mE6tmQ0HRyg@mail.gmail.com>
	<4F0317FE.2050802@rabbitmq.com>
	<CAMcAHLWt7XnCBu7q4sA2PQNQ_xAx8gHMg2rWqgVH5-RWo4Pw-A@mail.gmail.com>
	<CAOvN6FCu7dWWCSPqnfWu5OgZBGMm-nq-UWhVtn-rWEd9+1RPhQ@mail.gmail.com>
	<59F27BFB-A3BB-48A8-B139-E6EA7A82E32E@gmail.com>
	<ef43492b-92a0-4a7c-923a-780457d5dff4@googlegroups.com>
	<086DFC60-0A54-4133-9267-44D4D6E04D6D@gmail.com>
Message-ID: <3c752a0e-2c6b-4917-918f-7fd918ee49b4@googlegroups.com>

Ok, thank you for yoru info. I am also looking into other alternative MQ's 
now...

On Sunday, July 22, 2012 2:41:55 PM UTC+3, Alvaro Videla wrote:
>
> Hi,
>
> I haven't done any work into php-amqplib regarding the HA features 
> supported by RabbitMQ. As far as I remember you can declare queues with 
> extra arguments and so on, but that is as far as it went.
>
> -Alvaro
>
> On Jul 22, 2012, at 6:29 AM, thesilentman wrote:
>
> Hello Alvaro,
>
> did you find time to test this? I am evaluating rabbitmq for a php project 
> and need to know what lib I can use?
>
> Thanks,
> Frank
>
>
> On Tuesday, January 3, 2012 11:00:22 PM UTC+2, Alvaro Videla wrote:
>>
>> Hi Robin,
>>
>> The library implements the basic.cancel method but I haven't tested this 
>> yet.
>>
>> I think I will try to set up a Demo and implement any missing features in 
>> case they are needed.
>>
>> Alvaro
>>
>> On Jan 3, 2012, at 9:03 PM, Robin Harvey wrote:
>>
>> Alvaro - does php-amqplib support incoming consumer cancels?
>>
>>
>> Out of interest, how does the client know where to re-connect to when a 
>> queue fails (i.e. which slave got promoted)?  I've seen the following 
>> (here: http://www.rabbitmq.com/ha.html):
>>
>> > Clients that were consuming from the mirrored-queue and support our Consumer 
>> Cancellation Notifications<http://www.rabbitmq.com/extensions.html#consumer-cancel-notify>extension will receive a notification that their subscription to the 
>> mirrored-queue has been abruptly cancelled. At this point they should 
>> re-consume from the queue, which will pick up the new master
>>
>> ...but this doesn't give much detail.  Are the reconnection parameters in 
>> the consumer.cancel method?
>>
>>
>> Thanks,
>> --Robin
>>
>> On 3 January 2012 15:07, Alvaro Videla <videlalvaro at gmail.com> wrote:
>>
>>> Hi,
>>>
>>> Yes? it should support the arguments parameter. 
>>>
>>> BTW? I recommend that you use this version of the library: 
>>> https://github.com/videlalvaro/php-amqplib for the reasons stated here: 
>>> http://videlalvaro.github.com/2011/11/php-amqplib-future.html
>>>
>>> Regards,
>>>
>>> Alvaro
>>>
>>>
>>> On Tue, Jan 3, 2012 at 4:00 PM, Emile Joubert <emile at rabbitmq.com>wrote:
>>>
>>>> Hi Dhaneesh,
>>>>
>>>> On 30/12/11 04:25, Dhaneesh Radhakrishnan wrote:
>>>> > Hi
>>>> >
>>>> >  Is it possible to  implement Mirrored Queue ( active-active )using
>>>> > php-ampliqb  for
>>>> > HA
>>>>
>>>> Judging by the queue_declare() function, php-amqplib does support
>>>> arguments, so it is possible to make use of mirrored queues using this
>>>> library.
>>>>
>>>> See http://www.rabbitmq.com/ha.html for details on how to set the
>>>> "x-ha-policy" argument.
>>>>
>>>>
>>>>
>>>> -Emile
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> Sent form my Nokia 1100
>>
>>
>>  
>> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/9b50e608/attachment.htm>

From mailrohitp at gmail.com  Mon Jul 23 20:11:37 2012
From: mailrohitp at gmail.com (rohit prasad)
Date: Mon, 23 Jul 2012 12:11:37 -0700 (PDT)
Subject: [rabbitmq-discuss] configuring rabbit-mq server to send back a
 publisher confirm after N messages.
Message-ID: <1a11efe2-3ca0-4b49-aa0b-2380551ebce4@googlegroups.com>


Hi,

I am using Publisher-confirms.
Is there any way to tell Rabbit server to send a pub-confirm after N 
messages.

If this is possible, then in my rabbit client , I can wait for a 
pub-confirm after sending N messages, and be sure that Rabbit server will 
send me a confirm (ack or nack) pretty soon.
Otherwise the waiting time for the pub-confirm becomes kind of 
undeterministic, we keep waiting till Rabbit feels like sending a 
confirmation. Is this configurable in any way? Or Do you suggest some other 
way to reduce the wait time for publisher-confirm acks?

Thanks,
Rohit
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120723/7ba24a8a/attachment.htm>

From bsellner at seegrid.com  Mon Jul 23 20:57:24 2012
From: bsellner at seegrid.com (Brennan Sellner)
Date: Mon, 23 Jul 2012 15:57:24 -0400
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
Message-ID: <500DACA4.206@seegrid.com>

Hi all,

We're seeing the occasional slow transmission of a message (where 'slow' 
is defined as ~2.8 seconds between transmission and receipt).  It 
doesn't happen that often (perhaps once a week or so), but when it does 
it triggers some of our failsafe code.

We're using librabbitmq-c in a C++ program, and the message in question 
is being sent from one thread in a process to another thread in the same 
process (we're in the midst of refactoring; they'll eventually be 
separate processes on separate machines).  Each thread establishes and 
maintains its own isolated AMQP connection.

The consumer thread is consuming from a single durable queue, bound to a 
durable topic exchange with the wildcard binding.  The producer is 
publishing non-persistent messages (and expecting a reply via a separate 
reply exchange, but the problem occurs before we get to that point).

The flow of events is thus:

Time -0.003: The consumer receives, processes, and replies to an 
unrelated message.  It then waits for a frame by calling 
amqp_simple_wait_frame.

Time 0: The producer transmits a message via amqp_basic_publish.  Our 
logging bounds the time for the function to return at <= 38 microseconds.

Time 0.90: The consumer receives and responds to an AMQP heartbeat from 
the server, and acks the delivery of a prior message.  It again drops 
into an amqp_simple_wait_frame.

Time 1.90: The consumer handles another AMQP heartbeat in the same fashion.

Time 2.74: The consumer (finally!) sees the deliver frame for the 
producer's message, followed shortly by the header and body frames.  All 
frames arrive within a 364 microsecond window.

The rabbitmq server (v2.8.2) is running on the same machine, so there 
aren't any external networks involved.  We're still running Fedora 11 
(kernel 2.6.29, Erlang R12B-5.8) for the moment, if that's relevant.

The machine itself is somewhat old (Core 2 Duo @ 2.66 GHz, 2 GB RAM, 
single traditional HDD), but it doesn't seem like we're CPU or 
RAM-bound, though I haven't been able to capture a resource snapshot at 
the time of the error.  We have seen occasional slow disk I/O in other 
parts of the system.  Message load is extremely low at the moment: on 
the order of 100 messages / second, none of them larger than a single 
body frame.

The only things in the Rabbit logs around then are accepting/closing 
AMQP connection notices (8 are opened and 6 are closed in approximately 
the right time range).

I'm baffled: the amqp_basic_publish call doesn't hang, there's no 
network to induce latency of any sort, the consumer's sitting in a 
listen, and the server's clearly talking to the consumer!

My understanding is that when dealing solely with non-persistent 
messages, Rabbit won't hit the disk until it runs out of RAM.  Is that 
accurate?  Any ideas as to what else might cause this sort of delay, or 
suggestions on how to get further useful information?

Thanks,

-Brennan

From yogeeta.p at gmail.com  Tue Jul 24 05:00:30 2012
From: yogeeta.p at gmail.com (Yogita Patil)
Date: Tue, 24 Jul 2012 09:30:30 +0530
Subject: [rabbitmq-discuss] Publisher Confirms retries
Message-ID: <CADaq4BqHyEwzC1ZvqQDXrzwa5h9pssPTLhF80-S_P_rEFN2wNg@mail.gmail.com>

Given a publisher confirms setup,
How many times does the publisher try resending an unacknowledged message
before discarding it as dead
what is the the time interval between each  retry


Yogita.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120724/c2259e38/attachment.htm>

From heut2008 at gmail.com  Tue Jul 24 06:57:15 2012
From: heut2008 at gmail.com (heut2008)
Date: Tue, 24 Jul 2012 13:57:15 +0800
Subject: [rabbitmq-discuss] rabbitmq can't start
Message-ID: <CAPP2CaU9iPL0b+L0=ebv2G+qNcpE4JGh8WwrL=hQJunYJdOeYg@mail.gmail.com>

Hi,all

      recently,the rabbitmq running as a rpc service for openstack in
my server. it  crashes  ,then can't works ,the version is
"2.7.1-0ubuntu4",OS ubuntu12.04_x64 .
when I run rabbitmqctl list_queues
the result is

{error_logger,{{2012,7,24},{13,37,49}},"Protocol: ~p: register/listen
error: ~p~n",["inet_tcp",eaddrinuse]}
{error_logger,{{2012,7,24},{13,37,49}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,376}],[]]}
{error_logger,{{2012,7,24},{13,37,49}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqctl7779,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2012,7,24},{13,37,49}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2012,7,24},{13,37,49}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})

is it a known bug,or other reasons? any help is appreciate :).

From alexis at rabbitmq.com  Tue Jul 24 07:12:26 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 24 Jul 2012 07:12:26 +0100
Subject: [rabbitmq-discuss] can't start rabbitmq-server
In-Reply-To: <CACOPnvfFF9PD23JwjKuKRmK4Vaxr+84M0B0rG5nkRpxwMwP4Zg@mail.gmail.com>
References: <CAHAaT5uQ+zhaCO1qFLxP-kZyYXMRav=Tp3wHYFvej2TiDwA4fw@mail.gmail.com>
	<5008057F.9060003@rabbitmq.com>
	<CAHAaT5uB+jkP165sMdsXAF4OEzoa-iDZ1tiTNJ0ay-9kUHWrcQ@mail.gmail.com>
	<CACOPnvfFF9PD23JwjKuKRmK4Vaxr+84M0B0rG5nkRpxwMwP4Zg@mail.gmail.com>
Message-ID: <CACOPnvfeZSXr_f-rW5RBhty9_UP4zvy-y-siAt0WortWB5AgVw@mail.gmail.com>

Eslam

Have you been able to start RabbitMQ yet?

alexis


On Mon, Jul 23, 2012 at 10:59 AM, Alexis Richardson <alexis at rabbitmq.com>wrote:

>
>
> On Sat, Jul 21, 2012 at 11:52 PM, Eslam Mamdouh El Husseiny <
> emamdouh at cloud9ers.com> wrote:
>
>> btw normal user can start rabbitmq-server ,moreover when i'm trying to
>> start rabbitmq-server using root, the same error appears except that line
>>
>>> Only root or rabbitmq should run rabbitmq-server
>>
>>
>> any ideas ?
>>
>
> Eslam, there is not much to add to this.  Are you logged in as root?
>
>
>
>
>>
>> Thanks
>>
>> On Thu, Jul 19, 2012 at 3:02 PM, Tim Watson <tim at rabbitmq.com> wrote:
>>
>>>  On 07/19/2012 02:01 PM, Eslam Mamdouh El Husseiny wrote:
>>>
>>> hi,
>>> i have a mysterious problem with rabbitmq "2.7.1-0ubuntu4"
>>> sometimes it refuses to start and come out with this error message :
>>>
>>>> melzalabany at Ubuntu-11:web_tier$  rabbitmq-server
>>>> Only root or rabbitmq should run rabbitmq-server
>>>>
>>>
>>>
>>> That looks like the reason there: 'only root or rabbitmq should run
>>> rabbitmq-server'.....
>>>
>>>
>>>  and i resolve this error with restarting system
>>>
>>>
>>> Not sure how this helps, but perhaps I'm missing something?
>>>
>>>
>>>  So i'd like to know if there is a reason for this error and how to
>>> avoid this problem without rebooting machine
>>>
>>>
>>> Does this happen if you try and start the server the correct user?
>>>
>>
>>
>>
>> --
>> Best Regards,
>> Eslam Mamdouh El Husseiny
>> *Systems Administrator**
>> Cloud Niners Ltd.
>>
>> *
>> *Cellular: (+2) 011 198 40 40
>> Mansoura: (+2) 050 234 70 81
>> Cairo:    (+2) 022 *268 34 60
>> Fax:      (+2) 022 268 34 63
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120724/03118d47/attachment.htm>

From kuleshovmail at gmail.com  Tue Jul 24 08:06:00 2012
From: kuleshovmail at gmail.com (Alexander Kuleshov)
Date: Tue, 24 Jul 2012 00:06:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq authentication failure
Message-ID: <28add7c3-acee-4560-aadd-3e0ee8ab2ebe@googlegroups.com>

I try to connect with erlang amqp client to rabbitmq server.

I made connection params:

AMQP_Param = #amqp_params_network{
                                               host = <<"localhost">>,
                                               username = <<"guest">>
                                               password = <<"123456">>,
                                               port = 5672
                                               virtual_host = 
test_virtual_host
                                               heartbeat = 5
},

Now i run rabbitmq server and try to connect to it:

amqp_connection:start(AMQP_Param) 

But i got error:

{error,auth_failure}

How can i fix it and connect to rabbitmq?

Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120724/3eb033ba/attachment.htm>

From kuleshovmail at gmail.com  Tue Jul 24 08:16:37 2012
From: kuleshovmail at gmail.com (Alexander Kuleshov)
Date: Tue, 24 Jul 2012 00:16:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq authentication failure
In-Reply-To: <28add7c3-acee-4560-aadd-3e0ee8ab2ebe@googlegroups.com>
References: <28add7c3-acee-4560-aadd-3e0ee8ab2ebe@googlegroups.com>
Message-ID: <209b0dcd-4d9d-4c1d-8d37-0a69ea944584@googlegroups.com>

Problem with auth solved.

Now I need to give access to 'guest' user to queues. After connection i try 
to declare in/out queues and got error:

{{shutdown,{server_initiated_close,403,<<"ACCESS_REFUSED - access to queue 
'test_in_q' in vhost 'test_vhost' refused for user 'guest'">>}}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120724/f5633129/attachment.htm>

From andrea.rosa at hp.com  Tue Jul 24 09:29:16 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Tue, 24 Jul 2012 08:29:16 +0000
Subject: [rabbitmq-discuss] Rabbitmq authentication failure
In-Reply-To: <209b0dcd-4d9d-4c1d-8d37-0a69ea944584@googlegroups.com>
References: <28add7c3-acee-4560-aadd-3e0ee8ab2ebe@googlegroups.com>
	<209b0dcd-4d9d-4c1d-8d37-0a69ea944584@googlegroups.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD5A9ADEAF@G9W0721.americas.hpqcorp.net>

Hi

I think you have to add the guest user to the virtual host ?test_vhost?.
Let me know if it works
--
Andrea

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Alexander Kuleshov
Sent: 24 July 2012 08:17
To: rabbitmq-discuss at googlegroups.com
Subject: Re: [rabbitmq-discuss] Rabbitmq authentication failure

Problem with auth solved.

Now I need to give access to 'guest' user to queues. After connection i try to declare in/out queues and got error:

{{shutdown,{server_initiated_close,403,<<"ACCESS_REFUSED - access to queue 'test_in_q' in vhost 'test_vhost' refused for user 'guest'">>}}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120724/61d14757/attachment.htm>

From watson.timothy at gmail.com  Tue Jul 24 09:52:46 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 24 Jul 2012 09:52:46 +0100
Subject: [rabbitmq-discuss] rabbitmq can't start
In-Reply-To: <CAPP2CaU9iPL0b+L0=ebv2G+qNcpE4JGh8WwrL=hQJunYJdOeYg@mail.gmail.com>
References: <CAPP2CaU9iPL0b+L0=ebv2G+qNcpE4JGh8WwrL=hQJunYJdOeYg@mail.gmail.com>
Message-ID: <7E59F8B8-D597-49EB-BF3D-5E2E909EA00C@rabbitmq.com>

Hi

On 24 Jul 2012, at 06:57, heut2008 <heut2008 at gmail.com> wrote:

> Hi,all
> 
>      recently,the rabbitmq running as a rpc service for openstack in
> my server. it  crashes  ,then can't works ,the version is
> "2.7.1-0ubuntu4",OS ubuntu12.04_x64 .
> when I run rabbitmqctl list_queues
> the result is
> 
> {error_logger,{{2012,7,24},{13,37,49}},"Protocol: ~p: register/listen
> error: ~p~n",["inet_tcp",eaddrinuse]}
> {error_logger,{{2012,7,24},

You see the eaddrinuse? Something is already there. More specifically, this seems to indicate that distributed erlang node isn't able to start.

You say this is the output of rabbitmqctl after a crash?

Please explain exactly what the sequence of actions/effects looks like. What does the initial crash (before this) look like?

> {13,37,49}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,376}],[]]}
> {error_logger,{{2012,7,24},{13,37,49}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqctl7779,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2012,7,24},{13,37,49}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2012,7,24},{13,37,49}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
> Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> 
> is it a known bug,or other reasons? any help is appreciate :).
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From nimmavadiraj at gmail.com  Tue Jul 24 09:55:39 2012
From: nimmavadiraj at gmail.com (Vadiraj Hebbar)
Date: Tue, 24 Jul 2012 14:25:39 +0530
Subject: [rabbitmq-discuss] regarding time-stamp
Message-ID: <CALK6wMp0J+M5s49j9ZFSRPSKacEQtRT7xhr2PDW35sYytmpbnA@mail.gmail.com>

HI All,

how to set time-stamp flag to message in Java client  rabbitMQ.
please explain with sample code.


regards,

vadiraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120724/11f02632/attachment.htm>

From emile at rabbitmq.com  Tue Jul 24 10:12:37 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 24 Jul 2012 10:12:37 +0100
Subject: [rabbitmq-discuss] Publisher Confirms retries
In-Reply-To: <CADaq4BqHyEwzC1ZvqQDXrzwa5h9pssPTLhF80-S_P_rEFN2wNg@mail.gmail.com>
References: <CADaq4BqHyEwzC1ZvqQDXrzwa5h9pssPTLhF80-S_P_rEFN2wNg@mail.gmail.com>
Message-ID: <500E6705.7090106@rabbitmq.com>

Hi,

On 24/07/12 05:00, Yogita Patil wrote:
> Given a publisher confirms setup,
> How many times does the publisher try resending an unacknowledged
> message before discarding it as dead
> what is the the time interval between each  retry

It is up to the publisher to decide all of these questions. If confirms
have been selected on the channel then all subsequent publishes will be
acknowledged, perhaps not positively (nack is possible), perhaps not
individually (multiple ack is possible) and perhaps not immediately, but
it will be answered eventually. Unless the network fails.

If there was a network failure then it is possible for messages to
disappear. Therefore publishers should keep track of unconfirmed
messages in order to be able to resend them in case of a network failure.

The question of messages going missing and requiring resending while the
network remains running should not arise. It is not clear what failure
condition you are trying to protect against.


-Emile




From Francesco at rabbitmq.com  Tue Jul 24 10:10:09 2012
From: Francesco at rabbitmq.com (Francesco at rabbitmq.com)
Date: Tue, 24 Jul 2012 10:10:09 +0100
Subject: [rabbitmq-discuss] fine_grained_statistics
In-Reply-To: <ea7a0709-fc7c-4c6b-a632-a8d4197823a4@googlegroups.com>
References: <ea7a0709-fc7c-4c6b-a632-a8d4197823a4@googlegroups.com>
Message-ID: <87boj5iky6.wl%francesco@rabbitmq.com>

At Mon, 23 Jul 2012 10:04:23 -0700 (PDT),
justin.adam.miller at gmail.com wrote:
> Is there ever a time when fine_grained_statistics are dynamically turned off
> by the management plugin? By dynamic, I mean they're enabled by default, but
> then at some point during operation, they're shut off due to CPU load or
> throughput or some other trigger?

No.  By the way, the management plugins does not collect statistics itself, the
broker does.  So what `force_fine_statistics' does is simply to instruct the
broker to collect the fine statistics, via the `collect_statistics'
environmental variable - see http://www.rabbitmq.com/configure.html .

--
Francesco * Often in error, never in doubt

From heut2008 at gmail.com  Tue Jul 24 10:11:40 2012
From: heut2008 at gmail.com (heut2008)
Date: Tue, 24 Jul 2012 17:11:40 +0800
Subject: [rabbitmq-discuss] rabbitmq can't start
In-Reply-To: <7E59F8B8-D597-49EB-BF3D-5E2E909EA00C@rabbitmq.com>
References: <CAPP2CaU9iPL0b+L0=ebv2G+qNcpE4JGh8WwrL=hQJunYJdOeYg@mail.gmail.com>
	<7E59F8B8-D597-49EB-BF3D-5E2E909EA00C@rabbitmq.com>
Message-ID: <CAPP2CaXH-JJ5DKPJOsa2eiVNfNHMJasWGq6qiPFgz3U-aEjqHw@mail.gmail.com>

this is one of two cluster node. when I found client can't connect to
rabbitmq ,I run rabbitmqctl list_queues  shows  the above messages .

now,I killed the rabbitmq process, then restarts ,all goes well.

2012/7/24 Tim Watson <watson.timothy at gmail.com>:
> Hi
>
> On 24 Jul 2012, at 06:57, heut2008 <heut2008 at gmail.com> wrote:
>
>> Hi,all
>>
>>      recently,the rabbitmq running as a rpc service for openstack in
>> my server. it  crashes  ,then can't works ,the version is
>> "2.7.1-0ubuntu4",OS ubuntu12.04_x64 .
>> when I run rabbitmqctl list_queues
>> the result is
>>
>> {error_logger,{{2012,7,24},{13,37,49}},"Protocol: ~p: register/listen
>> error: ~p~n",["inet_tcp",eaddrinuse]}
>> {error_logger,{{2012,7,24},
>
> You see the eaddrinuse? Something is already there. More specifically, this seems to indicate that distributed erlang node isn't able to start.
>
> You say this is the output of rabbitmqctl after a crash?
>
> Please explain exactly what the sequence of actions/effects looks like. What does the initial crash (before this) look like?
>
>> {13,37,49}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,376}],[]]}
>> {error_logger,{{2012,7,24},{13,37,49}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqctl7779,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>> {error_logger,{{2012,7,24},{13,37,49}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>> {error_logger,{{2012,7,24},{13,37,49}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>> Kernel pid terminated (application_controller)
>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>>
>> is it a known bug,or other reasons? any help is appreciate :).
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From francesco at rabbitmq.com  Tue Jul 24 10:17:27 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 24 Jul 2012 10:17:27 +0100
Subject: [rabbitmq-discuss] configuring rabbit-mq server to send back a
	publisher confirm after N messages.
In-Reply-To: <1a11efe2-3ca0-4b49-aa0b-2380551ebce4@googlegroups.com>
References: <1a11efe2-3ca0-4b49-aa0b-2380551ebce4@googlegroups.com>
Message-ID: <87a9ypikm0.wl%francesco@rabbitmq.com>

At Mon, 23 Jul 2012 12:11:37 -0700 (PDT),
rohit prasad wrote:
> I am using Publisher-confirms.
> Is there any way to tell Rabbit server to send a pub-confirm after N messages.
> 
> If this is possible, then in my rabbit client , I can wait for a pub-confirm
> after sending N messages, and be sure that Rabbit server will send me a
> confirm (ack or nack) pretty soon.  Otherwise the waiting time for the
> pub-confirm becomes kind of undeterministic, we keep waiting till Rabbit feels
> like sending a confirmation. Is this configurable in any way? Or Do you
> suggest some other way to reduce the wait time for publisher-confirm acks?

I'm not sure I understand what you are saying (especially the part about
determinism), but the problem here seems that you don't want to wait for a
confirm for each message you publish.  This is easily done: you can have a
listener waiting for confirms while you publish messages in parallel.  See the
example in the blog post that introduced confirms:
http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/ , or
this Java example that waits for confirms for multiple publishes:
http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/examples/ConfirmDontLoseMessages.java
.

--
Francesco * Often in error, never in doubt

From emile at rabbitmq.com  Tue Jul 24 10:29:15 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 24 Jul 2012 10:29:15 +0100
Subject: [rabbitmq-discuss] regarding time-stamp
In-Reply-To: <CALK6wMp0J+M5s49j9ZFSRPSKacEQtRT7xhr2PDW35sYytmpbnA@mail.gmail.com>
References: <CALK6wMp0J+M5s49j9ZFSRPSKacEQtRT7xhr2PDW35sYytmpbnA@mail.gmail.com>
Message-ID: <500E6AEB.5070501@rabbitmq.com>

Hi,

On 24/07/12 09:55, Vadiraj Hebbar wrote:
> how to set time-stamp flag to message in Java client  rabbitMQ.
> please explain with sample code.

Here is an example that sets the timestamp property:

AMQP.BasicProperties props =
  new AMQP.BasicProperties.Builder().timestamp(new Date()).build();
channel.basicPublish(exchange, queue, props, payload);

If you require more control over the format and precision of your
timestamp then consider setting a header instead.


-Emile



From francesco at rabbitmq.com  Tue Jul 24 10:38:58 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 24 Jul 2012 10:38:58 +0100
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <500DACA4.206@seegrid.com>
References: <500DACA4.206@seegrid.com>
Message-ID: <878ve9ijm5.wl%francesco@rabbitmq.com>

Hi Brennan,
At Mon, 23 Jul 2012 15:57:24 -0400,
Brennan Sellner wrote:
> The rabbitmq server (v2.8.2) is running on the same machine, so there aren't
> any external networks involved.  We're still running Fedora 11 (kernel 2.6.29,
> Erlang R12B-5.8) for the moment, if that's relevant.

Please upgrade both RabbitMQ and Erlang if you can (especially rabbit), or
things will be hard to diagnose for us.

> Time 0.90: The consumer receives and responds to an AMQP heartbeat from 
> the server, and acks the delivery of a prior message.  It again drops 
> into an amqp_simple_wait_frame.

That does not sound right, heartbeats require no response.
 
> My understanding is that when dealing solely with non-persistent 
> messages, Rabbit won't hit the disk until it runs out of RAM.  Is that 
> accurate?

It is accurate, but your understanding of "runs out of RAM" might be misguided:
rabbit will start swapping to disc when the RAM used exceeds `total_ram *
vm_memory_high_watermark', where `vm_high_watermark' is a configurable
application variable, with 0.4 as default:
http://www.rabbitmq.com/configure.html .

> Any ideas as to what else might cause this sort of delay, or suggestions on
> how to get further useful information?

I would say that the most likely thing to be happening is for rabbit to start
paging to disc, so please check that first.  You can monitor your disc space
usage with the rabbitmq management plugin.

You might also be hitting flow control, but that is related to running out of
RAM.  You can check that as well via the management plugin, the connections will
be marked as "blocked".

Another option could be that you are running out of file descriptors (maybe you
have a large number of connections open?) and rabbit is blocking until some are
available.

--
Francesco * Often in error, never in doubt

From emile at rabbitmq.com  Tue Jul 24 10:44:54 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 24 Jul 2012 10:44:54 +0100
Subject: [rabbitmq-discuss] Exchange with throttling
In-Reply-To: <1ccea2bc-4d26-427f-b174-ff78de0de8c7@googlegroups.com>
References: <1ccea2bc-4d26-427f-b174-ff78de0de8c7@googlegroups.com>
Message-ID: <500E6E96.2010304@rabbitmq.com>

Hi,

On 23/07/12 18:20, F?lix wrote:
> Is there anything similar in rabbitmq?

Yes, the broker has a connection-based flow control mechanism - see
http://www.rabbitmq.com/memory.html#per-connection
and a blog post that explains further:
http://www.rabbitmq.com/blog/2012/04/17/rabbitmq-performance-measurements-part-1/

Bear in mind that blocking an Erlang process will lead to a backlog in
its internal mailbox without slowing down the network. Also, the
exchange is not a natural control point for bandwidth limiting, because
an exchange is not a process. A channel would be a more natural choice.
You may be able to adapt the existing flow control mechanism to grant
credits based on bandwidth rather than message count.



-Emile


From watson.timothy at gmail.com  Tue Jul 24 10:50:37 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 24 Jul 2012 10:50:37 +0100
Subject: [rabbitmq-discuss] rabbitmq can't start
In-Reply-To: <CAPP2CaXH-JJ5DKPJOsa2eiVNfNHMJasWGq6qiPFgz3U-aEjqHw@mail.gmail.com>
References: <CAPP2CaU9iPL0b+L0=ebv2G+qNcpE4JGh8WwrL=hQJunYJdOeYg@mail.gmail.com>
	<7E59F8B8-D597-49EB-BF3D-5E2E909EA00C@rabbitmq.com>
	<CAPP2CaXH-JJ5DKPJOsa2eiVNfNHMJasWGq6qiPFgz3U-aEjqHw@mail.gmail.com>
Message-ID: <000979CB-DC3D-4CE8-ADF5-D3C3FD7CE26C@rabbitmq.com>

Did you have another rabbitmqctl instance running at the same time by any chance, doing wait or status checks?

On 24 Jul 2012, at 10:11, heut2008 <heut2008 at gmail.com> wrote:

> this is one of two cluster node. when I found client can't connect to
> rabbitmq ,I run rabbitmqctl list_queues  shows  the above messages .
> 
> now,I killed the rabbitmq process, then restarts ,all goes well.
> 
> 2012/7/24 Tim Watson <watson.timothy at gmail.com>:
>> Hi
>> 
>> On 24 Jul 2012, at 06:57, heut2008 <heut2008 at gmail.com> wrote:
>> 
>>> Hi,all
>>> 
>>>     recently,the rabbitmq running as a rpc service for openstack in
>>> my server. it  crashes  ,then can't works ,the version is
>>> "2.7.1-0ubuntu4",OS ubuntu12.04_x64 .
>>> when I run rabbitmqctl list_queues
>>> the result is
>>> 
>>> {error_logger,{{2012,7,24},{13,37,49}},"Protocol: ~p: register/listen
>>> error: ~p~n",["inet_tcp",eaddrinuse]}
>>> {error_logger,{{2012,7,24},
>> 
>> You see the eaddrinuse? Something is already there. More specifically, this seems to indicate that distributed erlang node isn't able to start.
>> 
>> You say this is the output of rabbitmqctl after a crash?
>> 
>> Please explain exactly what the sequence of actions/effects looks like. What does the initial crash (before this) look like?
>> 
>>> {13,37,49}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,376}],[]]}
>>> {error_logger,{{2012,7,24},{13,37,49}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqctl7779,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>>> {error_logger,{{2012,7,24},{13,37,49}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>>> {error_logger,{{2012,7,24},{13,37,49}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>>> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>>> Kernel pid terminated (application_controller)
>>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>>> 
>>> is it a known bug,or other reasons? any help is appreciate :).
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From francesco at rabbitmq.com  Tue Jul 24 10:54:15 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 24 Jul 2012 10:54:15 +0100
Subject: [rabbitmq-discuss] configuring rabbit-mq server to send back
	a	publisher confirm after N messages.
In-Reply-To: <87a9ypikm0.wl%francesco@rabbitmq.com>
References: <1a11efe2-3ca0-4b49-aa0b-2380551ebce4@googlegroups.com>
	<87a9ypikm0.wl%francesco@rabbitmq.com>
Message-ID: <87629diiwo.wl%francesco@rabbitmq.com>

At Tue, 24 Jul 2012 10:17:27 +0100,
Francesco Mazzoli wrote:
> 
> At Mon, 23 Jul 2012 12:11:37 -0700 (PDT),
> rohit prasad wrote:
> > I am using Publisher-confirms.
> > Is there any way to tell Rabbit server to send a pub-confirm after N messages.
> > 
> > If this is possible, then in my rabbit client , I can wait for a pub-confirm
> > after sending N messages, and be sure that Rabbit server will send me a
> > confirm (ack or nack) pretty soon.  Otherwise the waiting time for the
> > pub-confirm becomes kind of undeterministic, we keep waiting till Rabbit feels
> > like sending a confirmation. Is this configurable in any way? Or Do you
> > suggest some other way to reduce the wait time for publisher-confirm acks?
> 
> I'm not sure I understand what you are saying (especially the part about
> determinism), [...]

It occurred to me that the comment on non-determinism might refer to the fact
that you don't have strong guarantees about the confirms (they might not reach
their target, they might arrive in bulk or not, etc.).

However, if your goal is to publish a series of messages and have the certainty
that they all reached the broker in that order, you can use AMQP transactions,
which provide you the tools to have that guarantees (and more).  However, be
aware that transactions will greatly decrease throughput. See
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.tx for more information.

--
Francesco * Often in error, never in doubt

From watson.timothy at gmail.com  Tue Jul 24 11:18:25 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 24 Jul 2012 11:18:25 +0100
Subject: [rabbitmq-discuss] rabbitmq can't start
In-Reply-To: <000979CB-DC3D-4CE8-ADF5-D3C3FD7CE26C@rabbitmq.com>
References: <CAPP2CaU9iPL0b+L0=ebv2G+qNcpE4JGh8WwrL=hQJunYJdOeYg@mail.gmail.com>
	<7E59F8B8-D597-49EB-BF3D-5E2E909EA00C@rabbitmq.com>
	<CAPP2CaXH-JJ5DKPJOsa2eiVNfNHMJasWGq6qiPFgz3U-aEjqHw@mail.gmail.com>
	<000979CB-DC3D-4CE8-ADF5-D3C3FD7CE26C@rabbitmq.com>
Message-ID: <82FF689D-81F6-4DF7-9700-F3D313B95DD3@rabbitmq.com>


On 24 Jul 2012, at 10:50, Tim Watson <watson.timothy at gmail.com> wrote:

> Did you have another rabbitmqctl instance running at the same time by any chance, doing wait or status checks?
> 

On second thoughts that shouldn't matter, as rabbitmqctl instances have a unique name. Has this issue happened before now? Do the server logs tell you anything about the time period when clients become disconnected (or unable to connect)? Also please upgrade to the latest rabbit if you can (2.8.4) as there have been numerous important bug fixes since 2.7.x releases.

> On 24 Jul 2012, at 10:11, heut2008 <heut2008 at gmail.com> wrote:
> 
>> this is one of two cluster node. when I found client can't connect to
>> rabbitmq ,I run rabbitmqctl list_queues  shows  the above messages .
>> 
>> now,I killed the rabbitmq process, then restarts ,all goes well.
>> 
>> 2012/7/24 Tim Watson <watson.timothy at gmail.com>:
>>> Hi
>>> 
>>> On 24 Jul 2012, at 06:57, heut2008 <heut2008 at gmail.com> wrote:
>>> 
>>>> Hi,all
>>>> 
>>>>    recently,the rabbitmq running as a rpc service for openstack in
>>>> my server. it  crashes  ,then can't works ,the version is
>>>> "2.7.1-0ubuntu4",OS ubuntu12.04_x64 .
>>>> when I run rabbitmqctl list_queues
>>>> the result is
>>>> 
>>>> {error_logger,{{2012,7,24},{13,37,49}},"Protocol: ~p: register/listen
>>>> error: ~p~n",["inet_tcp",eaddrinuse]}
>>>> {error_logger,{{2012,7,24},
>>> 
>>> You see the eaddrinuse? Something is already there. More specifically, this seems to indicate that distributed erlang node isn't able to start.
>>> 
>>> You say this is the output of rabbitmqctl after a crash?
>>> 
>>> Please explain exactly what the sequence of actions/effects looks like. What does the initial crash (before this) look like?
>>> 
>>>> {13,37,49}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.17.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,376}],[]]}
>>>> {error_logger,{{2012,7,24},{13,37,49}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqctl7779,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>>>> {error_logger,{{2012,7,24},{13,37,49}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>>>> {error_logger,{{2012,7,24},{13,37,49}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>>>> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>>>> Kernel pid terminated (application_controller)
>>>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>>>> 
>>>> is it a known bug,or other reasons? any help is appreciate :).
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dbuchko at vmware.com  Tue Jul 24 14:39:31 2012
From: dbuchko at vmware.com (Daniel Buchko)
Date: Tue, 24 Jul 2012 06:39:31 -0700
Subject: [rabbitmq-discuss] JSON-RPC plugin crash
In-Reply-To: <500A7609.5090102@rabbitmq.com>
References: <ju3bap$cat$1@dough.gmane.org> <50056DEF.6070005@rabbitmq.com>
	<5005729E.7020400@rabbitmq.com> <judi8l$bse$1@dough.gmane.org>
	<500A7609.5090102@rabbitmq.com>
Message-ID: <15333E71B3DDCB48A90165AD57993F2856879AA9E8@exch-mbx-114.vmware.com>

I've tried the web-stomp plugin packages with 2.8.4, seems to work fine.

Dan


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthias Radestock
Sent: Saturday, July 21, 2012 5:28 AM
To: Discussions about RabbitMQ
Cc: Matwey V. Kornilov
Subject: Re: [rabbitmq-discuss] JSON-RPC plugin crash

On 21/07/12 07:29, Matwey V. Kornilov wrote:
> Looks nice. I am failed to make it running too :( This is web-stomp 
> stuff from from hg.rabbitmq.com and rabbitmq-server 2.8.4:

Don't use the version from hg; that will only work with rabbit from hg.

Instead deploy the "binary" web-stomp plugin packages we released for 2.8.2, as show in the web-stomp article. These should work with the
2.8.4 broker, though I don't remember whether we tested that. If they don't then you'll need to install the 2.8.2 broker.

Matthias.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dbuchko at vmware.com  Tue Jul 24 14:58:38 2012
From: dbuchko at vmware.com (Daniel Buchko)
Date: Tue, 24 Jul 2012 06:58:38 -0700
Subject: [rabbitmq-discuss] pile up messages on queue
In-Reply-To: <87eho2zho5.wl%francesco@rabbitmq.com>
References: <2831333F-8100-4B2F-B964-0124F611C6BD@ll.mit.edu>
	<87eho2zho5.wl%francesco@rabbitmq.com>
Message-ID: <15333E71B3DDCB48A90165AD57993F2856879AAA78@exch-mbx-114.vmware.com>

Perhaps auto-ack is false, and you are not ack'ing the messages?  You can check the number of unack'd messages in the management console.

Dan


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Francesco Mazzoli
Sent: Monday, July 23, 2012 10:17 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] pile up messages on queue

Hi Yican,
At Mon, 23 Jul 2012 10:02:30 -0400,
Cao, Yican - 0661 - MITLL wrote:
> Hi,
> 
> I have a producer publishes messages at routing key a.b.c.
> Meantime a consumer is consume at #.
> 
> There is no problem to get those messages. But queue is piling up, 
> never been cleaned or purged.
> I'm using 2.7.1 server. 
> 
> Does anyone experience this? Thanks.
> 
> Yican Cao

It's not clear to me what you are trying to do and what the issue here.
Specifically, I'm not sure what you mean by "getting" from the queue and "cleaning" the queue.

If you are consuming from the queue, logically the messages should not appear again on the queue (unless you are rejecting them). Are you experiencing redelivery of messages that you have consumed already?

--
Francesco * Often in error, never in doubt _______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dilip.ladhani at gmail.com  Tue Jul 24 23:59:45 2012
From: dilip.ladhani at gmail.com (dilipl)
Date: Tue, 24 Jul 2012 15:59:45 -0700 (PDT)
Subject: [rabbitmq-discuss] Posting a json body as payload using the http api
Message-ID: <1343170785593-21034.post@n5.nabble.com>

Hey guys,

I can post a json message using the java client. I use the spring amqp
plugin and able to post a json using the amqpTemplate.convertAndSend call.

I know the http management api is not for heavy loads, but for a small piece
of our app, we use the http call to Rabbit. Now this worked fine, when my
payload was a simple String. It *does not work*, when I use json as the
body. I am thinking the json needs to be escaped somehow? I am actually able
to post the msg, but can't retrieve it using the rabbit console or a java
listener.

*This sample does not work*
http://localhost:55672/api/exchanges/%2F/my.exchange/publish
{
    "properties": {
        "content-type": "application/json"
    },
    "routing_key": "myKey",
    "payload": {
        "abc": "1.0",
        "deg": "XY",
        "dhi": "AB",
        "jkl": "654654",
        "mno": "CREATED",
        "pqr": "SYSTEM",
        "rst": "1.0",
        "uvw": "LOG",
        "timestamp": "07/24/2012 9:31:12"
    },
    "payload_encoding": "string"
}

*This does work*
http://localhost:55672/api/exchanges/%2F/my.exchange/publish
{
    "properties": {
        "content-type": "application/json"
    },
    "routing_key": "myKey",
    "payload": "1234",
    "payload_encoding": "string"
}



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Posting-a-json-body-as-payload-using-the-http-api-tp21034.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.nye1 at gmail.com  Wed Jul 25 02:33:59 2012
From: michael.nye1 at gmail.com (Michael Nye)
Date: Wed, 25 Jul 2012 11:33:59 +1000
Subject: [rabbitmq-discuss] Client on unreliable network best practice?
Message-ID: <CAFHLqD+wiGZEq4UtjBOKzCN9Y_X3ExveS_z18hG+Eh9Sd4wKKQ@mail.gmail.com>

Hello,

I have a C# client connecting to a RabbitMQ server over an unreliable
network connection.  It is both subscribing to and publishing messages.  If
the network connection is lost for a period of time and then brought back
online, it appears that the subscriptions will not continue to receive
messages.

What are the general "best practices" in handling this situation?  Is there
a simple property I'm missing that will auto-reconnect in these situations?
 Or must I manually check & reconnect when the network disconnection occurs?

Thanks for any help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120725/d2e168a4/attachment.htm>

From michael.nye1 at gmail.com  Wed Jul 25 03:53:57 2012
From: michael.nye1 at gmail.com (Michael Nye)
Date: Wed, 25 Jul 2012 12:53:57 +1000
Subject: [rabbitmq-discuss] Client on unreliable network best practice?
In-Reply-To: <CAFHLqD+wiGZEq4UtjBOKzCN9Y_X3ExveS_z18hG+Eh9Sd4wKKQ@mail.gmail.com>
References: <CAFHLqD+wiGZEq4UtjBOKzCN9Y_X3ExveS_z18hG+Eh9Sd4wKKQ@mail.gmail.com>
Message-ID: <CAFHLqD+PWevA3BM9CZV-wC3PeYr+khQs8Axru=yiN6wgxrpr-A@mail.gmail.com>

I should add that currently I create a ConnectionFactory, followed by a
connection & model when the client is initialized and reuse this instance
from the life of the client.

Also when a network connection drops out & comes back online, the publishes
start to fail also (usually an AlreadyClosedException with underlying C#
socket exceptions).  I would like the behaviour to make sure both
publishing & subscribing continues to work after a network failure.

On Wed, Jul 25, 2012 at 11:33 AM, Michael Nye <michael.nye1 at gmail.com>wrote:

> Hello,
>
> I have a C# client connecting to a RabbitMQ server over an unreliable
> network connection.  It is both subscribing to and publishing messages.  If
> the network connection is lost for a period of time and then brought back
> online, it appears that the subscriptions will not continue to receive
> messages.
>
> What are the general "best practices" in handling this situation?  Is
> there a simple property I'm missing that will auto-reconnect in these
> situations?  Or must I manually check & reconnect when the network
> disconnection occurs?
>
> Thanks for any help.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120725/c72123f6/attachment.htm>

From ward.mark at gmail.com  Tue Jul 24 16:31:10 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Tue, 24 Jul 2012 08:31:10 -0700 (PDT)
Subject: [rabbitmq-discuss] pull task queue design
Message-ID: <b409f5ae-bb98-4492-8b5e-dc730fef882b@googlegroups.com>



Hello,

I am fairly new to rabbitMQ and AMQP.  I am wondering if it is possible to 
build a pull task queue with task lease capabilities.  Something like the 
Google App Engine pull queue  
https://developers.google.com/appengine/docs/python/taskqueue/overview-pull.  


I am exploring the idea to have an http/rest interface between our worker 
and the server.  The server would connect rabbitMQ.  The workers are 
distributed to our client sites.  The reasoning behind this is due to being 
unsure how the persistent connection of AMQP will fair with customer?s 
firewall and proxy server configurations.  I cannot predict the 
combinations or limitations of outbound connections but typically http(s) 
80/443 are guaranteed outbound connections.

Possibly a reassurance of how well the AMQP protocol fairs across the 
internet may sway the design back to use the AMQP protocol over using the 
http/proxy idea.  The AMQP setup at the client site will need to function 
right from the start without having to involve network administrators 
altering configurations.  It would be possible for us to host rabbitMQ on 
ports 80/443.

It might be impossible if I am correct that AMQP does not provide message 
timeouts and messages are redelivered if the worker?s connection dies.  
With an http/proxy implementation the connections would have to be 
stateless.

 

-Mark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120724/3eb28c87/attachment.htm>

From ward.mark at gmail.com  Tue Jul 24 21:51:49 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Tue, 24 Jul 2012 13:51:49 -0700 (PDT)
Subject: [rabbitmq-discuss] browse queue
Message-ID: <cffe7190-5e0e-4680-af7a-a6aaa6b60f8c@googlegroups.com>

Hi,

Has there been any progress in providing a method to browse a queue?  I 
have found the "get messages" which require the messages to be requeued but 
we do not like this as a solution.   

I need a method to provide a status of the tasks we have in the queue.  
Avoid queuing tasks already queued.

What are the difficulties with browsing a queue in rabbitMQ that make this 
a complicated problem?

-Mark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120724/0fa6778c/attachment.htm>

From maf at recordedfuture.com  Wed Jul 25 06:54:24 2012
From: maf at recordedfuture.com (maf)
Date: Tue, 24 Jul 2012 22:54:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Version check when clustering?
Message-ID: <d38b20f7-4b8b-457a-8ba9-3f24b6bc727e@googlegroups.com>

Hello,

I recently tried to extend my RabbitMQ-cluster by adding a new machine. But 
when I did so the cluster crashed. To make a long story short, it turned 
out that I tried to add a node running 2.8.4 (and more modern Erlang) to a 
2.8.2 cluster, and this did not work.

I think it would be a good idea if the nodes checked that they are the same 
version when setting up the cluster and give an error message otherwise, or 
if it supposed to work then make it work. Having the cluster die when you 
try to add a new node seems a bit user-unfriendly :)

    /MaF
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120724/e29fda9f/attachment.htm>

From mitsuoyazawa at gmail.com  Tue Jul 24 16:20:11 2012
From: mitsuoyazawa at gmail.com (Mitsuo Yazawa)
Date: Tue, 24 Jul 2012 09:20:11 -0600
Subject: [rabbitmq-discuss] Configuration Loss
Message-ID: <981430FEFB0C4BB2AAE43E6ABE206601@SakuraPC>

Hi Rabbitmq team,

  I had a complete system configured, all was working perfectly between server and its nodes.
  but our rabbitmq server crashed, I ran all the updates possible to the server, and for some weird reason, our configuration in the server configured in web ui was lost. 
  my questions are, how could this happened?
  is there a way we can backup all this configuration and deploy it faster in case it happens again?
  were to look at, when this happens, to see what went wrong?
  how to prevent this anomaly?

  I tried to replicate the issue, with no success. but still, we want to be prepared for this situation in the future.

thanks
Mitsuo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120724/96b75099/attachment.htm>

From videlalvaro at gmail.com  Wed Jul 25 09:01:12 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 25 Jul 2012 10:01:12 +0200
Subject: [rabbitmq-discuss] Configuration Loss
In-Reply-To: <981430FEFB0C4BB2AAE43E6ABE206601@SakuraPC>
References: <981430FEFB0C4BB2AAE43E6ABE206601@SakuraPC>
Message-ID: <CAMcAHLVdWQ=OE84h4w1BOpTqLgMeGtMAH42EkkimnAXnR7-05w@mail.gmail.com>

On the main page of the Management Plugin you have a form that allows you
to export your current configuration as JSON and import it later. Not sure
if that will work for you.

-Alvaro

On Tue, Jul 24, 2012 at 5:20 PM, Mitsuo Yazawa <mitsuoyazawa at gmail.com>wrote:

>   Hi Rabbitmq team,
>
>
> I had a complete system configured, all was working perfectly between
> server and its nodes.
> but our rabbitmq server crashed, I ran all the updates possible to the
> server, and for some weird reason, our configuration in the server
> configured in web ui was lost.
>
>  my questions are, how could this happened?
> is there a way we can backup all this configuration and deploy it faster
> in case it happens again?
> were to look at, when this happens, to see what went wrong?
> how to prevent this anomaly?
>
> I tried to replicate the issue, with no success. but still, we want to be
> prepared for this situation in the future.
>
>
> thanks
> Mitsuo
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120725/74dc4eeb/attachment.htm>

From emile at rabbitmq.com  Wed Jul 25 09:46:56 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 25 Jul 2012 09:46:56 +0100
Subject: [rabbitmq-discuss] browse queue
In-Reply-To: <cffe7190-5e0e-4680-af7a-a6aaa6b60f8c@googlegroups.com>
References: <cffe7190-5e0e-4680-af7a-a6aaa6b60f8c@googlegroups.com>
Message-ID: <500FB280.4050507@rabbitmq.com>

Hi Mark,

On 24/07/12 21:51, Mark Ward wrote:
> Has there been any progress in providing a method to browse a queue?

The release notes will indicate whether a particular feature has been
completed, or the changelog for major features:
http://www.rabbitmq.com/changelog.html

Explicit support for queue browsing is not a supported feature at this
time (v2.8.4).

> I need a method to provide a status of the tasks we have in the queue.  
> Avoid queuing tasks already queued.

Note that this solution presupposes that you can pause the queue
in-between browsing the queue and enqueuing the new task. Without this
the state of the queue might change between these two events.

> What are the difficulties with browsing a queue in rabbitMQ that make
> this a complicated problem?

The design of RabbitMQ queues assume that they are only ever read from
the head, one item at a time, and this is a destructive operation. A
read message can be requeued, but then it will subsequently show as
redelivered.

As alternative options you can possibly implement your own message store
(e.g. on top of a database) and use it as an approximation of the state
of the queue.

Another alternative is to consume and requeue or republish every message
in the queue. This operation will have some performance implications,
depending on the length of the queue.



-Emile



From francesco at rabbitmq.com  Wed Jul 25 10:06:09 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 25 Jul 2012 10:06:09 +0100
Subject: [rabbitmq-discuss] Version check when clustering?
In-Reply-To: <d38b20f7-4b8b-457a-8ba9-3f24b6bc727e@googlegroups.com>
References: <d38b20f7-4b8b-457a-8ba9-3f24b6bc727e@googlegroups.com>
Message-ID: <87d33k43cu.wl%francesco@rabbitmq.com>

At Tue, 24 Jul 2012 22:54:24 -0700 (PDT),
maf wrote:
> Hello,
> 
> I recently tried to extend my RabbitMQ-cluster by adding a new machine. But
> when I did so the cluster crashed. To make a long story short, it turned out
> that I tried to add a node running 2.8.4 (and more modern Erlang) to a 2.8.2
> cluster, and this did not work.
> 
> I think it would be a good idea if the nodes checked that they are the same
> version when setting up the cluster and give an error message otherwise, or if
> it supposed to work then make it work. Having the cluster die when you try to
> add a new node seems a bit user-unfriendly :)

You're right, and we implemented this changes already - they'll be part of some
future release.

--
Francesco * Often in error, never in doubt

From emile at rabbitmq.com  Wed Jul 25 10:11:06 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 25 Jul 2012 10:11:06 +0100
Subject: [rabbitmq-discuss] Posting a json body as payload using the
 http api
In-Reply-To: <1343170785593-21034.post@n5.nabble.com>
References: <1343170785593-21034.post@n5.nabble.com>
Message-ID: <500FB82A.1060305@rabbitmq.com>

Hi,

On 24/07/12 23:59, dilipl wrote:
> [...] Now this worked fine, when my
> payload was a simple String. It *does not work*, when I use json as the
> body. I am thinking the json needs to be escaped somehow?

You may have answered your own question. The payload can be a string or
base64 encoded and the payload_encoding key must be set accordingly.
Either encode the body as base64 or escape the contents and supply it as
a string. Any good JSON reference should provide string escape rules.

-Emile


From francesco at rabbitmq.com  Wed Jul 25 10:15:23 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 25 Jul 2012 10:15:23 +0100
Subject: [rabbitmq-discuss] Configuration Loss
In-Reply-To: <981430FEFB0C4BB2AAE43E6ABE206601@SakuraPC>
References: <981430FEFB0C4BB2AAE43E6ABE206601@SakuraPC>
Message-ID: <87boj442xg.wl%francesco@rabbitmq.com>

At Tue, 24 Jul 2012 09:20:11 -0600,
Mitsuo Yazawa wrote:
> Hi Rabbitmq team,
> 
>     I had a complete system configured, all was working perfectly between
>     server and its nodes.
>     but our rabbitmq server crashed, I ran all the updates possible to the
>     server, and for some weird reason, our configuration in the server
>     configured in web ui was lost.
> 
>     my questions are, how could this happened?
>     is there a way we can backup all this configuration and deploy it faster
>     in case it happens again?
>     were to look at, when this happens, to see what went wrong?
>     how to prevent this anomaly?
>      
>     I tried to replicate the issue, with no success. but still, we want to be
>     prepared for this situation in the future.

What do you mean with "configuration"?  The configuration described here
http://www.rabbitmq.com/configure.html is in a user-created file, so that won't
be affected by server crashes.

If you mean that you lost all the non-durable resources (e.g. queues), there
isn't much you can do about that apart from having the creation process
automated by some code, which is usually the case - instead of creating them
manually with the management plugin.

You can also export the definition as Alvaro said, but in my opinion that's
quite a brittle solution.

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Wed Jul 25 10:41:31 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 25 Jul 2012 10:41:31 +0100
Subject: [rabbitmq-discuss] Configuration Loss
In-Reply-To: <87boj442xg.wl%francesco@rabbitmq.com>
References: <981430FEFB0C4BB2AAE43E6ABE206601@SakuraPC>
	<87boj442xg.wl%francesco@rabbitmq.com>
Message-ID: <87a9yo41pw.wl%francesco@rabbitmq.com>

At Wed, 25 Jul 2012 10:15:23 +0100,
Francesco Mazzoli wrote:
> You can also export the definition as Alvaro said, but in my opinion that's
> quite a brittle solution.

Just to clarify, I did not mean that exporting the definitions is unreliable,
but that it's better to have a way to automate resource creation that doing a
backup afterwards.

--
Francesco * Often in error, never in doubt

From yogeeta.p at gmail.com  Wed Jul 25 11:01:16 2012
From: yogeeta.p at gmail.com (Yogita Patil)
Date: Wed, 25 Jul 2012 15:31:16 +0530
Subject: [rabbitmq-discuss] Publisher Confirms retries
In-Reply-To: <CADaq4BpAEZ=s-yvibX8Ytc=Bn0J6NPG8yk6tv+a4h5Wd72vrGw@mail.gmail.com>
References: <CADaq4BqHyEwzC1ZvqQDXrzwa5h9pssPTLhF80-S_P_rEFN2wNg@mail.gmail.com>
	<500E6705.7090106@rabbitmq.com>
	<CADaq4BpAEZ=s-yvibX8Ytc=Bn0J6NPG8yk6tv+a4h5Wd72vrGw@mail.gmail.com>
Message-ID: <CADaq4Borrt+zHvZL5eYJBbtwgadmRhBGxiC4f2t_3k3vqzokmA@mail.gmail.com>

>
> Thanks Emile
>
> Is there any API that supports this feature?
>
> I searched a lot on the internet but couldn't find anything substantial.
>
> Regards,
> Yogita
>
>
> On Tue, Jul 24, 2012 at 2:42 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>
>> Hi,
>>
>> On 24/07/12 05:00, Yogita Patil wrote:
>> > Given a publisher confirms setup,
>> > How many times does the publisher try resending an unacknowledged
>> > message before discarding it as dead
>> > what is the the time interval between each  retry
>>
>> It is up to the publisher to decide all of these questions. If confirms
>> have been selected on the channel then all subsequent publishes will be
>> acknowledged, perhaps not positively (nack is possible), perhaps not
>> individually (multiple ack is possible) and perhaps not immediately, but
>> it will be answered eventually. Unless the network fails.
>>
>> If there was a network failure then it is possible for messages to
>> disappear. Therefore publishers should keep track of unconfirmed
>> messages in order to be able to resend them in case of a network failure.
>>
>> The question of messages going missing and requiring resending while the
>> network remains running should not arise. It is not clear what failure
>> condition you are trying to protect against.
>>
>>
>> -Emile
>>
>>
>>
>>
>
>
> --
> Regards,
> Yogita.
>



-- 
Regards,
Yogita.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120725/3c35afa2/attachment.htm>

From majek04 at gmail.com  Wed Jul 25 11:20:55 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 25 Jul 2012 11:20:55 +0100
Subject: [rabbitmq-discuss] pull task queue design
In-Reply-To: <b409f5ae-bb98-4492-8b5e-dc730fef882b@googlegroups.com>
References: <b409f5ae-bb98-4492-8b5e-dc730fef882b@googlegroups.com>
Message-ID: <CABzX+qwxzcw_1Y9MN3xu8gMUMXcjGyLcGDgCrv0s7fN8RpAW7w@mail.gmail.com>

On Tue, Jul 24, 2012 at 4:31 PM, Mark Ward <ward.mark at gmail.com> wrote:
> Hello,
>
> I am fairly new to rabbitMQ and AMQP.  I am wondering if it is possible to
> build a pull task queue with task lease capabilities.  Something like the
> Google App Engine pull queue
> https://developers.google.com/appengine/docs/python/taskqueue/overview-pull.

I strongly recommend taking a look at RabbitMQ tutorials:
    http://www.rabbitmq.com/getstarted.html

Second tutorial explains how RabbitMQ deals with "tasks" and "acknowledgments"
(similar to leases):
  http://www.rabbitmq.com/tutorials/tutorial-two-python.html

In rabbitmq you can't do time based 'leases', but 'acknowledgemnts'
are a similar concept, only without an explicit timeout.

> I am exploring the idea to have an http/rest interface between our worker
> and the server.  The server would connect rabbitMQ.  The workers are
> distributed to our client sites.  The reasoning behind this is due to being
> unsure how the persistent connection of AMQP will fair with customer?s
> firewall and proxy server configurations.  I cannot predict the combinations
> or limitations of outbound connections but typically http(s) 80/443 are
> guaranteed outbound connections.
>
> Possibly a reassurance of how well the AMQP protocol fairs across the
> internet may sway the design back to use the AMQP protocol over using the
> http/proxy idea.  The AMQP setup at the client site will need to function
> right from the start without having to involve network administrators
> altering configurations.  It would be possible for us to host rabbitMQ on
> ports 80/443.

Exposing AMQP protocol to the wide internet is not a recommended setup.
You would be better off by creating a custom application that would pull
messages from rabbitmq and expose them over http or something.

You might want to take a look at SockJS (http://sockjs.org) and
RabbitMQ-Web-Stomp plugin:
    http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/

> It might be impossible if I am correct that AMQP does not provide message
> timeouts

AMQP does not provide message timeouts. But RabbitMQ has an extension
for that: http://www.rabbitmq.com/extensions.html#lifetimes

> and messages are redelivered if the worker?s connection dies

Correct. Unacknowledged messages will be redelivered when the client
connection dies, or when the client explicitly rejects them.

>  With an http/proxy implementation the connections would have to be stateless.


Marek

From emile at rabbitmq.com  Wed Jul 25 11:28:02 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 25 Jul 2012 11:28:02 +0100
Subject: [rabbitmq-discuss] Publisher Confirms retries
In-Reply-To: <CADaq4Borrt+zHvZL5eYJBbtwgadmRhBGxiC4f2t_3k3vqzokmA@mail.gmail.com>
References: <CADaq4BqHyEwzC1ZvqQDXrzwa5h9pssPTLhF80-S_P_rEFN2wNg@mail.gmail.com>
	<500E6705.7090106@rabbitmq.com>
	<CADaq4BpAEZ=s-yvibX8Ytc=Bn0J6NPG8yk6tv+a4h5Wd72vrGw@mail.gmail.com>
	<CADaq4Borrt+zHvZL5eYJBbtwgadmRhBGxiC4f2t_3k3vqzokmA@mail.gmail.com>
Message-ID: <500FCA32.3010106@rabbitmq.com>


Hi,

On 25/07/12 11:01, Yogita Patil wrote:
>     Is there any API that supports this feature?

If you mean a library that wraps up the storing of published messages
awaiting confirmation, then no, I'm not aware of any. But most libraries
should allow you to request confirms on a channel and register a
confirmation callback, which are the essential ingredients to the
solution and making use of these directly should be simple enough.

-Emile


From tim at rabbitmq.com  Wed Jul 25 12:25:07 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 25 Jul 2012 12:25:07 +0100
Subject: [rabbitmq-discuss] Security Exception in IIS using RabbitMQ
	Client
In-Reply-To: <CE935BAB-1E50-4A86-8365-7629CFF533AF@rabbitmq.com>
References: <1bf0da2d77a8dde3045f42fbb98de912@mail.gmail.com>
	<9D0B20A0-D068-4BB5-89F3-161E53F96D03@rabbitmq.com>
	<C5A285C7-9D90-4177-B952-8042A49534DA@rabbitmq.com>
	<5ccfe77e7c0675abad274e4ca06a91ce@mail.gmail.com>
	<4FF1DB3B-E711-4E36-BD47-7E5D2BF332A6@rabbitmq.com>
	<CE935BAB-1E50-4A86-8365-7629CFF533AF@rabbitmq.com>
Message-ID: <500FD793.3080309@rabbitmq.com>

On 07/20/2012 11:39 PM, Tim Watson wrote:
> I've tried setting<trust level="Full" originUrl="" />  in the web.config,
> but it doesn't seem to help.

You haven't come back to me, so I'm assuming you figure out how to do 
this? On my local machine, I ended up editing the trust levels using the 
IIS (7) configuration manager and this worked fine. I also note that the 
RabbitMQ.Client assembly will not work at all in a partial trust 
environment, so having Full Trust is going to be a pre-requisite anyway.

From emile at rabbitmq.com  Wed Jul 25 12:41:08 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 25 Jul 2012 12:41:08 +0100
Subject: [rabbitmq-discuss] Federation configuration for clusters -
	failover
In-Reply-To: <CC32D72C.36B0%Michael.Laing@nytimes.com>
References: <CC32D72C.36B0%Michael.Laing@nytimes.com>
Message-ID: <500FDB54.70402@rabbitmq.com>

Hi,

On 23/07/12 15:25, Laing, Michael P. wrote:
> I currently have the same configuration for each node in the cluster. Is
> this correct?

Yes.

> Also, what is the expected behavior when a node in the cluster goes
> down? If it is the node on which the federation plugin has created its
> queues etc, I would think it should recreate them on another node and
> keep on going. We will test this but it would be nice to know what to

Yes, the federation link will be re-established from another node in the
cluster. You can determine the active node by inspecting the 'status'
field in the output of

rabbitmqctl eval 'rabbit_federation_status:status().'

> expect. Perhaps we should we set the HA option? Currently losing
> messages is not an issue for us but en futuro it will be as we implement
> high volume applications.

If you are concerned about losing messages after they get routed to
queues then you should use HA.


-Emile

From Michael.Laing at nytimes.com  Wed Jul 25 14:14:03 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Wed, 25 Jul 2012 09:14:03 -0400
Subject: [rabbitmq-discuss] Federation configuration for clusters -
 failover
In-Reply-To: <500FDB54.70402@rabbitmq.com>
Message-ID: <CC356910.376C%Michael.Laing@nytimes.com>

Thanks! -ml

On 7/25/12 7:41 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:

>Hi,
>
>On 23/07/12 15:25, Laing, Michael P. wrote:
>> I currently have the same configuration for each node in the cluster. Is
>> this correct?
>
>Yes.
>
>> Also, what is the expected behavior when a node in the cluster goes
>> down? If it is the node on which the federation plugin has created its
>> queues etc, I would think it should recreate them on another node and
>> keep on going. We will test this but it would be nice to know what to
>
>Yes, the federation link will be re-established from another node in the
>cluster. You can determine the active node by inspecting the 'status'
>field in the output of
>
>rabbitmqctl eval 'rabbit_federation_status:status().'
>
>> expect. Perhaps we should we set the HA option? Currently losing
>> messages is not an issue for us but en futuro it will be as we implement
>> high volume applications.
>
>If you are concerned about losing messages after they get routed to
>queues then you should use HA.
>
>
>-Emile


From zmstone at gmail.com  Wed Jul 25 16:14:07 2012
From: zmstone at gmail.com (stone)
Date: Wed, 25 Jul 2012 17:14:07 +0200
Subject: [rabbitmq-discuss] help - design pattern for an our use case
In-Reply-To: <50069C99.2010607@rabbitmq.com>
References: <CAEMO9cBFeuTCn-fbftXjGeGTBY2vRXBQEKr3mpk4sDVo+7G5KA@mail.gmail.com>
	<50069C99.2010607@rabbitmq.com>
Message-ID: <CAPNZrFWW2eOTzx-n5JpdX1v1rVvG8exSeLTG90+Cod4CRPvH8A@mail.gmail.com>

Hi

Sorry to hijack this topic, but I'm pretty interested in the topic name
Emile gave in the examples.
It looks like the topic is named from big to small. i.e. bigger topic comes
first then dot then smaller ones.
Is there a specific reason behind this naming convention?
like in routing performance perspective? is it better than the other way
around?
If for example, we have big medium and small, and there is a binding for
"big every thing" is "big.#" better than "#.big" ?

-Stone

On Wed, Jul 18, 2012 at 1:23 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 18/07/12 06:41, Bhaskar teja wrote:
> > What is a good design pattern for our use case - like number of queues?,
> > exchange type?, number of exchanges( web, e-mail ) ??
>
> This looks like a potential application of topics and a topic exchange.
> Allocate a queue for each user. Bind each user queue with appropriate
> routing keys. So a queue for user "alice" belonging to two communities
> might have these bindings:
>
> users.alice
> communities.pet-owners
> communities.music-collectors
>
> When "alice" takes an action that her communities may be interested in
> then a message must be sent to the topic exchange with a routing key for
> each of the communities that she belongs to. It is possible to do this
> in a single operation using CC routing. See
> http://www.rabbitmq.com/extensions.html#sender-selected-distribution
>
> Depending on the complexity of when groups are notified you could
> implement groups as sub-topics, so a group within pet-owners might be:
>
> communities.pet-owners.dog-lovers
>
> Depending on the rules for email notifications you could use a
> combination of dead letter exchanges and queue-TTL to detect when
> notifications have been waiting in the queue for too long and send them
> to the user by email. See:
>
> http://www.rabbitmq.com/extensions.html#dead-letter-exchanges
> http://www.rabbitmq.com/extensions.html#queue-ttl
>
> A possible problem with this design is the large number of bindings
> involved. This could be slow and difficult to manage, depending on the
> branching factor. You could contain the complexity by using
> exchange-to-exchange bindings and internal exchanges for groups (and
> communities).
>
> -Emile
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120725/a09432f6/attachment.htm>

From emile at rabbitmq.com  Wed Jul 25 17:05:36 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 25 Jul 2012 17:05:36 +0100
Subject: [rabbitmq-discuss] help - design pattern for an our use case
In-Reply-To: <CAPNZrFWW2eOTzx-n5JpdX1v1rVvG8exSeLTG90+Cod4CRPvH8A@mail.gmail.com>
References: <CAEMO9cBFeuTCn-fbftXjGeGTBY2vRXBQEKr3mpk4sDVo+7G5KA@mail.gmail.com>
	<50069C99.2010607@rabbitmq.com>
	<CAPNZrFWW2eOTzx-n5JpdX1v1rVvG8exSeLTG90+Cod4CRPvH8A@mail.gmail.com>
Message-ID: <50101950.7070206@rabbitmq.com>

Hi,

On 25/07/12 16:14, stone wrote:
> Is there a specific reason behind this naming convention?
> like in routing performance perspective? is it better than the other way
> around?
> If for example, we have big medium and small, and there is a binding for
> "big every thing" is "big.#" better than "#.big" ?

You are free to use any convention you like, within the constraints
imposed by the rules. The example was crafted to match the question, so
don't read too much into it.

I don't think there is a performance difference between leading or
trailing wildcards. If you are concerned about routing performance then
avoid topic exchanges. The additional work makes them slower than other
exchanges. For small numbers of topics you may be able to use bindings
to achieve the same effect.


-Emile


From blueskiwi at gmail.com  Wed Jul 25 13:27:08 2012
From: blueskiwi at gmail.com (Anentropic)
Date: Wed, 25 Jul 2012 05:27:08 -0700 (PDT)
Subject: [rabbitmq-discuss] 2.7.1, "rabbitmq-plugins: command not found"
Message-ID: <190e8be1-63df-4b4a-bfa9-0617370836ab@googlegroups.com>

I am on Ubuntu 12.04

I installed rabbitmq via `*sudo apt-get install rabbitmq-server`*
*
*
As a result I have version 2.7.1 up and working.*
*

Now I want to install the web management interface, but I have the 
following problem:

$ sudo rabbitmq-plugins enable rabbitmq_management
sudo: rabbitmq-plugins: command not found

It's my understanding that 2.7.1 is new enough that it should have this 
command?

thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120725/b3a39ef9/attachment.htm>

From mpietrek at skytap.com  Wed Jul 25 19:48:56 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 25 Jul 2012 11:48:56 -0700
Subject: [rabbitmq-discuss] One node in a cluster never fully starts up
Message-ID: <CACLE7ixg=3z1DRg+jZVrwfULrkJiFbNWA15UQP1_QFbHo_N6ng@mail.gmail.com>

We have a 3 node cluster (mq1, mq2, mq3) running 2.8.4 supporting a small
number of HA queues. During startup of the cluster, we start all nodes in
parallel. Usually everything works fine. However, we've just recently seen
one of the nodes (mq3) won't start, i.e., the rabbitmqctl wait <pid>
doesn't complete.

I can log in to the management UI on mq1 and mq2, so they're at least
minimally running.

Luckily, we've turned on verbose Mnesia logging. here's what the failing
node (mq3) shows in the console spew:

Activating RabbitMQ plugins ...
6 plugins activated:
* amqp_client-0.0.0
* mochiweb-1.3-rmq0.0.0-git
* rabbitmq_management-0.0.0
* rabbitmq_management_agent-0.0.0
* rabbitmq_mochiweb-0.0.0
* webmachine-1.7.0-rmq0.0.0-hg
Mnesia(rabbit at mq3): mnesia_monitor starting: <0.54.0>
Mnesia(rabbit at mq3): Version: "4.4.12"
Mnesia(rabbit at mq3): Env access_module: mnesia
Mnesia(rabbit at mq3): Env dir: "/highland/var/lib/rabbit at mq3"
Mnesia(rabbit at mq3): Env dump_log_load_regulation: false
Mnesia(rabbit at mq3): Env dump_log_time_threshold: 180000
Mnesia(rabbit at mq3): Env dump_log_update_in_place: true
Mnesia(rabbit at mq3): Env dump_log_write_threshold: 1000
Mnesia(rabbit at mq3): Env event_module: mnesia_event
Mnesia(rabbit at mq3): Env core_dir: false
Mnesia(rabbit at mq3): Env no_table_loaders: 2
Mnesia(rabbit at mq3): Env dc_dump_limit: 4
Mnesia(rabbit at mq3): Mnesia debug level set to trace
Mnesia(rabbit at mq3): mnesia_subscr starting: <0.55.0>
Mnesia(rabbit at mq3): mnesia_locker starting: <0.56.0>
Mnesia(rabbit at mq3): mnesia_late_loader starting: <0.86.0>
Mnesia(rabbit at mq3): Cannot get cstructs, Node rabbit at mq2 {node_not_running,
Mnesia(rabbit at mq3): Transaction log dump skipped (optional): schema_prepare
Mnesia(rabbit at mq3): Transaction log dump skipped (optional): schema_prepare
Mnesia(rabbit at mq3): mnesia_downs = []
                                           {rabbit_exchange,ram_only},
                                           {rabbit_semi_durable_route,
                                            ram_only},
                                           {rabbit_listener,ram_only},
                                           {gm_group,ram_only}]
Mnesia(rabbit at mq3): Table rabbit_route is loaded on
rabbit at mq1.s=ram_copies, r=nowhere, lc=false, f=false, m=true
Mnesia(rabbit at mq3): Getting table rabbit_user_permission (disc_copies) from
node rabbit at mq1: {active_remote,

rabbit at mq1}
Mnesia(rabbit at mq3): Table rabbit_semi_durable_route is loaded on
rabbit at mq1.s=ram_copies, r=nowhere, lc=false, f=false, m=true
Mnesia(rabbit at mq3): Table rabbit_queue is loaded on
rabbit at mq2.s=ram_copies, r=nowhere, lc=false, f=false, m=true
Mnesia(rabbit at mq3): Table rabbit_route is loaded on
rabbit at mq2.s=ram_copies, r=nowhere, lc=false, f=false, m=true
last message repeated 2 times
|   +---+   +-------+
|                   |
starting file handle cache server
...done
Mnesia(rabbit at mq3): Restarting transaction {tid,3657,<0.181.0>}: in 128ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3657,<0.181.0>}: in 236ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Sync serial {tid,3657,<0.181.0>}
Mnesia(rabbit at mq3): Restarting transaction {tid,3657,<0.181.0>}: in 488ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3657,<0.181.0>}: in 519ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
{aborted,nomore}
Mnesia(rabbit at mq3): Getting table rabbit_durable_exchange (disc_copies)
from node rabbit at mq1: {active_remote,
Mnesia(rabbit at mq3): Restarting transaction {tid,3732,<0.181.0>}: in 115ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3732,<0.181.0>}: in 111ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3732,<0.181.0>}: in 168ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Sync serial {tid,3732,<0.181.0>}
Mnesia(rabbit at mq3): Restarting transaction {tid,3732,<0.181.0>}: in 361ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3732,<0.181.0>}: in 481ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3732,<0.181.0>}: in 552ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3732,<0.181.0>}: in 538ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3732,<0.181.0>}: in 226ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3732,<0.181.0>}: in 327ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3732,<0.181.0>}: in 313ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3732,<0.181.0>}: in 326ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3732,<0.181.0>}: in 763ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Transaction {tid,3732,<0.181.0>} calling
#Fun<mnesia_loader.0.79080158> with [] failed:
{aborted,nomore}
Mnesia(rabbit at mq3): Getting table rabbit_durable_exchange (disc_copies)
from node rabbit at mq2: {active_remote,

rabbit at mq1}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 8ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 34ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 54ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 80ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 180ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 85ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 201ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 167ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 385ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 315ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Sync serial {tid,3733,<0.181.0>}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 237ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 165ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 197ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 496ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 348ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 325ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 412ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 585ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3733,<0.181.0>}: in 365ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Transaction {tid,3733,<0.181.0>} calling
#Fun<mnesia_loader.0.79080158> with [] failed:
{aborted,nomore}
Mnesia(rabbit at mq3): Getting table rabbit_durable_exchange (disc_copies)
from node rabbit at mq1: {active_remote,

rabbit at mq1}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 7ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 21ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 34ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 74ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 89ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 125ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 241ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 249ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 195ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 317ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Sync serial {tid,3734,<0.181.0>}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 421ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 210ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 447ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 213ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 425ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 261ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 440ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 620ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Restarting transaction {tid,3734,<0.181.0>}: in 367ms
{cyclic,rabbit at mq3
,{schema,rabbit_durable_exchange},read,read,{tid,3654,<0.175.0>}}
Mnesia(rabbit at mq3): Transaction {tid,3734,<0.181.0>} calling
#Fun<mnesia_loader.0.79080158> with [] failed:
{aborted,nomore}

The pattern of "Getting table rabbit_durable_exchange (disc_copies) from
node rabbit at mq1:" cycles between mq1 and mq2 repeatedly until I kill mq3.

What other sort of information can I provide or look for when this
situation repeats?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120725/7dfc9e3e/attachment.htm>

From michael.s.klishin at gmail.com  Wed Jul 25 20:36:47 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 25 Jul 2012 23:36:47 +0400
Subject: [rabbitmq-discuss] 2.7.1, "rabbitmq-plugins: command not found"
In-Reply-To: <190e8be1-63df-4b4a-bfa9-0617370836ab@googlegroups.com>
References: <190e8be1-63df-4b4a-bfa9-0617370836ab@googlegroups.com>
Message-ID: <AB0E1038-D9FF-4947-BE75-F138678F30B5@gmail.com>

Anentropic:

> Now I want to install the web management interface, but I have the following problem:
> 
> $ sudo rabbitmq-plugins enable rabbitmq_management
> sudo: rabbitmq-plugins: command not found
> 
> It's my understanding that 2.7.1 is new enough that it should have this command?

rabbitmq-plugins is new in 2.8.

There is an official apt repository you can get 2.8 from:
http://www.rabbitmq.com/install-debian.html

MK

michael at defprotocol.org

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 841 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120725/0be0d095/attachment.pgp>

From hcoyote at ghostar.org  Wed Jul 25 21:47:08 2012
From: hcoyote at ghostar.org (Travis)
Date: Wed, 25 Jul 2012 15:47:08 -0500
Subject: [rabbitmq-discuss] 2.7.1, "rabbitmq-plugins: command not found"
In-Reply-To: <AB0E1038-D9FF-4947-BE75-F138678F30B5@gmail.com>
References: <190e8be1-63df-4b4a-bfa9-0617370836ab@googlegroups.com>
	<AB0E1038-D9FF-4947-BE75-F138678F30B5@gmail.com>
Message-ID: <CAChq9g0dxoiDm5O40rg6oSBPdPpDgvW4sJfUyubduHYxXOs23g@mail.gmail.com>

On Wed, Jul 25, 2012 at 2:36 PM, Michael Klishin
<michael.s.klishin at gmail.com> wrote:
> Anentropic:
>
>> Now I want to install the web management interface, but I have the following problem:
>>
>> $ sudo rabbitmq-plugins enable rabbitmq_management
>> sudo: rabbitmq-plugins: command not found
>>
>> It's my understanding that 2.7.1 is new enough that it should have this command?
>
> rabbitmq-plugins is new in 2.8.

I have it on my copy of 2.7.1.

: :( 1 1s-tcampbell at aus-svc3 { ~ }:;
:;  sudo rabbitmq-plugins  list
[e] amqp_client                       0.0.0
[ ] eldap                             0.0.0-git
[ ] erlando                           0.0.0
[e] mochiweb                          1.3-rmq0.0.0-git
[ ] rabbitmq_auth_backend_ldap        0.0.0
[ ] rabbitmq_auth_mechanism_ssl       0.0.0
[ ] rabbitmq_consistent_hash_exchange 0.0.0
[ ] rabbitmq_federation               0.0.0
[ ] rabbitmq_jsonrpc                  0.0.0
[ ] rabbitmq_jsonrpc_channel          0.0.0
[ ] rabbitmq_jsonrpc_channel_examples 0.0.0
[E] rabbitmq_management               0.0.0
[e] rabbitmq_management_agent         0.0.0
[ ] rabbitmq_management_visualiser    0.0.0
[e] rabbitmq_mochiweb                 0.0.0
[ ] rabbitmq_shovel                   0.0.0
[ ] rabbitmq_shovel_management        0.0.0
[ ] rabbitmq_stomp                    0.0.0
[ ] rabbitmq_tracing                  0.0.0
[ ] rfc4627_jsonrpc                   0.0.0-git
[e] webmachine                        1.7.0-rmq0.0.0-hg

: :) 1s-tcampbell at aus-svc3 { ~ }:;
:;  rpm -qa | grep rabbitmq-server
rabbitmq-server-2.7.1-2

: :) 1s-tcampbell at aus-svc3 { ~ }:;
:;  which rabbitmq-plugins
/usr/sbin/rabbitmq-plugins

Sounds more like a $PATH problem.  Check to see if it's in /usr/sbin.

Travis
-- 
Travis Campbell
travis at ghostar.org

From wizaerd at gmail.com  Wed Jul 25 23:14:14 2012
From: wizaerd at gmail.com (Wizaerd)
Date: Wed, 25 Jul 2012 15:14:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Looking for some specific & complete C#
	examples
In-Reply-To: <a0c75a8f-42b8-4a68-ac61-31ee931a4db0@googlegroups.com>
References: <0fa4a463-7dfc-45f5-8772-3b680cb0e53a@googlegroups.com>
	<a0c75a8f-42b8-4a68-ac61-31ee931a4db0@googlegroups.com>
Message-ID: <9d6fa008-8062-453b-8008-8ba7ac882561@googlegroups.com>

I took a look, and the first thing I noticed was that this example was not 
a request-reply pattern.

In another example I was pointed to: 
 https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/dotnet 
specifically in the RPCClient.cs file at line 31 is:

 BasicDeliverEventArgs ea =
                (BasicDeliverEventArgs)consumer.Queue.Dequeue();
            if (ea.BasicProperties.CorrelationId == corrId) {
                return System.Text.Encoding.UTF8.GetString(ea.Body);
            }

This message is dequeued, then the CorrelationID doesn't match it just 
throws it away.  Is this really the correct way to do this?  because it 
seems to me that something is indeed waiting for that response, with that 
specific CorrelationId, and it will never actually get it.  Or is this a 
misrepresentation since in reality each request would get it's own ReplyTo 
queue, so the chances of getting a message with an incorrect CorrelationId 
wouldn;t happen?







On Monday, July 23, 2012 6:35:26 AM UTC-7, Christoph wrote:
>
> I'm not sure if you have already found these, but there are also Code 
> Examples of the book "RabbitMQ in Action" available on GitHub:  
> https://github.com/rabbitinaction/sourcecode/tree/master/csharp/appendix-a

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120725/72c8512c/attachment.htm>

From dilip.ladhani at gmail.com  Thu Jul 26 00:45:40 2012
From: dilip.ladhani at gmail.com (Dilip)
Date: Wed, 25 Jul 2012 18:45:40 -0500
Subject: [rabbitmq-discuss] Posting a json body as payload using the
 http api
Message-ID: <g544o6oq4ua0yjjtanhb14r9.1343259940632@email.android.com>

Ok . I will give this a shot or just ise the client

Sent from my Verizon Wireless Phone

Emile Joubert <emile at rabbitmq.com> wrote:

>Hi,
>
>On 24/07/12 23:59, dilipl wrote:
>> [...] Now this worked fine, when my
>> payload was a simple String. It *does not work*, when I use json as the
>> body. I am thinking the json needs to be escaped somehow?
>
>You may have answered your own question. The payload can be a string or
>base64 encoded and the payload_encoding key must be set accordingly.
>Either encode the body as base64 or escape the contents and supply it as
>a string. Any good JSON reference should provide string escape rules.
>
>-Emile
>

From r.parvataneni at accenture.com  Thu Jul 26 08:53:43 2012
From: r.parvataneni at accenture.com (r.parvataneni at accenture.com)
Date: Thu, 26 Jul 2012 07:53:43 +0000
Subject: [rabbitmq-discuss] how to keep messages in queues even after
 recieving messages by recievers.
Message-ID: <EAACB6C95B119446A050A690294166E6B2ADAB@048-CH1MPN2-253.048d.mgd.msft.net>

Hi ,

Could  please help me  on how  to keep messages in queues  even after recieving messages by recievers.

I'm using  below methods  on spring rabbit AmqpTemplate.

void convertAndSend(String exchange, String routingKey, Object message) throws AmqpException;
Object receiveAndConvert(String queueName) throws AmqpException;


My request:  after receiving message by receiver application, still I want to keep messages in queues(can monitor in Management console).


Thanks & Regards,
--------------------------------------------------------------------
Ranganath Parvataneni




________________________________
Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
______________________________________________________________________________________

www.accenture.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120726/42cc0718/attachment.htm>

From ernest.staszuk at comarch.pl  Thu Jul 26 09:02:44 2012
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Thu, 26 Jul 2012 10:02:44 +0200
Subject: [rabbitmq-discuss] how to keep messages in queues even after
 recieving messages by recievers.
In-Reply-To: <EAACB6C95B119446A050A690294166E6B2ADAB@048-CH1MPN2-253.048d.mgd.msft.net>
References: <EAACB6C95B119446A050A690294166E6B2ADAB@048-CH1MPN2-253.048d.mgd.msft.net>
Message-ID: <5010F9A4.2040409@comarch.pl>

Perhaps you could Nack messages after receiving. You could also
resend them (possibly to the other exchange or the same) transitionally
and then ack.

By the way I do not understand why you have needs like that. Do you really
need this kind of behavior? Or maybe is it desired only for a specific 
messages?

Best regards,
Ernest Staszuk

W dniu 2012-07-26 09:53, r.parvataneni at accenture.com pisze:
>
> Hi ,
>
> Could  please help me  on how  to keep messages in queues  even after 
> recieving messages by recievers.
>
> I'm using  below methods  on spring rabbit AmqpTemplate.
>
> *void*convertAndSend(String exchange, String routingKey, Object 
> message) *throws*AmqpException;
>
> Object receiveAndConvert(String queueName) *throws*AmqpException;
>
> My request:  after receiving message by receiver application, still I 
> want to keep messages in queues(can monitor in Management console).
>
> /Thanks & Regards,/
>
> /--------------------------------------------------------------------/
>
> */Ranganath Parvataneni/*
>
> /__/
>
>
> ------------------------------------------------------------------------
> Subject to local law, communications with Accenture and its affiliates 
> including telephone calls and emails (including content), may be 
> monitored by our systems for the purposes of security and the 
> assessment of internal compliance with Accenture policy.
> ______________________________________________________________________________________
>
> www.accenture.com
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120726/857c47e1/attachment.htm>

From andrea.rosa at hp.com  Thu Jul 26 10:00:44 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Thu, 26 Jul 2012 09:00:44 +0000
Subject: [rabbitmq-discuss] how to keep messages in queues even after
 recieving messages by recievers.
In-Reply-To: <EAACB6C95B119446A050A690294166E6B2ADAB@048-CH1MPN2-253.048d.mgd.msft.net>
References: <EAACB6C95B119446A050A690294166E6B2ADAB@048-CH1MPN2-253.048d.mgd.msft.net>
Message-ID: <5F389C517756284F80239F55BCA5DDDD5A9B1B4E@G9W0721.americas.hpqcorp.net>

Hi

I don't understand exactly your need, but maybe you could use a Topic/Fanout exchange and create another queue to get messages, consume and log them (in a flat file, in a DB...).

Regards
--
Andrea Rosa


From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of r.parvataneni at accenture.com
Sent: 26 July 2012 08:54
To: rabbitmq-discuss at lists.rabbitmq.com
Cc: rupa.ganesh at accenture.com
Subject: [rabbitmq-discuss] how to keep messages in queues even after recieving messages by recievers.

Hi ,

Could  please help me  on how  to keep messages in queues  even after recieving messages by recievers.

I'm using  below methods  on spring rabbit AmqpTemplate.

void convertAndSend(String exchange, String routingKey, Object message) throws AmqpException;
Object receiveAndConvert(String queueName) throws AmqpException;


My request:  after receiving message by receiver application, still I want to keep messages in queues(can monitor in Management console).


Thanks & Regards,
--------------------------------------------------------------------
Ranganath Parvataneni




________________________________
Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
______________________________________________________________________________________

www.accenture.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120726/65416139/attachment.htm>

From bme at saseco.dk  Thu Jul 26 10:12:49 2012
From: bme at saseco.dk (Bernhard Mogens Ege)
Date: Thu, 26 Jul 2012 11:12:49 +0200
Subject: [rabbitmq-discuss] Decoding header fields
Message-ID: <00b901cd6b0e$d7100d40$853027c0$@saseco.dk>

When I receive messages, I also receive information in custom header fields.

 

I can see the fields are there by inspecting 

 

e.BasicProperties.Headers

 

where e is of the type BasicDeliverEventArgs

 

The keys I can iterate through and make direct lookups against, but the
values are returned as objects but are in reality Byte[].

 

If I know the key is a string, I can decode it with:

 

String example =
System.Text.Encoding.UTF8.GetString((byte[])e.BasicProperties.Headers["keyna
me"]);

 

But how do I decode integers, doubles and more?

 

Does RabbitMQ have something to aid me here?

 

Shouldn't RabbitMQ also pass the type with the value?

 

-- 

Bernhard

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120726/51582c88/attachment.htm>

From francesco at rabbitmq.com  Thu Jul 26 10:40:11 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 26 Jul 2012 10:40:11 +0100
Subject: [rabbitmq-discuss] One node in a cluster never fully starts up
In-Reply-To: <CACLE7ixg=3z1DRg+jZVrwfULrkJiFbNWA15UQP1_QFbHo_N6ng@mail.gmail.com>
References: <CACLE7ixg=3z1DRg+jZVrwfULrkJiFbNWA15UQP1_QFbHo_N6ng@mail.gmail.com>
Message-ID: <87r4ryc138.wl%francesco@rabbitmq.com>

Hi Matt,

At Wed, 25 Jul 2012 11:48:56 -0700,
Matt Pietrek wrote:
> We have a 3 node cluster (mq1, mq2, mq3) running 2.8.4 supporting a small
> number of HA queues. During startup of the cluster, we start all nodes in
> parallel.

This is not a good idea when dealing with clustering.  RabbitMQ clustering is
basically a thin layer over mnesia clustering, and we need to do some additional
bookkeeping that is prone to race conditions (e.g. storing the online nodes at
shutdown).  We are putting efforts in making this process more reliable on the
rabbit side.

For this reason you should always execute clustering operations sequentially.

> Usually everything works fine. However, we've just recently seen one of the
> nodes (mq3) won't start, i.e., the rabbitmqctl wait <pid> doesn't complete.
> 
> I can log in to the management UI on mq1 and mq2, so they're at least
> minimally running.
> 
> Luckily, we've turned on verbose Mnesia logging. here's what the failing node
> (mq3) shows in the console spew:
>
> [...]
>
> The pattern of "Getting table rabbit_durable_exchange (disc_copies) from node
> rabbit at mq1:" cycles between mq1 and mq2 repeatedly until I kill mq3.

Uhm.  It looks like mnesia is detecting a deadlock, and I'm not sure why.  What
happens if you don't kill it?  Does it terminate by itself, eventually?

> What other sort of information can I provide or look for when this situation
> repeats?

Well, the normal rabbit logs would help.

--
Francesco * Often in error, never in doubt

From emile at rabbitmq.com  Thu Jul 26 11:16:26 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 26 Jul 2012 11:16:26 +0100
Subject: [rabbitmq-discuss] how to keep messages in queues even after
 recieving messages by recievers.
In-Reply-To: <EAACB6C95B119446A050A690294166E6B2ADAB@048-CH1MPN2-253.048d.mgd.msft.net>
References: <EAACB6C95B119446A050A690294166E6B2ADAB@048-CH1MPN2-253.048d.mgd.msft.net>
Message-ID: <501118FA.3060706@rabbitmq.com>


Hi,

On 26/07/12 08:53, r.parvataneni at accenture.com wrote:
> Could  please help me  on how  to keep messages in queues  even after
> recieving messages by recievers.

I note that you are using synchronous receipt. For asynchronous receipt
you could request that the Message Listener use manual acknowledge mode
and nack messages using the underlying channel.

Can you explain why you want to do this?


-Emile



From emile at rabbitmq.com  Thu Jul 26 11:44:52 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 26 Jul 2012 11:44:52 +0100
Subject: [rabbitmq-discuss] Looking for some specific & complete C#
	examples
In-Reply-To: <9d6fa008-8062-453b-8008-8ba7ac882561@googlegroups.com>
References: <0fa4a463-7dfc-45f5-8772-3b680cb0e53a@googlegroups.com>
	<a0c75a8f-42b8-4a68-ac61-31ee931a4db0@googlegroups.com>
	<9d6fa008-8062-453b-8008-8ba7ac882561@googlegroups.com>
Message-ID: <50111FA4.2010108@rabbitmq.com>

Hi,

On 25/07/12 23:14, Wizaerd wrote:
> This message is dequeued, then the CorrelationID doesn't match it just
> throws it away.  Is this really the correct way to do this?  because it
> seems to me that something is indeed waiting for that response, with
> that specific CorrelationId, and it will never actually get it.  Or is
> this a misrepresentation since in reality each request would get it's
> own ReplyTo queue, so the chances of getting a message with an incorrect
> CorrelationId wouldn;t happen?

Your concern is entirely valid, but the sample code doesn't address any
other concerns and only focusses on the topic of the tutorial.

You would not expect a message with a non-matching correlation ID to be
present in a server-named queue created specifically for the reply. If
you do detect this condition then you should report the exception
because it probably indicates a serious problem.

If the reply queue is shared then a unmatched correlation is more likely
and need not be treated as an anomaly.


-Emile



From emile at rabbitmq.com  Thu Jul 26 12:31:10 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 26 Jul 2012 12:31:10 +0100
Subject: [rabbitmq-discuss] Decoding header fields
In-Reply-To: <00b901cd6b0e$d7100d40$853027c0$@saseco.dk>
References: <00b901cd6b0e$d7100d40$853027c0$@saseco.dk>
Message-ID: <50112A7E.4000004@rabbitmq.com>

Hi,

On 26/07/12 10:12, Bernhard Mogens Ege wrote:
> The keys I can iterate through and make direct lookups against, but the
> values are returned as objects but are in reality Byte[].

I would expect a byte array if the producer populated the field with a
byte array (prefixed by 'x'), but it could be any of AMQP table field
type. Consumers and producers may agree on types for certain keys
beforehand, or the consumer can determine the type at runtime using
GetType().

See RabbitMQ.Client.Impl.WireFormatting.ReadFieldValue() for the
relevant implementation and mapping between AMQP types and .NET types.


-Emile






From bme at saseco.dk  Thu Jul 26 12:57:49 2012
From: bme at saseco.dk (Bernhard Mogens Ege)
Date: Thu, 26 Jul 2012 13:57:49 +0200
Subject: [rabbitmq-discuss] Decoding header fields
In-Reply-To: <50112A7E.4000004@rabbitmq.com>
References: <00b901cd6b0e$d7100d40$853027c0$@saseco.dk>
	<50112A7E.4000004@rabbitmq.com>
Message-ID: <00c401cd6b25$e3ec0430$abc40c90$@saseco.dk>

Hmm, I guess I have to work a bit on how I send the information, then. In
effect, I send a message like this:

                IBasicProperties bp = channel.CreateBasicProperties();
                bp.Headers = new Dictionary<string,string>{ { "languageid",
"1" } };
                channel.BasicPublish(ExchangeName, routingKey, false, true,
bp, payload);

payload can be null or some byte array. The value string would in my case be
"0" or "1".

So I have to send it differently?
-- 
Bernhard

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: 26. juli 2012 13:31
To: bme at saseco.dk; Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Decoding header fields

Hi,

On 26/07/12 10:12, Bernhard Mogens Ege wrote:
> The keys I can iterate through and make direct lookups against, but 
> the values are returned as objects but are in reality Byte[].

I would expect a byte array if the producer populated the field with a byte
array (prefixed by 'x'), but it could be any of AMQP table field type.
Consumers and producers may agree on types for certain keys beforehand, or
the consumer can determine the type at runtime using GetType().

See RabbitMQ.Client.Impl.WireFormatting.ReadFieldValue() for the relevant
implementation and mapping between AMQP types and .NET types.


-Emile






From emile at rabbitmq.com  Thu Jul 26 14:03:22 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 26 Jul 2012 14:03:22 +0100
Subject: [rabbitmq-discuss] Decoding header fields
In-Reply-To: <00c401cd6b25$e3ec0430$abc40c90$@saseco.dk>
References: <00b901cd6b0e$d7100d40$853027c0$@saseco.dk>
	<50112A7E.4000004@rabbitmq.com>
	<00c401cd6b25$e3ec0430$abc40c90$@saseco.dk>
Message-ID: <5011401A.7070000@rabbitmq.com>

Hi,

On 26/07/12 12:57, Bernhard Mogens Ege wrote:
> [...] The value string would in my case be
> "0" or "1".

For a table field value taking only these two values you can use a
boolean type, which in the best case uses only one bit to encode.


-Emile



From bme at saseco.dk  Thu Jul 26 14:08:18 2012
From: bme at saseco.dk (Bernhard Mogens Ege)
Date: Thu, 26 Jul 2012 15:08:18 +0200
Subject: [rabbitmq-discuss] Decoding header fields
In-Reply-To: <5011401A.7070000@rabbitmq.com>
References: <00b901cd6b0e$d7100d40$853027c0$@saseco.dk>
	<50112A7E.4000004@rabbitmq.com>
	<00c401cd6b25$e3ec0430$abc40c90$@saseco.dk>
	<5011401A.7070000@rabbitmq.com>
Message-ID: <00c501cd6b2f$bcceb230$366c1690$@saseco.dk>

Well, it can also be "2" and higher. And in the future I'd like to send
int's and more. But I still don't know if I send it correctly or if I do
something wrong. :-/ All I know is I only get byte[] on the receiving side.

Looking at WireFormatting.cs didn't really help me except it seems RabbitMQ
does have something that could do what I want. I just don't know how to use
it.

-- 
Bernhard

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: 26. juli 2012 15:03
To: bme at saseco.dk
Cc: 'Discussions about RabbitMQ'
Subject: Re: [rabbitmq-discuss] Decoding header fields

Hi,

On 26/07/12 12:57, Bernhard Mogens Ege wrote:
> [...] The value string would in my case be "0" or "1".

For a table field value taking only these two values you can use a boolean
type, which in the best case uses only one bit to encode.


-Emile



From emile at rabbitmq.com  Thu Jul 26 14:19:09 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 26 Jul 2012 14:19:09 +0100
Subject: [rabbitmq-discuss] Decoding header fields
In-Reply-To: <00c501cd6b2f$bcceb230$366c1690$@saseco.dk>
References: <00b901cd6b0e$d7100d40$853027c0$@saseco.dk>
	<50112A7E.4000004@rabbitmq.com>
	<00c401cd6b25$e3ec0430$abc40c90$@saseco.dk>
	<5011401A.7070000@rabbitmq.com>
	<00c501cd6b2f$bcceb230$366c1690$@saseco.dk>
Message-ID: <501143CD.3030505@rabbitmq.com>

Hi,

On 26/07/12 14:08, Bernhard Mogens Ege wrote:
> Well, it can also be "2" and higher. And in the future I'd like to send
> int's and more. But I still don't know if I send it correctly or if I do
> something wrong. :-/ All I know is I only get byte[] on the receiving side.

Ok, obviously if you need to represent more than two values then use a
larger type.

> Looking at WireFormatting.cs didn't really help me except it seems RabbitMQ
> does have something that could do what I want. I just don't know how to use
> it.

See RabbitMQ.Client.Examples.SendMap for an example that can send
multiple types of values in a header.


-Emile





From aperez at alea-soluciones.com  Thu Jul 26 10:34:02 2012
From: aperez at alea-soluciones.com (APA)
Date: Thu, 26 Jul 2012 02:34:02 -0700 (PDT)
Subject: [rabbitmq-discuss] Publisher and Consumer design doubts
Message-ID: <08b21942-8604-434b-b5b7-52cdca87f811@googlegroups.com>

High, I wonder if someone can help me

I'm using python and librabbitmq

I've a publisher and consumer (files are attached)

First Test 
The consumer declares and binds a queue to the exchange with AutoDelete=True
Start the consumer then the publisher.
Everything works great until I kill the publisher. Then wait five minutes 
and run the publisher again.
When it starts, RabbitMQ deletes the queue. The consumer does not get 
notice that he "loss connection"

Second Test
Change the consumer queue to be AutoDelete=False.
Everything works great until I kill the publisher. Then wait five minutes 
and run the publisher again.
The queue is not deleted but the consumer does not get notice that he "loss 
connection" and no message are received.

This behavior is normal or I'm making a great mistake, because I'm 
supposing the consumer should be listening to incoming messages from 
publisher.

Thanks in advanced

Best regards




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120726/ec78f80b/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: consumer.py
Type: text/x-python
Size: 996 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120726/ec78f80b/attachment.py>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: publisher.py
Type: text/x-python
Size: 1056 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120726/ec78f80b/attachment-0001.py>

From aaron at agoragames.com  Thu Jul 26 15:41:49 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 26 Jul 2012 10:41:49 -0400
Subject: [rabbitmq-discuss] one or many exchanges
Message-ID: <CALEq_A8Rtm_ov7ggj15TrWi3500h7NfHW7tzSVxSt=5uKzJOnA@mail.gmail.com>

We're using Rabbit as a bus for an RPC-like service. To date we're
using a named topic exchange, e.g. "account" for everything that
routes to one of many queues, e.g. "account.get". In practice there
are several queues as each queue is dedicated to a separate
environment.

Is this the best approach, or should we consolidate to a single
exchange? Years ago, we implemented transactions because if an
exchange didn't exist at the time of publishing, the channel would be
closed and we didn't want to lose messages that were published after
the bad one. I'm refactoring and implementing publisher confirms, and
don't know what to expect in that same scenario. If I can limit to a
single exchange without problem, then I can ensure that exchange
exists and not have to worry about this situation at all.

-Aaron

From mpietrek at skytap.com  Thu Jul 26 16:45:50 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 26 Jul 2012 08:45:50 -0700
Subject: [rabbitmq-discuss] One node in a cluster never fully starts up
In-Reply-To: <87r4ryc138.wl%francesco@rabbitmq.com>
References: <CACLE7ixg=3z1DRg+jZVrwfULrkJiFbNWA15UQP1_QFbHo_N6ng@mail.gmail.com>
	<87r4ryc138.wl%francesco@rabbitmq.com>
Message-ID: <CACLE7izfttKxd4kEBt9uriR1O+-o=_Qx9o=OGBZ+LUbEDf8efQ@mail.gmail.com>

Francesco,

Thanks for the quick reply. A couple of replies/questions:

If I'm understanding what you're saying, we should be starting up our
brokers sequentially. However, in my experience this hasn't worked. For
instance, we've seen mq1 stall in its startup, waiting for mq3 to start.
But mq3 can't start (per the sequential logic) till mq1 finishes starting
up. Per advice I received from you previously (below) we've moved to async
startup of the brokers:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-June/020689.html

>* Question 2*>* ---------------*>* Related to the above scenario, is there any danger (after an unplanned*>* shutdown), in simply letting all the nodes start in parallel and*>* letting Mnesia's waiting sort out the order? It seems to work OK in my*>* limited testing so far, but I don't know if we're risking data loss.*
It should be fine, but in general it's better to do cluster operations
sequentially and at one site. In this specific case it should be OK.

As it stands now, we're in a catch 22 - If we do sequential startup, we run
the risk of deadlocking if we start the nodes in the wrong order. But if we
do async startup, we run into the problem described in this thread.

--------
> Uhm.  It looks like mnesia is detecting a deadlock, and I'm not sure why.
 What
> happens if you don't kill it?  Does it terminate by itself, eventually?

I've let it wait for a good long time (30 minutes +) before killing it.

Thanks much for your help,

Matt

On Thu, Jul 26, 2012 at 2:40 AM, Francesco Mazzoli
<francesco at rabbitmq.com>wrote:

> Hi Matt,
>
> At Wed, 25 Jul 2012 11:48:56 -0700,
> Matt Pietrek wrote:
> > We have a 3 node cluster (mq1, mq2, mq3) running 2.8.4 supporting a small
> > number of HA queues. During startup of the cluster, we start all nodes in
> > parallel.
>
> This is not a good idea when dealing with clustering.  RabbitMQ clustering
> is
> basically a thin layer over mnesia clustering, and we need to do some
> additional
> bookkeeping that is prone to race conditions (e.g. storing the online
> nodes at
> shutdown).  We are putting efforts in making this process more reliable on
> the
> rabbit side.
>
> For this reason you should always execute clustering operations
> sequentially.
>
> > Usually everything works fine. However, we've just recently seen one of
> the
> > nodes (mq3) won't start, i.e., the rabbitmqctl wait <pid> doesn't
> complete.
> >
> > I can log in to the management UI on mq1 and mq2, so they're at least
> > minimally running.
> >
> > Luckily, we've turned on verbose Mnesia logging. here's what the failing
> node
> > (mq3) shows in the console spew:
> >
> > [...]
> >
> > The pattern of "Getting table rabbit_durable_exchange (disc_copies) from
> node
> > rabbit at mq1:" cycles between mq1 and mq2 repeatedly until I kill mq3.
>
> Uhm.  It looks like mnesia is detecting a deadlock, and I'm not sure why.
>  What
> happens if you don't kill it?  Does it terminate by itself, eventually?
>
> > What other sort of information can I provide or look for when this
> situation
> > repeats?
>
> Well, the normal rabbit logs would help.
>
> --
> Francesco * Often in error, never in doubt
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120726/b93251f7/attachment.htm>

From francesco at rabbitmq.com  Thu Jul 26 16:55:13 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 26 Jul 2012 16:55:13 +0100
Subject: [rabbitmq-discuss] One node in a cluster never fully starts up
In-Reply-To: <CACLE7izfttKxd4kEBt9uriR1O+-o=_Qx9o=OGBZ+LUbEDf8efQ@mail.gmail.com>
References: <CACLE7ixg=3z1DRg+jZVrwfULrkJiFbNWA15UQP1_QFbHo_N6ng@mail.gmail.com>
	<87r4ryc138.wl%francesco@rabbitmq.com>
	<CACLE7izfttKxd4kEBt9uriR1O+-o=_Qx9o=OGBZ+LUbEDf8efQ@mail.gmail.com>
Message-ID: <87fw8ebjq6.wl%francesco@rabbitmq.com>

At Thu, 26 Jul 2012 08:45:50 -0700,
Matt Pietrek wrote:
> 
> Francesco,
> 
> Thanks for the quick reply. A couple of replies/questions:
> 
> If I'm understanding what you're saying, we should be starting up our brokers
> sequentially. However, in my experience this hasn't worked. For instance,
> we've seen mq1 stall in its startup, waiting for mq3 to start.  But mq3 can't
> start (per the sequential logic) till mq1 finishes starting up. Per advice I
> received from you previously (below) we've moved to async startup of the
> brokers:
> 
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-June/020689.html

Ah, I remember now!  Your problem is that you want to recover the nodes and you
don't know which is the last one going down, so some nodes stall.  And yes, in
that specific case I could not see any problems (and I still can't) with the
parallel startup *if you're not upgrading rabbit*.

That said, those mnesia messages are quite mysterious. Could you send the Rabbit
logs as well?

--
Francesco * Often in error, never in doubt

From emile at rabbitmq.com  Thu Jul 26 17:14:59 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 26 Jul 2012 17:14:59 +0100
Subject: [rabbitmq-discuss] one or many exchanges
In-Reply-To: <CALEq_A8Rtm_ov7ggj15TrWi3500h7NfHW7tzSVxSt=5uKzJOnA@mail.gmail.com>
References: <CALEq_A8Rtm_ov7ggj15TrWi3500h7NfHW7tzSVxSt=5uKzJOnA@mail.gmail.com>
Message-ID: <50116D03.8090805@rabbitmq.com>


Hi Aaron,

On 26/07/12 15:41, Aaron Westendorf wrote:
> Is this the best approach, or should we consolidate to a single

Your choice does not matter much to the broker and I would expect
similar performance. Use the approach that is most convenient for you
and select a naming convention that clearly communicates its purpose and
makes it simple to assign permissions.

> the bad one. I'm refactoring and implementing publisher confirms, and
> don't know what to expect in that same scenario. If I can limit to a

Attempting to publish to a non-existent exchange is a channel-level
error regardless of whether you use publisher confirms or not.


-Emile




From steve at rabbitmq.com  Thu Jul 26 17:51:55 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 26 Jul 2012 17:51:55 +0100
Subject: [rabbitmq-discuss] Publisher and Consumer design doubts
In-Reply-To: <08b21942-8604-434b-b5b7-52cdca87f811@googlegroups.com>
References: <08b21942-8604-434b-b5b7-52cdca87f811@googlegroups.com>
Message-ID: <B8D0134C-B573-45E0-A4D0-F082720BBC2A@rabbitmq.com>

Dear ___,

Your example code appears to register the consumer callback repeatedly
in a loop, draining events after doing this. This cannot be good use of
the interface (but I could be wrong).

You may like to look at http://pypi.python.org/pypi/librabbitmq/ for
information about how to use the library correctly. There is an example
on the first page that demonstrates the consumer idiom.

The five minutes pause is likely enough time either for the repeated
stuff to clog up the client somehow, or for some network mechanism to
close the connection since nothing is happening on it. RabbitMQ will not
do this, but I am told there are network firewalls and stuff that will
unceremoniously chop a connection if it is silent for a while. It is not
clear that the client would ever notice this.

If these steps do not help I recommend looking in the RabbitMQ logs to
see why the connection is lost. Come to think of it, I would recommend
looking there anyway. You do not say if your tests are run locally or if
the server is on a different machine from the publisher/consumers?

Good luck, 
____ ____ (a happy bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

On 26 Jul 2012, at 10:34, APA wrote:

> High, I wonder if someone can help me
> 
> I'm using python and librabbitmq
> 
> I've a publisher and consumer (files are attached)
> 
> First Test 
> The consumer declares and binds a queue to the exchange with AutoDelete=True
> Start the consumer then the publisher.
> Everything works great until I kill the publisher. Then wait five minutes and run the publisher again.
> When it starts, RabbitMQ deletes the queue. The consumer does not get notice that he "loss connection"
> 
> Second Test
> Change the consumer queue to be AutoDelete=False.
> Everything works great until I kill the publisher. Then wait five minutes and run the publisher again.
> The queue is not deleted but the consumer does not get notice that he "loss connection" and no message are received.
> 
> This behavior is normal or I'm making a great mistake, because I'm supposing the consumer should be listening to incoming messages from publisher.
> 
> Thanks in advanced
> 
> Best regards
> 
> 
> 
> 
> <consumer.py><publisher.py>_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120726/b145b311/attachment.htm>

From paddy.carman at gmail.com  Thu Jul 26 18:03:28 2012
From: paddy.carman at gmail.com (Paddy Carman)
Date: Thu, 26 Jul 2012 10:03:28 -0700
Subject: [rabbitmq-discuss] Why do we need rabbitmq-web-stomp and why not
	rabitmq-web-amqp (over websockets)?
Message-ID: <CAOGkWBaVZv=rSFRc-kdFLJRptCxPZ298DxRFwUFjxvLiQpZL-w@mail.gmail.com>

Hi -
    I'm reading about the rabbitmq-web-stomp plugin. It seem very cool -
STOMP over Websockets connecting to AMQP backend. My questions:
* can we do AMQP over websockets directly and
* If so, why do we need STOMP?
* Is there any particular advantage of using STOMP?
* Are there performance implications in the STOM<>AMQP translation?

Thanks,
PC
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120726/9ccebe25/attachment.htm>

From paddy.carman at gmail.com  Thu Jul 26 21:34:42 2012
From: paddy.carman at gmail.com (PC)
Date: Thu, 26 Jul 2012 13:34:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Why do we need rabbitmq-web-stomp and why not
 rabitmq-web-amqp (over websockets)?
Message-ID: <fc24eff8-cdec-46e5-b7c4-f86b5b0393ec@googlegroups.com>

Hi -
    I'm reading about the rabbitmq-web-stomp plugin. It seems like a very 
cool idea - STOMP over Websockets connecting to AMQP backend.

My questions: 

   1. can we do AMQP over websockets directly and 
   2. If so, why do we need STOMP? 
   3. Is there any particular advantage of using STOMP? 
   4. Are there performance implications in the STOM<>AMQP translation?
   

Thanks,
PC
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120726/34b95132/attachment.htm>

From squall1386 at hotmail.com  Thu Jul 26 19:59:52 2012
From: squall1386 at hotmail.com (Chris Judkins-Fisher)
Date: Thu, 26 Jul 2012 13:59:52 -0500
Subject: [rabbitmq-discuss] basicPublish() Hangs on the Upstream Node in a
	Federation
Message-ID: <SNT127-W15555B836D172E6F1F0C49D5C20@phx.gbl>


Hello,

For some reason, I'm unable to publish messages to any exchange/queue on one of the VMs I'm using for testing RabbitMQ federations. My setup is as follows:

I have two VMs named rabbit1 and rabbit2, both with the federation plugin enabled. 
Rabbit1 is configured [1] with a federated exchange with a connection to rabbit2.

When I look at the federation status, I see that the connection is successfully established. The appropriate upstream exchange and queue are also automatically created on rabbit2. However, if I try to publish to an exchange from rabbit2, the code appears to hang and the message is never delivered. This happens whether I'm publishing to the upstream federated exchange, or just to a local exchange and queue. An example Test.java [2] runs correctly on rabbit1 or my local machine, but doesn't complete on rabbit2. It might be worth noting that the print statement _does_ execute after channel.basicPublish(...), but prints put after channel.close() or connection.close() don't occur.

I'm not sure what the next step is in troubleshooting this. Any help would be appreciated.

Thanks for taking a look.


[1] Rabbit1's rabbitmq.config

[{rabbitmq_federation,
    [
        {exchanges, [[{exchange, "high"},
            {type, "topic"},
            {upstream_set, "tomcats"}]]},
        {upstream_sets, [{"tomcats", [[{connection, "tomcat1"},
                {exchange, "highw1"},
                {max_hops, 1}]
            ]}]},
        {connections, [{"tomcat1", [{host, "out"},
                {port, 5672}]}]}
    ]
}].


[2] The code in Test.java

import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.Channel;

public class Test {

  public static void main(String[] argv) throws Exception {

    ConnectionFactory factory = new ConnectionFactory();
    factory.setHost("localhost");
    Connection connection = factory.newConnection();
    Channel channel = connection.createChannel();
    channel.exchangeDeclare("testexchange", "topic");
    channel.queueDeclare("testqueue", true, false, false, null);
    channel.queueBind("testqueue", "testexchange", "photo");

    String message = "Hello World!";
    channel.basicPublish("testexchange", "photo", null, message.getBytes());
    System.out.println(" [x] Sent '" + message + "'");

    channel.close();
    connection.close();
  }
}
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120726/0c94a49c/attachment.htm>

From dion.rowney at usask.ca  Thu Jul 26 23:59:16 2012
From: dion.rowney at usask.ca (Dion Rowney)
Date: Thu, 26 Jul 2012 17:59:16 -0500
Subject: [rabbitmq-discuss] AMQP Keep-alives?
Message-ID: <5011CBC4.9010609@usask.ca>

I am running vCloud Director, vCenter Orchestrator with RabbitMQ in the 
middle and keep getting this error email message:

VMware vCloud Director lost connection with AMQP Server

It does seem to cause a problem as it seems to just reconnect when 
needed but I believe it is because my cells are behind a Cisco load 
balancing content switch which must drop idle connections after some 
timeout period.

Is there a similar "keep-alive" or "heartbeat" option available for the 
vcd cells and vCO or maybe a RabbitMQ server setting to use keep-alive 
packets?

My fear is the disconnect message will be important one day and everyone 
will just ignore it.

If there is something that VMware needs to implement, just say it and I 
will open a SR ticket requesting this, but I thought I would check and 
see if its something I need to do on the RabbitMQ side first.

Thanks

  Dion


From aperez at alea-soluciones.com  Fri Jul 27 08:28:42 2012
From: aperez at alea-soluciones.com (Alberto Perez Alonso)
Date: Fri, 27 Jul 2012 09:28:42 +0200
Subject: [rabbitmq-discuss] Publisher and Consumer design doubts
In-Reply-To: <B8D0134C-B573-45E0-A4D0-F082720BBC2A@rabbitmq.com>
References: <08b21942-8604-434b-b5b7-52cdca87f811@googlegroups.com>
	<B8D0134C-B573-45E0-A4D0-F082720BBC2A@rabbitmq.com>
Message-ID: <CAN0=8+gkE-KDAEm0j7j8GkDtvgEKO5qOaagJJTcEjg52zeBLow@mail.gmail.com>

Hello

Yes, you're right.
I detected with management console that there are too many consumers.
Reviewed code and fixed it ( basic_consume out of loop ) but I sent the
example without the corrections.

Concerning to close connection:
umm, it seems that depends on the architecture:
*) consumer, publisher, RabbitMQ at localhost work fine.No connections are
closed.
*) consumer, publisher at localhost. RabbitMQ other machine (virtual
machine)->Connection is  closed

Ok-> it's not rabbitmq problem. I've to take a look

Thanks a lot.


2012/7/26 Steve Powell <steve at rabbitmq.com>

> Dear ___,
>
> Your example code appears to register the consumer callback repeatedly
> in a loop, draining events after doing this. This cannot be good use of
> the interface (but I could be wrong).
>
> You may like to look at http://pypi.python.org/pypi/librabbitmq/ for
> information about how to use the library correctly. There is an example
> on the first page that demonstrates the consumer idiom.
>
> The five minutes pause is likely enough time either for the repeated
> stuff to clog up the client somehow, or for some network mechanism to
> close the connection since nothing is happening on it. RabbitMQ will not
> do this, but I am told there are network firewalls and stuff that will
> unceremoniously chop a connection if it is silent for a while. It is not
> clear that the client would ever notice this.
>
> If these steps do not help I recommend looking in the RabbitMQ logs to
> see why the connection is lost. Come to think of it, I would recommend
> looking there anyway. You do not say if your tests are run locally or if
> the server is on a different machine from the publisher/consumers?
>
> Good luck,
>  ____ ____ (*a happy bunny*)
> *----------yet more definitions from the SPD----------*
> *corrugate* (*n.*) T.V. soap scandal.
> *olympic* (*n.*) A camp road-digger.
> *jamboree* (*n.*) A conserve made from French cheese.
>
> On 26 Jul 2012, at 10:34, APA wrote:
>
> High, I wonder if someone can help me
>
> I'm using python and librabbitmq
>
> I've a publisher and consumer (files are attached)
>
> First Test
> The consumer declares and binds a queue to the exchange with
> AutoDelete=True
> Start the consumer then the publisher.
> Everything works great until I kill the publisher. Then wait five minutes
> and run the publisher again.
> When it starts, RabbitMQ deletes the queue. The consumer does not get
> notice that he "loss connection"
>
> Second Test
> Change the consumer queue to be AutoDelete=False.
> Everything works great until I kill the publisher. Then wait five minutes
> and run the publisher again.
> The queue is not deleted but the consumer does not get notice that he
> "loss connection" and no message are received.
>
> This behavior is normal or I'm making a great mistake, because I'm
> supposing the consumer should be listening to incoming messages from
> publisher.
>
> Thanks in advanced
>
> Best regards
>
>
>
>
> <consumer.py><publisher.py>_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120727/879aff8f/attachment.htm>

From francesco at rabbitmq.com  Fri Jul 27 08:36:32 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 27 Jul 2012 08:36:32 +0100
Subject: [rabbitmq-discuss] AMQP Keep-alives?
In-Reply-To: <5011CBC4.9010609@usask.ca>
References: <5011CBC4.9010609@usask.ca>
Message-ID: <87lii5mz9b.wl%francesco@rabbitmq.com>

Hi Dion,
At Thu, 26 Jul 2012 17:59:16 -0500,
Dion Rowney wrote:
> Is there a similar "keep-alive" or "heartbeat" option available for the 
> vcd cells and vCO or maybe a RabbitMQ server setting to use keep-alive 
> packets?

You can use AMQP heartbeats.  The client can specify the requested heartbeat
delay in the `tune-ok' frame:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#connection.tune-ok .

In most client this will be a parameter when creating a connection.  For example
in the java client you can use the `setRequestedHeartbeat' method in
`ConnectionFactory':
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.8.4/rabbitmq-java-client-javadoc-2.8.4/com/rabbitmq/client/ConnectionFactory.html#setRequestedHeartbeat(int)

--
Francesco * Often in error, never in doubt

From oldhomelh at gmail.com  Fri Jul 27 09:13:27 2012
From: oldhomelh at gmail.com (andy)
Date: Fri, 27 Jul 2012 16:13:27 +0800
Subject: [rabbitmq-discuss] something about message priority
Message-ID: <000001cd6bcf$b6ac9b60$2405d220$@gmail.com>

We use spring amqp to use rabbitmq,but I have meet a problem that we should
send the message  in the queue  to  programe  in order of the
priority,through  I have set the message propriety,the rabbitmq still sends
message in order of

Delievered time. Could you tell me how to make it work so that we could
send message  order by  priority 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120727/4fa8519e/attachment.htm>

From ernest.staszuk at comarch.pl  Fri Jul 27 09:30:04 2012
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Fri, 27 Jul 2012 10:30:04 +0200
Subject: [rabbitmq-discuss] something about message priority
In-Reply-To: <000001cd6bcf$b6ac9b60$2405d220$@gmail.com>
References: <000001cd6bcf$b6ac9b60$2405d220$@gmail.com>
Message-ID: <5012518C.1080109@comarch.pl>

According to the compatibility and conformance with amqp specification 
(http://www.rabbitmq.com/specification.html) rabbitmq
does NOT support messages priority. It is planned to support in future. 
Also you should be aware that amqp specifies at least 2
priorities, so it is possible that it will not work as you would wish in 
the one of future releases. I implemented message priorities using
many queues and consume messages on them always in the same order (1st 
queue (is message) -> 1st queue (is message) -> 1st queue (empty)
-> 2nd queue (is message) -> 1st queue (empty) -> 2nd queue (empty) -> 
3rd queue (is message) -> 1st queue ...)

Best regards,
Ernest Staszuk

W dniu 2012-07-27 10:13, andy pisze:
>
> We use spring amqp to use rabbitmq,but I have meet a problem that we 
> should send the message  in the queue  to  programe  in order of the 
> priority,through  I have set the message propriety,the rabbitmq still 
> sends message in order of
>
> Delievered time. Could you tell me how to make it work so that we 
> could  send message  order by  priority
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120727/dd08ed03/attachment.htm>

From oldhomelh at gmail.com  Fri Jul 27 09:50:35 2012
From: oldhomelh at gmail.com (andy)
Date: Fri, 27 Jul 2012 16:50:35 +0800
Subject: [rabbitmq-discuss] =?gb2312?b?tPC4tDogIHNvbWV0aGluZyBhYm91dCBt?=
	=?gb2312?b?ZXNzYWdlIHByaW9yaXR5?=
In-Reply-To: <5012518C.1080109@comarch.pl>
References: <000001cd6bcf$b6ac9b60$2405d220$@gmail.com>
	<5012518C.1080109@comarch.pl>
Message-ID: <033c01cd6bd4$e76f6b10$b64e4130$@gmail.com>

Thank you for your answers.but  I doubt that as you say ,if we are
processing 2st queue message as soon as the 1st queue gets a new message
needed to process,how can we switch to process 1st? It also means that we
should check the amount of  messages in the queue  in order ,I think it will
cost much time and machine resource.and could you tell me  how I could  use
spring amqp api to check the amount.?

 

???: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] ?? Ernest Staszuk
????: 2012?7?27? 16:30
???: rabbitmq-discuss at lists.rabbitmq.com
??: Re: [rabbitmq-discuss] something about message priority

 

According to the compatibility and conformance with amqp specification
(http://www.rabbitmq.com/specification.html) rabbitmq 
does NOT support messages priority. It is planned to support in future. Also
you should be aware that amqp specifies at least 2 
priorities, so it is possible that it will not work as you would wish in the
one of future releases. I implemented message priorities using 
many queues and consume messages on them always in the same order (1st queue
(is message) -> 1st queue (is message) -> 1st queue (empty)
-> 2nd queue (is message) -> 1st queue (empty) -> 2nd queue (empty) -> 3rd
queue (is message) -> 1st queue ...)

Best regards, 
Ernest Staszuk

W dniu 2012-07-27 10:13, andy pisze:

We use spring amqp to use rabbitmq,but I have meet a problem that we should
send the message  in the queue  to  programe  in order of the
priority,through  I have set the message propriety,the rabbitmq still sends
message in order of

Delievered time. Could you tell me how to make it work so that we could
send message  order by  priority 






_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120727/4ee12705/attachment.htm>

From ernest.staszuk at comarch.pl  Fri Jul 27 10:31:53 2012
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Fri, 27 Jul 2012 11:31:53 +0200
Subject: [rabbitmq-discuss]
 =?utf-8?b?562U5aSNOiAgc29tZXRoaW5nIGFib3V0IG1l?=
 =?utf-8?q?ssage_priority?=
In-Reply-To: <033c01cd6bd4$e76f6b10$b64e4130$@gmail.com>
References: <000001cd6bcf$b6ac9b60$2405d220$@gmail.com>
	<5012518C.1080109@comarch.pl>
	<033c01cd6bd4$e76f6b10$b64e4130$@gmail.com>
Message-ID: <50126009.7070001@comarch.pl>

I didn't use spring amqp api, so I can not provide you working example.

I use consuming with small timeout (and there is a cost of time - small 
delay,
  not an issue in my case, cpu usage and network fingerprints stays very 
small).
I was also taking advantage of rabbit's java client prefetching (I am 
not sure
if spring implements that). These two combined gave me acceptable 
approximation of priorities.

You could also add to messages own argument (for example myPriority) and 
consume all messages
as they are available (or let's say up to 200 messages or sth), then put 
them in a priority
queue on your application side. And then process them from the head of 
this container (using
dedicated thread). That also may give you acceptable results.

Note that the state of art is as follows: RabbitMQ is a FIFO queue, and 
does not make
use of message priorities today. It could be changed in one of the 
future releases, I don't
know when it may be. As consequence of that you should apply some 
reasonable workaround
which will be acceptable for you or reconsider your needs (maybe you 
don't really need
priorities?) or use something else than RabbitMQ or implement it by 
yourself. By the way
AMQP itself says that "Messages with higher priorities MAY be delivered 
before those with
lower priorities". Following that messages priority in any 
implementation of AMQP may
be not consistent.

Best regards,
Ernest Staszuk





W dniu 2012-07-27 10:50, andy pisze:
> at as you say ,if we are processing 2st queue message as soon as the 
> 1^st queue gets a new message needed to process,how can we switch to 
> process 1^st ? It also means that we should check the amount of 
>  messages in the queue  in order ,I think it will cost much time and 
> machine resource.and could you tell me  how I could  use spring amqp a

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120727/14f9a601/attachment.htm>

From francesco at rabbitmq.com  Fri Jul 27 12:03:46 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 27 Jul 2012 12:03:46 +0100
Subject: [rabbitmq-discuss] Why do we need rabbitmq-web-stomp and why
	not	rabitmq-web-amqp (over websockets)?
In-Reply-To: <CAOGkWBaVZv=rSFRc-kdFLJRptCxPZ298DxRFwUFjxvLiQpZL-w@mail.gmail.com>
References: <CAOGkWBaVZv=rSFRc-kdFLJRptCxPZ298DxRFwUFjxvLiQpZL-w@mail.gmail.com>
Message-ID: <87k3xp31pp.wl%francesco@rabbitmq.com>

At Thu, 26 Jul 2012 10:03:28 -0700,
Paddy Carman wrote:
> Hi -
> ? ? I'm reading about the rabbitmq-web-stomp plugin. It seem very cool - STOMP
> over Websockets connecting to AMQP backend. My questions:?
> * can we do AMQP over websockets directly and?
> * If so, why do we need STOMP??
> * Is there any particular advantage of using STOMP??

Stomp is a tremendously more simple protocol than AMQP, which is why it is easy
to have a STOMP-over-SockJS.  Moreover, exposing AMQP to the internet is not a
good idea.

> * Are there performance implications in the STOM<>AMQP translation?

Not really.  The STOMP plugin uses the direct exchange, and converting between
message formats is straightforward.

--
Francesco * Often in error, never in doubt

From grussell at vmware.com  Fri Jul 27 12:58:54 2012
From: grussell at vmware.com (Gary Russell)
Date: Fri, 27 Jul 2012 04:58:54 -0700
Subject: [rabbitmq-discuss]
 =?utf-8?b?562U5aSNOiAgc29tZXRoaW5nIGFib3V0IG1l?=
 =?utf-8?q?ssage_priority?=
In-Reply-To: <50126009.7070001@comarch.pl>
References: <000001cd6bcf$b6ac9b60$2405d220$@gmail.com>
	<5012518C.1080109@comarch.pl>	<033c01cd6bd4$e76f6b10$b64e4130$@gmail.com>
	<50126009.7070001@comarch.pl>
Message-ID: <5012827E.6010004@vmware.com>

This comes up once in a while on the spring-amqp ( http://forum.springsource.org/forumdisplay.php?74-AMQP) and spring-integration ( http://forum.springsource.org/forumdisplay.php?42-Integration) forums; especially from folks migrating from JMS.

The general solution is to simulate priority, by having the listener container listen on multiple queues (e.g. 'low, normal, high') and have the client use a different routing key, based on the priority.

This generally works fine, as long as most messages are 'normal' and only a few are high. If you have a priority distribution that has many high priority messages (in relation to normal), you might be better off configuring a different listener container for each queue, so you can configure the consumer count appropriately for each queue (e.g. more consumers for the high priority queue).

On the client side, when using Spring Integration, it's easy to configure a routing-key-expression on the <outbound-channel-adapter/> to generate the appropriate routing key.

Even when not using Spring Integration, it's simple to do the same.

Hope that helps.

Gary
Spring Integration Team
VMware, Inc.


On 07/27/2012 05:31 AM, Ernest Staszuk wrote:
I didn't use spring amqp api, so I can not provide you working example.

I use consuming with small timeout (and there is a cost of time - small delay,
 not an issue in my case, cpu usage and network fingerprints stays very small).
I was also taking advantage of rabbit's java client prefetching (I am not sure
if spring implements that). These two combined gave me acceptable approximation of priorities.

You could also add to messages own argument (for example myPriority) and consume all messages
as they are available (or let's say up to 200 messages or sth), then put them in a priority
queue on your application side. And then process them from the head of this container (using
dedicated thread). That also may give you acceptable results.

Note that the state of art is as follows: RabbitMQ is a FIFO queue, and does not make
use of message priorities today. It could be changed in one of the future releases, I don't
know when it may be. As consequence of that you should apply some reasonable workaround
which will be acceptable for you or reconsider your needs (maybe you don't really need
priorities?) or use something else than RabbitMQ or implement it by yourself. By the way
AMQP itself says that "Messages with higher priorities MAY be delivered before those with
lower priorities". Following that messages priority in any implementation of AMQP may
be not consistent.

Best regards,
Ernest Staszuk





W dniu 2012-07-27 10:50, andy pisze:
at as you say ,if we are processing 2st queue message as soon as the 1st queue gets a new message needed to process,how can we switch to process 1st? It also means that we should check the amount of  messages in the queue  in order ,I think it will cost much time and machine resource.and could you tell me  how I could  use spring amqp a


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120727/333c9986/attachment.htm>

From ward.mark at gmail.com  Fri Jul 27 14:34:52 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Fri, 27 Jul 2012 06:34:52 -0700 (PDT)
Subject: [rabbitmq-discuss] pull task queue design
In-Reply-To: <b409f5ae-bb98-4492-8b5e-dc730fef882b@googlegroups.com>
References: <b409f5ae-bb98-4492-8b5e-dc730fef882b@googlegroups.com>
Message-ID: <cba3c403-28d4-4cbd-8b1f-82da4cc5e6a3@googlegroups.com>

Hi,

Disregard this thread.  I am making progress in reading and learning how to 
use the AMQP protocol.  I have had to unlearn how queues have been used in 
the past.  AMQP and RabbitMQ is impressive.

-Mark

On Tuesday, July 24, 2012 10:31:10 AM UTC-5, Mark Ward wrote:
>
> Hello,
>
> I am fairly new to rabbitMQ and AMQP.  I am wondering if it is possible to 
> build a pull task queue with task lease capabilities.  Something like the 
> Google App Engine pull queue  
> https://developers.google.com/appengine/docs/python/taskqueue/overview-pull.  
>
>
> I am exploring the idea to have an http/rest interface between our worker 
> and the server.  The server would connect rabbitMQ.  The workers are 
> distributed to our client sites.  The reasoning behind this is due to being 
> unsure how the persistent connection of AMQP will fair with customer?s 
> firewall and proxy server configurations.  I cannot predict the 
> combinations or limitations of outbound connections but typically http(s) 
> 80/443 are guaranteed outbound connections.
>
> Possibly a reassurance of how well the AMQP protocol fairs across the 
> internet may sway the design back to use the AMQP protocol over using the 
> http/proxy idea.  The AMQP setup at the client site will need to function 
> right from the start without having to involve network administrators 
> altering configurations.  It would be possible for us to host rabbitMQ on 
> ports 80/443.
>
> It might be impossible if I am correct that AMQP does not provide message 
> timeouts and messages are redelivered if the worker?s connection dies.  
> With an http/proxy implementation the connections would have to be 
> stateless.
>
>  
>
> -Mark
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120727/1354589a/attachment.htm>

From paddy.carman at gmail.com  Fri Jul 27 18:19:50 2012
From: paddy.carman at gmail.com (Paddy Carman)
Date: Fri, 27 Jul 2012 10:19:50 -0700
Subject: [rabbitmq-discuss] Why do we need rabbitmq-web-stomp and why
 not rabitmq-web-amqp (over websockets)?
In-Reply-To: <87k3xp31pp.wl%francesco@rabbitmq.com>
References: <CAOGkWBaVZv=rSFRc-kdFLJRptCxPZ298DxRFwUFjxvLiQpZL-w@mail.gmail.com>
	<87k3xp31pp.wl%francesco@rabbitmq.com>
Message-ID: <CAOGkWBaiDvx34X=irw4H5RhH40Vjyc0Wpynsgiq0pqahMHuY8g@mail.gmail.com>

Hi Francesco,
    Thanks.
    Why is it a bad idea to expose AMQP to web clients? I see at least one
company betting on it:  http://kaazing.com/products/amqp-edition
-PC

On Fri, Jul 27, 2012 at 4:03 AM, Francesco Mazzoli
<francesco at rabbitmq.com>wrote:

> At Thu, 26 Jul 2012 10:03:28 -0700,
> Paddy Carman wrote:
> > Hi -
> >     I'm reading about the rabbitmq-web-stomp plugin. It seem very cool -
> STOMP
> > over Websockets connecting to AMQP backend. My questions:
> > * can we do AMQP over websockets directly and
> > * If so, why do we need STOMP?
> > * Is there any particular advantage of using STOMP?
>
> Stomp is a tremendously more simple protocol than AMQP, which is why it is
> easy
> to have a STOMP-over-SockJS.  Moreover, exposing AMQP to the internet is
> not a
> good idea.
>
> > * Are there performance implications in the STOM<>AMQP translation?
>
> Not really.  The STOMP plugin uses the direct exchange, and converting
> between
> message formats is straightforward.
>
> --
> Francesco * Often in error, never in doubt
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120727/384c091f/attachment.htm>

From james.mcmahon at TASC.COM  Fri Jul 27 19:58:15 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Fri, 27 Jul 2012 18:58:15 +0000
Subject: [rabbitmq-discuss] Configuring beyond rabbitmq server
	on	localhost
In-Reply-To: <87d33mzc9p.wl%francesco@rabbitmq.com>
References: <C974010E949511448F6DC6F748F604D90FF1B0EB@TSEAMB01>,
	<87d33mzc9p.wl%francesco@rabbitmq.com>
Message-ID: <C974010E949511448F6DC6F748F604D90FF1E999@TSEAMB01>

Francesco, I have set RABBITMQ_NODE_PORT to 8009. Typically when I have been testing using localhost and 5672, I would start rabbitmq using the command

rabbitmq-server -detached

Should I not do that if I have a particular port I wish to listen on?

    I ask because I am getting an exception in my main of EmitLogDirect and ReceiveLogsDirect when I try to send and/or listen to that particular port. Here is my EmitLogDirect code:

package com.tasc.prism.queue;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.Map;

import javax.xml.bind.JAXBContext;
import javax.xml.bind.Marshaller;

import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.AMQP;


public class EmitLogDirect {

  private static final String EXCHANGE_NAME = "BRASS_PRISM";

  public static void main(String[] argv) throws Exception {

          String hostName = "localhost";
          int portNumber = 5672;

          if (argv.length < 2 || argv.length == 3 || argv.length > 4){
                  System.err.println("Usage: EmitLogDirect [BRASS Prism unique session ID] [\"your message\"] [rMQ host, optional] [rMQ port #, optional]");
                  System.exit(1);
          }
          else if (argv.length == 2) {
                  hostName = "localhost";
                  portNumber = 5672; // default port that rabbitMQ listens to
          }
          else if  (argv.length == 4) {
                  hostName = argv[2];
                  portNumber = Integer.parseInt(argv[3]);
          }


          ConnectionFactory factory = new ConnectionFactory();
          factory.setHost(hostName);
          factory.setPort(portNumber);
          Connection connection = factory.newConnection();
          Channel channel = connection.createChannel();

          //channel.exchangeDeclare(EXCHANGE_NAME, "direct");

          String exchange = getExchange(argv);
          String message = getMessage(argv);

          channel.basicPublish(EXCHANGE_NAME, exchange, null, message.getBytes());
          System.out.println(" [x] Sent '" + exchange + "':'" + message + "'");

          channel.close();
          connection.close();
  }

  private static String getExchange(String[] strings){
    if (strings.length < 1)
     return "info";
    return strings[0];
  }

  private static String getMessage(String[] strings){
    if (strings.length < 2)
     return "Hello World!";
    //return joinStrings(strings, " ", 1);
    return strings[1];
  }
}

My rabbitmq hostname is rabbit at PEWTER.

How should I start my rabbitmq-server to be running on port 8009? And what hostname and port should I pass to my EmitLogDirect java class?

Jim
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Francesco Mazzoli [francesco at rabbitmq.com]
Sent: Monday, July 23, 2012 12:13 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuring beyond rabbitmq server on   localhost

Hi Jim,
At Mon, 23 Jul 2012 14:29:29 +0000,
McMahon, James S (TASC) wrote:
>      How is this done? I'm guessing that I need to replace all my localhost
> references with some form of a URL for my remote host, and I suspect there
> will be rabbitmq and/or erlang configuration files that need to be modified on
> the server host and client machines so that they can communicate with the
> rabbitmq remote server. Is there an example?

To communicate with a remote rabbit server you need, as you guessed, to specify
the remote host and port when establishing a connection to the broker.  In the
case of the Java client you can do that with the relevant `ConnectionFactory'
methods.

Rabbit will bind on all interfaces by default, so the broker will be accessible
remotely.

>      Do people typically have multiple rabbitMQ servers running in some
>      federated fashion, serving as backup instances for fault tolerance and
>      fail over?

There are various way to cluster/federate rabbit brokers, see
http://www.rabbitmq.com/distributed.html for a comparison between the various
approaches.

--
Francesco * Often in error, never in doubt
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.

From james.mcmahon at TASC.COM  Fri Jul 27 20:58:33 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Fri, 27 Jul 2012 19:58:33 +0000
Subject: [rabbitmq-discuss] Configuring beyond
	rabbitmq	server	on	localhost
In-Reply-To: <87boj6za61.wl%francesco@rabbitmq.com>
References: <C974010E949511448F6DC6F748F604D90FF1B0EB@TSEAMB01>,
	<87boj6za61.wl%francesco@rabbitmq.com>
Message-ID: <C974010E949511448F6DC6F748F604D90FF1E9BC@TSEAMB01>

Can you show me by simple example, is hostName in the following code supposed to be an IP address, or MYCOMPNAME from rabbit at MYCOMPNAME, or the entire string rabbit at MYCOMPNAME, or something else?

          ConnectionFactory factory = new ConnectionFactory();
          factory.setHost(hostName);
          factory.setPort(portNumber);
          Connection connection = factory.newConnection();
          Channel channel = connection.createChannel();

Jim
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Francesco Mazzoli [francesco at rabbitmq.com]
Sent: Monday, July 23, 2012 12:58 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuring beyond rabbitmq     server  on      localhost

At Mon, 23 Jul 2012 16:41:53 +0000,
McMahon, James S (TASC) wrote:
> On the server running my rabbitmq instance, how do I tell it "service incoming
> requests to send or read messages by listening on port 1234"?

By changing the RABBITMQ_NODE_PORT environmental variable, see
http://www.rabbitmq.com/configure.html .

> When you say Rabbit binds on all interfaces by default, that doesn't mean it
> monitors all ports does it?

It obviously doesn't (that would be an odd thing to do), I meant that rabbitmq
will receive all incoming connection and not just local one (in other words it
won't bind to the loopback interface only).

--
Francesco * Often in error, never in doubt
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.

From jerryk at rbcon.com  Fri Jul 27 21:18:47 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Fri, 27 Jul 2012 13:18:47 -0700
Subject: [rabbitmq-discuss] Configuring beyond rabbitmq	server	on
	localhost
In-Reply-To: <C974010E949511448F6DC6F748F604D90FF1E9BC@TSEAMB01>
References: <C974010E949511448F6DC6F748F604D90FF1B0EB@TSEAMB01>
	<87boj6za61.wl%francesco@rabbitmq.com>
	<C974010E949511448F6DC6F748F604D90FF1E9BC@TSEAMB01>
Message-ID: <795F2997-ACC2-42DD-93F7-571808F457B1@rbcon.com>

you're good with any string that your machine can resolve to the IP address
of the system you're trying to connect to...  this could be either a host name or an IP address depending on the state of your DNS setup, your hosts file, etc.

If you fail to connect, inspect the resulting exception or details...

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On Jul 27, 2012, at 12:58 PM, "McMahon, James S (TASC)" <james.mcmahon at TASC.COM> wrote:

> Can you show me by simple example, is hostName in the following code supposed to be an IP address, or MYCOMPNAME from rabbit at MYCOMPNAME, or the entire string rabbit at MYCOMPNAME, or something else?
> 
>          ConnectionFactory factory = new ConnectionFactory();
>          factory.setHost(hostName);
>          factory.setPort(portNumber);
>          Connection connection = factory.newConnection();
>          Channel channel = connection.createChannel();
> 
> Jim
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Francesco Mazzoli [francesco at rabbitmq.com]
> Sent: Monday, July 23, 2012 12:58 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Configuring beyond rabbitmq     server  on      localhost
> 
> At Mon, 23 Jul 2012 16:41:53 +0000,
> McMahon, James S (TASC) wrote:
>> On the server running my rabbitmq instance, how do I tell it "service incoming
>> requests to send or read messages by listening on port 1234"?
> 
> By changing the RABBITMQ_NODE_PORT environmental variable, see
> http://www.rabbitmq.com/configure.html .
> 
>> When you say Rabbit binds on all interfaces by default, that doesn't mean it
>> monitors all ports does it?
> 
> It obviously doesn't (that would be an odd thing to do), I meant that rabbitmq
> will receive all incoming connection and not just local one (in other words it
> won't bind to the loopback interface only).
> 
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.mcmahon at TASC.COM  Fri Jul 27 21:32:04 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Fri, 27 Jul 2012 20:32:04 +0000
Subject: [rabbitmq-discuss] Configuring beyond
	rabbitmq	server	on	localhost
In-Reply-To: <795F2997-ACC2-42DD-93F7-571808F457B1@rbcon.com>
References: <C974010E949511448F6DC6F748F604D90FF1B0EB@TSEAMB01>
	<87boj6za61.wl%francesco@rabbitmq.com>
	<C974010E949511448F6DC6F748F604D90FF1E9BC@TSEAMB01>,
	<795F2997-ACC2-42DD-93F7-571808F457B1@rbcon.com>
Message-ID: <C974010E949511448F6DC6F748F604D90FF1E9DC@TSEAMB01>

     Thank you for the reply, Jerry. On the machines from which I am trying to communicate using EmitLogDirect with a ReceiveLogsDirect instance on another machine through the rabbitmq server on a third machine, is the only software install I need to do (other than my java files) the download and install of the rabbitmq-client code? In other words, so that the machine running EmitLogDirect (and the one running ReceiveLogsDirect) knows how to find the jars it requires to build my class file?

     It's not clear to me what download, install, and configuration I need to do on the non-rabbimq server machines - the clients, if you will.

Jim

________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Jerry Kuch [jerryk at rbcon.com]
Sent: Friday, July 27, 2012 4:18 PM
To: Discussions about RabbitMQ
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuring beyond rabbitmq     server  on      localhost

you're good with any string that your machine can resolve to the IP address
of the system you're trying to connect to...  this could be either a host name or an IP address depending on the state of your DNS setup, your hosts file, etc.

If you fail to connect, inspect the resulting exception or details...

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On Jul 27, 2012, at 12:58 PM, "McMahon, James S (TASC)" <james.mcmahon at TASC.COM> wrote:

> Can you show me by simple example, is hostName in the following code supposed to be an IP address, or MYCOMPNAME from rabbit at MYCOMPNAME, or the entire string rabbit at MYCOMPNAME, or something else?
>
>          ConnectionFactory factory = new ConnectionFactory();
>          factory.setHost(hostName);
>          factory.setPort(portNumber);
>          Connection connection = factory.newConnection();
>          Channel channel = connection.createChannel();
>
> Jim
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Francesco Mazzoli [francesco at rabbitmq.com]
> Sent: Monday, July 23, 2012 12:58 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Configuring beyond rabbitmq     server  on      localhost
>
> At Mon, 23 Jul 2012 16:41:53 +0000,
> McMahon, James S (TASC) wrote:
>> On the server running my rabbitmq instance, how do I tell it "service incoming
>> requests to send or read messages by listening on port 1234"?
>
> By changing the RABBITMQ_NODE_PORT environmental variable, see
> http://www.rabbitmq.com/configure.html .
>
>> When you say Rabbit binds on all interfaces by default, that doesn't mean it
>> monitors all ports does it?
>
> It obviously doesn't (that would be an odd thing to do), I meant that rabbitmq
> will receive all incoming connection and not just local one (in other words it
> won't bind to the loopback interface only).
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From cal5101 at yahoo.com  Fri Jul 27 22:57:59 2012
From: cal5101 at yahoo.com (Al Al)
Date: Fri, 27 Jul 2012 14:57:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Repeating error from Management Plugin
Message-ID: <1343426279.10776.YahooMailClassic@web161505.mail.bf1.yahoo.com>

Hi,?
I have been using the management plugin without any issues then suddenly I began getting errors when I try to do any action (except for GET):
For example, add Exchange:HTTP PUThttp://myhost:55672/api/exchanges/%2F/testExchange
500 Internal Server Error. The server encountered an error while processing this request{error,
 {exit,
  {{{badmatch,
     {badrpc,
      {'EXIT',
       {undef,
        [{rabbit_direct,start_channel,
          [1,<0.30609.0>,<0.30602.0>,<<"<rabbit at xenon.2.30602.0>">>,
           rabbit_framing_amqp_0_9_1,
           {user,<<"guest">>,
            [administrator],
            rabbit_auth_backend_internal,
            {internal_user,<<"guest">>,
             <<59,41,152,111,63,198,158,154,3,61,54,115,169,32,145,215,66,47,
               97,80>>,
             [administrator]}},
           <<"/">>,
           [{<<"publisher_confirms">>,bool,true},
            {<<"exchange_exchange_bindings">>,bool,true},
            {<<"basic.nack">>,bool,true},
            {<<"consumer_cancel_notify">>,bool,true}],
           <0.30606.0>]},
         {rpc,local_call,3},
         {amqp_channel_sup,'-start_writer_fun/4-fun-0-',7},
         {amqp_channel,start_writer,1},
         {amqp_channel,do_rpc,1},
         {amqp_channel,handle_call,3},
         {gen_server,handle_msg,5},
         {proc_lib,init_p_do_apply,3}]}}}},
    [{amqp_channel_sup,'-start_writer_fun/4-fun-0-',7},
     {amqp_channel,start_writer,1},
     {amqp_channel,do_rpc,1},
     {amqp_channel,handle_call,3},
     {gen_server,handle_msg,5},
     {proc_lib,init_p_do_apply,3}]},
   {gen_server,call,[<0.30609.0>,open,infinity]}},
  [{gen_server,call,3},
   {amqp_gen_connection,open_channel,3},
   {rabbit_mgmt_util,with_channel,5},
   {rabbit_mgmt_util,http_to_amqp,5},
   {webmachine_resource,resource_call,3},
   {webmachine_resource,do,3},
   {webmachine_decision_core,resource_call,1},
   {webmachine_decision_core,accept_helper,0}]}}Similarly for other actions like Publish message, Delete Exchange, Add Queue. I'm not sure I understand what the errors in the log file mean.I am on CentOS 6.0 running RabbitMQ version 2.6.1 and Erlang R14B04.I'm not sure what caused this problem. I have been using this set-up without any issues. The only thing new I have been doing is using the Erlang and Python (pika) clients to declare exchanges.Log file attached.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120727/605a42d7/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq_log_file.log
Type: application/octet-stream
Size: 48622 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120727/605a42d7/attachment.obj>

From jerryk at rbcon.com  Fri Jul 27 23:57:39 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Fri, 27 Jul 2012 15:57:39 -0700
Subject: [rabbitmq-discuss] Configuring beyond rabbitmq server on
	localhost
In-Reply-To: <C974010E949511448F6DC6F748F604D90FF1E9DC@TSEAMB01>
References: <C974010E949511448F6DC6F748F604D90FF1B0EB@TSEAMB01>
	<87boj6za61.wl%francesco@rabbitmq.com>
	<C974010E949511448F6DC6F748F604D90FF1E9BC@TSEAMB01>
	<795F2997-ACC2-42DD-93F7-571808F457B1@rbcon.com>
	<C974010E949511448F6DC6F748F604D90FF1E9DC@TSEAMB01>
Message-ID: <CAE0Sz=xgQ=XQBij7bJYw-+FcxLW+2Z6mLjg7fuTp5Da5J7D3ZA@mail.gmail.com>

Hi, James:

A machine wanting to use our regular Java client needs only that JAR and
its very short list of dependencies.  See:

http://mvnrepository.com/artifact/com.rabbitmq/amqp-client/2.8.4

A program publishing or consuming messages will need the client and its
dependencies on its runtime classpath, and of course its compile classpath
if you're also building the code there.

Best regards,
Jerry

On Fri, Jul 27, 2012 at 1:32 PM, McMahon, James S (TASC) <
james.mcmahon at tasc.com> wrote:

>      Thank you for the reply, Jerry. On the machines from which I am
> trying to communicate using EmitLogDirect with a ReceiveLogsDirect instance
> on another machine through the rabbitmq server on a third machine, is the
> only software install I need to do (other than my java files) the download
> and install of the rabbitmq-client code? In other words, so that the
> machine running EmitLogDirect (and the one running ReceiveLogsDirect) knows
> how to find the jars it requires to build my class file?
>
>      It's not clear to me what download, install, and configuration I need
> to do on the non-rabbimq server machines - the clients, if you will.
>
> Jim
>
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [
> rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Jerry Kuch [
> jerryk at rbcon.com]
> Sent: Friday, July 27, 2012 4:18 PM
> To: Discussions about RabbitMQ
> Cc: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Configuring beyond rabbitmq     server  on
>      localhost
>
> you're good with any string that your machine can resolve to the IP address
> of the system you're trying to connect to...  this could be either a host
> name or an IP address depending on the state of your DNS setup, your hosts
> file, etc.
>
> If you fail to connect, inspect the resulting exception or details...
>
> Sent from my iPhone (Brevity and typos are hopefully the result of
> 1-fingered typing rather than rudeness or illiteracy).
>
>
> On Jul 27, 2012, at 12:58 PM, "McMahon, James S (TASC)" <
> james.mcmahon at TASC.COM> wrote:
>
> > Can you show me by simple example, is hostName in the following code
> supposed to be an IP address, or MYCOMPNAME from rabbit at MYCOMPNAME, or
> the entire string rabbit at MYCOMPNAME, or something else?
> >
> >          ConnectionFactory factory = new ConnectionFactory();
> >          factory.setHost(hostName);
> >          factory.setPort(portNumber);
> >          Connection connection = factory.newConnection();
> >          Channel channel = connection.createChannel();
> >
> > Jim
> > ________________________________________
> > From: rabbitmq-discuss-bounces at lists.rabbitmq.com [
> rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Francesco
> Mazzoli [francesco at rabbitmq.com]
> > Sent: Monday, July 23, 2012 12:58 PM
> > To: Discussions about RabbitMQ
> > Subject: Re: [rabbitmq-discuss] Configuring beyond rabbitmq     server
>  on      localhost
> >
> > At Mon, 23 Jul 2012 16:41:53 +0000,
> > McMahon, James S (TASC) wrote:
> >> On the server running my rabbitmq instance, how do I tell it "service
> incoming
> >> requests to send or read messages by listening on port 1234"?
> >
> > By changing the RABBITMQ_NODE_PORT environmental variable, see
> > http://www.rabbitmq.com/configure.html .
> >
> >> When you say Rabbit binds on all interfaces by default, that doesn't
> mean it
> >> monitors all ports does it?
> >
> > It obviously doesn't (that would be an odd thing to do), I meant that
> rabbitmq
> > will receive all incoming connection and not just local one (in other
> words it
> > won't bind to the loopback interface only).
> >
> > --
> > Francesco * Often in error, never in doubt
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > CONFIDENTIALITY NOTICE: This message and any attachments or files
> transmitted with it (collectively, the "Message") are intended only for the
> addressee and may contain information that is privileged, proprietary
> and/or prohibited from disclosure by law or contract. If you are not the
> intended recipient: (a) please do not read, copy or retransmit the Message;
> (b) permanently delete and/or destroy all electronic and hard copies of the
> Message; (c) notify us by return email; and (d) you are hereby notified
> that any dissemination, distribution or copying of the Message is strictly
> prohibited.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120727/d7146e74/attachment.htm>

From kekib at alum.vassar.edu  Sat Jul 28 03:20:40 2012
From: kekib at alum.vassar.edu (kmb)
Date: Fri, 27 Jul 2012 19:20:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Limiting the size of a message
Message-ID: <1343442040462-21099.post@n5.nabble.com>

Hi, 

Is there a way to limit the size of messages that producers can send? I'd
like to prevent an authorized user with malicious intent from crashing a
RabbitMQ server (or severly degrading performance for a while) by sending a
massive message.

KMB



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Limiting-the-size-of-a-message-tp21099.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From arnaudtanguy at gmail.com  Fri Jul 27 17:47:13 2012
From: arnaudtanguy at gmail.com (Arnaud Tanguy)
Date: Fri, 27 Jul 2012 09:47:13 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit.js and x-ha-policy
Message-ID: <fbcc81d0-5160-4e33-8a83-7bfceb6efa50@googlegroups.com>

Hi guys,

I'm wondering how to set arguments to a queue in rabbit.js.

I'want to use this option: {'arguments': {'x-ha-policy': 'all'}

//rabbitMq connection ready
context.on('ready', function () {
    var pubStatSub = context.socket('PUSH');
    pubStatSub.connect('statsub_queue');

});

Is that possible?
Do I have to switch to an other library like node-amqp? (if it's possible)

Thanks for your help.

Cheers,
Arnaud.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120727/b74e0ad1/attachment.htm>

From jaaaelpumuki at gmail.com  Sat Jul 28 11:52:16 2012
From: jaaaelpumuki at gmail.com (=?ISO-8859-1?Q?F=E9lix_L=F3pez?=)
Date: Sat, 28 Jul 2012 12:52:16 +0200
Subject: [rabbitmq-discuss] Exchange with throttling
In-Reply-To: <500E6E96.2010304@rabbitmq.com>
References: <1ccea2bc-4d26-427f-b174-ff78de0de8c7@googlegroups.com>
	<500E6E96.2010304@rabbitmq.com>
Message-ID: <CAFdw230XV7YYV5mhpKek3DKpEV2RLQnWabxxBpmG-JoHrO7TZg@mail.gmail.com>

Thanks,

I've finally made a plugin to do that. I think what I wanted to do It
cannot be possible with mechanism you sent me in the email.

The plugin is here
https://github.com/flopezluis/rabbitmq-throttling-exchange, It has a lot to
improve and certainly I'm not sure of the impact of this exchange in the
performance of rabbitmq.


2012/7/24 Emile Joubert <emile at rabbitmq.com>

> Hi,
>
> On 23/07/12 18:20, F?lix wrote:
> > Is there anything similar in rabbitmq?
>
> Yes, the broker has a connection-based flow control mechanism - see
> http://www.rabbitmq.com/memory.html#per-connection
> and a blog post that explains further:
>
> http://www.rabbitmq.com/blog/2012/04/17/rabbitmq-performance-measurements-part-1/
>
> Bear in mind that blocking an Erlang process will lead to a backlog in
> its internal mailbox without slowing down the network. Also, the
> exchange is not a natural control point for bandwidth limiting, because
> an exchange is not a process. A channel would be a more natural choice.
> You may be able to adapt the existing flow control mechanism to grant
> credits based on bandwidth rather than message count.
>
>
>
> -Emile
>
>


-- 
http://www.linkedin.com/in/flopezluis

It's easier to ask forgiveness than it is to get permission


".....it doesn't matter how many times you fail. It doesn't matter how many
times you almost get it right. No one is going to know or care about your
failures, and either should you. All you have to do is learn from them and
those around you because...All that matters in business is that you get it
right once. Then everyone can tell you how lucky you are."
--Mark Cuban"

"Always be the worst guy in every band you're in." If you're the best guy
there, you need to be in a different band. And I think that works for
almost everything that's out there as well." Pat Metheny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120728/67ea15b1/attachment.htm>

From jaaaelpumuki at gmail.com  Sat Jul 28 11:52:44 2012
From: jaaaelpumuki at gmail.com (=?UTF-8?Q?F=C3=A9lix?=)
Date: Sat, 28 Jul 2012 03:52:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Exchange with throttling
In-Reply-To: <1ccea2bc-4d26-427f-b174-ff78de0de8c7@googlegroups.com>
References: <1ccea2bc-4d26-427f-b174-ff78de0de8c7@googlegroups.com>
Message-ID: <24c846ac-91c3-4304-8dea-a768d6c33335@googlegroups.com>

I've finally made a plugin to do that. The plugin is here 
https://github.com/flopezluis/rabbitmq-throttling-exchange, It has a lot to 
improve and certainly I'm not sure of the impact of this exchange in the 
performance of rabbitmq.


El lunes, 23 de julio de 2012 19:20:10 UTC+2, F?lix escribi?:
>
> Hi,
>
> I'm thinking of making an exchange that supports throttling. The idea is 
> that you can set the rate in a header, and the exchange checks if it has to 
> wait before dispatch  the message. 
>
> Is there anything similar in rabbitmq?
>
> Thanks
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120728/1d4c6e69/attachment.htm>

From mastronardif at gmail.com  Sat Jul 28 17:35:19 2012
From: mastronardif at gmail.com (Frank Mastronardi)
Date: Sat, 28 Jul 2012 12:35:19 -0400
Subject: [rabbitmq-discuss] Perl AnyEvent::RabbitMQ,
	"Received data is not body frame" issues
Message-ID: <CAAAKxg+7uv3j_7BiyrOtY1Nx=AYBfgjWYWzxxaW+uoXGv+X8_g@mail.gmail.com>

Folks,
I am a newbee and plan on using RabbitMQ.

I have basic setup where I have two console apps. One pushes messages
and one consumes the messages.

I have the problem after I get some messages I get the messages below on my
consumer
and the messages get lost.

Does anyone have any idea why?

I am using Perl and there is not much examples w/ just using
AnyEvent::RabbitMQ.
I can send the code its very basic if need be.

What I get after a few runs.
Received data is not body frame
Received data is not header frame



what I am using  have:
RabbitMQ 2.8.2 on Erlang R15B01
AnyEvent::RabbitMQ;
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120728/94772cb8/attachment.htm>

From james.mcmahon at TASC.COM  Sat Jul 28 18:47:09 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Sat, 28 Jul 2012 17:47:09 +0000
Subject: [rabbitmq-discuss] Configuring beyond rabbitmq server
	on	localhost
In-Reply-To: <CAE0Sz=xgQ=XQBij7bJYw-+FcxLW+2Z6mLjg7fuTp5Da5J7D3ZA@mail.gmail.com>
References: <C974010E949511448F6DC6F748F604D90FF1B0EB@TSEAMB01>
	<87boj6za61.wl%francesco@rabbitmq.com>
	<C974010E949511448F6DC6F748F604D90FF1E9BC@TSEAMB01>
	<795F2997-ACC2-42DD-93F7-571808F457B1@rbcon.com>
	<C974010E949511448F6DC6F748F604D90FF1E9DC@TSEAMB01>,
	<CAE0Sz=xgQ=XQBij7bJYw-+FcxLW+2Z6mLjg7fuTp5Da5J7D3ZA@mail.gmail.com>
Message-ID: <C974010E949511448F6DC6F748F604D90FF1EF34@TSEAMB01>

This was very helpful, Jerry. I got my configuration working flawlessly last night. Thank you very much for your guidance.



Jim



________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Jerry Kuch [jerryk at rbcon.com]
Sent: Friday, July 27, 2012 6:57 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuring beyond rabbitmq server on localhost

Hi, James:

A machine wanting to use our regular Java client needs only that JAR and its very short list of dependencies.  See:

http://mvnrepository.com/artifact/com.rabbitmq/amqp-client/2.8.4

A program publishing or consuming messages will need the client and its dependencies on its runtime classpath, and of course its compile classpath if you're also building the code there.

Best regards,
Jerry

On Fri, Jul 27, 2012 at 1:32 PM, McMahon, James S (TASC) <james.mcmahon at tasc.com<mailto:james.mcmahon at tasc.com>> wrote:
     Thank you for the reply, Jerry. On the machines from which I am trying to communicate using EmitLogDirect with a ReceiveLogsDirect instance on another machine through the rabbitmq server on a third machine, is the only software install I need to do (other than my java files) the download and install of the rabbitmq-client code? In other words, so that the machine running EmitLogDirect (and the one running ReceiveLogsDirect) knows how to find the jars it requires to build my class file?

     It's not clear to me what download, install, and configuration I need to do on the non-rabbimq server machines - the clients, if you will.

Jim

________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com> [rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] on behalf of Jerry Kuch [jerryk at rbcon.com<mailto:jerryk at rbcon.com>]
Sent: Friday, July 27, 2012 4:18 PM
To: Discussions about RabbitMQ
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuring beyond rabbitmq     server  on      localhost

you're good with any string that your machine can resolve to the IP address
of the system you're trying to connect to...  this could be either a host name or an IP address depending on the state of your DNS setup, your hosts file, etc.

If you fail to connect, inspect the resulting exception or details...

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On Jul 27, 2012, at 12:58 PM, "McMahon, James S (TASC)" <james.mcmahon at TASC.COM<mailto:james.mcmahon at TASC.COM>> wrote:

> Can you show me by simple example, is hostName in the following code supposed to be an IP address, or MYCOMPNAME from rabbit at MYCOMPNAME, or the entire string rabbit at MYCOMPNAME, or something else?
>
>          ConnectionFactory factory = new ConnectionFactory();
>          factory.setHost(hostName);
>          factory.setPort(portNumber);
>          Connection connection = factory.newConnection();
>          Channel channel = connection.createChannel();
>
> Jim
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com> [rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] on behalf of Francesco Mazzoli [francesco at rabbitmq.com<mailto:francesco at rabbitmq.com>]
> Sent: Monday, July 23, 2012 12:58 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Configuring beyond rabbitmq     server  on      localhost
>
> At Mon, 23 Jul 2012 16:41:53 +0000,
> McMahon, James S (TASC) wrote:
>> On the server running my rabbitmq instance, how do I tell it "service incoming
>> requests to send or read messages by listening on port 1234"?
>
> By changing the RABBITMQ_NODE_PORT environmental variable, see
> http://www.rabbitmq.com/configure.html .
>
>> When you say Rabbit binds on all interfaces by default, that doesn't mean it
>> monitors all ports does it?
>
> It obviously doesn't (that would be an odd thing to do), I meant that rabbitmq
> will receive all incoming connection and not just local one (in other words it
> won't bind to the loopback interface only).
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120728/9297780f/attachment.htm>

From jerryk at rbcon.com  Sat Jul 28 18:57:48 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Sat, 28 Jul 2012 10:57:48 -0700
Subject: [rabbitmq-discuss] Configuring beyond rabbitmq server on
	localhost
In-Reply-To: <C974010E949511448F6DC6F748F604D90FF1EF34@TSEAMB01>
References: <C974010E949511448F6DC6F748F604D90FF1B0EB@TSEAMB01>
	<87boj6za61.wl%francesco@rabbitmq.com>
	<C974010E949511448F6DC6F748F604D90FF1E9BC@TSEAMB01>
	<795F2997-ACC2-42DD-93F7-571808F457B1@rbcon.com>
	<C974010E949511448F6DC6F748F604D90FF1E9DC@TSEAMB01>
	<CAE0Sz=xgQ=XQBij7bJYw-+FcxLW+2Z6mLjg7fuTp5Da5J7D3ZA@mail.gmail.com>
	<C974010E949511448F6DC6F748F604D90FF1EF34@TSEAMB01>
Message-ID: <CAE0Sz=z4jxt7y88Yeowf-aQk4pOwDcFe8+QKzugyUBiwFjhBYw@mail.gmail.com>

Hi, James:

Glad to hear it worked out for you!

Best regards,
Jerry

On Sat, Jul 28, 2012 at 10:47 AM, McMahon, James S (TASC) <
james.mcmahon at tasc.com> wrote:

>  This was very helpful, Jerry. I got my configuration working flawlessly
> last night. Thank you very much for your guidance.
>
>
>
> Jim
>
>
>  ------------------------------
> *From:* rabbitmq-discuss-bounces at lists.rabbitmq.com [
> rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Jerry Kuch [
> jerryk at rbcon.com]
> *Sent:* Friday, July 27, 2012 6:57 PM
>
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Configuring beyond rabbitmq server on
> localhost
>
>  Hi, James:
>
> A machine wanting to use our regular Java client needs only that JAR and
> its very short list of dependencies.  See:
>
> http://mvnrepository.com/artifact/com.rabbitmq/amqp-client/2.8.4
>
> A program publishing or consuming messages will need the client and its
> dependencies on its runtime classpath, and of course its compile classpath
> if you're also building the code there.
>
> Best regards,
> Jerry
>
> On Fri, Jul 27, 2012 at 1:32 PM, McMahon, James S (TASC) <
> james.mcmahon at tasc.com> wrote:
>
>>      Thank you for the reply, Jerry. On the machines from which I am
>> trying to communicate using EmitLogDirect with a ReceiveLogsDirect instance
>> on another machine through the rabbitmq server on a third machine, is the
>> only software install I need to do (other than my java files) the download
>> and install of the rabbitmq-client code? In other words, so that the
>> machine running EmitLogDirect (and the one running ReceiveLogsDirect) knows
>> how to find the jars it requires to build my class file?
>>
>>      It's not clear to me what download, install, and configuration I
>> need to do on the non-rabbimq server machines - the clients, if you will.
>>
>> Jim
>>
>> ________________________________________
>> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [
>> rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Jerry Kuch [
>> jerryk at rbcon.com]
>> Sent: Friday, July 27, 2012 4:18 PM
>> To: Discussions about RabbitMQ
>> Cc: Discussions about RabbitMQ
>>  Subject: Re: [rabbitmq-discuss] Configuring beyond rabbitmq     server
>>  on      localhost
>>
>> you're good with any string that your machine can resolve to the IP
>> address
>> of the system you're trying to connect to...  this could be either a host
>> name or an IP address depending on the state of your DNS setup, your hosts
>> file, etc.
>>
>> If you fail to connect, inspect the resulting exception or details...
>>
>> Sent from my iPhone (Brevity and typos are hopefully the result of
>> 1-fingered typing rather than rudeness or illiteracy).
>>
>>
>> On Jul 27, 2012, at 12:58 PM, "McMahon, James S (TASC)" <
>> james.mcmahon at TASC.COM> wrote:
>>
>> > Can you show me by simple example, is hostName in the following code
>> supposed to be an IP address, or MYCOMPNAME from rabbit at MYCOMPNAME, or
>> the entire string rabbit at MYCOMPNAME, or something else?
>> >
>> >          ConnectionFactory factory = new ConnectionFactory();
>> >          factory.setHost(hostName);
>> >          factory.setPort(portNumber);
>> >          Connection connection = factory.newConnection();
>> >          Channel channel = connection.createChannel();
>> >
>> > Jim
>> > ________________________________________
>> > From: rabbitmq-discuss-bounces at lists.rabbitmq.com [
>> rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Francesco
>> Mazzoli [francesco at rabbitmq.com]
>> > Sent: Monday, July 23, 2012 12:58 PM
>> > To: Discussions about RabbitMQ
>> > Subject: Re: [rabbitmq-discuss] Configuring beyond rabbitmq     server
>>  on      localhost
>> >
>> > At Mon, 23 Jul 2012 16:41:53 +0000,
>> > McMahon, James S (TASC) wrote:
>> >> On the server running my rabbitmq instance, how do I tell it "service
>> incoming
>> >> requests to send or read messages by listening on port 1234"?
>> >
>> > By changing the RABBITMQ_NODE_PORT environmental variable, see
>> > http://www.rabbitmq.com/configure.html .
>> >
>> >> When you say Rabbit binds on all interfaces by default, that doesn't
>> mean it
>> >> monitors all ports does it?
>> >
>> > It obviously doesn't (that would be an odd thing to do), I meant that
>> rabbitmq
>> > will receive all incoming connection and not just local one (in other
>> words it
>> > won't bind to the loopback interface only).
>> >
>> > --
>> > Francesco * Often in error, never in doubt
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> > CONFIDENTIALITY NOTICE: This message and any attachments or files
>> transmitted with it (collectively, the "Message") are intended only for the
>> addressee and may contain information that is privileged, proprietary
>> and/or prohibited from disclosure by law or contract. If you are not the
>> intended recipient: (a) please do not read, copy or retransmit the Message;
>> (b) permanently delete and/or destroy all electronic and hard copies of the
>> Message; (c) notify us by return email; and (d) you are hereby notified
>> that any dissemination, distribution or copying of the Message is strictly
>> prohibited.
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120728/d14c8187/attachment.htm>

From a.d.prokofiev at gmail.com  Sun Jul 29 20:21:06 2012
From: a.d.prokofiev at gmail.com (anton prokofiev)
Date: Sun, 29 Jul 2012 12:21:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Erlang Consumer Example
Message-ID: <ea3f2de4-2e25-4a4c-a30d-b798520f87bc@googlegroups.com>

Hello, All!

I tried to create  a consumer in Erlang for RabbitMQ and get into big 
troubles.
Looks like examples that are available in RabbitMQ website did not work.

I have found an old post here
 https://groups.google.com/forum/?hl=en&fromgroups#!topicsearchin/rabbitmq-discuss/$20{function_clause,[{amqp_channel,build_content,/rabbitmq-discuss/WttoYWjFweU
unfortunately it is not to clear to me what to do.

Could somebody provide me with a full example of consumer?

Thanks a lot in advance.





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120729/52a932b5/attachment.htm>

From jerryk at rbcon.com  Sun Jul 29 21:40:19 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Sun, 29 Jul 2012 13:40:19 -0700
Subject: [rabbitmq-discuss] Erlang Consumer Example
In-Reply-To: <ea3f2de4-2e25-4a4c-a30d-b798520f87bc@googlegroups.com>
References: <ea3f2de4-2e25-4a4c-a30d-b798520f87bc@googlegroups.com>
Message-ID: <4C626FF2-D096-4C70-923E-C3068209365A@rbcon.com>

Hi, Anton: The Erlang client API has undergone some churn and the documentation has fallen out of step a couple of times. Which version are you currently trying to use and which examples do you feel are steering you wrong? With that information I can take a look and suggest some adaptations... 

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On Jul 29, 2012, at 12:21 PM, anton prokofiev <a.d.prokofiev at gmail.com> wrote:

> Hello, All!
> 
> I tried to create  a consumer in Erlang for RabbitMQ and get into big troubles.
> Looks like examples that are available in RabbitMQ website did not work.
> 
> I have found an old post here
>  https://groups.google.com/forum/?hl=en&fromgroups#!topicsearchin/rabbitmq-discuss/$20{function_clause,[{amqp_channel,build_content,/rabbitmq-discuss/WttoYWjFweU
> unfortunately it is not to clear to me what to do.
> 
> Could somebody provide me with a full example of consumer?
> 
> Thanks a lot in advance.
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dbarre62 at gmail.com  Sat Jul 28 18:46:11 2012
From: dbarre62 at gmail.com (Don)
Date: Sat, 28 Jul 2012 10:46:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Publish/Subscribe ordering of messages
Message-ID: <582b6b58-b944-4cfc-b493-c852cba675a8@googlegroups.com>

Suppose I have several applications that are all publishing to the same 
exchange and I also have several consumer applications each with its own 
queue for that exchange.  Will the messages be received in the same order 
on each of the consumers?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120728/74e0125d/attachment.htm>

From a.d.prokofiev at gmail.com  Sun Jul 29 21:59:46 2012
From: a.d.prokofiev at gmail.com (anton prokofiev)
Date: Sun, 29 Jul 2012 13:59:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Erlang Consumer Example
In-Reply-To: <ea3f2de4-2e25-4a4c-a30d-b798520f87bc@googlegroups.com>
References: <ea3f2de4-2e25-4a4c-a30d-b798520f87bc@googlegroups.com>
Message-ID: <85328f00-373d-4faf-9172-d836c2978fba@googlegroups.com>



On Sunday, 29 July 2012 21:21:06 UTC+2, anton prokofiev wrote:
>
> Hello, All!
>
> I tried to create  a consumer in Erlang for RabbitMQ and get into big 
> troubles.
> Looks like examples that are available in RabbitMQ website did not work.
>
> I have found an old post here
>  
> https://groups.google.com/forum/?hl=en&fromgroups#!topicsearchin/rabbitmq-discuss/$20{function_clause,[{amqp_channel,build_content,/rabbitmq-discuss/WttoYWjFweU
> unfortunately it is not to clear to me what to do.
>
> Could somebody provide me with a full example of consumer?
>
> Thanks a lot in advance.
>
>
>
> Looks like I have found a correct solution:

1. I have implemented simple gen_server, that just print all messages to 
the stdout.

2. And  to like this:
  {ok,Connection} = amqp_connection:start(ConnectionParams), % open 
connection with predefined params.
  {ok,Pid} =  test_srv:start_link(),    % Start our own consumer.
  {ok,Channel}  = amqp_connection:open_channel(Connection,none,*
{amqp_direct_consumer,[Pid]}*),

Then subscribe to the massages as described in the documentation.


In this cases all messages (basic.consume, basic.consume_ok,basic.deliver) 
are received through  handle_info method call of test_srv.

Now the question: 
Would it be better to create my own implementation of consume behavior, or 
handle them thought the message_info as it is now?
Any recommendations?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120729/87b3a7b3/attachment.htm>

From matthias at rabbitmq.com  Sun Jul 29 22:26:48 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 29 Jul 2012 22:26:48 +0100
Subject: [rabbitmq-discuss] Publish/Subscribe ordering of messages
In-Reply-To: <582b6b58-b944-4cfc-b493-c852cba675a8@googlegroups.com>
References: <582b6b58-b944-4cfc-b493-c852cba675a8@googlegroups.com>
Message-ID: <5015AA98.9010208@rabbitmq.com>

Don,

On 28/07/12 18:46, Don wrote:
> Suppose I have several applications that are all publishing to the same
> exchange and I also have several consumer applications each with its own
> queue for that exchange.  Will the messages be received in the same
> order on each of the consumers?

No. See http://www.rabbitmq.com/semantics.html#ordering


Matthias.

From toby.corkindale at strategicdata.com.au  Mon Jul 30 08:42:24 2012
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Mon, 30 Jul 2012 17:42:24 +1000
Subject: [rabbitmq-discuss] Perl AnyEvent::RabbitMQ,
 "Received data is not body frame" issues
In-Reply-To: <CAAAKxg+7uv3j_7BiyrOtY1Nx=AYBfgjWYWzxxaW+uoXGv+X8_g@mail.gmail.com>
References: <CAAAKxg+7uv3j_7BiyrOtY1Nx=AYBfgjWYWzxxaW+uoXGv+X8_g@mail.gmail.com>
Message-ID: <50163AE0.4080100@strategicdata.com.au>

On 29/07/12 02:35, Frank Mastronardi wrote:
> Folks,
> I am a newbee and plan on using RabbitMQ.
>
> I have basic setup where I have two console apps. One pushes messages
> and one consumes the messages.
>
> I have the problem after I get some messages I get the messages below on
> my consumer
> and the messages get lost.
>
> Does anyone have any idea why?
>
> I am using Perl and there is not much examples w/ just using
> AnyEvent::RabbitMQ.
> I can send the code its very basic if need be.

The author of that library abandoned it; they haven't responded to bugs 
or patches for at least a year or more, and I recall that it didn't work 
well when I tried it even longer ago.

I use Net::STOMP::Client. It works well, and the author is active on 
this list.


-Toby

From matthias at rabbitmq.com  Mon Jul 30 09:29:01 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 30 Jul 2012 09:29:01 +0100
Subject: [rabbitmq-discuss] Perl AnyEvent::RabbitMQ,
 "Received data is not body frame" issues
In-Reply-To: <50163AE0.4080100@strategicdata.com.au>
References: <CAAAKxg+7uv3j_7BiyrOtY1Nx=AYBfgjWYWzxxaW+uoXGv+X8_g@mail.gmail.com>
	<50163AE0.4080100@strategicdata.com.au>
Message-ID: <501645CD.9080302@rabbitmq.com>

On 30/07/12 08:42, Toby Corkindale wrote:
> On 29/07/12 02:35, Frank Mastronardi wrote:
>> I am using Perl and there is not much examples w/ just using
>> AnyEvent::RabbitMQ.
>
> The author of that library abandoned it; they haven't responded to bugs
> or patches for at least a year or more, and I recall that it didn't work
> well when I tried it even longer ago.
>
> I use Net::STOMP::Client. It works well, and the author is active on
> this list.

There is also POE::Component::Client::AMQP - 
http://search.cpan.org/dist/POE-Component-Client-AMQP/ - which is 
actively maintained.


Regards,

Matthias.

From emile at rabbitmq.com  Mon Jul 30 10:05:01 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 30 Jul 2012 10:05:01 +0100
Subject: [rabbitmq-discuss] Limiting the size of a message
In-Reply-To: <1343442040462-21099.post@n5.nabble.com>
References: <1343442040462-21099.post@n5.nabble.com>
Message-ID: <50164E3D.5000101@rabbitmq.com>


Hi,

On 28/07/12 03:20, kmb wrote:
> Is there a way to limit the size of messages that producers can send? I'd
> like to prevent an authorized user with malicious intent from crashing a
> RabbitMQ server (or severly degrading performance for a while) by sending a
> massive message.

No, the message size cannot be limited, but it is possible to limit the
size of frames (see
http://www.rabbitmq.com/amqp-0-9-1-reference.html#connection.tune.frame-max)
and it is possible to limit the time that a message may spend in a queue
(see
http://www.rabbitmq.com/extensions.html#queue-ttl).

If you are concerned about a malicious user that may flood the broker
with large messages, then consider fronting the broker with an AMQP
proxy that measures message sizes and disconnects clients that send
oversize messages.


-Emile


From matthias at rabbitmq.com  Mon Jul 30 10:22:45 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 30 Jul 2012 10:22:45 +0100
Subject: [rabbitmq-discuss] Limiting the size of a message
In-Reply-To: <50164E3D.5000101@rabbitmq.com>
References: <1343442040462-21099.post@n5.nabble.com>
	<50164E3D.5000101@rabbitmq.com>
Message-ID: <50165265.9050401@rabbitmq.com>

On 30/07/12 10:05, Emile Joubert wrote:
> On 28/07/12 03:20, kmb wrote:
>> Is there a way to limit the size of messages that producers can send? I'd
>> like to prevent an authorized user with malicious intent from crashing a
>> RabbitMQ server (or severly degrading performance for a while) by sending a
>> massive message.
>
> No, the message size cannot be limited

...though this feature is on our to-do list.

> but it is possible to limit the size of frames (see
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#connection.tune.frame-max)

...though that limit is currently not enforced, i.e. the broker will 
happily accept larger frames. We intend to change that in a future release.

Regards,

Matthias.

From tim at rabbitmq.com  Mon Jul 30 10:26:45 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 30 Jul 2012 10:26:45 +0100
Subject: [rabbitmq-discuss] Exchange with throttling
In-Reply-To: <CAFdw230XV7YYV5mhpKek3DKpEV2RLQnWabxxBpmG-JoHrO7TZg@mail.gmail.com>
References: <1ccea2bc-4d26-427f-b174-ff78de0de8c7@googlegroups.com>
	<500E6E96.2010304@rabbitmq.com>
	<CAFdw230XV7YYV5mhpKek3DKpEV2RLQnWabxxBpmG-JoHrO7TZg@mail.gmail.com>
Message-ID: <50165355.6010800@rabbitmq.com>

Just to add to Emile's comments, I there are a couple of things to 
consider here.

Firstly, it's important to point out that letting the Channel process 
mailbox fill up could lead to unexpected and unpredictable performance 
characteristics, and doesn't appear to offer anything that 
per-connection flow control isn't already doing. Also, creating an 
mnesia transaction for each routing operation is likely to produce an 
altogether *different* kind of throttling of Rabbit's performance across 
a cluster, and probably (in fact, almost certainly) not the one you 
intended.

I would strongly recommend reconsidering this approach. If you're 
interested in extending the flow control mechanism to support 
alternative measures, then perhaps we should have a collective 
conversation about that instead, as Emile is quite right in suggesting 
that approach makes more sense.

Cheers,
Tim

On 07/28/2012 11:52 AM, F?lix L?pez wrote:
> Thanks,
>
> I've finally made a plugin to do that. I think what I wanted to do It 
> cannot be possible with mechanism you sent me in the email.
>
> The plugin is here 
> https://github.com/flopezluis/rabbitmq-throttling-exchange, It has a 
> lot to improve and certainly I'm not sure of the impact of this 
> exchange in the performance of rabbitmq.
>
>
> 2012/7/24 Emile Joubert <emile at rabbitmq.com <mailto:emile at rabbitmq.com>>
>
>     Hi,
>
>     On 23/07/12 18:20, F?lix wrote:
>     > Is there anything similar in rabbitmq?
>
>     Yes, the broker has a connection-based flow control mechanism - see
>     http://www.rabbitmq.com/memory.html#per-connection
>     and a blog post that explains further:
>     http://www.rabbitmq.com/blog/2012/04/17/rabbitmq-performance-measurements-part-1/
>
>     Bear in mind that blocking an Erlang process will lead to a backlog in
>     its internal mailbox without slowing down the network. Also, the
>     exchange is not a natural control point for bandwidth limiting,
>     because
>     an exchange is not a process. A channel would be a more natural
>     choice.
>     You may be able to adapt the existing flow control mechanism to grant
>     credits based on bandwidth rather than message count.
>
>
>
>     -Emile
>
>
>
>
> -- 
> http://www.linkedin.com/in/flopezluis
>
> It's easier to ask forgiveness than it is to get permission
>
>
> ".....it doesn't matter how many times you fail. It doesn't matter how 
> many times you almost get it right. No one is going to know or care 
> about your failures, and either should you. All you have to do is 
> learn from them and those around you because...All that matters in 
> business is that you get it right once. Then everyone can tell you how 
> lucky you are."
> --Mark Cuban"
>
> "Always be the worst guy in every band you're in." If you're the best 
> guy there, you need to be in a different band. And I think that works 
> for almost everything that's out there as well." Pat Metheny
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120730/675fc544/attachment.htm>

From jaaaelpumuki at gmail.com  Mon Jul 30 10:45:09 2012
From: jaaaelpumuki at gmail.com (=?ISO-8859-1?Q?F=E9lix_L=F3pez?=)
Date: Mon, 30 Jul 2012 11:45:09 +0200
Subject: [rabbitmq-discuss] Exchange with throttling
In-Reply-To: <50165355.6010800@rabbitmq.com>
References: <1ccea2bc-4d26-427f-b174-ff78de0de8c7@googlegroups.com>
	<500E6E96.2010304@rabbitmq.com>
	<CAFdw230XV7YYV5mhpKek3DKpEV2RLQnWabxxBpmG-JoHrO7TZg@mail.gmail.com>
	<50165355.6010800@rabbitmq.com>
Message-ID: <CAFdw233dssYwOpPwK+0=KhN3niwUkv8pT7-0HHY03w2_8xHCUQ@mail.gmail.com>

Definitely I would like to extend the flow control mechanism to support
something similar as I've done with plugin, so someone can set a maximum
messages per second or something similar

2012/7/30 Tim Watson <tim at rabbitmq.com>

>  Just to add to Emile's comments, I there are a couple of things to
> consider here.
>
> Firstly, it's important to point out that letting the Channel process
> mailbox fill up could lead to unexpected and unpredictable performance
> characteristics, and doesn't appear to offer anything that per-connection
> flow control isn't already doing. Also, creating an mnesia transaction for
> each routing operation is likely to produce an altogether *different* kind
> of throttling of Rabbit's performance across a cluster, and probably (in
> fact, almost certainly) not the one you intended.
>
> I would strongly recommend reconsidering this approach. If you're
> interested in extending the flow control mechanism to support alternative
> measures, then perhaps we should have a collective conversation about that
> instead, as Emile is quite right in suggesting that approach makes more
> sense.
>
> Cheers,
> Tim
>
>
> On 07/28/2012 11:52 AM, F?lix L?pez wrote:
>
> Thanks,
>
>  I've finally made a plugin to do that. I think what I wanted to do It
> cannot be possible with mechanism you sent me in the email.
>
>  The plugin is here
> https://github.com/flopezluis/rabbitmq-throttling-exchange, It has a lot
> to improve and certainly I'm not sure of the impact of this exchange in the
> performance of rabbitmq.
>
>
> 2012/7/24 Emile Joubert <emile at rabbitmq.com>
>
>> Hi,
>>
>> On 23/07/12 18:20, F?lix wrote:
>> > Is there anything similar in rabbitmq?
>>
>> Yes, the broker has a connection-based flow control mechanism - see
>> http://www.rabbitmq.com/memory.html#per-connection
>> and a blog post that explains further:
>>
>> http://www.rabbitmq.com/blog/2012/04/17/rabbitmq-performance-measurements-part-1/
>>
>> Bear in mind that blocking an Erlang process will lead to a backlog in
>> its internal mailbox without slowing down the network. Also, the
>> exchange is not a natural control point for bandwidth limiting, because
>> an exchange is not a process. A channel would be a more natural choice.
>> You may be able to adapt the existing flow control mechanism to grant
>> credits based on bandwidth rather than message count.
>>
>>
>>
>> -Emile
>>
>>
>
>
>  --
> http://www.linkedin.com/in/flopezluis
>
> It's easier to ask forgiveness than it is to get permission
>
>
> ".....it doesn't matter how many times you fail. It doesn't matter how
> many times you almost get it right. No one is going to know or care about
> your failures, and either should you. All you have to do is learn from them
> and those around you because...All that matters in business is that you get
> it right once. Then everyone can tell you how lucky you are."
> --Mark Cuban"
>
> "Always be the worst guy in every band you're in." If you're the best guy
> there, you need to be in a different band. And I think that works for
> almost everything that's out there as well." Pat Metheny
>
>
> _______________________________________________
> rabbitmq-discuss mailing listrabbitmq-discuss at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>


-- 
http://www.linkedin.com/in/flopezluis

It's easier to ask forgiveness than it is to get permission


".....it doesn't matter how many times you fail. It doesn't matter how many
times you almost get it right. No one is going to know or care about your
failures, and either should you. All you have to do is learn from them and
those around you because...All that matters in business is that you get it
right once. Then everyone can tell you how lucky you are."
--Mark Cuban"

"Always be the worst guy in every band you're in." If you're the best guy
there, you need to be in a different band. And I think that works for
almost everything that's out there as well." Pat Metheny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120730/624a1cac/attachment.htm>

From matthias at rabbitmq.com  Mon Jul 30 10:52:07 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 30 Jul 2012 10:52:07 +0100
Subject: [rabbitmq-discuss] Erlang Consumer Example
In-Reply-To: <85328f00-373d-4faf-9172-d836c2978fba@googlegroups.com>
References: <ea3f2de4-2e25-4a4c-a30d-b798520f87bc@googlegroups.com>
	<85328f00-373d-4faf-9172-d836c2978fba@googlegroups.com>
Message-ID: <50165947.4070609@rabbitmq.com>

Anton,

On 29/07/12 21:59, anton prokofiev wrote:
> On Sunday, 29 July 2012 21:21:06 UTC+2, anton prokofiev wrote:
>     I tried to create  a consumer in Erlang for RabbitMQ and get into
>     big troubles.
>     Looks like examples that are available in RabbitMQ website did not work.

*Which* example didn't work?

> Looks like I have found a correct solution:
>
> 1. I have implemented simple gen_server, that just print all messages to
> the stdout.
>
> 2. And  to like this:
>    {ok,Connection} = amqp_connection:start(ConnectionParams), % open
> connection with predefined params.
>    {ok,Pid} =  test_srv:start_link(),    % Start our own consumer.
> {ok,Channel}  =
> amqp_connection:open_channel(Connection,none,*{amqp_direct_consumer,[Pid]}*),

The above creates a channel with a default consumer. More typically 
you'd associate consumers with particular subscriptions, as shown in 
http://www.rabbitmq.com/erlang-client-user-guide.html#subscribing.

> Would it be better to create my own implementation of consume behavior,
> or handle them thought the message_info as it is now?
> Any recommendations?

Implementing your own instance of the amqp_gen_consumer behaviour is 
probably the more "correct" approach, but it's a bit more work and if 
the behaviour of the amqp_direct_consumer fits in well with the rest of 
your system design then just use that.

Regards,

Matthias.

From majek04 at gmail.com  Mon Jul 30 10:53:25 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 30 Jul 2012 10:53:25 +0100
Subject: [rabbitmq-discuss] Why do we need rabbitmq-web-stomp and why
 not rabitmq-web-amqp (over websockets)?
In-Reply-To: <CAOGkWBaiDvx34X=irw4H5RhH40Vjyc0Wpynsgiq0pqahMHuY8g@mail.gmail.com>
References: <CAOGkWBaVZv=rSFRc-kdFLJRptCxPZ298DxRFwUFjxvLiQpZL-w@mail.gmail.com>
	<87k3xp31pp.wl%francesco@rabbitmq.com>
	<CAOGkWBaiDvx34X=irw4H5RhH40Vjyc0Wpynsgiq0pqahMHuY8g@mail.gmail.com>
Message-ID: <CABzX+qyNmjW=k7exq8neAK9q2_Lx=7f2-=5h=UdJhpepXVDhfg@mail.gmail.com>

On Fri, Jul 27, 2012 at 6:19 PM, Paddy Carman <paddy.carman at gmail.com> wrote:
> Hi Francesco,
>     Thanks.
>     Why is it a bad idea to expose AMQP to web clients? I see at least one
> company betting on it:  http://kaazing.com/products/amqp-edition

Oh boy, this is a long topic. To mention a few issues:

1) Resource usage is pretty much unlimited for an AMQP client.
(consider creating 1M queues, sending tremendous amount
of durable messages or opening 65K channels)

2) The security model of AMQP is inadequate for the browser
world, where the browser is basically untrusted.

3) The protocol is overcomplicated for the browser needs. Do you
really need an 'unsigned int' type in JavaScript?

I personally think the fact that AMQP is assuming trusted
clients, and on the web the opposite is true, is basically
a show stopper.

STOMP doesn't solve all this issues (security model
is similar, for example), but at least it's way simpler
to reason about. (lack of channels is one example of that)

In my ideal world the RabbitMQ-web-stomp would be
limited to only consuming messages, to avoid problem
mentioned in 1), but this would limit its functionality
too much, so we decided not to pursue this.

Marek

From matthias at rabbitmq.com  Mon Jul 30 11:10:30 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 30 Jul 2012 11:10:30 +0100
Subject: [rabbitmq-discuss] Repeating error from Management Plugin
In-Reply-To: <1343426279.10776.YahooMailClassic@web161505.mail.bf1.yahoo.com>
References: <1343426279.10776.YahooMailClassic@web161505.mail.bf1.yahoo.com>
Message-ID: <50165D96.9020005@rabbitmq.com>

Al,

On 27/07/12 22:57, Al Al wrote:
>> I am on CentOS 6.0 running RabbitMQ version 2.6.1 and Erlang R14B04.

Please upgrade rabbit to the latest version.

> I have been using the management plugin without any issues then suddenly
> I began getting errors when I try to do any action (except for GET):
>
> For example, add Exchange:
> HTTP PUT
> http://myhost:55672/api/exchanges/%2F/testExchange
>
> |500 Internal Server Error. The server||  encountered an error while processing this request|
>
> |{error,
> ||  {exit,
> ||   {{{badmatch,
> ||      {badrpc,
> ||       {'EXIT',
> ||        {undef,
> ||         [{rabbit_direct,start_channel,
> ||           [1,<0.30609.0>,<0.30602.0>,<<"<rabbit at xenon.2.30602.0>">>,
> ||            rabbit_framing_amqp_0_9_1,
> ||            {user,<<"guest">>,
> ||             [administrator],
> ||             rabbit_auth_backend_internal,
> ||             {internal_user,<<"guest">>,
> ||              <<59,41,152,111,63,198,158,154,3,61,54,115,169,32,145,215,66,47,
> ||                97,80>>,
> ||              [administrator]}},
> ||            <<"/">>,
> ||            [{<<"publisher_confirms">>,bool,true},
> ||             {<<"exchange_exchange_bindings">>,bool,true},
> ||             {<<"basic.nack">>,bool,true},
> ||             {<<"consumer_cancel_notify">>,bool,true}],
> ||            <0.30606.0>]},

The most likely cause is a version mismatch between the plug-ins and the 
broker. One more reason to upgrade since these days plug-ins are bundled 
with the broker.

Regards,

Matthias.

From emile at rabbitmq.com  Mon Jul 30 12:00:20 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 30 Jul 2012 12:00:20 +0100
Subject: [rabbitmq-discuss] basicPublish() Hangs on the Upstream Node in
 a Federation
In-Reply-To: <SNT127-W15555B836D172E6F1F0C49D5C20@phx.gbl>
References: <SNT127-W15555B836D172E6F1F0C49D5C20@phx.gbl>
Message-ID: <50166944.1050900@rabbitmq.com>

Hi Chris,

On 26/07/12 19:59, Chris Judkins-Fisher wrote:
> are also automatically created on rabbit2. However, if I try to publish
> to an exchange from rabbit2, the code appears to hang and the message is
> never delivered. This happens whether I'm publishing to the upstream


From nimmavadiraj at gmail.com  Mon Jul 30 12:42:46 2012
From: nimmavadiraj at gmail.com (Vadiraj Hebbar)
Date: Mon, 30 Jul 2012 17:12:46 +0530
Subject: [rabbitmq-discuss] Messages Timeout in Queue
Message-ID: <CALK6wMp1ZUitbjetqdjUOHXwSC_AY=OyNqGSbsheWGvBM8V6ZA@mail.gmail.com>

Hi All
Is it possible to set message time out in Java client API, so that messages
drop out from queue after some interval of time if nobody consumes it
Except time to live(TTL)?.
How to put a time -stamp on the messages in Java client publisher?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120730/d10db623/attachment.htm>

From emile at rabbitmq.com  Mon Jul 30 13:27:50 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 30 Jul 2012 13:27:50 +0100
Subject: [rabbitmq-discuss] Messages Timeout in Queue
In-Reply-To: <CALK6wMp1ZUitbjetqdjUOHXwSC_AY=OyNqGSbsheWGvBM8V6ZA@mail.gmail.com>
References: <CALK6wMp1ZUitbjetqdjUOHXwSC_AY=OyNqGSbsheWGvBM8V6ZA@mail.gmail.com>
Message-ID: <50167DC6.3010306@rabbitmq.com>

Hi,

On 30/07/12 12:42, Vadiraj Hebbar wrote:
> Is it possible to set message time out in Java client API, so that
> messages drop out from queue after some interval of time if nobody
> consumes it  Except time to live(TTL)?.

What do you mean "except ttl"? Per-queue message TTL sounds related to
what you are looking for. See

http://www.rabbitmq.com/extensions.html#queue-ttl

> How to put a time -stamp on the messages in Java client publisher?

The broker will not expire messages based on any individual message
properties. The per-queue message TTL feature demands that all messages
in a queue use the same timeout, therefore it is a queue configuration
option rather than by message.

If you want to implement your own timeout scheme in the consumer then
your publishers will need to provide timestamps. This can be included
somewhere in the payload, headers or the timestamp property. Note that
interpretation of this information will be by convention decided between
consumers and producers - the broker will treat this data as opaque. You
can then instruct consumers to ignore messages that are too old based on
the timestamp provided by the producer.


-Emile





From bme at saseco.dk  Mon Jul 30 13:44:45 2012
From: bme at saseco.dk (Bernhard Mogens Ege)
Date: Mon, 30 Jul 2012 14:44:45 +0200
Subject: [rabbitmq-discuss] Decoding header fields
In-Reply-To: <501143CD.3030505@rabbitmq.com>
References: <00b901cd6b0e$d7100d40$853027c0$@saseco.dk>
	<50112A7E.4000004@rabbitmq.com>
	<00c401cd6b25$e3ec0430$abc40c90$@saseco.dk>
	<5011401A.7070000@rabbitmq.com>
	<00c501cd6b2f$bcceb230$366c1690$@saseco.dk>
	<501143CD.3030505@rabbitmq.com>
Message-ID: <017701cd6e51$1c5dd450$55197cf0$@saseco.dk>

I have now looked at the SendMap example and replicated its function in my
own program, but I still receive header fields as Byte[].

How do I make RabbitMQ decode my header fields to the correct type?

-- 
Bernhard

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: 26. juli 2012 15:19
To: bme at saseco.dk
Cc: 'Discussions about RabbitMQ'
Subject: Re: [rabbitmq-discuss] Decoding header fields

Hi,

On 26/07/12 14:08, Bernhard Mogens Ege wrote:
> Well, it can also be "2" and higher. And in the future I'd like to 
> send int's and more. But I still don't know if I send it correctly or 
> if I do something wrong. :-/ All I know is I only get byte[] on the
receiving side.

Ok, obviously if you need to represent more than two values then use a
larger type.

> Looking at WireFormatting.cs didn't really help me except it seems 
> RabbitMQ does have something that could do what I want. I just don't 
> know how to use it.

See RabbitMQ.Client.Examples.SendMap for an example that can send multiple
types of values in a header.


-Emile





From francesco at rabbitmq.com  Mon Jul 30 14:25:50 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 30 Jul 2012 14:25:50 +0100
Subject: [rabbitmq-discuss] Client on unreliable network best practice?
In-Reply-To: <CAFHLqD+PWevA3BM9CZV-wC3PeYr+khQs8Axru=yiN6wgxrpr-A@mail.gmail.com>
References: <CAFHLqD+wiGZEq4UtjBOKzCN9Y_X3ExveS_z18hG+Eh9Sd4wKKQ@mail.gmail.com>
	<CAFHLqD+PWevA3BM9CZV-wC3PeYr+khQs8Axru=yiN6wgxrpr-A@mail.gmail.com>
Message-ID: <87zk6h4bz5.wl%francesco@rabbitmq.com>

Hi Michael,
> What are the general "best practices" in handling this situation? ?Is there a
> simple property I'm missing that will auto-reconnect in these situations? ?Or
> must I manually check & reconnect when the network disconnection occurs?

There isn't a "automatic reconnect" facility because there would be no way for
us to provide one, given how AMQP works - there are many situations in which the
best behaviour of the "reconnect" mechanism would be unclear.  E.g. when
consuming from exclusive queues, that are deleted when the connection closes.

For this reason you'll have to handle connection problems manually.  The .NET
client provides handlers to catch those errors more easily, see the .NET API:
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.8.4/rabbitmq-dotnet-client-2.8.4-client-htmldoc/html/index.html
.

--
Francesco * Often in error, never in doubt

From ward.mark at gmail.com  Mon Jul 30 19:06:19 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Mon, 30 Jul 2012 11:06:19 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
Message-ID: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>

Hi,

I might have the same problem as this post.  
https://groups.google.com/forum/?fromgroups#!searchin/rabbitmq-discuss/ssl_upgrade_failure/rabbitmq-discuss/-hCUUIzi_9c/Pg6UQ3Lo1kMJ

The setup
Windows 2008r2
rabbitmq server 2.8.4 
Erlang R15B01

.NET 4.0
RabbitMQ client 2.8.4 (installed from NuGet)

When I run my test .NET publisher I get the following exception "None of 
the specified endpoints were reachable".

I have gone through the SSL setup tutorial and I am stumped on why the .NET 
client cannot connect or even fail out with an SSL trust exception.
I have tested the connection to the server over SSL with the following 
tools. openssl s_client and the Java example.  The openssl and the java 
client connect and work.  It is the .NET client that I cannot get working 
and it is the one I need to have working.

I have setup my rabbitmq server to run the ssl over port 443 on my server. 
 This you will find in my log output and I have specified in each of my 
clients.

The following is the C# client that I am trying to connect and publish data 
into rabbitmq.  The client works when I am not attempting a SSL connection.

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using RabbitMQ.Client;

namespace ProducerOne
{
    class Program
    {
        static void Main(string[] args)
        {
            string hostName = "riooverlord-1";
            int port = 443;

            int count;
            if (args != null && args.Length == 1)
                count = int.Parse(args[0]);
            else
                count = 1;

            var connectionFactory = new ConnectionFactory();
            connectionFactory.HostName = hostName;
            connectionFactory.Port = port;
            connectionFactory.Ssl.Enabled = true;
            connectionFactory.Ssl.AcceptablePolicyErrors = 
System.Net.Security.SslPolicyErrors.None;
            
            IConnection connection = connectionFactory.CreateConnection(); 
            
            IModel channel = connection.CreateModel();

            for (int i = 0; i < count; i++)
            {
                byte[] message = 
Encoding.UTF8.GetBytes(string.Format("message {0} - {1}", i.ToString(), 
DateTime.Now.ToString()));
                channel.BasicPublish(string.Empty, "QueueOne", null, 
message);
            }

            channel.Close(); 
            connection.Close();
        }
    }
}


The following is a dump of my rabbitMQ log file.  I have grouped the log 
lines between xml like tags to group the different client attempts. 
 openssl, java, and .NET


=INFO REPORT==== 30-Jul-2012::11:28:01 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 30-Jul-2012::11:28:01 ===
Memory limit set to 409MB of 1023MB total.

=INFO REPORT==== 30-Jul-2012::11:28:03 ===
Disk free limit set to 953MB

=INFO REPORT==== 30-Jul-2012::11:28:04 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 30-Jul-2012::11:28:04 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 30-Jul-2012::11:28:04 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 30-Jul-2012::11:28:04 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 30-Jul-2012::11:28:04 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 30-Jul-2012::11:28:05 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 30-Jul-2012::11:28:06 ===
started SSL Listener on [::]:443

=INFO REPORT==== 30-Jul-2012::11:28:06 ===
started SSL Listener on 0.0.0.0:443

=INFO REPORT==== 30-Jul-2012::11:28:07 ===
Management agent started.

=INFO REPORT==== 30-Jul-2012::11:28:08 ===
Management plugin started. Port: 55672, path: /

=INFO REPORT==== 30-Jul-2012::11:28:08 ===
Statistics database started.

<openssl s_client test>
=INFO REPORT==== 30-Jul-2012::12:08:46 ===
accepting AMQP connection <0.19749.0> (192.168.10.157:53209 -> 
192.168.10.107:443)

=ERROR REPORT==== 30-Jul-2012::12:08:56 ===
closing AMQP connection <0.19749.0> (192.168.10.157:53209 -> 
192.168.10.107:443):
{handshake_timeout,handshake}
</openssl s_client test> 

<java client>
=INFO REPORT==== 30-Jul-2012::12:30:58 ===
accepting AMQP connection <0.30363.0> (192.168.10.157:53426 -> 
192.168.10.107:443)

=INFO REPORT==== 30-Jul-2012::12:30:59 ===
closing AMQP connection <0.30363.0> (192.168.10.157:53426 -> 
192.168.10.107:443)
</java client>

<java client>
=INFO REPORT==== 30-Jul-2012::12:32:17 ===
accepting AMQP connection <0.31021.0> (192.168.10.157:53436 -> 
192.168.10.107:443)

=INFO REPORT==== 30-Jul-2012::12:32:18 ===
closing AMQP connection <0.31021.0> (192.168.10.157:53436 -> 
192.168.10.107:443)
</java client>

<.net>
=INFO REPORT==== 30-Jul-2012::12:33:01 ===
accepting AMQP connection <0.31385.0> ([FE80::9CF9:E6C8:AAA2:E95E]:57009 -> 
[FE80::DC90:8492:EDEA:F29F]:443)

=ERROR REPORT==== 30-Jul-2012::12:33:01 ===
** State machine <0.31386.0> terminating 
** Last message in was {tcp,#Port<0.8637>,
                            
<<21,3,0,0,2,1,41,22,3,0,1,4,16,0,1,0,37,221,141,
                              253,17,32,217,19,107,158,219,100,18,72,74,101,
                              84,128,197,33,49,0,114,104,195,15,49,53,77,36,
                              
199,164,103,80,172,225,140,196,41,237,52,94,192,
                              237,8,8,60,9,59,19,181,87,174,84,219,50,35,22,
                              
84,239,236,14,94,95,81,214,243,162,206,220,188,
                              
94,158,6,115,212,126,162,103,173,87,166,4,48,53,
                              50,150,185,97,176,225,0,73,247,114,66,191,88,
                              143,29,252,2,155,92,204,233,244,199,52,122,55,
                              
130,100,70,122,145,184,131,116,118,196,2,179,50,
                              
61,68,124,192,145,169,147,42,49,126,32,69,25,36,
                              
57,217,75,204,54,156,34,217,117,139,164,114,118,
                              251,62,106,242,208,111,184,117,189,71,224,239,
                              20,92,253,137,74,191,110,114,95,129,206,58,78,
                              
141,136,190,206,53,7,146,104,216,241,137,28,137,
                              
20,133,25,240,230,127,70,254,228,162,130,190,53,
                              250,227,136,156,71,192,142,184,51,124,86,203,
                              108,235,25,32,235,83,144,185,184,208,190,238,
                              
133,1,253,184,101,162,231,40,109,144,35,218,161,
                              
26,4,87,13,117,249,60,35,117,112,213,236,163,18,
                              
128,61,187,20,3,0,0,1,1,22,3,0,0,60,186,95,216,
                              229,210,105,198,105,85,45,183,110,174,206,104,
                              
133,35,254,108,108,57,13,137,138,151,100,178,23,
                              
189,147,85,254,17,117,168,182,255,204,234,195,6,
                              
0,248,93,238,47,172,80,5,153,138,161,91,231,83,
                              251,42,192,80,179>>}
** When State == certify
**      Data  == {state,server,
                     {#Ref<0.0.0.50272>,<0.31385.0>},
                     gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
                     #Port<0.8637>,
                     {ssl_options,[],verify_peer,
                         {#Fun<ssl.3.54384637>,
                          #Fun<rabbit_networking.0.89858908>},
                         false,false,undefined,1,
                         "C:/certstore/server/cert.pem",undefined,
                         "C:/certstore/server/key.pem",undefined,undefined,
                        
 undefined,"C:/certstore/testca/cacert.pem",undefined,
                         undefined,
                         [<<0,57>>,
                          <<0,56>>,
                          <<0,53>>,
                          <<0,22>>,
                          <<0,19>>,
                          <<0,10>>,
                          <<0,51>>,
                          <<0,50>>,
                          <<0,47>>,
                          <<0,5>>,
                          <<0,4>>,
                          <<0,21>>,
                          <<0,9>>],
                         #Fun<ssl.0.54384637>,true,268435456,false,[],
                         undefined,false},
                     {socket_options,binary,0,0,0,false},
                     {connection_states,
                         {connection_state,
                             {security_parameters,
                                 <<0,0>>,
                                 0,0,0,0,0,0,0,0,0,0,undefined,undefined,
                                 undefined,undefined},
                             undefined,undefined,undefined,1,true,undefined,
                             undefined},
                         {connection_state,
                             {security_parameters,
                                 <<0,5>>,
                                 0,1,0,0,128,16,16,2,20,0,undefined,
                                
 <<80,22,197,78,29,58,72,186,12,107,61,151,17,
                                  
 177,209,163,174,99,56,24,71,199,106,49,91,
                                   186,189,199,117,68,234,215>>,
                                 <<80,22,197,77,73,19,16,200,132,120,47,224,
                                  
 160,79,3,106,44,134,25,30,170,200,151,96,89,
                                   3,64,53,236,247,30,107>>,
                                 undefined},
                             undefined,undefined,undefined,undefined,true,
                             undefined,undefined},
                         {connection_state,
                             {security_parameters,
                                 <<0,0>>,
                                 0,0,0,0,0,0,0,0,0,0,undefined,undefined,
                                 undefined,undefined},
                             undefined,undefined,undefined,4,true,undefined,
                             undefined},
                         {connection_state,
                             {security_parameters,
                                 <<0,5>>,
                                 0,1,0,0,128,16,16,2,20,0,undefined,
                                
 <<80,22,197,78,29,58,72,186,12,107,61,151,17,
                                  
 177,209,163,174,99,56,24,71,199,106,49,91,
                                   186,189,199,117,68,234,215>>,
                                 <<80,22,197,77,73,19,16,200,132,120,47,224,
                                  
 160,79,3,106,44,134,25,30,170,200,151,96,89,
                                   3,64,53,236,247,30,107>>,
                                 undefined},
                             undefined,undefined,undefined,undefined,true,
                             undefined,undefined}},
                     [],<<>>,<<>>,
                    
 {{<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,
                        
 182,188,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,
                        
 0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,
                        
 8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,
                         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>,
                       <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,
                         124,157,16,251,186,197,80,51,0,0,0,0,0,0,24,54,90,
                        
 252,231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,
                        
 48,15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,14,
                        
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,
                         0,0,0>>},
                      
{<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,
                        
 182,188,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,
                        
 0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,
                        
 8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,
                         0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>,
                       <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,
                         124,157,16,251,186,197,48,51,0,0,0,0,0,0,24,54,90,
                        
 252,231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,
                        
 48,15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,0,
                         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                         38,0,0,0>>}},
                     [],262221,
                     {session,
                        
 <<32,144,115,251,110,148,117,72,252,193,200,232,234,
                           193,127,229,114,142,20,246,109,56,190,101,113,75,
                           232,227,237,6,105,251>>,
                         undefined,
                        
 <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,
                          
 9,42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,
                          
 6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,48,30,
                          
 23,13,49,50,48,55,51,48,49,50,53,54,52,54,90,23,13,
                          
 49,51,48,55,51,48,49,50,53,54,52,54,90,48,41,49,22,
                          
 48,20,6,3,85,4,3,12,13,114,105,111,111,118,101,114,
                          
 108,111,114,100,45,49,49,15,48,13,6,3,85,4,10,12,6,
                           115,101,114,118,101,114,48,130,1,34,48,13,6,9,42,
                          
 134,72,134,247,13,1,1,1,5,0,3,130,1,15,0,48,130,1,
                          
 10,2,130,1,1,0,163,99,255,119,11,217,190,17,106,102,
                           242,229,252,214,101,34,15,190,61,32,23,69,175,49,
                           141,78,38,16,202,80,88,96,12,88,193,17,57,226,60,
                          
 106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
                          
 104,157,167,92,224,120,142,28,102,218,176,245,195,
                           212,83,251,182,49,60,172,62,12,51,164,181,246,88,
                          
 136,122,208,186,96,220,62,57,137,103,4,26,67,30,132,
                          
 246,62,142,238,140,226,125,194,135,210,234,107,18,
                           128,76,113,52,34,199,134,34,140,80,84,35,205,142,
                          
 207,230,104,37,226,58,32,253,248,156,220,244,151,11,
                           22,43,188,14,177,227,4,188,97,24,83,79,40,16,150,
                          
 139,230,40,224,66,224,140,89,175,200,198,15,30,202,
                          
 248,69,32,159,182,234,202,82,247,91,75,129,24,242,
                          
 250,172,34,107,44,39,177,73,125,204,232,146,190,41,
                           239,6,154,165,197,220,227,183,190,17,114,215,232,
                          
 235,67,159,222,247,110,133,191,142,154,6,99,200,37,
                           59,120,252,161,54,91,223,191,85,104,9,121,14,184,
                          
 105,75,162,181,90,233,48,195,87,151,172,23,119,42,
                          
 211,2,3,130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,
                          
 3,85,29,19,4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,
                          
 48,19,6,3,85,29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,
                          
 48,13,6,9,42,134,72,134,247,13,1,1,5,5,0,3,130,1,1,
                          
 0,222,44,95,61,253,222,29,196,80,45,112,118,52,202,
                          
 249,227,153,3,154,114,189,224,23,172,222,204,213,89,
                          
 202,98,202,252,34,116,104,112,18,98,136,6,133,201,
                          
 165,220,4,130,95,247,113,200,31,36,105,22,27,24,197,
                          
 222,154,33,131,183,215,250,104,240,205,213,224,56,
                          
 201,76,226,250,166,136,68,224,195,215,149,224,255,
                          
 162,11,156,74,159,108,185,153,46,116,32,182,58,192,
                          
 42,77,78,249,153,29,40,105,199,192,192,14,230,169,
                          
 223,199,172,53,122,145,127,57,110,56,67,139,94,115,
                          
 57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,
                          
 134,211,89,211,47,183,79,202,162,128,196,45,44,85,
                          
 122,172,122,58,170,117,116,151,187,96,109,186,207,
                          
 188,10,72,138,17,2,60,52,236,72,68,203,229,144,164,
                          
 154,254,145,75,227,182,44,152,36,81,103,234,99,135,
                          
 223,62,152,94,109,109,202,223,114,90,71,131,48,180,
                          
 74,83,145,93,85,218,225,135,141,226,127,85,243,186,
                          
 10,50,216,220,110,91,48,135,32,83,253,201,62,47,163,
                          
 250,152,166,230,144,155,164,240,234,78,55,198,137,
                           227,164,67,70>>,
                         0,
                         <<0,5>>,
                         undefined,new,63510870781},
                     274512,ssl_session_cache,
                     {3,0},
                     undefined,true,rsa,undefined,
                     {'RSAPrivateKey','two-prime',
                        
 20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
                         65537,
                        
 15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
                        
 147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
                        
 139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
                        
 83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
                        
 118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
                        
 129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
                         asn1_NOVALUE},
                     {'DHParameter',
                        
 179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
                         2,asn1_NOVALUE},
                     undefined,undefined,#Ref<0.0.0.50276>,
                     {<0.31385.0>,#Ref<0.0.0.50285>},
                     0,<<>>,true,
                     {false,first},
                     undefined,
                     {[],[]},
                     false,true}
** Reason for termination = 
** {function_clause,
       [{ssl_connection,handle_alert,
            [{alert,1,41,{"ssl_connection.erl",1678}},
             certify,
             {state,server,
                 {#Ref<0.0.0.50272>,<0.31385.0>},
                 gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
                 #Port<0.8637>,
                 {ssl_options,[],verify_peer,
                    
 {#Fun<ssl.3.54384637>,#Fun<rabbit_networking.0.89858908>},
                     false,false,undefined,1,"C:/certstore/server/cert.pem",
                     undefined,"C:/certstore/server/key.pem",undefined,
                     undefined,undefined,"C:/certstore/testca/cacert.pem",
                     undefined,undefined,
                     [<<0,57>>,
                      <<0,56>>,
                      <<0,53>>,
                      <<0,22>>,
                      <<0,19>>,
                      <<0,10>>,
                      <<0,51>>,
                      <<0,50>>,
                      <<0,47>>,
                      <<0,5>>,
                      <<0,4>>,
                      <<0,21>>,
                      <<0,9>>],
                     #Fun<ssl.0.54384637>,true,268435456,false,[],undefined,
                     false},
                 {socket_options,binary,0,0,0,false},
                 {connection_states,
                     {connection_state,
                         {security_parameters,
                             <<0,0>>,
                             0,0,0,0,0,0,0,0,0,0,undefined,undefined,
                             undefined,undefined},
                         undefined,undefined,undefined,2,true,undefined,
                         undefined},
                     {connection_state,
                         {security_parameters,
                             <<0,5>>,
                             0,1,0,0,128,16,16,2,20,0,undefined,
                            
 <<80,22,197,78,29,58,72,186,12,107,61,151,17,177,
                              
 209,163,174,99,56,24,71,199,106,49,91,186,189,
                               199,117,68,234,215>>,
                            
 <<80,22,197,77,73,19,16,200,132,120,47,224,160,79,
                               3,106,44,134,25,30,170,200,151,96,89,3,64,53,
                               236,247,30,107>>,
                             undefined},
                         undefined,undefined,undefined,undefined,true,
                         undefined,undefined},
                     {connection_state,
                         {security_parameters,
                             <<0,0>>,
                             0,0,0,0,0,0,0,0,0,0,undefined,undefined,
                             undefined,undefined},
                         undefined,undefined,undefined,4,true,undefined,
                         undefined},
                     {connection_state,
                         {security_parameters,
                             <<0,5>>,
                             0,1,0,0,128,16,16,2,20,0,undefined,
                            
 <<80,22,197,78,29,58,72,186,12,107,61,151,17,177,
                              
 209,163,174,99,56,24,71,199,106,49,91,186,189,
                               199,117,68,234,215>>,
                            
 <<80,22,197,77,73,19,16,200,132,120,47,224,160,79,
                               3,106,44,134,25,30,170,200,151,96,89,3,64,53,
                               236,247,30,107>>,
                             undefined},
                         undefined,undefined,undefined,undefined,true,
                         undefined,undefined}},
                 [],<<>>,<<>>,
                
 {{<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,182,
                    
 188,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,
                    
 1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,
                    
 101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                     0,0,0,0,0,0,0,42,0,0,0>>,
                   <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,124,
                     157,16,251,186,197,80,51,0,0,0,0,0,0,24,54,90,252,231,
                    
 192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,
                    
 4,3,19,8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,
                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>},
                  
{<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,182,
                    
 188,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,
                    
 1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,
                    
 101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                     0,0,0,0,0,0,38,0,0,0>>,
                   <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,124,
                     157,16,251,186,197,48,51,0,0,0,0,0,0,24,54,90,252,231,
                     192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,
                    
 85,4,3,19,8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,
                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>}},
                 [{ssl_tls,undefined,22,
                      {3,0},
                      
<<16,0,1,0,37,221,141,253,17,32,217,19,107,158,219,100,
                        
18,72,74,101,84,128,197,33,49,0,114,104,195,15,49,53,
                        
77,36,199,164,103,80,172,225,140,196,41,237,52,94,192,
                        
237,8,8,60,9,59,19,181,87,174,84,219,50,35,22,84,239,
                        
236,14,94,95,81,214,243,162,206,220,188,94,158,6,115,
                        
212,126,162,103,173,87,166,4,48,53,50,150,185,97,176,
                        225,0,73,247,114,66,191,88,143,29,252,2,155,92,204,
                        
233,244,199,52,122,55,130,100,70,122,145,184,131,116,
                        
118,196,2,179,50,61,68,124,192,145,169,147,42,49,126,
                        32,69,25,36,57,217,75,204,54,156,34,217,117,139,164,
                        
114,118,251,62,106,242,208,111,184,117,189,71,224,239,
                        
20,92,253,137,74,191,110,114,95,129,206,58,78,141,136,
                        
190,206,53,7,146,104,216,241,137,28,137,20,133,25,240,
                        
230,127,70,254,228,162,130,190,53,250,227,136,156,71,
                        192,142,184,51,124,86,203,108,235,25,32,235,83,144,
                        
185,184,208,190,238,133,1,253,184,101,162,231,40,109,
                        144,35,218,161,26,4,87,13,117,249,60,35,117,112,213,
                        236,163,18,128,61,187>>},
                  {ssl_tls,undefined,20,{3,0},<<1>>},
                  {ssl_tls,undefined,22,
                      {3,0},
                      
<<186,95,216,229,210,105,198,105,85,45,183,110,174,206,
                        104,133,35,254,108,108,57,13,137,138,151,100,178,23,
                        189,147,85,254,17,117,168,182,255,204,234,195,6,0,
                        248,93,238,47,172,80,5,153,138,161,91,231,83,251,42,
                        192,80,179>>}],
                 262221,
                 {session,
                    
 <<32,144,115,251,110,148,117,72,252,193,200,232,234,193,
                       127,229,114,142,20,246,109,56,190,101,113,75,232,227,
                       237,6,105,251>>,
                     undefined,
                    
 <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,9,
                      
 42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,6,3,85,
                      
 4,3,19,8,77,121,84,101,115,116,67,65,48,30,23,13,49,50,
                      
 48,55,51,48,49,50,53,54,52,54,90,23,13,49,51,48,55,51,
                      
 48,49,50,53,54,52,54,90,48,41,49,22,48,20,6,3,85,4,3,12,
                      
 13,114,105,111,111,118,101,114,108,111,114,100,45,49,49,
                       15,48,13,6,3,85,4,10,12,6,115,101,114,118,101,114,48,
                      
 130,1,34,48,13,6,9,42,134,72,134,247,13,1,1,1,5,0,3,130,
                       1,15,0,48,130,1,10,2,130,1,1,0,163,99,255,119,11,217,
                      
 190,17,106,102,242,229,252,214,101,34,15,190,61,32,23,
                      
 69,175,49,141,78,38,16,202,80,88,96,12,88,193,17,57,226,
                      
 60,106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
                      
 104,157,167,92,224,120,142,28,102,218,176,245,195,212,
                       83,251,182,49,60,172,62,12,51,164,181,246,88,136,122,
                      
 208,186,96,220,62,57,137,103,4,26,67,30,132,246,62,142,
                      
 238,140,226,125,194,135,210,234,107,18,128,76,113,52,34,
                      
 199,134,34,140,80,84,35,205,142,207,230,104,37,226,58,
                       32,253,248,156,220,244,151,11,22,43,188,14,177,227,4,
                      
 188,97,24,83,79,40,16,150,139,230,40,224,66,224,140,89,
                      
 175,200,198,15,30,202,248,69,32,159,182,234,202,82,247,
                       91,75,129,24,242,250,172,34,107,44,39,177,73,125,204,
                      
 232,146,190,41,239,6,154,165,197,220,227,183,190,17,114,
                      
 215,232,235,67,159,222,247,110,133,191,142,154,6,99,200,
                      
 37,59,120,252,161,54,91,223,191,85,104,9,121,14,184,105,
                      
 75,162,181,90,233,48,195,87,151,172,23,119,42,211,2,3,
                      
 130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,3,85,29,19,
                      
 4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,48,19,6,3,85,
                      
 29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,48,13,6,9,42,134,
                       72,134,247,13,1,1,5,5,0,3,130,1,1,0,222,44,95,61,253,
                      
 222,29,196,80,45,112,118,52,202,249,227,153,3,154,114,
                      
 189,224,23,172,222,204,213,89,202,98,202,252,34,116,104,
                      
 112,18,98,136,6,133,201,165,220,4,130,95,247,113,200,31,
                      
 36,105,22,27,24,197,222,154,33,131,183,215,250,104,240,
                       205,213,224,56,201,76,226,250,166,136,68,224,195,215,
                      
 149,224,255,162,11,156,74,159,108,185,153,46,116,32,182,
                       58,192,42,77,78,249,153,29,40,105,199,192,192,14,230,
                      
 169,223,199,172,53,122,145,127,57,110,56,67,139,94,115,
                      
 57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,134,
                      
 211,89,211,47,183,79,202,162,128,196,45,44,85,122,172,
                      
 122,58,170,117,116,151,187,96,109,186,207,188,10,72,138,
                      
 17,2,60,52,236,72,68,203,229,144,164,154,254,145,75,227,
                      
 182,44,152,36,81,103,234,99,135,223,62,152,94,109,109,
                       202,223,114,90,71,131,48,180,74,83,145,93,85,218,225,
                      
 135,141,226,127,85,243,186,10,50,216,220,110,91,48,135,
                      
 32,83,253,201,62,47,163,250,152,166,230,144,155,164,240,
                       234,78,55,198,137,227,164,67,70>>,
                     0,
                     <<0,5>>,
                     undefined,new,63510870781},
                 274512,ssl_session_cache,
                 {3,0},
                 undefined,true,rsa,undefined,
                 {'RSAPrivateKey','two-prime',
                    
 20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
                     65537,
                    
 15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
                    
 147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
                    
 139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
                    
 83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
                    
 118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
                    
 129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
                     asn1_NOVALUE},
                 {'DHParameter',
                    
 179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
                     2,asn1_NOVALUE},
                 undefined,undefined,#Ref<0.0.0.50276>,
                 {<0.31385.0>,#Ref<0.0.0.50285>},
                 0,<<>>,true,
                 {false,first},
                 undefined,
                 {[],[]},
                 false,true}],
            [{file,"ssl_connection.erl"},{line,2179}]},
        {ssl_connection,handle_alerts,2,
            [{file,"ssl_connection.erl"},{line,2177}]},
        {gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,494}]},
        {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}

=ERROR REPORT==== 30-Jul-2012::12:33:01 ===
error on AMQP connection <0.31385.0>: {ssl_upgrade_failure,
                                       {{function_clause,
                                         [{ssl_connection,handle_alert,
                                           [{alert,1,41,
                                             {"ssl_connection.erl",1678}},
                                            certify,
                                            {state,server,
                                            
 {#Ref<0.0.0.50272>,<0.31385.0>},
                                            
 gen_tcp,tcp,tcp_closed,tcp_error,
                                             "localhost",443,#Port<0.8637>,
                                             {ssl_options,[],verify_peer,
                                              {#Fun<ssl.3.54384637>,
                                              
 #Fun<rabbit_networking.0.89858908>},
                                              false,false,undefined,1,
                                              
"C:/certstore/server/cert.pem",
                                              undefined,
                                              "C:/certstore/server/key.pem",
                                              undefined,undefined,undefined,
                                              
"C:/certstore/testca/cacert.pem",
                                              undefined,undefined,
                                              [<<0,57>>,
                                               <<0,56>>,
                                               <<0,53>>,
                                               <<0,22>>,
                                               <<0,19>>,
                                               <<0,10>>,
                                               <<0,51>>,
                                               <<0,50>>,
                                               <<0,47>>,
                                               <<0,5>>,
                                               <<0,4>>,
                                               <<0,21>>,
                                               <<0,9>>],
                                              #Fun<ssl.0.54384637>,true,
                                              268435456,false,[],undefined,
                                              false},
                                             {socket_options,binary,0,0,0,
                                              false},
                                             {connection_states,
                                              {connection_state,
                                               {security_parameters,
                                                <<0,0>>,
                                                
0,0,0,0,0,0,0,0,0,0,undefined,
                                                
undefined,undefined,undefined},
                                              
 undefined,undefined,undefined,
                                               2,true,undefined,undefined},
                                              {connection_state,
                                               {security_parameters,
                                                <<0,5>>,
                                                0,1,0,0,128,16,16,2,20,0,
                                                undefined,
                                                
<<80,22,197,78,29,58,72,186,12,
                                                  107,61,151,17,177,209,163,
                                                  
174,99,56,24,71,199,106,49,
                                                  
91,186,189,199,117,68,234,215>>,
                                                <<80,22,197,77,73,19,16,200,
                                                  
132,120,47,224,160,79,3,106,
                                                  
44,134,25,30,170,200,151,96,
                                                  
89,3,64,53,236,247,30,107>>,
                                                undefined},
                                              
 undefined,undefined,undefined,
                                               undefined,true,undefined,
                                               undefined},
                                              {connection_state,
                                               {security_parameters,
                                                <<0,0>>,
                                                
0,0,0,0,0,0,0,0,0,0,undefined,
                                                
undefined,undefined,undefined},
                                              
 undefined,undefined,undefined,
                                               4,true,undefined,undefined},
                                              {connection_state,
                                               {security_parameters,
                                                <<0,5>>,
                                                0,1,0,0,128,16,16,2,20,0,
                                                undefined,
                                                
<<80,22,197,78,29,58,72,186,12,
                                                  107,61,151,17,177,209,163,
                                                  
174,99,56,24,71,199,106,49,
                                                  
91,186,189,199,117,68,234,215>>,
                                                <<80,22,197,77,73,19,16,200,
                                                  
132,120,47,224,160,79,3,106,
                                                  
44,134,25,30,170,200,151,96,
                                                  
89,3,64,53,236,247,30,107>>,
                                                undefined},
                                              
 undefined,undefined,undefined,
                                               undefined,true,undefined,
                                               undefined}},
                                             [],<<>>,<<>>,
                                            
 {{<<107,195,247,68,168,208,252,17,
                                                
 160,186,113,157,135,198,182,
                                                
 188,80,51,0,0,0,0,0,0,24,54,
                                                
 90,252,231,192,148,13,0,0,27,
                                                
 1,1,0,23,0,21,48,19,49,17,48,
                                                
 15,6,3,85,4,3,19,8,77,121,84,
                                                
 101,115,116,67,65,14,0,0,0,0,
                                                
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                                                 0,0,0,0,0,0,42,0,0,0>>,
                                               <<164,73,160,132,230,249,118,
                                                 68,17,25,226,99,197,97,124,
                                                
 157,16,251,186,197,80,51,0,0,
                                                
 0,0,0,0,24,54,90,252,231,192,
                                                
 148,13,0,0,27,1,1,0,23,0,21,
                                                
 48,19,49,17,48,15,6,3,85,4,3,
                                                 19,8,77,121,84,101,115,116,
                                                
 67,65,14,0,0,0,0,0,0,0,0,0,0,
                                                
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                                                 0,42,0,0,0>>},
                                              
{<<107,195,247,68,168,208,252,17,
                                                
 160,186,113,157,135,198,182,
                                                
 188,48,51,0,0,0,0,0,0,24,54,
                                                
 90,252,231,192,148,13,0,0,27,
                                                
 1,1,0,23,0,21,48,19,49,17,48,
                                                
 15,6,3,85,4,3,19,8,77,121,84,
                                                
 101,115,116,67,65,0,0,0,0,0,0,
                                                
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                                                 0,0,0,0,0,38,0,0,0>>,
                                               <<164,73,160,132,230,249,118,
                                                 68,17,25,226,99,197,97,124,
                                                 157,16,251,186,197,48,51,0,
                                                 0,0,0,0,0,24,54,90,252,231,
                                                 192,148,13,0,0,27,1,1,0,23,
                                                 0,21,48,19,49,17,48,15,6,3,
                                                 85,4,3,19,8,77,121,84,101,
                                                
 115,116,67,65,0,0,0,0,0,0,0,
                                                
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                                                 0,0,0,0,0,38,0,0,0>>}},
                                             [{ssl_tls,undefined,22,
                                               {3,0},
                                               <<16,0,1,0,37,221,141,253,17,
                                                
 32,217,19,107,158,219,100,18,
                                                
 72,74,101,84,128,197,33,49,0,
                                                 114,104,195,15,49,53,77,36,
                                                 199,164,103,80,172,225,140,
                                                
 196,41,237,52,94,192,237,8,8,
                                                
 60,9,59,19,181,87,174,84,219,
                                                
 50,35,22,84,239,236,14,94,95,
                                                 81,214,243,162,206,220,188,
                                                
 94,158,6,115,212,126,162,103,
                                                 173,87,166,4,48,53,50,150,
                                                
 185,97,176,225,0,73,247,114,
                                                 66,191,88,143,29,252,2,155,
                                                
 92,204,233,244,199,52,122,55,
                                                 130,100,70,122,145,184,131,
                                                 116,118,196,2,179,50,61,68,
                                                 124,192,145,169,147,42,49,
                                                 126,32,69,25,36,57,217,75,
                                                 204,54,156,34,217,117,139,
                                                 164,114,118,251,62,106,242,
                                                 208,111,184,117,189,71,224,
                                                
 239,20,92,253,137,74,191,110,
                                                
 114,95,129,206,58,78,141,136,
                                                
 190,206,53,7,146,104,216,241,
                                                
 137,28,137,20,133,25,240,230,
                                                 127,70,254,228,162,130,190,
                                                 53,250,227,136,156,71,192,
                                                 142,184,51,124,86,203,108,
                                                
 235,25,32,235,83,144,185,184,
                                                 208,190,238,133,1,253,184,
                                                 101,162,231,40,109,144,35,
                                                 218,161,26,4,87,13,117,249,
                                                
 60,35,117,112,213,236,163,18,
                                                 128,61,187>>},
                                              {ssl_tls,undefined,20,
                                               {3,0},
                                               <<1>>},
                                              {ssl_tls,undefined,22,
                                               {3,0},
                                               <<186,95,216,229,210,105,198,
                                                 105,85,45,183,110,174,206,
                                                 104,133,35,254,108,108,57,
                                                 13,137,138,151,100,178,23,
                                                 189,147,85,254,17,117,168,
                                                
 182,255,204,234,195,6,0,248,
                                                 93,238,47,172,80,5,153,138,
                                                
 161,91,231,83,251,42,192,80,
                                                 179>>}],
                                             262221,
                                             {session,
                                              
<<32,144,115,251,110,148,117,72,
                                                252,193,200,232,234,193,127,
                                                
229,114,142,20,246,109,56,190,
                                                
101,113,75,232,227,237,6,105,
                                                251>>,
                                              undefined,
                                              
<<48,130,2,230,48,130,1,206,160,
                                                
3,2,1,2,2,1,1,48,13,6,9,42,134,
                                                
72,134,247,13,1,1,5,5,0,48,19,
                                                
49,17,48,15,6,3,85,4,3,19,8,77,
                                                
121,84,101,115,116,67,65,48,30,
                                                
23,13,49,50,48,55,51,48,49,50,
                                                
53,54,52,54,90,23,13,49,51,48,
                                                
55,51,48,49,50,53,54,52,54,90,
                                                
48,41,49,22,48,20,6,3,85,4,3,
                                                
12,13,114,105,111,111,118,101,
                                                
114,108,111,114,100,45,49,49,
                                                
15,48,13,6,3,85,4,10,12,6,115,
                                                
101,114,118,101,114,48,130,1,
                                                
34,48,13,6,9,42,134,72,134,247,
                                                
13,1,1,1,5,0,3,130,1,15,0,48,
                                                130,1,10,2,130,1,1,0,163,99,
                                                
255,119,11,217,190,17,106,102,
                                                
242,229,252,214,101,34,15,190,
                                                
61,32,23,69,175,49,141,78,38,
                                                
16,202,80,88,96,12,88,193,17,
                                                57,226,60,106,35,93,184,216,
                                                
167,217,0,102,117,69,97,209,60,
                                                
27,104,157,167,92,224,120,142,
                                                
28,102,218,176,245,195,212,83,
                                                
251,182,49,60,172,62,12,51,164,
                                                
181,246,88,136,122,208,186,96,
                                                
220,62,57,137,103,4,26,67,30,
                                                
132,246,62,142,238,140,226,125,
                                                
194,135,210,234,107,18,128,76,
                                                
113,52,34,199,134,34,140,80,84,
                                                
35,205,142,207,230,104,37,226,
                                                
58,32,253,248,156,220,244,151,
                                                
11,22,43,188,14,177,227,4,188,
                                                
97,24,83,79,40,16,150,139,230,
                                                
40,224,66,224,140,89,175,200,
                                                198,15,30,202,248,69,32,159,
                                                
182,234,202,82,247,91,75,129,
                                                24,242,250,172,34,107,44,39,
                                                
177,73,125,204,232,146,190,41,
                                                
239,6,154,165,197,220,227,183,
                                                
190,17,114,215,232,235,67,159,
                                                
222,247,110,133,191,142,154,6,
                                                
99,200,37,59,120,252,161,54,91,
                                                223,191,85,104,9,121,14,184,
                                                
105,75,162,181,90,233,48,195,
                                                
87,151,172,23,119,42,211,2,3,
                                                
130,228,61,83,2,3,1,0,1,163,47,
                                                
48,45,48,9,6,3,85,29,19,4,2,48,
                                                
0,48,11,6,3,85,29,15,4,4,3,2,5,
                                                
32,48,19,6,3,85,29,37,4,12,48,
                                                
10,6,8,43,6,1,5,5,7,3,1,48,13,
                                                
6,9,42,134,72,134,247,13,1,1,5,
                                                
5,0,3,130,1,1,0,222,44,95,61,
                                                
253,222,29,196,80,45,112,118,
                                                
52,202,249,227,153,3,154,114,
                                                
189,224,23,172,222,204,213,89,
                                                
202,98,202,252,34,116,104,112,
                                                
18,98,136,6,133,201,165,220,4,
                                                
130,95,247,113,200,31,36,105,
                                                22,27,24,197,222,154,33,131,
                                                183,215,250,104,240,205,213,
                                                
224,56,201,76,226,250,166,136,
                                                
68,224,195,215,149,224,255,162,
                                                
11,156,74,159,108,185,153,46,
                                                
116,32,182,58,192,42,77,78,249,
                                                
153,29,40,105,199,192,192,14,
                                                
230,169,223,199,172,53,122,145,
                                                
127,57,110,56,67,139,94,115,57,
                                                
55,116,11,212,76,212,44,180,72,
                                                
244,150,141,6,207,134,211,89,
                                                
211,47,183,79,202,162,128,196,
                                                45,44,85,122,172,122,58,170,
                                                
117,116,151,187,96,109,186,207,
                                                
188,10,72,138,17,2,60,52,236,
                                                
72,68,203,229,144,164,154,254,
                                                145,75,227,182,44,152,36,81,
                                                
103,234,99,135,223,62,152,94,
                                                
109,109,202,223,114,90,71,131,
                                                
48,180,74,83,145,93,85,218,225,
                                                
135,141,226,127,85,243,186,10,
                                                
50,216,220,110,91,48,135,32,83,
                                                
253,201,62,47,163,250,152,166,
                                                
230,144,155,164,240,234,78,55,
                                                198,137,227,164,67,70>>,
                                              0,
                                              <<0,5>>,
                                              undefined,new,63510870781},
                                             274512,ssl_session_cache,
                                             {3,0},
                                             undefined,true,rsa,undefined,
                                             {'RSAPrivateKey','two-prime',
                                              
20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
                                              65537,
                                              
15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
                                              
147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
                                              
139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
                                              
83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
                                              
118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
                                              
129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
                                              asn1_NOVALUE},
                                             {'DHParameter',
                                              
179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
                                              2,asn1_NOVALUE},
                                             undefined,undefined,
                                             #Ref<0.0.0.50276>,
                                            
 {<0.31385.0>,#Ref<0.0.0.50285>},
                                             0,<<>>,true,
                                             {false,first},
                                             undefined,
                                             {[],[]},
                                             false,true}],
                                           [{file,"ssl_connection.erl"},
                                            {line,2179}]},
                                          {ssl_connection,handle_alerts,2,
                                           [{file,"ssl_connection.erl"},
                                            {line,2177}]},
                                          {gen_fsm,handle_msg,7,
                                          
 [{file,"gen_fsm.erl"},{line,494}]},
                                          {proc_lib,init_p_do_apply,3,
                                           [{file,"proc_lib.erl"},
                                            {line,227}]}]},
                                        {gen_fsm,sync_send_all_state_event,
                                         [<0.31386.0>,start,5000]}}}
</.net>

<java>
=INFO REPORT==== 30-Jul-2012::12:36:39 ===
accepting AMQP connection <0.342.1> (192.168.10.157:53463 -> 
192.168.10.107:443)

=INFO REPORT==== 30-Jul-2012::12:36:40 ===
closing AMQP connection <0.342.1> (192.168.10.157:53463 -> 
192.168.10.107:443)
</java>

<openssl>
=INFO REPORT==== 30-Jul-2012::12:36:46 ===
accepting AMQP connection <0.419.1> (192.168.10.157:53464 -> 
192.168.10.107:443)

=ERROR REPORT==== 30-Jul-2012::12:36:51 ===
closing AMQP connection <0.419.1> (192.168.10.157:53464 -> 
192.168.10.107:443):
{bad_version,10,10,10,10}
</openssl>

<.net>
=INFO REPORT==== 30-Jul-2012::12:43:58 ===
accepting AMQP connection <0.3888.1> ([FE80::9CF9:E6C8:AAA2:E95E]:57040 -> 
[FE80::DC90:8492:EDEA:F29F]:443)

=ERROR REPORT==== 30-Jul-2012::12:43:58 ===
** State machine <0.3889.1> terminating 
** Last message in was {tcp,#Port<0.8968>,
                            <<21,3,0,0,2,1,41,22,3,0,1,4,16,0,1,0,13,149,79,
                              68,242,219,55,33,132,16,78,131,203,216,134,82,
                              
174,2,104,224,25,10,69,244,189,175,235,223,106,
                              
45,186,155,55,99,237,33,164,234,55,53,210,3,243,
                              
167,173,216,218,142,61,49,55,108,94,229,157,57,
                              65,152,150,104,244,4,248,47,159,188,27,115,22,
                              
176,202,177,230,100,242,152,230,216,64,87,7,88,
                              
206,101,137,11,61,214,170,45,226,106,24,133,184,
                              53,215,16,85,173,26,76,22,71,236,163,220,163,
                              
198,105,253,57,252,199,21,111,171,20,59,238,66,
                              
255,32,129,232,2,110,140,48,215,124,215,101,193,
                              77,70,48,12,192,100,149,167,33,214,90,232,214,
                              
188,72,182,193,115,137,185,198,135,213,168,214,
                              
68,180,170,204,32,157,92,121,79,219,215,147,140,
                              21,215,151,41,254,22,64,224,33,217,40,66,213,
                              175,157,29,114,38,133,252,112,102,104,185,76,
                              
231,12,236,87,176,162,138,29,15,168,220,218,231,
                              
131,230,243,106,157,193,42,63,8,9,49,203,208,76,
                              
250,159,76,187,179,2,183,83,199,70,237,161,192,
                              221,12,4,228,227,107,196,161,231,171,118,233,
                              
240,24,122,209,118,132,27,20,3,0,0,1,1,22,3,0,0,
                              
60,202,190,24,80,89,105,254,68,94,146,20,33,11,
                              8,52,82,120,141,183,75,210,23,34,29,85,28,45,
                              
236,35,40,199,167,111,94,144,170,240,48,75,136,
                              
116,63,197,216,54,26,61,171,134,80,82,163,26,75,
                              50,152,15,181,218,235>>}
** When State == certify
**      Data  == {state,server,
                     {#Ref<0.0.0.58837>,<0.3888.1>},
                     gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
                     #Port<0.8968>,
                     {ssl_options,[],verify_peer,
                         {#Fun<ssl.3.54384637>,
                          #Fun<rabbit_networking.0.89858908>},
                         false,false,undefined,1,
                         "C:/certstore/server/cert.pem",undefined,
                         "C:/certstore/server/key.pem",undefined,undefined,
                        
 undefined,"C:/certstore/testca/cacert.pem",undefined,
                         undefined,
                         [<<0,57>>,
                          <<0,56>>,
                          <<0,53>>,
                          <<0,22>>,
                          <<0,19>>,
                          <<0,10>>,
                          <<0,51>>,
                          <<0,50>>,
                          <<0,47>>,
                          <<0,5>>,
                          <<0,4>>,
                          <<0,21>>,
                          <<0,9>>],
                         #Fun<ssl.0.54384637>,true,268435456,false,[],
                         undefined,false},
                     {socket_options,binary,0,0,0,false},
                     {connection_states,
                         {connection_state,
                             {security_parameters,
                                 <<0,0>>,
                                 0,0,0,0,0,0,0,0,0,0,undefined,undefined,
                                 undefined,undefined},
                             undefined,undefined,undefined,1,true,undefined,
                             undefined},
                         {connection_state,
                             {security_parameters,
                                 <<0,5>>,
                                 0,1,0,0,128,16,16,2,20,0,undefined,
                                
 <<80,22,199,223,40,186,235,18,229,68,117,41,
                                  
 146,137,237,216,114,239,54,7,165,33,37,94,
                                   57,110,228,3,62,87,25,210>>,
                                 <<80,22,199,222,169,174,5,18,190,32,21,236,
                                  
 199,246,168,19,117,78,229,208,48,132,253,20,
                                   180,170,31,49,53,31,120,40>>,
                                 undefined},
                             undefined,undefined,undefined,undefined,true,
                             undefined,undefined},
                         {connection_state,
                             {security_parameters,
                                 <<0,0>>,
                                 0,0,0,0,0,0,0,0,0,0,undefined,undefined,
                                 undefined,undefined},
                             undefined,undefined,undefined,4,true,undefined,
                             undefined},
                         {connection_state,
                             {security_parameters,
                                 <<0,5>>,
                                 0,1,0,0,128,16,16,2,20,0,undefined,
                                
 <<80,22,199,223,40,186,235,18,229,68,117,41,
                                  
 146,137,237,216,114,239,54,7,165,33,37,94,
                                   57,110,228,3,62,87,25,210>>,
                                 <<80,22,199,222,169,174,5,18,190,32,21,236,
                                  
 199,246,168,19,117,78,229,208,48,132,253,20,
                                   180,170,31,49,53,31,120,40>>,
                                 undefined},
                             undefined,undefined,undefined,undefined,true,
                             undefined,undefined}},
                     [],<<>>,<<>>,
                    
 {{<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,
                        
 209,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,
                        
 27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,
                        
 121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,
                         0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>,
                      
 <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,128,
                        
 137,71,51,20,230,80,51,0,0,0,0,0,0,24,54,90,252,231,
                        
 192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,
                        
 3,85,4,3,19,8,77,121,84,101,115,116,67,65,14,0,0,0,0,
                        
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>},
                      
{<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,
                        
 209,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,
                        
 27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,
                        
 121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                         0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>,
                       <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,
                        
 128,137,71,51,20,230,48,51,0,0,0,0,0,0,24,54,90,252,
                         231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,
                         15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,0,0,
                         0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,
                         0,0,0>>}},
                     [],262221,
                     {session,
                        
 <<120,172,49,23,82,227,196,133,69,243,102,137,72,209,
                          
 109,38,212,150,216,237,102,171,222,27,8,24,94,130,
                           47,132,52,140>>,
                         undefined,
                        
 <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,
                          
 9,42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,
                          
 6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,48,30,
                          
 23,13,49,50,48,55,51,48,49,50,53,54,52,54,90,23,13,
                          
 49,51,48,55,51,48,49,50,53,54,52,54,90,48,41,49,22,
                          
 48,20,6,3,85,4,3,12,13,114,105,111,111,118,101,114,
                          
 108,111,114,100,45,49,49,15,48,13,6,3,85,4,10,12,6,
                           115,101,114,118,101,114,48,130,1,34,48,13,6,9,42,
                          
 134,72,134,247,13,1,1,1,5,0,3,130,1,15,0,48,130,1,
                          
 10,2,130,1,1,0,163,99,255,119,11,217,190,17,106,102,
                           242,229,252,214,101,34,15,190,61,32,23,69,175,49,
                           141,78,38,16,202,80,88,96,12,88,193,17,57,226,60,
                          
 106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
                          
 104,157,167,92,224,120,142,28,102,218,176,245,195,
                           212,83,251,182,49,60,172,62,12,51,164,181,246,88,
                          
 136,122,208,186,96,220,62,57,137,103,4,26,67,30,132,
                          
 246,62,142,238,140,226,125,194,135,210,234,107,18,
                           128,76,113,52,34,199,134,34,140,80,84,35,205,142,
                          
 207,230,104,37,226,58,32,253,248,156,220,244,151,11,
                           22,43,188,14,177,227,4,188,97,24,83,79,40,16,150,
                          
 139,230,40,224,66,224,140,89,175,200,198,15,30,202,
                          
 248,69,32,159,182,234,202,82,247,91,75,129,24,242,
                          
 250,172,34,107,44,39,177,73,125,204,232,146,190,41,
                           239,6,154,165,197,220,227,183,190,17,114,215,232,
                          
 235,67,159,222,247,110,133,191,142,154,6,99,200,37,
                           59,120,252,161,54,91,223,191,85,104,9,121,14,184,
                          
 105,75,162,181,90,233,48,195,87,151,172,23,119,42,
                          
 211,2,3,130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,
                          
 3,85,29,19,4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,
                          
 48,19,6,3,85,29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,
                          
 48,13,6,9,42,134,72,134,247,13,1,1,5,5,0,3,130,1,1,
                          
 0,222,44,95,61,253,222,29,196,80,45,112,118,52,202,
                          
 249,227,153,3,154,114,189,224,23,172,222,204,213,89,
                          
 202,98,202,252,34,116,104,112,18,98,136,6,133,201,
                          
 165,220,4,130,95,247,113,200,31,36,105,22,27,24,197,
                          
 222,154,33,131,183,215,250,104,240,205,213,224,56,
                          
 201,76,226,250,166,136,68,224,195,215,149,224,255,
                          
 162,11,156,74,159,108,185,153,46,116,32,182,58,192,
                          
 42,77,78,249,153,29,40,105,199,192,192,14,230,169,
                          
 223,199,172,53,122,145,127,57,110,56,67,139,94,115,
                          
 57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,
                          
 134,211,89,211,47,183,79,202,162,128,196,45,44,85,
                          
 122,172,122,58,170,117,116,151,187,96,109,186,207,
                          
 188,10,72,138,17,2,60,52,236,72,68,203,229,144,164,
                          
 154,254,145,75,227,182,44,152,36,81,103,234,99,135,
                          
 223,62,152,94,109,109,202,223,114,90,71,131,48,180,
                          
 74,83,145,93,85,218,225,135,141,226,127,85,243,186,
                          
 10,50,216,220,110,91,48,135,32,83,253,201,62,47,163,
                          
 250,152,166,230,144,155,164,240,234,78,55,198,137,
                           227,164,67,70>>,
                         0,
                         <<0,5>>,
                         undefined,new,63510871438},
                     274512,ssl_session_cache,
                     {3,0},
                     undefined,true,rsa,undefined,
                     {'RSAPrivateKey','two-prime',
                        
 20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
                         65537,
                        
 15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
                        
 147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
                        
 139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
                        
 83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
                        
 118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
                        
 129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
                         asn1_NOVALUE},
                     {'DHParameter',
                        
 179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
                         2,asn1_NOVALUE},
                     undefined,undefined,#Ref<0.0.0.58841>,
                     {<0.3888.1>,#Ref<0.0.0.58850>},
                     0,<<>>,true,
                     {false,first},
                     undefined,
                     {[],[]},
                     false,true}
** Reason for termination = 
** {function_clause,
       [{ssl_connection,handle_alert,
            [{alert,1,41,{"ssl_connection.erl",1678}},
             certify,
             {state,server,
                 {#Ref<0.0.0.58837>,<0.3888.1>},
                 gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
                 #Port<0.8968>,
                 {ssl_options,[],verify_peer,
                    
 {#Fun<ssl.3.54384637>,#Fun<rabbit_networking.0.89858908>},
                     false,false,undefined,1,"C:/certstore/server/cert.pem",
                     undefined,"C:/certstore/server/key.pem",undefined,
                     undefined,undefined,"C:/certstore/testca/cacert.pem",
                     undefined,undefined,
                     [<<0,57>>,
                      <<0,56>>,
                      <<0,53>>,
                      <<0,22>>,
                      <<0,19>>,
                      <<0,10>>,
                      <<0,51>>,
                      <<0,50>>,
                      <<0,47>>,
                      <<0,5>>,
                      <<0,4>>,
                      <<0,21>>,
                      <<0,9>>],
                     #Fun<ssl.0.54384637>,true,268435456,false,[],undefined,
                     false},
                 {socket_options,binary,0,0,0,false},
                 {connection_states,
                     {connection_state,
                         {security_parameters,
                             <<0,0>>,
                             0,0,0,0,0,0,0,0,0,0,undefined,undefined,
                             undefined,undefined},
                         undefined,undefined,undefined,2,true,undefined,
                         undefined},
                     {connection_state,
                         {security_parameters,
                             <<0,5>>,
                             0,1,0,0,128,16,16,2,20,0,undefined,
                            
 <<80,22,199,223,40,186,235,18,229,68,117,41,146,
                               137,237,216,114,239,54,7,165,33,37,94,57,110,
                               228,3,62,87,25,210>>,
                             <<80,22,199,222,169,174,5,18,190,32,21,236,199,
                              
 246,168,19,117,78,229,208,48,132,253,20,180,170,
                               31,49,53,31,120,40>>,
                             undefined},
                         undefined,undefined,undefined,undefined,true,
                         undefined,undefined},
                     {connection_state,
                         {security_parameters,
                             <<0,0>>,
                             0,0,0,0,0,0,0,0,0,0,undefined,undefined,
                             undefined,undefined},
                         undefined,undefined,undefined,4,true,undefined,
                         undefined},
                     {connection_state,
                         {security_parameters,
                             <<0,5>>,
                             0,1,0,0,128,16,16,2,20,0,undefined,
                            
 <<80,22,199,223,40,186,235,18,229,68,117,41,146,
                               137,237,216,114,239,54,7,165,33,37,94,57,110,
                               228,3,62,87,25,210>>,
                             <<80,22,199,222,169,174,5,18,190,32,21,236,199,
                              
 246,168,19,117,78,229,208,48,132,253,20,180,170,
                               31,49,53,31,120,40>>,
                             undefined},
                         undefined,undefined,undefined,undefined,true,
                         undefined,undefined}},
                 [],<<>>,<<>>,
                
 {{<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,209,
                    
 80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,1,1,
                    
 0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,101,
                    
 115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                     0,0,0,0,0,42,0,0,0>>,
                  
 <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,128,137,
                    
 71,51,20,230,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,
                    
 13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,
                    
 8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,
                     0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>},
                  
{<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,209,
                    
 48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,1,1,
                    
 0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,101,
                    
 115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                     0,0,0,0,38,0,0,0>>,
                   <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,128,
                    
 137,71,51,20,230,48,51,0,0,0,0,0,0,24,54,90,252,231,192,
                     148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,
                     3,19,8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,
                     0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>}},
                 [{ssl_tls,undefined,22,
                      {3,0},
                      
<<16,0,1,0,13,149,79,68,242,219,55,33,132,16,78,131,203,
                        
216,134,82,174,2,104,224,25,10,69,244,189,175,235,223,
                        106,45,186,155,55,99,237,33,164,234,55,53,210,3,243,
                        
167,173,216,218,142,61,49,55,108,94,229,157,57,65,152,
                        150,104,244,4,248,47,159,188,27,115,22,176,202,177,
                        
230,100,242,152,230,216,64,87,7,88,206,101,137,11,61,
                        
214,170,45,226,106,24,133,184,53,215,16,85,173,26,76,
                        22,71,236,163,220,163,198,105,253,57,252,199,21,111,
                        
171,20,59,238,66,255,32,129,232,2,110,140,48,215,124,
                        
215,101,193,77,70,48,12,192,100,149,167,33,214,90,232,
                        
214,188,72,182,193,115,137,185,198,135,213,168,214,68,
                        180,170,204,32,157,92,121,79,219,215,147,140,21,215,
                        
151,41,254,22,64,224,33,217,40,66,213,175,157,29,114,
                        38,133,252,112,102,104,185,76,231,12,236,87,176,162,
                        
138,29,15,168,220,218,231,131,230,243,106,157,193,42,
                        
63,8,9,49,203,208,76,250,159,76,187,179,2,183,83,199,
                        70,237,161,192,221,12,4,228,227,107,196,161,231,171,
                        118,233,240,24,122,209,118,132,27>>},
                  {ssl_tls,undefined,20,{3,0},<<1>>},
                  {ssl_tls,undefined,22,
                      {3,0},
                      <<202,190,24,80,89,105,254,68,94,146,20,33,11,8,52,82,
                        120,141,183,75,210,23,34,29,85,28,45,236,35,40,199,
                        167,111,94,144,170,240,48,75,136,116,63,197,216,54,
                        
26,61,171,134,80,82,163,26,75,50,152,15,181,218,235>>}],
                 262221,
                 {session,
                    
 <<120,172,49,23,82,227,196,133,69,243,102,137,72,209,109,
                      
 38,212,150,216,237,102,171,222,27,8,24,94,130,47,132,52,
                       140>>,
                     undefined,
                    
 <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,9,
                      
 42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,6,3,85,
                      
 4,3,19,8,77,121,84,101,115,116,67,65,48,30,23,13,49,50,
                      
 48,55,51,48,49,50,53,54,52,54,90,23,13,49,51,48,55,51,
                      
 48,49,50,53,54,52,54,90,48,41,49,22,48,20,6,3,85,4,3,12,
                      
 13,114,105,111,111,118,101,114,108,111,114,100,45,49,49,
                       15,48,13,6,3,85,4,10,12,6,115,101,114,118,101,114,48,
                      
 130,1,34,48,13,6,9,42,134,72,134,247,13,1,1,1,5,0,3,130,
                       1,15,0,48,130,1,10,2,130,1,1,0,163,99,255,119,11,217,
                      
 190,17,106,102,242,229,252,214,101,34,15,190,61,32,23,
                      
 69,175,49,141,78,38,16,202,80,88,96,12,88,193,17,57,226,
                      
 60,106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
                      
 104,157,167,92,224,120,142,28,102,218,176,245,195,212,
                       83,251,182,49,60,172,62,12,51,164,181,246,88,136,122,
                      
 208,186,96,220,62,57,137,103,4,26,67,30,132,246,62,142,
                      
 238,140,226,125,194,135,210,234,107,18,128,76,113,52,34,
                      
 199,134,34,140,80,84,35,205,142,207,230,104,37,226,58,
                       32,253,248,156,220,244,151,11,22,43,188,14,177,227,4,
                      
 188,97,24,83,79,40,16,150,139,230,40,224,66,224,140,89,
                      
 175,200,198,15,30,202,248,69,32,159,182,234,202,82,247,
                       91,75,129,24,242,250,172,34,107,44,39,177,73,125,204,
                      
 232,146,190,41,239,6,154,165,197,220,227,183,190,17,114,
                      
 215,232,235,67,159,222,247,110,133,191,142,154,6,99,200,
                      
 37,59,120,252,161,54,91,223,191,85,104,9,121,14,184,105,
                      
 75,162,181,90,233,48,195,87,151,172,23,119,42,211,2,3,
                      
 130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,3,85,29,19,
                      
 4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,48,19,6,3,85,
                      
 29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,48,13,6,9,42,134,
                       72,134,247,13,1,1,5,5,0,3,130,1,1,0,222,44,95,61,253,
                      
 222,29,196,80,45,112,118,52,202,249,227,153,3,154,114,
                      
 189,224,23,172,222,204,213,89,202,98,202,252,34,116,104,
                      
 112,18,98,136,6,133,201,165,220,4,130,95,247,113,200,31,
                      
 36,105,22,27,24,197,222,154,33,131,183,215,250,104,240,
                       205,213,224,56,201,76,226,250,166,136,68,224,195,215,
                      
 149,224,255,162,11,156,74,159,108,185,153,46,116,32,182,
                       58,192,42,77,78,249,153,29,40,105,199,192,192,14,230,
                      
 169,223,199,172,53,122,145,127,57,110,56,67,139,94,115,
                      
 57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,134,
                      
 211,89,211,47,183,79,202,162,128,196,45,44,85,122,172,
                      
 122,58,170,117,116,151,187,96,109,186,207,188,10,72,138,
                      
 17,2,60,52,236,72,68,203,229,144,164,154,254,145,75,227,
                      
 182,44,152,36,81,103,234,99,135,223,62,152,94,109,109,
                       202,223,114,90,71,131,48,180,74,83,145,93,85,218,225,
                      
 135,141,226,127,85,243,186,10,50,216,220,110,91,48,135,
                      
 32,83,253,201,62,47,163,250,152,166,230,144,155,164,240,
                       234,78,55,198,137,227,164,67,70>>,
                     0,
                     <<0,5>>,
                     undefined,new,63510871438},
                 274512,ssl_session_cache,
                 {3,0},
                 undefined,true,rsa,undefined,
                 {'RSAPrivateKey','two-prime',
                    
 20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
                     65537,
                    
 15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
                    
 147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
                    
 139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
                    
 83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
                    
 118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
                    
 129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
                     asn1_NOVALUE},
                 {'DHParameter',
                    
 179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
                     2,asn1_NOVALUE},
                 undefined,undefined,#Ref<0.0.0.58841>,
                 {<0.3888.1>,#Ref<0.0.0.58850>},
                 0,<<>>,true,
                 {false,first},
                 undefined,
                 {[],[]},
                 false,true}],
            [{file,"ssl_connection.erl"},{line,2179}]},
        {ssl_connection,handle_alerts,2,
            [{file,"ssl_connection.erl"},{line,2177}]},
        {gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,494}]},
        {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}

=ERROR REPORT==== 30-Jul-2012::12:43:58 ===
error on AMQP connection <0.3888.1>: {ssl_upgrade_failure,
                                      {{function_clause,
                                        [{ssl_connection,handle_alert,
                                          [{alert,1,41,
                                            {"ssl_connection.erl",1678}},
                                           certify,
                                           {state,server,
                                            {#Ref<0.0.0.58837>,<0.3888.1>},
                                            
gen_tcp,tcp,tcp_closed,tcp_error,
                                            "localhost",443,#Port<0.8968>,
                                            {ssl_options,[],verify_peer,
                                             {#Fun<ssl.3.54384637>,
                                              
#Fun<rabbit_networking.0.89858908>},
                                             false,false,undefined,1,
                                             "C:/certstore/server/cert.pem",
                                             undefined,
                                             "C:/certstore/server/key.pem",
                                             undefined,undefined,undefined,
                                            
 "C:/certstore/testca/cacert.pem",
                                             undefined,undefined,
                                             [<<0,57>>,
                                              <<0,56>>,
                                              <<0,53>>,
                                              <<0,22>>,
                                              <<0,19>>,
                                              <<0,10>>,
                                              <<0,51>>,
                                              <<0,50>>,
                                              <<0,47>>,
                                              <<0,5>>,
                                              <<0,4>>,
                                              <<0,21>>,
                                              <<0,9>>],
                                             #Fun<ssl.0.54384637>,true,
                                             268435456,false,[],undefined,
                                             false},
                                            {socket_options,binary,0,0,0,
                                             false},
                                            {connection_states,
                                             {connection_state,
                                              {security_parameters,
                                               <<0,0>>,
                                              
 0,0,0,0,0,0,0,0,0,0,undefined,
                                              
 undefined,undefined,undefined},
                                              
undefined,undefined,undefined,2,
                                              true,undefined,undefined},
                                             {connection_state,
                                              {security_parameters,
                                               <<0,5>>,
                                               0,1,0,0,128,16,16,2,20,0,
                                               undefined,
                                              
 <<80,22,199,223,40,186,235,18,
                                                
 229,68,117,41,146,137,237,216,
                                                
 114,239,54,7,165,33,37,94,57,
                                                 110,228,3,62,87,25,210>>,
                                               <<80,22,199,222,169,174,5,18,
                                                
 190,32,21,236,199,246,168,19,
                                                
 117,78,229,208,48,132,253,20,
                                                
 180,170,31,49,53,31,120,40>>,
                                               undefined},
                                              undefined,undefined,undefined,
                                              undefined,true,undefined,
                                              undefined},
                                             {connection_state,
                                              {security_parameters,
                                               <<0,0>>,
                                              
 0,0,0,0,0,0,0,0,0,0,undefined,
                                              
 undefined,undefined,undefined},
                                              
undefined,undefined,undefined,4,
                                              true,undefined,undefined},
                                             {connection_state,
                                              {security_parameters,
                                               <<0,5>>,
                                               0,1,0,0,128,16,16,2,20,0,
                                               undefined,
                                              
 <<80,22,199,223,40,186,235,18,
                                                
 229,68,117,41,146,137,237,216,
                                                
 114,239,54,7,165,33,37,94,57,
                                                 110,228,3,62,87,25,210>>,
                                               <<80,22,199,222,169,174,5,18,
                                                
 190,32,21,236,199,246,168,19,
                                                
 117,78,229,208,48,132,253,20,
                                                
 180,170,31,49,53,31,120,40>>,
                                               undefined},
                                              undefined,undefined,undefined,
                                              undefined,true,undefined,
                                              undefined}},
                                            [],<<>>,<<>>,
                                            {{<<31,32,233,180,58,12,212,253,
                                                
218,229,84,250,254,74,36,209,
                                                
80,51,0,0,0,0,0,0,24,54,90,252,
                                                
231,192,148,13,0,0,27,1,1,0,23,
                                                
0,21,48,19,49,17,48,15,6,3,85,
                                                
4,3,19,8,77,121,84,101,115,116,
                                                
67,65,14,0,0,0,0,0,0,0,0,0,0,0,
                                                
0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,
                                                0,0,0>>,
                                              <<225,51,90,230,223,74,48,11,
                                                
240,71,28,159,160,170,128,137,
                                                
71,51,20,230,80,51,0,0,0,0,0,
                                                
0,24,54,90,252,231,192,148,13,
                                                
0,0,27,1,1,0,23,0,21,48,19,49,
                                                17,48,15,6,3,85,4,3,19,8,77,
                                                
121,84,101,115,116,67,65,14,0,
                                                
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                                                
0,0,0,0,0,0,0,0,0,42,0,0,0>>},
                                             {<<31,32,233,180,58,12,212,253,
                                                
218,229,84,250,254,74,36,209,
                                                
48,51,0,0,0,0,0,0,24,54,90,252,
                                                
231,192,148,13,0,0,27,1,1,0,23,
                                                
0,21,48,19,49,17,48,15,6,3,85,
                                                
4,3,19,8,77,121,84,101,115,116,
                                                
67,65,0,0,0,0,0,0,0,0,0,0,0,0,
                                                
0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,
                                                0,0,0>>,
                                              <<225,51,90,230,223,74,48,11,
                                                240,71,28,159,160,170,128,
                                                
137,71,51,20,230,48,51,0,0,0,
                                                0,0,0,24,54,90,252,231,192,
                                                148,13,0,0,27,1,1,0,23,0,21,
                                                
48,19,49,17,48,15,6,3,85,4,3,
                                                19,8,77,121,84,101,115,116,
                                                67,65,0,0,0,0,0,0,0,0,0,0,0,
                                                0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                                                0,38,0,0,0>>}},
                                            [{ssl_tls,undefined,22,
                                              {3,0},
                                              
<<16,0,1,0,13,149,79,68,242,219,
                                                55,33,132,16,78,131,203,216,
                                                
134,82,174,2,104,224,25,10,69,
                                                244,189,175,235,223,106,45,
                                                
186,155,55,99,237,33,164,234,
                                                55,53,210,3,243,167,173,216,
                                                218,142,61,49,55,108,94,229,
                                                157,57,65,152,150,104,244,4,
                                                
248,47,159,188,27,115,22,176,
                                                202,177,230,100,242,152,230,
                                                
216,64,87,7,88,206,101,137,11,
                                                
61,214,170,45,226,106,24,133,
                                                
184,53,215,16,85,173,26,76,22,
                                                71,236,163,220,163,198,105,
                                                
253,57,252,199,21,111,171,20,
                                                59,238,66,255,32,129,232,2,
                                                110,140,48,215,124,215,101,
                                                193,77,70,48,12,192,100,149,
                                                
167,33,214,90,232,214,188,72,
                                                182,193,115,137,185,198,135,
                                                
213,168,214,68,180,170,204,32,
                                                
157,92,121,79,219,215,147,140,
                                                21,215,151,41,254,22,64,224,
                                                33,217,40,66,213,175,157,29,
                                                114,38,133,252,112,102,104,
                                                
185,76,231,12,236,87,176,162,
                                                
138,29,15,168,220,218,231,131,
                                                
230,243,106,157,193,42,63,8,9,
                                                
49,203,208,76,250,159,76,187,
                                                179,2,183,83,199,70,237,161,
                                                
192,221,12,4,228,227,107,196,
                                                161,231,171,118,233,240,24,
                                                122,209,118,132,27>>},
                                             {ssl_tls,undefined,20,
                                              {3,0},
                                              <<1>>},
                                             {ssl_tls,undefined,22,
                                              {3,0},
                                              <<202,190,24,80,89,105,254,68,
                                                94,146,20,33,11,8,52,82,120,
                                                141,183,75,210,23,34,29,85,
                                                28,45,236,35,40,199,167,111,
                                                
94,144,170,240,48,75,136,116,
                                                63,197,216,54,26,61,171,134,
                                                80,82,163,26,75,50,152,15,
                                                181,218,235>>}],
                                            262221,
                                            {session,
                                            
 <<120,172,49,23,82,227,196,133,69,
                                              
 243,102,137,72,209,109,38,212,
                                              
 150,216,237,102,171,222,27,8,24,
                                               94,130,47,132,52,140>>,
                                             undefined,
                                            
 <<48,130,2,230,48,130,1,206,160,3,
                                              
 2,1,2,2,1,1,48,13,6,9,42,134,72,
                                              
 134,247,13,1,1,5,5,0,48,19,49,
                                              
 17,48,15,6,3,85,4,3,19,8,77,121,
                                              
 84,101,115,116,67,65,48,30,23,
                                              
 13,49,50,48,55,51,48,49,50,53,
                                              
 54,52,54,90,23,13,49,51,48,55,
                                              
 51,48,49,50,53,54,52,54,90,48,
                                              
 41,49,22,48,20,6,3,85,4,3,12,13,
                                              
 114,105,111,111,118,101,114,108,
                                              
 111,114,100,45,49,49,15,48,13,6,
                                              
 3,85,4,10,12,6,115,101,114,118,
                                              
 101,114,48,130,1,34,48,13,6,9,
                                              
 42,134,72,134,247,13,1,1,1,5,0,
                                              
 3,130,1,15,0,48,130,1,10,2,130,
                                              
 1,1,0,163,99,255,119,11,217,190,
                                              
 17,106,102,242,229,252,214,101,
                                               34,15,190,61,32,23,69,175,49,
                                              
 141,78,38,16,202,80,88,96,12,88,
                                              
 193,17,57,226,60,106,35,93,184,
                                              
 216,167,217,0,102,117,69,97,209,
                                               60,27,104,157,167,92,224,120,
                                              
 142,28,102,218,176,245,195,212,
                                              
 83,251,182,49,60,172,62,12,51,
                                              
 164,181,246,88,136,122,208,186,
                                              
 96,220,62,57,137,103,4,26,67,30,
                                              
 132,246,62,142,238,140,226,125,
                                              
 194,135,210,234,107,18,128,76,
                                              
 113,52,34,199,134,34,140,80,84,
                                              
 35,205,142,207,230,104,37,226,
                                              
 58,32,253,248,156,220,244,151,
                                              
 11,22,43,188,14,177,227,4,188,
                                              
 97,24,83,79,40,16,150,139,230,
                                               40,224,66,224,140,89,175,200,
                                              
 198,15,30,202,248,69,32,159,182,
                                              
 234,202,82,247,91,75,129,24,242,
                                              
 250,172,34,107,44,39,177,73,125,
                                               204,232,146,190,41,239,6,154,
                                              
 165,197,220,227,183,190,17,114,
                                              
 215,232,235,67,159,222,247,110,
                                              
 133,191,142,154,6,99,200,37,59,
                                               120,252,161,54,91,223,191,85,
                                              
 104,9,121,14,184,105,75,162,181,
                                              
 90,233,48,195,87,151,172,23,119,
                                              
 42,211,2,3,130,228,61,83,2,3,1,
                                              
 0,1,163,47,48,45,48,9,6,3,85,29,
                                              
 19,4,2,48,0,48,11,6,3,85,29,15,
                                              
 4,4,3,2,5,32,48,19,6,3,85,29,37,
                                              
 4,12,48,10,6,8,43,6,1,5,5,7,3,1,
                                              
 48,13,6,9,42,134,72,134,247,13,
                                              
 1,1,5,5,0,3,130,1,1,0,222,44,95,
                                              
 61,253,222,29,196,80,45,112,118,
                                               52,202,249,227,153,3,154,114,
                                              
 189,224,23,172,222,204,213,89,
                                              
 202,98,202,252,34,116,104,112,
                                              
 18,98,136,6,133,201,165,220,4,
                                              
 130,95,247,113,200,31,36,105,22,
                                               27,24,197,222,154,33,131,183,
                                              
 215,250,104,240,205,213,224,56,
                                              
 201,76,226,250,166,136,68,224,
                                              
 195,215,149,224,255,162,11,156,
                                               74,159,108,185,153,46,116,32,
                                              
 182,58,192,42,77,78,249,153,29,
                                              
 40,105,199,192,192,14,230,169,
                                              
 223,199,172,53,122,145,127,57,
                                              
 110,56,67,139,94,115,57,55,116,
                                              
 11,212,76,212,44,180,72,244,150,
                                              
 141,6,207,134,211,89,211,47,183,
                                              
 79,202,162,128,196,45,44,85,122,
                                              
 172,122,58,170,117,116,151,187,
                                              
 96,109,186,207,188,10,72,138,17,
                                              
 2,60,52,236,72,68,203,229,144,
                                              
 164,154,254,145,75,227,182,44,
                                              
 152,36,81,103,234,99,135,223,62,
                                              
 152,94,109,109,202,223,114,90,
                                              
 71,131,48,180,74,83,145,93,85,
                                              
 218,225,135,141,226,127,85,243,
                                              
 186,10,50,216,220,110,91,48,135,
                                              
 32,83,253,201,62,47,163,250,152,
                                              
 166,230,144,155,164,240,234,78,
                                               55,198,137,227,164,67,70>>,
                                             0,
                                             <<0,5>>,
                                             undefined,new,63510871438},
                                            274512,ssl_session_cache,
                                            {3,0},
                                            undefined,true,rsa,undefined,
                                            {'RSAPrivateKey','two-prime',
                                            
 20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
                                             65537,
                                            
 15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
                                            
 147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
                                            
 139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
                                            
 83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
                                            
 118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
                                            
 129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
                                             asn1_NOVALUE},
                                            {'DHParameter',
                                            
 179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
                                             2,asn1_NOVALUE},
                                            undefined,undefined,
                                            #Ref<0.0.0.58841>,
                                            {<0.3888.1>,#Ref<0.0.0.58850>},
                                            0,<<>>,true,
                                            {false,first},
                                            undefined,
                                            {[],[]},
                                            false,true}],
                                          [{file,"ssl_connection.erl"},
                                           {line,2179}]},
                                         {ssl_connection,handle_alerts,2,
                                          [{file,"ssl_connection.erl"},
                                           {line,2177}]},
                                         {gen_fsm,handle_msg,7,
                                          
[{file,"gen_fsm.erl"},{line,494}]},
                                         {proc_lib,init_p_do_apply,3,
                                          [{file,"proc_lib.erl"},
                                           {line,227}]}]},
                                       {gen_fsm,sync_send_all_state_event,
                                        [<0.3889.1>,start,5000]}}}
</.net>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120730/efbe5f33/attachment.htm>

From a.d.prokofiev at gmail.com  Mon Jul 30 22:12:01 2012
From: a.d.prokofiev at gmail.com (Anton Prokofiev)
Date: Mon, 30 Jul 2012 23:12:01 +0200
Subject: [rabbitmq-discuss] Erlang Consumer Example
In-Reply-To: <50165947.4070609@rabbitmq.com>
References: <ea3f2de4-2e25-4a4c-a30d-b798520f87bc@googlegroups.com>
	<85328f00-373d-4faf-9172-d836c2978fba@googlegroups.com>
	<50165947.4070609@rabbitmq.com>
Message-ID: <5016F8A1.8020904@googlemail.com>

Hello, Matthias!



On 07/30/2012 11:52 AM, Matthias Radestock wrote:
> Anton,
>
> On 29/07/12 21:59, anton prokofiev wrote:
>> On Sunday, 29 July 2012 21:21:06 UTC+2, anton prokofiev wrote:
>>     I tried to create  a consumer in Erlang for RabbitMQ and get into
>>     big troubles.
>>     Looks like examples that are available in RabbitMQ website did 
>> not work.
>
> *Which* example didn't work?
It seams to me that  this one did not work:

Sub = #'basic.consume'{queue = Q},
       #'basic.consume_ok'{consumer_tag = Tag} = amqp_channel:call(Channel, Sub) %% the caller is the subscriber


At least I do not managed to force it to work.
In another one,

Sub = #'basic.consume'{queue = Q},
       #'basic.consume_ok'{consumer_tag = Tag} = amqp_channel:subscribe(Channel, Sub, Consumer)
     

It was not clear to me what should be used as a consumer, as final 
example contains only case when we use *#'basic.get'* command.

If I understood it correctly, I should pass a PID of the consumer 
process, when I  open channel:
amqp_connection:open_channel(Connection,none,*{amqp_direct_consumer,[Pid]}*), 


Unfortunately I can not found this in the documentation, or may be it 
was not clearly enough pointed out. :(

I should say that I  have not too much experience with erlang, and just 
started to work with rabbitMQ.
Another problem is that RabbitMQ broker I work with is out of my control 
and documentation that I have really misleading.
As a result I have to use try-and-error approach to develop my application.

>> Looks like I have found a correct solution:
>>
>> 1. I have implemented simple gen_server, that just print all messages to
>> the stdout.
>>
>> 2. And  to like this:
>>    {ok,Connection} = amqp_connection:start(ConnectionParams), % open
>> connection with predefined params.
>>    {ok,Pid} =  test_srv:start_link(),    % Start our own consumer.
>> {ok,Channel}  =
>> amqp_connection:open_channel(Connection,none,*{amqp_direct_consumer,[Pid]}*), 
>>
>
> The above creates a channel with a default consumer. More typically 
> you'd associate consumers with particular subscriptions, as shown in 
> http://www.rabbitmq.com/erlang-client-user-guide.html#subscribing.
>
>> Would it be better to create my own implementation of consume behavior,
>> or handle them thought the message_info as it is now?
>> Any recommendations?
>
> Implementing your own instance of the amqp_gen_consumer behaviour is 
> probably the more "correct" approach, but it's a bit more work and if 
> the behaviour of the amqp_direct_consumer fits in well with the rest 
> of your system design then just use that.
>
> Regards,
>
> Matthias.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120730/6b58d7d5/attachment.htm>

From kekib at alum.vassar.edu  Tue Jul 31 05:56:07 2012
From: kekib at alum.vassar.edu (kmb)
Date: Mon, 30 Jul 2012 21:56:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Limiting the size of a message
In-Reply-To: <50165265.9050401@rabbitmq.com>
References: <1343442040462-21099.post@n5.nabble.com>
	<50164E3D.5000101@rabbitmq.com> <50165265.9050401@rabbitmq.com>
Message-ID: <1343710567230-21127.post@n5.nabble.com>

Thanks for your answers. For now, fronting the broker with a client that
detects malicious behavior seems to be the way to go. 

Regards,
Keki 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Limiting-the-size-of-a-message-tp21099p21127.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From watson.timothy at gmail.com  Tue Jul 31 09:58:34 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 31 Jul 2012 09:58:34 +0100
Subject: [rabbitmq-discuss] Exchange with throttling
In-Reply-To: <CAFdw233dssYwOpPwK+0=KhN3niwUkv8pT7-0HHY03w2_8xHCUQ@mail.gmail.com>
References: <1ccea2bc-4d26-427f-b174-ff78de0de8c7@googlegroups.com>
	<500E6E96.2010304@rabbitmq.com>
	<CAFdw230XV7YYV5mhpKek3DKpEV2RLQnWabxxBpmG-JoHrO7TZg@mail.gmail.com>
	<50165355.6010800@rabbitmq.com>
	<CAFdw233dssYwOpPwK+0=KhN3niwUkv8pT7-0HHY03w2_8xHCUQ@mail.gmail.com>
Message-ID: <8DA457D4-3C5C-45CD-A69C-2FC3F55728DF@rabbitmq.com>


On 30 Jul 2012, at 10:45, F?lix L?pez <jaaaelpumuki at gmail.com> wrote:

> Definitely I would like to extend the flow control mechanism to support something similar as I've done with plugin, so someone can set a maximum messages per second or something similar
> 

The flow control mechanism at the moment uses the concept of credit. You could possibly use internal or user defined sensors to limit or release available credit, without introducing throttle points at unnatural junctions in the process flow. I'm not saying we would do that, just that it sounds like a more convincing approach to customising flow control. The key thing is to understand where you actually want to introduce back pressure, as apply it in the wrong place almost certainly won't help and a lot of careful thought went into designing the existing approach, so (a) changing that would require just as much careful consideration and (b) opening the choice of how to apply throttling to user defined actions, sensors or throttles would require even more careful design. We would also have to consider the implications of supporting this, as any arbitrary user code that runs inside rabbit can have a variety of effects which need to be understood and documented.

I would also like to offer another architectural approach to meeting this requirement. By introducing traffic management in a border controller you obviate the need to alter the broker's behaviour in potentially unpredictable ways. A border control component doesn't have to be AMQP aware, so you can defer to smart network kit or a trusted software implementation. If a single connection (to a given endpoint) can be both producer and consumer, then a traffic manager that isn't aware of AMQP framing could potentially block progress by, for example, preventing ACKs from being delivered where a single client connection is handling both roles over two different channels. In this case, you could deploy a rabbit node to act as a border controller and use an intermediary client (say the erlang direct client, which is likely to be very efficient in this respect) to do the rate limiting before forwarding messages to the real destination endpoint. I think it's worthwhile exploring the alternative possibilities before adding complexity to the broker.

> 2012/7/30 Tim Watson <tim at rabbitmq.com>
> Just to add to Emile's comments, I there are a couple of things to consider here.
> 
> Firstly, it's important to point out that letting the Channel process mailbox fill up could lead to unexpected and unpredictable performance characteristics, and doesn't appear to offer anything that per-connection flow control isn't already doing. Also, creating an mnesia transaction for each routing operation is likely to produce an altogether *different* kind of throttling of Rabbit's performance across a cluster, and probably (in fact, almost certainly) not the one you intended.
> 
> I would strongly recommend reconsidering this approach. If you're interested in extending the flow control mechanism to support alternative measures, then perhaps we should have a collective conversation about that instead, as Emile is quite right in suggesting that approach makes more sense.
> 
> Cheers,
> Tim
> 
> 
> On 07/28/2012 11:52 AM, F?lix L?pez wrote:
>> Thanks, 
>> 
>> I've finally made a plugin to do that. I think what I wanted to do It cannot be possible with mechanism you sent me in the email. 
>> 
>> The plugin is here https://github.com/flopezluis/rabbitmq-throttling-exchange, It has a lot to improve and certainly I'm not sure of the impact of this exchange in the performance of rabbitmq.
>> 
>> 
>> 2012/7/24 Emile Joubert <emile at rabbitmq.com>
>> Hi,
>> 
>> On 23/07/12 18:20, F?lix wrote:
>> > Is there anything similar in rabbitmq?
>> 
>> Yes, the broker has a connection-based flow control mechanism - see
>> http://www.rabbitmq.com/memory.html#per-connection
>> and a blog post that explains further:
>> http://www.rabbitmq.com/blog/2012/04/17/rabbitmq-performance-measurements-part-1/
>> 
>> Bear in mind that blocking an Erlang process will lead to a backlog in
>> its internal mailbox without slowing down the network. Also, the
>> exchange is not a natural control point for bandwidth limiting, because
>> an exchange is not a process. A channel would be a more natural choice.
>> You may be able to adapt the existing flow control mechanism to grant
>> credits based on bandwidth rather than message count.
>> 
>> 
>> 
>> -Emile
>> 
>> 
>> 
>> 
>> -- 
>> http://www.linkedin.com/in/flopezluis
>> 
>> It's easier to ask forgiveness than it is to get permission
>> 
>> 
>> ".....it doesn't matter how many times you fail. It doesn't matter how many times you almost get it right. No one is going to know or care about your failures, and either should you. All you have to do is learn from them and those around you because...All that matters in business is that you get it right once. Then everyone can tell you how lucky you are."
>> --Mark Cuban"
>> 
>> "Always be the worst guy in every band you're in." If you're the best guy there, you need to be in a different band. And I think that works for almost everything that's out there as well." Pat Metheny
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> -- 
> http://www.linkedin.com/in/flopezluis
> 
> It's easier to ask forgiveness than it is to get permission
> 
> 
> ".....it doesn't matter how many times you fail. It doesn't matter how many times you almost get it right. No one is going to know or care about your failures, and either should you. All you have to do is learn from them and those around you because...All that matters in business is that you get it right once. Then everyone can tell you how lucky you are."
> --Mark Cuban"
> 
> "Always be the worst guy in every band you're in." If you're the best guy there, you need to be in a different band. And I think that works for almost everything that's out there as well." Pat Metheny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120731/420dd120/attachment.htm>

From emile at rabbitmq.com  Tue Jul 31 10:33:57 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 31 Jul 2012 10:33:57 +0100
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
Message-ID: <5017A685.9000607@rabbitmq.com>


Hi Mark.

On 30/07/12 19:06, Mark Ward wrote:
> I might have the same problem as this post.
>  https://groups.google.com/forum/?fromgroups#!searchin/rabbitmq-discuss/ssl_upgrade_failure/rabbitmq-discuss/-hCUUIzi_9c/Pg6UQ3Lo1kMJ

Bear in mind that in posting these detailed logfiles you have revealed
private keymaterial. You will need to re-generate it.

The only part of this output that has any meaning to me is
"ssl_upgrade_failure" (which is pretty generic unfortunately), and
"certify". Maybe there is a problem with verification? Are you using the
same certificates and keys that you used for the Java test? Have you
tried turning peer verification off, just as a test? See the details
about "verify_none" here:

http://www.rabbitmq.com/ssl.html
http://www.erlang.org/doc/man/ssl.html

Another test you can perform is to place an stunnel proxy in front of
the broker and see if you can connect through that with the .NET client.
This may aid in producing diagnostics about where the problem lies.


-Emile


From steve at rabbitmq.com  Tue Jul 31 11:56:18 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 31 Jul 2012 11:56:18 +0100
Subject: [rabbitmq-discuss] Crashes - init terminating?
In-Reply-To: <60F6A6AF-045F-46CE-ADDE-91DF27A61AF3@rabbitmq.com>
References: <CAECZ850EcVLSU_w+nt4Y_Yp47xh9Jw0dfMyAfSE1hW5MZ270JQ@mail.gmail.com>
	<60F6A6AF-045F-46CE-ADDE-91DF27A61AF3@rabbitmq.com>
Message-ID: <A5777F79-73AB-4CC6-9336-E13BDF155C6F@rabbitmq.com>

Dan,
Reposting on Discuss.  Please continue correspondence on ths rabbitmq-discuss mailing list.

From: 	Dan Dart <dan at canddi.com>
Subject: 	Re: [rabbitmq-discuss] Crashes - init terminating?
Date: 	30 July 2012 18:07:05 GMT+01:00
To: 	Steve Powell <steve at rabbitmq.com>

> Did you run `sudo port load rabbitmq-server` which starts the service in
> the background?
No - and I've never had to before.

> 
> Now accessing the rabbitmqctl and rabbitmq-server scripts from the
> command line requires that you issue them as root, done with sudo:
> 
>    sudo rabbitmqctl status
> 
> This should give a reasonable response.

Doesn't look reasonable to me:
{"init terminating in
do_boot",{undef,[{rabbit_control,start,[]},{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()

> To see if the server has problems you should look in the log directory
> (/opt/local/var/log/rabbitmq/*) where you should have two logs for each
> rabbitmq node you run. (By default this is rabbit@<hostname>.log and
> -sasl.log.) I suspect there will be nothing untoward there.

Getting lots of connection_closed_abruptly - although I suspect this is normal.
And nothing in the sasl log.

> I cannot reproduce your symptoms unless I disable the -pa option on the
> (eventual) erl command, so it looks as though you have an environment
> problem. Please check the following directory:
> 
>    /opt/local/lib/rabbitmq/lib/rabbitmq_server-2.8.2/
> 
> and see if the scripts are in sbin/, and there are a lot of beam files
> in ebin/.
[Dan-Darts-iMac:lib/rabbitmq_server-2.8.2/sbin] DanDart% ls
rabbitmq-defaults	rabbitmq-env		rabbitmq-plugins	rabbitmq-server		rabbitmqctl

[Dan-Darts-iMac:lib/rabbitmq_server-2.8.2/ebin] DanDart% ls
credit_flow.beam
[...snip...]

> PS:
> [You might be using a non-standard prefix for macport install
> files -- if so, the /opt/local in this directory path might be something
> different for you -- and we may have a bug, since we are supposed to
> cope with that.]

Nope - it's the same. I just used a standard "port install
rabbitmq-server" and don't remember doing anything that would break
it.

Is that any help?

Regards
Dan

Steve Powell  (a happy bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

On 19 Jun 2012, at 14:04, Steve Powell wrote:

> Hi Dan,
> 
> The Erlang crash dumps for rabbitmq-server and rabbitmqctl are because
> of failures to run these Erlang programs (actually a prelaunch program
> in the former case). They should not affect the rabbitmq-server service
> if it is already running (which it appears to be since you say sending
> and receiving messages are fine).
> 
> I assume that by the latest version of rabbitmq you are running
> rabbitmq-server 2.8.2, and Erlang R15B, which is what I get from my
> macports (on OS X 10.6.8, macports 2.1.1). You should check that any
> earlier version(s) is(are) uninstalled.
> 
> Did you run `sudo port load rabbitmq-server` which starts the service in
> the background?
> 
> Now accessing the rabbitmqctl and rabbitmq-server scripts from the
> command line requires that you issue them as root, done with sudo:
> 
>    sudo rabbitmqctl status
> 
> This should give a reasonable response.
> 
> To see if the server has problems you should look in the log directory
> (/opt/local/var/log/rabbitmq/*) where you should have two logs for each
> rabbitmq node you run. (By default this is rabbit@<hostname>.log and
> -sasl.log.) I suspect there will be nothing untoward there.
> 
> I cannot reproduce your symptoms unless I disable the -pa option on the
> (eventual) erl command, so it looks as though you have an environment
> problem. Please check the following directory:
> 
>    /opt/local/lib/rabbitmq/lib/rabbitmq_server-2.8.2/
> 
> and see if the scripts are in sbin/, and there are a lot of beam files
> in ebin/.
> 
> PS: 
> [You might be using a non-standard prefix for macport install
> files -- if so, the /opt/local in this directory path might be something
> different for you -- and we may have a bug, since we are supposed to
> cope with that.]
> 
> Steve Powell  (a happy bunny)
> ----------yet more definitions from the SPD----------
> corrugate (n.) T.V. soap scandal.
> olympic (n.) A camp road-digger.
> jamboree (n.) A conserve made from French cheese.
> 
> On 19 Jun 2012, at 10:44, Dan Dart wrote:
> 
>> Hi,
>> 
>> I'm having a problem in that sending and receiving messages is fine,
>> but doing either of these commands:
>> 
>> rabbitmqctl list_exchanges
>> rabbitmqctl list_queues
>> rabbitmqctl list_bindings
>> rabbitmqctl delete_user
>> rabbitmqctl add_user
>> rabbitmqctl delete_vhost
>> rabbitmqctl add_vhost
>> rabbitmqctl set_permissions
>> rabbitmqctl stop
>> 
>> echoes the following to stderr:
>> 
>> {"init terminating in
>> do_boot",{undef,[{rabbit_control,start,[]},{init,start_it,1},{init,start_em,1}]}}
>> 
>> Crash dump was written to: erl_crash.dump
>> init terminating in do_boot ()
>> 
>> and rabbitmq-server results in:
>> 
>> {"init terminating in
>> do_boot",{undef,[{rabbit_prelaunch,start,[]},{init,start_it,1},{init,start_em,1}]}}
>> 
>> Crash dump was written to: erl_crash.dump
>> init terminating in do_boot ()
>> 
>> My Rabbit version is the latest from MacPorts on OSX 10.6 (and will
>> not tell me itself).
>> 
>> My erl_crash.dump:
>> https://gist.github.com/2953290
>> 
>> Cheers
>> Dan
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120731/cab6d6b8/attachment.htm>

From nimmavadiraj at gmail.com  Tue Jul 31 11:57:50 2012
From: nimmavadiraj at gmail.com (Vadiraj Hebbar)
Date: Tue, 31 Jul 2012 16:27:50 +0530
Subject: [rabbitmq-discuss] AMQP Message attributes properties
Message-ID: <CALK6wMqGwUNbkL6wB=PQFR3E2SD3aCUjXSK3C9gfDu6VrGnsGQ@mail.gmail.com>

I am new for rabbitMQ, i am  using AMQP Java client  publisher.I want to
use message attributes properties like Message priority,Delivery mode,
Message publishing timestamp,Expiration period, etc.how to set it on
channel.basicPublish() method ,please explain with example.

regards,

vadiraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120731/1e4b64a9/attachment.htm>

From matthias at rabbitmq.com  Tue Jul 31 12:05:52 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 31 Jul 2012 12:05:52 +0100
Subject: [rabbitmq-discuss] AMQP Message attributes properties
In-Reply-To: <CALK6wMqGwUNbkL6wB=PQFR3E2SD3aCUjXSK3C9gfDu6VrGnsGQ@mail.gmail.com>
References: <CALK6wMqGwUNbkL6wB=PQFR3E2SD3aCUjXSK3C9gfDu6VrGnsGQ@mail.gmail.com>
Message-ID: <5017BC10.3090805@rabbitmq.com>

Vadiraj,

On 31/07/12 11:57, Vadiraj Hebbar wrote:
> I am new for rabbitMQ, i am  using AMQP Java client  publisher.I want to
> use message attributes properties like Message priority,Delivery mode,
> Message publishing timestamp,Expiration period, etc.how to set it on
> channel.basicPublish() method ,please explain with example.

See http://www.rabbitmq.com/api-guide.html#publishing

Regards,

Matthias.


From steve at rabbitmq.com  Tue Jul 31 12:22:00 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 31 Jul 2012 12:22:00 +0100
Subject: [rabbitmq-discuss] Crashes - init terminating?
In-Reply-To: <A5777F79-73AB-4CC6-9336-E13BDF155C6F@rabbitmq.com>
References: <CAECZ850EcVLSU_w+nt4Y_Yp47xh9Jw0dfMyAfSE1hW5MZ270JQ@mail.gmail.com>
	<60F6A6AF-045F-46CE-ADDE-91DF27A61AF3@rabbitmq.com>
	<A5777F79-73AB-4CC6-9336-E13BDF155C6F@rabbitmq.com>
Message-ID: <7CDB61C0-1459-4E33-BB56-ABE641E2F481@rabbitmq.com>

Don,

Since our last conversation the latest release has become 2.8.4.

>> Did you run `sudo port load rabbitmq-server` which starts the service in
>> the background?
> No - and I've never had to before.


Well, you don't have to, but if you don't you need to start the server
yourself (`sudo rabbitmq-server` or `sudo rabbitmq-server -detached`)
before running rabbitmqctl etc. Did you? If you didn't then you have an
old version still running -- this may be scuppered because of an Erlang
upgrade during the rabbitmq-server install. So...

I think your problems are probably caused by having two installations
interfering (or possibly an old Erlang version).

If you haven't installed rabbitmq-server or Erlang by any other means
than macports then the following sequence will probably get you working.

(If you have, please ensure that the other installations are correctly
removed (including any plugin directories, environment variable
settings, &c.) before proceeding.)

Execute the following steps:

1) obtain the latest macports version `sudo port selfupdate` (Macports
   2.1.2 is what I get today.)

2) perform `sudo port upgrade outdated` (this might cure everything, but
   just in case...)

3) uninstall all previous versions of rabbitmq-server (`sudo port
   uninstall rabbitmq-server` should do it) check these are all gone:
   `sudo port installed rabbitmq-*`

4) clean up: `sudo port -u -v uninstall` will remove any debris from the
   macports repository

5) check your Erlang version: `sudo port installed erlang*` (should be
   active) upgrade this is it old (should have been done already above)

6) perform a clean install: `sudo port install rabbitmq-server` (check
   what version you get)

7) OBSERVE the instructions issued during this install about `sudo port
   load rabbitmq-server`. You might want to start rabbitmq in the
   background this way, or start it the normal way if you want. But
   start it.

Now everything should work. Come back here if it doesn't. In
particular, the output from when you start the server and the first
rabbitmqctl command.

Hope all goes smoothly for you.

Steve Powell  (a happy bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

On 31 Jul 2012, at 11:56, Steve Powell wrote:

> Dan,
> Reposting on Discuss.  Please continue correspondence on ths rabbitmq-discuss mailing list.
> 
> From: 	Dan Dart <dan at canddi.com>
> Subject: 	Re: [rabbitmq-discuss] Crashes - init terminating?
> Date: 	30 July 2012 18:07:05 GMT+01:00
> To: 	Steve Powell <steve at rabbitmq.com>
> 
>> Did you run `sudo port load rabbitmq-server` which starts the service in
>> the background?
> No - and I've never had to before.
> 
>> 
>> Now accessing the rabbitmqctl and rabbitmq-server scripts from the
>> command line requires that you issue them as root, done with sudo:
>> 
>>    sudo rabbitmqctl status
>> 
>> This should give a reasonable response.
> 
> Doesn't look reasonable to me:
> {"init terminating in
> do_boot",{undef,[{rabbit_control,start,[]},{init,start_it,1},{init,start_em,1}]}}
> 
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
> 
>> To see if the server has problems you should look in the log directory
>> (/opt/local/var/log/rabbitmq/*) where you should have two logs for each
>> rabbitmq node you run. (By default this is rabbit@<hostname>.log and
>> -sasl.log.) I suspect there will be nothing untoward there.
> 
> Getting lots of connection_closed_abruptly - although I suspect this is normal.
> And nothing in the sasl log.
> 
>> I cannot reproduce your symptoms unless I disable the -pa option on the
>> (eventual) erl command, so it looks as though you have an environment
>> problem. Please check the following directory:
>> 
>>    /opt/local/lib/rabbitmq/lib/rabbitmq_server-2.8.2/
>> 
>> and see if the scripts are in sbin/, and there are a lot of beam files
>> in ebin/.
> [Dan-Darts-iMac:lib/rabbitmq_server-2.8.2/sbin] DanDart% ls
> rabbitmq-defaults	rabbitmq-env		rabbitmq-plugins	rabbitmq-server		rabbitmqctl
> 
> [Dan-Darts-iMac:lib/rabbitmq_server-2.8.2/ebin] DanDart% ls
> credit_flow.beam
> [...snip...]
> 
>> PS:
>> [You might be using a non-standard prefix for macport install
>> files -- if so, the /opt/local in this directory path might be something
>> different for you -- and we may have a bug, since we are supposed to
>> cope with that.]
> 
> Nope - it's the same. I just used a standard "port install
> rabbitmq-server" and don't remember doing anything that would break
> it.
> 
> Is that any help?
> 
> Regards
> Dan
> 
> Steve Powell  (a happy bunny)
> ----------yet more definitions from the SPD----------
> corrugate (n.) T.V. soap scandal.
> olympic (n.) A camp road-digger.
> jamboree (n.) A conserve made from French cheese.
> 
> On 19 Jun 2012, at 14:04, Steve Powell wrote:
> 
>> Hi Dan,
>> 
>> The Erlang crash dumps for rabbitmq-server and rabbitmqctl are because
>> of failures to run these Erlang programs (actually a prelaunch program
>> in the former case). They should not affect the rabbitmq-server service
>> if it is already running (which it appears to be since you say sending
>> and receiving messages are fine).
>> 
>> I assume that by the latest version of rabbitmq you are running
>> rabbitmq-server 2.8.2, and Erlang R15B, which is what I get from my
>> macports (on OS X 10.6.8, macports 2.1.1). You should check that any
>> earlier version(s) is(are) uninstalled.
>> 
>> Did you run `sudo port load rabbitmq-server` which starts the service in
>> the background?
>> 
>> Now accessing the rabbitmqctl and rabbitmq-server scripts from the
>> command line requires that you issue them as root, done with sudo:
>> 
>>    sudo rabbitmqctl status
>> 
>> This should give a reasonable response.
>> 
>> To see if the server has problems you should look in the log directory
>> (/opt/local/var/log/rabbitmq/*) where you should have two logs for each
>> rabbitmq node you run. (By default this is rabbit@<hostname>.log and
>> -sasl.log.) I suspect there will be nothing untoward there.
>> 
>> I cannot reproduce your symptoms unless I disable the -pa option on the
>> (eventual) erl command, so it looks as though you have an environment
>> problem. Please check the following directory:
>> 
>>    /opt/local/lib/rabbitmq/lib/rabbitmq_server-2.8.2/
>> 
>> and see if the scripts are in sbin/, and there are a lot of beam files
>> in ebin/.
>> 
>> PS: 
>> [You might be using a non-standard prefix for macport install
>> files -- if so, the /opt/local in this directory path might be something
>> different for you -- and we may have a bug, since we are supposed to
>> cope with that.]
>> 
>> Steve Powell  (a happy bunny)
>> ----------yet more definitions from the SPD----------
>> corrugate (n.) T.V. soap scandal.
>> olympic (n.) A camp road-digger.
>> jamboree (n.) A conserve made from French cheese.
>> 
>> On 19 Jun 2012, at 10:44, Dan Dart wrote:
>> 
>>> Hi,
>>> 
>>> I'm having a problem in that sending and receiving messages is fine,
>>> but doing either of these commands:
>>> 
>>> rabbitmqctl list_exchanges
>>> rabbitmqctl list_queues
>>> rabbitmqctl list_bindings
>>> rabbitmqctl delete_user
>>> rabbitmqctl add_user
>>> rabbitmqctl delete_vhost
>>> rabbitmqctl add_vhost
>>> rabbitmqctl set_permissions
>>> rabbitmqctl stop
>>> 
>>> echoes the following to stderr:
>>> 
>>> {"init terminating in
>>> do_boot",{undef,[{rabbit_control,start,[]},{init,start_it,1},{init,start_em,1}]}}
>>> 
>>> Crash dump was written to: erl_crash.dump
>>> init terminating in do_boot ()
>>> 
>>> and rabbitmq-server results in:
>>> 
>>> {"init terminating in
>>> do_boot",{undef,[{rabbit_prelaunch,start,[]},{init,start_it,1},{init,start_em,1}]}}
>>> 
>>> Crash dump was written to: erl_crash.dump
>>> init terminating in do_boot ()
>>> 
>>> My Rabbit version is the latest from MacPorts on OSX 10.6 (and will
>>> not tell me itself).
>>> 
>>> My erl_crash.dump:
>>> https://gist.github.com/2953290
>>> 
>>> Cheers
>>> Dan
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120731/8450ffda/attachment.htm>

From ward.mark at gmail.com  Tue Jul 31 14:24:48 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Tue, 31 Jul 2012 06:24:48 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
Message-ID: <f7728ce5-c6ae-44ee-9fd1-a884cfe46cc8@googlegroups.com>

Hi Emile,

Thank you for pointing out the details in the log, I was aware of the 
content.  It is from an internal test server with certificates generated 
going through the ssl example in the help.  Nothing of value exposed.

I have my server's configuration set to false for the fail_if_no_peer_cert 
setting.  I am not using client certificates in my testing. I will see if I 
can get some of the network communication logged.  I have also pulled the 
.net client source and the tip in default also had the same issue.  


A side note not all posts seem to make it into the google group but I find 
the posts either in email or in nabble.com

-Mark


Hi Mark. 

On 30/07/12 19:06, Mark Ward wrote: 
> I might have the same problem as this post. 
>  
https://groups.google.com/forum/?fromgroups#!searchin/rabbitmq-discuss/ssl_upgrade_failure/rabbitmq-discuss/-hCUUIzi_9c/Pg6UQ3Lo1kMJ

Bear in mind that in posting these detailed logfiles you have revealed 
private keymaterial. You will need to re-generate it. 

The only part of this output that has any meaning to me is 
"ssl_upgrade_failure" (which is pretty generic unfortunately), and 
"certify". Maybe there is a problem with verification? Are you using the 
same certificates and keys that you used for the Java test? Have you 
tried turning peer verification off, just as a test? See the details 
about "verify_none" here: 

http://www.rabbitmq.com/ssl.html
http://www.erlang.org/doc/man/ssl.html

Another test you can perform is to place an stunnel proxy in front of 
the broker and see if you can connect through that with the .NET client. 
This may aid in producing diagnostics about where the problem lies. 


-Emile  

On Monday, July 30, 2012 1:06:19 PM UTC-5, Mark Ward wrote:
>
> Hi,
>
> I might have the same problem as this post.  
> https://groups.google.com/forum/?fromgroups#!searchin/rabbitmq-discuss/ssl_upgrade_failure/rabbitmq-discuss/-hCUUIzi_9c/Pg6UQ3Lo1kMJ
>
> The setup
> Windows 2008r2
> rabbitmq server 2.8.4 
> Erlang R15B01
>
> .NET 4.0
> RabbitMQ client 2.8.4 (installed from NuGet)
>
> When I run my test .NET publisher I get the following exception "None of 
> the specified endpoints were reachable".
>
> I have gone through the SSL setup tutorial and I am stumped on why the 
> .NET client cannot connect or even fail out with an SSL trust exception.
> I have tested the connection to the server over SSL with the following 
> tools. openssl s_client and the Java example.  The openssl and the java 
> client connect and work.  It is the .NET client that I cannot get working 
> and it is the one I need to have working.
>
> I have setup my rabbitmq server to run the ssl over port 443 on my server. 
>  This you will find in my log output and I have specified in each of my 
> clients.
>
> The following is the C# client that I am trying to connect and publish 
> data into rabbitmq.  The client works when I am not attempting a SSL 
> connection.
>
> using System;
> using System.Collections.Generic;
> using System.Linq;
> using System.Text;
> using RabbitMQ.Client;
>
> namespace ProducerOne
> {
>     class Program
>     {
>         static void Main(string[] args)
>         {
>             string hostName = "riooverlord-1";
>             int port = 443;
>
>             int count;
>             if (args != null && args.Length == 1)
>                 count = int.Parse(args[0]);
>             else
>                 count = 1;
>
>             var connectionFactory = new ConnectionFactory();
>             connectionFactory.HostName = hostName;
>             connectionFactory.Port = port;
>             connectionFactory.Ssl.Enabled = true;
>             connectionFactory.Ssl.AcceptablePolicyErrors = 
> System.Net.Security.SslPolicyErrors.None;
>             
>             IConnection connection = connectionFactory.CreateConnection(); 
>             
>             IModel channel = connection.CreateModel();
>
>             for (int i = 0; i < count; i++)
>             {
>                 byte[] message = 
> Encoding.UTF8.GetBytes(string.Format("message {0} - {1}", i.ToString(), 
> DateTime.Now.ToString()));
>                 channel.BasicPublish(string.Empty, "QueueOne", null, 
> message);
>             }
>
>             channel.Close(); 
>             connection.Close();
>         }
>     }
> }
>
>
> The following is a dump of my rabbitMQ log file.  I have grouped the log 
> lines between xml like tags to group the different client attempts. 
>  openssl, java, and .NET
>
>
> =INFO REPORT==== 30-Jul-2012::11:28:01 ===
> Limiting to approx 924 file handles (829 sockets)
>
> =INFO REPORT==== 30-Jul-2012::11:28:01 ===
> Memory limit set to 409MB of 1023MB total.
>
> =INFO REPORT==== 30-Jul-2012::11:28:03 ===
> Disk free limit set to 953MB
>
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> Management plugin upgraded statistics to fine.
>
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>
> =WARNING REPORT==== 30-Jul-2012::11:28:04 ===
> msg_store_persistent: rebuilding indices from scratch
>
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> started TCP Listener on [::]:5672
>
> =INFO REPORT==== 30-Jul-2012::11:28:05 ===
> started TCP Listener on 0.0.0.0:5672
>
> =INFO REPORT==== 30-Jul-2012::11:28:06 ===
> started SSL Listener on [::]:443
>
> =INFO REPORT==== 30-Jul-2012::11:28:06 ===
> started SSL Listener on 0.0.0.0:443
>
> =INFO REPORT==== 30-Jul-2012::11:28:07 ===
> Management agent started.
>
> =INFO REPORT==== 30-Jul-2012::11:28:08 ===
> Management plugin started. Port: 55672, path: /
>
> =INFO REPORT==== 30-Jul-2012::11:28:08 ===
> Statistics database started.
>
> <openssl s_client test>
> =INFO REPORT==== 30-Jul-2012::12:08:46 ===
> accepting AMQP connection <0.19749.0> (192.168.10.157:53209 -> 
> 192.168.10.107:443)
>
> =ERROR REPORT==== 30-Jul-2012::12:08:56 ===
> closing AMQP connection <0.19749.0> (192.168.10.157:53209 -> 
> 192.168.10.107:443):
> {handshake_timeout,handshake}
> </openssl s_client test> 
>
> <java client>
> =INFO REPORT==== 30-Jul-2012::12:30:58 ===
> accepting AMQP connection <0.30363.0> (192.168.10.157:53426 -> 
> 192.168.10.107:443)
>
> =INFO REPORT==== 30-Jul-2012::12:30:59 ===
> closing AMQP connection <0.30363.0> (192.168.10.157:53426 -> 
> 192.168.10.107:443)
> </java client>
>
> <java client>
> =INFO REPORT==== 30-Jul-2012::12:32:17 ===
> accepting AMQP connection <0.31021.0> (192.168.10.157:53436 -> 
> 192.168.10.107:443)
>
> =INFO REPORT==== 30-Jul-2012::12:32:18 ===
> closing AMQP connection <0.31021.0> (192.168.10.157:53436 -> 
> 192.168.10.107:443)
> </java client>
>
> <.net>
> =INFO REPORT==== 30-Jul-2012::12:33:01 ===
> accepting AMQP connection <0.31385.0> ([FE80::9CF9:E6C8:AAA2:E95E]:57009 
> -> [FE80::DC90:8492:EDEA:F29F]:443)
>
> =ERROR REPORT==== 30-Jul-2012::12:33:01 ===
> ** State machine <0.31386.0> terminating 
> ** Last message in was {tcp,#Port<0.8637>,
>                             
> <<21,3,0,0,2,1,41,22,3,0,1,4,16,0,1,0,37,221,141,
>                               
> 253,17,32,217,19,107,158,219,100,18,72,74,101,
>                               
> 84,128,197,33,49,0,114,104,195,15,49,53,77,36,
>                               
> 199,164,103,80,172,225,140,196,41,237,52,94,192,
>                               
> 237,8,8,60,9,59,19,181,87,174,84,219,50,35,22,
>                               
> 84,239,236,14,94,95,81,214,243,162,206,220,188,
>                               
> 94,158,6,115,212,126,162,103,173,87,166,4,48,53,
>                               50,150,185,97,176,225,0,73,247,114,66,191,88,
>                               
> 143,29,252,2,155,92,204,233,244,199,52,122,55,
>                               
> 130,100,70,122,145,184,131,116,118,196,2,179,50,
>                               
> 61,68,124,192,145,169,147,42,49,126,32,69,25,36,
>                               
> 57,217,75,204,54,156,34,217,117,139,164,114,118,
>                               
> 251,62,106,242,208,111,184,117,189,71,224,239,
>                               
> 20,92,253,137,74,191,110,114,95,129,206,58,78,
>                               
> 141,136,190,206,53,7,146,104,216,241,137,28,137,
>                               
> 20,133,25,240,230,127,70,254,228,162,130,190,53,
>                               250,227,136,156,71,192,142,184,51,124,86,203,
>                               108,235,25,32,235,83,144,185,184,208,190,238,
>                               
> 133,1,253,184,101,162,231,40,109,144,35,218,161,
>                               
> 26,4,87,13,117,249,60,35,117,112,213,236,163,18,
>                               
> 128,61,187,20,3,0,0,1,1,22,3,0,0,60,186,95,216,
>                               
> 229,210,105,198,105,85,45,183,110,174,206,104,
>                               
> 133,35,254,108,108,57,13,137,138,151,100,178,23,
>                               
> 189,147,85,254,17,117,168,182,255,204,234,195,6,
>                               
> 0,248,93,238,47,172,80,5,153,138,161,91,231,83,
>                               251,42,192,80,179>>}
> ** When State == certify
> **      Data  == {state,server,
>                      {#Ref<0.0.0.50272>,<0.31385.0>},
>                      gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
>                      #Port<0.8637>,
>                      {ssl_options,[],verify_peer,
>                          {#Fun<ssl.3.54384637>,
>                           #Fun<rabbit_networking.0.89858908>},
>                          false,false,undefined,1,
>                          "C:/certstore/server/cert.pem",undefined,
>                          "C:/certstore/server/key.pem",undefined,undefined,
>                         
>  undefined,"C:/certstore/testca/cacert.pem",undefined,
>                          undefined,
>                          [<<0,57>>,
>                           <<0,56>>,
>                           <<0,53>>,
>                           <<0,22>>,
>                           <<0,19>>,
>                           <<0,10>>,
>                           <<0,51>>,
>                           <<0,50>>,
>                           <<0,47>>,
>                           <<0,5>>,
>                           <<0,4>>,
>                           <<0,21>>,
>                           <<0,9>>],
>                          #Fun<ssl.0.54384637>,true,268435456,false,[],
>                          undefined,false},
>                      {socket_options,binary,0,0,0,false},
>                      {connection_states,
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,0>>,
>                                  0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                                  undefined,undefined},
>                             
>  undefined,undefined,undefined,1,true,undefined,
>                              undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,5>>,
>                                  0,1,0,0,128,16,16,2,20,0,undefined,
>                                 
>  <<80,22,197,78,29,58,72,186,12,107,61,151,17,
>                                   
>  177,209,163,174,99,56,24,71,199,106,49,91,
>                                    186,189,199,117,68,234,215>>,
>                                 
>  <<80,22,197,77,73,19,16,200,132,120,47,224,
>                                   
>  160,79,3,106,44,134,25,30,170,200,151,96,89,
>                                    3,64,53,236,247,30,107>>,
>                                  undefined},
>                              undefined,undefined,undefined,undefined,true,
>                              undefined,undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,0>>,
>                                  0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                                  undefined,undefined},
>                             
>  undefined,undefined,undefined,4,true,undefined,
>                              undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,5>>,
>                                  0,1,0,0,128,16,16,2,20,0,undefined,
>                                 
>  <<80,22,197,78,29,58,72,186,12,107,61,151,17,
>                                   
>  177,209,163,174,99,56,24,71,199,106,49,91,
>                                    186,189,199,117,68,234,215>>,
>                                 
>  <<80,22,197,77,73,19,16,200,132,120,47,224,
>                                   
>  160,79,3,106,44,134,25,30,170,200,151,96,89,
>                                    3,64,53,236,247,30,107>>,
>                                  undefined},
>                              undefined,undefined,undefined,undefined,true,
>                              undefined,undefined}},
>                      [],<<>>,<<>>,
>                     
>  {{<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,
>                         
>  182,188,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,
>                         
>  0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,
>                         
>  8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>,
>                        <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,
>                          124,157,16,251,186,197,80,51,0,0,0,0,0,0,24,54,90,
>                         
>  252,231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,
>                         
>  48,15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,14,
>                         
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,
>                          0,0,0>>},
>                       
> {<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,
>                         
>  182,188,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,
>                         
>  0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,
>                         
>  8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>,
>                        <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,
>                          124,157,16,251,186,197,48,51,0,0,0,0,0,0,24,54,90,
>                         
>  252,231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,
>                         
>  48,15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                          38,0,0,0>>}},
>                      [],262221,
>                      {session,
>                         
>  <<32,144,115,251,110,148,117,72,252,193,200,232,234,
>                           
>  193,127,229,114,142,20,246,109,56,190,101,113,75,
>                            232,227,237,6,105,251>>,
>                          undefined,
>                         
>  <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,
>                           
>  9,42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,
>                           
>  6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,48,30,
>                           
>  23,13,49,50,48,55,51,48,49,50,53,54,52,54,90,23,13,
>                           
>  49,51,48,55,51,48,49,50,53,54,52,54,90,48,41,49,22,
>                           
>  48,20,6,3,85,4,3,12,13,114,105,111,111,118,101,114,
>                           
>  108,111,114,100,45,49,49,15,48,13,6,3,85,4,10,12,6,
>                           
>  115,101,114,118,101,114,48,130,1,34,48,13,6,9,42,
>                           
>  134,72,134,247,13,1,1,1,5,0,3,130,1,15,0,48,130,1,
>                           
>  10,2,130,1,1,0,163,99,255,119,11,217,190,17,106,102,
>                           
>  242,229,252,214,101,34,15,190,61,32,23,69,175,49,
>                           
>  141,78,38,16,202,80,88,96,12,88,193,17,57,226,60,
>                           
>  106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
>                           
>  104,157,167,92,224,120,142,28,102,218,176,245,195,
>                           
>  212,83,251,182,49,60,172,62,12,51,164,181,246,88,
>                           
>  136,122,208,186,96,220,62,57,137,103,4,26,67,30,132,
>                           
>  246,62,142,238,140,226,125,194,135,210,234,107,18,
>                           
>  128,76,113,52,34,199,134,34,140,80,84,35,205,142,
>                           
>  207,230,104,37,226,58,32,253,248,156,220,244,151,11,
>                           
>  22,43,188,14,177,227,4,188,97,24,83,79,40,16,150,
>                           
>  139,230,40,224,66,224,140,89,175,200,198,15,30,202,
>                           
>  248,69,32,159,182,234,202,82,247,91,75,129,24,242,
>                           
>  250,172,34,107,44,39,177,73,125,204,232,146,190,41,
>                           
>  239,6,154,165,197,220,227,183,190,17,114,215,232,
>                           
>  235,67,159,222,247,110,133,191,142,154,6,99,200,37,
>                           
>  59,120,252,161,54,91,223,191,85,104,9,121,14,184,
>                           
>  105,75,162,181,90,233,48,195,87,151,172,23,119,42,
>                           
>  211,2,3,130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,
>                           
>  3,85,29,19,4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,
>                           
>  48,19,6,3,85,29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,
>                           
>  48,13,6,9,42,134,72,134,247,13,1,1,5,5,0,3,130,1,1,
>                           
>  0,222,44,95,61,253,222,29,196,80,45,112,118,52,202,
>                           
>  249,227,153,3,154,114,189,224,23,172,222,204,213,89,
>                           
>  202,98,202,252,34,116,104,112,18,98,136,6,133,201,
>                           
>  165,220,4,130,95,247,113,200,31,36,105,22,27,24,197,
>                           
>  222,154,33,131,183,215,250,104,240,205,213,224,56,
>                           
>  201,76,226,250,166,136,68,224,195,215,149,224,255,
>                           
>  162,11,156,74,159,108,185,153,46,116,32,182,58,192,
>                           
>  42,77,78,249,153,29,40,105,199,192,192,14,230,169,
>                           
>  223,199,172,53,122,145,127,57,110,56,67,139,94,115,
>                           
>  57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,
>                           
>  134,211,89,211,47,183,79,202,162,128,196,45,44,85,
>                           
>  122,172,122,58,170,117,116,151,187,96,109,186,207,
>                           
>  188,10,72,138,17,2,60,52,236,72,68,203,229,144,164,
>                           
>  154,254,145,75,227,182,44,152,36,81,103,234,99,135,
>                           
>  223,62,152,94,109,109,202,223,114,90,71,131,48,180,
>                           
>  74,83,145,93,85,218,225,135,141,226,127,85,243,186,
>                           
>  10,50,216,220,110,91,48,135,32,83,253,201,62,47,163,
>                           
>  250,152,166,230,144,155,164,240,234,78,55,198,137,
>                            227,164,67,70>>,
>                          0,
>                          <<0,5>>,
>                          undefined,new,63510870781},
>                      274512,ssl_session_cache,
>                      {3,0},
>                      undefined,true,rsa,undefined,
>                      {'RSAPrivateKey','two-prime',
>                         
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                          65537,
>                         
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                         
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                         
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                         
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                         
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                         
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                          asn1_NOVALUE},
>                      {'DHParameter',
>                         
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                          2,asn1_NOVALUE},
>                      undefined,undefined,#Ref<0.0.0.50276>,
>                      {<0.31385.0>,#Ref<0.0.0.50285>},
>                      0,<<>>,true,
>                      {false,first},
>                      undefined,
>                      {[],[]},
>                      false,true}
> ** Reason for termination = 
> ** {function_clause,
>        [{ssl_connection,handle_alert,
>             [{alert,1,41,{"ssl_connection.erl",1678}},
>              certify,
>              {state,server,
>                  {#Ref<0.0.0.50272>,<0.31385.0>},
>                  gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
>                  #Port<0.8637>,
>                  {ssl_options,[],verify_peer,
>                     
>  {#Fun<ssl.3.54384637>,#Fun<rabbit_networking.0.89858908>},
>                     
>  false,false,undefined,1,"C:/certstore/server/cert.pem",
>                      undefined,"C:/certstore/server/key.pem",undefined,
>                      undefined,undefined,"C:/certstore/testca/cacert.pem",
>                      undefined,undefined,
>                      [<<0,57>>,
>                       <<0,56>>,
>                       <<0,53>>,
>                       <<0,22>>,
>                       <<0,19>>,
>                       <<0,10>>,
>                       <<0,51>>,
>                       <<0,50>>,
>                       <<0,47>>,
>                       <<0,5>>,
>                       <<0,4>>,
>                       <<0,21>>,
>                       <<0,9>>],
>                     
>  #Fun<ssl.0.54384637>,true,268435456,false,[],undefined,
>                      false},
>                  {socket_options,binary,0,0,0,false},
>                  {connection_states,
>                      {connection_state,
>                          {security_parameters,
>                              <<0,0>>,
>                              0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                              undefined,undefined},
>                          undefined,undefined,undefined,2,true,undefined,
>                          undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,5>>,
>                              0,1,0,0,128,16,16,2,20,0,undefined,
>                             
>  <<80,22,197,78,29,58,72,186,12,107,61,151,17,177,
>                               
>  209,163,174,99,56,24,71,199,106,49,91,186,189,
>                                199,117,68,234,215>>,
>                             
>  <<80,22,197,77,73,19,16,200,132,120,47,224,160,79,
>                               
>  3,106,44,134,25,30,170,200,151,96,89,3,64,53,
>                                236,247,30,107>>,
>                              undefined},
>                          undefined,undefined,undefined,undefined,true,
>                          undefined,undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,0>>,
>                              0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                              undefined,undefined},
>                          undefined,undefined,undefined,4,true,undefined,
>                          undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,5>>,
>                              0,1,0,0,128,16,16,2,20,0,undefined,
>                             
>  <<80,22,197,78,29,58,72,186,12,107,61,151,17,177,
>                               
>  209,163,174,99,56,24,71,199,106,49,91,186,189,
>                                199,117,68,234,215>>,
>                             
>  <<80,22,197,77,73,19,16,200,132,120,47,224,160,79,
>                               
>  3,106,44,134,25,30,170,200,151,96,89,3,64,53,
>                                236,247,30,107>>,
>                              undefined},
>                          undefined,undefined,undefined,undefined,true,
>                          undefined,undefined}},
>                  [],<<>>,<<>>,
>                 
>  {{<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,182,
>                     
>  188,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,
>                     
>  1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,
>                     
>  101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,42,0,0,0>>,
>                    <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,124,
>                      157,16,251,186,197,80,51,0,0,0,0,0,0,24,54,90,252,231,
>                     
>  192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,
>                     
>  4,3,19,8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>},
>                   
> {<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,182,
>                     
>  188,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,
>                     
>  1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,
>                     
>  101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,38,0,0,0>>,
>                    <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,124,
>                      157,16,251,186,197,48,51,0,0,0,0,0,0,24,54,90,252,231,
>                      192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,
>                     
>  85,4,3,19,8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>}},
>                  [{ssl_tls,undefined,22,
>                       {3,0},
>                       
> <<16,0,1,0,37,221,141,253,17,32,217,19,107,158,219,100,
>                         
> 18,72,74,101,84,128,197,33,49,0,114,104,195,15,49,53,
>                         
> 77,36,199,164,103,80,172,225,140,196,41,237,52,94,192,
>                         
> 237,8,8,60,9,59,19,181,87,174,84,219,50,35,22,84,239,
>                         
> 236,14,94,95,81,214,243,162,206,220,188,94,158,6,115,
>                         
> 212,126,162,103,173,87,166,4,48,53,50,150,185,97,176,
>                         225,0,73,247,114,66,191,88,143,29,252,2,155,92,204,
>                         
> 233,244,199,52,122,55,130,100,70,122,145,184,131,116,
>                         
> 118,196,2,179,50,61,68,124,192,145,169,147,42,49,126,
>                         
> 32,69,25,36,57,217,75,204,54,156,34,217,117,139,164,
>                         
> 114,118,251,62,106,242,208,111,184,117,189,71,224,239,
>                         
> 20,92,253,137,74,191,110,114,95,129,206,58,78,141,136,
>                         
> 190,206,53,7,146,104,216,241,137,28,137,20,133,25,240,
>                         
> 230,127,70,254,228,162,130,190,53,250,227,136,156,71,
>                         192,142,184,51,124,86,203,108,235,25,32,235,83,144,
>                         
> 185,184,208,190,238,133,1,253,184,101,162,231,40,109,
>                         
> 144,35,218,161,26,4,87,13,117,249,60,35,117,112,213,
>                         236,163,18,128,61,187>>},
>                   {ssl_tls,undefined,20,{3,0},<<1>>},
>                   {ssl_tls,undefined,22,
>                       {3,0},
>                       
> <<186,95,216,229,210,105,198,105,85,45,183,110,174,206,
>                         
> 104,133,35,254,108,108,57,13,137,138,151,100,178,23,
>                         189,147,85,254,17,117,168,182,255,204,234,195,6,0,
>                         
> 248,93,238,47,172,80,5,153,138,161,91,231,83,251,42,
>                         192,80,179>>}],
>                  262221,
>                  {session,
>                     
>  <<32,144,115,251,110,148,117,72,252,193,200,232,234,193,
>                       
>  127,229,114,142,20,246,109,56,190,101,113,75,232,227,
>                        237,6,105,251>>,
>                      undefined,
>                     
>  <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,9,
>                       
>  42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,6,3,85,
>                       
>  4,3,19,8,77,121,84,101,115,116,67,65,48,30,23,13,49,50,
>                       
>  48,55,51,48,49,50,53,54,52,54,90,23,13,49,51,48,55,51,
>                       
>  48,49,50,53,54,52,54,90,48,41,49,22,48,20,6,3,85,4,3,12,
>                       
>  13,114,105,111,111,118,101,114,108,111,114,100,45,49,49,
>                       
>  15,48,13,6,3,85,4,10,12,6,115,101,114,118,101,114,48,
>                       
>  130,1,34,48,13,6,9,42,134,72,134,247,13,1,1,1,5,0,3,130,
>                       
>  1,15,0,48,130,1,10,2,130,1,1,0,163,99,255,119,11,217,
>                       
>  190,17,106,102,242,229,252,214,101,34,15,190,61,32,23,
>                       
>  69,175,49,141,78,38,16,202,80,88,96,12,88,193,17,57,226,
>                       
>  60,106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
>                       
>  104,157,167,92,224,120,142,28,102,218,176,245,195,212,
>                       
>  83,251,182,49,60,172,62,12,51,164,181,246,88,136,122,
>                       
>  208,186,96,220,62,57,137,103,4,26,67,30,132,246,62,142,
>                       
>  238,140,226,125,194,135,210,234,107,18,128,76,113,52,34,
>                       
>  199,134,34,140,80,84,35,205,142,207,230,104,37,226,58,
>                       
>  32,253,248,156,220,244,151,11,22,43,188,14,177,227,4,
>                       
>  188,97,24,83,79,40,16,150,139,230,40,224,66,224,140,89,
>                       
>  175,200,198,15,30,202,248,69,32,159,182,234,202,82,247,
>                       
>  91,75,129,24,242,250,172,34,107,44,39,177,73,125,204,
>                       
>  232,146,190,41,239,6,154,165,197,220,227,183,190,17,114,
>                       
>  215,232,235,67,159,222,247,110,133,191,142,154,6,99,200,
>                       
>  37,59,120,252,161,54,91,223,191,85,104,9,121,14,184,105,
>                       
>  75,162,181,90,233,48,195,87,151,172,23,119,42,211,2,3,
>                       
>  130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,3,85,29,19,
>                       
>  4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,48,19,6,3,85,
>                       
>  29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,48,13,6,9,42,134,
>                       
>  72,134,247,13,1,1,5,5,0,3,130,1,1,0,222,44,95,61,253,
>                       
>  222,29,196,80,45,112,118,52,202,249,227,153,3,154,114,
>                       
>  189,224,23,172,222,204,213,89,202,98,202,252,34,116,104,
>                       
>  112,18,98,136,6,133,201,165,220,4,130,95,247,113,200,31,
>                       
>  36,105,22,27,24,197,222,154,33,131,183,215,250,104,240,
>                       
>  205,213,224,56,201,76,226,250,166,136,68,224,195,215,
>                       
>  149,224,255,162,11,156,74,159,108,185,153,46,116,32,182,
>                       
>  58,192,42,77,78,249,153,29,40,105,199,192,192,14,230,
>                       
>  169,223,199,172,53,122,145,127,57,110,56,67,139,94,115,
>                       
>  57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,134,
>                       
>  211,89,211,47,183,79,202,162,128,196,45,44,85,122,172,
>                       
>  122,58,170,117,116,151,187,96,109,186,207,188,10,72,138,
>                       
>  17,2,60,52,236,72,68,203,229,144,164,154,254,145,75,227,
>                       
>  182,44,152,36,81,103,234,99,135,223,62,152,94,109,109,
>                       
>  202,223,114,90,71,131,48,180,74,83,145,93,85,218,225,
>                       
>  135,141,226,127,85,243,186,10,50,216,220,110,91,48,135,
>                       
>  32,83,253,201,62,47,163,250,152,166,230,144,155,164,240,
>                        234,78,55,198,137,227,164,67,70>>,
>                      0,
>                      <<0,5>>,
>                      undefined,new,63510870781},
>                  274512,ssl_session_cache,
>                  {3,0},
>                  undefined,true,rsa,undefined,
>                  {'RSAPrivateKey','two-prime',
>                     
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                      65537,
>                     
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                     
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                     
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                     
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                     
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                     
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                      asn1_NOVALUE},
>                  {'DHParameter',
>                     
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                      2,asn1_NOVALUE},
>                  undefined,undefined,#Ref<0.0.0.50276>,
>                  {<0.31385.0>,#Ref<0.0.0.50285>},
>                  0,<<>>,true,
>                  {false,first},
>                  undefined,
>                  {[],[]},
>                  false,true}],
>             [{file,"ssl_connection.erl"},{line,2179}]},
>         {ssl_connection,handle_alerts,2,
>             [{file,"ssl_connection.erl"},{line,2177}]},
>         {gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,494}]},
>         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
>
> =ERROR REPORT==== 30-Jul-2012::12:33:01 ===
> error on AMQP connection <0.31385.0>: {ssl_upgrade_failure,
>                                        {{function_clause,
>                                          [{ssl_connection,handle_alert,
>                                            [{alert,1,41,
>                                              {"ssl_connection.erl",1678}},
>                                             certify,
>                                             {state,server,
>                                             
>  {#Ref<0.0.0.50272>,<0.31385.0>},
>                                             
>  gen_tcp,tcp,tcp_closed,tcp_error,
>                                              "localhost",443,#Port<0.8637>,
>                                              {ssl_options,[],verify_peer,
>                                               {#Fun<ssl.3.54384637>,
>                                               
>  #Fun<rabbit_networking.0.89858908>},
>                                               false,false,undefined,1,
>                                               
> "C:/certstore/server/cert.pem",
>                                               undefined,
>                                               
> "C:/certstore/server/key.pem",
>                                               
> undefined,undefined,undefined,
>                                               
> "C:/certstore/testca/cacert.pem",
>                                               undefined,undefined,
>                                               [<<0,57>>,
>                                                <<0,56>>,
>                                                <<0,53>>,
>                                                <<0,22>>,
>                                                <<0,19>>,
>                                                <<0,10>>,
>                                                <<0,51>>,
>                                                <<0,50>>,
>                                                <<0,47>>,
>                                                <<0,5>>,
>                                                <<0,4>>,
>                                                <<0,21>>,
>                                                <<0,9>>],
>                                               #Fun<ssl.0.54384637>,true,
>                                               268435456,false,[],undefined,
>                                               false},
>                                              {socket_options,binary,0,0,0,
>                                               false},
>                                              {connection_states,
>                                               {connection_state,
>                                                {security_parameters,
>                                                 <<0,0>>,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,undefined,
>                                                 
> undefined,undefined,undefined},
>                                               
>  undefined,undefined,undefined,
>                                                2,true,undefined,undefined},
>                                               {connection_state,
>                                                {security_parameters,
>                                                 <<0,5>>,
>                                                 0,1,0,0,128,16,16,2,20,0,
>                                                 undefined,
>                                                 
> <<80,22,197,78,29,58,72,186,12,
>                                                   
> 107,61,151,17,177,209,163,
>                                                   
> 174,99,56,24,71,199,106,49,
>                                                   
> 91,186,189,199,117,68,234,215>>,
>                                                 
> <<80,22,197,77,73,19,16,200,
>                                                   
> 132,120,47,224,160,79,3,106,
>                                                   
> 44,134,25,30,170,200,151,96,
>                                                   
> 89,3,64,53,236,247,30,107>>,
>                                                 undefined},
>                                               
>  undefined,undefined,undefined,
>                                                undefined,true,undefined,
>                                                undefined},
>                                               {connection_state,
>                                                {security_parameters,
>                                                 <<0,0>>,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,undefined,
>                                                 
> undefined,undefined,undefined},
>                                               
>  undefined,undefined,undefined,
>                                                4,true,undefined,undefined},
>                                               {connection_state,
>                                                {security_parameters,
>                                                 <<0,5>>,
>                                                 0,1,0,0,128,16,16,2,20,0,
>                                                 undefined,
>                                                 
> <<80,22,197,78,29,58,72,186,12,
>                                                   
> 107,61,151,17,177,209,163,
>                                                   
> 174,99,56,24,71,199,106,49,
>                                                   
> 91,186,189,199,117,68,234,215>>,
>                                                 
> <<80,22,197,77,73,19,16,200,
>                                                   
> 132,120,47,224,160,79,3,106,
>                                                   
> 44,134,25,30,170,200,151,96,
>                                                   
> 89,3,64,53,236,247,30,107>>,
>                                                 undefined},
>                                               
>  undefined,undefined,undefined,
>                                                undefined,true,undefined,
>                                                undefined}},
>                                              [],<<>>,<<>>,
>                                             
>  {{<<107,195,247,68,168,208,252,17,
>                                                 
>  160,186,113,157,135,198,182,
>                                                 
>  188,80,51,0,0,0,0,0,0,24,54,
>                                                 
>  90,252,231,192,148,13,0,0,27,
>                                                 
>  1,1,0,23,0,21,48,19,49,17,48,
>                                                 
>  15,6,3,85,4,3,19,8,77,121,84,
>                                                 
>  101,115,116,67,65,14,0,0,0,0,
>                                                 
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                  0,0,0,0,0,0,42,0,0,0>>,
>                                               
>  <<164,73,160,132,230,249,118,
>                                                 
>  68,17,25,226,99,197,97,124,
>                                                 
>  157,16,251,186,197,80,51,0,0,
>                                                 
>  0,0,0,0,24,54,90,252,231,192,
>                                                 
>  148,13,0,0,27,1,1,0,23,0,21,
>                                                 
>  48,19,49,17,48,15,6,3,85,4,3,
>                                                 
>  19,8,77,121,84,101,115,116,
>                                                 
>  67,65,14,0,0,0,0,0,0,0,0,0,0,
>                                                 
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                  0,42,0,0,0>>},
>                                               
> {<<107,195,247,68,168,208,252,17,
>                                                 
>  160,186,113,157,135,198,182,
>                                                 
>  188,48,51,0,0,0,0,0,0,24,54,
>                                                 
>  90,252,231,192,148,13,0,0,27,
>                                                 
>  1,1,0,23,0,21,48,19,49,17,48,
>                                                 
>  15,6,3,85,4,3,19,8,77,121,84,
>                                                 
>  101,115,116,67,65,0,0,0,0,0,0,
>                                                 
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                  0,0,0,0,0,38,0,0,0>>,
>                                               
>  <<164,73,160,132,230,249,118,
>                                                 
>  68,17,25,226,99,197,97,124,
>                                                 
>  157,16,251,186,197,48,51,0,
>                                                 
>  0,0,0,0,0,24,54,90,252,231,
>                                                 
>  192,148,13,0,0,27,1,1,0,23,
>                                                 
>  0,21,48,19,49,17,48,15,6,3,
>                                                  85,4,3,19,8,77,121,84,101,
>                                                 
>  115,116,67,65,0,0,0,0,0,0,0,
>                                                 
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                  0,0,0,0,0,38,0,0,0>>}},
>                                              [{ssl_tls,undefined,22,
>                                                {3,0},
>                                               
>  <<16,0,1,0,37,221,141,253,17,
>                                                 
>  32,217,19,107,158,219,100,18,
>                                                 
>  72,74,101,84,128,197,33,49,0,
>                                                 
>  114,104,195,15,49,53,77,36,
>                                                 
>  199,164,103,80,172,225,140,
>                                                 
>  196,41,237,52,94,192,237,8,8,
>                                                 
>  60,9,59,19,181,87,174,84,219,
>                                                 
>  50,35,22,84,239,236,14,94,95,
>                                                 
>  81,214,243,162,206,220,188,
>                                                 
>  94,158,6,115,212,126,162,103,
>                                                  173,87,166,4,48,53,50,150,
>                                                 
>  185,97,176,225,0,73,247,114,
>                                                 
>  66,191,88,143,29,252,2,155,
>                                                 
>  92,204,233,244,199,52,122,55,
>                                                 
>  130,100,70,122,145,184,131,
>                                                 
>  116,118,196,2,179,50,61,68,
>                                                  124,192,145,169,147,42,49,
>                                                  126,32,69,25,36,57,217,75,
>                                                  204,54,156,34,217,117,139,
>                                                 
>  164,114,118,251,62,106,242,
>                                                 
>  208,111,184,117,189,71,224,
>                                                 
>  239,20,92,253,137,74,191,110,
>                                                 
>  114,95,129,206,58,78,141,136,
>                                                 
>  190,206,53,7,146,104,216,241,
>                                                 
>  137,28,137,20,133,25,240,230,
>                                                 
>  127,70,254,228,162,130,190,
>                                                  53,250,227,136,156,71,192,
>                                                  142,184,51,124,86,203,108,
>                                                 
>  235,25,32,235,83,144,185,184,
>                                                  208,190,238,133,1,253,184,
>                                                  101,162,231,40,109,144,35,
>                                                 
>  218,161,26,4,87,13,117,249,
>                                                 
>  60,35,117,112,213,236,163,18,
>                                                  128,61,187>>},
>                                               {ssl_tls,undefined,20,
>                                                {3,0},
>                                                <<1>>},
>                                               {ssl_tls,undefined,22,
>                                                {3,0},
>                                               
>  <<186,95,216,229,210,105,198,
>                                                  105,85,45,183,110,174,206,
>                                                  104,133,35,254,108,108,57,
>                                                  13,137,138,151,100,178,23,
>                                                  189,147,85,254,17,117,168,
>                                                 
>  182,255,204,234,195,6,0,248,
>                                                 
>  93,238,47,172,80,5,153,138,
>                                                 
>  161,91,231,83,251,42,192,80,
>                                                  179>>}],
>                                              262221,
>                                              {session,
>                                               
> <<32,144,115,251,110,148,117,72,
>                                                 
> 252,193,200,232,234,193,127,
>                                                 
> 229,114,142,20,246,109,56,190,
>                                                 
> 101,113,75,232,227,237,6,105,
>                                                 251>>,
>                                               undefined,
>                                               
> <<48,130,2,230,48,130,1,206,160,
>                                                 
> 3,2,1,2,2,1,1,48,13,6,9,42,134,
>                                                 
> 72,134,247,13,1,1,5,5,0,48,19,
>                                                 
> 49,17,48,15,6,3,85,4,3,19,8,77,
>                                                 
> 121,84,101,115,116,67,65,48,30,
>                                                 
> 23,13,49,50,48,55,51,48,49,50,
>                                                 
> 53,54,52,54,90,23,13,49,51,48,
>                                                 
> 55,51,48,49,50,53,54,52,54,90,
>                                                 
> 48,41,49,22,48,20,6,3,85,4,3,
>                                                 
> 12,13,114,105,111,111,118,101,
>                                                 
> 114,108,111,114,100,45,49,49,
>                                                 
> 15,48,13,6,3,85,4,10,12,6,115,
>                                                 
> 101,114,118,101,114,48,130,1,
>                                                 
> 34,48,13,6,9,42,134,72,134,247,
>                                                 
> 13,1,1,1,5,0,3,130,1,15,0,48,
>                                                 
> 130,1,10,2,130,1,1,0,163,99,
>                                                 
> 255,119,11,217,190,17,106,102,
>                                                 
> 242,229,252,214,101,34,15,190,
>                                                 
> 61,32,23,69,175,49,141,78,38,
>                                                 
> 16,202,80,88,96,12,88,193,17,
>                                                 
> 57,226,60,106,35,93,184,216,
>                                                 
> 167,217,0,102,117,69,97,209,60,
>                                                 
> 27,104,157,167,92,224,120,142,
>                                                 
> 28,102,218,176,245,195,212,83,
>                                                 
> 251,182,49,60,172,62,12,51,164,
>                                                 
> 181,246,88,136,122,208,186,96,
>                                                 
> 220,62,57,137,103,4,26,67,30,
>                                                 
> 132,246,62,142,238,140,226,125,
>                                                 
> 194,135,210,234,107,18,128,76,
>                                                 
> 113,52,34,199,134,34,140,80,84,
>                                                 
> 35,205,142,207,230,104,37,226,
>                                                 
> 58,32,253,248,156,220,244,151,
>                                                 
> 11,22,43,188,14,177,227,4,188,
>                                                 
> 97,24,83,79,40,16,150,139,230,
>                                                 
> 40,224,66,224,140,89,175,200,
>                                                 
> 198,15,30,202,248,69,32,159,
>                                                 
> 182,234,202,82,247,91,75,129,
>                                                 
> 24,242,250,172,34,107,44,39,
>                                                 
> 177,73,125,204,232,146,190,41,
>                                                 
> 239,6,154,165,197,220,227,183,
>                                                 
> 190,17,114,215,232,235,67,159,
>                                                 
> 222,247,110,133,191,142,154,6,
>                                                 
> 99,200,37,59,120,252,161,54,91,
>                                                 
> 223,191,85,104,9,121,14,184,
>                                                 
> 105,75,162,181,90,233,48,195,
>                                                 
> 87,151,172,23,119,42,211,2,3,
>                                                 
> 130,228,61,83,2,3,1,0,1,163,47,
>                                                 
> 48,45,48,9,6,3,85,29,19,4,2,48,
>                                                 
> 0,48,11,6,3,85,29,15,4,4,3,2,5,
>                                                 
> 32,48,19,6,3,85,29,37,4,12,48,
>                                                 
> 10,6,8,43,6,1,5,5,7,3,1,48,13,
>                                                 
> 6,9,42,134,72,134,247,13,1,1,5,
>                                                 
> 5,0,3,130,1,1,0,222,44,95,61,
>                                                 
> 253,222,29,196,80,45,112,118,
>                                                 
> 52,202,249,227,153,3,154,114,
>                                                 
> 189,224,23,172,222,204,213,89,
>                                                 
> 202,98,202,252,34,116,104,112,
>                                                 
> 18,98,136,6,133,201,165,220,4,
>                                                 
> 130,95,247,113,200,31,36,105,
>                                                 
> 22,27,24,197,222,154,33,131,
>                                                 
> 183,215,250,104,240,205,213,
>                                                 
> 224,56,201,76,226,250,166,136,
>                                                 
> 68,224,195,215,149,224,255,162,
>                                                 
> 11,156,74,159,108,185,153,46,
>                                                 
> 116,32,182,58,192,42,77,78,249,
>                                                 
> 153,29,40,105,199,192,192,14,
>                                                 
> 230,169,223,199,172,53,122,145,
>                                                 
> 127,57,110,56,67,139,94,115,57,
>                                                 
> 55,116,11,212,76,212,44,180,72,
>                                                 
> 244,150,141,6,207,134,211,89,
>                                                 
> 211,47,183,79,202,162,128,196,
>                                                 
> 45,44,85,122,172,122,58,170,
>                                                 
> 117,116,151,187,96,109,186,207,
>                                                 
> 188,10,72,138,17,2,60,52,236,
>                                                 
> 72,68,203,229,144,164,154,254,
>                                                 
> 145,75,227,182,44,152,36,81,
>                                                 
> 103,234,99,135,223,62,152,94,
>                                                 
> 109,109,202,223,114,90,71,131,
>                                                 
> 48,180,74,83,145,93,85,218,225,
>                                                 
> 135,141,226,127,85,243,186,10,
>                                                 
> 50,216,220,110,91,48,135,32,83,
>                                                 
> 253,201,62,47,163,250,152,166,
>                                                 
> 230,144,155,164,240,234,78,55,
>                                                 198,137,227,164,67,70>>,
>                                               0,
>                                               <<0,5>>,
>                                               undefined,new,63510870781},
>                                              274512,ssl_session_cache,
>                                              {3,0},
>                                              undefined,true,rsa,undefined,
>                                              {'RSAPrivateKey','two-prime',
>                                               
> 20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                                               65537,
>                                               
> 15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                                               
> 147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                                               
> 139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                                               
> 83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                                               
> 118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                                               
> 129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                                               asn1_NOVALUE},
>                                              {'DHParameter',
>                                               
> 179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                                               2,asn1_NOVALUE},
>                                              undefined,undefined,
>                                              #Ref<0.0.0.50276>,
>                                             
>  {<0.31385.0>,#Ref<0.0.0.50285>},
>                                              0,<<>>,true,
>                                              {false,first},
>                                              undefined,
>                                              {[],[]},
>                                              false,true}],
>                                            [{file,"ssl_connection.erl"},
>                                             {line,2179}]},
>                                           {ssl_connection,handle_alerts,2,
>                                            [{file,"ssl_connection.erl"},
>                                             {line,2177}]},
>                                           {gen_fsm,handle_msg,7,
>                                           
>  [{file,"gen_fsm.erl"},{line,494}]},
>                                           {proc_lib,init_p_do_apply,3,
>                                            [{file,"proc_lib.erl"},
>                                             {line,227}]}]},
>                                         {gen_fsm,sync_send_all_state_event,
>                                          [<0.31386.0>,start,5000]}}}
> </.net>
>
> <java>
> =INFO REPORT==== 30-Jul-2012::12:36:39 ===
> accepting AMQP connection <0.342.1> (192.168.10.157:53463 -> 
> 192.168.10.107:443)
>
> =INFO REPORT==== 30-Jul-2012::12:36:40 ===
> closing AMQP connection <0.342.1> (192.168.10.157:53463 -> 
> 192.168.10.107:443)
> </java>
>
> <openssl>
> =INFO REPORT==== 30-Jul-2012::12:36:46 ===
> accepting AMQP connection <0.419.1> (192.168.10.157:53464 -> 
> 192.168.10.107:443)
>
> =ERROR REPORT==== 30-Jul-2012::12:36:51 ===
> closing AMQP connection <0.419.1> (192.168.10.157:53464 -> 
> 192.168.10.107:443):
> {bad_version,10,10,10,10}
> </openssl>
>
> <.net>
> =INFO REPORT==== 30-Jul-2012::12:43:58 ===
> accepting AMQP connection <0.3888.1> ([FE80::9CF9:E6C8:AAA2:E95E]:57040 -> 
> [FE80::DC90:8492:EDEA:F29F]:443)
>
> =ERROR REPORT==== 30-Jul-2012::12:43:58 ===
> ** State machine <0.3889.1> terminating 
> ** Last message in was {tcp,#Port<0.8968>,
>                             
> <<21,3,0,0,2,1,41,22,3,0,1,4,16,0,1,0,13,149,79,
>                               
> 68,242,219,55,33,132,16,78,131,203,216,134,82,
>                               
> 174,2,104,224,25,10,69,244,189,175,235,223,106,
>                               
> 45,186,155,55,99,237,33,164,234,55,53,210,3,243,
>                               
> 167,173,216,218,142,61,49,55,108,94,229,157,57,
>                               
> 65,152,150,104,244,4,248,47,159,188,27,115,22,
>                               
> 176,202,177,230,100,242,152,230,216,64,87,7,88,
>                               
> 206,101,137,11,61,214,170,45,226,106,24,133,184,
>                               53,215,16,85,173,26,76,22,71,236,163,220,163,
>                               
> 198,105,253,57,252,199,21,111,171,20,59,238,66,
>                               
> 255,32,129,232,2,110,140,48,215,124,215,101,193,
>                               
> 77,70,48,12,192,100,149,167,33,214,90,232,214,
>                               
> 188,72,182,193,115,137,185,198,135,213,168,214,
>                               
> 68,180,170,204,32,157,92,121,79,219,215,147,140,
>                               21,215,151,41,254,22,64,224,33,217,40,66,213,
>                               175,157,29,114,38,133,252,112,102,104,185,76,
>                               
> 231,12,236,87,176,162,138,29,15,168,220,218,231,
>                               
> 131,230,243,106,157,193,42,63,8,9,49,203,208,76,
>                               
> 250,159,76,187,179,2,183,83,199,70,237,161,192,
>                               221,12,4,228,227,107,196,161,231,171,118,233,
>                               
> 240,24,122,209,118,132,27,20,3,0,0,1,1,22,3,0,0,
>                               
> 60,202,190,24,80,89,105,254,68,94,146,20,33,11,
>                               8,52,82,120,141,183,75,210,23,34,29,85,28,45,
>                               
> 236,35,40,199,167,111,94,144,170,240,48,75,136,
>                               
> 116,63,197,216,54,26,61,171,134,80,82,163,26,75,
>                               50,152,15,181,218,235>>}
> ** When State == certify
> **      Data  == {state,server,
>                      {#Ref<0.0.0.58837>,<0.3888.1>},
>                      gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
>                      #Port<0.8968>,
>                      {ssl_options,[],verify_peer,
>                          {#Fun<ssl.3.54384637>,
>                           #Fun<rabbit_networking.0.89858908>},
>                          false,false,undefined,1,
>                          "C:/certstore/server/cert.pem",undefined,
>                          "C:/certstore/server/key.pem",undefined,undefined,
>                         
>  undefined,"C:/certstore/testca/cacert.pem",undefined,
>                          undefined,
>                          [<<0,57>>,
>                           <<0,56>>,
>                           <<0,53>>,
>                           <<0,22>>,
>                           <<0,19>>,
>                           <<0,10>>,
>                           <<0,51>>,
>                           <<0,50>>,
>                           <<0,47>>,
>                           <<0,5>>,
>                           <<0,4>>,
>                           <<0,21>>,
>                           <<0,9>>],
>                          #Fun<ssl.0.54384637>,true,268435456,false,[],
>                          undefined,false},
>                      {socket_options,binary,0,0,0,false},
>                      {connection_states,
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,0>>,
>                                  0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                                  undefined,undefined},
>                             
>  undefined,undefined,undefined,1,true,undefined,
>                              undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,5>>,
>                                  0,1,0,0,128,16,16,2,20,0,undefined,
>                                 
>  <<80,22,199,223,40,186,235,18,229,68,117,41,
>                                   
>  146,137,237,216,114,239,54,7,165,33,37,94,
>                                    57,110,228,3,62,87,25,210>>,
>                                 
>  <<80,22,199,222,169,174,5,18,190,32,21,236,
>                                   
>  199,246,168,19,117,78,229,208,48,132,253,20,
>                                    180,170,31,49,53,31,120,40>>,
>                                  undefined},
>                              undefined,undefined,undefined,undefined,true,
>                              undefined,undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,0>>,
>                                  0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                                  undefined,undefined},
>                             
>  undefined,undefined,undefined,4,true,undefined,
>                              undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,5>>,
>                                  0,1,0,0,128,16,16,2,20,0,undefined,
>                                 
>  <<80,22,199,223,40,186,235,18,229,68,117,41,
>                                   
>  146,137,237,216,114,239,54,7,165,33,37,94,
>                                    57,110,228,3,62,87,25,210>>,
>                                 
>  <<80,22,199,222,169,174,5,18,190,32,21,236,
>                                   
>  199,246,168,19,117,78,229,208,48,132,253,20,
>                                    180,170,31,49,53,31,120,40>>,
>                                  undefined},
>                              undefined,undefined,undefined,undefined,true,
>                              undefined,undefined}},
>                      [],<<>>,<<>>,
>                     
>  {{<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,
>                         
>  209,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,
>                         
>  27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,
>                         
>  121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>,
>                       
>  <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,128,
>                         
>  137,71,51,20,230,80,51,0,0,0,0,0,0,24,54,90,252,231,
>                         
>  192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,
>                         
>  3,85,4,3,19,8,77,121,84,101,115,116,67,65,14,0,0,0,0,
>                         
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>},
>                       
> {<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,
>                         
>  209,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,
>                         
>  27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,
>                         
>  121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>,
>                        <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,
>                         
>  128,137,71,51,20,230,48,51,0,0,0,0,0,0,24,54,90,252,
>                         
>  231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,
>                         
>  15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,0,0,
>                         
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,
>                          0,0,0>>}},
>                      [],262221,
>                      {session,
>                         
>  <<120,172,49,23,82,227,196,133,69,243,102,137,72,209,
>                           
>  109,38,212,150,216,237,102,171,222,27,8,24,94,130,
>                            47,132,52,140>>,
>                          undefined,
>                         
>  <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,
>                           
>  9,42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,
>                           
>  6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,48,30,
>                           
>  23,13,49,50,48,55,51,48,49,50,53,54,52,54,90,23,13,
>                           
>  49,51,48,55,51,48,49,50,53,54,52,54,90,48,41,49,22,
>                           
>  48,20,6,3,85,4,3,12,13,114,105,111,111,118,101,114,
>                           
>  108,111,114,100,45,49,49,15,48,13,6,3,85,4,10,12,6,
>                           
>  115,101,114,118,101,114,48,130,1,34,48,13,6,9,42,
>                           
>  134,72,134,247,13,1,1,1,5,0,3,130,1,15,0,48,130,1,
>                           
>  10,2,130,1,1,0,163,99,255,119,11,217,190,17,106,102,
>                           
>  242,229,252,214,101,34,15,190,61,32,23,69,175,49,
>                           
>  141,78,38,16,202,80,88,96,12,88,193,17,57,226,60,
>                           
>  106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
>                           
>  104,157,167,92,224,120,142,28,102,218,176,245,195,
>                           
>  212,83,251,182,49,60,172,62,12,51,164,181,246,88,
>                           
>  136,122,208,186,96,220,62,57,137,103,4,26,67,30,132,
>                           
>  246,62,142,238,140,226,125,194,135,210,234,107,18,
>                           
>  128,76,113,52,34,199,134,34,140,80,84,35,205,142,
>                           
>  207,230,104,37,226,58,32,253,248,156,220,244,151,11,
>                           
>  22,43,188,14,177,227,4,188,97,24,83,79,40,16,150,
>                           
>  139,230,40,224,66,224,140,89,175,200,198,15,30,202,
>                           
>  248,69,32,159,182,234,202,82,247,91,75,129,24,242,
>                           
>  250,172,34,107,44,39,177,73,125,204,232,146,190,41,
>                           
>  239,6,154,165,197,220,227,183,190,17,114,215,232,
>                           
>  235,67,159,222,247,110,133,191,142,154,6,99,200,37,
>                           
>  59,120,252,161,54,91,223,191,85,104,9,121,14,184,
>                           
>  105,75,162,181,90,233,48,195,87,151,172,23,119,42,
>                           
>  211,2,3,130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,
>                           
>  3,85,29,19,4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,
>                           
>  48,19,6,3,85,29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,
>                           
>  48,13,6,9,42,134,72,134,247,13,1,1,5,5,0,3,130,1,1,
>                           
>  0,222,44,95,61,253,222,29,196,80,45,112,118,52,202,
>                           
>  249,227,153,3,154,114,189,224,23,172,222,204,213,89,
>                           
>  202,98,202,252,34,116,104,112,18,98,136,6,133,201,
>                           
>  165,220,4,130,95,247,113,200,31,36,105,22,27,24,197,
>                           
>  222,154,33,131,183,215,250,104,240,205,213,224,56,
>                           
>  201,76,226,250,166,136,68,224,195,215,149,224,255,
>                           
>  162,11,156,74,159,108,185,153,46,116,32,182,58,192,
>                           
>  42,77,78,249,153,29,40,105,199,192,192,14,230,169,
>                           
>  223,199,172,53,122,145,127,57,110,56,67,139,94,115,
>                           
>  57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,
>                           
>  134,211,89,211,47,183,79,202,162,128,196,45,44,85,
>                           
>  122,172,122,58,170,117,116,151,187,96,109,186,207,
>                           
>  188,10,72,138,17,2,60,52,236,72,68,203,229,144,164,
>                           
>  154,254,145,75,227,182,44,152,36,81,103,234,99,135,
>                           
>  223,62,152,94,109,109,202,223,114,90,71,131,48,180,
>                           
>  74,83,145,93,85,218,225,135,141,226,127,85,243,186,
>                           
>  10,50,216,220,110,91,48,135,32,83,253,201,62,47,163,
>                           
>  250,152,166,230,144,155,164,240,234,78,55,198,137,
>                            227,164,67,70>>,
>                          0,
>                          <<0,5>>,
>                          undefined,new,63510871438},
>                      274512,ssl_session_cache,
>                      {3,0},
>                      undefined,true,rsa,undefined,
>                      {'RSAPrivateKey','two-prime',
>                         
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                          65537,
>                         
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                         
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                         
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                         
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                         
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                         
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                          asn1_NOVALUE},
>                      {'DHParameter',
>                         
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                          2,asn1_NOVALUE},
>                      undefined,undefined,#Ref<0.0.0.58841>,
>                      {<0.3888.1>,#Ref<0.0.0.58850>},
>                      0,<<>>,true,
>                      {false,first},
>                      undefined,
>                      {[],[]},
>                      false,true}
> ** Reason for termination = 
> ** {function_clause,
>        [{ssl_connection,handle_alert,
>             [{alert,1,41,{"ssl_connection.erl",1678}},
>              certify,
>              {state,server,
>                  {#Ref<0.0.0.58837>,<0.3888.1>},
>                  gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
>                  #Port<0.8968>,
>                  {ssl_options,[],verify_peer,
>                     
>  {#Fun<ssl.3.54384637>,#Fun<rabbit_networking.0.89858908>},
>                     
>  false,false,undefined,1,"C:/certstore/server/cert.pem",
>                      undefined,"C:/certstore/server/key.pem",undefined,
>                      undefined,undefined,"C:/certstore/testca/cacert.pem",
>                      undefined,undefined,
>                      [<<0,57>>,
>                       <<0,56>>,
>                       <<0,53>>,
>                       <<0,22>>,
>                       <<0,19>>,
>                       <<0,10>>,
>                       <<0,51>>,
>                       <<0,50>>,
>                       <<0,47>>,
>                       <<0,5>>,
>                       <<0,4>>,
>                       <<0,21>>,
>                       <<0,9>>],
>                     
>  #Fun<ssl.0.54384637>,true,268435456,false,[],undefined,
>                      false},
>                  {socket_options,binary,0,0,0,false},
>                  {connection_states,
>                      {connection_state,
>                          {security_parameters,
>                              <<0,0>>,
>                              0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                              undefined,undefined},
>                          undefined,undefined,undefined,2,true,undefined,
>                          undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,5>>,
>                              0,1,0,0,128,16,16,2,20,0,undefined,
>                             
>  <<80,22,199,223,40,186,235,18,229,68,117,41,146,
>                               
>  137,237,216,114,239,54,7,165,33,37,94,57,110,
>                                228,3,62,87,25,210>>,
>                             
>  <<80,22,199,222,169,174,5,18,190,32,21,236,199,
>                               
>  246,168,19,117,78,229,208,48,132,253,20,180,170,
>                                31,49,53,31,120,40>>,
>                              undefined},
>                          undefined,undefined,undefined,undefined,true,
>                          undefined,undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,0>>,
>                              0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                              undefined,undefined},
>                          undefined,undefined,undefined,4,true,undefined,
>                          undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,5>>,
>                              0,1,0,0,128,16,16,2,20,0,undefined,
>                             
>  <<80,22,199,223,40,186,235,18,229,68,117,41,146,
>                               
>  137,237,216,114,239,54,7,165,33,37,94,57,110,
>                                228,3,62,87,25,210>>,
>                             
>  <<80,22,199,222,169,174,5,18,190,32,21,236,199,
>                               
>  246,168,19,117,78,229,208,48,132,253,20,180,170,
>                                31,49,53,31,120,40>>,
>                              undefined},
>                          undefined,undefined,undefined,undefined,true,
>                          undefined,undefined}},
>                  [],<<>>,<<>>,
>                 
>  {{<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,209,
>                     
>  80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,1,1,
>                     
>  0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,101,
>                     
>  115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,42,0,0,0>>,
>                   
>  <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,128,137,
>                     
>  71,51,20,230,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,
>                     
>  13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,
>                     
>  8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>},
>                   
> {<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,209,
>                     
>  48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,1,1,
>                     
>  0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,101,
>                     
>  115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,38,0,0,0>>,
>                    <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,128,
>                     
>  137,71,51,20,230,48,51,0,0,0,0,0,0,24,54,90,252,231,192,
>                     
>  148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,
>                     
>  3,19,8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>}},
>                  [{ssl_tls,undefined,22,
>                       {3,0},
>                       
> <<16,0,1,0,13,149,79,68,242,219,55,33,132,16,78,131,203,
>                         
> 216,134,82,174,2,104,224,25,10,69,244,189,175,235,223,
>                         
> 106,45,186,155,55,99,237,33,164,234,55,53,210,3,243,
>                         
> 167,173,216,218,142,61,49,55,108,94,229,157,57,65,152,
>                         150,104,244,4,248,47,159,188,27,115,22,176,202,177,
>                         
> 230,100,242,152,230,216,64,87,7,88,206,101,137,11,61,
>                         
> 214,170,45,226,106,24,133,184,53,215,16,85,173,26,76,
>                         
> 22,71,236,163,220,163,198,105,253,57,252,199,21,111,
>                         
> 171,20,59,238,66,255,32,129,232,2,110,140,48,215,124,
>                         
> 215,101,193,77,70,48,12,192,100,149,167,33,214,90,232,
>                         
> 214,188,72,182,193,115,137,185,198,135,213,168,214,68,
>                         
> 180,170,204,32,157,92,121,79,219,215,147,140,21,215,
>                         
> 151,41,254,22,64,224,33,217,40,66,213,175,157,29,114,
>                         
> 38,133,252,112,102,104,185,76,231,12,236,87,176,162,
>                         
> 138,29,15,168,220,218,231,131,230,243,106,157,193,42,
>                         
> 63,8,9,49,203,208,76,250,159,76,187,179,2,183,83,199,
>                         
> 70,237,161,192,221,12,4,228,227,107,196,161,231,171,
>                         118,233,240,24,122,209,118,132,27>>},
>                   {ssl_tls,undefined,20,{3,0},<<1>>},
>                   {ssl_tls,undefined,22,
>                       {3,0},
>                       
> <<202,190,24,80,89,105,254,68,94,146,20,33,11,8,52,82,
>                         120,141,183,75,210,23,34,29,85,28,45,236,35,40,199,
>                         167,111,94,144,170,240,48,75,136,116,63,197,216,54,
>                         
> 26,61,171,134,80,82,163,26,75,50,152,15,181,218,235>>}],
>                  262221,
>                  {session,
>                     
>  <<120,172,49,23,82,227,196,133,69,243,102,137,72,209,109,
>                       
>  38,212,150,216,237,102,171,222,27,8,24,94,130,47,132,52,
>                        140>>,
>                      undefined,
>                     
>  <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,9,
>                       
>  42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,6,3,85,
>                       
>  4,3,19,8,77,121,84,101,115,116,67,65,48,30,23,13,49,50,
>                       
>  48,55,51,48,49,50,53,54,52,54,90,23,13,49,51,48,55,51,
>                       
>  48,49,50,53,54,52,54,90,48,41,49,22,48,20,6,3,85,4,3,12,
>                       
>  13,114,105,111,111,118,101,114,108,111,114,100,45,49,49,
>                       
>  15,48,13,6,3,85,4,10,12,6,115,101,114,118,101,114,48,
>                       
>  130,1,34,48,13,6,9,42,134,72,134,247,13,1,1,1,5,0,3,130,
>                       
>  1,15,0,48,130,1,10,2,130,1,1,0,163,99,255,119,11,217,
>                       
>  190,17,106,102,242,229,252,214,101,34,15,190,61,32,23,
>                       
>  69,175,49,141,78,38,16,202,80,88,96,12,88,193,17,57,226,
>                       
>  60,106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
>                       
>  104,157,167,92,224,120,142,28,102,218,176,245,195,212,
>                       
>  83,251,182,49,60,172,62,12,51,164,181,246,88,136,122,
>                       
>  208,186,96,220,62,57,137,103,4,26,67,30,132,246,62,142,
>                       
>  238,140,226,125,194,135,210,234,107,18,128,76,113,52,34,
>                       
>  199,134,34,140,80,84,35,205,142,207,230,104,37,226,58,
>                       
>  32,253,248,156,220,244,151,11,22,43,188,14,177,227,4,
>                       
>  188,97,24,83,79,40,16,150,139,230,40,224,66,224,140,89,
>                       
>  175,200,198,15,30,202,248,69,32,159,182,234,202,82,247,
>                       
>  91,75,129,24,242,250,172,34,107,44,39,177,73,125,204,
>                       
>  232,146,190,41,239,6,154,165,197,220,227,183,190,17,114,
>                       
>  215,232,235,67,159,222,247,110,133,191,142,154,6,99,200,
>                       
>  37,59,120,252,161,54,91,223,191,85,104,9,121,14,184,105,
>                       
>  75,162,181,90,233,48,195,87,151,172,23,119,42,211,2,3,
>                       
>  130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,3,85,29,19,
>                       
>  4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,48,19,6,3,85,
>                       
>  29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,48,13,6,9,42,134,
>                       
>  72,134,247,13,1,1,5,5,0,3,130,1,1,0,222,44,95,61,253,
>                       
>  222,29,196,80,45,112,118,52,202,249,227,153,3,154,114,
>                       
>  189,224,23,172,222,204,213,89,202,98,202,252,34,116,104,
>                       
>  112,18,98,136,6,133,201,165,220,4,130,95,247,113,200,31,
>                       
>  36,105,22,27,24,197,222,154,33,131,183,215,250,104,240,
>                       
>  205,213,224,56,201,76,226,250,166,136,68,224,195,215,
>                       
>  149,224,255,162,11,156,74,159,108,185,153,46,116,32,182,
>                       
>  58,192,42,77,78,249,153,29,40,105,199,192,192,14,230,
>                       
>  169,223,199,172,53,122,145,127,57,110,56,67,139,94,115,
>                       
>  57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,134,
>                       
>  211,89,211,47,183,79,202,162,128,196,45,44,85,122,172,
>                       
>  122,58,170,117,116,151,187,96,109,186,207,188,10,72,138,
>                       
>  17,2,60,52,236,72,68,203,229,144,164,154,254,145,75,227,
>                       
>  182,44,152,36,81,103,234,99,135,223,62,152,94,109,109,
>                       
>  202,223,114,90,71,131,48,180,74,83,145,93,85,218,225,
>                       
>  135,141,226,127,85,243,186,10,50,216,220,110,91,48,135,
>                       
>  32,83,253,201,62,47,163,250,152,166,230,144,155,164,240,
>                        234,78,55,198,137,227,164,67,70>>,
>                      0,
>                      <<0,5>>,
>                      undefined,new,63510871438},
>                  274512,ssl_session_cache,
>                  {3,0},
>                  undefined,true,rsa,undefined,
>                  {'RSAPrivateKey','two-prime',
>                     
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                      65537,
>                     
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                     
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                     
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                     
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                     
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                     
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                      asn1_NOVALUE},
>                  {'DHParameter',
>                     
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                      2,asn1_NOVALUE},
>                  undefined,undefined,#Ref<0.0.0.58841>,
>                  {<0.3888.1>,#Ref<0.0.0.58850>},
>                  0,<<>>,true,
>                  {false,first},
>                  undefined,
>                  {[],[]},
>                  false,true}],
>             [{file,"ssl_connection.erl"},{line,2179}]},
>         {ssl_connection,handle_alerts,2,
>             [{file,"ssl_connection.erl"},{line,2177}]},
>         {gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,494}]},
>         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
>
> =ERROR REPORT==== 30-Jul-2012::12:43:58 ===
> error on AMQP connection <0.3888.1>: {ssl_upgrade_failure,
>                                       {{function_clause,
>                                         [{ssl_connection,handle_alert,
>                                           [{alert,1,41,
>                                             {"ssl_connection.erl",1678}},
>                                            certify,
>                                            {state,server,
>                                             {#Ref<0.0.0.58837>,<0.3888.1>},
>                                             
> gen_tcp,tcp,tcp_closed,tcp_error,
>                                             "localhost",443,#Port<0.8968>,
>                                             {ssl_options,[],verify_peer,
>                                              {#Fun<ssl.3.54384637>,
>                                               
> #Fun<rabbit_networking.0.89858908>},
>                                              false,false,undefined,1,
>                                             
>  "C:/certstore/server/cert.pem",
>                                              undefined,
>                                              "C:/certstore/server/key.pem",
>                                              undefined,undefined,undefined,
>                                             
>  "C:/certstore/testca/cacert.pem",
>                                              undefined,undefined,
>                                              [<<0,57>>,
>                                               <<0,56>>,
>                                               <<0,53>>,
>                                               <<0,22>>,
>                                               <<0,19>>,
>                                               <<0,10>>,
>                                               <<0,51>>,
>                                               <<0,50>>,
>                                               <<0,47>>,
>                                               <<0,5>>,
>                                               <<0,4>>,
>                                               <<0,21>>,
>                                               <<0,9>>],
>                                              #Fun<ssl.0.54384637>,true,
>                                              268435456,false,[],undefined,
>                                              false},
>                                             {socket_options,binary,0,0,0,
>                                              false},
>                                             {connection_states,
>                                              {connection_state,
>                                               {security_parameters,
>                                                <<0,0>>,
>                                               
>  0,0,0,0,0,0,0,0,0,0,undefined,
>                                               
>  undefined,undefined,undefined},
>                                               
> undefined,undefined,undefined,2,
>                                               true,undefined,undefined},
>                                              {connection_state,
>                                               {security_parameters,
>                                                <<0,5>>,
>                                                0,1,0,0,128,16,16,2,20,0,
>                                                undefined,
>                                               
>  <<80,22,199,223,40,186,235,18,
>                                                 
>  229,68,117,41,146,137,237,216,
>                                                 
>  114,239,54,7,165,33,37,94,57,
>                                                  110,228,3,62,87,25,210>>,
>                                               
>  <<80,22,199,222,169,174,5,18,
>                                                 
>  190,32,21,236,199,246,168,19,
>                                                 
>  117,78,229,208,48,132,253,20,
>                                                 
>  180,170,31,49,53,31,120,40>>,
>                                                undefined},
>                                               
> undefined,undefined,undefined,
>                                               undefined,true,undefined,
>                                               undefined},
>                                              {connection_state,
>                                               {security_parameters,
>                                                <<0,0>>,
>                                               
>  0,0,0,0,0,0,0,0,0,0,undefined,
>                                               
>  undefined,undefined,undefined},
>                                               
> undefined,undefined,undefined,4,
>                                               true,undefined,undefined},
>                                              {connection_state,
>                                               {security_parameters,
>                                                <<0,5>>,
>                                                0,1,0,0,128,16,16,2,20,0,
>                                                undefined,
>                                               
>  <<80,22,199,223,40,186,235,18,
>                                                 
>  229,68,117,41,146,137,237,216,
>                                                 
>  114,239,54,7,165,33,37,94,57,
>                                                  110,228,3,62,87,25,210>>,
>                                               
>  <<80,22,199,222,169,174,5,18,
>                                                 
>  190,32,21,236,199,246,168,19,
>                                                 
>  117,78,229,208,48,132,253,20,
>                                                 
>  180,170,31,49,53,31,120,40>>,
>                                                undefined},
>                                               
> undefined,undefined,undefined,
>                                               undefined,true,undefined,
>                                               undefined}},
>                                             [],<<>>,<<>>,
>                                             
> {{<<31,32,233,180,58,12,212,253,
>                                                 
> 218,229,84,250,254,74,36,209,
>                                                 
> 80,51,0,0,0,0,0,0,24,54,90,252,
>                                                 
> 231,192,148,13,0,0,27,1,1,0,23,
>                                                 
> 0,21,48,19,49,17,48,15,6,3,85,
>                                                 
> 4,3,19,8,77,121,84,101,115,116,
>                                                 
> 67,65,14,0,0,0,0,0,0,0,0,0,0,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,
>                                                 0,0,0>>,
>                                               <<225,51,90,230,223,74,48,11,
>                                                 
> 240,71,28,159,160,170,128,137,
>                                                 
> 71,51,20,230,80,51,0,0,0,0,0,
>                                                 
> 0,24,54,90,252,231,192,148,13,
>                                                 
> 0,0,27,1,1,0,23,0,21,48,19,49,
>                                                 
> 17,48,15,6,3,85,4,3,19,8,77,
>                                                 
> 121,84,101,115,116,67,65,14,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,42,0,0,0>>},
>                                             
>  {<<31,32,233,180,58,12,212,253,
>                                                 
> 218,229,84,250,254,74,36,209,
>                                                 
> 48,51,0,0,0,0,0,0,24,54,90,252,
>                                                 
> 231,192,148,13,0,0,27,1,1,0,23,
>                                                 
> 0,21,48,19,49,17,48,15,6,3,85,
>                                                 
> 4,3,19,8,77,121,84,101,115,116,
>                                                 
> 67,65,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,
>                                                 0,0,0>>,
>                                               <<225,51,90,230,223,74,48,11,
>                                                 240,71,28,159,160,170,128,
>                                                 
> 137,71,51,20,230,48,51,0,0,0,
>                                                 0,0,0,24,54,90,252,231,192,
>                                                 
> 148,13,0,0,27,1,1,0,23,0,21,
>                                                 
> 48,19,49,17,48,15,6,3,85,4,3,
>                                                 19,8,77,121,84,101,115,116,
>                                                 
> 67,65,0,0,0,0,0,0,0,0,0,0,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                 0,38,0,0,0>>}},
>                                             [{ssl_tls,undefined,22,
>                                               {3,0},
>                                               
> <<16,0,1,0,13,149,79,68,242,219,
>                                                 
> 55,33,132,16,78,131,203,216,
>                                                 
> 134,82,174,2,104,224,25,10,69,
>                                                 244,189,175,235,223,106,45,
>                                                 
> 186,155,55,99,237,33,164,234,
>                                                 
> 55,53,210,3,243,167,173,216,
>                                                 
> 218,142,61,49,55,108,94,229,
>                                                 
> 157,57,65,152,150,104,244,4,
>                                                 
> 248,47,159,188,27,115,22,176,
>                                                 
> 202,177,230,100,242,152,230,
>                                                 
> 216,64,87,7,88,206,101,137,11,
>                                                 
> 61,214,170,45,226,106,24,133,
>                                                 
> 184,53,215,16,85,173,26,76,22,
>                                                 71,236,163,220,163,198,105,
>                                                 
> 253,57,252,199,21,111,171,20,
>                                                 59,238,66,255,32,129,232,2,
>                                                 110,140,48,215,124,215,101,
>                                                 
> 193,77,70,48,12,192,100,149,
>                                                 
> 167,33,214,90,232,214,188,72,
>                                                 
> 182,193,115,137,185,198,135,
>                                                 
> 213,168,214,68,180,170,204,32,
>                                                 
> 157,92,121,79,219,215,147,140,
>                                                 
> 21,215,151,41,254,22,64,224,
>                                                 
> 33,217,40,66,213,175,157,29,
>                                                 114,38,133,252,112,102,104,
>                                                 
> 185,76,231,12,236,87,176,162,
>                                                 
> 138,29,15,168,220,218,231,131,
>                                                 
> 230,243,106,157,193,42,63,8,9,
>                                                 
> 49,203,208,76,250,159,76,187,
>                                                 
> 179,2,183,83,199,70,237,161,
>                                                 
> 192,221,12,4,228,227,107,196,
>                                                 161,231,171,118,233,240,24,
>                                                 122,209,118,132,27>>},
>                                              {ssl_tls,undefined,20,
>                                               {3,0},
>                                               <<1>>},
>                                              {ssl_tls,undefined,22,
>                                               {3,0},
>                                               
> <<202,190,24,80,89,105,254,68,
>                                                 
> 94,146,20,33,11,8,52,82,120,
>                                                 141,183,75,210,23,34,29,85,
>                                                 
> 28,45,236,35,40,199,167,111,
>                                                 
> 94,144,170,240,48,75,136,116,
>                                                 
> 63,197,216,54,26,61,171,134,
>                                                 80,82,163,26,75,50,152,15,
>                                                 181,218,235>>}],
>                                             262221,
>                                             {session,
>                                             
>  <<120,172,49,23,82,227,196,133,69,
>                                               
>  243,102,137,72,209,109,38,212,
>                                               
>  150,216,237,102,171,222,27,8,24,
>                                                94,130,47,132,52,140>>,
>                                              undefined,
>                                             
>  <<48,130,2,230,48,130,1,206,160,3,
>                                               
>  2,1,2,2,1,1,48,13,6,9,42,134,72,
>                                               
>  134,247,13,1,1,5,5,0,48,19,49,
>                                               
>  17,48,15,6,3,85,4,3,19,8,77,121,
>                                               
>  84,101,115,116,67,65,48,30,23,
>                                               
>  13,49,50,48,55,51,48,49,50,53,
>                                               
>  54,52,54,90,23,13,49,51,48,55,
>                                               
>  51,48,49,50,53,54,52,54,90,48,
>                                               
>  41,49,22,48,20,6,3,85,4,3,12,13,
>                                               
>  114,105,111,111,118,101,114,108,
>                                               
>  111,114,100,45,49,49,15,48,13,6,
>                                               
>  3,85,4,10,12,6,115,101,114,118,
>                                               
>  101,114,48,130,1,34,48,13,6,9,
>                                               
>  42,134,72,134,247,13,1,1,1,5,0,
>                                               
>  3,130,1,15,0,48,130,1,10,2,130,
>                                               
>  1,1,0,163,99,255,119,11,217,190,
>                                               
>  17,106,102,242,229,252,214,101,
>                                               
>  34,15,190,61,32,23,69,175,49,
>                                               
>  141,78,38,16,202,80,88,96,12,88,
>                                               
>  193,17,57,226,60,106,35,93,184,
>                                               
>  216,167,217,0,102,117,69,97,209,
>                                               
>  60,27,104,157,167,92,224,120,
>                                               
>  142,28,102,218,176,245,195,212,
>                                               
>  83,251,182,49,60,172,62,12,51,
>                                               
>  164,181,246,88,136,122,208,186,
>                                               
>  96,220,62,57,137,103,4,26,67,30,
>                                               
>  132,246,62,142,238,140,226,125,
>                                               
>  194,135,210,234,107,18,128,76,
>                                               
>  113,52,34,199,134,34,140,80,84,
>                                               
>  35,205,142,207,230,104,37,226,
>                                               
>  58,32,253,248,156,220,244,151,
>                                               
>  11,22,43,188,14,177,227,4,188,
>                                               
>  97,24,83,79,40,16,150,139,230,
>                                               
>  40,224,66,224,140,89,175,200,
>                                               
>  198,15,30,202,248,69,32,159,182,
>                                               
>  234,202,82,247,91,75,129,24,242,
>                                               
>  250,172,34,107,44,39,177,73,125,
>                                               
>  204,232,146,190,41,239,6,154,
>                                               
>  165,197,220,227,183,190,17,114,
>                                               
>  215,232,235,67,159,222,247,110,
>                                               
>  133,191,142,154,6,99,200,37,59,
>                                               
>  120,252,161,54,91,223,191,85,
>                                               
>  104,9,121,14,184,105,75,162,181,
>                                               
>  90,233,48,195,87,151,172,23,119,
>                                               
>  42,211,2,3,130,228,61,83,2,3,1,
>                                               
>  0,1,163,47,48,45,48,9,6,3,85,29,
>                                               
>  19,4,2,48,0,48,11,6,3,85,29,15,
>                                               
>  4,4,3,2,5,32,48,19,6,3,85,29,37,
>                                               
>  4,12,48,10,6,8,43,6,1,5,5,7,3,1,
>                                               
>  48,13,6,9,42,134,72,134,247,13,
>                                               
>  1,1,5,5,0,3,130,1,1,0,222,44,95,
>                                               
>  61,253,222,29,196,80,45,112,118,
>                                               
>  52,202,249,227,153,3,154,114,
>                                               
>  189,224,23,172,222,204,213,89,
>                                               
>  202,98,202,252,34,116,104,112,
>                                               
>  18,98,136,6,133,201,165,220,4,
>                                               
>  130,95,247,113,200,31,36,105,22,
>                                               
>  27,24,197,222,154,33,131,183,
>                                               
>  215,250,104,240,205,213,224,56,
>                                               
>  201,76,226,250,166,136,68,224,
>                                               
>  195,215,149,224,255,162,11,156,
>                                               
>  74,159,108,185,153,46,116,32,
>                                               
>  182,58,192,42,77,78,249,153,29,
>                                               
>  40,105,199,192,192,14,230,169,
>                                               
>  223,199,172,53,122,145,127,57,
>                                               
>  110,56,67,139,94,115,57,55,116,
>                                               
>  11,212,76,212,44,180,72,244,150,
>                                               
>  141,6,207,134,211,89,211,47,183,
>                                               
>  79,202,162,128,196,45,44,85,122,
>                                               
>  172,122,58,170,117,116,151,187,
>                                               
>  96,109,186,207,188,10,72,138,17,
>                                               
>  2,60,52,236,72,68,203,229,144,
>                                               
>  164,154,254,145,75,227,182,44,
>                                               
>  152,36,81,103,234,99,135,223,62,
>                                               
>  152,94,109,109,202,223,114,90,
>                                               
>  71,131,48,180,74,83,145,93,85,
>                                               
>  218,225,135,141,226,127,85,243,
>                                               
>  186,10,50,216,220,110,91,48,135,
>                                               
>  32,83,253,201,62,47,163,250,152,
>                                               
>  166,230,144,155,164,240,234,78,
>                                                55,198,137,227,164,67,70>>,
>                                              0,
>                                              <<0,5>>,
>                                              undefined,new,63510871438},
>                                             274512,ssl_session_cache,
>                                             {3,0},
>                                             undefined,true,rsa,undefined,
>                                             {'RSAPrivateKey','two-prime',
>                                             
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                                              65537,
>                                             
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                                             
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                                             
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                                             
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                                             
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                                             
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                                              asn1_NOVALUE},
>                                             {'DHParameter',
>                                             
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                                              2,asn1_NOVALUE},
>                                             undefined,undefined,
>                                             #Ref<0.0.0.58841>,
>                                             {<0.3888.1>,#Ref<0.0.0.58850>},
>                                             0,<<>>,true,
>                                             {false,first},
>                                             undefined,
>                                             {[],[]},
>                                             false,true}],
>                                           [{file,"ssl_connection.erl"},
>                                            {line,2179}]},
>                                          {ssl_connection,handle_alerts,2,
>                                           [{file,"ssl_connection.erl"},
>                                            {line,2177}]},
>                                          {gen_fsm,handle_msg,7,
>                                           
> [{file,"gen_fsm.erl"},{line,494}]},
>                                          {proc_lib,init_p_do_apply,3,
>                                           [{file,"proc_lib.erl"},
>                                            {line,227}]}]},
>                                        {gen_fsm,sync_send_all_state_event,
>                                         [<0.3889.1>,start,5000]}}}
> </.net>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120731/74353e32/attachment.htm>

From monish.unni at gmail.com  Tue Jul 31 16:19:15 2012
From: monish.unni at gmail.com (cogitate)
Date: Tue, 31 Jul 2012 08:19:15 -0700 (PDT)
Subject: [rabbitmq-discuss] pika DLE, DLQ setup
Message-ID: <1343747955118-21135.post@n5.nabble.com>

i am trying to get dead-letter-exchange work with pika.
 steps below:
[0] s2.direct is an exchange that declares a dead-letter-exchange(DLE)
called s2.dlx ( rabbitmq )
[1] setup DLE consumer -  declares a DLQ (pyDlxQueue) binds to DLE(s2.dlx)
[2] setup a consumer listening to queue (EchoPayMe) binds to
s2.direct(exchange)
    queue EchoPayMe setup with arguments x-message-ttl=10 and DLE=s2.dlx
    the consumer also sleeps for 100 seconds ( to simulate
long-running/hanging service)
    the idea is a producer puts 10 messages in it's queue will only have
message 1 served,
    the rest of the messages should go to DLE(s2.dlx) when the DLE consumer
replies.
[3] the producer - publish messages to s2.direct exchange w/ rk="EchoPayMe"

the problem is no messages are received by the DLQ or get routed to the DLE
consumer.
the code for the DLE consumer, App consumer and App Producer in python/pika
below.

i am sure there's a fundamental error in what i am doing, cause, i can get
it working (somewhat) with java
code (the x-message-ttl = 10 doesn't really hold the messages for 10 ms only
before returning, so i am somewhat puzzled by that, but at least the DLE
consumer gets the message)

regards,
-monish


-- DLE Consumer--
connection = pika.BlockingConnection(pika.ConnectionParameters(
        host='localhost'))

channel = connection.channel()

result = channel.queue_declare(queue='pyDlxQueue')
queue_name = result.method.queue
channel.queue_bind(exchange='s2.dlx',
                   queue=queue_name)
                   #routing_key='pyDlxQueue')

def on_request(ch, method, props, body):
    print " [x] pyDLX Got %r " % (body,)
    response = "ERROR FROM pyDLX"

    ch.basic_publish(exchange='',
                     routing_key=props.reply_to,
                     properties=pika.BasicProperties(correlation_id = \
                                                     props.correlation_id),
                     body=str(response))
    ch.basic_ack(delivery_tag = method.delivery_tag)

channel.basic_consume(on_request, queue='pyDlxQueue',no_ack=False)

print " [x] pyDLX consumer started "
channel.start_consuming()

--  Consumer ---
connection = pika.BlockingConnection(pika.ConnectionParameters(
        host='localhost'))
channel = connection.channel()
result =
channel.queue_declare(queue='EchoPayMe',exclusive=False,auto_delete=True,durable=False,arguments={'x-dead-letter-exchange':'s2.dlx','x-message-ttl':10})

queue_name = result.method.queue
channel.queue_bind(exchange='s2.direct',
                   queue=queue_name,
                   routing_key='EchoPayMe')

def on_request(ch, method, props, body):
    sleep_time = 100
    print " [x] Got %r with corr_id=%r \n ======Sleeping for %s seconds
=============" % (body,props.correlation_id,sleep_time)
    time.sleep(sleep_time)
    response = "Got "+ body
    print "[x] Returning response %r" %(response,)

    ch.basic_publish(exchange='',
                     routing_key=props.reply_to,
                     properties=pika.BasicProperties(correlation_id = \
                                                     props.correlation_id),
                     body=str(response))
    ch.basic_ack(delivery_tag = method.delivery_tag)

#channel.basic_qos(prefetch_count=1)
channel.basic_consume(on_request, queue='EchoPayMe')

print " [x] Awaiting service requests"
channel.start_consuming()


-- Producer --
class EchoClient(object):
    def __init__(self):
        self.connection = pika.BlockingConnection(pika.ConnectionParameters(
                host='localhost'))
        self.channel = self.connection.channel()

    def call(self, request):
        self.response = None
        self.corr_id = str(uuid.uuid4())
        self.channel.basic_publish(exchange='s2.direct',
                                   routing_key='EchoPayMe',
                                   properties=pika.BasicProperties(
                                   correlation_id=self.corr_id,),
                                   body=request)

echoClient = EchoClient()
total_count = 10
for i in xrange(total_count):
    print " [x] Calling echoService %d"%(i,)
    request=str(i)
    echoClient.call(request)




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/pika-DLE-DLQ-setup-tp21135.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From noel.lysaght at gmail.com  Tue Jul 31 12:55:20 2012
From: noel.lysaght at gmail.com (Bigtoe)
Date: Tue, 31 Jul 2012 04:55:20 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ in a WCF webservice,
	model usage and performance
Message-ID: <733e1dca-3306-4865-a342-1b3265045523@googlegroups.com>

Hi Folks, I have a query about performance and IModel usage in a .NET WCF 
service. I posted this question on Stackoverflow<http://stackoverflow.com/questions/11414019/rabbitmq-in-a-wcf-webservice-model-usage-and-performance>  and 
received no answers. I was hoping that maybe you had some suggestions. I 
can repost the full question here the link is not appropriate.

Kind Regards
Noel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120731/274f3f84/attachment.htm>

From ward.mark at gmail.com  Tue Jul 31 17:54:14 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Tue, 31 Jul 2012 09:54:14 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
Message-ID: <4665d2e3-f27d-4890-b4fb-7099f3f1a4c1@googlegroups.com>

I also find that I am getting a crash report


=CRASH REPORT==== 31-Jul-2012::11:49:27 ===
  crasher:
    initial call: ssl_connection:init/1
    pid: <0.2005.0>
    registered_name: []
    exception exit: {function_clause,
                     [{ssl_connection,handle_alert,
                       [{alert,1,41,{"ssl_connection.erl",1678}},
                        certify,
                        {state,server,
                         {#Ref<0.0.0.3519>,<0.2004.0>},
                         gen_tcp,tcp,tcp_closed,tcp_error,"localhost",5673,
                         #Port<0.6927>,
                         {ssl_options,[],verify_peer,
                          {#Fun<ssl.3.54384637>,
                           #Fun<rabbit_networking.0.89858908>},
                          false,false,undefined,1,
                          "C:/certstore/server/cert.pem",undefined,
                          "C:/certstore/server/key.pem",undefined,undefined,
                          undefined,"C:/certstore/testca/cacert.pem",
                          undefined,undefined,
                          [<<0,57>>,
                           <<0,56>>,
                           <<0,53>>,
                           <<0,22>>,
                           <<0,19>>,
                           <<0,10>>,
                           <<0,51>>,
                           <<0,50>>,
                           <<0,47>>,
                           <<0,5>>,
                           <<0,4>>,
                           <<0,21>>,
                           <<0,9>>],
                          #Fun<ssl.0.54384637>,true,268435456,false,[],
                          undefined,false},
                         {socket_options,binary,0,0,0,false},
                         {connection_states,
                          {connection_state,
                           {security_parameters,
                            <<0,0>>,
                            
0,0,0,0,0,0,0,0,0,0,undefined,undefined,undefined,
                            undefined},
                           undefined,undefined,undefined,2,true,undefined,
                           undefined},
                          {connection_state,
                           {security_parameters,
                            <<0,5>>,
                            0,1,0,0,128,16,16,2,20,0,undefined,
                            
<<80,24,12,151,143,247,71,111,7,0,213,251,62,218,
                              72,70,107,116,90,10,167,84,229,82,238,143,106,
                              189,129,137,120,37>>,
                            
<<80,24,12,150,219,81,172,71,220,204,226,250,231,
                              59,67,23,118,214,197,159,94,52,26,141,239,220,
                              206,147,93,91,255,217>>,
                            undefined},
                           undefined,undefined,undefined,undefined,true,
                           undefined,undefined},
                          {connection_state,
                           {security_parameters,
                            <<0,0>>,
                            
0,0,0,0,0,0,0,0,0,0,undefined,undefined,undefined,
                            undefined},
                           undefined,undefined,undefined,4,true,undefined,
                           undefined},
                          {connection_state,
                           {security_parameters,
                            <<0,5>>,
                            0,1,0,0,128,16,16,2,20,0,undefined,
                            
<<80,24,12,151,143,247,71,111,7,0,213,251,62,218,
                              72,70,107,116,90,10,167,84,229,82,238,143,106,
                              189,129,137,120,37>>,
                            
<<80,24,12,150,219,81,172,71,220,204,226,250,231,
                              59,67,23,118,214,197,159,94,52,26,141,239,220,
                              206,147,93,91,255,217>>,
                            undefined},
                           undefined,undefined,undefined,undefined,true,
                           undefined,undefined}},
                         [],<<>>,<<>>,
                        
 {{<<147,168,51,52,111,93,167,12,15,169,148,216,173,16,
                            
 10,102,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,
                            
 13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,
                            
 4,3,19,8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,
                            
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>,
                          
 <<251,184,35,169,163,87,178,187,37,192,252,123,181,
                             129,164,233,200,200,54,89,80,51,0,0,0,0,0,0,24,
                            
 54,90,252,231,192,148,13,0,0,27,1,1,0,23,0,21,48,
                            
 19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,101,115,
                            
 116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                             0,0,0,0,0,0,0,42,0,0,0>>},
                          
{<<147,168,51,52,111,93,167,12,15,169,148,216,173,16,
                            
 10,102,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,
                            
 13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,
                            
 4,3,19,8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,
                            
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>,
                           <<251,184,35,169,163,87,178,187,37,192,252,123,
                            
 181,129,164,233,200,200,54,89,48,51,0,0,0,0,0,0,
                             24,54,90,252,231,192,148,13,0,0,27,1,1,0,23,0,
                             21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,
                            
 101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                             0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>}},
                         [{ssl_tls,undefined,22,
                           {3,0},
                          
 <<16,0,1,0,123,75,129,51,18,36,51,250,162,9,73,177,
                             52,106,237,214,56,123,147,150,203,2,26,71,116,
                            
 122,79,104,39,199,69,230,35,23,254,29,135,64,136,
                            
 87,161,232,129,151,212,7,191,52,179,17,65,95,109,
                            
 219,222,95,70,102,216,180,62,208,160,43,117,27,1,
                            
 73,131,12,188,48,223,245,43,47,112,188,186,68,2,
                             101,191,3,185,233,153,193,72,235,190,29,76,162,
                            
 200,244,109,194,114,28,135,67,184,147,18,69,109,
                             32,108,244,212,117,171,218,87,83,175,72,31,22,
                            
 135,62,163,193,37,10,249,223,215,202,130,241,117,
                            
 226,225,59,239,25,213,60,241,25,154,126,124,100,
                             81,12,64,167,116,74,197,202,141,0,158,167,122,
                            
 189,226,203,228,252,82,69,5,61,1,158,239,160,81,
                            
 8,233,89,54,175,65,210,178,97,231,204,44,120,183,
                            
 190,249,49,172,165,74,150,47,240,78,172,251,246,
                            
 36,247,233,167,54,192,233,175,248,165,92,148,47,
                             166,169,161,66,131,192,236,203,23,92,50,125,49,
                            
 166,67,157,26,234,14,57,134,61,129,223,83,243,62,
                             133,126,124,201,26,200,183,124,28,56,213,15,57,
                             121,145,117>>},
                          {ssl_tls,undefined,20,{3,0},<<1>>},
                          {ssl_tls,undefined,22,
                           {3,0},
                           <<47,189,30,31,35,90,113,124,16,218,73,230,25,40,
                             223,197,196,223,227,243,229,128,107,151,20,185,
                             221,86,224,218,42,117,89,43,185,8,185,8,26,138,
                             148,194,31,136,224,44,106,194,77,74,91,187,204,
                             203,139,41,95,73,175,166>>}],
                         262221,
                         {session,
                          
<<10,43,60,13,114,167,3,71,4,243,226,253,43,75,236,
                            
247,34,226,96,114,235,173,147,87,119,172,202,62,25,
                            28,225,172>>,
                          undefined,
                          
<<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,
                            
6,9,42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,
                            
15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,48,
                            
30,23,13,49,50,48,55,51,48,49,50,53,54,52,54,90,23,
                            
13,49,51,48,55,51,48,49,50,53,54,52,54,90,48,41,49,
                            
22,48,20,6,3,85,4,3,12,13,114,105,111,111,118,101,
                            
114,108,111,114,100,45,49,49,15,48,13,6,3,85,4,10,
                            
12,6,115,101,114,118,101,114,48,130,1,34,48,13,6,9,
                            
42,134,72,134,247,13,1,1,1,5,0,3,130,1,15,0,48,130,
                            
1,10,2,130,1,1,0,163,99,255,119,11,217,190,17,106,
                            
102,242,229,252,214,101,34,15,190,61,32,23,69,175,
                            
49,141,78,38,16,202,80,88,96,12,88,193,17,57,226,
                            
60,106,35,93,184,216,167,217,0,102,117,69,97,209,
                            60,27,104,157,167,92,224,120,142,28,102,218,176,
                            
245,195,212,83,251,182,49,60,172,62,12,51,164,181,
                            
246,88,136,122,208,186,96,220,62,57,137,103,4,26,
                            
67,30,132,246,62,142,238,140,226,125,194,135,210,
                            
234,107,18,128,76,113,52,34,199,134,34,140,80,84,
                            35,205,142,207,230,104,37,226,58,32,253,248,156,
                            
220,244,151,11,22,43,188,14,177,227,4,188,97,24,83,
                            
79,40,16,150,139,230,40,224,66,224,140,89,175,200,
                            
198,15,30,202,248,69,32,159,182,234,202,82,247,91,
                            
75,129,24,242,250,172,34,107,44,39,177,73,125,204,
                            
232,146,190,41,239,6,154,165,197,220,227,183,190,
                            
17,114,215,232,235,67,159,222,247,110,133,191,142,
                            154,6,99,200,37,59,120,252,161,54,91,223,191,85,
                            
104,9,121,14,184,105,75,162,181,90,233,48,195,87,
                            
151,172,23,119,42,211,2,3,130,228,61,83,2,3,1,0,1,
                            
163,47,48,45,48,9,6,3,85,29,19,4,2,48,0,48,11,6,3,
                            
85,29,15,4,4,3,2,5,32,48,19,6,3,85,29,37,4,12,48,
                            10,6,8,43,6,1,5,5,7,3,1,48,13,6,9,42,134,72,134,
                            
247,13,1,1,5,5,0,3,130,1,1,0,222,44,95,61,253,222,
                            
29,196,80,45,112,118,52,202,249,227,153,3,154,114,
                            189,224,23,172,222,204,213,89,202,98,202,252,34,
                            
116,104,112,18,98,136,6,133,201,165,220,4,130,95,
                            
247,113,200,31,36,105,22,27,24,197,222,154,33,131,
                            
183,215,250,104,240,205,213,224,56,201,76,226,250,
                            
166,136,68,224,195,215,149,224,255,162,11,156,74,
                            
159,108,185,153,46,116,32,182,58,192,42,77,78,249,
                            
153,29,40,105,199,192,192,14,230,169,223,199,172,
                            
53,122,145,127,57,110,56,67,139,94,115,57,55,116,
                            
11,212,76,212,44,180,72,244,150,141,6,207,134,211,
                            
89,211,47,183,79,202,162,128,196,45,44,85,122,172,
                            
122,58,170,117,116,151,187,96,109,186,207,188,10,
                            72,138,17,2,60,52,236,72,68,203,229,144,164,154,
                            
254,145,75,227,182,44,152,36,81,103,234,99,135,223,
                            
62,152,94,109,109,202,223,114,90,71,131,48,180,74,
                            
83,145,93,85,218,225,135,141,226,127,85,243,186,10,
                            
50,216,220,110,91,48,135,32,83,253,201,62,47,163,
                            
250,152,166,230,144,155,164,240,234,78,55,198,137,
                            227,164,67,70>>,
                          0,
                          <<0,5>>,
                          undefined,new,63510954567},
                         274512,ssl_session_cache,
                         {3,0},
                         undefined,true,rsa,undefined,
                         {'RSAPrivateKey','two-prime',
                          
20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
                          65537,
                          
15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
                          
147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
                          
139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
                          
83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
                          
118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
                          
129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
                          asn1_NOVALUE},
                         {'DHParameter',
                          
179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
                          2,asn1_NOVALUE},
                         undefined,undefined,#Ref<0.0.0.3523>,
                         {<0.2004.0>,#Ref<0.0.0.3539>},
                         0,<<>>,true,
                         {false,first},
                         undefined,
                         {[],[]},
                         false,true}],
                       [{file,"ssl_connection.erl"},{line,2179}]},
                      {ssl_connection,handle_alerts,2,
                       [{file,"ssl_connection.erl"},{line,2177}]},
                      
{gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,494}]},
                      {proc_lib,init_p_do_apply,3,
                       [{file,"proc_lib.erl"},{line,227}]}]}
      in function  gen_fsm:terminate/7 (gen_fsm.erl, line 611)
    ancestors: [ssl_connection_sup,ssl_sup,<0.225.0>]
    messages: []
    links: [<0.228.0>]
    dictionary: [{ssl_manager,ssl_manager}]
    trap_exit: false
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 2959
  neighbours:

=SUPERVISOR REPORT==== 31-Jul-2012::11:49:27 ===
     Supervisor: {local,ssl_connection_sup}
     Context:    child_terminated
     Reason:     {function_clause,
                  [{ssl_connection,handle_alert,
                    [{alert,1,41,{"ssl_connection.erl",1678}},
                     certify,
                     {state,server,
                      {#Ref<0.0.0.3519>,<0.2004.0>},
                      gen_tcp,tcp,tcp_closed,tcp_error,"localhost",5673,
                      #Port<0.6927>,
                      {ssl_options,[],verify_peer,
                       {#Fun<ssl.3.54384637>,
                        #Fun<rabbit_networking.0.89858908>},
                      
 false,false,undefined,1,"C:/certstore/server/cert.pem",
                       undefined,"C:/certstore/server/key.pem",undefined,
                       undefined,undefined,"C:/certstore/testca/cacert.pem",
                       undefined,undefined,
                       [<<0,57>>,
                        <<0,56>>,
                        <<0,53>>,
                        <<0,22>>,
                        <<0,19>>,
                        <<0,10>>,
                        <<0,51>>,
                        <<0,50>>,
                        <<0,47>>,
                        <<0,5>>,
                        <<0,4>>,
                        <<0,21>>,
                        <<0,9>>],
                      
 #Fun<ssl.0.54384637>,true,268435456,false,[],undefined,
                       false},
                      {socket_options,binary,0,0,0,false},
                      {connection_states,
                       {connection_state,
                        {security_parameters,
                         <<0,0>>,
                         0,0,0,0,0,0,0,0,0,0,undefined,undefined,undefined,
                         undefined},
                        undefined,undefined,undefined,2,true,undefined,
                        undefined},
                       {connection_state,
                        {security_parameters,
                         <<0,5>>,
                         0,1,0,0,128,16,16,2,20,0,undefined,
                        
 <<80,24,12,151,143,247,71,111,7,0,213,251,62,218,72,
                          
 70,107,116,90,10,167,84,229,82,238,143,106,189,129,
                           137,120,37>>,
                        
 <<80,24,12,150,219,81,172,71,220,204,226,250,231,59,
                          
 67,23,118,214,197,159,94,52,26,141,239,220,206,147,
                           93,91,255,217>>,
                         undefined},
                        undefined,undefined,undefined,undefined,true,
                        undefined,undefined},
                       {connection_state,
                        {security_parameters,
                         <<0,0>>,
                         0,0,0,0,0,0,0,0,0,0,undefined,undefined,undefined,
                         undefined},
                        undefined,undefined,undefined,4,true,undefined,
                        undefined},
                       {connection_state,
                        {security_parameters,
                         <<0,5>>,
                         0,1,0,0,128,16,16,2,20,0,undefined,
                        
 <<80,24,12,151,143,247,71,111,7,0,213,251,62,218,72,
                          
 70,107,116,90,10,167,84,229,82,238,143,106,189,129,
                           137,120,37>>,
                        
 <<80,24,12,150,219,81,172,71,220,204,226,250,231,59,
                          
 67,23,118,214,197,159,94,52,26,141,239,220,206,147,
                           93,91,255,217>>,
                         undefined},
                        undefined,undefined,undefined,undefined,true,
                        undefined,undefined}},
                      [],<<>>,<<>>,
                      
{{<<147,168,51,52,111,93,167,12,15,169,148,216,173,16,10,
                          
102,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,
                          
0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,
                          
77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,
                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>,
                        <<251,184,35,169,163,87,178,187,37,192,252,123,181,
                          129,164,233,200,200,54,89,80,51,0,0,0,0,0,0,24,54,
                          
90,252,231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,
                          17,48,15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,
                          
65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                          0,0,42,0,0,0>>},
                      
 {<<147,168,51,52,111,93,167,12,15,169,148,216,173,16,10,
                          
102,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,
                          
0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,
                          
77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,
                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>,
                        <<251,184,35,169,163,87,178,187,37,192,252,123,181,
                          129,164,233,200,200,54,89,48,51,0,0,0,0,0,0,24,54,
                          90,252,231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,
                          49,17,48,15,6,3,85,4,3,19,8,77,121,84,101,115,116,
                          67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                          0,0,0,0,38,0,0,0>>}},
                      [{ssl_tls,undefined,22,
                        {3,0},
                        
<<16,0,1,0,123,75,129,51,18,36,51,250,162,9,73,177,52,
                          106,237,214,56,123,147,150,203,2,26,71,116,122,79,
                          104,39,199,69,230,35,23,254,29,135,64,136,87,161,
                          232,129,151,212,7,191,52,179,17,65,95,109,219,222,
                          
95,70,102,216,180,62,208,160,43,117,27,1,73,131,12,
                          
188,48,223,245,43,47,112,188,186,68,2,101,191,3,185,
                          233,153,193,72,235,190,29,76,162,200,244,109,194,
                          
114,28,135,67,184,147,18,69,109,32,108,244,212,117,
                          
171,218,87,83,175,72,31,22,135,62,163,193,37,10,249,
                          223,215,202,130,241,117,226,225,59,239,25,213,60,
                          
241,25,154,126,124,100,81,12,64,167,116,74,197,202,
                          
141,0,158,167,122,189,226,203,228,252,82,69,5,61,1,
                          158,239,160,81,8,233,89,54,175,65,210,178,97,231,
                          
204,44,120,183,190,249,49,172,165,74,150,47,240,78,
                          172,251,246,36,247,233,167,54,192,233,175,248,165,
                          92,148,47,166,169,161,66,131,192,236,203,23,92,50,
                          125,49,166,67,157,26,234,14,57,134,61,129,223,83,
                          
243,62,133,126,124,201,26,200,183,124,28,56,213,15,
                          57,121,145,117>>},
                       {ssl_tls,undefined,20,{3,0},<<1>>},
                       {ssl_tls,undefined,22,
                        {3,0},
                        
<<47,189,30,31,35,90,113,124,16,218,73,230,25,40,223,
                          197,196,223,227,243,229,128,107,151,20,185,221,86,
                          
224,218,42,117,89,43,185,8,185,8,26,138,148,194,31,
                          136,224,44,106,194,77,74,91,187,204,203,139,41,95,
                          73,175,166>>}],
                      262221,
                      {session,
                      
 <<10,43,60,13,114,167,3,71,4,243,226,253,43,75,236,247,
                        
 34,226,96,114,235,173,147,87,119,172,202,62,25,28,225,
                         172>>,
                       undefined,
                      
 <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,9,
                        
 42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,6,3,
                        
 85,4,3,19,8,77,121,84,101,115,116,67,65,48,30,23,13,
                        
 49,50,48,55,51,48,49,50,53,54,52,54,90,23,13,49,51,48,
                        
 55,51,48,49,50,53,54,52,54,90,48,41,49,22,48,20,6,3,
                        
 85,4,3,12,13,114,105,111,111,118,101,114,108,111,114,
                         100,45,49,49,15,48,13,6,3,85,4,10,12,6,115,101,114,
                        
 118,101,114,48,130,1,34,48,13,6,9,42,134,72,134,247,
                        
 13,1,1,1,5,0,3,130,1,15,0,48,130,1,10,2,130,1,1,0,163,
                        
 99,255,119,11,217,190,17,106,102,242,229,252,214,101,
                        
 34,15,190,61,32,23,69,175,49,141,78,38,16,202,80,88,
                        
 96,12,88,193,17,57,226,60,106,35,93,184,216,167,217,0,
                        
 102,117,69,97,209,60,27,104,157,167,92,224,120,142,28,
                        
 102,218,176,245,195,212,83,251,182,49,60,172,62,12,51,
                        
 164,181,246,88,136,122,208,186,96,220,62,57,137,103,4,
                        
 26,67,30,132,246,62,142,238,140,226,125,194,135,210,
                        
 234,107,18,128,76,113,52,34,199,134,34,140,80,84,35,
                        
 205,142,207,230,104,37,226,58,32,253,248,156,220,244,
                        
 151,11,22,43,188,14,177,227,4,188,97,24,83,79,40,16,
                         150,139,230,40,224,66,224,140,89,175,200,198,15,30,
                        
 202,248,69,32,159,182,234,202,82,247,91,75,129,24,242,
                         250,172,34,107,44,39,177,73,125,204,232,146,190,41,
                        
 239,6,154,165,197,220,227,183,190,17,114,215,232,235,
                        
 67,159,222,247,110,133,191,142,154,6,99,200,37,59,120,
                        
 252,161,54,91,223,191,85,104,9,121,14,184,105,75,162,
                         181,90,233,48,195,87,151,172,23,119,42,211,2,3,130,
                        
 228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,3,85,29,19,4,
                        
 2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,48,19,6,3,85,
                         29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,48,13,6,9,42,
                        
 134,72,134,247,13,1,1,5,5,0,3,130,1,1,0,222,44,95,61,
                        
 253,222,29,196,80,45,112,118,52,202,249,227,153,3,154,
                        
 114,189,224,23,172,222,204,213,89,202,98,202,252,34,
                        
 116,104,112,18,98,136,6,133,201,165,220,4,130,95,247,
                        
 113,200,31,36,105,22,27,24,197,222,154,33,131,183,215,
                        
 250,104,240,205,213,224,56,201,76,226,250,166,136,68,
                        
 224,195,215,149,224,255,162,11,156,74,159,108,185,153,
                        
 46,116,32,182,58,192,42,77,78,249,153,29,40,105,199,
                        
 192,192,14,230,169,223,199,172,53,122,145,127,57,110,
                         56,67,139,94,115,57,55,116,11,212,76,212,44,180,72,
                         244,150,141,6,207,134,211,89,211,47,183,79,202,162,
                        
 128,196,45,44,85,122,172,122,58,170,117,116,151,187,
                        
 96,109,186,207,188,10,72,138,17,2,60,52,236,72,68,203,
                        
 229,144,164,154,254,145,75,227,182,44,152,36,81,103,
                         234,99,135,223,62,152,94,109,109,202,223,114,90,71,
                        
 131,48,180,74,83,145,93,85,218,225,135,141,226,127,85,
                        
 243,186,10,50,216,220,110,91,48,135,32,83,253,201,62,
                        
 47,163,250,152,166,230,144,155,164,240,234,78,55,198,
                         137,227,164,67,70>>,
                       0,
                       <<0,5>>,
                       undefined,new,63510954567},
                      274512,ssl_session_cache,
                      {3,0},
                      undefined,true,rsa,undefined,
                      {'RSAPrivateKey','two-prime',
                      
 20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
                       65537,
                      
 15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
                      
 147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
                      
 139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
                      
 83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
                      
 118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
                      
 129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
                       asn1_NOVALUE},
                      {'DHParameter',
                      
 179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
                       2,asn1_NOVALUE},
                      undefined,undefined,#Ref<0.0.0.3523>,
                      {<0.2004.0>,#Ref<0.0.0.3539>},
                      0,<<>>,true,
                      {false,first},
                      undefined,
                      {[],[]},
                      false,true}],
                    [{file,"ssl_connection.erl"},{line,2179}]},
                   {ssl_connection,handle_alerts,2,
                    [{file,"ssl_connection.erl"},{line,2177}]},
                   {gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,494}]},
                   {proc_lib,init_p_do_apply,3,
                    [{file,"proc_lib.erl"},{line,227}]}]}
     Offender:   [{pid,<0.2005.0>},
                  {name,undefined},
                  {mfargs,{ssl_connection,start_link,undefined}},
                  {restart_type,temporary},
                  {shutdown,4000},
                  {child_type,worker}]



On Monday, July 30, 2012 1:06:19 PM UTC-5, Mark Ward wrote:
>
> Hi,
>
> I might have the same problem as this post.  
> https://groups.google.com/forum/?fromgroups#!searchin/rabbitmq-discuss/ssl_upgrade_failure/rabbitmq-discuss/-hCUUIzi_9c/Pg6UQ3Lo1kMJ
>
> The setup
> Windows 2008r2
> rabbitmq server 2.8.4 
> Erlang R15B01
>
> .NET 4.0
> RabbitMQ client 2.8.4 (installed from NuGet)
>
> When I run my test .NET publisher I get the following exception "None of 
> the specified endpoints were reachable".
>
> I have gone through the SSL setup tutorial and I am stumped on why the 
> .NET client cannot connect or even fail out with an SSL trust exception.
> I have tested the connection to the server over SSL with the following 
> tools. openssl s_client and the Java example.  The openssl and the java 
> client connect and work.  It is the .NET client that I cannot get working 
> and it is the one I need to have working.
>
> I have setup my rabbitmq server to run the ssl over port 443 on my server. 
>  This you will find in my log output and I have specified in each of my 
> clients.
>
> The following is the C# client that I am trying to connect and publish 
> data into rabbitmq.  The client works when I am not attempting a SSL 
> connection.
>
> using System;
> using System.Collections.Generic;
> using System.Linq;
> using System.Text;
> using RabbitMQ.Client;
>
> namespace ProducerOne
> {
>     class Program
>     {
>         static void Main(string[] args)
>         {
>             string hostName = "riooverlord-1";
>             int port = 443;
>
>             int count;
>             if (args != null && args.Length == 1)
>                 count = int.Parse(args[0]);
>             else
>                 count = 1;
>
>             var connectionFactory = new ConnectionFactory();
>             connectionFactory.HostName = hostName;
>             connectionFactory.Port = port;
>             connectionFactory.Ssl.Enabled = true;
>             connectionFactory.Ssl.AcceptablePolicyErrors = 
> System.Net.Security.SslPolicyErrors.None;
>             
>             IConnection connection = connectionFactory.CreateConnection(); 
>             
>             IModel channel = connection.CreateModel();
>
>             for (int i = 0; i < count; i++)
>             {
>                 byte[] message = 
> Encoding.UTF8.GetBytes(string.Format("message {0} - {1}", i.ToString(), 
> DateTime.Now.ToString()));
>                 channel.BasicPublish(string.Empty, "QueueOne", null, 
> message);
>             }
>
>             channel.Close(); 
>             connection.Close();
>         }
>     }
> }
>
>
> The following is a dump of my rabbitMQ log file.  I have grouped the log 
> lines between xml like tags to group the different client attempts. 
>  openssl, java, and .NET
>
>
> =INFO REPORT==== 30-Jul-2012::11:28:01 ===
> Limiting to approx 924 file handles (829 sockets)
>
> =INFO REPORT==== 30-Jul-2012::11:28:01 ===
> Memory limit set to 409MB of 1023MB total.
>
> =INFO REPORT==== 30-Jul-2012::11:28:03 ===
> Disk free limit set to 953MB
>
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> Management plugin upgraded statistics to fine.
>
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>
> =WARNING REPORT==== 30-Jul-2012::11:28:04 ===
> msg_store_persistent: rebuilding indices from scratch
>
> =INFO REPORT==== 30-Jul-2012::11:28:04 ===
> started TCP Listener on [::]:5672
>
> =INFO REPORT==== 30-Jul-2012::11:28:05 ===
> started TCP Listener on 0.0.0.0:5672
>
> =INFO REPORT==== 30-Jul-2012::11:28:06 ===
> started SSL Listener on [::]:443
>
> =INFO REPORT==== 30-Jul-2012::11:28:06 ===
> started SSL Listener on 0.0.0.0:443
>
> =INFO REPORT==== 30-Jul-2012::11:28:07 ===
> Management agent started.
>
> =INFO REPORT==== 30-Jul-2012::11:28:08 ===
> Management plugin started. Port: 55672, path: /
>
> =INFO REPORT==== 30-Jul-2012::11:28:08 ===
> Statistics database started.
>
> <openssl s_client test>
> =INFO REPORT==== 30-Jul-2012::12:08:46 ===
> accepting AMQP connection <0.19749.0> (192.168.10.157:53209 -> 
> 192.168.10.107:443)
>
> =ERROR REPORT==== 30-Jul-2012::12:08:56 ===
> closing AMQP connection <0.19749.0> (192.168.10.157:53209 -> 
> 192.168.10.107:443):
> {handshake_timeout,handshake}
> </openssl s_client test> 
>
> <java client>
> =INFO REPORT==== 30-Jul-2012::12:30:58 ===
> accepting AMQP connection <0.30363.0> (192.168.10.157:53426 -> 
> 192.168.10.107:443)
>
> =INFO REPORT==== 30-Jul-2012::12:30:59 ===
> closing AMQP connection <0.30363.0> (192.168.10.157:53426 -> 
> 192.168.10.107:443)
> </java client>
>
> <java client>
> =INFO REPORT==== 30-Jul-2012::12:32:17 ===
> accepting AMQP connection <0.31021.0> (192.168.10.157:53436 -> 
> 192.168.10.107:443)
>
> =INFO REPORT==== 30-Jul-2012::12:32:18 ===
> closing AMQP connection <0.31021.0> (192.168.10.157:53436 -> 
> 192.168.10.107:443)
> </java client>
>
> <.net>
> =INFO REPORT==== 30-Jul-2012::12:33:01 ===
> accepting AMQP connection <0.31385.0> ([FE80::9CF9:E6C8:AAA2:E95E]:57009 
> -> [FE80::DC90:8492:EDEA:F29F]:443)
>
> =ERROR REPORT==== 30-Jul-2012::12:33:01 ===
> ** State machine <0.31386.0> terminating 
> ** Last message in was {tcp,#Port<0.8637>,
>                             
> <<21,3,0,0,2,1,41,22,3,0,1,4,16,0,1,0,37,221,141,
>                               
> 253,17,32,217,19,107,158,219,100,18,72,74,101,
>                               
> 84,128,197,33,49,0,114,104,195,15,49,53,77,36,
>                               
> 199,164,103,80,172,225,140,196,41,237,52,94,192,
>                               
> 237,8,8,60,9,59,19,181,87,174,84,219,50,35,22,
>                               
> 84,239,236,14,94,95,81,214,243,162,206,220,188,
>                               
> 94,158,6,115,212,126,162,103,173,87,166,4,48,53,
>                               50,150,185,97,176,225,0,73,247,114,66,191,88,
>                               
> 143,29,252,2,155,92,204,233,244,199,52,122,55,
>                               
> 130,100,70,122,145,184,131,116,118,196,2,179,50,
>                               
> 61,68,124,192,145,169,147,42,49,126,32,69,25,36,
>                               
> 57,217,75,204,54,156,34,217,117,139,164,114,118,
>                               
> 251,62,106,242,208,111,184,117,189,71,224,239,
>                               
> 20,92,253,137,74,191,110,114,95,129,206,58,78,
>                               
> 141,136,190,206,53,7,146,104,216,241,137,28,137,
>                               
> 20,133,25,240,230,127,70,254,228,162,130,190,53,
>                               250,227,136,156,71,192,142,184,51,124,86,203,
>                               108,235,25,32,235,83,144,185,184,208,190,238,
>                               
> 133,1,253,184,101,162,231,40,109,144,35,218,161,
>                               
> 26,4,87,13,117,249,60,35,117,112,213,236,163,18,
>                               
> 128,61,187,20,3,0,0,1,1,22,3,0,0,60,186,95,216,
>                               
> 229,210,105,198,105,85,45,183,110,174,206,104,
>                               
> 133,35,254,108,108,57,13,137,138,151,100,178,23,
>                               
> 189,147,85,254,17,117,168,182,255,204,234,195,6,
>                               
> 0,248,93,238,47,172,80,5,153,138,161,91,231,83,
>                               251,42,192,80,179>>}
> ** When State == certify
> **      Data  == {state,server,
>                      {#Ref<0.0.0.50272>,<0.31385.0>},
>                      gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
>                      #Port<0.8637>,
>                      {ssl_options,[],verify_peer,
>                          {#Fun<ssl.3.54384637>,
>                           #Fun<rabbit_networking.0.89858908>},
>                          false,false,undefined,1,
>                          "C:/certstore/server/cert.pem",undefined,
>                          "C:/certstore/server/key.pem",undefined,undefined,
>                         
>  undefined,"C:/certstore/testca/cacert.pem",undefined,
>                          undefined,
>                          [<<0,57>>,
>                           <<0,56>>,
>                           <<0,53>>,
>                           <<0,22>>,
>                           <<0,19>>,
>                           <<0,10>>,
>                           <<0,51>>,
>                           <<0,50>>,
>                           <<0,47>>,
>                           <<0,5>>,
>                           <<0,4>>,
>                           <<0,21>>,
>                           <<0,9>>],
>                          #Fun<ssl.0.54384637>,true,268435456,false,[],
>                          undefined,false},
>                      {socket_options,binary,0,0,0,false},
>                      {connection_states,
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,0>>,
>                                  0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                                  undefined,undefined},
>                             
>  undefined,undefined,undefined,1,true,undefined,
>                              undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,5>>,
>                                  0,1,0,0,128,16,16,2,20,0,undefined,
>                                 
>  <<80,22,197,78,29,58,72,186,12,107,61,151,17,
>                                   
>  177,209,163,174,99,56,24,71,199,106,49,91,
>                                    186,189,199,117,68,234,215>>,
>                                 
>  <<80,22,197,77,73,19,16,200,132,120,47,224,
>                                   
>  160,79,3,106,44,134,25,30,170,200,151,96,89,
>                                    3,64,53,236,247,30,107>>,
>                                  undefined},
>                              undefined,undefined,undefined,undefined,true,
>                              undefined,undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,0>>,
>                                  0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                                  undefined,undefined},
>                             
>  undefined,undefined,undefined,4,true,undefined,
>                              undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,5>>,
>                                  0,1,0,0,128,16,16,2,20,0,undefined,
>                                 
>  <<80,22,197,78,29,58,72,186,12,107,61,151,17,
>                                   
>  177,209,163,174,99,56,24,71,199,106,49,91,
>                                    186,189,199,117,68,234,215>>,
>                                 
>  <<80,22,197,77,73,19,16,200,132,120,47,224,
>                                   
>  160,79,3,106,44,134,25,30,170,200,151,96,89,
>                                    3,64,53,236,247,30,107>>,
>                                  undefined},
>                              undefined,undefined,undefined,undefined,true,
>                              undefined,undefined}},
>                      [],<<>>,<<>>,
>                     
>  {{<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,
>                         
>  182,188,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,
>                         
>  0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,
>                         
>  8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>,
>                        <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,
>                          124,157,16,251,186,197,80,51,0,0,0,0,0,0,24,54,90,
>                         
>  252,231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,
>                         
>  48,15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,14,
>                         
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,
>                          0,0,0>>},
>                       
> {<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,
>                         
>  182,188,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,
>                         
>  0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,
>                         
>  8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>,
>                        <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,
>                          124,157,16,251,186,197,48,51,0,0,0,0,0,0,24,54,90,
>                         
>  252,231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,
>                         
>  48,15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                          38,0,0,0>>}},
>                      [],262221,
>                      {session,
>                         
>  <<32,144,115,251,110,148,117,72,252,193,200,232,234,
>                           
>  193,127,229,114,142,20,246,109,56,190,101,113,75,
>                            232,227,237,6,105,251>>,
>                          undefined,
>                         
>  <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,
>                           
>  9,42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,
>                           
>  6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,48,30,
>                           
>  23,13,49,50,48,55,51,48,49,50,53,54,52,54,90,23,13,
>                           
>  49,51,48,55,51,48,49,50,53,54,52,54,90,48,41,49,22,
>                           
>  48,20,6,3,85,4,3,12,13,114,105,111,111,118,101,114,
>                           
>  108,111,114,100,45,49,49,15,48,13,6,3,85,4,10,12,6,
>                           
>  115,101,114,118,101,114,48,130,1,34,48,13,6,9,42,
>                           
>  134,72,134,247,13,1,1,1,5,0,3,130,1,15,0,48,130,1,
>                           
>  10,2,130,1,1,0,163,99,255,119,11,217,190,17,106,102,
>                           
>  242,229,252,214,101,34,15,190,61,32,23,69,175,49,
>                           
>  141,78,38,16,202,80,88,96,12,88,193,17,57,226,60,
>                           
>  106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
>                           
>  104,157,167,92,224,120,142,28,102,218,176,245,195,
>                           
>  212,83,251,182,49,60,172,62,12,51,164,181,246,88,
>                           
>  136,122,208,186,96,220,62,57,137,103,4,26,67,30,132,
>                           
>  246,62,142,238,140,226,125,194,135,210,234,107,18,
>                           
>  128,76,113,52,34,199,134,34,140,80,84,35,205,142,
>                           
>  207,230,104,37,226,58,32,253,248,156,220,244,151,11,
>                           
>  22,43,188,14,177,227,4,188,97,24,83,79,40,16,150,
>                           
>  139,230,40,224,66,224,140,89,175,200,198,15,30,202,
>                           
>  248,69,32,159,182,234,202,82,247,91,75,129,24,242,
>                           
>  250,172,34,107,44,39,177,73,125,204,232,146,190,41,
>                           
>  239,6,154,165,197,220,227,183,190,17,114,215,232,
>                           
>  235,67,159,222,247,110,133,191,142,154,6,99,200,37,
>                           
>  59,120,252,161,54,91,223,191,85,104,9,121,14,184,
>                           
>  105,75,162,181,90,233,48,195,87,151,172,23,119,42,
>                           
>  211,2,3,130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,
>                           
>  3,85,29,19,4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,
>                           
>  48,19,6,3,85,29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,
>                           
>  48,13,6,9,42,134,72,134,247,13,1,1,5,5,0,3,130,1,1,
>                           
>  0,222,44,95,61,253,222,29,196,80,45,112,118,52,202,
>                           
>  249,227,153,3,154,114,189,224,23,172,222,204,213,89,
>                           
>  202,98,202,252,34,116,104,112,18,98,136,6,133,201,
>                           
>  165,220,4,130,95,247,113,200,31,36,105,22,27,24,197,
>                           
>  222,154,33,131,183,215,250,104,240,205,213,224,56,
>                           
>  201,76,226,250,166,136,68,224,195,215,149,224,255,
>                           
>  162,11,156,74,159,108,185,153,46,116,32,182,58,192,
>                           
>  42,77,78,249,153,29,40,105,199,192,192,14,230,169,
>                           
>  223,199,172,53,122,145,127,57,110,56,67,139,94,115,
>                           
>  57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,
>                           
>  134,211,89,211,47,183,79,202,162,128,196,45,44,85,
>                           
>  122,172,122,58,170,117,116,151,187,96,109,186,207,
>                           
>  188,10,72,138,17,2,60,52,236,72,68,203,229,144,164,
>                           
>  154,254,145,75,227,182,44,152,36,81,103,234,99,135,
>                           
>  223,62,152,94,109,109,202,223,114,90,71,131,48,180,
>                           
>  74,83,145,93,85,218,225,135,141,226,127,85,243,186,
>                           
>  10,50,216,220,110,91,48,135,32,83,253,201,62,47,163,
>                           
>  250,152,166,230,144,155,164,240,234,78,55,198,137,
>                            227,164,67,70>>,
>                          0,
>                          <<0,5>>,
>                          undefined,new,63510870781},
>                      274512,ssl_session_cache,
>                      {3,0},
>                      undefined,true,rsa,undefined,
>                      {'RSAPrivateKey','two-prime',
>                         
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                          65537,
>                         
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                         
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                         
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                         
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                         
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                         
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                          asn1_NOVALUE},
>                      {'DHParameter',
>                         
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                          2,asn1_NOVALUE},
>                      undefined,undefined,#Ref<0.0.0.50276>,
>                      {<0.31385.0>,#Ref<0.0.0.50285>},
>                      0,<<>>,true,
>                      {false,first},
>                      undefined,
>                      {[],[]},
>                      false,true}
> ** Reason for termination = 
> ** {function_clause,
>        [{ssl_connection,handle_alert,
>             [{alert,1,41,{"ssl_connection.erl",1678}},
>              certify,
>              {state,server,
>                  {#Ref<0.0.0.50272>,<0.31385.0>},
>                  gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
>                  #Port<0.8637>,
>                  {ssl_options,[],verify_peer,
>                     
>  {#Fun<ssl.3.54384637>,#Fun<rabbit_networking.0.89858908>},
>                     
>  false,false,undefined,1,"C:/certstore/server/cert.pem",
>                      undefined,"C:/certstore/server/key.pem",undefined,
>                      undefined,undefined,"C:/certstore/testca/cacert.pem",
>                      undefined,undefined,
>                      [<<0,57>>,
>                       <<0,56>>,
>                       <<0,53>>,
>                       <<0,22>>,
>                       <<0,19>>,
>                       <<0,10>>,
>                       <<0,51>>,
>                       <<0,50>>,
>                       <<0,47>>,
>                       <<0,5>>,
>                       <<0,4>>,
>                       <<0,21>>,
>                       <<0,9>>],
>                     
>  #Fun<ssl.0.54384637>,true,268435456,false,[],undefined,
>                      false},
>                  {socket_options,binary,0,0,0,false},
>                  {connection_states,
>                      {connection_state,
>                          {security_parameters,
>                              <<0,0>>,
>                              0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                              undefined,undefined},
>                          undefined,undefined,undefined,2,true,undefined,
>                          undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,5>>,
>                              0,1,0,0,128,16,16,2,20,0,undefined,
>                             
>  <<80,22,197,78,29,58,72,186,12,107,61,151,17,177,
>                               
>  209,163,174,99,56,24,71,199,106,49,91,186,189,
>                                199,117,68,234,215>>,
>                             
>  <<80,22,197,77,73,19,16,200,132,120,47,224,160,79,
>                               
>  3,106,44,134,25,30,170,200,151,96,89,3,64,53,
>                                236,247,30,107>>,
>                              undefined},
>                          undefined,undefined,undefined,undefined,true,
>                          undefined,undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,0>>,
>                              0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                              undefined,undefined},
>                          undefined,undefined,undefined,4,true,undefined,
>                          undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,5>>,
>                              0,1,0,0,128,16,16,2,20,0,undefined,
>                             
>  <<80,22,197,78,29,58,72,186,12,107,61,151,17,177,
>                               
>  209,163,174,99,56,24,71,199,106,49,91,186,189,
>                                199,117,68,234,215>>,
>                             
>  <<80,22,197,77,73,19,16,200,132,120,47,224,160,79,
>                               
>  3,106,44,134,25,30,170,200,151,96,89,3,64,53,
>                                236,247,30,107>>,
>                              undefined},
>                          undefined,undefined,undefined,undefined,true,
>                          undefined,undefined}},
>                  [],<<>>,<<>>,
>                 
>  {{<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,182,
>                     
>  188,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,
>                     
>  1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,
>                     
>  101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,42,0,0,0>>,
>                    <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,124,
>                      157,16,251,186,197,80,51,0,0,0,0,0,0,24,54,90,252,231,
>                     
>  192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,
>                     
>  4,3,19,8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>},
>                   
> {<<107,195,247,68,168,208,252,17,160,186,113,157,135,198,182,
>                     
>  188,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,
>                     
>  1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,
>                     
>  101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,38,0,0,0>>,
>                    <<164,73,160,132,230,249,118,68,17,25,226,99,197,97,124,
>                      157,16,251,186,197,48,51,0,0,0,0,0,0,24,54,90,252,231,
>                      192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,
>                     
>  85,4,3,19,8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>}},
>                  [{ssl_tls,undefined,22,
>                       {3,0},
>                       
> <<16,0,1,0,37,221,141,253,17,32,217,19,107,158,219,100,
>                         
> 18,72,74,101,84,128,197,33,49,0,114,104,195,15,49,53,
>                         
> 77,36,199,164,103,80,172,225,140,196,41,237,52,94,192,
>                         
> 237,8,8,60,9,59,19,181,87,174,84,219,50,35,22,84,239,
>                         
> 236,14,94,95,81,214,243,162,206,220,188,94,158,6,115,
>                         
> 212,126,162,103,173,87,166,4,48,53,50,150,185,97,176,
>                         225,0,73,247,114,66,191,88,143,29,252,2,155,92,204,
>                         
> 233,244,199,52,122,55,130,100,70,122,145,184,131,116,
>                         
> 118,196,2,179,50,61,68,124,192,145,169,147,42,49,126,
>                         
> 32,69,25,36,57,217,75,204,54,156,34,217,117,139,164,
>                         
> 114,118,251,62,106,242,208,111,184,117,189,71,224,239,
>                         
> 20,92,253,137,74,191,110,114,95,129,206,58,78,141,136,
>                         
> 190,206,53,7,146,104,216,241,137,28,137,20,133,25,240,
>                         
> 230,127,70,254,228,162,130,190,53,250,227,136,156,71,
>                         192,142,184,51,124,86,203,108,235,25,32,235,83,144,
>                         
> 185,184,208,190,238,133,1,253,184,101,162,231,40,109,
>                         
> 144,35,218,161,26,4,87,13,117,249,60,35,117,112,213,
>                         236,163,18,128,61,187>>},
>                   {ssl_tls,undefined,20,{3,0},<<1>>},
>                   {ssl_tls,undefined,22,
>                       {3,0},
>                       
> <<186,95,216,229,210,105,198,105,85,45,183,110,174,206,
>                         
> 104,133,35,254,108,108,57,13,137,138,151,100,178,23,
>                         189,147,85,254,17,117,168,182,255,204,234,195,6,0,
>                         
> 248,93,238,47,172,80,5,153,138,161,91,231,83,251,42,
>                         192,80,179>>}],
>                  262221,
>                  {session,
>                     
>  <<32,144,115,251,110,148,117,72,252,193,200,232,234,193,
>                       
>  127,229,114,142,20,246,109,56,190,101,113,75,232,227,
>                        237,6,105,251>>,
>                      undefined,
>                     
>  <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,9,
>                       
>  42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,6,3,85,
>                       
>  4,3,19,8,77,121,84,101,115,116,67,65,48,30,23,13,49,50,
>                       
>  48,55,51,48,49,50,53,54,52,54,90,23,13,49,51,48,55,51,
>                       
>  48,49,50,53,54,52,54,90,48,41,49,22,48,20,6,3,85,4,3,12,
>                       
>  13,114,105,111,111,118,101,114,108,111,114,100,45,49,49,
>                       
>  15,48,13,6,3,85,4,10,12,6,115,101,114,118,101,114,48,
>                       
>  130,1,34,48,13,6,9,42,134,72,134,247,13,1,1,1,5,0,3,130,
>                       
>  1,15,0,48,130,1,10,2,130,1,1,0,163,99,255,119,11,217,
>                       
>  190,17,106,102,242,229,252,214,101,34,15,190,61,32,23,
>                       
>  69,175,49,141,78,38,16,202,80,88,96,12,88,193,17,57,226,
>                       
>  60,106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
>                       
>  104,157,167,92,224,120,142,28,102,218,176,245,195,212,
>                       
>  83,251,182,49,60,172,62,12,51,164,181,246,88,136,122,
>                       
>  208,186,96,220,62,57,137,103,4,26,67,30,132,246,62,142,
>                       
>  238,140,226,125,194,135,210,234,107,18,128,76,113,52,34,
>                       
>  199,134,34,140,80,84,35,205,142,207,230,104,37,226,58,
>                       
>  32,253,248,156,220,244,151,11,22,43,188,14,177,227,4,
>                       
>  188,97,24,83,79,40,16,150,139,230,40,224,66,224,140,89,
>                       
>  175,200,198,15,30,202,248,69,32,159,182,234,202,82,247,
>                       
>  91,75,129,24,242,250,172,34,107,44,39,177,73,125,204,
>                       
>  232,146,190,41,239,6,154,165,197,220,227,183,190,17,114,
>                       
>  215,232,235,67,159,222,247,110,133,191,142,154,6,99,200,
>                       
>  37,59,120,252,161,54,91,223,191,85,104,9,121,14,184,105,
>                       
>  75,162,181,90,233,48,195,87,151,172,23,119,42,211,2,3,
>                       
>  130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,3,85,29,19,
>                       
>  4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,48,19,6,3,85,
>                       
>  29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,48,13,6,9,42,134,
>                       
>  72,134,247,13,1,1,5,5,0,3,130,1,1,0,222,44,95,61,253,
>                       
>  222,29,196,80,45,112,118,52,202,249,227,153,3,154,114,
>                       
>  189,224,23,172,222,204,213,89,202,98,202,252,34,116,104,
>                       
>  112,18,98,136,6,133,201,165,220,4,130,95,247,113,200,31,
>                       
>  36,105,22,27,24,197,222,154,33,131,183,215,250,104,240,
>                       
>  205,213,224,56,201,76,226,250,166,136,68,224,195,215,
>                       
>  149,224,255,162,11,156,74,159,108,185,153,46,116,32,182,
>                       
>  58,192,42,77,78,249,153,29,40,105,199,192,192,14,230,
>                       
>  169,223,199,172,53,122,145,127,57,110,56,67,139,94,115,
>                       
>  57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,134,
>                       
>  211,89,211,47,183,79,202,162,128,196,45,44,85,122,172,
>                       
>  122,58,170,117,116,151,187,96,109,186,207,188,10,72,138,
>                       
>  17,2,60,52,236,72,68,203,229,144,164,154,254,145,75,227,
>                       
>  182,44,152,36,81,103,234,99,135,223,62,152,94,109,109,
>                       
>  202,223,114,90,71,131,48,180,74,83,145,93,85,218,225,
>                       
>  135,141,226,127,85,243,186,10,50,216,220,110,91,48,135,
>                       
>  32,83,253,201,62,47,163,250,152,166,230,144,155,164,240,
>                        234,78,55,198,137,227,164,67,70>>,
>                      0,
>                      <<0,5>>,
>                      undefined,new,63510870781},
>                  274512,ssl_session_cache,
>                  {3,0},
>                  undefined,true,rsa,undefined,
>                  {'RSAPrivateKey','two-prime',
>                     
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                      65537,
>                     
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                     
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                     
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                     
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                     
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                     
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                      asn1_NOVALUE},
>                  {'DHParameter',
>                     
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                      2,asn1_NOVALUE},
>                  undefined,undefined,#Ref<0.0.0.50276>,
>                  {<0.31385.0>,#Ref<0.0.0.50285>},
>                  0,<<>>,true,
>                  {false,first},
>                  undefined,
>                  {[],[]},
>                  false,true}],
>             [{file,"ssl_connection.erl"},{line,2179}]},
>         {ssl_connection,handle_alerts,2,
>             [{file,"ssl_connection.erl"},{line,2177}]},
>         {gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,494}]},
>         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
>
> =ERROR REPORT==== 30-Jul-2012::12:33:01 ===
> error on AMQP connection <0.31385.0>: {ssl_upgrade_failure,
>                                        {{function_clause,
>                                          [{ssl_connection,handle_alert,
>                                            [{alert,1,41,
>                                              {"ssl_connection.erl",1678}},
>                                             certify,
>                                             {state,server,
>                                             
>  {#Ref<0.0.0.50272>,<0.31385.0>},
>                                             
>  gen_tcp,tcp,tcp_closed,tcp_error,
>                                              "localhost",443,#Port<0.8637>,
>                                              {ssl_options,[],verify_peer,
>                                               {#Fun<ssl.3.54384637>,
>                                               
>  #Fun<rabbit_networking.0.89858908>},
>                                               false,false,undefined,1,
>                                               
> "C:/certstore/server/cert.pem",
>                                               undefined,
>                                               
> "C:/certstore/server/key.pem",
>                                               
> undefined,undefined,undefined,
>                                               
> "C:/certstore/testca/cacert.pem",
>                                               undefined,undefined,
>                                               [<<0,57>>,
>                                                <<0,56>>,
>                                                <<0,53>>,
>                                                <<0,22>>,
>                                                <<0,19>>,
>                                                <<0,10>>,
>                                                <<0,51>>,
>                                                <<0,50>>,
>                                                <<0,47>>,
>                                                <<0,5>>,
>                                                <<0,4>>,
>                                                <<0,21>>,
>                                                <<0,9>>],
>                                               #Fun<ssl.0.54384637>,true,
>                                               268435456,false,[],undefined,
>                                               false},
>                                              {socket_options,binary,0,0,0,
>                                               false},
>                                              {connection_states,
>                                               {connection_state,
>                                                {security_parameters,
>                                                 <<0,0>>,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,undefined,
>                                                 
> undefined,undefined,undefined},
>                                               
>  undefined,undefined,undefined,
>                                                2,true,undefined,undefined},
>                                               {connection_state,
>                                                {security_parameters,
>                                                 <<0,5>>,
>                                                 0,1,0,0,128,16,16,2,20,0,
>                                                 undefined,
>                                                 
> <<80,22,197,78,29,58,72,186,12,
>                                                   
> 107,61,151,17,177,209,163,
>                                                   
> 174,99,56,24,71,199,106,49,
>                                                   
> 91,186,189,199,117,68,234,215>>,
>                                                 
> <<80,22,197,77,73,19,16,200,
>                                                   
> 132,120,47,224,160,79,3,106,
>                                                   
> 44,134,25,30,170,200,151,96,
>                                                   
> 89,3,64,53,236,247,30,107>>,
>                                                 undefined},
>                                               
>  undefined,undefined,undefined,
>                                                undefined,true,undefined,
>                                                undefined},
>                                               {connection_state,
>                                                {security_parameters,
>                                                 <<0,0>>,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,undefined,
>                                                 
> undefined,undefined,undefined},
>                                               
>  undefined,undefined,undefined,
>                                                4,true,undefined,undefined},
>                                               {connection_state,
>                                                {security_parameters,
>                                                 <<0,5>>,
>                                                 0,1,0,0,128,16,16,2,20,0,
>                                                 undefined,
>                                                 
> <<80,22,197,78,29,58,72,186,12,
>                                                   
> 107,61,151,17,177,209,163,
>                                                   
> 174,99,56,24,71,199,106,49,
>                                                   
> 91,186,189,199,117,68,234,215>>,
>                                                 
> <<80,22,197,77,73,19,16,200,
>                                                   
> 132,120,47,224,160,79,3,106,
>                                                   
> 44,134,25,30,170,200,151,96,
>                                                   
> 89,3,64,53,236,247,30,107>>,
>                                                 undefined},
>                                               
>  undefined,undefined,undefined,
>                                                undefined,true,undefined,
>                                                undefined}},
>                                              [],<<>>,<<>>,
>                                             
>  {{<<107,195,247,68,168,208,252,17,
>                                                 
>  160,186,113,157,135,198,182,
>                                                 
>  188,80,51,0,0,0,0,0,0,24,54,
>                                                 
>  90,252,231,192,148,13,0,0,27,
>                                                 
>  1,1,0,23,0,21,48,19,49,17,48,
>                                                 
>  15,6,3,85,4,3,19,8,77,121,84,
>                                                 
>  101,115,116,67,65,14,0,0,0,0,
>                                                 
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                  0,0,0,0,0,0,42,0,0,0>>,
>                                               
>  <<164,73,160,132,230,249,118,
>                                                 
>  68,17,25,226,99,197,97,124,
>                                                 
>  157,16,251,186,197,80,51,0,0,
>                                                 
>  0,0,0,0,24,54,90,252,231,192,
>                                                 
>  148,13,0,0,27,1,1,0,23,0,21,
>                                                 
>  48,19,49,17,48,15,6,3,85,4,3,
>                                                 
>  19,8,77,121,84,101,115,116,
>                                                 
>  67,65,14,0,0,0,0,0,0,0,0,0,0,
>                                                 
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                  0,42,0,0,0>>},
>                                               
> {<<107,195,247,68,168,208,252,17,
>                                                 
>  160,186,113,157,135,198,182,
>                                                 
>  188,48,51,0,0,0,0,0,0,24,54,
>                                                 
>  90,252,231,192,148,13,0,0,27,
>                                                 
>  1,1,0,23,0,21,48,19,49,17,48,
>                                                 
>  15,6,3,85,4,3,19,8,77,121,84,
>                                                 
>  101,115,116,67,65,0,0,0,0,0,0,
>                                                 
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                  0,0,0,0,0,38,0,0,0>>,
>                                               
>  <<164,73,160,132,230,249,118,
>                                                 
>  68,17,25,226,99,197,97,124,
>                                                 
>  157,16,251,186,197,48,51,0,
>                                                 
>  0,0,0,0,0,24,54,90,252,231,
>                                                 
>  192,148,13,0,0,27,1,1,0,23,
>                                                 
>  0,21,48,19,49,17,48,15,6,3,
>                                                  85,4,3,19,8,77,121,84,101,
>                                                 
>  115,116,67,65,0,0,0,0,0,0,0,
>                                                 
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                  0,0,0,0,0,38,0,0,0>>}},
>                                              [{ssl_tls,undefined,22,
>                                                {3,0},
>                                               
>  <<16,0,1,0,37,221,141,253,17,
>                                                 
>  32,217,19,107,158,219,100,18,
>                                                 
>  72,74,101,84,128,197,33,49,0,
>                                                 
>  114,104,195,15,49,53,77,36,
>                                                 
>  199,164,103,80,172,225,140,
>                                                 
>  196,41,237,52,94,192,237,8,8,
>                                                 
>  60,9,59,19,181,87,174,84,219,
>                                                 
>  50,35,22,84,239,236,14,94,95,
>                                                 
>  81,214,243,162,206,220,188,
>                                                 
>  94,158,6,115,212,126,162,103,
>                                                  173,87,166,4,48,53,50,150,
>                                                 
>  185,97,176,225,0,73,247,114,
>                                                 
>  66,191,88,143,29,252,2,155,
>                                                 
>  92,204,233,244,199,52,122,55,
>                                                 
>  130,100,70,122,145,184,131,
>                                                 
>  116,118,196,2,179,50,61,68,
>                                                  124,192,145,169,147,42,49,
>                                                  126,32,69,25,36,57,217,75,
>                                                  204,54,156,34,217,117,139,
>                                                 
>  164,114,118,251,62,106,242,
>                                                 
>  208,111,184,117,189,71,224,
>                                                 
>  239,20,92,253,137,74,191,110,
>                                                 
>  114,95,129,206,58,78,141,136,
>                                                 
>  190,206,53,7,146,104,216,241,
>                                                 
>  137,28,137,20,133,25,240,230,
>                                                 
>  127,70,254,228,162,130,190,
>                                                  53,250,227,136,156,71,192,
>                                                  142,184,51,124,86,203,108,
>                                                 
>  235,25,32,235,83,144,185,184,
>                                                  208,190,238,133,1,253,184,
>                                                  101,162,231,40,109,144,35,
>                                                 
>  218,161,26,4,87,13,117,249,
>                                                 
>  60,35,117,112,213,236,163,18,
>                                                  128,61,187>>},
>                                               {ssl_tls,undefined,20,
>                                                {3,0},
>                                                <<1>>},
>                                               {ssl_tls,undefined,22,
>                                                {3,0},
>                                               
>  <<186,95,216,229,210,105,198,
>                                                  105,85,45,183,110,174,206,
>                                                  104,133,35,254,108,108,57,
>                                                  13,137,138,151,100,178,23,
>                                                  189,147,85,254,17,117,168,
>                                                 
>  182,255,204,234,195,6,0,248,
>                                                 
>  93,238,47,172,80,5,153,138,
>                                                 
>  161,91,231,83,251,42,192,80,
>                                                  179>>}],
>                                              262221,
>                                              {session,
>                                               
> <<32,144,115,251,110,148,117,72,
>                                                 
> 252,193,200,232,234,193,127,
>                                                 
> 229,114,142,20,246,109,56,190,
>                                                 
> 101,113,75,232,227,237,6,105,
>                                                 251>>,
>                                               undefined,
>                                               
> <<48,130,2,230,48,130,1,206,160,
>                                                 
> 3,2,1,2,2,1,1,48,13,6,9,42,134,
>                                                 
> 72,134,247,13,1,1,5,5,0,48,19,
>                                                 
> 49,17,48,15,6,3,85,4,3,19,8,77,
>                                                 
> 121,84,101,115,116,67,65,48,30,
>                                                 
> 23,13,49,50,48,55,51,48,49,50,
>                                                 
> 53,54,52,54,90,23,13,49,51,48,
>                                                 
> 55,51,48,49,50,53,54,52,54,90,
>                                                 
> 48,41,49,22,48,20,6,3,85,4,3,
>                                                 
> 12,13,114,105,111,111,118,101,
>                                                 
> 114,108,111,114,100,45,49,49,
>                                                 
> 15,48,13,6,3,85,4,10,12,6,115,
>                                                 
> 101,114,118,101,114,48,130,1,
>                                                 
> 34,48,13,6,9,42,134,72,134,247,
>                                                 
> 13,1,1,1,5,0,3,130,1,15,0,48,
>                                                 
> 130,1,10,2,130,1,1,0,163,99,
>                                                 
> 255,119,11,217,190,17,106,102,
>                                                 
> 242,229,252,214,101,34,15,190,
>                                                 
> 61,32,23,69,175,49,141,78,38,
>                                                 
> 16,202,80,88,96,12,88,193,17,
>                                                 
> 57,226,60,106,35,93,184,216,
>                                                 
> 167,217,0,102,117,69,97,209,60,
>                                                 
> 27,104,157,167,92,224,120,142,
>                                                 
> 28,102,218,176,245,195,212,83,
>                                                 
> 251,182,49,60,172,62,12,51,164,
>                                                 
> 181,246,88,136,122,208,186,96,
>                                                 
> 220,62,57,137,103,4,26,67,30,
>                                                 
> 132,246,62,142,238,140,226,125,
>                                                 
> 194,135,210,234,107,18,128,76,
>                                                 
> 113,52,34,199,134,34,140,80,84,
>                                                 
> 35,205,142,207,230,104,37,226,
>                                                 
> 58,32,253,248,156,220,244,151,
>                                                 
> 11,22,43,188,14,177,227,4,188,
>                                                 
> 97,24,83,79,40,16,150,139,230,
>                                                 
> 40,224,66,224,140,89,175,200,
>                                                 
> 198,15,30,202,248,69,32,159,
>                                                 
> 182,234,202,82,247,91,75,129,
>                                                 
> 24,242,250,172,34,107,44,39,
>                                                 
> 177,73,125,204,232,146,190,41,
>                                                 
> 239,6,154,165,197,220,227,183,
>                                                 
> 190,17,114,215,232,235,67,159,
>                                                 
> 222,247,110,133,191,142,154,6,
>                                                 
> 99,200,37,59,120,252,161,54,91,
>                                                 
> 223,191,85,104,9,121,14,184,
>                                                 
> 105,75,162,181,90,233,48,195,
>                                                 
> 87,151,172,23,119,42,211,2,3,
>                                                 
> 130,228,61,83,2,3,1,0,1,163,47,
>                                                 
> 48,45,48,9,6,3,85,29,19,4,2,48,
>                                                 
> 0,48,11,6,3,85,29,15,4,4,3,2,5,
>                                                 
> 32,48,19,6,3,85,29,37,4,12,48,
>                                                 
> 10,6,8,43,6,1,5,5,7,3,1,48,13,
>                                                 
> 6,9,42,134,72,134,247,13,1,1,5,
>                                                 
> 5,0,3,130,1,1,0,222,44,95,61,
>                                                 
> 253,222,29,196,80,45,112,118,
>                                                 
> 52,202,249,227,153,3,154,114,
>                                                 
> 189,224,23,172,222,204,213,89,
>                                                 
> 202,98,202,252,34,116,104,112,
>                                                 
> 18,98,136,6,133,201,165,220,4,
>                                                 
> 130,95,247,113,200,31,36,105,
>                                                 
> 22,27,24,197,222,154,33,131,
>                                                 
> 183,215,250,104,240,205,213,
>                                                 
> 224,56,201,76,226,250,166,136,
>                                                 
> 68,224,195,215,149,224,255,162,
>                                                 
> 11,156,74,159,108,185,153,46,
>                                                 
> 116,32,182,58,192,42,77,78,249,
>                                                 
> 153,29,40,105,199,192,192,14,
>                                                 
> 230,169,223,199,172,53,122,145,
>                                                 
> 127,57,110,56,67,139,94,115,57,
>                                                 
> 55,116,11,212,76,212,44,180,72,
>                                                 
> 244,150,141,6,207,134,211,89,
>                                                 
> 211,47,183,79,202,162,128,196,
>                                                 
> 45,44,85,122,172,122,58,170,
>                                                 
> 117,116,151,187,96,109,186,207,
>                                                 
> 188,10,72,138,17,2,60,52,236,
>                                                 
> 72,68,203,229,144,164,154,254,
>                                                 
> 145,75,227,182,44,152,36,81,
>                                                 
> 103,234,99,135,223,62,152,94,
>                                                 
> 109,109,202,223,114,90,71,131,
>                                                 
> 48,180,74,83,145,93,85,218,225,
>                                                 
> 135,141,226,127,85,243,186,10,
>                                                 
> 50,216,220,110,91,48,135,32,83,
>                                                 
> 253,201,62,47,163,250,152,166,
>                                                 
> 230,144,155,164,240,234,78,55,
>                                                 198,137,227,164,67,70>>,
>                                               0,
>                                               <<0,5>>,
>                                               undefined,new,63510870781},
>                                              274512,ssl_session_cache,
>                                              {3,0},
>                                              undefined,true,rsa,undefined,
>                                              {'RSAPrivateKey','two-prime',
>                                               
> 20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                                               65537,
>                                               
> 15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                                               
> 147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                                               
> 139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                                               
> 83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                                               
> 118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                                               
> 129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                                               asn1_NOVALUE},
>                                              {'DHParameter',
>                                               
> 179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                                               2,asn1_NOVALUE},
>                                              undefined,undefined,
>                                              #Ref<0.0.0.50276>,
>                                             
>  {<0.31385.0>,#Ref<0.0.0.50285>},
>                                              0,<<>>,true,
>                                              {false,first},
>                                              undefined,
>                                              {[],[]},
>                                              false,true}],
>                                            [{file,"ssl_connection.erl"},
>                                             {line,2179}]},
>                                           {ssl_connection,handle_alerts,2,
>                                            [{file,"ssl_connection.erl"},
>                                             {line,2177}]},
>                                           {gen_fsm,handle_msg,7,
>                                           
>  [{file,"gen_fsm.erl"},{line,494}]},
>                                           {proc_lib,init_p_do_apply,3,
>                                            [{file,"proc_lib.erl"},
>                                             {line,227}]}]},
>                                         {gen_fsm,sync_send_all_state_event,
>                                          [<0.31386.0>,start,5000]}}}
> </.net>
>
> <java>
> =INFO REPORT==== 30-Jul-2012::12:36:39 ===
> accepting AMQP connection <0.342.1> (192.168.10.157:53463 -> 
> 192.168.10.107:443)
>
> =INFO REPORT==== 30-Jul-2012::12:36:40 ===
> closing AMQP connection <0.342.1> (192.168.10.157:53463 -> 
> 192.168.10.107:443)
> </java>
>
> <openssl>
> =INFO REPORT==== 30-Jul-2012::12:36:46 ===
> accepting AMQP connection <0.419.1> (192.168.10.157:53464 -> 
> 192.168.10.107:443)
>
> =ERROR REPORT==== 30-Jul-2012::12:36:51 ===
> closing AMQP connection <0.419.1> (192.168.10.157:53464 -> 
> 192.168.10.107:443):
> {bad_version,10,10,10,10}
> </openssl>
>
> <.net>
> =INFO REPORT==== 30-Jul-2012::12:43:58 ===
> accepting AMQP connection <0.3888.1> ([FE80::9CF9:E6C8:AAA2:E95E]:57040 -> 
> [FE80::DC90:8492:EDEA:F29F]:443)
>
> =ERROR REPORT==== 30-Jul-2012::12:43:58 ===
> ** State machine <0.3889.1> terminating 
> ** Last message in was {tcp,#Port<0.8968>,
>                             
> <<21,3,0,0,2,1,41,22,3,0,1,4,16,0,1,0,13,149,79,
>                               
> 68,242,219,55,33,132,16,78,131,203,216,134,82,
>                               
> 174,2,104,224,25,10,69,244,189,175,235,223,106,
>                               
> 45,186,155,55,99,237,33,164,234,55,53,210,3,243,
>                               
> 167,173,216,218,142,61,49,55,108,94,229,157,57,
>                               
> 65,152,150,104,244,4,248,47,159,188,27,115,22,
>                               
> 176,202,177,230,100,242,152,230,216,64,87,7,88,
>                               
> 206,101,137,11,61,214,170,45,226,106,24,133,184,
>                               53,215,16,85,173,26,76,22,71,236,163,220,163,
>                               
> 198,105,253,57,252,199,21,111,171,20,59,238,66,
>                               
> 255,32,129,232,2,110,140,48,215,124,215,101,193,
>                               
> 77,70,48,12,192,100,149,167,33,214,90,232,214,
>                               
> 188,72,182,193,115,137,185,198,135,213,168,214,
>                               
> 68,180,170,204,32,157,92,121,79,219,215,147,140,
>                               21,215,151,41,254,22,64,224,33,217,40,66,213,
>                               175,157,29,114,38,133,252,112,102,104,185,76,
>                               
> 231,12,236,87,176,162,138,29,15,168,220,218,231,
>                               
> 131,230,243,106,157,193,42,63,8,9,49,203,208,76,
>                               
> 250,159,76,187,179,2,183,83,199,70,237,161,192,
>                               221,12,4,228,227,107,196,161,231,171,118,233,
>                               
> 240,24,122,209,118,132,27,20,3,0,0,1,1,22,3,0,0,
>                               
> 60,202,190,24,80,89,105,254,68,94,146,20,33,11,
>                               8,52,82,120,141,183,75,210,23,34,29,85,28,45,
>                               
> 236,35,40,199,167,111,94,144,170,240,48,75,136,
>                               
> 116,63,197,216,54,26,61,171,134,80,82,163,26,75,
>                               50,152,15,181,218,235>>}
> ** When State == certify
> **      Data  == {state,server,
>                      {#Ref<0.0.0.58837>,<0.3888.1>},
>                      gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
>                      #Port<0.8968>,
>                      {ssl_options,[],verify_peer,
>                          {#Fun<ssl.3.54384637>,
>                           #Fun<rabbit_networking.0.89858908>},
>                          false,false,undefined,1,
>                          "C:/certstore/server/cert.pem",undefined,
>                          "C:/certstore/server/key.pem",undefined,undefined,
>                         
>  undefined,"C:/certstore/testca/cacert.pem",undefined,
>                          undefined,
>                          [<<0,57>>,
>                           <<0,56>>,
>                           <<0,53>>,
>                           <<0,22>>,
>                           <<0,19>>,
>                           <<0,10>>,
>                           <<0,51>>,
>                           <<0,50>>,
>                           <<0,47>>,
>                           <<0,5>>,
>                           <<0,4>>,
>                           <<0,21>>,
>                           <<0,9>>],
>                          #Fun<ssl.0.54384637>,true,268435456,false,[],
>                          undefined,false},
>                      {socket_options,binary,0,0,0,false},
>                      {connection_states,
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,0>>,
>                                  0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                                  undefined,undefined},
>                             
>  undefined,undefined,undefined,1,true,undefined,
>                              undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,5>>,
>                                  0,1,0,0,128,16,16,2,20,0,undefined,
>                                 
>  <<80,22,199,223,40,186,235,18,229,68,117,41,
>                                   
>  146,137,237,216,114,239,54,7,165,33,37,94,
>                                    57,110,228,3,62,87,25,210>>,
>                                 
>  <<80,22,199,222,169,174,5,18,190,32,21,236,
>                                   
>  199,246,168,19,117,78,229,208,48,132,253,20,
>                                    180,170,31,49,53,31,120,40>>,
>                                  undefined},
>                              undefined,undefined,undefined,undefined,true,
>                              undefined,undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,0>>,
>                                  0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                                  undefined,undefined},
>                             
>  undefined,undefined,undefined,4,true,undefined,
>                              undefined},
>                          {connection_state,
>                              {security_parameters,
>                                  <<0,5>>,
>                                  0,1,0,0,128,16,16,2,20,0,undefined,
>                                 
>  <<80,22,199,223,40,186,235,18,229,68,117,41,
>                                   
>  146,137,237,216,114,239,54,7,165,33,37,94,
>                                    57,110,228,3,62,87,25,210>>,
>                                 
>  <<80,22,199,222,169,174,5,18,190,32,21,236,
>                                   
>  199,246,168,19,117,78,229,208,48,132,253,20,
>                                    180,170,31,49,53,31,120,40>>,
>                                  undefined},
>                              undefined,undefined,undefined,undefined,true,
>                              undefined,undefined}},
>                      [],<<>>,<<>>,
>                     
>  {{<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,
>                         
>  209,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,
>                         
>  27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,
>                         
>  121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>,
>                       
>  <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,128,
>                         
>  137,71,51,20,230,80,51,0,0,0,0,0,0,24,54,90,252,231,
>                         
>  192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,
>                         
>  3,85,4,3,19,8,77,121,84,101,115,116,67,65,14,0,0,0,0,
>                         
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>},
>                       
> {<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,
>                         
>  209,48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,
>                         
>  27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,
>                         
>  121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                          0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>,
>                        <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,
>                         
>  128,137,71,51,20,230,48,51,0,0,0,0,0,0,24,54,90,252,
>                         
>  231,192,148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,
>                         
>  15,6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,0,0,
>                         
>  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,
>                          0,0,0>>}},
>                      [],262221,
>                      {session,
>                         
>  <<120,172,49,23,82,227,196,133,69,243,102,137,72,209,
>                           
>  109,38,212,150,216,237,102,171,222,27,8,24,94,130,
>                            47,132,52,140>>,
>                          undefined,
>                         
>  <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,
>                           
>  9,42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,
>                           
>  6,3,85,4,3,19,8,77,121,84,101,115,116,67,65,48,30,
>                           
>  23,13,49,50,48,55,51,48,49,50,53,54,52,54,90,23,13,
>                           
>  49,51,48,55,51,48,49,50,53,54,52,54,90,48,41,49,22,
>                           
>  48,20,6,3,85,4,3,12,13,114,105,111,111,118,101,114,
>                           
>  108,111,114,100,45,49,49,15,48,13,6,3,85,4,10,12,6,
>                           
>  115,101,114,118,101,114,48,130,1,34,48,13,6,9,42,
>                           
>  134,72,134,247,13,1,1,1,5,0,3,130,1,15,0,48,130,1,
>                           
>  10,2,130,1,1,0,163,99,255,119,11,217,190,17,106,102,
>                           
>  242,229,252,214,101,34,15,190,61,32,23,69,175,49,
>                           
>  141,78,38,16,202,80,88,96,12,88,193,17,57,226,60,
>                           
>  106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
>                           
>  104,157,167,92,224,120,142,28,102,218,176,245,195,
>                           
>  212,83,251,182,49,60,172,62,12,51,164,181,246,88,
>                           
>  136,122,208,186,96,220,62,57,137,103,4,26,67,30,132,
>                           
>  246,62,142,238,140,226,125,194,135,210,234,107,18,
>                           
>  128,76,113,52,34,199,134,34,140,80,84,35,205,142,
>                           
>  207,230,104,37,226,58,32,253,248,156,220,244,151,11,
>                           
>  22,43,188,14,177,227,4,188,97,24,83,79,40,16,150,
>                           
>  139,230,40,224,66,224,140,89,175,200,198,15,30,202,
>                           
>  248,69,32,159,182,234,202,82,247,91,75,129,24,242,
>                           
>  250,172,34,107,44,39,177,73,125,204,232,146,190,41,
>                           
>  239,6,154,165,197,220,227,183,190,17,114,215,232,
>                           
>  235,67,159,222,247,110,133,191,142,154,6,99,200,37,
>                           
>  59,120,252,161,54,91,223,191,85,104,9,121,14,184,
>                           
>  105,75,162,181,90,233,48,195,87,151,172,23,119,42,
>                           
>  211,2,3,130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,
>                           
>  3,85,29,19,4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,
>                           
>  48,19,6,3,85,29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,
>                           
>  48,13,6,9,42,134,72,134,247,13,1,1,5,5,0,3,130,1,1,
>                           
>  0,222,44,95,61,253,222,29,196,80,45,112,118,52,202,
>                           
>  249,227,153,3,154,114,189,224,23,172,222,204,213,89,
>                           
>  202,98,202,252,34,116,104,112,18,98,136,6,133,201,
>                           
>  165,220,4,130,95,247,113,200,31,36,105,22,27,24,197,
>                           
>  222,154,33,131,183,215,250,104,240,205,213,224,56,
>                           
>  201,76,226,250,166,136,68,224,195,215,149,224,255,
>                           
>  162,11,156,74,159,108,185,153,46,116,32,182,58,192,
>                           
>  42,77,78,249,153,29,40,105,199,192,192,14,230,169,
>                           
>  223,199,172,53,122,145,127,57,110,56,67,139,94,115,
>                           
>  57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,
>                           
>  134,211,89,211,47,183,79,202,162,128,196,45,44,85,
>                           
>  122,172,122,58,170,117,116,151,187,96,109,186,207,
>                           
>  188,10,72,138,17,2,60,52,236,72,68,203,229,144,164,
>                           
>  154,254,145,75,227,182,44,152,36,81,103,234,99,135,
>                           
>  223,62,152,94,109,109,202,223,114,90,71,131,48,180,
>                           
>  74,83,145,93,85,218,225,135,141,226,127,85,243,186,
>                           
>  10,50,216,220,110,91,48,135,32,83,253,201,62,47,163,
>                           
>  250,152,166,230,144,155,164,240,234,78,55,198,137,
>                            227,164,67,70>>,
>                          0,
>                          <<0,5>>,
>                          undefined,new,63510871438},
>                      274512,ssl_session_cache,
>                      {3,0},
>                      undefined,true,rsa,undefined,
>                      {'RSAPrivateKey','two-prime',
>                         
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                          65537,
>                         
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                         
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                         
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                         
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                         
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                         
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                          asn1_NOVALUE},
>                      {'DHParameter',
>                         
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                          2,asn1_NOVALUE},
>                      undefined,undefined,#Ref<0.0.0.58841>,
>                      {<0.3888.1>,#Ref<0.0.0.58850>},
>                      0,<<>>,true,
>                      {false,first},
>                      undefined,
>                      {[],[]},
>                      false,true}
> ** Reason for termination = 
> ** {function_clause,
>        [{ssl_connection,handle_alert,
>             [{alert,1,41,{"ssl_connection.erl",1678}},
>              certify,
>              {state,server,
>                  {#Ref<0.0.0.58837>,<0.3888.1>},
>                  gen_tcp,tcp,tcp_closed,tcp_error,"localhost",443,
>                  #Port<0.8968>,
>                  {ssl_options,[],verify_peer,
>                     
>  {#Fun<ssl.3.54384637>,#Fun<rabbit_networking.0.89858908>},
>                     
>  false,false,undefined,1,"C:/certstore/server/cert.pem",
>                      undefined,"C:/certstore/server/key.pem",undefined,
>                      undefined,undefined,"C:/certstore/testca/cacert.pem",
>                      undefined,undefined,
>                      [<<0,57>>,
>                       <<0,56>>,
>                       <<0,53>>,
>                       <<0,22>>,
>                       <<0,19>>,
>                       <<0,10>>,
>                       <<0,51>>,
>                       <<0,50>>,
>                       <<0,47>>,
>                       <<0,5>>,
>                       <<0,4>>,
>                       <<0,21>>,
>                       <<0,9>>],
>                     
>  #Fun<ssl.0.54384637>,true,268435456,false,[],undefined,
>                      false},
>                  {socket_options,binary,0,0,0,false},
>                  {connection_states,
>                      {connection_state,
>                          {security_parameters,
>                              <<0,0>>,
>                              0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                              undefined,undefined},
>                          undefined,undefined,undefined,2,true,undefined,
>                          undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,5>>,
>                              0,1,0,0,128,16,16,2,20,0,undefined,
>                             
>  <<80,22,199,223,40,186,235,18,229,68,117,41,146,
>                               
>  137,237,216,114,239,54,7,165,33,37,94,57,110,
>                                228,3,62,87,25,210>>,
>                             
>  <<80,22,199,222,169,174,5,18,190,32,21,236,199,
>                               
>  246,168,19,117,78,229,208,48,132,253,20,180,170,
>                                31,49,53,31,120,40>>,
>                              undefined},
>                          undefined,undefined,undefined,undefined,true,
>                          undefined,undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,0>>,
>                              0,0,0,0,0,0,0,0,0,0,undefined,undefined,
>                              undefined,undefined},
>                          undefined,undefined,undefined,4,true,undefined,
>                          undefined},
>                      {connection_state,
>                          {security_parameters,
>                              <<0,5>>,
>                              0,1,0,0,128,16,16,2,20,0,undefined,
>                             
>  <<80,22,199,223,40,186,235,18,229,68,117,41,146,
>                               
>  137,237,216,114,239,54,7,165,33,37,94,57,110,
>                                228,3,62,87,25,210>>,
>                             
>  <<80,22,199,222,169,174,5,18,190,32,21,236,199,
>                               
>  246,168,19,117,78,229,208,48,132,253,20,180,170,
>                                31,49,53,31,120,40>>,
>                              undefined},
>                          undefined,undefined,undefined,undefined,true,
>                          undefined,undefined}},
>                  [],<<>>,<<>>,
>                 
>  {{<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,209,
>                     
>  80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,1,1,
>                     
>  0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,101,
>                     
>  115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,42,0,0,0>>,
>                   
>  <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,128,137,
>                     
>  71,51,20,230,80,51,0,0,0,0,0,0,24,54,90,252,231,192,148,
>                     
>  13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,
>                     
>  8,77,121,84,101,115,116,67,65,14,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,0,0,0,0,0,0,42,0,0,0>>},
>                   
> {<<31,32,233,180,58,12,212,253,218,229,84,250,254,74,36,209,
>                     
>  48,51,0,0,0,0,0,0,24,54,90,252,231,192,148,13,0,0,27,1,1,
>                     
>  0,23,0,21,48,19,49,17,48,15,6,3,85,4,3,19,8,77,121,84,101,
>                     
>  115,116,67,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,38,0,0,0>>,
>                    <<225,51,90,230,223,74,48,11,240,71,28,159,160,170,128,
>                     
>  137,71,51,20,230,48,51,0,0,0,0,0,0,24,54,90,252,231,192,
>                     
>  148,13,0,0,27,1,1,0,23,0,21,48,19,49,17,48,15,6,3,85,4,
>                     
>  3,19,8,77,121,84,101,115,116,67,65,0,0,0,0,0,0,0,0,0,0,
>                      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0>>}},
>                  [{ssl_tls,undefined,22,
>                       {3,0},
>                       
> <<16,0,1,0,13,149,79,68,242,219,55,33,132,16,78,131,203,
>                         
> 216,134,82,174,2,104,224,25,10,69,244,189,175,235,223,
>                         
> 106,45,186,155,55,99,237,33,164,234,55,53,210,3,243,
>                         
> 167,173,216,218,142,61,49,55,108,94,229,157,57,65,152,
>                         150,104,244,4,248,47,159,188,27,115,22,176,202,177,
>                         
> 230,100,242,152,230,216,64,87,7,88,206,101,137,11,61,
>                         
> 214,170,45,226,106,24,133,184,53,215,16,85,173,26,76,
>                         
> 22,71,236,163,220,163,198,105,253,57,252,199,21,111,
>                         
> 171,20,59,238,66,255,32,129,232,2,110,140,48,215,124,
>                         
> 215,101,193,77,70,48,12,192,100,149,167,33,214,90,232,
>                         
> 214,188,72,182,193,115,137,185,198,135,213,168,214,68,
>                         
> 180,170,204,32,157,92,121,79,219,215,147,140,21,215,
>                         
> 151,41,254,22,64,224,33,217,40,66,213,175,157,29,114,
>                         
> 38,133,252,112,102,104,185,76,231,12,236,87,176,162,
>                         
> 138,29,15,168,220,218,231,131,230,243,106,157,193,42,
>                         
> 63,8,9,49,203,208,76,250,159,76,187,179,2,183,83,199,
>                         
> 70,237,161,192,221,12,4,228,227,107,196,161,231,171,
>                         118,233,240,24,122,209,118,132,27>>},
>                   {ssl_tls,undefined,20,{3,0},<<1>>},
>                   {ssl_tls,undefined,22,
>                       {3,0},
>                       
> <<202,190,24,80,89,105,254,68,94,146,20,33,11,8,52,82,
>                         120,141,183,75,210,23,34,29,85,28,45,236,35,40,199,
>                         167,111,94,144,170,240,48,75,136,116,63,197,216,54,
>                         
> 26,61,171,134,80,82,163,26,75,50,152,15,181,218,235>>}],
>                  262221,
>                  {session,
>                     
>  <<120,172,49,23,82,227,196,133,69,243,102,137,72,209,109,
>                       
>  38,212,150,216,237,102,171,222,27,8,24,94,130,47,132,52,
>                        140>>,
>                      undefined,
>                     
>  <<48,130,2,230,48,130,1,206,160,3,2,1,2,2,1,1,48,13,6,9,
>                       
>  42,134,72,134,247,13,1,1,5,5,0,48,19,49,17,48,15,6,3,85,
>                       
>  4,3,19,8,77,121,84,101,115,116,67,65,48,30,23,13,49,50,
>                       
>  48,55,51,48,49,50,53,54,52,54,90,23,13,49,51,48,55,51,
>                       
>  48,49,50,53,54,52,54,90,48,41,49,22,48,20,6,3,85,4,3,12,
>                       
>  13,114,105,111,111,118,101,114,108,111,114,100,45,49,49,
>                       
>  15,48,13,6,3,85,4,10,12,6,115,101,114,118,101,114,48,
>                       
>  130,1,34,48,13,6,9,42,134,72,134,247,13,1,1,1,5,0,3,130,
>                       
>  1,15,0,48,130,1,10,2,130,1,1,0,163,99,255,119,11,217,
>                       
>  190,17,106,102,242,229,252,214,101,34,15,190,61,32,23,
>                       
>  69,175,49,141,78,38,16,202,80,88,96,12,88,193,17,57,226,
>                       
>  60,106,35,93,184,216,167,217,0,102,117,69,97,209,60,27,
>                       
>  104,157,167,92,224,120,142,28,102,218,176,245,195,212,
>                       
>  83,251,182,49,60,172,62,12,51,164,181,246,88,136,122,
>                       
>  208,186,96,220,62,57,137,103,4,26,67,30,132,246,62,142,
>                       
>  238,140,226,125,194,135,210,234,107,18,128,76,113,52,34,
>                       
>  199,134,34,140,80,84,35,205,142,207,230,104,37,226,58,
>                       
>  32,253,248,156,220,244,151,11,22,43,188,14,177,227,4,
>                       
>  188,97,24,83,79,40,16,150,139,230,40,224,66,224,140,89,
>                       
>  175,200,198,15,30,202,248,69,32,159,182,234,202,82,247,
>                       
>  91,75,129,24,242,250,172,34,107,44,39,177,73,125,204,
>                       
>  232,146,190,41,239,6,154,165,197,220,227,183,190,17,114,
>                       
>  215,232,235,67,159,222,247,110,133,191,142,154,6,99,200,
>                       
>  37,59,120,252,161,54,91,223,191,85,104,9,121,14,184,105,
>                       
>  75,162,181,90,233,48,195,87,151,172,23,119,42,211,2,3,
>                       
>  130,228,61,83,2,3,1,0,1,163,47,48,45,48,9,6,3,85,29,19,
>                       
>  4,2,48,0,48,11,6,3,85,29,15,4,4,3,2,5,32,48,19,6,3,85,
>                       
>  29,37,4,12,48,10,6,8,43,6,1,5,5,7,3,1,48,13,6,9,42,134,
>                       
>  72,134,247,13,1,1,5,5,0,3,130,1,1,0,222,44,95,61,253,
>                       
>  222,29,196,80,45,112,118,52,202,249,227,153,3,154,114,
>                       
>  189,224,23,172,222,204,213,89,202,98,202,252,34,116,104,
>                       
>  112,18,98,136,6,133,201,165,220,4,130,95,247,113,200,31,
>                       
>  36,105,22,27,24,197,222,154,33,131,183,215,250,104,240,
>                       
>  205,213,224,56,201,76,226,250,166,136,68,224,195,215,
>                       
>  149,224,255,162,11,156,74,159,108,185,153,46,116,32,182,
>                       
>  58,192,42,77,78,249,153,29,40,105,199,192,192,14,230,
>                       
>  169,223,199,172,53,122,145,127,57,110,56,67,139,94,115,
>                       
>  57,55,116,11,212,76,212,44,180,72,244,150,141,6,207,134,
>                       
>  211,89,211,47,183,79,202,162,128,196,45,44,85,122,172,
>                       
>  122,58,170,117,116,151,187,96,109,186,207,188,10,72,138,
>                       
>  17,2,60,52,236,72,68,203,229,144,164,154,254,145,75,227,
>                       
>  182,44,152,36,81,103,234,99,135,223,62,152,94,109,109,
>                       
>  202,223,114,90,71,131,48,180,74,83,145,93,85,218,225,
>                       
>  135,141,226,127,85,243,186,10,50,216,220,110,91,48,135,
>                       
>  32,83,253,201,62,47,163,250,152,166,230,144,155,164,240,
>                        234,78,55,198,137,227,164,67,70>>,
>                      0,
>                      <<0,5>>,
>                      undefined,new,63510871438},
>                  274512,ssl_session_cache,
>                  {3,0},
>                  undefined,true,rsa,undefined,
>                  {'RSAPrivateKey','two-prime',
>                     
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                      65537,
>                     
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                     
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                     
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                     
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                     
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                     
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                      asn1_NOVALUE},
>                  {'DHParameter',
>                     
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                      2,asn1_NOVALUE},
>                  undefined,undefined,#Ref<0.0.0.58841>,
>                  {<0.3888.1>,#Ref<0.0.0.58850>},
>                  0,<<>>,true,
>                  {false,first},
>                  undefined,
>                  {[],[]},
>                  false,true}],
>             [{file,"ssl_connection.erl"},{line,2179}]},
>         {ssl_connection,handle_alerts,2,
>             [{file,"ssl_connection.erl"},{line,2177}]},
>         {gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,494}]},
>         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
>
> =ERROR REPORT==== 30-Jul-2012::12:43:58 ===
> error on AMQP connection <0.3888.1>: {ssl_upgrade_failure,
>                                       {{function_clause,
>                                         [{ssl_connection,handle_alert,
>                                           [{alert,1,41,
>                                             {"ssl_connection.erl",1678}},
>                                            certify,
>                                            {state,server,
>                                             {#Ref<0.0.0.58837>,<0.3888.1>},
>                                             
> gen_tcp,tcp,tcp_closed,tcp_error,
>                                             "localhost",443,#Port<0.8968>,
>                                             {ssl_options,[],verify_peer,
>                                              {#Fun<ssl.3.54384637>,
>                                               
> #Fun<rabbit_networking.0.89858908>},
>                                              false,false,undefined,1,
>                                             
>  "C:/certstore/server/cert.pem",
>                                              undefined,
>                                              "C:/certstore/server/key.pem",
>                                              undefined,undefined,undefined,
>                                             
>  "C:/certstore/testca/cacert.pem",
>                                              undefined,undefined,
>                                              [<<0,57>>,
>                                               <<0,56>>,
>                                               <<0,53>>,
>                                               <<0,22>>,
>                                               <<0,19>>,
>                                               <<0,10>>,
>                                               <<0,51>>,
>                                               <<0,50>>,
>                                               <<0,47>>,
>                                               <<0,5>>,
>                                               <<0,4>>,
>                                               <<0,21>>,
>                                               <<0,9>>],
>                                              #Fun<ssl.0.54384637>,true,
>                                              268435456,false,[],undefined,
>                                              false},
>                                             {socket_options,binary,0,0,0,
>                                              false},
>                                             {connection_states,
>                                              {connection_state,
>                                               {security_parameters,
>                                                <<0,0>>,
>                                               
>  0,0,0,0,0,0,0,0,0,0,undefined,
>                                               
>  undefined,undefined,undefined},
>                                               
> undefined,undefined,undefined,2,
>                                               true,undefined,undefined},
>                                              {connection_state,
>                                               {security_parameters,
>                                                <<0,5>>,
>                                                0,1,0,0,128,16,16,2,20,0,
>                                                undefined,
>                                               
>  <<80,22,199,223,40,186,235,18,
>                                                 
>  229,68,117,41,146,137,237,216,
>                                                 
>  114,239,54,7,165,33,37,94,57,
>                                                  110,228,3,62,87,25,210>>,
>                                               
>  <<80,22,199,222,169,174,5,18,
>                                                 
>  190,32,21,236,199,246,168,19,
>                                                 
>  117,78,229,208,48,132,253,20,
>                                                 
>  180,170,31,49,53,31,120,40>>,
>                                                undefined},
>                                               
> undefined,undefined,undefined,
>                                               undefined,true,undefined,
>                                               undefined},
>                                              {connection_state,
>                                               {security_parameters,
>                                                <<0,0>>,
>                                               
>  0,0,0,0,0,0,0,0,0,0,undefined,
>                                               
>  undefined,undefined,undefined},
>                                               
> undefined,undefined,undefined,4,
>                                               true,undefined,undefined},
>                                              {connection_state,
>                                               {security_parameters,
>                                                <<0,5>>,
>                                                0,1,0,0,128,16,16,2,20,0,
>                                                undefined,
>                                               
>  <<80,22,199,223,40,186,235,18,
>                                                 
>  229,68,117,41,146,137,237,216,
>                                                 
>  114,239,54,7,165,33,37,94,57,
>                                                  110,228,3,62,87,25,210>>,
>                                               
>  <<80,22,199,222,169,174,5,18,
>                                                 
>  190,32,21,236,199,246,168,19,
>                                                 
>  117,78,229,208,48,132,253,20,
>                                                 
>  180,170,31,49,53,31,120,40>>,
>                                                undefined},
>                                               
> undefined,undefined,undefined,
>                                               undefined,true,undefined,
>                                               undefined}},
>                                             [],<<>>,<<>>,
>                                             
> {{<<31,32,233,180,58,12,212,253,
>                                                 
> 218,229,84,250,254,74,36,209,
>                                                 
> 80,51,0,0,0,0,0,0,24,54,90,252,
>                                                 
> 231,192,148,13,0,0,27,1,1,0,23,
>                                                 
> 0,21,48,19,49,17,48,15,6,3,85,
>                                                 
> 4,3,19,8,77,121,84,101,115,116,
>                                                 
> 67,65,14,0,0,0,0,0,0,0,0,0,0,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,0,0,0,0,42,
>                                                 0,0,0>>,
>                                               <<225,51,90,230,223,74,48,11,
>                                                 
> 240,71,28,159,160,170,128,137,
>                                                 
> 71,51,20,230,80,51,0,0,0,0,0,
>                                                 
> 0,24,54,90,252,231,192,148,13,
>                                                 
> 0,0,27,1,1,0,23,0,21,48,19,49,
>                                                 
> 17,48,15,6,3,85,4,3,19,8,77,
>                                                 
> 121,84,101,115,116,67,65,14,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,42,0,0,0>>},
>                                             
>  {<<31,32,233,180,58,12,212,253,
>                                                 
> 218,229,84,250,254,74,36,209,
>                                                 
> 48,51,0,0,0,0,0,0,24,54,90,252,
>                                                 
> 231,192,148,13,0,0,27,1,1,0,23,
>                                                 
> 0,21,48,19,49,17,48,15,6,3,85,
>                                                 
> 4,3,19,8,77,121,84,101,115,116,
>                                                 
> 67,65,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,
>                                                 0,0,0>>,
>                                               <<225,51,90,230,223,74,48,11,
>                                                 240,71,28,159,160,170,128,
>                                                 
> 137,71,51,20,230,48,51,0,0,0,
>                                                 0,0,0,24,54,90,252,231,192,
>                                                 
> 148,13,0,0,27,1,1,0,23,0,21,
>                                                 
> 48,19,49,17,48,15,6,3,85,4,3,
>                                                 19,8,77,121,84,101,115,116,
>                                                 
> 67,65,0,0,0,0,0,0,0,0,0,0,0,
>                                                 
> 0,0,0,0,0,0,0,0,0,0,0,0,0,0,
>                                                 0,38,0,0,0>>}},
>                                             [{ssl_tls,undefined,22,
>                                               {3,0},
>                                               
> <<16,0,1,0,13,149,79,68,242,219,
>                                                 
> 55,33,132,16,78,131,203,216,
>                                                 
> 134,82,174,2,104,224,25,10,69,
>                                                 244,189,175,235,223,106,45,
>                                                 
> 186,155,55,99,237,33,164,234,
>                                                 
> 55,53,210,3,243,167,173,216,
>                                                 
> 218,142,61,49,55,108,94,229,
>                                                 
> 157,57,65,152,150,104,244,4,
>                                                 
> 248,47,159,188,27,115,22,176,
>                                                 
> 202,177,230,100,242,152,230,
>                                                 
> 216,64,87,7,88,206,101,137,11,
>                                                 
> 61,214,170,45,226,106,24,133,
>                                                 
> 184,53,215,16,85,173,26,76,22,
>                                                 71,236,163,220,163,198,105,
>                                                 
> 253,57,252,199,21,111,171,20,
>                                                 59,238,66,255,32,129,232,2,
>                                                 110,140,48,215,124,215,101,
>                                                 
> 193,77,70,48,12,192,100,149,
>                                                 
> 167,33,214,90,232,214,188,72,
>                                                 
> 182,193,115,137,185,198,135,
>                                                 
> 213,168,214,68,180,170,204,32,
>                                                 
> 157,92,121,79,219,215,147,140,
>                                                 
> 21,215,151,41,254,22,64,224,
>                                                 
> 33,217,40,66,213,175,157,29,
>                                                 114,38,133,252,112,102,104,
>                                                 
> 185,76,231,12,236,87,176,162,
>                                                 
> 138,29,15,168,220,218,231,131,
>                                                 
> 230,243,106,157,193,42,63,8,9,
>                                                 
> 49,203,208,76,250,159,76,187,
>                                                 
> 179,2,183,83,199,70,237,161,
>                                                 
> 192,221,12,4,228,227,107,196,
>                                                 161,231,171,118,233,240,24,
>                                                 122,209,118,132,27>>},
>                                              {ssl_tls,undefined,20,
>                                               {3,0},
>                                               <<1>>},
>                                              {ssl_tls,undefined,22,
>                                               {3,0},
>                                               
> <<202,190,24,80,89,105,254,68,
>                                                 
> 94,146,20,33,11,8,52,82,120,
>                                                 141,183,75,210,23,34,29,85,
>                                                 
> 28,45,236,35,40,199,167,111,
>                                                 
> 94,144,170,240,48,75,136,116,
>                                                 
> 63,197,216,54,26,61,171,134,
>                                                 80,82,163,26,75,50,152,15,
>                                                 181,218,235>>}],
>                                             262221,
>                                             {session,
>                                             
>  <<120,172,49,23,82,227,196,133,69,
>                                               
>  243,102,137,72,209,109,38,212,
>                                               
>  150,216,237,102,171,222,27,8,24,
>                                                94,130,47,132,52,140>>,
>                                              undefined,
>                                             
>  <<48,130,2,230,48,130,1,206,160,3,
>                                               
>  2,1,2,2,1,1,48,13,6,9,42,134,72,
>                                               
>  134,247,13,1,1,5,5,0,48,19,49,
>                                               
>  17,48,15,6,3,85,4,3,19,8,77,121,
>                                               
>  84,101,115,116,67,65,48,30,23,
>                                               
>  13,49,50,48,55,51,48,49,50,53,
>                                               
>  54,52,54,90,23,13,49,51,48,55,
>                                               
>  51,48,49,50,53,54,52,54,90,48,
>                                               
>  41,49,22,48,20,6,3,85,4,3,12,13,
>                                               
>  114,105,111,111,118,101,114,108,
>                                               
>  111,114,100,45,49,49,15,48,13,6,
>                                               
>  3,85,4,10,12,6,115,101,114,118,
>                                               
>  101,114,48,130,1,34,48,13,6,9,
>                                               
>  42,134,72,134,247,13,1,1,1,5,0,
>                                               
>  3,130,1,15,0,48,130,1,10,2,130,
>                                               
>  1,1,0,163,99,255,119,11,217,190,
>                                               
>  17,106,102,242,229,252,214,101,
>                                               
>  34,15,190,61,32,23,69,175,49,
>                                               
>  141,78,38,16,202,80,88,96,12,88,
>                                               
>  193,17,57,226,60,106,35,93,184,
>                                               
>  216,167,217,0,102,117,69,97,209,
>                                               
>  60,27,104,157,167,92,224,120,
>                                               
>  142,28,102,218,176,245,195,212,
>                                               
>  83,251,182,49,60,172,62,12,51,
>                                               
>  164,181,246,88,136,122,208,186,
>                                               
>  96,220,62,57,137,103,4,26,67,30,
>                                               
>  132,246,62,142,238,140,226,125,
>                                               
>  194,135,210,234,107,18,128,76,
>                                               
>  113,52,34,199,134,34,140,80,84,
>                                               
>  35,205,142,207,230,104,37,226,
>                                               
>  58,32,253,248,156,220,244,151,
>                                               
>  11,22,43,188,14,177,227,4,188,
>                                               
>  97,24,83,79,40,16,150,139,230,
>                                               
>  40,224,66,224,140,89,175,200,
>                                               
>  198,15,30,202,248,69,32,159,182,
>                                               
>  234,202,82,247,91,75,129,24,242,
>                                               
>  250,172,34,107,44,39,177,73,125,
>                                               
>  204,232,146,190,41,239,6,154,
>                                               
>  165,197,220,227,183,190,17,114,
>                                               
>  215,232,235,67,159,222,247,110,
>                                               
>  133,191,142,154,6,99,200,37,59,
>                                               
>  120,252,161,54,91,223,191,85,
>                                               
>  104,9,121,14,184,105,75,162,181,
>                                               
>  90,233,48,195,87,151,172,23,119,
>                                               
>  42,211,2,3,130,228,61,83,2,3,1,
>                                               
>  0,1,163,47,48,45,48,9,6,3,85,29,
>                                               
>  19,4,2,48,0,48,11,6,3,85,29,15,
>                                               
>  4,4,3,2,5,32,48,19,6,3,85,29,37,
>                                               
>  4,12,48,10,6,8,43,6,1,5,5,7,3,1,
>                                               
>  48,13,6,9,42,134,72,134,247,13,
>                                               
>  1,1,5,5,0,3,130,1,1,0,222,44,95,
>                                               
>  61,253,222,29,196,80,45,112,118,
>                                               
>  52,202,249,227,153,3,154,114,
>                                               
>  189,224,23,172,222,204,213,89,
>                                               
>  202,98,202,252,34,116,104,112,
>                                               
>  18,98,136,6,133,201,165,220,4,
>                                               
>  130,95,247,113,200,31,36,105,22,
>                                               
>  27,24,197,222,154,33,131,183,
>                                               
>  215,250,104,240,205,213,224,56,
>                                               
>  201,76,226,250,166,136,68,224,
>                                               
>  195,215,149,224,255,162,11,156,
>                                               
>  74,159,108,185,153,46,116,32,
>                                               
>  182,58,192,42,77,78,249,153,29,
>                                               
>  40,105,199,192,192,14,230,169,
>                                               
>  223,199,172,53,122,145,127,57,
>                                               
>  110,56,67,139,94,115,57,55,116,
>                                               
>  11,212,76,212,44,180,72,244,150,
>                                               
>  141,6,207,134,211,89,211,47,183,
>                                               
>  79,202,162,128,196,45,44,85,122,
>                                               
>  172,122,58,170,117,116,151,187,
>                                               
>  96,109,186,207,188,10,72,138,17,
>                                               
>  2,60,52,236,72,68,203,229,144,
>                                               
>  164,154,254,145,75,227,182,44,
>                                               
>  152,36,81,103,234,99,135,223,62,
>                                               
>  152,94,109,109,202,223,114,90,
>                                               
>  71,131,48,180,74,83,145,93,85,
>                                               
>  218,225,135,141,226,127,85,243,
>                                               
>  186,10,50,216,220,110,91,48,135,
>                                               
>  32,83,253,201,62,47,163,250,152,
>                                               
>  166,230,144,155,164,240,234,78,
>                                                55,198,137,227,164,67,70>>,
>                                              0,
>                                              <<0,5>>,
>                                              undefined,new,63510871438},
>                                             274512,ssl_session_cache,
>                                             {3,0},
>                                             undefined,true,rsa,undefined,
>                                             {'RSAPrivateKey','two-prime',
>                                             
>  20626154516851897899026407170042992186954022225619154212982023436593021084431130197446826019668822057364906823742347703189807900395411954920873998310066315490647373642439940204039202384183392622156916320328265059046273749378724499423180264851128949425176965378808923708249996203617405459079934227817868247758516226763794212954049706311605777883116953728567988744407772593262913415387064723162423936064571000681319856846203478410121074550319506347566528404963612789338894176075017651715919226127325082190253879422994652680148227557765718727880087472465526710974927798830792613909804655622488819123356265357557645983059,
>                                              65537,
>                                             
>  15753576824404866706376044232975295999480958580700470942075700491610291444240661336850952536956572441237780354035479412899062124514279649717935639187182346184359282354583383537744820106814466907274737116652140127417508163711369986704110474344618453140626409540202949116017723728154618463680762130909614342150817793549884200377997171328336034785139122051227189867421396653375857793738402806848616845781621592305587456572159520606363585103073092410791668613304828460354220401157090209517088913719565971597857543743477192138569316510730037503924347993836684082018172906476137909503657700281531265319722383583750655610033,
>                                             
>  147963628923537722751250644893149910647877745647734479009072815590885096313393320663197608983026775547798886997516128878305383131732077392946066063157676914467572774145482415764325037604743832854138017377728241182637036038664832996330038429839687140432034633341581183037957243832228259712690537805605526845193,
>                                             
>  139400166560599511134623535154168044117010417616561480638015081392064434781718455691958277496285324026113415331264145017196766697778293856707095327318700977134141451262624416630418359166089488660683041261802926507292086611225259562442267712647320647693527512273216022318431874813920243053485708514328171146363,
>                                             
>  83212467327384986304573676226052859556415918814388050915321066942845293419331638916695519695552403472316761189365579170052054657464473144510935149454544731015019450641317811279517339991120183217189753978530140001349668695196144921887425826763528219706478790317998346937302441917152707146049333230102124035785,
>                                             
>  118916720507552022048665608432855834756697764891421680852488047292157809410585374710015890565403109851349965834947961540449206337987565415672422882713682584320894244712750709683946460867884783291160821945215927067811750403188589443481695241023753840587790753752211547061302330366385996130296252588774967793455,
>                                             
>  129831464471044841636495352280916516561752975654850437815069221568863429305147590324598171020575116437572160306269648211801154160117293514373271643619553796558702820331561846467578879016523966553104294325592014959642456308451848867115460176418358926962367640698172575352976728984474679014058617640630906621214,
>                                              asn1_NOVALUE},
>                                             {'DHParameter',
>                                             
>  179769313486231590770839156793787453197860296048756011706444423684197180216158519368947833795864925541502180565485980503646440548199239100050792877003355816639229553136239076508735759914822574862575007425302077447712589550957937778424442426617334727629299387668709205606050270810842907692932019128194467627007,
>                                              2,asn1_NOVALUE},
>                                             undefined,undefined,
>                                             #Ref<0.0.0.58841>,
>                                             {<0.3888.1>,#Ref<0.0.0.58850>},
>                                             0,<<>>,true,
>                                             {false,first},
>                                             undefined,
>                                             {[],[]},
>                                             false,true}],
>                                           [{file,"ssl_connection.erl"},
>                                            {line,2179}]},
>                                          {ssl_connection,handle_alerts,2,
>                                           [{file,"ssl_connection.erl"},
>                                            {line,2177}]},
>                                          {gen_fsm,handle_msg,7,
>                                           
> [{file,"gen_fsm.erl"},{line,494}]},
>                                          {proc_lib,init_p_do_apply,3,
>                                           [{file,"proc_lib.erl"},
>                                            {line,227}]}]},
>                                        {gen_fsm,sync_send_all_state_event,
>                                         [<0.3889.1>,start,5000]}}}
> </.net>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120731/c172adc4/attachment.htm>

From ward.mark at gmail.com  Tue Jul 31 18:21:12 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Tue, 31 Jul 2012 10:21:12 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
Message-ID: <3804ff37-4552-421b-af7d-0bbacd10afc8@googlegroups.com>

Adding to this is the wireshark trace of the .net client.

No.     Time           Source                Destination           Protocol 
Length Info
     52 116.689790000  fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
TCP      82     57715 > https [SYN] Seq=0 Win=8192 Len=0 MSS=1440 
SACK_PERM=1

Frame 52: 82 bytes on wire (656 bits), 82 bytes captured (656 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 57715 (57715), Dst Port: https 
(443), Seq: 0, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     53 116.689845000  fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
TCP      82     https > 57715 [SYN, ACK] Seq=0 Ack=1 Win=8192 Len=0 
MSS=1440 SACK_PERM=1

Frame 53: 82 bytes on wire (656 bits), 82 bytes captured (656 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 57715 
(57715), Seq: 0, Ack: 1, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     54 116.690623000  fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
TCP      74     57715 > https [ACK] Seq=1 Ack=1 Win=64800 Len=0

Frame 54: 74 bytes on wire (592 bits), 74 bytes captured (592 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 57715 (57715), Dst Port: https 
(443), Seq: 1, Ack: 1, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     55 116.719962000  fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
SSLv3    132    Client Hello

Frame 55: 132 bytes on wire (1056 bits), 132 bytes captured (1056 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 57715 (57715), Dst Port: https 
(443), Seq: 1, Ack: 1, Len: 58
Secure Sockets Layer
    SSLv3 Record Layer: Handshake Protocol: Client Hello
        Content Type: Handshake (22)
        Version: SSL 3.0 (0x0300)
        Length: 53
        Handshake Protocol: Client Hello
            Handshake Type: Client Hello (1)
            Length: 49
            Version: SSL 3.0 (0x0300)
            Random
            Session ID Length: 0
            Cipher Suites Length: 10
            Cipher Suites (5 suites)
                Cipher Suite: TLS_RSA_WITH_RC4_128_SHA (0x0005)
                Cipher Suite: TLS_RSA_WITH_3DES_EDE_CBC_SHA (0x000a)
                Cipher Suite: TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA (0x0013)
                Cipher Suite: TLS_RSA_WITH_RC4_128_MD5 (0x0004)
                Cipher Suite: TLS_EMPTY_RENEGOTIATION_INFO_SCSV (0x00ff)
            Compression Methods Length: 1
            Compression Methods (1 method)
                Compression Method: null (0)

No.     Time           Source                Destination           Protocol 
Length Info
     56 116.800431000  fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
SSLv3    160    Server Hello

Frame 56: 160 bytes on wire (1280 bits), 160 bytes captured (1280 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 57715 
(57715), Seq: 1, Ack: 59, Len: 86
Secure Sockets Layer
    SSLv3 Record Layer: Handshake Protocol: Server Hello
        Content Type: Handshake (22)
        Version: SSL 3.0 (0x0300)
        Length: 81
        Handshake Protocol: Server Hello
            Handshake Type: Server Hello (2)
            Length: 77
            Version: SSL 3.0 (0x0300)
            Random
            Session ID Length: 32
            Session ID: 1288833cf7cd85a2955a1b1dc6b1a6daef9b16f2ef5e9f8c...
            Cipher Suite: TLS_RSA_WITH_RC4_128_SHA (0x0005)
            Compression Method: null (0)
            Extensions Length: 5
            Extension: renegotiation_info

No.     Time           Source                Destination           Protocol 
Length Info
     57 116.800727000  fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
TCP      1514   [TCP segment of a reassembled PDU]

Frame 57: 1514 bytes on wire (12112 bits), 1514 bytes captured (12112 bits) 
on interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 57715 
(57715), Seq: 87, Ack: 59, Len: 1440

No.     Time           Source                Destination           Protocol 
Length Info
     58 116.800734000  fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
SSLv3    112    Certificate

Frame 58: 112 bytes on wire (896 bits), 112 bytes captured (896 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 57715 
(57715), Seq: 1527, Ack: 59, Len: 38
[2 Reassembled TCP Segments (1478 bytes): #57(1440), #58(38)]
Secure Sockets Layer
    SSLv3 Record Layer: Handshake Protocol: Certificate
        Content Type: Handshake (22)
        Version: SSL 3.0 (0x0300)
        Length: 1473
        Handshake Protocol: Certificate
            Handshake Type: Certificate (11)
            Length: 1469
            Certificates Length: 1466
            Certificates (1466 bytes)

No.     Time           Source                Destination           Protocol 
Length Info
     59 116.800848000  fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
SSLv3    110    Certificate Request

Frame 59: 110 bytes on wire (880 bits), 110 bytes captured (880 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 57715 
(57715), Seq: 1565, Ack: 59, Len: 36
Secure Sockets Layer
    SSLv3 Record Layer: Handshake Protocol: Certificate Request
        Content Type: Handshake (22)
        Version: SSL 3.0 (0x0300)
        Length: 31
        Handshake Protocol: Certificate Request
            Handshake Type: Certificate Request (13)
            Length: 27
            Certificate types count: 1
            Certificate types (1 type)
            Distinguished Names Length: 23
            Distinguished Names (23 bytes)

No.     Time           Source                Destination           Protocol 
Length Info
     60 116.800883000  fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
SSLv3    83     Server Hello Done

Frame 60: 83 bytes on wire (664 bits), 83 bytes captured (664 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 57715 
(57715), Seq: 1601, Ack: 59, Len: 9
Secure Sockets Layer
    SSLv3 Record Layer: Handshake Protocol: Server Hello Done
        Content Type: Handshake (22)
        Version: SSL 3.0 (0x0300)
        Length: 4
        Handshake Protocol: Server Hello Done
            Handshake Type: Server Hello Done (14)
            Length: 0

No.     Time           Source                Destination           Protocol 
Length Info
     61 116.801615000  fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
TCP      74     57715 > https [ACK] Seq=59 Ack=1610 Win=64800 Len=0

Frame 61: 74 bytes on wire (592 bits), 74 bytes captured (592 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 57715 (57715), Dst Port: https 
(443), Seq: 59, Ack: 1610, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     62 116.807562000  fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
SSLv3    417    Alert (Level: Warning, Description: No Certificate), Client 
Key Exchange, Change Cipher Spec, Encrypted Handshake Message

Frame 62: 417 bytes on wire (3336 bits), 417 bytes captured (3336 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 57715 (57715), Dst Port: https 
(443), Seq: 59, Ack: 1610, Len: 343
Secure Sockets Layer
    SSLv3 Record Layer: Alert (Level: Warning, Description: No Certificate)
        Content Type: Alert (21)
        Version: SSL 3.0 (0x0300)
        Length: 2
        Alert Message
    SSLv3 Record Layer: Handshake Protocol: Client Key Exchange
        Content Type: Handshake (22)
        Version: SSL 3.0 (0x0300)
        Length: 260
        Handshake Protocol: Client Key Exchange
            Handshake Type: Client Key Exchange (16)
            Length: 256
    SSLv3 Record Layer: Change Cipher Spec Protocol: Change Cipher Spec
        Content Type: Change Cipher Spec (20)
        Version: SSL 3.0 (0x0300)
        Length: 1
        Change Cipher Spec Message
    SSLv3 Record Layer: Handshake Protocol: Encrypted Handshake Message
        Content Type: Handshake (22)
        Version: SSL 3.0 (0x0300)
        Length: 60
        Handshake Protocol: Encrypted Handshake Message

No.     Time           Source                Destination           Protocol 
Length Info
     63 116.807678000  fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
TCP      74     https > 57715 [FIN, ACK] Seq=1610 Ack=402 Win=64457 Len=0

Frame 63: 74 bytes on wire (592 bits), 74 bytes captured (592 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 57715 
(57715), Seq: 1610, Ack: 402, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     64 116.808015000  fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
TCP      74     57715 > https [ACK] Seq=402 Ack=1611 Win=64800 Len=0

Frame 64: 74 bytes on wire (592 bits), 74 bytes captured (592 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 57715 (57715), Dst Port: https 
(443), Seq: 402, Ack: 1611, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     65 116.860465000  fe80::9cf9:e6c8:aaa2:e95e fe80::dc90:8492:edea:f29f 
TCP      74     57715 > https [FIN, ACK] Seq=402 Ack=1611 Win=64800 Len=0

Frame 65: 74 bytes on wire (592 bits), 74 bytes captured (592 bits) on 
interface 0
Ethernet II, Src: Vmware_01:f7:d2 (00:0c:29:01:f7:d2), Dst: Vmware_c0:0f:28 
(00:0c:29:c0:0f:28)
Internet Protocol Version 6, Src: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e), Dst: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f)
Transmission Control Protocol, Src Port: 57715 (57715), Dst Port: https 
(443), Seq: 402, Ack: 1611, Len: 0

No.     Time           Source                Destination           Protocol 
Length Info
     66 116.860490000  fe80::dc90:8492:edea:f29f fe80::9cf9:e6c8:aaa2:e95e 
TCP      74     https > 57715 [ACK] Seq=1611 Ack=403 Win=64457 Len=0

Frame 66: 74 bytes on wire (592 bits), 74 bytes captured (592 bits) on 
interface 0
Ethernet II, Src: Vmware_c0:0f:28 (00:0c:29:c0:0f:28), Dst: Vmware_01:f7:d2 
(00:0c:29:01:f7:d2)
Internet Protocol Version 6, Src: fe80::dc90:8492:edea:f29f 
(fe80::dc90:8492:edea:f29f), Dst: fe80::9cf9:e6c8:aaa2:e95e 
(fe80::9cf9:e6c8:aaa2:e95e)
Transmission Control Protocol, Src Port: https (443), Dst Port: 57715 
(57715), Seq: 1611, Ack: 403, Len: 0

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120731/43280ee3/attachment.htm>

From francesco at rabbitmq.com  Tue Jul 31 18:24:16 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 31 Jul 2012 18:24:16 +0100
Subject: [rabbitmq-discuss] Erlang Consumer Example
In-Reply-To: <5016F8A1.8020904@googlemail.com>
References: <ea3f2de4-2e25-4a4c-a30d-b798520f87bc@googlegroups.com>
	<85328f00-373d-4faf-9172-d836c2978fba@googlegroups.com>
	<50165947.4070609@rabbitmq.com> <5016F8A1.8020904@googlemail.com>
Message-ID: <87sjc7alof.wl%francesco@rabbitmq.com>

At Mon, 30 Jul 2012 23:12:01 +0200,
Anton Prokofiev wrote:
> It seams to me that  this one did not work:
> 
> Sub = #'basic.consume'{queue = Q},
>       #'basic.consume_ok'{consumer_tag = Tag} = amqp_channel:call(Channel, Sub) %% the caller is the subscriber
> 
> At least I do not managed to force it to work.
> In another one,
> 
> Sub = #'basic.consume'{queue = Q},
>       #'basic.consume_ok'{consumer_tag = Tag} = amqp_channel:subscribe(Channel, Sub, Consumer)
> 
> It was not clear to me what should be used as a consumer, as final example
> contains only case when we use *#'basic.get'* command.

I just tried out a simple consumer, copying and pasting the example:

   -include("amqp_client.hrl").

   loop(Channel) ->
       receive
           %% This is the first message received
           #'basic.consume_ok'{} ->
               loop(Channel);
   
           %% This is received when the subscription is cancelled
           #'basic.cancel_ok'{} ->
               ok;
   
           %% A delivery
           {#'basic.deliver'{delivery_tag = Tag}, Content} ->
               %% Do something with the message payload
               %% (some work here)
               io:format("~p~n", [Content]),
   
               %% Ack the message
               amqp_channel:cast(Channel, #'basic.ack'{delivery_tag = Tag}),
   
               %% Loop
               loop(Channel)
       end.
   
   test() ->
       {ok, Connection} = amqp_connection:start(#amqp_params_network{}),
       {ok, Channel} = amqp_connection:open_channel(Connection),
       Q = <<"q">>,
       %% declare queue
       #'queue.declare_ok'{} = amqp_channel:call(Channel,
                                                 #'queue.declare'{queue = Q})
       %% consume
       Sub = #'basic.consume'{queue = Q},
       #'basic.consume_ok'{consumer_tag = Tag} = amqp_channel:call(Channel, Sub),
       loop(Channel).

After running `test()', I published some messages to the "(AMQP default)"
exchange with the appropriate routing key ("q") through the management
interface, and the consumer correctly received.

> If I understood it correctly, I should pass a PID of the consumer process,
> when I open channel:
> amqp_connection:open_channel(Connection,none,*{amqp_direct_consumer,[Pid]}*),

As explained by Matthias, this will create a channel with a default consumer,
which is probably not what you need - you most likely want the selective
consumer, which is default (in `open_channel/{1,2}').

The edoc is quite unclear on what the default consumer is (in fact, I don't
think there is a way to know that from the edoc, you have to look at the
source).  It also does not include details about the callback functions required
for the `amqp_gen_consumer' behaviour.  I'll file a bug.

> I should say that I have not too much experience with erlang, and just started
> to work with rabbitMQ.
> Another problem is that RabbitMQ broker I work with is out of my control and
> documentation that I have really misleading.
> As a result I have to use try-and-error approach to develop my application.

I can imagine that to be frustrating.  Try to convince the sysadmins to the last
version :).  Also, you should find the appropriate docs locally - I don't know
how you installed rabbit but they are usually packaged with the broker.  But the
trial and error approach is tedious and dangerous.

--
Francesco * Often in error, never in doubt

From ward.mark at gmail.com  Tue Jul 31 18:47:00 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Tue, 31 Jul 2012 10:47:00 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
Message-ID: <e5c81f25-9988-41e0-b0bc-01a794b67d33@googlegroups.com>

I have enabled the fail_if_no_peer_cert (true) to see if the .net client 
will act differently.  As it turns out the network trace was exactly the 
same and the .net client had the same error.  The Java client received a 
handshake_failure which was expected as I do not have the java client 
sending a client certificate at this time.

I am going to attempt to setup the .net client unit tests to see if I can 
repeat the issue with the ssl unit test.

On Monday, July 30, 2012 1:06:19 PM UTC-5, Mark Ward wrote:
>
> Hi,
>
> I might have the same problem as this post.  
> https://groups.google.com/forum/?fromgroups#!searchin/rabbitmq-discuss/ssl_upgrade_failure/rabbitmq-discuss/-hCUUIzi_9c/Pg6UQ3Lo1kMJ
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120731/ed06f84d/attachment.htm>

From ward.mark at gmail.com  Tue Jul 31 20:08:12 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Tue, 31 Jul 2012 12:08:12 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET ssl_upgrade_failure
In-Reply-To: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
References: <8b4d3c61-a6c0-4dfd-9d90-3ef63184b3d0@googlegroups.com>
Message-ID: <08046b1b-a5cc-4d83-87ba-4e7a772c4887@googlegroups.com>

I have ran the SSL unit test in the .net client and it also fails with the 
same errors.  What is also odd is the unit test gives a false sense of 
success if the "SSL_CERTS_DIR" is not set or specified.

On Monday, July 30, 2012 1:06:19 PM UTC-5, Mark Ward wrote:
>
> Hi,
>
> I might have the same problem as this post.  
> https://groups.google.com/forum/?fromgroups#!searchin/rabbitmq-discuss/ssl_upgrade_failure/rabbitmq-discuss/-hCUUIzi_9c/Pg6UQ3Lo1kMJ
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120731/2799bf81/attachment.htm>

From curylod at asme.org  Tue Jul 31 22:23:45 2012
From: curylod at asme.org (Dave Curylo)
Date: Tue, 31 Jul 2012 17:23:45 -0400
Subject: [rabbitmq-discuss] Disallow clients without heartbeat
Message-ID: <CAAqmy6Pkg7uPYnKjm38-_cDMf6g2zgdCyKEJe9vbMHtgj-ijuw@mail.gmail.com>

I would like all my clients to specify a heartbeat so the server will
disconnect them automatically if they become unresponsive. Is there any way
on the message broker to require that clients set a heartbeat, and disallow
connections from clients that don't?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120731/f5adb756/attachment.htm>

From squall1386 at hotmail.com  Tue Jul 31 23:49:56 2012
From: squall1386 at hotmail.com (Chris Judkins-Fisher)
Date: Tue, 31 Jul 2012 17:49:56 -0500
Subject: [rabbitmq-discuss] basicPublish() Hangs on the Upstream Node in
 a Federation
In-Reply-To: <50166944.1050900@rabbitmq.com>
References: <SNT127-W15555B836D172E6F1F0C49D5C20@phx.gbl>,
	<50166944.1050900@rabbitmq.com>
Message-ID: <SNT127-W189232D7C87742955A45C6D5C50@phx.gbl>


Hi Emile,

I can see the appropriate exchange and queue when list_exchanges or list_queues. Also, this exact code works on rabbit1, and also on my own computer.

The only line logged in rabbit at rabbit2.log when I run that code is "accepting AMQP connection". Is there a way to configure the broker to log any more information?

I should also say that, since sending this message, I've recreated the VM and reinstalled everything without activating the federation plugin or anything, and I'm still getting the same problem. I'm installing rabbitmq on CentOS 5.7, and I have to compile Erlang source because of the problem explained at http://stackoverflow.com/questions/5463503/rabbitmq-install-issue-on-centos-5-5. Everything appears to work with the manual compile, but I'm wondering if this bug has something to do with the Erlang version I'm using. It doesn't seem likely, since I did basically the same setup on rabbit1 and it worked, but it's the only thing I can think of at this point.

Thanks,
Chris

> Date: Mon, 30 Jul 2012 12:00:20 +0100
> From: emile at rabbitmq.com
> To: rabbitmq-discuss at lists.rabbitmq.com
> CC: squall1386 at hotmail.com
> Subject: Re: [rabbitmq-discuss] basicPublish() Hangs on the Upstream Node in a Federation
> 
> Hi Chris,
> 
> On 26/07/12 19:59, Chris Judkins-Fisher wrote:
> > are also automatically created on rabbit2. However, if I try to publish
> > to an exchange from rabbit2, the code appears to hang and the message is
> > never delivered. This happens whether I'm publishing to the upstream
> 
> From your description further on it sounds like the channel close
> immediately following the publish is failing. Is it possible that you
> are publishing to a non-existent exchange (testexchange)? What does the
> broker logfile say? The solution in this case is to make sure that the
> exchange you publish to exists.
> 
> 
> -Emile
> 
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120731/30ad3a1e/attachment-0001.htm>

