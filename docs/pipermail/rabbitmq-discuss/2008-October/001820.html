<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Pub/sub with expiring reply queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Pub/sub%20with%20expiring%20reply%20queue&In-Reply-To=269388e30810290326q4d8a2cc8q4d991c135cbe246f%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001819.html">
   <LINK REL="Next"  HREF="001823.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Pub/sub with expiring reply queue</H1>
    <B>Richard Marr</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Pub/sub%20with%20expiring%20reply%20queue&In-Reply-To=269388e30810290326q4d8a2cc8q4d991c135cbe246f%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Pub/sub with expiring reply queue">richard.marr at gmail.com
       </A><BR>
    <I>Wed Oct 29 11:10:30 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001819.html">[rabbitmq-discuss] Pub/sub with expiring reply queue
</A></li>
        <LI>Next message: <A HREF="001823.html">[rabbitmq-discuss] Pub/sub with expiring reply queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1820">[ date ]</a>
              <a href="thread.html#1820">[ thread ]</a>
              <a href="subject.html#1820">[ subject ]</a>
              <a href="author.html#1820">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ben,

&gt;<i> It's quite hard to tell without actually seeing the code :-)
</I>
Yep. I was naively hoping it'd be an obvious n00b question that you'd
know right off the bat  :o)

The demo I've built delivers each message to two queues, but is
currently syncronous so only waits for the first response. My debug
output tells me that both subscribers (one per queue) get the message
body intact, but the replyTo property is null, even though the reply
queue name generated in the client looks valid. I put debug just
before the RpcClient.publish() call in the RpcClient.primitiveCall()
method and it lookeds fine.

Should the properties object be passed through transparently?



// The client code looks like this:

String exchangeName = &quot;searchExchange&quot;;
String routingKey = &quot;search.replica.1&quot;;
int ticket = _channel.accessRequest( _realm );
	
RpcClient rpc = new RpcClient( _channel, ticket, exchangeName, routingKey );
byte[] results = rpc.primitiveCall( query.getBytes() );



// And the server code looks like this:

int ticket = _channel.accessRequest( _realm );

String exchangeName = &quot;searchExchange&quot;;
String queueName = &quot;search.partition.&quot;+_partitionCode+&quot;.replica.&quot; +
_replicaCode;
String bindingKey = &quot;search.replica.&quot; + _replicaCode;

_channel.exchangeDeclare(ticket, exchangeName, &quot;direct&quot;);
_channel.queueDeclare(ticket, queueName);
_channel.queueBind(ticket, queueName, exchangeName, bindingKey );

RpcServer server = new RpcServer( _channel, ticket, queueName ){
	@Override
	public byte[] handleCall(QueueingConsumer.Delivery request,
AMQP.BasicProperties replyProperties)
	{
		return _index.search( request.getBody() );
	}
};
ShutdownSignalException e = server.mainloop();


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001819.html">[rabbitmq-discuss] Pub/sub with expiring reply queue
</A></li>
	<LI>Next message: <A HREF="001823.html">[rabbitmq-discuss] Pub/sub with expiring reply queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1820">[ date ]</a>
              <a href="thread.html#1820">[ thread ]</a>
              <a href="subject.html#1820">[ subject ]</a>
              <a href="author.html#1820">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
