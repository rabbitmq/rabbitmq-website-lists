<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Flow Control
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Flow%20Control&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001790.html">
   <LINK REL="Next"  HREF="001781.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Flow Control</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Flow%20Control&In-Reply-To="
       TITLE="[rabbitmq-discuss] Flow Control">0x6e6562 at gmail.com
       </A><BR>
    <I>Wed Oct 22 12:19:41 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001790.html">[rabbitmq-discuss] rabbitmq-server could do with an exec
</A></li>
        <LI>Next message: <A HREF="001781.html">[rabbitmq-discuss] Flow Control
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1778">[ date ]</a>
              <a href="thread.html#1778">[ thread ]</a>
              <a href="subject.html#1778">[ subject ]</a>
              <a href="author.html#1778">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Brian,

On Wed, Oct 22, 2008 at 2:14 AM, Brian Sullivan &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">bsullivan at lindenlab.com</A>&gt; wrote:
&gt;<i> [I am answering this thread, even though I think we have a bit of a split
</I>&gt;<i> into two topics, and this one no longer has anything to do with jms
</I>&gt;<i> support...  ;)   Responses inline.]
</I>
Sure, so I've changed the subject line and conveniently ignored JMS
tas a subject of discussion.

&gt;<i> I think the Channel.Flow command is exactly what I am looking for here.  Can
</I>&gt;<i> I make the assumption that it will work in the case where there are NO
</I>&gt;<i> subscribers (my &quot;base case&quot; scenario where the publisher is sending a ton of
</I>&gt;<i> data, and I just don't have any clients currently reading it).  The
</I>&gt;<i> publisher will simply get the Channel.Flow signal when the broker needs
</I>&gt;<i> extra time to clean up messages it hasn't been able to throw away yet,
</I>&gt;<i> correct?
</I>
The Channel.Flow command will be sent to all open channels and will
have the effect that message sending will be suspended until the
broker sends the pendant to allow the resumption of transmission. So
it doesn't matter when you have consumers or not. Furthermore, in one
of the previous posts I briefly discussed the possibility of
introducing a callback interface in the client so that you could take
action in an event driven fashion.

&gt;<i> Yeah, it is a bottleneck, but just for each host - and we are less worried
</I>&gt;<i> about latency than we are about fault tolerance, because this is a logging
</I>&gt;<i> system.  We currently have a similar system running, and want the hosts to
</I>&gt;<i> be able to dump their logging messages easily (locally), then just have a
</I>&gt;<i> process to pick this heterogeneous mix of logging messages and transmit them
</I>&gt;<i> all to the exchange, on the appropriate topics.
</I>
Are you talking about some fast local broker that relays to a slower
*less-local* broker thus giving the producer the maximum amount of
bandwith in order to do a reliable fire and forget?

&gt;<i> I agree that egress flow is where our problem is (at least what I was
</I>&gt;<i> expecting, and hopefully it's only one place...).  As long as the broker can
</I>&gt;<i> send back a Channel.Flow command to a producer if one of the queues fills up
</I>&gt;<i> the whole node, then we can back up and handle it when necessary, likely by
</I>&gt;<i> upping the consumption rate.  We don't have a real need to do this
</I>&gt;<i> dynamically right now - we just want to be able to detect the problem and
</I>&gt;<i> address it via configuration at this point.
</I>
This would be doable with Channel.Flow.

&gt;<i> The main thing here is that we want to make sure the server doesn't crash if
</I>&gt;<i> it gets overloaded, and that the behavior is predictable.From my tests
</I>&gt;<i> somewhere earlier in this thread, I hit some wall where I saturated the
</I>&gt;<i> broker and it got stuck at 200 msg/sec.  As long as the updated flow control
</I>&gt;<i> works to keep the broker happy, then I think I am good.
</I>
This is the whole intention of the flow control implementation. In
your case, you were most likely seeing TCP-based flow control via back
pressure over the socket, but this is not something that we are going
to rely on given the message pipeline inside the broker. Hence the
upcoming Channel.Flow patch.

&gt;&gt;<i> 4. Topics: I still haven't completely understood the rational behind
</I>&gt;&gt;<i> topic exchanges from the point of view of your application. As I have
</I>&gt;&gt;<i> indicated before, direct exchanges are more efficient that topics ATM,
</I>&gt;&gt;<i> but the sweet spot is going to depend on your app.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I think we got to an understanding on this one on the other thread.  Please
</I>&gt;<i> let me know if it's still not clear why I want topic vs direct.  :)
</I>
Yep, that's been answered in the other thread.

HTH,

Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001790.html">[rabbitmq-discuss] rabbitmq-server could do with an exec
</A></li>
	<LI>Next message: <A HREF="001781.html">[rabbitmq-discuss] Flow Control
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1778">[ date ]</a>
              <a href="thread.html#1778">[ thread ]</a>
              <a href="subject.html#1778">[ subject ]</a>
              <a href="author.html#1778">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
