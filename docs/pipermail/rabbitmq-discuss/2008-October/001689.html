<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbit_persister:extend_transaction in	chunks?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20rabbit_persister%3Aextend_transaction%20in%0A%09chunks%3F&In-Reply-To=84fb38e30810031915l577d4336wad198b70b75aad95%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001688.html">
   <LINK REL="Next"  HREF="001690.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbit_persister:extend_transaction in	chunks?</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20rabbit_persister%3Aextend_transaction%20in%0A%09chunks%3F&In-Reply-To=84fb38e30810031915l577d4336wad198b70b75aad95%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] rabbit_persister:extend_transaction in	chunks?">matthias at lshift.net
       </A><BR>
    <I>Sat Oct  4 05:22:28 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001688.html">[rabbitmq-discuss] rabbit_persister:extend_transaction in	chunks?
</A></li>
        <LI>Next message: <A HREF="001690.html">[rabbitmq-discuss] potentially stupid question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1689">[ date ]</a>
              <a href="thread.html#1689">[ thread ]</a>
              <a href="subject.html#1689">[ subject ]</a>
              <a href="author.html#1689">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Tsuraan,

tsuraan wrote:
&gt;&gt;<i> That would work, but why would you want to do that? Have you obtained
</I>&gt;&gt;<i> some measurements indicating that there is a performance problem in that
</I>&gt;&gt;<i> area?
</I>&gt;<i> 
</I>&gt;<i> No, not a performance issue, but a memory one.
</I>
The memory required for the list is linear in the size of the queue and 
independent of the message payload size (because payloads are binaries 
and thus not copied). So normally this shouldn't be an issue. But ...

&gt;<i> I have a file-based queue implementation now,
</I>
This changes things since it means the memory footprint of your queues 
is potentially constant rather than O(n), and you want to keep it that 
way. I understand the motivation for your question now.

&gt;<i> it looks like it's easy enough to drop into the
</I>&gt;<i> rabbit_amqqueue_process, with the exception of where it calls
</I>&gt;<i> queue:to_list in purge_message_buffer. I'd like to avoid having to
</I>&gt;<i> have the to_list called, and instead just grab a few (thousand)
</I>&gt;<i> messages at a time and call extend_transaction on the chunks.
</I>
It is safe to call extend_transaction and dirty_work (which is what 
actually gets called in the above case) multiple times. Also note that 
you do not need to materialise the entire messages - you just need their 
persistent_keys.


Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001688.html">[rabbitmq-discuss] rabbit_persister:extend_transaction in	chunks?
</A></li>
	<LI>Next message: <A HREF="001690.html">[rabbitmq-discuss] potentially stupid question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1689">[ date ]</a>
              <a href="thread.html#1689">[ thread ]</a>
              <a href="subject.html#1689">[ subject ]</a>
              <a href="author.html#1689">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
