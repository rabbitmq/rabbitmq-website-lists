<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Redelivery of unacknowledged messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Redelivery%20of%20unacknowledged%20messages&In-Reply-To=269388e30810022335i57fd37b2xc019aa811cabef1a%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001676.html">
   <LINK REL="Next"  HREF="001671.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Redelivery of unacknowledged messages</H1>
    <B>Jonatan Kallus</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Redelivery%20of%20unacknowledged%20messages&In-Reply-To=269388e30810022335i57fd37b2xc019aa811cabef1a%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Redelivery of unacknowledged messages">jonatan at heysan.com
       </A><BR>
    <I>Fri Oct  3 18:26:23 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001676.html">[rabbitmq-discuss] Redelivery of unacknowledged messages
</A></li>
        <LI>Next message: <A HREF="001671.html">[rabbitmq-discuss] Redelivery of unacknowledged messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1681">[ date ]</a>
              <a href="thread.html#1681">[ thread ]</a>
              <a href="subject.html#1681">[ subject ]</a>
              <a href="author.html#1681">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ben, Mathias, Gordon,

Thanks for your answers.

The system around the queue involves a few web servers using php to enqueue
messages at almost every page load and a single java application that
subscribes to the queue and makes one http request to another site for each
message. (To take load off from the web servers and to make their flow
asynchronous, in opposite to when they made the http request themselves.)
The http request usually takes around 50 ms, but sometimes more and
sometimes they fail or timeout after 60 s. We are using a number of
concurrent connections for the http client, not to let a single http request
timing out block the queue. The RabbitMQ subscriber starts threads that
handles the http requests as long as there are available http connections,
if there are no available http connections, the handleDelivery method waits
(while-loop) for a free connection, thus blocking from receiving more
messages until there is time to handle them.

Currently I acknowledge messages that results in a successful http request,
but any message that fails due to issues outside of our system (timeouts
etc.) does not get acknowledged, since we want them to be delivered again
later.

I am trying not to have any concept of a queue inside of the java
applications since that is the MQs responsibility and to avoid loss of
messages on a crash.

Since I started this thread I have realized that it might be smarter to
retry with messages that fail due to timeouts until they succeed instead of
throwing them away and wait for a redelivery.

It is not an issue of load balancing and to do it the way I do it now,
basic.reject is probably what I need.

I'm thankful for, and interested in, any thoughts and ideas.

On Thu, Oct 2, 2008 at 11:35 PM, Ben Hood &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">0x6e6562 at gmail.com</A>&gt; wrote:

&gt;<i> Matthias,
</I>&gt;<i>
</I>&gt;<i> On Fri, Oct 3, 2008 at 3:25 AM, Matthias Radestock &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; I am not at all sure that Basic.Reject is what Jonatan needs.
</I>&gt;<i>
</I>&gt;<i> Potentially not. I probably left too much of the original context of a
</I>&gt;<i> similar question that I answered off list last week. I did ask that
</I>&gt;<i> person I they would mind me turning their conversation into a list
</I>&gt;<i> topic for the benefit of everybody, but they never did get back to me.
</I>&gt;<i> So you and Gordon rightfully point out, it would be better if Jonatan
</I>&gt;<i> told us exactly what functionality his application requires.
</I>&gt;<i>
</I>&gt;<i> Ben
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081003/7029829d/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081003/7029829d/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001676.html">[rabbitmq-discuss] Redelivery of unacknowledged messages
</A></li>
	<LI>Next message: <A HREF="001671.html">[rabbitmq-discuss] Redelivery of unacknowledged messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1681">[ date ]</a>
              <a href="thread.html#1681">[ thread ]</a>
              <a href="subject.html#1681">[ subject ]</a>
              <a href="author.html#1681">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
