<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Topic routing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Topic%20routing&In-Reply-To=269388e30810221515k3e49552akecd6b25c7ce20671%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001788.html">
   <LINK REL="Next"  HREF="001776.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Topic routing</H1>
    <B>Brian Sullivan</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Topic%20routing&In-Reply-To=269388e30810221515k3e49552akecd6b25c7ce20671%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Topic routing">bsullivan at lindenlab.com
       </A><BR>
    <I>Wed Oct 22 23:23:15 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001788.html">[rabbitmq-discuss] Topic routing
</A></li>
        <LI>Next message: <A HREF="001776.html">[rabbitmq-discuss] rabbitmq-server could do with an exec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1789">[ date ]</a>
              <a href="thread.html#1789">[ thread ]</a>
              <a href="subject.html#1789">[ subject ]</a>
              <a href="author.html#1789">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Agreed on all of your points.  I am less worried about this being a  
showstopper for us now - I just want to have an idea of what options I  
might have to relieve pressure in this scenario.  Thanks for the  
thorough reply.  :)

Brian

On Oct 22, 2008, at 3:15 PM, Ben Hood wrote:

&gt;<i> Brian,
</I>&gt;<i>
</I>&gt;<i> On Wed, Oct 22, 2008 at 7:52 PM, Brian Sullivan &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">bsullivan at lindenlab.com</A> 
</I>&gt;<i> &gt; wrote:
</I>&gt;&gt;<i> I mean 3) number of actual topic keys that I publish on - if I need  
</I>&gt;&gt;<i> to add
</I>&gt;&gt;<i> some variables to the keys so I can distribute load across multiple  
</I>&gt;&gt;<i> queues
</I>&gt;&gt;<i> (&quot;mytopic.1&quot;, &quot;mytopic.2&quot;).  Some ideas I had here were a little  
</I>&gt;&gt;<i> funky and
</I>&gt;&gt;<i> might cause a multiplying of actual topic key strings that I use.   
</I>&gt;&gt;<i> One idea
</I>&gt;&gt;<i> was to use the publisher's hostname in the topic key (ex:  
</I>&gt;&gt;<i> &quot;mytopic.host123&quot;)
</I>&gt;&gt;<i> so that I could create a binding to &quot;mytopic.host*3&quot; to get ~1/10th  
</I>&gt;&gt;<i> the load
</I>&gt;&gt;<i> on each queue (however now that I think about it, I don't know if I  
</I>&gt;&gt;<i> can do
</I>&gt;&gt;<i> that with the wildcards anyways - I think * matches only full words  
</I>&gt;&gt;<i> in the
</I>&gt;&gt;<i> key, doesn't it?).
</I>&gt;<i>
</I>&gt;<i> Well, the O(n) I refer to is not option (3). The cost of routing a
</I>&gt;<i> message on a topic exchange is linear in the number of bindings,
</I>&gt;<i> irrespective of how many different routing keys you use.
</I>&gt;<i>
</I>&gt;<i> Whether foo.*.[0-9] delivers true load balancing will depend on the
</I>&gt;<i> relative frequency of each individual key on one side.
</I>&gt;<i>
</I>&gt;<i> On the other side, it will also depend on how homogeneous the capacity
</I>&gt;<i> of consumption is on each queue - the more heterogeneous this is, the
</I>&gt;<i> less load balancing you will experience.
</I>&gt;<i>
</I>&gt;<i> Though you could also imagine a situation whereby skew in the key
</I>&gt;<i> distribution is counteracted by heterogeneous queue throughput, thus
</I>&gt;<i> bringing balance into the system by accident.
</I>&gt;<i>
</I>&gt;<i> And you can imagine the opposite, when a skew distribution is
</I>&gt;<i> amplified by unbalanced queues.
</I>&gt;<i>
</I>&gt;<i> I don't know whether or not implementing load balancing via topic
</I>&gt;<i> matches will buy you much in terms of load balancing, so my advice is
</I>&gt;<i> to try it out and measure it.
</I>&gt;<i>
</I>&gt;<i> The reason why I say this is because to answer this with any certain
</I>&gt;<i> authority you would have to have intimate knowledge of how things get
</I>&gt;<i> pushed through the entire processing pipeline.
</I>&gt;<i>
</I>&gt;<i> As far as I can see you would definitely be increasing the effective
</I>&gt;<i> workload on ingress - proportional to the degree that you want to load
</I>&gt;<i> balance.
</I>&gt;<i>
</I>&gt;<i> On egress, I think the only gain you would see is when a queue cannot
</I>&gt;<i> farm work out quick enough to the consumers listening on it, which, if
</I>&gt;<i> you had QoS, would be less likely to happen.
</I>&gt;<i>
</I>&gt;<i> But having said that
</I>&gt;<i>
</I>&gt;<i> a) you mileage may vary;
</I>&gt;<i> b) you could use a bounded number of intelligently chosen wildcard
</I>&gt;<i> patterns (using a * for the last character will give you a load
</I>&gt;<i> balance of 1/n(charset) for randomly distributed keys);
</I>&gt;<i> c) topic caching is on the road map, persuasiveness has been known to
</I>&gt;<i> lead to re-prioritization;
</I>&gt;<i> d) one could implement a custom exchange type that is specifically
</I>&gt;<i> designed to do load balancing;
</I>&gt;<i> e) you might find that you don't need to do this yet before your real
</I>&gt;<i> needs aren't anywhere near the limits (but due diligence is always
</I>&gt;<i> good).
</I>&gt;<i>
</I>&gt;<i> BTW: * matches a single word, and # matches zero or more words.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Regardless, as long as a binding to &quot;mytopic.*&quot; counts as one  
</I>&gt;&gt;<i> binding in
</I>&gt;&gt;<i> your O(n), even if I have M topics (mytopic.1, ... mytopic.m), then  
</I>&gt;&gt;<i> I think
</I>&gt;&gt;<i> I'm good with whatever oddball scheme I come up with.
</I>&gt;<i>
</I>&gt;<i> As indicated above, this is correct way to view the O(n) - the number
</I>&gt;<i> of bindings.
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Ben
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001788.html">[rabbitmq-discuss] Topic routing
</A></li>
	<LI>Next message: <A HREF="001776.html">[rabbitmq-discuss] rabbitmq-server could do with an exec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1789">[ date ]</a>
              <a href="thread.html#1789">[ thread ]</a>
              <a href="subject.html#1789">[ subject ]</a>
              <a href="author.html#1789">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
