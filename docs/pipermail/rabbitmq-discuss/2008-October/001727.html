<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Catching channel disconnect
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Catching%20channel%20disconnect&In-Reply-To=269388e30810141554n74aa1360h58e6be51a7c6145b%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001726.html">
   <LINK REL="Next"  HREF="001728.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Catching channel disconnect</H1>
    <B>Valentino Volonghi</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Catching%20channel%20disconnect&In-Reply-To=269388e30810141554n74aa1360h58e6be51a7c6145b%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Catching channel disconnect">dialtone at gmail.com
       </A><BR>
    <I>Wed Oct 15 00:31:56 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001726.html">[rabbitmq-discuss] Catching channel disconnect
</A></li>
        <LI>Next message: <A HREF="001728.html">[rabbitmq-discuss] Catching channel disconnect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1727">[ date ]</a>
              <a href="thread.html#1727">[ thread ]</a>
              <a href="subject.html#1727">[ subject ]</a>
              <a href="author.html#1727">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


On Oct 14, 2008, at 3:54 PM, Ben Hood wrote:

&gt;<i> Valentino,
</I>&gt;<i>
</I>&gt;<i> On Tue, Oct 14, 2008 at 10:23 PM, Valentino Volonghi &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dialtone at gmail.com</A> 
</I>&gt;<i> &gt; wrote:
</I>&gt;&gt;<i> This all works fine until I shut down the remote host, then shovel
</I>&gt;&gt;<i> crashes
</I>&gt;&gt;<i> and I can't see how to recover it.
</I>&gt;<i>
</I>&gt;<i> You may be running into the same issue that has been addressed in
</I>&gt;<i> branch 19251 (which is awaiting QA before being folded back into the
</I>&gt;<i> trunk).
</I>

Well, I can see that with the patch what would happen is that at the  
exact moment
of the disconnect the process would crash and then would be restarted  
instead of
waiting until a tx_select() fails to then restart everything.

This is fine and more in line with what I would expect, it's just that  
even in this case
erlang appears to not have any kind of exponential backoff  
reconnection strategy.

Basically when it restarts it tries to connect to the remote rabbitmq  
instance and of course,
since it's down (in my test), it raises an econnrefused because no  
port is open. This is
all good and fine. I suspect that since econnrefused is an exception I  
should plug my
logic right there and catch it and start a loop there that runs until  
the connection is
established and use an exponential backoff to ask for new connections.

Do you think this makes sense?

- --
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: <A HREF="http://www.twisted.it">http://www.twisted.it</A>
<A HREF="http://www.adroll.com">http://www.adroll.com</A>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (Darwin)

iEYEARECAAYFAkj1K+wACgkQ9Llz28widGX/vgCfQCPv06ZNsG0nGGNNqYuLw07r
fWsAnAzgQHAQCWEUrpi6Fuf8wqc1E5jF
=4Wuz
-----END PGP SIGNATURE-----


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001726.html">[rabbitmq-discuss] Catching channel disconnect
</A></li>
	<LI>Next message: <A HREF="001728.html">[rabbitmq-discuss] Catching channel disconnect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1727">[ date ]</a>
              <a href="thread.html#1727">[ thread ]</a>
              <a href="subject.html#1727">[ subject ]</a>
              <a href="author.html#1727">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
