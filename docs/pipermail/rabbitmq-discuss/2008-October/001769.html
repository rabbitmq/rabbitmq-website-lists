<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Bug(?) in stopping multiple instances	of	rabbitmq-server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Bug%28%3F%29%20in%20stopping%20multiple%20instances%0A%09of%09rabbitmq-server&In-Reply-To=18686.27873.874961.524690%40jon.es">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001765.html">
   <LINK REL="Next"  HREF="001770.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Bug(?) in stopping multiple instances	of	rabbitmq-server</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Bug%28%3F%29%20in%20stopping%20multiple%20instances%0A%09of%09rabbitmq-server&In-Reply-To=18686.27873.874961.524690%40jon.es"
       TITLE="[rabbitmq-discuss] Bug(?) in stopping multiple instances	of	rabbitmq-server">matthias at lshift.net
       </A><BR>
    <I>Wed Oct 22 07:14:29 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001765.html">[rabbitmq-discuss] Bug(?) in stopping multiple instances of	rabbitmq-server
</A></li>
        <LI>Next message: <A HREF="001770.html">[rabbitmq-discuss] Bug(?) in stopping multiple instances	of	rabbitmq-server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1769">[ date ]</a>
              <a href="thread.html#1769">[ thread ]</a>
              <a href="subject.html#1769">[ subject ]</a>
              <a href="author.html#1769">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Terry Jones wrote:

&gt;<i> I can then stop it via *either*
</I>&gt;<i> 
</I>&gt;<i>     NODE_PORT=22222 ./rabbitmq-multi stop_all
</I>&gt;<i> or
</I>&gt;<i>     ./rabbitmq-multi stop_all
</I>&gt;<i> 
</I>&gt;<i> I'm not sure how it knows how to stop itself when I don't tell it the port
</I>&gt;<i> number. That's presumably logged somewhere.
</I>
rabbitmq-multi records the names of the nodes it has started. That's 
enough for Erlang to be able to subsequently connect to them.

&gt;<i>     # ./rabbitmq-multi start_all 1
</I>&gt;<i>     Starting all nodes...
</I>&gt;<i>     [snip]
</I>&gt;<i> 
</I>&gt;<i>     # NODENAME=fred NODE_PORT=30000 ./rabbitmq-multi start_all 1
</I>&gt;<i>     Starting all nodes...
</I>&gt;<i>     [snip]
</I>
That's a usage of rabbitmq-multi we hadn't thought of :)

rabbitmq-multi is designed to control *one set of* multiple nodes named 
NODENAME, NODENAME_1, ..., NODENAME_{N-1}, at ports NODE_PORT, 
NODE_PORT+1, ..., NODE_PORT+{N-1}.

The important bit here is the &quot;one set&quot;. What you are doing above is 
create *two* sets of nodes. The way rabbitmq-multi currently works, the 
record of node names for the second set will overwrite the first. That 
leads to the behaviour you saw:

&gt;<i>     # NODENAME=fred NODE_PORT=30000 ./rabbitmq-multi stop_all
</I>&gt;<i>     Stopping all nodes...
</I>&gt;<i>     [snip]
</I>&gt;<i> 
</I>&gt;<i>     # ./rabbitmq-multi stop_all
</I>&gt;<i>     Stopping all nodes...
</I>&gt;<i> 
</I>&gt;<i>     rabbit_multi action stop_all failed:
</I>&gt;<i>     no_nodes_running
</I>
When the second set of nodes was started the first set of nodes will 
have been forgotten.

Btw, there is no need to specify NODENAME etc in anything other than the 
start_all call.


For starting a several nodes with unrelated names and ports I recommend 
using the rabbitmq-server script, rather than rabbitmq-multi. You can 
stop the nodes individually with rabbitmqctl.


Regards,

Matthias


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001765.html">[rabbitmq-discuss] Bug(?) in stopping multiple instances of	rabbitmq-server
</A></li>
	<LI>Next message: <A HREF="001770.html">[rabbitmq-discuss] Bug(?) in stopping multiple instances	of	rabbitmq-server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1769">[ date ]</a>
              <a href="thread.html#1769">[ thread ]</a>
              <a href="subject.html#1769">[ subject ]</a>
              <a href="author.html#1769">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
