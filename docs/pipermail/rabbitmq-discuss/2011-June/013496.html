<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] is anybody using tx?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20is%20anybody%20using%20tx%3F&In-Reply-To=%3C4E0A3C6C.6040806%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013495.html">
   <LINK REL="Next"  HREF="013540.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] is anybody using tx?</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20is%20anybody%20using%20tx%3F&In-Reply-To=%3C4E0A3C6C.6040806%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] is anybody using tx?">matthias at rabbitmq.com
       </A><BR>
    <I>Tue Jun 28 21:41:16 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013495.html">[rabbitmq-discuss] is anybody using tx?
</A></li>
        <LI>Next message: <A HREF="013540.html">[rabbitmq-discuss] is anybody using tx?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13496">[ date ]</a>
              <a href="thread.html#13496">[ thread ]</a>
              <a href="subject.html#13496">[ subject ]</a>
              <a href="author.html#13496">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alessandro,

On 28/06/11 21:13, Alessandro Ranellucci wrote:
&gt;<i> On 28-06-2011 at 10:25, Matthias Radestock wrote:
</I>&gt;<i>  &gt;So in your app, can the messages inside a tx can end up in multiple
</I>&gt;<i>  &gt;queues?
</I>&gt;<i>
</I>&gt;<i> Yes, and I think it could be a common case. For example, a transaction
</I>&gt;<i> in my system may contain:
</I>&gt;<i> - a message to &quot;deliver.product.to.customer&quot;;
</I>&gt;<i> - a message to &quot;charge.prepaid.account&quot;;
</I>&gt;<i> - a message to &quot;notify.customer.by.sms&quot;.
</I>&gt;<i>
</I>&gt;<i> How could I handle that without AMQP transactions?
</I>
Well, you cannot actually handle that directly *with* an AMQP 
transaction *as defined in the spec*, since they guarantee atomicity for 
single-queue transactions only (though, as Gordon pointed out, 
implementations are free to extend that to multiple queues, which would 
then be sufficient to do the above).

One way to handle this scenario in RabbitMQ is to put the channel in 
'confirm' mode, send all three messages and wait for the confirmations. 
If there is a failure then re-send the messages that didn't get 
confirmed. That may result in duplicate messages (e.g. if a confirmation 
was lost due to a connection failure), so you'd need to make the 
messages idempotent / do dup detection at the consumer end. But then 
again message duplication is quite prevalent in messaging systems, so an 
app will likely have to deal with that anyway.

This technique is of course is not a direct replacements for 
fully-fledged transactions, but it works remarkably well in many situations.

Looking at your example though makes me wonder why an app would want 
these messages to be delivered atomically anyway. Surely one would want 
to charge the prepaid account first, then, *if that succeeds*, deliver 
the product, then *if that succeeds*, notify the customer. No?


Regards,

Matthias.
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013495.html">[rabbitmq-discuss] is anybody using tx?
</A></li>
	<LI>Next message: <A HREF="013540.html">[rabbitmq-discuss] is anybody using tx?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13496">[ date ]</a>
              <a href="thread.html#13496">[ thread ]</a>
              <a href="subject.html#13496">[ subject ]</a>
              <a href="author.html#13496">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
