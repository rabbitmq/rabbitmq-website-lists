<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] reading time extending on persistent messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20reading%20time%20extending%20on%20persistent%20messages&In-Reply-To=%3C20110630125847.GD18064%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013512.html">
   <LINK REL="Next"  HREF="013514.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] reading time extending on persistent messages</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20reading%20time%20extending%20on%20persistent%20messages&In-Reply-To=%3C20110630125847.GD18064%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] reading time extending on persistent messages">matthew at rabbitmq.com
       </A><BR>
    <I>Thu Jun 30 13:58:47 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013512.html">[rabbitmq-discuss] reading time extending on persistent messages
</A></li>
        <LI>Next message: <A HREF="013514.html">[rabbitmq-discuss] Send message from erlang client problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13562">[ date ]</a>
              <a href="thread.html#13562">[ thread ]</a>
              <a href="subject.html#13562">[ subject ]</a>
              <a href="author.html#13562">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Arno,

On Wed, Jun 29, 2011 at 03:34:08PM +0200, Arno Puschmann wrote:
&gt;<i> I'm using rabbitmq 2.4.1 on a Ubuntu 10.04. I tested to write  a large
</I>&gt;<i> number (300k) of messages to an persistent queue. Alle messages are
</I>&gt;<i> the same and have a size of 1KB. After this I restartet my system and
</I>&gt;<i> rabbitmq, to go save that nothing is on the memory but all on disk.
</I>&gt;<i> After restarting all, I startet a consumer to readout the messages.
</I>&gt;<i> Now I noticed that reading out the persistent messages took always
</I>&gt;<i> longer. I measured the time for reading out every interval of 3k
</I>&gt;<i> messages. For example, to readout the first 3k messages it took under
</I>&gt;<i> 1sec. After 45k messages it took over 10sec. to readout the next 3k
</I>&gt;<i> messages. After reading 165k messages it took about 30sec. to read the
</I>&gt;<i> next 3000 messages. I have repeat these test several times always with
</I>&gt;<i> a similar result.
</I>
I've used your consuming code that you supplied and repeated your test.
I did not reboot, but I did shut down rabbit and cleared out the caches.
I checked and Rabbit does sit there reading at 20MB/s off disk on
consuming.

I sent in 300,000 1KB persistent messages to a durable queue, then
safely shutdown Rabbit and restarted it, after clearing caches. I used
the Erlang client to publish and the Java client (with your code) to
consume the messages. The output I see is below.

Note that this is with the latest from default which will pretty much be
the same as 2.5.1. There haven't been any performance impacting changes
to the persistence layer for a little while. That said, there was quite
a gap between 2.4.1 and 2.5.0 so it may be something came in there.
Checking the release notes for 2.5.0 -
<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-June/013249.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-June/013249.html</A>
- there are a number of performance related items but nothing that
strikes as relevant to your test.

Are there any indicators in your RabbitMQ logs that suggest Rabbit's
under memory pressure? Is there contention for the disk drive? Maybe try
upgrading to 2.5.1 and see if that helps?

Best wishes,

Matthew

The last 3000 Messages needed 332
The last 3000 Messages needed 314
The last 3000 Messages needed 310
The last 3000 Messages needed 383
The last 3000 Messages needed 449
The last 3000 Messages needed 436
The last 3000 Messages needed 309
The last 3000 Messages needed 320
The last 3000 Messages needed 363
The last 3000 Messages needed 340
The last 3000 Messages needed 377
The last 3000 Messages needed 369
The last 3000 Messages needed 404
The last 3000 Messages needed 379
The last 3000 Messages needed 408
The last 3000 Messages needed 445
The last 3000 Messages needed 379
The last 3000 Messages needed 357
The last 3000 Messages needed 434
The last 3000 Messages needed 325
The last 3000 Messages needed 327
The last 3000 Messages needed 508
The last 3000 Messages needed 334
The last 3000 Messages needed 360
The last 3000 Messages needed 326
The last 3000 Messages needed 339
The last 3000 Messages needed 313
The last 3000 Messages needed 458
The last 3000 Messages needed 355
The last 3000 Messages needed 341
The last 3000 Messages needed 358
The last 3000 Messages needed 331
The last 3000 Messages needed 514
The last 3000 Messages needed 339
The last 3000 Messages needed 363
The last 3000 Messages needed 355
The last 3000 Messages needed 353
The last 3000 Messages needed 372
The last 3000 Messages needed 417
The last 3000 Messages needed 375
The last 3000 Messages needed 350
The last 3000 Messages needed 438
The last 3000 Messages needed 339
The last 3000 Messages needed 554
The last 3000 Messages needed 342
The last 3000 Messages needed 340
The last 3000 Messages needed 368
The last 3000 Messages needed 372
The last 3000 Messages needed 372
The last 3000 Messages needed 420
The last 3000 Messages needed 392
The last 3000 Messages needed 358
The last 3000 Messages needed 362
The last 3000 Messages needed 347
The last 3000 Messages needed 509
The last 3000 Messages needed 402
The last 3000 Messages needed 441
The last 3000 Messages needed 437
The last 3000 Messages needed 373
The last 3000 Messages needed 359
The last 3000 Messages needed 657
The last 3000 Messages needed 345
The last 3000 Messages needed 461
The last 3000 Messages needed 384
The last 3000 Messages needed 459
The last 3000 Messages needed 648
The last 3000 Messages needed 361
The last 3000 Messages needed 369
The last 3000 Messages needed 396
The last 3000 Messages needed 407
The last 3000 Messages needed 436
The last 3000 Messages needed 376
The last 3000 Messages needed 369
The last 3000 Messages needed 409
The last 3000 Messages needed 407
The last 3000 Messages needed 378
The last 3000 Messages needed 542
The last 3000 Messages needed 391
The last 3000 Messages needed 430
The last 3000 Messages needed 389
The last 3000 Messages needed 384
The last 3000 Messages needed 480
The last 3000 Messages needed 391
The last 3000 Messages needed 434
The last 3000 Messages needed 417
The last 3000 Messages needed 387
The last 3000 Messages needed 409
The last 3000 Messages needed 609
The last 3000 Messages needed 411
The last 3000 Messages needed 472
The last 3000 Messages needed 388
The last 3000 Messages needed 399
The last 3000 Messages needed 456
The last 3000 Messages needed 430
The last 3000 Messages needed 400
The last 3000 Messages needed 420
The last 3000 Messages needed 394
The last 3000 Messages needed 426
The last 3000 Messages needed 434
The last 3000 Messages needed 416

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013512.html">[rabbitmq-discuss] reading time extending on persistent messages
</A></li>
	<LI>Next message: <A HREF="013514.html">[rabbitmq-discuss] Send message from erlang client problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13562">[ date ]</a>
              <a href="thread.html#13562">[ thread ]</a>
              <a href="subject.html#13562">[ subject ]</a>
              <a href="author.html#13562">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
