<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] message via stomp adapter crashes queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20message%20via%20stomp%20adapter%20crashes%20queue&In-Reply-To=%3C4DFB135A.6070402%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013282.html">
   <LINK REL="Next"  HREF="013283.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] message via stomp adapter crashes queue</H1>
    <B>Rob Harrop</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20message%20via%20stomp%20adapter%20crashes%20queue&In-Reply-To=%3C4DFB135A.6070402%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] message via stomp adapter crashes queue">rob at rabbitmq.com
       </A><BR>
    <I>Fri Jun 17 09:42:02 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013282.html">[rabbitmq-discuss] message via stomp adapter crashes queue
</A></li>
        <LI>Next message: <A HREF="013283.html">[rabbitmq-discuss] message via stomp adapter crashes queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13310">[ date ]</a>
              <a href="thread.html#13310">[ thread ]</a>
              <a href="subject.html#13310">[ subject ]</a>
              <a href="author.html#13310">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Chris,

This is what you see against 2.1?

The bug you linked to is not present in 2.1, it was introduced in 2.2 
but is fixed since 2.4.1 (or maybe 2.4.0).

The log doesn't seem to be saying anything interesting about queues 
crashing, simply that the parser thinks the incoming frame is corrupted. 
In particular, it looks like the header key has a newline in it, which 
is definitely not allowed.

Do you have a few sample frames that you could send me.

The best solution to this is to find out why you can't run against 
2.5.0. The parser was much updated to support STOMP 1.1 recently and to 
handle some clarifications around handling of extraneous newlines and such.

Rob

Chris wrote:
&gt;<i>
</I>&gt;<i> Thank you for the response Rob.
</I>&gt;<i>
</I>&gt;<i> Not sure exactly, but I know that if we move past 2.1.0 and the
</I>&gt;<i> matching stomp plugin things get worse. I'm just the guy that has to
</I>&gt;<i> keep this thing running and not the developer of the stomp client
</I>&gt;<i> pushing data at the rabbit stomp adapter or the clients on the other
</I>&gt;<i> side doing amqp. I'll try again to get the details on what's keeping
</I>&gt;<i> us stuck at this version.
</I>&gt;<i>
</I>&gt;<i> In the meantime this is what we see when the Queue goes away:
</I>&gt;<i>
</I>&gt;<i> 10:49&lt; arreyder&gt; =ERROR REPORT==== 15-Jun-2011::15:46:12 ===
</I>&gt;<i> 10:49&lt; arreyder&gt; STOMP error frame sent:
</I>&gt;<i> 10:49&lt; arreyder&gt; Message: &quot;Invalid frame&quot;
</I>&gt;<i> 10:49&lt; arreyder&gt; Detail: &quot;Could not parse frame\n&quot;
</I>&gt;<i> 10:49&lt; arreyder&gt; Server private detail:
</I>&gt;<i> {bad_header_key,&quot;destinaSEND&quot;}
</I>&gt;<i> 10:49&lt; arreyder&gt; &quot;detinaSEND&quot;
</I>&gt;<i> 10:51&lt; arreyder&gt; here's the one from just before that one:
</I>&gt;<i> 10:51&lt; arreyder&gt; =ERROR REPORT==== 15-Jun-2011::15:31:11 ===
</I>&gt;<i> 10:51&lt; arreyder&gt; STOMP error frame sent:
</I>&gt;<i> 10:51&lt; arreyder&gt; Message: &quot;Invalid frame&quot;
</I>&gt;<i> 10:51&lt; arreyder&gt; Detail: &quot;Could not parse frame\n&quot;
</I>&gt;<i> 10:51&lt; arreyder&gt; Server private detail:
</I>&gt;<i> {bad_header_key,&quot;destinationSEND&quot;}
</I>&gt;<i>
</I>&gt;<i> I've verified on the wire (packet captures) that the message headers
</I>&gt;<i> do not look like how they are logged there. They appear correctly
</I>&gt;<i> sent.
</I>&gt;<i>
</I>&gt;<i> crr
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013282.html">[rabbitmq-discuss] message via stomp adapter crashes queue
</A></li>
	<LI>Next message: <A HREF="013283.html">[rabbitmq-discuss] message via stomp adapter crashes queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13310">[ date ]</a>
              <a href="thread.html#13310">[ thread ]</a>
              <a href="subject.html#13310">[ subject ]</a>
              <a href="author.html#13310">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
