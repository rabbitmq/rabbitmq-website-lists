<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Starts slow, but then fast.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Starts%20slow%2C%20but%20then%20fast.&In-Reply-To=%3C4DF7736F.6040506%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013238.html">
   <LINK REL="Next"  HREF="013241.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Starts slow, but then fast.</H1>
    <B>Tim Fox</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Starts%20slow%2C%20but%20then%20fast.&In-Reply-To=%3C4DF7736F.6040506%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Starts slow, but then fast.">tim at rabbitmq.com
       </A><BR>
    <I>Tue Jun 14 15:42:55 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013238.html">[rabbitmq-discuss] Starts slow, but then fast.
</A></li>
        <LI>Next message: <A HREF="013241.html">[rabbitmq-discuss] RabbitMQ as a reliable message queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13239">[ date ]</a>
              <a href="thread.html#13239">[ thread ]</a>
              <a href="subject.html#13239">[ subject ]</a>
              <a href="author.html#13239">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If you're starting a JVM every time you run the producer code, then the 
delay is probably because the VM hasn't had time to &quot;warm up&quot; and the 
JIT to kick in.

JIT can take 10s of seconds to minutes to really kick in and get the 
best benefit. (This is one reason why JVM is not really suited to 
scripting applications).

This is why when running any benchmarks it's always sensible to your let 
your client application warm up by sending and consuming messages for a 
minute or more before you start taking measurements.

On 14/06/11 15:33, Robert wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I did the &quot;Hello, World&quot; - Example from 
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/tutorials/tutorial-one-java.html">http://www.rabbitmq.com/tutorials/tutorial-one-java.html</A>
</I>&gt;<i>
</I>&gt;<i> and only added to send the message 100000 times.
</I>&gt;<i>
</I>&gt;<i> Any ideas on the following behaviour:
</I>&gt;<i>
</I>&gt;<i> The first couple of hundred messages being received pretty slowly (per 
</I>&gt;<i> 100 messages 2-3 seconds), then it improves up to a couple thausand 
</I>&gt;<i> messages a little bit (per 1000 messages 2-3 seconds), but then - peng 
</I>&gt;<i> - from around 8000 messages it is extremly fast (rest in about 1 
</I>&gt;<i> second !!!).
</I>&gt;<i>
</I>&gt;<i> And it doesn't matter if I ran the producer code 1 time or a couple 
</I>&gt;<i> times. It is always the same bahaviour. (Also, the producers loop is 
</I>&gt;<i> done much before all messages being consumed - so, it looks as the 
</I>&gt;<i> sending is fast).
</I>&gt;<i>
</I>&gt;<i> What is going on. Any ideas ?
</I>&gt;<i>
</I>&gt;<i> Cheers, Rob.
</I>&gt;<i>
</I>&gt;<i> Here my code (but in Scala):
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> object ConsumerTest {
</I>&gt;<i>   val QUEUE_NAME = &quot;robs_queue&quot;
</I>&gt;<i>
</I>&gt;<i>   def main(args: Array[String]) {
</I>&gt;<i>     val factory = new ConnectionFactory();
</I>&gt;<i>     factory.setHost(&quot;localhost&quot;);
</I>&gt;<i>     val connection = factory.newConnection();
</I>&gt;<i>     val channel = connection.createChannel();
</I>&gt;<i>     channel.queueDeclare(AMQPTesterRaw.QUEUE_NAME, false, false, 
</I>&gt;<i> false, null)
</I>&gt;<i>
</I>&gt;<i>     val consumer = new QueueingConsumer(channel)
</I>&gt;<i>     channel.basicConsume(AMQPTesterRaw.QUEUE_NAME, true, consumer)
</I>&gt;<i>
</I>&gt;<i>     while(true){
</I>&gt;<i>       val del = consumer.nextDelivery();
</I>&gt;<i>       println(&quot;arrived = &quot; + new String(del.getBody))
</I>&gt;<i>     }
</I>&gt;<i>
</I>&gt;<i>   }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> object ProducerTest {
</I>&gt;<i>   def main(args: Array[String]) {
</I>&gt;<i>     val factory = new ConnectionFactory();
</I>&gt;<i>     factory.setHost(&quot;localhost&quot;);
</I>&gt;<i>     val connection = factory.newConnection();
</I>&gt;<i>     val channel = connection.createChannel();
</I>&gt;<i>     channel.queueDeclare(AMQPTesterRaw.QUEUE_NAME, false, false, 
</I>&gt;<i> false, null)
</I>&gt;<i>
</I>&gt;<i>     for(x &lt;- 1 to 100000){
</I>&gt;<i>       val msg = &quot;Hello World(&quot; + x + &quot;)&quot;
</I>&gt;<i>       channel.basicPublish(&quot;&quot;, AMQPTesterRaw.QUEUE_NAME, null, 
</I>&gt;<i> msg.getBytes)
</I>&gt;<i>     }
</I>&gt;<i>
</I>&gt;<i>     channel.close()
</I>&gt;<i>     connection.close()
</I>&gt;<i>
</I>&gt;<i>   }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013238.html">[rabbitmq-discuss] Starts slow, but then fast.
</A></li>
	<LI>Next message: <A HREF="013241.html">[rabbitmq-discuss] RabbitMQ as a reliable message queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13239">[ date ]</a>
              <a href="thread.html#13239">[ thread ]</a>
              <a href="subject.html#13239">[ subject ]</a>
              <a href="author.html#13239">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
