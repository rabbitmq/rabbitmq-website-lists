<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] use rabbit.config file to start multiple nodes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20use%20rabbit.config%20file%20to%20start%20multiple%0A%20nodes&In-Reply-To=%3C676E1597FDBED54694CBA16B69DE71C302E05F%40PTGMAIL02v.protegra.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013355.html">
   <LINK REL="Next"  HREF="013301.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] use rabbit.config file to start multiple nodes</H1>
    <B>Jason Klassen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20use%20rabbit.config%20file%20to%20start%20multiple%0A%20nodes&In-Reply-To=%3C676E1597FDBED54694CBA16B69DE71C302E05F%40PTGMAIL02v.protegra.com%3E"
       TITLE="[rabbitmq-discuss] use rabbit.config file to start multiple nodes">Jason.Klassen at protegra.com
       </A><BR>
    <I>Thu Jun 16 16:47:38 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013355.html">[rabbitmq-discuss] Question on who usually manages brokers
</A></li>
        <LI>Next message: <A HREF="013301.html">[rabbitmq-discuss] 2.4.1, RABBITMQ_SERVER_START_ARGS,	and the management plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13300">[ date ]</a>
              <a href="thread.html#13300">[ thread ]</a>
              <a href="subject.html#13300">[ subject ]</a>
              <a href="author.html#13300">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Simon,

Thanks for the insight.  Looks like it's Plan B then.  I modified the rabbitmq-server.bat and created rabbitmq-multi-server.bat to take parameters of nodename and port.   It would be handy to have future batch files include the ability to use named parameters instead of relying on environment variables. so we can do:

...\sbin&gt;rabbitmq-server -port=5555 -sname=testRabbit -startargs='-rabbitmq_mochiweb port 55555'

With this in place I can now start 2 servers by calling

...\sbin&gt; rabbitmq-multi-server rabbit1 4444
...\sbin&gt; rabbitmq-multi-server rabbit2 5555

Not the most flexible but it works.  In case it's of use to anyone else the contents are below. Replace setlocal enabledelayedexpansion  with the below snippet in rabbitmq-server 

setlocal enabledelayedexpansion 

rem ************
rem hacking around config
rem ************

set USER_NODENAME=rabbit
if not &quot;%1&quot;==&quot;&quot; (
    set USER_NODENAME=%1
)

set USER_PORT=5672
if not &quot;%2&quot;==&quot;&quot; (
    set USER_PORT=%2
)

if &quot;!RABBITMQ_BASE!&quot;==&quot;&quot; (
    set RABBITMQ_BASE=!APPDATA!\RabbitMQ
)

if &quot;!COMPUTERNAME!&quot;==&quot;&quot; (
    set COMPUTERNAME=localhost
)

if &quot;!RABBITMQ_NODENAME!&quot;==&quot;&quot; (
    set RABBITMQ_NODENAME=!USER_NODENAME!@!COMPUTERNAME!
)

if &quot;!RABBITMQ_NODE_PORT!&quot;==&quot;&quot; (
    set RABBITMQ_NODE_PORT=!USER_PORT!
)

rem ************
rem end of hacking around config
rem ************

Note: if you run the rabbitMQ management plugin you'll need some additional handling to prevent conflicts with multiple launches of that as well.

Cheers,
Jason

-----Original Message-----
From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A> [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] On Behalf Of Simon MacMullen
Sent: June-16-11 5:14 AM
To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] use rabbit.config file to start multiple nodes

On 15/06/11 22:51, Jason Klassen wrote:
&gt;<i> How do I set the nodename through the config file?
</I>
I'm afraid you can't do that. (Boring reason why: the nodename is set as the process starts up, before we read the config file.)

&gt;<i> How can I set 2 nodes in a single config file?
</I>
...and you also can't do that.

&gt;<i> I am trying to avoid setting environment variables as this solution 
</I>&gt;<i> should be easily run by other developers and a config file removes the 
</I>&gt;<i> chance of typos.
</I>
That makes sense. In future we might move to preprocessing the config file somehow so that nodename can be set that way.

Probably your best bet is to write a script to start nodes in the way you want.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013355.html">[rabbitmq-discuss] Question on who usually manages brokers
</A></li>
	<LI>Next message: <A HREF="013301.html">[rabbitmq-discuss] 2.4.1, RABBITMQ_SERVER_START_ARGS,	and the management plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13300">[ date ]</a>
              <a href="thread.html#13300">[ thread ]</a>
              <a href="subject.html#13300">[ subject ]</a>
              <a href="author.html#13300">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
