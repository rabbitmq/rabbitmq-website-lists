<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Redudancy solutions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Redudancy%20solutions&In-Reply-To=%3C20110615113432.GA8842%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013207.html">
   <LINK REL="Next"  HREF="013219.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Redudancy solutions</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Redudancy%20solutions&In-Reply-To=%3C20110615113432.GA8842%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Redudancy solutions">matthew at rabbitmq.com
       </A><BR>
    <I>Wed Jun 15 12:34:32 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013207.html">[rabbitmq-discuss] Redudancy solutions
</A></li>
        <LI>Next message: <A HREF="013219.html">[rabbitmq-discuss] Compile rabbitmq-erlang-client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13260">[ date ]</a>
              <a href="thread.html#13260">[ thread ]</a>
              <a href="subject.html#13260">[ subject ]</a>
              <a href="author.html#13260">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Joseph,

On Fri, Jun 10, 2011 at 08:21:58AM -0700, Joseph Marlin wrote:
&gt;<i> I'm looking for some insight on different ways of achieving a HA
</I>&gt;<i> RabbitMQ setup without using DRBD. Because of our current setup, doing
</I>&gt;<i> that kind of configuration would be very difficult to achieve.
</I>&gt;<i> 
</I>&gt;<i> I'd really like to get a setup where if one machine goes down, another
</I>&gt;<i> machine can immediately take over, retaining the exact state of
</I>&gt;<i> RabbitMQ on the failed machine when it went down.
</I>
I'd like that too. However, the &quot;exact state&quot; includes things like open
file descriptors, including sockets etc, which is rather difficult to
migrate in this way. The only thing that I'm aware of that might come
close to working for this is the FT feature in VMware vSphere
(<A HREF="http://www.vmware.com/products/fault-tolerance/overview.html">http://www.vmware.com/products/fault-tolerance/overview.html</A>).

Even the upcoming active/active HA, which offers RAID-1-style mirroring
of queues will not migrate consumers of those queues in the event of
failure. It's just too damn hard.

&gt;<i> My latest attempt at a redudant solution was two completely separate,
</I>&gt;<i> identical, RabbitMQ setups. A publisher pushed messages to the queues
</I>&gt;<i> of each independent node at the same time. I also had a Cassandra
</I>&gt;<i> cluster node installed on each node. Before a consumer would handle a
</I>&gt;<i> message, it would check in with the Cassandra database to ensure that
</I>&gt;<i> it had not already been handled. This worked fine at extremely slow
</I>&gt;<i> speeds, but at anything above 50 messages/sec, there were simply way
</I>&gt;<i> too many double-handled messages, which are not acceptable.
</I>
Yup. You might also try zookeeper but that too I think is going to be
too slow - my understanding is that paxos is quite chatty.

There are clever ways of partitioning the workload though which, whilst
they end up rather complicated, can be made to work. The basic idea is
that you have all your consumers consume from all the duplicate queues.
They then only act on a message if they get sufficient copies of the
same message that they can prove no one else will get more copies. That
works quite nicely, but you have to ensure there can be no draws. So for
example, 2 consumers both subscribed to the same 3 queues is fine
because the outcomes are (0,3), (1,2), (2,1) and (3,0) - there's always
a clear winner. But 2 consumers both subscribe to 2 queues can result in
draws and then you have to do cleverer things to resolve such issues.

If I were you, I'd wait for the upcoming active/active HA stuff to land
before going down the above route.

&gt;<i> Is there an alternative to HA that doesn't involve DRBD/Pacemaker/etc?
</I>
Well, other than what's due to arrive shortly. But you can always use
Pacemaker without DRBD - any sort of reliable SAN/NAS thingy should
work ok.

Matthew
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013207.html">[rabbitmq-discuss] Redudancy solutions
</A></li>
	<LI>Next message: <A HREF="013219.html">[rabbitmq-discuss] Compile rabbitmq-erlang-client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13260">[ date ]</a>
              <a href="thread.html#13260">[ thread ]</a>
              <a href="subject.html#13260">[ subject ]</a>
              <a href="author.html#13260">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
