<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] How can I set socket timeouts in PHP using the AMQP PHP extension?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20can%20I%20set%20socket%20timeouts%20in%20PHP%20using%0A%20the%20AMQP%20PHP%20extension%3F&In-Reply-To=%3CA03783F8664B4022A4094188D8A718E7%40myyearbook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013497.html">
   <LINK REL="Next"  HREF="013509.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] How can I set socket timeouts in PHP using the AMQP PHP extension?</H1>
    <B>Gavin M. Roy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20can%20I%20set%20socket%20timeouts%20in%20PHP%20using%0A%20the%20AMQP%20PHP%20extension%3F&In-Reply-To=%3CA03783F8664B4022A4094188D8A718E7%40myyearbook.com%3E"
       TITLE="[rabbitmq-discuss] How can I set socket timeouts in PHP using the AMQP PHP extension?">gmr at myyearbook.com
       </A><BR>
    <I>Wed Jun 29 04:08:36 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013497.html">[rabbitmq-discuss] How can I set socket timeouts in PHP using the	AMQP PHP extension?
</A></li>
        <LI>Next message: <A HREF="013509.html">[rabbitmq-discuss] How can I set socket timeouts in PHP using the AMQP PHP extension?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13501">[ date ]</a>
              <a href="thread.html#13501">[ thread ]</a>
              <a href="subject.html#13501">[ subject ]</a>
              <a href="author.html#13501">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>While not directly related to your question and you've not specified your use case, I have found trying to use native AMQP drivers in my PHP application as having too much overhead for connection management and iirc the existing implementations do not have connection pooling. This means lots of startup time and overhead on every request. To get around this we created a HTTP library that talks to the RabbitMQ JSON RPC Channel plugin. If all you are doing is publishing, you might want to check out VorpalBunny:
<A HREF="https://github.com/myyearbook/VorpalBunny/">https://github.com/myyearbook/VorpalBunny/</A>
As far as the underlying implementation, it's worth noting that the rabbitmq-c library is considered experimental. While we use it in our C applications in production, I can't say that we use the PHP extension on top of it. The PHP site has fatal errors for me right now so I can't look up to see which PHP extension the code is based on, otherwise I'd poke into the code and let you know if there are any timeout settings.
Gavin
On Tuesday, June 28, 2011 at 6:44 PM, Keith Krueger wrote:
&gt;<i> I am using the PHP AMQP extension, as described here:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://php.net/manual/en/book.amqp.php">http://php.net/manual/en/book.amqp.php</A>
</I>&gt;<i> 
</I>&gt;<i> This PHP extension uses the rabbitmq-c library as its underlying implementation.
</I>&gt;<i> 
</I>&gt;<i> I would like to set socket timeouts for connection establishment and for each of my enqueues and dequeues. I want to do this in case our server performance degrades, to allow the clients to fail quickly rather than hang.
</I>&gt;<i> 
</I>&gt;<i> Does anyone have experience doing this in a PHP environment? I have tried setting the PHP socket timeout as follows.
</I>&gt;<i> 
</I>&gt;<i>  ini_set('default_socket_timeout', 5);
</I>&gt;<i> 
</I>&gt;<i> This appears to have no impact on the PHP extension's timeout settings. I am still able to enqueue a multi-megabyte MQ message to rabbitmq without losing the socket connection. It takes about 75 seconds to enqueue this message, but the socket is kept open the entire time.
</I>&gt;<i> 
</I>&gt;<i> Is there any support either in the PHP AMQP extension or in a different PHP setting that I can use to reduce the timeouts for our interactions with RabbitMQ? I'd rather not live with a potential problem of hanging client processes if I can avoid it. 
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> 
</I>&gt;<i> -Keith
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A> (mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>)
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013497.html">[rabbitmq-discuss] How can I set socket timeouts in PHP using the	AMQP PHP extension?
</A></li>
	<LI>Next message: <A HREF="013509.html">[rabbitmq-discuss] How can I set socket timeouts in PHP using the AMQP PHP extension?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13501">[ date ]</a>
              <a href="thread.html#13501">[ thread ]</a>
              <a href="subject.html#13501">[ subject ]</a>
              <a href="author.html#13501">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
