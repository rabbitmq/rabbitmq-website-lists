<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Persistent messages and durable queue	questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Persistent%20messages%20and%20durable%20queue%0A%09questions&In-Reply-To=%3C4E01A49C.9010402%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013371.html">
   <LINK REL="Next"  HREF="013432.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Persistent messages and durable queue	questions</H1>
    <B>Rob Harrop</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Persistent%20messages%20and%20durable%20queue%0A%09questions&In-Reply-To=%3C4E01A49C.9010402%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Persistent messages and durable queue	questions">rob at rabbitmq.com
       </A><BR>
    <I>Wed Jun 22 09:15:24 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013371.html">[rabbitmq-discuss] Persistent messages and durable queue questions
</A></li>
        <LI>Next message: <A HREF="013432.html">[rabbitmq-discuss] Persistent messages and durable queue	questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13373">[ date ]</a>
              <a href="thread.html#13373">[ thread ]</a>
              <a href="subject.html#13373">[ subject ]</a>
              <a href="author.html#13373">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

Elias Levy wrote:
&gt;<i> Good day,
</I>&gt;<i>
</I>&gt;<i> I was wondering whether someone my know the answer to the following
</I>&gt;<i> questions.  I've read the FAQ and manuals, but they are not completely
</I>&gt;<i> clear.
</I>&gt;<i>
</I>&gt;<i> The first question is does a persistent message will hit the disk even
</I>&gt;<i> if there is a consumer on the queue the message is being delivered to,
</I>&gt;<i> and do automatic acknowledgements (i.e. no-wait) make a difference?
</I>&gt;<i>
</I>&gt;<i> We are in a situation where writing to disk is expensive, and usually
</I>&gt;<i> there will be a waiting and willing consumer attached to the queue, but
</I>&gt;<i> we are not using automatic acks, rather we ack the message when the
</I>&gt;<i> consumer has processed it, which may take a second or two.  So we'd like
</I>&gt;<i> to know whether in the common case in this situation messages will be
</I>&gt;<i> written to disk or not.
</I>&gt;<i>
</I>&gt;<i> The docs are unclear.  One could interpret them to mean that if there is
</I>&gt;<i> a willing consumer the message will not be written to disk, but its
</I>&gt;<i> unclear if this requires no-wait to be true.
</I>
When there is a consumer ready to receive the message, the message will 
only be written to disk if:

1. The queue is durable
2. The message is peristent
3. Automatic ack is disabled

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The second question is what happens to persistent messages coming in
</I>&gt;<i> through a node that are to be routed to a durable queue attached to a
</I>&gt;<i> different node?
</I>&gt;<i>
</I>&gt;<i> I believe this is answered by a question in the FAQ, &quot;What happens to
</I>&gt;<i> messages when a network outage removes the route between an exchange and
</I>&gt;<i> a bound queue?&quot;, which states that the messages will be silently dropped
</I>&gt;<i> unless I set the mandatory flag on basic.publish.
</I>&gt;<i>
</I>&gt;<i> Alas, that is not feasible in our use-case.  We are publishing to a
</I>&gt;<i> topic exchange and creating bindings to to match a subset of the
</I>&gt;<i> published messages to some durable queues.  Thus, we actually expect
</I>&gt;<i> many messages to be routed to no queue.  Even if we set the mandatory
</I>&gt;<i> flag, we'd not be able to tell whether the error received by the
</I>&gt;<i> publisher was a result of no binding matching the message (a normal
</I>&gt;<i> condition) or the loss a node, along with all the queues and bindings
</I>&gt;<i> associated with it (an exceptional condition).
</I>&gt;<i>
</I>
You can use publisher confirms to allow your application code to know 
when a message has successfully been routed or when it has been lost.

See: <A HREF="http://www.rabbitmq.com/extensions.html#confirms">http://www.rabbitmq.com/extensions.html#confirms</A>

&gt;<i> Any suggestions on how to handle this issue and distinguish between
</I>&gt;<i> these two conditions?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Elias Levy
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013371.html">[rabbitmq-discuss] Persistent messages and durable queue questions
</A></li>
	<LI>Next message: <A HREF="013432.html">[rabbitmq-discuss] Persistent messages and durable queue	questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13373">[ date ]</a>
              <a href="thread.html#13373">[ thread ]</a>
              <a href="subject.html#13373">[ subject ]</a>
              <a href="author.html#13373">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
