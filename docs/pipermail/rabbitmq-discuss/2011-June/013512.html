<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] reading time extending on persistent messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20reading%20time%20extending%20on%20persistent%20messages&In-Reply-To=%3C27D6B27DB616654BBEF4DDB8B31EAF916B590E951E%40vs-msx01.IT-NG.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013508.html">
   <LINK REL="Next"  HREF="013562.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] reading time extending on persistent messages</H1>
    <B>Arno Puschmann</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20reading%20time%20extending%20on%20persistent%20messages&In-Reply-To=%3C27D6B27DB616654BBEF4DDB8B31EAF916B590E951E%40vs-msx01.IT-NG.local%3E"
       TITLE="[rabbitmq-discuss] reading time extending on persistent messages">arno.puschmann at acodeas.de
       </A><BR>
    <I>Wed Jun 29 14:34:08 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013508.html">[rabbitmq-discuss] How can I set socket timeouts in PHP using the AMQP PHP extension?
</A></li>
        <LI>Next message: <A HREF="013562.html">[rabbitmq-discuss] reading time extending on persistent messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13512">[ date ]</a>
              <a href="thread.html#13512">[ thread ]</a>
              <a href="subject.html#13512">[ subject ]</a>
              <a href="author.html#13512">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm using rabbitmq 2.4.1 on a Ubuntu 10.04. I tested to write  a large number (300k) of messages to an persistent queue. Alle messages are the same and have a size of 1KB. After this I restartet my system and rabbitmq, to go save that nothing is on the memory but all on disk. After restarting all, I startet a consumer to readout the messages. Now I noticed that reading out the persistent messages took always longer. I measured the time for reading out every interval of 3k messages. For example, to readout the first 3k messages it took under 1sec. After 45k messages it took over 10sec. to readout the next 3k messages. After reading 165k messages it took about 30sec. to read the next 3000 messages. I have repeat these test several times always with a similar result.

Can anybody explain these behaviour or have a solution for this problem?
I tried also ActiveMQ and HornetQ under the same requirements without such behaviour.
Thanks.

Here my programmcode

	ConnectionFactory factory = new ConnectionFactory();
	factory.setHost(&quot;localhost&quot;);

	Connection connection = factory.newConnection();
	Channel channel = connection.createChannel();

	QueueingConsumer consumer = new QueueingConsumer(channel);
	channel.exchangeDeclare(EXCHANGE_NAME, &quot;direct&quot;, true);
	channel.queueDeclare(QUEUE_NAME, true, false, false, null);
	channel.basicConsume(QUEUE_NAME, true, consumer);
	channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, &quot;111&quot;);

	System.out.println(&quot; [*] Waiting for messages. To exit press CTRL+C&quot;);

	int i=0;
	long start = System.currentTimeMillis();
	while (true)
	{

		QueueingConsumer.Delivery delivery = consumer.nextDelivery();
		String message = new String(delivery.getBody());

		i++;
		if(i == 3000)
		{
			System.out.println(&quot;The last 3000 Messages needed &quot; + (System.currentTimeMillis() - start));
			start = System.currentTimeMillis();
			i=0;
		}
	}
</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013508.html">[rabbitmq-discuss] How can I set socket timeouts in PHP using the AMQP PHP extension?
</A></li>
	<LI>Next message: <A HREF="013562.html">[rabbitmq-discuss] reading time extending on persistent messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13512">[ date ]</a>
              <a href="thread.html#13512">[ thread ]</a>
              <a href="subject.html#13512">[ subject ]</a>
              <a href="author.html#13512">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
