<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Treating the Ack Message
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Treating%20the%20Ack%20Message&In-Reply-To=%3Cyrv4c1uzcl4p5.fsf%40dwragg.eng.vmware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013092.html">
   <LINK REL="Next"  HREF="013096.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Treating the Ack Message</H1>
    <B>David Wragg</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Treating%20the%20Ack%20Message&In-Reply-To=%3Cyrv4c1uzcl4p5.fsf%40dwragg.eng.vmware.com%3E"
       TITLE="[rabbitmq-discuss] Treating the Ack Message">david at rabbitmq.com
       </A><BR>
    <I>Thu Jun  2 14:53:58 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013092.html">[rabbitmq-discuss] Treating the Ack Message
</A></li>
        <LI>Next message: <A HREF="013096.html">[rabbitmq-discuss] duplicate 'messages' queue attribute in HTTP API	JSON response?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13095">[ date ]</a>
              <a href="thread.html#13095">[ thread ]</a>
              <a href="subject.html#13095">[ subject ]</a>
              <a href="author.html#13095">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&quot;Marcus Vinitius Baffa&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mbaffa at opus.com.br</A>&gt; writes:
&gt;<i> I am new to RabbitMQ and I am starting with test and prototypes. I have
</I>&gt;<i> pretty basic questions:
</I>&gt;<i>
</I>&gt;<i> 1)      When the client sends a message to a service and the server
</I>&gt;<i> crashes before it can send back the ack to the client the message stays
</I>&gt;<i> in the queue.
</I>&gt;<i>
</I>&gt;<i> How can the client know the message has not been received, by a timeout
</I>&gt;<i> ???
</I>
I'll use the terms &quot;producer&quot; and &quot;consumer&quot;, rather than &quot;client&quot; and
&quot;server&quot;, because the latter terms risk confusion: All agents sending
and receiving messages are clients of rabbitmq-server (the broker).

There are a couple of AMQP features related to your question.  On a
publish operation, you can set the &quot;mandatory&quot; and &quot;immediate&quot; flags.
&quot;mandatory&quot; tells the broker that the producer expects the message to be
directly routed into at least one queue (rather than being dropped
because there were no bindings of the exchange that matched the
message).  &quot;immediate&quot; says that the producer expects the message to be
directory routed to a consumer via a queue immediately.  If these flags
can't be satisfied, the error is signalled to the producer.

But neither of these give you what you ask for: &quot;mandatory&quot; merely says
that the message should be routed to a queue, and says nothing about
receipt by a consumer.  &quot;immediate&quot; really does require immediate
delivery to a consumer.  If the consumer is already processing earlier
messages, so that the message cannot be delivery due to outstanding
acknowledgements, the publish will fail.

So if you want to send a message from a producer to a consumer, and have
the consumer know whether the message was processed by a consumer within
a certain time, then you will need to make the consumer send a response
message back to the original producer in your application's code.

&gt;<i> 2)      In this case when the server runs again I would like to clear
</I>&gt;<i> all the messages not received.
</I>
There is a purge operation that clears a queue.  So your consumer should
purge its queues on startup.

But note that what you are asking for will tightly couple your clients
and servers.  One of the benefits of using a message broker, compared to
(for example) using HTTP for clients to send requests to servers, is
that the broker can reliably convey a message even if producers and
consumers are not running at the same time, or get restarted.

So for instance, a producer might send a message while the consumer is
temporarily stopped.  When the consumer becomes available again, it can
start handling the messages sent while it was away.

Taking advantage of that kind of approach can help to build more robust
systems.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013092.html">[rabbitmq-discuss] Treating the Ack Message
</A></li>
	<LI>Next message: <A HREF="013096.html">[rabbitmq-discuss] duplicate 'messages' queue attribute in HTTP API	JSON response?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13095">[ date ]</a>
              <a href="thread.html#13095">[ thread ]</a>
              <a href="subject.html#13095">[ subject ]</a>
              <a href="author.html#13095">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
