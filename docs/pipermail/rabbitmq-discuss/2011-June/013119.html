<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Database Corruption Possibilities
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Database%20Corruption%20Possibilities&In-Reply-To=%3C8E0354BD-F819-4D6D-895E-4472CF121B30%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013118.html">
   <LINK REL="Next"  HREF="013123.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Database Corruption Possibilities</H1>
    <B>Alvaro Videla</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Database%20Corruption%20Possibilities&In-Reply-To=%3C8E0354BD-F819-4D6D-895E-4472CF121B30%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] Database Corruption Possibilities">videlalvaro at gmail.com
       </A><BR>
    <I>Fri Jun  3 12:40:54 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013118.html">[rabbitmq-discuss] Database Corruption Possibilities
</A></li>
        <LI>Next message: <A HREF="013123.html">[rabbitmq-discuss] Database Corruption Possibilities
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13119">[ date ]</a>
              <a href="thread.html#13119">[ thread ]</a>
              <a href="subject.html#13119">[ subject ]</a>
              <a href="author.html#13119">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Just FYI,

RabbitMQ does not use Mnesia as message storage. It has it's own persister module.

AFAIK Mnesia is only used for storing routing tables, Exchanges and Queues meta information.

-Alvaro

On Jun 3, 2011, at 1:35 PM, Alex Lovell-Troy wrote:

&gt;<i> There are a handful of approaches to this problem which all seem to follow a similar pattern.  Until there is a way to replace mnesia with a replicable back end, we've all written something on our own that wraps each amqp transaction with a transactional write to the datastore of our choice and.  I've seen this done with MySQL, MongoDB, and riak personally.  
</I>&gt;<i> 
</I>&gt;<i> @jbrisbin has done some interesting work with implementing a specific queue that sends messages to riak that looks intriguing.  I believe there is also a piece that pushes messages from riak into rabbitmq.
</I>&gt;<i> 
</I>&gt;<i> At least, that was the state of the art the last time I looked
</I>&gt;<i> 
</I>&gt;<i> Anyone else?
</I>&gt;<i> 
</I>&gt;<i> -alex
</I>&gt;<i> 
</I>&gt;<i> On Fri, Jun 3, 2011 at 12:21 PM, Ozan Seymen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">Ozan.Seymen at tdpg.com</A>&gt; wrote:
</I>&gt;<i> Hi all,
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> Can someone please explain the scenarios where we might have Rabbit message storage (is it mnesia?) corrupted in a way that it is not recoverable?
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> In the solution I am working on, I simply cannot afford to lose any messages. In order to secure this, I will:
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> &#183;         Rely on publisher confirms. This should ensure that broker will always confirm whether it assumed responsibility and persisted the message.
</I>&gt;<i> 
</I>&gt;<i> &#183;         Implement durable queues/exchanges.
</I>&gt;<i> 
</I>&gt;<i> &#183;         Ack enabled in consumers to prevent losing messages if consumer dies halfway. I will solve the ordering problem on the consumer side.
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> Even though all of these above prevent message loss in normal conditions, none of them covers the case where data gets corrupted in the broker. There is a window (albeit small) that things might go wrong: broker assumes responsibility (message is in the disk) and before message is sent to the consumer, broker experiences problems which corrupts the storage. If I can&#8217;t bring the broker up with all data previously persisted, I&#8217;ve lost messages &#8211; producer forgot about the message as broker accepts responsibility and consumers have no idea about the message as it hasn&#8217;t been delivered to it.
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> Am I a total paranoid that is beyond help? Even so, I would really appreciate any info you guys can share.
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> Cheers,
</I>&gt;<i> 
</I>&gt;<i> oseymen
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i>   
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> This e-mail and any attached files are intended for the named addressee only. It contains information which may be confidential and legally privileged and also protected by copyright. Unless you are the named addressee (or authorised to receive for the addressee) you may not copy or use it or disclose it to anyone else. If you received it in error please notify the sender immediately and then delete it from your system.
</I>&gt;<i> 
</I>&gt;<i> Please be advised that the views and opinions expressed in this e-mail may not reflect the views and opinions of The Digital Property Group Limited or any of its subsidiary companies.
</I>&gt;<i> 
</I>&gt;<i> We make every effort to keep our network free from viruses. However, you do need to check this e-mail and any attachments to it for viruses as we can take no responsibility for any computer virus which may be transferred by way of this e-mail. We reserve the right to monitor all e-mail communications.
</I>&gt;<i> 
</I>&gt;<i> The Digital Property Group Limited is a Daily Mail and General Trust plc company.
</I>&gt;<i> Registered Office: Northcliffe House, 2 Derry Street, London, W8 5TT.
</I>&gt;<i> Registered in England &amp; Wales No: 02290527 VAT no. 243571174
</I>&gt;<i> 
</I>&gt;<i> ______________________________________________________________________
</I>&gt;<i> This email has been scanned by the MessageLabs Email Security System.
</I>&gt;<i> For more information please visit <A HREF="http://www.messagelabs.com/email">http://www.messagelabs.com/email</A> 
</I>&gt;<i> ______________________________________________________________________
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110603/a45c0ced/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110603/a45c0ced/attachment.htm</A>&gt;
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013118.html">[rabbitmq-discuss] Database Corruption Possibilities
</A></li>
	<LI>Next message: <A HREF="013123.html">[rabbitmq-discuss] Database Corruption Possibilities
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13119">[ date ]</a>
              <a href="thread.html#13119">[ thread ]</a>
              <a href="subject.html#13119">[ subject ]</a>
              <a href="author.html#13119">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
