<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Linking to a channel process (erlang client)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Linking%20to%20a%20channel%20process%20%28erlang%20client%29&In-Reply-To=%3CBANLkTimjpyquxen%2ByBQ2-XPvZ6JmHBfvOA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013250.html">
   <LINK REL="Next"  HREF="013263.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Linking to a channel process (erlang client)</H1>
    <B>Hunter Morris</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Linking%20to%20a%20channel%20process%20%28erlang%20client%29&In-Reply-To=%3CBANLkTimjpyquxen%2ByBQ2-XPvZ6JmHBfvOA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Linking to a channel process (erlang client)">huntermorris+rabbitmq at gmail.com
       </A><BR>
    <I>Wed Jun 15 13:05:44 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013250.html">[rabbitmq-discuss] Linking to a channel process (erlang client)
</A></li>
        <LI>Next message: <A HREF="013263.html">[rabbitmq-discuss] Linking to a channel process (erlang client)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13262">[ date ]</a>
              <a href="thread.html#13262">[ thread ]</a>
              <a href="subject.html#13262">[ subject ]</a>
              <a href="author.html#13262">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Jun 15, 2011 at 12:45 AM, Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt; wrote:
&gt;<i> Hmm, that's tricky. Depends what you want to do really - you could have
</I>&gt;<i> the supervisor link to the base process that is the amqp_client
</I>&gt;<i> application if you want (before starting any workers), but it depends if
</I>&gt;<i> you want death of your application to tear down the whole client -
</I>&gt;<i> sequencing of those actions to achieve a safe, controlled shutdown, is
</I>&gt;<i> not trivial.
</I>
Currently, my application's top-level supervisor starts amqp_sup as a
child itself which gives the behaviour I want when my application
crashes. That works quite well and behaves as I expect.

&gt;<i> My understanding is that on the whole, libraries that spawn processes
</I>&gt;<i> are linked to, or monitored, rather than linking / monitoring their
</I>&gt;<i> clients. However, this may be wrong and/or not best practise. If you
</I>&gt;<i> have ideas how this can be improved, please do let us know.
</I>
My main concern is leaking processes since client-side channels are
composed of at least 3 processes each (and I expect hundreds of
channels in this particular application).

I've seen other &quot;client&quot; applications which manage socket connections
treat this issue very differently. For example, lhttpc
(<A HREF="https://github.com/esl/lhttpc">https://github.com/esl/lhttpc</A>) spawn_links a simple lhttpc_client
process, passing along self() in order to unlink when a request is
finished. Obviously, HTTP clients are largely stateless which differs
greatly from the situation we have with AMQP connections and channels.

Based on a suggestion, I will most likely trap exits in the worker
process while setting up the link to the channel in order to clean up
if it receives an exit signal from elsewhere. Because the worker
processes are quite simple, this should be fine.

Thanks for your help,
Hunter
</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013250.html">[rabbitmq-discuss] Linking to a channel process (erlang client)
</A></li>
	<LI>Next message: <A HREF="013263.html">[rabbitmq-discuss] Linking to a channel process (erlang client)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13262">[ date ]</a>
              <a href="thread.html#13262">[ thread ]</a>
              <a href="subject.html#13262">[ subject ]</a>
              <a href="author.html#13262">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
