<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Over memory threshold?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Over%20memory%20threshold%3F&In-Reply-To=%3CBANLkTi%3DN6EXqBKWsbB0n218erWGz2mgY8g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013289.html">
   <LINK REL="Next"  HREF="013290.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Over memory threshold?</H1>
    <B>Marek Majkowski</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Over%20memory%20threshold%3F&In-Reply-To=%3CBANLkTi%3DN6EXqBKWsbB0n218erWGz2mgY8g%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Over memory threshold?">majek04 at gmail.com
       </A><BR>
    <I>Thu Jun 16 15:00:39 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013289.html">[rabbitmq-discuss] Over memory threshold?
</A></li>
        <LI>Next message: <A HREF="013290.html">[rabbitmq-discuss] 2.5.0 stomp ssl Windows 2008R2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13298">[ date ]</a>
              <a href="thread.html#13298">[ thread ]</a>
              <a href="subject.html#13298">[ subject ]</a>
              <a href="author.html#13298">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Jun 16, 2011 at 10:50, yaohui &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">yaohui1984 at qq.com</A>&gt; wrote:
&gt;<i> When there is plenty of&#160; messages in the queues, the memory would be over
</I>&gt;<i> a&#160;high_watermark that is&#160;1/4 physical memory by default. after write some
</I>&gt;<i> message to disk, the memory will below the&#160;high_watermark.
</I>&gt;<i> &#160;but i found that,&#160;after&#160;it's over the hig_watermark&#160;some times, the
</I>&gt;<i> rabbitmq do nothing though the memory is over the high_watermark. then i
</I>&gt;<i> can't send any message to rabbitmq. why the message aren't written to disk?
</I>
Hi,

Unfortunately it's not that simple. Rabbit does the best to free memory,
but in practice, it's not always able to do enough. For example, Rabbit doesn't
control the way Erlang VM handles garbage collection.

In the over-memory situation Rabbit tries to put messages to the disk,
frees the memory used by them, and prays that Erlang GC will eventually
release memory.

But in some corner situations, it's possible for Rabbit to get stuck. For
example: if you created more queues than you have available
memory. As queue metadata must always be in memory, Rabbit will
hit memory watermark and will never be able to recover.

Also, there is some memory cost associated with every message even
though the message is stored on-disk (unless you use a magical
rabbitmq-toke plugin, which intends to solve this problem).

So, take a look at rabbitmq-toke, monitor rabbitmq memory
usage usign rabbitmq-managament plugin, and just buy
more RAM if that's not enough!

Cheers,
   Marek
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013289.html">[rabbitmq-discuss] Over memory threshold?
</A></li>
	<LI>Next message: <A HREF="013290.html">[rabbitmq-discuss] 2.5.0 stomp ssl Windows 2008R2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13298">[ date ]</a>
              <a href="thread.html#13298">[ thread ]</a>
              <a href="subject.html#13298">[ subject ]</a>
              <a href="author.html#13298">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
