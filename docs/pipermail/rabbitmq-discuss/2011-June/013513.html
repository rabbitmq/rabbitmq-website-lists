<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] How can I set socket timeouts in PHP using the AMQP PHP extension?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20can%20I%20set%20socket%20timeouts%20in%20PHP%20using%0A%20the%20AMQP%20PHP%20extension%3F&In-Reply-To=%3CBANLkTik%3DU3-nTTxivnWmm5SB0sXW0__aUA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013509.html">
   <LINK REL="Next"  HREF="013521.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] How can I set socket timeouts in PHP using the AMQP PHP extension?</H1>
    <B>Gavin M. Roy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20can%20I%20set%20socket%20timeouts%20in%20PHP%20using%0A%20the%20AMQP%20PHP%20extension%3F&In-Reply-To=%3CBANLkTik%3DU3-nTTxivnWmm5SB0sXW0__aUA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] How can I set socket timeouts in PHP using the AMQP PHP extension?">gmr at myyearbook.com
       </A><BR>
    <I>Wed Jun 29 14:47:17 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013509.html">[rabbitmq-discuss] How can I set socket timeouts in PHP using the AMQP PHP extension?
</A></li>
        <LI>Next message: <A HREF="013521.html">[rabbitmq-discuss] How can I set socket timeouts in PHP using the AMQP PHP extension?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13513">[ date ]</a>
              <a href="thread.html#13513">[ thread ]</a>
              <a href="subject.html#13513">[ subject ]</a>
              <a href="author.html#13513">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Cool, I meant persistent, such as with the mysql_pconnect or pgsql_pconnect.

Thanks for the work on amqphp, will look deeper at it for use in other
areas. I'm glad there is an active, maintained client!

Gavin

On Wed, Jun 29, 2011 at 4:08 AM, Robin Harvey &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">harvey.robin at gmail.com</A>&gt;wrote:

&gt;<i> BTW, Gavin, on this point:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; iirc the existing implementations do not have connection pooling
</I>&gt;<i>
</I>&gt;<i> I've recently updated amqphp so that you can manage multiple connections at
</I>&gt;<i> the same time, so for example you can connect to and consume from 2 or more
</I>&gt;<i> different brokers at the same time.  There's a demo here:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://github.com/BraveSirRobin/amqphp/blob/master/demos/demo-multi-consumer.php">https://github.com/BraveSirRobin/amqphp/blob/master/demos/demo-multi-consumer.php</A>
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> --Robin
</I>&gt;<i>
</I>&gt;<i> On Wed, Jun 29, 2011 at 4:08 AM, Gavin M. Roy &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">gmr at myyearbook.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> While not directly related to your question and you've not specified your
</I>&gt;&gt;<i> use case, I have found trying to use native AMQP drivers in my PHP
</I>&gt;&gt;<i> application as having too much overhead for connection management and iirc
</I>&gt;&gt;<i> the existing implementations do not have connection pooling. This means lots
</I>&gt;&gt;<i> of startup time and overhead on every request. To get around this we created
</I>&gt;&gt;<i> a HTTP library that talks to the RabbitMQ JSON RPC Channel plugin. If all
</I>&gt;&gt;<i> you are doing is publishing, you might want to check out VorpalBunny:
</I>&gt;&gt;<i> <A HREF="https://github.com/myyearbook/VorpalBunny/">https://github.com/myyearbook/VorpalBunny/</A>
</I>&gt;&gt;<i> As far as the underlying implementation, it's worth noting that the
</I>&gt;&gt;<i> rabbitmq-c library is considered experimental. While we use it in our C
</I>&gt;&gt;<i> applications in production, I can't say that we use the PHP extension on top
</I>&gt;&gt;<i> of it. The PHP site has fatal errors for me right now so I can't look up to
</I>&gt;&gt;<i> see which PHP extension the code is based on, otherwise I'd poke into the
</I>&gt;&gt;<i> code and let you know if there are any timeout settings.
</I>&gt;&gt;<i> Gavin
</I>&gt;&gt;<i> On Tuesday, June 28, 2011 at 6:44 PM, Keith Krueger wrote:
</I>&gt;&gt;<i> &gt; I am using the PHP AMQP extension, as described here:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; <A HREF="http://php.net/manual/en/book.amqp.php">http://php.net/manual/en/book.amqp.php</A>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; This PHP extension uses the rabbitmq-c library as its underlying
</I>&gt;&gt;<i> implementation.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I would like to set socket timeouts for connection establishment and for
</I>&gt;&gt;<i> each of my enqueues and dequeues. I want to do this in case our server
</I>&gt;&gt;<i> performance degrades, to allow the clients to fail quickly rather than hang.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Does anyone have experience doing this in a PHP environment? I have
</I>&gt;&gt;<i> tried setting the PHP socket timeout as follows.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;  ini_set('default_socket_timeout', 5);
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; This appears to have no impact on the PHP extension's timeout settings.
</I>&gt;&gt;<i> I am still able to enqueue a multi-megabyte MQ message to rabbitmq without
</I>&gt;&gt;<i> losing the socket connection. It takes about 75 seconds to enqueue this
</I>&gt;&gt;<i> message, but the socket is kept open the entire time.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Is there any support either in the PHP AMQP extension or in a different
</I>&gt;&gt;<i> PHP setting that I can use to reduce the timeouts for our interactions with
</I>&gt;&gt;<i> RabbitMQ? I'd rather not live with a potential problem of hanging client
</I>&gt;&gt;<i> processes if I can avoid it.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Thanks,
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; -Keith
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A> (mailto:
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>)
</I>&gt;&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/e89cbb43/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/e89cbb43/attachment.htm</A>&gt;
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013509.html">[rabbitmq-discuss] How can I set socket timeouts in PHP using the AMQP PHP extension?
</A></li>
	<LI>Next message: <A HREF="013521.html">[rabbitmq-discuss] How can I set socket timeouts in PHP using the AMQP PHP extension?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13513">[ date ]</a>
              <a href="thread.html#13513">[ thread ]</a>
              <a href="subject.html#13513">[ subject ]</a>
              <a href="author.html#13513">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
