<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] durable queues on fanout exchange not durable
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20durable%20queues%20on%20fanout%20exchange%20not%20durable&In-Reply-To=%3CCAMcAHLV5gxD0L7K9y7GTZq_WTmnpMX_KkuV7U9H%3DQ6gcMybjJQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032275.html">
   <LINK REL="Next"  HREF="032276.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] durable queues on fanout exchange not durable</H1>
    <B>Alvaro Videla</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20durable%20queues%20on%20fanout%20exchange%20not%20durable&In-Reply-To=%3CCAMcAHLV5gxD0L7K9y7GTZq_WTmnpMX_KkuV7U9H%3DQ6gcMybjJQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] durable queues on fanout exchange not durable">videlalvaro at gmail.com
       </A><BR>
    <I>Tue Dec  3 16:26:36 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032275.html">[rabbitmq-discuss] durable queues on fanout exchange not durable
</A></li>
        <LI>Next message: <A HREF="032276.html">[rabbitmq-discuss] Message distribution policy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32287">[ date ]</a>
              <a href="thread.html#32287">[ thread ]</a>
              <a href="subject.html#32287">[ subject ]</a>
              <a href="author.html#32287">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

It seems you are using php-amqplib, if that's the case, the way you
are declaring the queues seems to be correct.

To debug this I would start by running a script that just declares the
queue as durable and the query RabbitMQ via the command line to check
the queue properties.

For example, I've just ran the following script, which creates a
durable queue called messages:

<A HREF="https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer.php">https://github.com/videlalvaro/php-amqplib/blob/master/demo/amqp_consumer.php</A>

And then I've got this result:

$ ./sbin/rabbitmqctl list_queues name durable
Listing queues ...
msgs true
...done.

Note that queue durability is not related to exchange durability.

Regards,

Alvaro

On Tue, Dec 3, 2013 at 11:02 AM, woodslee &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">woodslee at 126.com</A>&gt; wrote:
&gt;<i> Hi pann
</I>&gt;<i>
</I>&gt;<i> I think this is impossible.
</I>&gt;<i> If you declared a durable queue, whatever in producer or comsumer,once it is
</I>&gt;<i> declared, it will be persistent in disk,and even you need not declare it
</I>&gt;<i> later anymore.
</I>&gt;<i> I think you can view the state of the queue in rabbitMQ web UI. If it is
</I>&gt;<i> durable, the flag will be the letter of &quot;D&quot;
</I>&gt;<i>
</I>&gt;<i> ----- Original Message -----
</I>&gt;<i>
</I>&gt;<i> From: pann
</I>&gt;<i> To: rabbitmq-discuss
</I>&gt;<i> Sent: 2013-12-03, 17:46:56
</I>&gt;<i> Subject: [rabbitmq-discuss] durable queues on fanout exchange not durable
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I am having trouble getting my queues durable on my fanout exchange.
</I>&gt;<i> What I am trying to accomplish is the following:
</I>&gt;<i>
</I>&gt;<i> * One producer, submitting messages to the exchange. The producer is not
</I>&gt;<i> aware of how many subscribers there will be.
</I>&gt;<i> * Multiple subscribers that creates their on queues. These queues should be
</I>&gt;<i> durable. If a subscriber needs to be restarted, the queue should survive in
</I>&gt;<i> order not to lose the messages.
</I>&gt;<i>
</I>&gt;<i> The problem is that the queues do not survive the restart unless they are
</I>&gt;<i> also declared on the producer side. However that is not possible since the
</I>&gt;<i> producer is not aware of how many consumers there will be.
</I>&gt;<i>
</I>&gt;<i> The queues are created on the consumer side like this:
</I>&gt;<i> $ch-&gt;queue_declare($queue, false, true, false, false);
</I>&gt;<i> $ch-&gt;exchange_declare($exchange, 'fanout', false, true, false);
</I>&gt;<i> $ch-&gt;queue_bind($queue, $exchange);
</I>&gt;<i>
</I>&gt;<i> and I only declare the exchange on the producer side:
</I>&gt;<i> $ch-&gt;exchange_declare($exchange, 'fanout', false, true, false);
</I>&gt;<i>
</I>&gt;<i> I am probably missing something rather simple, but I have not been able to
</I>&gt;<i> find the answer by googling the problem.
</I>&gt;<i>
</I>&gt;<i> /PA
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context:
</I>&gt;<i> <A HREF="http://rabbitmq.1065348.n5.nabble.com/durable-queues-on-fanout-exchange-not-durable-tp31781.html">http://rabbitmq.1065348.n5.nabble.com/durable-queues-on-fanout-exchange-not-durable-tp31781.html</A>
</I>&gt;<i> Sent from the RabbitMQ mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I></PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032275.html">[rabbitmq-discuss] durable queues on fanout exchange not durable
</A></li>
	<LI>Next message: <A HREF="032276.html">[rabbitmq-discuss] Message distribution policy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32287">[ date ]</a>
              <a href="thread.html#32287">[ thread ]</a>
              <a href="subject.html#32287">[ subject ]</a>
              <a href="author.html#32287">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
