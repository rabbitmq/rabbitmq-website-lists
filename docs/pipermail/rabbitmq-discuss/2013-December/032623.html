<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Why does the queue drop other messages after the first is consumed?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Why%20does%20the%20queue%20drop%20other%20messages%20after%0A%20the%20first%20is%20consumed%3F&In-Reply-To=%3CCADbNrROqOy8Hya%3DfhSb00%2B5LvN66Sd8u-m11Z9PJi8okvNF4tg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032622.html">
   <LINK REL="Next"  HREF="032624.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Why does the queue drop other messages after the first is consumed?</H1>
    <B>Raj Kumar Sanpui</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Why%20does%20the%20queue%20drop%20other%20messages%20after%0A%20the%20first%20is%20consumed%3F&In-Reply-To=%3CCADbNrROqOy8Hya%3DfhSb00%2B5LvN66Sd8u-m11Z9PJi8okvNF4tg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Why does the queue drop other messages after the first is consumed?">raj.kumar.sanpui at gmail.com
       </A><BR>
    <I>Mon Dec 16 19:29:32 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032622.html">[rabbitmq-discuss] Why does the queue drop other messages after the first is consumed?
</A></li>
        <LI>Next message: <A HREF="032624.html">[rabbitmq-discuss] Why does the queue drop other messages after the first is consumed?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32623">[ date ]</a>
              <a href="thread.html#32623">[ thread ]</a>
              <a href="subject.html#32623">[ subject ]</a>
              <a href="author.html#32623">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Agreed, but something as simple as:

{{{
pthread_mutex_lock(&amp;mutex);
basic.consume( );
pthread_mutex_unlock(&amp;mutex);
}}}

Should not have any issues (unless the library you are using has), and
there are no issues in above code, if you can see.




On Tue, Dec 17, 2013 at 12:40 AM, Alvaro Videla &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">videlalvaro at gmail.com</A>&gt;wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> Well it might be the code is corrupting the channel state, RabbitMQ
</I>&gt;<i> will just act based on the order you send AMQP commands to it. If your
</I>&gt;<i> code sends those commands in the wrong order, then errors might
</I>&gt;<i> happen, for example ack'ing the wrong message or things like that.
</I>&gt;<i>
</I>&gt;<i> RabbitMQ is a server, which means, it is not concerned on which
</I>&gt;<i> threading library your application is using, or even if it is using
</I>&gt;<i> threads at all. Your application will send &quot;requests&quot; to RabbitMQ and
</I>&gt;<i> RabbitMQ will service them. In this case the requests are AMQP
</I>&gt;<i> commands.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Alvaro
</I>&gt;<i>
</I>&gt;<i> On Mon, Dec 16, 2013 at 6:59 PM, Raj Kumar Sanpui
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">raj.kumar.sanpui at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; @Alvaro: The same code works perfect, if there are no pthread_mutex_lock.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Can Allan know anything about it.
</I>&gt;<i> &gt; @Alan Antonuk: Alan, do you have any issue in your library with regard to
</I>&gt;<i> &gt; thread locks (pthread_mutex_lock) ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Tue, Dec 17, 2013 at 12:26 AM, Alvaro Videla &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">videlalvaro at gmail.com</A>&gt;
</I>&gt;<i> &gt; wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Well, perhaps either your code or the AMQP library has that problem.
</I>&gt;<i> &gt;&gt; RabbitMQ doesn't know anything about application specific code.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On Mon, Dec 16, 2013 at 6:48 PM, Raj Kumar Sanpui
</I>&gt;<i> &gt;&gt; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">raj.kumar.sanpui at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; &gt; Seems like rabbitmq has an allergy towards thread locks.
</I>&gt;<i> &gt;&gt; &gt; Invoke a consumer thread (basic.consume) calling pthread_mutex_lock( )
</I>&gt;<i> &gt;&gt; &gt; and
</I>&gt;<i> &gt;&gt; &gt; all but one message gets dropped. Same works absolutely fine, if no
</I>&gt;<i> &gt;&gt; &gt; thread
</I>&gt;<i> &gt;&gt; &gt; locks are used.
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; On Mon, Dec 16, 2013 at 11:22 PM, Michael Klishin
</I>&gt;<i> &gt;&gt; &gt; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mklishin at gopivotal.com</A>&gt;
</I>&gt;<i> &gt;&gt; &gt; wrote:
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; On 16 Dec 2013, at 21:47, Raj Kumar Sanpui &lt;
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">raj.kumar.sanpui at gmail.com</A>&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; wrote:
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; In between, do we have any man page for basic.consume?
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; What does &quot;no ack&quot;, &quot;exclusive&quot;, &quot;local&quot; stands for?
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; Ignore local. Exclusive means that there can only ever be one
</I>&gt;<i> consumer
</I>&gt;<i> &gt;&gt; &gt;&gt; on
</I>&gt;<i> &gt;&gt; &gt;&gt; the queue.
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; no ack means &#8220;no manual ack&#8221;, that is, you don&#8217;t intend to use manual
</I>&gt;<i> &gt;&gt; &gt;&gt; acknowledgements of
</I>&gt;<i> &gt;&gt; &gt;&gt; deliveries. See tutorial 2: <A HREF="http://www.rabbitmq.com/getstarted.html">http://www.rabbitmq.com/getstarted.html</A>
</I>&gt;<i> &gt;&gt; &gt;&gt; and <A HREF="http://www.rabbitmq.com/amqp-0-9-1-reference.html#domain.no-ack">http://www.rabbitmq.com/amqp-0-9-1-reference.html#domain.no-ack</A>
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; MK
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; Software Engineer, Pivotal/RabbitMQ
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; &gt;&gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt;&gt; &gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt;&gt; &gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; _______________________________________________
</I>&gt;<i> &gt;&gt; &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt;&gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt;&gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/c5e55f9f/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131217/c5e55f9f/attachment.html</A>&gt;
</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032622.html">[rabbitmq-discuss] Why does the queue drop other messages after the first is consumed?
</A></li>
	<LI>Next message: <A HREF="032624.html">[rabbitmq-discuss] Why does the queue drop other messages after the first is consumed?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32623">[ date ]</a>
              <a href="thread.html#32623">[ thread ]</a>
              <a href="subject.html#32623">[ subject ]</a>
              <a href="author.html#32623">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
