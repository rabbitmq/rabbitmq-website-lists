<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmqctl stop hangs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmqctl%20stop%20hangs&In-Reply-To=%3C329C6A8B-BE65-41F3-BD5D-5944042F169B%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032422.html">
   <LINK REL="Next"  HREF="032428.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmqctl stop hangs</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmqctl%20stop%20hangs&In-Reply-To=%3C329C6A8B-BE65-41F3-BD5D-5944042F169B%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmqctl stop hangs">tim at rabbitmq.com
       </A><BR>
    <I>Tue Dec 10 09:49:27 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032422.html">[rabbitmq-discuss] rabbitmqctl stop hangs
</A></li>
        <LI>Next message: <A HREF="032428.html">[rabbitmq-discuss] rabbitmqctl stop hangs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32426">[ date ]</a>
              <a href="thread.html#32426">[ thread ]</a>
              <a href="subject.html#32426">[ subject ]</a>
              <a href="author.html#32426">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>There ought to be further information in the log files from the brokers in question during the stop operation. Can you post that, or put it somewhere accessible please? Why do you have both `rabbitmq-server stop' and `rabbitmqctl stop' running at the same time? Are those pointing to different rabbits? 

On 10 Dec 2013, at 01:32, Tyrrill, Ed wrote:

&gt;<i> Hi All,
</I>&gt;<i> 
</I>&gt;<i> We are using rabbitmq-server rpms on linux.  Recently we upgraded from 3.1.1-1 to 3.2.0-1, and we are seeing intermittent hangs when stopping rabbitmq.  Here is the ps output:
</I>&gt;<i> 
</I>&gt;<i> root     31052 31051  0 Dec06 ?        00:00:00 /bin/sh /sbin/service rabbitmq-server stop
</I>&gt;<i> root     31055 31052  0 Dec06 ?        00:00:00 /bin/sh /etc/init.d/rabbitmq-server stop
</I>&gt;<i> root     31100 31055  0 Dec06 ?        00:00:00 /bin/sh /usr/sbin/rabbitmqctl stop /var/run/rabbitmq/pid
</I>&gt;<i> root     31111 31100  0 Dec06 ?        00:00:00 su rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl  &quot;stop&quot; &quot;/var/run/rabbitmq/pid&quot;
</I>&gt;<i> rabbitmq 31112 31111  0 Dec06 ?        00:24:10 /usr/lib64/erlang/erts-5.10.3/bin/beam.smp -- -root /usr/lib64/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/rabbitmq/lib/rabbitmq_server-3.2.0/sbin/../ebin -noshell -noinput -hidden -sname rabbitmqctl31112 -boot start_clean -s rabbit_control_main -nodename <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at vm-ave29</A> -extra stop /var/run/rabbitmq/pid
</I>&gt;<i> 
</I>&gt;<i> The CPU time column on the erlang process does slowly go up.  I don't know if it plays a factor, but this broker has shovels defined to a remote broker, and the remote broker was down at the time of this stop.
</I>&gt;<i> 
</I>
How long do these hangs take? The shovel workers will wait 10 seconds for both their inbound and outbound connections to close cleanly. If you examine the log files for both the source and destination (i.e., remote) brokers during the shutdown, there may be some useful indication of whether this is the cause of the problem or not.

&gt;<i> Is this a known issue?  We've been seeing this a couple times a week (over &gt; 100 brokers), and I need to get a fix for this.
</I>&gt;<i> 
</I>
We have fixed bugs with shutdown delays and deadlocks in the past, but they're mostly dusted and released now. We do have an open issue that can cause long delays during broker shutdown, which is mediated by having a lot of durable queues (regardless of whether they contain messages or not). Could that be what you're seeing? How many durable queues do these brokers have running on them?

Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/6dec21bb/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131210/6dec21bb/attachment.html</A>&gt;
</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032422.html">[rabbitmq-discuss] rabbitmqctl stop hangs
</A></li>
	<LI>Next message: <A HREF="032428.html">[rabbitmq-discuss] rabbitmqctl stop hangs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32426">[ date ]</a>
              <a href="thread.html#32426">[ thread ]</a>
              <a href="subject.html#32426">[ subject ]</a>
              <a href="author.html#32426">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
