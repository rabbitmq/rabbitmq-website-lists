<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbit Mq 3.0.2 memory leak
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbit%20Mq%203.0.2%20memory%20leak&In-Reply-To=%3CCAPK6Oevr7A1L7HpuuLYfS-2u0-YiEjoJ%3DAk3YkCDaVe7csx91w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032791.html">
   <LINK REL="Next"  HREF="032789.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbit Mq 3.0.2 memory leak</H1>
    <B>shridharan muthu</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbit%20Mq%203.0.2%20memory%20leak&In-Reply-To=%3CCAPK6Oevr7A1L7HpuuLYfS-2u0-YiEjoJ%3DAk3YkCDaVe7csx91w%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Rabbit Mq 3.0.2 memory leak">shridharan.m at gmail.com
       </A><BR>
    <I>Fri Dec 27 16:55:55 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032791.html">[rabbitmq-discuss] Validation of rabbitmq.config file?
</A></li>
        <LI>Next message: <A HREF="032789.html">[rabbitmq-discuss] MQTT on different virtual hosts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32787">[ date ]</a>
              <a href="thread.html#32787">[ thread ]</a>
              <a href="subject.html#32787">[ subject ]</a>
              <a href="author.html#32787">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello there,

     I am facing a memory leak situation with our production cluster with
Rabbit version 3.0.2. We have one high volume queue (out of other 45
queues) causing this issue. The cluster has 2 nodes and the memory leak
happens only on the slave node for that queue. I am attaching two
screenshots to show

   1. memory on the slave builds up over time compared to the master which
   stays consistently around 400 MB.
   2. memory doubles every few seconds for the slave node.


Original memory usage ( which is so high compared to the second node which
is the master for that queue)
[image: Inline image 2]
Doubled memory on slave
[image: Inline image 3]
This queue processes 300-350 messages a sec and we have around 0 to 20
messages in the queue coz of traffic spikiness. Here is how producers and
consumers are using it.

Producers:
    Application (php, web servers) will establish a connection, publish a
message, close the connection. We have approx 250 app servers publishing
messages for this queue.

Consumers:
    Worker will establish a connection, consume messages using get with
autoack for 2 mins, worker will close the connection and dies. 448 workers
are consuming messages for this queue.

Note: we use php amqplib 0.2.2 (which is really old and due for an upgrade)

I know the quick answer is &quot;upgrade&quot; but is there a short term solution to
fix this before we upgrade? I usually delete the queue (since application
creates it if it doesn't exist) and take it to stable state before the
memory builds up for 3 days to hit the watermark.

Thanks,
Shri
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131227/725a1323/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131227/725a1323/attachment.html</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SlaveMemoryOriginal.png
Type: image/png
Size: 53360 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131227/725a1323/attachment.png">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131227/725a1323/attachment.png</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SlaveMemory.png
Type: image/png
Size: 51949 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131227/725a1323/attachment-0001.png">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131227/725a1323/attachment-0001.png</A>&gt;
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032791.html">[rabbitmq-discuss] Validation of rabbitmq.config file?
</A></li>
	<LI>Next message: <A HREF="032789.html">[rabbitmq-discuss] MQTT on different virtual hosts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32787">[ date ]</a>
              <a href="thread.html#32787">[ thread ]</a>
              <a href="subject.html#32787">[ subject ]</a>
              <a href="author.html#32787">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
