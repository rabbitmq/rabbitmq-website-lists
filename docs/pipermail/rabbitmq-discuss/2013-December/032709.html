<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Blocked/blocking%20connections%20%26%20Memory%0A%09fluctuations&In-Reply-To=%3CCAPK6Oeu8kWC3K%3DiJxZu1gP1JziO6tWcptY%2B5e2%2BV1%2B4wk4%3DWrA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032708.html">
   <LINK REL="Next"  HREF="032710.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations</H1>
    <B>shridharan muthu</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Blocked/blocking%20connections%20%26%20Memory%0A%09fluctuations&In-Reply-To=%3CCAPK6Oeu8kWC3K%3DiJxZu1gP1JziO6tWcptY%2B5e2%2BV1%2B4wk4%3DWrA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations">shridharan.m at gmail.com
       </A><BR>
    <I>Thu Dec 19 16:35:37 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032708.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
        <LI>Next message: <A HREF="032710.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32709">[ date ]</a>
              <a href="thread.html#32709">[ thread ]</a>
              <a href="subject.html#32709">[ subject ]</a>
              <a href="author.html#32709">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you Simon. I have a few questions (inline with the explanation below).


On Thu, Dec 19, 2013 at 7:50 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 18/12/13 17:11, shridharan muthu wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * Hi there,     I am noticing couple of issues in our rabbit cluster (of
</I>&gt;&gt;<i> 2 nodes). *
</I>&gt;&gt;<i> *  1. I notice a lot of blocked and blocking connections in the
</I>&gt;&gt;<i> management*
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *     admin UI but &quot;rabbitmqctl list_connections&quot; is not showing any
</I>&gt;&gt;<i> blocked or blocking connections. These connections are living over a
</I>&gt;&gt;<i> day and since we use php in our application layer, none of these
</I>&gt;&gt;<i> connections should not live more than 5 mins. Whats strange is that
</I>&gt;&gt;<i> this symptom is noticed in only one of the nodes of the cluster. *
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> * Which version are you running? This sounds like a bug that was fixed in
</I>&gt;<i> 3.0.3 where connections and channels might not be cleaned up from the
</I>&gt;<i> management database when their node went down.*
</I>&gt;<i>
</I>
       You are spot on Simon. We are using 3.0.2 version in our cluster. In
this case, restarting node will not help I guess. Can I delete these
blocked/blocking connections from Management UI?

&gt;<i>
</I>&gt;<i> *  2. Memory doubles once in a few seconds on same node of the cluster.*
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *     May be GC is kicking in? Not sure whether it could relate to the
</I>&gt;&gt;<i>   blocked/blocking connections. Since this node didn't hit memory
</I>&gt;&gt;<i> watermark level, logs doesn't have any warning/errors. *
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> * That sounds like it might be GC, but it's hard to tell.*
</I>&gt;<i>
</I>&gt;<i>
</I>     Could it be cause of the blocked connections? I will check the memory
usage after cleaning up the connections.


&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *      On a related note, I have a question about redistributing queues
</I>&gt;&gt;<i> after maintanence. For a cluster with 2 nodes (node 1 &amp; node 2) with
</I>&gt;&gt;<i> mirroring, lets say out of 12 queues, 6 lives in node 1 (as master) and
</I>&gt;&gt;<i> other 6 lives in node 2.  For maintenance reasons, if I take node 2 down
</I>&gt;&gt;<i> and put it back in the cluster, all queues will live node 1 at this point.
</I>&gt;&gt;<i> Is there any way to redistribute the queues among these 2 nodes in this
</I>&gt;&gt;<i> case to move 6 queues back to node 2?*
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> * You could use a higher priority &quot;nodes&quot; policy to move the master to
</I>&gt;<i> node 2, then delete it again (albeit the queue would be unmirrored while
</I>&gt;<i> this was taking place). Oh, but you need to be on at least RabbitMQ 3.1.x
</I>&gt;<i> for that to work, 3.0.x does not let a mirroring policy move the master.*
</I>&gt;<i>
</I>
   Ah! But that would leave with tightly coupling queues to nodes.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> * OTOH if the queues are mirrored to all nodes anyway, why worry? A slave
</I>&gt;<i> takes about as many resources as a master anyway, so all your masters being
</I>&gt;<i> on one node and all the slaves on the other should be no big deal.*
</I>

    My understanding is that all operations (publish, consume) on a queue
will be forwarded from slaves to the master (where it will be executed and
broadcasted to all mirrors) and all the messages in the mirror will be used
only when the master goes down. This sounds like slaves are just forwarding
messages all the time (1 hop penalty) and generates more traffic between
slaves &amp; the master.

&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/60397ec7/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/60397ec7/attachment.html</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032708.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
	<LI>Next message: <A HREF="032710.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32709">[ date ]</a>
              <a href="thread.html#32709">[ thread ]</a>
              <a href="subject.html#32709">[ subject ]</a>
              <a href="author.html#32709">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
