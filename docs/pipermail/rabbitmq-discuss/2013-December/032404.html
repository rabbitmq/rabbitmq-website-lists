<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] When rabbitmq is clustered with one other	node we see a very slow dequeue of messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%0A%09%3D%3Futf-8%3Fq%3FWhen_rabbitmq_is_clustered_with_one_%3F%3D%0A%09%3D%3Futf-8%3Fq%3Fother%3D09node_we_see_a_very_slow_dequeue_of_messages%3F%3D&In-Reply-To=%3Cloom.20131206T221755-465%40post.gmane.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032387.html">
   <LINK REL="Next"  HREF="032429.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] When rabbitmq is clustered with one other	node we see a very slow dequeue of messages</H1>
    <B>James</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%0A%09%3D%3Futf-8%3Fq%3FWhen_rabbitmq_is_clustered_with_one_%3F%3D%0A%09%3D%3Futf-8%3Fq%3Fother%3D09node_we_see_a_very_slow_dequeue_of_messages%3F%3D&In-Reply-To=%3Cloom.20131206T221755-465%40post.gmane.org%3E"
       TITLE="[rabbitmq-discuss] When rabbitmq is clustered with one other	node we see a very slow dequeue of messages">james.eddy at us.thalesgroup.com
       </A><BR>
    <I>Fri Dec  6 21:29:45 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032387.html">[rabbitmq-discuss] When rabbitmq is clustered with one other	node we see a very slow dequeue of messages
</A></li>
        <LI>Next message: <A HREF="032429.html">[rabbitmq-discuss] When rabbitmq is clustered with one other node we see a very slow dequeue of messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32404">[ date ]</a>
              <a href="thread.html#32404">[ thread ]</a>
              <a href="subject.html#32404">[ subject ]</a>
              <a href="author.html#32404">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>James &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">james.eddy at ...</A>&gt; writes:

&gt;<i> We have two setups with slightly different network setups (two pairs of 
</I>Node A and B). One we see this issue on, the other we do not, so this is not 
an issue that can be always reproduced.

I see now why this is not always reproducible. On one of our setups there 
was no queueBind to the exchange on the failed server (Node B).

So this issue becomes always reproducible (in our environment) when it meets 
the following conditions.

(1) NODE_A and NODE_B in a cluster
(2) CLIENT_A0 connects to NODE_A creates topic exchange EXCHANGE_X, and 
publishes 1MSG/sec
(3) CLIENT_A1 connects to NODE_A creates and binds queue to EXCHANGE_X, 
CLIENT_A1 now is dequeueing messages at the rate of ~ 1MSG/sec
(4) CLIENT_B connects to NODE_B binds queue to EXCHANGE_X, CLIENT_B1 also is 
now dequeueing messages at the rate of ~ 1MSG/sec
(5) Pull the cable from NODE_A to NODE_B (anything that does not allow the 
tcp connection drop to be detected, making net_ticktime come into play. 
Making NODE_B not routable from NODE_A will work, or iptables DROP will 
work).

Result: CLIENT_A0 continues to publish at 1MSG/sec, after net_ticktime 
CLIENT_A1 is dequeueing much less then 1MSG/sec and falls behind.


* Note: &quot;connects&quot; is a localhost connection for this test

Thanks,
James


</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032387.html">[rabbitmq-discuss] When rabbitmq is clustered with one other	node we see a very slow dequeue of messages
</A></li>
	<LI>Next message: <A HREF="032429.html">[rabbitmq-discuss] When rabbitmq is clustered with one other node we see a very slow dequeue of messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32404">[ date ]</a>
              <a href="thread.html#32404">[ thread ]</a>
              <a href="subject.html#32404">[ subject ]</a>
              <a href="author.html#32404">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
