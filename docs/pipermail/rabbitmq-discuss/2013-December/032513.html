<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] How to create a rabbitmq cluster using existing application without losing existing data?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20create%20a%20rabbitmq%20cluster%20using%0A%20existing%20application%20without%20losing%20existing%20data%3F&In-Reply-To=%3CBLU176-W429E7C8AA4F9F0CFEE5C5EADDC0%40phx.gbl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032455.html">
   <LINK REL="Next"  HREF="032514.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] How to create a rabbitmq cluster using existing application without losing existing data?</H1>
    <B>Joshua Lim</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20create%20a%20rabbitmq%20cluster%20using%0A%20existing%20application%20without%20losing%20existing%20data%3F&In-Reply-To=%3CBLU176-W429E7C8AA4F9F0CFEE5C5EADDC0%40phx.gbl%3E"
       TITLE="[rabbitmq-discuss] How to create a rabbitmq cluster using existing application without losing existing data?">joshua__lim at hotmail.com
       </A><BR>
    <I>Thu Dec 12 16:34:26 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032455.html">[rabbitmq-discuss] How to create a rabbitmq cluster using existing application without losing existing data?
</A></li>
        <LI>Next message: <A HREF="032514.html">[rabbitmq-discuss] How to create a rabbitmq cluster using existing application without losing existing data?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32513">[ date ]</a>
              <a href="thread.html#32513">[ thread ]</a>
              <a href="subject.html#32513">[ subject ]</a>
              <a href="author.html#32513">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Date: Wed, 11 Dec 2013 10:32:00 +0000
</I>&gt;<i> From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>
</I>&gt;<i> To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> CC: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">joshua__lim at hotmail.com</A>
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] How to create a rabbitmq cluster using existing application without losing existing data?
</I>&gt;<i> 
</I>&gt;<i> On 11/12/13 10:26, Joshua Lim wrote:
</I>&gt;<i> &gt; I'm trying to find out if it is possible to create a rabbitmq cluster
</I>&gt;<i> &gt; for an existing production instance with data on it.
</I>&gt;<i> 
</I>&gt;<i> Yes.
</I>&gt;<i> 
</I>&gt;<i> &gt; The reason is
</I>&gt;<i> &gt; because I'm starting with only 1 server for the start and would like to
</I>&gt;<i> &gt; expand to a 2 server cluster only in the future.
</I>&gt;<i> 
</I>&gt;<i> Which makes sense.
</I>&gt;<i> 
</I>&gt;<i> &gt; What I did is:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1. Issue rabbitmqctl stop_app, rabbitmqctl reset, rabbitmqctl stop on
</I>&gt;<i> &gt; both nodes.
</I>&gt;<i> 
</I>&gt;<i> rabbitmqctl reset is the culprit here - it will erase all information on 
</I>&gt;<i> the node.
</I>&gt;<i> 
</I>&gt;<i> &gt; 2. Add auto-config to rabbitmq.config on both nodes:   {cluster_nodes,
</I>&gt;<i> &gt; {['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at existing-machine</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at new-machine</A>'], disc}}
</I>&gt;<i> 
</I>&gt;<i> Note that the auto-config lists nodes in an existing cluster that the 
</I>&gt;<i> machine should attempt to contact when coming up from a new installation 
</I>&gt;<i> (or post reset). And a standalone node is a cluster of size one.
</I>&gt;<i> &gt; So what you really wanted to do was:&gt; 
</I>&gt;<i> * Not touch existing-machine
</I>&gt;<i> * Add {cluster_nodes, {['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at existing-machine</A>'], disc}} to new-machine
</I>&gt;<i> * Reset new-machine if you've previously used RabbitMQ on it
</I>&gt;<i> * Start new-machine
</I>Thanks for your pointers, this now works.  :) 
I was a bit confused by the 3 node example (see config below) mentioned in <A HREF="http://www.rabbitmq.com/clustering.html">http://www.rabbitmq.com/clustering.html</A>  That's why I put all the nodes into cluster_nodes field.
{cluster_nodes, {['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit1</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit2</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3</A>'], disc}},
How about the cluster_nodes configuration field on existing machine?  I left it as {cluster_nodes, {['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at existing-machine</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at new-machine</A>'], disc}}
Is that the correct way?  I need active-active ha.  By the way, I've not gone into <A HREF="http://www.rabbitmq.com/ha.html">http://www.rabbitmq.com/ha.html</A> yet.

 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/4586d834/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131212/4586d834/attachment.html</A>&gt;
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032455.html">[rabbitmq-discuss] How to create a rabbitmq cluster using existing application without losing existing data?
</A></li>
	<LI>Next message: <A HREF="032514.html">[rabbitmq-discuss] How to create a rabbitmq cluster using existing application without losing existing data?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32513">[ date ]</a>
              <a href="thread.html#32513">[ thread ]</a>
              <a href="subject.html#32513">[ subject ]</a>
              <a href="author.html#32513">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
