<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] When rabbitmq is clustered with one other node we see a very slow dequeue of messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20When%20rabbitmq%20is%20clustered%20with%20one%20other%20node%0A%20we%20see%20a%20very%20slow%20dequeue%20of%20messages&In-Reply-To=%3C083E352F62C9974389AD0F9F875EA238179D94A4F6%40THSONEA03CMS03P.ONE-03.GRP%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032336.html">
   <LINK REL="Next"  HREF="032317.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] When rabbitmq is clustered with one other node we see a very slow dequeue of messages</H1>
    <B>GENTLING Gregory</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20When%20rabbitmq%20is%20clustered%20with%20one%20other%20node%0A%20we%20see%20a%20very%20slow%20dequeue%20of%20messages&In-Reply-To=%3C083E352F62C9974389AD0F9F875EA238179D94A4F6%40THSONEA03CMS03P.ONE-03.GRP%3E"
       TITLE="[rabbitmq-discuss] When rabbitmq is clustered with one other node we see a very slow dequeue of messages">Gregory.GENTLING at us.thalesgroup.com
       </A><BR>
    <I>Wed Dec  4 01:52:24 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032336.html">[rabbitmq-discuss] MQTT Plugin - missed and received in wrong order with QoS=0
</A></li>
        <LI>Next message: <A HREF="032317.html">[rabbitmq-discuss] When rabbitmq is clustered with one other node we see a very slow dequeue of messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32299">[ date ]</a>
              <a href="thread.html#32299">[ thread ]</a>
              <a href="subject.html#32299">[ subject ]</a>
              <a href="author.html#32299">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Classification: Open
When rabbitmq is clustered with one other node we see a very slow dequeue of messages. The scenario is simple, Node A and Node B in the cluster. They are clustered with the auto_heal option and default netticktime. Steps to repeat are:


(These are all local connections)

(1)    Connect client A1 to Node A

a.       Client A1 creates a topic exchange

b.      Client A1 is a publisher with 1msg/sec

(2)    Connect client A2 to Node A

a.       Client A1 listens for the messages in the exchange

(3)    Connect client B to Node B   (this is important, the issue does not occur unless you have this remote client)

a.       Client B listens for the messages in the exchange

(4)    Pull the plug on Node B (you will not see the issue with a graceful shutdown), alternately you can just use &quot;route&quot; to now make Node B not routable from Node A

a.       If you kill rabbitmq, you will not see the issue

(5)    Wait for netticktime (or until you see NodeB being removed from the cluster in Node A's log)

(6)    Client A2 no longer receives messages at 1msg/sec, it will fall considerably behind but recover in about 10 mins.

We have two setups with slightly different network setups (two pairs of Node A and B). One we see this issue on, the other we do not, so this is not an issue that can be always reproduced.

Other issues observed in this state:

*         rabbitmqctl cluster_status/list_queues/list_connections/list_exchanges all hang, rabbitmq status does not hang

*         declareQueue, declareExchange, declareExchangePassive all hang

*         disabling auto_heal does not help

*         tested with both Erlang 5.9 and 5.10.3

*         tested with both RabbitMq 3.1.5 and 3.1.3, same issue in both

*         don't see this issue with direct exchange

*         nothing in vmstat out of the ordinary, CPU is not pegged, system is not thrashing


Things we have ruled out:

*         Iptables, tested with no rules

*         Selinux, tested in permissive

*         Java drivers


Same thing as described here:

<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-June/027674.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-June/027674.html</A>

Thank you,

Greg Gentling
Principal Software Architecture - Avant CommonApps
Thales Avionics, Inc.
In-Flight Entertainment and Connectivity
Irvine, CA 92618
949-595-4943


[@@OPEN@@]

This email was classified by GENTLING Gregory on Tuesday, December 03, 2013 5:52:25 PM.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/129aa6f9/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131203/129aa6f9/attachment.html</A>&gt;
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032336.html">[rabbitmq-discuss] MQTT Plugin - missed and received in wrong order with QoS=0
</A></li>
	<LI>Next message: <A HREF="032317.html">[rabbitmq-discuss] When rabbitmq is clustered with one other node we see a very slow dequeue of messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32299">[ date ]</a>
              <a href="thread.html#32299">[ thread ]</a>
              <a href="subject.html#32299">[ subject ]</a>
              <a href="author.html#32299">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
