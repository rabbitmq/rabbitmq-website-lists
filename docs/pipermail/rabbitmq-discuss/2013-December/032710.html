<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Blocked/blocking%20connections%20%26%20Memory%0A%09fluctuations&In-Reply-To=%3C52B32C85.7090509%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032709.html">
   <LINK REL="Next"  HREF="032714.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Blocked/blocking%20connections%20%26%20Memory%0A%09fluctuations&In-Reply-To=%3C52B32C85.7090509%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations">simon at rabbitmq.com
       </A><BR>
    <I>Thu Dec 19 17:27:33 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032709.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
        <LI>Next message: <A HREF="032714.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32710">[ date ]</a>
              <a href="thread.html#32710">[ thread ]</a>
              <a href="subject.html#32710">[ subject ]</a>
              <a href="author.html#32710">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 19/12/13 16:35, shridharan muthu wrote:
&gt;<i>         You are spot on Simon. We are using 3.0.2 version in our
</I>&gt;<i> cluster. In this case, restarting node will not help I guess. Can I
</I>&gt;<i> delete these blocked/blocking connections from Management UI?
</I>
The only way to do that is to restart the management stats database:

# rabbitmqctl -n &lt;node with the stats db&gt; eval 
'application:stop(rabbitmq_management),application:start(rabbitmq_management).'

&gt;<i>       Could it be cause of the blocked connections? I will check the
</I>&gt;<i> memory usage after cleaning up the connections.
</I>
I doubt it, those connections don't really exist except as rows in the 
management stats db. But note that we have fixed a few memory leaks 
since 3.0.2.

&gt;<i>     /You could use a higher priority &quot;nodes&quot; policy to move the master
</I>&gt;<i>     to node 2, then delete it again (albeit the queue would be
</I>&gt;<i>     unmirrored while this was taking place). Oh, but you need to be on
</I>&gt;<i>     at least RabbitMQ 3.1.x for that to work, 3.0.x does not let a
</I>&gt;<i>     mirroring policy move the master./
</I>&gt;<i>
</I>&gt;<i>     Ah! But that would leave with tightly coupling queues to nodes.
</I>
Only until you delete the &quot;nodes&quot; policy - you can use that to move the 
master, but then revert to an &quot;all&quot; policy; at which point the master 
will stay where it is.

&gt;<i>     /OTOH if the queues are mirrored to all nodes anyway, why worry? A
</I>&gt;<i>     slave takes about as many resources as a master anyway, so all your
</I>&gt;<i>     masters being on one node and all the slaves on the other should be
</I>&gt;<i>     no big deal.
</I>&gt;<i>     /
</I>&gt;<i>
</I>&gt;<i> //
</I>&gt;<i>      My understanding is that all operations (publish, consume) on a
</I>&gt;<i> queue will be forwarded from slaves to the master (where it will be
</I>&gt;<i> executed and broadcasted to all mirrors) and all the messages in the
</I>&gt;<i> mirror will be used only when the master goes down.
</I>
Yes.

&gt;<i> This sounds like
</I>&gt;<i> slaves are just forwarding messages all the time (1 hop penalty) and
</I>&gt;<i> generates more traffic between slaves &amp; the master.
</I>
Sure, but how will distributing the masters around the cluster help 
that? Or are you saying your clients know that some queues are on node 
2, and expect to connect to that node to use that queue? If so that 
makes sense...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032709.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
	<LI>Next message: <A HREF="032714.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32710">[ date ]</a>
              <a href="thread.html#32710">[ thread ]</a>
              <a href="subject.html#32710">[ subject ]</a>
              <a href="author.html#32710">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
