<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Blocked/blocking%20connections%20%26%20Memory%0A%09fluctuations&In-Reply-To=%3C52B315AE.7040000%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032680.html">
   <LINK REL="Next"  HREF="032709.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Blocked/blocking%20connections%20%26%20Memory%0A%09fluctuations&In-Reply-To=%3C52B315AE.7040000%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations">simon at rabbitmq.com
       </A><BR>
    <I>Thu Dec 19 15:50:06 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032680.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
        <LI>Next message: <A HREF="032709.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32708">[ date ]</a>
              <a href="thread.html#32708">[ thread ]</a>
              <a href="subject.html#32708">[ subject ]</a>
              <a href="author.html#32708">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18/12/13 17:11, shridharan muthu wrote:
&gt;<i> Hi there,
</I>&gt;<i>
</I>&gt;<i>     I am noticing couple of issues in our rabbit cluster (of 2 nodes).
</I>&gt;<i>
</I>&gt;<i>  1. I notice a lot of blocked and blocking connections in the management
</I>&gt;<i>     admin UI but &quot;rabbitmqctl list_connections&quot; is not showing any
</I>&gt;<i>     blocked or blocking connections. These connections are living over a
</I>&gt;<i>     day and since we use php in our application layer, none of these
</I>&gt;<i>     connections should not live more than 5 mins. Whats strange is that
</I>&gt;<i>     this symptom is noticed in only one of the nodes of the cluster.
</I>
Which version are you running? This sounds like a bug that was fixed in 
3.0.3 where connections and channels might not be cleaned up from the 
management database when their node went down.

&gt;<i>  2. Memory doubles once in a few seconds on same node of the cluster.
</I>&gt;<i>     May be GC is kicking in? Not sure whether it could relate to the
</I>&gt;<i>     blocked/blocking connections. Since this node didn't hit memory
</I>&gt;<i>     watermark level, logs doesn't have any warning/errors.
</I>
That sounds like it might be GC, but it's hard to tell.

&gt;<i>      On a related note, I have a question about redistributing queues
</I>&gt;<i> after maintanence. For a cluster with 2 nodes (node 1 &amp; node 2) with
</I>&gt;<i> mirroring, lets say out of 12 queues, 6 lives in node 1 (as master) and
</I>&gt;<i> other 6 lives in node 2.  For maintenance reasons, if I take node 2 down
</I>&gt;<i> and put it back in the cluster, all queues will live node 1 at this
</I>&gt;<i> point. Is there any way to redistribute the queues among these 2 nodes
</I>&gt;<i> in this case to move 6 queues back to node 2?
</I>
You could use a higher priority &quot;nodes&quot; policy to move the master to 
node 2, then delete it again (albeit the queue would be unmirrored while 
this was taking place). Oh, but you need to be on at least RabbitMQ 
3.1.x for that to work, 3.0.x does not let a mirroring policy move the 
master.

OTOH if the queues are mirrored to all nodes anyway, why worry? A slave 
takes about as many resources as a master anyway, so all your masters 
being on one node and all the slaves on the other should be no big deal.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032680.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
	<LI>Next message: <A HREF="032709.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32708">[ date ]</a>
              <a href="thread.html#32708">[ thread ]</a>
              <a href="subject.html#32708">[ subject ]</a>
              <a href="author.html#32708">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
