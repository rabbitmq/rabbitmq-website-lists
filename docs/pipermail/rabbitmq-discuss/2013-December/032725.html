<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Blocked/blocking%20connections%20%26%20Memory%0A%09fluctuations&In-Reply-To=%3C52B4367E.9020707%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032714.html">
   <LINK REL="Next"  HREF="032760.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Blocked/blocking%20connections%20%26%20Memory%0A%09fluctuations&In-Reply-To=%3C52B4367E.9020707%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations">simon at rabbitmq.com
       </A><BR>
    <I>Fri Dec 20 12:22:22 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032714.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
        <LI>Next message: <A HREF="032760.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32725">[ date ]</a>
              <a href="thread.html#32725">[ thread ]</a>
              <a href="subject.html#32725">[ subject ]</a>
              <a href="author.html#32725">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hmm. I cannot figure out how that could come to pass - it looks like 
there is a broken listener already there.

You might be able to fix this by invoking

$ rabbitmqctl -n rabbit eval 
'rabbit_web_dispatch_sup:stop_listener([{port,55672},{ignore_in_use,true}]).'

but if that doesn't work I think you'd have to restart the node I'm afraid.

Either way, I'd be very interested to see the logs from around when you 
tried to restart the management application.

Cheers, Simon

On 19/12/13 19:38, shridharan muthu wrote:
&gt;<i> Hello Simon,
</I>&gt;<i>
</I>&gt;<i>     I tried restarting rabbitmq management and I got the following
</I>&gt;<i> error. I am not able to use port 15672 at all.
</I>&gt;<i>
</I>&gt;<i> /sudo rabbitmqctl -n rabbit eval
</I>&gt;<i> 'application:stop(rabbitmq_management),application:start(rabbitmq_management).'/
</I>&gt;<i> /{error,/
</I>&gt;<i> /    {bad_return,/
</I>&gt;<i> /        {{rabbit_mgmt_app,start,[normal,[]]},/
</I>&gt;<i> /         {'EXIT',/
</I>&gt;<i> /             {{{case_clause,/
</I>&gt;<i> /                   {error,/
</I>&gt;<i> /                       {no_record_for_listener,/
</I>&gt;<i> /                           [{port,55672},{ignore_in_use,true}]}}},/
</I>&gt;<i> /               [{rabbit_mochiweb_registry,handle_call,3},/
</I>&gt;<i> /                {gen_server,handle_msg,5},/
</I>&gt;<i> /                {proc_lib,init_p_do_apply,3}]},/
</I>&gt;<i> /              {gen_server,call,/
</I>&gt;<i> /                  [rabbit_mochiweb_registry,/
</I>&gt;<i> /                   {add,rabbit_mgmt_redirect,/
</I>&gt;<i> /                       [{port,55672},{ignore_in_use,true}],/
</I>&gt;<i> /                       #Fun&lt;rabbit_mochiweb.1.105980535&gt;,/
</I>&gt;<i> /                       #Fun&lt;rabbit_mochiweb.0.34137573&gt;,/
</I>&gt;<i> /                       {[],&quot;Redirect to port 15672&quot;}},/
</I>&gt;<i> /                   infinity]}}}}}}/
</I>&gt;<i> /...done./
</I>&gt;<i> /
</I>&gt;<i> /
</I>&gt;<i> So, Is there anyway bring it back up without restarting the app?
</I>&gt;<i>
</I>&gt;<i> Shri
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Dec 19, 2013 at 9:27 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     On 19/12/13 16:35, shridharan muthu wrote:
</I>&gt;<i>
</I>&gt;<i>                  You are spot on Simon. We are using 3.0.2 version in our
</I>&gt;<i>         cluster. In this case, restarting node will not help I guess. Can I
</I>&gt;<i>         delete these blocked/blocking connections from Management UI?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     The only way to do that is to restart the management stats database:
</I>&gt;<i>
</I>&gt;<i>     # rabbitmqctl -n &lt;node with the stats db&gt; eval
</I>&gt;<i>     'application:stop(rabbitmq___management),application:start(__rabbitmq_management).'
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>                Could it be cause of the blocked connections? I will
</I>&gt;<i>         check the
</I>&gt;<i>         memory usage after cleaning up the connections.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     I doubt it, those connections don't really exist except as rows in
</I>&gt;<i>     the management stats db. But note that we have fixed a few memory
</I>&gt;<i>     leaks since 3.0.2.
</I>&gt;<i>
</I>&gt;<i>              /You could use a higher priority &quot;nodes&quot; policy to move the
</I>&gt;<i>         master
</I>&gt;<i>
</I>&gt;<i>              to node 2, then delete it again (albeit the queue would be
</I>&gt;<i>              unmirrored while this was taking place). Oh, but you need
</I>&gt;<i>         to be on
</I>&gt;<i>              at least RabbitMQ 3.1.x for that to work, 3.0.x does not let a
</I>&gt;<i>              mirroring policy move the master./
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>              Ah! But that would leave with tightly coupling queues to nodes.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     Only until you delete the &quot;nodes&quot; policy - you can use that to move
</I>&gt;<i>     the master, but then revert to an &quot;all&quot; policy; at which point the
</I>&gt;<i>     master will stay where it is.
</I>&gt;<i>
</I>&gt;<i>              /OTOH if the queues are mirrored to all nodes anyway, why
</I>&gt;<i>         worry? A
</I>&gt;<i>
</I>&gt;<i>              slave takes about as many resources as a master anyway, so
</I>&gt;<i>         all your
</I>&gt;<i>              masters being on one node and all the slaves on the other
</I>&gt;<i>         should be
</I>&gt;<i>              no big deal.
</I>&gt;<i>              /
</I>&gt;<i>
</I>&gt;<i>         //
</I>&gt;<i>
</I>&gt;<i>               My understanding is that all operations (publish, consume)
</I>&gt;<i>         on a
</I>&gt;<i>         queue will be forwarded from slaves to the master (where it will be
</I>&gt;<i>         executed and broadcasted to all mirrors) and all the messages in the
</I>&gt;<i>         mirror will be used only when the master goes down.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     Yes.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         This sounds like
</I>&gt;<i>         slaves are just forwarding messages all the time (1 hop penalty) and
</I>&gt;<i>         generates more traffic between slaves &amp; the master.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     Sure, but how will distributing the masters around the cluster help
</I>&gt;<i>     that? Or are you saying your clients know that some queues are on
</I>&gt;<i>     node 2, and expect to connect to that node to use that queue? If so
</I>&gt;<i>     that makes sense...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>     --
</I>&gt;<i>     Simon MacMullen
</I>&gt;<i>     RabbitMQ, Pivotal
</I>&gt;<i>
</I>&gt;<i>
</I>

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032714.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
	<LI>Next message: <A HREF="032760.html">[rabbitmq-discuss] Blocked/blocking connections &amp; Memory	fluctuations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32725">[ date ]</a>
              <a href="thread.html#32725">[ thread ]</a>
              <a href="subject.html#32725">[ subject ]</a>
              <a href="author.html#32725">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
