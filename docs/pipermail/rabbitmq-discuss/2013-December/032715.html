<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] CPU Utilization Concern
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20CPU%20Utilization%20Concern&In-Reply-To=%3CCAO%3D6ox8DR8tFEywhCY2RON6gWqNe1y_cYKxF1ktyim%3D%3DSBiicw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032713.html">
   <LINK REL="Next"  HREF="032716.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] CPU Utilization Concern</H1>
    <B>Richard Raseley</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20CPU%20Utilization%20Concern&In-Reply-To=%3CCAO%3D6ox8DR8tFEywhCY2RON6gWqNe1y_cYKxF1ktyim%3D%3DSBiicw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] CPU Utilization Concern">richard at raseley.com
       </A><BR>
    <I>Thu Dec 19 21:26:02 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032713.html">[rabbitmq-discuss] RabbitMQ console has lost ability to log anyone in
</A></li>
        <LI>Next message: <A HREF="032716.html">[rabbitmq-discuss] CPU Utilization Concern
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32715">[ date ]</a>
              <a href="thread.html#32715">[ thread ]</a>
              <a href="subject.html#32715">[ subject ]</a>
              <a href="author.html#32715">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Currently working with an architecture as follows:

1) A topic exchange is bound to 3 consistent hash exchanges with routing
keys that match 3 distinct types of messages (e.g. type-a, type-b, type-c).

2) Each of these type-specific consistent hash exchanges is, in turn bound
to 16 type-specific queues (e.g. type-a-01, ... , type-a-16) with a weight
of 100.

3) Three consumers are configured to consume messages specific to that type
- each consumer connects to all of the 16 queues for it's type.

4) Producers connect to the broker and send messages to the topic exchange
with a routing key that matches the type of message they are sending.

5) Only one type is active at this time.

The reason we went down this path was to mitigate the 1 queue : 1 cpu core
limitation within RabbitMQ (or Erlange in general?).

We *are* seeing (relatively) even message distribution across the queues
for the on message type that is current active (yay), however I am only
seeing utilization on between 4-6 (depending on the time) out of the 16
total cores (others are 100% idle). This wasn't the behavior in my initial
testing (I saw relatively equal load across all cores).

Can someone confirm that in the architecture outlined above I would expect
to see (relatively) equal distribution across all available cores?
Furthermore, if my expectation is correct, are there Erlang / RabbitMQ
specific configurations that would impact things like core distribution /
affinity? I am also currently pursuing the idea that it might be some
hypervisor-specific setting that is causing this (no good info on that as
of yet).

Thank you in advance for any assistance.

Regards,

Richard Raseley
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/a29a40c7/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131219/a29a40c7/attachment.html</A>&gt;
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032713.html">[rabbitmq-discuss] RabbitMQ console has lost ability to log anyone in
</A></li>
	<LI>Next message: <A HREF="032716.html">[rabbitmq-discuss] CPU Utilization Concern
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32715">[ date ]</a>
              <a href="thread.html#32715">[ thread ]</a>
              <a href="subject.html#32715">[ subject ]</a>
              <a href="author.html#32715">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
