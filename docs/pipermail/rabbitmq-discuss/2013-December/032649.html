<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Best way to ping server from client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Best%20way%20to%20ping%20server%20from%20client&In-Reply-To=%3C52B08780.8030000%40noaa.gov%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032419.html">
   <LINK REL="Next"  HREF="032650.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Best way to ping server from client</H1>
    <B>James Gardner</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Best%20way%20to%20ping%20server%20from%20client&In-Reply-To=%3C52B08780.8030000%40noaa.gov%3E"
       TITLE="[rabbitmq-discuss] Best way to ping server from client">james.gardner at noaa.gov
       </A><BR>
    <I>Tue Dec 17 17:18:56 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032419.html">[rabbitmq-discuss] Best way to ping server from client
</A></li>
        <LI>Next message: <A HREF="032650.html">[rabbitmq-discuss] Best way to ping server from client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32649">[ date ]</a>
              <a href="thread.html#32649">[ thread ]</a>
              <a href="subject.html#32649">[ subject ]</a>
              <a href="author.html#32649">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi Alvaro,

Great to get your reply, I didn't expect to hear from the Creator ;). 
Sorry about the delay, I wanted to think further on this before responding.
The access_request idea was the type of answer I was looking for, but alas:
<A HREF="http://www.rabbitmq.com/undeprecated.html">http://www.rabbitmq.com/undeprecated.html</A>
...so I can't base a solution on it.

The way I'm understanding it, there is a fundamental problem, when 
waiting for a server-push, in being able to detect the difference 
between 'server has nothing to send you' and 'server has just gone away 
forever', hence the need for some sort of heartbeat.
I guess I have come to the conclusion that the only way to tell if a 
server has gone away, is to send a request which should illicit an 
immediate response, hence the need for some sort of ping.
There are only two operations I can think of to use for pings, albeit 
relatively expensive ones:

For consume scripts, a periodic queue declaration call, since they're 
idempotent?
For publish scripts, a periodic QOS call, eg. setting prefetch number? 
(Am I correct in saying this would have no effect on a channel used only 
for publishing?)

Do you or anyone else see any problems with using these? Let me know if 
my thinking is off somehow.

Also, if you would care to, I would like to ask you to comment on:
<A HREF="https://github.com/videlalvaro/php-amqplib/commit/20d50074e6a2904737d23d93e36fd22ece46add2">https://github.com/videlalvaro/php-amqplib/commit/20d50074e6a2904737d23d93e36fd22ece46add2</A>
Not sure I fully understand the exact implications or limitations that 
result from this issue; what are the scenarios in which this would cause 
a problem?

I would like to take the opportunity to thank you and all the 
contributors for a great library; it's been a real life saver since we 
were suffering a memory leak in the PECL AMQP extension. PhpAmqpLib has 
been very solid so far and I greatly prefer its design. It's also nice 
to be able to read the code easily, and package it along with our apps.
Cheers,

James


On 12/09/2013 11:49 AM, Alvaro Videla wrote:
&gt;<i> Hi James,
</I>&gt;<i>
</I>&gt;<i> I've thought about implementing some of the hearbeats exposed by
</I>&gt;<i> RabbitMQ but is not so easy considering PHP's single thread view of
</I>&gt;<i> the world. I could try to approximate timeouts for example, but not
</I>&gt;<i> sure about what errors that could bring.
</I>&gt;<i>
</I>&gt;<i> As a complete hack and trying to answer your question, there's the
</I>&gt;<i> access_request method which in RabbitMQ won't do much: See
</I>&gt;<i> <A HREF="https://github.com/videlalvaro/php-amqplib/blob/master/PhpAmqpLib/Channel/AMQPChannel.php#L233">https://github.com/videlalvaro/php-amqplib/blob/master/PhpAmqpLib/Channel/AMQPChannel.php#L233</A>
</I>&gt;<i> <A HREF="andhttp://hg.rabbitmq.com/rabbitmq-server/file/3e9ad0a5795e/src/rabbit_channel.erl#l646">andhttp://hg.rabbitmq.com/rabbitmq-server/file/3e9ad0a5795e/src/rabbit_channel.erl#l646</A>
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Alvaro
</I>&gt;<i>
</I>&gt;<i> On Mon, Dec 9, 2013 at 6:42 PM, James Gardner&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">james.gardner at noaa.gov</A>&gt;  wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I need to know the best way to 'ping' an AMQP server from a client (I'm
</I>&gt;&gt;<i> using PhpAmqpLib). We have encountered some situations where the client
</I>&gt;&gt;<i> doesn't realize the server has 'gone away', and hangs for far too long,
</I>&gt;&gt;<i> sometimes indefinitely. Regardless of whether this is a problem with the
</I>&gt;&gt;<i> client library, if I wanted to test the connection by issuing the most
</I>&gt;&gt;<i> benign, inexpensive request, what might that be? Perhaps there is a channel
</I>&gt;&gt;<i> method I can call repeatedly at regular intervals without causing errors,
</I>&gt;&gt;<i> like QOS, or something else? This would be during a consume.
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> James Gardner, NWS NIDS
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032419.html">[rabbitmq-discuss] Best way to ping server from client
</A></li>
	<LI>Next message: <A HREF="032650.html">[rabbitmq-discuss] Best way to ping server from client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32649">[ date ]</a>
              <a href="thread.html#32649">[ thread ]</a>
              <a href="subject.html#32649">[ subject ]</a>
              <a href="author.html#32649">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
