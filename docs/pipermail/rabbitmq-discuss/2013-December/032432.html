<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Recurring partitioning problem on local network
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Recurring%20partitioning%20problem%20on%20local%0A%20network&In-Reply-To=%3C25870F6AB6D0E34489AD94C19EA928DB01F22E1F%40OFLEXMB06P.centene.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032430.html">
   <LINK REL="Next"  HREF="032434.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Recurring partitioning problem on local network</H1>
    <B>Bill Chmura</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Recurring%20partitioning%20problem%20on%20local%0A%20network&In-Reply-To=%3C25870F6AB6D0E34489AD94C19EA928DB01F22E1F%40OFLEXMB06P.centene.com%3E"
       TITLE="[rabbitmq-discuss] Recurring partitioning problem on local network">bchmura at nurturhealth.com
       </A><BR>
    <I>Tue Dec 10 16:56:06 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032430.html">[rabbitmq-discuss] Recurring partitioning problem on local	network
</A></li>
        <LI>Next message: <A HREF="032434.html">[rabbitmq-discuss] Recurring partitioning problem on local	network
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32432">[ date ]</a>
              <a href="thread.html#32432">[ thread ]</a>
              <a href="subject.html#32432">[ subject ]</a>
              <a href="author.html#32432">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think we are willing to do anything :)

Right now we are aiming to run without clustering for the short term - we need to be up and stable.

What do you mean by a patched version?  Are there instructions?

We are also doing that other testing to try and replicate the issue... should have been this morning, but we've had a weather delay



-----Original Message-----
From: Simon MacMullen [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>] 
Sent: Tuesday, December 10, 2013 11:03 AM
To: Discussions about RabbitMQ
Cc: Bill Chmura
Subject: Re: [rabbitmq-discuss] Recurring partitioning problem on local network

On 09/12/13 22:20, Bill Chmura wrote:
&gt;<i> Can someone confirm for me that I understand these events correctly?  
</I>&gt;<i> I would really appreciate it
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 9-Dec-2013::05:43:41 ===
</I>&gt;<i>
</I>&gt;<i> rabbit on node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at NURWEB-QAAPP01</A>' down
</I>&gt;<i>
</I>&gt;<i> // The above indicates the net_ticktime expired without a good response?
</I>
Either that or the Erlang VM got positive confirmation that the node was down - you'll see this message in the logs when deliberately shutting down the node for example, without waiting for net_ticktime.

&gt;<i> =ERROR REPORT==== 9-Dec-2013::05:43:41 ===
</I>&gt;<i>
</I>&gt;<i> Mnesia('<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at NURWEB-QAWEB01</A>'): ** ERROR ** mnesia_event got 
</I>&gt;<i> {inconsistent_database, running_partitioned_network, 
</I>&gt;<i> '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at NURWEB-QAAPP01</A>'}
</I>&gt;<i>
</I>&gt;<i> // This means it got back in touch with QAAPP01 and neither had gotten 
</I>&gt;<i> good results from the net_ticktime specified &quot;pings&quot;.  So it 
</I>&gt;<i> partitioned itself off.
</I>
It got back in touch and both nodes thought the other one had been down
- i.e. that a network partition has occurred. So this is notification of something that has already happened, not a decision being made.

&gt;<i>  So close to it being down though?
</I>
Agreed, that's suspicious.

&gt;<i> =ERROR REPORT==== 9-Dec-2013::05:43:41 ===
</I>&gt;<i>
</I>&gt;<i> ** Generic server &lt;0.323.0&gt; terminating
</I>&gt;<i>
</I>&gt;<i> ** Last message in was {mnesia_locker,'<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at NURWEB-QAAPP01</A>',granted}
</I>&gt;<i>
</I>&gt;<i> ** When Server state == {state,&lt;0.321.0&gt;,&lt;0.322.0&gt;,rabbit_mgmt_sup,
</I>&gt;<i>
</I>&gt;<i>                              [{rabbit_mgmt_db,
</I>&gt;<i>
</I>&gt;<i>                                   {rabbit_mgmt_db,start_link,[]},
</I>&gt;<i>
</I>&gt;<i>                                   permanent,4294967295,worker,
</I>&gt;<i>
</I>&gt;<i>                                   [rabbit_mgmt_db]}]}
</I>&gt;<i>
</I>&gt;<i> ** Reason for termination ==
</I>&gt;<i>
</I>&gt;<i> ** {unexpected_info,{mnesia_locker,'<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at NURWEB-QAAPP01</A>',granted}}
</I>&gt;<i>
</I>&gt;<i> // This (above) I have seen rarely, but it seems related - any ideas 
</I>&gt;<i> aside from the node crashed?
</I>
We've not seen many reports of this, but it seems to be associated with a node being down for a very short time.

&gt;<i> =INFO REPORT==== 9-Dec-2013::05:43:43 ===
</I>&gt;<i>
</I>&gt;<i> only running disc node went down
</I>&gt;<i>
</I>&gt;<i> // Above indicates the cluster as it is now no longer has QAAPP01 
</I>&gt;<i> which is the disk node.
</I>
Yes, this is to suggest that the cluster is in a dangerous state; if a cluster consisting only of RAM nodes is shut down you will experience data loss.

(As an aside: you might want to have more disc nodes to prevent this!)

&gt;<i> =ERROR REPORT==== 9-Dec-2013::05:45:35 ===
</I>&gt;<i>
</I>&gt;<i> Mnesia('<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at NURWEB-QAWEB01</A>'): ** ERROR ** mnesia_event got 
</I>&gt;<i> {inconsistent_database, running_partitioned_network, 
</I>&gt;<i> '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at NURWEB-QAWEB02</A>'}
</I>&gt;<i>
</I>&gt;<i> // The above indicates that it just portioned itself off from another 
</I>&gt;<i> of the cluster
</I>
Same as above.

&gt;<i> Any help would be very much appreciated - especially confirming that I 
</I>&gt;<i> understand the above events will help with the troubleshooting process.
</I>
So the fact that the node comes back almost as soon as it is seen as down is quite dubious to me. If you are able to run a patched version of the server it might be interesting to log why nodes are considered to be down (whether it actually is net_ticktime).

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal

This email and all attachments are confidential and intended solely 
for the use of the individual or entity to which they are addressed. 
If you have received this email in error please notify the sender 
by replying to this message. If you are not the intended recipient, 
please delete this message and all attachments immediately.  Do not 
copy, disclose, use or act upon the information contained. Please 
note that any views or opinions presented in this email are solely 
those of the author and do not necessarily represent those of the 
company. Finally, the recipient should check this email and any 
attachments for the presence of viruses. While every attempt is made 
to verify that the contents are safe, the company accepts no liability 
for any damage caused by any virus transmitted by this email.

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032430.html">[rabbitmq-discuss] Recurring partitioning problem on local	network
</A></li>
	<LI>Next message: <A HREF="032434.html">[rabbitmq-discuss] Recurring partitioning problem on local	network
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32432">[ date ]</a>
              <a href="thread.html#32432">[ thread ]</a>
              <a href="subject.html#32432">[ subject ]</a>
              <a href="author.html#32432">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
