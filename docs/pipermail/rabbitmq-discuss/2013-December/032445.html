<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMq[Functionality with multiple users]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMq%5BFunctionality%20with%20multiple%20users%5D&In-Reply-To=%3C52A804F9.8000900%40kindlebit.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032441.html">
   <LINK REL="Next"  HREF="032473.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMq[Functionality with multiple users]</H1>
    <B>Sukhjeet</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMq%5BFunctionality%20with%20multiple%20users%5D&In-Reply-To=%3C52A804F9.8000900%40kindlebit.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMq[Functionality with multiple users]">sukhjeet.singh1 at kindlebit.com
       </A><BR>
    <I>Wed Dec 11 06:23:53 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="032441.html">[rabbitmq-discuss] Load Balancing the ssl support in RabbitMQ.
</A></li>
        <LI>Next message: <A HREF="032473.html">[rabbitmq-discuss] RabbitMq[Functionality with multiple users]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32445">[ date ]</a>
              <a href="thread.html#32445">[ thread ]</a>
              <a href="subject.html#32445">[ subject ]</a>
              <a href="author.html#32445">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Team,
                           I am working out with rabbit-mq from some 
days. It is a very nice application and I am trying to incorporating 
this app into my Asp.net MVC 4.0 Web app for providing a facility
                           of mailing system.  I have gone through the 
tutorials and certain examples for C#.

Requirement: Sir, my requirement is to provide a mail like system in the 
web app using Rabbit-Mq. For Example: If I have one user logged in to my 
application and sends a message to another
                         online user , I need to send the message to 
that user. I am using a very basic code given on Rabbit-mq web site but 
I am not getting an idea on how rabbit-mq will server this.As for   now 
I when I click on send message , a message is stored in the queue and 
then when I click on recieve message button on same page, the particular 
message is shown. That is just a template that I have designed.

Can you please help me for my practical situation and I will be really 
thankful to you.

I am using below Code for my template. Please send me the code to 
implement this or just guide me a path by which I can achieve this.


This is a view page::
   public ActionResult Index()
         {
             MessageService ObjMessageService = new MessageService();
             var model = new MessagingModel();
             model.MessageList = ObjMessageService.GetMessageDetails();
             return View(model);
         }



Below function works when &quot;SendMessage&quot; button is pressed
         public ActionResult SendMessage(MessagingModel ObjModel)
         {
             string Message = string.Empty;
             try
             {

                 //var factory = new ConnectionFactory() { HostName = 
&quot;localhost&quot; };
                 //using (var connection = factory.CreateConnection())
                 //using (var channel = connection.CreateModel())
                 //{
                 //    channel.ExchangeDeclare(&quot;logs&quot;, &quot;fanout&quot;);
                 //    var message = ObjModel.Message;
                 //    var body = Encoding.UTF8.GetBytes(message);
                 //    channel.BasicPublish(&quot;logs&quot;, &quot;&quot;, null, body);

                 //}

                 var factory = new ConnectionFactory() { HostName = 
&quot;localhost&quot; };
                 using (var connection = factory.CreateConnection())
                 {
                     using (var channel = connection.CreateModel())
                     {
                         Message = ObjModel.Message;
                         channel.QueueDeclare(&quot;MessageQueue&quot;, true, 
false, false, null);
                         var body = 
Encoding.UTF8.GetBytes(ObjModel.Message);
                         //Save Message To dateBase

                         MessageService ObjMessageService = new 
MessageService();
                         int displayOrder = 
ObjMessageService.GetDisplayOrder();
                         if (displayOrder &gt; 0)
                         {
                             int NewOrder = displayOrder + 1;
                             tblMessageDetail ObjTBL = new 
tblMessageDetail();
                             ObjTBL.Message = ObjModel.Message;
                             ObjTBL.Sent_Date = DateTime.Now;
                             ObjTBL.IsReceived = false;
                             ObjTBL.DisplayOrder = NewOrder;
                             int Result = 
ObjMessageService.SaveSentMessage(ObjTBL);
                             if (Result == 1)
                             {
                                 channel.BasicPublish(&quot;&quot;, 
&quot;MessageQueue&quot;, null, body);
                             }
                         }

                     }
                 }
             }
             catch
             {
                 Message = &quot;An Error has been occurred while sending 
messages.&quot;;
             }
             return Json(new { MSG = Message });
         }


and   Below message works for receive message::
      [HttpPost]
         public JsonResult RecieveMessage()
         {
             string Message = string.Empty;
             try
             {
                 //var factory = new ConnectionFactory() { HostName = 
&quot;localhost&quot; };
                 //using (var connection = factory.CreateConnection())
                 //{
                 //    using (var channel = connection.CreateModel())
                 //    {
                 //        channel.ExchangeDeclare(&quot;logs&quot;, &quot;fanout&quot;);
                 //        var queueName = channel.QueueDeclare();
                 //        channel.QueueBind(queueName, &quot;logs&quot;, &quot;&quot;);
                 //        var consumer = new 
QueueingBasicConsumer(channel);
                 //        var ResultBody = 
channel.BasicConsume(queueName, true, consumer);
                 //        Message = 
Encoding.UTF8.GetString(ResultBody.ToArray()));
                 //    }
                 //}

                 var factory = new ConnectionFactory();
                 using (var connection = factory.CreateConnection())
                 {
                     using (var channel = connection.CreateModel())
                     {
                         channel.QueueDeclare(&quot;MessageQueue&quot;, true, 
false, false, null);
                         bool noAck = true;
                         BasicGetResult result = 
channel.BasicGet(&quot;MessageQueue&quot;, noAck);
                         if (result == null)
                         {
                             Message = &quot;No Messages Found.&quot;;
                         }
                         else
                         {
                             IBasicProperties props = 
result.BasicProperties;
                             byte[] Body = result.Body;
                             Message = Encoding.Default.GetString(Body);
                         }
                     }
                 }
             }
             catch
             {
                 Message = &quot;An Error has been occurred while receiving 
messages.&quot;;
             }
             return Json(new { MSG = Message });
         }

I have attached a  image of the page which can may be give you an Idea 
of the template that I have designed::
Actually the table just shows the sent messages which I save in databse 
when I click on send message button.








CaptureMessaging.PNG




---
This email is free from viruses and malware because avast! Antivirus protection is active.
<A HREF="http://www.avast.com">http://www.avast.com</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/4d8ee76f/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/4d8ee76f/attachment.html</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 30775 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/4d8ee76f/attachment.png">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/4d8ee76f/attachment.png</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: CaptureMessaging.PNG
Type: image/png
Size: 30775 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/4d8ee76f/attachment-0001.png">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131211/4d8ee76f/attachment-0001.png</A>&gt;
</PRE>









































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032441.html">[rabbitmq-discuss] Load Balancing the ssl support in RabbitMQ.
</A></li>
	<LI>Next message: <A HREF="032473.html">[rabbitmq-discuss] RabbitMq[Functionality with multiple users]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32445">[ date ]</a>
              <a href="thread.html#32445">[ thread ]</a>
              <a href="subject.html#32445">[ subject ]</a>
              <a href="author.html#32445">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
