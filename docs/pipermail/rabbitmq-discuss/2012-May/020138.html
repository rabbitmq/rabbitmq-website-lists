<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Fwd: STOMP adapter lose the last message of a	burst
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Fwd%3A%20STOMP%20adapter%20lose%20the%20last%20message%20of%20a%0A%09burst&In-Reply-To=%3C8FDFF1DF-442E-4E58-86F3-22849632433A%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020166.html">
   <LINK REL="Next"  HREF="020142.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Fwd: STOMP adapter lose the last message of a	burst</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Fwd%3A%20STOMP%20adapter%20lose%20the%20last%20message%20of%20a%0A%09burst&In-Reply-To=%3C8FDFF1DF-442E-4E58-86F3-22849632433A%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Fwd: STOMP adapter lose the last message of a	burst">steve at rabbitmq.com
       </A><BR>
    <I>Fri May 18 11:28:38 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020166.html">[rabbitmq-discuss] question, Shovel : different queue name between source and destination
</A></li>
        <LI>Next message: <A HREF="020142.html">[rabbitmq-discuss]  HAProxy does not work with Rabbitmq?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20138">[ date ]</a>
              <a href="thread.html#20138">[ thread ]</a>
              <a href="subject.html#20138">[ subject ]</a>
              <a href="author.html#20138">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sent to google-groups by mistake.
Steve Powell
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

Begin forwarded message:

&gt;<i> From: Steve Powell &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>&gt;
</I>&gt;<i> Date: 18 May 2012 11:22:37 GMT+01:00
</I>&gt;<i> To: Jos&#233; Mic&#243; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jose.mico at gmail.com</A>&gt;
</I>&gt;<i> Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at googlegroups.com</A>
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] STOMP adapter lose the last message of a burst
</I>&gt;<i> 
</I>&gt;<i> Hi Jos&#233;,
</I>&gt;<i> 
</I>&gt;<i> This may very well be a bug, but could also be something about flushing
</I>&gt;<i> in the Perl script you are using.
</I>&gt;<i> 
</I>&gt;<i> Please can you tell us which version of RabbitMQ and STOMP you are
</I>&gt;<i> using?
</I>&gt;<i> 
</I>&gt;<i> Steve Powell
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>
</I>&gt;<i> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
</I>&gt;<i> 
</I>&gt;<i> On 18 May 2012, at 06:18, Jos&#233; Mic&#243; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> I think I've found a somewhat serious bug in the STOMP adapter: after a burst of incoming messages, the last one remains buffered somewhere indefinitely and is not added to the queue until another message is received from the same connection (same with topics). This cause and excessive delay to deliver the message to consumers, if it is ever delivered. Besides that, that last message is lost if the connection is not properly closed.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I've attached a simple script which replicates the bug. It sends burst of 100 small messages to a queue every 10 seconds. Using the management console, we can inspect the count of Ready messages. The expected progression is 100 ... 200 ... 300 ... 400 ... 500, but very frequently (not always) we get 99 ... 199 ... 299 ... 399 ... 499, as the last message is not queued.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Could be that the STOMP parser gets confused after an incomplete frame was read from tcp buffer? Any ideas?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Regards,
</I>&gt;&gt;<i> Jos&#233;
</I>&gt;&gt;<i> &lt;stomp_bug.pl&gt;_______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> 
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120518/10f0ce43/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120518/10f0ce43/attachment.htm</A>&gt;
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020166.html">[rabbitmq-discuss] question, Shovel : different queue name between source and destination
</A></li>
	<LI>Next message: <A HREF="020142.html">[rabbitmq-discuss]  HAProxy does not work with Rabbitmq?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20138">[ date ]</a>
              <a href="thread.html#20138">[ thread ]</a>
              <a href="subject.html#20138">[ subject ]</a>
              <a href="author.html#20138">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
