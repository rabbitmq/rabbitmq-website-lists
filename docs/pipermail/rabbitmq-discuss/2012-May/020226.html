<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] STOMP adapter lose the last message of a	burst
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20adapter%20lose%20the%20last%20message%20of%20a%0A%09burst&In-Reply-To=%3C4FBAC621.2070501%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020217.html">
   <LINK REL="Next"  HREF="020227.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] STOMP adapter lose the last message of a	burst</H1>
    <B>Jos&#233; Mic&#243;</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20adapter%20lose%20the%20last%20message%20of%20a%0A%09burst&In-Reply-To=%3C4FBAC621.2070501%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] STOMP adapter lose the last message of a	burst">jose.mico at gmail.com
       </A><BR>
    <I>Mon May 21 23:48:01 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020217.html">[rabbitmq-discuss] STOMP adapter lose the last message of a	burst
</A></li>
        <LI>Next message: <A HREF="020227.html">[rabbitmq-discuss] STOMP adapter lose the last message of a	burst
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20226">[ date ]</a>
              <a href="thread.html#20226">[ thread ]</a>
              <a href="subject.html#20226">[ subject ]</a>
              <a href="author.html#20226">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/21/2012 08:04 AM, Steve Powell wrote:
&gt;<i> So I installed Wireshark (are you familiar with this tool?) and looked
</I>&gt;<i> at the message traffic. As far as I can see the last buffer is NOT sent
</I>&gt;<i> to the broker from the perl app.
</I>
I installed Wireshark and done some captures while running the Python 
script that I've sent before, for bursts of 100 and 1000 messages, both 
for cases of successes and failures (captures attached). Note that sent 
messages are numbered starting from 0, so the last message of the burst 
are #99 or #999.

I can see in all captures that the last packet sent ends correctly on 
&quot;00099/END&quot; or &quot;00999/END&quot; followed by NIL. So, the Python script is 
actually sending all messages to RabbitMQ.

So, I think that...

- The data is sent to Rabbit.

- Rabbit receives all packets, because the last packet contains several 
messages, not only the last one.

- Rabbit *always* process correctly messages 00098 and 00998, so the 
parser receives the data of the last packet.

- The last message remains buffered somewhere (is not actually lost) but 
is not sent timely to the queue. If more data is sent later on the same 
connection, then that message is added to the queue. If connection is 
closed, the message is lost.

I guess that this is caused by a race condition, because the bug is not 
always triggered and only happens when the broker is stressed.

My next step would be to add some debug statements to 
process_received_bytes() in rabbit_stomp_server.erl, but I really have 
not clue about Erlang :-(


Jos&#233;

-------------- next part --------------
A non-text attachment was scrubbed...
Name: stomp_bug_captures.tar.gz
Type: application/x-gzip
Size: 27773 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/6a7f7485/attachment.bin">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/6a7f7485/attachment.bin</A>&gt;
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020217.html">[rabbitmq-discuss] STOMP adapter lose the last message of a	burst
</A></li>
	<LI>Next message: <A HREF="020227.html">[rabbitmq-discuss] STOMP adapter lose the last message of a	burst
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20226">[ date ]</a>
              <a href="thread.html#20226">[ thread ]</a>
              <a href="subject.html#20226">[ subject ]</a>
              <a href="author.html#20226">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
