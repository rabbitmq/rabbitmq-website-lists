<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Silent crash causes persistent durable	message loss
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Silent%20crash%20causes%20persistent%20durable%0A%09message%20loss&In-Reply-To=%3CA43B64B9-2834-4912-8775-B41C122334DA%40thumb.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020225.html">
   <LINK REL="Next"  HREF="020232.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Silent crash causes persistent durable	message loss</H1>
    <B>Will Koffel</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Silent%20crash%20causes%20persistent%20durable%0A%09message%20loss&In-Reply-To=%3CA43B64B9-2834-4912-8775-B41C122334DA%40thumb.it%3E"
       TITLE="[rabbitmq-discuss] Silent crash causes persistent durable	message loss">will at thumb.it
       </A><BR>
    <I>Tue May 22 01:46:43 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020225.html">[rabbitmq-discuss] Silent crash causes persistent durable message loss
</A></li>
        <LI>Next message: <A HREF="020232.html">[rabbitmq-discuss] Silent crash causes persistent durable message loss
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20228">[ date ]</a>
              <a href="thread.html#20228">[ thread ]</a>
              <a href="subject.html#20228">[ subject ]</a>
              <a href="author.html#20228">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the feedback guys, sorry for the slow reply back.

I took a look on the machine.  It's running on an Amazon Linux instance on EC2 (based on CentOS loosely).  I don't see anything at all related to oom-killer in logs.  Nor anything about rabbit.  I looked in dmesg, and everything in /var/log.

Amazon doesn't do memory monitoring with AWS CloudWatch (major downside, blech), so I can't see if there was any memory contention, but we've never seen any issues on those machines.  There's no CPU or disk spikes during that time to indicate anything else traumatic happening on the machine in question.

One long-shot idea at the application layer:  The daemons we run to consume those queues call &quot;declare&quot; on the relevant exchanges and queues on startup.  This has always been a convenient way to ensure the queues are alive before we start writing/reading them.  In the case where RabbitMQ crashes on us, the daemons start the cycle (they die, their parent process restarts them, they die again, etc.). 

Is there any case in which WHILE rabbit was starting up, it might accept a connection, which would instruct it to create the &quot;expiring-queue&quot;, and then when it went to restore the persistent messages from disk, it would give up since the queue already existed?  Any sort of race condition that could bite us if there are clients thrashing away during start?  Or will RabbitMQ fail to accept any connections until it's cleanly started up?

-Will


On May 21, 2012, at 5:02 PM, Matthias Radestock wrote:

&gt;<i> On 21/05/12 21:50, Francesco Mazzoli wrote:
</I>&gt;&gt;<i> I have trouble believing that it is actually dying silently with no
</I>&gt;&gt;<i> information in the logs.
</I>&gt;<i> 
</I>&gt;<i> iirc we've seen this in the past with things like 'oom killer'. It is
</I>&gt;<i> probably worth checking the system logs.
</I>&gt;<i> 
</I>&gt;&gt;<i> In the meantime I'm going to do the obvious and suggest to upgrade to
</I>&gt;&gt;<i> 2.8.2. We fixed several ugly bugs related to DLX (one of which was
</I>&gt;&gt;<i> particularly easy to get) and they might be related to your problem.
</I>&gt;<i> 
</I>&gt;<i> I don't think any of the DLX bugs pre 2.8.2 would have brought down an
</I>&gt;<i> entire rabbit, just individual queues.
</I>&gt;<i> 
</I>&gt;<i> Matthias.
</I>
________________
Will Koffel
CTO, Thumb&#8482;
51 E 12th St., 4th Floor
New York, NY 10003
Office: (212) 673-8650
Mobile: (617) 575-WILL
@thumb
www.thumb.it






-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/20a55f60/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/20a55f60/attachment.htm</A>&gt;
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020225.html">[rabbitmq-discuss] Silent crash causes persistent durable message loss
</A></li>
	<LI>Next message: <A HREF="020232.html">[rabbitmq-discuss] Silent crash causes persistent durable message loss
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20228">[ date ]</a>
              <a href="thread.html#20228">[ thread ]</a>
              <a href="subject.html#20228">[ subject ]</a>
              <a href="author.html#20228">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
