<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ stopping when trying to delete	locked mnesia files?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20stopping%20when%20trying%20to%20delete%0A%09locked%20mnesia%20files%3F&In-Reply-To=%3CA27BFD19-9FAF-4BC5-9BEC-AACBE6DD10CD%40tjervaag.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020394.html">
   <LINK REL="Next"  HREF="020373.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ stopping when trying to delete	locked mnesia files?</H1>
    <B>&#216;yvind Tjervaag</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20stopping%20when%20trying%20to%20delete%0A%09locked%20mnesia%20files%3F&In-Reply-To=%3CA27BFD19-9FAF-4BC5-9BEC-AACBE6DD10CD%40tjervaag.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ stopping when trying to delete	locked mnesia files?">oyvind at tjervaag.com
       </A><BR>
    <I>Wed May 30 13:33:32 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020394.html">[rabbitmq-discuss] RabbitMQ stopping when trying to delete locked mnesia files?
</A></li>
        <LI>Next message: <A HREF="020373.html">[rabbitmq-discuss] SSL Enhancement for .NET Client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20402">[ date ]</a>
              <a href="thread.html#20402">[ thread ]</a>
              <a href="subject.html#20402">[ subject ]</a>
              <a href="author.html#20402">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On May 30, 2012, at 12:49 PM, Simon MacMullen wrote:

&gt;<i> On 29/05/12 13:01, &#216;yvind Tjervaag wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> I'm running RabbitMQ version 2.8.2 and Erlang R15B01 on Windows 2008
</I>&gt;&gt;<i> R2 (64 bit). Now, I've told the IT-ops-people to stop locking any
</I>&gt;&gt;<i> files in the mnesia folder, but I think RabbitMQ should not fail this
</I>&gt;&gt;<i> badly when it tries deleting a locked file?
</I>&gt;<i> 
</I>&gt;<i> Hmm. We do in general assume that file operations on files owned by Rabbit will succeed; it's hard to know in the general case what else to do.
</I>
Agreed.

&gt;<i> In the crash that you're seeing, Rabbit was not able to delete an old file from the message store. That's a *comparatively* benign event, but the question of what Rabbit should do in this case is still not obvious. Should it ignore the fact that the delete failed (and thus leak that file)? Should it maintain records of which deletions have failed with the intent of retrying them later? (And does that get persisted?) Should the message store hang until the file can be deleted? (That could be a long time, and you won't accept any new persistent messages until then.)
</I>&gt;<i> 
</I>&gt;<i> But it's worse than that - while Rabbit in general tries to open files and keep them open, it will close and reopen files when it is running low on file descriptors. If reopening (for example) a queue index file fails, it's *really* not obvious what our plan B could be.
</I>
I definitely see that the issue is bigger than I first though it was, I just thought it should crash as seldom as possible ;).

&gt;<i> Rabbit really needs to know that its files are under its control.
</I>
Now that I know I'll be more careful letting the people in charge of backups and virus-scans know not to touch the files! 

Thanks,
&#216;yvind
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020394.html">[rabbitmq-discuss] RabbitMQ stopping when trying to delete locked mnesia files?
</A></li>
	<LI>Next message: <A HREF="020373.html">[rabbitmq-discuss] SSL Enhancement for .NET Client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20402">[ date ]</a>
              <a href="thread.html#20402">[ thread ]</a>
              <a href="subject.html#20402">[ subject ]</a>
              <a href="author.html#20402">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
