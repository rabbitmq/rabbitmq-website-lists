<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbmitMQ%20consuming%20CPU%20and%20Memory&In-Reply-To=%3C4FABE7B9.5010509%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019974.html">
   <LINK REL="Next"  HREF="020021.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbmitMQ consuming CPU and Memory</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbmitMQ%20consuming%20CPU%20and%20Memory&In-Reply-To=%3C4FABE7B9.5010509%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbmitMQ consuming CPU and Memory">matthias at rabbitmq.com
       </A><BR>
    <I>Thu May 10 17:07:21 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019974.html">[rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
</A></li>
        <LI>Next message: <A HREF="020021.html">[rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19975">[ date ]</a>
              <a href="thread.html#19975">[ thread ]</a>
              <a href="subject.html#19975">[ subject ]</a>
              <a href="author.html#19975">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Paul,

On 10/05/12 16:40, Paul Gross wrote:
&gt;<i> We are seeing weird issues with RabbmitMQ and CPU/Memory. Basically, we
</I>&gt;<i> run tests locally and on our build server. In both cases, we create a
</I>&gt;<i> couple of queues, push messages through (not many, maybe a few hundred),
</I>&gt;<i> and consume them. This works fine for a few days.
</I>&gt;<i>
</I>&gt;<i> Then, all of a sudden, RabbitMQ goes nuts. It consumes all available CPU
</I>&gt;<i> and memory until it crashes the server. As far as we can tell, nothing
</I>&gt;<i> is different right before this happens. We have to manually kill
</I>&gt;<i> RabbitMQ, and when it comes back up, the queue has less than 10
</I>&gt;<i> messages. The last time this happened, the only thing in the log was
</I>&gt;<i> &quot;Mnesia is overloaded.&quot;
</I>
The &quot;mnesia is overloaded&quot; message could be an indication of a high rate 
of queue/exchange/binding creation/deletion. But I suspect it may also 
be triggered at low creation/deletion rates when rabbit is generally 
busy, so this may be a red herring.

&gt;<i> This happens both locally on a MacPro (10.7.3) and on our build server
</I>&gt;<i> (Ubuntu 10.04).
</I>&gt;<i>
</I>&gt;<i> These images are from munin, and give an idea of what's going on:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://dl.dropbox.com/u/15440955/rabbitmq-cpu.png">http://dl.dropbox.com/u/15440955/rabbitmq-cpu.png</A>
</I>&gt;<i> <A HREF="http://dl.dropbox.com/u/15440955/rabbitmq-memory.png">http://dl.dropbox.com/u/15440955/rabbitmq-memory.png</A>
</I>&gt;<i>
</I>&gt;<i> We are looking for help on how to debug this problem. We cannot directly
</I>&gt;<i> reproduce the problem, but it happens every couple of days.
</I>&gt;<i>
</I>&gt;<i> Here is our setup on the build server:
</I>&gt;<i>     {rabbit,&quot;RabbitMQ&quot;,&quot;2.7.1&quot;},
</I>&gt;<i>     {erlang_version,&quot;Erlang R13B03 ...&quot;}
</I>&gt;<i>     [...]
</I>&gt;<i> And here is our setup on the MacPro:
</I>&gt;<i>     {rabbit,&quot;RabbitMQ&quot;,&quot;2.7.1&quot;},
</I>&gt;<i>     {erlang_version,&quot;Erlang R15B ...&quot;}
</I>
There have been numerous stability improvements since 2.7.1, so I 
suggest you upgrade to the latest rabbit version (2.8.2). Also, R13B03 
is quite ancient, so you should really upgrade that too - R15B01 is the 
latest.

If you still see the same behaviour then try to set up some alarms that 
catch the problem in the early stages and grab the output of 
'rabbitmqctl report'.


Regards,

Matthias.
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019974.html">[rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
</A></li>
	<LI>Next message: <A HREF="020021.html">[rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19975">[ date ]</a>
              <a href="thread.html#19975">[ thread ]</a>
              <a href="subject.html#19975">[ subject ]</a>
              <a href="author.html#19975">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
