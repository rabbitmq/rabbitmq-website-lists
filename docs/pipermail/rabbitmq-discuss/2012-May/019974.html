<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbmitMQ%20consuming%20CPU%20and%20Memory&In-Reply-To=%3C4FABE167.9080900%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019984.html">
   <LINK REL="Next"  HREF="019975.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbmitMQ consuming CPU and Memory</H1>
    <B>Paul Gross</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbmitMQ%20consuming%20CPU%20and%20Memory&In-Reply-To=%3C4FABE167.9080900%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbmitMQ consuming CPU and Memory">pgross at gmail.com
       </A><BR>
    <I>Thu May 10 16:40:23 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019984.html">[rabbitmq-discuss] Active Queue Management
</A></li>
        <LI>Next message: <A HREF="019975.html">[rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19974">[ date ]</a>
              <a href="thread.html#19974">[ thread ]</a>
              <a href="subject.html#19974">[ subject ]</a>
              <a href="author.html#19974">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We are seeing weird issues with RabbmitMQ and CPU/Memory. Basically, we 
run tests locally and on our build server. In both cases, we create a 
couple of queues, push messages through (not many, maybe a few hundred), 
and consume them. This works fine for a few days.

Then, all of a sudden, RabbitMQ goes nuts. It consumes all available CPU 
and memory until it crashes the server. As far as we can tell, nothing 
is different right before this happens. We have to manually kill 
RabbitMQ, and when it comes back up, the queue has less than 10 
messages. The last time this happened, the only thing in the log was 
&quot;Mnesia is overloaded.&quot;

This happens both locally on a MacPro (10.7.3) and on our build server 
(Ubuntu 10.04).

These images are from munin, and give an idea of what's going on:

<A HREF="http://dl.dropbox.com/u/15440955/rabbitmq-cpu.png">http://dl.dropbox.com/u/15440955/rabbitmq-cpu.png</A>
<A HREF="http://dl.dropbox.com/u/15440955/rabbitmq-memory.png">http://dl.dropbox.com/u/15440955/rabbitmq-memory.png</A>

We are looking for help on how to debug this problem. We cannot directly 
reproduce the problem, but it happens every couple of days.

Here is our setup on the build server:

    $ sudo rabbitmqctl status
    Status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ci-rabbitmq</A>' ...
    [{pid,31302},
      {running_applications,[{rabbit,&quot;RabbitMQ&quot;,&quot;2.7.1&quot;},
                             {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.4&quot;},
                             {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.1.8&quot;},
                             {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.4.12&quot;},
                             {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.16.4&quot;},
                             {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.13.4&quot;}]},
      {os,{unix,linux}},
      {erlang_version,&quot;Erlang R13B03 (erts-5.7.4) [source] [64-bit]
    [smp:4:4] [rq:4] [async-threads:30] [h
    ipe] [kernel-poll:true]\n&quot;},
      {memory,[{total,40501088},
               {processes,15379528},
               {processes_used,15355904},
               {system,25121560},
               {atom,1113129},
               {atom_used,1103706},
               {binary,8548768},
               {code,11903849},
               {ets,1436704}]},
      {vm_memory_high_watermark,0.19999999923056544},
      {vm_memory_limit,207944908}]
    ...done.


And here is our setup on the MacPro:

    Status of node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at yoshi</A> ...
    [{pid,70356},
      {running_applications,[{rabbit,&quot;RabbitMQ&quot;,&quot;2.7.1&quot;},
                             {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.6&quot;},
                             {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.8&quot;},
                             {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.2&quot;},
                             {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.18&quot;},
                             {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.15&quot;}]},
      {os,{unix,darwin}},
      {erlang_version,&quot;Erlang R15B (erts-5.9) [source] [64-bit]
    [smp:16:16] [async-threads:30] [hipe] [kernel-poll:true]\n&quot;},
      {memory,[{total,39776688},
               {processes,13068508},
               {processes_used,13068480},
               {system,26708180},
               {atom,504409},
               {atom_used,475853},
               {binary,8659336},
               {code,11916223},
               {ets,1464712}]},
      {vm_memory_high_watermark,0.3999999999026046},
      {vm_memory_limit,3285576908}]
    ...done.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120510/08ba4552/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120510/08ba4552/attachment.htm</A>&gt;
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019984.html">[rabbitmq-discuss] Active Queue Management
</A></li>
	<LI>Next message: <A HREF="019975.html">[rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19974">[ date ]</a>
              <a href="thread.html#19974">[ thread ]</a>
              <a href="subject.html#19974">[ subject ]</a>
              <a href="author.html#19974">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
