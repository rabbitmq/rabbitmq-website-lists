<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Per-Connection Flow Control -- The Case	Against
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Per-Connection%20Flow%20Control%20--%20The%20Case%0A%09Against&In-Reply-To=%3C4FC5FCE3.9080102%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020381.html">
   <LINK REL="Next"  HREF="020404.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Per-Connection Flow Control -- The Case	Against</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Per-Connection%20Flow%20Control%20--%20The%20Case%0A%09Against&In-Reply-To=%3C4FC5FCE3.9080102%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Per-Connection Flow Control -- The Case	Against">simon at rabbitmq.com
       </A><BR>
    <I>Wed May 30 11:56:35 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020381.html">[rabbitmq-discuss] Per-Connection Flow Control -- The Case	Against
</A></li>
        <LI>Next message: <A HREF="020404.html">[rabbitmq-discuss] Per-Connection Flow Control -- The Case	Against
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20395">[ date ]</a>
              <a href="thread.html#20395">[ thread ]</a>
              <a href="subject.html#20395">[ subject ]</a>
              <a href="author.html#20395">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 30/05/12 06:52, Chip Salzenberg wrote:
&gt;<i> On Fri, May 25, 2012 at 5:12 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     In the mean time, I wonder whether 500 consumers and prefetch-count
</I>&gt;<i>     of 2 is what you really want. Normally I would expect a
</I>&gt;<i>     configuration like that when you expect to take some time to process
</I>&gt;<i>     each message, but it sounds like you're going fast enough that
</I>&gt;<i>     either 500 consumers are not needed, or prefetch-count &gt; 2 might
</I>&gt;<i>     lead to better performance.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I didn't know that a larger prefetch count could reduce broker workload.
</I>&gt;<i>   Per-message processing in this system is sometimes high (up to 20s),
</I>&gt;<i> but it averages very low.  It's likely that 500 is overkill, but
</I>&gt;<i> probably only by 2x or so.
</I>&gt;<i>
</I>&gt;<i> Assuming a constant throughput of about 6K/sec and at least 250 workers,
</I>&gt;<i> what prefetch seems more helpful, IYO?  10?  20?
</I>
Well, there are two different things here that I somewhat conflated:

* Number of consumers using prefetch count
   - The higher this number, the more bookkeeping work the queue has
     to do.

* Size of prefetch count
   - The lower this number, the more likely that any given consumer will
     stall, and thus the slower consuming goes.

The &quot;ideal&quot; prefetch count is (network latency / average time to process 
each message). Lower than that and consumers will process all their 
messages, ack them, and then have to wait for more messages to arrive 
over the network.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020381.html">[rabbitmq-discuss] Per-Connection Flow Control -- The Case	Against
</A></li>
	<LI>Next message: <A HREF="020404.html">[rabbitmq-discuss] Per-Connection Flow Control -- The Case	Against
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20395">[ date ]</a>
              <a href="thread.html#20395">[ thread ]</a>
              <a href="subject.html#20395">[ subject ]</a>
              <a href="author.html#20395">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
