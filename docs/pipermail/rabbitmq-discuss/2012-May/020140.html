<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] What happens to messages delivered just before canceling consume?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20What%20happens%20to%20messages%20delivered%20just%0A%20before%20canceling%20consume%3F&In-Reply-To=%3C20120518104125.GB24978%40wellquite.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020139.html">
   <LINK REL="Next"  HREF="020157.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] What happens to messages delivered just before canceling consume?</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20What%20happens%20to%20messages%20delivered%20just%0A%20before%20canceling%20consume%3F&In-Reply-To=%3C20120518104125.GB24978%40wellquite.org%3E"
       TITLE="[rabbitmq-discuss] What happens to messages delivered just before canceling consume?">matthew at rabbitmq.com
       </A><BR>
    <I>Fri May 18 11:41:25 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020139.html">[rabbitmq-discuss] What happens to messages delivered just before canceling consume?
</A></li>
        <LI>Next message: <A HREF="020157.html">[rabbitmq-discuss] What happens to messages delivered just before canceling consume?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20140">[ date ]</a>
              <a href="thread.html#20140">[ thread ]</a>
              <a href="subject.html#20140">[ subject ]</a>
              <a href="author.html#20140">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, May 18, 2012 at 11:31:00AM +0100, Emile Joubert wrote:
&gt;<i> &gt;&gt; Another option is to turn off prefetching (prefetch = 0).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Um, doesn't that just mean you get a deluge of messages instead?
</I>&gt;<i> 
</I>&gt;<i> Apologies, yes please ignore my incorrect advice. Using prefetch = 0
</I>&gt;<i> will turn of prefetch limiting and not help at all. The simplest
</I>&gt;<i> solution here is to use prefetch = 1 and cancel the subscription before
</I>&gt;<i> acknowledging the final message.
</I>
However, unless you are on a network with 0 latency, a prefetch of 1
will guarantee your client sits around idle for at least some of the
time. If you follow the maths through on my recent blog post,
<A HREF="http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/">http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/</A>
then you should be able to calculate a sensible prefetch figure (without
resorting to more exotic solutions like CoDel).

Then, after cancelling the consumer, keep hold of the cancelled consumer
tag (ctag) and if you see any deliveries appearing with that ctag, just
nack+requeue them immediately. There should not be more of them than
your prefetch setting.

Matthew
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020139.html">[rabbitmq-discuss] What happens to messages delivered just before canceling consume?
</A></li>
	<LI>Next message: <A HREF="020157.html">[rabbitmq-discuss] What happens to messages delivered just before canceling consume?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20140">[ date ]</a>
              <a href="thread.html#20140">[ thread ]</a>
              <a href="subject.html#20140">[ subject ]</a>
              <a href="author.html#20140">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
