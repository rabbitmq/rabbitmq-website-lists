<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ stopping when trying to delete locked mnesia files?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20stopping%20when%20trying%20to%20delete%0A%20locked%20mnesia%20files%3F&In-Reply-To=%3C4FC5FB52.1090404%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020371.html">
   <LINK REL="Next"  HREF="020402.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ stopping when trying to delete locked mnesia files?</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20stopping%20when%20trying%20to%20delete%0A%20locked%20mnesia%20files%3F&In-Reply-To=%3C4FC5FB52.1090404%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ stopping when trying to delete locked mnesia files?">simon at rabbitmq.com
       </A><BR>
    <I>Wed May 30 11:49:54 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020371.html">[rabbitmq-discuss] RabbitMQ stopping when trying to delete locked	mnesia files?
</A></li>
        <LI>Next message: <A HREF="020402.html">[rabbitmq-discuss] RabbitMQ stopping when trying to delete	locked mnesia files?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20394">[ date ]</a>
              <a href="thread.html#20394">[ thread ]</a>
              <a href="subject.html#20394">[ subject ]</a>
              <a href="author.html#20394">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 29/05/12 13:01, &#216;yvind Tjervaag wrote:
&gt;<i> Hi!
</I>
Hi.

&gt;<i> I've had this problem a couple of times now where it seems, if I'm
</I>&gt;<i> deciphering the logs correctly, the RabbitMQ crashed when it tries to
</I>&gt;<i> delete mnesia files that are locked by backup or virus-scanning. I
</I>&gt;<i> thought I had seen something about this on this list a while back,
</I>&gt;<i> but I can't seem to find it now.
</I>
That's a correct decipherment.

&gt;<i> I'm running RabbitMQ version 2.8.2 and Erlang R15B01 on Windows 2008
</I>&gt;<i> R2 (64 bit). Now, I've told the IT-ops-people to stop locking any
</I>&gt;<i> files in the mnesia folder, but I think RabbitMQ should not fail this
</I>&gt;<i> badly when it tries deleting a locked file?
</I>
Hmm. We do in general assume that file operations on files owned by 
Rabbit will succeed; it's hard to know in the general case what else to do.

In the crash that you're seeing, Rabbit was not able to delete an old 
file from the message store. That's a *comparatively* benign event, but 
the question of what Rabbit should do in this case is still not obvious. 
Should it ignore the fact that the delete failed (and thus leak that 
file)? Should it maintain records of which deletions have failed with 
the intent of retrying them later? (And does that get persisted?) Should 
the message store hang until the file can be deleted? (That could be a 
long time, and you won't accept any new persistent messages until then.)

But it's worse than that - while Rabbit in general tries to open files 
and keep them open, it will close and reopen files when it is running 
low on file descriptors. If reopening (for example) a queue index file 
fails, it's *really* not obvious what our plan B could be.

Rabbit really needs to know that its files are under its control.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020371.html">[rabbitmq-discuss] RabbitMQ stopping when trying to delete locked	mnesia files?
</A></li>
	<LI>Next message: <A HREF="020402.html">[rabbitmq-discuss] RabbitMQ stopping when trying to delete	locked mnesia files?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20394">[ date ]</a>
              <a href="thread.html#20394">[ thread ]</a>
              <a href="subject.html#20394">[ subject ]</a>
              <a href="author.html#20394">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
