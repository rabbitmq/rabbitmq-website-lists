<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Regular supervisor shutdown errors?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Regular%20supervisor%20shutdown%20errors%3F&In-Reply-To=%3CA92A97C4-0512-44ED-8AC5-51FCC84E79F1%40thumb.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020341.html">
   <LINK REL="Next"  HREF="020346.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Regular supervisor shutdown errors?</H1>
    <B>Will Koffel</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Regular%20supervisor%20shutdown%20errors%3F&In-Reply-To=%3CA92A97C4-0512-44ED-8AC5-51FCC84E79F1%40thumb.it%3E"
       TITLE="[rabbitmq-discuss] Regular supervisor shutdown errors?">will at thumb.it
       </A><BR>
    <I>Sat May 26 16:51:22 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020341.html">[rabbitmq-discuss] Regular supervisor shutdown errors?
</A></li>
        <LI>Next message: <A HREF="020346.html">[rabbitmq-discuss] Regular supervisor shutdown errors?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20345">[ date ]</a>
              <a href="thread.html#20345">[ thread ]</a>
              <a href="subject.html#20345">[ subject ]</a>
              <a href="author.html#20345">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm wondering these could be running out of memory.  I do see them taking very different amounts of RAM on different machines across my stack.  It's almost as if the large queues that I have (ones in which messages sit for a while before expiring via their TTL) are getting saved in RAM instead of persistent.  But if that were the case, then restarting RabbitMQ would flush them, I presume.  And I can definitely restart with the messages still there, which is what made my confident they were durable and persistent.

For people familiar with the erl_crash.dump, is my example below a simple &quot;out of memory&quot; error that caused the crash?  This is running on EC2, which has no swap space by default, maybe there's a hard crash case here?

-Will

On May 26, 2012, at 12:00 AM, Will Koffel wrote:

&gt;<i> I'm seeing somewhat regular (but not in a tight loop) occurrences of these notices in my rabbit@&lt;host&gt;-sasl.log.
</I>&gt;<i> 
</I>&gt;<i> Sometimes the reason is listed as &quot;noproc&quot;, other times as &quot;shutdown&quot;.  Are these normal?  If not, how can I debug?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> =SUPERVISOR REPORT==== 26-May-2012::02:09:34 ===
</I>&gt;&gt;<i>      Supervisor: {&lt;0.549.2188&gt;,
</I>&gt;&gt;<i>                                            rabbit_channel_sup_sup}
</I>&gt;&gt;<i>      Context:    shutdown_error
</I>&gt;&gt;<i>      Reason:     noproc
</I>&gt;&gt;<i>      Offender:   [{pid,&lt;0.551.2188&gt;},
</I>&gt;&gt;<i>                   {name,channel_sup},
</I>&gt;&gt;<i>                   {mfa,{rabbit_channel_sup,start_link,[]}},
</I>&gt;&gt;<i>                   {restart_type,temporary},
</I>&gt;&gt;<i>                   {shutdown,infinity},
</I>&gt;&gt;<i>                   {child_type,supervisor}]
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> =SUPERVISOR REPORT==== 26-May-2012::02:15:52 ===
</I>&gt;&gt;<i>      Supervisor: {&lt;0.31254.2188&gt;,
</I>&gt;&gt;<i>                                            rabbit_channel_sup_sup}
</I>&gt;&gt;<i>      Context:    shutdown_error
</I>&gt;&gt;<i>      Reason:     noproc
</I>&gt;&gt;<i>      Offender:   [{pid,&lt;0.31256.2188&gt;},
</I>&gt;&gt;<i>                   {name,channel_sup},
</I>&gt;&gt;<i>                   {mfa,{rabbit_channel_sup,start_link,[]}},
</I>&gt;&gt;<i>                   {restart_type,temporary},
</I>&gt;&gt;<i>                   {shutdown,infinity},
</I>&gt;&gt;<i>                   {child_type,supervisor}]
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> =SUPERVISOR REPORT==== 26-May-2012::02:18:20 ===
</I>&gt;&gt;<i>      Supervisor: {&lt;0.15873.2189&gt;,
</I>&gt;&gt;<i>                                            rabbit_channel_sup_sup}
</I>&gt;&gt;<i>      Context:    shutdown_error
</I>&gt;&gt;<i>      Reason:     shutdown
</I>&gt;&gt;<i>      Offender:   [{pid,&lt;0.15875.2189&gt;},
</I>&gt;&gt;<i>                   {name,channel_sup},
</I>&gt;&gt;<i>                   {mfa,{rabbit_channel_sup,start_link,[]}},
</I>&gt;&gt;<i>                   {restart_type,temporary},
</I>&gt;&gt;<i>                   {shutdown,infinity},
</I>&gt;&gt;<i>                   {child_type,supervisor}]
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> =SUPERVISOR REPORT==== 26-May-2012::03:52:54 ===
</I>&gt;&gt;<i>      Supervisor: {&lt;0.23330.3&gt;,rabbit_channel_sup_sup}
</I>&gt;&gt;<i>      Context:    shutdown_error
</I>&gt;&gt;<i>      Reason:     shutdown
</I>&gt;&gt;<i>      Offender:   [{pid,&lt;0.23340.3&gt;},
</I>&gt;&gt;<i>                   {name,channel_sup},
</I>&gt;&gt;<i>                   {mfa,{rabbit_channel_sup,start_link,[]}},
</I>&gt;&gt;<i>                   {restart_type,temporary},
</I>&gt;&gt;<i>                   {shutdown,infinity},
</I>&gt;&gt;<i>                   {child_type,supervisor}]
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> =SUPERVISOR REPORT==== 26-May-2012::03:53:48 ===
</I>&gt;&gt;<i>      Supervisor: {&lt;0.27559.3&gt;,rabbit_channel_sup_sup}
</I>&gt;&gt;<i>      Context:    shutdown_error
</I>&gt;&gt;<i>      Reason:     shutdown
</I>&gt;&gt;<i>      Offender:   [{pid,&lt;0.27561.3&gt;},
</I>&gt;&gt;<i>                   {name,channel_sup},
</I>&gt;&gt;<i>                   {mfa,{rabbit_channel_sup,start_link,[]}},
</I>&gt;&gt;<i>                   {restart_type,temporary},
</I>&gt;&gt;<i>                   {shutdown,infinity},
</I>&gt;&gt;<i>                   {child_type,supervisor}]
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> =SUPERVISOR REPORT==== 26-May-2012::03:54:22 ===
</I>&gt;&gt;<i>      Supervisor: {&lt;0.30115.3&gt;,rabbit_channel_sup_sup}
</I>&gt;&gt;<i>      Context:    shutdown_error
</I>&gt;&gt;<i>      Reason:     shutdown
</I>&gt;&gt;<i>      Offender:   [{pid,&lt;0.30117.3&gt;},
</I>&gt;&gt;<i>                   {name,channel_sup},
</I>&gt;&gt;<i>                   {mfa,{rabbit_channel_sup,start_link,[]}},
</I>&gt;&gt;<i>                   {restart_type,temporary},
</I>&gt;&gt;<i>                   {shutdown,infinity},
</I>&gt;&gt;<i>                   {child_type,supervisor}]
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I've also seen 3 of my instances of rabbitmq crash this evening. Haven't changed anything about the configuration or versions or anything in weeks, but clearly something is going on.  One one of the crashed instances, the startup_err log shows me:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Crash dump was written to: erl_crash.dump
</I>&gt;&gt;<i> eheap_alloc: Cannot allocate 2850821240 bytes of memory (of type &quot;old_heap&quot;).
</I>&gt;&gt;<i> /usr/sbin/rabbitmq-server: line 42: 31512 Aborted                 /usr/lib/rabbitmq/bin/${SCRIPT} &quot;$@&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I can't find the erl_crash.dump file, however.  Where should that live?
</I>&gt;<i> 
</I>&gt;<i> Rabbit seems to startup okay, except that when this happens, I lose all my persistent messages in a queue (issue I mentioned on the list last week, never figured it out, I'm moving away from rabbit for my persistent message needs, this is just too scary an issue for my production data at the moment). Not sure if these warnings in the logs are related to the crashes that I've seen, or the lost messages.
</I>&gt;<i> 
</I>&gt;<i> -Will
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ________________
</I>&gt;<i> Will Koffel
</I>&gt;<i> CTO, Thumb&#8482;
</I>&gt;<i> 51 E 12th St., 4th Floor
</I>&gt;<i> New York, NY 10003
</I>&gt;<i> Office: (212) 673-8650
</I>&gt;<i> Mobile: (617) 575-WILL
</I>&gt;<i> @thumb
</I>&gt;<i> www.thumb.it
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>
________________
Will Koffel
CTO, Thumb&#8482;
51 E 12th St., 4th Floor
New York, NY 10003
Office: (212) 673-8650
Mobile: (617) 575-WILL
@thumb
www.thumb.it






-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120526/9914e949/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120526/9914e949/attachment.htm</A>&gt;
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020341.html">[rabbitmq-discuss] Regular supervisor shutdown errors?
</A></li>
	<LI>Next message: <A HREF="020346.html">[rabbitmq-discuss] Regular supervisor shutdown errors?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20345">[ date ]</a>
              <a href="thread.html#20345">[ thread ]</a>
              <a href="subject.html#20345">[ subject ]</a>
              <a href="author.html#20345">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
