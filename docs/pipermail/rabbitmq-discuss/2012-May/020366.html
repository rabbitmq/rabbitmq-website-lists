<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Windows service recovery
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Windows%20service%20recovery&In-Reply-To=%3C96EE5EF0-DDD0-4CD1-B368-675D9A13D619%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020365.html">
   <LINK REL="Next"  HREF="020286.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Windows service recovery</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Windows%20service%20recovery&In-Reply-To=%3C96EE5EF0-DDD0-4CD1-B368-675D9A13D619%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Windows service recovery">watson.timothy at gmail.com
       </A><BR>
    <I>Mon May 28 14:51:54 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020365.html">[rabbitmq-discuss] Windows service recovery
</A></li>
        <LI>Next message: <A HREF="020286.html">[rabbitmq-discuss] stomp+ssl message send works,	receive hangs after around 200-300 messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20366">[ date ]</a>
              <a href="thread.html#20366">[ thread ]</a>
              <a href="subject.html#20366">[ subject ]</a>
              <a href="author.html#20366">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 28 May 2012, at 14:46, Lior Barnea wrote:

&gt;<i> &quot;Based on this reading, it ought to be 'possible' to verify that an instance is still up, but I'm a little unclear on how you would confirm that the said program was the one that erlsrv 'ought' to be monitoring. &quot;
</I>&gt;<i> 
</I>&gt;<i> This is even worse, cause if I run some other erl process and both erlsrv process and rabbitMQ's erl process goes down it is possible that erlsrv will fail to spawn rabbitMQ for no reason...
</I>&gt;<i> 
</I>
Yes well that's just my reading of the erlsrv code. Today, erlsrv simply won't start, which is a different problem altogether.

&gt;<i> A possible solution - erlsrv will save (On disk for example) the PID the erl.exe it needs to monitor and on startup, if there is an erl.exe with the same PID, it is the one.
</I>
That's pretty much what standalone rabbit (rabbit-server) does now on unix, although the pid is actually created by the wrapper script which in turn runs `exec erl &lt;....etc&gt;`. This doesn't happen in the windows batch files, not am I aware of a mechanism for doing so in such scripts, so the behaviour you're describing for windows services clearly belongs in erlsrv.

Needless to say, you're going to need to have some conversations on the erlang-questions mailing list about this one, as we're not responsible for developing or maintaining erlsrv at all.

Cheers,
Tim

&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Tim Watson [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at rabbitmq.com</A>] 
</I>&gt;<i> Sent: Monday, May 28, 2012 15:39
</I>&gt;<i> To: Lior Barnea
</I>&gt;<i> Cc: Emile Joubert; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] Windows service recovery
</I>&gt;<i> 
</I>&gt;<i> On 28/05/12 13:38, Lior Barnea wrote:
</I>&gt;&gt;<i> Erlsrv is the service instance, acting as a watchdog (spawning it on startup) for erl.exe which runs rabbitMQ.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> As I said before, the scenario in which erlsvr is going down without erl.exe is currently hypothetic but its behavior after its restarting because I killed it is wrong.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> For my QA team: &quot;Its unlikely that it will happens&quot; equals &quot;It can 
</I>&gt;&gt;<i> happen&quot; :)
</I>&gt;<i> 
</I>&gt;<i> Yeah, you're right on both counts. The behaviour is wrong and 'it can happen' in theory. This question now needs to move over to the erlang-questions mailing list and get raised with the OTP team, as they're responsible for erlsrv and should be able to get it fixed.
</I>&gt;<i> 
</I>&gt;<i> From a brief glance at the (erlsrv) code, my reading of it is that there is no link between erlsrv and erl.exe other than the use of the fifo pipes provided by to_erl, used to handle interactions (such as shut down). Based on this reading, it ought to be 'possible' to verify that an instance is still up, but I'm a little unclear on how you would confirm that the said program was the one that erlsrv 'ought' to be monitoring.
</I>&gt;<i> 
</I>&gt;<i> 
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020365.html">[rabbitmq-discuss] Windows service recovery
</A></li>
	<LI>Next message: <A HREF="020286.html">[rabbitmq-discuss] stomp+ssl message send works,	receive hangs after around 200-300 messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20366">[ date ]</a>
              <a href="thread.html#20366">[ thread ]</a>
              <a href="subject.html#20366">[ subject ]</a>
              <a href="author.html#20366">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
