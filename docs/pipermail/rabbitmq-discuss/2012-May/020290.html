<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Clustered server doesn't permit local	connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustered%20server%20doesn%27t%20permit%20local%0A%09connections&In-Reply-To=%3C4FBD155E.6030701%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020288.html">
   <LINK REL="Next"  HREF="020293.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Clustered server doesn't permit local	connections</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustered%20server%20doesn%27t%20permit%20local%0A%09connections&In-Reply-To=%3C4FBD155E.6030701%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Clustered server doesn't permit local	connections">simon at rabbitmq.com
       </A><BR>
    <I>Wed May 23 17:50:38 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020288.html">[rabbitmq-discuss] Clustered server doesn't permit local	connections
</A></li>
        <LI>Next message: <A HREF="020293.html">[rabbitmq-discuss] Clustered server doesn't permit local	connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20290">[ date ]</a>
              <a href="thread.html#20290">[ thread ]</a>
              <a href="subject.html#20290">[ subject ]</a>
              <a href="author.html#20290">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Damn, this is a bug :( I've replicated it.

It occurs when you bring up a new node in an existing cluster, and that 
node is sufficiently short of memory or disc space that the memory or 
disc space alarm goes off immediately. It does not occur when an alarm 
goes off after the node has started.

I believe it should only manifest on the new node. Certainly that's what 
I'm seeing. But the node never recovers. And a running node should not 
be able to get into this state.

The workaround is to ensure your nodes have enough memory and disc space 
when they start.

Needless to say, we will fix this in a new release soon.

Cheers, Simon

On 23/05/12 17:05, Glade Diviney wrote:
&gt;<i> I'm running 2.8.2 on both machines. Version lines in &quot;rabbitmqctl
</I>&gt;<i> status&quot; match on both.
</I>&gt;<i>
</I>&gt;<i> I installed from .deb, from the &quot;testing&quot; repo as instructed by
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/install-debian.html.">http://www.rabbitmq.com/install-debian.html.</A>
</I>&gt;<i>
</I>&gt;<i> I tried disabling the cluster, and was able to bring up the singleton
</I>&gt;<i> rabbitmq instance and use it successfully. As soon as I brought up the
</I>&gt;<i> other instance, everything fails again.
</I>&gt;<i>
</I>&gt;<i> Thanks for the troubleshooting you've done so far...any other advise?
</I>&gt;<i>
</I>&gt;<i> -Glade
</I>&gt;<i>
</I>&gt;<i> On Wed, May 23, 2012 at 8:37 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     On 23/05/12 16:24, Glade Diviney wrote:
</I>&gt;<i>
</I>&gt;<i>         Hi Simon,
</I>&gt;<i>
</I>&gt;<i>         Your instinct may be right on alarms. I did service rabbitmq stop,
</I>&gt;<i>         cleared the logs, the service rabbitmq start and saw this in
</I>&gt;<i>         rabbit.log:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     &lt;snip&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         ** Reason == {'function not exported',
</I>&gt;<i>
</I>&gt;<i>           [{rabbit_alarm,remote___conserve_resources,[&lt;2894.58.__0&gt;,true]},
</I>&gt;<i>                            {rabbit_alarm,internal___register,3},
</I>&gt;<i>                            {rabbit_alarm,handle_event,2},
</I>&gt;<i>                            {gen_event,server_update,4},
</I>&gt;<i>                            {gen_event,server_notify,4},
</I>&gt;<i>                            {gen_event,handle_msg,5},
</I>&gt;<i>                            {proc_lib,init_p_do_apply,3}]}
</I>&gt;<i>
</I>&gt;<i>         What's the prognosis, doc?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     Aha!
</I>&gt;<i>
</I>&gt;<i>     That function was renamed in 2.8.2. Are you by any chance running a
</I>&gt;<i>     cluster with mixed RabbitMQ versions?
</I>&gt;<i>
</I>&gt;<i>     That is very likely to lead to random breakage - like this.
</I>&gt;<i>
</I>&gt;<i>     Future versions of RabbitMQ will probably refuse to start instead.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>     --
</I>&gt;<i>     Simon MacMullen
</I>&gt;<i>     RabbitMQ, VMware
</I>&gt;<i>
</I>&gt;<i>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020288.html">[rabbitmq-discuss] Clustered server doesn't permit local	connections
</A></li>
	<LI>Next message: <A HREF="020293.html">[rabbitmq-discuss] Clustered server doesn't permit local	connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20290">[ date ]</a>
              <a href="thread.html#20290">[ thread ]</a>
              <a href="subject.html#20290">[ subject ]</a>
              <a href="author.html#20290">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
