<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster unresponsive after some stop/start of a node.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20unresponsive%20after%20some%20stop/start%0A%20of%20a%20node.&In-Reply-To=%3C4FBA2457.5030103%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020183.html">
   <LINK REL="Next"  HREF="020209.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster unresponsive after some stop/start of a node.</H1>
    <B>Francesco Mazzoli</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20unresponsive%20after%20some%20stop/start%0A%20of%20a%20node.&In-Reply-To=%3C4FBA2457.5030103%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Cluster unresponsive after some stop/start of a node.">francesco at rabbitmq.com
       </A><BR>
    <I>Mon May 21 12:17:43 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020183.html">[rabbitmq-discuss] Cluster unresponsive after some stop/start of a node.
</A></li>
        <LI>Next message: <A HREF="020209.html">[rabbitmq-discuss] Cluster unresponsive after some stop/start of a node.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20196">[ date ]</a>
              <a href="thread.html#20196">[ thread ]</a>
              <a href="subject.html#20196">[ subject ]</a>
              <a href="author.html#20196">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Hello Francesco,
</I>&gt;<i>
</I>&gt;<i> I'm attaching full logs from qwe (qwe.tgz) and asd (asd.tgz) of a
</I>&gt;<i> minimal test case.
</I>&gt;<i>
</I>&gt;<i> Test.
</I>&gt;<i>
</I>&gt;<i> 1. Both qwe and asd are up and running, serving clients.
</I>&gt;<i> 2. In the middle of qwe (master) accepting messages do stop_app on qwe.
</I>&gt;<i> 3. Wait until asd is promoted, then start_app on qwe.
</I>&gt;<i> 4. Do stop_app on asd.
</I>&gt;<i> 5. Wait, do start_app on asd. qwe is now the master back.
</I>&gt;<i> 6. Repeat 2,3,4,5 again. See &quot;ERROR REPORT&quot; (rabbit\@asd.log) on asd.
</I>
I could not reproduce this on my local machine.

I don't think it has anything to do with HA queues, as the log indicates 
`asd' is having problems contacting `qwe' when started. I would expect 
seeing a timeout error like yours if `asd' was a disc node and `qwe' was 
down, but if `asd' is a RAM node I'd expect a different error. What 
version of RabbitMQ are you running? It might be that on earlier 
versions we had looser checks for standalone RAM nodes.

In any case, I would never expect that to happen if at least one node in 
the cluster is up at all times, which seems to be the case here. Can you 
make sure that the error shows up with those precise steps, making sure 
that the connection between the two nodes is not severed - and without 
bothering with HA queues and publishing/consuming.

&gt;<i> On your comment on standalone RAM nodes, to be presice, asd (which is
</I>&gt;<i> really a RAM node) may be left running standalone for some time while
</I>&gt;<i> qwe is doing stop_app/start_app cycle. In my test, both qwe and asd
</I>&gt;<i> are never down at the same time.
</I>
Having a standalone RAM node is a very bad idea, and we actively try to 
prevent the user from creating that situation when we can. I would 
strongly advise you against doing that, unless you have good reasons to 
(but I doubt it).

Francesco.
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020183.html">[rabbitmq-discuss] Cluster unresponsive after some stop/start of a node.
</A></li>
	<LI>Next message: <A HREF="020209.html">[rabbitmq-discuss] Cluster unresponsive after some stop/start of a node.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20196">[ date ]</a>
              <a href="thread.html#20196">[ thread ]</a>
              <a href="subject.html#20196">[ subject ]</a>
              <a href="author.html#20196">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
