<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Per-Connection Flow Control -- The Case Against (Try #2)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Per-Connection%20Flow%20Control%20--%20The%20Case%20Against%0A%20%28Try%20%232%29&In-Reply-To=%3CCANSL5VGhM-ppNWwKVZdWkEU9ZdNgqSi4Sc7ooRyK-FQpU-Bqqg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020393.html">
   <LINK REL="Next"  HREF="020379.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Per-Connection Flow Control -- The Case Against (Try #2)</H1>
    <B>Chip Salzenberg</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Per-Connection%20Flow%20Control%20--%20The%20Case%20Against%0A%20%28Try%20%232%29&In-Reply-To=%3CCANSL5VGhM-ppNWwKVZdWkEU9ZdNgqSi4Sc7ooRyK-FQpU-Bqqg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Per-Connection Flow Control -- The Case Against (Try #2)">rev.chip at gmail.com
       </A><BR>
    <I>Wed May 30 06:41:23 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020393.html">[rabbitmq-discuss] default queue parameters
</A></li>
        <LI>Next message: <A HREF="020379.html">[rabbitmq-discuss] Urgent issue with rabbitmq
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20377">[ date ]</a>
              <a href="thread.html#20377">[ thread ]</a>
              <a href="subject.html#20377">[ subject ]</a>
              <a href="author.html#20377">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It would appear Google Groups ate my reply; thus, this resend.  Sorry if
this is a dup for anyone.
--------------------

 On 5/29/2012 6:21 AM, Tony Garnock-Jones wrote:

On 28 May 2012 19:12, Reverend Chip &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rev.chip at gmail.com</A>&gt; wrote:

&gt;<i> That's very funny.
</I>&gt;<i>  If you're serious, then I can't take you seriously.
</I>&gt;<i>
</I>
 I suspect you're just being rude....


I explained a scenario, as produced by the current flow control code, that
is ridiculous on its face: That growing queues are fine, until consumers
appear, at which point growing queues are not fine.  That's a paradoxical
result that at the very least should prompt reevaluation of the flow
control algorithm.  To ask what the practical bad results are in my
specific case is ridiculous misdirection.

Either growing queues (up to disk and memory limits) are acceptable -- my
position, and the position of RMQ without consumers -- or growing queues
are not acceptable -- the position of RMQ with consumers.  This paradox is
quite simple to write and to read.  The behavior of the current code is
absurd, as anyone can see if they were to choose to look.

So no, I was not being rude, specifically.  But I did ridicule your
comment, which well deserved it.  Per Thomas Jefferson: &quot;Ridicule is the
only weapon which can be used against unintelligible propositions. Ideas
must be distinct before reason can act upon them.&quot;

PS: You may not have thought about the further wrinkle that the queues do
not accept new messages until they are EMPTY.  Which is doubly ridiculous.



 , but since it's also possible that the message you're replying to didn't
get through to you in its entirety (because of broken &quot;From&quot; quoting at
some stage in the mail delivery pipeline), I'll reproduce the rest of what
I wrote here in case it helps advance the discussion:

 &gt;From one point of view, any time consumers exist but are not keeping up
with offered traffic is a good time to throttle the producers. Perhaps call
this the &quot;steady state&quot; point of view - I'm unsure if it has a better name
already.

 &gt;From another point of view - call this the &quot;bursty&quot; point of view,
perhaps - the growth of queues is perfectly acceptable, whether consumers
exist at the time or not.

 ISTM Rabbit makes a guess about whether the application is &quot;steady state&quot;
or &quot;bursty&quot;, choosing &quot;steady state&quot; all the time. Rabbit team, is this the
case? Is there a way of configuring the flow control to permit unbounded
queue growth to support the &quot;bursty&quot; case? Or do I have the wrong end of
the stick entirely?


&gt;<i> 1. A client is publishing 1.5K/sec to each of four exchanges, each of
</I>&gt;<i> which has a queue.
</I>&gt;<i> 2. There are no consumers.  Therefore the queue is growing.
</I>&gt;<i> 3. RMQ does not stop this.  &quot;Flow control&quot; does not trigger.
</I>&gt;<i> 4. The consumers appear to begin to tear down the backlog.
</I>&gt;<i>  5. RMQ per-connection flow control suddenly decides that now there are
</I>&gt;<i> some consumers, now it has a reason to throttle the sender.
</I>&gt;<i> 6. If the consumers had not shown up, the producer would not have been
</I>&gt;<i> blocked.
</I>&gt;<i>
</I>
 7. The consumers drain some of the messages from the queues.
8. The producers are unblocked.
9. Profit!!!

 Regards,
  Tony
-- 
Tony Garnock-Jones
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonygarnockjones at gmail.com</A>
<A HREF="http://homepages.kcbbs.gen.nz/tonyg/">http://homepages.kcbbs.gen.nz/tonyg/</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120529/3cc5908b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120529/3cc5908b/attachment.htm</A>&gt;
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020393.html">[rabbitmq-discuss] default queue parameters
</A></li>
	<LI>Next message: <A HREF="020379.html">[rabbitmq-discuss] Urgent issue with rabbitmq
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20377">[ date ]</a>
              <a href="thread.html#20377">[ thread ]</a>
              <a href="subject.html#20377">[ subject ]</a>
              <a href="author.html#20377">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
