<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] STOMP adapter lose the last message of a burst
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20adapter%20lose%20the%20last%20message%20of%20a%20burst&In-Reply-To=%3C226517f0-2ad1-4583-8a63-4c65b4bb247d%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020134.html">
   <LINK REL="Next"  HREF="020350.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] STOMP adapter lose the last message of a burst</H1>
    <B>Jos&#233; Mic&#243;</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20adapter%20lose%20the%20last%20message%20of%20a%20burst&In-Reply-To=%3C226517f0-2ad1-4583-8a63-4c65b4bb247d%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] STOMP adapter lose the last message of a burst">jose.mico at gmail.com
       </A><BR>
    <I>Fri May 18 06:18:11 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020134.html">[rabbitmq-discuss] Disk space monitoring watermark issue on	2.8.2
</A></li>
        <LI>Next message: <A HREF="020350.html">[rabbitmq-discuss] STOMP adapter lose the last message of a	burst
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20130">[ date ]</a>
              <a href="thread.html#20130">[ thread ]</a>
              <a href="subject.html#20130">[ subject ]</a>
              <a href="author.html#20130">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think I've found a somewhat serious bug in the STOMP adapter: after a 
burst of incoming messages, the last one remains buffered somewhere 
indefinitely and is not added to the queue until another message is 
received from the same connection (same with topics). This cause and 
excessive delay to deliver the message to consumers, if it is ever 
delivered. Besides that, that last message is lost if the connection is not 
properly closed.

I've attached a simple script which replicates the bug. It sends burst of 
100 small messages to a queue every 10 seconds. Using the management 
console, we can inspect the count of Ready messages. The expected 
progression is 100 ... 200 ... 300 ... 400 ... 500, but very frequently 
(not always) we get 99 ... 199 ... 299 ... 399 ... 499, as the last message 
is not queued.

Could be that the STOMP parser gets confused after an incomplete frame was 
read from tcp buffer? Any ideas?

Regards,
Jos&#233;
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/59a5e2d2/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/59a5e2d2/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: stomp_bug.pl
Type: text/x-perl
Size: 1181 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/59a5e2d2/attachment.pl">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/59a5e2d2/attachment.pl</A>&gt;
</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020134.html">[rabbitmq-discuss] Disk space monitoring watermark issue on	2.8.2
</A></li>
	<LI>Next message: <A HREF="020350.html">[rabbitmq-discuss] STOMP adapter lose the last message of a	burst
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20130">[ date ]</a>
              <a href="thread.html#20130">[ thread ]</a>
              <a href="subject.html#20130">[ subject ]</a>
              <a href="author.html#20130">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
