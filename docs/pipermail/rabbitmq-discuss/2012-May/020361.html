<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Pika write buffer problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Pika%20write%20buffer%20problem&In-Reply-To=%3CB8B68C3D41791846910BA4C7AF61D25B0822D7%40ganymede.gebaschtel.bnet%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020349.html">
   <LINK REL="Next"  HREF="020354.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Pika write buffer problem</H1>
    <B>Josh Geisser</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Pika%20write%20buffer%20problem&In-Reply-To=%3CB8B68C3D41791846910BA4C7AF61D25B0822D7%40ganymede.gebaschtel.bnet%3E"
       TITLE="[rabbitmq-discuss] Pika write buffer problem">josh at gebaschtel.ch
       </A><BR>
    <I>Mon May 28 13:30:11 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020349.html">[rabbitmq-discuss] Pika write buffer problem
</A></li>
        <LI>Next message: <A HREF="020354.html">[rabbitmq-discuss] is the default administrator account too weak?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20361">[ date ]</a>
              <a href="thread.html#20361">[ thread ]</a>
              <a href="subject.html#20361">[ subject ]</a>
              <a href="author.html#20361">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I had the same issue, depending on the meg size and network layout it can publish like 1&#8217;000msg, and then pika crashes with publishing the like 10&#8217;000th message. It will continue to publish messages (no matter whether actually sent to the broker or not) until it hits the end of the buffer.

In order to avoid this either do not publish too fast, implement the TCP_Backpressure CB to let the buffer drain, or use transactional channels which seems to avoid this issue at all.

Cheers
josh

From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A> [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] On Behalf Of Gavin M. Roy
Sent: Sonntag, 27. Mai 2012 23:01
To: James Dear
Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] Pika write buffer problem

The warnings are just warnings, letting you know that the writes to rabbitMQ are not happening as quickly as you'd like them to do. Are you saying they are not actually getting into RabbitMQ?

On Sunday, May 27, 2012 at 4:27 PM, James Dear wrote:
Hi,

I'm having trouble getting simple examples of basic_publish to work due to the write buffer being exceeded. If I use the demo_send code from here&lt;<A HREF="http://pika.github.com/examples.html">http://pika.github.com/examples.html</A>&gt;, I only manage to send 5 messages before getting write buffer exceeded problems. Here's my output:

[INFO     2012-05-27 20:30:16,863  #5451] Connecting fd 3 to 127.0.0.1:5672&lt;<A HREF="http://127.0.0.1:5672">http://127.0.0.1:5672</A>&gt;
[INFO     2012-05-27 20:30:17,869  #5451] demo_send: Connected to RabbitMQ
[INFO     2012-05-27 20:30:17,872  #5451] demo_send: Received our Channel
[INFO     2012-05-27 20:30:17,882  #5451] demo_send: Queue Declared
[INFO     2012-05-27 20:30:17,883  #5451] Sending: Hello World #0: 1338147017.88308692
[INFO     2012-05-27 20:30:17,883  #5451] Sending: Hello World #1: 1338147017.88367391
[INFO     2012-05-27 20:30:17,884  #5451] Sending: Hello World #2: 1338147017.88425899
[INFO     2012-05-27 20:30:17,884  #5451] Sending: Hello World #3: 1338147017.88472700
[INFO     2012-05-27 20:30:17,885  #5451] Sending: Hello World #4: 1338147017.88527107
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 413 bytes and an estimated 10 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 447 bytes and an estimated 11 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 490 bytes and an estimated 12 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
[INFO     2012-05-27 20:30:17,887  #5451] Sending: Hello World #5: 1338147017.88733912
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 511 bytes and an estimated 13 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 545 bytes and an estimated 14 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 588 bytes and an estimated 15 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))

etc etc

On the other hand, everything works fine with pika twisted and the msgs do end up on RabbitMQ with pika twisted, so it doesn't seem to be a restriction to do with RabbitMQ per se.

I've created gists&lt;<A HREF="https://gist.github.com/2815757">https://gist.github.com/2815757</A>&gt; for the pika native code which doesn't work and the pika twisted code that does work.

If anyone could help, I would greatly appreciate it.

James
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>




--

----

ASG at hnet
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120528/ff352cf8/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120528/ff352cf8/attachment.htm</A>&gt;
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020349.html">[rabbitmq-discuss] Pika write buffer problem
</A></li>
	<LI>Next message: <A HREF="020354.html">[rabbitmq-discuss] is the default administrator account too weak?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20361">[ date ]</a>
              <a href="thread.html#20361">[ thread ]</a>
              <a href="subject.html#20361">[ subject ]</a>
              <a href="author.html#20361">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
