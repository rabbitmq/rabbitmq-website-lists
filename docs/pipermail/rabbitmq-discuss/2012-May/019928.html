<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Queues with high memory consumption
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queues%20with%20high%20memory%20consumption&In-Reply-To=%3C4FA9020F.5040102%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019902.html">
   <LINK REL="Next"  HREF="019964.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Queues with high memory consumption</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queues%20with%20high%20memory%20consumption&In-Reply-To=%3C4FA9020F.5040102%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Queues with high memory consumption">matthias at rabbitmq.com
       </A><BR>
    <I>Tue May  8 12:22:55 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019902.html">[rabbitmq-discuss] Queues with high memory consumption
</A></li>
        <LI>Next message: <A HREF="019964.html">[rabbitmq-discuss] Queues with high memory consumption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19928">[ date ]</a>
              <a href="thread.html#19928">[ thread ]</a>
              <a href="subject.html#19928">[ subject ]</a>
              <a href="author.html#19928">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Pablo,

On 07/05/12 19:28, Pablo Molnar wrote:
&gt;<i> I'm trying to figure out why the memory consumption of some queues
</I>&gt;<i> are  extremely high although there is almost none messages ready to consume.
</I>&gt;<i> For instance this queue has only 3 messages but consumes 2.4GB of
</I>&gt;<i> RAM.
</I>
That is not necessarily a problem, in particular ...

&gt;<i> {
</I>&gt;<i>    &quot;exclusive_consumer_tag&quot;:&quot;&quot;,
</I>&gt;<i>    &quot;messages_ready&quot;:0,
</I>&gt;<i>    &quot;messages_unacknowledged&quot;:3,
</I>&gt;<i>    &quot;messages&quot;:3,
</I>&gt;<i>    &quot;consumers&quot;:25,
</I>&gt;<i>    &quot;memory&quot;:2586777216,
</I>&gt;<i>    &quot;slave_nodes&quot;:[
</I>&gt;<i>
</I>&gt;<i>    ],
</I>&gt;<i>    &quot;backing_queue_status&quot;:{
</I>&gt;<i>       &quot;q1&quot;:0,
</I>&gt;<i>       &quot;q2&quot;:0,
</I>&gt;<i>       &quot;delta&quot;:[
</I>&gt;<i>          &quot;delta&quot;,
</I>&gt;<i>          &quot;undefined&quot;,
</I>&gt;<i>          0,
</I>&gt;<i>          &quot;undefined&quot;
</I>&gt;<i>       ],
</I>&gt;<i>       &quot;q3&quot;:0,
</I>&gt;<i>       &quot;q4&quot;:0,
</I>&gt;<i>       &quot;len&quot;:0,
</I>&gt;<i>       &quot;pending_acks&quot;:3,
</I>&gt;<i>       &quot;target_ram_count&quot;:0,
</I>&gt;<i>       &quot;ram_msg_count&quot;:0,
</I>&gt;<i>       &quot;ram_ack_count&quot;:0,
</I>&gt;<i>       &quot;next_seq_id&quot;:72528926,
</I>&gt;<i>       &quot;persistent_count&quot;:3,
</I>&gt;<i>       &quot;avg_ingress_rate&quot;:42.456013780009044,
</I>&gt;<i>       &quot;avg_egress_rate&quot;:42.456013780009044,
</I>&gt;<i>       &quot;avg_ack_ingress_rate&quot;:42.456013780009044,
</I>&gt;<i>       &quot;avg_ack_egress_rate&quot;:42.456013780009044
</I>&gt;<i>    },  ...
</I>
...this is a slow-moving, but not idle queue. I suspect what happened is 
that at some point the queue did have lots of messages in it, hence 
requiring lots of memory. Those messages subsequently got drained, but 
the since the queue is slow moving it can take a while for Erlang's gc 
to reclaim memory.

Unless this is causing any other problems I wouldn't worry about it.

&gt;<i> rabbitmqctl status
</I>&gt;<i> Status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at i-00000140-csm</A>' ...
</I>&gt;<i> [{pid,20106},
</I>&gt;<i>  {running_applications,
</I>&gt;<i>      [{rabbitmq_management_visualiser,&quot;RabbitMQ Visualiser&quot;,&quot;2.7.1&quot;},
</I>&gt;<i>       {rabbitmq_management,&quot;RabbitMQ Management Console&quot;,&quot;2.7.1&quot;},
</I>&gt;<i>       {rabbitmq_mochiweb,&quot;RabbitMQ Mochiweb Embedding&quot;,&quot;2.7.1&quot;},
</I>&gt;<i>       {webmachine,&quot;webmachine&quot;,&quot;1.7.0-rmq2.7.1-hg&quot;},
</I>&gt;<i>       {amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;2.7.1&quot;},
</I>&gt;<i>       {rabbitmq_management_agent,&quot;RabbitMQ Management Agent&quot;,&quot;2.7.1&quot;},
</I>&gt;<i>       {rabbit,&quot;RabbitMQ&quot;,&quot;2.7.1&quot;},
</I>&gt;<i>       {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.8&quot;},
</I>&gt;<i>       {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.2&quot;},
</I>&gt;<i>       {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;1.3-rmq2.7.1-git&quot;},
</I>&gt;<i>       {inets,&quot;INETS  CXC 138 49&quot;,&quot;5.8&quot;},
</I>&gt;<i>       {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.6&quot;},
</I>&gt;<i>       {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.18&quot;},
</I>&gt;<i>       {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.15&quot;}]},
</I>&gt;<i>  {os,{unix,linux}},
</I>&gt;<i>  {erlang_version,
</I>&gt;<i>      &quot;Erlang R15B (erts-5.9) [source] [64-bit] [smp:4:4] [async-threads:0] [hipe] [kernel-poll:false]\n&quot;},
</I>&gt;<i>  {memory,
</I>&gt;<i>      [{total,4736488576},
</I>&gt;<i>       {processes,3832122172},
</I>&gt;<i>       {processes_used,3832066481},
</I>&gt;<i>       {system,904366404},
</I>&gt;<i>       {atom,561761},
</I>&gt;<i>       {atom_used,551430},
</I>&gt;<i>       {binary,98523592},
</I>&gt;<i>       {code,15193946},
</I>&gt;<i>       {ets,717445688}]},
</I>&gt;<i>  {vm_memory_high_watermark,0.6999999999761628},
</I>&gt;<i>  {vm_memory_limit,5873161011}]
</I>&gt;<i> ...done.
</I>
You may want to upgrade to the latest Erlang (R15B01) and rabbit 
(2.8.2), though I doubt that will make a difference.


Regards,

Matthias.
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019902.html">[rabbitmq-discuss] Queues with high memory consumption
</A></li>
	<LI>Next message: <A HREF="019964.html">[rabbitmq-discuss] Queues with high memory consumption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19928">[ date ]</a>
              <a href="thread.html#19928">[ thread ]</a>
              <a href="subject.html#19928">[ subject ]</a>
              <a href="author.html#19928">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
