<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster Disk Node failure and cluster membership
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20Disk%20Node%20failure%20and%20cluster%20membership&In-Reply-To=%3C31aa1f35-0ffb-4d6e-be9c-56d8a7fd4260%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020313.html">
   <LINK REL="Next"  HREF="020314.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster Disk Node failure and cluster membership</H1>
    <B>Kevin Nuckolls</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20Disk%20Node%20failure%20and%20cluster%20membership&In-Reply-To=%3C31aa1f35-0ffb-4d6e-be9c-56d8a7fd4260%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Cluster Disk Node failure and cluster membership">kevin.nuckolls at gmail.com
       </A><BR>
    <I>Fri May 25 05:29:49 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020313.html">[rabbitmq-discuss] in 2.8.2, when bringing 500 subscribers on line, all publishing blocks until queues empty
</A></li>
        <LI>Next message: <A HREF="020314.html">[rabbitmq-discuss] .NET DefaultBasicConsumer / BasicQueuingConsumer and 'noack' scenarios
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20319">[ date ]</a>
              <a href="thread.html#20319">[ thread ]</a>
              <a href="subject.html#20319">[ subject ]</a>
              <a href="author.html#20319">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm hoping to automate the clustering steps with Chef and I have one 
pivotal question: If I have a cluster with three disc nodes in the cloud 
and one of them goes down and is gone forever, will the other nodes 
eventually give up on treating it as a disc node?

In that scenario, cluster_status would look something like this after 
kevin-rabbit1 terminated forever:

Cluster status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at kevin-rabbit2</A>' ...
[{nodes,[{disc,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at kevin-rabbit3</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at kevin-rabbit2</A>',
                '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at kevin-rabbit1</A>']}]},
 {running_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at kevin-rabbit3</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at kevin-rabbit2</A>']}]
...done.

The cluster just thinks that kevin-rabbit1 is &quot;off&quot; and that it might come 
back someday, right? Is there any way for me to tell the cluster &quot;sorry 
guys, that node is dead _forever_. Just forget about it and move on with 
your lives.&quot;

I saw this language in the cluster docs which makes me concerned about 
making sure that the cluster_status is clean and up to date with what nodes 
are alive and dead.

There are some important caveats:

   - All disk nodes must be running for certain operations, most notably 
   leaving a cluster, to succeed.
   - At least one disk node should be running at all times.
   - When all nodes in a cluster have been shut down, restarting any node 
   will suspend for up to 30 seconds and then fail if the last disk node that 
   was shut down has not been restarted yet. Since the nodes do not know what 
   happened to that last node, they have to assume that it holds a more 
   up-to-date version of the broker state. Hence, in order to preserve data 
   integrity, they cannot resume operation until that node is restarted.


That's why I want to make sure that the other nodes know that the lost disc 
node is never, ever coming back. 

Anyway thanks. Any insight will help :)

Kevin Nuckolls
Senior Software Engineer
Mosaik Solutions

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120524/77b696de/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120524/77b696de/attachment.htm</A>&gt;
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020313.html">[rabbitmq-discuss] in 2.8.2, when bringing 500 subscribers on line, all publishing blocks until queues empty
</A></li>
	<LI>Next message: <A HREF="020314.html">[rabbitmq-discuss] .NET DefaultBasicConsumer / BasicQueuingConsumer and 'noack' scenarios
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20319">[ date ]</a>
              <a href="thread.html#20319">[ thread ]</a>
              <a href="subject.html#20319">[ subject ]</a>
              <a href="author.html#20319">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
