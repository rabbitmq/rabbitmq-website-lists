<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Perl SSL support for Net::RabbitMQ
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Perl%20SSL%20support%20for%20Net%3A%3ARabbitMQ&In-Reply-To=%3CCA%2B0gB9mx%3DNjjaC0E2b87_VuwM4yn4j%2BmDR2n8NXRfRgBxyF3Vg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020318.html">
   <LINK REL="Next"  HREF="020311.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Perl SSL support for Net::RabbitMQ</H1>
    <B>Julio Polo</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Perl%20SSL%20support%20for%20Net%3A%3ARabbitMQ&In-Reply-To=%3CCA%2B0gB9mx%3DNjjaC0E2b87_VuwM4yn4j%2BmDR2n8NXRfRgBxyF3Vg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Perl SSL support for Net::RabbitMQ">julio at hawaii.edu
       </A><BR>
    <I>Tue May 29 22:21:47 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020318.html">[rabbitmq-discuss] Perl SSL support for Net::RabbitMQ
</A></li>
        <LI>Next message: <A HREF="020311.html">[rabbitmq-discuss] some basic management questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20375">[ date ]</a>
              <a href="thread.html#20375">[ thread ]</a>
              <a href="subject.html#20375">[ subject ]</a>
              <a href="author.html#20375">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If you are willing to use AnyEvent::RabbitMQ (chosen because it
required the least amount of additional software), I have a simple
patch to version 1.05 to make it work with SSL:

/usr/local/lib/site_perl/5.8.x/AnyEvent# diff RabbitMQ.pm.bak RabbitMQ.pm
95c95
&lt;             $self-&gt;{_handle} = AnyEvent::Handle-&gt;new(
---
&gt;<i>             my %handle_args = (
</I>113a114,117
&gt;<i>             if ($args{tls}) {
</I>&gt;<i>                 $handle_args{tls} = 'connect';
</I>&gt;<i>             }
</I>&gt;<i>             $self-&gt;{_handle} = AnyEvent::Handle-&gt;new(%handle_args);
</I>
and you would simply add tls =&gt; 1 to the connection settings.
Hopefully this snippet of code is self-explanatory:

    my %basic_settings =
    (
        host       =&gt; $conf-&gt;{$CONF_host},
        port       =&gt; $conf-&gt;{$CONF_port},
        user       =&gt; $conf-&gt;{$CONF_user},
        pass       =&gt; $conf-&gt;{$CONF_pass},
        vhost      =&gt; $conf-&gt;{$CONF_vhost},
        timeout    =&gt; $conf-&gt;{$CONF_timeout},
    );

    # the tls option requires this patch to AnyEvent::RabbitMQ
=pod
95c95
&lt;             $self-&gt;{_handle} = AnyEvent::Handle-&gt;new(
---
&gt;<i>             my %handle_args = (
</I>113a114,117
&gt;<i>             if ($args{tls}) {
</I>&gt;<i>                 $handle_args{tls} = 'connect';
</I>&gt;<i>             }
</I>&gt;<i>             $self-&gt;{_handle} = AnyEvent::Handle-&gt;new(%handle_args);
</I>=cut
    if ($conf-&gt;{$CONF_secure})
    {
        $basic_settings{'tls'} = 1;  # this gets translated to connect
by above patch
    }

    my $cv = AnyEvent-&gt;condvar;

    my $ar;
    $ar = AnyEvent::RabbitMQ-&gt;new-&gt;load_xml_spec()-&gt;connect
    (
        %basic_settings,

        on_success =&gt; sub
        {
            $ar-&gt;open_channel
            (
                on_success =&gt; sub
                {
                    log_this( join(' ', 'RabbitMQ
open_channel-&gt;on_success: ', Dumper(@_)) ) if $debug;
                    shift-&gt;declare_exchange
                    (
                        exchange   =&gt; $exchange_name,
                        type       =&gt; 'topic',
                        passive    =&gt; $exchange_passive,
                        durable     =&gt; 1,
                        auto_delete =&gt; 0,
#                       internal    =&gt; 0,
                        on_success =&gt; sub
                        {
                            $cv-&gt;send(&quot;Declared exchange $exchange_name&quot;);
                        },
                        on_failure =&gt; $cv,
                    );
                },

                on_failure =&gt; $cv,

                on_close   =&gt; sub
                {
                    croak join(' ', 'RabbitMQ open_channel-&gt;on_close:
', Dumper(@_));
                }

            ); # open_channel

        }, # on_success

        on_failure      =&gt; $cv,

        on_read_failure =&gt; sub
        {
            croak join(' ', 'RabbitMQ connect-&gt;on_read_failure: ', Dumper(@_));
        },

        on_close        =&gt; sub
        {
            croak join(' ', 'RabbitMQ connect-&gt;on_close: ', Dumper(@_));
        },
    );

    $cv-&gt;recv;

    # return the channel for this connection
    my $channel = $ar-&gt;channels-&gt;{1}
        or croak &quot;No channel in _connect\n&quot;;

We were planning to publish some of this code.  I can make it
available sooner if anyone is interested.

Julio Polo
Identity and Access Management
Information Technology Services
University of Hawaii


On Thu, May 24, 2012 at 4:15 PM, xtrm &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">xtrm2008 at live.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> So what is everyone doing in regards to SSL support? &#160;Is everyone using
</I>&gt;<i> either .NET or Java for their implementations?
</I>&gt;<i>
</I>&gt;<i> Thanks again for the help
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Alan Antonuk wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I believe (someone correct me if I'm wrong) Net::RabbitMQ is just a
</I>&gt;&gt;<i> wrapper
</I>&gt;&gt;<i> around the rabbitmq-c library, which does not support SSL as of yet, so
</I>&gt;&gt;<i> Net::RabbitMQ probably doesn't support SSL yet.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> There is currently an effort underway to add SSL support to rabbitmq-c,
</I>&gt;&gt;<i> but
</I>&gt;&gt;<i> it is not complete yet.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -Alan
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Thu, May 24, 2012 at 9:36 AM, xtrm &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">xtrm2008 at live.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hello all,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> New to RabbitMQ and hoping someone on the forum has been through this
</I>&gt;&gt;&gt;<i> before. I am trying to implement SSL client authentication to use with on
</I>&gt;&gt;&gt;<i> all our clients. &#160;I am unable to find any documentation on how to go
</I>&gt;&gt;&gt;<i> about
</I>&gt;&gt;&gt;<i> doing this. &#160;I was able to find two examples in .NET and Java on the
</I>&gt;&gt;&gt;<i> rabbitMQ SSL support website, but no mention on how to implement using
</I>&gt;&gt;&gt;<i> Perl.
</I>&gt;&gt;&gt;<i> Has anyone gotten this working? &#160;If so how did you guys go about
</I>&gt;&gt;&gt;<i> implementing SSL support?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I currently have my clients publishing successfully using the non SSL
</I>&gt;&gt;&gt;<i> port
</I>&gt;&gt;&gt;<i> using Net::RabbitMQ module.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks for the help in advance.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;<i> View this message in context:
</I>&gt;&gt;&gt;<i> <A HREF="http://old.nabble.com/Perl-SSL-support-for-Net%3A%3ARabbitMQ-tp33901964p33901964.html">http://old.nabble.com/Perl-SSL-support-for-Net%3A%3ARabbitMQ-tp33901964p33901964.html</A>
</I>&gt;&gt;&gt;<i> Sent from the RabbitMQ mailing list archive at Nabble.com.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://old.nabble.com/Perl-SSL-support-for-Net%3A%3ARabbitMQ-tp33901964p33905637.html">http://old.nabble.com/Perl-SSL-support-for-Net%3A%3ARabbitMQ-tp33901964p33905637.html</A>
</I>&gt;<i> Sent from the RabbitMQ mailing list archive at Nabble.com.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020318.html">[rabbitmq-discuss] Perl SSL support for Net::RabbitMQ
</A></li>
	<LI>Next message: <A HREF="020311.html">[rabbitmq-discuss] some basic management questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20375">[ date ]</a>
              <a href="thread.html#20375">[ thread ]</a>
              <a href="subject.html#20375">[ subject ]</a>
              <a href="author.html#20375">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
