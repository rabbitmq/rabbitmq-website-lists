<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Mirrored queue failover
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mirrored%20queue%20failover&In-Reply-To=%3C4FA8E2B9.1060601%40ms.scsk.jp%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019920.html">
   <LINK REL="Next"  HREF="019918.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Mirrored queue failover</H1>
    <B>Katsushi Fukui</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mirrored%20queue%20failover&In-Reply-To=%3C4FA8E2B9.1060601%40ms.scsk.jp%3E"
       TITLE="[rabbitmq-discuss] Mirrored queue failover">ka.fukui at ms.scsk.jp
       </A><BR>
    <I>Tue May  8 10:09:13 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019920.html">[rabbitmq-discuss] Updating RabbitMQ to latest version
</A></li>
        <LI>Next message: <A HREF="019918.html">[rabbitmq-discuss] Cannot change the STOMP port on the CentOS?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19910">[ date ]</a>
              <a href="thread.html#19910">[ thread ]</a>
              <a href="subject.html#19910">[ subject ]</a>
              <a href="author.html#19910">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I also checked this issue with v2.8.2, but the situation is not improved.

Kats


(2012/04/19 14:41), Katsushi Fukui wrote:
&gt;<i> Hi Matthew,
</I>&gt;<i>
</I>&gt;<i> I found an interesting behavior and logs when I repeatedly restarted a node of the cluster.
</I>&gt;<i> I rebuilt a new cluster and checked a logs of the mirrored queue again. Now the master of the mirrored queue is rabbit1, the slaves are rabbit2 and rabbit3. When rabbit3 is stopped, the logs of the rabbit1 shows:
</I>&gt;<i> =INFO REPORT==== 19-Apr-2012::11:18:58 ===
</I>&gt;<i> Mirrored-queue (queue 'que1' in vhost '/'): Master &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit1.2.594.0</A>&gt; saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3.3.229.0</A>&gt;
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 19-Apr-2012::11:18:59 ===
</I>&gt;<i> rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3</A> down
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This means that que1 detected death of the queue slave on rabbit3 and node is down. But if I repeat restarting the slaves over and over, sometime logs shows like this:
</I>&gt;<i> =INFO REPORT==== 19-Apr-2012::11:56:26 ===
</I>&gt;<i> Mirrored-queue (queue 'que1' in vhost '/'): Master &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit1.2.594.0</A>&gt; saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3.3.229.0</A>&gt;
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 19-Apr-2012::11:56:26 ===
</I>&gt;<i> rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3</A> down
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 19-Apr-2012::11:56:35 ===
</I>&gt;<i> rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3</A> up
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 19-Apr-2012::11:56:38 ===
</I>&gt;<i> rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit2</A> down
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 19-Apr-2012::11:59:32 ===
</I>&gt;<i> rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit2</A> up
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Despite stopping rabbit2, que1 doesn't report death of mirror. Now rabbit2 is up, but que1 has only one slave on rabbit3.&#12288;Next, I stopped rabbit3 and the logs shows:
</I>&gt;<i> =INFO REPORT==== 19-Apr-2012::12:00:04 ===
</I>&gt;<i> Mirrored-queue (queue 'que1' in vhost '/'): Master &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit1.2.594.0</A>&gt; saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit2.3.229.0</A>&gt; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3.1.227.0</A>&gt;
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 19-Apr-2012::12:00:04 ===
</I>&gt;<i> rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3</A> down
</I>&gt;<i>
</I>&gt;<i> Que1 detected deaths of two slaves. Finally I restarted rabbit2 and rabbit3, so que1 got two slaves.
</I>&gt;<i> It looks there is a case a mirrored queue can not detect the failure of the slaves.
</I>&gt;<i>
</I>&gt;<i> Kats
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Thank you, Matthew,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I created an exchange &quot;ex1&quot; that is bound to que1, and published a message using a publisher was connected to rabbit3 as you suggested.
</I>&gt;&gt;<i> I could send it without returning error, but the logs of rabbit3 shows this error:
</I>&gt;&gt;<i> =ERROR REPORT==== 17-Apr-2012::11:12:30 ===
</I>&gt;&gt;<i> Discarding message {'$gen_cast',{deliver,{delivery,false,false,&lt;0.3061.0&gt;,{basic_message,{resource,&lt;&lt;1 byte&gt;&gt;,exchange,&lt;&lt;3 bytes&gt;&gt;},[&lt;&lt;5 bytes&gt;&gt;],{content,60,{'P_basic',&lt;&lt;10 bytes&gt;&gt;,undefined,undefined,2,0,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined},&lt;&lt;15 bytes&gt;&gt;,rabbit_framing_amqp_0_9_1,[&lt;&lt;12 bytes&gt;&gt;]},&lt;&lt;16 bytes&gt;&gt;,true},undefined},flow}} from &lt;0.3061.0&gt; to &lt;0.229.0&gt; in an old incarnation (3) of this node (2)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The result of list_queues is:
</I>&gt;&gt;<i> # ./rabbitmqctl list_queues name messages slave_pids synchronised_slave_pids
</I>&gt;&gt;<i> Listing queues ...
</I>&gt;&gt;<i> que1 1 [&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit2.1.229.0</A>&gt;] [&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit2.1.229.0</A>&gt;]
</I>&gt;&gt;<i> ...done.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I wonder if this problem is only occurred in my environment.
</I>&gt;&gt;<i>
</I>

</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019920.html">[rabbitmq-discuss] Updating RabbitMQ to latest version
</A></li>
	<LI>Next message: <A HREF="019918.html">[rabbitmq-discuss] Cannot change the STOMP port on the CentOS?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19910">[ date ]</a>
              <a href="thread.html#19910">[ thread ]</a>
              <a href="subject.html#19910">[ subject ]</a>
              <a href="author.html#19910">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
