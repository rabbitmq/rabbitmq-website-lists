<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Behind NAT issue with pika client :: keep alive :: heartbeat - How to detect dead connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Behind%20NAT%20issue%20with%20pika%20client%20%3A%3A%20keep%20alive%0A%20%3A%3A%20heartbeat%20-%20How%20to%20detect%20dead%20connection&In-Reply-To=%3C44e62cab-d05a-4c6b-8d6c-499d19eceded%40e20g2000vbm.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020032.html">
   <LINK REL="Next"  HREF="020038.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Behind NAT issue with pika client :: keep alive :: heartbeat - How to detect dead connection</H1>
    <B>alkos</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Behind%20NAT%20issue%20with%20pika%20client%20%3A%3A%20keep%20alive%0A%20%3A%3A%20heartbeat%20-%20How%20to%20detect%20dead%20connection&In-Reply-To=%3C44e62cab-d05a-4c6b-8d6c-499d19eceded%40e20g2000vbm.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Behind NAT issue with pika client :: keep alive :: heartbeat - How to detect dead connection">cybersayo at gmail.com
       </A><BR>
    <I>Tue May 15 08:49:25 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020032.html">[rabbitmq-discuss] RabbitMQ Management only via HTTP API
</A></li>
        <LI>Next message: <A HREF="020038.html">[rabbitmq-discuss] Behind NAT issue with pika client :: keep alive :: heartbeat - How to detect dead connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20035">[ date ]</a>
              <a href="thread.html#20035">[ thread ]</a>
              <a href="subject.html#20035">[ subject ]</a>
              <a href="author.html#20035">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I'm having pika client that act as consumer/producer in same time, rpc
scenario. As a consumer it waits for command from rabbitmq and when it
rcv's client execute function and returns result to rabbgitmq.
In lab conditions (permanent IP address without any firewall in
between client and rabbitmq server) there was no problem, at least not
in 3-4 days.
When we put client behind NAT, consumer stop rcv after few hours.
Problem, ofcourse was change end-to-end path of tcp connection. DHCP
would give different IP address to WAN interface of ADSL, or even to
PC with pika client. Previously established connection is still there
with ESTABLISHED status (netstat -t shows it) - even of rabbitmq
server I can still see that socket connection with ESTABLISHED
status.

I've tryed to put in rabbitmq.config keep alive option but with now
success at all.

Since I'm using RPC scenario, I'm using BlockingConnection.
Also, I've tryed to put heartbeat=True, but then script keep closing
and opens connection - probably due to callback function.
Even with threading class that implement function that is called in
callback I have the same issue.

I can hardly beleive that I'm the only one person who have this kind
of problem, since I didnt find any simple solution to this problem.

So, basicly my question is how to detect from within script that there
is no end-to-end connection to rabbitmq even though socket exists?

Thaks,

Aleks
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020032.html">[rabbitmq-discuss] RabbitMQ Management only via HTTP API
</A></li>
	<LI>Next message: <A HREF="020038.html">[rabbitmq-discuss] Behind NAT issue with pika client :: keep alive :: heartbeat - How to detect dead connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20035">[ date ]</a>
              <a href="thread.html#20035">[ thread ]</a>
              <a href="subject.html#20035">[ subject ]</a>
              <a href="author.html#20035">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
