<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ server closing connection every few	minutes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20server%20closing%20connection%20every%20few%0A%09minutes&In-Reply-To=%3CCA%2BO6_Ff1LO4V-voUkY5-JvL5g8j56dnSd4QMJ9qvteVdn3Oi7A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020263.html">
   <LINK REL="Next"  HREF="020234.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ server closing connection every few	minutes</H1>
    <B>David Tinker</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20server%20closing%20connection%20every%20few%0A%09minutes&In-Reply-To=%3CCA%2BO6_Ff1LO4V-voUkY5-JvL5g8j56dnSd4QMJ9qvteVdn3Oi7A%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ server closing connection every few	minutes">david.tinker at gmail.com
       </A><BR>
    <I>Tue May 22 07:34:13 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020263.html">[rabbitmq-discuss] rabbitmq was shutdown unwanted
</A></li>
        <LI>Next message: <A HREF="020234.html">[rabbitmq-discuss] RabbitMQ server closing connection every few minutes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20231">[ date ]</a>
              <a href="thread.html#20231">[ thread ]</a>
              <a href="subject.html#20231">[ subject ]</a>
              <a href="author.html#20231">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

We have a Java application using RabbitMQ that keeps getting its
connection closed by the server every few minutes. On the client side
we see this:

2012-05-22 05:30:05,337 [AMQP Connection 127.0.0.1:5671] ERROR
pork.RabbitService &#160;- Connection to Rabbit Exchange shutting down:
com.rabbitmq.client.ShutdownSignalException: connection error; reason:
java.net.SocketException: Connection reset
Reason: java.net.SocketException: Connection reset

On the server side we get this:

=INFO REPORT==== 22-May-2012::05:25:20 ===
accepting AMQP connection &lt;0.32660.612&gt; (127.0.0.1:45458 -&gt; 127.0.0.1:5671)

=ERROR REPORT==== 22-May-2012::05:30:05 ===
closing AMQP connection &lt;0.32660.612&gt; (127.0.0.1:45458 -&gt; 127.0.0.1:5671):
{timeout,running}

It happens more frequently when the system is busy (500-1000
messages/s) than when it is cruising (50 messages/s). The application
and RabbitMQ are on the same box so I don't think its a
networking/firewall problem.

The application only uses one connection and one channel. Messages are
received using Connection.basicConsume(..) and acked or nacked
sometime later on different threads. It can sometimes be several
minutes before a message is acked or nacked. We are using
Connection.basicQos(10000) to limit the number of outstanding messages
but its not often that reaches 10000 and the error happens anytime.
There is defensive code to make sure messages are not acked/nacked
more than once.

Anyone have any ideas? Is there any way to get more information on the
server or client side regarding the error?

RabbitMQ 2.8.1 on Gentoo Linux 64bit
Erlang R15B (erts-5.9) [source] [64-bit]
amqp-client-2.8.2 (also tried amqp-client-2.7.1)
java version &quot;1.6.0_31&quot;
Java(TM) SE Runtime Environment (build 1.6.0_31-b04)
Java HotSpot(TM) 64-Bit Server VM (build 20.6-b01, mixed mode)

Thanks
David
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020263.html">[rabbitmq-discuss] rabbitmq was shutdown unwanted
</A></li>
	<LI>Next message: <A HREF="020234.html">[rabbitmq-discuss] RabbitMQ server closing connection every few minutes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20231">[ date ]</a>
              <a href="thread.html#20231">[ thread ]</a>
              <a href="subject.html#20231">[ subject ]</a>
              <a href="author.html#20231">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
