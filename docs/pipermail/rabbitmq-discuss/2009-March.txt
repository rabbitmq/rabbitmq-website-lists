From markkicks at gmail.com  Sun Mar  1 17:42:01 2009
From: markkicks at gmail.com (mark)
Date: Sun, 1 Mar 2009 09:42:01 -0800
Subject: [rabbitmq-discuss] Configuring the broker on Fedora 10 to start the
	stomp-plugin automatically
Message-ID: <82fa9e310903010942t195b195ch496ea17cfa14e46e@mail.gmail.com>

how do i configure /etc/init.d/rabbitmq-server to start stomp plugin
in fedora core 10 automatically? i tried adding the following to
/etc/sysconfig/rabbimtq

  SERVER_START_ARGS='
    -pa /path/to/rabbitmq-stomp/ebin
    -rabbit
       stomp_listeners [{"0.0.0.0",61613}]
       extra_startup_steps [{"STOMP-listeners",rabbit_stomp,kickstart,[]}]'



but it doesnt get picked up. the README has instructions only for debian/ubuntu.
thanks a lot!



From jonspalmer at gmail.com  Sun Mar  1 18:36:02 2009
From: jonspalmer at gmail.com (Jon Palmer)
Date: Sun, 1 Mar 2009 10:36:02 -0800
Subject: [rabbitmq-discuss] RabbitMQ.Net,
	Windows Powershell and CLS compliance
Message-ID: <6c54b85a0903011036q615da5adt4ddd4341004067ac@mail.gmail.com>

I am new to using RabbitMQ and I couldn't find if this question has been
asked on the mailing list before.
I'm trying to use RabbitMQ.Net inside a Powershell script. Something like
this:

[System.Reflection.Assembly]::LoadFile(  "C:\tools\RabbitMQ.Client.dll")

function GetAmqpChannel( $amqp_host ="127.0.0.1", $uid ="guest", $pwd
="guest")
{
$factory = new-object RabbitMQ.Client.ConnectionFactory
$protocol = [RabbitMQ.Client.Protocols]::DefaultProtocol
return $factory.CreateConnection($protocol, $amqp_host).CreateModel()
}

GetAmqpChannel



However I receive the following error:


The field/property: "shutdownReport" for type:
"RabbitMQ.Client.Framing.Impl.v0_8.Connection" differs only in case from
 the field/property: "ShutdownReport". Failed to use non CLS compliant type.


Looking at the source it seems that the problem is that RabbitMQ.Client.Impl
declares both

public *System.Collections.IList* ShutdownReport { get; }

public *System.Collections.IList* shutdownReport


As a result the Client.Impl class isn't CLS compliant. This prevents me from
using RabbitMQ.Net inside powershell. Does anyone have suggestions about how
this can be fixed? Are both the getter and the field a required part of the
public API or could one be removed?


Many thanks

Jon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090301/714ab416/attachment.htm 

From markkicks at gmail.com  Sun Mar  1 18:52:34 2009
From: markkicks at gmail.com (mark)
Date: Sun, 1 Mar 2009 10:52:34 -0800
Subject: [rabbitmq-discuss] rabbitmq stomp 1.5.3 version error
Message-ID: <82fa9e310903011052v6aa07269v4e5e10ff3795cd1f@mail.gmail.com>

hi
i had rabbitmq stomp working. i upgraded to the latest 1.5.3 and i get
this error

=ERROR REPORT==== 1-Mar-2009::10:51:00 ===
STOMP error frame sent:
Message: "Processing error"
Detail: "Processing error\n"
Server private detail: {undef,
                           [{rabbit_channel,start_link,
                                [rabbit_stomp,<0.213.0>,<0.213.0>,<<"guest">>,
                                 <<"/">>]},
                            {rabbit_stomp,do_login,4},
                            {rabbit_stomp,process_frame,3},
                            {rabbit_stomp,process_received_bytes,2},
                            {rabbit_stomp,init,1},
                            {proc_lib,init_p,5}]}

=INFO REPORT==== 1-Mar-2009::10:51:00 ===



how do i fix this?

thanks a lot!



From alexis.richardson at cohesiveft.com  Sun Mar  1 19:33:51 2009
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Sun, 1 Mar 2009 19:33:51 +0000
Subject: [rabbitmq-discuss] RabbitMQ.Net,
	Windows Powershell and CLS 	compliance
In-Reply-To: <6c54b85a0903011036q615da5adt4ddd4341004067ac@mail.gmail.com>
References: <6c54b85a0903011036q615da5adt4ddd4341004067ac@mail.gmail.com>
Message-ID: <167204d20903011133r3ee17c87yc48562a88b8eb297@mail.gmail.com>

Jon,

Thanks very much for raising this here.  Someone will look at your
'getter and the field' question asap.

Meanwhile (as it is Sunday..), can I ask if you have tried patching
the code per your suggested fix?  If so, can you let us know what
happens.

alexis


On Sun, Mar 1, 2009 at 6:36 PM, Jon Palmer <jonspalmer at gmail.com> wrote:
> I am new to using RabbitMQ and I couldn't find if this question has been
> asked on the mailing list before.
> I'm trying to use RabbitMQ.Net inside a Powershell script. Something like
> this:
>
> [System.Reflection.Assembly]::LoadFile( ?"C:\tools\RabbitMQ.Client.dll")
> function GetAmqpChannel( $amqp_host ="127.0.0.1", $uid ="guest", $pwd
> ="guest")
> {
> $factory = new-object RabbitMQ.Client.ConnectionFactory
> $protocol = [RabbitMQ.Client.Protocols]::DefaultProtocol
> return $factory.CreateConnection($protocol, $amqp_host).CreateModel()
> }
> GetAmqpChannel
>
>
>
> However I receive the following error:
>
> The field/property: "shutdownReport" for type:
> "RabbitMQ.Client.Framing.Impl.v0_8.Connection" differs only in case from
> ?the field/property: "ShutdownReport". Failed to use non CLS compliant type.
>
> Looking at the source it seems that the problem is that?RabbitMQ.Client.Impl
> declares both
>
> public System.Collections.IList ShutdownReport { get; }
>
> public System.Collections.IList shutdownReport
>
> As a result the Client.Impl class isn't CLS compliant. This prevents me from
> using RabbitMQ.Net inside powershell. Does anyone have suggestions about how
> this can be fixed? Are both the getter and the field a required part of the
> public API or could one be removed?
>
> Many thanks
>
> Jon
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From jonspalmer at gmail.com  Sun Mar  1 19:39:29 2009
From: jonspalmer at gmail.com (Jon Palmer)
Date: Sun, 1 Mar 2009 11:39:29 -0800
Subject: [rabbitmq-discuss] RabbitMQ.Net,
	Windows Powershell and CLS 	compliance
In-Reply-To: <167204d20903011133r3ee17c87yc48562a88b8eb297@mail.gmail.com>
References: <6c54b85a0903011036q615da5adt4ddd4341004067ac@mail.gmail.com>
	<167204d20903011133r3ee17c87yc48562a88b8eb297@mail.gmail.com>
Message-ID: <6c54b85a0903011139k7bdbb0d2jd19badcbb021d492@mail.gmail.com>

I am going to try modifying the source to remove the public field as the
next step. However I have two concerns:
1. I'm slightly afraid that there might be other examples of this problem
lurking.
2. Fixing the problem is a 'breaking change' in that it requires removing a
public field. Its unlikely to be a big deal because the fix to use the
property that is left is easy. However it might break some code that relies
on the removed field.

Jon


On Sun, Mar 1, 2009 at 11:33 AM, Alexis Richardson <
alexis.richardson at cohesiveft.com> wrote:

> Jon,
>
> Thanks very much for raising this here.  Someone will look at your
> 'getter and the field' question asap.
>
> Meanwhile (as it is Sunday..), can I ask if you have tried patching
> the code per your suggested fix?  If so, can you let us know what
> happens.
>
> alexis
>
>
> On Sun, Mar 1, 2009 at 6:36 PM, Jon Palmer <jonspalmer at gmail.com> wrote:
> > I am new to using RabbitMQ and I couldn't find if this question has been
> > asked on the mailing list before.
> > I'm trying to use RabbitMQ.Net inside a Powershell script. Something like
> > this:
> >
> > [System.Reflection.Assembly]::LoadFile(  "C:\tools\RabbitMQ.Client.dll")
> > function GetAmqpChannel( $amqp_host ="127.0.0.1", $uid ="guest", $pwd
> > ="guest")
> > {
> > $factory = new-object RabbitMQ.Client.ConnectionFactory
> > $protocol = [RabbitMQ.Client.Protocols]::DefaultProtocol
> > return $factory.CreateConnection($protocol, $amqp_host).CreateModel()
> > }
> > GetAmqpChannel
> >
> >
> >
> > However I receive the following error:
> >
> > The field/property: "shutdownReport" for type:
> > "RabbitMQ.Client.Framing.Impl.v0_8.Connection" differs only in case from
> >  the field/property: "ShutdownReport". Failed to use non CLS compliant
> type.
> >
> > Looking at the source it seems that the problem is
> that RabbitMQ.Client.Impl
> > declares both
> >
> > public System.Collections.IList ShutdownReport { get; }
> >
> > public System.Collections.IList shutdownReport
> >
> > As a result the Client.Impl class isn't CLS compliant. This prevents me
> from
> > using RabbitMQ.Net inside powershell. Does anyone have suggestions about
> how
> > this can be fixed? Are both the getter and the field a required part of
> the
> > public API or could one be removed?
> >
> > Many thanks
> >
> > Jon
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090301/eb494bbf/attachment.htm 

From jonspalmer at gmail.com  Sun Mar  1 22:13:29 2009
From: jonspalmer at gmail.com (Jon Palmer)
Date: Sun, 1 Mar 2009 14:13:29 -0800
Subject: [rabbitmq-discuss] Weird mercurial error cloning
	abbitmg-dotnet-client repository
Message-ID: <6c54b85a0903011413r455d7f8dh53510861b9d41f66@mail.gmail.com>

I'm trying to clone a fresh version of the rabbitmg-dotnet-client but get
this weird error:

C:\dev>hg clone http://hg.rabbitmq.com/rabbitmq-dotnet-client/
destination directory: rabbitmq-dotnet-client
requesting all changes
adding changesets
adding manifests
adding file changes
transaction abort!
rollback completed
** unknown exception encountered, details follow
** report bug details to http://www.selenic.com/mercurial/bts
** or mercurial at selenic.com
** Mercurial Distributed SCM (version 1.1.1+20081229)
** Extensions loaded: win32text
Traceback (most recent call last):
  File "hg", line 20, in <module>
  File "mercurial\dispatch.pyc", line 20, in run
  File "mercurial\dispatch.pyc", line 29, in dispatch
  File "mercurial\dispatch.pyc", line 45, in _runcatch
  File "mercurial\dispatch.pyc", line 367, in _dispatch
  File "mercurial\dispatch.pyc", line 416, in _runcommand
  File "mercurial\dispatch.pyc", line 376, in checkargs
  File "mercurial\dispatch.pyc", line 361, in <lambda>
  File "mercurial\util.pyc", line 715, in check
  File "mercurial\commands.pyc", line 595, in clone
  File "mercurial\hg.pyc", line 215, in clone
  File "mercurial\localrepo.pyc", line 2137, in clone
  File "mercurial\localrepo.pyc", line 1481, in pull
  File "mercurial\localrepo.pyc", line 2029, in addchangegroup
  File "mercurial\revlog.pyc", line 1202, in addgroup
  File "mercurial\changegroup.pyc", line 31, in chunkiter
  File "mercurial\changegroup.pyc", line 21, in getchunk
  File "mercurial\util.pyc", line 1662, in read
  File "mercurial\httprepo.pyc", line 19, in zgenerator
zlib.error: Error -3 while decompressing: too many length or distance
symbols


Any one have any thoughts on what the problem is? Can others checkout/update
from the mercurial repository?

Thanks
Jon Palmer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090301/f0a7a294/attachment.htm 

From mfarver at mindbent.org  Sun Mar  1 22:22:18 2009
From: mfarver at mindbent.org (Mark Farver)
Date: Sun, 1 Mar 2009 16:22:18 -0600
Subject: [rabbitmq-discuss] rabbitmq stomp 1.5.3 version error
In-Reply-To: <82fa9e310903011052v6aa07269v4e5e10ff3795cd1f@mail.gmail.com>
References: <82fa9e310903011052v6aa07269v4e5e10ff3795cd1f@mail.gmail.com>
Message-ID: <e060a91e0903011422k7e2cf969q15db4f7fe4abeb4d@mail.gmail.com>

I'm seeing the same issue, but I've never had it working before so
I've been assuming its a config issue.

Mark

On 3/1/09, mark <markkicks at gmail.com> wrote:
> hi
> i had rabbitmq stomp working. i upgraded to the latest 1.5.3 and i get
> this error
>
> =ERROR REPORT==== 1-Mar-2009::10:51:00 ===
> STOMP error frame sent:
> Message: "Processing error"
> Detail: "Processing error\n"
> Server private detail: {undef,
>                            [{rabbit_channel,start_link,
>
> [rabbit_stomp,<0.213.0>,<0.213.0>,<<"guest">>,
>                                  <<"/">>]},
>                             {rabbit_stomp,do_login,4},
>                             {rabbit_stomp,process_frame,3},
>                             {rabbit_stomp,process_received_bytes,2},
>                             {rabbit_stomp,init,1},
>                             {proc_lib,init_p,5}]}
>
> =INFO REPORT==== 1-Mar-2009::10:51:00 ===
>
>
>
> how do i fix this?
>
> thanks a lot!
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From holger at wizards.de  Sun Mar  1 22:33:40 2009
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Sun, 01 Mar 2009 23:33:40 +0100
Subject: [rabbitmq-discuss] Weird mercurial error
 cloning	abbitmg-dotnet-client repository
In-Reply-To: <6c54b85a0903011413r455d7f8dh53510861b9d41f66@mail.gmail.com>
References: <6c54b85a0903011413r455d7f8dh53510861b9d41f66@mail.gmail.com>
Message-ID: <49AB0D44.9010409@wizards.de>

Jon Palmer wrote:
> zlib.error: Error -3 while decompressing: too many length or distance
> symbols
> 
> Any one have any thoughts on what the problem is? Can others
> checkout/update from the mercurial repository?

I just did - no problems here. hg 1.1.1+20081229 on Windows.

-h



From markkicks at gmail.com  Mon Mar  2 00:13:01 2009
From: markkicks at gmail.com (mark)
Date: Sun, 1 Mar 2009 16:13:01 -0800
Subject: [rabbitmq-discuss] Configuring the broker on Fedora 10 to start
	the stomp-plugin automatically
In-Reply-To: <e060a91e0903011439t2a3efe12h61d00598083d8d24@mail.gmail.com>
References: <82fa9e310903010942t195b195ch496ea17cfa14e46e@mail.gmail.com>
	<e060a91e0903011439t2a3efe12h61d00598083d8d24@mail.gmail.com>
Message-ID: <82fa9e310903011613p641bcf53v43bed8446ee753ed@mail.gmail.com>

adding to /etc/rabbitmq/rabbitmq.conf made it work

On Sun, Mar 1, 2009 at 2:39 PM, Mark Farver <mark.farver at gmail.com> wrote:
> I think all it took for me was adding this to /etc/default/rabbitmq on
> CentOS 5.
>
> SERVER_START_ARGS='-pa
> "/usr/lib/erlang/lib/rabbitmq-stomp-default/ebin" -rabbit
> stomp_listeners [{"0.0.0.0",61613}] extra_startup_steps
> [{"STOMP-listeners",rabbit_stomp,kickstart,[]}]'
>
>
>
> On Sun, Mar 1, 2009 at 11:42 AM, mark <markkicks at gmail.com> wrote:
>> how do i configure /etc/init.d/rabbitmq-server to start stomp plugin
>> in fedora core 10 automatically? i tried adding the following to
>> /etc/sysconfig/rabbimtq
>>
>> ?SERVER_START_ARGS='
>> ? ?-pa /path/to/rabbitmq-stomp/ebin
>> ? ?-rabbit
>> ? ? ? stomp_listeners [{"0.0.0.0",61613}]
>> ? ? ? extra_startup_steps [{"STOMP-listeners",rabbit_stomp,kickstart,[]}]'
>>
>>
>>
>> but it doesnt get picked up. the README has instructions only for debian/ubuntu.
>> thanks a lot!
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



From jonspalmer at gmail.com  Mon Mar  2 00:16:45 2009
From: jonspalmer at gmail.com (Jon Palmer)
Date: Sun, 1 Mar 2009 16:16:45 -0800
Subject: [rabbitmq-discuss] RabbitMQ.Net,
	Windows Powershell and CLS 	compliance
In-Reply-To: <167204d20903011133r3ee17c87yc48562a88b8eb297@mail.gmail.com>
References: <6c54b85a0903011036q615da5adt4ddd4341004067ac@mail.gmail.com>
	<167204d20903011133r3ee17c87yc48562a88b8eb297@mail.gmail.com>
Message-ID: <6c54b85a0903011616j2507f9c0g3484e545c47cbb1@mail.gmail.com>

I've made the very simple change in RabbitMQ.Client.Impl.ConnectionBase to
make shutdownReport a private not public field and so far my Powershell
problems are fixed.
It feels like shutdownReport being public is just a bug and that it is
intended as the private backing field for the public property. I'll wait to
here more once the week starts.

Thanks
Jon

On Sun, Mar 1, 2009 at 11:33 AM, Alexis Richardson <
alexis.richardson at cohesiveft.com> wrote:

> Jon,
>
> Thanks very much for raising this here.  Someone will look at your
> 'getter and the field' question asap.
>
> Meanwhile (as it is Sunday..), can I ask if you have tried patching
> the code per your suggested fix?  If so, can you let us know what
> happens.
>
> alexis
>
>
> On Sun, Mar 1, 2009 at 6:36 PM, Jon Palmer <jonspalmer at gmail.com> wrote:
> > I am new to using RabbitMQ and I couldn't find if this question has been
> > asked on the mailing list before.
> > I'm trying to use RabbitMQ.Net inside a Powershell script. Something like
> > this:
> >
> > [System.Reflection.Assembly]::LoadFile(  "C:\tools\RabbitMQ.Client.dll")
> > function GetAmqpChannel( $amqp_host ="127.0.0.1", $uid ="guest", $pwd
> > ="guest")
> > {
> > $factory = new-object RabbitMQ.Client.ConnectionFactory
> > $protocol = [RabbitMQ.Client.Protocols]::DefaultProtocol
> > return $factory.CreateConnection($protocol, $amqp_host).CreateModel()
> > }
> > GetAmqpChannel
> >
> >
> >
> > However I receive the following error:
> >
> > The field/property: "shutdownReport" for type:
> > "RabbitMQ.Client.Framing.Impl.v0_8.Connection" differs only in case from
> >  the field/property: "ShutdownReport". Failed to use non CLS compliant
> type.
> >
> > Looking at the source it seems that the problem is
> that RabbitMQ.Client.Impl
> > declares both
> >
> > public System.Collections.IList ShutdownReport { get; }
> >
> > public System.Collections.IList shutdownReport
> >
> > As a result the Client.Impl class isn't CLS compliant. This prevents me
> from
> > using RabbitMQ.Net inside powershell. Does anyone have suggestions about
> how
> > this can be fixed? Are both the getter and the field a required part of
> the
> > public API or could one be removed?
> >
> > Many thanks
> >
> > Jon
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090301/a1135c74/attachment.htm 

From darien at kindlund.com  Mon Mar  2 02:16:27 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Sun, 1 Mar 2009 21:16:27 -0500
Subject: [rabbitmq-discuss] Configuring the broker on Fedora 10 to start
	the stomp-plugin automatically
In-Reply-To: <82fa9e310903011613p641bcf53v43bed8446ee753ed@mail.gmail.com>
References: <82fa9e310903010942t195b195ch496ea17cfa14e46e@mail.gmail.com>
	<e060a91e0903011439t2a3efe12h61d00598083d8d24@mail.gmail.com>
	<82fa9e310903011613p641bcf53v43bed8446ee753ed@mail.gmail.com>
Message-ID: <50c8ffe90903011816j5e1fdebdgec1d789984f45305@mail.gmail.com>

Yeah, I already mentioned to Tony that the README in the stomp adapter
source code (v1.5.3) needs to be updated to reflect the new
configuration location (/etc/rabbitmq/rabbitmq.conf).

-- Darien

On Sun, Mar 1, 2009 at 7:13 PM, mark <markkicks at gmail.com> wrote:
> adding to /etc/rabbitmq/rabbitmq.conf made it work
>
> On Sun, Mar 1, 2009 at 2:39 PM, Mark Farver <mark.farver at gmail.com> wrote:
>> I think all it took for me was adding this to /etc/default/rabbitmq on
>> CentOS 5.
>>
>> SERVER_START_ARGS='-pa
>> "/usr/lib/erlang/lib/rabbitmq-stomp-default/ebin" -rabbit
>> stomp_listeners [{"0.0.0.0",61613}] extra_startup_steps
>> [{"STOMP-listeners",rabbit_stomp,kickstart,[]}]'
>>
>>
>>
>> On Sun, Mar 1, 2009 at 11:42 AM, mark <markkicks at gmail.com> wrote:
>>> how do i configure /etc/init.d/rabbitmq-server to start stomp plugin
>>> in fedora core 10 automatically? i tried adding the following to
>>> /etc/sysconfig/rabbimtq
>>>
>>> ?SERVER_START_ARGS='
>>> ? ?-pa /path/to/rabbitmq-stomp/ebin
>>> ? ?-rabbit
>>> ? ? ? stomp_listeners [{"0.0.0.0",61613}]
>>> ? ? ? extra_startup_steps [{"STOMP-listeners",rabbit_stomp,kickstart,[]}]'
>>>
>>>
>>>
>>> but it doesnt get picked up. the README has instructions only for debian/ubuntu.
>>> thanks a lot!
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From tonyg at lshift.net  Mon Mar  2 11:08:29 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 02 Mar 2009 11:08:29 +0000
Subject: [rabbitmq-discuss] Configuring the broker on Fedora 10 to start
 the stomp-plugin automatically
In-Reply-To: <50c8ffe90903011816j5e1fdebdgec1d789984f45305@mail.gmail.com>
References: <82fa9e310903010942t195b195ch496ea17cfa14e46e@mail.gmail.com>	
	<e060a91e0903011439t2a3efe12h61d00598083d8d24@mail.gmail.com>	
	<82fa9e310903011613p641bcf53v43bed8446ee753ed@mail.gmail.com>
	<50c8ffe90903011816j5e1fdebdgec1d789984f45305@mail.gmail.com>
Message-ID: <49ABBE2D.1020304@lshift.net>

Darien Kindlund wrote:
> Yeah, I already mentioned to Tony that the README in the stomp adapter
> source code (v1.5.3) needs to be updated to reflect the new
> configuration location (/etc/rabbitmq/rabbitmq.conf).

And I haven't yet gotten round to either updating the README or thanking
you for pointing the required change out :-) Sorry. I'll do that now.

Regards,
  Tony




From tonyg at lshift.net  Mon Mar  2 11:13:21 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 02 Mar 2009 11:13:21 +0000
Subject: [rabbitmq-discuss] rabbitmq stomp 1.5.3 version error
In-Reply-To: <82fa9e310903011052v6aa07269v4e5e10ff3795cd1f@mail.gmail.com>
References: <82fa9e310903011052v6aa07269v4e5e10ff3795cd1f@mail.gmail.com>
Message-ID: <49ABBF51.3020708@lshift.net>

Hi Mark,

mark wrote:
> i had rabbitmq stomp working. i upgraded to the latest 1.5.3 and i get
> this error

Are you sure you're on the rabbitmq_v1_5_3 tag for the rabbitmq-stomp
module?

This sequence works for me:

hg clone http://hg.rabbitmq.com/rabbitmq-server
hg clone http://hg.rabbitmq.com/rabbitmq-codegen
hg clone http://hg.rabbitmq.com/rabbitmq-stomp
(cd rabbitmq-server; hg up rabbitmq_v1_5_3)
(cd rabbitmq-codegen; hg up rabbitmq_v1_5_3)
(cd rabbitmq-stomp; hg up rabbitmq_v1_5_3)
make -C rabbitmq-server
make -C rabbitmq-stomp run

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Mon Mar  2 11:17:39 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 02 Mar 2009 11:17:39 +0000
Subject: [rabbitmq-discuss] Weird mercurial error
 cloning	abbitmg-dotnet-client repository
In-Reply-To: <49AB0D44.9010409@wizards.de>
References: <6c54b85a0903011413r455d7f8dh53510861b9d41f66@mail.gmail.com>
	<49AB0D44.9010409@wizards.de>
Message-ID: <49ABC053.4040108@lshift.net>

Holger Hoffst?tte wrote:
> Jon Palmer wrote:
>> Any one have any thoughts on what the problem is? Can others
>> checkout/update from the mercurial repository?
> I just did - no problems here. hg 1.1.1+20081229 on Windows.

No problems here either: hg 1.0.1 on debian lenny

Did retrying help? Could the connection have been interrupted
mid-download? (There are some large files in that repo, and http cloning
seems much slower than ssh cloning)

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Mon Mar  2 11:23:57 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 02 Mar 2009 11:23:57 +0000
Subject: [rabbitmq-discuss] RabbitMQ.Net,
 Windows Powershell and CLS  compliance
In-Reply-To: <6c54b85a0903011139k7bdbb0d2jd19badcbb021d492@mail.gmail.com>
References: <6c54b85a0903011036q615da5adt4ddd4341004067ac@mail.gmail.com>	<167204d20903011133r3ee17c87yc48562a88b8eb297@mail.gmail.com>
	<6c54b85a0903011139k7bdbb0d2jd19badcbb021d492@mail.gmail.com>
Message-ID: <49ABC1CD.5080008@lshift.net>

Hi Jon,

Jon Palmer wrote:
> 2. Fixing the problem is a 'breaking change' in that it requires
> removing a public field. Its unlikely to be a big deal because the fix
> to use the property that is left is easy. However it might break some
> code that relies on the removed field.

The general rule for our code is: if it's on the implementation side
(RabbitMQ.Client.Impl namespace), then go wild. No code should be
relying on interfaces or implementations from the RabbitMQ.Client.Impl
namespaces -- none of it is public API.

Re potential other missed cases: it looks like in general, fields have
an "m_" prefix that the corresponding properties lack. If we are
consistent about it, it'll obviate the problem.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From michael.greene at gmail.com  Mon Mar  2 14:25:43 2009
From: michael.greene at gmail.com (Michael Greene)
Date: Mon, 2 Mar 2009 08:25:43 -0600
Subject: [rabbitmq-discuss] Weird mercurial error cloning
	abbitmg-dotnet-client repository
In-Reply-To: <49ABC053.4040108@lshift.net>
References: <6c54b85a0903011413r455d7f8dh53510861b9d41f66@mail.gmail.com>
	<49AB0D44.9010409@wizards.de> <49ABC053.4040108@lshift.net>
Message-ID: <f4d6a21a0903020625h296ba67dg1aeb4740f80c5cc8@mail.gmail.com>

Seeing a very similar problem to Jon's on a fresh clone.  My existing
copy works fine. (looks like I should update hg, but Jon does not have
that problem)

C:\sources\rabbit2>hg -v clone http://hg.rabbitmq.com/rabbitmq-dotnet-client/
destination directory: rabbitmq-dotnet-client
requesting all changes
adding changesets
adding manifests
adding file changes
transaction abort!
rollback completed
** unknown exception encountered, details follow
** report bug details to http://www.selenic.com/mercurial/bts
** or mercurial at selenic.com
** Mercurial Distributed SCM (version 1.0.2+20080813)
Traceback (most recent call last):
  File "hg", line 20, in <module>
  File "mercurial\dispatch.pyc", line 20, in run
  File "mercurial\dispatch.pyc", line 29, in dispatch
  File "mercurial\dispatch.pyc", line 45, in _runcatch
  File "mercurial\dispatch.pyc", line 364, in _dispatch
  File "mercurial\dispatch.pyc", line 417, in _runcommand
  File "mercurial\dispatch.pyc", line 373, in checkargs
  File "mercurial\dispatch.pyc", line 358, in <lambda>
  File "mercurial\commands.pyc", line 546, in clone
  File "mercurial\hg.pyc", line 230, in clone
  File "mercurial\localrepo.pyc", line 2144, in clone
  File "mercurial\localrepo.pyc", line 1504, in pull
  File "mercurial\localrepo.pyc", line 2036, in addchangegroup
  File "mercurial\revlog.pyc", line 1168, in addgroup
  File "mercurial\changegroup.pyc", line 31, in chunkiter
  File "mercurial\changegroup.pyc", line 21, in getchunk
  File "mercurial\util.pyc", line 1493, in read
  File "mercurial\httprepo.pyc", line 141, in zgenerator
zlib.error: Error -3 while decompressing: invalid block type

I did notice this repo takes far longer during the "adding file
changes" stage than any of the other repositories.  I saw it wait
there for ~3 minutes.

Regards,
Michael Greene

On Mon, Mar 2, 2009 at 5:17 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> Holger Hoffst?tte wrote:
>> Jon Palmer wrote:
>>> Any one have any thoughts on what the problem is? Can others
>>> checkout/update from the mercurial repository?
>> I just did - no problems here. hg 1.1.1+20081229 on Windows.
>
> No problems here either: hg 1.0.1 on debian lenny
>
> Did retrying help? Could the connection have been interrupted
> mid-download? (There are some large files in that repo, and http cloning
> seems much slower than ssh cloning)
>
> Regards,
> ?Tony
> --



From matt.george at myemma.com  Mon Mar  2 15:20:40 2009
From: matt.george at myemma.com (Matt George)
Date: Mon, 2 Mar 2009 09:20:40 -0600
Subject: [rabbitmq-discuss] application keeps crashing
Message-ID: <6E81AB9F-2BB1-4AF9-B00D-6603473E1A64@myemma.com>

Seemingly at random, our rabbitmq application seems to crash. The node  
seems to stay up, but I will get a notice that the application is down  
an I have to run the start_app command.

Here is the rabbit-sasl.log from the period of time where the crash  
seems to occur:

=SUPERVISOR REPORT==== 28-Feb-2009::01:37:29 ===
      Supervisor: {local,mnesia_kernel_sup}
      Context:    child_terminated
      Reason:     shutdown
      Offender:   [{pid,<0.61.0>},
                   {name,mnesia_monitor},
                   {mfa,{mnesia_monitor,start,[]}},
                   {restart_type,permanent},
                   {shutdown,3000},
                   {child_type,worker}]


=SUPERVISOR REPORT==== 28-Feb-2009::01:37:29 ===
      Supervisor: {local,mnesia_kernel_sup}
      Context:    shutdown
      Reason:     reached_max_restart_intensity
      Offender:   [{pid,<0.61.0>},
                   {name,mnesia_monitor},
                   {mfa,{mnesia_monitor,start,[]}},
                   {restart_type,permanent},
                   {shutdown,3000},
                   {child_type,worker}]


=SUPERVISOR REPORT==== 28-Feb-2009::01:37:29 ===
      Supervisor: {local,mnesia_sup}
      Context:    child_terminated
      Reason:     shutdown
      Offender:   [{pid,<0.60.0>},
                   {name,mnesia_kernel_sup},
                   {mfa,{mnesia_kernel_sup,start,[]}},
                   {restart_type,permanent},
                   {shutdown,infinity},
                   {child_type,supervisor}]


=SUPERVISOR REPORT==== 28-Feb-2009::01:37:29 ===
      Supervisor: {local,mnesia_sup}
      Context:    shutdown
      Reason:     reached_max_restart_intensity
      Offender:   [{pid,<0.60.0>},
                   {name,mnesia_kernel_sup},
                   {mfa,{mnesia_kernel_sup,start,[]}},
                   {restart_type,permanent},
                   {shutdown,infinity},
                   {child_type,supervisor}]


=CRASH REPORT==== 28-Feb-2009::01:42:17 ===
   crasher:
     pid: <0.25316.9>
     registered_name: []
     error_info: {aborted,{no_exists,[rabbit_config,profiling_enabled]}}
     initial_call: {rabbit_reader,init,[<0.140.0>]}
     ancestors: [rabbit_tcp_client_sup,rabbit_sup,<0.106.0>]
     messages: []
     links: [<0.140.0>,#Port<0.1545808>]
     dictionary: []
     trap_exit: true
     status: running
     heap_size: 233
     stack_size: 21
     reductions: 102
   neighbours:

=SUPERVISOR REPORT==== 28-Feb-2009::01:42:17 ===
      Supervisor: {local,rabbit_tcp_client_sup}
      Context:    child_terminated
      Reason:     {aborted,{no_exists, 
[rabbit_config,profiling_enabled]}}
      Offender:   [{pid,<0.25316.9>},
                   {name,tcp_client},
                   {mfa,{rabbit_reader,start_link,[]}},
                   {restart_type,temporary},
                   {shutdown,brutal_kill},
                   {child_type,worker}]


=CRASH REPORT==== 28-Feb-2009::15:23:27 ===
   crasher:
     pid: <0.9179.11>
     registered_name: []
     error_info: {aborted,{no_exists,[rabbit_config,profiling_enabled]}}
     initial_call: {rabbit_reader,init,[<0.140.0>]}
     ancestors: [rabbit_tcp_client_sup,rabbit_sup,<0.106.0>]
     messages: []
     links: [<0.140.0>,#Port<0.1595616>]
     dictionary: []
     trap_exit: true
     status: running
     heap_size: 233
     stack_size: 21
     reductions: 102
   neighbours:

=SUPERVISOR REPORT==== 28-Feb-2009::15:23:27 ===
      Supervisor: {local,rabbit_tcp_client_sup}
      Context:    child_terminated
      Reason:     {aborted,{no_exists, 
[rabbit_config,profiling_enabled]}}
      Offender:   [{pid,<0.9179.11>},
                   {name,tcp_client},
                   {mfa,{rabbit_reader,start_link,[]}},
                   {restart_type,temporary},
                   {shutdown,brutal_kill},
                   {child_type,worker}]

Matt George
Software Developer | Emma?
matt.george at myemma.com
800.595.4401
615.292.0777 (fax)

Emma helps organizations everywhere communicate & market in style.
Visit us online at http://www.myemma.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090302/3bf7c111/attachment.htm 

From tonyg at lshift.net  Mon Mar  2 15:32:35 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 02 Mar 2009 15:32:35 +0000
Subject: [rabbitmq-discuss] Weird mercurial error cloning
 abbitmg-dotnet-client repository
In-Reply-To: <f4d6a21a0903020625h296ba67dg1aeb4740f80c5cc8@mail.gmail.com>
References: <6c54b85a0903011413r455d7f8dh53510861b9d41f66@mail.gmail.com>	
	<49AB0D44.9010409@wizards.de> <49ABC053.4040108@lshift.net>
	<f4d6a21a0903020625h296ba67dg1aeb4740f80c5cc8@mail.gmail.com>
Message-ID: <49ABFC13.606@lshift.net>

Michael Greene wrote:
> Seeing a very similar problem to Jon's on a fresh clone.  My existing
> copy works fine. (looks like I should update hg, but Jon does not have
> that problem)

Weird. Perhaps it's a socket timing out or something? Perhaps Windows'
behaviour here is different?

Does it happen when you clone other repositories? Try the
rabbitmq-server one.

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From michael.greene at gmail.com  Mon Mar  2 15:53:02 2009
From: michael.greene at gmail.com (Michael Greene)
Date: Mon, 2 Mar 2009 09:53:02 -0600
Subject: [rabbitmq-discuss] Weird mercurial error cloning
	abbitmg-dotnet-client repository
In-Reply-To: <49ABFC13.606@lshift.net>
References: <6c54b85a0903011413r455d7f8dh53510861b9d41f66@mail.gmail.com>
	<49AB0D44.9010409@wizards.de> <49ABC053.4040108@lshift.net>
	<f4d6a21a0903020625h296ba67dg1aeb4740f80c5cc8@mail.gmail.com>
	<49ABFC13.606@lshift.net>
Message-ID: <f4d6a21a0903020753ufcd2ce5s342969e917cef449@mail.gmail.com>

Tony Garnock-Jones <tonyg at lshift.net> wrote:
> Weird. Perhaps it's a socket timing out or something? Perhaps Windows'
> behaviour here is different?
>
> Does it happen when you clone other repositories? Try the
> rabbitmq-server one.

When I use either my existing copy or a fresh clone of
rabbitmq-server, it completes successfully--and in much shorter time,
~15 seconds.

I see similar problems on both [hg 1.0.2 on OSX 10.5.6] and [hg 1.0.1
on Ubuntu 8.10/Linux 2.6.24] on the rabbitmq-dotnet-client repo, so it
is not a Windows-only issue.  They are all connecting from the same
network, though, so it could be a connectivity issue, but it is
obviously not isolated to me if Jon is seeing similar things.

Michael



From jonspalmer at gmail.com  Mon Mar  2 16:16:52 2009
From: jonspalmer at gmail.com (Jon Palmer)
Date: Mon, 2 Mar 2009 08:16:52 -0800
Subject: [rabbitmq-discuss] Weird mercurial error cloning
	abbitmg-dotnet-client repository
In-Reply-To: <f4d6a21a0903020753ufcd2ce5s342969e917cef449@mail.gmail.com>
References: <6c54b85a0903011413r455d7f8dh53510861b9d41f66@mail.gmail.com>
	<49AB0D44.9010409@wizards.de> <49ABC053.4040108@lshift.net>
	<f4d6a21a0903020625h296ba67dg1aeb4740f80c5cc8@mail.gmail.com>
	<49ABFC13.606@lshift.net>
	<f4d6a21a0903020753ufcd2ce5s342969e917cef449@mail.gmail.com>
Message-ID: <6c54b85a0903020816l6a17ca5eqbe125ab5ce44fa88@mail.gmail.com>

I've not yet been able to clone the repositories. I also had issues
downloading the snapshot zip. I noticed that as the snapshot download
progressed the transfer kb/sec rate dropped steadily over time. I also
noticed that the server is not reporting the size of the zip file. I suspect
the network connection is getting dropped and causing all the problems (both
zip download and repository clone). After about five tries I was able to get
the zip download to complete. I see this behavior from home and from work so
its not just my network.
Jon

On Mon, Mar 2, 2009 at 7:53 AM, Michael Greene <michael.greene at gmail.com>wrote:

> Tony Garnock-Jones <tonyg at lshift.net> wrote:
> > Weird. Perhaps it's a socket timing out or something? Perhaps Windows'
> > behaviour here is different?
> >
> > Does it happen when you clone other repositories? Try the
> > rabbitmq-server one.
>
> When I use either my existing copy or a fresh clone of
> rabbitmq-server, it completes successfully--and in much shorter time,
> ~15 seconds.
>
> I see similar problems on both [hg 1.0.2 on OSX 10.5.6] and [hg 1.0.1
> on Ubuntu 8.10/Linux 2.6.24] on the rabbitmq-dotnet-client repo, so it
> is not a Windows-only issue.  They are all connecting from the same
> network, though, so it could be a connectivity issue, but it is
> obviously not isolated to me if Jon is seeing similar things.
>
> Michael
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090302/7b132368/attachment.htm 

From tonyg at lshift.net  Mon Mar  2 16:25:59 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 02 Mar 2009 16:25:59 +0000
Subject: [rabbitmq-discuss] Weird mercurial error cloning
 abbitmg-dotnet-client repository
In-Reply-To: <6c54b85a0903020816l6a17ca5eqbe125ab5ce44fa88@mail.gmail.com>
References: <6c54b85a0903011413r455d7f8dh53510861b9d41f66@mail.gmail.com>	
	<49AB0D44.9010409@wizards.de> <49ABC053.4040108@lshift.net>	
	<f4d6a21a0903020625h296ba67dg1aeb4740f80c5cc8@mail.gmail.com>	
	<49ABFC13.606@lshift.net>	
	<f4d6a21a0903020753ufcd2ce5s342969e917cef449@mail.gmail.com>
	<6c54b85a0903020816l6a17ca5eqbe125ab5ce44fa88@mail.gmail.com>
Message-ID: <49AC0897.2030600@lshift.net>

Good to know that it's not a Windows-specific thing. I'm kind of at a
loss as to what to try. When I use the repository from home and from
work everything works fine. Where are you two based? Perhaps it's
geographic. Or it could be to do with your ISP. Do either of you have
web proxies configured? (See $http_proxy, for instance)


Jon Palmer wrote:
> I've not yet been able to clone the repositories. I also had issues
> downloading the snapshot zip. I noticed that as the snapshot download
> progressed the transfer kb/sec rate dropped steadily over time. I also
> noticed that the server is not reporting the size of the zip file. I
> suspect the network connection is getting dropped and causing all the
> problems (both zip download and repository clone). After about five
> tries I was able to get the zip download to complete. I see this
> behavior from home and from work so its not just my network.
> 
> Jon
> 
> On Mon, Mar 2, 2009 at 7:53 AM, Michael Greene <michael.greene at gmail.com
> <mailto:michael.greene at gmail.com>> wrote:
> 
>     Tony Garnock-Jones <tonyg at lshift.net <mailto:tonyg at lshift.net>> wrote:
>     > Weird. Perhaps it's a socket timing out or something? Perhaps Windows'
>     > behaviour here is different?
>     >
>     > Does it happen when you clone other repositories? Try the
>     > rabbitmq-server one.
> 
>     When I use either my existing copy or a fresh clone of
>     rabbitmq-server, it completes successfully--and in much shorter time,
>     ~15 seconds.
> 
>     I see similar problems on both [hg 1.0.2 on OSX 10.5.6] and [hg 1.0.1
>     on Ubuntu 8.10/Linux 2.6.24] on the rabbitmq-dotnet-client repo, so it
>     is not a Windows-only issue.  They are all connecting from the same
>     network, though, so it could be a connectivity issue, but it is
>     obviously not isolated to me if Jon is seeing similar things.
> 
>     Michael
> 
> 


-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From jonspalmer at gmail.com  Mon Mar  2 16:30:35 2009
From: jonspalmer at gmail.com (Jon Palmer)
Date: Mon, 2 Mar 2009 08:30:35 -0800
Subject: [rabbitmq-discuss] Weird mercurial error cloning
	abbitmg-dotnet-client repository
In-Reply-To: <49AC0897.2030600@lshift.net>
References: <6c54b85a0903011413r455d7f8dh53510861b9d41f66@mail.gmail.com>
	<49AB0D44.9010409@wizards.de> <49ABC053.4040108@lshift.net>
	<f4d6a21a0903020625h296ba67dg1aeb4740f80c5cc8@mail.gmail.com>
	<49ABFC13.606@lshift.net>
	<f4d6a21a0903020753ufcd2ce5s342969e917cef449@mail.gmail.com>
	<6c54b85a0903020816l6a17ca5eqbe125ab5ce44fa88@mail.gmail.com>
	<49AC0897.2030600@lshift.net>
Message-ID: <6c54b85a0903020830v78f34400mf97d0ae2aa77489b@mail.gmail.com>

I have problems on a fairly crappy ADSL ISP in San Francisco and also on a
monster corporate network (T3 +) in Boston. Can't every get the repo or zip
snapshot from SF, no luck with the repo from Boston, one time in three the
zip works from Boston.

On Mon, Mar 2, 2009 at 8:25 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:

> Good to know that it's not a Windows-specific thing. I'm kind of at a
> loss as to what to try. When I use the repository from home and from
> work everything works fine. Where are you two based? Perhaps it's
> geographic. Or it could be to do with your ISP. Do either of you have
> web proxies configured? (See $http_proxy, for instance)
>
>
> Jon Palmer wrote:
> > I've not yet been able to clone the repositories. I also had issues
> > downloading the snapshot zip. I noticed that as the snapshot download
> > progressed the transfer kb/sec rate dropped steadily over time. I also
> > noticed that the server is not reporting the size of the zip file. I
> > suspect the network connection is getting dropped and causing all the
> > problems (both zip download and repository clone). After about five
> > tries I was able to get the zip download to complete. I see this
> > behavior from home and from work so its not just my network.
> >
> > Jon
> >
> > On Mon, Mar 2, 2009 at 7:53 AM, Michael Greene <michael.greene at gmail.com
> > <mailto:michael.greene at gmail.com>> wrote:
> >
> >     Tony Garnock-Jones <tonyg at lshift.net <mailto:tonyg at lshift.net>>
> wrote:
> >     > Weird. Perhaps it's a socket timing out or something? Perhaps
> Windows'
> >     > behaviour here is different?
> >     >
> >     > Does it happen when you clone other repositories? Try the
> >     > rabbitmq-server one.
> >
> >     When I use either my existing copy or a fresh clone of
> >     rabbitmq-server, it completes successfully--and in much shorter time,
> >     ~15 seconds.
> >
> >     I see similar problems on both [hg 1.0.2 on OSX 10.5.6] and [hg 1.0.1
> >     on Ubuntu 8.10/Linux 2.6.24] on the rabbitmq-dotnet-client repo, so
> it
> >     is not a Windows-only issue.  They are all connecting from the same
> >     network, though, so it could be a connectivity issue, but it is
> >     obviously not isolated to me if Jon is seeing similar things.
> >
> >     Michael
> >
> >
>
>
> --
>  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090302/66437ced/attachment.htm 

From michael.greene at gmail.com  Mon Mar  2 16:30:46 2009
From: michael.greene at gmail.com (Michael Greene)
Date: Mon, 2 Mar 2009 10:30:46 -0600
Subject: [rabbitmq-discuss] Weird mercurial error cloning
	abbitmg-dotnet-client repository
In-Reply-To: <49AC0897.2030600@lshift.net>
References: <6c54b85a0903011413r455d7f8dh53510861b9d41f66@mail.gmail.com>
	<49AB0D44.9010409@wizards.de> <49ABC053.4040108@lshift.net>
	<f4d6a21a0903020625h296ba67dg1aeb4740f80c5cc8@mail.gmail.com>
	<49ABFC13.606@lshift.net>
	<f4d6a21a0903020753ufcd2ce5s342969e917cef449@mail.gmail.com>
	<6c54b85a0903020816l6a17ca5eqbe125ab5ce44fa88@mail.gmail.com>
	<49AC0897.2030600@lshift.net>
Message-ID: <f4d6a21a0903020830r269a1816j7539192cbc23beb3@mail.gmail.com>

Tony Garnock-Jones <tonyg at lshift.net> wrote:
> Good to know that it's not a Windows-specific thing. I'm kind of at a
> loss as to what to try. When I use the repository from home and from
> work everything works fine. Where are you two based? Perhaps it's
> geographic. Or it could be to do with your ISP. Do either of you have
> web proxies configured? (See $http_proxy, for instance)

I am not using web proxies.  I am based in Chicago.  These machines
are behind a DSL line, with the following traceroute (first few
entries with personal IPs omitted):

  5     5 ms     7 ms    22 ms  bb1-g6-0.chcgil.ameritech.net [151.164.190.120]
  6    17 ms     6 ms     5 ms  ex2-p1-0.eqchil.sbcglobal.net [151.164.189.80]
  7     6 ms    15 ms    10 ms  Te-3-2.Chicago1.Level3.net [4.68.110.197]
  8     8 ms    12 ms    17 ms  ae-31-51.ebr1.Chicago1.Level3.net [4.68.101.30]
  9    34 ms    35 ms    39 ms  ae-2.ebr2.NewYork1.Level3.net [4.69.132.66]
 10    95 ms    57 ms   135 ms  ae-62-62.csw1.NewYork1.Level3.net [4.69.134.82]
 11    28 ms    34 ms    37 ms  ae-61-61.ebr1.NewYork1.Level3.net [4.69.134.65]
 12    99 ms   108 ms   108 ms  ae-43-43.ebr2.London1.Level3.net [4.69.137.73]
 13    99 ms   101 ms   111 ms  ae-25-52.car5.London1.Level3.net [4.68.116.51]
 14   110 ms   100 ms   108 ms  217.163.45.82
 15   100 ms   105 ms   107 ms  gi1-1-6.ar32.hx3.dco.gxn.net [62.72.142.147]
 16   106 ms    99 ms    99 ms  lshift01.he.gxn.net [194.143.187.26]



From 0x6e6562 at gmail.com  Mon Mar  2 16:56:28 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 2 Mar 2009 16:56:28 +0000
Subject: [rabbitmq-discuss] application keeps crashing
In-Reply-To: <6E81AB9F-2BB1-4AF9-B00D-6603473E1A64@myemma.com>
References: <6E81AB9F-2BB1-4AF9-B00D-6603473E1A64@myemma.com>
Message-ID: <269388e30903020856q1c92d2e1pa9d45f54126c277f@mail.gmail.com>

George,

On Mon, Mar 2, 2009 at 3:20 PM, Matt George <matt.george at myemma.com> wrote:
> =CRASH REPORT==== 28-Feb-2009::01:42:17 ===
> ??crasher:
> ?? ?pid: <0.25316.9>
> ?? ?registered_name: []
> ?? ?error_info: {aborted,{no_exists,[rabbit_config,profiling_enabled]}}
> ?? ?initial_call: {rabbit_reader,init,[<0.140.0>]}
> ?? ?ancestors: [rabbit_tcp_client_sup,rabbit_sup,<0.106.0>]
> ?? ?messages: []

This looks like you are missing a table called rabbit_config. To
verify this, use the mnesia:info/0 command from the shell. After
having checked this, it might be an idea to find out how this could
come about, seeing as ensuring that the correct tables exist is part
of the boot sequence.

HTH,

Ben



From 0x6e6562 at gmail.com  Mon Mar  2 17:10:13 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 2 Mar 2009 17:10:13 +0000
Subject: [rabbitmq-discuss] Fwd:  application keeps crashing
In-Reply-To: <269388e30903020909t3656c209sf4305a2e3ced45bc@mail.gmail.com>
References: <6E81AB9F-2BB1-4AF9-B00D-6603473E1A64@myemma.com>
	<269388e30903020856q1c92d2e1pa9d45f54126c277f@mail.gmail.com>
	<273934A4-6379-4536-86AA-49F8A5A2AD09@myemma.com>
	<269388e30903020909t3656c209sf4305a2e3ced45bc@mail.gmail.com>
Message-ID: <269388e30903020910l48150771s358598630949b6b8@mail.gmail.com>

---------- Forwarded message ----------
From: Ben Hood <0x6e6562 at gmail.com>
Date: Mon, Mar 2, 2009 at 5:09 PM
Subject: Re: [rabbitmq-discuss] application keeps crashing
To: Matt George <matt.george at myemma.com>


Matt - Sorry I called you George beforehand :-(

On Mon, Mar 2, 2009 at 5:04 PM, Matt George <matt.george at myemma.com> wrote:
> What is the best way to run that command? I have just a little bit of
> experience with the erlang shell, I am slowly getting more into using it.

Probably the easiest way (without using any of the Rabbit machinery)
is to just execute the following:

$ erl -mnesia dir PATH_TO_YOUR_MNESIA DIRECTORY -s mnesia

Erlang (BEAM) emulator version 5.6.5 [source] [smp:2]
[async-threads:0] [hipe] [kernel-poll:false]

Eshell V5.6.5 ?(abort with ^G)
1> mnesia:info().

.....Output follows here

Ben



From 0x6e6562 at gmail.com  Mon Mar  2 22:54:50 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 2 Mar 2009 22:54:50 +0000
Subject: [rabbitmq-discuss] application keeps crashing
In-Reply-To: <AFDE92CE-5688-48F4-A4DA-5452A413B701@myemma.com>
References: <6E81AB9F-2BB1-4AF9-B00D-6603473E1A64@myemma.com>
	<269388e30903020856q1c92d2e1pa9d45f54126c277f@mail.gmail.com>
	<273934A4-6379-4536-86AA-49F8A5A2AD09@myemma.com>
	<269388e30903020909t3656c209sf4305a2e3ced45bc@mail.gmail.com>
	<AFDE92CE-5688-48F4-A4DA-5452A413B701@myemma.com>
Message-ID: <269388e30903021454q7819c3beq6d3fc9a7a83fd4d@mail.gmail.com>

Matt,

On Mon, Mar 2, 2009 at 5:13 PM, Matt George <matt.george at myemma.com> wrote:
> ---> Active tables <---
> schema ? ? ? ? : with 1 ? ? ? ?records occupying 388 ? ? ?words of mem
> ===> System info in version "4.3.5", debug level = none <===
> opt_disc. Directory "/Users/mgeorge/Mnesia.nonode at nohost" is NOT used.
> use fallback at restart = false
> running db nodes ? = [nonode at nohost]
> stopped db nodes ? = []
> master node tables = []
> remote ? ? ? ? ? ? = []
> ram_copies ? ? ? ? = [schema]
> disc_copies ? ? ? ?= []
> disc_only_copies ? = []

Well this means that there was no mnesia database in that directory,
which is a slight problem :-(

On face value, one may conclude that there was no Rabbit installed in
the standard location on that particular node, but this contradicts
the fact that Rabbit was actually running.

Can you maybe tell us about the details of your installation
(including any clustering or virtualization you may have used)?

Ben



From clemesha at gmail.com  Tue Mar  3 05:30:19 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Mon, 2 Mar 2009 21:30:19 -0800
Subject: [rabbitmq-discuss] RabbitMQ Cluster, option "-setcookie cookie"
Message-ID: <d272f0690903022130k11121d31o2ee22515c476dc87@mail.gmail.com>

Hi,

I'm looking to use RabbitMQ Cluster in a fairly dynamic way (on Amazon
EC2), and I had a couple questions.

First off, I'm looking to start the cluster in a scripted, dynamic way
- so as far as I understand,
the best way to do this would be create a random cookie and pass it to
all nodes on startup.

In this document: http://www.rabbitmq.com/clustering.html, there is this line:
"As an alternative, you can insert the option "-setcookie
cluster_cookie" in the erl call in the rabbitmq-server and rabbitmqctl
 scripts."

Does this imply I should modify the rabbitmq-server and rabbitmqctl
scripts to have this functionality, or is there some way
(that I'm not seeing yet) to pass "-setcookie cluster_cookie" to
rabbitmq-server and rabbitmqctl scripts?


Secondly, I plan to have my "Provisioning process" that created the
cluster_cookie and started the Cluster to hold onto this cookie
for using later, to conveniently add more nodes to the Cluster.  Do
this sound like a fine pattern, or is there
a better way to do such a thing?


Thanks very much,
Alex



-- 
Alex Clemesha
clemesha.org



From tonyg at lshift.net  Tue Mar  3 08:30:42 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 03 Mar 2009 08:30:42 +0000
Subject: [rabbitmq-discuss] RabbitMQ 1.5.3 in MacPorts
Message-ID: <49ACEAB2.4020402@lshift.net>

Hi all,

Chris Pettitt's changes to the MacPorts packaging have landed in the 
MacPorts SVN.

     sudo port sync
     sudo port install rabbitmq-server

... and follow the instructions about launchctl, or use the info Chris 
posted previously: 
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-February/003485.html

I've got some draft changes to the website being reviewed, so expect to 
see information on MacPorts arrive on the server installation page 
sometime soon.

Regards,
   Tony



From cpettitt at gmail.com  Tue Mar  3 18:40:19 2009
From: cpettitt at gmail.com (Chris Pettitt)
Date: Tue, 3 Mar 2009 10:40:19 -0800
Subject: [rabbitmq-discuss] Monitoring RabbitMQ from JMX
Message-ID: <de47e4420903031040s361185b8r8d06d1bbe590e0d8@mail.gmail.com>

Hello,

I'm currently exploring monitoring options for RabbitMQ. There is a monitoring
page on the RabbitMQ site [1] from July 2008 that describes some potential
solutions, but it's not clear if anything has been done since that discussion.

I'd like to expose monitoring through JMX. Is there anything that does
that already
or that can be adapted to such a purpose?

If not, I've thought about a few ways I could implement it, but I would be
happy to get feedback from the folks on this list. Here are some thoughts:

1. I could write a JMX system to talk to rabbit_amqqueue directly
using JInterface.
I prototyped this approach successfully, but it seems wrong to depend on the
functions in rabbit_amqqueue directly, especially if they are not a public API.

2. I could write a small Erlang process that proxies requests to the action
function in rabbit_control. The benefit of this is that rabbit_control
aggregates monitoring across several modules and the client is less sensitive
to changes to rabbit_amqqueue and other modules. Using an Erlang process is
also nice because I wouldn't have to spawn rabbitmqctl for each request. With
this solution the JMX system could communicate with the process using either
JInterface or pipes (though I prefer the former unless there is a good reason
to avoid it).

Thoughts? Is there a good alternative I'm missing?

Thanks,
Chris

[1]: https://dev.rabbitmq.com/wiki/ManagementAndMonitoring



From cctrieloff at redhat.com  Tue Mar  3 18:58:40 2009
From: cctrieloff at redhat.com (Carl Trieloff)
Date: Tue, 03 Mar 2009 13:58:40 -0500
Subject: [rabbitmq-discuss] Monitoring RabbitMQ from JMX
In-Reply-To: <de47e4420903031040s361185b8r8d06d1bbe590e0d8@mail.gmail.com>
References: <de47e4420903031040s361185b8r8d06d1bbe590e0d8@mail.gmail.com>
Message-ID: <49AD7DE0.5040807@redhat.com>


A full JMX AMQP bridge exists with WS-DM support. It may or may not help you
http://qpid.apache.org/qman-qpid-management-bridge.html

regards,
Carl.


Chris Pettitt wrote:
> Hello,
>
> I'm currently exploring monitoring options for RabbitMQ. There is a monitoring
> page on the RabbitMQ site [1] from July 2008 that describes some potential
> solutions, but it's not clear if anything has been done since that discussion.
>
> I'd like to expose monitoring through JMX. Is there anything that does
> that already
> or that can be adapted to such a purpose?
>
> If not, I've thought about a few ways I could implement it, but I would be
> happy to get feedback from the folks on this list. Here are some thoughts:
>
> 1. I could write a JMX system to talk to rabbit_amqqueue directly
> using JInterface.
> I prototyped this approach successfully, but it seems wrong to depend on the
> functions in rabbit_amqqueue directly, especially if they are not a public API.
>
> 2. I could write a small Erlang process that proxies requests to the action
> function in rabbit_control. The benefit of this is that rabbit_control
> aggregates monitoring across several modules and the client is less sensitive
> to changes to rabbit_amqqueue and other modules. Using an Erlang process is
> also nice because I wouldn't have to spawn rabbitmqctl for each request. With
> this solution the JMX system could communicate with the process using either
> JInterface or pipes (though I prefer the former unless there is a good reason
> to avoid it).
>
> Thoughts? Is there a good alternative I'm missing?
>
> Thanks,
> Chris
>
> [1]: https://dev.rabbitmq.com/wiki/ManagementAndMonitoring
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>   




From markkicks at gmail.com  Tue Mar  3 20:05:12 2009
From: markkicks at gmail.com (mark)
Date: Tue, 3 Mar 2009 12:05:12 -0800
Subject: [rabbitmq-discuss] rabbitmq stomp 1.5.3 version error
In-Reply-To: <49ABBF51.3020708@lshift.net>
References: <82fa9e310903011052v6aa07269v4e5e10ff3795cd1f@mail.gmail.com>
	<49ABBF51.3020708@lshift.net>
Message-ID: <82fa9e310903031205q20fcbe1dr49470712e641da0d@mail.gmail.com>

Hi Tony,
Thanks a lot!!! Your steps make it work for me.
Guess I was running different versions at the time I tried!!
thanks a lot!!


On Mon, Mar 2, 2009 at 3:13 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> Hi Mark,
>
> mark wrote:
>> i had rabbitmq stomp working. i upgraded to the latest 1.5.3 and i get
>> this error
>
> Are you sure you're on the rabbitmq_v1_5_3 tag for the rabbitmq-stomp
> module?
>
> This sequence works for me:
>
> hg clone http://hg.rabbitmq.com/rabbitmq-server
> hg clone http://hg.rabbitmq.com/rabbitmq-codegen
> hg clone http://hg.rabbitmq.com/rabbitmq-stomp
> (cd rabbitmq-server; hg up rabbitmq_v1_5_3)
> (cd rabbitmq-codegen; hg up rabbitmq_v1_5_3)
> (cd rabbitmq-stomp; hg up rabbitmq_v1_5_3)
> make -C rabbitmq-server
> make -C rabbitmq-stomp run
>
> Regards,
> ?Tony
> --
> ?[][][] Tony Garnock-Jones ? ? | Mob: +44 (0)7905 974 211
> ? [][] LShift Ltd ? ? ? ? ? ? | Tel: +44 (0)20 7729 7060
> ?[] ?[] http://www.lshift.net/ | Email: tonyg at lshift.net
>



From alexis.richardson at cohesiveft.com  Wed Mar  4 11:55:26 2009
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Wed, 4 Mar 2009 11:55:26 +0000
Subject: [rabbitmq-discuss] Monitoring RabbitMQ from JMX
In-Reply-To: <49AD7DE0.5040807@redhat.com>
References: <de47e4420903031040s361185b8r8d06d1bbe590e0d8@mail.gmail.com>
	<49AD7DE0.5040807@redhat.com>
Message-ID: <167204d20903040355s2ba0a38cxae38524325c0184f@mail.gmail.com>

Thanks Carl, I took a look at that recently and it does look like
interesting work.

Chris,

Thanks for this.  Creating something would be really helpful.

I don't know which of the approaches would make the most sense from
those you list.  I hope others will comment.  Alas Matthias is on
vacation this week.  In terms of existing work, Tony and Ben may wish
to comment.  There's a few features Tony added for monitoring queue
lifecycle events last year for a customer.  I don't know if you are
aware of those (apologies if you know all this already).

In terms of 'general approaches to management and monitoring', we have
had a number of discussions about this on-list.  To date, the
following have been suggested.  Note that many of these speak more to
management than to monitoring.

* JMX -- We are not JMX experts and would love others better qualified
than us, to help.  If you can do something here, that would be very
cool.  As Carl mentioned, the qman stuff that the qpid guys have done,
may be useful as a guide, although RabbitMQ implements a different
version of the AMQP protocol at the moment.

* OSGi -- Neil Bartlett's prototype may be helpful here.  It is on
github: http://github.com/njbartlett/rabbitosgi

* Web interface -- I believe Valentino came up with a good list, in
the REST style, a few weeks ago.

* XMPP interface -- Tony's bots:
http://hg.rabbitmq.com/rabbitmq-xmpp/raw-file/default/doc/index.html

Anyway, I hope this helps give you some more ideas.

alexis



On Tue, Mar 3, 2009 at 6:58 PM, Carl Trieloff <cctrieloff at redhat.com> wrote:
>
> A full JMX AMQP bridge exists with WS-DM support. It may or may not help you
> http://qpid.apache.org/qman-qpid-management-bridge.html
>
> regards,
> Carl.
>
>
> Chris Pettitt wrote:
>> Hello,
>>
>> I'm currently exploring monitoring options for RabbitMQ. There is a monitoring
>> page on the RabbitMQ site [1] from July 2008 that describes some potential
>> solutions, but it's not clear if anything has been done since that discussion.
>>
>> I'd like to expose monitoring through JMX. Is there anything that does
>> that already
>> or that can be adapted to such a purpose?
>>
>> If not, I've thought about a few ways I could implement it, but I would be
>> happy to get feedback from the folks on this list. Here are some thoughts:
>>
>> 1. I could write a JMX system to talk to rabbit_amqqueue directly
>> using JInterface.
>> I prototyped this approach successfully, but it seems wrong to depend on the
>> functions in rabbit_amqqueue directly, especially if they are not a public API.
>>
>> 2. I could write a small Erlang process that proxies requests to the action
>> function in rabbit_control. The benefit of this is that rabbit_control
>> aggregates monitoring across several modules and the client is less sensitive
>> to changes to rabbit_amqqueue and other modules. Using an Erlang process is
>> also nice because I wouldn't have to spawn rabbitmqctl for each request. With
>> this solution the JMX system could communicate with the process using either
>> JInterface or pipes (though I prefer the former unless there is a good reason
>> to avoid it).
>>
>> Thoughts? Is there a good alternative I'm missing?
>>
>> Thanks,
>> Chris
>>
>> [1]: https://dev.rabbitmq.com/wiki/ManagementAndMonitoring
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From 0x6e6562 at gmail.com  Wed Mar  4 12:39:50 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 4 Mar 2009 12:39:50 +0000
Subject: [rabbitmq-discuss] Monitoring RabbitMQ from JMX
In-Reply-To: <de47e4420903031040s361185b8r8d06d1bbe590e0d8@mail.gmail.com>
References: <de47e4420903031040s361185b8r8d06d1bbe590e0d8@mail.gmail.com>
Message-ID: <269388e30903040439r1e8ddb21i2f358e5422d7c2c7@mail.gmail.com>

Chris,

On Tue, Mar 3, 2009 at 6:40 PM, Chris Pettitt <cpettitt at gmail.com> wrote:
> I'm currently exploring monitoring options for RabbitMQ. There is a monitoring
> page on the RabbitMQ site [1] from July 2008 that describes some potential
> solutions, but it's not clear if anything has been done since that discussion.

Apart from discussing this further (you might want to google threads
on this list about monitoring), nothing has been done. It is a
medium-ish priority, but ATM we are very busy at LShift and hence have
very little time to do anything.

> I'd like to expose monitoring through JMX. Is there anything that does
> that already
> or that can be adapted to such a purpose?

As Carl has pointed out, QPid have exposed some functionality via JMX.
But AFAIK this has not been done for Rabbit.

> If not, I've thought about a few ways I could implement it, but I would be
> happy to get feedback from the folks on this list. Here are some thoughts:
>
> 1. I could write a JMX system to talk to rabbit_amqqueue directly
> using JInterface.
> I prototyped this approach successfully, but it seems wrong to depend on the
> functions in rabbit_amqqueue directly, especially if they are not a public API.
>
> 2. I could write a small Erlang process that proxies requests to the action
> function in rabbit_control. The benefit of this is that rabbit_control
> aggregates monitoring across several modules and the client is less sensitive
> to changes to rabbit_amqqueue and other modules. Using an Erlang process is
> also nice because I wouldn't have to spawn rabbitmqctl for each request. With
> this solution the JMX system could communicate with the process using either
> JInterface or pipes (though I prefer the former unless there is a good reason
> to avoid it).
>
> Thoughts? Is there a good alternative I'm missing?

I would divide the problem up into three parts to solve separately:

1. Define how you want to remote the calls;
2. Define what functionality you want to expose;
3. Have a look at what internal APIs are available to you and whether
you can write a wrapper to subsume them;


ad 1) Using JInterface seems fine to me;
ad 2) Tricky - you will limited to what rabbit_amqqueue exposes;
ad 3) Using rabbit_amqqueue is not evil per se, it's just that it is
subject to change (explicitly or subtly), so it's something you may
need to keep in sync. We wouldn't be so-and-so's and deliberately
break your stuff, but you would have to clear on the fact that
compatibility would be a best-effort thing rather than a guarantee to
support stuff going forwards.

Having said all of that, you may get the most mileage out of us were
you to look into OTP's SMTP capabilities ;-)

HTH,

Ben



From 0x6e6562 at gmail.com  Wed Mar  4 12:42:04 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 4 Mar 2009 12:42:04 +0000
Subject: [rabbitmq-discuss] application keeps crashing
In-Reply-To: <95074A2E-B7BC-4F6F-BA5C-B25A43ED9BA7@myemma.com>
References: <6E81AB9F-2BB1-4AF9-B00D-6603473E1A64@myemma.com>
	<269388e30903020856q1c92d2e1pa9d45f54126c277f@mail.gmail.com>
	<273934A4-6379-4536-86AA-49F8A5A2AD09@myemma.com>
	<269388e30903020909t3656c209sf4305a2e3ced45bc@mail.gmail.com>
	<AFDE92CE-5688-48F4-A4DA-5452A413B701@myemma.com>
	<269388e30903021454q7819c3beq6d3fc9a7a83fd4d@mail.gmail.com>
	<95074A2E-B7BC-4F6F-BA5C-B25A43ED9BA7@myemma.com>
Message-ID: <269388e30903040442g5a22281br401206fc846c5f91@mail.gmail.com>

Matt,

On Tue, Mar 3, 2009 at 2:57 PM, Matt George <matt.george at myemma.com> wrote:
> I talked to the guys who setup the box and they told me that it's a standard
> vanilla ubuntu 8.04 install, on a vmware virtual server.
> The rabbitmq install was from the debian package via apt-get, and was
> upgraded from 1.5.1 to 1.5.3 the same way. After we installed
> rabbitmq, nothing else was done in terms of configuration.
> Let me know if you need anymore info

OK, so you're saying that you can reproduce this behaviour by using
apt-get to upgrade from 1.5.1 to 1.5.3?

Ben



From daveb at miceda.org  Wed Mar  4 14:50:27 2009
From: daveb at miceda.org (Dave Bryson)
Date: Wed, 4 Mar 2009 08:50:27 -0600
Subject: [rabbitmq-discuss] Erlang client problems again
Message-ID: <C7D3466C-F88E-45DA-BCDC-8ADB5A17D734@miceda.org>

I had a problem in the past with the Erlang client timing out and  
never connecting.  With some help on the list from another user I was  
able to get it to work by synching the exact version of the client and  
rabbitmq from the source in mercurial. Now I'm trying the latest  
server 1.5.3 and the latest version of the client and I'm having the  
same exact problem again: network test times out on the first basic  
test and if I try making my own connection "lib_amqp:start_connection"  
it just hangs.

I see a lot of activity on the erlang client in source control and  
knowing the client uses code from the server I'm curious why it just  
"doesn't work".  Is anyone using the erlang client with the latest  
rabbitmq server (1.5.3)?  What version of the server are the client  
developers testing against?

Thanks,
Dave



From dmitriy.samovskiy at cohesiveft.com  Wed Mar  4 15:31:05 2009
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Wed, 04 Mar 2009 09:31:05 -0600
Subject: [rabbitmq-discuss] application keeps crashing
In-Reply-To: <269388e30903040442g5a22281br401206fc846c5f91@mail.gmail.com>
References: <6E81AB9F-2BB1-4AF9-B00D-6603473E1A64@myemma.com>	<269388e30903020856q1c92d2e1pa9d45f54126c277f@mail.gmail.com>	<273934A4-6379-4536-86AA-49F8A5A2AD09@myemma.com>	<269388e30903020909t3656c209sf4305a2e3ced45bc@mail.gmail.com>	<AFDE92CE-5688-48F4-A4DA-5452A413B701@myemma.com>	<269388e30903021454q7819c3beq6d3fc9a7a83fd4d@mail.gmail.com>	<95074A2E-B7BC-4F6F-BA5C-B25A43ED9BA7@myemma.com>
	<269388e30903040442g5a22281br401206fc846c5f91@mail.gmail.com>
Message-ID: <49AE9EB9.4050908@cohesiveft.com>


Hi all,

>> I talked to the guys who setup the box and they told me that it's a standard
>> vanilla ubuntu 8.04 install, on a vmware virtual server.
>> The rabbitmq install was from the debian package via apt-get, and was
>> upgraded from 1.5.1 to 1.5.3 the same way. After we installed
>> rabbitmq, nothing else was done in terms of configuration.
>> Let me know if you need anymore info
> 
> OK, so you're saying that you can reproduce this behaviour by using
> apt-get to upgrade from 1.5.1 to 1.5.3?

I just did an upgrade from 1.5.1 to 1.5.3 on my vm with "apt-get install rabbitmq-server" 
and it worked well, didn't break anything. It's Debian Etch however, not Ubuntu.

Matt, do you have any config in /etc/default/rabbitmq? 1.5.3 had some filename changes in 
this area (file got renamed to rabbitmq.conf), please see Tony's announcement:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-February/003479.html

- Dmitriy



From matt.george at myemma.com  Wed Mar  4 15:37:13 2009
From: matt.george at myemma.com (Matt George)
Date: Wed, 4 Mar 2009 09:37:13 -0600
Subject: [rabbitmq-discuss] application keeps crashing
In-Reply-To: <49AE9EB9.4050908@cohesiveft.com>
References: <6E81AB9F-2BB1-4AF9-B00D-6603473E1A64@myemma.com>	<269388e30903020856q1c92d2e1pa9d45f54126c277f@mail.gmail.com>	<273934A4-6379-4536-86AA-49F8A5A2AD09@myemma.com>	<269388e30903020909t3656c209sf4305a2e3ced45bc@mail.gmail.com>	<AFDE92CE-5688-48F4-A4DA-5452A413B701@myemma.com>	<269388e30903021454q7819c3beq6d3fc9a7a83fd4d@mail.gmail.com>	<95074A2E-B7BC-4F6F-BA5C-B25A43ED9BA7@myemma.com>
	<269388e30903040442g5a22281br401206fc846c5f91@mail.gmail.com>
	<49AE9EB9.4050908@cohesiveft.com>
Message-ID: <A8B96994-6D59-479A-8925-12770794D93E@myemma.com>

I do not have a /etc/default/rabbitmq present. Our install should have  
been just a vanilla install.

thanks,
Matt

Matt George
Software Developer | Emma?
matt.george at myemma.com
800.595.4401
615.292.0777 (fax)

Emma helps organizations everywhere communicate & market in style.
Visit us online at http://www.myemma.com

On Mar 4, 2009, at 9:31 AM, Dmitriy Samovskiy wrote:

>
> Hi all,
>
>>> I talked to the guys who setup the box and they told me that it's  
>>> a standard
>>> vanilla ubuntu 8.04 install, on a vmware virtual server.
>>> The rabbitmq install was from the debian package via apt-get, and  
>>> was
>>> upgraded from 1.5.1 to 1.5.3 the same way. After we installed
>>> rabbitmq, nothing else was done in terms of configuration.
>>> Let me know if you need anymore info
>> OK, so you're saying that you can reproduce this behaviour by using
>> apt-get to upgrade from 1.5.1 to 1.5.3?
>
> I just did an upgrade from 1.5.1 to 1.5.3 on my vm with "apt-get  
> install rabbitmq-server" and it worked well, didn't break anything.  
> It's Debian Etch however, not Ubuntu.
>
> Matt, do you have any config in /etc/default/rabbitmq? 1.5.3 had  
> some filename changes in this area (file got renamed to  
> rabbitmq.conf), please see Tony's announcement:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-February/003479.html
>
> - Dmitriy

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090304/da807878/attachment.htm 

From 0x6e6562 at gmail.com  Wed Mar  4 17:34:23 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 4 Mar 2009 17:34:23 +0000
Subject: [rabbitmq-discuss] Erlang client problems again
In-Reply-To: <C7D3466C-F88E-45DA-BCDC-8ADB5A17D734@miceda.org>
References: <C7D3466C-F88E-45DA-BCDC-8ADB5A17D734@miceda.org>
Message-ID: <269388e30903040934h4d40784i4adb9323663fe17c@mail.gmail.com>

Dave,

On Wed, Mar 4, 2009 at 2:50 PM, Dave Bryson <daveb at miceda.org> wrote:
> I had a problem in the past with the Erlang client timing out and
> never connecting. ?With some help on the list from another user I was
> able to get it to work by synching the exact version of the client and
> rabbitmq from the source in mercurial. Now I'm trying the latest
> server 1.5.3 and the latest version of the client and I'm having the
> same exact problem again: network test times out on the first basic
> test and if I try making my own connection "lib_amqp:start_connection"
> it just hangs.
>
> I see a lot of activity on the erlang client in source control and
> knowing the client uses code from the server I'm curious why it just
> "doesn't work". ?Is anyone using the erlang client with the latest
> rabbitmq server (1.5.3)? ?What version of the server are the client
> developers testing against?

In general

hg up -C default

for both the client and the server will do the trick.

This is because the default branch of Rabbit differs quite a bit from
the 1.5.x series, i.e. the default branch contains a lot of new
features (and internal API changes) that will be released in 1.6.0,
whereas 1.5.3 is a maintenance release that does not include any new
features.

When the Erlang client is released, specific client and server
versions will be locked down. Until then, we will always sync the
default branches of both trees.

Having just that I've just run the test suite with the latest
respective trees and have noticed that the QOS test breaks the suite
because it internally waits 15 secs to do what it has to do, but eunit
times out after 5 seconds :-( Need to fix this, obviously.

HTH,

Ben



From 0x6e6562 at gmail.com  Wed Mar  4 17:36:22 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 4 Mar 2009 17:36:22 +0000
Subject: [rabbitmq-discuss] Fwd:  application keeps crashing
In-Reply-To: <7D044EAD-5B2C-4EEB-B56E-51814CE92F55@myemma.com>
References: <6E81AB9F-2BB1-4AF9-B00D-6603473E1A64@myemma.com>
	<269388e30903020856q1c92d2e1pa9d45f54126c277f@mail.gmail.com>
	<273934A4-6379-4536-86AA-49F8A5A2AD09@myemma.com>
	<269388e30903020909t3656c209sf4305a2e3ced45bc@mail.gmail.com>
	<AFDE92CE-5688-48F4-A4DA-5452A413B701@myemma.com>
	<269388e30903021454q7819c3beq6d3fc9a7a83fd4d@mail.gmail.com>
	<95074A2E-B7BC-4F6F-BA5C-B25A43ED9BA7@myemma.com>
	<269388e30903040442g5a22281br401206fc846c5f91@mail.gmail.com>
	<7D044EAD-5B2C-4EEB-B56E-51814CE92F55@myemma.com>
Message-ID: <269388e30903040936t4b0d54d1xa030eec6f9a272ad@mail.gmail.com>

Just cc'ing the list :-)


---------- Forwarded message ----------
From: Matt George <matt.george at myemma.com>
Date: Wed, Mar 4, 2009 at 3:16 PM
Subject: Re: [rabbitmq-discuss] application keeps crashing
To: Ben Hood <0x6e6562 at gmail.com>


No I'm sorry for the confusion. I was saying that we had upgraded the
to 1.5.3 using apt-get.
thanks,
Matt
Matt George
Software Developer?|?Emma?
matt.george at myemma.com
800.595.4401
615.292.0777 (fax)
Emma helps organizations everywhere communicate & market in style.
Visit us online at?http://www.myemma.com
- Show quoted text -
On Mar 4, 2009, at 6:42 AM, Ben Hood wrote:

Matt,

On Tue, Mar 3, 2009 at 2:57 PM, Matt George <matt.george at myemma.com> wrote:

I talked to the guys who setup the box and they told me that it's a standard

vanilla ubuntu 8.04 install, on a vmware virtual server.

The rabbitmq install was from the debian package via apt-get, and was

upgraded from 1.5.1 to 1.5.3 the same way. After we installed

rabbitmq, nothing else was done in terms of configuration.

Let me know if you need anymore info

OK, so you're saying that you can reproduce this behaviour by using
apt-get to upgrade from 1.5.1 to 1.5.3?

Ben



From 0x6e6562 at gmail.com  Wed Mar  4 17:42:15 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 4 Mar 2009 17:42:15 +0000
Subject: [rabbitmq-discuss] application keeps crashing
In-Reply-To: <A8B96994-6D59-479A-8925-12770794D93E@myemma.com>
References: <6E81AB9F-2BB1-4AF9-B00D-6603473E1A64@myemma.com>
	<269388e30903020856q1c92d2e1pa9d45f54126c277f@mail.gmail.com>
	<273934A4-6379-4536-86AA-49F8A5A2AD09@myemma.com>
	<269388e30903020909t3656c209sf4305a2e3ced45bc@mail.gmail.com>
	<AFDE92CE-5688-48F4-A4DA-5452A413B701@myemma.com>
	<269388e30903021454q7819c3beq6d3fc9a7a83fd4d@mail.gmail.com>
	<95074A2E-B7BC-4F6F-BA5C-B25A43ED9BA7@myemma.com>
	<269388e30903040442g5a22281br401206fc846c5f91@mail.gmail.com>
	<49AE9EB9.4050908@cohesiveft.com>
	<A8B96994-6D59-479A-8925-12770794D93E@myemma.com>
Message-ID: <269388e30903040942sb943a9t21ce44289ff788d1@mail.gmail.com>

Matt,

On Wed, Mar 4, 2009 at 3:37 PM, Matt George <matt.george at myemma.com> wrote:
> I do not have a?/etc/default/rabbitmq present. Our install should have been
> just a vanilla install.

OK.

To be able to help you, I'm going to need to be able to reproduce your
error somehow. Considering that you've virtualized your environment,
are you able to provide an image with your setup that will recreate
the symptom?

Ben



From 0x6e6562 at gmail.com  Wed Mar  4 18:13:22 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 4 Mar 2009 18:13:22 +0000
Subject: [rabbitmq-discuss] Erlang client problems again
In-Reply-To: <E8753CC6-0981-49A5-8918-8A0292700FA7@miceda.org>
References: <C7D3466C-F88E-45DA-BCDC-8ADB5A17D734@miceda.org>
	<269388e30903040934h4d40784i4adb9323663fe17c@mail.gmail.com>
	<E8753CC6-0981-49A5-8918-8A0292700FA7@miceda.org>
Message-ID: <269388e30903041013i4e1bb9c6ub1addf51812f2b16@mail.gmail.com>

Dave,

On Wed, Mar 4, 2009 at 5:53 PM, Dave Bryson <daveb at miceda.org> wrote:
> Thanks for the help.

No worries.

> I'll do that from now on. ?I did clone the v1_5 branch
> of the client just a little while ago and all seems to be working.

One of these days, we'll make a proper release of the client and lock
in a version with the server.

Ben



From cpettitt at gmail.com  Fri Mar  6 00:13:00 2009
From: cpettitt at gmail.com (Chris Pettitt)
Date: Thu, 5 Mar 2009 16:13:00 -0800
Subject: [rabbitmq-discuss] Monitoring RabbitMQ from JMX
In-Reply-To: <269388e30903040439r1e8ddb21i2f358e5422d7c2c7@mail.gmail.com>
References: <de47e4420903031040s361185b8r8d06d1bbe590e0d8@mail.gmail.com>
	<269388e30903040439r1e8ddb21i2f358e5422d7c2c7@mail.gmail.com>
Message-ID: <de47e4420903051613v4f16ae31ib9da1be0afad3890@mail.gmail.com>

Carl, Alexis, Ben,

Thank you for your very helpful replies. Unfortunately I haven't been
able to work on this as much as I had hoped this week.

My idea about proxying commands through rabbit_control did not work.
The action functions print to the display instead of returning the
results tuple. However, I am able to connect to the rabbit node
directly from Java and call the functions. This works out to be easier
(one less process to manage).

I totally agree with Ben's suggestion for dividing up this problem. I
can use JInterface for #1, but if I get the abstractions right for #2
and #3 then it should be able to replace #1 with an SNMP layer at a
later date.

I hope to make more progress on this next week. One of my next steps
is to look at what we're currently monitoring and determine if there
are equivalents in Rabbit.

Thanks again for your help. I'll report back when I have something
more substantial.

Thanks,
Chris

On Wed, Mar 4, 2009 at 4:39 AM, Ben Hood <0x6e6562 at gmail.com> wrote:
> Chris,
>
> On Tue, Mar 3, 2009 at 6:40 PM, Chris Pettitt <cpettitt at gmail.com> wrote:
>> I'm currently exploring monitoring options for RabbitMQ. There is a monitoring
>> page on the RabbitMQ site [1] from July 2008 that describes some potential
>> solutions, but it's not clear if anything has been done since that discussion.
>
> Apart from discussing this further (you might want to google threads
> on this list about monitoring), nothing has been done. It is a
> medium-ish priority, but ATM we are very busy at LShift and hence have
> very little time to do anything.
>
>> I'd like to expose monitoring through JMX. Is there anything that does
>> that already
>> or that can be adapted to such a purpose?
>
> As Carl has pointed out, QPid have exposed some functionality via JMX.
> But AFAIK this has not been done for Rabbit.
>
>> If not, I've thought about a few ways I could implement it, but I would be
>> happy to get feedback from the folks on this list. Here are some thoughts:
>>
>> 1. I could write a JMX system to talk to rabbit_amqqueue directly
>> using JInterface.
>> I prototyped this approach successfully, but it seems wrong to depend on the
>> functions in rabbit_amqqueue directly, especially if they are not a public API.
>>
>> 2. I could write a small Erlang process that proxies requests to the action
>> function in rabbit_control. The benefit of this is that rabbit_control
>> aggregates monitoring across several modules and the client is less sensitive
>> to changes to rabbit_amqqueue and other modules. Using an Erlang process is
>> also nice because I wouldn't have to spawn rabbitmqctl for each request. With
>> this solution the JMX system could communicate with the process using either
>> JInterface or pipes (though I prefer the former unless there is a good reason
>> to avoid it).
>>
>> Thoughts? Is there a good alternative I'm missing?
>
> I would divide the problem up into three parts to solve separately:
>
> 1. Define how you want to remote the calls;
> 2. Define what functionality you want to expose;
> 3. Have a look at what internal APIs are available to you and whether
> you can write a wrapper to subsume them;
>
>
> ad 1) Using JInterface seems fine to me;
> ad 2) Tricky - you will limited to what rabbit_amqqueue exposes;
> ad 3) Using rabbit_amqqueue is not evil per se, it's just that it is
> subject to change (explicitly or subtly), so it's something you may
> need to keep in sync. We wouldn't be so-and-so's and deliberately
> break your stuff, but you would have to clear on the fact that
> compatibility would be a best-effort thing rather than a guarantee to
> support stuff going forwards.
>
> Having said all of that, you may get the most mileage out of us were
> you to look into OTP's SMTP capabilities ;-)
>
> HTH,
>
> Ben
>



From 0x6e6562 at gmail.com  Sat Mar  7 13:27:04 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 7 Mar 2009 13:27:04 +0000
Subject: [rabbitmq-discuss] application keeps crashing
In-Reply-To: <68BFB691-2F10-4547-959B-82EFB8BBFBF6@myemma.com>
References: <6E81AB9F-2BB1-4AF9-B00D-6603473E1A64@myemma.com>
	<269388e30903020909t3656c209sf4305a2e3ced45bc@mail.gmail.com>
	<AFDE92CE-5688-48F4-A4DA-5452A413B701@myemma.com>
	<269388e30903021454q7819c3beq6d3fc9a7a83fd4d@mail.gmail.com>
	<95074A2E-B7BC-4F6F-BA5C-B25A43ED9BA7@myemma.com>
	<269388e30903040442g5a22281br401206fc846c5f91@mail.gmail.com>
	<49AE9EB9.4050908@cohesiveft.com>
	<A8B96994-6D59-479A-8925-12770794D93E@myemma.com>
	<269388e30903040942sb943a9t21ce44289ff788d1@mail.gmail.com>
	<68BFB691-2F10-4547-959B-82EFB8BBFBF6@myemma.com>
Message-ID: <269388e30903070527v73a79054p864de02c35025a0c@mail.gmail.com>

Matt,

On Fri, Mar 6, 2009 at 8:58 PM, Matt George <matt.george at myemma.com> wrote:

> Unfortunately, I cannot get a copy of that virtual machine right now.
> Earlier you had said that there might be something wrong with the mnesia db.

Yes - the error message you were getting was due to a case clause that
didn't check for the non-existence of the rabbit_config table in
mnesia, because the non-existence of the table is not something that
would normally occur.

> Where would I generally look for that location to see if it's messed up?

Well you would do exactly what you did beforehand, i.e. look at the
directory where you tell Rabbit to put the mnesia files, which is
/var/lib/rabbitmq/mnesia in your case.

> ask because we have a dev server, with the same basic setup as our prod
> server,
> that seems to be working completely fine. Which leads me to think that it
> might be a setup or data issue.
> thanks,

Possibly. This is why is important to able to capture the state of the
VM when the problem happens again, so that we can look into what is
missing and maybe try to find out why.

Ben



From 0x6e6562 at gmail.com  Mon Mar  9 15:14:50 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 9 Mar 2009 15:14:50 +0000
Subject: [rabbitmq-discuss] application keeps crashing
In-Reply-To: <E9594A13-713D-419E-98E3-767FFD09DF1E@myemma.com>
References: <6E81AB9F-2BB1-4AF9-B00D-6603473E1A64@myemma.com>
	<269388e30903021454q7819c3beq6d3fc9a7a83fd4d@mail.gmail.com>
	<95074A2E-B7BC-4F6F-BA5C-B25A43ED9BA7@myemma.com>
	<269388e30903040442g5a22281br401206fc846c5f91@mail.gmail.com>
	<49AE9EB9.4050908@cohesiveft.com>
	<A8B96994-6D59-479A-8925-12770794D93E@myemma.com>
	<269388e30903040942sb943a9t21ce44289ff788d1@mail.gmail.com>
	<68BFB691-2F10-4547-959B-82EFB8BBFBF6@myemma.com>
	<269388e30903070527v73a79054p864de02c35025a0c@mail.gmail.com>
	<E9594A13-713D-419E-98E3-767FFD09DF1E@myemma.com>
Message-ID: <269388e30903090814s766328b4s387844eb7f1d0a18@mail.gmail.com>

Matt,

On Mon, Mar 9, 2009 at 2:29 PM, Matt George <matt.george at myemma.com> wrote:
> We had another crash over the weekend and I saw some stuff in the logs this
> time that I thought might help so I am attaching them with this email.

OK, the sasl log shows the original symptom where the rabbit_config
table doesn't exist. Is this on the same environment as the previous
occurences? You said that you were unable to reproduce this on your
development environment. I am wondering if the underlying mnesia
tables are somehow being deleted. If you could do a fresh installation
of 1.5.3 on the particular environment that is giving you grief, maybe
you will be able to reproduce this issue.

> One
> of the things that I noticed was that it looks like somehow the connections
> seem to be opening but not closing for some time.

This is not an issue. As AMQP is a connection orientated protocol,
connections can last a long time.

> I am using the pyamqplib
> library to make my connections. From the rabbitmq standpoint, is it better
> to keep a connection open, or to get a new connection for every message?

The former, as that is what the protocol is designed to do. However,
we have been able to maintain 20000 concurrent connections to a single
instance (before getting bored), so it would be pretty hard to
overload it.

Looking at the normal log, you have a few thousand standard entries
that document clients connecting and disconnecting.

Towards the back end of the log file (at about 21:19:56 on 8/3/09) you
have a lot of  connection_closed_abruptly errors in the log. This is
usually the result of the client resetting the socket without
observing the AMQP shutdown protocol (in plain english, it looks as if
a number of clients have just died). Are you sure that the Rabbit
instance has become unavailable at this point? Do you have another
client to test this with?

Ben
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit.log.1
Type: application/octet-stream
Size: 890779 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090309/32efd88d/attachment.obj 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit-sasl.log.1
Type: application/octet-stream
Size: 6074 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090309/32efd88d/attachment-0001.obj 

From 0x6e6562 at gmail.com  Mon Mar  9 15:27:31 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 9 Mar 2009 15:27:31 +0000
Subject: [rabbitmq-discuss] application keeps crashing
In-Reply-To: <A3988C98-E300-4F8E-9106-1DC6FFB39641@myemma.com>
References: <6E81AB9F-2BB1-4AF9-B00D-6603473E1A64@myemma.com>
	<269388e30903040442g5a22281br401206fc846c5f91@mail.gmail.com>
	<49AE9EB9.4050908@cohesiveft.com>
	<A8B96994-6D59-479A-8925-12770794D93E@myemma.com>
	<269388e30903040942sb943a9t21ce44289ff788d1@mail.gmail.com>
	<68BFB691-2F10-4547-959B-82EFB8BBFBF6@myemma.com>
	<269388e30903070527v73a79054p864de02c35025a0c@mail.gmail.com>
	<E9594A13-713D-419E-98E3-767FFD09DF1E@myemma.com>
	<269388e30903090814s766328b4s387844eb7f1d0a18@mail.gmail.com>
	<A3988C98-E300-4F8E-9106-1DC6FFB39641@myemma.com>
Message-ID: <269388e30903090827p6bc316ehca85a3dcfa9cb496@mail.gmail.com>

Matt,

On Mon, Mar 9, 2009 at 3:19 PM, Matt George <matt.george at myemma.com> wrote:
> I think we might be able to do a fresh install on the prod box later this
> week. Is that the one you were talking about?
> Would it be best to try and uninstall the current Rabbitmq instance and then
> install again?

Yes. Ideally you should start from fresh and install the latest stable
of Rabbit, which is 1.5.3.

BTW - If you keep this discussion on list, then you might get some
help from other members of the community :-)

Ben



From Andrius.Norkaitis at oryo.lt  Tue Mar 10 21:29:21 2009
From: Andrius.Norkaitis at oryo.lt (Andrius Norkaitis)
Date: Tue, 10 Mar 2009 23:29:21 +0200
Subject: [rabbitmq-discuss] win 2008 64bit
Message-ID: <000b01c9a1c7$46d3f6b0$d47be410$@Norkaitis@oryo.lt>

Hi,

 

Is it ok to install complete-rabbitmq-bundle-1.5.3.zip
<http://www.rabbitmq.com/releases/bundles/v1.5.3/complete-rabbitmq-bundle-1.
5.3.zip>  on win64 or should I look somewere for 64bit with compilation of
erlang or rabbitmq?

 

Thanks,

Andrius

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090310/be300f49/attachment.htm 

From clemesha at gmail.com  Tue Mar 10 21:36:02 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Tue, 10 Mar 2009 14:36:02 -0700
Subject: [rabbitmq-discuss] RabbitMQ Cluster,
	option "-setcookie cookie" + EC2 experiences
Message-ID: <d272f0690903101436i67e5d81dpdd6c4d43b78a99aa@mail.gmail.com>

Quick update on this...

Currently, I have "fixed" my setcookie issue by bundling a Rabbit AMI, which,
in turn, bundles the .erlang.cookie with it.  Now every instance of the AMI will
have the same cookie - so these instances can cluster with each other
... Not the
cleanest solution, but it works for now.


For completeness, here are a couple issues I've hit during this
(RabbitMQ cluster on EC2) process:

=> There are issue with bundling "/var/lib/rabbitmq/mnesia/rabbit/*"
because the Mnesia tables have a dependence on the current hostname.
I just did "rm -rf /var/lib/rabbitmq/mnesia/rabbit/*" before bundling,
which was good enough for now.
This issue is discussed in detail here:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-January/003171.html


=> Sometime (but not always) when I instantiate a couple Rabbit ec2
instances at once, I see one of the instances fail to start up,
with the following message from  "rabbitmqctl status":

Status of node 'rabbit at ip-10-250-19-15' ...\n\n=ERROR REPORT====
10-Mar-2009::21:10:49 ===\nError in process <0.35.0> on node
'rabbitmqctl1437 at ip-10-250-19-15' with exit value:
{badarg,[{erlang,list_to_existing_atom,[\"rabbit@(none)\"]},{dist_util,recv_challenge,1},{dist_util,handshake_we_started,1}]}\n\n{badrpc,nodedown}\n...done.

This interesting part is the "rabbit@(none)" part I think.  A hostname
issue of some sort?  Here's another ec2 hostname rabbitmq-discuss
thread: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-March/000972.html
, but I'm fairly sure that I'm not having the same issue,
as I'm starting all my Cluster instance at the "availability_zone"
"us-east-1c" - which all have internal hostnames of
"ip-XXX-XXX-XXX-XXX"


Anyways, back to work!
thanks,
Alex




-- 
Alex Clemesha
clemesha.org



From matthias at lshift.net  Wed Mar 11 13:22:36 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 11 Mar 2009 13:22:36 +0000
Subject: [rabbitmq-discuss] RabbitMQ Cluster,
 option "-setcookie cookie" + EC2 experiences
In-Reply-To: <d272f0690903101436i67e5d81dpdd6c4d43b78a99aa@mail.gmail.com>
References: <d272f0690903101436i67e5d81dpdd6c4d43b78a99aa@mail.gmail.com>
Message-ID: <49B7BB1C.8090204@lshift.net>

Alex,

Alex Clemesha wrote:
> Currently, I have "fixed" my setcookie issue by bundling a Rabbit AMI, which,
> in turn, bundles the .erlang.cookie with it.  Now every instance of the AMI will
> have the same cookie - so these instances can cluster with each other
> ... Not the cleanest solution, but it works for now.

I reckon that is a perfectly acceptable solution.

> In this document: http://www.rabbitmq.com/clustering.html, there is this line:
> "As an alternative, you can insert the option "-setcookie
> cluster_cookie" in the erl call in the rabbitmq-server and rabbitmqctl
>  scripts."
> 
> Does this imply I should modify the rabbitmq-server and rabbitmqctl
> scripts to have this functionality, or is there some way
> (that I'm not seeing yet) to pass "-setcookie cluster_cookie" to
> rabbitmq-server and rabbitmqctl scripts?

You can either edit the scripts (rabbitmq-server, rabbitmq-multi and 
rabbitmqctl) or add the "-setcookie ..." to SERVER_ERL_ARGS and 
MULTI_ERL_ARGS in /etc/rabbitmq/rabbitmq.conf. Make sure you copy the 
existing settings of RABBITMQ_SERVER_ERL_ARGS across from the script 
though. However, I've just noticed that rabbitmqctl doesn't source 
/etc/rabbitmq/rabbitmq.conf, so the only way to change the cookie for 
that is to edit the script. I have filed a bug to fix that.

> Status of node 'rabbit at ip-10-250-19-15' ...\n\n=ERROR REPORT====
> 10-Mar-2009::21:10:49 ===\nError in process <0.35.0> on node
> 'rabbitmqctl1437 at ip-10-250-19-15' with exit value:
> {badarg,[{erlang,list_to_existing_atom,[\"rabbit@(none)\"]},{dist_util,recv_challenge,1},{dist_util,handshake_we_started,1}]}\n\n{badrpc,nodedown}\n...done.
> 
> This interesting part is the "rabbit@(none)" part I think.  A hostname
> issue of some sort?

It certainly looks like the rabbit node failed to get hold of the 
hostname. Might be a timing issue, i.e. perhaps DNS is in a state of 
flux / broken just after an image comes up.

Btw, what version of Erlang are you running?


Matthias.



From Robert.Elsner at echostar.com  Wed Mar 11 17:55:12 2009
From: Robert.Elsner at echostar.com (Elsner, Robert)
Date: Wed, 11 Mar 2009 11:55:12 -0600
Subject: [rabbitmq-discuss] basic.qos support?
Message-ID: <D4C5E348C434294AA040A57B0D3DF5ED02CB362D@MER2-EXCHB1.echostar.com>

Greetings,

 

I have a situation where there will be multiple clients receiving
messages (topic exchange) but some of these clients might not keep up
with the reception.  I need a maximum message queue length, and a way to
specify to the server to drop messages if that clients queue is full.

 

I see on the developer page:
https://dev.rabbitmq.com/wiki/BasicQosDesign and this looks like what I
need.

 

However, I gather that this is a 1.6.x feature or is available in
subversion.  How can I get the source to test the basic.qos features?

 

My clients are currently Java-based.

 

Thanks,

Rob Elsner

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090311/0dd129d7/attachment.htm 

From opendev at gmail.com  Wed Mar 11 18:08:19 2009
From: opendev at gmail.com (Joern)
Date: Wed, 11 Mar 2009 19:08:19 +0100
Subject: [rabbitmq-discuss] basic.qos support?
In-Reply-To: <D4C5E348C434294AA040A57B0D3DF5ED02CB362D@MER2-EXCHB1.echostar.com>
References: <D4C5E348C434294AA040A57B0D3DF5ED02CB362D@MER2-EXCHB1.echostar.com>
Message-ID: <9e009ad0903111108k32f9bd15lf0fea4333bbbe61c@mail.gmail.com>

Hi Robert,

2009/3/11 Elsner, Robert <Robert.Elsner at echostar.com>:

> I have a situation where there will be multiple clients receiving messages
> (topic exchange) but some of these clients might not keep up with the
> reception.? I need a maximum message queue length, and a way to specify to
> the server to drop messages if that clients queue is full.

You could work around this issue by maintaining your own (Java) based
queue and drop messages in the client when that queue is full. Or use
basic get instead of subscriptions if you need to implement a
primitive form of congestion control on the clients end.

Best regards,


Joern
--



From matthias at lshift.net  Wed Mar 11 18:15:57 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 11 Mar 2009 18:15:57 +0000
Subject: [rabbitmq-discuss] basic.qos support?
In-Reply-To: <D4C5E348C434294AA040A57B0D3DF5ED02CB362D@MER2-EXCHB1.echostar.com>
References: <D4C5E348C434294AA040A57B0D3DF5ED02CB362D@MER2-EXCHB1.echostar.com>
Message-ID: <49B7FFDD.600@lshift.net>

Robert,

Elsner, Robert wrote:
> However, I gather that this is a 1.6.x feature or is available in 
> subversion.  How can I get the source to test the basic.qos features?

basic.qos is due to appear in the 1.6.x release. Until then you can get 
hold of it by building from source from our mercurial repos. See 
http://www.rabbitmq.com/build-server.html and 
http://www.rabbitmq.com/build-java-client.html for instructions for the 
RabbitMQ server and Java client, respectively.


Matthias.



From Robert.Elsner at echostar.com  Wed Mar 11 20:21:26 2009
From: Robert.Elsner at echostar.com (Elsner, Robert)
Date: Wed, 11 Mar 2009 14:21:26 -0600
Subject: [rabbitmq-discuss] basic.qos support?
In-Reply-To: <49B7FFDD.600@lshift.net>
References: <D4C5E348C434294AA040A57B0D3DF5ED02CB362D@MER2-EXCHB1.echostar.com>
	<49B7FFDD.600@lshift.net>
Message-ID: <D4C5E348C434294AA040A57B0D3DF5ED02CB3657@MER2-EXCHB1.echostar.com>

If a message is not marked immediate=true, and the basicQos(10) is
called on the channel, would you expect it to continue adding messages
to the queue for delivery?

I assumed that if the client specified a basic qos "prefetchCount" of
10, and the messages were marked as durable=false immediate=false, they
would be silently discarded.

Rob



From matthias at lshift.net  Wed Mar 11 23:10:21 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 11 Mar 2009 23:10:21 +0000
Subject: [rabbitmq-discuss] basic.qos support?
In-Reply-To: <D4C5E348C434294AA040A57B0D3DF5ED02CB3657@MER2-EXCHB1.echostar.com>
References: <D4C5E348C434294AA040A57B0D3DF5ED02CB362D@MER2-EXCHB1.echostar.com>	<49B7FFDD.600@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED02CB3657@MER2-EXCHB1.echostar.com>
Message-ID: <49B844DD.8070406@lshift.net>

Robert,

Elsner, Robert wrote:
> If a message is not marked immediate=true, and the basicQos(10) is
> called on the channel, would you expect it to continue adding messages
> to the queue for delivery?

basicQos affects the transmission of messages from queues to consumers 
only. It does not affect the publication side; messages still get routed 
to the queue and queued by it as normal.


Matthias.



From Robert.Elsner at echostar.com  Wed Mar 11 23:16:59 2009
From: Robert.Elsner at echostar.com (Elsner, Robert)
Date: Wed, 11 Mar 2009 17:16:59 -0600
Subject: [rabbitmq-discuss] basic.qos support?
In-Reply-To: <49B844DD.8070406@lshift.net>
References: <D4C5E348C434294AA040A57B0D3DF5ED02CB362D@MER2-EXCHB1.echostar.com>	<49B7FFDD.600@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED02CB3657@MER2-EXCHB1.echostar.com>
	<49B844DD.8070406@lshift.net>
Message-ID: <D4C5E348C434294AA040A57B0D3DF5ED02EA77DE@MER2-EXCHB1.echostar.com>


> basicQos affects the transmission of messages from queues to 
> consumers only. It does not affect the publication side; 
> messages still get routed to the queue and queued by it as normal.


That would explain the behavior I saw using rabbitmqctl to list
information about the queues, the number of messages would bounce around
for a client allowed to consume all of the data, but was fixed at 10
when a client was blocked from consuming data.

Thanks for the clarification,
Rob



From clemesha at gmail.com  Thu Mar 12 05:42:33 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Wed, 11 Mar 2009 22:42:33 -0700
Subject: [rabbitmq-discuss] RabbitMQ Cluster,
	option "-setcookie cookie" + 	EC2 experiences
In-Reply-To: <49B7BB1C.8090204@lshift.net>
References: <d272f0690903101436i67e5d81dpdd6c4d43b78a99aa@mail.gmail.com>
	<49B7BB1C.8090204@lshift.net>
Message-ID: <d272f0690903112242l648a5506tb2335a5de5162913@mail.gmail.com>

>> Currently, I have "fixed" my setcookie issue by bundling a Rabbit AMI,
>> which,
>> in turn, bundles the .erlang.cookie with it. ?Now every instance of the
>> AMI will
>> have the same cookie - so these instances can cluster with each other
>> ... Not the cleanest solution, but it works for now.
>
> I reckon that is a perfectly acceptable solution.
I've come to believe that as well :)


>
>> In this document: http://www.rabbitmq.com/clustering.html, there is this
>> line:
>> "As an alternative, you can insert the option "-setcookie
>> cluster_cookie" in the erl call in the rabbitmq-server and rabbitmqctl
>> ?scripts."
>>
>> Does this imply I should modify the rabbitmq-server and rabbitmqctl
>> scripts to have this functionality, or is there some way
>> (that I'm not seeing yet) to pass "-setcookie cluster_cookie" to
>> rabbitmq-server and rabbitmqctl scripts?
>
> You can either edit the scripts (rabbitmq-server, rabbitmq-multi and
> rabbitmqctl) or add the "-setcookie ..." to SERVER_ERL_ARGS and
> MULTI_ERL_ARGS in /etc/rabbitmq/rabbitmq.conf. Make sure you copy the
> existing settings of RABBITMQ_SERVER_ERL_ARGS across from the script though.
> However, I've just noticed that rabbitmqctl doesn't source
> /etc/rabbitmq/rabbitmq.conf, so the only way to change the cookie for that
> is to edit the script. I have filed a bug to fix that.
Ok, thanks.


>
>> Status of node 'rabbit at ip-10-250-19-15' ...\n\n=ERROR REPORT====
>> 10-Mar-2009::21:10:49 ===\nError in process <0.35.0> on node
>> 'rabbitmqctl1437 at ip-10-250-19-15' with exit value:
>>
>> {badarg,[{erlang,list_to_existing_atom,[\"rabbit@(none)\"]},{dist_util,recv_challenge,1},{dist_util,handshake_we_started,1}]}\n\n{badrpc,nodedown}\n...done.
>>
>> This interesting part is the "rabbit@(none)" part I think. ?A hostname
>> issue of some sort?
>
> It certainly looks like the rabbit node failed to get hold of the hostname.
> Might be a timing issue, i.e. perhaps DNS is in a state of flux / broken
> just after an image comes up.
Yeah, this part is unfortunate - it's pretty random from what I've
seen.  I've guess
I'll take 'rabbitmq-server' out of the boot sequence ... maybe that
will fix things.


>
> Btw, what version of Erlang are you running?
# erl -version
Erlang (ASYNC_THREADS) (BEAM) emulator version 5.5.5

on Ubuntu 8.04:
# cat /etc/issue
Ubuntu 8.04.2 \n \l



thanks,
Alex


>
> Matthias.
>



-- 
Alex Clemesha
clemesha.org



From matthias at lshift.net  Thu Mar 12 08:55:56 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 12 Mar 2009 08:55:56 +0000
Subject: [rabbitmq-discuss] RabbitMQ Cluster,
 option "-setcookie cookie" + EC2 experiences
In-Reply-To: <d272f0690903112242l648a5506tb2335a5de5162913@mail.gmail.com>
References: <d272f0690903101436i67e5d81dpdd6c4d43b78a99aa@mail.gmail.com>	<49B7BB1C.8090204@lshift.net>
	<d272f0690903112242l648a5506tb2335a5de5162913@mail.gmail.com>
Message-ID: <49B8CE1C.3020901@lshift.net>

Alex,

Alex Clemesha wrote:
> # erl -version
> Erlang (ASYNC_THREADS) (BEAM) emulator version 5.5.5

That's R11B-5. You many want to upgrade to R12B-5 - I seem to recall 
that there were some DNS related bug fixes in the R12 series.


Matthias.



From eran.sandler at gmail.com  Thu Mar 12 16:19:28 2009
From: eran.sandler at gmail.com (Eran Sandler)
Date: Thu, 12 Mar 2009 18:19:28 +0200
Subject: [rabbitmq-discuss] win 2008 64bit
In-Reply-To: <-672053394664793056@unknownmsgid>
References: <-672053394664793056@unknownmsgid>
Message-ID: <5f884b720903120919o2b4cffd3l52a528f6358eca25@mail.gmail.com>

I don't know regarding Windows 2008 64bit, but we use it on Windows 2003
64bit and it works just fine.

AFAIK, there is no official win64 build of the Erlang runtime. If you
install the 32bit runtime and use RabbitMQ it will work in 32bit without a
problem.

Eran

On Tue, Mar 10, 2009 at 11:29 PM, Andrius Norkaitis <
Andrius.Norkaitis at oryo.lt> wrote:

>  Hi,
>
>
>
> Is it ok to install complete-rabbitmq-bundle-1.5.3.zip<http://www.rabbitmq.com/releases/bundles/v1.5.3/complete-rabbitmq-bundle-1.5.3.zip>on win64 or should I look somewere for 64bit with compilation of erlang or
> rabbitmq?
>
>
>
> Thanks,
>
> Andrius
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090312/c737346c/attachment.htm 

From eran.sandler at gmail.com  Thu Mar 12 16:28:22 2009
From: eran.sandler at gmail.com (Eran Sandler)
Date: Thu, 12 Mar 2009 18:28:22 +0200
Subject: [rabbitmq-discuss] Ack semantics in RabbitMQ
Message-ID: <5f884b720903120928i3fd0445dnbac071a117eccfa7@mail.gmail.com>

Hi all,

I'm trying to find a bit more information about the ack semantic in RabbitMQ
in a specific scenario.

In a consumer pull model, where consumers pull the queue once in a while
(without subscription) and you have multiple consumer, if a consumer pulls a
message (without auto ack) and doesn't ack it can another consumer still get
it or is it marked in a certain way until its acked and deleted?

Assuming when a message is pulled and not acked yet and no other consumer
can pull it until its either acked or rejected back to the queue, will it
have a certain timeout that it was pulled and wasn't acked for X amount of
time?

The reason I'm asking all of this is that after reading the post from one of
the Twitter engineers on Kesterl (
http://robey.lag.net/2008/11/27/scarling-to-kestrel.html) which is what
replaced Scarling, they added a couple of features I would really like to
see on RabbitMQ (and they might already be there).

The first is the "ack" logic they have on Kesterl (though I would also
prefer to have a timeout until a message is acked).

The blocking calls are interesting, but I think that other features such as
flow control can easily have a better semantics than the blocking pull
calls.

Of course, there is the flow-to-disk feature which a lot of people have
asked (I'm really doing my best to get up to speed on Erlang to see if I can
help ;-) ).

Anyone care to map the feature of Kesterl to RabbitMQ (or even to AMQP) and
mark what is the diff and if its needed or can be replaced by another
feature?

Thanks in advnace,

Eran
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090312/53761e5b/attachment.htm 

From Andrius.Norkaitis at oryo.lt  Thu Mar 12 17:42:14 2009
From: Andrius.Norkaitis at oryo.lt (Andrius Norkaitis)
Date: Thu, 12 Mar 2009 19:42:14 +0200
Subject: [rabbitmq-discuss] win 2008 64bit
In-Reply-To: <5f884b720903120919o2b4cffd3l52a528f6358eca25@mail.gmail.com>
References: <-672053394664793056@unknownmsgid>
	<5f884b720903120919o2b4cffd3l52a528f6358eca25@mail.gmail.com>
Message-ID: <002001c9a339$e185b770$a4912650$@Norkaitis@oryo.lt>

At web site there is such note:

 

Our goal is to streamline the broker installation process such that you can
have RabbitMQ up and running within two minutes of completing your download.
If this doesn't happen to you, please let us know at
legitimategrievance at rabbitmq.com

 

I had some problems to install and launch it on windows 2008 server (64bit),
but figured out, so I can share my experience:

 

1.       Because  erlang is 32bit app, it is installed by default to
C:\Program Files (x86). I had problems changing path in bat files (for
unknown reason it didn't found erl even if I specified other location), so
it was easier to reinstall it to C:\Program Files folder which is default.

2.       I installed rabbitmq as windows service and started it, but it
wasn't working because service was running as "Local System" account. I
changed to log on as "Network Service", but the problem persisted.

"Network Service" by default has not IO permissions to access windows
directory (needed for erlang.cookie) and your user account appdata directory
for storing logs and db. So I changed the bat script and specified another
dir and added permissions to this folder. Also you need to add permissions
for c:\windows catalog because when rabbitmq starts, it creates
.erlang.cookie there (haven't found a successful way to change this path).
After that, you could remove permissions from folder and add it only to that
file.

3.       After I changed paths in bat file, it was using the old ones, so
finally I removed all "if ." and epically specified new paths.

 

if "%RABBITMQ_BASE%"=="" (

    set RABBITMQ_BASE=%APPDATA%\%RABBITMQ_SERVICENAME%

)

 

Changed to:

 

    set RABBITMQ_BASE=C:\Rabbit

 

Etc.

 

4.       Rabbitmqctl won't work because rabbit is using cookie in c:\windows
and rabbitmqctl is looking for cookie at userdata folder. I tried to modify
bat to specify -setcookie c:\Windows, but that didn't worked for me, so the
easier way was to copy cookie file from windows dir to my user dir.

 

 

It would be great if someone better "bat" guru than me could tell how to do
this easier. Seems that rabbit isn't used heavily on production windows
servers J and there is not detail manual about this.

 

Andrius

 

From: Eran Sandler [mailto:eran.sandler at gmail.com] 
Sent: Thursday, March 12, 2009 6:19 PM
To: Andrius Norkaitis
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] win 2008 64bit

 

I don't know regarding Windows 2008 64bit, but we use it on Windows 2003
64bit and it works just fine.

AFAIK, there is no official win64 build of the Erlang runtime. If you
install the 32bit runtime and use RabbitMQ it will work in 32bit without a
problem.

Eran

 

On Tue, Mar 10, 2009 at 11:29 PM, Andrius Norkaitis
<Andrius.Norkaitis at oryo.lt> wrote:

Hi,

 

Is it ok to install complete-rabbitmq-bundle-1.5.3.zip
<http://www.rabbitmq.com/releases/bundles/v1.5.3/complete-rabbitmq-bundle-1.
5.3.zip>  on win64 or should I look somewere for 64bit with compilation of
erlang or rabbitmq?

 

Thanks,

Andrius


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090312/48fc2e55/attachment.htm 

From clemesha at gmail.com  Thu Mar 12 23:39:50 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Thu, 12 Mar 2009 16:39:50 -0700
Subject: [rabbitmq-discuss] RabbitMQ Cluster,
	option "-setcookie cookie" + 	EC2 experiences
In-Reply-To: <49B8CE1C.3020901@lshift.net>
References: <d272f0690903101436i67e5d81dpdd6c4d43b78a99aa@mail.gmail.com>
	<49B7BB1C.8090204@lshift.net>
	<d272f0690903112242l648a5506tb2335a5de5162913@mail.gmail.com>
	<49B8CE1C.3020901@lshift.net>
Message-ID: <d272f0690903121639l33e6f7e2j7da88d911f620b3e@mail.gmail.com>

Hi,

I now have the rabbit cluster going fine, i.e. "rabbitmqctl status"
reports that my instances are clustered.
  (I moved over to the ec2 availability_zone=>us-east-1a and I'm not
seeing the same DNS issue yet?!? ...could be total chance, I've only
done a couple of tests)

I'm having this issue now:
I can only attach (via python amqplib clients) to the first cluster
node that I attached the secondary node to.

 Im getting: socket.gaierror: (8, 'nodename nor servname provided, or
not known') when trying to attach a client to second broker (in the
cluster).

I've tried both 'ram' and 'disk' clustering, if that makes any difference.

Any thoughts on this?


>> # erl -version
>> Erlang (ASYNC_THREADS) (BEAM) emulator version 5.5.5
>
> That's R11B-5. You many want to upgrade to R12B-5 - I seem to recall that
> there were some DNS related bug fixes in the R12 series.
Interesting, thanks for the tip.


thanks for all the help,
Alex



-- 
Alex Clemesha
clemesha.org



From matthias at lshift.net  Fri Mar 13 12:24:49 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 13 Mar 2009 12:24:49 +0000
Subject: [rabbitmq-discuss] Ack semantics in RabbitMQ
In-Reply-To: <5f884b720903120928i3fd0445dnbac071a117eccfa7@mail.gmail.com>
References: <5f884b720903120928i3fd0445dnbac071a117eccfa7@mail.gmail.com>
Message-ID: <49BA5091.4030806@lshift.net>

Eran,

Eran Sandler wrote:
> In a consumer pull model, where consumers pull the queue once in a while 
> (without subscription) and you have multiple consumer, if a consumer 
> pulls a message (without auto ack) and doesn't ack it can another 
> consumer still get it or is it marked in a certain way until its acked 
> and deleted? 

The AMQP ack model for subscriptions and "pull" are identical. In both 
cases the message is kept on the server but is unavailable to other 
consumers until it either has been ack'ed (and gets removed), nack'ed 
(with basic.reject; though RabbitMQ does not implement that) or the 
channel/connection is closed (at which point the message becomes 
available to other consumers).

> Assuming when a message is pulled and not acked yet and no other 
> consumer can pull it until its either acked or rejected back to the 
> queue, will it have a certain timeout that it was pulled and wasn't 
> acked for X amount of time?

There is no timeout on waiting for acks. Usually that is not a problem 
since the common cases of a missing ack - network or client failure - 
will result in the connection getting dropped (and thus trigger the 
behaviour described above). Still, a timeout could be useful to, say, 
deal with alive but unresponsive consumers. That has come up in 
discussion before. Is there a specific use case you have in mind that 
requires such functionality?


Regards,

Matthias.



From matthias at lshift.net  Fri Mar 13 13:30:14 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 13 Mar 2009 13:30:14 +0000
Subject: [rabbitmq-discuss] RabbitMQ Cluster,
 option "-setcookie cookie" + 	EC2 experiences
In-Reply-To: <d272f0690903121639l33e6f7e2j7da88d911f620b3e@mail.gmail.com>
References: <d272f0690903101436i67e5d81dpdd6c4d43b78a99aa@mail.gmail.com>	<49B7BB1C.8090204@lshift.net>	<d272f0690903112242l648a5506tb2335a5de5162913@mail.gmail.com>	<49B8CE1C.3020901@lshift.net>
	<d272f0690903121639l33e6f7e2j7da88d911f620b3e@mail.gmail.com>
Message-ID: <49BA5FE6.8070106@lshift.net>

Alex,

Alex Clemesha wrote:
>  Im getting: socket.gaierror: (8, 'nodename nor servname provided, or
> not known') when trying to attach a client to second broker (in the
> cluster).

That looks like an error thrown by the python client library and, on the 
surface of it, does not appear to indicate a problem with the RabbitMQ 
broker. Do the connection attempts show up in the server logs at all?


Matthias.





From clemesha at gmail.com  Sat Mar 14 02:03:50 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Fri, 13 Mar 2009 19:03:50 -0700
Subject: [rabbitmq-discuss] RabbitMQ Cluster,
	option "-setcookie cookie" + 	EC2 experiences
In-Reply-To: <49BA5FE6.8070106@lshift.net>
References: <d272f0690903101436i67e5d81dpdd6c4d43b78a99aa@mail.gmail.com>
	<49B7BB1C.8090204@lshift.net>
	<d272f0690903112242l648a5506tb2335a5de5162913@mail.gmail.com>
	<49B8CE1C.3020901@lshift.net>
	<d272f0690903121639l33e6f7e2j7da88d911f620b3e@mail.gmail.com>
	<49BA5FE6.8070106@lshift.net>
Message-ID: <d272f0690903131903r46d57f33p28a8191266232c51@mail.gmail.com>

Hi,

>>
>> ?Im getting: socket.gaierror: (8, 'nodename nor servname provided, or
>> not known') when trying to attach a client to second broker (in the
>> cluster).
>
> That looks like an error thrown by the python client library and, on the
> surface of it, does not appear to indicate a problem with the RabbitMQ
> broker. Do the connection attempts show up in the server logs at all?

I've gotten to the root of the problem - it has to do with the fact
that the second
rabbit broker is doing a redirect, i.e, from
/var/log/rabbitmq/rabbit.log I see:

INFO REPORT==== 14-Mar-2009::00:18:55 ===
connection <0.16842.0> redirecting to
<<"domU-12-31-39-00-7E-16.compute-1.internal:5672">>


So it looks like I need to solve this problem by either using my
clients correctly,
or they need to handle redirects better.

With py amqplib,  I can put "insist=True" inside of "amqp.Connection",
and I don't see
the failure anymore ( socket.gaierror: (8, 'nodename nor servname
provided, or not known'),
but I'm stilling wondering if the clients should handle the redirect
transparently?

With txAMQP, I have not yet seen if you can even pass a "insist=True"
anywhere.  The txAMQP also
does not follow the redirect (as far as I can see), it just sort of
'hangs', but I'm probably
just using the client wrong ...I'm going to do more investigating.


Maybe the authors of either python client lib are around, and they
could set me straight
on this use case :-)


thanks!
-Alex






-- 
Alex Clemesha
clemesha.org



From dmitriy.samovskiy at cohesiveft.com  Sun Mar 15 04:42:01 2009
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Sat, 14 Mar 2009 23:42:01 -0500
Subject: [rabbitmq-discuss] RabbitMQ Cluster,
 option "-setcookie cookie" + 	EC2 experiences
In-Reply-To: <d272f0690903131903r46d57f33p28a8191266232c51@mail.gmail.com>
References: <d272f0690903101436i67e5d81dpdd6c4d43b78a99aa@mail.gmail.com>	<49B7BB1C.8090204@lshift.net>	<d272f0690903112242l648a5506tb2335a5de5162913@mail.gmail.com>	<49B8CE1C.3020901@lshift.net>	<d272f0690903121639l33e6f7e2j7da88d911f620b3e@mail.gmail.com>	<49BA5FE6.8070106@lshift.net>
	<d272f0690903131903r46d57f33p28a8191266232c51@mail.gmail.com>
Message-ID: <49BC8719.2060901@cohesiveft.com>


Hi Alex,

Alex Clemesha wrote:
>>>  Im getting: socket.gaierror: (8, 'nodename nor servname provided, or
>>> not known') when trying to attach a client to second broker (in the
>>> cluster).
>> That looks like an error thrown by the python client library and, on the
>> surface of it, does not appear to indicate a problem with the RabbitMQ
>> broker. Do the connection attempts show up in the server logs at all?
> 
> I've gotten to the root of the problem - it has to do with the fact
> that the second
> rabbit broker is doing a redirect, i.e, from
> /var/log/rabbitmq/rabbit.log I see:
> 
> INFO REPORT==== 14-Mar-2009::00:18:55 ===
> connection <0.16842.0> redirecting to
> <<"domU-12-31-39-00-7E-16.compute-1.internal:5672">>
This name (*.internal) is an
internal DNS name that resolves only in EC2 region where your brokers are running. Clients
connecting from another region (regions are US or EU) or from Internet will not be able to
resolve this - they should be using the instance's public DNS name.

Python on my mac does raise gaierror 8 when I tried to connect to unresolvable name (see 
below). Interestingly, python in Linux raised gaierror -2 'Name or service not known'.

$ python
Python 2.5.1 (r251:54863, Apr 15 2008, 22:57:26)
[GCC 4.0.1 (Apple Inc. build 5465)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
 >>> import socket
 >>> sock = socket.socket()
 >>> sock.connect(('foo.bar.internal', 5672))
Traceback (most recent call last):
   File "<stdin>", line 1, in <module>
   File "<string>", line 1, in connect
socket.gaierror: (8, 'nodename nor servname provided, or not known')



You *might* get rabbit to put right name into known_hosts field by associating public DNS 
name of rabbit instance (ec2*.amazonaws.com) with its private IP address (10.X.X.X) in 
/etc/hosts. Or do client side load balancing with insist=True, like you said.

Also, here is a link to a potentially related thread:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-September/001901.html




- Dmitriy



From eran.sandler at gmail.com  Sun Mar 15 09:55:31 2009
From: eran.sandler at gmail.com (Eran Sandler)
Date: Sun, 15 Mar 2009 11:55:31 +0200
Subject: [rabbitmq-discuss] Ack semantics in RabbitMQ
In-Reply-To: <49BA5091.4030806@lshift.net>
References: <5f884b720903120928i3fd0445dnbac071a117eccfa7@mail.gmail.com>
	<49BA5091.4030806@lshift.net>
Message-ID: <5f884b720903150255r5df61441lee9b0788c6d5d4a0@mail.gmail.com>

Hi Matthias,

Thanks for responding.

There is a couple of projects at work that will require an async system
based on message queues. I don't want to lose anything and I do want to
handle cases in which the message was consumed (and not acked yet) and
something bad happend. In which case, I want to ack a message only when I
know for sure that the actions that this message triggered finished
correctly.

So, the current behavior is well suite for me.

Regarding the blocking "GET" commands, I read about Kesterl (in the link I
gave below) and thought its an interesting approach to make pulling a bit
more efficient instead of sending the "puller" back to a short sleep.

That's basically the only scenario. I don't think its too important. What
was more important to me was understanding the exact Ack semantics (which is
implemented exactly as I want it to be :-) ).

With the new command line tool that allows getting the queue length, I can
easily write a script to let Nagios alert me if the rate of messages going
in is higher than the rate of them coming out.

Eran

On Fri, Mar 13, 2009 at 2:24 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Eran,
>
> Eran Sandler wrote:
>
>> In a consumer pull model, where consumers pull the queue once in a while
>> (without subscription) and you have multiple consumer, if a consumer pulls a
>> message (without auto ack) and doesn't ack it can another consumer still get
>> it or is it marked in a certain way until its acked and deleted?
>>
>
> The AMQP ack model for subscriptions and "pull" are identical. In both
> cases the message is kept on the server but is unavailable to other
> consumers until it either has been ack'ed (and gets removed), nack'ed (with
> basic.reject; though RabbitMQ does not implement that) or the
> channel/connection is closed (at which point the message becomes available
> to other consumers).
>
>  Assuming when a message is pulled and not acked yet and no other consumer
>> can pull it until its either acked or rejected back to the queue, will it
>> have a certain timeout that it was pulled and wasn't acked for X amount of
>> time?
>>
>
> There is no timeout on waiting for acks. Usually that is not a problem
> since the common cases of a missing ack - network or client failure - will
> result in the connection getting dropped (and thus trigger the behaviour
> described above). Still, a timeout could be useful to, say, deal with alive
> but unresponsive consumers. That has come up in discussion before. Is there
> a specific use case you have in mind that requires such functionality?
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090315/5ec0fd37/attachment.htm 

From luis.dasilva007 at gmail.com  Mon Mar 16 14:03:36 2009
From: luis.dasilva007 at gmail.com (Luis Da Silva)
Date: Mon, 16 Mar 2009 11:03:36 -0300
Subject: [rabbitmq-discuss] Newbie q - stateful protocol
Message-ID: <e6e848df0903160703w169ef846o475186f839c93917@mail.gmail.com>

Hi,

Is it possible to implement stateful protocols using RabbitMQ (routing,
memory shared between states,...)?
In that case what overhead does it have and an example can be very helpful.

thks, Luis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090316/1f2a7128/attachment.htm 

From alexis.richardson at gmail.com  Mon Mar 16 15:21:20 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 16 Mar 2009 15:21:20 +0000
Subject: [rabbitmq-discuss] RabbitMQ team in California soon and will be in
	San Francisco w/c 5th April
Message-ID: <167204d20903160821j68ce8c25q2503814fce4b5cda@mail.gmail.com>

Dear list, and folks cc'd and bcc'd,

(Apologies if you get this twice..)

Tony and I will be visiting SF in the second week of April, probably
arriving Sunday night (April 5th).  I shall be leaving on Thursday
morning to catch a plane to LAX and then back to the UK but Tony will
be around until the end of the weekend.  Prior to being in SF we shall
visit SD and LA.  Our visit to SD is on 1-4 April and will include an
AMQP 1.0 'face to face' meeting with the AMQP Working Group -- more on
that in a later email.

It would be great if we could meet up with as many folks as possible
who want to talk about RabbitMQ.  If you are around please contact me,
or post to the list, and please spread the word on #rabbitmq.  If you
are not around please spread the word :-)

Our aim is to find time to sit down with people who are using RabbitMQ
and make sure their set-up is working as best it can, and how we can
make it better.  We also want to organiser some 'get togethers' ie.
talks, meals and beers.  We want to meet people who are interested in
messaging, no matter what your favourite language or protocol is.

The current plan is for us to do a Talk at BayFP on Wednesday 8th
April in the evening.  Thanks to Mike and Keith for this opportunity.
We'd like to present new work in messaging including thoughts on
things like HTTP pubsub, Comet, BOSH, XMPP, microblogging, ... and how
they relate to the existing AMQP broker.  Details to come.  I hope
this will be fun and we can all go for a beer afterwards.  Assuming
the BayFP talk is in downtown SF, that should allow anyone who wants
to come along to meet up.  Maybe we can go to the Thirsty Bear again.

If you would like to join us at the talk or afterwards, please contact
Mike and Keith (cc'd), and cc me.  Other than that we can meet up on
any day that any of us is around.  Just let me know.  It would be
great to see you.

Cheers,

alexis



From mheitzenroder at gmail.com  Mon Mar 16 15:23:47 2009
From: mheitzenroder at gmail.com (Matt Heitzenroder)
Date: Mon, 16 Mar 2009 11:23:47 -0400
Subject: [rabbitmq-discuss] RedHat's Pending AMQP w/ XML Patent
Message-ID: <FD4AA620-D689-4289-9BEA-54622C63187F@gmail.com>

We are implementing a project using RabbitMQ.

I would be interested in LShift's/CohesiveFT's opinion on the patent  
filed by RedHat, per http://bit.ly/lTFb

How does this effect RabbitMQ?  What about the overall effect on the  
adoption of AMQP?

Cheers,
Matt



From tsuraan at gmail.com  Mon Mar 16 15:53:46 2009
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 16 Mar 2009 10:53:46 -0500
Subject: [rabbitmq-discuss] max amount of persisted data
Message-ID: <84fb38e30903160853j7f35c172q6515236ed57aaac1@mail.gmail.com>

How exactly does Rabbit use mnesia?  Does it persist messages to a
simple disc_copy table that can only hold 4GB of data, or does it use
fragmented tables or local_content tables?  I'm basically wondering
whether stock Rabbit can handle more than 4GB of persisted data, or
would it be wise to deploy with a tokyo cabinet mnesia backend or
something similar if huge persisted queues are expected.



From tonyg at lshift.net  Mon Mar 16 16:21:03 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 16 Mar 2009 16:21:03 +0000
Subject: [rabbitmq-discuss] Success using OpenAMQ JMS client with RabbitMQ
Message-ID: <49BE7C6F.90207@lshift.net>

Hi all,

I've just downloaded (git clone
git://github.com/pieterh/openamq-jms.git) the OpenAMQ AMQP JMS client
and tried it out. Kudos to the OpenAMQ team for building such a smooth
piece of software!

 - With a small patch (attached; you will need to edit the hardcoded
path to the AMQP 0-8 spec XML file if you want to try it),

 - and the addition of a "/test" vhost to the RabbitMQ server config
(rabbitmqctl add_vhost /test; rabbitmqctl set_permissions -p /test guest
'.*' '.*' '.*'),

 - the included example programs worked fine against RabbitMQ.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
-------------- next part --------------
A non-text attachment was scrubbed...
Name: openamq-jms-to-rabbitmq.patch
Type: text/x-patch
Size: 1594 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090316/7b387dd5/attachment.bin 

From alexis.richardson at gmail.com  Mon Mar 16 17:19:47 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 16 Mar 2009 17:19:47 +0000
Subject: [rabbitmq-discuss] RedHat's Pending AMQP w/ XML Patent
In-Reply-To: <FD4AA620-D689-4289-9BEA-54622C63187F@gmail.com>
References: <FD4AA620-D689-4289-9BEA-54622C63187F@gmail.com>
Message-ID: <167204d20903161019p5ba8457aqfa6b220ed59fd4d0@mail.gmail.com>

Matt,

On Mon, Mar 16, 2009 at 3:23 PM, Matt Heitzenroder
<mheitzenroder at gmail.com> wrote:
> We are implementing a project using RabbitMQ.

Cool - and thanks for getting in touch.


> I would be interested in LShift's/CohesiveFT's opinion on the patent
> filed by RedHat, per http://bit.ly/lTFb

That's a very interesting question.  We've brought this to the
attention of the AMQP Working Group, of which we are a member.
Currently the matter is under discussion - so keep an eye on how
things evolve.

The way AMQP works is that ALL members of the WG grant a patent
license to ALL implementers and users of AMQP for patents held that
may affect use of AMQP.  So anything in the specification is
definitely safe from patent abuse and this is upheld by a substantial
body of law and commercial interest.  This is similar to, say, the
W3C.  AMQP is protected from royalty and tenancy abuse, as befits an
Internet protocol.

The problem with this particular patent application is that it covers
something not currently in the AMQP spec.  Were the AMQP spec to
include XML exchanges as an "Extension", then Red Hat would be obliged
to grant licenses to users and implementers, if the patent had been
approved.  We don't expect this particular patent to get approved --
it is too 'obvious'.  In any case we and other members of the Working
Group are taking steps to make sure AMQP stays 100% free and open,
even for extensions of this sort.  We want that because it promotes
interop as the spec evolves, and attracts many more implementers.

We are however very annoyed about the Fear, Uncertainty and Doubt that
actions like this cause.  We are astonished that Red Hat applied for a
patent of this type -- as long ago as 2007 would you believe --
without talking to the Working Group about the best way to protect
AMQP Extensions from patent spam and other abuse such as trolling.

The cheapest and easiest solution would have been to establish
defensive prior art by making this very obvious design very public
indeed, preferably attached to legal language placing the text of the
claim in a safe domain (such as AMQP WG, FSF, or Public).  The fact
that this was not done, raises questions about Red Hat business
practice and casts doubt on their motives.  I suppose for now we shall
all draw our own conclusions.

I hope that Red Hat come clean about their intentions and help to
defuse any FUD.  I do believe they are sincerely committed to the
existing Working Group contracts and would like to see them defend
open standards in the future.  Note that I use 'open standard'
advisedly -- the situation here is very different from the OIN patent
portfolio which is designed to protect Linux.  There is no notion of
interop for Linux, at least nothing like AMQP interop.  The approaches
used by the W3C and IETF are more appropriate here.


> How does this effect RabbitMQ?

Currently not at all.  We shall work to make sure that it never does
and expect to be able to report a suitable guarantee on behalf of the
Working Group as soon as possible.  There are a number of ways to do
this, none of which are terribly difficult, and people in the Working
Group are working as a group to make it happen and do so unambiguously
:-)


>?What about the overall effect on the
> adoption of AMQP?

I don't think that scaring users and implementers is good for AMQP
adoption.  This gives Red Hat, and everyone else, a strong incentive
to sort out the mess they have caused.  Then we can all move on,
probably stronger for the experience.

Let me know if this helps,

Alexis Richardson,
RabbitMQ






> Cheers,
> Matt
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From aconbere at gmail.com  Mon Mar 16 17:41:08 2009
From: aconbere at gmail.com (anders conbere)
Date: Mon, 16 Mar 2009 07:41:08 -1000
Subject: [rabbitmq-discuss] RedHat's Pending AMQP w/ XML Patent
In-Reply-To: <167204d20903161019p5ba8457aqfa6b220ed59fd4d0@mail.gmail.com>
References: <FD4AA620-D689-4289-9BEA-54622C63187F@gmail.com>
	<167204d20903161019p5ba8457aqfa6b220ed59fd4d0@mail.gmail.com>
Message-ID: <8ca3fbe80903161041k5d32657fl1672eb0fea2d7058@mail.gmail.com>

On Mon, Mar 16, 2009 at 7:19 AM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
> Matt,
>
> On Mon, Mar 16, 2009 at 3:23 PM, Matt Heitzenroder
> <mheitzenroder at gmail.com> wrote:
>> We are implementing a project using RabbitMQ.
>
> Cool - and thanks for getting in touch.
>
>
>> I would be interested in LShift's/CohesiveFT's opinion on the patent
>> filed by RedHat, per http://bit.ly/lTFb
>
> That's a very interesting question. ?We've brought this to the
> attention of the AMQP Working Group, of which we are a member.
> Currently the matter is under discussion - so keep an eye on how
> things evolve.
>
> The way AMQP works is that ALL members of the WG grant a patent
> license to ALL implementers and users of AMQP for patents held that
> may affect use of AMQP. ?So anything in the specification is
> definitely safe from patent abuse and this is upheld by a substantial
> body of law and commercial interest. ?This is similar to, say, the
> W3C. ?AMQP is protected from royalty and tenancy abuse, as befits an
> Internet protocol.
>
> The problem with this particular patent application is that it covers
> something not currently in the AMQP spec. ?Were the AMQP spec to
> include XML exchanges as an "Extension", then Red Hat would be obliged
> to grant licenses to users and implementers, if the patent had been
> approved. ?We don't expect this particular patent to get approved --
> it is too 'obvious'. ?In any case we and other members of the Working
> Group are taking steps to make sure AMQP stays 100% free and open,
> even for extensions of this sort. ?We want that because it promotes
> interop as the spec evolves, and attracts many more implementers.
>
> We are however very annoyed about the Fear, Uncertainty and Doubt that
> actions like this cause. ?We are astonished that Red Hat applied for a
> patent of this type -- as long ago as 2007 would you believe --
> without talking to the Working Group about the best way to protect
> AMQP Extensions from patent spam and other abuse such as trolling.
>
> The cheapest and easiest solution would have been to establish
> defensive prior art by making this very obvious design very public
> indeed, preferably attached to legal language placing the text of the
> claim in a safe domain (such as AMQP WG, FSF, or Public). ?The fact
> that this was not done, raises questions about Red Hat business
> practice and casts doubt on their motives. ?I suppose for now we shall
> all draw our own conclusions.

After reading the patent, it seems as though this is really an attempt
to patent a method which has been in use by many middleware products
simply applied to a new protocol (AMQP). Routing messages based on
data contained withing XML stanzas, where the route is defined by an
Xpath. (one could even sight XMPP as being excellent prior art),. I
would be astonished if this patent application were granted.

~ Anders

>
> I hope that Red Hat come clean about their intentions and help to
> defuse any FUD. ?I do believe they are sincerely committed to the
> existing Working Group contracts and would like to see them defend
> open standards in the future. ?Note that I use 'open standard'
> advisedly -- the situation here is very different from the OIN patent
> portfolio which is designed to protect Linux. ?There is no notion of
> interop for Linux, at least nothing like AMQP interop. ?The approaches
> used by the W3C and IETF are more appropriate here.
>
>
>> How does this effect RabbitMQ?
>
> Currently not at all. ?We shall work to make sure that it never does
> and expect to be able to report a suitable guarantee on behalf of the
> Working Group as soon as possible. ?There are a number of ways to do
> this, none of which are terribly difficult, and people in the Working
> Group are working as a group to make it happen and do so unambiguously
> :-)
>
>
>>?What about the overall effect on the
>> adoption of AMQP?
>
> I don't think that scaring users and implementers is good for AMQP
> adoption. ?This gives Red Hat, and everyone else, a strong incentive
> to sort out the mess they have caused. ?Then we can all move on,
> probably stronger for the experience.
>
> Let me know if this helps,
>
> Alexis Richardson,
> RabbitMQ
>
>
>
>
>
>
>> Cheers,
>> Matt
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From alexis.richardson at gmail.com  Mon Mar 16 17:46:06 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 16 Mar 2009 17:46:06 +0000
Subject: [rabbitmq-discuss] RedHat's Pending AMQP w/ XML Patent
In-Reply-To: <8ca3fbe80903161041k5d32657fl1672eb0fea2d7058@mail.gmail.com>
References: <FD4AA620-D689-4289-9BEA-54622C63187F@gmail.com>
	<167204d20903161019p5ba8457aqfa6b220ed59fd4d0@mail.gmail.com>
	<8ca3fbe80903161041k5d32657fl1672eb0fea2d7058@mail.gmail.com>
Message-ID: <167204d20903161046q15be0698q6fc869a453dc094f@mail.gmail.com>

Anders,

Thanks for that.  I agree with you.

I suppose a defense lawyer might pitch that applying the known
approach of XQuery to a focussed application area - AMQP - makes it
novel.  My response would be that all this does is suggest the patent
claim is a direct attack on AMQP since the non-AMQP work is obviously
prior art.

alexis



On Mon, Mar 16, 2009 at 5:41 PM, anders conbere <aconbere at gmail.com> wrote:
> On Mon, Mar 16, 2009 at 7:19 AM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>> Matt,
>>
>> On Mon, Mar 16, 2009 at 3:23 PM, Matt Heitzenroder
>> <mheitzenroder at gmail.com> wrote:
>>> We are implementing a project using RabbitMQ.
>>
>> Cool - and thanks for getting in touch.
>>
>>
>>> I would be interested in LShift's/CohesiveFT's opinion on the patent
>>> filed by RedHat, per http://bit.ly/lTFb
>>
>> That's a very interesting question. ?We've brought this to the
>> attention of the AMQP Working Group, of which we are a member.
>> Currently the matter is under discussion - so keep an eye on how
>> things evolve.
>>
>> The way AMQP works is that ALL members of the WG grant a patent
>> license to ALL implementers and users of AMQP for patents held that
>> may affect use of AMQP. ?So anything in the specification is
>> definitely safe from patent abuse and this is upheld by a substantial
>> body of law and commercial interest. ?This is similar to, say, the
>> W3C. ?AMQP is protected from royalty and tenancy abuse, as befits an
>> Internet protocol.
>>
>> The problem with this particular patent application is that it covers
>> something not currently in the AMQP spec. ?Were the AMQP spec to
>> include XML exchanges as an "Extension", then Red Hat would be obliged
>> to grant licenses to users and implementers, if the patent had been
>> approved. ?We don't expect this particular patent to get approved --
>> it is too 'obvious'. ?In any case we and other members of the Working
>> Group are taking steps to make sure AMQP stays 100% free and open,
>> even for extensions of this sort. ?We want that because it promotes
>> interop as the spec evolves, and attracts many more implementers.
>>
>> We are however very annoyed about the Fear, Uncertainty and Doubt that
>> actions like this cause. ?We are astonished that Red Hat applied for a
>> patent of this type -- as long ago as 2007 would you believe --
>> without talking to the Working Group about the best way to protect
>> AMQP Extensions from patent spam and other abuse such as trolling.
>>
>> The cheapest and easiest solution would have been to establish
>> defensive prior art by making this very obvious design very public
>> indeed, preferably attached to legal language placing the text of the
>> claim in a safe domain (such as AMQP WG, FSF, or Public). ?The fact
>> that this was not done, raises questions about Red Hat business
>> practice and casts doubt on their motives. ?I suppose for now we shall
>> all draw our own conclusions.
>
> After reading the patent, it seems as though this is really an attempt
> to patent a method which has been in use by many middleware products
> simply applied to a new protocol (AMQP). Routing messages based on
> data contained withing XML stanzas, where the route is defined by an
> Xpath. (one could even sight XMPP as being excellent prior art),. I
> would be astonished if this patent application were granted.
>
> ~ Anders
>
>>
>> I hope that Red Hat come clean about their intentions and help to
>> defuse any FUD. ?I do believe they are sincerely committed to the
>> existing Working Group contracts and would like to see them defend
>> open standards in the future. ?Note that I use 'open standard'
>> advisedly -- the situation here is very different from the OIN patent
>> portfolio which is designed to protect Linux. ?There is no notion of
>> interop for Linux, at least nothing like AMQP interop. ?The approaches
>> used by the W3C and IETF are more appropriate here.
>>
>>
>>> How does this effect RabbitMQ?
>>
>> Currently not at all. ?We shall work to make sure that it never does
>> and expect to be able to report a suitable guarantee on behalf of the
>> Working Group as soon as possible. ?There are a number of ways to do
>> this, none of which are terribly difficult, and people in the Working
>> Group are working as a group to make it happen and do so unambiguously
>> :-)
>>
>>
>>>?What about the overall effect on the
>>> adoption of AMQP?
>>
>> I don't think that scaring users and implementers is good for AMQP
>> adoption. ?This gives Red Hat, and everyone else, a strong incentive
>> to sort out the mess they have caused. ?Then we can all move on,
>> probably stronger for the experience.
>>
>> Let me know if this helps,
>>
>> Alexis Richardson,
>> RabbitMQ
>>
>>
>>
>>
>>
>>
>>> Cheers,
>>> Matt
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



From mheitzenroder at gmail.com  Mon Mar 16 18:15:07 2009
From: mheitzenroder at gmail.com (Matt Heitzenroder)
Date: Mon, 16 Mar 2009 14:15:07 -0400
Subject: [rabbitmq-discuss] RedHat's Pending AMQP w/ XML Patent
In-Reply-To: <167204d20903161019p5ba8457aqfa6b220ed59fd4d0@mail.gmail.com>
References: <FD4AA620-D689-4289-9BEA-54622C63187F@gmail.com>
	<167204d20903161019p5ba8457aqfa6b220ed59fd4d0@mail.gmail.com>
Message-ID: <D392037F-115E-4EC1-83AB-B1F924DFB9E5@gmail.com>

Awesome response! That's a great response. If you don't mind, please  
let us know of any new developments incase it doesn't my radar.

Cheers,
matt


On  Mar 16, at 1:19 PM, Alexis Richardson wrote:

> Matt,
>
> On Mon, Mar 16, 2009 at 3:23 PM, Matt Heitzenroder
> <mheitzenroder at gmail.com> wrote:
>> We are implementing a project using RabbitMQ.
>
> Cool - and thanks for getting in touch.
>
>
>> I would be interested in LShift's/CohesiveFT's opinion on the patent
>> filed by RedHat, per http://bit.ly/lTFb
>
> That's a very interesting question.  We've brought this to the
> attention of the AMQP Working Group, of which we are a member.
> Currently the matter is under discussion - so keep an eye on how
> things evolve.
>
> The way AMQP works is that ALL members of the WG grant a patent
> license to ALL implementers and users of AMQP for patents held that
> may affect use of AMQP.  So anything in the specification is
> definitely safe from patent abuse and this is upheld by a substantial
> body of law and commercial interest.  This is similar to, say, the
> W3C.  AMQP is protected from royalty and tenancy abuse, as befits an
> Internet protocol.
>
> The problem with this particular patent application is that it covers
> something not currently in the AMQP spec.  Were the AMQP spec to
> include XML exchanges as an "Extension", then Red Hat would be obliged
> to grant licenses to users and implementers, if the patent had been
> approved.  We don't expect this particular patent to get approved --
> it is too 'obvious'.  In any case we and other members of the Working
> Group are taking steps to make sure AMQP stays 100% free and open,
> even for extensions of this sort.  We want that because it promotes
> interop as the spec evolves, and attracts many more implementers.
>
> We are however very annoyed about the Fear, Uncertainty and Doubt that
> actions like this cause.  We are astonished that Red Hat applied for a
> patent of this type -- as long ago as 2007 would you believe --
> without talking to the Working Group about the best way to protect
> AMQP Extensions from patent spam and other abuse such as trolling.
>
> The cheapest and easiest solution would have been to establish
> defensive prior art by making this very obvious design very public
> indeed, preferably attached to legal language placing the text of the
> claim in a safe domain (such as AMQP WG, FSF, or Public).  The fact
> that this was not done, raises questions about Red Hat business
> practice and casts doubt on their motives.  I suppose for now we shall
> all draw our own conclusions.
>
> I hope that Red Hat come clean about their intentions and help to
> defuse any FUD.  I do believe they are sincerely committed to the
> existing Working Group contracts and would like to see them defend
> open standards in the future.  Note that I use 'open standard'
> advisedly -- the situation here is very different from the OIN patent
> portfolio which is designed to protect Linux.  There is no notion of
> interop for Linux, at least nothing like AMQP interop.  The approaches
> used by the W3C and IETF are more appropriate here.
>
>
>> How does this effect RabbitMQ?
>
> Currently not at all.  We shall work to make sure that it never does
> and expect to be able to report a suitable guarantee on behalf of the
> Working Group as soon as possible.  There are a number of ways to do
> this, none of which are terribly difficult, and people in the Working
> Group are working as a group to make it happen and do so unambiguously
> :-)
>
>
>>  What about the overall effect on the
>> adoption of AMQP?
>
> I don't think that scaring users and implementers is good for AMQP
> adoption.  This gives Red Hat, and everyone else, a strong incentive
> to sort out the mess they have caused.  Then we can all move on,
> probably stronger for the experience.
>
> Let me know if this helps,
>
> Alexis Richardson,
> RabbitMQ
>
>
>
>
>
>
>> Cheers,
>> Matt
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>




From joe at joetify.com  Mon Mar 16 18:20:40 2009
From: joe at joetify.com (Joe Williams)
Date: Mon, 16 Mar 2009 11:20:40 -0700
Subject: [rabbitmq-discuss] Erlounge Seattle, Wednesday This Week.
Message-ID: <49BE9878.4010505@joetify.com>

If any Seattle based RabbitMQ and Erlang users are interested in coming out, we are having another Erlounge this week.

*7pm, March 18th 2009 @ Fuel Coffee*
1705 N 45th St, Seattle, WA
http://erloungeseattle.org/


See you there.

-Joe

-- 
Name: Joseph A. Williams
Email: joe at joetify.com
Blog: http://www.joeandmotorboat.com/




From emile at lshift.net  Mon Mar 16 18:36:11 2009
From: emile at lshift.net (Emile Joubert)
Date: Mon, 16 Mar 2009 18:36:11 +0000
Subject: [rabbitmq-discuss] win 2008 64bit
In-Reply-To: <002001c9a339$e185b770$a4912650$@Norkaitis@oryo.lt>
References: <-672053394664793056@unknownmsgid>	<5f884b720903120919o2b4cffd3l52a528f6358eca25@mail.gmail.com>
	<002001c9a339$e185b770$a4912650$@Norkaitis@oryo.lt>
Message-ID: <49BE9C1B.5080206@lshift.net>


Andrius,

Thanks for sharing your experience on windows 2008/64-bit. I've just 
tried the same and found that I needed to

set ERLANG_HOME=C:\Program Files (x86)\erl5.6.5

prior to launching rabbitmq-server.bat to run the broker. If you chose 
to install Erlang in a different location then the path will be different.

Your comments about the file permissions of the service account are very 
useful and will appear in the next version of the website.

We are aware of the potential pitfalls with synchronising cookies when 
running the service and rabbitctl as different users. The suggestions at

http://www.rabbitmq.com/service-guide.html

under "Service Management" were meant to help, but I agree that these 
could be more prominent.

The way that variables persist across invocations of the script is 
intentional, but your solution will work fine. The limitations of batch 
files have led us to consider alternatives such as powershell or windows 
script host, but will these will probably not be explored in the near 
future.

If you have any more suggestions then please let us know.

Regards

-Emile

Andrius Norkaitis wrote:
> At web site there is such note:
> 
>  
> 
> Our goal is to streamline the broker installation process such that you 
> can have RabbitMQ up and running within two minutes of completing your 
> download. If this doesn't happen to you, please let us know at 
> legitimategrievance at rabbitmq.com <mailto:legitimategrievance at rabbitmq.com>
> 
>  
> 
> I had some problems to install and launch it on windows 2008 server 
> (64bit), but figured out, so I can share my experience:
> 
>  
> 
> 1.       Because  erlang is 32bit app, it is installed by default to 
> C:\Program Files (x86). I had problems changing path in bat files (for 
> unknown reason it didn?t found erl even if I specified other location), 
> so  it was easier to reinstall it to C:\Program Files folder which is 
> default.
> 
> 2.       I installed rabbitmq as windows service and started it, but it 
> wasn?t working because service was running as ?Local System? account. I 
> changed to log on as ?Network Service?, but the problem persisted.
> 
> ?Network Service? by default has not IO permissions to access windows 
> directory (needed for erlang.cookie) and your user account appdata 
> directory for storing logs and db. So I changed the bat script and 
> specified another dir and added permissions to this folder. Also you 
> need to add permissions for c:\windows catalog because when rabbitmq 
> starts, it creates .erlang.cookie there (haven?t found a successful way 
> to change this path). After that, you could remove permissions from 
> folder and add it only to that file.
> 
> 3.       After I changed paths in bat file, it was using the old ones, 
> so finally I removed all ?if ?? and epically specified new paths.
> 
>  
> 
> if "%RABBITMQ_BASE%"=="" (
> 
>     set RABBITMQ_BASE=%APPDATA%\%RABBITMQ_SERVICENAME%
> 
> )
> 
>  
> 
> Changed to:
> 
>  
> 
>     set RABBITMQ_BASE=C:\Rabbit
> 
>  
> 
> Etc.
> 
>  
> 
> 4.       Rabbitmqctl won?t work because rabbit is using cookie in 
> c:\windows and rabbitmqctl is looking for cookie at userdata folder. I 
> tried to modify bat to specify ?setcookie c:\Windows, but that didn?t 
> worked for me, so the easier way was to copy cookie file from windows 
> dir to my user dir.
> 
>  
> 
>  
> 
> It would be great if someone better ?bat? guru than me could tell how to 
> do this easier. Seems that rabbit isn?t used heavily on production 
> windows servers J and there is not detail manual about this.
> 
>  
> 
> Andrius
> 
>  
> 
> *From:* Eran Sandler [mailto:eran.sandler at gmail.com]
> *Sent:* Thursday, March 12, 2009 6:19 PM
> *To:* Andrius Norkaitis
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* Re: [rabbitmq-discuss] win 2008 64bit
> 
>  
> 
> I don't know regarding Windows 2008 64bit, but we use it on Windows 2003 
> 64bit and it works just fine.
> 
> AFAIK, there is no official win64 build of the Erlang runtime. If you 
> install the 32bit runtime and use RabbitMQ it will work in 32bit without 
> a problem.
> 
> Eran
> 
>  
> 
> On Tue, Mar 10, 2009 at 11:29 PM, Andrius Norkaitis 
> <Andrius.Norkaitis at oryo.lt <mailto:Andrius.Norkaitis at oryo.lt>> wrote:
> 
> Hi,
> 
>  
> 
> Is it ok to install complete-rabbitmq-bundle-1.5.3.zip 
> <http://www.rabbitmq.com/releases/bundles/v1.5.3/complete-rabbitmq-bundle-1.5.3.zip> 
> on win64 or should I look somewere for 64bit with compilation of erlang 
> or rabbitmq?
> 
>  
> 
> Thanks,
> 
> Andrius
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com 
> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
>  
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From clemesha at gmail.com  Mon Mar 16 18:44:36 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Mon, 16 Mar 2009 11:44:36 -0700
Subject: [rabbitmq-discuss] RabbitMQ Cluster,
	option "-setcookie cookie" + 	EC2 experiences
In-Reply-To: <49BC8719.2060901@cohesiveft.com>
References: <d272f0690903101436i67e5d81dpdd6c4d43b78a99aa@mail.gmail.com>
	<49B7BB1C.8090204@lshift.net>
	<d272f0690903112242l648a5506tb2335a5de5162913@mail.gmail.com>
	<49B8CE1C.3020901@lshift.net>
	<d272f0690903121639l33e6f7e2j7da88d911f620b3e@mail.gmail.com>
	<49BA5FE6.8070106@lshift.net>
	<d272f0690903131903r46d57f33p28a8191266232c51@mail.gmail.com>
	<49BC8719.2060901@cohesiveft.com>
Message-ID: <d272f0690903161144u407eeb29me644f97bc7a26bed@mail.gmail.com>

>> I've gotten to the root of the problem - it has to do with the fact
>> that the second
>> rabbit broker is doing a redirect, i.e, from
>> /var/log/rabbitmq/rabbit.log I see:
>>
>> INFO REPORT==== 14-Mar-2009::00:18:55 ===
>> connection <0.16842.0> redirecting to
>> <<"domU-12-31-39-00-7E-16.compute-1.internal:5672">>
>
> This name (*.internal) is an
> internal DNS name that resolves only in EC2 region where your brokers are
> running. Clients
> connecting from another region (regions are US or EU) or from Internet will
> not be able to
> resolve this
Yes, of course the *.internal are not resolvable from outside of the
current ec2 availability zone -
but what I (naively) didn't realize is that dns that I see in the logs
are actually being passed to the client
(and hence the client errors I'm seeing) - thanks for setting me
straight on that one!


> they should be using the instance's public DNS name.

So, is this behavior 'configurable' in RabbitMQ any way (i.e. make
Rabbit redirect to the public DNS, not the private)
or should I be solving this problem in a different way?



>
> Python on my mac does raise gaierror 8 when I tried to connect to
> unresolvable name (see below). Interestingly, python in Linux raised
> gaierror -2 'Name or service not known'.
>
> $ python
> Python 2.5.1 (r251:54863, Apr 15 2008, 22:57:26)
> [GCC 4.0.1 (Apple Inc. build 5465)] on darwin
> Type "help", "copyright", "credits" or "license" for more information.
>>>> import socket
>>>> sock = socket.socket()
>>>> sock.connect(('foo.bar.internal', 5672))
> Traceback (most recent call last):
> ?File "<stdin>", line 1, in <module>
> ?File "<string>", line 1, in connect
> socket.gaierror: (8, 'nodename nor servname provided, or not known')
>
>
>
> You *might* get rabbit to put right name into known_hosts field by
> associating public DNS name of rabbit instance (ec2*.amazonaws.com) with its
> private IP address (10.X.X.X) in /etc/hosts. Or do client side load
> balancing with insist=True, like you said.
I guess this sort of answers my above question about configuring Rabbit to
redirect to the public DNS.

My inclination is to avoid making this a client side
concern - it seems more complicated to try to juggle all the (coming and going)
Rabbit cluster IPs, and try to pass this info to my clients in some ad hoc way -
but I'm not exactly sure... any opinion on this?

The /etc/hosts solution sounds better, but you say "it might work", is there
anyone using this solution with success?  I get the feeling from other mailing
list posts that I should try to avoid using "known_hosts".

>
> Also, here is a link to a potentially related thread:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-September/001901.html
Yes, thanks, I saw that before.  In it you say "...the best approach
is not to rely on known_hosts at all...",
do you still hold this to be true?  I'm a bit unclear of my remaining
options, but I'm going to keep researching.
Any advice is appreciated.


thanks very much,
Alex

>
>
>
>
> - Dmitriy
>



-- 
Alex Clemesha
clemesha.org



From alexis.richardson at gmail.com  Mon Mar 16 19:16:55 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 16 Mar 2009 19:16:55 +0000
Subject: [rabbitmq-discuss] Come to the AMQP Event in San Diego
Message-ID: <167204d20903161216y3c3b8de2ub0cd194edafd7415@mail.gmail.com>

Hi,

I mentioned that the reason that Tony and I would be in San Diego was
an AMQP event on 1-3 April.  You are all invited to attend on April
1st.  This is a good chance to meet everyone working on the AMQP specs
and make your voice heard - on any issue.  The agenda is geared around
plans for AMQP 1.0 but people who already use AMQP are welcomed to
talk about what they are doing.  If you have any concerns about AMQP
or requests for action, this is a good forum to share them.  Or maybe
you just like the idea of visiting San Diego.

I attach a flyer.

Best wishes,

alexis
-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqp-flyer3.pdf
Type: application/pdf
Size: 32130 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090316/1dab034f/attachment.pdf 

From clemesha at gmail.com  Mon Mar 16 19:33:39 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Mon, 16 Mar 2009 12:33:39 -0700
Subject: [rabbitmq-discuss] Come to the AMQP Event in San Diego
In-Reply-To: <167204d20903161216y3c3b8de2ub0cd194edafd7415@mail.gmail.com>
References: <167204d20903161216y3c3b8de2ub0cd194edafd7415@mail.gmail.com>
Message-ID: <d272f0690903161233y3645b5abjf36b362b65c95c05@mail.gmail.com>

 ?Or maybe
> you just like the idea of visiting San Diego.
Among the obvious perks of an AMQP meet-up, the idea of visiting San
Diego is a worthwhile one.
The event location is in a brand new very beautiful building, about 50
feet from the ocean in La Jolla.  Just a FYI :-)

See you there!
-Alex

>
> I attach a flyer.
>
> Best wishes,
>
> alexis
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Alex Clemesha
clemesha.org



From alexis.richardson at gmail.com  Mon Mar 16 19:34:26 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 16 Mar 2009 19:34:26 +0000
Subject: [rabbitmq-discuss] Come to the AMQP Event in San Diego
In-Reply-To: <d272f0690903161233y3645b5abjf36b362b65c95c05@mail.gmail.com>
References: <167204d20903161216y3c3b8de2ub0cd194edafd7415@mail.gmail.com>
	<d272f0690903161233y3645b5abjf36b362b65c95c05@mail.gmail.com>
Message-ID: <167204d20903161234p2a550d32s570bc3c51bb1356b@mail.gmail.com>

I forgot to mention that Alex has offered to buy beers.


On Mon, Mar 16, 2009 at 7:33 PM, Alex Clemesha <clemesha at gmail.com> wrote:
> ??Or maybe
>> you just like the idea of visiting San Diego.
> Among the obvious perks of an AMQP meet-up, the idea of visiting San
> Diego is a worthwhile one.
> The event location is in a brand new very beautiful building, about 50
> feet from the ocean in La Jolla. ?Just a FYI :-)
>
> See you there!
> -Alex
>
>>
>> I attach a flyer.
>>
>> Best wishes,
>>
>> alexis
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
>
> --
> Alex Clemesha
> clemesha.org
>



From clemesha at gmail.com  Mon Mar 16 19:35:51 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Mon, 16 Mar 2009 12:35:51 -0700
Subject: [rabbitmq-discuss] Come to the AMQP Event in San Diego
In-Reply-To: <167204d20903161234p2a550d32s570bc3c51bb1356b@mail.gmail.com>
References: <167204d20903161216y3c3b8de2ub0cd194edafd7415@mail.gmail.com>
	<d272f0690903161233y3645b5abjf36b362b65c95c05@mail.gmail.com>
	<167204d20903161234p2a550d32s570bc3c51bb1356b@mail.gmail.com>
Message-ID: <d272f0690903161235x6938155agda687c6b0527b73@mail.gmail.com>

On Mon, Mar 16, 2009 at 12:34 PM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
> I forgot to mention that Alex has offered to buy beers.
(Oh noes, don't tell everyone! :-)


>
>
> On Mon, Mar 16, 2009 at 7:33 PM, Alex Clemesha <clemesha at gmail.com> wrote:
>> ??Or maybe
>>> you just like the idea of visiting San Diego.
>> Among the obvious perks of an AMQP meet-up, the idea of visiting San
>> Diego is a worthwhile one.
>> The event location is in a brand new very beautiful building, about 50
>> feet from the ocean in La Jolla. ?Just a FYI :-)
>>
>> See you there!
>> -Alex
>>
>>>
>>> I attach a flyer.
>>>
>>> Best wishes,
>>>
>>> alexis
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>>
>>
>> --
>> Alex Clemesha
>> clemesha.org
>>
>



-- 
Alex Clemesha
clemesha.org



From dmitriy.samovskiy at cohesiveft.com  Mon Mar 16 21:04:00 2009
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Mon, 16 Mar 2009 16:04:00 -0500
Subject: [rabbitmq-discuss] RabbitMQ Cluster,
 option "-setcookie cookie" + 	EC2 experiences
In-Reply-To: <d272f0690903161144u407eeb29me644f97bc7a26bed@mail.gmail.com>
References: <d272f0690903101436i67e5d81dpdd6c4d43b78a99aa@mail.gmail.com>	
	<49B7BB1C.8090204@lshift.net>	
	<d272f0690903112242l648a5506tb2335a5de5162913@mail.gmail.com>	
	<49B8CE1C.3020901@lshift.net>	
	<d272f0690903121639l33e6f7e2j7da88d911f620b3e@mail.gmail.com>	
	<49BA5FE6.8070106@lshift.net>	
	<d272f0690903131903r46d57f33p28a8191266232c51@mail.gmail.com>	
	<49BC8719.2060901@cohesiveft.com>
	<d272f0690903161144u407eeb29me644f97bc7a26bed@mail.gmail.com>
Message-ID: <49BEBEC0.7000206@cohesiveft.com>



> 
> My inclination is to avoid making this a client side
> concern - it seems more complicated to try to juggle all the (coming and going)
> Rabbit cluster IPs, and try to pass this info to my clients in some ad hoc way -
> but I'm not exactly sure... any opinion on this?
> 
> The /etc/hosts solution sounds better, but you say "it might work", is there
> anyone using this solution with success?  I get the feeling from other mailing
> list posts that I should try to avoid using "known_hosts".
> 
>> Also, here is a link to a potentially related thread:
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-September/001901.html
> Yes, thanks, I saw that before.  In it you say "...the best approach
> is not to rely on known_hosts at all...",
> do you still hold this to be true?

In general case, yes, I still believe that known_hosts mechanism as described in AMQP 0-8 
will not make it easy for you to run some clients from inside NAT and some clients from 
outside NAT at the same time and rely on known_hosts field of redirect method.

However, EC2 has one property that can help. Public DNS names (ec2*.amazonaws.com) resolve 
  to a public IP outside of EC2 and to a private IP inside EC2. If you manage to convince 
each broker that its cluster peers are ec2*.amazonaws.com, it's the name broker will put 
in known_hosts field (I would hope).

You can first try to use public DNS names when setting up a cluster and see if it forces 
rabbit to use public DNS names in known_hosts.

If that doesn't work, by associating public DNS name with an internal IP in /etc/hosts, 
you force OS to return ec2*amazonaws.com name for a 10.X.X.X lookup. This will override 
EC2 internal DNS, which associates 10.X.X.X with *.internal. I said it *might* work 
because it depends on the order in which various naming services are tried by your OS - 
usually /etc/hosts is tried before DNS, but this is not a rule.

You may need to restart nscd and wait a bit or even reboot. Use "getent hosts 10.X.X.X" to 
see which name your OS currently returns for a given IP.

Please note that I have not had a chance to try either of these myself.


HTH,
Dmitriy



From matthias at lshift.net  Mon Mar 16 22:06:32 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 16 Mar 2009 22:06:32 +0000
Subject: [rabbitmq-discuss] max amount of persisted data
In-Reply-To: <84fb38e30903160853j7f35c172q6515236ed57aaac1@mail.gmail.com>
References: <84fb38e30903160853j7f35c172q6515236ed57aaac1@mail.gmail.com>
Message-ID: <49BECD68.9050502@lshift.net>

Tsuraan,

tsuraan wrote:
> How exactly does Rabbit use mnesia?  Does it persist messages to a
> simple disc_copy table that can only hold 4GB of data, or does it use
> fragmented tables or local_content tables?

Mnesia is only used for storing routing and configuration data. Messages 
are persisted to a disk_log in a snapshot+delta format.

> I'm basically wondering whether stock Rabbit can handle more than 4GB
> of persisted data

Yes, but with some important caveats:

- All persisted data is currently also held in memory and hence bounded 
by that.

- In some scenarios RabbitMQ will end up spending most of its time 
writing new snapshots. That's because the time it takes to write a 
snapshot is proportional to the amount of persisted data, and snapshots 
are written every 500 entries (i.e. publishes, deliveries, acks) by default.


The plans we have for disk-based queues remove these limitations.



Matthias.



From tsuraan at gmail.com  Tue Mar 17 03:41:19 2009
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 16 Mar 2009 22:41:19 -0500
Subject: [rabbitmq-discuss] max amount of persisted data
In-Reply-To: <49BECD68.9050502@lshift.net>
References: <84fb38e30903160853j7f35c172q6515236ed57aaac1@mail.gmail.com>
	<49BECD68.9050502@lshift.net>
Message-ID: <84fb38e30903162041h42262268qa1bf2c40c38445b3@mail.gmail.com>

> Mnesia is only used for storing routing and configuration data. Messages
> are persisted to a disk_log in a snapshot+delta format.

Ok, makes sense.

> Yes, but with some important caveats:
>
> - All persisted data is currently also held in memory and hence bounded
> by that.
...
> The plans we have for disk-based queues remove these limitations.

Would replacing the queue currently used for unacked_message_q in
rabbit_channel.erl with a queue that overflows to a tempfile be
sufficient to resolve this?  I have a (minimally tested) queue that
does that.  I guess the calls to queue:to_list would have to be
replaced with something fold-based or it would defeat the purpose of
the whole thing, but is that basically what needs to be done?



From matthias at lshift.net  Tue Mar 17 08:10:52 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 17 Mar 2009 08:10:52 +0000
Subject: [rabbitmq-discuss] max amount of persisted data
In-Reply-To: <84fb38e30903162041h42262268qa1bf2c40c38445b3@mail.gmail.com>
References: <84fb38e30903160853j7f35c172q6515236ed57aaac1@mail.gmail.com>	<49BECD68.9050502@lshift.net>
	<84fb38e30903162041h42262268qa1bf2c40c38445b3@mail.gmail.com>
Message-ID: <49BF5B0C.3000309@lshift.net>

Tsuraan,

tsuraan wrote:
> Would replacing the queue currently used for unacked_message_q in
> rabbit_channel.erl with a queue that overflows to a tempfile be
> sufficient to resolve this?

The short answer is 'no'.

I don't really want to go into the details of the proposed disk-based 
queue design, and the rationales behind it. Firstly, we haven't worked 
it all out yet. Secondly, the explanation would fill several pages and 
take a few hours to write - it's a fairly complex piece of work.


Matthias.



From matthias at lshift.net  Tue Mar 17 08:15:36 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 17 Mar 2009 08:15:36 +0000
Subject: [rabbitmq-discuss] RabbitMQ Cluster,
 option "-setcookie cookie" + EC2 experiences
In-Reply-To: <49BEBEC0.7000206@cohesiveft.com>
References: <d272f0690903101436i67e5d81dpdd6c4d43b78a99aa@mail.gmail.com>		<49B7BB1C.8090204@lshift.net>		<d272f0690903112242l648a5506tb2335a5de5162913@mail.gmail.com>		<49B8CE1C.3020901@lshift.net>		<d272f0690903121639l33e6f7e2j7da88d911f620b3e@mail.gmail.com>		<49BA5FE6.8070106@lshift.net>		<d272f0690903131903r46d57f33p28a8191266232c51@mail.gmail.com>		<49BC8719.2060901@cohesiveft.com>	<d272f0690903161144u407eeb29me644f97bc7a26bed@mail.gmail.com>
	<49BEBEC0.7000206@cohesiveft.com>
Message-ID: <49BF5C28.5020006@lshift.net>

Dmitriy Samovskiy wrote:
> described in AMQP 0-8 will not make it easy for you to run some clients 
> from inside NAT and some clients from outside NAT at the same time and 
> rely on known_hosts field of redirect method.

Just to add to that, the whole known_host/redirect mechanism has been 
removed from AMQP 0-9-1 since it was underspecified and a half-hearted 
attempt at addressing a problem for which there already are established 
solutions such as load balancers and round-robin DNS.


Matthias.



From tonyg at lshift.net  Tue Mar 17 11:04:30 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 17 Mar 2009 11:04:30 +0000
Subject: [rabbitmq-discuss] max amount of persisted data
In-Reply-To: <49BF5B0C.3000309@lshift.net>
References: <84fb38e30903160853j7f35c172q6515236ed57aaac1@mail.gmail.com>	<49BECD68.9050502@lshift.net>	<84fb38e30903162041h42262268qa1bf2c40c38445b3@mail.gmail.com>
	<49BF5B0C.3000309@lshift.net>
Message-ID: <49BF83BE.8050100@lshift.net>

Matthias Radestock wrote:
> tsuraan wrote:
>> Would replacing the queue currently used for unacked_message_q in
>> rabbit_channel.erl with a queue that overflows to a tempfile be
>> sufficient to resolve this?
> 
> The short answer is 'no'.

:-) Or, seen another way, "yes". It's a start. It'd work for when
non-persistent messages were being sent through the broker. We already
have experimental code doing most of this, similar I suppose to the code
you have -- but it's not ready even for experimentation at the moment.

The full solution needs to carefully balance three interacting components:

 - persistent storage of messages
 - the memory needs of the queue-data-structure of messages in each
   AMQP-queue
 - TX-class transactions


Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Tue Mar 17 11:05:19 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 17 Mar 2009 11:05:19 +0000
Subject: [rabbitmq-discuss] Newbie q - stateful protocol
In-Reply-To: <e6e848df0903160703w169ef846o475186f839c93917@mail.gmail.com>
References: <e6e848df0903160703w169ef846o475186f839c93917@mail.gmail.com>
Message-ID: <49BF83EF.1050802@lshift.net>

Hi Luis,

Luis Da Silva wrote:
> Is it possible to implement stateful protocols using RabbitMQ (routing,
> memory shared between states,...)?

I'm not sure what you mean here. Are you talking about state
synchronisation between applications -- a form of
replication/object-caching?

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Tue Mar 17 11:11:15 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 17 Mar 2009 11:11:15 +0000
Subject: [rabbitmq-discuss] Ack semantics in RabbitMQ
In-Reply-To: <5f884b720903150255r5df61441lee9b0788c6d5d4a0@mail.gmail.com>
References: <5f884b720903120928i3fd0445dnbac071a117eccfa7@mail.gmail.com>	<49BA5091.4030806@lshift.net>
	<5f884b720903150255r5df61441lee9b0788c6d5d4a0@mail.gmail.com>
Message-ID: <49BF8553.8090502@lshift.net>

Eran Sandler wrote:
> Regarding the blocking "GET" commands, I read about Kesterl (in the link
> I gave below) and thought its an interesting approach to make pulling a
> bit more efficient instead of sending the "puller" back to a short sleep.

Another approach is to set the prefetch window to 1, and start a
consumer. If you really did only want a single message, you can cancel
the consumer before acking the message. Otherwise, when you ack it, the
server will send you the next waiting message if there is one.

  --> BASIC.QOS{ prefetch_count = 1 }
  --> BASIC.CONSUME
  <-- BASIC.CONSUME-OK
  ... wait for a message to arrive ...
  <-- BASIC.DELIVER
  --> BASIC.CANCEL
  <-- BASIC.CANCEL-OK
  ... processing of message ...
  --> BASIC.ACK

versus

  --> BASIC.QOS{ prefetch_count = 1 }
  --> BASIC.CONSUME
  <-- BASIC.CONSUME-OK
  ... wait for a message to arrive ...
  <-- BASIC.DELIVER
  ... processing of message ...
  --> BASIC.ACK
  ... wait for a message to arrive ...
  <-- BASIC.DELIVER
  ... processing of message ...
  --> BASIC.ACK
  ...

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Tue Mar 17 11:13:30 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 17 Mar 2009 11:13:30 +0000
Subject: [rabbitmq-discuss] Batch files are awful (was Re: win 2008 64bit)
In-Reply-To: <002001c9a339$e185b770$a4912650$@Norkaitis@oryo.lt>
References: <-672053394664793056@unknownmsgid>	<5f884b720903120919o2b4cffd3l52a528f6358eca25@mail.gmail.com>
	<002001c9a339$e185b770$a4912650$@Norkaitis@oryo.lt>
Message-ID: <49BF85DA.8040704@lshift.net>

Andrius Norkaitis wrote:
> It would be great if someone better ?bat? guru than me could tell how to
> do this easier. Seems that rabbit isn?t used heavily on production
> windows servers J and there is not detail manual about this.

Batch files are horrible, horrible things, worse even than Unix shell. :-(

Any volunteers for doing the work of changing over to using WSH instead
of batch files to automate Rabbit on Windows?

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Tue Mar 17 11:20:37 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 17 Mar 2009 11:20:37 +0000
Subject: [rabbitmq-discuss] Cluster Pathology
In-Reply-To: <3b949f090902171014k76f1f140t7c99e53556e0baf4@mail.gmail.com>
References: <3b949f090902091229r372a78ci84ed70b5fa5f2b68@mail.gmail.com>	
	<49922C3C.7040004@cohesiveft.com>	
	<3b949f090902101754n14babf88o88e6bacc875501ca@mail.gmail.com>	
	<4992FD65.9040105@cohesiveft.com>	
	<3b949f090902110850sa5a081fx8df758289423bfa1@mail.gmail.com>	
	<499AC3E6.4090901@lshift.net>
	<3b949f090902171014k76f1f140t7c99e53556e0baf4@mail.gmail.com>
Message-ID: <49BF8785.1040005@lshift.net>

Jason J. W. Williams wrote:
> That's pretty exciting. :-) What would be the difference between a
> pluggable and distributed queue?

By "pluggable queue" I mean that the implementation for actually storing
messages before forwarding them can be varied. Currently there's just
the one implementation baked into the system.

By "distributed queue" I mean that one of the (pluggable) options for
storing and transacting messages could be to replicate the queue across
more than a single node -- perhaps using a mnesia table, perhaps using a
SQL data base, perhaps using something else.

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From luis.dasilva007 at gmail.com  Tue Mar 17 11:54:13 2009
From: luis.dasilva007 at gmail.com (Luis Da Silva)
Date: Tue, 17 Mar 2009 08:54:13 -0300
Subject: [rabbitmq-discuss] Newbie q - stateful protocol
In-Reply-To: <49BF83EF.1050802@lshift.net>
References: <e6e848df0903160703w169ef846o475186f839c93917@mail.gmail.com>
	<49BF83EF.1050802@lshift.net>
Message-ID: <e6e848df0903170454j2b7aad4n2c358c98899b40a5@mail.gmail.com>

Hi Tony,

Let me explain it better.
I have to handle requests to TCP/IP servers using different protocols
(stateful), the idea is to use a common pool of workers (consumers) to where
distribute those requests for further processing. Each consumer process
(finite state machine session) should handle all the subsequent
communication for the request received until coming back to idle state
(consumer released).

As far as I understand, RabbitMQ can act as the pool to distribute and route
messages to the right consumer process. Can this be handled by RabbitMQ? Any
example to share?

thanks,
Luis


So RabbitMQ


2009/3/17 Tony Garnock-Jones <tonyg at lshift.net>eful

> Hi Luis,
>
> Luis Da Silva wrote:
> > Is it possible to implement stateful protocols using RabbitMQ (routing,
> > memory shared between states,...)?
>
> I'm not sure what you mean here. Are you talking about state
> synchronisation between applications -- a form of
> replication/object-caching?
>
> Regards,
>  Tony
> --
>  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090317/a4480c6b/attachment.htm 

From matthias at lshift.net  Tue Mar 17 12:05:40 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 17 Mar 2009 12:05:40 +0000
Subject: [rabbitmq-discuss] max amount of persisted data
In-Reply-To: <49BF83BE.8050100@lshift.net>
References: <84fb38e30903160853j7f35c172q6515236ed57aaac1@mail.gmail.com>	<49BECD68.9050502@lshift.net>	<84fb38e30903162041h42262268qa1bf2c40c38445b3@mail.gmail.com>	<49BF5B0C.3000309@lshift.net>
	<49BF83BE.8050100@lshift.net>
Message-ID: <49BF9214.1080402@lshift.net>

Tsuraan,

Tony Garnock-Jones wrote:
> Matthias Radestock wrote:
>> tsuraan wrote:
>>> Would replacing the queue currently used for unacked_message_q in
>>> rabbit_channel.erl with a queue that overflows to a tempfile be
>>> sufficient to resolve this?
>> The short answer is 'no'.
> 
> :-) Or, seen another way, "yes". It's a start. It'd work for when
> non-persistent messages were being sent through the broker.

No, it won't. My original answer is correct. unacked_message_q in 
rabbit_channel keeps track of the ids of messages that have been sent to 
consumers but have not been ack'ed yet. It does not hold undelivered 
messages and it does not hold message content. That all happens in 
rabbit_amqqueue_process' #q.q field (which I reckon Tony thought you 
were talking about), and rabbit_persister's #psnapshot.queues field (for 
persistent messages).

> The full solution needs to carefully balance three interacting components:
> 
>  - persistent storage of messages
>  - the memory needs of the queue-data-structure of messages in each
>    AMQP-queue
>  - TX-class transactions

+ fanout (not keeping multiple copies of messages)
+ clustering (which affects decisions on where messages should be 
persisted, and how recovery works)
+ non-linear access (for priorities and message expiry)
+ a few other things we will no doubt discover


Matthias.



From tsuraan at gmail.com  Tue Mar 17 16:00:21 2009
From: tsuraan at gmail.com (tsuraan)
Date: Tue, 17 Mar 2009 11:00:21 -0500
Subject: [rabbitmq-discuss] max amount of persisted data
In-Reply-To: <49BECD68.9050502@lshift.net>
References: <84fb38e30903160853j7f35c172q6515236ed57aaac1@mail.gmail.com>
	<49BECD68.9050502@lshift.net>
Message-ID: <84fb38e30903170900w21eaaa0dtf966c2e91c371475@mail.gmail.com>

> Mnesia is only used for storing routing and configuration data. Messages
> are persisted to a disk_log in a snapshot+delta format.

Along that line, can hot standby rabbits be made by rsync'ing the
/var/lib/rabbitmw/mnesia directory to another machine?  To rephrase
the question, is the data on disk always valid, or at least
recoverable?  Obviously any work done between the snapshot and the
machine failure would be lost, but would the on-disk data be usable?



From eran.sandler at gmail.com  Tue Mar 17 19:21:38 2009
From: eran.sandler at gmail.com (Eran Sandler)
Date: Tue, 17 Mar 2009 21:21:38 +0200
Subject: [rabbitmq-discuss] Ack semantics in RabbitMQ
In-Reply-To: <49BF8553.8090502@lshift.net>
References: <5f884b720903120928i3fd0445dnbac071a117eccfa7@mail.gmail.com>
	<49BA5091.4030806@lshift.net>
	<5f884b720903150255r5df61441lee9b0788c6d5d4a0@mail.gmail.com>
	<49BF8553.8090502@lshift.net>
Message-ID: <5f884b720903171221i31d1204fn21d56bad985d10c7@mail.gmail.com>

Thanks Tony.

This looks like an interesting semantics for this.

Eran

On Tue, Mar 17, 2009 at 1:11 PM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> Eran Sandler wrote:
> > Regarding the blocking "GET" commands, I read about Kesterl (in the link
> > I gave below) and thought its an interesting approach to make pulling a
> > bit more efficient instead of sending the "puller" back to a short sleep.
>
> Another approach is to set the prefetch window to 1, and start a
> consumer. If you really did only want a single message, you can cancel
> the consumer before acking the message. Otherwise, when you ack it, the
> server will send you the next waiting message if there is one.
>
>  --> BASIC.QOS{ prefetch_count = 1 }
>  --> BASIC.CONSUME
>  <-- BASIC.CONSUME-OK
>  ... wait for a message to arrive ...
>  <-- BASIC.DELIVER
>  --> BASIC.CANCEL
>  <-- BASIC.CANCEL-OK
>  ... processing of message ...
>  --> BASIC.ACK
>
> versus
>
>  --> BASIC.QOS{ prefetch_count = 1 }
>  --> BASIC.CONSUME
>  <-- BASIC.CONSUME-OK
>  ... wait for a message to arrive ...
>  <-- BASIC.DELIVER
>  ... processing of message ...
>  --> BASIC.ACK
>  ... wait for a message to arrive ...
>  <-- BASIC.DELIVER
>  ... processing of message ...
>  --> BASIC.ACK
>  ...
>
> Regards,
>  Tony
> --
>  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090317/7bc84d40/attachment.htm 

From matthias at lshift.net  Wed Mar 18 07:52:05 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 18 Mar 2009 07:52:05 +0000
Subject: [rabbitmq-discuss] max amount of persisted data
In-Reply-To: <49BF9214.1080402@lshift.net>
References: <84fb38e30903160853j7f35c172q6515236ed57aaac1@mail.gmail.com>	<49BECD68.9050502@lshift.net>	<84fb38e30903162041h42262268qa1bf2c40c38445b3@mail.gmail.com>	<49BF5B0C.3000309@lshift.net>
	<49BF83BE.8050100@lshift.net> <49BF9214.1080402@lshift.net>
Message-ID: <49C0A825.4050700@lshift.net>

Matthias Radestock wrote:
> unacked_message_q in rabbit_channel keeps track of the ids of
> messages that have been sent to consumers but have not been ack'ed
> yet. It does not hold undelivered messages and it does not hold
> message content. That all happens in rabbit_amqqueue_process' #q.q
> field (which I reckon Tony thought you were talking about), and
> rabbit_persister's #psnapshot.queues field (for persistent messages).

Just to correct some minor inaccuracies in the above ...

- rabbit_channel's unacked_message_q does in fact hold message content, 
not just ids. But, as stated above, the messages are only those that 
have been sent to consumers and not yet acknowledged. So generally that 
should just be a few messages.

- The field in rabbit_amqqueue_process' #q state which contains the 
message queue is called 'message_buffer', not 'q'.

tsuraan wrote:
> can hot standby rabbits be made by rsync'ing the
> /var/lib/rabbitmw/mnesia directory to another machine?  To rephrase
> the question, is the data on disk always valid, or at least
> recoverable?  Obviously any work done between the snapshot and the
> machine failure would be lost, but would the on-disk data be usable?

There have been some discussions on the list about using a SAN to hold 
the /var/lib/rabbitmq/mnesia dir. Generally that (and the rsync 
technique you suggest) should work, and the data should be recoverable.

An important constraint is that the Erlang node name must remain 
unchanged, i.e. you must not use one node's /var/lib/rabbitmq/mnesia dir 
on a node with a different name.


Matthias.



From riteshrathi at gmail.com  Wed Mar 18 11:52:10 2009
From: riteshrathi at gmail.com (rathi)
Date: Wed, 18 Mar 2009 17:22:10 +0530
Subject: [rabbitmq-discuss] Broker data
Message-ID: <d31e757a0903180452o3b6af195l26e946c92a3ff85b@mail.gmail.com>

Is it possible to get broker's data like number of queues & exchanges,
bindings between them and some meta-data which I would like to associate
with the queue from java client. Something similar to the information which
rabbitmqctl gives. In cluster scenario is it be possible to know which node
created the queue.

thanks & regards,
rathi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090318/1cd29894/attachment.htm 

From clemesha at gmail.com  Wed Mar 18 22:24:09 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Wed, 18 Mar 2009 15:24:09 -0700
Subject: [rabbitmq-discuss] txAMQP with RabbitMQ Cluster
Message-ID: <d272f0690903181524t67d0daecwe2fbb8e4bbdf3b7f@mail.gmail.com>

Hi,

Can anyone who is using txAMQP (or the author, hi Esteve!) answer a
couple of client related questions?

So, I'm working with the RabbitMQ Cluster, and I'm hitting a couple of
issues.  These issue may still
be arising from my setup of the brokers, but I feel that most likely I
may be having client issues and/or using them wrong.
(I do want to point out that we have been using txAMQP a lot, with
great success, on the project I'm working on,
the Ocean Observatories Initiative (OOI), see here [1])


First, does txAMQP support the "insist" flag?
With py-amqplib, I can do:
conn = amqp.Connection(host="localhost:5672 ", userid="guest",
password="guest", virtual_host="/", insist=True),
can the same be done with txAMPQ?  I've search around + looked in the
source, and haven't found how to yet.


Secondly, and this is where I'm a bit more lost (i.e, the problem may
or may not lie in the client),
can txAMQP handle redirects from brokers?
Here is my situation: I have a Rabbit cluster going on ec2 (see this
thread [2]), and
right now I'm only connecting to the Cluster from another ec2 instance
in the same Availability Zone (LAN).

The interesting behavior is this: producing and consuming through the
Cluster node that I performed the
"rabbitmqctl {stop_app, reset, cluster nodeA nodeB, start_app}" on
*works*.  Trying to connect to the *other*
cluster node results (in /var/log/rabbitmq/rabbit.log) *redirect*
messages like so:

=INFO REPORT==== 18-Mar-2009::21:15:49 ===
connection <0.804.0> redirecting to
<<"domU-12-31-39-00-A1-E3.compute-1.internal:5672">>

and at this point my txAMQP producer client just "hangs", i.e. it does
not successfully send its message.


Any pointers / words of wisdom / tests to try?
Thanks!
-Alex


[1] http://www.oceanobservatories.org/spaces/display/CIDev/Home
[2] http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-March/003534.html




-- 
Alex Clemesha
clemesha.org



From terry at jon.es  Wed Mar 18 22:39:39 2009
From: terry at jon.es (Terry Jones)
Date: Wed, 18 Mar 2009 23:39:39 +0100
Subject: [rabbitmq-discuss] txAMQP with RabbitMQ Cluster
In-Reply-To: Your message at 15:24:09 on Wednesday, 18 March 2009
References: <d272f0690903181524t67d0daecwe2fbb8e4bbdf3b7f@mail.gmail.com>
Message-ID: <18881.30763.531109.411654@jon.es>

>>>>> "Alex" == Alex Clemesha <clemesha at gmail.com> writes:

Hi Alex

With respect to your second issue:

Alex> Secondly, and this is where I'm a bit more lost (i.e, the problem may
Alex> or may not lie in the client), can txAMQP handle redirects from
Alex> brokers?  Here is my situation: I have a Rabbit cluster going on ec2
Alex> (see this thread [2]), and right now I'm only connecting to the
Alex> Cluster from another ec2 instance in the same Availability Zone
Alex> (LAN).

Alex> The interesting behavior is this: producing and consuming through the
Alex> Cluster node that I performed the "rabbitmqctl {stop_app, reset,
Alex> cluster nodeA nodeB, start_app}" on *works*.  Trying to connect to
Alex> the *other* cluster node results (in /var/log/rabbitmq/rabbit.log)
Alex> *redirect* messages like so:

Alex> =INFO REPORT==== 18-Mar-2009::21:15:49 ===
Alex> connection <0.804.0> redirecting to
Alex> <<"domU-12-31-39-00-A1-E3.compute-1.internal:5672">>

Alex> and at this point my txAMQP producer client just "hangs", i.e. it
Alex> does not successfully send its message.

Is your client using the internal IP address of the broker server? I.e.,
the one you fetch as the private DNS entry from
http://169.254.169.254/user-data when the instance starts up.

Terry



From clemesha at gmail.com  Wed Mar 18 22:56:37 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Wed, 18 Mar 2009 15:56:37 -0700
Subject: [rabbitmq-discuss] txAMQP with RabbitMQ Cluster
In-Reply-To: <18881.30763.531109.411654@jon.es>
References: <d272f0690903181524t67d0daecwe2fbb8e4bbdf3b7f@mail.gmail.com>
	<18881.30763.531109.411654@jon.es>
Message-ID: <d272f0690903181556j368a3ff0g1f9abbc58470a5e@mail.gmail.com>

On Wed, Mar 18, 2009 at 3:39 PM, Terry Jones <terry at jon.es> wrote:
>>>>>> "Alex" == Alex Clemesha <clemesha at gmail.com> writes:
>
> Hi Alex
>
> With respect to your second issue:
>
> Alex> Secondly, and this is where I'm a bit more lost (i.e, the problem may
> Alex> or may not lie in the client), can txAMQP handle redirects from
> Alex> brokers? ?Here is my situation: I have a Rabbit cluster going on ec2
> Alex> (see this thread [2]), and right now I'm only connecting to the
> Alex> Cluster from another ec2 instance in the same Availability Zone
> Alex> (LAN).
>
> Alex> The interesting behavior is this: producing and consuming through the
> Alex> Cluster node that I performed the "rabbitmqctl {stop_app, reset,
> Alex> cluster nodeA nodeB, start_app}" on *works*. ?Trying to connect to
> Alex> the *other* cluster node results (in /var/log/rabbitmq/rabbit.log)
> Alex> *redirect* messages like so:
>
> Alex> =INFO REPORT==== 18-Mar-2009::21:15:49 ===
> Alex> connection <0.804.0> redirecting to
> Alex> <<"domU-12-31-39-00-A1-E3.compute-1.internal:5672">>
>
> Alex> and at this point my txAMQP producer client just "hangs", i.e. it
> Alex> does not successfully send its message.
>
> Is your client using the internal IP address of the broker server? I.e.,
> the one you fetch as the private DNS entry from
> http://169.254.169.254/user-data when the instance starts up.
Yes, it is. Right now I'm restricting my tests to the availability
zone "us-east-1a",
so they all have the form: domU-***.internal.


thanks,
Alex

>
> Terry
>



-- 
Alex Clemesha
clemesha.org



From opendev at gmail.com  Thu Mar 19 08:57:54 2009
From: opendev at gmail.com (Joern)
Date: Thu, 19 Mar 2009 09:57:54 +0100
Subject: [rabbitmq-discuss] Broker data
In-Reply-To: <d31e757a0903180452o3b6af195l26e946c92a3ff85b@mail.gmail.com>
References: <d31e757a0903180452o3b6af195l26e946c92a3ff85b@mail.gmail.com>
Message-ID: <9e009ad0903190157m1a0cf884nb6e60f63bf8eb8cb@mail.gmail.com>

Hi Rathi,

2009/3/18 rathi <riteshrathi at gmail.com>:

> Is it possible to get broker's data like number of queues & exchanges,
> bindings between them and some meta-data which I would like to associate
> with the queue from java client. Something similar to the information which
> rabbitmqctl gives.

Why don't you parse the information given by rabbitmqctl and expose
that to AMQP?

Best regards,


Joern
--



From tonyg at lshift.net  Thu Mar 19 11:25:40 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 19 Mar 2009 11:25:40 +0000
Subject: [rabbitmq-discuss] max amount of persisted data
In-Reply-To: <49BF9214.1080402@lshift.net>
References: <84fb38e30903160853j7f35c172q6515236ed57aaac1@mail.gmail.com>	<49BECD68.9050502@lshift.net>	<84fb38e30903162041h42262268qa1bf2c40c38445b3@mail.gmail.com>	<49BF5B0C.3000309@lshift.net>
	<49BF83BE.8050100@lshift.net> <49BF9214.1080402@lshift.net>
Message-ID: <49C22BB4.9090300@lshift.net>

Matthias Radestock wrote:
> No, it won't. My original answer is correct.

Oops :-)

Tony




From aymerick at fotonauts.com  Thu Mar 19 12:39:15 2009
From: aymerick at fotonauts.com (=?ISO-8859-1?Q?Aymerick_J=E9hanne?=)
Date: Thu, 19 Mar 2009 13:39:15 +0100
Subject: [rabbitmq-discuss] RabbitMQ startup time with durable queues
Message-ID: <9DB0FA5E-C542-4D6D-9668-0A167EAB3578@fotonauts.com>

Hi,

I'm beaten by rabbitmq's startup time with a lot of durable queues.

Actually, I have more than 5500 durable queues, with almost 10  
bindings by queues. And I simply can't restart rabbitmq at all, I have  
to delete its mnesia directory then recreate all queues and bindings.

So I have done some tests to measure the startup time.

Script to test is here: http://gist.github.com/81789

My results are here: http://tinyurl.com/cne7fj

So it takes one hour to start rabbitmq with 6000 (empty) durable  
queues. I can't wait that time... so as I said I reset mnesia  
directory at each restart, with data loss if there were still some  
messages in the queues before the restart.

Do you guys have an idea of what's the issue ?

Aymerick



From matthias at lshift.net  Thu Mar 19 14:48:24 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 19 Mar 2009 14:48:24 +0000
Subject: [rabbitmq-discuss] RabbitMQ startup time with durable queues
In-Reply-To: <9DB0FA5E-C542-4D6D-9668-0A167EAB3578@fotonauts.com>
References: <9DB0FA5E-C542-4D6D-9668-0A167EAB3578@fotonauts.com>
Message-ID: <49C25B38.6090503@lshift.net>

Aymerick,

Aymerick J?hanne wrote:
> So it takes one hour to start rabbitmq with 6000 (empty) durable  
> queues.

Well spotted. I am working on a fix.


Matthias.



From Robert.Elsner at echostar.com  Thu Mar 19 14:52:23 2009
From: Robert.Elsner at echostar.com (Elsner, Robert)
Date: Thu, 19 Mar 2009 08:52:23 -0600
Subject: [rabbitmq-discuss] RabbitMQ startup time with durable queues
In-Reply-To: <49C25B38.6090503@lshift.net>
References: <9DB0FA5E-C542-4D6D-9668-0A167EAB3578@fotonauts.com>
	<49C25B38.6090503@lshift.net>
Message-ID: <D4C5E348C434294AA040A57B0D3DF5ED02EA7D5C@MER2-EXCHB1.echostar.com>

Matthias,

Is this related to corruption of dets tables?

Rob

> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com 
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On 
> Behalf Of Matthias Radestock
> Sent: Thursday, March 19, 2009 8:48 AM
> To: Aymerick J?hanne
> Cc: RabbitMQ Discuss
> Subject: Re: [rabbitmq-discuss] RabbitMQ startup time with 
> durable queues
> 
> Aymerick,
> 
> Aymerick J?hanne wrote:
> > So it takes one hour to start rabbitmq with 6000 (empty) durable 
> > queues.
> 
> Well spotted. I am working on a fix.
> 
> 
> Matthias.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 



From matthias at lshift.net  Thu Mar 19 14:58:49 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 19 Mar 2009 14:58:49 +0000
Subject: [rabbitmq-discuss] RabbitMQ startup time with durable queues
In-Reply-To: <D4C5E348C434294AA040A57B0D3DF5ED02EA7D5C@MER2-EXCHB1.echostar.com>
References: <9DB0FA5E-C542-4D6D-9668-0A167EAB3578@fotonauts.com>	<49C25B38.6090503@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA7D5C@MER2-EXCHB1.echostar.com>
Message-ID: <49C25DA9.507@lshift.net>

Robert,

Elsner, Robert wrote:
> Is this related to corruption of dets tables?

No.


Matthias.



From matthias at lshift.net  Thu Mar 19 18:19:31 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 19 Mar 2009 18:19:31 +0000
Subject: [rabbitmq-discuss] RabbitMQ startup time with durable queues
In-Reply-To: <49C25B38.6090503@lshift.net>
References: <9DB0FA5E-C542-4D6D-9668-0A167EAB3578@fotonauts.com>
	<49C25B38.6090503@lshift.net>
Message-ID: <49C28CB3.9020908@lshift.net>

Aymerick,

Matthias Radestock wrote:
> Aymerick J?hanne wrote:
>> So it takes one hour to start rabbitmq with 6000 (empty) durable  
>> queues.
> 
> Well spotted. I am working on a fix.

I have committed a fix on the 'bug20500' branch in the rabbitmq-server 
hg repo. The fix hasn't been qa'ed yet, but feel free to give it a spin 
if you are feeling adventurous.


Matthias.



From esteve at sindominio.net  Thu Mar 19 19:42:47 2009
From: esteve at sindominio.net (Esteve Fernandez)
Date: Thu, 19 Mar 2009 20:42:47 +0100
Subject: [rabbitmq-discuss] txAMQP with RabbitMQ Cluster
In-Reply-To: <d272f0690903181524t67d0daecwe2fbb8e4bbdf3b7f@mail.gmail.com>
References: <d272f0690903181524t67d0daecwe2fbb8e4bbdf3b7f@mail.gmail.com>
Message-ID: <200903192042.47881.esteve@sindominio.net>

On Wednesday 18 March 2009 23:24:09 Alex Clemesha wrote:
> Hi,
>
> Can anyone who is using txAMQP (or the author, hi Esteve!) answer a
> couple of client related questions?

Hi Alex :-)

> First, does txAMQP support the "insist" flag?
> With py-amqplib, I can do:
> conn = amqp.Connection(host="localhost:5672 ", userid="guest",
> password="guest", virtual_host="/", insist=True),
> can the same be done with txAMPQ?  I've search around + looked in the
> source, and haven't found how to yet.

It should, as long as you pass the standard AMQP spec. txAMQP generates all 
the AMQP structures on the fly, it reads the XML spec and creates the 
appropiate methods and classes thanks to Qpid, from which txAMQP is based 
off.

I've never used the insist option, but I think this should work:

@defer.inlineCallbacks
def func(client):
    channel0 = yield client.channel(0)
    response = yield channel0.connection_open(vhost="/", insist=True)

> Secondly, and this is where I'm a bit more lost (i.e, the problem may
> or may not lie in the client),
> can txAMQP handle redirects from brokers?

Not yet, but I think it wouldn't be very hard to implement it. Here's some 
pseudo untested python code:

@defer.inlineCallbacks
def func(client):
    channel0 = yield client.channel(0)
    response = yield channel0.connection_open(vhost="/", insist=True)
    if response == OPEN-OK: # I don't remember the actual fields for a 
response, sorry
        # do as usual
    elif response == "redirect":
        yield channel0.connection_close() # close the current connection
        reactor.connectTCP(host=response.host,...) # create a connection to 
another broker using the standard Twisted methods

Sorry for being so imprecise, I'll try to add more details tomorrow. In any 
case, let me know if you need anything else.

Cheers.



From clemesha at gmail.com  Fri Mar 20 06:51:43 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Thu, 19 Mar 2009 23:51:43 -0700
Subject: [rabbitmq-discuss] txAMQP with RabbitMQ Cluster
In-Reply-To: <200903192042.47881.esteve@sindominio.net>
References: <d272f0690903181524t67d0daecwe2fbb8e4bbdf3b7f@mail.gmail.com>
	<200903192042.47881.esteve@sindominio.net>
Message-ID: <d272f0690903192351i8dd990u50f2a1b66d800224@mail.gmail.com>

Hi,


>
> It should, as long as you pass the standard AMQP spec. txAMQP generates all
> the AMQP structures on the fly, it reads the XML spec and creates the
> appropiate methods and classes thanks to Qpid, from which txAMQP is based
> off.
>
> I've never used the insist option, but I think this should work:
>
> @defer.inlineCallbacks
> def func(client):
> ? ?channel0 = yield client.channel(0)
> ? ?response = yield channel0.connection_open(vhost="/", insist=True)
>
Yep, this works, thanks!

>> Secondly, and this is where I'm a bit more lost (i.e, the problem may
>> or may not lie in the client),
>> can txAMQP handle redirects from brokers?
>
> Not yet, but I think it wouldn't be very hard to implement it.
Thanks for the tips, with them we've be able to get pass this for right now.


The 'fixes' that I made to successfully move past the two above issues basically
came down to making some minor changes to the "start"  method of
"AMQClient" in "protocol.py".
The diff looks like this:

298c298
<     def start(self, response, mechanism='AMQPLAIN', locale='en_US',
insist=False):
---
>     def start(self, response, mechanism='AMQPLAIN', locale='en_US'):
306,308c306
<         response = yield channel0.connection_open(self.vhost, insist=insist)
<         defer.returnValue(response)
<
---
>         yield channel0.connection_open(self.vhost)


The changes are adding the "insist" flag and doing a
"defer.returnValue(response)"
such that I can inspect the "response.method.name" to see if I have a
redirect or not.
Then, at this point, it is an my application's concern to close the
current connection and
make a new connection to the redirect destination.

So, I'm wondering: 1) is there a cleaner way of doing this, 2) are the
modifications that I made
in the source in the right place, 3) should the redirect be a txAMQP
concern or an application
concern, 4) should I be sending you patches :-)


thanks very much!
-Alex










-- 
Alex Clemesha
clemesha.org



From riteshrathi at gmail.com  Sat Mar 21 15:24:16 2009
From: riteshrathi at gmail.com (rathi)
Date: Sat, 21 Mar 2009 20:54:16 +0530
Subject: [rabbitmq-discuss] Broker data
In-Reply-To: <9e009ad0903190157m1a0cf884nb6e60f63bf8eb8cb@mail.gmail.com>
References: <d31e757a0903180452o3b6af195l26e946c92a3ff85b@mail.gmail.com>
	<9e009ad0903190157m1a0cf884nb6e60f63bf8eb8cb@mail.gmail.com>
Message-ID: <d31e757a0903210824j3be5430frd68d178d3443fe72@mail.gmail.com>

I am trying to invoke rabbitmqctl using Jinterface. Then I am thinking of
parsing and getting the relevant data. Will this work ?

thanks & regards,
rathi

On Thu, Mar 19, 2009 at 2:27 PM, Joern <opendev at gmail.com> wrote:

> Hi Rathi,
>
> 2009/3/18 rathi <riteshrathi at gmail.com>:
>
> > Is it possible to get broker's data like number of queues & exchanges,
> > bindings between them and some meta-data which I would like to associate
> > with the queue from java client. Something similar to the information
> which
> > rabbitmqctl gives.
>
> Why don't you parse the information given by rabbitmqctl and expose
> that to AMQP?
>
> Best regards,
>
>
> Joern
> --
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090321/a8ccbedc/attachment.htm 

From jewel at subvert-the-dominant-paradigm.net  Mon Mar 23 09:58:03 2009
From: jewel at subvert-the-dominant-paradigm.net (John Leuner)
Date: Mon, 23 Mar 2009 11:58:03 +0200
Subject: [rabbitmq-discuss] Rabbit accepted into Debian unstable
Message-ID: <1237802283.22365.119.camel@cmalu.WAG54GS>

> rabbitmq-server_1.5.0-5_amd64.changes ACCEPTED

Rabbit has finally been accepted in Debian unstable.

Matthias, I think the only files that need to be updated are the
debian/control and debian/changelog files which I have attached.

Let me know when the 1.5.4 release is ready and I'll prepare the new
upload.

John


 
-------------- next part --------------
rabbitmq-server (1.5.0-5) unstable; urgency=low

  * Include the full license for amqp-0.8.json in debian/copyright

 -- John Leuner <jewel at debian.org>  Fri, 27 Feb 2009 16:16:54 +0200

rabbitmq-server (1.5.0-4) unstable; urgency=low

  * Clarify and explicitly list the license and copyright for
    codegen/amqp-0.8.json
	
  * Explicitly list the authors and copyright for the rest of the codebase
    at the top of debian/copyright
	
  * Clarify the copyright of the files in src/tcp_* . The rabbitmq authors have
    confirmed that they are the original authors of this code and that the
    files at http://code.google.com/p/cacherl/ were taken without their
    knowledge from the rabbitmq project. (Comparing the commit dates in version
    control shows that cacherl is newer)

 -- John Leuner <jewel at debian.org>  Wed, 25 Feb 2009 13:10:15 +0200

rabbitmq-server (1.5.0-3) unstable; urgency=low

  * Previous changelog entry had an incorrect Maintainer name

 -- John Leuner <jewel at debian.org>  Wed, 28 Jan 2009 16:45:33 +0200

rabbitmq-server (1.5.0-2) unstable; urgency=low

  * Reupload package to unstable. Mistakenly uploaded to testing last time, closes: #507902

 -- John Leuner <jewel at debian.org>  Mon, 19 Jan 2009 17:38:43 +0200

rabbitmq-server (1.5.0-1) testing; urgency=low

  * New Upstream Release
  * First Debian upload, closes: #507902

 -- John Leuner <jewel at debian.org>  Wed, 17 Dec 2008 18:23:47 +0000
-------------- next part --------------
Source: rabbitmq-server
Section: net
Priority: extra
Maintainer: John Leuner <jewel at debian.org>
Build-Depends: cdbs, debhelper (>= 5), erlang-nox, erlang-dev, python-simplejson
Standards-Version: 3.8.0

Package: rabbitmq-server
Architecture: all
Depends: erlang-nox, adduser, logrotate, ${misc:Depends}
Description: An AMQP server written in Erlang
 RabbitMQ is an implementation of AMQP, the emerging standard for high
 performance enterprise messaging. The RabbitMQ server is a robust and
 scalable implementation of an AMQP broker.
Homepage: http://www.rabbitmq.com/

From cpettitt at gmail.com  Mon Mar 23 18:45:55 2009
From: cpettitt at gmail.com (Chris Pettitt)
Date: Mon, 23 Mar 2009 11:45:55 -0700
Subject: [rabbitmq-discuss] Flow Control in RabbitMQ 1.5.3
Message-ID: <de47e4420903231145k6c16bffdoabd428d2270c06cb@mail.gmail.com>

Hello,

I've been performance/stress testing RabbitMQ in our perf lab. We've
found that we can consistently crash RabbitMQ's erlang node (running
on Solaris) when using 2 or more producers, which send messages as
fast as they can, with 2 or more consumers. The crashes occur during
memory allocation.

I found an article that talks about flow control in RabbitMQ 1.5.0
[1]. It doesn't seem to work in our 1.5.3 setup. When I start rabbit
from erl, I see that the memsup app is not started. I checked the
rabbitmq-server configuration and see "-os_mon start_memsup false".
I've tried setting start_memsup to true and I've also tried starting
memsup manually before calling rabbit:start(). Neither seems to cause
flow control information to be logged and both still result in the
erlang node crashing.

I very strongly suspect user error, but I'd appreciate some guidance
on how to enable this feature.


[1]: http://hopper.squarespace.com/blog/2008/11/9/flow-control-in-rabbitmq.html

Thanks,
Chris



From cpettitt at gmail.com  Mon Mar 23 19:31:25 2009
From: cpettitt at gmail.com (Chris Pettitt)
Date: Mon, 23 Mar 2009 12:31:25 -0700
Subject: [rabbitmq-discuss] Broker data
In-Reply-To: <d31e757a0903210824j3be5430frd68d178d3443fe72@mail.gmail.com>
References: <d31e757a0903180452o3b6af195l26e946c92a3ff85b@mail.gmail.com>
	<9e009ad0903190157m1a0cf884nb6e60f63bf8eb8cb@mail.gmail.com>
	<d31e757a0903210824j3be5430frd68d178d3443fe72@mail.gmail.com>
Message-ID: <de47e4420903231231k45febcday82e51f01d9a0442e@mail.gmail.com>

A few weeks back I was looking at using JInterface to create a JMX
interface for RabbitMQ. I still haven't had cycles to work on it, but
one of the immediate issues I saw was that I could not use
rabbitmq_control.erl (the actual module for rabbitmqctl) directly,
because it does not return the results, but instead prints them to
stdout. You can make the same RPC calls that rabbitmqctl does though
to get the results.

- Chris

2009/3/21 rathi <riteshrathi at gmail.com>:
> I am trying to invoke rabbitmqctl using Jinterface. Then I am thinking of
> parsing and getting the relevant data. Will this work ?
>
> thanks & regards,
> rathi
>
> On Thu, Mar 19, 2009 at 2:27 PM, Joern <opendev at gmail.com> wrote:
>>
>> Hi Rathi,
>>
>> 2009/3/18 rathi <riteshrathi at gmail.com>:
>>
>> > Is it possible to get broker's data like number of queues & exchanges,
>> > bindings between them and some meta-data which I would like to associate
>> > with the queue from java client. Something similar to the information
>> > which
>> > rabbitmqctl gives.
>>
>> Why don't you parse the information given by rabbitmqctl and expose
>> that to AMQP?
>>
>> Best regards,
>>
>>
>> Joern
>> --
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthias at lshift.net  Mon Mar 23 20:02:55 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 23 Mar 2009 20:02:55 +0000
Subject: [rabbitmq-discuss] Broker data
In-Reply-To: <de47e4420903231231k45febcday82e51f01d9a0442e@mail.gmail.com>
References: <d31e757a0903180452o3b6af195l26e946c92a3ff85b@mail.gmail.com>	<9e009ad0903190157m1a0cf884nb6e60f63bf8eb8cb@mail.gmail.com>	<d31e757a0903210824j3be5430frd68d178d3443fe72@mail.gmail.com>
	<de47e4420903231231k45febcday82e51f01d9a0442e@mail.gmail.com>
Message-ID: <49C7EAEF.4020801@lshift.net>

Chris,

Chris Pettitt wrote:
> A few weeks back I was looking at using JInterface to create a JMX
> interface for RabbitMQ. I still haven't had cycles to work on it, but
> one of the immediate issues I saw was that I could not use
> rabbitmq_control.erl (the actual module for rabbitmqctl) directly,
> because it does not return the results, but instead prints them to
> stdout. You can make the same RPC calls that rabbitmqctl does though
> to get the results.

rabbit_control.erl is just a thin wrapper around the internal APIs. It 
deals with option parsing and result presentation. So calling the 
internal APIs directly, as you suggest, is indeed the way to go if you 
want to expose the rabbit_control functionality programmatically.


Matthias




From matthias at lshift.net  Mon Mar 23 20:14:11 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 23 Mar 2009 20:14:11 +0000
Subject: [rabbitmq-discuss] Flow Control in RabbitMQ 1.5.3
In-Reply-To: <de47e4420903231145k6c16bffdoabd428d2270c06cb@mail.gmail.com>
References: <de47e4420903231145k6c16bffdoabd428d2270c06cb@mail.gmail.com>
Message-ID: <49C7ED93.6020600@lshift.net>

Chris,

Chris Pettitt wrote:
> I found an article that talks about flow control in RabbitMQ 1.5.0
> [1]. It doesn't seem to work in our 1.5.3 setup. When I start rabbit
> from erl, I see that the memsup app is not started. I checked the
> rabbitmq-server configuration and see "-os_mon start_memsup false".
> I've tried setting start_memsup to true and I've also tried starting
> memsup manually before calling rabbit:start(). Neither seems to cause
> flow control information to be logged and both still result in the
> erlang node crashing.
> 
> I very strongly suspect user error, but I'd appreciate some guidance
> on how to enable this feature.

See http://www.rabbitmq.com/admin-guide.html#memsup - you are supposed 
to be using "-rabbit memory_alarms true".  Enabling memsup the way you 
did should be ok too though as long the server isn't low on memory to 
start with and you wait at least a minute before stressing it. You may 
need to tweak the threshold. Also, we don't know whether memsup on 
Solaris is producing the right information, which is why rabbit leaves 
it turned off by default on that platform. So if you can do some 
testing/investigation that would be great.


Matthias.



From cpettitt at gmail.com  Mon Mar 23 21:31:18 2009
From: cpettitt at gmail.com (Chris Pettitt)
Date: Mon, 23 Mar 2009 14:31:18 -0700
Subject: [rabbitmq-discuss] Flow Control in RabbitMQ 1.5.3
In-Reply-To: <49C7ED93.6020600@lshift.net>
References: <de47e4420903231145k6c16bffdoabd428d2270c06cb@mail.gmail.com>
	<49C7ED93.6020600@lshift.net>
Message-ID: <de47e4420903231431n2f8b19acyf0ab2a3d968b74cb@mail.gmail.com>

Hi Matthias,

Thank you for the pointer. I should have looked more closely at the
documentation!

Cursory testing reveals that RabbitMQ is able to use flow control
without crashing with a high watermark of 0.7, while 0.75 or higher
results in the Erlang node crashing (before memsup detects the low
memory condition?). I'll follow up if I learn anything more about
memsup's behavior on Solaris.

Thanks,
Chris

On Mon, Mar 23, 2009 at 1:14 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Chris,
>
> Chris Pettitt wrote:
>>
>> I found an article that talks about flow control in RabbitMQ 1.5.0
>> [1]. It doesn't seem to work in our 1.5.3 setup. When I start rabbit
>> from erl, I see that the memsup app is not started. I checked the
>> rabbitmq-server configuration and see "-os_mon start_memsup false".
>> I've tried setting start_memsup to true and I've also tried starting
>> memsup manually before calling rabbit:start(). Neither seems to cause
>> flow control information to be logged and both still result in the
>> erlang node crashing.
>>
>> I very strongly suspect user error, but I'd appreciate some guidance
>> on how to enable this feature.
>
> See http://www.rabbitmq.com/admin-guide.html#memsup - you are supposed to be
> using "-rabbit memory_alarms true". ?Enabling memsup the way you did should
> be ok too though as long the server isn't low on memory to start with and
> you wait at least a minute before stressing it. You may need to tweak the
> threshold. Also, we don't know whether memsup on Solaris is producing the
> right information, which is why rabbit leaves it turned off by default on
> that platform. So if you can do some testing/investigation that would be
> great.
>
>
> Matthias.
>



From matthias at lshift.net  Tue Mar 24 16:24:00 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 24 Mar 2009 16:24:00 +0000
Subject: [rabbitmq-discuss] Rabbit accepted into Debian unstable
In-Reply-To: <1237802283.22365.119.camel@cmalu.WAG54GS>
References: <1237802283.22365.119.camel@cmalu.WAG54GS>
Message-ID: <49C90920.2050206@lshift.net>

John,

John Leuner wrote:
>> rabbitmq-server_1.5.0-5_amd64.changes ACCEPTED
> 
> Rabbit has finally been accepted in Debian unstable.

That is excellent news. Thanks for your efforts in getting us to this point.

> Matthias, I think the only files that need to be updated are the
> debian/control and debian/changelog files which I have attached.

It looks like all the changes are specific to the version that's in the 
official Debian distribution; so what's in our source repo and the .deb 
on the RabbitMQ web site should remain unchanged. Or did I miss anything?


Matthias.



From alexis.richardson at gmail.com  Tue Mar 24 17:39:17 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 24 Mar 2009 17:39:17 +0000
Subject: [rabbitmq-discuss] RabbitMQ / AMQP and Django
Message-ID: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>

Folks,

FYI for Pythonists: a new thing with an appropriate name ..

http://pypi.python.org/pypi/carrot/0.2.1

a



From Robert.Elsner at echostar.com  Tue Mar 24 18:04:16 2009
From: Robert.Elsner at echostar.com (Elsner, Robert)
Date: Tue, 24 Mar 2009 12:04:16 -0600
Subject: [rabbitmq-discuss] High cpu usage for Java RabbitMQ client?
In-Reply-To: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>
Message-ID: <D4C5E348C434294AA040A57B0D3DF5ED02EA80EC@MER2-EXCHB1.echostar.com>

Greetings,

I'm trying to figure out if this is something I am doing wrong, or if it
is a problem with the RabbitMQ java client.

Basically I have topic exchanges and messages are posted with keys
similar to:  name.hexnumber.othernumber.finalnumber

The posts comprise approximately a 3Mbit stream that is being converted
to AMQP messages (so the overhead of AMQP is very noticeable, this jumps
to about a 5Mbps if I listen to all messages).  What I see is that even
when nothing is being pushed onto the broker, the java client consumes
approximately one CPU (90-105%) of a dual core machine.  When I track
this down, the trace outputs this:

   2 31.92% 64.00%   16949 301403 java.net.SocketInputStream.socketRead0

So even though there is no data (if I kill the producer) the client is
still very very busy.

Has anyone else seen similar problems to this or am I doing something
wrong?

Thanks,
Rob Elsner



From matthias at lshift.net  Tue Mar 24 21:12:50 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 24 Mar 2009 21:12:50 +0000
Subject: [rabbitmq-discuss] High cpu usage for Java RabbitMQ client?
In-Reply-To: <D4C5E348C434294AA040A57B0D3DF5ED02EA80EC@MER2-EXCHB1.echostar.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA80EC@MER2-EXCHB1.echostar.com>
Message-ID: <49C94CD2.8010002@lshift.net>

Robert,

Elsner, Robert wrote:
> What I see is that even when nothing is being pushed onto the broker,
> the java client consumes approximately one CPU (90-105%) of a dual
> core machine. When I track this down, the trace outputs this:
> 
>    2 31.92% 64.00%   16949 301403 java.net.SocketInputStream.socketRead0
> 
> So even though there is no data (if I kill the producer) the client is
> still very very busy.

Are you sure this is not just due to the consumers catching up?
Is the broker idle when the above happens? It may be worth running the 
test through the tracer (http://www.rabbitmq.com/examples.html#tracer) 
to see whether there is any unusual traffic between the client and the 
server.

What versions of the broker and client are you using? What O/S? What 
version of the JVM? Would it possible for you to post your producer and 
consumer code?

Also, do the stack traces you get from sending the JVM a QUIT signal 
offer any clues? Feel free to post them here.


Regards,

Matthias.



From Robert.Elsner at echostar.com  Tue Mar 24 23:08:36 2009
From: Robert.Elsner at echostar.com (Elsner, Robert)
Date: Tue, 24 Mar 2009 17:08:36 -0600
Subject: [rabbitmq-discuss] High cpu usage for Java RabbitMQ client?
In-Reply-To: <49C94CD2.8010002@lshift.net>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA80EC@MER2-EXCHB1.echostar.com>
	<49C94CD2.8010002@lshift.net>
Message-ID: <D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com>

Matthias,

I have implemented the Basic.Qos to limit to 10 the prefetch size.  All
of my messages are marked as immediate, so that if a client gets backed
up, my understanding is that the message will be silently dropped for
that queue.  This seems to be the case, if I add a queue but do not
consume messages, the broker does not continually consume extra memory.

The broker is from the mercurial repository, the last status that hg
info reports is this:

changeset:   922:e4c723649145
branch:      bug19356
tag:         tip
parent:      921:1f4653fa63c9
parent:      853:1c307e454a52
user:        Essien Ita Essien <essiene at gmail.com>
date:        Thu Feb 19 08:46:15 2009 +0100
summary:     Merge with upstream default

The java client is from the same pull, on the same day.

All of these are running on Linux, generally Ubuntu (my development box)
but I setup the broker to run on Debian 5.0.  JVM version build
1.6.0_10-b33

I can reduce the code to a simple example.  The outline is basically I
have a few runnable's that open a channel, perform QoS, open an
exchange, and bind a queue.  They then sit in a loop using
.nextDelivery() from the QueueingConsumer.

> Also, do the stack traces you get from sending the JVM a QUIT 
> signal offer any clues? Feel free to post them here.

Attached.

I will follow up with some equivalent code samples later, I'm just
trying to narrow down where the problem is, and prefer to not waste too
much time from other people if no one has seen this issue but me.

Rob
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: stack_traces.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090324/373d653f/attachment.txt 

From matthias at lshift.net  Wed Mar 25 00:17:24 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 25 Mar 2009 00:17:24 +0000
Subject: [rabbitmq-discuss] High cpu usage for Java RabbitMQ client?
In-Reply-To: <D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>	<D4C5E348C434294AA040A57B0D3DF5ED02EA80EC@MER2-EXCHB1.echostar.com>	<49C94CD2.8010002@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com>
Message-ID: <49C97814.60805@lshift.net>

Robert,

Elsner, Robert wrote:
> The broker is from the mercurial repository, the last status that hg
> info reports is this:
> 
> changeset:   922:e4c723649145
> branch:      bug19356
> tag:         tip

You should not be using the tip. See
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-January/003164.html

>> Also, do the stack traces you get from sending the JVM a QUIT 
>> signal offer any clues? Feel free to post them here.
> 
> Attached.

Looks fairly sane. The connection thread sits exactly where you'd expect 
it to be when not much is happening on the connection, namely in a 
socketRead0. There are a whole bunch of non-rabbit threads though, 
including UI threads. It would be good to eliminate those from our 
enquiries.


Matthias.



From Robert.Elsner at echostar.com  Wed Mar 25 01:05:31 2009
From: Robert.Elsner at echostar.com (Elsner, Robert)
Date: Tue, 24 Mar 2009 19:05:31 -0600
Subject: [rabbitmq-discuss] High cpu usage for Java RabbitMQ client?
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>	<D4C5E348C434294AA040A57B0D3DF5ED02EA80EC@MER2-EXCHB1.echostar.com>	<49C94CD2.8010002@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com>
	<49C97814.60805@lshift.net>
Message-ID: <D4C5E348C434294AA040A57B0D3DF5ED07062E@MER2-EXCHB1.echostar.com>

Matthias,

> You should not be using the tip. See
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-January/003164.html

I used the directions from http://www.rabbitmq.com/build-server.html to download.  If those are incorrect, then that needs to be fixed.  I was referred to that page by an email a little bit ago to the list.

>Looks fairly sane. The connection thread sits exactly where you'd expect 
> it to be when not much is happening on the connection, namely in a 
> socketRead0. There are a whole bunch of non-rabbit threads though, 
> including UI threads. It would be good to eliminate those from our 
> enquiries.

Yes there are a lot of UI threads.  The UI is entirely driven by messages from AMQP.  

What I did, in a different experiment, was disable posting to the AMQP broker.  The UI is then doing nothing, and the system process time is the majority of effort.  I'm thinking of running strace on this, to see what the specific issue is.  My concern is that, for some reason, the call is not blocking in a nice way and is causing excess looping somewhere.

I will develop a non-UI process that does the same things and test it.  If I can reproduce this result then I can post that code.

Thanks for your help,
Rob
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090324/749db263/attachment.htm 

From Robert.Elsner at echostar.com  Wed Mar 25 02:20:40 2009
From: Robert.Elsner at echostar.com (Elsner, Robert)
Date: Tue, 24 Mar 2009 20:20:40 -0600
Subject: [rabbitmq-discuss] High cpu usage for Java RabbitMQ client?
	(solved, my fault)
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>	<D4C5E348C434294AA040A57B0D3DF5ED02EA80EC@MER2-EXCHB1.echostar.com>	<49C94CD2.8010002@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com>
	<49C97814.60805@lshift.net>
Message-ID: <D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com>

Matthias,

Good news, as you expected, it was something I was doing.  There was a Thread.yield() in a loop, which would have caused the extra system time.  All is well with RabbitMQ, as you assumed.  Sometimes it takes a second opinion, I just hate to waste your time being that. :)

>From my previous email, does the Qos work like I describe?  If messages are marked immediate but the client's queue is over Basic.Qos setting, the server will silently drop the delivery?

Also, I have looked through the AMQP lists a little bit and saw some discussion of a compressed or binary wire format, specifically relating to market quotes.  It looks like this is slated for 1.0, but that would be ideal for me (since AMQP overhead is ~30-50% of my message size now).  Is there a roadmap to adoption?

Thank you,
Rob

> Looks fairly sane. The connection thread sits exactly where you'd expect 
> it to be when not much is happening on the connection, namely in a 
> socketRead0. There are a whole bunch of non-rabbit threads though, 
> including UI threads. It would be good to eliminate those from our 
> enquiries.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090324/0754fdc8/attachment.htm 

From matthias at lshift.net  Wed Mar 25 06:40:47 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 25 Mar 2009 06:40:47 +0000
Subject: [rabbitmq-discuss] High cpu usage for Java RabbitMQ
 client?	(solved, my fault)
In-Reply-To: <D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>	<D4C5E348C434294AA040A57B0D3DF5ED02EA80EC@MER2-EXCHB1.echostar.com>	<49C94CD2.8010002@lshift.net>	<D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com>	<49C97814.60805@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com>
Message-ID: <49C9D1EF.2050008@lshift.net>

Robert,

Elsner, Robert wrote:
> I used the directions from http://www.rabbitmq.com/build-server.html 
> to download. If those are incorrect, then that needs to be fixed.

The instructions do indeed need fixing. We are aware of that, but just
haven't found the time to do it yet.

> If messages are marked immediate but the client's queue is over
> Basic.Qos setting, the server will silently drop the delivery?

Correct.

> Also, I have looked through the AMQP lists a little bit and saw some
>  discussion of a compressed or binary wire format, specifically
> relating to market quotes.  It looks like this is slated for 1.0, but
> that would be ideal for me (since AMQP overhead is ~30-50% of my
> message size now).  Is there a roadmap to adoption?

You are the first person to ask about this :) We have thought about more 
compact encodings for messaging than present in AMQP. See, for example 
Tony's "Streamlining HTTP" post 
(http://www.lshift.net/blog/2009/02/27/streamlining-http), but we have 
no concrete plans for implementation yet.

Does the overhead really cause problems in your setup? Do you end up 
saturating the network?


Regards,

Matthias.



From Robert.Elsner at echostar.com  Wed Mar 25 11:41:33 2009
From: Robert.Elsner at echostar.com (Elsner, Robert)
Date: Wed, 25 Mar 2009 05:41:33 -0600
Subject: [rabbitmq-discuss] High cpu usage for Java RabbitMQ
	client?	(solved, my fault)
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>	<D4C5E348C434294AA040A57B0D3DF5ED02EA80EC@MER2-EXCHB1.echostar.com>	<49C94CD2.8010002@lshift.net>	<D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com>	<49C97814.60805@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com>
	<49C9D1EF.2050008@lshift.net>
Message-ID: <D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>

Matthias,

> The instructions do indeed need fixing. We are aware of that, but just
> haven't found the time to do it yet.

There's never enough time for documentation :)

> > Also, I have looked through the AMQP lists a little bit and saw some
> >  discussion of a compressed or binary wire format, specifically
> > relating to market quotes.  It looks like this is slated for 1.0, but
> > that would be ideal for me (since AMQP overhead is ~30-50% of my
> > message size now).  Is there a roadmap to adoption?
> 
> You are the first person to ask about this :) We have thought about more 
> compact encodings for messaging than present in AMQP. See, for example 
> Tony's "Streamlining HTTP" post 
> (http://www.lshift.net/blog/2009/02/27/streamlining-http), but we have 
> no concrete plans for implementation yet.

Have you thought about approaching the AMQP spec with Thrift or ProtocolBuffers encoding?  Tony's post is very much inline with what I've found, we have a few messages that are very small (24 bytes) and some that are larger (~500 bytes) so the AMQP overhead is very noticeable.  Disabling positive-ack from the queues helped alleviate some of the traffic, but not enough to matter.

> Does the overhead really cause problems in your setup? Do you end up 
> saturating the network?

Well, our current system has about 50 clients each consuming a 3Mbps stream.  I was hoping to be able to swap out the backend to AMQP and then perform optimizations using the routing keys.  However, the AMQP "stream" would at that point bump to 5-6Mbps.  That's not too practical over our WAN links.  This just adds a little bit of effort to switch to AMQP, by reworking the client to query the more static data from a DB instead of streaming it over and over (so the discussions I've seen about last quote caching would be a nice feature).  The eventual goal is to have clustered brokers that do the traffic management between the remote nodes that generate messages, so that the data that needs to be routed across our WAN links is, but the majority of the data will stay local to the producers for archiving.

Thanks,
Rob

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090325/0dcf0afe/attachment.htm 

From greenspan.levi at googlemail.com  Wed Mar 25 15:31:51 2009
From: greenspan.levi at googlemail.com (Levi Greenspan)
Date: Wed, 25 Mar 2009 16:31:51 +0100
Subject: [rabbitmq-discuss] Custom Exchange Implementation
Message-ID: <1237995111.16430.18.camel@localhost>

Dear list members,

I have hacked together a custom exchange type, which supports bindings
without a routing key similar to the fanout exchange type. When a
publisher sends a message with routing key R, the message will be send
to all queues bound to the exchange with key K=R. If no queue is found,
one is randomly selected and a binding from this queue to the exchange
with key R is added. Next time a message is send with routing key R, the
very same queue will be used.

Now, what I have come up with, works reasonably well in testing, however
from looking at the code I am afraid the way its done is not safe in the
face of parallel calls of rabbit_exchange:route, because I update the
shared state (bindings table). Would it be better to create a separate
process to handle all this?

Maybe someone can give me a little help with this. I should add - what
is certainly obvious already - that I am in no way a competent Erlang
programmer or that I know much about RabbitMQ's internals. I would just
like to get a second opinion about this issue before I run into trouble
in production ;-)

Many thanks,
Levi





From alexis.richardson at gmail.com  Wed Mar 25 15:33:33 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 25 Mar 2009 15:33:33 +0000
Subject: [rabbitmq-discuss] Custom Exchange Implementation
In-Reply-To: <1237995111.16430.18.camel@localhost>
References: <1237995111.16430.18.camel@localhost>
Message-ID: <167204d20903250833l2cdd8da4s5c5a19e72d406a7a@mail.gmail.com>

Levi

That's fascinating.  Can I ask what application you have that requires this?

alexis



On Wed, Mar 25, 2009 at 3:31 PM, Levi Greenspan
<greenspan.levi at googlemail.com> wrote:
> Dear list members,
>
> I have hacked together a custom exchange type, which supports bindings
> without a routing key similar to the fanout exchange type. When a
> publisher sends a message with routing key R, the message will be send
> to all queues bound to the exchange with key K=R. If no queue is found,
> one is randomly selected and a binding from this queue to the exchange
> with key R is added. Next time a message is send with routing key R, the
> very same queue will be used.
>
> Now, what I have come up with, works reasonably well in testing, however
> from looking at the code I am afraid the way its done is not safe in the
> face of parallel calls of rabbit_exchange:route, because I update the
> shared state (bindings table). Would it be better to create a separate
> process to handle all this?
>
> Maybe someone can give me a little help with this. I should add - what
> is certainly obvious already - that I am in no way a competent Erlang
> programmer or that I know much about RabbitMQ's internals. I would just
> like to get a second opinion about this issue before I run into trouble
> in production ;-)
>
> Many thanks,
> Levi
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From greenspan.levi at googlemail.com  Wed Mar 25 15:34:06 2009
From: greenspan.levi at googlemail.com (Levi Greenspan)
Date: Wed, 25 Mar 2009 16:34:06 +0100
Subject: [rabbitmq-discuss] Custom Exchange Implementation
In-Reply-To: <1237995111.16430.18.camel@localhost>
References: <1237995111.16430.18.camel@localhost>
Message-ID: <1237995246.16430.20.camel@localhost>

Sorry, forgot to attach the patch.

Regards,
Levi

On Wed, 2009-03-25 at 16:31 +0100, Levi Greenspan wrote:
> Dear list members,
> 
> I have hacked together a custom exchange type, which supports bindings
> without a routing key similar to the fanout exchange type. When a
> publisher sends a message with routing key R, the message will be send
> to all queues bound to the exchange with key K=R. If no queue is found,
> one is randomly selected and a binding from this queue to the exchange
> with key R is added. Next time a message is send with routing key R, the
> very same queue will be used.
> 
> Now, what I have come up with, works reasonably well in testing, however
> from looking at the code I am afraid the way its done is not safe in the
> face of parallel calls of rabbit_exchange:route, because I update the
> shared state (bindings table). Would it be better to create a separate
> process to handle all this?
> 
> Maybe someone can give me a little help with this. I should add - what
> is certainly obvious already - that I am in no way a competent Erlang
> programmer or that I know much about RabbitMQ's internals. I would just
> like to get a second opinion about this issue before I run into trouble
> in production ;-)
> 
> Many thanks,
> Levi
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: srand-exchange-hack.diff
Type: text/x-patch
Size: 2366 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090325/3a15051f/attachment.bin 

From sustrik at imatix.com  Wed Mar 25 15:42:20 2009
From: sustrik at imatix.com (Martin Sustrik)
Date: Wed, 25 Mar 2009 16:42:20 +0100
Subject: [rabbitmq-discuss] Custom Exchange Implementation
In-Reply-To: <167204d20903250833l2cdd8da4s5c5a19e72d406a7a@mail.gmail.com>
References: <1237995111.16430.18.camel@localhost>
	<167204d20903250833l2cdd8da4s5c5a19e72d406a7a@mail.gmail.com>
Message-ID: <49CA50DC.5030905@imatix.com>

Whoo. Random distribution of services among the running instances. 
Pretty interesting. I've never seen something alike.

Martin

Alexis Richardson wrote:
> Levi
> 
> That's fascinating.  Can I ask what application you have that requires this?
> 
> alexis
> 
> 
> 
> On Wed, Mar 25, 2009 at 3:31 PM, Levi Greenspan
> <greenspan.levi at googlemail.com> wrote:
>> Dear list members,
>>
>> I have hacked together a custom exchange type, which supports bindings
>> without a routing key similar to the fanout exchange type. When a
>> publisher sends a message with routing key R, the message will be send
>> to all queues bound to the exchange with key K=R. If no queue is found,
>> one is randomly selected and a binding from this queue to the exchange
>> with key R is added. Next time a message is send with routing key R, the
>> very same queue will be used.
>>
>> Now, what I have come up with, works reasonably well in testing, however
>> from looking at the code I am afraid the way its done is not safe in the
>> face of parallel calls of rabbit_exchange:route, because I update the
>> shared state (bindings table). Would it be better to create a separate
>> process to handle all this?
>>
>> Maybe someone can give me a little help with this. I should add - what
>> is certainly obvious already - that I am in no way a competent Erlang
>> programmer or that I know much about RabbitMQ's internals. I would just
>> like to get a second opinion about this issue before I run into trouble
>> in production ;-)
>>
>> Many thanks,
>> Levi
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From greenspan.levi at googlemail.com  Wed Mar 25 15:42:35 2009
From: greenspan.levi at googlemail.com (Levi Greenspan)
Date: Wed, 25 Mar 2009 16:42:35 +0100
Subject: [rabbitmq-discuss] Custom Exchange Implementation
In-Reply-To: <167204d20903250833l2cdd8da4s5c5a19e72d406a7a@mail.gmail.com>
References: <1237995111.16430.18.camel@localhost>
	<167204d20903250833l2cdd8da4s5c5a19e72d406a7a@mail.gmail.com>
Message-ID: <1237995755.16430.28.camel@localhost>

On Wed, 2009-03-25 at 15:33 +0000, Alexis Richardson wrote:
> Levi
> 
> That's fascinating.  Can I ask what application you have that requires this?
> 
> alexis

Sure. What I have is a frontend and a backend  with RabbitMQ in between.
The frontend and the backend consist of multiple nodes to spread the
load. However I need to consistently route the traffic from the frontend
to the same node in the backend. Initially the routing key is only known
in the frontend, so I can not have backend nodes binding themselves to
the exchange, as they don't know the key. Hence my custom exchange type,
that binds the queues dynamically.

Cheers,
Levi




From alexis.richardson at gmail.com  Wed Mar 25 15:54:27 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 25 Mar 2009 15:54:27 +0000
Subject: [rabbitmq-discuss] Custom Exchange Implementation
In-Reply-To: <1237995755.16430.28.camel@localhost>
References: <1237995111.16430.18.camel@localhost>
	<167204d20903250833l2cdd8da4s5c5a19e72d406a7a@mail.gmail.com>
	<1237995755.16430.28.camel@localhost>
Message-ID: <167204d20903250854t51806d09g7d21613235bebb2e@mail.gmail.com>

What a neat idea.  A self-organising broker.



On Wed, Mar 25, 2009 at 3:42 PM, Levi Greenspan
<greenspan.levi at googlemail.com> wrote:
> On Wed, 2009-03-25 at 15:33 +0000, Alexis Richardson wrote:
>> Levi
>>
>> That's fascinating. ?Can I ask what application you have that requires this?
>>
>> alexis
>
> Sure. What I have is a frontend and a backend ?with RabbitMQ in between.
> The frontend and the backend consist of multiple nodes to spread the
> load. However I need to consistently route the traffic from the frontend
> to the same node in the backend. Initially the routing key is only known
> in the frontend, so I can not have backend nodes binding themselves to
> the exchange, as they don't know the key. Hence my custom exchange type,
> that binds the queues dynamically.
>
> Cheers,
> Levi
>
>



From sustrik at imatix.com  Wed Mar 25 16:07:12 2009
From: sustrik at imatix.com (Martin Sustrik)
Date: Wed, 25 Mar 2009 17:07:12 +0100
Subject: [rabbitmq-discuss] Custom Exchange Implementation
In-Reply-To: <1237995755.16430.28.camel@localhost>
References: <1237995111.16430.18.camel@localhost>	<167204d20903250833l2cdd8da4s5c5a19e72d406a7a@mail.gmail.com>
	<1237995755.16430.28.camel@localhost>
Message-ID: <49CA56B0.503@imatix.com>

Nice. One idea though:

When no node is assigned to a freshly arrived routing key, choose the 
one that has least routing keys attached. If there are several with 
lowest number of bindings choose the first one.

That would spread the load more evenly.

Martin

Levi Greenspan wrote:
> On Wed, 2009-03-25 at 15:33 +0000, Alexis Richardson wrote:
>> Levi
>>
>> That's fascinating.  Can I ask what application you have that requires this?
>>
>> alexis
> 
> Sure. What I have is a frontend and a backend  with RabbitMQ in between.
> The frontend and the backend consist of multiple nodes to spread the
> load. However I need to consistently route the traffic from the frontend
> to the same node in the backend. Initially the routing key is only known
> in the frontend, so I can not have backend nodes binding themselves to
> the exchange, as they don't know the key. Hence my custom exchange type,
> that binds the queues dynamically.
> 
> Cheers,
> Levi
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From greenspan.levi at googlemail.com  Wed Mar 25 16:17:06 2009
From: greenspan.levi at googlemail.com (Levi Greenspan)
Date: Wed, 25 Mar 2009 17:17:06 +0100
Subject: [rabbitmq-discuss] Custom Exchange Implementation
In-Reply-To: <49CA56B0.503@imatix.com>
References: <1237995111.16430.18.camel@localhost>
	<167204d20903250833l2cdd8da4s5c5a19e72d406a7a@mail.gmail.com>
	<1237995755.16430.28.camel@localhost>  <49CA56B0.503@imatix.com>
Message-ID: <1237997826.16430.34.camel@localhost>

On Wed, 2009-03-25 at 17:07 +0100, Martin Sustrik wrote:
> Nice. One idea though:
> 
> When no node is assigned to a freshly arrived routing key, choose the 
> one that has least routing keys attached. If there are several with 
> lowest number of bindings choose the first one.
> 
> That would spread the load more evenly.
> 
> Martin

Thanks Martin. I know there is definitely room for improvement. I wanted
a simple working prototype first, especially one that is correct ;)

Cheers,
Levi





From matthias at lshift.net  Wed Mar 25 17:09:35 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 25 Mar 2009 17:09:35 +0000
Subject: [rabbitmq-discuss] Custom Exchange Implementation
In-Reply-To: <1237995111.16430.18.camel@localhost>
References: <1237995111.16430.18.camel@localhost>
Message-ID: <49CA654F.5090102@lshift.net>

Levi,

Levi Greenspan wrote:
> I have hacked together a custom exchange type, which supports bindings
> without a routing key similar to the fanout exchange type. When a
> publisher sends a message with routing key R, the message will be send
> to all queues bound to the exchange with key K=R. If no queue is found,
> one is randomly selected and a binding from this queue to the exchange
> with key R is added. Next time a message is send with routing key R, the
> very same queue will be used.
> 
> Now, what I have come up with, works reasonably well in testing, however
> from looking at the code I am afraid the way its done is not safe in the
> face of parallel calls of rabbit_exchange:route, because I update the
> shared state (bindings table). Would it be better to create a separate
> process to handle all this?

Just make the updates part of the same mnesia tx as the route lookup. 
That should do the trick, I think.


Matthias.



From greenspan.levi at googlemail.com  Wed Mar 25 17:53:16 2009
From: greenspan.levi at googlemail.com (Levi Greenspan)
Date: Wed, 25 Mar 2009 18:53:16 +0100
Subject: [rabbitmq-discuss] Custom Exchange Implementation
In-Reply-To: <49CA654F.5090102@lshift.net>
References: <1237995111.16430.18.camel@localhost> <49CA654F.5090102@lshift.net>
Message-ID: <1238003596.16430.40.camel@localhost>

On Wed, 2009-03-25 at 17:09 +0000, Matthias Radestock wrote:
> Just make the updates part of the same mnesia tx as the route lookup. 
> That should do the trick, I think.

True. I have attached an updated patch which should do exactly what you
suggested.

Many thanks indeed,
Levi

-------------- next part --------------
A non-text attachment was scrubbed...
Name: srand-exchange-hack.diff
Type: text/x-patch
Size: 2913 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090325/4bcef60a/attachment.bin 

From matthias at lshift.net  Wed Mar 25 18:22:37 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 25 Mar 2009 18:22:37 +0000
Subject: [rabbitmq-discuss] High cpu usage for Java
 RabbitMQ	client?	(solved, my fault)
In-Reply-To: <D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>	<D4C5E348C434294AA040A57B0D3DF5ED02EA80EC@MER2-EXCHB1.echostar.com>	<49C94CD2.8010002@lshift.net>	<D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com>	<49C97814.60805@lshift.net>	<D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com>	<49C9D1EF.2050008@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>
Message-ID: <49CA766D.8050102@lshift.net>

Robert,

Elsner, Robert wrote:
>  > The instructions do indeed need fixing. We are aware of that, but just
>  > haven't found the time to do it yet.
> 
> There's never enough time for documentation :)

The docs have now been updated.

> Have you thought about approaching the AMQP spec with Thrift or 
> ProtocolBuffers encoding?

The topic of more compact encodings has certainly been brought up, but 
to date there haven't been any in-depth discussions. I am sure the 
subject will be revisited at some point.


Matthias.



From alexis.richardson at gmail.com  Wed Mar 25 19:10:23 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 25 Mar 2009 19:10:23 +0000
Subject: [rabbitmq-discuss] High cpu usage for Java RabbitMQ client?
	(solved, my fault)
In-Reply-To: <49CA766D.8050102@lshift.net>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA80EC@MER2-EXCHB1.echostar.com>
	<49C94CD2.8010002@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com>
	<49C97814.60805@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com>
	<49C9D1EF.2050008@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>
	<49CA766D.8050102@lshift.net>
Message-ID: <167204d20903251210v6fba41c6y8003189346807430@mail.gmail.com>

On Wed, Mar 25, 2009 at 6:22 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Robert,
>
> Elsner, Robert wrote:
>> Have you thought about approaching the AMQP spec with Thrift or
>> ProtocolBuffers encoding?
>
> The topic of more compact encodings has certainly been brought up, but
> to date there haven't been any in-depth discussions. I am sure the
> subject will be revisited at some point.

To add to Matthias' point, several people have reported GPB with
RabbitMQ in the wild, and I know of some looking at Thrift with
RabbitMQ in at least a casual manner.  The community would love to see
some public examples ... so "go for it!".

alexis



>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From Robert.Elsner at echostar.com  Wed Mar 25 19:22:03 2009
From: Robert.Elsner at echostar.com (Elsner, Robert)
Date: Wed, 25 Mar 2009 13:22:03 -0600
Subject: [rabbitmq-discuss] GPB and AMQP/RabbitMQ
In-Reply-To: <167204d20903251210v6fba41c6y8003189346807430@mail.gmail.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com><D4C5E348C434294AA040A57B0D3DF5ED02EA80EC@MER2-EXCHB1.echostar.com><49C94CD2.8010002@lshift.net><D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com><49C97814.60805@lshift.net><D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com><49C9D1EF.2050008@lshift.net><D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com><49CA766D.8050102@lshift.net>
	<167204d20903251210v6fba41c6y8003189346807430@mail.gmail.com>
Message-ID: <D4C5E348C434294AA040A57B0D3DF5ED02EA821A@MER2-EXCHB1.echostar.com>

Alexis,

> To add to Matthias' point, several people have reported GPB 
> with RabbitMQ in the wild, and I know of some looking at 
> Thrift with RabbitMQ in at least a casual manner.  The 
> community would love to see some public examples ... so "go for it!".

We are using GPB as the message payload for all of our AMQP messages.
We have settled on RabbitMQ as the broker, and have been very pleased
with the results (except for my gripe earlier about the AMQP header
size).  If I get time I may undertake a quick project to make GPB the
wireformat, but without adoption from the AMQP WG this would be an
academic exercise only.  A portion of our GPB defines what will become
the routing key, so this is redundant data, but that would be sweet if
we could build a GPB payload that included the AMQP headers, and the
routing worked directly from that.

One of our goals is to integrate the JavaScript and rabbitmq-http
portions, so that our webcode can make RPC calls the same as all of our
other processes.  We also have some C# applications that we will tie
together with RabbitMQ and GPB.  We also have Erlang projects which use
RabbitMQ as the broker.  It's worked out incredibly well for us, thus
far, and has helped us work toward tool integration without a lot of
headache or investment in writing interop-libraries.

Thanks,
Rob



From alexis.richardson at gmail.com  Wed Mar 25 19:31:27 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 25 Mar 2009 19:31:27 +0000
Subject: [rabbitmq-discuss] GPB and AMQP/RabbitMQ
In-Reply-To: <D4C5E348C434294AA040A57B0D3DF5ED02EA821A@MER2-EXCHB1.echostar.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>
	<49C94CD2.8010002@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com>
	<49C97814.60805@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com>
	<49C9D1EF.2050008@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>
	<49CA766D.8050102@lshift.net>
	<167204d20903251210v6fba41c6y8003189346807430@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA821A@MER2-EXCHB1.echostar.com>
Message-ID: <167204d20903251231v3809fde3ma064dbadc6fbc7b@mail.gmail.com>

Robert,

Thanks so much for talking about this.

On Wed, Mar 25, 2009 at 7:22 PM, Elsner, Robert
<Robert.Elsner at echostar.com> wrote:
> Alexis,
>
>> To add to Matthias' point, several people have reported GPB
>> with RabbitMQ in the wild, and I know of some looking at
>> Thrift with RabbitMQ in at least a casual manner. ?The
>> community would love to see some public examples ... so "go for it!".
>
> We are using GPB as the message payload for all of our AMQP messages.
> We have settled on RabbitMQ as the broker, and have been very pleased
> with the results (except for my gripe earlier about the AMQP header
> size). ?If I get time I may undertake a quick project to make GPB the
> wireformat, but without adoption from the AMQP WG this would be an
> academic exercise only. ?A portion of our GPB defines what will become
> the routing key, so this is redundant data, but that would be sweet if
> we could build a GPB payload that included the AMQP headers, and the
> routing worked directly from that.

When you say "if we could.." do you plan to it and/or do you require help?

Would a custom exchange be useful here?


> One of our goals is to integrate the JavaScript and rabbitmq-http
> portions, so that our webcode can make RPC calls the same as all of our
> other processes. ?We also have some C# applications that we will tie
> together with RabbitMQ and GPB. ?We also have Erlang projects which use
> RabbitMQ as the broker. ?It's worked out incredibly well for us, thus
> far, and has helped us work toward tool integration without a lot of
> headache or investment in writing interop-libraries.

Very cool!  I am extremely impressed.  Do you plan to blog about this?

alexis



> Thanks,
> Rob
>



From kirk at kirkwylie.com  Wed Mar 25 19:36:28 2009
From: kirk at kirkwylie.com (Kirk Wylie)
Date: Wed, 25 Mar 2009 19:36:28 +0000
Subject: [rabbitmq-discuss] High cpu usage for Java RabbitMQ client?
	(solved, my fault)
In-Reply-To: <D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA80EC@MER2-EXCHB1.echostar.com>
	<49C94CD2.8010002@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com>
	<49C97814.60805@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com>
	<49C9D1EF.2050008@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>
Message-ID: <81df5590903251236w6de80ea2w5261ad6ce27eb896@mail.gmail.com>

Just picking out one piece to pipe up on the list after lurking for a while...

2009/3/25 Elsner, Robert <Robert.Elsner at echostar.com>:
> Have you thought about approaching the AMQP spec with Thrift or
> ProtocolBuffers encoding?? Tony's post is very much inline with what I've
> found, we have a few messages that are very small (24 bytes) and some that
> are larger (~500 bytes) so the AMQP overhead is very noticeable.? Disabling
> positive-ack from the queues helped alleviate some of the traffic, but not
> enough to matter.

Hi, Robert,

Are you talking about using Thrift or GPB for the message bodies, or
for the overall AMQP framing? Just trying to parse what precisely
you're asking about here.

Kirk



From kirk at kirkwylie.com  Wed Mar 25 19:46:15 2009
From: kirk at kirkwylie.com (Kirk Wylie)
Date: Wed, 25 Mar 2009 19:46:15 +0000
Subject: [rabbitmq-discuss] GPB and AMQP/RabbitMQ
In-Reply-To: <D4C5E348C434294AA040A57B0D3DF5ED02EA821A@MER2-EXCHB1.echostar.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>
	<49C94CD2.8010002@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com>
	<49C97814.60805@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com>
	<49C9D1EF.2050008@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>
	<49CA766D.8050102@lshift.net>
	<167204d20903251210v6fba41c6y8003189346807430@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA821A@MER2-EXCHB1.echostar.com>
Message-ID: <81df5590903251246l76b87001r34d42ae1a2ebd107@mail.gmail.com>

On Wed, Mar 25, 2009 at 7:22 PM, Elsner, Robert
<Robert.Elsner at echostar.com> wrote:
> We are using GPB as the message payload for all of our AMQP messages.
> We have settled on RabbitMQ as the broker, and have been very pleased
> with the results (except for my gripe earlier about the AMQP header
> size). ?If I get time I may undertake a quick project to make GPB the
> wireformat, but without adoption from the AMQP WG this would be an
> academic exercise only. ?A portion of our GPB defines what will become
> the routing key, so this is redundant data, but that would be sweet if
> we could build a GPB payload that included the AMQP headers, and the
> routing worked directly from that.

Hi, Robert,

Ignore my previous email. This thread is updating too fast for my old
fingers to keep up. :-)

Interestingly, when GPB came out, ActiveMQ did this precise thing (to
have a parallel wire protocol beyond the existing ones that was based
on using GPB as the wire representation), and they said that it worked
quite well. That being said, it definitely wouldn't work for AMQP
given that it is designed as a completely neutral wire representation,
but it might be useful for members of the WG to know that many people
find the current wire encoding a bit too high-overhead.

The problem I've personally always had with GPB in this case is that
you still need to have some type of message termination encoding, or
some type of prefix to let you know the size, as otherwise GPB will
just consume data from the inbound stream. So GPB in and of itself
would still need some other type of framing going on to say "the next
thing should be interpreted as per this .proto, and by the way, it's
going to be 1024 bytes" or something. How would you think of working
around that?

Kirk



From Robert.Elsner at echostar.com  Wed Mar 25 21:12:06 2009
From: Robert.Elsner at echostar.com (Elsner, Robert)
Date: Wed, 25 Mar 2009 15:12:06 -0600
Subject: [rabbitmq-discuss] GPB and AMQP/RabbitMQ
In-Reply-To: <167204d20903251231v3809fde3ma064dbadc6fbc7b@mail.gmail.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>
	<49C94CD2.8010002@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com>
	<49C97814.60805@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com>
	<49C9D1EF.2050008@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>
	<49CA766D.8050102@lshift.net>
	<167204d20903251210v6fba41c6y8003189346807430@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA821A@MER2-EXCHB1.echostar.com>
	<167204d20903251231v3809fde3ma064dbadc6fbc7b@mail.gmail.com>
Message-ID: <D4C5E348C434294AA040A57B0D3DF5ED02EA8253@MER2-EXCHB1.echostar.com>

Alexis,

> Thanks so much for talking about this.

It's my pleasure.  RabbitMQ and AMQP in general has worked its way in to
our normal tool chain, because they just work so well and fit a need
we've had for some time.

> When you say "if we could.." do you plan to it and/or do you 
> require help?

The problem on my side is the scope of the changes (the internals of
RabbitMQ, all of the libraries, etc).  I don't really have the time to
devote to such a huge undertaking alone, but I suppose one of the
benefits of open source is collaborative development and this topic
seems to have a lot of interest.

> Would a custom exchange be useful here?

I'm betting so, but I want to (right now) avoid customizing our AMQP
broker to the extreme, I want to do what I can with the stock
server/client and decide from there if something custom would be a
better/cleaner approach.

> Very cool!  I am extremely impressed.  Do you plan to blog about this?

I hadn't thought about that, but it might be pretty useful for other
people once we get further along.

Thanks,
Rob



From Robert.Elsner at echostar.com  Wed Mar 25 21:32:17 2009
From: Robert.Elsner at echostar.com (Elsner, Robert)
Date: Wed, 25 Mar 2009 15:32:17 -0600
Subject: [rabbitmq-discuss] GPB and AMQP/RabbitMQ
In-Reply-To: <81df5590903251246l76b87001r34d42ae1a2ebd107@mail.gmail.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>
	<49C94CD2.8010002@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA8173@MER2-EXCHB1.echostar.com>
	<49C97814.60805@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com>
	<49C9D1EF.2050008@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>
	<49CA766D.8050102@lshift.net>
	<167204d20903251210v6fba41c6y8003189346807430@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA821A@MER2-EXCHB1.echostar.com>
	<81df5590903251246l76b87001r34d42ae1a2ebd107@mail.gmail.com>
Message-ID: <D4C5E348C434294AA040A57B0D3DF5ED02EA826D@MER2-EXCHB1.echostar.com>

Hey Kirk,

> Ignore my previous email. This thread is updating too fast 
> for my old fingers to keep up. :-)

Luckily for me there is no ordering in SMTP, and I received that after
this one, for whatever reason. :)

> Interestingly, when GPB came out, ActiveMQ did this precise 
> thing (to have a parallel wire protocol beyond the existing 
> ones that was based on using GPB as the wire representation), 
> and they said that it worked quite well. That being said, it 
> definitely wouldn't work for AMQP given that it is designed 
> as a completely neutral wire representation, but it might be 
> useful for members of the WG to know that many people find 
> the current wire encoding a bit too high-overhead.

I did not know ActiveMQ had that, very interesting.  The part I have
enjoyed the most about GPB is that the languages we use (C#, Java,
Erlang, C) have generated source, operate very similarly, and work
incredibly well.  GPB versus our current packet format adds a little
overhead, but the flexibility and extensibility far exceeds what we've
done thus far.  I know there are other libraries out there, do you know
if anyone has done anything similar with AMQP and the other formats?

I've looked over some of the AMQPWG posts and they do seem to have the
idea that the overhead can be a little bit extreme.  Perhaps a push from
the RabbitMQ team to help work this out would be beneficial.  Hopefully
some good things will come out of their next meeting.

> The problem I've personally always had with GPB in this case 
> is that you still need to have some type of message 
> termination encoding, or some type of prefix to let you know 
> the size, as otherwise GPB will just consume data from the 
> inbound stream. So GPB in and of itself would still need some 
> other type of framing going on to say "the next thing should 
> be interpreted as per this .proto, and by the way, it's going 
> to be 1024 bytes" or something. How would you think of 
> working around that?

Luckily that problem is currently handled by AMQP.  The general solution
I've seen is to prefix everything with the size of the protobuf message.
Of course if you start listening to a stream mid-message (for whatever
reason) you first have to synchronize to the messages.

I think if I was to go to GPB as a wireformat for AMQP, I would probably
wait until multicast udp/unicast udp support were added, and use the
datagram concept of UDP as the message delimiter.  This might be
beneficial for my use, but adds a higher workload for the brokers.

The one factor I don't like about GPB is that it isn't self-describing,
to really understand a message one needs the .proto or the code
generated from it.  For something like AMQP it might be more useful to
the community to pick a binary wireformat that encodes well, which also
self-describes its message.  

Rob



From michael.greene at gmail.com  Wed Mar 25 21:40:27 2009
From: michael.greene at gmail.com (Michael Greene)
Date: Wed, 25 Mar 2009 16:40:27 -0500
Subject: [rabbitmq-discuss] GPB and AMQP/RabbitMQ
In-Reply-To: <D4C5E348C434294AA040A57B0D3DF5ED02EA826D@MER2-EXCHB1.echostar.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>
	<49C97814.60805@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com>
	<49C9D1EF.2050008@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>
	<49CA766D.8050102@lshift.net>
	<167204d20903251210v6fba41c6y8003189346807430@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA821A@MER2-EXCHB1.echostar.com>
	<81df5590903251246l76b87001r34d42ae1a2ebd107@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA826D@MER2-EXCHB1.echostar.com>
Message-ID: <f4d6a21a0903251440q24bff7dbg63b5f48008ba3cea@mail.gmail.com>

 Elsner, Robert <Robert.Elsner at echostar.com> wrote:
> I did not know ActiveMQ had that, very interesting. ?The part I have
> enjoyed the most about GPB is that the languages we use (C#, Java,
> Erlang, C) have generated source, operate very similarly, and work
> incredibly well. ?GPB versus our current packet format adds a little
> overhead, but the flexibility and extensibility far exceeds what we've
> done thus far. ?I know there are other libraries out there, do you know
> if anyone has done anything similar with AMQP and the other formats?

We are using Thrift--very similar to GPB--and RabbitMQ together with
great success.  We are using them as entirely separate message
encoding vs. distribution systems, but other people are using them
with tighter integration (e.g. the txAMQP project from FluidInfo,
which I have not tried).

> The one factor I don't like about GPB is that it isn't self-describing,
> to really understand a message one needs the .proto or the code
> generated from it. ?For something like AMQP it might be more useful to
> the community to pick a binary wireformat that encodes well, which also
> self-describes its message.

There is a similar situation with Thrift, and I agree that either
would make a poor standard if that were a goal of the AMQP WG.

Michael



From bsullivan at lindenlab.com  Wed Mar 25 22:11:12 2009
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Wed, 25 Mar 2009 15:11:12 -0700
Subject: [rabbitmq-discuss] Queue Re-declaration
In-Reply-To: <49751265.7010806@lshift.net>
References: <3b949f090901121639y51a0952ek3142c87b0dbae000@mail.gmail.com>	<D7806050-2372-46CA-8776-BC509D600E61@mac.com>	<496C551A.2070307@lshift.net>	<3b949f090901131506y2b708a0drf43edd78ba2d6291@mail.gmail.com>	<496D224A.5070400@lshift.net>	<3b949f090901131526x2eb486adx6f1dd21781648145@mail.gmail.com>
	<26c0cf900901191546y9bfe1e9t7fa9c1d1b04be6b4@mail.gmail.com>
	<49751265.7010806@lshift.net>
Message-ID: <08EF58F6-C23B-4DB6-BB45-A5C5AEF70E7B@lindenlab.com>


Hi Matthias,

Actually I had the same question.  We would like to be able to know  
which clients are connected to which queues mostly from an  
adminstration standpoint.  In particular, if a queue is filling up, we  
would like to be able to track down which application is not consuming  
fast enough (or not at all).  From the rabbitmqctl output, I don't see  
a way to really discern this once we have more than a couple of clients.

I have tried to enforce queue names with a particular syntax for now,  
so that we can identify the consumer a little easier, but I can't  
always make it happen.

In the meantime, what's the erlang shell command to find this  
information?

Thanks,
Brian

On Jan 19, 2009, at 3:53 PM, Matthias Radestock wrote:

>> Also, side (bonus question) : is there a way to actually list the
>> consumers of the queue (not just the number of them) or, even  
>> better, to
>> kick one of them out?
>
> Only through the Erlang shell.
>
> What use case have you got in mind for this?
>
>
> Matthias
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From bsullivan at lindenlab.com  Wed Mar 25 22:18:27 2009
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Wed, 25 Mar 2009 15:18:27 -0700
Subject: [rabbitmq-discuss] Queue Re-declaration
In-Reply-To: <49751265.7010806@lshift.net>
References: <3b949f090901121639y51a0952ek3142c87b0dbae000@mail.gmail.com>	<D7806050-2372-46CA-8776-BC509D600E61@mac.com>	<496C551A.2070307@lshift.net>	<3b949f090901131506y2b708a0drf43edd78ba2d6291@mail.gmail.com>	<496D224A.5070400@lshift.net>	<3b949f090901131526x2eb486adx6f1dd21781648145@mail.gmail.com>
	<26c0cf900901191546y9bfe1e9t7fa9c1d1b04be6b4@mail.gmail.com>
	<49751265.7010806@lshift.net>
Message-ID: <03D2D0FC-2725-456A-8C6E-BF58AD2AC7C3@lindenlab.com>


Also - what is the expected behavior if you delete a queue (externally  
using a different client) that a consuming application has a binding  
to?  In my testing, I don't believe I get any errors back to the  
client, it just seems to be silently listening for more messages that  
will never come.  This is using the Java client.

Thanks,
Brian

On Jan 19, 2009, at 3:53 PM, Matthias Radestock wrote:

> Julien Genestoux wrote:
>> Let me jump into that conversation to ask a basic question : how to
>> destroy a queue when it's been created as non-auto-delete?
>
> By invoking AMQP's queue.delete command.




From kirk at kirkwylie.com  Wed Mar 25 22:39:39 2009
From: kirk at kirkwylie.com (Kirk Wylie)
Date: Wed, 25 Mar 2009 22:39:39 +0000
Subject: [rabbitmq-discuss] GPB and AMQP/RabbitMQ
In-Reply-To: <D4C5E348C434294AA040A57B0D3DF5ED02EA826D@MER2-EXCHB1.echostar.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>
	<49C97814.60805@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com>
	<49C9D1EF.2050008@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>
	<49CA766D.8050102@lshift.net>
	<167204d20903251210v6fba41c6y8003189346807430@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA821A@MER2-EXCHB1.echostar.com>
	<81df5590903251246l76b87001r34d42ae1a2ebd107@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA826D@MER2-EXCHB1.echostar.com>
Message-ID: <81df5590903251539o472f7ac1mee80ddacc0fb06a8@mail.gmail.com>

On Wed, Mar 25, 2009 at 9:32 PM, Elsner, Robert
<Robert.Elsner at echostar.com> wrote:
>> Interestingly, when GPB came out, ActiveMQ did this precise
>> thing (to have a parallel wire protocol beyond the existing
>> ones that was based on using GPB as the wire representation),
>> and they said that it worked quite well. That being said, it
>> definitely wouldn't work for AMQP given that it is designed
>> as a completely neutral wire representation, but it might be
>> useful for members of the WG to know that many people find
>> the current wire encoding a bit too high-overhead.
>
> I did not know ActiveMQ had that, very interesting.

Bear in mind that I don't know where James went with it, I know that
he had the transport in an experimental branch, but I'm not sure if it
was anything other than a thought experiment for him. If nothing else,
the new transport was both faster and had lower CPU overhead than the
existing one, so he probably should have kept it. :-)

> ?The part I have
> enjoyed the most about GPB is that the languages we use (C#, Java,
> Erlang, C) have generated source, operate very similarly, and work
> incredibly well. ?GPB versus our current packet format adds a little
> overhead, but the flexibility and extensibility far exceeds what we've
> done thus far. ?I know there are other libraries out there, do you know
> if anyone has done anything similar with AMQP and the other formats?

There are plenty of people using Thrift in similar use cases, and some
stuff that I've done with other MOM infrastructure was relatively
similar (which I'll talk about in a little bit).

> I've looked over some of the AMQPWG posts and they do seem to have the
> idea that the overhead can be a little bit extreme. ?Perhaps a push from
> the RabbitMQ team to help work this out would be beneficial. ?Hopefully
> some good things will come out of their next meeting.

And this is the time. AMQP 1.0 is under public review, so if you have
any comments, I'm sure you can pass them along to Alexis or another
Rabbit team member and they can help provide that feedback.

> I think if I was to go to GPB as a wireformat for AMQP, I would probably
> wait until multicast udp/unicast udp support were added, and use the
> datagram concept of UDP as the message delimiter. ?This might be
> beneficial for my use, but adds a higher workload for the brokers.

That's quite an interesting concept, but in general, I think using
something like GPB isn't ideal for a fixed protocol like AMQP. AMQP
has to have at the wire level a very fixed, stable, well known
protocol for interoperability. That means that you're better off
defining the protocol itself in a very compact representation, because
you don't really care about the whole
generation-from-arbitrary-specification side that something like GPB
has, and any backwards compatibility has to be "baked in" to the
specification.

It also has to be a protocol which is particularly subject to hardware
implementation and stream analysis (think Wireshark). That has its own
protocol design requirements that something like GPB (which is a more
general purpose system) can ignore (varint128 is probably not ideal
for a small hardware implementation for example).

So in general, I think smaller framing overhead == Big Win, use of
GPB/Thrift itself == Unnecessary.

> The one factor I don't like about GPB is that it isn't self-describing,
> to really understand a message one needs the .proto or the code
> generated from it. ?For something like AMQP it might be more useful to
> the community to pick a binary wireformat that encodes well, which also
> self-describes its message.

This is where some work that I did at my last job may pay off.
Essentially, we rolled our own packed, binary, self-describing,
hierarchical message format. Extremely compact (minimum 10 bytes
overhead), fields were all self-describing with type information,
everything was easy to map into direct CPUs (no varints), and fully
hierarchical. Unfortunately that implementation is trapped at the
former employer, but they've given the go-ahead to support a cleanroom
implementation of the encoding and tools in the open source arena (and
plan on helping with the effort, since they don't want to own it long
term).

I'm more than willing to discuss what this (Fudge) is, since I'm
getting down to the clean room implementation these days if you think
it's interesting (I've gotten a lot of positive feedback). The
ultimate plan is to support a low-level message format (getField,
setField, that type of thing) as well as mapping to/from higher level
message representations (.proto, .xsd) and full XPath lookups.

Kirk



From matthias at lshift.net  Thu Mar 26 07:22:01 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 26 Mar 2009 07:22:01 +0000
Subject: [rabbitmq-discuss] Queue Re-declaration
In-Reply-To: <08EF58F6-C23B-4DB6-BB45-A5C5AEF70E7B@lindenlab.com>
References: <3b949f090901121639y51a0952ek3142c87b0dbae000@mail.gmail.com>	<D7806050-2372-46CA-8776-BC509D600E61@mac.com>	<496C551A.2070307@lshift.net>	<3b949f090901131506y2b708a0drf43edd78ba2d6291@mail.gmail.com>	<496D224A.5070400@lshift.net>	<3b949f090901131526x2eb486adx6f1dd21781648145@mail.gmail.com>	<26c0cf900901191546y9bfe1e9t7fa9c1d1b04be6b4@mail.gmail.com>	<49751265.7010806@lshift.net>
	<08EF58F6-C23B-4DB6-BB45-A5C5AEF70E7B@lindenlab.com>
Message-ID: <49CB2D19.2050109@lshift.net>

Brian,

Brian Sullivan wrote:
> Actually I had the same question.  We would like to be able to know 
> which clients are connected to which queues mostly from an adminstration 
> standpoint.  In particular, if a queue is filling up, we would like to 
> be able to track down which application is not consuming fast enough (or 
> not at all).  From the rabbitmqctl output, I don't see a way to really 
> discern this once we have more than a couple of clients.

That information is quite tricky to get hold of, and presenting it in a 
sensible form in rabbitmqctl is trickier still. Anyway, I've added this 
to our todo list.

> In the meantime, what's the erlang shell command to find this information?

That would involve solving the first part of the trickiness mentioned above.

The information is held in the channel processes' consumer_mapping state 
field. So you'd have to reach into the channel processes' state, which 
is certainly possible, but not straightforward. First though you need to 
get hold of all channel processes. Again, that's possible but not 
straightforward.

If I find a spare couple of hours I'll give it a try.


Matthias.



From matthias at lshift.net  Thu Mar 26 07:34:18 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 26 Mar 2009 07:34:18 +0000
Subject: [rabbitmq-discuss] Queue Re-declaration
In-Reply-To: <03D2D0FC-2725-456A-8C6E-BF58AD2AC7C3@lindenlab.com>
References: <3b949f090901121639y51a0952ek3142c87b0dbae000@mail.gmail.com>	<D7806050-2372-46CA-8776-BC509D600E61@mac.com>	<496C551A.2070307@lshift.net>	<3b949f090901131506y2b708a0drf43edd78ba2d6291@mail.gmail.com>	<496D224A.5070400@lshift.net>	<3b949f090901131526x2eb486adx6f1dd21781648145@mail.gmail.com>	<26c0cf900901191546y9bfe1e9t7fa9c1d1b04be6b4@mail.gmail.com>	<49751265.7010806@lshift.net>
	<03D2D0FC-2725-456A-8C6E-BF58AD2AC7C3@lindenlab.com>
Message-ID: <49CB2FFA.60009@lshift.net>

Brian,

Brian Sullivan wrote:
> Also - what is the expected behavior if you delete a queue (externally 
> using a different client) that a consuming application has a binding 
> to?  In my testing, I don't believe I get any errors back to the client, 
> it just seems to be silently listening for more messages that will never 
> come.  This is using the Java client.

That is the expected behaviour in AMQP 0-8.

In 0-9-1 the notion of queue exclusivity extends to *all* queue 
operations, not just basic.consume. So if a client declares a queue as 
exclusive then no other client can do anything with that queue at all, 
including deleting it.

The problem you describe will still exist for non-exclusive queues 
though. Arguably a queue should inform consumers when it is 
disappearing. AMQP does not support this, and I don't know of any plans 
of adding such a feature. One possible workaround is for clients to 
periodically check whether the queue still exists.


Regards,

Matthias.



From jewel at subvert-the-dominant-paradigm.net  Thu Mar 26 10:04:58 2009
From: jewel at subvert-the-dominant-paradigm.net (John Leuner)
Date: Thu, 26 Mar 2009 12:04:58 +0200
Subject: [rabbitmq-discuss] Rabbit accepted into Debian unstable
In-Reply-To: <49C90920.2050206@lshift.net>
References: <1237802283.22365.119.camel@cmalu.WAG54GS>
	<49C90920.2050206@lshift.net>
Message-ID: <1238061898.22365.179.camel@cmalu.WAG54GS>

> > 
> > Rabbit has finally been accepted in Debian unstable.
> 
> That is excellent news. Thanks for your efforts in getting us to this point.
> 
> > Matthias, I think the only files that need to be updated are the
> > debian/control and debian/changelog files which I have attached.
> 
> It looks like all the changes are specific to the version that's in the 
> official Debian distribution; so what's in our source repo and the .deb 
> on the RabbitMQ web site should remain unchanged. Or did I miss anything?

If you plan to release debs separately from Debian then we could keep
these changes separate, but we should keep in mind that people might be
upgrading and downgrading between these debs so they should stay
compatible.

I forgot to attach the changes to the copyright, I think it would be
best if we keep this synced.

John

-------------- next part --------------
This package was debianized by Tony Garnock-Jones <tonyg at rabbitmq.com> on
Wed,  3 Jan 2007 15:43:44 +0000.

It was downloaded from http://www.rabbitmq.com/

The file codegen/amqp-0.8.json is covered by the following terms:

        "Copyright (C) 2008-2009 LShift Ltd, Cohesive Financial Technologies LLC,
        and Rabbit Technologies Ltd
        
        Permission is hereby granted, free of charge, to any person
        obtaining a copy of this file (the Software), to deal in the
        Software without restriction, including without limitation the 
        rights to use, copy, modify, merge, publish, distribute, 
        sublicense, and/or sell copies of the Software, and to permit 
        persons to whom the Software is furnished to do so, subject to 
        the following conditions:
	
	The above copyright notice and this permission notice shall be
        included in all copies or substantial portions of the Software.
	
	THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
        EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
        OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
        NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
        HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
        WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
        FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
        OTHER DEALINGS IN THE SOFTWARE."

The rest of this package is licensed under the Mozilla Public License 1.1
Authors and Copyright are as described below:

     The Initial Developers of the Original Code are LShift Ltd,
     Cohesive Financial Technologies LLC, and Rabbit Technologies Ltd.

     Portions created before 22-Nov-2008 00:00:00 GMT by LShift Ltd,
     Cohesive Financial Technologies LLC, or Rabbit Technologies Ltd
     are Copyright (C) 2007-2008 LShift Ltd, Cohesive Financial
     Technologies LLC, and Rabbit Technologies Ltd.

     Portions created by LShift Ltd are Copyright (C) 2007-2009 LShift
     Ltd. Portions created by Cohesive Financial Technologies LLC are
     Copyright (C) 2007-2009 Cohesive Financial Technologies
     LLC. Portions created by Rabbit Technologies Ltd are Copyright
     (C) 2007-2009 Rabbit Technologies Ltd.


                          MOZILLA PUBLIC LICENSE
                                Version 1.1

                              ---------------

1. Definitions.

     1.0.1. "Commercial Use" means distribution or otherwise making the
     Covered Code available to a third party.

     1.1. "Contributor" means each entity that creates or contributes to
     the creation of Modifications.

     1.2. "Contributor Version" means the combination of the Original
     Code, prior Modifications used by a Contributor, and the Modifications
     made by that particular Contributor.

     1.3. "Covered Code" means the Original Code or Modifications or the
     combination of the Original Code and Modifications, in each case
     including portions thereof.

     1.4. "Electronic Distribution Mechanism" means a mechanism generally
     accepted in the software development community for the electronic
     transfer of data.

     1.5. "Executable" means Covered Code in any form other than Source
     Code.

     1.6. "Initial Developer" means the individual or entity identified
     as the Initial Developer in the Source Code notice required by Exhibit
     A.

     1.7. "Larger Work" means a work which combines Covered Code or
     portions thereof with code not governed by the terms of this License.

     1.8. "License" means this document.

     1.8.1. "Licensable" means having the right to grant, to the maximum
     extent possible, whether at the time of the initial grant or
     subsequently acquired, any and all of the rights conveyed herein.

     1.9. "Modifications" means any addition to or deletion from the
     substance or structure of either the Original Code or any previous
     Modifications. When Covered Code is released as a series of files, a
     Modification is:
          A. Any addition to or deletion from the contents of a file
          containing Original Code or previous Modifications.

          B. Any new file that contains any part of the Original Code or
          previous Modifications.

     1.10. "Original Code" means Source Code of computer software code
     which is described in the Source Code notice required by Exhibit A as
     Original Code, and which, at the time of its release under this
     License is not already Covered Code governed by this License.

     1.10.1. "Patent Claims" means any patent claim(s), now owned or
     hereafter acquired, including without limitation,  method, process,
     and apparatus claims, in any patent Licensable by grantor.

     1.11. "Source Code" means the preferred form of the Covered Code for
     making modifications to it, including all modules it contains, plus
     any associated interface definition files, scripts used to control
     compilation and installation of an Executable, or source code
     differential comparisons against either the Original Code or another
     well known, available Covered Code of the Contributor's choice. The
     Source Code can be in a compressed or archival form, provided the
     appropriate decompression or de-archiving software is widely available
     for no charge.

     1.12. "You" (or "Your")  means an individual or a legal entity
     exercising rights under, and complying with all of the terms of, this
     License or a future version of this License issued under Section 6.1.
     For legal entities, "You" includes any entity which controls, is
     controlled by, or is under common control with You. For purposes of
     this definition, "control" means (a) the power, direct or indirect,
     to cause the direction or management of such entity, whether by
     contract or otherwise, or (b) ownership of more than fifty percent
     (50%) of the outstanding shares or beneficial ownership of such
     entity.

2. Source Code License.

     2.1. The Initial Developer Grant.
     The Initial Developer hereby grants You a world-wide, royalty-free,
     non-exclusive license, subject to third party intellectual property
     claims:
          (a)  under intellectual property rights (other than patent or
          trademark) Licensable by Initial Developer to use, reproduce,
          modify, display, perform, sublicense and distribute the Original
          Code (or portions thereof) with or without Modifications, and/or
          as part of a Larger Work; and

          (b) under Patents Claims infringed by the making, using or
          selling of Original Code, to make, have made, use, practice,
          sell, and offer for sale, and/or otherwise dispose of the
          Original Code (or portions thereof).

          (c) the licenses granted in this Section 2.1(a) and (b) are
          effective on the date Initial Developer first distributes
          Original Code under the terms of this License.

          (d) Notwithstanding Section 2.1(b) above, no patent license is
          granted: 1) for code that You delete from the Original Code; 2)
          separate from the Original Code;  or 3) for infringements caused
          by: i) the modification of the Original Code or ii) the
          combination of the Original Code with other software or devices.

     2.2. Contributor Grant.
     Subject to third party intellectual property claims, each Contributor
     hereby grants You a world-wide, royalty-free, non-exclusive license

          (a)  under intellectual property rights (other than patent or
          trademark) Licensable by Contributor, to use, reproduce, modify,
          display, perform, sublicense and distribute the Modifications
          created by such Contributor (or portions thereof) either on an
          unmodified basis, with other Modifications, as Covered Code
          and/or as part of a Larger Work; and

          (b) under Patent Claims infringed by the making, using, or
          selling of  Modifications made by that Contributor either alone
          and/or in combination with its Contributor Version (or portions
          of such combination), to make, use, sell, offer for sale, have
          made, and/or otherwise dispose of: 1) Modifications made by that
          Contributor (or portions thereof); and 2) the combination of
          Modifications made by that Contributor with its Contributor
          Version (or portions of such combination).

          (c) the licenses granted in Sections 2.2(a) and 2.2(b) are
          effective on the date Contributor first makes Commercial Use of
          the Covered Code.

          (d)    Notwithstanding Section 2.2(b) above, no patent license is
          granted: 1) for any code that Contributor has deleted from the
          Contributor Version; 2)  separate from the Contributor Version;
          3)  for infringements caused by: i) third party modifications of
          Contributor Version or ii)  the combination of Modifications made
          by that Contributor with other software  (except as part of the
          Contributor Version) or other devices; or 4) under Patent Claims
          infringed by Covered Code in the absence of Modifications made by
          that Contributor.

3. Distribution Obligations.

     3.1. Application of License.
     The Modifications which You create or to which You contribute are
     governed by the terms of this License, including without limitation
     Section 2.2. The Source Code version of Covered Code may be
     distributed only under the terms of this License or a future version
     of this License released under Section 6.1, and You must include a
     copy of this License with every copy of the Source Code You
     distribute. You may not offer or impose any terms on any Source Code
     version that alters or restricts the applicable version of this
     License or the recipients' rights hereunder. However, You may include
     an additional document offering the additional rights described in
     Section 3.5.

     3.2. Availability of Source Code.
     Any Modification which You create or to which You contribute must be
     made available in Source Code form under the terms of this License
     either on the same media as an Executable version or via an accepted
     Electronic Distribution Mechanism to anyone to whom you made an
     Executable version available; and if made available via Electronic
     Distribution Mechanism, must remain available for at least twelve (12)
     months after the date it initially became available, or at least six
     (6) months after a subsequent version of that particular Modification
     has been made available to such recipients. You are responsible for
     ensuring that the Source Code version remains available even if the
     Electronic Distribution Mechanism is maintained by a third party.

     3.3. Description of Modifications.
     You must cause all Covered Code to which You contribute to contain a
     file documenting the changes You made to create that Covered Code and
     the date of any change. You must include a prominent statement that
     the Modification is derived, directly or indirectly, from Original
     Code provided by the Initial Developer and including the name of the
     Initial Developer in (a) the Source Code, and (b) in any notice in an
     Executable version or related documentation in which You describe the
     origin or ownership of the Covered Code.

     3.4. Intellectual Property Matters
          (a) Third Party Claims.
          If Contributor has knowledge that a license under a third party's
          intellectual property rights is required to exercise the rights
          granted by such Contributor under Sections 2.1 or 2.2,
          Contributor must include a text file with the Source Code
          distribution titled "LEGAL" which describes the claim and the
          party making the claim in sufficient detail that a recipient will
          know whom to contact. If Contributor obtains such knowledge after
          the Modification is made available as described in Section 3.2,
          Contributor shall promptly modify the LEGAL file in all copies
          Contributor makes available thereafter and shall take other steps
          (such as notifying appropriate mailing lists or newsgroups)
          reasonably calculated to inform those who received the Covered
          Code that new knowledge has been obtained.

          (b) Contributor APIs.
          If Contributor's Modifications include an application programming
          interface and Contributor has knowledge of patent licenses which
          are reasonably necessary to implement that API, Contributor must
          also include this information in the LEGAL file.

               (c)    Representations.
          Contributor represents that, except as disclosed pursuant to
          Section 3.4(a) above, Contributor believes that Contributor's
          Modifications are Contributor's original creation(s) and/or
          Contributor has sufficient rights to grant the rights conveyed by
          this License.

     3.5. Required Notices.
     You must duplicate the notice in Exhibit A in each file of the Source
     Code.  If it is not possible to put such notice in a particular Source
     Code file due to its structure, then You must include such notice in a
     location (such as a relevant directory) where a user would be likely
     to look for such a notice.  If You created one or more Modification(s)
     You may add your name as a Contributor to the notice described in
     Exhibit A.  You must also duplicate this License in any documentation
     for the Source Code where You describe recipients' rights or ownership
     rights relating to Covered Code.  You may choose to offer, and to
     charge a fee for, warranty, support, indemnity or liability
     obligations to one or more recipients of Covered Code. However, You
     may do so only on Your own behalf, and not on behalf of the Initial
     Developer or any Contributor. You must make it absolutely clear than
     any such warranty, support, indemnity or liability obligation is
     offered by You alone, and You hereby agree to indemnify the Initial
     Developer and every Contributor for any liability incurred by the
     Initial Developer or such Contributor as a result of warranty,
     support, indemnity or liability terms You offer.

     3.6. Distribution of Executable Versions.
     You may distribute Covered Code in Executable form only if the
     requirements of Section 3.1-3.5 have been met for that Covered Code,
     and if You include a notice stating that the Source Code version of
     the Covered Code is available under the terms of this License,
     including a description of how and where You have fulfilled the
     obligations of Section 3.2. The notice must be conspicuously included
     in any notice in an Executable version, related documentation or
     collateral in which You describe recipients' rights relating to the
     Covered Code. You may distribute the Executable version of Covered
     Code or ownership rights under a license of Your choice, which may
     contain terms different from this License, provided that You are in
     compliance with the terms of this License and that the license for the
     Executable version does not attempt to limit or alter the recipient's
     rights in the Source Code version from the rights set forth in this
     License. If You distribute the Executable version under a different
     license You must make it absolutely clear that any terms which differ
     from this License are offered by You alone, not by the Initial
     Developer or any Contributor. You hereby agree to indemnify the
     Initial Developer and every Contributor for any liability incurred by
     the Initial Developer or such Contributor as a result of any such
     terms You offer.

     3.7. Larger Works.
     You may create a Larger Work by combining Covered Code with other code
     not governed by the terms of this License and distribute the Larger
     Work as a single product. In such a case, You must make sure the
     requirements of this License are fulfilled for the Covered Code.

4. Inability to Comply Due to Statute or Regulation.

     If it is impossible for You to comply with any of the terms of this
     License with respect to some or all of the Covered Code due to
     statute, judicial order, or regulation then You must: (a) comply with
     the terms of this License to the maximum extent possible; and (b)
     describe the limitations and the code they affect. Such description
     must be included in the LEGAL file described in Section 3.4 and must
     be included with all distributions of the Source Code. Except to the
     extent prohibited by statute or regulation, such description must be
     sufficiently detailed for a recipient of ordinary skill to be able to
     understand it.

5. Application of this License.

     This License applies to code to which the Initial Developer has
     attached the notice in Exhibit A and to related Covered Code.

6. Versions of the License.

     6.1. New Versions.
     Netscape Communications Corporation ("Netscape") may publish revised
     and/or new versions of the License from time to time. Each version
     will be given a distinguishing version number.

     6.2. Effect of New Versions.
     Once Covered Code has been published under a particular version of the
     License, You may always continue to use it under the terms of that
     version. You may also choose to use such Covered Code under the terms
     of any subsequent version of the License published by Netscape. No one
     other than Netscape has the right to modify the terms applicable to
     Covered Code created under this License.

     6.3. Derivative Works.
     If You create or use a modified version of this License (which you may
     only do in order to apply it to code which is not already Covered Code
     governed by this License), You must (a) rename Your license so that
     the phrases "Mozilla", "MOZILLAPL", "MOZPL", "Netscape",
     "MPL", "NPL" or any confusingly similar phrase do not appear in your
     license (except to note that your license differs from this License)
     and (b) otherwise make it clear that Your version of the license
     contains terms which differ from the Mozilla Public License and
     Netscape Public License. (Filling in the name of the Initial
     Developer, Original Code or Contributor in the notice described in
     Exhibit A shall not of themselves be deemed to be modifications of
     this License.)

7. DISCLAIMER OF WARRANTY.

     COVERED CODE IS PROVIDED UNDER THIS LICENSE ON AN "AS IS" BASIS,
     WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING,
     WITHOUT LIMITATION, WARRANTIES THAT THE COVERED CODE IS FREE OF
     DEFECTS, MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE OR NON-INFRINGING.
     THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE COVERED CODE
     IS WITH YOU. SHOULD ANY COVERED CODE PROVE DEFECTIVE IN ANY RESPECT,
     YOU (NOT THE INITIAL DEVELOPER OR ANY OTHER CONTRIBUTOR) ASSUME THE
     COST OF ANY NECESSARY SERVICING, REPAIR OR CORRECTION. THIS DISCLAIMER
     OF WARRANTY CONSTITUTES AN ESSENTIAL PART OF THIS LICENSE. NO USE OF
     ANY COVERED CODE IS AUTHORIZED HEREUNDER EXCEPT UNDER THIS DISCLAIMER.

8. TERMINATION.

     8.1.  This License and the rights granted hereunder will terminate
     automatically if You fail to comply with terms herein and fail to cure
     such breach within 30 days of becoming aware of the breach. All
     sublicenses to the Covered Code which are properly granted shall
     survive any termination of this License. Provisions which, by their
     nature, must remain in effect beyond the termination of this License
     shall survive.

     8.2.  If You initiate litigation by asserting a patent infringement
     claim (excluding declatory judgment actions) against Initial Developer
     or a Contributor (the Initial Developer or Contributor against whom
     You file such action is referred to as "Participant")  alleging that:

     (a)  such Participant's Contributor Version directly or indirectly
     infringes any patent, then any and all rights granted by such
     Participant to You under Sections 2.1 and/or 2.2 of this License
     shall, upon 60 days notice from Participant terminate prospectively,
     unless if within 60 days after receipt of notice You either: (i)
     agree in writing to pay Participant a mutually agreeable reasonable
     royalty for Your past and future use of Modifications made by such
     Participant, or (ii) withdraw Your litigation claim with respect to
     the Contributor Version against such Participant.  If within 60 days
     of notice, a reasonable royalty and payment arrangement are not
     mutually agreed upon in writing by the parties or the litigation claim
     is not withdrawn, the rights granted by Participant to You under
     Sections 2.1 and/or 2.2 automatically terminate at the expiration of
     the 60 day notice period specified above.

     (b)  any software, hardware, or device, other than such Participant's
     Contributor Version, directly or indirectly infringes any patent, then
     any rights granted to You by such Participant under Sections 2.1(b)
     and 2.2(b) are revoked effective as of the date You first made, used,
     sold, distributed, or had made, Modifications made by that
     Participant.

     8.3.  If You assert a patent infringement claim against Participant
     alleging that such Participant's Contributor Version directly or
     indirectly infringes any patent where such claim is resolved (such as
     by license or settlement) prior to the initiation of patent
     infringement litigation, then the reasonable value of the licenses
     granted by such Participant under Sections 2.1 or 2.2 shall be taken
     into account in determining the amount or value of any payment or
     license.

     8.4.  In the event of termination under Sections 8.1 or 8.2 above,
     all end user license agreements (excluding distributors and resellers)
     which have been validly granted by You or any distributor hereunder
     prior to termination shall survive termination.

9. LIMITATION OF LIABILITY.

     UNDER NO CIRCUMSTANCES AND UNDER NO LEGAL THEORY, WHETHER TORT
     (INCLUDING NEGLIGENCE), CONTRACT, OR OTHERWISE, SHALL YOU, THE INITIAL
     DEVELOPER, ANY OTHER CONTRIBUTOR, OR ANY DISTRIBUTOR OF COVERED CODE,
     OR ANY SUPPLIER OF ANY OF SUCH PARTIES, BE LIABLE TO ANY PERSON FOR
     ANY INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES OF ANY
     CHARACTER INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOSS OF GOODWILL,
     WORK STOPPAGE, COMPUTER FAILURE OR MALFUNCTION, OR ANY AND ALL OTHER
     COMMERCIAL DAMAGES OR LOSSES, EVEN IF SUCH PARTY SHALL HAVE BEEN
     INFORMED OF THE POSSIBILITY OF SUCH DAMAGES. THIS LIMITATION OF
     LIABILITY SHALL NOT APPLY TO LIABILITY FOR DEATH OR PERSONAL INJURY
     RESULTING FROM SUCH PARTY'S NEGLIGENCE TO THE EXTENT APPLICABLE LAW
     PROHIBITS SUCH LIMITATION. SOME JURISDICTIONS DO NOT ALLOW THE
     EXCLUSION OR LIMITATION OF INCIDENTAL OR CONSEQUENTIAL DAMAGES, SO
     THIS EXCLUSION AND LIMITATION MAY NOT APPLY TO YOU.

10. U.S. GOVERNMENT END USERS.

     The Covered Code is a "commercial item," as that term is defined in
     48 C.F.R. 2.101 (Oct. 1995), consisting of "commercial computer
     software" and "commercial computer software documentation," as such
     terms are used in 48 C.F.R. 12.212 (Sept. 1995). Consistent with 48
     C.F.R. 12.212 and 48 C.F.R. 227.7202-1 through 227.7202-4 (June 1995),
     all U.S. Government End Users acquire Covered Code with only those
     rights set forth herein.

11. MISCELLANEOUS.

     This License represents the complete agreement concerning subject
     matter hereof. If any provision of this License is held to be
     unenforceable, such provision shall be reformed only to the extent
     necessary to make it enforceable. This License shall be governed by
     California law provisions (except to the extent applicable law, if
     any, provides otherwise), excluding its conflict-of-law provisions.
     With respect to disputes in which at least one party is a citizen of,
     or an entity chartered or registered to do business in the United
     States of America, any litigation relating to this License shall be
     subject to the jurisdiction of the Federal Courts of the Northern
     District of California, with venue lying in Santa Clara County,
     California, with the losing party responsible for costs, including
     without limitation, court costs and reasonable attorneys' fees and
     expenses. The application of the United Nations Convention on
     Contracts for the International Sale of Goods is expressly excluded.
     Any law or regulation which provides that the language of a contract
     shall be construed against the drafter shall not apply to this
     License.

12. RESPONSIBILITY FOR CLAIMS.

     As between Initial Developer and the Contributors, each party is
     responsible for claims and damages arising, directly or indirectly,
     out of its utilization of rights under this License and You agree to
     work with Initial Developer and Contributors to distribute such
     responsibility on an equitable basis. Nothing herein is intended or
     shall be deemed to constitute any admission of liability.

13. MULTIPLE-LICENSED CODE.

     Initial Developer may designate portions of the Covered Code as
     "Multiple-Licensed".  "Multiple-Licensed" means that the Initial
     Developer permits you to utilize portions of the Covered Code under
     Your choice of the NPL or the alternative licenses, if any, specified
     by the Initial Developer in the file described in Exhibit A.

EXHIBIT A -Mozilla Public License.

     ``The contents of this file are subject to the Mozilla Public License
     Version 1.1 (the "License"); you may not use this file except in
     compliance with the License. You may obtain a copy of the License at
     http://www.mozilla.org/MPL/

     Software distributed under the License is distributed on an "AS IS"
     basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
     License for the specific language governing rights and limitations
     under the License.

     The Original Code is RabbitMQ.

     The Initial Developers of the Original Code are LShift Ltd,
     Cohesive Financial Technologies LLC, and Rabbit Technologies Ltd.

     Portions created before 22-Nov-2008 00:00:00 GMT by LShift Ltd,
     Cohesive Financial Technologies LLC, or Rabbit Technologies Ltd
     are Copyright (C) 2007-2008 LShift Ltd, Cohesive Financial
     Technologies LLC, and Rabbit Technologies Ltd.

     Portions created by LShift Ltd are Copyright (C) 2007-2009 LShift
     Ltd. Portions created by Cohesive Financial Technologies LLC are
     Copyright (C) 2007-2009 Cohesive Financial Technologies
     LLC. Portions created by Rabbit Technologies Ltd are Copyright
     (C) 2007-2009 Rabbit Technologies Ltd.

     All Rights Reserved.

     Contributor(s): ______________________________________.''

     [NOTE: The text of this Exhibit A may differ slightly from the text of
     the notices in the Source Code files of the Original Code. You should
     use the text of this Exhibit A rather than the text found in the
     Original Code Source Code for Your Modifications.]





If you have any questions regarding licensing, please contact us at 
info at rabbitmq.com.

The Debian packaging is (C) 2007-2009, Rabbit Technologies Ltd. <info at rabbitmq.com>
and is licensed under the MPL 1.1, see above.



From cremes.devlist at mac.com  Thu Mar 26 14:59:54 2009
From: cremes.devlist at mac.com (Chuck Remes)
Date: Thu, 26 Mar 2009 09:59:54 -0500
Subject: [rabbitmq-discuss] GPB and AMQP/RabbitMQ
In-Reply-To: <81df5590903251539o472f7ac1mee80ddacc0fb06a8@mail.gmail.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>
	<49C97814.60805@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070630@MER2-EXCHB1.echostar.com>
	<49C9D1EF.2050008@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>
	<49CA766D.8050102@lshift.net>
	<167204d20903251210v6fba41c6y8003189346807430@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA821A@MER2-EXCHB1.echostar.com>
	<81df5590903251246l76b87001r34d42ae1a2ebd107@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA826D@MER2-EXCHB1.echostar.com>
	<81df5590903251539o472f7ac1mee80ddacc0fb06a8@mail.gmail.com>
Message-ID: <3BF3A91C-7241-4430-97CC-8D92DD51CEFF@mac.com>


On Mar 25, 2009, at 5:39 PM, Kirk Wylie wrote:

> On Wed, Mar 25, 2009 at 9:32 PM, Elsner, Robert
>
>
>> The one factor I don't like about GPB is that it isn't self- 
>> describing,
>> to really understand a message one needs the .proto or the code
>> generated from it.  For something like AMQP it might be more useful  
>> to
>> the community to pick a binary wireformat that encodes well, which  
>> also
>> self-describes its message.
>
> This is where some work that I did at my last job may pay off.
> Essentially, we rolled our own packed, binary, self-describing,
> hierarchical message format. Extremely compact (minimum 10 bytes
> overhead), fields were all self-describing with type information,
> everything was easy to map into direct CPUs (no varints), and fully
> hierarchical. Unfortunately that implementation is trapped at the
> former employer, but they've given the go-ahead to support a cleanroom
> implementation of the encoding and tools in the open source arena (and
> plan on helping with the effort, since they don't want to own it long
> term).

You two might be interested in something I ran across a few weeks ago.  
It's a self-describing binary protocol (exprot) up on github. You can  
read about it here [1]. There are already implementations in OCamel  
and Ruby. I'm sure it wouldn't be too tough to do others.

That link points to the first article. There are others on that blog  
that follow it up.

cr

[1] http://eigenclass.org/R2/writings/extprot-extensible-protocols-intro



From kirk at kirkwylie.com  Thu Mar 26 15:15:15 2009
From: kirk at kirkwylie.com (Kirk Wylie)
Date: Thu, 26 Mar 2009 15:15:15 +0000
Subject: [rabbitmq-discuss] GPB and AMQP/RabbitMQ
In-Reply-To: <3BF3A91C-7241-4430-97CC-8D92DD51CEFF@mac.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>
	<49C9D1EF.2050008@lshift.net>
	<D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>
	<49CA766D.8050102@lshift.net>
	<167204d20903251210v6fba41c6y8003189346807430@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA821A@MER2-EXCHB1.echostar.com>
	<81df5590903251246l76b87001r34d42ae1a2ebd107@mail.gmail.com>
	<D4C5E348C434294AA040A57B0D3DF5ED02EA826D@MER2-EXCHB1.echostar.com>
	<81df5590903251539o472f7ac1mee80ddacc0fb06a8@mail.gmail.com>
	<3BF3A91C-7241-4430-97CC-8D92DD51CEFF@mac.com>
Message-ID: <81df5590903260815s1afe4534q7671a26c793b7cf5@mail.gmail.com>

Hi, Chuck,

On Thu, Mar 26, 2009 at 2:59 PM, Chuck Remes <cremes.devlist at mac.com> wrote:
>> This is where some work that I did at my last job may pay off.
>> Essentially, we rolled our own packed, binary, self-describing,
>> hierarchical message format. Extremely compact (minimum 10 bytes
>> overhead), fields were all self-describing with type information,
>> everything was easy to map into direct CPUs (no varints), and fully
>> hierarchical. Unfortunately that implementation is trapped at the
>> former employer, but they've given the go-ahead to support a cleanroom
>> implementation of the encoding and tools in the open source arena (and
>> plan on helping with the effort, since they don't want to own it long
>> term).
>
> You two might be interested in something I ran across a few weeks ago.
> It's a self-describing binary protocol (exprot) up on github. You can
> read about it here [1]. There are already implementations in OCamel
> and Ruby. I'm sure it wouldn't be too tough to do others.

Indeed, I remember the day it came out, and blogged about it:
http://kirkwylie.blogspot.com/2009/01/extprot-very-cool-idea.html .

However, there hasn't benen that much of a takeup on the other
language front, and while OCaml and Ruby are all very well and good,
but without your big 3 languages (C++, C#, Java), it's of limited use.
And it doesn't look like the author's necessarily interested in
pushing it to a much wider audience by making it a general purpose
encoding system with multi-language bindings. Because my background is
in financial services (where there's some F# going on, but very little
Ruby and OCaml), I think we probably have something to add there.

That being said, my plan was ultimately to have a reasonable amount of
interchange with other system (so that you can use .proto files to
define a schema, or an extprot definition, or even an XSD). So I want
to learn from what he's done and see where I can learn from what the
extprot guys have done.

Good find, though, it's right up the alley: self describing, delimited, fast.

Kirk



From bsullivan at lindenlab.com  Thu Mar 26 19:00:35 2009
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Thu, 26 Mar 2009 12:00:35 -0700
Subject: [rabbitmq-discuss] Queue Re-declaration
In-Reply-To: <49CB2FFA.60009@lshift.net>
References: <3b949f090901121639y51a0952ek3142c87b0dbae000@mail.gmail.com>	<D7806050-2372-46CA-8776-BC509D600E61@mac.com>
	<496C551A.2070307@lshift.net>	<3b949f090901131506y2b708a0drf43edd78ba2d6291@mail.gmail.com>	<496D224A.5070400@lshift.net>
	<3b949f090901131526x2eb486adx6f1dd21781648145@mail.gmail.com>	<26c0cf900901191546y9bfe1e9t7fa9c1d1b04be6b4@mail.gmail.com>
	<49751265.7010806@lshift.net>
	<03D2D0FC-2725-456A-8C6E-BF58AD2AC7C3@lindenlab.com>
	<49CB2FFA.60009@lshift.net>
Message-ID: <568FDD9C-DD22-414D-ABA5-9BB7546F3039@lindenlab.com>


Hi Matthias,

For the workaround to periodically check if the queue still exists, is  
the most efficient (or only) way to do this to continually re-declare  
the queue?  I know it's meant to be an assertion, but it still looks  
very strange in my code, and I am curious if there is a lighter way to  
do this.

Thanks,
Brian

On Mar 26, 2009, at 12:34 AM, Matthias Radestock wrote:

> Brian,
>
> Brian Sullivan wrote:
>> Also - what is the expected behavior if you delete a queue  
>> (externally using a different client) that a consuming application  
>> has a binding to?  In my testing, I don't believe I get any errors  
>> back to the client, it just seems to be silently listening for more  
>> messages that will never come.  This is using the Java client.
>
> That is the expected behaviour in AMQP 0-8.
>
> In 0-9-1 the notion of queue exclusivity extends to *all* queue  
> operations, not just basic.consume. So if a client declares a queue  
> as exclusive then no other client can do anything with that queue at  
> all, including deleting it.
>
> The problem you describe will still exist for non-exclusive queues  
> though. Arguably a queue should inform consumers when it is  
> disappearing. AMQP does not support this, and I don't know of any  
> plans of adding such a feature. One possible workaround is for  
> clients to periodically check whether the queue still exists.
>
>
> Regards,
>
> Matthias.




From matthias at lshift.net  Thu Mar 26 19:17:41 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 26 Mar 2009 19:17:41 +0000
Subject: [rabbitmq-discuss] Queue Re-declaration
In-Reply-To: <568FDD9C-DD22-414D-ABA5-9BB7546F3039@lindenlab.com>
References: <3b949f090901121639y51a0952ek3142c87b0dbae000@mail.gmail.com>	<D7806050-2372-46CA-8776-BC509D600E61@mac.com>	<496C551A.2070307@lshift.net>	<3b949f090901131506y2b708a0drf43edd78ba2d6291@mail.gmail.com>	<496D224A.5070400@lshift.net>	<3b949f090901131526x2eb486adx6f1dd21781648145@mail.gmail.com>	<26c0cf900901191546y9bfe1e9t7fa9c1d1b04be6b4@mail.gmail.com>	<49751265.7010806@lshift.net>	<03D2D0FC-2725-456A-8C6E-BF58AD2AC7C3@lindenlab.com>	<49CB2FFA.60009@lshift.net>
	<568FDD9C-DD22-414D-ABA5-9BB7546F3039@lindenlab.com>
Message-ID: <49CBD4D5.2030208@lshift.net>

Brian,

Brian Sullivan wrote:
> For the workaround to periodically check if the queue still exists, is 
> the most efficient (or only) way to do this to continually re-declare 
> the queue?  I know it's meant to be an assertion, but it still looks 
> very strange in my code, and I am curious if there is a lighter way to 
> do this.

A *passive* queue.declare is very light weight and does exactly what you 
want.


Matthias.



From alexis.richardson at gmail.com  Thu Mar 26 21:36:10 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 26 Mar 2009 21:36:10 +0000
Subject: [rabbitmq-discuss] our meetup in SF
Message-ID: <167204d20903261436m349000a5qc8f9b2338b571f18@mail.gmail.com>

Hello,

For bay area folks -
http://www.bayfp.org/blog/2009/03/25/next-meeting-rabbitmq-wednesday-april-8th-730pm/

Please come!  Beer will be consumed afterwards.

alexis



From tonyg at lshift.net  Thu Mar 26 23:12:17 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 26 Mar 2009 23:12:17 +0000
Subject: [rabbitmq-discuss] GPB and AMQP/RabbitMQ
In-Reply-To: <81df5590903260815s1afe4534q7671a26c793b7cf5@mail.gmail.com>
References: <167204d20903241039s6f1618afy322c4c2579ec89be@mail.gmail.com>	<49C9D1EF.2050008@lshift.net>	<D4C5E348C434294AA040A57B0D3DF5ED070636@MER2-EXCHB1.echostar.com>	<49CA766D.8050102@lshift.net>	<167204d20903251210v6fba41c6y8003189346807430@mail.gmail.com>	<D4C5E348C434294AA040A57B0D3DF5ED02EA821A@MER2-EXCHB1.echostar.com>	<81df5590903251246l76b87001r34d42ae1a2ebd107@mail.gmail.com>	<D4C5E348C434294AA040A57B0D3DF5ED02EA826D@MER2-EXCHB1.echostar.com>	<81df5590903251539o472f7ac1mee80ddacc0fb06a8@mail.gmail.com>	<3BF3A91C-7241-4430-97CC-8D92DD51CEFF@mac.com>
	<81df5590903260815s1afe4534q7671a26c793b7cf5@mail.gmail.com>
Message-ID: <49CC0BD1.10800@lshift.net>

> However, there hasn't benen that much of a takeup on the other
> language front, and while OCaml and Ruby are all very well and good,
> but without your big 3 languages (C++, C#, Java), it's of limited use.

When it first came to light, I forked it and started hacking on C and 
Erlang bindings. I haven't gotten much further than basic low-level 
codecs, but it's maybe a start. (I didn't have much luck with getting 
the ocaml code built, sadly.)

http://github.com/tonyg/extprot/tree/master

Regards,
   Tony



From matthias at lshift.net  Fri Mar 27 14:37:12 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 27 Mar 2009 14:37:12 +0000
Subject: [rabbitmq-discuss] Rabbit accepted into Debian unstable
In-Reply-To: <1238061898.22365.179.camel@cmalu.WAG54GS>
References: <1237802283.22365.119.camel@cmalu.WAG54GS>	<49C90920.2050206@lshift.net>
	<1238061898.22365.179.camel@cmalu.WAG54GS>
Message-ID: <49CCE498.9010601@lshift.net>

John,

John Leuner wrote:
> we should keep in mind that people might be upgrading and downgrading
> between these debs so they should stay compatible.

We generally do not release more than one debian_version for any given 
upstream_version. So as long as you submit your packages with a 
debian_version that is higher than whatever we released then we should 
be fine, right?

> I forgot to attach the changes to the copyright, I think it would be 
> best if we keep this synced.

Done.


Matthias.



From jewel at subvert-the-dominant-paradigm.net  Mon Mar 30 13:57:28 2009
From: jewel at subvert-the-dominant-paradigm.net (John Leuner)
Date: Mon, 30 Mar 2009 14:57:28 +0200
Subject: [rabbitmq-discuss] Rabbit accepted into Debian unstable
In-Reply-To: <49CCE498.9010601@lshift.net>
References: <1237802283.22365.119.camel@cmalu.WAG54GS>
	<49C90920.2050206@lshift.net>
	<1238061898.22365.179.camel@cmalu.WAG54GS>
	<49CCE498.9010601@lshift.net>
Message-ID: <1238417848.15177.5.camel@cmalu.WAG54GS>

On Fri, 2009-03-27 at 14:37 +0000, Matthias Radestock wrote:
> John,
> 
> John Leuner wrote:
> > we should keep in mind that people might be upgrading and downgrading
> > between these debs so they should stay compatible.
> 
> We generally do not release more than one debian_version for any given 
> upstream_version. So as long as you submit your packages with a 
> debian_version that is higher than whatever we released then we should 
> be fine, right?

Well, that would prevent conflict between the two different packages,
but we still have to make sure that they don't diverge in any
significant way. 

Most importantly it should be possible for the user to remove, install
and upgrade packages without corrupting their data (rabbit queues) or
configuration settings.

John





From cpettitt at gmail.com  Tue Mar 31 23:36:19 2009
From: cpettitt at gmail.com (Chris Pettitt)
Date: Tue, 31 Mar 2009 15:36:19 -0700
Subject: [rabbitmq-discuss] Flow Control in RabbitMQ 1.5.3
In-Reply-To: <de47e4420903231431n2f8b19acyf0ab2a3d968b74cb@mail.gmail.com>
References: <de47e4420903231145k6c16bffdoabd428d2270c06cb@mail.gmail.com>
	<49C7ED93.6020600@lshift.net>
	<de47e4420903231431n2f8b19acyf0ab2a3d968b74cb@mail.gmail.com>
Message-ID: <de47e4420903311536r1e1227f3n7b38b31daa2596ce@mail.gmail.com>

Hi all,

I found that Solaris continued to crash regardless of what settings I
used for the high watermark. As memsup on Solaris was questionable I
moved to Linux.

I moved to a Quad core CentOS box with 9 GB of memory. Unfortunately,
I'm seeing similar crashes, though they take longer to occur.

What I'm seeing is usually some variation of the following:

1. Start broker clean
2. Start 1 consumer
3. Start 10 producers that publish as fast as they can (we're trying
to stress the system)
4. Once system memory reaches the high water mark throttling occurs
(I've tried settings from about 40% - 95%, the rest of the
observations will refer to measurements at 70%).
5. Throttling toggles on and off a few times, between 3 - 5 times, and
then all clients (including the consumer) get disconnected.
6. Memory sores to over 90%.
6. Sometimes the erlang process crashes at this point, other times all
producers and consumers reconnect and within about 30 seconds the
erlang process crashes. In most cases the producers never produce
after the reconnect, but on some occasions the consumer does receive
messages before dying.

I understand that this is pretty excessive in terms of stress.
However, without going into details, it is very important that I
demonstrate that RabbitMQ degrades gracefully under high load.

On a more positive note, I'm seeing RabbitMQ outperform my current JMS
provider by a factor of ~15x on Solaris!

Any help would be appreciated.

Thanks,
Chris


On Mon, Mar 23, 2009 at 2:31 PM, Chris Pettitt <cpettitt at gmail.com> wrote:
> Hi Matthias,
>
> Thank you for the pointer. I should have looked more closely at the
> documentation!
>
> Cursory testing reveals that RabbitMQ is able to use flow control
> without crashing with a high watermark of 0.7, while 0.75 or higher
> results in the Erlang node crashing (before memsup detects the low
> memory condition?). I'll follow up if I learn anything more about
> memsup's behavior on Solaris.
>
> Thanks,
> Chris
>
> On Mon, Mar 23, 2009 at 1:14 PM, Matthias Radestock <matthias at lshift.net> wrote:
>> Chris,
>>
>> Chris Pettitt wrote:
>>>
>>> I found an article that talks about flow control in RabbitMQ 1.5.0
>>> [1]. It doesn't seem to work in our 1.5.3 setup. When I start rabbit
>>> from erl, I see that the memsup app is not started. I checked the
>>> rabbitmq-server configuration and see "-os_mon start_memsup false".
>>> I've tried setting start_memsup to true and I've also tried starting
>>> memsup manually before calling rabbit:start(). Neither seems to cause
>>> flow control information to be logged and both still result in the
>>> erlang node crashing.
>>>
>>> I very strongly suspect user error, but I'd appreciate some guidance
>>> on how to enable this feature.
>>
>> See http://www.rabbitmq.com/admin-guide.html#memsup - you are supposed to be
>> using "-rabbit memory_alarms true". ?Enabling memsup the way you did should
>> be ok too though as long the server isn't low on memory to start with and
>> you wait at least a minute before stressing it. You may need to tweak the
>> threshold. Also, we don't know whether memsup on Solaris is producing the
>> right information, which is why rabbit leaves it turned off by default on
>> that platform. So if you can do some testing/investigation that would be
>> great.
>>
>>
>> Matthias.
>>
>



