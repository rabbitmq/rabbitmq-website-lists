From taylste at gmail.com  Tue Feb  1 17:08:37 2011
From: taylste at gmail.com (Steven Taylor)
Date: Tue, 1 Feb 2011 17:08:37 +0000
Subject: [rabbitmq-discuss] Silverlight client?
Message-ID: <AANLkTi=39QZD0UN-xn5Ff08Z8wJexuNNsNy_FDxfLra5@mail.gmail.com>

Hi,

I found this link at RabbitMQ.com:
http://kaazing.net/documentation/howto-amqp-silverlight.html

Has anybody been playing around with it Kaazing?  Has anyone had good
experiences with this company?

I'm just looking for Silverlight connectivity options without WCF + I'm a
bit cautious about investing too much time in a demo download.

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110201/defd5d2d/attachment.htm>

From alexis at rabbitmq.com  Tue Feb  1 17:53:54 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 1 Feb 2011 17:53:54 +0000
Subject: [rabbitmq-discuss] Silverlight client?
In-Reply-To: <AANLkTi=39QZD0UN-xn5Ff08Z8wJexuNNsNy_FDxfLra5@mail.gmail.com>
References: <AANLkTi=39QZD0UN-xn5Ff08Z8wJexuNNsNy_FDxfLra5@mail.gmail.com>
Message-ID: <AANLkTikwcgz5VCO-hGHhy738jLVV2rH1SZ--csPrqORB@mail.gmail.com>

Steven

We have several customers who report good things about Kaazing+Rabbit.

Give it a try!

a


On Tue, Feb 1, 2011 at 5:08 PM, Steven Taylor <taylste at gmail.com> wrote:
> Hi,
>
> I found this link at RabbitMQ.com:
> http://kaazing.net/documentation/howto-amqp-silverlight.html
>
> Has anybody been playing around with it Kaazing?? Has anyone had good
> experiences with this company?
>
> I'm just looking for Silverlight connectivity options without WCF + I'm a
> bit cautious about investing too much time in a demo download.
>
> thanks,
> -Steven
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From yoavglazner at gmail.com  Tue Feb  1 18:43:59 2011
From: yoavglazner at gmail.com (yoav glazner)
Date: Tue, 1 Feb 2011 20:43:59 +0200
Subject: [rabbitmq-discuss] Blocking queue.get() in python?
In-Reply-To: <AANLkTinVO8XSRg4TLEVxJzauu=qtwoS0=T0dxyB_c5oG@mail.gmail.com>
References: <AANLkTinVO8XSRg4TLEVxJzauu=qtwoS0=T0dxyB_c5oG@mail.gmail.com>
Message-ID: <AANLkTinPvG--n97+Om4omsavRXq1H-5dPksMujYCyjGU@mail.gmail.com>

On Mon, Jan 31, 2011 at 9:59 PM, yoav glazner <yoavglazner at gmail.com> wrote:

> Hi,
>
> I'm trying to implement a priority queue over Rabbit with python, and this
> is my idea
> each batch of tasks has its own queue, each worker knows about all the
> batches and their priorities.
> now the part where I don't understand:
>   how does a worker tries a take a task from a batch(queue)  but if its
> empty it passes to the next batch?
>
> I need somthing like:
>
> for q in queuesSortedByPriority:
>   t = q.get()
>   if t: break
> else: raise NoTaskFound()
>

I saw in the java example-
http://www.rabbitmq.com/tutorial-one-java.html
the following line:
QueueingConsumer.nextDelivery() blocks until another message has been
delivered from the server.
I haven't seen anything like this for python. is there anything similar?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110201/4eb755fc/attachment.htm>

From gmr at myyearbook.com  Tue Feb  1 19:03:54 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 1 Feb 2011 14:03:54 -0500
Subject: [rabbitmq-discuss] Blocking queue.get() in python?
In-Reply-To: <AANLkTinPvG--n97+Om4omsavRXq1H-5dPksMujYCyjGU@mail.gmail.com>
References: <AANLkTinVO8XSRg4TLEVxJzauu=qtwoS0=T0dxyB_c5oG@mail.gmail.com>
	<AANLkTinPvG--n97+Om4omsavRXq1H-5dPksMujYCyjGU@mail.gmail.com>
Message-ID: <AANLkTimVfR2Mx+kerktahvSO_RRdkuCf9KgWdohWH7jp@mail.gmail.com>

It's the Basic.Get AMQP command. Pika and other clients implement this.

In pika it's channel.basic_get()

For the blocking behavior, you'll want to use the blocking adapter.

On Tue, Feb 1, 2011 at 1:43 PM, yoav glazner <yoavglazner at gmail.com> wrote:
> On Mon, Jan 31, 2011 at 9:59 PM, yoav glazner <yoavglazner at gmail.com> wrote:
>>
>> Hi,
>> I'm trying to implement a priority queue over Rabbit with python, and this
>> is my idea
>> each batch of tasks has its own queue, each worker knows about all the
>> batches and their priorities.
>> now the part where I don't understand:
>> ??how does a worker tries a take a task from a batch(queue) ?but if its
>> empty it passes to the next batch?
>> I need somthing like:
>> for q in queuesSortedByPriority:
>> ??t = q.get()
>> ??if t: break
>> else: raise NoTaskFound()
>
>
> I saw in the java example-
> http://www.rabbitmq.com/tutorial-one-java.html
> the following line:
> QueueingConsumer.nextDelivery()?blocks until another message has been
> delivered from the server.
> I haven't seen anything like this for python. is there anything similar?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From yoavglazner at gmail.com  Tue Feb  1 19:04:40 2011
From: yoavglazner at gmail.com (yoav glazner)
Date: Tue, 1 Feb 2011 21:04:40 +0200
Subject: [rabbitmq-discuss] Blocking queue.get() in python?
In-Reply-To: <AANLkTinPvG--n97+Om4omsavRXq1H-5dPksMujYCyjGU@mail.gmail.com>
References: <AANLkTinVO8XSRg4TLEVxJzauu=qtwoS0=T0dxyB_c5oG@mail.gmail.com>
	<AANLkTinPvG--n97+Om4omsavRXq1H-5dPksMujYCyjGU@mail.gmail.com>
Message-ID: <AANLkTiknXmZ-9hkd5a33imXhuAEScTZN01m8fPMUKJNe@mail.gmail.com>

> QueueingConsumer.nextDelivery() blocks until another message has been
> delivered from the server.
> I haven't seen anything like this for python. is there anything similar?
>

never mind, found it!
pika:
channel.basic_get
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110201/a8d55b6f/attachment.htm>

From matthew at rabbitmq.com  Tue Feb  1 19:07:14 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 1 Feb 2011 19:07:14 +0000
Subject: [rabbitmq-discuss] Blocking queue.get() in python?
In-Reply-To: <AANLkTimVfR2Mx+kerktahvSO_RRdkuCf9KgWdohWH7jp@mail.gmail.com>
References: <AANLkTinVO8XSRg4TLEVxJzauu=qtwoS0=T0dxyB_c5oG@mail.gmail.com>
	<AANLkTinPvG--n97+Om4omsavRXq1H-5dPksMujYCyjGU@mail.gmail.com>
	<AANLkTimVfR2Mx+kerktahvSO_RRdkuCf9KgWdohWH7jp@mail.gmail.com>
Message-ID: <20110201190714.GB11388@wellquite.org>

On Tue, Feb 01, 2011 at 02:03:54PM -0500, Gavin M. Roy wrote:
> It's the Basic.Get AMQP command. Pika and other clients implement this.

The Java QueuingConsumer does not use basic.get. It uses basic.consume,
as the name suggests. The nextDelivery functionality is provided by
simply blocking the thread until a message is delivered.

Matthew

From yoavglazner at gmail.com  Tue Feb  1 19:07:51 2011
From: yoavglazner at gmail.com (yoav glazner)
Date: Tue, 1 Feb 2011 21:07:51 +0200
Subject: [rabbitmq-discuss] Blocking queue.get() in python?
In-Reply-To: <AANLkTimVfR2Mx+kerktahvSO_RRdkuCf9KgWdohWH7jp@mail.gmail.com>
References: <AANLkTinVO8XSRg4TLEVxJzauu=qtwoS0=T0dxyB_c5oG@mail.gmail.com>
	<AANLkTinPvG--n97+Om4omsavRXq1H-5dPksMujYCyjGU@mail.gmail.com>
	<AANLkTimVfR2Mx+kerktahvSO_RRdkuCf9KgWdohWH7jp@mail.gmail.com>
Message-ID: <AANLkTin5bzP3npVKVy-0Fy1Zwe4jjioZx4DGFtP8hvMp@mail.gmail.com>

>
> In pika it's channel.basic_get()
>

Thanks! although I just found it, it was weird that Google has no examples
with this.

>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110201/783f7cb1/attachment-0001.htm>

From gmr at myyearbook.com  Tue Feb  1 19:08:06 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 1 Feb 2011 14:08:06 -0500
Subject: [rabbitmq-discuss] Blocking queue.get() in python?
In-Reply-To: <20110201190714.GB11388@wellquite.org>
References: <AANLkTinVO8XSRg4TLEVxJzauu=qtwoS0=T0dxyB_c5oG@mail.gmail.com>
	<AANLkTinPvG--n97+Om4omsavRXq1H-5dPksMujYCyjGU@mail.gmail.com>
	<AANLkTimVfR2Mx+kerktahvSO_RRdkuCf9KgWdohWH7jp@mail.gmail.com>
	<20110201190714.GB11388@wellquite.org>
Message-ID: <AANLkTi=4_Bw+NrBv1A5G77RxQY81N+J4XLa_+PfbTWXL@mail.gmail.com>

On Tue, Feb 1, 2011 at 2:07 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Tue, Feb 01, 2011 at 02:03:54PM -0500, Gavin M. Roy wrote:
>> It's the Basic.Get AMQP command. Pika and other clients implement this.
>
> The Java QueuingConsumer does not use basic.get. It uses basic.consume,
> as the name suggests. The nextDelivery functionality is provided by
> simply blocking the thread until a message is delivered.

Ah my bad.

From james.r.carr at gmail.com  Wed Feb  2 03:28:50 2011
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 1 Feb 2011 22:28:50 -0500
Subject: [rabbitmq-discuss] Queue bound by a percentage change?
Message-ID: <AANLkTikyLwaNrrdF=rbWWYkjd+Xx4MROx_08Mqcd5npr@mail.gmail.com>

Hey All,

I've been wondering what kind of scheme would be useful for binding
queues to be notified for certain changes in a value. For example, say
I have a stock system that applications can bind to and be notified
if, for excample, IBM's stock price has risen 2.00 or more, if the
price has dropped more than 2%, etc. What kind of scheme would work
best in this case?

Thanks,
James

From oyvind at tjervaag.com  Wed Feb  2 06:42:33 2011
From: oyvind at tjervaag.com (=?iso-8859-1?Q?=D8yvind_Tjervaag?=)
Date: Wed, 2 Feb 2011 07:42:33 +0100
Subject: [rabbitmq-discuss] Shovel bug? Consumer hangs after network
	failure.
In-Reply-To: <20110127183023.GJ19295@rabbitmq.com>
References: <C0DB3E20-AC51-4027-8E5A-860751563E17@tjervaag.com>
	<20110120224502.GA13371@rabbitmq.com>
	<A353E0E0-8D9C-4985-B413-B2E8D54A35A3@tjervaag.com>
	<20110127183023.GJ19295@rabbitmq.com>
Message-ID: <C9219178-38FA-4DFC-AE01-1E4BE57727D5@tjervaag.com>


On Jan 27, 2011, at 7:30 PM, Matthew Sackman wrote:
> 
> This bug has now been fixed. If you compile the shovel from the latest
> source from our repos, then you'll find that you can now specify
> ?heartbeat=5 at the end of the broker URI (amongst other parameters).
> This will be in the next release if you're not comfortable with
> compiling from source.
> 
> Matthew

Nice :) Thanks!

I've got a project delivery coming up, so I'm all tied up in testing our current setup, but I'll make sure to try out this when I get that out of the way :)

?yvind


From d at unwiredcouch.com  Wed Feb  2 10:50:34 2011
From: d at unwiredcouch.com (Daniel Schauenberg)
Date: Wed, 2 Feb 2011 11:50:34 +0100
Subject: [rabbitmq-discuss] librabbitmq strdup patch
Message-ID: <0C144FE7-5908-44F7-9743-5B75332BC4BB@unwiredcouch.com>

Hi,

I need to interact with a message queue from C++ in a project of mine and want to use RabbitMQ for it. However I did not find a suitable C++ client so I started using librabbitmq. It didn't compile for me on OSX and FreeBSD as strdup is already defined on these platforms. So I patched it to use the librabbitmq strdup definition only if there doesn't already exist one and moved the strdup code into a single .h file.

I submitted a pull request on github (https://github.com/rabbitmq/rabbitmq-c/pull/1). As I am not a C programmer, I'd love some input on this (especially if there is a more suitable #define to check for).

Cheers,
Daniel

From max.bridgewater at gmail.com  Wed Feb  2 10:55:43 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Wed, 2 Feb 2011 05:55:43 -0500
Subject: [rabbitmq-discuss] Any Client for Objective C?
Message-ID: <AANLkTimmRMXNDu-BZriGoQxGT_mP4AOuajHSmHyVw0_M@mail.gmail.com>

Hi Folks,

Am I right that there is not official client for Obj-C? If so, I would
be curious to know what is the reason. And finally, may you please
advise on what could be used for iOS?

Thanks,
Max.

From alexis at rabbitmq.com  Wed Feb  2 11:04:40 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 2 Feb 2011 11:04:40 +0000
Subject: [rabbitmq-discuss] Any Client for Objective C?
In-Reply-To: <AANLkTimmRMXNDu-BZriGoQxGT_mP4AOuajHSmHyVw0_M@mail.gmail.com>
References: <AANLkTimmRMXNDu-BZriGoQxGT_mP4AOuajHSmHyVw0_M@mail.gmail.com>
Message-ID: <AANLkTi=_B=7znFKwas=KLyPSUoErbU_WBA7mJO3hfDJ+@mail.gmail.com>

Max

We hear occasional noises about such a thing but I'm not sure I can
point you at an 'official' one.

I think people have run the C client on iOS.

alexis


On Wed, Feb 2, 2011 at 10:55 AM, Max Bridgewater
<max.bridgewater at gmail.com> wrote:
> Hi Folks,
>
> Am I right that there is not official client for Obj-C? If so, I would
> be curious to know what is the reason. And finally, may you please
> advise on what could be used for iOS?
>
> Thanks,
> Max.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From max.bridgewater at gmail.com  Wed Feb  2 11:44:00 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Wed, 2 Feb 2011 06:44:00 -0500
Subject: [rabbitmq-discuss] Any Client for Objective C?
In-Reply-To: <AANLkTi=_B=7znFKwas=KLyPSUoErbU_WBA7mJO3hfDJ+@mail.gmail.com>
References: <AANLkTimmRMXNDu-BZriGoQxGT_mP4AOuajHSmHyVw0_M@mail.gmail.com>
	<AANLkTi=_B=7znFKwas=KLyPSUoErbU_WBA7mJO3hfDJ+@mail.gmail.com>
Message-ID: <AANLkTimLdV9iEZTG-=mcRsTi0pHUgty=Us=JYb=ZBUvV@mail.gmail.com>

Thanks Alexis. I will give it a try.

Max.

On Wed, Feb 2, 2011 at 6:04 AM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Max
>
> We hear occasional noises about such a thing but I'm not sure I can
> point you at an 'official' one.
>
> I think people have run the C client on iOS.
>
> alexis
>
>
> On Wed, Feb 2, 2011 at 10:55 AM, Max Bridgewater
> <max.bridgewater at gmail.com> wrote:
>> Hi Folks,
>>
>> Am I right that there is not official client for Obj-C? If so, I would
>> be curious to know what is the reason. And finally, may you please
>> advise on what could be used for iOS?
>>
>> Thanks,
>> Max.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From Waseem_Hawaldar at mindtree.com  Wed Feb  2 11:59:02 2011
From: Waseem_Hawaldar at mindtree.com (Waseem Hawaldar)
Date: Wed, 2 Feb 2011 11:59:02 +0000
Subject: [rabbitmq-discuss] Changes needed to switch from rabbitMq 1.8 to
	rabbitMq 2.2
Message-ID: <192E282CAB256F41A2161A9E1BAA7C5E089C49@MTW02MBX01.mindtree.com>


I want to know as to what changes should be done applicationwise to switch from 1.8 version to 2.2.

Regards,
Waseem:)

Waseem Hawaldar| Open Source Practice | MindTree Ltd [untitled] | Ecospace, outer ring road , Belandur(Accenture Office).  Bangalore-560 059, INDIA | Project Aadhaar - UIDAI |Mob: +91 9900588758 | email: waseem_hawaldar at mindtree.com| www.mindtree.com |


________________________________

http://www.mindtree.com/email/disclaimer.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110202/dd61e557/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 1026 bytes
Desc: image001.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110202/dd61e557/attachment-0001.gif>

From majek04 at gmail.com  Wed Feb  2 12:06:39 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 2 Feb 2011 12:06:39 +0000
Subject: [rabbitmq-discuss] What is the best option for work sharing
 that needs topic like selective message receival?
In-Reply-To: <AANLkTinmxAPKvjz1eg=ByV23X9xJgBsqYQmOjbMbqD3X@mail.gmail.com>
References: <AANLkTinPPog61Qgt-xFNvn-UFeYkrMUhH3xuwM-Xdvvx@mail.gmail.com>
	<AANLkTikdyn33xfu+FZjKVTo+X=9BhN_gNqCLzBk4Xp=i@mail.gmail.com>
	<AANLkTinmxAPKvjz1eg=ByV23X9xJgBsqYQmOjbMbqD3X@mail.gmail.com>
Message-ID: <AANLkTi=pcmT-6sCLqAGu6zWX9Xvo=dKXsxGASTu8Z2eT@mail.gmail.com>

On Mon, Jan 31, 2011 at 19:39, Enno Shioji <eshioji at gmail.com> wrote:
>> I'm afraid the problem needs some more explanation.
>> ?- what's wrong with just one fat queue that is shared between workers?
> Some workers can perform certain categories of jobs, while some
> workers can perform other categories of job. I.e. workers cannot
> perform all category of jobs. They can only perform a subset of job
> category.

Great.
You've just defined your routing methodology.
I guess the same relations should be represented
using bindings and queues.

The simplest thing to do, would be probably to have
on queue per category, and if a consumer can do
jobs from multiple categories - it should bind to multiple
queues.

On the other hand queues are relatively heavyweight,
and it would be more efficient to have only one queue per
consumer. But that's harder to manage dynamically.

> So, if there is a fat queue, many consumers will pull
> messages that they cannot consume and would have to put those back
> into the queue (which I think would be very inefficient).
>
>> ?- are all the tasks going to take roughly the same time?
> At the current moment, yes.
>
>> ?- do you need to prioritize the tasks?
> It would be nice to roughly prioritize the tasks (it doesn't have to
> be strict), but it'd be more of a "nice to have" requirement...
>
>
>
> Regards,
> Enno
>
>
>
>
>
> On Mon, Jan 31, 2011 at 11:36 PM, Marek Majkowski <majek04 at gmail.com> wrote:
>> On Mon, Jan 31, 2011 at 09:40, Enno Shioji <eshioji at gmail.com> wrote:
>>> I have an app. I would like to migrate to AMQP based architecture. The
>>> main component/functionality of this app. is to distribute work based
>>> on some rules.
>>>
>>> After learning a little bit about AMQP, I concluded that the way to
>>> achieve this is to have the producer send "jobs" to a direct exchange
>>> with routing keys that indicate the nature of the jobs (let's call it
>>> "job category"), and having queues that binds to each unique routing
>>> key, and then having consumers listening on these queues. Multiple
>>> consumers may listen to the same queue. One job should only be
>>> performed once system-wide (but is not strictly required as long as
>>> performance loss is not significant).
>>>
>>> My problem is that the number of such "job category" increases
>>> overtime. E.g. if in the beginning there is only one routing keys such
>>> as "key.stuff.1.A", overtime keys like "key.stuff.2.A" or
>>> "key.stuff.2.B" will start to emerge and eventually such categories
>>> will reach a large number. However, older categories will eventually
>>> become obsolete so at a given time I would have at most something like
>>> 20K different "job categories". But overtime I would have a LOT of job
>>> categories. (Lifetime of each "job category" depends and can be
>>> anything from 1 day to 1 seconds etc..)
>>>
>>> I'm wondering if there is a better way to achieve what I want.
>>>
>>> If this helps, everything can be transient and non durable. Message
>>> loss can be tolerated as long as it's not too frequent (e.g. once per
>>> 10K msgs etc.)
>>
>> I'm afraid the problem needs some more explanation.
>> ?- what's wrong with just one fat queue that is shared between workers?
>> ?- are all the tasks going to take roughly the same time?
>> ?- do you need to prioritize the tasks?
>>
>> Cheers,
>> ?Marek
>>
>

From rtrlists at googlemail.com  Wed Feb  2 12:10:32 2011
From: rtrlists at googlemail.com (Robert Raschke)
Date: Wed, 2 Feb 2011 12:10:32 +0000
Subject: [rabbitmq-discuss] Queue bound by a percentage change?
In-Reply-To: <AANLkTikyLwaNrrdF=rbWWYkjd+Xx4MROx_08Mqcd5npr@mail.gmail.com>
References: <AANLkTikyLwaNrrdF=rbWWYkjd+Xx4MROx_08Mqcd5npr@mail.gmail.com>
Message-ID: <AANLkTikSEn=iS4pcQwetKiFAFs8dw9=qS0bFWt6hvP-P@mail.gmail.com>

On Wed, Feb 2, 2011 at 3:28 AM, James Carr <james.r.carr at gmail.com> wrote:

> I've been wondering what kind of scheme would be useful for binding
> queues to be notified for certain changes in a value. For example, say
> I have a stock system that applications can bind to and be notified
> if, for excample, IBM's stock price has risen 2.00 or more, if the
> price has dropped more than 2%, etc. What kind of scheme would work
> best in this case?
>

If you really need to do this kind of thing through a queue binding, rather
than consumer value checks, the only thing that comes to mind is to have the
producer band the values, so you can subscribe to bands. For example, have
the producer use 1% bands in the routing key, 0 for 0<= x < 1, 1 for 1<= x
<2, etc. and then bind your queue to as many ranges as you are interested.

Or you could use a filtering shovel, which does the range checking for you.

And just in case, you aren't talking about keeping track of the %-age
change? Cause that would involve keeping state in a sliding window and make
things a wee bit more complicated.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110202/fdc35f0e/attachment.htm>

From matthew at rabbitmq.com  Wed Feb  2 12:14:10 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 2 Feb 2011 12:14:10 +0000
Subject: [rabbitmq-discuss] Queue bound by a percentage change?
In-Reply-To: <AANLkTikSEn=iS4pcQwetKiFAFs8dw9=qS0bFWt6hvP-P@mail.gmail.com>
References: <AANLkTikyLwaNrrdF=rbWWYkjd+Xx4MROx_08Mqcd5npr@mail.gmail.com>
	<AANLkTikSEn=iS4pcQwetKiFAFs8dw9=qS0bFWt6hvP-P@mail.gmail.com>
Message-ID: <20110202121410.GA6008@rabbitmq.com>

On Wed, Feb 02, 2011 at 12:10:32PM +0000, Robert Raschke wrote:
> And just in case, you aren't talking about keeping track of the %-age
> change? Cause that would involve keeping state in a sliding window and make
> things a wee bit more complicated.

Yeah, you could do it with an exchange type, but it's tricky currently
(though will be improved in future releases) for exchange types to have
state.

Matthew

From emile at rabbitmq.com  Wed Feb  2 12:43:00 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 02 Feb 2011 12:43:00 +0000
Subject: [rabbitmq-discuss] Changes needed to switch from rabbitMq 1.8
 to rabbitMq 2.2
In-Reply-To: <192E282CAB256F41A2161A9E1BAA7C5E089C49@MTW02MBX01.mindtree.com>
References: <192E282CAB256F41A2161A9E1BAA7C5E089C49@MTW02MBX01.mindtree.com>
Message-ID: <4D495154.5060506@rabbitmq.com>

Hi Waseem,

On 02/02/11 11:59, Waseem Hawaldar wrote:
> I want to know as to what changes should be done applicationwise to
> switch from 1.8 version to 2.2.

Changes that might affect applications are listed in the release notes. 
If your application makes use of any parts of the API that changed (e.g. 
renaming of noAck to autoAck in the Java client) then you will need to 
modify your code accordingly. You might also want to look at extensions 
that were developed since version 1.8.1 and see whether any are relevant 
to you.

Details about extensions can be found here
http://www.rabbitmq.com/extensions.html

Previous announcements can be found here if you are not subscribed:
http://lists.rabbitmq.com/pipermail/rabbitmq-announce/


Regards

Emile

From dis1 at sonicsnes.net  Wed Feb  2 09:48:04 2011
From: dis1 at sonicsnes.net (SonicSNES)
Date: Wed, 2 Feb 2011 01:48:04 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-stomp adapter tweaks
Message-ID: <82106507-d30b-410b-b842-afe0a7e1a276@33g2000pru.googlegroups.com>

I've been moving around a bunch of code in rabbitmq-stomp to tailor it
specifically for my app, and hit one tiny roadblock which is
preventing me from finishing.

How would I go about bypassing the login sequence, so the client gets
a CONNECTED as soon as it connects? I'm trying to call do_login from
init, but my with limited erlang skills, all I can get it to do is
hang, time out, or catch on fire. I'd assume it's just a tiny bit of
code, but I'm stumped.

-- SS

From simon at rabbitmq.com  Wed Feb  2 15:38:57 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 02 Feb 2011 15:38:57 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.3.0 Release
Message-ID: <4D497A91.4060302@rabbitmq.com>

Perfectly timed one day before the start of the year of the Rabbit, the 
RabbitMQ team is pleased to announce the release of RabbitMQ
2.3.0.

This release fixes a number of bugs and introduces some enhancements,
including streaming publish confirmations, new plugin mechanisms for 
authentication and authorisation, and a great deal more.

See the attached release notes for more details.

Binary and source distributions of the new release can be found in the
usual place at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to
this latest release.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.

Regards,
                The RabbitMQ Team








-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.3.0.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110202/f660b95c/attachment-0001.txt>

From jbrisbin at vmware.com  Wed Feb  2 16:15:09 2011
From: jbrisbin at vmware.com (Jonathan Brisbin)
Date: Wed, 2 Feb 2011 08:15:09 -0800
Subject: [rabbitmq-discuss] amqp_client rabbit_common updated to 2.3.0
Message-ID: <67ED217C-1530-4B32-9567-062FB36F9975@vmware.com>

Thanks for the hard work going into the 2.3.0 release! :)

I've updated the rebar-friendly versions of the amqp_client and rabbit_common to the 2.3.0 tag.

https://github.com/jbrisbin/amqp_client
<https://github.com/jbrisbin/amqp_client>https://github.com/jbrisbin/rabbit_common

<https://github.com/jbrisbin/rabbit_common>I'm also going to update the webhooks plugin to make sure it's 2.3.0 compatible and I'll convert it to using rebar, while I'm in there mucking about.

Thanks!

Jon Brisbin

Twitter: @j_brisbin
Skype: jon.brisbin



From jbrisbin at vmware.com  Wed Feb  2 17:06:43 2011
From: jbrisbin at vmware.com (Jonathan Brisbin)
Date: Wed, 2 Feb 2011 09:06:43 -0800
Subject: [rabbitmq-discuss] Updated webhooks plugin for 2.3.0
Message-ID: <8AA4C998-E04E-47F0-B803-57A9E98BA49E@vmware.com>

I updated the Webhooks plugin to use rebar for the build, which also included an update to use v2.3.0 of the Erlang client.

I also uploaded a new tar file of the plugin and its dependencies that can be used with the 2.3.0 broker.


https://github.com/jbrisbin/rabbitmq-webhooks
<https://github.com/jbrisbin/rabbitmq-webhooks>

Thanks!

Jon Brisbin

Twitter: @j_brisbin
Skype: jon.brisbin



From lionel.cons at cern.ch  Wed Feb  2 17:08:16 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 2 Feb 2011 18:08:16 +0100
Subject: [rabbitmq-discuss] RabbitMQ Configuration Files
Message-ID: <AANLkTikhYGFTLS7G5VxXsin+WVO7=3=vW0BbX89m6uu1@mail.gmail.com>

I'm trying to understand how RabbitMQ can be configured from a set of
files and/or scripts. I don't need a GUI, I just need to be able to
instantiate a broker on an empty machine.

According to the doc, there are two main files: rabbitmq.conf (to set
some environment variables) and rabbitmq.config (with Erlang syntax).

Out of all the things that can be configured, are there some that
cannot be defined in one of these two files? rabbitmq.config seems to
be all-mighty but a previous answer
(http://old.nabble.com/rabbitmq-configuration-file-and-access-control-td30018285.html)
seems to indicate that scripting is needed for ACLs, at least.

The doc for rabbitmq.config
(http://www.rabbitmq.com/install.html#configfile) is rather short. Not
knowing the internals, it is quite difficult to find out what can be
configured. Is there a documented list of all the things that can be
set in this file?

Is there a way to tell a configured broker to dump its configuration
in the same syntax as the rabbitmq.config file? (like iptables-save
and iptables-restore do for firewall configuration)

Cheers,

Lionel Cons

From jasonjwwilliams at gmail.com  Wed Feb  2 17:42:43 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 2 Feb 2011 10:42:43 -0700
Subject: [rabbitmq-discuss] RabbitMQ 2.3.0 Release
In-Reply-To: <4D497A91.4060302@rabbitmq.com>
References: <4D497A91.4060302@rabbitmq.com>
Message-ID: <AANLkTikrz2NK2zp_ALb4fCQmAyDQ4Cc_PG5bQiqHn7wz@mail.gmail.com>

Thank you for all the hard work guys. :) The delivery confirmations
look terrific.

-J

P.S.
Have you guys considered adding a plugin package manager to
rabbitmqctl? Would make it really easy to re-install the latest
plugins when you upgrade.

On Wed, Feb 2, 2011 at 8:38 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> Perfectly timed one day before the start of the year of the Rabbit, the
> RabbitMQ team is pleased to announce the release of RabbitMQ
> 2.3.0.
>
> This release fixes a number of bugs and introduces some enhancements,
> including streaming publish confirmations, new plugin mechanisms for
> authentication and authorisation, and a great deal more.
>
> See the attached release notes for more details.
>
> Binary and source distributions of the new release can be found in the
> usual place at http://www.rabbitmq.com/download.html
>
> We recommend that all users of earlier versions of RabbitMQ upgrade to
> this latest release.
>
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
> info at rabbitmq.com.
>
> Regards,
> ? ? ? ? ? ? ? The RabbitMQ Team
>
>
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From simon at rabbitmq.com  Wed Feb  2 17:45:50 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 02 Feb 2011 17:45:50 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.3.0 Release
In-Reply-To: <AANLkTikrz2NK2zp_ALb4fCQmAyDQ4Cc_PG5bQiqHn7wz@mail.gmail.com>
References: <4D497A91.4060302@rabbitmq.com>
	<AANLkTikrz2NK2zp_ALb4fCQmAyDQ4Cc_PG5bQiqHn7wz@mail.gmail.com>
Message-ID: <4D49984E.9090903@rabbitmq.com>

On 02/02/11 17:42, Jason J. W. Williams wrote:
> Thank you for all the hard work guys. :) The delivery confirmations
> look terrific.

Thank you!

> Have you guys considered adding a plugin package manager to
> rabbitmqctl? Would make it really easy to re-install the latest
> plugins when you upgrade.

Oh, we've talked about all sorts of ways to improve the plugin 
experience. Debian / RPM packages per plugin. A single package / 
download containing all plugins and an a2enmod type script. A mini 
package manager. A windows installer with checkboxes. All sorts of 
things :) Hopefully at some point we'll get something built...

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Wed Feb  2 18:01:03 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 02 Feb 2011 18:01:03 +0000
Subject: [rabbitmq-discuss] RabbitMQ Configuration Files
In-Reply-To: <AANLkTikhYGFTLS7G5VxXsin+WVO7=3=vW0BbX89m6uu1@mail.gmail.com>
References: <AANLkTikhYGFTLS7G5VxXsin+WVO7=3=vW0BbX89m6uu1@mail.gmail.com>
Message-ID: <4D499BDF.3060809@rabbitmq.com>

On 02/02/11 17:08, Lionel Cons wrote:
> According to the doc, there are two main files: rabbitmq.conf (to set
> some environment variables) and rabbitmq.config (with Erlang syntax).
>
> Out of all the things that can be configured, are there some that
> cannot be defined in one of these two files? rabbitmq.config seems to
> be all-mighty

Yes, there are. Those files (hopefully at some point rabbitmq.conf will 
go away) are for server-wide configuration, e.g.:

* Which ports should be opened?
* Where are SSL certs?
* Where should the LDAP plugin find an LDAP server?

> but a previous answer
> (http://old.nabble.com/rabbitmq-configuration-file-and-access-control-td30018285.html)
> seems to indicate that scripting is needed for ACLs, at least.

...but they don't contain anything about exchanges, bindings, queues, 
users, vhosts or permissions. For that you can use rabbitmqctl or the 
management plugin.

> The doc for rabbitmq.config
> (http://www.rabbitmq.com/install.html#configfile) is rather short. Not
> knowing the internals, it is quite difficult to find out what can be
> configured. Is there a documented list of all the things that can be
> set in this file?

Sadly no. We need to improve documentation in this area.

> Is there a way to tell a configured broker to dump its configuration
> in the same syntax as the rabbitmq.config file? (like iptables-save
> and iptables-restore do for firewall configuration)

Not in that format. The closest we can get is the management plugin, 
which can dump / restore the exchanges, queues, users etc into a JSON 
file. There's a command line tool which can do this so you don't have to 
use the GUI.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From dtenenba at fhcrc.org  Wed Feb  2 21:37:54 2011
From: dtenenba at fhcrc.org (Dan Tenenbaum)
Date: Wed, 2 Feb 2011 13:37:54 -0800
Subject: [rabbitmq-discuss] publishing messages causes messages to stop
	being collected
Message-ID: <AANLkTiksgQH=a2GPNE=QOPzTf=VSRtw-Jt2EBfHAYtfp@mail.gmail.com>

Hi,

I had developed a solution using rabbitmq and it was working fine. Then I
started another instance of one of my apps on another machine and both
instances stopped receiving messages. Here is more detail.

I have a setup with two fanout exchanges, call them e1 and e2.

I have two apps, one (call it a1) written in node-amqp and the other (a2) in
python/pika.

The workflow is:
1) a1 publishes a message to e1

2) a2 is listening to e1, receives the message , starts sending a series of
messages to e2.

3) a1 is listening to e2 and prints out the messages it receives.

All 3 steps were working, then I added another instance of a1 on another
machine and step 3 stopped working. Neither instance of a1 receives any more
messages. rabbitmqctl tells me they are piling up in the queue, and a2 logs
also tell me step 2 is still happening.

Specifically, the action that caused step 3 to fail was not simply adding
another instance of a1 but having that instance do step 1.

Here are what I think are the relevant bits of code.

In a1:
var connection = amqp.createConnection({ host: 'broker_host' });
connection.addListener('ready', function(){
  //this is what I'm calling e1:
  var from_web_exchange = connection.exchange('from_web_exchange', {type:
'fanout', autoDelete: false});
  // and e2:
  var from_worker_exchange = connection.exchange('from_worker_exchange',
{type: 'fanout', autoDelete: false});
  //hostname contains the name of the machine where this app is running.
 //there will only be one instance of this app per machine
  var queueName = hostname + "_queue";
  var fromBuildersQueue = connection.queue(queueName, {exclusive: true})
  fromBuildersQueue.bind('from_worker_exchange', '#')

    fromBuildersQueue.subscribe( {ack:true}, function(message){
      sys.puts("got message: " + message.data.toString());
   }
  ...

//later:
        var msg = "hello, world";
        from_web_exchange.publish("#", msg);


in a2:

# e1:
from_web_exchange =
channel.exchange_declare(exchange="from_web_exchange",type="fanout")
# e2:
from_worker_exchange =
channel.exchange_declare(exchange="from_worker_exchange", type='fanout')

from_web_queue = channel.queue_declare(exclusive=True)
from_web_queue_name = from_web_queue.queue

channel.queue_bind(exchange='from_web_exchange', queue=from_web_queue_name)

def callback(ch, method, properties, body):
          channel.basic_publish(exchange='from_worker_exchange',
                              routing_key="key.frombuilders",
                              body= "hello world from python")

channel.basic_consume(callback,
                      queue=from_web_queue.queue,
                      no_ack=True)

pika.asyncore_loop()

---
rabbitmqctl list_queues reports:

Listing queues ...
host1_queue 7
amq.gen-AGnTMUOdr+DdImg0jfqahA== 0
host2_queue 0
...done.


Hope someone can tell me what is going on here. a1 is a web app and the
first instance of it is on my local machine, and a2 represents me trying to
deploy this app in a production environment.

Thanks!
Dan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110202/9d78ede3/attachment-0001.htm>

From muesli.john at gmail.com  Wed Feb  2 21:52:17 2011
From: muesli.john at gmail.com (Muesli John)
Date: Wed, 2 Feb 2011 16:52:17 -0500
Subject: [rabbitmq-discuss] Available for MQ Design/Implementation Work
Message-ID: <AANLkTikWjP2z+rsXN3HLtWYXNsGBk9UM5U0ywr17V0Uh@mail.gmail.com>

Hi Folks,

I hope I'm not crossing the boundaries with my request. I would like to
gently inquire if anybody in the list, by any chance, needs some (Rabbit)MQ
consultancy. If so, I would be available both as designer, architect or
developer. I reside in Toronto and have more than 10 years of industrial and
academical experience (incl. research papers) with event driven systems.

Thanks for  bearing with me.

Muesli.John (at) Gmail
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110202/2b369b21/attachment.htm>

From jurdanas.kriauciunas at gmail.com  Wed Feb  2 18:27:45 2011
From: jurdanas.kriauciunas at gmail.com (Jurdanas Kriauciunas)
Date: Wed, 2 Feb 2011 10:27:45 -0800 (PST)
Subject: [rabbitmq-discuss] Sending message through rabbitmq-stomp ->
	exchange(topic) - crashes queue
Message-ID: <989107b2-fa2d-4c95-bcc1-cb411fc5d093@v7g2000yqh.googlegroups.com>

Hi,

I have a problem with rabbitmq-stomp sending to exchange and receiving
messages through amqp.
In example I create exchange (type=topic): hm
Python clients creates "anonymous" queue and binds to exchange: hm.
with test.# routing key pattern.
Stomp client sends message to destination: /exchange/hm/test.stompkey

At this time "anonymous" queue dies. It also can be seen from web
management.
Interestingly stomp to stomp through rabbitmq works ok. (eg. subscribe
send). Also stomp can receive messages sent from python (or java)
client without big problems.
Versions tested: 2.1.1, 2.2.0 and newest 2.3.0. All have same problem
(2.1.1 has different destination naming and extra headers). But newest
version sends error back at least.

---
Here is excerpt from .log file:
=ERROR REPORT==== 2-Feb-2011::19:50:38 ===
Error in process <0.2811.0> on node 'rabbit at JOSKIS-PC' with exit
value: {badarg,[{erlang,size,[[<<9 bytes>>]]},
{rabbit_binary_generator,build_content_frames,7},
{rabbit_binary_generator,build_simple_content_frames,4},
{rabbit_writer,assemble_frames,5},
{rabbit_writer,internal_send_command_async...


=ERROR REPORT==== 2-Feb-2011::19:50:38 ===
connection <0.2809.0> (running), channel 1 - error:
shutdown

=WARNING REPORT==== 2-Feb-2011::19:50:38 ===
Non-AMQP exit reason 'shutdown'

=INFO REPORT==== 2-Feb-2011::19:50:38 ===
closing TCP connection <0.2809.0> from 127.0.0.1:64551

=INFO REPORT==== 2-Feb-2011::19:51:38 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:64562

=INFO REPORT==== 2-Feb-2011::19:51:38 ===
starting TCP connection <0.3603.0> from 127.0.0.1:64562

=INFO REPORT==== 2-Feb-2011::19:51:38 ===
closing TCP connection <0.3603.0> from 127.0.0.1:64562

=INFO REPORT==== 2-Feb-2011::19:51:47 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:64565

=INFO REPORT==== 2-Feb-2011::19:51:47 ===
starting TCP connection <0.3706.0> from 127.0.0.1:64565

=ERROR REPORT==== 2-Feb-2011::19:51:51 ===
connection <0.3706.0> (running), channel 1 - error:
shutdown

=WARNING REPORT==== 2-Feb-2011::19:51:51 ===
Non-AMQP exit reason 'shutdown'

=INFO REPORT==== 2-Feb-2011::19:51:51 ===
closing TCP connection <0.3706.0> from 127.0.0.1:64565

=INFO REPORT==== 2-Feb-2011::19:53:58 ===
ending STOMP connection <0.1344.0> from 127.0.0.1:64522


---
Here is excerpt from -sasl.log file:

=SUPERVISOR REPORT==== 2-Feb-2011::19:50:38 ===
     Supervisor: {<0.2810.0>,rabbit_channel_sup}
     Context:    child_terminated
     Reason:     {badarg,
                     [{erlang,size,[[<<"how are u">>]]},
                      {rabbit_binary_generator,build_content_frames,
7},
 
{rabbit_binary_generator,build_simple_content_frames,4},
                      {rabbit_writer,assemble_frames,5},
                      {rabbit_writer,internal_send_command_async,3},
                      {rabbit_writer,handle_message,2},
                      {rabbit_writer,mainloop1,2},
                      {rabbit_writer,mainloop,2}]}
     Offender:   [{pid,<0.2811.0>},
                  {name,writer},
                  {mfa,{rabbit_writer,start_link,
                                      [#Port<0.4445>,1,131072,
 
rabbit_framing_amqp_0_8,<0.2809.0>]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 2-Feb-2011::19:50:38 ===
     Supervisor: {<0.2810.0>,rabbit_channel_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.2811.0>},
                  {name,writer},
                  {mfa,{rabbit_writer,start_link,
                                      [#Port<0.4445>,1,131072,
 
rabbit_framing_amqp_0_8,<0.2809.0>]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]


=CRASH REPORT==== 2-Feb-2011::19:51:51 ===
  crasher:
    initial call: rabbit_writer:mainloop/2
    pid: <0.3708.0>
    registered_name: []
    exception error: bad argument
      in function  size/1
         called as size([<<"how are u">>])
      in call from rabbit_binary_generator:build_content_frames/7
      in call from rabbit_binary_generator:build_simple_content_frames/
4
      in call from rabbit_writer:assemble_frames/5
      in call from rabbit_writer:internal_send_command_async/3
      in call from rabbit_writer:handle_message/2
      in call from rabbit_writer:mainloop1/2
      in call from rabbit_writer:mainloop/2
    ancestors:
[<0.3707.0>,<0.3705.0>,<0.3703.0>,rabbit_tcp_client_sup,
                  rabbit_sup,<0.70.0>]
    messages: []
    links: [<0.3707.0>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 377
    stack_size: 24
    reductions: 218
  neighbours:

=SUPERVISOR REPORT==== 2-Feb-2011::19:51:51 ===
     Supervisor: {<0.3707.0>,rabbit_channel_sup}
     Context:    child_terminated
     Reason:     badarg
     Offender:   [{pid,<0.3708.0>},
                  {name,writer},
                  {mfa,{rabbit_writer,start_link,
                                      [#Port<0.4449>,1,131072,
 
rabbit_framing_amqp_0_8,<0.3706.0>]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 2-Feb-2011::19:51:51 ===
     Supervisor: {<0.3707.0>,rabbit_channel_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.3708.0>},
                  {name,writer},
                  {mfa,{rabbit_writer,start_link,
                                      [#Port<0.4449>,1,131072,
 
rabbit_framing_amqp_0_8,<0.3706.0>]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]

From james.r.carr at gmail.com  Wed Feb  2 23:15:10 2011
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 2 Feb 2011 18:15:10 -0500
Subject: [rabbitmq-discuss] Management Plugin Causes Fault?
Message-ID: <AANLkTinoNO7OS4hFnDUz0p9AAG-x0nCDVxk09H69+vei@mail.gmail.com>

Hi All,

I'd love to get the management plugin working to try it out but it
just doesn't seem to work for me (I know it's experimental so I am
taking it with a grain of salt). I have copied the following files to
/usr/lib/rabbitmq/lib/rabbitmq_server-2.3.0/plugins:


amqp_client-2.3.0.ez          rabbitmq-management-agent-2.3.0.ez
mochiweb-2.3.0.ez             rabbitmq-mochiweb-2.3.0.ez
rabbitmq-management-2.3.0.ez  webmachine-2.3.0.ez

When I try to start rabbitmq-server I get the following:

Activating RabbitMQ plugins ...
*WARNING* Undefined function erlang:max/2
*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
*WARNING* Undefined function lists:keyfind/3
*WARNING* Undefined function ssl:ssl_accept/3
*WARNING* Undefined function webmachine_resource:start_link/2
6 plugins activated:
* amqp_client-2.3.0
* mochiweb-1.3
* rabbit_management-2.3.0
* rabbit_management_agent-2.3.0
* rabbit_mochiweb-2.3.0
* webmachine-1.7.0

{"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}})

I can only guess that the undefined functions are related to perhaps
having a dusty version of erlang installed so I'll upgrade and give a
try again, just wondering if there might be something else I am
missing. :)


Thanks,
James

From matthew at rabbitmq.com  Wed Feb  2 23:48:19 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 2 Feb 2011 23:48:19 +0000
Subject: [rabbitmq-discuss] Sending message through rabbitmq-stomp ->
 exchange(topic) - crashes queue
In-Reply-To: <989107b2-fa2d-4c95-bcc1-cb411fc5d093@v7g2000yqh.googlegroups.com>
References: <989107b2-fa2d-4c95-bcc1-cb411fc5d093@v7g2000yqh.googlegroups.com>
Message-ID: <20110202234818.GB25295@wellquite.org>

On Wed, Feb 02, 2011 at 10:27:45AM -0800, Jurdanas Kriauciunas wrote:
> Versions tested: 2.1.1, 2.2.0 and newest 2.3.0. All have same problem
> (2.1.1 has different destination naming and extra headers). But newest
> version sends error back at least.

Good to know this isn't a bug that's recently been introduced.

> Here is excerpt from .log file:
> =ERROR REPORT==== 2-Feb-2011::19:50:38 ===
> Error in process <0.2811.0> on node 'rabbit at JOSKIS-PC' with exit
> value: {badarg,[{erlang,size,[[<<9 bytes>>]]},
> {rabbit_binary_generator,build_content_frames,7},
> {rabbit_binary_generator,build_simple_content_frames,4},
> {rabbit_writer,assemble_frames,5},
> {rabbit_writer,internal_send_command_async...

Ok, so the message payload is being sent through as a list instead of as
a binary. My guess without checking further is this is a bug in the
stomp client in the way it constructs the messages which are then sent
further into Rabbit, but this may not be the case.

Is there any chance you can send the python code that you use (short and
simple though it may be) that triggers this crash?

Many thanks,

Matthew

From matthew at rabbitmq.com  Wed Feb  2 23:50:53 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 2 Feb 2011 23:50:53 +0000
Subject: [rabbitmq-discuss] Management Plugin Causes Fault?
In-Reply-To: <AANLkTinoNO7OS4hFnDUz0p9AAG-x0nCDVxk09H69+vei@mail.gmail.com>
References: <AANLkTinoNO7OS4hFnDUz0p9AAG-x0nCDVxk09H69+vei@mail.gmail.com>
Message-ID: <20110202235053.GC25295@wellquite.org>

On Wed, Feb 02, 2011 at 06:15:10PM -0500, James Carr wrote:
> Activating RabbitMQ plugins ...
> *WARNING* Undefined function erlang:max/2

Woah, that's an R14ism. That's a clear bug, but might be solved by
upgrading your version of Erlang to the latest (assuming there aren't
other bugs revealed by this).

> *WARNING* Undefined function fdsrv:bind_socket/2
> *WARNING* Undefined function fdsrv:start/0
> *WARNING* Undefined function fdsrv:stop/0
> *WARNING* Undefined function lists:keyfind/3
> *WARNING* Undefined function ssl:ssl_accept/3
> *WARNING* Undefined function webmachine_resource:start_link/2
> 6 plugins activated:
> * amqp_client-2.3.0
> * mochiweb-1.3
> * rabbit_management-2.3.0
> * rabbit_management_agent-2.3.0
> * rabbit_mochiweb-2.3.0
> * webmachine-1.7.0
> 
> {"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}}"}
> 
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}})
> 
> I can only guess that the undefined functions are related to perhaps
> having a dusty version of erlang installed so I'll upgrade and give a
> try again, just wondering if there might be something else I am
> missing. :)
> 
> 
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From paul.pearcy at wallst.com  Wed Feb  2 23:51:43 2011
From: paul.pearcy at wallst.com (Paul Pearcy)
Date: Wed, 2 Feb 2011 18:51:43 -0500
Subject: [rabbitmq-discuss] Mgmt plug-in on 2.3.0
Message-ID: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CBF@IS-EXCHANGEC101.wsod.local>

Hello,
  I upgraded to 2.3.0 on CentOS5. Did so by stopping the service, uninstalling 2.2 RPM, and using the new 2.3. Afterwards, I installed the mgmt plugin by placing all of the new .ez files into the plugins directory.

When I start things up, everything looks correct(I think), as shown below, but the mgmt plugin doesn't seem to work. Initially, I could get to the mgmt URL, but only am able to view the header bar and no details show up under the different tabs (maybe this was my browser caching some details?). I rebooted the server to be sure and now I get a page that says:
Contexts available:

 *   /rpc
 *   /rabbitmq_lib

Any ideas where I could have gone wrong? I do see a decent number of errors now in my logs that I don't understand that are probably the true underlying cause, but am just guessing. I can send these details, if needed.

I downgraded back to 2.2 and everything works as expected again (with the caveat that I had to blow away my mnesia db, as there were "future_upgrades_found", which makes sense).

Thanks,
Paul

Here is the startup log:

Activating RabbitMQ plugins ...
*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
6 plugins activated:
* amqp_client-2.3.0
* mochiweb-1.3
* rabbit_jsonrpc-2.3.0
* rabbit_jsonrpc_channel-2.3.0
* rabbit_mochiweb-2.3.0
* rfc4627_jsonrpc-0.01


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.3.0  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at dm-essearchd101
app descriptor : /usr/lib/rabbitmq/lib/rabbitmq_server-2.3.0/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : fHvpRXzyPQzgh7d2ZgynpA==
log            : /var/log/rabbitmq/rabbit at dm-essearchd101.log
sasl log       : /var/log/rabbitmq/rabbit at dm-essearchd101-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at dm-essearchd101
erlang version : 5.8.1

starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...done
starting codec correctness check                                      ...done
-- external infrastructure ready
starting plugin registry                                              ...done
starting auth mechanism cr-demo                                       ...done
starting auth mechanism amqplain                                      ...done
starting auth mechanism plain                                         ...done
starting statistics event manager                                     ...done
starting logging server                                               ...done
starting exchange type direct                                         ...done
starting exchange type fanout                                         ...done
starting exchange type headers                                        ...done
starting exchange type topic                                          ...done
-- kernel ready
starting alarm handler                                                ...done
starting node monitor                                                 ...done
starting cluster delegate                                             ...done
starting guid generator                                               ...done
starting memory monitor                                               ...done
-- core initialized
starting empty DB check                                               ...done
starting exchange recovery                                            ...done
starting queue supervisor and queue recovery                          ...done
-- message delivery logic ready
starting error log relay                                              ...done
starting networking                                                   ...done
starting direct_client                                                ...done

broker running

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110202/13fd1288/attachment-0001.htm>

From matthew at rabbitmq.com  Wed Feb  2 23:51:39 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 2 Feb 2011 23:51:39 +0000
Subject: [rabbitmq-discuss] Sending message through rabbitmq-stomp ->
 exchange(topic) - crashes queue
In-Reply-To: <20110202234818.GB25295@wellquite.org>
References: <989107b2-fa2d-4c95-bcc1-cb411fc5d093@v7g2000yqh.googlegroups.com>
	<20110202234818.GB25295@wellquite.org>
Message-ID: <20110202235139.GD25295@wellquite.org>

On Wed, Feb 02, 2011 at 11:48:19PM +0000, Matthew Sackman wrote:
> Ok, so the message payload is being sent through as a list instead of as
> a binary. My guess without checking further is this is a bug in the
> stomp client in the way it constructs the messages which are then sent
> further into Rabbit, but this may not be the case.

I meant "stomp adaptor" there, not client.

Matthew

From matthew at rabbitmq.com  Wed Feb  2 23:57:58 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 2 Feb 2011 23:57:58 +0000
Subject: [rabbitmq-discuss] Mgmt plug-in on 2.3.0
In-Reply-To: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CBF@IS-EXCHANGEC101.wsod.local>
References: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CBF@IS-EXCHANGEC101.wsod.local>
Message-ID: <20110202235757.GE25295@wellquite.org>

Hi Paul,

On Wed, Feb 02, 2011 at 06:51:43PM -0500, Paul Pearcy wrote:
> Any ideas where I could have gone wrong? I do see a decent number of errors now in my logs that I don't understand that are probably the true underlying cause, but am just guessing. I can send these details, if needed.

The logs (probably send off list if they're massive) are likely to be
very useful in helping us diagnose this. There's nothing obvious to me
in the details your provide to pinpoint the problem.

Many thanks,

Matthew

From paul.pearcy at wallst.com  Thu Feb  3 00:11:11 2011
From: paul.pearcy at wallst.com (Paul Pearcy)
Date: Wed, 2 Feb 2011 19:11:11 -0500
Subject: [rabbitmq-discuss] Mgmt plug-in on 2.3.0
In-Reply-To: <20110202235757.GE25295@wellquite.org>
References: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CBF@IS-EXCHANGEC101.wsod.local>
	<20110202235757.GE25295@wellquite.org>
Message-ID: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CC4@IS-EXCHANGEC101.wsod.local>

Hey Matt,
  Many thanks for the quick response. You can take a look at the log files here:
http://dl.dropbox.com/u/12095883/rabbit%40dm-essearchd101.log.1
http://dl.dropbox.com/u/12095883/rabbit%40dm-essearchd101-sasl.log.1

When I initially brought things up, I had a 2.2 Java client connecting which may have caused some of the errors. I updated my app to the 2.3 client and received what appeared to be the same behavior. 

Thanks!
Paul


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew Sackman
Sent: Wednesday, February 02, 2011 4:58 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Mgmt plug-in on 2.3.0

Hi Paul,

On Wed, Feb 02, 2011 at 06:51:43PM -0500, Paul Pearcy wrote:
> Any ideas where I could have gone wrong? I do see a decent number of errors now in my logs that I don't understand that are probably the true underlying cause, but am just guessing. I can send these details, if needed.

The logs (probably send off list if they're massive) are likely to be
very useful in helping us diagnose this. There's nothing obvious to me
in the details your provide to pinpoint the problem.

Many thanks,

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Thu Feb  3 00:40:25 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 3 Feb 2011 00:40:25 +0000
Subject: [rabbitmq-discuss] Mgmt plug-in on 2.3.0
In-Reply-To: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CC4@IS-EXCHANGEC101.wsod.local>
References: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CBF@IS-EXCHANGEC101.wsod.local>
	<20110202235757.GE25295@wellquite.org>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CC4@IS-EXCHANGEC101.wsod.local>
Message-ID: <20110203004024.GG25295@wellquite.org>

Hi Paul,

On Wed, Feb 02, 2011 at 07:11:11PM -0500, Paul Pearcy wrote:
>   Many thanks for the quick response. You can take a look at the log files here:
> http://dl.dropbox.com/u/12095883/rabbit%40dm-essearchd101.log.1
> http://dl.dropbox.com/u/12095883/rabbit%40dm-essearchd101-sasl.log.1

** Reason for termination == 
** {{badmatch,false},
    [{rabbit_amqqueue_process,assert_invariant,1},
     {rabbit_amqqueue_process,noreply,1},
     {gen_server2,handle_msg,2},
     {proc_lib,wake_up,3}]}

Wow. Something's _very_ broken.

It crashed, with a transaction in flight, the queue state does think
it's empty, which is odd because the failure of assert_invariant is
requires the queue to not be empty,... oh, I see what it is. The
sync_timeout can cause messages to become eligable for delivery, but we
don't then immediately call run_message_queue. Hence the queue can reach
a situation where it has messages eligable for delivery, with consumers
available to receive said messages, and yet we don't push those msgs out
asap.

It's a bug introduced by the addition of confirms, but it can cause this
crash even if you're just using transactions. It's a race condition,
which is why we've not seen it in testing. The solution is to not use
2.3 - go back to 2.2 for the time being. The only case where 2.3 is safe
is when you're using neither transactions nor confirms and you might
need infinite memory too. This might be interpreted as general advice to
avoid 2.3 for the time being, I'm afraid.

> When I initially brought things up, I had a 2.2 Java client connecting which may have caused some of the errors. I updated my app to the 2.3 client and received what appeared to be the same behavior. 

No - no errors should be caused by using a 2.2 client with the 2.3
broker - and that's not what's caused this problem.

The year of the Rabbit bodes well.

Matthew

From james.r.carr at gmail.com  Thu Feb  3 00:47:53 2011
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 2 Feb 2011 19:47:53 -0500
Subject: [rabbitmq-discuss] Queue bound by a percentage change?
In-Reply-To: <AANLkTikSEn=iS4pcQwetKiFAFs8dw9=qS0bFWt6hvP-P@mail.gmail.com>
References: <AANLkTikyLwaNrrdF=rbWWYkjd+Xx4MROx_08Mqcd5npr@mail.gmail.com>
	<AANLkTikSEn=iS4pcQwetKiFAFs8dw9=qS0bFWt6hvP-P@mail.gmail.com>
Message-ID: <AANLkTinoAAA+BebuQhy0Nf4kisbvoZnOUB6aJZa0dLQb@mail.gmail.com>

Hi Robert,

Thanks for the reply! I considered doing the banding in the routing
key. However, on the following point:

> Or you could use a filtering shovel, which does the range checking for you.

filtering shovel? Can you expand on that?


Thanks,
James


On Wed, Feb 2, 2011 at 7:10 AM, Robert Raschke <rtrlists at googlemail.com> wrote:
>
> On Wed, Feb 2, 2011 at 3:28 AM, James Carr <james.r.carr at gmail.com> wrote:
>>
>> I've been wondering what kind of scheme would be useful for binding
>> queues to be notified for certain changes in a value. For example, say
>> I have a stock system that applications can bind to and be notified
>> if, for excample, IBM's stock price has risen 2.00 or more, if the
>> price has dropped more than 2%, etc. What kind of scheme would work
>> best in this case?
>
> If you really need to do this kind of thing through a queue binding, rather
> than consumer value checks, the only thing that comes to mind is to have the
> producer band the values, so you can subscribe to bands. For example, have
> the producer use 1% bands in the routing key, 0 for 0<= x < 1, 1 for 1<= x
> <2, etc. and then bind your queue to as many ranges as you are interested.
>
> Or you could use a filtering shovel, which does the range checking for you.
>
> And just in case, you aren't talking about keeping track of the %-age
> change? Cause that would involve keeping state in a sliding window and make
> things a wee bit more complicated.
>
> Robby
>
>

From james.r.carr at gmail.com  Thu Feb  3 01:31:14 2011
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 2 Feb 2011 20:31:14 -0500
Subject: [rabbitmq-discuss] Management Plugin Causes Fault?
In-Reply-To: <20110202235053.GC25295@wellquite.org>
References: <AANLkTinoNO7OS4hFnDUz0p9AAG-x0nCDVxk09H69+vei@mail.gmail.com>
	<20110202235053.GC25295@wellquite.org>
Message-ID: <AANLkTimWa_LE2wwUb9DKumfA1giS3bzmCgaXNsShJwzF@mail.gmail.com>

Okay, I removed everything apt-get installed and went out and compiled
erlang from sources, used agner to install rabbitmq_server, dumped the
plugins in and started it up and all works fine. The only issue is
that I still get the following warnings on server startup:

*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
*WARNING* Undefined function webmachine_resource:start_link/2

This is with:
Erlang R14B01 (erts-5.8.2) [source] [smp:2:2] [rq:2] [async-threads:0]
[kernel-poll:false]

Despite the warnings so far it seems to work great! :)


Thanks,
James

On Wed, Feb 2, 2011 at 6:50 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Wed, Feb 02, 2011 at 06:15:10PM -0500, James Carr wrote:
>> Activating RabbitMQ plugins ...
>> *WARNING* Undefined function erlang:max/2
>
> Woah, that's an R14ism. That's a clear bug, but might be solved by
> upgrading your version of Erlang to the latest (assuming there aren't
> other bugs revealed by this).
>
>> *WARNING* Undefined function fdsrv:bind_socket/2
>> *WARNING* Undefined function fdsrv:start/0
>> *WARNING* Undefined function fdsrv:stop/0
>> *WARNING* Undefined function lists:keyfind/3
>> *WARNING* Undefined function ssl:ssl_accept/3
>> *WARNING* Undefined function webmachine_resource:start_link/2
>> 6 plugins activated:
>> * amqp_client-2.3.0
>> * mochiweb-1.3
>> * rabbit_management-2.3.0
>> * rabbit_management_agent-2.3.0
>> * rabbit_mochiweb-2.3.0
>> * webmachine-1.7.0
>>
>> {"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}}"}
>>
>> Crash dump was written to: erl_crash.dump
>> Kernel pid terminated (application_controller)
>> ({application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}})
>>
>> I can only guess that the undefined functions are related to perhaps
>> having a dusty version of erlang installed so I'll upgrade and give a
>> try again, just wondering if there might be something else I am
>> missing. :)
>>
>>
>> Thanks,
>> James
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthew at rabbitmq.com  Thu Feb  3 02:07:23 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 3 Feb 2011 02:07:23 +0000
Subject: [rabbitmq-discuss] Mgmt plug-in on 2.3.0
In-Reply-To: <20110203004024.GG25295@wellquite.org>
References: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CBF@IS-EXCHANGEC101.wsod.local>
	<20110202235757.GE25295@wellquite.org>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CC4@IS-EXCHANGEC101.wsod.local>
	<20110203004024.GG25295@wellquite.org>
Message-ID: <20110203020722.GA15015@rabbitmq.com>

Hi,

On Thu, Feb 03, 2011 at 12:40:25AM +0000, Matthew Sackman wrote:
> It's a bug introduced by the addition of confirms,...

No it's not. It's a bug introduced when fixing another bug which is in
the same area as the confirms but actually has nothing to do with
confirms. So we've moved from a bug that can cause unexpected data loss
to a bug which can racily crash the queue. Probably a lateral move.

In any case, I've fixed it. If you're happy compiling from source then
compile from the head of branch "bug23793". However, I suspect given two
critical bugs have now been found in the 2.3.0 release that there'll be
a 2.3.1 release fairly soon, so if you don't want to compile from source
and can wait a little while, then continue with 2.2 for the time being.

Matthew

From eshioji at gmail.com  Thu Feb  3 05:33:33 2011
From: eshioji at gmail.com (Enno Shioji)
Date: Thu, 3 Feb 2011 14:33:33 +0900
Subject: [rabbitmq-discuss] What is the best option for work sharing
 that needs topic like selective message receival?
In-Reply-To: <AANLkTi=pcmT-6sCLqAGu6zWX9Xvo=dKXsxGASTu8Z2eT@mail.gmail.com>
References: <AANLkTinPPog61Qgt-xFNvn-UFeYkrMUhH3xuwM-Xdvvx@mail.gmail.com>
	<AANLkTikdyn33xfu+FZjKVTo+X=9BhN_gNqCLzBk4Xp=i@mail.gmail.com>
	<AANLkTinmxAPKvjz1eg=ByV23X9xJgBsqYQmOjbMbqD3X@mail.gmail.com>
	<AANLkTi=pcmT-6sCLqAGu6zWX9Xvo=dKXsxGASTu8Z2eT@mail.gmail.com>
Message-ID: <AANLkTinv=DA85pNLs9rCwOGp_cuasPpxK3PUfzy4Eh64@mail.gmail.com>

*forgot to include the mailing list, sorry.

Hi Marek,


Thanks! My worry is though that these categories are very short-lived.
If I create and destroy many queues (e.g. 10-100 per second), would
that be a viable solution in e.g. RabbitMQ?



Regards,
Enno
- Hide quoted text -


On Wed, Feb 2, 2011 at 9:06 PM, Marek Majkowski <majek04 at gmail.com> wrote:
> On Mon, Jan 31, 2011 at 19:39, Enno Shioji <eshioji at gmail.com> wrote:
>>> I'm afraid the problem needs some more explanation.
>>>  - what's wrong with just one fat queue that is shared between workers?
>> Some workers can perform certain categories of jobs, while some
>> workers can perform other categories of job. I.e. workers cannot
>> perform all category of jobs. They can only perform a subset of job
>> category.
>
> Great.
> You've just defined your routing methodology.
> I guess the same relations should be represented
> using bindings and queues.
>
> The simplest thing to do, would be probably to have
> on queue per category, and if a consumer can do
> jobs from multiple categories - it should bind to multiple
> queues.
>
> On the other hand queues are relatively heavyweight,
> and it would be more efficient to have only one queue per
> consumer. But that's harder to manage dynamically.
>
>> So, if there is a fat queue, many consumers will pull
>> messages that they cannot consume and would have to put those back
>> into the queue (which I think would be very inefficient).
>>
>>>  - are all the tasks going to take roughly the same time?
>> At the current moment, yes.
>>
>>>  - do you need to prioritize the tasks?
>> It would be nice to roughly prioritize the tasks (it doesn't have to
>> be strict), but it'd be more of a "nice to have" requirement...
>>
>>
>>
>> Regards,
>> Enno
>>
>>
>>
>>
>>
>> On Mon, Jan 31, 2011 at 11:36 PM, Marek Majkowski <majek04 at gmail.com> wrote:
>>> On Mon, Jan 31, 2011 at 09:40, Enno Shioji <eshioji at gmail.com> wrote:
>>>> I have an app. I would like to migrate to AMQP based architecture. The
>>>> main component/functionality of this app. is to distribute work based
>>>> on some rules.
>>>>
>>>> After learning a little bit about AMQP, I concluded that the way to
>>>> achieve this is to have the producer send "jobs" to a direct exchange
>>>> with routing keys that indicate the nature of the jobs (let's call it
>>>> "job category"), and having queues that binds to each unique routing
>>>> key, and then having consumers listening on these queues. Multiple
>>>> consumers may listen to the same queue. One job should only be
>>>> performed once system-wide (but is not strictly required as long as
>>>> performance loss is not significant).
>>>>
>>>> My problem is that the number of such "job category" increases
>>>> overtime. E.g. if in the beginning there is only one routing keys such
>>>> as "key.stuff.1.A", overtime keys like "key.stuff.2.A" or
>>>> "key.stuff.2.B" will start to emerge and eventually such categories
>>>> will reach a large number. However, older categories will eventually
>>>> become obsolete so at a given time I would have at most something like
>>>> 20K different "job categories". But overtime I would have a LOT of job
>>>> categories. (Lifetime of each "job category" depends and can be
>>>> anything from 1 day to 1 seconds etc..)
>>>>
>>>> I'm wondering if there is a better way to achieve what I want.
>>>>
>>>> If this helps, everything can be transient and non durable. Message
>>>> loss can be tolerated as long as it's not too frequent (e.g. once per
>>>> 10K msgs etc.)
>>>
>>> I'm afraid the problem needs some more explanation.
>>>  - what's wrong with just one fat queue that is shared between workers?
>>>  - are all the tasks going to take roughly the same time?
>>>  - do you need to prioritize the tasks?
>>>
>>> Cheers,
>>>  Marek
>>>
>>
>

From Waseem_Hawaldar at mindtree.com  Thu Feb  3 05:54:26 2011
From: Waseem_Hawaldar at mindtree.com (Waseem Hawaldar)
Date: Thu, 3 Feb 2011 05:54:26 +0000
Subject: [rabbitmq-discuss] RabbitMq upgrade issue
Message-ID: <192E282CAB256F41A2161A9E1BAA7C5E08C9C1@MTW02MBX01.mindtree.com>

I was using rabbitMq 1.8 which was working as expected ie, all the queues were durable .I mean even if I restart the server messages use to be persistent in queues.
But, now I decided to use upgraded version i.e, rabbitMq 2.2 . So, I had replaced 1.8 jar with 2.2 jar and also started 2.2 server. After all this changes I am observing that the messages in the queues are not persistent as how it use to happen with 1.8.
So can you please suggest me the changes to be made for this upgraded version.

Regards,
Waseem:)

Waseem Hawaldar| Open Source Practice | MindTree Ltd [untitled] | Ecospace, outer ring road , Belandur(Accenture Office).  Bangalore-560 059, INDIA | Project Aadhaar - UIDAI |Mob: +91 9900588758 | email: waseem_hawaldar at mindtree.com| www.mindtree.com |


________________________________

http://www.mindtree.com/email/disclaimer.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110203/62d78e3c/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 1026 bytes
Desc: image001.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110203/62d78e3c/attachment.gif>

From lionel.cons at cern.ch  Thu Feb  3 06:48:53 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Thu, 3 Feb 2011 07:48:53 +0100
Subject: [rabbitmq-discuss] RabbitMQ Configuration Files
In-Reply-To: <4D499BDF.3060809@rabbitmq.com> (Simon MacMullen's message of
	"Wed, 2 Feb 2011 18:01:03 +0000")
References: <AANLkTikhYGFTLS7G5VxXsin+WVO7=3=vW0BbX89m6uu1@mail.gmail.com>
	<4D499BDF.3060809@rabbitmq.com>
Message-ID: <vfq4o8l7gve.fsf@mail.cern.ch>

Simon MacMullen <simon at rabbitmq.com> writes:
> ...but they don't contain anything about exchanges, bindings, queues,
> users, vhosts or permissions. For that you can use rabbitmqctl or the
> management plugin.

So these two tools (rabbitmqctl and the management plugin with its CLI)
seem to overlap significantly.

Will they continue to live and diverge or will you put the management
plugin in the core and replace rabbitmqctl with the management CLI?

How would you automate the installation a pre-configured broker: with a
script calling rabbitmqctl or with a JSON file to be used by the
management CLI?

Thanks for your answers.

Cheers,

Lionel

From Waseem_Hawaldar at mindtree.com  Thu Feb  3 07:08:22 2011
From: Waseem_Hawaldar at mindtree.com (Waseem Hawaldar)
Date: Thu, 3 Feb 2011 07:08:22 +0000
Subject: [rabbitmq-discuss] Not able to commit channel
Message-ID: <192E282CAB256F41A2161A9E1BAA7C5E08CA15@MTW02MBX01.mindtree.com>

When I commit channel using statement as channel.txCommit(); I get the following error :
PRECONDITION_FAILED - channel is not transactional

Could you please tell me the solution for these.

Regards,
Waseem:)

Waseem Hawaldar| Open Source Practice | MindTree Ltd [untitled] | Ecospace, outer ring road , Belandur(Accenture Office).  Bangalore-560 059, INDIA | Project Aadhaar - UIDAI |Mob: +91 9900588758 | email: waseem_hawaldar at mindtree.com| www.mindtree.com |


________________________________

http://www.mindtree.com/email/disclaimer.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110203/deb572d0/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 1026 bytes
Desc: image001.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110203/deb572d0/attachment-0001.gif>

From simon at rabbitmq.com  Thu Feb  3 09:40:00 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Feb 2011 09:40:00 +0000
Subject: [rabbitmq-discuss] Not able to commit channel
In-Reply-To: <192E282CAB256F41A2161A9E1BAA7C5E08CA15@MTW02MBX01.mindtree.com>
References: <192E282CAB256F41A2161A9E1BAA7C5E08CA15@MTW02MBX01.mindtree.com>
Message-ID: <4D4A77F0.2020001@rabbitmq.com>

On 03/02/11 07:08, Waseem Hawaldar wrote:
> When I commit channel using statement as channel.txCommit(); I get the
> following error :
>
> PRECONDITION_FAILED - channel is not transactional
>
> Could you please tell me the solution for these.

You need to make the channel transactional first - use Channel.txSelect().

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From rtrlists at googlemail.com  Thu Feb  3 09:44:40 2011
From: rtrlists at googlemail.com (Robert Raschke)
Date: Thu, 3 Feb 2011 09:44:40 +0000
Subject: [rabbitmq-discuss] Queue bound by a percentage change?
In-Reply-To: <AANLkTinoAAA+BebuQhy0Nf4kisbvoZnOUB6aJZa0dLQb@mail.gmail.com>
References: <AANLkTikyLwaNrrdF=rbWWYkjd+Xx4MROx_08Mqcd5npr@mail.gmail.com>
	<AANLkTikSEn=iS4pcQwetKiFAFs8dw9=qS0bFWt6hvP-P@mail.gmail.com>
	<AANLkTinoAAA+BebuQhy0Nf4kisbvoZnOUB6aJZa0dLQb@mail.gmail.com>
Message-ID: <AANLkTi=H7Wd1T=uM3wj2cpDdwA+PHNinDm1WSW3z=8wN@mail.gmail.com>

Hi James,

On Thu, Feb 3, 2011 at 12:47 AM, James Carr <james.r.carr at gmail.com> wrote:

>
> > Or you could use a filtering shovel, which does the range checking for
> you.
>
> filtering shovel? Can you expand on that?
>
>
Well, I personally have never used the shovel plugin (I think it's a plugin,
but it could simply be an add-on, I forget). You can use it to bridge two
AMQP servers, for example, and those could of course be one and the same. My
expectation would be that you can specify in some way which messages you
want the shovel to, err, shovel from one system to the other.

It might be a dead end, but probably worth spending an hour to look at what
a shovel can do for you.

Let's see, ah, here's a link:
http://hg.rabbitmq.com/rabbitmq-shovel/file/rabbitmq_v2_3_0/README

>From the looks of thing there's no obvious way to add filtering into that;
at least not from a config perspective, maybe the code is so simple, that
it's easy to add things you need. Or you could simply use it as a starting
point for creating your own filter that sits between your queues. Depends a
bit on how deep into programming you are willing to dive.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110203/46181676/attachment.htm>

From simon at rabbitmq.com  Thu Feb  3 09:53:02 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Feb 2011 09:53:02 +0000
Subject: [rabbitmq-discuss] Management Plugin Causes Fault?
In-Reply-To: <AANLkTimWa_LE2wwUb9DKumfA1giS3bzmCgaXNsShJwzF@mail.gmail.com>
References: <AANLkTinoNO7OS4hFnDUz0p9AAG-x0nCDVxk09H69+vei@mail.gmail.com>	<20110202235053.GC25295@wellquite.org>
	<AANLkTimWa_LE2wwUb9DKumfA1giS3bzmCgaXNsShJwzF@mail.gmail.com>
Message-ID: <4D4A7AFE.3010106@rabbitmq.com>

On 03/02/11 01:31, James Carr wrote:
> This is with:
> Erlang R14B01 (erts-5.8.2) [source] [smp:2:2] [rq:2] [async-threads:0]
> [kernel-poll:false]

For reference, the management plugin (and any other plugin using 
Mochiweb) requires at least Erlang R13B01:

http://www.rabbitmq.com/management.html#erlang

That said, we don't exactly handle this in an elegant way. I wonder if 
there's any sane way to check Erlang versions vs plugins installed...

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Thu Feb  3 10:02:02 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Feb 2011 10:02:02 +0000
Subject: [rabbitmq-discuss] RabbitMQ Configuration Files
In-Reply-To: <vfq4o8l7gve.fsf@mail.cern.ch>
References: <AANLkTikhYGFTLS7G5VxXsin+WVO7=3=vW0BbX89m6uu1@mail.gmail.com>	<4D499BDF.3060809@rabbitmq.com>
	<vfq4o8l7gve.fsf@mail.cern.ch>
Message-ID: <4D4A7D1A.3000803@rabbitmq.com>

On 03/02/11 06:48, Lionel Cons wrote:
> Simon MacMullen<simon at rabbitmq.com>  writes:
>> ...but they don't contain anything about exchanges, bindings, queues,
>> users, vhosts or permissions. For that you can use rabbitmqctl or the
>> management plugin.
>
> So these two tools (rabbitmqctl and the management plugin with its CLI)
> seem to overlap significantly.

To some extent. They overlap in user / vhost management, and in the 
list_* commands.

It's possible that rabbitmqctl might in future lose the list_* commands, 
but I think they'll continue to both have user management - in the 
management plugin since that manages all sorts of other things, but in 
rabbitmqctl since that doesn't require you to authenticate as a Rabbit 
user and thus lets you get back in if you've locked yourself out.

> Will they continue to live and diverge or will you put the management
> plugin in the core and replace rabbitmqctl with the management CLI?

They will probably both continue to live, but maybe with rabbitmqctl 
becoming more stripped down.

Putting the management plugin in the core would be controversial since 
it would mean RabbitMQ growing a web server and there are various 
reasons why we're wary of that.

One possibility would be for the management plugin to grow an AMQP 
interface, which could be moved into the core. The plugin could then 
translate HTTP to AMQP. But this would be a lot of work for (IMHO) 
fairly marginal gain.

> How would you automate the installation a pre-configured broker: with a
> script calling rabbitmqctl or with a JSON file to be used by the
> management CLI?

I would suggest using the management plugin since rabbitmqctl can't 
create exchanges, queues or bindings. Which I should have made clearer 
in the other mail, sorry.

One thing I have wondered in the past is if there would be general 
interest in a configuration option for the management plugin which would 
make it restore a backup on startup. Since backups get merged on restore 
this would not wipe anything, but would allow you to ensure that a set 
of objects was always there.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From emile at rabbitmq.com  Thu Feb  3 12:02:45 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 03 Feb 2011 12:02:45 +0000
Subject: [rabbitmq-discuss] RabbitMq upgrade issue
In-Reply-To: <192E282CAB256F41A2161A9E1BAA7C5E08C9C1@MTW02MBX01.mindtree.com>
References: <192E282CAB256F41A2161A9E1BAA7C5E08C9C1@MTW02MBX01.mindtree.com>
Message-ID: <4D4A9965.20306@rabbitmq.com>

Hi Waseem

On 03/02/11 05:54, Waseem Hawaldar wrote:
> I was using rabbitMq 1.8 which was working as expected ie, all the
> queues were durable .I mean even if I restart the server messages use to
> be persistent in queues.
>
> But, now I decided to use upgraded version i.e, rabbitMq 2.2 . So, I had
> replaced 1.8 jar with 2.2 jar and also started 2.2 server. After all
> this changes I am observing that the messages in the queues are not
> persistent as how it use to happen with 1.8.

Persistent messages in durable queues are only guaranteed to be on disk 
after a commit. You should make sure the channel is in transactional 
mode (txSelect) and commit when you want messages since the last commit 
to be persisted (txCommit).

Messages will still eventually be persisted in the absence of 
transactions if it is necessary (e.g. the message does not get delivered 
and ack'ed in the meantime), but there is no guarantee when that might 
happen, regardless of which version of rabbit you are using.


Regards

Emile


From simon at rabbitmq.com  Thu Feb  3 14:22:14 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Feb 2011 14:22:14 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.3.1 Release
Message-ID: <4D4ABA16.80605@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ
2.3.1.

This release fixes a small number of bugs, in particular one serious bug 
in 2.3.0 which could lead to queue processes crashing.

See the attached release notes for more details.

Binary and source distributions of the new release can be found in the
usual place at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to
this latest release. In particular we would very strongly recommend that 
any users of 2.3.0 upgrade.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.

Regards,
            The RabbitMQ Team




-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.3.1.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110203/56346581/attachment.txt>

From matthew at rabbitmq.com  Thu Feb  3 14:31:10 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 3 Feb 2011 14:31:10 +0000
Subject: [rabbitmq-discuss] Mgmt plug-in on 2.3.0
In-Reply-To: <20110203020722.GA15015@rabbitmq.com>
References: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CBF@IS-EXCHANGEC101.wsod.local>
	<20110202235757.GE25295@wellquite.org>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CC4@IS-EXCHANGEC101.wsod.local>
	<20110203004024.GG25295@wellquite.org>
	<20110203020722.GA15015@rabbitmq.com>
Message-ID: <20110203143110.GH15733@rabbitmq.com>

On Thu, Feb 03, 2011 at 02:07:23AM +0000, Matthew Sackman wrote:
> In any case, I've fixed it. If you're happy compiling from source then
> compile from the head of branch "bug23793". However, I suspect given two
> critical bugs have now been found in the 2.3.0 release that there'll be
> a 2.3.1 release fairly soon, so if you don't want to compile from source
> and can wait a little while, then continue with 2.2 for the time being.

This bug is the main critical bug that's been fixed by the 2.3.1
release. Please do not use 2.3.0; upgrade to 2.3.1.

Matthew

From matthew at rabbitmq.com  Thu Feb  3 14:45:29 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 3 Feb 2011 14:45:29 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.3.1 Release
In-Reply-To: <4D4ABA16.80605@rabbitmq.com>
References: <4D4ABA16.80605@rabbitmq.com>
Message-ID: <20110203144528.GI15733@rabbitmq.com>

On Thu, Feb 03, 2011 at 02:22:14PM +0000, Simon MacMullen wrote:
> The RabbitMQ team is pleased to announce the release of RabbitMQ
> 2.3.1.
> 
> This release fixes a small number of bugs, in particular one serious
> bug in 2.3.0 which could lead to queue processes crashing.

As a result of the severity of the bug that's been fixed, we do not
advise anyone to use 2.3.0.

The bug fixed is a race condition that can cause any queue to violate an
enforced invariant of the queue during an AMQP transaction commit. If
the invariant is violated, then the queue will crash instantly, losing
all non-persisted messages within the queue.

The bug was introduced in the process of fixing another bug - a bug that
had existed since the 2.0.0 release, and which could lead, in the event
of a crash, to more persistent messages being lost than should be. To
explain that a little further: persistent messages are not written to
disk immediately because there may be opportunities to optimise out the
write completely, and additionally it is not performant to issue lots of
tiny I/O write operations. Consequently, there are various caches, and
timeouts which ensure that messages that are being written to disk are
done so promptly enough but also efficiently enough. The bug found was
that one of the timers related to this process was not being reset
correctly. As a result, a long period of time could occur before
messages were pushed out to disk in some cases, leading to a bigger
window for messages to be potentially lost in. This would affect not
just how messages are pushed to disk in the case of memory pressure, but
also latency of transaction commits, and probably some scenarios too.

In fixing this bug, the critical bug discovered in 2.3.0 was
accidentally introduced. Both bugs do not exist in 2.3.1.

By being a race condition, it managed to not get triggered in testing.
Indeed even now, knowing where the bug lies, I have not been able to
trigger it.

I hope that sheds some light on the situation.

Matthew

From paul.pearcy at wallst.com  Thu Feb  3 17:17:46 2011
From: paul.pearcy at wallst.com (Paul Pearcy)
Date: Thu, 3 Feb 2011 12:17:46 -0500
Subject: [rabbitmq-discuss] Mgmt plug-in on 2.3.0
In-Reply-To: <20110203143110.GH15733@rabbitmq.com>
References: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CBF@IS-EXCHANGEC101.wsod.local>
	<20110202235757.GE25295@wellquite.org>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CC4@IS-EXCHANGEC101.wsod.local>
	<20110203004024.GG25295@wellquite.org>	<20110203020722.GA15015@rabbitmq.com>
	<20110203143110.GH15733@rabbitmq.com>
Message-ID: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4D25@IS-EXCHANGEC101.wsod.local>

Cool, thank you!

I'll give it a shot and confirm that it fixed the race I was hitting.

Best Regards,
Paul

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew Sackman
Sent: Thursday, February 03, 2011 7:31 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Mgmt plug-in on 2.3.0

On Thu, Feb 03, 2011 at 02:07:23AM +0000, Matthew Sackman wrote:
> In any case, I've fixed it. If you're happy compiling from source then
> compile from the head of branch "bug23793". However, I suspect given two
> critical bugs have now been found in the 2.3.0 release that there'll be
> a 2.3.1 release fairly soon, so if you don't want to compile from source
> and can wait a little while, then continue with 2.2 for the time being.

This bug is the main critical bug that's been fixed by the 2.3.1
release. Please do not use 2.3.0; upgrade to 2.3.1.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From harvey.robin at gmail.com  Thu Feb  3 19:37:23 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Thu, 3 Feb 2011 19:37:23 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.3.1 Release
In-Reply-To: <20110203144528.GI15733@rabbitmq.com>
References: <4D4ABA16.80605@rabbitmq.com> <20110203144528.GI15733@rabbitmq.com>
Message-ID: <AANLkTimV=npoH9Syq2Z6wk-tjEr2NQo4Lgr2V-DjCga9@mail.gmail.com>

Hi,

Does this version include the new "interleaved message delivery" stuff for
basic.deliver?

Thanks,
--Robin

On Thu, Feb 3, 2011 at 2:45 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Thu, Feb 03, 2011 at 02:22:14PM +0000, Simon MacMullen wrote:
> > The RabbitMQ team is pleased to announce the release of RabbitMQ
> > 2.3.1.
> >
> > This release fixes a small number of bugs, in particular one serious
> > bug in 2.3.0 which could lead to queue processes crashing.
>
> As a result of the severity of the bug that's been fixed, we do not
> advise anyone to use 2.3.0.
>
> The bug fixed is a race condition that can cause any queue to violate an
> enforced invariant of the queue during an AMQP transaction commit. If
> the invariant is violated, then the queue will crash instantly, losing
> all non-persisted messages within the queue.
>
> The bug was introduced in the process of fixing another bug - a bug that
> had existed since the 2.0.0 release, and which could lead, in the event
> of a crash, to more persistent messages being lost than should be. To
> explain that a little further: persistent messages are not written to
> disk immediately because there may be opportunities to optimise out the
> write completely, and additionally it is not performant to issue lots of
> tiny I/O write operations. Consequently, there are various caches, and
> timeouts which ensure that messages that are being written to disk are
> done so promptly enough but also efficiently enough. The bug found was
> that one of the timers related to this process was not being reset
> correctly. As a result, a long period of time could occur before
> messages were pushed out to disk in some cases, leading to a bigger
> window for messages to be potentially lost in. This would affect not
> just how messages are pushed to disk in the case of memory pressure, but
> also latency of transaction commits, and probably some scenarios too.
>
> In fixing this bug, the critical bug discovered in 2.3.0 was
> accidentally introduced. Both bugs do not exist in 2.3.1.
>
> By being a race condition, it managed to not get triggered in testing.
> Indeed even now, knowing where the bug lies, I have not been able to
> trigger it.
>
> I hope that sheds some light on the situation.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110203/4fefa01a/attachment-0001.htm>

From s4nchez at gmail.com  Thu Feb  3 20:36:18 2011
From: s4nchez at gmail.com (Ivan Sanchez)
Date: Thu, 3 Feb 2011 12:36:18 -0800 (PST)
Subject: [rabbitmq-discuss] Blocked connections on rabbitmq 2.2.0
Message-ID: <5064478c-55fc-4312-b847-925a5fb7b8ec@d23g2000prj.googlegroups.com>


  Hi all,

  Yesterday I've noticed some very strange behaviour in one of our
rabbitmq cluster nodes. Its queues became unresponsive and running
"rabbitmqctl list_connections" was returning that all the connections
were either "blocking" or "blocked". The documentation doesn't mention
these states. Does anyone know what they mean?

  To give a bit of context: we noticed this problem when good portion
of our clients stopped receiving messages. Looking at all the servers
we found one that was using too much CPU and also swapping to disk.
This node was the only presenting this behaviour, but it seemed like
this problem compromised the whole cluster. We haven't touched these
servers for ages (they are dedicated to rabbitmq) and the system load
was completely under normal levels. We use simple DNS round-robin for
clients to connect to the cluster and none of our messages are
persistent, so seeing swapping really scared me.

  After restarting the whole cluster a few times the problem
persisted, always on the same server. We even tried force_reset in all
nodes, but that also didn't help. Things just went back to normal
after we removed the problematic node from the cluster. Now my task if
figure out what can be the problem.

  Did anyone have experience with this kind of behaviour? I'm even
considering hardware problem, but so far didn't find anything
indicating that was the case.

  Any help is welcome.

Thank you,
Ivan

From paul.pearcy at wallst.com  Thu Feb  3 23:43:03 2011
From: paul.pearcy at wallst.com (Paul Pearcy)
Date: Thu, 3 Feb 2011 18:43:03 -0500
Subject: [rabbitmq-discuss] Mgmt plug-in on 2.3.0
In-Reply-To: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4D25@IS-EXCHANGEC101.wsod.local>
References: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CBF@IS-EXCHANGEC101.wsod.local>
	<20110202235757.GE25295@wellquite.org>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CC4@IS-EXCHANGEC101.wsod.local>
	<20110203004024.GG25295@wellquite.org>	<20110203020722.GA15015@rabbitmq.com>
	<20110203143110.GH15733@rabbitmq.com>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4D25@IS-EXCHANGEC101.wsod.local>
Message-ID: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EEAD8EAC@IS-EXCHANGEC101.wsod.local>

Hey Matthew,
  2.3.1 runs cleanly for me. 2.3.0 would immediately blow up on me, but not the case with the new release. 

Thanks for the work!!!

Best Regards,
Paul

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Paul Pearcy
Sent: Thursday, February 03, 2011 10:18 AM
To: Matthew Sackman; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Mgmt plug-in on 2.3.0

Cool, thank you!

I'll give it a shot and confirm that it fixed the race I was hitting.

Best Regards,
Paul

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew Sackman
Sent: Thursday, February 03, 2011 7:31 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Mgmt plug-in on 2.3.0

On Thu, Feb 03, 2011 at 02:07:23AM +0000, Matthew Sackman wrote:
> In any case, I've fixed it. If you're happy compiling from source then
> compile from the head of branch "bug23793". However, I suspect given two
> critical bugs have now been found in the 2.3.0 release that there'll be
> a 2.3.1 release fairly soon, so if you don't want to compile from source
> and can wait a little while, then continue with 2.2 for the time being.

This bug is the main critical bug that's been fixed by the 2.3.1
release. Please do not use 2.3.0; upgrade to 2.3.1.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Fri Feb  4 00:27:20 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 4 Feb 2011 00:27:20 +0000
Subject: [rabbitmq-discuss] Mgmt plug-in on 2.3.0
In-Reply-To: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EEAD8EAC@IS-EXCHANGEC101.wsod.local>
References: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CBF@IS-EXCHANGEC101.wsod.local>
	<20110202235757.GE25295@wellquite.org>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4CC4@IS-EXCHANGEC101.wsod.local>
	<20110203004024.GG25295@wellquite.org>
	<20110203020722.GA15015@rabbitmq.com>
	<20110203143110.GH15733@rabbitmq.com>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EE8E4D25@IS-EXCHANGEC101.wsod.local>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EEAD8EAC@IS-EXCHANGEC101.wsod.local>
Message-ID: <20110204002719.GB8423@wellquite.org>

Hi Paul,

On Thu, Feb 03, 2011 at 06:43:03PM -0500, Paul Pearcy wrote:
>   2.3.1 runs cleanly for me. 2.3.0 would immediately blow up on me, but not the case with the new release. 

That's great news. Even after knowing where the bug was, I couldn't
trigger it. Is there any chance you could send me the client code you
were using that triggered it so readily? I might well want to add it to
our test suite if it is that reliable.

Many thanks,

Matthew

From Denis.Conan at telecom-sudparis.eu  Fri Feb  4 08:11:27 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Fri, 04 Feb 2011 09:11:27 +0100
Subject: [rabbitmq-discuss] AMQP Java Client on
	http://repo2.maven.org/maven2/com/rabbitmq/amqp-client/
Message-ID: <4D4BB4AF.7050508@telecom-sudparis.eu>


Hi all,

the AMQP Java client does not seem to have been deployed on the maven repository.

Index of /maven2/com/rabbitmq/amqp-client/
../
1.3.0/                                             23-Jun-2008 14:27 
         -
1.5.4/                                             19-May-2009 21:35 
         -
1.5.5/                                             14-Jul-2009 03:57 
         -
1.6.0/                                             12-Aug-2009 16:08 
         -
1.7.2/                                             07-Dec-2010 13:24 
         -
1.8.0/                                             07-Dec-2010 13:24 
         -
1.8.1/                                             07-Dec-2010 13:24 
         -
2.0.0/                                             07-Dec-2010 13:24 
         -
2.1.0/                                             07-Dec-2010 13:25 
         -
2.1.1/                                             07-Dec-2010 13:25 
         -
2.2.0/                                             07-Dec-2010 13:25 
         -
2.3.0/                                             02-Feb-2011 14:21 
         -
maven-metadata.xml                                 02-Feb-2011 14:21 
       547
maven-metadata.xml.md5                             02-Feb-2011 14:21 
        32
maven-metadata.xml.sha1                            02-Feb-2011 14:21 
        40

BR

Denis

From simon at rabbitmq.com  Fri Feb  4 08:14:13 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 04 Feb 2011 08:14:13 +0000
Subject: [rabbitmq-discuss] AMQP Java Client
	on	http://repo2.maven.org/maven2/com/rabbitmq/amqp-client/
In-Reply-To: <4D4BB4AF.7050508@telecom-sudparis.eu>
References: <4D4BB4AF.7050508@telecom-sudparis.eu>
Message-ID: <4D4BB555.7020408@rabbitmq.com>

Yes, the repo was not responsive when I tried to do the 2.3.1 upload. 
I'll try again today.

Cheers, Simon

On 04/02/2011 8:11AM, Denis Conan wrote:
>
> Hi all,
>
> the AMQP Java client does not seem to have been deployed on the maven
> repository.
>
> Index of /maven2/com/rabbitmq/amqp-client/
> ../
> 1.3.0/ 23-Jun-2008 14:27 -
> 1.5.4/ 19-May-2009 21:35 -
> 1.5.5/ 14-Jul-2009 03:57 -
> 1.6.0/ 12-Aug-2009 16:08 -
> 1.7.2/ 07-Dec-2010 13:24 -
> 1.8.0/ 07-Dec-2010 13:24 -
> 1.8.1/ 07-Dec-2010 13:24 -
> 2.0.0/ 07-Dec-2010 13:24 -
> 2.1.0/ 07-Dec-2010 13:25 -
> 2.1.1/ 07-Dec-2010 13:25 -
> 2.2.0/ 07-Dec-2010 13:25 -
> 2.3.0/ 02-Feb-2011 14:21 -
> maven-metadata.xml 02-Feb-2011 14:21 547
> maven-metadata.xml.md5 02-Feb-2011 14:21 32
> maven-metadata.xml.sha1 02-Feb-2011 14:21 40
>
> BR
>
> Denis
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jurdanas.kriauciunas at gmail.com  Fri Feb  4 08:25:10 2011
From: jurdanas.kriauciunas at gmail.com (Jurdanas Kriauciunas)
Date: Fri, 4 Feb 2011 00:25:10 -0800 (PST)
Subject: [rabbitmq-discuss] Sending message through rabbitmq-stomp ->
 exchange(topic) - crashes queue
In-Reply-To: <20110202235139.GD25295@wellquite.org>
References: <989107b2-fa2d-4c95-bcc1-cb411fc5d093@v7g2000yqh.googlegroups.com>
	<20110202234818.GB25295@wellquite.org>
	<20110202235139.GD25295@wellquite.org>
Message-ID: <ed901f76-6b99-4991-9012-f31e7d9eb5a0@o13g2000yql.googlegroups.com>



On 3 Vas, 01:51, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Wed, Feb 02, 2011 at 11:48:19PM +0000, Matthew Sackman wrote:
> > Ok, so the message payload is being sent through as a list instead of as
> > a binary. My guess without checking further is this is a bug in the
> > stomp client in the way it constructs the messages which are then sent
> > further into Rabbit, but this may not be the case.
>
> I meant "stomp adaptor" there, not client.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Hi,

Hmm, we use python (and java) as amqp client. And use some javascript
(http://www.orbited.org) through stomp to connect to rabbitmq.

I have debugged with wireshark and attached send command from orbited
(proxy) to rabbitmq.
Debug log from javascript and simple javascropt is also added below.
About code (parameters) for javascript: orbited runs on
127.0.0.1:9000. Passthrough to rabbitmq with stomp plugin on same
machine.
---

0000   53 45 4e 44 0a 63 6f 6e 74 65 6e 74 2d 74 79 70  SEND.content-
typ
0010   65 3a 74 65 78 74 2f 70 6c 61 69 6e 0a 63 6f 6e  e:text/
plain.con
0020   74 65 6e 74 2d 65 6e 63 6f 64 69 6e 67 3a 75 74  tent-
encoding:ut
0030   66 2d 38 0a 63 6f 6e 74 65 6e 74 2d 6c 65 6e 67  f-8.content-
leng
0040   74 68 3a 31 38 0a 64 65 73 74 69 6e 61 74 69 6f  th:
18.destinatio
0050   6e 3a 2f 65 78 63 68 61 6e 67 65 2f 68 6d 2f 74  n:/exchange/hm/
t
0060   65 73 74 2e 73 74 6f 6d 70 0a 0a 6d 65 73 73 61
est.stomp..messa
0070   67 65 5f 66 72 6f 6d 5f 73 74 6f 6d 70 00        ge_from_stomp.

--

Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, sessionOpen; sending:, 127.0.0.1:61613
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, encoded payload:, 127.0.0.1:61613
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, initial
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, data, 1
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, len, 1
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, typeof(data), string
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, data[0] , 1
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, type , string
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, result, true
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, tcpsocket.onopen..
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, SEND: , CONNECT login:guest passcode:guest ?
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, did onopen
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, READ: , CONNECTED session:session-
B91MWlC45wxuqYty86zZVg== heartbeat:0,0 version:1.0 ?
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, SEND: , SEND content-type:text/plain content-
encoding:utf-8 content-length:18 destination:/exchange/hm/test.stomp
message_from_stomp?
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, SEND: , DISCONNECT ?
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, sessionOnClose
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, doClose, 201
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, onCloseTriggered, false
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, triggerClose timer, 201
Fri Feb 04 2011 09:16:24 GMT+0200 (FLE Standard Time), debug,
Orbited.TCPSocket, onclose!, 201

---

<html>
<head>

<script type="text/javascript">document.domain = document.domain;</
script>

<title>STOMP test</title>

<script type="text/javascript" src="jquery-1.4.4.min.js"></script>

<script type="text/javascript" src="http://127.0.0.1:9000/static/
Orbited.js"></script>
<script type="text/javascript">
Orbited.settings.hostname = "127.0.0.1";
Orbited.settings.port = 9000;

Orbited.loggers['Orbited.TCPSocket'].enabled = true;
Orbited.settings.log = true;

TCPSocket = Orbited.TCPSocket;
</script>
<script type="text/javascript" src="http://127.0.0.1:9000/static/
protocols/stomp/stomp.js"></script>
<script type="text/javascript">
function send_to_stomp() {
  stomp = new STOMPClient();
  stomp.onconnectedframe = function() {
    stomp.send('message_from_stomp', '/exchange/hm/test.stomp');
    stomp.disconnect();
  };
  stomp.connect('127.0.0.1', 61613, 'guest', 'guest')
}
</script>
</head>
<body>
<button onclick="send_to_stomp()">send</button>
</body>
</html>

From mikeb at rabbitmq.com  Fri Feb  4 10:14:31 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 04 Feb 2011 10:14:31 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.3.1 Release
In-Reply-To: <AANLkTimV=npoH9Syq2Z6wk-tjEr2NQo4Lgr2V-DjCga9@mail.gmail.com>
References: <4D4ABA16.80605@rabbitmq.com> <20110203144528.GI15733@rabbitmq.com>
	<AANLkTimV=npoH9Syq2Z6wk-tjEr2NQo4Lgr2V-DjCga9@mail.gmail.com>
Message-ID: <4D4BD187.9090806@rabbitmq.com>

On 02/03/2011 07:37 PM, Robin Harvey wrote:
> Hi,
>
> Does this version include the new "interleaved message delivery" stuff
> for basic.deliver?

Yes it does.

To be clear what that is: AMQP messages can be delivered in multiple 
content frames, if the payload is larger than the maximum allowed frame 
size; this fix means that messages with more than one content frame may 
be interleaved with frames on other channels.  In other words, large 
messages won't hold up frames for other channels on the connection 
(though they will hold up deliveries on the same channel, by specification).

This should require no changes to clients, which are expected to deal 
with interleaved frames anyway.


Michael.

From matthias at rabbitmq.com  Fri Feb  4 10:18:37 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 04 Feb 2011 10:18:37 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.3.1 Release
In-Reply-To: <4D4BD187.9090806@rabbitmq.com>
References: <4D4ABA16.80605@rabbitmq.com>
	<20110203144528.GI15733@rabbitmq.com>	<AANLkTimV=npoH9Syq2Z6wk-tjEr2NQo4Lgr2V-DjCga9@mail.gmail.com>
	<4D4BD187.9090806@rabbitmq.com>
Message-ID: <4D4BD27D.2090606@rabbitmq.com>

Michael Bridgen wrote:
> On 02/03/2011 07:37 PM, Robin Harvey wrote:
>> Does this version include the new "interleaved message delivery" stuff
>> for basic.deliver?
> 
> Yes it does.

...and it was listed in the 2.3.0 release notes:

<quote>
- prevent delivery of large messages to consumers from blocking 
deliveries on other channels
</quote>


Matthias.

From videlalvaro at gmail.com  Fri Feb  4 10:50:39 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 4 Feb 2011 18:50:39 +0800
Subject: [rabbitmq-discuss] RabbitMQ 2.3.1 Release
In-Reply-To: <4D4ABA16.80605@rabbitmq.com>
References: <4D4ABA16.80605@rabbitmq.com>
Message-ID: <7D52B099-0816-44FF-987C-F5F3C1409782@gmail.com>

This is pretty cool news.

BTW, the Year of the Rabbit just started here in China ;)

?????

Alvaro

On Feb 3, 2011, at 10:22 PM, Simon MacMullen wrote:

> The RabbitMQ team is pleased to announce the release of RabbitMQ
> 2.3.1.
> 
> This release fixes a small number of bugs, in particular one serious bug in 2.3.0 which could lead to queue processes crashing.
> 
> See the attached release notes for more details.
> 
> Binary and source distributions of the new release can be found in the
> usual place at http://www.rabbitmq.com/download.html
> 
> We recommend that all users of earlier versions of RabbitMQ upgrade to
> this latest release. In particular we would very strongly recommend that any users of 2.3.0 upgrade.
> 
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
> info at rabbitmq.com.
> 
> Regards,
>           The RabbitMQ Team
> 
> 
> 
> 
> <README-2.3.1.txt>_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Fri Feb  4 11:35:20 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 04 Feb 2011 11:35:20 +0000
Subject: [rabbitmq-discuss] AMQP Java
	Client	on	http://repo2.maven.org/maven2/com/rabbitmq/amqp-client/
In-Reply-To: <4D4BB555.7020408@rabbitmq.com>
References: <4D4BB4AF.7050508@telecom-sudparis.eu>
	<4D4BB555.7020408@rabbitmq.com>
Message-ID: <4D4BE478.3060501@rabbitmq.com>

On 04/02/11 08:14, Simon MacMullen wrote:
> Yes, the repo was not responsive when I tried to do the 2.3.1 upload.
> I'll try again today.

It's now there.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Fri Feb  4 11:53:42 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 4 Feb 2011 11:53:42 +0000
Subject: [rabbitmq-discuss] Blocked connections on rabbitmq 2.2.0
In-Reply-To: <5064478c-55fc-4312-b847-925a5fb7b8ec@d23g2000prj.googlegroups.com>
References: <5064478c-55fc-4312-b847-925a5fb7b8ec@d23g2000prj.googlegroups.com>
Message-ID: <AANLkTinBf_Cat4ZT9-uT6J_x0yOCSVQ=iYia5t2BBK53@mail.gmail.com>

On Thu, Feb 3, 2011 at 20:36, Ivan Sanchez <s4nchez at gmail.com> wrote:
> ?Yesterday I've noticed some very strange behaviour in one of our
> rabbitmq cluster nodes. Its queues became unresponsive and running
> "rabbitmqctl list_connections" was returning that all the connections
> were either "blocking" or "blocked". The documentation doesn't mention
> these states. Does anyone know what they mean?
>
> ?To give a bit of context: we noticed this problem when good portion
> of our clients stopped receiving messages. Looking at all the servers
> we found one that was using too much CPU and also swapping to disk.
> This node was the only presenting this behaviour, but it seemed like
> this problem compromised the whole cluster. We haven't touched these
> servers for ages (they are dedicated to rabbitmq) and the system load
> was completely under normal levels. We use simple DNS round-robin for
> clients to connect to the cluster and none of our messages are
> persistent, so seeing swapping really scared me.
>
> ?After restarting the whole cluster a few times the problem
> persisted, always on the same server. We even tried force_reset in all
> nodes, but that also didn't help. Things just went back to normal
> after we removed the problematic node from the cluster. Now my task if
> figure out what can be the problem.
>
> ?Did anyone have experience with this kind of behaviour? I'm even
> considering hardware problem, but so far didn't find anything
> indicating that was the case.

Hi,

When RabbitMQ is using more memory than it should,
to avoid crashing, it stops accepting new messages.

In AMQP publishing messages is asynchronous, and
it's illegal to 'reject' a published message.

Instead, when RabbitMQ is under a memory pressure
it stops receiving data from tcp connections that try to
do 'basic_publish'.

That's what the 'blocked' connection state means.

It's perfectly legal to open second connection and
consume messages using it as long as it doesn't do 'basic_publish'.

Please check for memory alerts in your RabbitMQ logs,
check if memory watermark is being set properly
and if you have enough memory for your Rabbit.

Cheers,
  Marek

From Denis.Conan at telecom-sudparis.eu  Fri Feb  4 12:04:55 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Fri, 04 Feb 2011 13:04:55 +0100
Subject: [rabbitmq-discuss] AMQP
	Java	Client	on	http://repo2.maven.org/maven2/com/rabbitmq/amqp-client/
In-Reply-To: <4D4BE478.3060501@rabbitmq.com>
References: <4D4BB4AF.7050508@telecom-sudparis.eu>	<4D4BB555.7020408@rabbitmq.com>
	<4D4BE478.3060501@rabbitmq.com>
Message-ID: <4D4BEB67.1090504@telecom-sudparis.eu>

Le 04/02/2011 12:35, Simon MacMullen a ?crit :
> On 04/02/11 08:14, Simon MacMullen wrote:
>> Yes, the repo was not responsive when I tried to do the 2.3.1 upload.
>> I'll try again today.
>
> It's now there.
>
> Cheers, Simon

thank you

-- 
Denis Conan
Institut T?l?com, T?l?com SudParis
http://www-public.telecom-sudparis.eu/~conan

From s4nchez at gmail.com  Fri Feb  4 12:42:13 2011
From: s4nchez at gmail.com (Ivan Sanchez)
Date: Fri, 4 Feb 2011 04:42:13 -0800 (PST)
Subject: [rabbitmq-discuss] Blocked connections on rabbitmq 2.2.0
In-Reply-To: <AANLkTinBf_Cat4ZT9-uT6J_x0yOCSVQ=iYia5t2BBK53@mail.gmail.com>
References: <5064478c-55fc-4312-b847-925a5fb7b8ec@d23g2000prj.googlegroups.com>
	<AANLkTinBf_Cat4ZT9-uT6J_x0yOCSVQ=iYia5t2BBK53@mail.gmail.com>
Message-ID: <a83097fd-425c-456d-91d4-4e4d8047da2f@r19g2000prm.googlegroups.com>

  Hi Marek,

  Thank you for your answer. I've got a few of the following alerts:

  =INFO REPORT==== 2-Feb-2011::21:05:38 ===
vm_memory_high_watermark set. Memory used:6611768328 allowed:
3351445504

=INFO REPORT==== 2-Feb-2011::21:05:38 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}

  Apart from the cluster setup, the only other setting I have in my
config is ERL_MAX_ETS_TABLES=10000.

  The part that's confusing to me is that only one node had this issue
(even after resetting the whole cluster), and I'm not using persistent
messages. So now I'm not sure what else could be causing the memory
problem.

  Is there anything else I'm missing here?

  Thanks again for your help.

--
Ivan

On Feb 4, 11:53?am, Marek Majkowski <maje... at gmail.com> wrote:
> On Thu, Feb 3, 2011 at 20:36, Ivan Sanchez <s4nc... at gmail.com> wrote:
> > ?Yesterday I've noticed some very strange behaviour in one of our
> > rabbitmq cluster nodes. Its queues became unresponsive and running
> > "rabbitmqctl list_connections" was returning that all the connections
> > were either "blocking" or "blocked". The documentation doesn't mention
> > these states. Does anyone know what they mean?
>
> > ?To give a bit of context: we noticed this problem when good portion
> > of our clients stopped receiving messages. Looking at all the servers
> > we found one that was using too much CPU and also swapping to disk.
> > This node was the only presenting this behaviour, but it seemed like
> > this problem compromised the whole cluster. We haven't touched these
> > servers for ages (they are dedicated to rabbitmq) and the system load
> > was completely under normal levels. We use simple DNS round-robin for
> > clients to connect to the cluster and none of our messages are
> > persistent, so seeing swapping really scared me.
>
> > ?After restarting the whole cluster a few times the problem
> > persisted, always on the same server. We even tried force_reset in all
> > nodes, but that also didn't help. Things just went back to normal
> > after we removed the problematic node from the cluster. Now my task if
> > figure out what can be the problem.
>
> > ?Did anyone have experience with this kind of behaviour? I'm even
> > considering hardware problem, but so far didn't find anything
> > indicating that was the case.
>
> Hi,
>
> When RabbitMQ is using more memory than it should,
> to avoid crashing, it stops accepting new messages.
>
> In AMQP publishing messages is asynchronous, and
> it's illegal to 'reject' a published message.
>
> Instead, when RabbitMQ is under a memory pressure
> it stops receiving data from tcp connections that try to
> do 'basic_publish'.
>
> That's what the 'blocked' connection state means.
>
> It's perfectly legal to open second connection and
> consume messages using it as long as it doesn't do 'basic_publish'.
>
> Please check for memory alerts in your RabbitMQ logs,
> check if memory watermark is being set properly
> and if you have enough memory for your Rabbit.
>
> Cheers,
> ? Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From majek04 at gmail.com  Fri Feb  4 13:01:57 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 4 Feb 2011 13:01:57 +0000
Subject: [rabbitmq-discuss] Blocked connections on rabbitmq 2.2.0
In-Reply-To: <a83097fd-425c-456d-91d4-4e4d8047da2f@r19g2000prm.googlegroups.com>
References: <5064478c-55fc-4312-b847-925a5fb7b8ec@d23g2000prj.googlegroups.com>
	<AANLkTinBf_Cat4ZT9-uT6J_x0yOCSVQ=iYia5t2BBK53@mail.gmail.com>
	<a83097fd-425c-456d-91d4-4e4d8047da2f@r19g2000prm.googlegroups.com>
Message-ID: <AANLkTi=spp-CEcU2NuaX-+X7dS3VmbJSApvKrfS45KRw@mail.gmail.com>

On Fri, Feb 4, 2011 at 12:42, Ivan Sanchez <s4nchez at gmail.com> wrote:
> ?Thank you for your answer. I've got a few of the following alerts:
>
> ?=INFO REPORT==== 2-Feb-2011::21:05:38 ===
> vm_memory_high_watermark set. Memory used:6611768328 allowed:
> 3351445504
>
> =INFO REPORT==== 2-Feb-2011::21:05:38 ===
> ? ?alarm_handler: {set,{vm_memory_high_watermark,[]}}

That line means that Rabbit is under memory pressure and
won't accept any new messages until some memory
will be freed.

> ?Apart from the cluster setup, the only other setting I have in my
> config is ERL_MAX_ETS_TABLES=10000.

That shouldn't make a difference.

> ?The part that's confusing to me is that only one node had this issue
> (even after resetting the whole cluster), and I'm not using persistent
> messages. So now I'm not sure what else could be causing the memory
> problem.
>
> ?Is there anything else I'm missing here?

Maybe the biggest queue landed on that particular node?
Maybe this node handles all the queues?



> On Feb 4, 11:53?am, Marek Majkowski <maje... at gmail.com> wrote:
>> On Thu, Feb 3, 2011 at 20:36, Ivan Sanchez <s4nc... at gmail.com> wrote:
>> > ?Yesterday I've noticed some very strange behaviour in one of our
>> > rabbitmq cluster nodes. Its queues became unresponsive and running
>> > "rabbitmqctl list_connections" was returning that all the connections
>> > were either "blocking" or "blocked". The documentation doesn't mention
>> > these states. Does anyone know what they mean?
>>
>> > ?To give a bit of context: we noticed this problem when good portion
>> > of our clients stopped receiving messages. Looking at all the servers
>> > we found one that was using too much CPU and also swapping to disk.
>> > This node was the only presenting this behaviour, but it seemed like
>> > this problem compromised the whole cluster. We haven't touched these
>> > servers for ages (they are dedicated to rabbitmq) and the system load
>> > was completely under normal levels. We use simple DNS round-robin for
>> > clients to connect to the cluster and none of our messages are
>> > persistent, so seeing swapping really scared me.
>>
>> > ?After restarting the whole cluster a few times the problem
>> > persisted, always on the same server. We even tried force_reset in all
>> > nodes, but that also didn't help. Things just went back to normal
>> > after we removed the problematic node from the cluster. Now my task if
>> > figure out what can be the problem.
>>
>> > ?Did anyone have experience with this kind of behaviour? I'm even
>> > considering hardware problem, but so far didn't find anything
>> > indicating that was the case.
>>
>> Hi,
>>
>> When RabbitMQ is using more memory than it should,
>> to avoid crashing, it stops accepting new messages.
>>
>> In AMQP publishing messages is asynchronous, and
>> it's illegal to 'reject' a published message.
>>
>> Instead, when RabbitMQ is under a memory pressure
>> it stops receiving data from tcp connections that try to
>> do 'basic_publish'.
>>
>> That's what the 'blocked' connection state means.
>>
>> It's perfectly legal to open second connection and
>> consume messages using it as long as it doesn't do 'basic_publish'.
>>
>> Please check for memory alerts in your RabbitMQ logs,
>> check if memory watermark is being set properly
>> and if you have enough memory for your Rabbit.
>>
>> Cheers,
>> ? Marek
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthew at rabbitmq.com  Fri Feb  4 13:10:45 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 4 Feb 2011 13:10:45 +0000
Subject: [rabbitmq-discuss] Pulling RabbitMQ out of service
In-Reply-To: <AANLkTimfiszCWbmvTXDP+aksewghMm9OffvVuk0puExj@mail.gmail.com>
References: <AANLkTimfiszCWbmvTXDP+aksewghMm9OffvVuk0puExj@mail.gmail.com>
Message-ID: <20110204131044.GM15733@rabbitmq.com>

On Mon, Jan 31, 2011 at 07:26:34AM -0800, Bill Moseley wrote:
> For those of you running multiple RabbitMQ servers in a cluster, what is
> your procedure when you want to shut one of the servers down (e.g. for
> maintenance) but not disrupt overall service?   Queues only live on one
> server so I'm wondering how (or if) you do something to flush out the queue
> before stopping the machine.

Usual best practise is to force clients to reconnect elsewhere,
recreating the resources they need. This may need some careful thought
with ordering of events etc. Frequent best practise is that publishers
create exchanges, and consumers create the queues they need and bind
them as necessary. To avoid missing any messages you'll need to start up
new consumers before taking down the old ones. But they must create new
queues, not on the to-die node. So this requires the queue names must be
fresh, but then you're going to have to deal with the possibilities of
duplicate messages during the period that multiple sets of consumers are
up etc.

The "or-else" routing semantics of RabbitMQ's "Alternate Exchanges" may
well be of use here.
http://www.rabbitmq.com/extensions.html#alternate-exchange

> Now, this is a bit tougher: How about catastrophic failures?  I'm wondering
> about using the complexity of Pacemaker and DRBD vs. tracking incomplete
> jobs and resubmitting after some time.

Horses for courses really. We know of a number of clients who are using
the pacemaker stuff, though frequently with NAS/SAN rather than DRBD. If
you can work out what failures you can withstand and what you can't and
then pick the best approach to match.

Matthew

From moseley at hank.org  Fri Feb  4 15:00:09 2011
From: moseley at hank.org (Bill Moseley)
Date: Fri, 4 Feb 2011 07:00:09 -0800
Subject: [rabbitmq-discuss] Pulling RabbitMQ out of service
In-Reply-To: <20110204131044.GM15733@rabbitmq.com>
References: <AANLkTimfiszCWbmvTXDP+aksewghMm9OffvVuk0puExj@mail.gmail.com>
	<20110204131044.GM15733@rabbitmq.com>
Message-ID: <AANLkTinqO4gQ-kT7yfaoKituECaZNu6rkRBk6bkYRqkK@mail.gmail.com>

On Fri, Feb 4, 2011 at 5:10 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Mon, Jan 31, 2011 at 07:26:34AM -0800, Bill Moseley wrote:
> > For those of you running multiple RabbitMQ servers in a cluster, what is
> > your procedure when you want to shut one of the servers down (e.g. for
> > maintenance) but not disrupt overall service?   Queues only live on one
> > server so I'm wondering how (or if) you do something to flush out the
> queue
> > before stopping the machine.
>
> Usual best practise is to force clients to reconnect elsewhere,
> recreating the resources they need. This may need some careful thought
> with ordering of events etc. Frequent best practise is that publishers
> create exchanges, and consumers create the queues they need and bind
> them as necessary. To avoid missing any messages you'll need to start up
> new consumers before taking down the old ones.


Thanks for responding -- I had just this morning thought about this question
and here was your response!

Configuration on the clients is something I'm trying to reduce -- as well as
the need to trigger a reconnect on all clients manually.  Maybe what I need
is better configuration management.

One approach I was considering is having all clients (producers and
consumers) connect to a load balancer in front of two independent RabbitMQ
brokers.  They would not be in a cluster (although each one could be its own
cluster of machines for scaling).   The balancer only uses one RabbitMQ
broker and the second is hot-standby.  The consumers connect to a different
IP than the producers.   Clients know to reconnect upon loss of a
connection.

Then the trick is to use the load balancer to make the producers move to the
new broker, move some consumers as well, and leave some other consumers to
drain the queues on the old broker before pulling out of service.


But they must create new
> queues, not on the to-die node. So this requires the queue names must be
> fresh, but then you're going to have to deal with the possibilities of
> duplicate messages during the period that multiple sets of consumers are
> up etc.
>

Renaming the queues is only needed if pulling a machine out of cluster (for
the queues that were created on that machine), correct?  I would not need
that with two separate brokers as I describe above, if I follow what you are
saying.



> The "or-else" routing semantics of RabbitMQ's "Alternate Exchanges" may
> well be of use here.
> http://www.rabbitmq.com/extensions.html#alternate-exchange


Yes, I've been looking at those.  Are you saying that if the queue is not
durable then once all the consumers of that queue go away then could use the
alternate-exchange as a type of fail-over?


> > Now, this is a bit tougher: How about catastrophic failures?  I'm
> wondering
> > about using the complexity of Pacemaker and DRBD vs. tracking incomplete
> > jobs and resubmitting after some time.
>
> Horses for courses really. We know of a number of clients who are using
> the pacemaker stuff, though frequently with NAS/SAN rather than DRBD. If
> you can work out what failures you can withstand and what you can't and
> then pick the best approach to match.
>

The story from our IT department is we don't like DRBD and NAS/SAN is too
expensive. ;)  But, they want to be able to yank the plug on a RabbitMQ box
and have the application continue with no disruption.  Basically, no message
is ever lost.

Yes, the key might be knowing what failures we can withstand.  My current
thinking has shifted a bit.  I think that instead of trying to build
something that never fails, just assume it's not very likely to fail but
design the application to handle a queue failure.  What that means is that
for messages (really "jobs" in this case) that must complete, the producer,
or some agent of the producer (perhaps a cron job) will see the job was not
completed in a timely way and send a new message.

Maybe that's not so pretty if the queue has a million messages pending when
it fails, but if that's the case then there's other more serious
problems....


-- 
Bill Moseley
moseley at hank.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110204/148f8846/attachment-0001.htm>

From matthew at rabbitmq.com  Fri Feb  4 15:19:11 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 4 Feb 2011 15:19:11 +0000
Subject: [rabbitmq-discuss] Pulling RabbitMQ out of service
In-Reply-To: <AANLkTinqO4gQ-kT7yfaoKituECaZNu6rkRBk6bkYRqkK@mail.gmail.com>
References: <AANLkTimfiszCWbmvTXDP+aksewghMm9OffvVuk0puExj@mail.gmail.com>
	<20110204131044.GM15733@rabbitmq.com>
	<AANLkTinqO4gQ-kT7yfaoKituECaZNu6rkRBk6bkYRqkK@mail.gmail.com>
Message-ID: <20110204151910.GU15733@rabbitmq.com>

On Fri, Feb 04, 2011 at 07:00:09AM -0800, Bill Moseley wrote:
> One approach I was considering is having all clients (producers and
> consumers) connect to a load balancer in front of two independent RabbitMQ
> brokers.  They would not be in a cluster (although each one could be its own
> cluster of machines for scaling).   The balancer only uses one RabbitMQ
> broker and the second is hot-standby.  The consumers connect to a different
> IP than the producers.   Clients know to reconnect upon loss of a
> connection.
> 
> Then the trick is to use the load balancer to make the producers move to the
> new broker, move some consumers as well, and leave some other consumers to
> drain the queues on the old broker before pulling out of service.

Yup, that approach should work well.

> Renaming the queues is only needed if pulling a machine out of cluster (for
> the queues that were created on that machine), correct?  I would not need
> that with two separate brokers as I describe above, if I follow what you are
> saying.

Correct.

> > The "or-else" routing semantics of RabbitMQ's "Alternate Exchanges" may
> > well be of use here.
> > http://www.rabbitmq.com/extensions.html#alternate-exchange
> 
> Yes, I've been looking at those.  Are you saying that if the queue is not
> durable then once all the consumers of that queue go away then could use the
> alternate-exchange as a type of fail-over?

The unfortunate thing about ae is that it can't be dynamically set on an
exchange.

So in a cluster, if you start with an exchange X with an ae of Y, then
you could have all your clients create exclusive queues and bind them to
X.

At the point you want to move over, you create exchange Y, with ae of Z,
add all the new clients (leave the old running) and the new clients
create new exclusive queues and bind to Y. At this point, the new
clients will not be receiving any messages at all.

Then gracefully shut down your old clients. They should remove their
bindings explicitly to X and then make sure their queues are empty
before disconnecting. Atomically, as soon as they remove their bindings
from X, the ae will kick in and messages will be routed now to Y, which
then shovel them off to the new clients. Provided you do the binding
deletion and queue drain carefully, you should be able to guarantee no
message loss.

Then on the next upgrade step, you're just repeating the process but
with Z for Y. The problem though is that you'll end up with an infinite
change of exchanges X -> Y -> Z -> ...

If you rethink it all, you'll be able to see that you can ensure there's
always just 2 hops by using exchange to exchange bindings. I.e. you
start with A -> X -> [queues]. Then you add Y -> [new queues], then you
add A -> Y and remove A -> X. The only issue here is that those last two
steps cannot be done atomically, so there'll be a window where both new
and old queues can get the same message, or messages can be dropped,
depending on how you order events. But effectively A is abstracting over
which version of the underlying routing topology you're using. It's
really quite powerful, though note that exchange-to-exchange bindings
are also a rabbit-only feature atm.

http://www.rabbitmq.com/extensions.html#exchange-bindings

> The story from our IT department is we don't like DRBD and NAS/SAN is too
> expensive. ;)  But, they want to be able to yank the plug on a RabbitMQ box
> and have the application continue with no disruption.  Basically, no message
> is ever lost.

Then tell them where to sign ;)

> Yes, the key might be knowing what failures we can withstand.  My current
> thinking has shifted a bit.  I think that instead of trying to build
> something that never fails, just assume it's not very likely to fail but
> design the application to handle a queue failure.  What that means is that
> for messages (really "jobs" in this case) that must complete, the producer,
> or some agent of the producer (perhaps a cron job) will see the job was not
> completed in a timely way and send a new message.

Yup. Idempotency of operations here will make your life easier, as will
things like publisher confirms and/or transactions.

> Maybe that's not so pretty if the queue has a million messages pending when
> it fails, but if that's the case then there's other more serious
> problems....

Exactly.

Matthew

From zteve.powell at gmail.com  Fri Feb  4 15:43:04 2011
From: zteve.powell at gmail.com (Steve Powell)
Date: Fri, 4 Feb 2011 15:43:04 +0000
Subject: [rabbitmq-discuss] Sending message through rabbitmq-stomp ->
	exchange(topic) - crashes queue
Message-ID: <E79B6990-B431-4D55-AD55-AF56F198C1A9@rabbitmq.com>

I have raised a bug for this problem.

As reported here Matthew feels that the stomp client is generating the wrong form for the payload of a message, and the code verifies this observation.

On Wed, Feb 02, 2011 at 11:48:19PM +0000, Matthew Sackman wrote:
> Ok, so the message payload is being sent through as a list instead of as
> a binary. My guess without checking further is this is a bug in the
> stomp client in the way it constructs the messages which are then sent
> further into Rabbit, but this may not be the case.


The fix is to send it flattened, of course.

To validate this fix a small testcase is being constructed.

From chrisch at ecollege.com  Fri Feb  4 16:29:49 2011
From: chrisch at ecollege.com (Chris Chew)
Date: Fri, 4 Feb 2011 16:29:49 +0000
Subject: [rabbitmq-discuss] Pulling RabbitMQ out of service
In-Reply-To: <AANLkTinqO4gQ-kT7yfaoKituECaZNu6rkRBk6bkYRqkK@mail.gmail.com>
References: <AANLkTimfiszCWbmvTXDP+aksewghMm9OffvVuk0puExj@mail.gmail.com>
	<20110204131044.GM15733@rabbitmq.com>
	<AANLkTinqO4gQ-kT7yfaoKituECaZNu6rkRBk6bkYRqkK@mail.gmail.com>
Message-ID: <CDE001AD-0B58-44D8-A1B6-4F5E1D8DE616@ecollege.com>

On Feb 4, 2011, at 8:00 AM, Bill Moseley wrote:

The story from our IT department is we don't like DRBD and NAS/SAN is too expensive. ;)  But, they want to be able to yank the plug on a RabbitMQ box and have the application continue with no disruption.  Basically, no message is ever lost.


For what it's worth...

We're currently in production with an active/passive Rabbit writing to a shared volume attached via NFS.  That's working fine for now but in all likelihood will be our first performance bottleneck.  Consequently we're testing performance of an Active/Passive Rabbit writing to a GlusterFS share via the native gluster filesystem driver.  Initial results are looking much better (and cheaper) than what we saw with the more traditional NAS.

Of course the longer term goal is to a) have a better story for A/B/C Rabbit warrens (essentially RAID) and b) add a comfortable amount of failure tolerance into our application workflows, but for now Gluster is looking like a promising next step.

I mention all of this because maybe your IT department will be more comfortable with something like Gluster than DRBD or NAS/SAN.

Good luck!

Chris Chew

P.S. One problem we've seen with the Pacemaker stack and NFS is that sometimes the filesystem isn't unlocked when migrating the resource from the active to the passive server.  A native, fstab'd Gluster volume removes the filesystem from the Pacemaker equation and consequently appears to be more reliable.



From s4nchez at gmail.com  Fri Feb  4 16:31:42 2011
From: s4nchez at gmail.com (Ivan Sanchez)
Date: Fri, 4 Feb 2011 08:31:42 -0800 (PST)
Subject: [rabbitmq-discuss] Blocked connections on rabbitmq 2.2.0
In-Reply-To: <AANLkTi=spp-CEcU2NuaX-+X7dS3VmbJSApvKrfS45KRw@mail.gmail.com>
References: <5064478c-55fc-4312-b847-925a5fb7b8ec@d23g2000prj.googlegroups.com>
	<AANLkTinBf_Cat4ZT9-uT6J_x0yOCSVQ=iYia5t2BBK53@mail.gmail.com>
	<a83097fd-425c-456d-91d4-4e4d8047da2f@r19g2000prm.googlegroups.com>
	<AANLkTi=spp-CEcU2NuaX-+X7dS3VmbJSApvKrfS45KRw@mail.gmail.com>
Message-ID: <fd04613e-fbf7-479c-8eda-dc61d24546b4@h19g2000prh.googlegroups.com>


  Unfortunately when I tried to run 'rabbitmqctl list_queues memory'
during the problem it would never bring a result.

  But you're right, it's possible queues got big in that node (clients
too slow, perhaps). If that's the case, is there a way to prevent the
server from running out of memory? In my context I'd rather drop
unacknowledged messages than making the queue grow forever.

--
Ivan

On Feb 4, 1:01?pm, Marek Majkowski <maje... at gmail.com> wrote:
> On Fri, Feb 4, 2011 at 12:42, Ivan Sanchez <s4nc... at gmail.com> wrote:
> > ?Thank you for your answer. I've got a few of the following alerts:
>
> > ?=INFO REPORT==== 2-Feb-2011::21:05:38 ===
> > vm_memory_high_watermark set. Memory used:6611768328 allowed:
> > 3351445504
>
> > =INFO REPORT==== 2-Feb-2011::21:05:38 ===
> > ? ?alarm_handler: {set,{vm_memory_high_watermark,[]}}
>
> That line means that Rabbit is under memory pressure and
> won't accept any new messages until some memory
> will be freed.
>
> > ?Apart from the cluster setup, the only other setting I have in my
> > config is ERL_MAX_ETS_TABLES=10000.
>
> That shouldn't make a difference.
>
> > ?The part that's confusing to me is that only one node had this issue
> > (even after resetting the whole cluster), and I'm not using persistent
> > messages. So now I'm not sure what else could be causing the memory
> > problem.
>
> > ?Is there anything else I'm missing here?
>
> Maybe the biggest queue landed on that particular node?
> Maybe this node handles all the queues?
>
>
>
>
>
>
>
>
>
> > On Feb 4, 11:53?am, Marek Majkowski <maje... at gmail.com> wrote:
> >> On Thu, Feb 3, 2011 at 20:36, Ivan Sanchez <s4nc... at gmail.com> wrote:
> >> > ?Yesterday I've noticed some very strange behaviour in one of our
> >> > rabbitmq cluster nodes. Its queues became unresponsive and running
> >> > "rabbitmqctl list_connections" was returning that all the connections
> >> > were either "blocking" or "blocked". The documentation doesn't mention
> >> > these states. Does anyone know what they mean?
>
> >> > ?To give a bit of context: we noticed this problem when good portion
> >> > of our clients stopped receiving messages. Looking at all the servers
> >> > we found one that was using too much CPU and also swapping to disk.
> >> > This node was the only presenting this behaviour, but it seemed like
> >> > this problem compromised the whole cluster. We haven't touched these
> >> > servers for ages (they are dedicated to rabbitmq) and the system load
> >> > was completely under normal levels. We use simple DNS round-robin for
> >> > clients to connect to the cluster and none of our messages are
> >> > persistent, so seeing swapping really scared me.
>
> >> > ?After restarting the whole cluster a few times the problem
> >> > persisted, always on the same server. We even tried force_reset in all
> >> > nodes, but that also didn't help. Things just went back to normal
> >> > after we removed the problematic node from the cluster. Now my task if
> >> > figure out what can be the problem.
>
> >> > ?Did anyone have experience with this kind of behaviour? I'm even
> >> > considering hardware problem, but so far didn't find anything
> >> > indicating that was the case.
>
> >> Hi,
>
> >> When RabbitMQ is using more memory than it should,
> >> to avoid crashing, it stops accepting new messages.
>
> >> In AMQP publishing messages is asynchronous, and
> >> it's illegal to 'reject' a published message.
>
> >> Instead, when RabbitMQ is under a memory pressure
> >> it stops receiving data from tcp connections that try to
> >> do 'basic_publish'.
>
> >> That's what the 'blocked' connection state means.
>
> >> It's perfectly legal to open second connection and
> >> consume messages using it as long as it doesn't do 'basic_publish'.
>
> >> Please check for memory alerts in your RabbitMQ logs,
> >> check if memory watermark is being set properly
> >> and if you have enough memory for your Rabbit.
>
> >> Cheers,
> >> ? Marek
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Fri Feb  4 16:58:12 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 04 Feb 2011 16:58:12 +0000
Subject: [rabbitmq-discuss] Blocked connections on rabbitmq 2.2.0
In-Reply-To: <fd04613e-fbf7-479c-8eda-dc61d24546b4@h19g2000prh.googlegroups.com>
References: <5064478c-55fc-4312-b847-925a5fb7b8ec@d23g2000prj.googlegroups.com>	<AANLkTinBf_Cat4ZT9-uT6J_x0yOCSVQ=iYia5t2BBK53@mail.gmail.com>	<a83097fd-425c-456d-91d4-4e4d8047da2f@r19g2000prm.googlegroups.com>	<AANLkTi=spp-CEcU2NuaX-+X7dS3VmbJSApvKrfS45KRw@mail.gmail.com>
	<fd04613e-fbf7-479c-8eda-dc61d24546b4@h19g2000prh.googlegroups.com>
Message-ID: <4D4C3024.5040008@rabbitmq.com>

Ivan,

Ivan Sanchez wrote:
> Unfortunately when I tried to run 'rabbitmqctl list_queues memory' 
> during the problem it would never bring a result.

You may be suffering from one (or more) of the bugs we fixed in the
recent 2.3.x releases. I strongly recommend you upgrade.

> But you're right, it's possible queues got big in that node (clients 
> too slow, perhaps). If that's the case, is there a way to prevent the
>  server from running out of memory?

The server isn't running out of memory as such. It detects it is under
memory pressure and stops accepting new messages. Well before then it
will have started paging messages to disk. That will continue until
enough memory has been freed to resume accepting new messages again.

> In my context I'd rather drop unacknowledged messages than making the
> queue grow forever.

When consuming messages in noAck mode the server can forget about them 
as soon as it has sent them to the client. That creates the risk of 
losing potentially quite a lot of messages though in the event of a 
client or network failure, depending on how much buffering is taking 
place en route.

An alternative would be to configure per-queue message TTLs - see 
http://www.rabbitmq.com/extensions.html#queue-ttl

Both of these assume though that memory is taken up by 
delivered-but-unacknowledged messages, which is by no means certain. So 
I suggest that before trying either approach you a) upgrade to 2.3.1, 
and b) if the problem repeats use 'rabbitmqctl list_queues name 
messages_ready messages_unacknowledged' (it shouldn't block anymore in 
2.3.1) to determine which queues, if any, have many messages ready or 
waiting for acknowledgement.


Regards,

Matthias.

From majek04 at gmail.com  Fri Feb  4 17:32:17 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 4 Feb 2011 17:32:17 +0000
Subject: [rabbitmq-discuss] exceptions on fast opening a number of
 connections / exception on TCP connection
In-Reply-To: <4D4459FF.4090404@gmail.com>
References: <4D4459FF.4090404@gmail.com>
Message-ID: <AANLkTi=ZfwfduVs4Ji54jwCLwzt-+1qN8Fp1P2xRgZMT@mail.gmail.com>

On Sat, Jan 29, 2011 at 18:18, Marcin Krol <mrkafk at gmail.com> wrote:
> I wrote a "stress test" function that (relatively) quickly does the
> following: it creates a number of threads that open a new connection to
> Rabbit, do RPC call over Rabbit, close the connection, sleep some
> milliseconds and iterate again.
>
> I'm getting following exceptions in Rabbit log:
>
> =ERROR REPORT==== 29-Jan-2011::18:06:04 ===
> exception on TCP connection <0.22244.4> from 10.0.0.234:54501
> {inet_error,enomem}
>
>[...]
> If I add some time.sleep between the calls, the problem disappears (see
> class TestThread and function stress_test in code below), but that's
> kind of not the point, right?

I'm afraid I can't help on this one. Maybe you just run out of memory?

Marek

From majek04 at gmail.com  Fri Feb  4 17:36:43 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 4 Feb 2011 17:36:43 +0000
Subject: [rabbitmq-discuss] pika exceptions
In-Reply-To: <4D445C4F.5060904@gmail.com>
References: <4D445C4F.5060904@gmail.com>
Message-ID: <AANLkTintAn5Tj4JgSgvHL_KSLjKtT=FWyhxN=Mhh310O@mail.gmail.com>

On Sat, Jan 29, 2011 at 18:28, Marcin Krol <mrkafk at gmail.com> wrote:
> Hello everyone,
>
> Re "stress test" I wrote about in another mail - even if I increase
> time.sleep pika starts throwing exceptions after a while:
>
>
> Exception in thread Thread-1:
> Traceback (most recent call last):
> ?File "/usr/lib/python2.5/threading.py", line 486, in __bootstrap_inner
> ? ?self.run()
> ?File "./rc_mt2.py", line 167, in run
> ? ?self.testfun(*self.args, **self.kwargs)
> ?File "./rc_mt2.py", line 179, in rpc_testcall
> ? ?repl = rc.call(hello, servnum, rdonly=rdonly)
> ?File "./rc_mt2.py", line 133, in call
> ? ?self.setup_distrib(self.node)
> ?File "./rc_mt2.py", line 88, in setup_distrib
> ? ?self.res = self.chan.queue_declare(exclusive = True)
> ?File "/usr/local/bin/src/pika/pika/spec.py", line 3003, in queue_declare
> ? ?[Queue.DeclareOk])
> ?File "/usr/local/bin/src/pika/pika/channel.py", line 186, in _rpc
> ? ?self._ensure()
> ?File "/usr/local/bin/src/pika/pika/channel.py", line 84, in _ensure
> ? ?raise ChannelClosed(self.channel_close)
> ChannelClosed: Connection.Close(class_id = 0, method_id = 0, reply_code
> = 540, reply_text = 'Pika: method not implemented: Exchange.DeclareOk')

You seem to be using threads and global channel and connection instances.
That's a bad idea.

Try using  a dedicated connection for every thread.

Marek

From alexandru at rabbitmq.com  Fri Feb  4 18:38:00 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 4 Feb 2011 20:38:00 +0200
Subject: [rabbitmq-discuss] How to break RabbitMQ cluster
In-Reply-To: <201101291943.32653.bugs@almad.net>
References: <201101291943.32653.bugs@almad.net>
Message-ID: <20110204183800.GB2394@dakota.doc.ic.ac.uk>

Hi,

Thanks for the report and sorry for the late reply.

I can reproduce all 3 problems on 2.2.0, but I can't reproduce the first
two on 2.3.1 (latest release).  Could you please try again and confirm
this is the case?

On 2.3.1, the last scenario doesn't cause a hang, but fails with an
internal exception (seems like you can't declare a queue in a cluster if
one cluster node is down).  I'm looking into this.

Cheers,
Alex

On Sat, Jan 29, 2011 at 07:43:32PM +0100, Almad wrote:
> Hi,
> 
> our OPs are trying to install and use rabbit in cluster mode and discovered 
> two bad "how-to"s, described here:
> 
> https://gist.github.com/798431
> 
> Any idea how to prevent them, or what configuration could cause it?
> 
> Thanks,
> 
> Almad
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From taylste at gmail.com  Fri Feb  4 23:54:30 2011
From: taylste at gmail.com (Steven Taylor)
Date: Fri, 4 Feb 2011 23:54:30 +0000
Subject: [rabbitmq-discuss] Messaging patterns
Message-ID: <AANLkTi=HqV7FL_5hj5WAL5KxYACjc2zdrUUfsbCeOcA_@mail.gmail.com>

Hi,

where do you go when you want to get another perspective on messaging?
Where do you go for best practice?  Hire the RabbitMQ team?  While I'd like
to do that anyway down the track, are there any seminal / inspirational /
new wave books that you guys can point me to?  Are there particular meetup
events?

Is staring at AQMP protocol specs the best place?  (btw: I once had a
lecturer who was heavily involved in the RFC process for TCP/IP years ago --
he would genuinely recommend that)
In a nutshell, I'm looking for ways to sensibly manage the "conversations"
that go on.  i.e. from what goes in the message packet, to the message flow,
and the entities involved.

On the one hand there are weird things like this...
http://www.freepatentsonline.com/6766508.html

There's FIXML... there's...

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110204/b9a5d5b5/attachment.htm>

From videlalvaro at gmail.com  Fri Feb  4 23:59:53 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 5 Feb 2011 07:59:53 +0800
Subject: [rabbitmq-discuss] Messaging patterns
In-Reply-To: <AANLkTi=HqV7FL_5hj5WAL5KxYACjc2zdrUUfsbCeOcA_@mail.gmail.com>
References: <AANLkTi=HqV7FL_5hj5WAL5KxYACjc2zdrUUfsbCeOcA_@mail.gmail.com>
Message-ID: <0969497D-245D-4FC0-BADF-FA5C65B70622@gmail.com>

Hi Steven,

There's a pretty nice book on messaging patterns: http://www.amazon.com/Enterprise-Integration-Patterns-Designing-Deploying/dp/0321200683/ref=pd_sim_b_1

That book is oriented towards "old" messaging solutions like TIBCO and so on, but you can easily translate those patterns to AMQP and RabbitMQ.

And then you have our book: http://bit.ly/rabbitmq where we discuss some patterns on Chapter 3. We have plans for adding more patterns to that chapter too. 

Regards,

Alvaro

On Feb 5, 2011, at 7:54 AM, Steven Taylor wrote:

> Hi,
>  
> where do you go when you want to get another perspective on messaging?  Where do you go for best practice?  Hire the RabbitMQ team?  While I'd like to do that anyway down the track, are there any seminal / inspirational / new wave books that you guys can point me to?  Are there particular meetup events?
>  
> Is staring at AQMP protocol specs the best place?  (btw: I once had a lecturer who was heavily involved in the RFC process for TCP/IP years ago -- he would genuinely recommend that) 
> In a nutshell, I'm looking for ways to sensibly manage the "conversations" that go on.  i.e. from what goes in the message packet, to the message flow, and the entities involved.
>  
> On the one hand there are weird things like this...
> http://www.freepatentsonline.com/6766508.html
>  
> There's FIXML... there's...
>  
> thanks,
> -Steven
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110205/8c1cd06f/attachment.htm>

From moshima at advent.com  Sat Feb  5 04:38:18 2011
From: moshima at advent.com (Michi Oshima)
Date: Fri, 4 Feb 2011 20:38:18 -0800 (PST)
Subject: [rabbitmq-discuss] Announcing: rabbitmq-proxyauth: A RabbitMQ
 Proxy Authentication patch/Plugin
In-Reply-To: <4C513A7D.6070509@rabbitmq.com>
References: <AANLkTikhoEc9CmnOvOqt3diTXeVKiOow0GTaEswoqhED@mail.gmail.com>
	<4C4D58FB.7090008@rabbitmq.com>
	<AANLkTi=iFRAK+7z6nLN1EhVXUOTsLxOX8Cmjky_rqp+N@mail.gmail.com>
	<4C513A7D.6070509@rabbitmq.com>
Message-ID: <30850031.post@talk.nabble.com>


Hi, I'm just wondering if there is any updates to "rabbitmq-proxyauth"?  I
ask because the feature provided by the plugin would be very useful, and I
would like there to be an "official release" (whatever that means) of the
plugin.  Thanks.

-- 
View this message in context: http://old.nabble.com/Announcing%3A-rabbitmq-proxyauth%3A-A-RabbitMQ-Proxy-Authentication-patch-Plugin-tp29233099p30850031.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From harvey.robin at gmail.com  Sat Feb  5 11:36:44 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Sat, 5 Feb 2011 11:36:44 +0000
Subject: [rabbitmq-discuss] SSL client error after upgrade to 2.3.1
Message-ID: <AANLkTimBHveMof3hUZAv7UkQ_b_LasyPJFU=1qpptLGV@mail.gmail.com>

Hi,

I'm experiencing RabbitMQ server faults when connecting over SSL following
an upgrade to server version 2.3.1.  I have previously had this working fine
using version 2.2.0, if I downgrade my server to this version the SSL starts
working again using the same configuration and client program.

When I try to make an SSL connection, I see the following in the server
logs:

=INFO REPORT==== 5-Feb-2011::11:29:01 ===
accepted TCP connection on 0.0.0.0:5671 from 127.0.0.1:33683

=INFO REPORT==== 5-Feb-2011::11:29:01 ===
starting TCP connection <0.1043.0> from 127.0.0.1:33683

=INFO REPORT==== 5-Feb-2011::11:29:01 ===
upgraded TCP connection <0.1043.0> to SSL

=ERROR REPORT==== 5-Feb-2011::11:29:05 ===
exception on TCP connection <0.1043.0> from 127.0.0.1:33683
{channel0_error,opening,
    {error,function_clause,'connection.open',
        [{rabbit_reader,'-i/2-fun-5-',
             [{tlsv1,{rsa,'3des_ede_cbc',sha,no_export}}]},
         {rabbit_reader,'-infos/2-lc$^0/1-0-',2},
         {rabbit_reader,'-infos/2-lc$^0/1-0-',2},
         {rabbit_reader,handle_method0,2},
         {rabbit_reader,handle_method0,3},
         {rabbit_reader,mainloop,2},
         {rabbit_reader,start_connection,7},
         {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 5-Feb-2011::11:29:05 ===
closing TCP connection <0.1043.0> from 127.0.0.1:33683


My SSL configuration is as follows:

robin at robin-desktop:~$ cat /etc/rabbitmq/rabbitmq.config
[
  {rabbit, [
     {ssl_listeners, [{"0.0.0.0",5671}]},
     {ssl_options, [{cacertfile,"/home/robin/rmq-ssl/testca/cacert.pem"},
                    {certfile,"/home/robin/rmq-ssl/server/cert.pem"},
                    {keyfile,"/home/robin/rmq-ssl/server/key.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,true}]}
   ]}
].


I'm using rabbitmq-server_2.3.1-1_all.deb on Ubuntu 10.10, 64 bit.  When
installing the server I'm using "dpkg -i <server deb file>" and to remove
I'm using "dpkg --purge <server deb file>".  I originally set up the SSL
certificates by following the RabbitMQ documentation here:
http://www.rabbitmq.com/ssl.html


Is there a problem with my RMQ SSL config, or has anything changed with
RMQ/SSL in the 2.3.1 version?

Thanks,
--Robin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110205/96789fc6/attachment-0001.htm>

From taylste at gmail.com  Sat Feb  5 11:42:10 2011
From: taylste at gmail.com (Steven Taylor)
Date: Sat, 5 Feb 2011 11:42:10 +0000
Subject: [rabbitmq-discuss] Messaging patterns
In-Reply-To: <0969497D-245D-4FC0-BADF-FA5C65B70622@gmail.com>
References: <AANLkTi=HqV7FL_5hj5WAL5KxYACjc2zdrUUfsbCeOcA_@mail.gmail.com>
	<0969497D-245D-4FC0-BADF-FA5C65B70622@gmail.com>
Message-ID: <AANLkTi=e3wUBfQHK5dARy2Ltv9NUwYQU4SdW6xSiuGMg@mail.gmail.com>

Hi,

thanks for pointing me to those books.  That Tibco styled one looks like a
good one.

I get the sense that there's a need for link between messaging patterns and
domain specific languages.  Perhaps there's something in the Erlang
community that would help me.

cheers,
-Steven

On 4 February 2011 23:59, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Hi Steven,
>
> There's a pretty nice book on messaging patterns:
> http://www.amazon.com/Enterprise-Integration-Patterns-Designing-Deploying/dp/0321200683/ref=pd_sim_b_1
>
> That book is oriented towards "old" messaging solutions like TIBCO and so
> on, but you can easily translate those patterns to AMQP and RabbitMQ.
>
> And then you have our book: http://bit.ly/rabbitmq where we discuss some
> patterns on Chapter 3. We have plans for adding more patterns to that
> chapter too.
>
> Regards,
>
> Alvaro
>
>   On Feb 5, 2011, at 7:54 AM, Steven Taylor wrote:
>
>   Hi,
>
> where do you go when you want to get another perspective on messaging?
> Where do you go for best practice?  Hire the RabbitMQ team?  While I'd like
> to do that anyway down the track, are there any seminal / inspirational /
> new wave books that you guys can point me to?  Are there particular meetup
> events?
>
> Is staring at AQMP protocol specs the best place?  (btw: I once had a
> lecturer who was heavily involved in the RFC process for TCP/IP years ago --
> he would genuinely recommend that)
> In a nutshell, I'm looking for ways to sensibly manage the "conversations"
> that go on.  i.e. from what goes in the message packet, to the message flow,
> and the entities involved.
>
> On the one hand there are weird things like this...
> http://www.freepatentsonline.com/6766508.html
>
> There's FIXML... there's...
>
> thanks,
> -Steven
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110205/2d183a7e/attachment.htm>

From max.bridgewater at gmail.com  Sat Feb  5 19:40:31 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Sat, 5 Feb 2011 14:40:31 -0500
Subject: [rabbitmq-discuss] Clustering on Same Machine
Message-ID: <AANLkTinn64K1zYC0bVJihAJC65jxQRRy6j61f8uXQOpq@mail.gmail.com>

Hi,

For experimental purposes, I'm trying to create a cluster of three
nodes, all on the same machine. I can run the three nodes by setting
the value of NODE_COUNT to 3 in /etc/init.d/rabbitmq-server.
To create the cluster, I enter the following in /etc/rabbitmq/rabbitmq.config:

[{rabbit, [{cluster_nodes,
['rabbit at ip-10-196-18-9','rabbit_1 at ip-10-196-18-9','rabbit_2 at ip-10-196-18-9']}]}].

Unfortunately, this doesn't work. Error message is: Starting
rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, _err

The last line in the /var/log/rabbitmq/startup_log is below.

Any idea?
Thanks,
Max.

starting database    ...{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},
{'EXIT',{{case_clause,{error,{unable_to_join_cluster,['rabbit at ip-10-196-18-9','rabbit_1 at ip-10-196-18-9','rabbit_2 at ip-10-196-18-9'],{merge_schema_failed,
[66,97,100,32,99,111,111,107,105,101,32,105,110,32,116,97,98,108,101,32,100,101,102,105,110,105,116,105,111,110,32,114,97,98,98,105,116,95,
117,115,101,114,95,112,101,114,109,105,115,115,105,111,110,58,32,39,114,97,98,98,105,116,95,49,64,105,112,45,49,48,45,49,57,54,45,49,56,45,57,
39,32,61,32,123,99,115,116,114,117,99,116,44,114,97,98,98,105,116,95,117,115,101,114,95,112,101,114,109,105,115,115,105,111,110,44,115,101,
116,44,91,93,44,91,39,114,97,98,98,105,116,95,49,64,105,112,45,49,48,45,49,57,54,45,49,56,45,57,39,93,44,91,93,44,48,44,
114,101,97,100,95,119,114,105,116,101,44,91,93,44,91,93,44,102,97,108,115,101,44,117,115,101,114,95,112,101,114,109,105,115,115,105,111,110,44,91,117,115,101,114,95,118,
104,111,115,116,44,112,101,114,109,105,115,115,105,111,110,93,44,91,93,44,91,93,44,123,123,49,50,57,54,44,57,50,50,54,50,51,44,56,49,48,53,56,52,125,44,39,114,97,
98,98,105,116,95,49,64,105,112,45,49,48,45,49,57,54,45,49,56,45,57,39,125,44,123,123,50,44,48,125,44,91,93,125,125,44,32,39,114,97,98,98,105,116,64,105,112,
45,49,48,45,49,57,54,45,49,56,45,57,39,32,61,32,123,99,115,116,114,117,99,116,44,114,97,98,98,105,116,95,117,115,101,114,95,112,101,114,109,105,115,115,
105,111,110,44,115,101,116,44,91,93,44,91,39,114,97,98,98,105,116,64,105,112,45,49,48,45,49,57,54,45,49,56,45,57,39,93,44,91,93,44,48,44,114,101,97,100,95,
119,114,105,116,101,44,91,93,44,91,93,44,102,97,108,115,101,
44,117,115,101,114,95,112,101,114,109,105,115,115,105,111,110,44,91,117,115,101,114,95,118,104,111,115,116,44,112,101,114,109,105,115,115,105,
111,110,93,44,91,93,44,91,93,44,123,123,49,50,57,54,44,57,50,49,56,48,57,44,50,57,53,54,51,53,125,44,39,114,97,98,98,105,116,64,105,112,45,49,48,45,49,57,54,45,49,
56,45,57,39,125,44,123,123,50,44,48,125,44,91,93,125,125,10]}}}},[{rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
{rabbit,run_boot_step,1},{rabbit,'-start/2-lc$^0/1-0-',1},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}"}

From matthias at rabbitmq.com  Sat Feb  5 20:08:50 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 05 Feb 2011 20:08:50 +0000
Subject: [rabbitmq-discuss] SSL client error after upgrade to 2.3.1
In-Reply-To: <AANLkTimBHveMof3hUZAv7UkQ_b_LasyPJFU=1qpptLGV@mail.gmail.com>
References: <AANLkTimBHveMof3hUZAv7UkQ_b_LasyPJFU=1qpptLGV@mail.gmail.com>
Message-ID: <4D4DAE52.6080204@rabbitmq.com>

Robin,

Robin Harvey wrote:
> When I try to make an SSL connection, I see the following in the server 
> logs:
> 
> =ERROR REPORT==== 5-Feb-2011::11:29:05 ===
> exception on TCP connection <0.1043.0> from 127.0.0.1:33683 
> <http://127.0.0.1:33683>
> {channel0_error,opening,
>     {error,function_clause,'connection.open',
>         [{rabbit_reader,'-i/2-fun-5-',
>              [{tlsv1,{rsa,'3des_ede_cbc',sha,no_export}}]},
>          {rabbit_reader,'-infos/2-lc$^0/1-0-',2},
>          {rabbit_reader,'-infos/2-lc$^0/1-0-',2},
>          {rabbit_reader,handle_method0,2},
>          {rabbit_reader,handle_method0,3},
>          {rabbit_reader,mainloop,2},
>          {rabbit_reader,start_connection,7},
>          {proc_lib,init_p_do_apply,3}]}}
> 
> =INFO REPORT==== 5-Feb-2011::11:29:05 ===
> closing TCP connection <0.1043.0> from 127.0.0.1:33683 
> <http://127.0.0.1:33683>

Looks like you have stumbled across a bug in our code, or rather 
Erlang's documentation or code for the ssl module - the 
{rsa,'3des_ede_cbc',sha,no_export} tuple in the above is meant to be a 
triple of {key_exchange(), cipher(), hash()}. Alas it's a 4-tuple. What 
version of Erlang are you running?

Regards,

Matthias.

From m at mlcastle.net  Sat Feb  5 20:13:29 2011
From: m at mlcastle.net (mike castleman)
Date: Sat, 05 Feb 2011 15:13:29 -0500
Subject: [rabbitmq-discuss] event-based use of the RabbitMQ C library
Message-ID: <4D4DAF69.1020407@mlcastle.net>

hi list,

I'm looking at using RabbitMQ and the C library for a project.

In all three of the consumer examples provided with the C library
(amqp_consumer.c, amqp_listen.c, amqp_listenq.c), it seems like
consuming messages blocks on calling amqp_simple_wait_frame().

Is there any way we can select(2) on something or otherwise be notified
when a message is ready to be received?

As far as I can tell, just select()ing on the socket is not sufficient,
because if amqp_simple_wait_frame() reads a partial frame, it will still
block.

Are there examples anywhere of event-driven uses of the RabbitMQ C
library which send and receive on different channels on the same
connection based on some kind of external events?

Thanks a lot,
mlc


-- 
mike castleman
mailto:m at mlcastle.net
tel:+1-646-382-7220
http://mlcastle.net/

From matthias at rabbitmq.com  Sat Feb  5 21:47:15 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 05 Feb 2011 21:47:15 +0000
Subject: [rabbitmq-discuss] SSL client error after upgrade to 2.3.1
In-Reply-To: <AANLkTinOiB6u+np5+VAVq4et92TQ1w4sP0sqK1iaJ-m-@mail.gmail.com>
References: <AANLkTimBHveMof3hUZAv7UkQ_b_LasyPJFU=1qpptLGV@mail.gmail.com>	<4D4DAE52.6080204@rabbitmq.com>
	<AANLkTinOiB6u+np5+VAVq4et92TQ1w4sP0sqK1iaJ-m-@mail.gmail.com>
Message-ID: <4D4DC563.1050204@rabbitmq.com>

[re-cc'ing rabbitmq-discuss]

Robin Harvey wrote:
> My Erlang / OTP packages are all installed from APT:
> 
> robin at robin-desktop:~$ dpkg -l | grep erlang
> ii  erlang-base                           1:13.b.3-dfsg-2ubuntu3         
> [...]

So that's R13B-3, which, according to the docs, returns strings for 
cipher suites instead of triples. Clearly it doesn't or we would get a 
different error.

Please try R14B01. There is a pretty good chance the problem won't exist 
there, judging from the docs and my quick scan of the code.


Regards,

Matthias.

From alexandru at rabbitmq.com  Sat Feb  5 22:13:26 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Sun, 6 Feb 2011 00:13:26 +0200
Subject: [rabbitmq-discuss] Clustering on Same Machine
In-Reply-To: <AANLkTinn64K1zYC0bVJihAJC65jxQRRy6j61f8uXQOpq@mail.gmail.com>
References: <AANLkTinn64K1zYC0bVJihAJC65jxQRRy6j61f8uXQOpq@mail.gmail.com>
Message-ID: <20110205221326.GA2373@dakota.doc.ic.ac.uk>

Hi Max,

That might be caused by stale mnesia databases in /var/lib/rabbitmq.

Could you try to clean that directory (rm -rf /var/lib/rabbitmq/* should
be enough) and try again?

Note that this will remove any messages, queues, etc. from that machine.

Cheers,
Alex

On Sat, Feb 05, 2011 at 02:40:31PM -0500, Max Bridgewater wrote:
> Hi,
> 
> For experimental purposes, I'm trying to create a cluster of three
> nodes, all on the same machine. I can run the three nodes by setting
> the value of NODE_COUNT to 3 in /etc/init.d/rabbitmq-server.
> To create the cluster, I enter the following in /etc/rabbitmq/rabbitmq.config:
> 
> [{rabbit, [{cluster_nodes,
> ['rabbit at ip-10-196-18-9','rabbit_1 at ip-10-196-18-9','rabbit_2 at ip-10-196-18-9']}]}].
> 
> Unfortunately, this doesn't work. Error message is: Starting
> rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, _err
> 
> The last line in the /var/log/rabbitmq/startup_log is below.
> 
> Any idea?
> Thanks,
> Max.
> 
> starting database    ...{"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},
> {'EXIT',{{case_clause,{error,{unable_to_join_cluster,['rabbit at ip-10-196-18-9','rabbit_1 at ip-10-196-18-9','rabbit_2 at ip-10-196-18-9'],{merge_schema_failed,
> [66,97,100,32,99,111,111,107,105,101,32,105,110,32,116,97,98,108,101,32,100,101,102,105,110,105,116,105,111,110,32,114,97,98,98,105,116,95,
> 117,115,101,114,95,112,101,114,109,105,115,115,105,111,110,58,32,39,114,97,98,98,105,116,95,49,64,105,112,45,49,48,45,49,57,54,45,49,56,45,57,
> 39,32,61,32,123,99,115,116,114,117,99,116,44,114,97,98,98,105,116,95,117,115,101,114,95,112,101,114,109,105,115,115,105,111,110,44,115,101,
> 116,44,91,93,44,91,39,114,97,98,98,105,116,95,49,64,105,112,45,49,48,45,49,57,54,45,49,56,45,57,39,93,44,91,93,44,48,44,
> 114,101,97,100,95,119,114,105,116,101,44,91,93,44,91,93,44,102,97,108,115,101,44,117,115,101,114,95,112,101,114,109,105,115,115,105,111,110,44,91,117,115,101,114,95,118,
> 104,111,115,116,44,112,101,114,109,105,115,115,105,111,110,93,44,91,93,44,91,93,44,123,123,49,50,57,54,44,57,50,50,54,50,51,44,56,49,48,53,56,52,125,44,39,114,97,
> 98,98,105,116,95,49,64,105,112,45,49,48,45,49,57,54,45,49,56,45,57,39,125,44,123,123,50,44,48,125,44,91,93,125,125,44,32,39,114,97,98,98,105,116,64,105,112,
> 45,49,48,45,49,57,54,45,49,56,45,57,39,32,61,32,123,99,115,116,114,117,99,116,44,114,97,98,98,105,116,95,117,115,101,114,95,112,101,114,109,105,115,115,
> 105,111,110,44,115,101,116,44,91,93,44,91,39,114,97,98,98,105,116,64,105,112,45,49,48,45,49,57,54,45,49,56,45,57,39,93,44,91,93,44,48,44,114,101,97,100,95,
> 119,114,105,116,101,44,91,93,44,91,93,44,102,97,108,115,101,
> 44,117,115,101,114,95,112,101,114,109,105,115,115,105,111,110,44,91,117,115,101,114,95,118,104,111,115,116,44,112,101,114,109,105,115,115,105,
> 111,110,93,44,91,93,44,91,93,44,123,123,49,50,57,54,44,57,50,49,56,48,57,44,50,57,53,54,51,53,125,44,39,114,97,98,98,105,116,64,105,112,45,49,48,45,49,57,54,45,49,
> 56,45,57,39,125,44,123,123,50,44,48,125,44,91,93,125,125,10]}}}},[{rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
> {rabbit,run_boot_step,1},{rabbit,'-start/2-lc$^0/1-0-',1},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}"}
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From max.bridgewater at gmail.com  Sat Feb  5 22:21:53 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Sat, 5 Feb 2011 17:21:53 -0500
Subject: [rabbitmq-discuss] Clustering on Same Machine
In-Reply-To: <20110205221326.GA2373@dakota.doc.ic.ac.uk>
References: <AANLkTinn64K1zYC0bVJihAJC65jxQRRy6j61f8uXQOpq@mail.gmail.com>
	<20110205221326.GA2373@dakota.doc.ic.ac.uk>
Message-ID: <AANLkTikX_fL8DR3fMK9GKfrBi7ORxHaD_LxF0Fzauher@mail.gmail.com>

Spot on!

Thanks Alex.

Max.

On Sat, Feb 5, 2011 at 5:13 PM, Alexandru Scvor?ov
<alexandru at rabbitmq.com> wrote:
> Hi Max,
>
> That might be caused by stale mnesia databases in /var/lib/rabbitmq.
>
> Could you try to clean that directory (rm -rf /var/lib/rabbitmq/* should
> be enough) and try again?
>
> Note that this will remove any messages, queues, etc. from that machine.
>
> Cheers,
> Alex
>
> On Sat, Feb 05, 2011 at 02:40:31PM -0500, Max Bridgewater wrote:
>> Hi,
>>
>> For experimental purposes, I'm trying to create a cluster of three
>> nodes, all on the same machine. I can run the three nodes by setting
>> the value of NODE_COUNT to 3 in /etc/init.d/rabbitmq-server.
>> To create the cluster, I enter the following in /etc/rabbitmq/rabbitmq.config:
>>
>> [{rabbit, [{cluster_nodes,
>> ['rabbit at ip-10-196-18-9','rabbit_1 at ip-10-196-18-9','rabbit_2 at ip-10-196-18-9']}]}].
>>
>> Unfortunately, this doesn't work. Error message is: Starting
>> rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, _err
>>
>> The last line in the /var/log/rabbitmq/startup_log is below.
>>
>> Any idea?
>> Thanks,
>> Max.
>>
>> starting database ? ?...{"Kernel pid
>> terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},
>> {'EXIT',{{case_clause,{error,{unable_to_join_cluster,['rabbit at ip-10-196-18-9','rabbit_1 at ip-10-196-18-9','rabbit_2 at ip-10-196-18-9'],{merge_schema_failed,
>> [66,97,100,32,99,111,111,107,105,101,32,105,110,32,116,97,98,108,101,32,100,101,102,105,110,105,116,105,111,110,32,114,97,98,98,105,116,95,
>> 117,115,101,114,95,112,101,114,109,105,115,115,105,111,110,58,32,39,114,97,98,98,105,116,95,49,64,105,112,45,49,48,45,49,57,54,45,49,56,45,57,
>> 39,32,61,32,123,99,115,116,114,117,99,116,44,114,97,98,98,105,116,95,117,115,101,114,95,112,101,114,109,105,115,115,105,111,110,44,115,101,
>> 116,44,91,93,44,91,39,114,97,98,98,105,116,95,49,64,105,112,45,49,48,45,49,57,54,45,49,56,45,57,39,93,44,91,93,44,48,44,
>> 114,101,97,100,95,119,114,105,116,101,44,91,93,44,91,93,44,102,97,108,115,101,44,117,115,101,114,95,112,101,114,109,105,115,115,105,111,110,44,91,117,115,101,114,95,118,
>> 104,111,115,116,44,112,101,114,109,105,115,115,105,111,110,93,44,91,93,44,91,93,44,123,123,49,50,57,54,44,57,50,50,54,50,51,44,56,49,48,53,56,52,125,44,39,114,97,
>> 98,98,105,116,95,49,64,105,112,45,49,48,45,49,57,54,45,49,56,45,57,39,125,44,123,123,50,44,48,125,44,91,93,125,125,44,32,39,114,97,98,98,105,116,64,105,112,
>> 45,49,48,45,49,57,54,45,49,56,45,57,39,32,61,32,123,99,115,116,114,117,99,116,44,114,97,98,98,105,116,95,117,115,101,114,95,112,101,114,109,105,115,115,
>> 105,111,110,44,115,101,116,44,91,93,44,91,39,114,97,98,98,105,116,64,105,112,45,49,48,45,49,57,54,45,49,56,45,57,39,93,44,91,93,44,48,44,114,101,97,100,95,
>> 119,114,105,116,101,44,91,93,44,91,93,44,102,97,108,115,101,
>> 44,117,115,101,114,95,112,101,114,109,105,115,115,105,111,110,44,91,117,115,101,114,95,118,104,111,115,116,44,112,101,114,109,105,115,115,105,
>> 111,110,93,44,91,93,44,91,93,44,123,123,49,50,57,54,44,57,50,49,56,48,57,44,50,57,53,54,51,53,125,44,39,114,97,98,98,105,116,64,105,112,45,49,48,45,49,57,54,45,49,
>> 56,45,57,39,125,44,123,123,50,44,48,125,44,91,93,125,125,10]}}}},[{rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>> {rabbit,run_boot_step,1},{rabbit,'-start/2-lc$^0/1-0-',1},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}"}
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From james.r.carr at gmail.com  Sun Feb  6 13:45:59 2011
From: james.r.carr at gmail.com (James Carr)
Date: Sun, 6 Feb 2011 07:45:59 -0600
Subject: [rabbitmq-discuss] Queue bound by a percentage change?
In-Reply-To: <AANLkTi=H7Wd1T=uM3wj2cpDdwA+PHNinDm1WSW3z=8wN@mail.gmail.com>
References: <AANLkTikyLwaNrrdF=rbWWYkjd+Xx4MROx_08Mqcd5npr@mail.gmail.com>
	<AANLkTikSEn=iS4pcQwetKiFAFs8dw9=qS0bFWt6hvP-P@mail.gmail.com>
	<AANLkTinoAAA+BebuQhy0Nf4kisbvoZnOUB6aJZa0dLQb@mail.gmail.com>
	<AANLkTi=H7Wd1T=uM3wj2cpDdwA+PHNinDm1WSW3z=8wN@mail.gmail.com>
Message-ID: <AANLkTi=m36P+utKsoBgUMzr3wgKGt6NZwbHXVb7WNZEW@mail.gmail.com>

After thinking about it for awhile and it seem the best bet is to
create a queue that the application logic dynamicly publishes routing
keys for. The way I currently set this up is:

Client A decides it wants to be notified if a stock drops .2% or more
  * publishes a Command Message indicating as such (something like
{ticker:"IBM", on:"drop", percentage:0.002} )
  * binds to queue stocks.IBM.drop.[>0.2%]
Client B
  * recieves command message and routes notifications with routing key
if the criteria matches

I've yet to investigate shovel but so far this seems to be an ideal solution. :)


Thanks,
James

On Thu, Feb 3, 2011 at 3:44 AM, Robert Raschke <rtrlists at googlemail.com> wrote:
> Hi James,
>
> On Thu, Feb 3, 2011 at 12:47 AM, James Carr <james.r.carr at gmail.com> wrote:
>>
>> > Or you could use a filtering shovel, which does the range checking for
>> > you.
>>
>> filtering shovel? Can you expand on that?
>>
>
> Well, I personally have never used the shovel plugin (I think it's a plugin,
> but it could simply be an add-on, I forget). You can use it to bridge two
> AMQP servers, for example, and those could of course be one and the same. My
> expectation would be that you can specify in some way which messages you
> want the shovel to, err, shovel from one system to the other.
>
> It might be a dead end, but probably worth spending an hour to look at what
> a shovel can do for you.
>
> Let's see, ah, here's a link:
> http://hg.rabbitmq.com/rabbitmq-shovel/file/rabbitmq_v2_3_0/README
>
> From the looks of thing there's no obvious way to add filtering into that;
> at least not from a config perspective, maybe the code is so simple, that
> it's easy to add things you need. Or you could simply use it as a starting
> point for creating your own filter that sits between your queues. Depends a
> bit on how deep into programming you are willing to dive.
>
> Robby
>
>

From harvey.robin at gmail.com  Sun Feb  6 14:34:06 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Sun, 6 Feb 2011 14:34:06 +0000
Subject: [rabbitmq-discuss]  SSL client error after upgrade to 2.3.1
In-Reply-To: <AANLkTikBRArjp0dO1PtD1ndvO1bUVqMpk5oOC7dALW14@mail.gmail.com>
References: <AANLkTimBHveMof3hUZAv7UkQ_b_LasyPJFU=1qpptLGV@mail.gmail.com>
	<4D4DAE52.6080204@rabbitmq.com>
	<AANLkTinOiB6u+np5+VAVq4et92TQ1w4sP0sqK1iaJ-m-@mail.gmail.com>
	<4D4DC563.1050204@rabbitmq.com>
	<AANLkTikBRArjp0dO1PtD1ndvO1bUVqMpk5oOC7dALW14@mail.gmail.com>
Message-ID: <AANLkTim5k9CSkZK68VcCA-OaGk-eJG1MPM3nR=xT3Z=2@mail.gmail.com>

Hi Matthias,

OK, I've installed the R14B01 Erlang package, and I can confirm this fixes
the SSL error outlined above.  FYI, I got the Erlang package from here:

https://launchpad.net/~scattino/+archive/ppa

The package author has this to say:

The Erlang packages are a direct backport of Debian testing/experimental
ones; I am not taking any responsibility for any damage to your system that
they may cause: they work for me(TM), if anyone finds them useful, then good
for them :)

>From what I can see, I *think* that Ubuntu is going to stick with the R13
Erlang version for version 11.04, so I'm not sure if this is likely to cause
issues for Ubuntu users.  There's a useful discussion of this issue here:

http://groups.google.com/group/erlang-programming/browse_thread/thread/ca796d8b727bab3a/87d40fc65b53fbd7

Some posters on that thread thought that Ubuntu 11.04 is going to use R14
because this version is already in the upstream Debian repos, however when I
looked at the Erlang package page on Launchpad it's still showing R13.
 There's a couple of months to go before 11.04 lands, so maybe they're going
to switch to R14 before making the final release?

Thanks very much for your help.
--Robin


On Sat, Feb 5, 2011 at 9:47 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> [re-cc'ing rabbitmq-discuss]
>
> Robin Harvey wrote:
>
>> My Erlang / OTP packages are all installed from APT:
>>
>> robin at robin-desktop:~$ dpkg -l | grep erlang
>> ii  erlang-base                           1:13.b.3-dfsg-2ubuntu3
>> [...]
>>
>
> So that's R13B-3, which, according to the docs, returns strings for cipher
> suites instead of triples. Clearly it doesn't or we would get a different
> error.
>
> Please try R14B01. There is a pretty good chance the problem won't exist
> there, judging from the docs and my quick scan of the code.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110206/4fb253a1/attachment.htm>

From matthias at rabbitmq.com  Sun Feb  6 15:07:02 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 06 Feb 2011 15:07:02 +0000
Subject: [rabbitmq-discuss] SSL client error after upgrade to 2.3.1
In-Reply-To: <AANLkTim5k9CSkZK68VcCA-OaGk-eJG1MPM3nR=xT3Z=2@mail.gmail.com>
References: <AANLkTimBHveMof3hUZAv7UkQ_b_LasyPJFU=1qpptLGV@mail.gmail.com>	<4D4DAE52.6080204@rabbitmq.com>	<AANLkTinOiB6u+np5+VAVq4et92TQ1w4sP0sqK1iaJ-m-@mail.gmail.com>	<4D4DC563.1050204@rabbitmq.com>	<AANLkTikBRArjp0dO1PtD1ndvO1bUVqMpk5oOC7dALW14@mail.gmail.com>
	<AANLkTim5k9CSkZK68VcCA-OaGk-eJG1MPM3nR=xT3Z=2@mail.gmail.com>
Message-ID: <4D4EB916.8060307@rabbitmq.com>

Robin,

Robin Harvey wrote:
> OK, I've installed the R14B01 Erlang package, and I can confirm this 
> fixes the SSL error outlined above.

Excellent.

> From what I can see, I *think* that Ubuntu is going to stick with the 
> R13 Erlang version for version 11.04, so I'm not sure if this is likely 
> to cause issues for Ubuntu users.

Erlang's ssl code base has been changing a lot, which is why running 
rabbit with ssl support requires far more recent versions of Erlang than 
when running without. Having said that, I shall file a bug to see 
whether there is an easy workaround we can apply for R13B04.

Regards,

Matthias.

From james.r.carr at gmail.com  Sun Feb  6 16:14:54 2011
From: james.r.carr at gmail.com (James Carr)
Date: Sun, 6 Feb 2011 10:14:54 -0600
Subject: [rabbitmq-discuss] JSON-RPC reference?
Message-ID: <AANLkTinX7sboOrht3QTYtMmCcU_FA_52dK6T_ocmVoOm@mail.gmail.com>

HI All,

Aside from digging through the sample provided for the JSON-RPC
channel is there any kind of documentation floating around that
describes the services and procedures supported?


Thanks,
James

From david at rabbitmq.com  Sun Feb  6 17:03:26 2011
From: david at rabbitmq.com (David Wragg)
Date: Sun, 06 Feb 2011 17:03:26 +0000
Subject: [rabbitmq-discuss] event-based use of the RabbitMQ C library
In-Reply-To: <4D4DAF69.1020407@mlcastle.net> (mike castleman's message of
	"Sat, 05 Feb 2011 15:13:29 -0500")
References: <4D4DAF69.1020407@mlcastle.net>
Message-ID: <yrv4cwrldt7s1.fsf@dwragg.eng.vmware.com>

Hi Mike,

mike castleman <m at mlcastle.net> writes:
> I'm looking at using RabbitMQ and the C library for a project.
>
> In all three of the consumer examples provided with the C library
> (amqp_consumer.c, amqp_listen.c, amqp_listenq.c), it seems like
> consuming messages blocks on calling amqp_simple_wait_frame().
>
> Is there any way we can select(2) on something or otherwise be notified
> when a message is ready to be received?

librabbitmq does not currently support non-blocking operation.

One workaround is to call librabbitmq from within a thread, and run the
rest of your application within other threads.  But note that
librabbitmq does not allow you to share a connection between threads, so
you won't be able to consume and publish concurrently within a single
thread.  You could open multiple connections, and use one for
publishing, and another for consuming.

And I think you can make the select approach work, but it's a hack.

> As far as I can tell, just select()ing on the socket is not sufficient,
> because if amqp_simple_wait_frame() reads a partial frame, it will still
> block.

You will need to set O_NONBLOCK on the socket.  Then in the partial
frame case, the recv call will return EGAIN or EWOULDBLOCK, and
amqp_simple_wait_frame will return this value in a translated form
(-(errno | ERR_CATEGORY_OS)).  You could detect that and proceed
accordingly.

As I said, it's a hack.

> Are there examples anywhere of event-driven uses of the RabbitMQ C
> library which send and receive on different channels on the same
> connection based on some kind of external events?

librabbitmq does not currently support such cases well.  That might
change in the future, but that's the situation today.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From MVierling at attinteractive.com  Sun Feb  6 17:23:16 2011
From: MVierling at attinteractive.com (Michael Vierling)
Date: Sun, 6 Feb 2011 09:23:16 -0800
Subject: [rabbitmq-discuss] AMQP Erlang client
In-Reply-To: <237050FF255D844CBDF840D42334EB9B66C6B27B4A@SFOEXM02.YELLOWPAGES.LOCAL>
References: <Act3xz1tOp7+38BGT92F2jzYjJcOUw==>
	<237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>,
	<AANLkTi=w-68v8JZW08zu3YV2N9=6ZTX2+rZK0Q18JiP5@mail.gmail.com>
	<237050FF255D844CBDF840D42334EB9B66C6B27B4A@SFOEXM02.YELLOWPAGES.LOCAL>
Message-ID: <237050FF255D844CBDF840D42334EB9B66E62128EF@SFOEXM02.YELLOWPAGES.LOCAL>

Has the Erlang AMQP client code changed recently?  We are attempting to get the metronome plugin to work.  However the following code seems no longer to work:

init([]) ->
  Connection = amqp_connection:start_direct(),
  Channel = amqp_connection:open_channel(Connection),
  amqp_channel:call(Channel, #'exchange.declare'{exchange = <<"metronome">>,
                                                 type = <<"topic">>}),

In the current code, the start_direct function no longer exists.  So I've replaced it with start.

init([]) ->
  Connection = amqp_connection:start(direct),
  Channel = amqp_connection:open_channel(Connection),
  amqp_channel:call(Channel, #'exchange.declare'{exchange = <<"metronome">>,
                                                 type = <<"topic">>}),

However it still doesn't work.

(rabbit at rabbit9)6> Channel = amqp_connection:open_channel(Connection).
** exception exit: {{function_clause,[{gen,call,
                                           [{ok,<0.1066.0>},
                                            '$gen_call',
                                            {command,{open_channel,none}},
                                            infinity]},
                                      {gen_server,call,3},
                                      {amqp_gen_connection,open_channel,2},
                                      {erl_eval,do_apply,5},
                                      {erl_eval,expr,5},
                                      {shell,exprs,7},
                                      {shell,eval_exprs,7},
                                      {shell,eval_loop,3}]},
                    {gen_server,call,
                                [{ok,<0.1066.0>},{command,{open_channel,none}},infinity]}}
     in function  gen_server:call/3
     in call from amqp_gen_connection:open_channel/2
(rabbit at rabbit9)7>

Any ideas?

Thanks,
Michael

From matthew at rabbitmq.com  Sun Feb  6 17:36:45 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 6 Feb 2011 17:36:45 +0000
Subject: [rabbitmq-discuss] AMQP Erlang client
In-Reply-To: <237050FF255D844CBDF840D42334EB9B66E62128EF@SFOEXM02.YELLOWPAGES.LOCAL>
References: <Act3xz1tOp7+38BGT92F2jzYjJcOUw==>
	<237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>
	<AANLkTi=w-68v8JZW08zu3YV2N9=6ZTX2+rZK0Q18JiP5@mail.gmail.com>
	<237050FF255D844CBDF840D42334EB9B66C6B27B4A@SFOEXM02.YELLOWPAGES.LOCAL>
	<237050FF255D844CBDF840D42334EB9B66E62128EF@SFOEXM02.YELLOWPAGES.LOCAL>
Message-ID: <20110206173644.GA23802@wellquite.org>

On Sun, Feb 06, 2011 at 09:23:16AM -0800, Michael Vierling wrote:
> Has the Erlang AMQP client code changed recently?  We are attempting to get the metronome plugin to work.  However the following code seems no longer to work:

Yeah, I'm afraid the metronome plugin page thing is very badly bitrotten
and out of date.

> 
> init([]) ->
>   Connection = amqp_connection:start_direct(),

That should be {ok, Connection} = amqp_connection:start(direct),

>   Channel = amqp_connection:open_channel(Connection),

{ok, Channel} = amqp_connection:open_channel(Connection),

>   amqp_channel:call(Channel, #'exchange.declare'{exchange = <<"metronome">>,
>                                                  type = <<"topic">>}),

That's fine.

Matthew

From jerryk at vmware.com  Sun Feb  6 18:56:44 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Sun, 6 Feb 2011 10:56:44 -0800
Subject: [rabbitmq-discuss] AMQP Erlang client
In-Reply-To: <20110206173644.GA23802@wellquite.org>
References: <Act3xz1tOp7+38BGT92F2jzYjJcOUw==>
	<237050FF255D844CBDF840D42334EB9B66C66279FE@SFOEXM02.YELLOWPAGES.LOCAL>
	<AANLkTi=w-68v8JZW08zu3YV2N9=6ZTX2+rZK0Q18JiP5@mail.gmail.com>
	<237050FF255D844CBDF840D42334EB9B66C6B27B4A@SFOEXM02.YELLOWPAGES.LOCAL>
	<237050FF255D844CBDF840D42334EB9B66E62128EF@SFOEXM02.YELLOWPAGES.LOCAL>
	<20110206173644.GA23802@wellquite.org>
Message-ID: <17310964-7F9A-458C-BD0A-BAE7DB4C9D50@vmware.com>

The last time I looked, even the principal web documentation on the Erlang client itself had succumbed to this bit rot as have various chunks of sample code from beyond the Rabbit team's shores (e.g. in some Github repos).

I vaguely recall either reporting this as a bug or intending to do so... In the meantime, one should tread lightly and double check assumptions with the Erlang client's own code.  Most of the deviations are no more dramatic than the ones Matthew amends here. 

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On Feb 6, 2011, at 9:37 AM, "Matthew Sackman" <matthew at rabbitmq.com> wrote:

> On Sun, Feb 06, 2011 at 09:23:16AM -0800, Michael Vierling wrote:
>> Has the Erlang AMQP client code changed recently?  We are attempting to get the metronome plugin to work.  However the following code seems no longer to work:
> 
> Yeah, I'm afraid the metronome plugin page thing is very badly bitrotten
> and out of date.
> 
>> 
>> init([]) ->
>>  Connection = amqp_connection:start_direct(),
> 
> That should be {ok, Connection} = amqp_connection:start(direct),
> 
>>  Channel = amqp_connection:open_channel(Connection),
> 
> {ok, Channel} = amqp_connection:open_channel(Connection),
> 
>>  amqp_channel:call(Channel, #'exchange.declare'{exchange = <<"metronome">>,
>>                                                 type = <<"topic">>}),
> 
> That's fine.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From prayadav at gmail.com  Sun Feb  6 21:00:03 2011
From: prayadav at gmail.com (Prashant)
Date: Sun, 6 Feb 2011 13:00:03 -0800 (PST)
Subject: [rabbitmq-discuss] AMQP 0.9.1 Specification: Suport for Deliver API
Message-ID: <fa8da284-8925-4a72-8bef-9c749d1246f7@a5g2000vbs.googlegroups.com>

Helo,

I was stuck while trying to use deliver option in channel. Now , in my
experiment , I am trying to use basicRecover to republish all the
unack messages back to the channel. These messages gets again repub ,
so far so good. But i fear , it might go into a loop as ,when Consumer
cannot consume messages it will be returned back to channel.

I looked into Spec refrence and found out that channel has a deliver
mechanism , which basically checks for relivered bit .
Per specification-----
This method delivers a message to the client, via a consumer. In the
asynchronous message delivery model, the client starts a consumer
using the Consume method, then the server responds with Deliver
methods as and when messages arrive for that consumer.

    * The server SHOULD track the number of times a message has been
delivered to clients and when a message is redelivered a certain
number of times - e.g. 5 times - without being acknowledged, the
server SHOULD consider the message to be unprocessable (possibly
causing client applications to abort), and move the message to a dead
letter queue.
-------
Now , my question is how I can leverage this , i.e.  if messge is
redelivered 5 times to channel , I intend to publish a message about
the status of this message with specifics that it has been failed
after trying 5 times...
If , its pssible , where do I need to add the logic to check this,
certainly now publisher as the messages are in channel.Can you please
throw in some pointers.

Regds
Prashant

From gmr at myyearbook.com  Mon Feb  7 00:32:06 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sun, 6 Feb 2011 19:32:06 -0500
Subject: [rabbitmq-discuss] Pika 0.9.1a Released
Message-ID: <AANLkTikLYwHFfeC_aCTLeAXRbqfb+ygiq38akL=Sv--0@mail.gmail.com>

This release represents a substantial refactor of the Pika code base to make
it asynchronous at the core. As such, this release is tagged as alpha and I
am encouraging those familiar with Pika to download this and test it in
their environment and provide feedback. Special thanks go to Tony for the
direction and support, Brian Jones and Chris Hager for code review and to
Marek Majkowski for the improvements to table encoding and decoding.

It has been tested against Python 2.4.4, Python 2.5.4, Python 2.6.1+ and all
versions of RabbitMQ from 2.0 forward.

Users are highly encouraged to review the documentation at
https://tonyg.github.com/pika/

Major Changes since 0.5.2:

 * Pika has been restructured and made to be fully asynchronous at its core
and now supports AMQP 0-9-1 only (RabbitMQ 2.0+)
 * There are many method definition changes, class name changes and module
changes
 * Asynchronous AMQP commands now take a callback parameter for notification
of completion
 * AMQP commands that are specified as synchronous now buffer other calls on
the same channel, sending them when the synchronous commands send their
response frame
 * SelectConnection is now the recommended connection adapter and shows
better performance than the AsyncoreConnection. SelectConnection implements
select, poll, epoll and kqueue for event handling
 * TornadoConnection adds a connection adapter for the Tornado IOLoop
 * Client channel flow control has been removed
 * Support for additional AMQP data types have been added
 * More extensive unit and functional tests added
 * Extensive use of logging at the DEBUG level allows for tracing of all
internal activity in Pika and all frames sent to and from RabbitMQ
 * Emphasis on code readability and well commented code through-out

Internal changes since 0.5.2:

 * Low level debug logging demonstrates client behavior and can be toggled
via
   pika.log.DEBUG boolean value.
 * Classes now implement new style classes
 * Major restructuring of existing modules and classes
 * Universal callback mechanism added, removing events and other callback
   methods
 * Added BaseConenction which extends Connection and builds in default
behaviors
   for asynchronous connection adapters.
 * Abstracted content frame handling to its own class,
channel.ContentHandler
 * ConnectionState class moved from codec to connection
 * Frame class definitions moved from codec to frames
 * Reconnection strategies moved into own module
 * Global callback manager implemented
 * HeartbeatChecker moved to own module
 * PlainCredentials moved to credentials module for extensibility
 * AsyncoreConnection rewritten to align with BaseConnection
 * BlockingConnection rewritten to extend BaseConnection and added
BlockingChannel and BlockingChannelTransport
 * PEP8ification and use more pythonic idioms for areas as appropriate

Installation is available via pypi and directly from source.

Please use the issue tracker at https://github.com/tonyg/pika/issues for any
issues you may encounter and feel free to contact me directly or on list
with any questions or comments.

Regards,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110206/c70e4083/attachment.htm>

From bkjones at gmail.com  Mon Feb  7 02:00:36 2011
From: bkjones at gmail.com (Brian Jones)
Date: Sun, 6 Feb 2011 21:00:36 -0500
Subject: [rabbitmq-discuss] JSON-RPC reference?
In-Reply-To: <AANLkTinX7sboOrht3QTYtMmCcU_FA_52dK6T_ocmVoOm@mail.gmail.com>
References: <AANLkTinX7sboOrht3QTYtMmCcU_FA_52dK6T_ocmVoOm@mail.gmail.com>
Message-ID: <AANLkTikLc0pExEkrayoBuh_vEgsMmJNgeXsMx8XbXT+6@mail.gmail.com>

On Sun, Feb 6, 2011 at 11:14 AM, James Carr <james.r.carr at gmail.com> wrote:

> HI All,
>
> Aside from digging through the sample provided for the JSON-RPC
> channel is there any kind of documentation floating around that
> describes the services and procedures supported?
>

+1
Please?


>
>
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Brian K. Jones
My Blog          http://www.protocolostomy.com
Follow me      http://twitter.com/bkjones
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110206/09767bfd/attachment.htm>

From sameek at arosys.com  Mon Feb  7 10:07:06 2011
From: sameek at arosys.com (sam_mis)
Date: Mon, 7 Feb 2011 02:07:06 -0800 (PST)
Subject: [rabbitmq-discuss]  How to poll queue get new message using Java?
Message-ID: <30862121.post@talk.nabble.com>


Hi 

I am using Rabbitmq Java client library.how i am know that my queue get ,new
message.there is any method that give me notification that new message is
come on queue and my queue is empty.

Thanks



-- 
View this message in context: http://old.nabble.com/How-to-poll-queue-get-new-message-using-Java--tp30862121p30862121.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Mon Feb  7 10:10:50 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 07 Feb 2011 10:10:50 +0000
Subject: [rabbitmq-discuss] AMQP 0.9.1 Specification: Suport for Deliver
 API
In-Reply-To: <fa8da284-8925-4a72-8bef-9c749d1246f7@a5g2000vbs.googlegroups.com>
References: <fa8da284-8925-4a72-8bef-9c749d1246f7@a5g2000vbs.googlegroups.com>
Message-ID: <4D4FC52A.3010605@rabbitmq.com>

Hi Prashant,

On 06/02/11 21:00, Prashant wrote:
> Helo,
>
> I was stuck while trying to use deliver option in channel. Now , in my
> experiment , I am trying to use basicRecover to republish all the
> unack messages back to the channel. These messages gets again repub ,
> so far so good. But i fear , it might go into a loop as ,when Consumer
> cannot consume messages it will be returned back to channel.
>
> I looked into Spec refrence and found out that channel has a deliver
> mechanism , which basically checks for relivered bit .
> Per specification-----
> This method delivers a message to the client, via a consumer. In the
> asynchronous message delivery model, the client starts a consumer
> using the Consume method, then the server responds with Deliver
> methods as and when messages arrive for that consumer.
>
>      * The server SHOULD track the number of times a message has been
> delivered to clients and when a message is redelivered a certain
> number of times - e.g. 5 times - without being acknowledged, the
> server SHOULD consider the message to be unprocessable (possibly
> causing client applications to abort), and move the message to a dead
> letter queue.
> -------
> Now , my question is how I can leverage this , i.e.  if messge is
> redelivered 5 times to channel , I intend to publish a message about
> the status of this message with specifics that it has been failed
> after trying 5 times...
> If , its pssible , where do I need to add the logic to check this,
> certainly now publisher as the messages are in channel.Can you please
> throw in some pointers.

The specification does indeed suggest that a broker should track the 
number of redeliveries. You can get more details about conformance for 
this feature on the specification page:

  http://www.rabbitmq.com/specification.html

The feature that you describe has reference "basic / deliver / 01" and 
is mark as "planned", which means that it has not been implemented yet. 
It is possible to get similar functionality without broker support though.

A possible way to deal with your scenario is to republish 
non-processable messages to a different queue instead of leaving them 
unacknowledged. You might even republish messages together with the 
cause of failure to aid the decision about their fate.

Another option might be to publish messages initially with a processing 
count of 0. Each time a consumer fails to publish the message, republish 
the message to the same queue with an incremented processing count 
instead of leaving the message unacknowledged. When the processing count 
reaches 5 then you can take appropriate action.

Regards

Emile



From matthew at rabbitmq.com  Mon Feb  7 10:19:36 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 7 Feb 2011 10:19:36 +0000
Subject: [rabbitmq-discuss] AMQP 0.9.1 Specification: Suport for Deliver
 API
In-Reply-To: <fa8da284-8925-4a72-8bef-9c749d1246f7@a5g2000vbs.googlegroups.com>
References: <fa8da284-8925-4a72-8bef-9c749d1246f7@a5g2000vbs.googlegroups.com>
Message-ID: <20110207101936.GA11100@rabbitmq.com>

On Sun, Feb 06, 2011 at 01:00:03PM -0800, Prashant wrote:
> I was stuck while trying to use deliver option in channel. Now , in my
> experiment , I am trying to use basicRecover to republish all the
> unack messages back to the channel.

Why? Unacked messages are automatically reinjected back into the queue
when the client disconnects. Thus there is never normally any reason to
use basic.recover.

Basic.reject has more viable use cases, and our extension of this to
basic.nack
(http://www.rabbitmq.com/extensions.html#negative-acknowledgements ) is
somewhat more flexible. But basic.recover is arguably a mis-feature of
the specification and indeed we no longer support
basic.recover{requeue=false} at all.

Matthew

From emile at rabbitmq.com  Mon Feb  7 10:21:59 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 07 Feb 2011 10:21:59 +0000
Subject: [rabbitmq-discuss] How to poll queue get new message using Java?
In-Reply-To: <30862121.post@talk.nabble.com>
References: <30862121.post@talk.nabble.com>
Message-ID: <4D4FC7C7.3090305@rabbitmq.com>

Hi Sam,

> I am using Rabbitmq Java client library.how i am know that my queue get ,new
> message.there is any method that give me notification that new message is
> come on queue and my queue is empty.

If I understand you question correctly, you want notification when 
messages arrive in a queue.

You can have the message delivered to a consumer asynchronously by 
setting up a subscription. The Java API guide has more details:

http://www.rabbitmq.com/api-guide.html#consuming


Regards

Emile

From prayadav at gmail.com  Mon Feb  7 10:30:03 2011
From: prayadav at gmail.com (Prashant)
Date: Mon, 7 Feb 2011 02:30:03 -0800 (PST)
Subject: [rabbitmq-discuss] AMQP 0.9.1 Specification: Suport for Deliver
	API
In-Reply-To: <20110207101936.GA11100@rabbitmq.com>
References: <fa8da284-8925-4a72-8bef-9c749d1246f7@a5g2000vbs.googlegroups.com>
	<20110207101936.GA11100@rabbitmq.com>
Message-ID: <2df9561f-42ed-43f3-9021-5511b6c9e487@l22g2000pre.googlegroups.com>

client is not disconnecing..If message fails for some reason and I
want to process it again , I need to requeue it back and basicRecover
just does that , isn't.
But if you say basicReject is helpful , I will look into it.

Prashant

On Feb 7, 10:19?am, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Sun, Feb 06, 2011 at 01:00:03PM -0800, Prashant wrote:
> > I was stuck while trying to use deliver option in channel. Now , in my
> > experiment , I am trying to use basicRecover to republish all the
> > unack messages back to the channel.
>
> Why? Unacked messages are automatically reinjected back into the queue
> when the client disconnects. Thus there is never normally any reason to
> use basic.recover.
>
> Basic.reject has more viable use cases, and our extension of this to
> basic.nack
> (http://www.rabbitmq.com/extensions.html#negative-acknowledgements) is
> somewhat more flexible. But basic.recover is arguably a mis-feature of
> the specification and indeed we no longer support
> basic.recover{requeue=false} at all.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Mon Feb  7 10:40:50 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 7 Feb 2011 10:40:50 +0000
Subject: [rabbitmq-discuss] AMQP 0.9.1 Specification: Suport for Deliver
 API
In-Reply-To: <2df9561f-42ed-43f3-9021-5511b6c9e487@l22g2000pre.googlegroups.com>
References: <fa8da284-8925-4a72-8bef-9c749d1246f7@a5g2000vbs.googlegroups.com>
	<20110207101936.GA11100@rabbitmq.com>
	<2df9561f-42ed-43f3-9021-5511b6c9e487@l22g2000pre.googlegroups.com>
Message-ID: <20110207104050.GB11100@rabbitmq.com>

On Mon, Feb 07, 2011 at 02:30:03AM -0800, Prashant wrote:
> client is not disconnecing..If message fails for some reason and I
> want to process it again , I need to requeue it back and basicRecover
> just does that , isn't.
> But if you say basicReject is helpful , I will look into it.

Yeah, the issue with basic.recover{requeue=true} is that it just says to
requeue all messages that have been delivered to your channel. This
could easily include messages you're yet to see (though that can be
controlled with basic.qos settings). The reject or nack methods are much
more helpful in allowing you to select which messages are requeued.

Matthew

From peter at cacoethes.co.uk  Mon Feb  7 10:59:36 2011
From: peter at cacoethes.co.uk (Peter Ledbrook)
Date: Mon, 7 Feb 2011 10:59:36 +0000
Subject: [rabbitmq-discuss] [ANN] RabbitMQ Grails Plugin version 0.3 released
Message-ID: <AANLkTi==UN92O5t0Hp_+Ta82L04Okt2y+D1xMm=Ve9xb@mail.gmail.com>

Hi,

I'm pleased to announce that version 0.3 of the Grails RabbitMQ plugin
has been released. In summary, this version:

 * comes with Spring AMQP 1.0.0 M2;
 * has transaction support;
 * has support for pub/sub model;
 * allows you to configure exchanges and bindings in addition to queues;
 * allows applications to connect to any virtual host, not just '/';
 * and has the following Bug fixes:
     * GRAILSPLUGINS-2496 - Messages are now picked up when the
application starts [1]

Enjoy!

Peter

[1] http://jira.codehaus.org/browse/GRAILSPLUGINS-2496

-- 
Peter Ledbrook
Grails Advocate
SpringSource - A Division of VMware

From Chris.Hampson at arm.com  Mon Feb  7 11:56:46 2011
From: Chris.Hampson at arm.com (Chris Hampson)
Date: Mon, 7 Feb 2011 11:56:46 +0000
Subject: [rabbitmq-discuss] Strange Management Plugin Error
Message-ID: <A610E03AD50BFC4D95529A36D37FA55E169794BA70@GEORGE.Emea.Arm.com>

Hi Guys,

I don't think this has been covered in the mailing list so far (apologies if it has, and I'll go squirrel further, hopefully it's a problem unique to use over here).

We're experiencing a strange problem with the Management Plugin. We quite regularly are greeted with a rather intimidating Erlang stack trace when loading pages of the plugin.

The output we're getting posted at the bottom of this message. Normally hitting refresh a few times seems to clear the message and let us at the interface, other than that our cluster seems to be operating ok.

I've posted below the error as it appears on the page, some entries from the logs, and the output of rabbitmqctl status.

This is the only real problem we've experienced so far with RabbitMQ, we've been very impressed, but if anyone's got any suggestions for fixing up this problem we'll be one step closer to perfection ;-)

Many thanks in advance, if you need any further debug/info I'm more than happy to provide it. :-)

Chris H



And now for the gory details:

>From the browser:

Got response code 500 with body

Internal Server Error
The server encountered an error while processing this request:

{error,{exit,{{undef,[{erlang,max,[0,1297079069756]},
                      {rabbit_mgmt_db,gs_update_add,3},
                      {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                      {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                      {lists,foldl,3},
                      {rabbit_mgmt_db,handle_call,3},
                      {gen_server,handle_msg,5},
                      {proc_lib,init_p_do_apply,3}]},
              {gen_server,call,
                          [{global,rabbit_mgmt_db},
                           {get_overview,all},
                           infinity]}},
             [{gen_server,call,3},
              {rabbit_mgmt_db,safe_call,2},
              {rabbit_mgmt_wm_overview,to_json,2},
              {webmachine_resource,resource_call,3},
              {webmachine_resource,do,3},
              {webmachine_decision_core,resource_call,1},
              {webmachine_decision_core,decision,1},
              {webmachine_decision_core,handle_request,2}]}}

>From rabbit\@site1-sasl.log

=CRASH REPORT==== 7-Feb-2011::11:44:29 ===
  crasher:
    pid: <0.9277.47>
    registered_name: []
    exception exit: {undef,[{erlang,max,[0,1297079069756]},
                            {rabbit_mgmt_db,gs_update_add,3},
                            {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                            {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                            {lists,foldl,3},
                            {rabbit_mgmt_db,handle_call,3},
                            {gen_server,handle_msg,5},
                            {proc_lib,init_p_do_apply,3}]}
      in function  gen_server:terminate/6
    initial call: rabbit_mgmt_db:init/1
    ancestors: [<0.200.0>,rabbit_sup,<0.111.0>]
    messages: []
    links: [<0.200.0>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 2584
    stack_size: 23
    reductions: 242620
  neighbours:

=SUPERVISOR REPORT==== 7-Feb-2011::11:44:29 ===
     Supervisor: {global,rabbit_mgmt_global_sup}
     Context:    child_terminated
     Reason:     {undef,[{erlang,max,[0,1297079069756]},
                         {rabbit_mgmt_db,gs_update_add,3},
                         {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                         {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                         {lists,foldl,3},
                         {rabbit_mgmt_db,handle_call,3},
                         {gen_server,handle_msg,5},
                         {proc_lib,init_p_do_apply,3}]}
     Offender:   [{pid,<0.9277.47>},
                  {name,rabbit_mgmt_db},
                  {mfa,{rabbit_mgmt_db,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,5000},
                  {child_type,worker}]

>From rabbit\@site1.log

=ERROR REPORT==== 7-Feb-2011::11:44:29 ===
** Generic server rabbit_mgmt_db terminating
** Last message in was {get_overview,all}
** When Server state == {state,[{channel_exchange_stats,15294516},
                                {channel_queue_exchange_stats,15298613},
                                {channel_queue_stats,15290419},
                                {channel_stats,15282225},
                                {connection_stats,15278128},
                                {consumers,15286322},
                                {queue_stats,15274029}]}
** Reason for termination ==
** {'function not exported',[{erlang,max,[0,1297079069756]},
                             {rabbit_mgmt_db,gs_update_add,3},
                             {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                             {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                             {lists,foldl,3},
                             {rabbit_mgmt_db,handle_call,3},
                             {gen_server,handle_msg,5},
                             {proc_lib,init_p_do_apply,3}]}

=ERROR REPORT==== 7-Feb-2011::11:44:29 ===
webmachine error: path="/api/overview"
{error,{exit,{{undef,[{erlang,max,[0,1297079069756]},
                      {rabbit_mgmt_db,gs_update_add,3},
                      {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                      {rabbit_mgmt_db,'-gs_update/2-lc$^1/1-1-',3},
                      {lists,foldl,3},
                      {rabbit_mgmt_db,handle_call,3},
                      {gen_server,handle_msg,5},
                      {proc_lib,init_p_do_apply,3}]},
              {gen_server,call,
                          [{global,rabbit_mgmt_db},
                           {get_overview,all},
                           infinity]}},
             [{gen_server,call,3},
              {rabbit_mgmt_db,safe_call,2},
              {rabbit_mgmt_wm_overview,to_json,2},
              {webmachine_resource,resource_call,3},
              {webmachine_resource,do,3},
              {webmachine_decision_core,resource_call,1},
              {webmachine_decision_core,decision,1},
              {webmachine_decision_core,handle_request,2}]}}

And finally rabbitmq status so you can see what we're running:

Status of node 'rabbit at site1' ...
[{running_applications,
     [{rabbit_jsonrpc_channel,"RabbitMQ JSON-RPC Channels","2.3.1"},
      {rabbit_management,"RabbitMQ Management Console","2.3.1"},
      {webmachine,"webmachine","1.7.0"},
      {rabbit_management_agent,"RabbitMQ Management Agent","2.3.1"},
      {rabbit_jsonrpc_channel_test,"rabbit_jsonrpc_channel_test","0.01"},
      {amqp_client,"RabbitMQ AMQP Client","2.3.1"},
      {rfc4627_jsonrpc,"JSON RPC Service","0.01"},
      {rabbit_jsonrpc,"Rabbit JSON-RPC","2.3.1"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.3.1"},
      {mochiweb,"MochiMedia Web Server","1.3"},
      {crypto,"CRYPTO version 1","1.5.3"},
      {inets,"INETS  CXC 138 49","5.0.12"},
      {rabbit_stomp,"Embedded Rabbit Stomp Adapter","2.3.1"},
      {rabbit,"RabbitMQ","2.3.1"},
      {mnesia,"MNESIA  CXC 138 12","4.4.7"},
      {os_mon,"CPO  CXC 138 46","2.1.8"},
      {sasl,"SASL  CXC 138 11","2.1.5.4"},
      {stdlib,"ERTS  CXC 138 10","1.15.5"},
      {kernel,"ERTS  CXC 138 10","2.12.5"}]},
 {nodes,
     [{disc,['rabbit at site1']},
      {ram,['rabbit at site4','rabbit at site3','rabbit at site2']}]},
 {running_nodes,
     ['rabbit at site3','rabbit at site2','rabbit at site4',
      'rabbit at site1']}]
...done.

-- IMPORTANT NOTICE: The contents of this email and any attachments are confidential and may also be privileged. If you are not the intended recipient, please notify the sender immediately and do not disclose the contents to any other person, use it for any purpose, or store or copy the information in any medium.  Thank you.


From simon at rabbitmq.com  Mon Feb  7 12:13:28 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 07 Feb 2011 12:13:28 +0000
Subject: [rabbitmq-discuss] Strange Management Plugin Error
In-Reply-To: <A610E03AD50BFC4D95529A36D37FA55E169794BA70@GEORGE.Emea.Arm.com>
References: <A610E03AD50BFC4D95529A36D37FA55E169794BA70@GEORGE.Emea.Arm.com>
Message-ID: <4D4FE1E8.5080808@rabbitmq.com>

Hi Chris

On 07/02/11 11:56, Chris Hampson wrote:
> {error,{exit,{{undef,[{erlang,max,[0,1297079069756]},


> {stdlib,"ERTS  CXC 138 10","1.15.5"}

It looks like you're running Erlang R12B05. We don't support the 
management plugin on this old an Erlang.

In fact rabbit_mochiweb used to blow up on startup with R12. I guess 
some of the changes that went in recently to reduce its dependencies now 
allow you to run it on R12, so it might be possible to fix the remaining 
issues and get it supported on older Erlangs. But that won't happen today.

I assume you're a RHEL / CentOS 5 user? There is some discussion here 
about using a newer Erlang on that platform:

http://old.nabble.com/Mgmt-plugin-(2.1.1)-td30020890.html

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From alexandru at rabbitmq.com  Mon Feb  7 12:13:56 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 7 Feb 2011 14:13:56 +0200
Subject: [rabbitmq-discuss] How to break RabbitMQ cluster
In-Reply-To: <201101291943.32653.bugs@almad.net>
References: <201101291943.32653.bugs@almad.net>
Message-ID: <20110207121356.GA2414@dakota.doc.ic.ac.uk>

Hi,

About the third case:
  1) if you declare a durable queue on a clustered node and bring down
     that node, any attempts to re-declare that queue on a different
     node should result in NOT_FOUND exceptions;
  2) that said, there's an error in our code that causes INTERNAL_ERRORS
     to be sent instead; I've opened a bug for this, and we will fix it.

Thank you for the report.

Cheers,
Alex

On Sat, Jan 29, 2011 at 07:43:32PM +0100, Almad wrote:
> Hi,
> 
> our OPs are trying to install and use rabbit in cluster mode and discovered 
> two bad "how-to"s, described here:
> 
> https://gist.github.com/798431
> 
> Any idea how to prevent them, or what configuration could cause it?
> 
> Thanks,
> 
> Almad
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Mon Feb  7 12:51:10 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 07 Feb 2011 12:51:10 +0000
Subject: [rabbitmq-discuss] Strange Management Plugin Error
In-Reply-To: <4D4FE1E8.5080808@rabbitmq.com>
References: <A610E03AD50BFC4D95529A36D37FA55E169794BA70@GEORGE.Emea.Arm.com>
	<4D4FE1E8.5080808@rabbitmq.com>
Message-ID: <4D4FEABE.6020909@rabbitmq.com>

On 07/02/11 12:13, Simon MacMullen wrote:
> Hi Chris
>
> On 07/02/11 11:56, Chris Hampson wrote:
>> {error,{exit,{{undef,[{erlang,max,[0,1297079069756]},
>
>
>> {stdlib,"ERTS CXC 138 10","1.15.5"}
>
> It looks like you're running Erlang R12B05. We don't support the
> management plugin on this old an Erlang.
>
> In fact rabbit_mochiweb used to blow up on startup with R12. I guess
> some of the changes that went in recently to reduce its dependencies now
> allow you to run it on R12, so it might be possible to fix the remaining
> issues and get it supported on older Erlangs.

Actually I still can't get this to work. rabbit_mochiweb still blows up 
on R12B05 for me. Can you tell me more about your Erlang / OS installation?

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From max.bridgewater at gmail.com  Mon Feb  7 13:00:55 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Mon, 7 Feb 2011 08:00:55 -0500
Subject: [rabbitmq-discuss] How do I protect rabbitmqctl?
Message-ID: <AANLkTikKhcPMYg2jfo9=G8TU1t+P3r_X+3vPK5zJoGfj@mail.gmail.com>

Hi,

I've got a pretty simple question. I created a user called "root",
then I set this user to admin (rabbitmqctl set_admin root) and cleared
admin rights from from all other users (guest, etc.). Now, similar as
when using mysql client, I was expecting that at some point, the tool
rabbitmqctl would require credentials for creating new users and
setting permissions. This doesn't seem to be the case. I'm missing
something?

Thanks,
Max.

From majek04 at gmail.com  Mon Feb  7 13:04:47 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 7 Feb 2011 13:04:47 +0000
Subject: [rabbitmq-discuss] JSON-RPC reference?
In-Reply-To: <AANLkTinX7sboOrht3QTYtMmCcU_FA_52dK6T_ocmVoOm@mail.gmail.com>
References: <AANLkTinX7sboOrht3QTYtMmCcU_FA_52dK6T_ocmVoOm@mail.gmail.com>
Message-ID: <AANLkTin7jqAaW005DaRmP_NYiwwejKo-rOzsq=-4UV36@mail.gmail.com>

On Sun, Feb 6, 2011 at 16:14, James Carr <james.r.carr at gmail.com> wrote:
> Aside from digging through the sample provided for the JSON-RPC
> channel is there any kind of documentation floating around that
> describes the services and procedures supported?

No, I'm afraid the only option is reading the source code.


We have few in-house initiatives on how to replace
jsonrpc with something more supported, but the topic
is complex and requires a lot of engineering.

Cheers,
  Marek

From simon at rabbitmq.com  Mon Feb  7 13:04:55 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 07 Feb 2011 13:04:55 +0000
Subject: [rabbitmq-discuss] How do I protect rabbitmqctl?
In-Reply-To: <AANLkTikKhcPMYg2jfo9=G8TU1t+P3r_X+3vPK5zJoGfj@mail.gmail.com>
References: <AANLkTikKhcPMYg2jfo9=G8TU1t+P3r_X+3vPK5zJoGfj@mail.gmail.com>
Message-ID: <4D4FEDF7.4030607@rabbitmq.com>

On 07/02/11 13:00, Max Bridgewater wrote:
> I've got a pretty simple question. I created a user called "root",
> then I set this user to admin (rabbitmqctl set_admin root) and cleared
> admin rights from from all other users (guest, etc.). Now, similar as
> when using mysql client, I was expecting that at some point, the tool
> rabbitmqctl would require credentials for creating new users and
> setting permissions. This doesn't seem to be the case. I'm missing
> something?

rabbitmqctl connects to Rabbit using the Erlang cookie. Possession of 
this cookie is equivalent to being an admin user (the admin user flag is 
used by the management plugin).

If you installed from .deb / RPM packages the cookie file should only be 
available to the rabbitmq user (and thus root via the script wrappers). 
If you installed by hand, check your home directory for .erlang.cookie 
and set permissions as appropriate.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From videlalvaro at gmail.com  Mon Feb  7 13:05:02 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 7 Feb 2011 21:05:02 +0800
Subject: [rabbitmq-discuss] How do I protect rabbitmqctl?
In-Reply-To: <AANLkTikKhcPMYg2jfo9=G8TU1t+P3r_X+3vPK5zJoGfj@mail.gmail.com>
References: <AANLkTikKhcPMYg2jfo9=G8TU1t+P3r_X+3vPK5zJoGfj@mail.gmail.com>
Message-ID: <E4C33D5B-C4DD-48FE-B7C6-0E07EA824DD9@gmail.com>

Hi,

One thing is the "AMQP" user that you created called root. Another one is the user that has access to the rabbitmqctl command.

Regards,

Alvaro

On Feb 7, 2011, at 9:00 PM, Max Bridgewater wrote:

> Hi,
> 
> I've got a pretty simple question. I created a user called "root",
> then I set this user to admin (rabbitmqctl set_admin root) and cleared
> admin rights from from all other users (guest, etc.). Now, similar as
> when using mysql client, I was expecting that at some point, the tool
> rabbitmqctl would require credentials for creating new users and
> setting permissions. This doesn't seem to be the case. I'm missing
> something?
> 
> Thanks,
> Max.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthew at rabbitmq.com  Mon Feb  7 13:06:52 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 7 Feb 2011 13:06:52 +0000
Subject: [rabbitmq-discuss] How do I protect rabbitmqctl?
In-Reply-To: <AANLkTikKhcPMYg2jfo9=G8TU1t+P3r_X+3vPK5zJoGfj@mail.gmail.com>
References: <AANLkTikKhcPMYg2jfo9=G8TU1t+P3r_X+3vPK5zJoGfj@mail.gmail.com>
Message-ID: <20110207130651.GF11100@rabbitmq.com>

On Mon, Feb 07, 2011 at 08:00:55AM -0500, Max Bridgewater wrote:
> I've got a pretty simple question. I created a user called "root",
> then I set this user to admin (rabbitmqctl set_admin root) and cleared
> admin rights from from all other users (guest, etc.). Now, similar as
> when using mysql client, I was expecting that at some point, the tool
> rabbitmqctl would require credentials for creating new users and
> setting permissions. This doesn't seem to be the case. I'm missing
> something?

It does require credentials, and you do provide credentials, in the form
of the erlang.cookie file.

Matthew

From max.bridgewater at gmail.com  Mon Feb  7 13:32:28 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Mon, 7 Feb 2011 08:32:28 -0500
Subject: [rabbitmq-discuss] How do I protect rabbitmqctl?
In-Reply-To: <20110207130651.GF11100@rabbitmq.com>
References: <AANLkTikKhcPMYg2jfo9=G8TU1t+P3r_X+3vPK5zJoGfj@mail.gmail.com>
	<20110207130651.GF11100@rabbitmq.com>
Message-ID: <AANLkTin4iToCJ9kdCTWkAA1OFst08=Cny1SukJWz_Rbs@mail.gmail.com>

Thanks Folks. I was missing the cookie piece. This rounds up my
understanding of authentication.

Max.

On Mon, Feb 7, 2011 at 8:06 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Mon, Feb 07, 2011 at 08:00:55AM -0500, Max Bridgewater wrote:
>> I've got a pretty simple question. I created a user called "root",
>> then I set this user to admin (rabbitmqctl set_admin root) and cleared
>> admin rights from from all other users (guest, etc.). Now, similar as
>> when using mysql client, I was expecting that at some point, the tool
>> rabbitmqctl would require credentials for creating new users and
>> setting permissions. This doesn't seem to be the case. I'm missing
>> something?
>
> It does require credentials, and you do provide credentials, in the form
> of the erlang.cookie file.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From Chris.Hampson at arm.com  Mon Feb  7 13:34:35 2011
From: Chris.Hampson at arm.com (Chris Hampson)
Date: Mon, 7 Feb 2011 13:34:35 +0000
Subject: [rabbitmq-discuss] Strange Management Plugin Error
In-Reply-To: <4D4FEABE.6020909@rabbitmq.com>
References: <A610E03AD50BFC4D95529A36D37FA55E169794BA70@GEORGE.Emea.Arm.com>
	<4D4FE1E8.5080808@rabbitmq.com> <4D4FEABE.6020909@rabbitmq.com>
Message-ID: <A610E03AD50BFC4D95529A36D37FA55E169794BACB@GEORGE.Emea.Arm.com>

Hi Simon,

Yup, we're CentOS 5.5 over here on all nodes, and were previously running R12B (5.6.5 was also mentioned when running the erl shell).

I've just upgraded all our nodes to R14B (5.8.1) from the repository mentioned in the set of posts you pointed me at.

(http://repos.fedorapeople.org/repos/peter/erlang/ for any users experiencing the same problem).

So far so good, we're back up and running with the new version of erlang, all nodes are happy and no sign of that stack trace.

I'm a little reluctant to declare the problem fixed yet, as it was seemingly intermittent, but I'll post an update tomorrow if we haven't seen the stack-trace (well, and if we have too). Fingers crossed.

Thanks for the rapid response, you guys are doing a brilliant job with this product :-)

Chris

> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
> discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
> Sent: 07 February 2011 12:51
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Strange Management Plugin Error
>
> On 07/02/11 12:13, Simon MacMullen wrote:
> > Hi Chris
> >
> > On 07/02/11 11:56, Chris Hampson wrote:
> >> {error,{exit,{{undef,[{erlang,max,[0,1297079069756]},
> >
> >
> >> {stdlib,"ERTS CXC 138 10","1.15.5"}
> >
> > It looks like you're running Erlang R12B05. We don't support the
> > management plugin on this old an Erlang.
> >
> > In fact rabbit_mochiweb used to blow up on startup with R12. I guess
> > some of the changes that went in recently to reduce its dependencies
> now
> > allow you to run it on R12, so it might be possible to fix the
> remaining
> > issues and get it supported on older Erlangs.
>
> Actually I still can't get this to work. rabbit_mochiweb still blows up
> on R12B05 for me. Can you tell me more about your Erlang / OS
> installation?
>
> Cheers, Simon
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- IMPORTANT NOTICE: The contents of this email and any attachments are confidential and may also be privileged. If you are not the intended recipient, please notify the sender immediately and do not disclose the contents to any other person, use it for any purpose, or store or copy the information in any medium.  Thank you.


From simon at rabbitmq.com  Mon Feb  7 13:37:24 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 07 Feb 2011 13:37:24 +0000
Subject: [rabbitmq-discuss] Strange Management Plugin Error
In-Reply-To: <A610E03AD50BFC4D95529A36D37FA55E169794BACB@GEORGE.Emea.Arm.com>
References: <A610E03AD50BFC4D95529A36D37FA55E169794BA70@GEORGE.Emea.Arm.com>	<4D4FE1E8.5080808@rabbitmq.com>
	<4D4FEABE.6020909@rabbitmq.com>
	<A610E03AD50BFC4D95529A36D37FA55E169794BACB@GEORGE.Emea.Arm.com>
Message-ID: <4D4FF594.3050900@rabbitmq.com>

On 07/02/11 13:34, Chris Hampson wrote:
> I've just upgraded all our nodes to R14B (5.8.1) from the repository
> mentioned in the set of posts you pointed me at.

Oh, it actually exists now? That's good news.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From bkjones at gmail.com  Mon Feb  7 15:05:49 2011
From: bkjones at gmail.com (Brian Jones)
Date: Mon, 7 Feb 2011 10:05:49 -0500
Subject: [rabbitmq-discuss] JSON-RPC reference?
In-Reply-To: <AANLkTin7jqAaW005DaRmP_NYiwwejKo-rOzsq=-4UV36@mail.gmail.com>
References: <AANLkTinX7sboOrht3QTYtMmCcU_FA_52dK6T_ocmVoOm@mail.gmail.com>
	<AANLkTin7jqAaW005DaRmP_NYiwwejKo-rOzsq=-4UV36@mail.gmail.com>
Message-ID: <AANLkTinZjv1dUUAKd-SDOC7=JvvhM00VAQVko0XevT5z@mail.gmail.com>

On Mon, Feb 7, 2011 at 8:04 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Sun, Feb 6, 2011 at 16:14, James Carr <james.r.carr at gmail.com> wrote:
> > Aside from digging through the sample provided for the JSON-RPC
> > channel is there any kind of documentation floating around that
> > describes the services and procedures supported?
>
> No, I'm afraid the only option is reading the source code.
>
>
> We have few in-house initiatives on how to replace
> jsonrpc with something more supported, but the topic
> is complex and requires a lot of engineering.
>

Are you suggesting that jsonrpc is one or more of:
      1. Not well supported
      2. Deprecated

If it's going to be replaced at some point, I can understand the complete
lack of any docs outside of source code, but then what will be replacing it?
Should I hold off sifting source code until that gets released? Are docs
being neglected because you want to discourage adoption until some other
facility is made public?

If it's not going to be replaced at some point in the nearer term, is it
unreasonable to request a doc for it that is similar to the one for the
Management API?

thanks.

>
> Cheers,
>   Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Brian K. Jones
My Blog          http://www.protocolostomy.com
Follow me      http://twitter.com/bkjones
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110207/23bfae36/attachment.htm>

From steve at rabbitmq.com  Mon Feb  7 15:08:52 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 7 Feb 2011 15:08:52 +0000
Subject: [rabbitmq-discuss] Sending message through rabbitmq-stomp ->
	exchange(topic) - crashes queue
Message-ID: <136F3B85-2AD2-435C-845C-88E95E887DCD@rabbitmq.com>

A (simple) fix to this problem is now in QA.

There are some performance changes to the Stomp Gateway implementation in development which will also affect this area of the codebase.

Steve Powell

From james.r.carr at gmail.com  Mon Feb  7 15:18:14 2011
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 7 Feb 2011 09:18:14 -0600
Subject: [rabbitmq-discuss] JSON-RPC reference?
In-Reply-To: <AANLkTinZjv1dUUAKd-SDOC7=JvvhM00VAQVko0XevT5z@mail.gmail.com>
References: <AANLkTinX7sboOrht3QTYtMmCcU_FA_52dK6T_ocmVoOm@mail.gmail.com>
	<AANLkTin7jqAaW005DaRmP_NYiwwejKo-rOzsq=-4UV36@mail.gmail.com>
	<AANLkTinZjv1dUUAKd-SDOC7=JvvhM00VAQVko0XevT5z@mail.gmail.com>
Message-ID: <AANLkTinzEOVVsN2s3rSa_7E1kUhmJjEYOC4bRKsWSz1m@mail.gmail.com>

I would love to create a websocket based API for rabbitmq (using STOMP
or whatever) but my current lack of erlang skills prevent me from
doing so.

I'm working my way through Erlang and OTP in Action, so I pray that
the skills I need will come quickly. I always tout websockets allowing
browsers to communicate directly with message brokers as being the
future in presentations I give. :)

Thanks,
James

On Mon, Feb 7, 2011 at 9:05 AM, Brian Jones <bkjones at gmail.com> wrote:
>
>
> On Mon, Feb 7, 2011 at 8:04 AM, Marek Majkowski <majek04 at gmail.com> wrote:
>>
>> On Sun, Feb 6, 2011 at 16:14, James Carr <james.r.carr at gmail.com> wrote:
>> > Aside from digging through the sample provided for the JSON-RPC
>> > channel is there any kind of documentation floating around that
>> > describes the services and procedures supported?
>>
>> No, I'm afraid the only option is reading the source code.
>>
>>
>> We have few in-house initiatives on how to replace
>> jsonrpc with something more supported, but the topic
>> is complex and requires a lot of engineering.
>
> Are you suggesting that jsonrpc is one or more of:
> ?? ? ?1. Not well supported
> ?? ? ?2. Deprecated
> If it's going to be replaced at some point, I can understand the complete
> lack of any docs outside of source code, but then what will be replacing it?
> Should I hold off sifting source code until that gets released? Are docs
> being neglected because you want to discourage adoption until some other
> facility is made public?
> If it's not going to be replaced at some point in the nearer term, is it
> unreasonable to request a doc for it that is similar to the one for the
> Management API?
> thanks.
>>
>> Cheers,
>> ?Marek
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> --
> Brian K. Jones
> My Blog? ? ? ? ? http://www.protocolostomy.com
> Follow me? ? ? http://twitter.com/bkjones
>

From gmr at myyearbook.com  Mon Feb  7 15:27:16 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 7 Feb 2011 10:27:16 -0500
Subject: [rabbitmq-discuss] JSON-RPC reference?
In-Reply-To: <AANLkTin7jqAaW005DaRmP_NYiwwejKo-rOzsq=-4UV36@mail.gmail.com>
References: <AANLkTinX7sboOrht3QTYtMmCcU_FA_52dK6T_ocmVoOm@mail.gmail.com>
	<AANLkTin7jqAaW005DaRmP_NYiwwejKo-rOzsq=-4UV36@mail.gmail.com>
Message-ID: <AANLkTim008qzrmK=wLfFdNrDom71Zj=V8Mygny1s6qOq@mail.gmail.com>

Hey Marek,

We're currently evaluating looking at this in production for use in
delivering large amounts of messages in single transactions from lots of web
applications where a persistent connection can't be maintained with RabbitMQ
and the large volume of connect/disconnects are problematic.

Currently my thinking was this was the best way to go but I am concerned
that it will be deprecated. Will this be maintained for the foreseeable
future?

Regards,

Gavin

On Mon, Feb 7, 2011 at 8:04 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Sun, Feb 6, 2011 at 16:14, James Carr <james.r.carr at gmail.com> wrote:
> > Aside from digging through the sample provided for the JSON-RPC
> > channel is there any kind of documentation floating around that
> > describes the services and procedures supported?
>
> No, I'm afraid the only option is reading the source code.
>
>
> We have few in-house initiatives on how to replace
> jsonrpc with something more supported, but the topic
> is complex and requires a lot of engineering.
>
> Cheers,
>   Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110207/a1424794/attachment.htm>

From simon at rabbitmq.com  Mon Feb  7 15:33:21 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 07 Feb 2011 15:33:21 +0000
Subject: [rabbitmq-discuss] Announcing: rabbitmq-proxyauth: A RabbitMQ
 Proxy Authentication patch/Plugin
In-Reply-To: <30850031.post@talk.nabble.com>
References: <AANLkTikhoEc9CmnOvOqt3diTXeVKiOow0GTaEswoqhED@mail.gmail.com>	<4C4D58FB.7090008@rabbitmq.com>	<AANLkTi=iFRAK+7z6nLN1EhVXUOTsLxOX8Cmjky_rqp+N@mail.gmail.com>	<4C513A7D.6070509@rabbitmq.com>
	<30850031.post@talk.nabble.com>
Message-ID: <4D5010C1.1000002@rabbitmq.com>

On 05/02/11 04:38, Michi Oshima wrote:
> Hi, I'm just wondering if there is any updates to "rabbitmq-proxyauth"?  I
> ask because the feature provided by the plugin would be very useful, and I
> would like there to be an "official release" (whatever that means) of the
> plugin.  Thanks.

I can't answer that question I'm afraid but it's worth pointing out (in 
case Scott is reading :-) that RabbitMQ 2.3.1 now has a plugin mechanism 
in the server to make these sorts of plugins more feasible to write (the 
previous release required patching the server I think).

Having an official plugin which externalises authentication would be 
nice but it's down our priority list ATM.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From gmr at myyearbook.com  Mon Feb  7 15:42:27 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 7 Feb 2011 10:42:27 -0500
Subject: [rabbitmq-discuss] Pika 0.9.2a Released
Message-ID: <AANLkTim+SD3jSf=3wTqzunuumRauGaGZ427E5yY6biuf@mail.gmail.com>

A small regression bug was found in the Poll and EPoll handlers in
SelectConnection and as a result, I have pushed 0.9.2a to PyPI and updated
the documentation.

Documentation:
http://tonyg.github.com/pika/

Souce:
https://github.com/tonyg/pika/tarball/v0.9.2a

Install via pip or easy_install:
pip install pika
easy_install pika
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110207/2e9ff180/attachment.htm>

From majek04 at gmail.com  Mon Feb  7 16:36:00 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 7 Feb 2011 16:36:00 +0000
Subject: [rabbitmq-discuss] JSON-RPC reference?
In-Reply-To: <AANLkTinZjv1dUUAKd-SDOC7=JvvhM00VAQVko0XevT5z@mail.gmail.com>
References: <AANLkTinX7sboOrht3QTYtMmCcU_FA_52dK6T_ocmVoOm@mail.gmail.com>
	<AANLkTin7jqAaW005DaRmP_NYiwwejKo-rOzsq=-4UV36@mail.gmail.com>
	<AANLkTinZjv1dUUAKd-SDOC7=JvvhM00VAQVko0XevT5z@mail.gmail.com>
Message-ID: <AANLkTi=Hf9ky7v7Lavw_Q3LoaaXq_TPVRr+XJYPha8JA@mail.gmail.com>

>> On Sun, Feb 6, 2011 at 16:14, James Carr <james.r.carr at gmail.com> wrote:
>> > Aside from digging through the sample provided for the JSON-RPC
>> > channel is there any kind of documentation floating around that
>> > describes the services and procedures supported?
>>
>> No, I'm afraid the only option is reading the source code.
>>
>>
>> We have few in-house initiatives on how to replace
>> jsonrpc with something more supported, but the topic
>> is complex and requires a lot of engineering.
>
> Are you suggesting that jsonrpc is one or more of:
> ?? ? ?1. Not well supported
> ?? ? ?2. Deprecated
> If it's going to be replaced at some point, I can understand the complete
> lack of any docs outside of source code, but then what will be replacing it?
> Should I hold off sifting source code until that gets released? Are docs
> being neglected because you want to discourage adoption until some other
> facility is made public?
> If it's not going to be replaced at some point in the nearer term, is it
> unreasonable to request a doc for it that is similar to the one for the
> Management API?

We haven't done any major improvements
on it for quite a long time. We're keeping it alive (is it
the same as "supporting"?) because it's in our repo
and some people are relying on it.

If I were to decide I would have removed jsonrpc from our
repos long time ago. But, fortunately, others keep me from
doing this.

We will have a better supported replacement at some point, but:
 a) it will do different things than what jsonrpc does
 b) it's hard to say when.

Right now it's _safe_ to use jsonrpc. We will keep it under
our wings until we have a replacement. We'll make an announcement
when that is no longer true.

Cheers,
  Marek

From majek04 at gmail.com  Mon Feb  7 16:38:41 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 7 Feb 2011 16:38:41 +0000
Subject: [rabbitmq-discuss] JSON-RPC reference?
In-Reply-To: <AANLkTinzEOVVsN2s3rSa_7E1kUhmJjEYOC4bRKsWSz1m@mail.gmail.com>
References: <AANLkTinX7sboOrht3QTYtMmCcU_FA_52dK6T_ocmVoOm@mail.gmail.com>
	<AANLkTin7jqAaW005DaRmP_NYiwwejKo-rOzsq=-4UV36@mail.gmail.com>
	<AANLkTinZjv1dUUAKd-SDOC7=JvvhM00VAQVko0XevT5z@mail.gmail.com>
	<AANLkTinzEOVVsN2s3rSa_7E1kUhmJjEYOC4bRKsWSz1m@mail.gmail.com>
Message-ID: <AANLkTinu+gSGnodTLCMd0ie__nHjKxVvN-KdGQGueRdK@mail.gmail.com>

On Mon, Feb 7, 2011 at 15:18, James Carr <james.r.carr at gmail.com> wrote:
> I would love to create a websocket based API for rabbitmq (using STOMP
> or whatever) but my current lack of erlang skills prevent me from
> doing so.

No worries, Mike B. had already done that. Take a look at rabbit-socks:
   http://hg.rabbitmq.com/rabbit-socks

It's pretty much proof of concept, but it takes rabbit in that direction.

> I'm working my way through Erlang and OTP in Action, so I pray that
> the skills I need will come quickly. I always tout websockets allowing
> browsers to communicate directly with message brokers as being the
> future in presentations I give. :)
>
> Thanks,
> James
>
> On Mon, Feb 7, 2011 at 9:05 AM, Brian Jones <bkjones at gmail.com> wrote:
>>
>>
>> On Mon, Feb 7, 2011 at 8:04 AM, Marek Majkowski <majek04 at gmail.com> wrote:
>>>
>>> On Sun, Feb 6, 2011 at 16:14, James Carr <james.r.carr at gmail.com> wrote:
>>> > Aside from digging through the sample provided for the JSON-RPC
>>> > channel is there any kind of documentation floating around that
>>> > describes the services and procedures supported?
>>>
>>> No, I'm afraid the only option is reading the source code.
>>>
>>>
>>> We have few in-house initiatives on how to replace
>>> jsonrpc with something more supported, but the topic
>>> is complex and requires a lot of engineering.
>>
>> Are you suggesting that jsonrpc is one or more of:
>> ?? ? ?1. Not well supported
>> ?? ? ?2. Deprecated
>> If it's going to be replaced at some point, I can understand the complete
>> lack of any docs outside of source code, but then what will be replacing it?
>> Should I hold off sifting source code until that gets released? Are docs
>> being neglected because you want to discourage adoption until some other
>> facility is made public?
>> If it's not going to be replaced at some point in the nearer term, is it
>> unreasonable to request a doc for it that is similar to the one for the
>> Management API?
>> thanks.
>>>
>>> Cheers,
>>> ?Marek
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>> --
>> Brian K. Jones
>> My Blog? ? ? ? ? http://www.protocolostomy.com
>> Follow me? ? ? http://twitter.com/bkjones
>>
>

From majek04 at gmail.com  Mon Feb  7 16:42:04 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 7 Feb 2011 16:42:04 +0000
Subject: [rabbitmq-discuss] JSON-RPC reference?
In-Reply-To: <AANLkTim008qzrmK=wLfFdNrDom71Zj=V8Mygny1s6qOq@mail.gmail.com>
References: <AANLkTinX7sboOrht3QTYtMmCcU_FA_52dK6T_ocmVoOm@mail.gmail.com>
	<AANLkTin7jqAaW005DaRmP_NYiwwejKo-rOzsq=-4UV36@mail.gmail.com>
	<AANLkTim008qzrmK=wLfFdNrDom71Zj=V8Mygny1s6qOq@mail.gmail.com>
Message-ID: <AANLkTimDF6DWfmCoMwR_kbVoXfdV3inn2WQ-j33Pv0Jj@mail.gmail.com>

On Mon, Feb 7, 2011 at 15:27, Gavin M. Roy <gmr at myyearbook.com> wrote:
> We're currently evaluating looking at this in production for use in
> delivering large amounts of messages in single transactions from lots of web
> applications where a persistent connection can't be maintained with RabbitMQ
> and the large volume of connect/disconnects are problematic.
> Currently my thinking was this was the best way to go but I am concerned
> that it will be deprecated. Will this be maintained for the foreseeable
> future?

I can't say that - I don't know. But:
a) The community voice is very important - if we know that enough people
   are actually using jsonrpc, we will try to support it.
b) We'll try to make an announcement before killing jsonrpc.

Cheers,
  Marek



> On Mon, Feb 7, 2011 at 8:04 AM, Marek Majkowski <majek04 at gmail.com> wrote:
>> On Sun, Feb 6, 2011 at 16:14, James Carr <james.r.carr at gmail.com> wrote:
>> > Aside from digging through the sample provided for the JSON-RPC
>> > channel is there any kind of documentation floating around that
>> > describes the services and procedures supported?
>>
>> No, I'm afraid the only option is reading the source code.
>>
>>
>> We have few in-house initiatives on how to replace
>> jsonrpc with something more supported, but the topic
>> is complex and requires a lot of engineering.
>>
>> Cheers,
>> ?Marek
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From simon at rabbitmq.com  Mon Feb  7 16:44:06 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 07 Feb 2011 16:44:06 +0000
Subject: [rabbitmq-discuss] Experimental Windows installer
Message-ID: <4D502156.7090703@rabbitmq.com>

Hi all. In an effort to make the installation process on Windows less 
painful we've put together an installer. It's been tested on a few 
Windows machines here but could do with some more testing.

Notes:

* You still need to install Erlang first. If Erlang is not installed the 
installer will open a web browser for you to do it. You do not need to 
set ERLANG_HOME or anything, just run the Erlang installer.

* The installer makes no effort to detect a previous manual installation 
of RabbitMQ, so it may stomp on things. It's probably  wise to manually 
remove a manual installation before trying it (or at least uninstall the 
service). Of course it will detect installations it's created itself.

* By default the installer will set up RabbitMQ to run as a service, and 
add some links to your start menu. You can switch both of those features 
off.

* Obviously this isn't supported as yet, although if you run into 
trouble we'll do our best to help you out.

* It doesn't install any plugins. To install plugins:

   - Open the plugins folder from the Start Menu.
   - Download and drop the plugins in the plugins folder
   - Stop the service
   - Reinstall the service
   - Start the service

* No, you do not need to reboot at any point :)

You can get it from here:

http://www.rabbitmq.com/releases/rabbitmq-server/v2.3.1-windows-installer/rabbitmq-server-2.3.1-preview.exe

I'm sure there will be bugs. Please report them here.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Mon Feb  7 16:46:23 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 07 Feb 2011 16:46:23 +0000
Subject: [rabbitmq-discuss] JSON-RPC reference?
In-Reply-To: <AANLkTi=Hf9ky7v7Lavw_Q3LoaaXq_TPVRr+XJYPha8JA@mail.gmail.com>
References: <AANLkTinX7sboOrht3QTYtMmCcU_FA_52dK6T_ocmVoOm@mail.gmail.com>	<AANLkTin7jqAaW005DaRmP_NYiwwejKo-rOzsq=-4UV36@mail.gmail.com>	<AANLkTinZjv1dUUAKd-SDOC7=JvvhM00VAQVko0XevT5z@mail.gmail.com>
	<AANLkTi=Hf9ky7v7Lavw_Q3LoaaXq_TPVRr+XJYPha8JA@mail.gmail.com>
Message-ID: <4D5021DF.9000806@rabbitmq.com>

On 07/02/11 16:36, Marek Majkowski wrote:
> If I were to decide I would have removed jsonrpc from our
> repos long time ago. But, fortunately, others keep me from
> doing this.

According to our statistics it's the third most popular plugin (after 
Management and STOMP) so we should aim to keep it running. It's very 
unlikely to see new features though.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Mon Feb  7 17:43:36 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 7 Feb 2011 17:43:36 +0000
Subject: [rabbitmq-discuss] publishing messages causes messages to stop
 being collected
In-Reply-To: <AANLkTiksgQH=a2GPNE=QOPzTf=VSRtw-Jt2EBfHAYtfp@mail.gmail.com>
References: <AANLkTiksgQH=a2GPNE=QOPzTf=VSRtw-Jt2EBfHAYtfp@mail.gmail.com>
Message-ID: <AANLkTim02hVCiX0PmN879b3KjaJ=NhmBPFwhGwinXiuT@mail.gmail.com>

Dan,

On Wed, Feb 2, 2011 at 21:37, Dan Tenenbaum <dtenenba at fhcrc.org> wrote:
> All 3 steps were working, then I added another instance of a1 on another
> machine and step 3 stopped working. Neither instance of a1 receives any more
> messages. rabbitmqctl tells me they are piling up in the queue, and a2 logs
> also tell me step 2 is still happening.
> Specifically, the action that caused step 3 to fail was not simply adding
> another instance of a1 but having that instance do step 1.
>
> Hope someone can tell me what is going on here. a1 is a web app and the
> first instance of it is on my local machine, and a2 represents me trying to
> deploy this app in a production environment.

I'm afraid I can't help. Your code looks sane, and I don't know
amqp at node enough to spot any client problems.

Did you managed to find problem yourself?

Cheers,
  Marek

From majek04 at gmail.com  Mon Feb  7 19:00:41 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 7 Feb 2011 19:00:41 +0000
Subject: [rabbitmq-discuss] exceptions on fast opening a number of
 connections / exception on TCP connection
In-Reply-To: <4D4459FF.4090404@gmail.com>
References: <4D4459FF.4090404@gmail.com>
Message-ID: <AANLkTikh3Zsv1xBv-eqAR8w3dTiSi-3mF5k3aOuD0eCY@mail.gmail.com>

On Sat, Jan 29, 2011 at 18:18, Marcin Krol <mrkafk at gmail.com> wrote:
> I wrote a "stress test" function that (relatively) quickly does the
> following: it creates a number of threads that open a new connection to
> Rabbit, do RPC call over Rabbit, close the connection, sleep some
> milliseconds and iterate again.
>
> I'm getting following exceptions in Rabbit log:
>
> =ERROR REPORT==== 29-Jan-2011::18:06:04 ===
> exception on TCP connection <0.22244.4> from 10.0.0.234:54501
> {inet_error,enomem}

For a record, this error is triggered by a broken framing. For example:
echo -e "AMQP\x00\x00\x09\x01AMQP\x00\x00\x09\x01"|nc localhost 5672

Cheers,
  Marek

From bkjones at gmail.com  Mon Feb  7 19:58:13 2011
From: bkjones at gmail.com (Brian Jones)
Date: Mon, 7 Feb 2011 14:58:13 -0500
Subject: [rabbitmq-discuss] JSON-RPC reference?
In-Reply-To: <4D5021DF.9000806@rabbitmq.com>
References: <AANLkTinX7sboOrht3QTYtMmCcU_FA_52dK6T_ocmVoOm@mail.gmail.com>
	<AANLkTin7jqAaW005DaRmP_NYiwwejKo-rOzsq=-4UV36@mail.gmail.com>
	<AANLkTinZjv1dUUAKd-SDOC7=JvvhM00VAQVko0XevT5z@mail.gmail.com>
	<AANLkTi=Hf9ky7v7Lavw_Q3LoaaXq_TPVRr+XJYPha8JA@mail.gmail.com>
	<4D5021DF.9000806@rabbitmq.com>
Message-ID: <AANLkTimMf4uuCVaOpmeEDzrXgdEkWv2qKsva9s1GneBm@mail.gmail.com>

On Mon, Feb 7, 2011 at 11:46 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 07/02/11 16:36, Marek Majkowski wrote:
>
>> If I were to decide I would have removed jsonrpc from our
>> repos long time ago. But, fortunately, others keep me from
>> doing this.
>>
>
> According to our statistics it's the third most popular plugin (after
> Management and STOMP) so we should aim to keep it running. It's very
> unlikely to see new features though.
>

What are the statistics based on? I'd be slow to trust download numbers
since it's not currently practical to evaluate it for suitability without
downloading the source.



>
> Cheers, Simon
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Brian K. Jones
My Blog          http://www.protocolostomy.com
Follow me      http://twitter.com/bkjones
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110207/cce21ca6/attachment.htm>

From denny.swindle at gmail.com  Mon Feb  7 20:07:27 2011
From: denny.swindle at gmail.com (Denny Swindle)
Date: Mon, 7 Feb 2011 14:07:27 -0600
Subject: [rabbitmq-discuss] publish messages after certain period
Message-ID: <D903D238-0FD1-4D78-8DE8-5495225D458D@gmail.com>

I'm pretty much a newbie at using RabbitMQ.  We have a instance running on one of our servers for an application we have and so far it's been working great for what we need.  But now I have a scenario and I'm wondering if it's possible to leverage RabbitMQ.  

Basically, I'd like to be able to publish a message.  I'd want that message held for 30 seconds prior to it actually being delivered.  After 30 seconds the message can be delivered to the appropriate queue(s).  During the 30 second window, I'd have the option of removing the message preventing it from being delivered altogether.

Would RabbitMQ be able to handle this type of scenario? 

Thanks -
Denny

From dtenenba at fhcrc.org  Mon Feb  7 19:09:48 2011
From: dtenenba at fhcrc.org (Dan Tenenbaum)
Date: Mon, 7 Feb 2011 11:09:48 -0800
Subject: [rabbitmq-discuss] publishing messages causes messages to stop
 being collected
In-Reply-To: <AANLkTim02hVCiX0PmN879b3KjaJ=NhmBPFwhGwinXiuT@mail.gmail.com>
References: <AANLkTiksgQH=a2GPNE=QOPzTf=VSRtw-Jt2EBfHAYtfp@mail.gmail.com>
	<AANLkTim02hVCiX0PmN879b3KjaJ=NhmBPFwhGwinXiuT@mail.gmail.com>
Message-ID: <AANLkTi=Gyt=nrT5GDvpwU+AOcPRQx4xxiwwgm21VWC6Z@mail.gmail.com>

On Mon, Feb 7, 2011 at 9:43 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> Dan,
>
> On Wed, Feb 2, 2011 at 21:37, Dan Tenenbaum <dtenenba at fhcrc.org> wrote:
> > All 3 steps were working, then I added another instance of a1 on another
> > machine and step 3 stopped working. Neither instance of a1 receives any
> more
> > messages. rabbitmqctl tells me they are piling up in the queue, and a2
> logs
> > also tell me step 2 is still happening.
> > Specifically, the action that caused step 3 to fail was not simply adding
> > another instance of a1 but having that instance do step 1.
> >
> > Hope someone can tell me what is going on here. a1 is a web app and the
> > first instance of it is on my local machine, and a2 represents me trying
> to
> > deploy this app in a production environment.
>
> I'm afraid I can't help. Your code looks sane, and I don't know
> amqp at node enough to spot any client problems.
>
> Did you managed to find problem yourself?
>

Not really. I ended up doing a really hacky workaround where I created a
different exchange for each node.js client and published the messages on the
appropriate exchange. This is not really satisfactory, though, because
ultimately I want to add new consumers for these messages and would like
them to only have to deal with one exchange.

Oh, and instead of this:
> Hope someone can tell me what is going on here. a1 is a web app and the
> first instance of it is on my local machine, and a2 represents me trying
to
> deploy this app in a production environment.
...i meant to say:

a1 is a web app, and the first instance of it is on my local machine; the
second is me trying to deploy this app in a production environment.

Dan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110207/f9a04f2b/attachment.htm>

From prayadav at gmail.com  Mon Feb  7 22:25:40 2011
From: prayadav at gmail.com (Prashant)
Date: Mon, 7 Feb 2011 14:25:40 -0800 (PST)
Subject: [rabbitmq-discuss] AMQP 0.9.1 Specification: Suport for Deliver
	API
In-Reply-To: <4D4FC52A.3010605@rabbitmq.com>
References: <fa8da284-8925-4a72-8bef-9c749d1246f7@a5g2000vbs.googlegroups.com>
	<4D4FC52A.3010605@rabbitmq.com>
Message-ID: <f2af33dc-ddd5-4498-80b0-25915518bb3c@m16g2000prc.googlegroups.com>

Hi Emile

I tried second approach of yours , but the issue with the approach is
that republishing of message goes into recursive publishing.

A publish to Q where my consumer check if header has count and if not
=5 update and republish ( this republish , shoudl be rather
reject(requue = true ) ).

so that set me wondering whether we can alter header of a message and
requeue it back rather than republishing it ?

Regds
Prashant


On Feb 7, 10:10?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Prashant,
>
> On 06/02/11 21:00, Prashant wrote:
>
>
>
> > Helo,
>
> > I was stuck while trying to use deliver option in channel. Now , in my
> > experiment , I am trying to use basicRecover to republish all the
> > unack messages back to the channel. These messages gets again repub ,
> > so far so good. But i fear , it might go into a loop as ,when Consumer
> > cannot consume messages it will be returned back to channel.
>
> > I looked into Spec refrence and found out that channel has a deliver
> > mechanism , which basically checks for relivered bit .
> > Per specification-----
> > This method delivers a message to the client, via a consumer. In the
> > asynchronous message delivery model, the client starts a consumer
> > using the Consume method, then the server responds with Deliver
> > methods as and when messages arrive for that consumer.
>
> > ? ? ?* The server SHOULD track the number of times a message has been
> > delivered to clients and when a message is redelivered a certain
> > number of times - e.g. 5 times - without being acknowledged, the
> > server SHOULD consider the message to be unprocessable (possibly
> > causing client applications to abort), and move the message to a dead
> > letter queue.
> > -------
> > Now , my question is how I can leverage this , i.e. ?if messge is
> > redelivered 5 times to channel , I intend to publish a message about
> > the status of this message with specifics that it has been failed
> > after trying 5 times...
> > If , its pssible , where do I need to add the logic to check this,
> > certainly now publisher as the messages are in channel.Can you please
> > throw in some pointers.
>
> The specification does indeed suggest that a broker should track the
> number of redeliveries. You can get more details about conformance for
> this feature on the specification page:
>
> ?http://www.rabbitmq.com/specification.html
>
> The feature that you describe has reference "basic / deliver / 01" and
> is mark as "planned", which means that it has not been implemented yet.
> It is possible to get similar functionality without broker support though.
>
> A possible way to deal with your scenario is to republish
> non-processable messages to a different queue instead of leaving them
> unacknowledged. You might even republish messages together with the
> cause of failure to aid the decision about their fate.
>
> Another option might be to publish messages initially with a processing
> count of 0. Each time a consumer fails to publish the message, republish
> the message to the same queue with an incremented processing count
> instead of leaving the message unacknowledged. When the processing count
> reaches 5 then you can take appropriate action.
>
> Regards
>
> Emile
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Mon Feb  7 22:46:37 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 07 Feb 2011 22:46:37 +0000
Subject: [rabbitmq-discuss] AMQP 0.9.1 Specification: Suport for Deliver
 API
In-Reply-To: <f2af33dc-ddd5-4498-80b0-25915518bb3c@m16g2000prc.googlegroups.com>
References: <fa8da284-8925-4a72-8bef-9c749d1246f7@a5g2000vbs.googlegroups.com>	<4D4FC52A.3010605@rabbitmq.com>
	<f2af33dc-ddd5-4498-80b0-25915518bb3c@m16g2000prc.googlegroups.com>
Message-ID: <4D50764D.6040609@rabbitmq.com>

Hi Prashant

The idea behind the counter is to terminate any further processing and 
prevent an infinite loop.

It is not possible to alter a message when rejecting. The closest you 
can get is to consume the message and publish a new message containing 
the changes you need.

Regards

Emile

Op 07/02/2011 22:25, het Prashant geskryf:
> Hi Emile
>
> I tried second approach of yours , but the issue with the approach is
> that republishing of message goes into recursive publishing.
>
> A publish to Q where my consumer check if header has count and if not
> =5 update and republish ( this republish , shoudl be rather
> reject(requue = true ) ).
>
> so that set me wondering whether we can alter header of a message and
> requeue it back rather than republishing it ?
>
> Regds
> Prashant
>
>
> On Feb 7, 10:10 am, Emile Joubert<em... at rabbitmq.com>  wrote:
>> Hi Prashant,
>>
>> On 06/02/11 21:00, Prashant wrote:
>>
>>
>>
>>> Helo,
>>
>>> I was stuck while trying to use deliver option in channel. Now , in my
>>> experiment , I am trying to use basicRecover to republish all the
>>> unack messages back to the channel. These messages gets again repub ,
>>> so far so good. But i fear , it might go into a loop as ,when Consumer
>>> cannot consume messages it will be returned back to channel.
>>
>>> I looked into Spec refrence and found out that channel has a deliver
>>> mechanism , which basically checks for relivered bit .
>>> Per specification-----
>>> This method delivers a message to the client, via a consumer. In the
>>> asynchronous message delivery model, the client starts a consumer
>>> using the Consume method, then the server responds with Deliver
>>> methods as and when messages arrive for that consumer.
>>
>>>       * The server SHOULD track the number of times a message has been
>>> delivered to clients and when a message is redelivered a certain
>>> number of times - e.g. 5 times - without being acknowledged, the
>>> server SHOULD consider the message to be unprocessable (possibly
>>> causing client applications to abort), and move the message to a dead
>>> letter queue.
>>> -------
>>> Now , my question is how I can leverage this , i.e.  if messge is
>>> redelivered 5 times to channel , I intend to publish a message about
>>> the status of this message with specifics that it has been failed
>>> after trying 5 times...
>>> If , its pssible , where do I need to add the logic to check this,
>>> certainly now publisher as the messages are in channel.Can you please
>>> throw in some pointers.
>>
>> The specification does indeed suggest that a broker should track the
>> number of redeliveries. You can get more details about conformance for
>> this feature on the specification page:
>>
>>   http://www.rabbitmq.com/specification.html
>>
>> The feature that you describe has reference "basic / deliver / 01" and
>> is mark as "planned", which means that it has not been implemented yet.
>> It is possible to get similar functionality without broker support though.
>>
>> A possible way to deal with your scenario is to republish
>> non-processable messages to a different queue instead of leaving them
>> unacknowledged. You might even republish messages together with the
>> cause of failure to aid the decision about their fate.
>>
>> Another option might be to publish messages initially with a processing
>> count of 0. Each time a consumer fails to publish the message, republish
>> the message to the same queue with an incremented processing count
>> instead of leaving the message unacknowledged. When the processing count
>> reaches 5 then you can take appropriate action.

From tonygarnockjones+rabbitmq at gmail.com  Mon Feb  7 23:12:58 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 7 Feb 2011 18:12:58 -0500
Subject: [rabbitmq-discuss] event-based use of the RabbitMQ C library
In-Reply-To: <yrv4cwrldt7s1.fsf@dwragg.eng.vmware.com>
References: <4D4DAF69.1020407@mlcastle.net>
	<yrv4cwrldt7s1.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTi=L-cL3Tw9rhOmjMUxnUrRdiYPrddHv-Z-h1dDO@mail.gmail.com>

On 6 February 2011 12:03, David Wragg <david at rabbitmq.com> wrote:

> librabbitmq does not currently support non-blocking operation.
>

Correct, but it permits it.


> As I said, it's a hack.
>

The alternative is to avoid use of the *_simple_* methods, including
amqp_simple_wait_frame, and to read bytes yourself in whatever way you see
fit (e.g. using libevent or raw select plus nonblocking sockets) and pass
those bytes to amqp_handle_input. You'll need to do the connection opening
and tuning yourself, but once that's done you're golden.


> > Are there examples anywhere of event-driven uses of the RabbitMQ C
> > library which send and receive on different channels on the same
> > connection based on some kind of external events?
>

Yes: https://github.com/tonyg/rais/blob/master/src/connection.c#L384-411

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110207/5622f265/attachment.htm>

From finncolman at yahoo.co.nz  Mon Feb  7 23:17:08 2011
From: finncolman at yahoo.co.nz (finn colman)
Date: Mon, 7 Feb 2011 15:17:08 -0800 (PST)
Subject: [rabbitmq-discuss] New Open source AMQP implementation,
	problems with integrating using different langauges
Message-ID: <385049.30892.qm@web111406.mail.gq1.yahoo.com>

Hi there.
I have a python program that talks to a rabbit MQ server using its own library. 
On my end I am running Robin's AMQP PHP 
library,https://github.com/BraveSirRobin/amqphp to connect to the Rabbit MQ 
server. I can submit a message to the queue and the python side can read it, but 
if the python side submits a message to the queue and the PHP side tries to 
consume it I am getting an Exception thrown from inside amqp.wire.php: 
"Unexpected message property flags".
This is happening because the strlen($binFlags) is evaluating to 0 in this case. 
If I run it using PHP submitted messages then it correctly evaliuates to a 
length of 16.
The binary flags is 1100000000000000(49152) for a PHP suibmitted message read 
off the queue, but it is 0 for the message read off the queue that was put there 
by python.
What is causing this? Also what do these flags really represent.
As a temporary work around I have managed to get the code to read the message by 
simply commenting out these three lines of code that check this binary flags 
length.
Thanks.


      

From m at mlcastle.net  Tue Feb  8 01:12:52 2011
From: m at mlcastle.net (mike castleman)
Date: Mon, 07 Feb 2011 20:12:52 -0500
Subject: [rabbitmq-discuss] event-based use of the RabbitMQ C library
In-Reply-To: <AANLkTi=L-cL3Tw9rhOmjMUxnUrRdiYPrddHv-Z-h1dDO@mail.gmail.com>
References: <4D4DAF69.1020407@mlcastle.net>	<yrv4cwrldt7s1.fsf@dwragg.eng.vmware.com>
	<AANLkTi=L-cL3Tw9rhOmjMUxnUrRdiYPrddHv-Z-h1dDO@mail.gmail.com>
Message-ID: <4D509894.1050606@mlcastle.net>

On 02/07/2011 06:12 PM, Tony Garnock-Jones wrote:
> The alternative is to avoid use of the *_simple_* methods, including
> amqp_simple_wait_frame, and to read bytes yourself in whatever way you
> see fit (e.g. using libevent or raw select plus nonblocking sockets) and
> pass those bytes to amqp_handle_input. You'll need to do the connection
> opening and tuning yourself, but once that's done you're golden.
>  
> Yes: https://github.com/tonyg/rais/blob/master/src/connection.c#L384-411

Thanks, Tony. This is super-helpful! I'll experiment with using the
technique you describe and see how it goes.

If my experiments are successful (or fail in interesting ways), I'll try
to write up a blog post with my findings. Certainly the RabbitMQ C
library does not currently suffer from an excess of documentation.

As far as I can tell, rais is (the beginning of) an AMQP broker
implementation in C? Is that correct?

cheers,
mlc


-- 
mike castleman
mailto:m at mlcastle.net
tel:+1-646-382-7220
http://mlcastle.net/

From tonygarnockjones+rabbitmq at gmail.com  Tue Feb  8 01:16:52 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 7 Feb 2011 20:16:52 -0500
Subject: [rabbitmq-discuss] event-based use of the RabbitMQ C library
In-Reply-To: <4D509894.1050606@mlcastle.net>
References: <4D4DAF69.1020407@mlcastle.net>
	<yrv4cwrldt7s1.fsf@dwragg.eng.vmware.com>
	<AANLkTi=L-cL3Tw9rhOmjMUxnUrRdiYPrddHv-Z-h1dDO@mail.gmail.com>
	<4D509894.1050606@mlcastle.net>
Message-ID: <AANLkTikWAAt8SvhzwhnanLxnF_1xfyQuAU-5xCC9ZBob@mail.gmail.com>

On 7 February 2011 20:12, mike castleman <m at mlcastle.net> wrote:

> If my experiments are successful (or fail in interesting ways), I'll try
> to write up a blog post with my findings. Certainly the RabbitMQ C
> library does not currently suffer from an excess of documentation.
>

Great! Please do! You're quite right about the lack of documentation -
entirely my fault :-)


> As far as I can tell, rais is (the beginning of) an AMQP broker
> implementation in C? Is that correct?
>

Hm, sort of. It's an experiment probably not worth continuing with. Both
librabbitmq's clunkiness and some misdesign entirely blamable on rais itself
led to it being more trouble than it was worth. The idea was to have a
little local relay node on a client machine that would provide a staging
area for messages on their way in and out - a kind of responsibility store,
if you like, that would give "reliable/at-most-once" delivery and
deduplication semantics on top of a remote RabbitMQ. It turned out that
programming in C in that style was a royal pain in the behind. Much better
to use ucontext_t or other approaches.

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110207/592f6954/attachment.htm>

From hujn at polyvore.com  Tue Feb  8 01:27:07 2011
From: hujn at polyvore.com (Jianing Hu)
Date: Mon, 7 Feb 2011 17:27:07 -0800
Subject: [rabbitmq-discuss] disk space not released after persistent
	messages are consumed
Message-ID: <AANLkTikfrhX3wWMfwzRDLn3GDq+Ers+31tnuokONxT-i@mail.gmail.com>

Hi,

RabbitMQ newbie here so apologies in advance if what I'm doing is
obviously wrong.

I'm experimenting with RabbigMQ 2.1.1 and it seems my persistent
message storage file keeps growing despite of messages being consumed.
Here's the code I used for testing. I'm using perl with Net::RabbitMQ

    use Net::RabbitMQ;
    my $mq = Net::RabbitMQ->new();
    $mq->connect("localhost", {
        user => 'guest',
        password => 'guest'
    });
    $mq->channel_open(1);
    $mq->queue_declare(1, 'test', {
        passive => 0,
        durable => 1,
        exclusive => 0,
        auto_delete => 0
    });

    my $data = 'foobar' x 200;
    for (1..100000) {
        $mq->publish(1, 'test', $data, {}, { delivery_mode => 2});
    }

    $mq->consume(1, 'test', {
        no_ack => 0
    });
    for (1..100000) {
        my $msg = $mq->recv();
        $mq->ack(1, $msg->{delivery_tag});
    }

After running this code I end up with a 3MB file in the
msg_store_persistent directory, even though rabbitmqctl list_queues
shows 0 messages in the queue. After restarting RabbitMQ server that
file grew by another 800KB. Any advice is greatly appreciated.

Thanks,
- Jianing

From finncolman at yahoo.co.nz  Tue Feb  8 02:08:24 2011
From: finncolman at yahoo.co.nz (finn colman)
Date: Mon, 7 Feb 2011 18:08:24 -0800 (PST)
Subject: [rabbitmq-discuss] New Open source AMQP implementation,
	problems with integrating using different langauges
Message-ID: <302921.41550.qm@web111413.mail.gq1.yahoo.com>

I have found the solution to my problem.
I set found out that the flags were the content-type and content-encoding. When 
I set these properties in the python code then I could consumer the message on 
the PHP side without an exception being thrown.




----- Original Message ----
From: finn colman <finncolman at yahoo.co.nz>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tue, 8 February, 2011 12:17:08 PM
Subject: New Open source AMQP implementation, problems with integrating using 
different langauges

Hi there.
I have a python program that talks to a rabbit MQ server using its own library. 
On my end I am running Robin's AMQP PHP 
library,https://github.com/BraveSirRobin/amqphp to connect to the Rabbit MQ 
server. I can submit a message to the queue and the python side can read it, but 

if the python side submits a message to the queue and the PHP side tries to 
consume it I am getting an Exception thrown from inside amqp.wire.php: 
"Unexpected message property flags".
This is happening because the strlen($binFlags) is evaluating to 0 in this case. 

If I run it using PHP submitted messages then it correctly evaliuates to a 
length of 16.
The binary flags is 1100000000000000(49152) for a PHP suibmitted message read 
off the queue, but it is 0 for the message read off the queue that was put there 

by python.
What is causing this? Also what do these flags really represent.
As a temporary work around I have managed to get the code to read the message by 

simply commenting out these three lines of code that check this binary flags 
length.
Thanks.


      

From sameek at arosys.com  Tue Feb  8 04:15:25 2011
From: sameek at arosys.com (sam_mis)
Date: Mon, 7 Feb 2011 20:15:25 -0800 (PST)
Subject: [rabbitmq-discuss] it correct way to creating consumer as an daemon
 thread?
Message-ID: <30870170.post@talk.nabble.com>


Hi

i am using Rabbitmq Java client library. consumer that are infinite run and
poll queue where message are arrives.


         boolean runInfinite = true;
         while (runInfinite)
          {
                 QueueingConsumer.Delivery task;
             try 
               {
               task= consumer.nextDelivery();
               } 
             catch (InterruptedException ie) 
               {
               continue;
               }
         }
consumer infinitely run i want to make it daemon thread.it is correct way to
make it daemon thread and there are other option.

Thanks

-- 
View this message in context: http://old.nabble.com/it-correct-way-to-creating-consumer-as-an-daemon-thread--tp30870170p30870170.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From harvey.robin at gmail.com  Tue Feb  8 09:21:29 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Tue, 8 Feb 2011 09:21:29 +0000
Subject: [rabbitmq-discuss] New Open source AMQP implementation,
 problems with integrating using different langauges
In-Reply-To: <302921.41550.qm@web111413.mail.gq1.yahoo.com>
References: <302921.41550.qm@web111413.mail.gq1.yahoo.com>
Message-ID: <AANLkTi=7paA4bBQkdLdppMwxhyczKbuwQEzkXXPbdhuy@mail.gmail.com>

Hi,

The situation Finn describes where having no message delivery flags sounds
like a bug in amqphp.  Are the content-type / content-encoding parameters
required by Amqp / RabbitMQ?

Thanks,
--Robin

On Tue, Feb 8, 2011 at 2:08 AM, finn colman <finncolman at yahoo.co.nz> wrote:

> I have found the solution to my problem.
> I set found out that the flags were the content-type and content-encoding.
> When
> I set these properties in the python code then I could consumer the message
> on
> the PHP side without an exception being thrown.
>
>
>
>
> ----- Original Message ----
> From: finn colman <finncolman at yahoo.co.nz>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Tue, 8 February, 2011 12:17:08 PM
> Subject: New Open source AMQP implementation, problems with integrating
> using
> different langauges
>
> Hi there.
> I have a python program that talks to a rabbit MQ server using its own
> library.
> On my end I am running Robin's AMQP PHP
> library,https://github.com/BraveSirRobin/amqphp to connect to the Rabbit
> MQ
> server. I can submit a message to the queue and the python side can read
> it, but
>
> if the python side submits a message to the queue and the PHP side tries to
> consume it I am getting an Exception thrown from inside amqp.wire.php:
> "Unexpected message property flags".
> This is happening because the strlen($binFlags) is evaluating to 0 in this
> case.
>
> If I run it using PHP submitted messages then it correctly evaliuates to a
> length of 16.
> The binary flags is 1100000000000000(49152) for a PHP suibmitted message
> read
> off the queue, but it is 0 for the message read off the queue that was put
> there
>
> by python.
> What is causing this? Also what do these flags really represent.
> As a temporary work around I have managed to get the code to read the
> message by
>
> simply commenting out these three lines of code that check this binary
> flags
> length.
> Thanks.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110208/7f422539/attachment.htm>

From matthias at rabbitmq.com  Tue Feb  8 09:40:01 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 08 Feb 2011 09:40:01 +0000
Subject: [rabbitmq-discuss] New Open source AMQP implementation,
 problems with integrating using different langauges
In-Reply-To: <AANLkTi=7paA4bBQkdLdppMwxhyczKbuwQEzkXXPbdhuy@mail.gmail.com>
References: <302921.41550.qm@web111413.mail.gq1.yahoo.com>
	<AANLkTi=7paA4bBQkdLdppMwxhyczKbuwQEzkXXPbdhuy@mail.gmail.com>
Message-ID: <4D510F71.1090101@rabbitmq.com>

On 08/02/11 09:21, Robin Harvey wrote:
> Are the content-type / content-encoding parameters required by Amqp /
> RabbitMQ?

No.

Matthias.

From majek04 at gmail.com  Tue Feb  8 11:09:50 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 8 Feb 2011 11:09:50 +0000
Subject: [rabbitmq-discuss] publishing messages causes messages to stop
 being collected
In-Reply-To: <AANLkTi=Gyt=nrT5GDvpwU+AOcPRQx4xxiwwgm21VWC6Z@mail.gmail.com>
References: <AANLkTiksgQH=a2GPNE=QOPzTf=VSRtw-Jt2EBfHAYtfp@mail.gmail.com>
	<AANLkTim02hVCiX0PmN879b3KjaJ=NhmBPFwhGwinXiuT@mail.gmail.com>
	<AANLkTi=Gyt=nrT5GDvpwU+AOcPRQx4xxiwwgm21VWC6Z@mail.gmail.com>
Message-ID: <AANLkTikX2GAnZoWS_=emt8ADHsKCn4GL1cywGLzdJLWS@mail.gmail.com>

On Mon, Feb 7, 2011 at 19:09, Dan Tenenbaum <dtenenba at fhcrc.org> wrote:
> On Mon, Feb 7, 2011 at 9:43 AM, Marek Majkowski <majek04 at gmail.com> wrote:
>> On Wed, Feb 2, 2011 at 21:37, Dan Tenenbaum <dtenenba at fhcrc.org> wrote:
>> > All 3 steps were working, then I added another instance of a1 on another
>> > machine and step 3 stopped working. Neither instance of a1 receives any
>> > more
>> > messages. rabbitmqctl tells me they are piling up in the queue, and a2
>> > logs
>> > also tell me step 2 is still happening.
>> > Specifically, the action that caused step 3 to fail was not simply
>> > adding
>> > another instance of a1 but having that instance do step 1.
>> >
>> > Hope someone can tell me what is going on here. a1 is a web app and the
>> > first instance of it is on my local machine, and a2 represents me trying
>> > to
>> > deploy this app in a production environment.
>>
>> I'm afraid I can't help. Your code looks sane, and I don't know
>> amqp at node enough to spot any client problems.
>>
>> Did you managed to find problem yourself?
>
> Not really. I ended up doing a really hacky workaround where I created a
> different exchange for each node.js client and published the messages on the
> appropriate exchange. This is not really satisfactory, though, because
> ultimately I want to add new consumers for these messages and would like
> them to only have to deal with one exchange.
> Oh, and instead of this:
>> Hope someone can tell me what is going on here. a1 is a web app and the
>> first instance of it is on my local machine, and a2 represents me trying
>> to
>> deploy this app in a production environment.
> ...i meant to say:
> a1 is a web app, and the first instance of it is on my local machine; the
> second is me trying to deploy this app in a production environment.

Not good. You could try to write a simplified implementation
of 'a1' in something else than node and see if there's a difference.
The whole concept sounds pretty simple, so by digging a bit harder
you should be able to find the problem.

Cheers,
  Marek

From Denis.Conan at telecom-sudparis.eu  Tue Feb  8 12:38:07 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Tue, 08 Feb 2011 13:38:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
Message-ID: <4D51392F.8000508@telecom-sudparis.eu>


Hi all,

my objective is to run the Java Client on Android.

Do not hesitate to tell me if I started off with the wrong idea.

I didn't see any specific release for Android. So, I took the Java Client for 
J2SE. I was able to adapt the previous version 2.2.0 of the Java Client for 
running on Android: removal of packages json and jsonrpc, and correct a call to 
super in the constructor of the class PossibleAuthenticationFailureException.

As I see, the new version 2.3.1 now has authentication with SASL. 
Unfortunately, there is no package javax.security.sasl in Android JRE. So, I 
tried to manage this lack by replacing the classes of this package by the ones 
in aSMACK (http://code.google.com/p/asmack/). The compilation is ok, but the 
execution throws the following exception.

Any comment and/or help will be appreciated. Thanks in advance.

java.io.IOException: No compatible authentication mechanism found - server 
offered [PLAIN AMQPLAIN]
W/System.err(  275): 	at 
com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:269)
W/System.err(  275): 	at 
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:382)
W/System.err(  275): 	at 
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:402)
W/System.err(  275): 	at 
eu.telecomsudparis.rabbitmq.tutorial.android.SendActivity.onCreate(SendActivity.java:26)
W/System.err(  275): 	at 
android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1047)

The RabbitMQ server logs contains the following message:

=INFO REPORT==== 8-Feb-2011::13:07:27 ===
accepted TCP connection on [::]:5672 from 157.159.110.134:60291

=INFO REPORT==== 8-Feb-2011::13:07:27 ===
starting TCP connection <0.22221.0> from 157.159.110.134:60291

=ERROR REPORT==== 8-Feb-2011::13:07:37 ===
exception on TCP connection <0.22221.0> from 157.159.110.134:60291
{handshake_timeout,frame_header}

=INFO REPORT==== 8-Feb-2011::13:07:37 ===
closing TCP connection <0.22221.0> from 157.159.110.134:60291

-- 
Denis Conan

From majek04 at gmail.com  Tue Feb  8 14:43:22 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 8 Feb 2011 14:43:22 +0000
Subject: [rabbitmq-discuss] What is the best option for work sharing
 that needs topic like selective message receival?
In-Reply-To: <AANLkTinv=DA85pNLs9rCwOGp_cuasPpxK3PUfzy4Eh64@mail.gmail.com>
References: <AANLkTinPPog61Qgt-xFNvn-UFeYkrMUhH3xuwM-Xdvvx@mail.gmail.com>
	<AANLkTikdyn33xfu+FZjKVTo+X=9BhN_gNqCLzBk4Xp=i@mail.gmail.com>
	<AANLkTinmxAPKvjz1eg=ByV23X9xJgBsqYQmOjbMbqD3X@mail.gmail.com>
	<AANLkTi=pcmT-6sCLqAGu6zWX9Xvo=dKXsxGASTu8Z2eT@mail.gmail.com>
	<AANLkTinv=DA85pNLs9rCwOGp_cuasPpxK3PUfzy4Eh64@mail.gmail.com>
Message-ID: <AANLkTi=d8nrKpztZ-ivaGq0ps1Tg8xTtV3JR=_GEMndZ@mail.gmail.com>

On Thu, Feb 3, 2011 at 05:33, Enno Shioji <eshioji at gmail.com> wrote:
> Thanks! My worry is though that these categories are very short-lived.
> If I create and destroy many queues (e.g. 10-100 per second), would
> that be a viable solution in e.g. RabbitMQ?

Yes, but before trusting me with your soul do your own benchmarks
(with the durability, no_wait and other flags set to your requirements)

Marek


> On Wed, Feb 2, 2011 at 9:06 PM, Marek Majkowski <majek04 at gmail.com> wrote:
>> On Mon, Jan 31, 2011 at 19:39, Enno Shioji <eshioji at gmail.com> wrote:
>>>> I'm afraid the problem needs some more explanation.
>>>> ?- what's wrong with just one fat queue that is shared between workers?
>>> Some workers can perform certain categories of jobs, while some
>>> workers can perform other categories of job. I.e. workers cannot
>>> perform all category of jobs. They can only perform a subset of job
>>> category.
>>
>> Great.
>> You've just defined your routing methodology.
>> I guess the same relations should be represented
>> using bindings and queues.
>>
>> The simplest thing to do, would be probably to have
>> on queue per category, and if a consumer can do
>> jobs from multiple categories - it should bind to multiple
>> queues.
>>
>> On the other hand queues are relatively heavyweight,
>> and it would be more efficient to have only one queue per
>> consumer. But that's harder to manage dynamically.
>>
>>> So, if there is a fat queue, many consumers will pull
>>> messages that they cannot consume and would have to put those back
>>> into the queue (which I think would be very inefficient).
>>>
>>>> ?- are all the tasks going to take roughly the same time?
>>> At the current moment, yes.
>>>
>>>> ?- do you need to prioritize the tasks?
>>> It would be nice to roughly prioritize the tasks (it doesn't have to
>>> be strict), but it'd be more of a "nice to have" requirement...
>>>
>>>
>>>
>>> Regards,
>>> Enno
>>>
>>>
>>>
>>>
>>>
>>> On Mon, Jan 31, 2011 at 11:36 PM, Marek Majkowski <majek04 at gmail.com> wrote:
>>>> On Mon, Jan 31, 2011 at 09:40, Enno Shioji <eshioji at gmail.com> wrote:
>>>>> I have an app. I would like to migrate to AMQP based architecture. The
>>>>> main component/functionality of this app. is to distribute work based
>>>>> on some rules.
>>>>>
>>>>> After learning a little bit about AMQP, I concluded that the way to
>>>>> achieve this is to have the producer send "jobs" to a direct exchange
>>>>> with routing keys that indicate the nature of the jobs (let's call it
>>>>> "job category"), and having queues that binds to each unique routing
>>>>> key, and then having consumers listening on these queues. Multiple
>>>>> consumers may listen to the same queue. One job should only be
>>>>> performed once system-wide (but is not strictly required as long as
>>>>> performance loss is not significant).
>>>>>
>>>>> My problem is that the number of such "job category" increases
>>>>> overtime. E.g. if in the beginning there is only one routing keys such
>>>>> as "key.stuff.1.A", overtime keys like "key.stuff.2.A" or
>>>>> "key.stuff.2.B" will start to emerge and eventually such categories
>>>>> will reach a large number. However, older categories will eventually
>>>>> become obsolete so at a given time I would have at most something like
>>>>> 20K different "job categories". But overtime I would have a LOT of job
>>>>> categories. (Lifetime of each "job category" depends and can be
>>>>> anything from 1 day to 1 seconds etc..)
>>>>>
>>>>> I'm wondering if there is a better way to achieve what I want.
>>>>>
>>>>> If this helps, everything can be transient and non durable. Message
>>>>> loss can be tolerated as long as it's not too frequent (e.g. once per
>>>>> 10K msgs etc.)
>>>>
>>>> I'm afraid the problem needs some more explanation.
>>>> ?- what's wrong with just one fat queue that is shared between workers?
>>>> ?- are all the tasks going to take roughly the same time?
>>>> ?- do you need to prioritize the tasks?
>>>>
>>>> Cheers,
>>>> ?Marek
>>>>
>>>
>>
>

From jbrisbin at vmware.com  Tue Feb  8 15:43:17 2011
From: jbrisbin at vmware.com (Jonathan Brisbin)
Date: Tue, 8 Feb 2011 07:43:17 -0800
Subject: [rabbitmq-discuss] errors in riak_queue impl
Message-ID: <5FFE8196-60D2-41A1-8E2B-2917341776F9@vmware.com>

I'm getting some errors while playing with this rabbit_riak_queue implementation I'm working on. It's happening when I get notification of a delivered message. Any idea on what's going on here?

=ERROR REPORT==== 8-Feb-2011::10:27:55 ===
** Generic server <0.253.0> terminating
** Last message in was {'$gen_cast',
                        {deliver,<<"amq.ctag-j1c04J2xVhlCLHJrDTIwaA==">>,
                         true,
                         {{resource,<<"/">>,queue,<<"test">>},
                          <0.208.0>,"2",true,
                          {basic_message,undefined,undefined,
                           {content,60,
                            {'P_basic',"application/json",undefined,
                             {dict,5,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},
                              {{[],
                                [["X-Riak-Meta-Bar",98,97,122]],
                                [],[],[],
                                [["X-Riak-Meta-Guid",49,112,47,67,107,71,120,
                                  100,88,97,120,112,114,119,119,116,115,70,
                                  115,90,43,65,61,61]],
                                [],[],[],
                                [["X-Riak-Meta-Queue",116,101,115,116]],
                                [],[],
                                [["X-Riak-Meta-Foo",55]],
                                [],[],
                                [["X-Riak-Meta-Classid",54,48]]}}},
                             undefined,undefined,undefined,undefined,
                             undefined,undefined,undefined,undefined,
                             undefined,undefined,undefined},
                            undefined,undefined,
                            [<<"{\"test\":\"value\", \"int\": 14}">>]},
                           <<214,159,194,144,108,93,93,172,105,175,12,45,176,
                             91,25,248>>,
                           undefined}}}}
** When Server state == {ch,running,1,<0.250.0>,<0.252.0>,undefined,
                         #Fun<rabbit_channel_sup.0.123274458>,none,
                         {set,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         1,
                         {[],[]},
                         {[],[]},
                         {user,<<"guest">>,true,rabbit_auth_backend_internal,
                          {internal_user,<<"guest">>,
                           <<155,99,204,87,188,155,243,157,145,163,38,225,4,
                             178,160,143,117,202,5,215>>,
                           true}},
                         <<"/">>,<<"test">>,
                         {dict,1,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],
                            [[<<"amq.ctag-j1c04J2xVhlCLHJrDTIwaA==">>|
                              {resource,<<"/">>,queue,<<"test">>}]],
                            [],[],[],[],[],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         <0.248.0>,
                         {state,none,undefined},
                         false,1,
                         {0,nil},
                         []}
** Reason for termination == 
** {{badrecord,resource},
    [{rabbit_channel,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,init_p_do_apply,3}]}

=ERROR REPORT==== 8-Feb-2011::10:27:55 ===
connection <0.250.0> (running), channel 1 - error:
{{badrecord,resource},
 [{rabbit_channel,handle_cast,2},
  {gen_server2,handle_msg,2},
  {proc_lib,init_p_do_apply,3}]}

=WARNING REPORT==== 8-Feb-2011::10:27:55 ===
Non-AMQP exit reason '{{badrecord,resource},
                       [{rabbit_channel,handle_cast,2},
                        {gen_server2,handle_msg,2},
                        {proc_lib,init_p_do_apply,3}]}'



Thanks!

Jon Brisbin

Twitter: @j_brisbin
Skype: jon.brisbin



From rtrlists at googlemail.com  Tue Feb  8 15:47:00 2011
From: rtrlists at googlemail.com (Robert Raschke)
Date: Tue, 8 Feb 2011 15:47:00 +0000
Subject: [rabbitmq-discuss] errors in riak_queue impl
In-Reply-To: <5FFE8196-60D2-41A1-8E2B-2917341776F9@vmware.com>
References: <5FFE8196-60D2-41A1-8E2B-2917341776F9@vmware.com>
Message-ID: <AANLkTimCigD6XauvdR8BvnzuDJtLnRGcP54dJ-Oi5=ou@mail.gmail.com>

On Tue, Feb 8, 2011 at 3:43 PM, Jonathan Brisbin <jbrisbin at vmware.com>wrote:

> I'm getting some errors while playing with this rabbit_riak_queue
> implementation I'm working on. It's happening when I get notification of a
> delivered message. Any idea on what's going on here?
>
> [...]
>


> =ERROR REPORT==== 8-Feb-2011::10:27:55 ===
> connection <0.250.0> (running), channel 1 - error:
> {{badrecord,resource},
>  [{rabbit_channel,handle_cast,2},
>  {gen_server2,handle_msg,2},
>  {proc_lib,init_p_do_apply,3}]}
>
> =WARNING REPORT==== 8-Feb-2011::10:27:55 ===
> Non-AMQP exit reason '{{badrecord,resource},
>                       [{rabbit_channel,handle_cast,2},
>                        {gen_server2,handle_msg,2},
>                        {proc_lib,init_p_do_apply,3}]}'
>
>
Shot in the dark:

Looks like the 'resource' record doesn't match up somewhere; maybe it's got
different number of fields in different locations.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110208/4c181c4b/attachment.htm>

From Waseem_Hawaldar at mindtree.com  Tue Feb  8 15:58:21 2011
From: Waseem_Hawaldar at mindtree.com (Waseem Hawaldar)
Date: Tue, 8 Feb 2011 15:58:21 +0000
Subject: [rabbitmq-discuss] Failing to connect/reconnect to rabbitMq.
Message-ID: <192E282CAB256F41A2161A9E1BAA7C5E08D394@MTW02MBX01.mindtree.com>

When I start pumping messages to RabbitMQ version 1.8. I am finding this below mentioned error:


org.mule.retry.notifiers.ConnectNotifier] - Failed to connect/reconnect: endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UIDEnrolRspQ&replyToExchange. Root Exception was: Failed to create com.rabbitmq.client.Channel. Type: class org.mule.api.lifecycle.InitialisationException


So , can someone please suggest me some solution for this error.



Regards,
Waseem:)

Waseem Hawaldar| Open Source Practice | MindTree Ltd [untitled] | Ecospace, outer ring road , Belandur(Accenture Office).  Bangalore-560 059, INDIA | Project Aadhaar - UIDAI |Mob: +91 9900588758 | email: waseem_hawaldar at mindtree.com| www.mindtree.com |


________________________________

http://www.mindtree.com/email/disclaimer.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110208/73de291e/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 1026 bytes
Desc: image001.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110208/73de291e/attachment-0001.gif>

From dsinclair at chariotsolutions.com  Tue Feb  8 16:03:07 2011
From: dsinclair at chariotsolutions.com (David Sinclair)
Date: Tue, 8 Feb 2011 11:03:07 -0500
Subject: [rabbitmq-discuss] Failing to connect/reconnect to rabbitMq.
In-Reply-To: <192E282CAB256F41A2161A9E1BAA7C5E08D394@MTW02MBX01.mindtree.com>
References: <192E282CAB256F41A2161A9E1BAA7C5E08D394@MTW02MBX01.mindtree.com>
Message-ID: <AANLkTi=webtYMHFOWh4Soo_o-9_6eUTJ8cxFZxK0D6Q8@mail.gmail.com>

That is the whole error? Can't tell to much just from that.

On Tue, Feb 8, 2011 at 10:58 AM, Waseem Hawaldar <
Waseem_Hawaldar at mindtree.com> wrote:

>  When I start pumping messages to RabbitMQ version 1.8. I am finding this
> below mentioned error:
>
>
>
>
>
> org.mule.retry.notifiers.ConnectNotifier] - Failed to connect/reconnect:
> endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UIDEnrolRspQ&replyToExchange.
> Root Exception was: Failed to create com.rabbitmq.client.Channel. Type:
> class org.mule.api.lifecycle.InitialisationException
>
>
>
>
>
> So , can someone please suggest me some solution for this error.
>
>
>
>
>
>
>
> *Regards,*
>
> WaseemJ
>
>
>
> *Waseem Hawaldar*| Open Source Practice |* MindTree Ltd **[image:
> untitled]*| Ecospace, outer ring road , Belandur(Accenture Office).
> Bangalore-560 059, INDIA | *Project Aadhaar - UIDAI** |*Mob: +91
> 9900588758 | email: *waseem_hawaldar at mindtree.com*| www.mindtree.com |
>
>
>
> ------------------------------
>
> http://www.mindtree.com/email/disclaimer.html
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110208/c9748d8e/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 1026 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110208/c9748d8e/attachment.gif>

From emile at rabbitmq.com  Tue Feb  8 16:14:27 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 08 Feb 2011 16:14:27 +0000
Subject: [rabbitmq-discuss] Failing to connect/reconnect to rabbitMq.
In-Reply-To: <AANLkTi=webtYMHFOWh4Soo_o-9_6eUTJ8cxFZxK0D6Q8@mail.gmail.com>
References: <192E282CAB256F41A2161A9E1BAA7C5E08D394@MTW02MBX01.mindtree.com>
	<AANLkTi=webtYMHFOWh4Soo_o-9_6eUTJ8cxFZxK0D6Q8@mail.gmail.com>
Message-ID: <4D516BE3.2090604@rabbitmq.com>

Hi Waseem,

Is there anything in the RabbitMQ logfile at the corresponding time? Is 
it possible to get a full stacktrace? What was the state of the network 
at this point? Was this a reconnection?

Regards

Emile

On 08/02/11 16:03, David Sinclair wrote:
> That is the whole error? Can't tell to much just from that.
>
> On Tue, Feb 8, 2011 at 10:58 AM, Waseem Hawaldar
> <Waseem_Hawaldar at mindtree.com <mailto:Waseem_Hawaldar at mindtree.com>> wrote:
>
>     When I start pumping messages to RabbitMQ version 1.8. I am finding
>     this below mentioned error:
>
>     org.mule.retry.notifiers.ConnectNotifier] - Failed to
>     connect/reconnect:
>     endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UIDEnrolRspQ&replyToExchange.
>     Root Exception was: Failed to create com.rabbitmq.client.Channel.
>     Type: class org.mule.api.lifecycle.InitialisationException

From matthew at rabbitmq.com  Tue Feb  8 16:14:44 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 8 Feb 2011 16:14:44 +0000
Subject: [rabbitmq-discuss] errors in riak_queue impl
In-Reply-To: <AANLkTimCigD6XauvdR8BvnzuDJtLnRGcP54dJ-Oi5=ou@mail.gmail.com>
References: <5FFE8196-60D2-41A1-8E2B-2917341776F9@vmware.com>
	<AANLkTimCigD6XauvdR8BvnzuDJtLnRGcP54dJ-Oi5=ou@mail.gmail.com>
Message-ID: <20110208161443.GC5122@wellquite.org>

On Tue, Feb 08, 2011 at 03:47:00PM +0000, Robert Raschke wrote:
> > =WARNING REPORT==== 8-Feb-2011::10:27:55 ===
> > Non-AMQP exit reason '{{badrecord,resource},
> >                       [{rabbit_channel,handle_cast,2},
> >                        {gen_server2,handle_msg,2},
> >                        {proc_lib,init_p_do_apply,3}]}'
> >
> >
> Shot in the dark:
> 
> Looks like the 'resource' record doesn't match up somewhere; maybe it's got
> different number of fields in different locations.

Probably something like you're using an #amqqueue where you should just
be using a #resource, or you're using a binary where you should be using
a #resource... something like that.

Matthew

From matthew at rabbitmq.com  Tue Feb  8 16:15:26 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 8 Feb 2011 16:15:26 +0000
Subject: [rabbitmq-discuss] Failing to connect/reconnect to rabbitMq.
In-Reply-To: <192E282CAB256F41A2161A9E1BAA7C5E08D394@MTW02MBX01.mindtree.com>
References: <192E282CAB256F41A2161A9E1BAA7C5E08D394@MTW02MBX01.mindtree.com>
Message-ID: <20110208161525.GD5122@wellquite.org>

On Tue, Feb 08, 2011 at 03:58:21PM +0000, Waseem Hawaldar wrote:
> When I start pumping messages to RabbitMQ version 1.8.

1.8 is ancient. Please try upgrading to the latest 2.3.1.

Matthew

From GSchimmel at schubergphilis.com  Tue Feb  8 15:46:11 2011
From: GSchimmel at schubergphilis.com (Geurt Schimmel)
Date: Tue, 8 Feb 2011 16:46:11 +0100
Subject: [rabbitmq-discuss] Pika 0.9.1a Released
Message-ID: <EB192628D03CD94B9D9F7A735B3F50BD292A618A10@SBPOMB2.sbp.lan>

The documention url is http://tonyg.github.com/pika/, not https://tonyg.github.com/pika/

Examples on http://www.rabbitmq.com/getstarted.html still point to version 0.5.x, but when you follow the documentation, it will install Pika 0.9.2. As a result of this, the examples are broken.

Kind regards,
Geurt Schimmel


Schuberg Philis
Star Parc Boeingavenue 271
1119 PD Schiphol-Rijk
schubergphilis.com

+31 20 750 65 85
+31 6 223 969 95
_____________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110208/740fd5b5/attachment-0001.htm>

From cristofer.seccia at gmail.com  Tue Feb  8 16:34:19 2011
From: cristofer.seccia at gmail.com (Crisoforo Seccia)
Date: Tue, 8 Feb 2011 17:34:19 +0100
Subject: [rabbitmq-discuss] is there any possibility to remotely unbind a
	queue or close an exchange?
Message-ID: <AANLkTi=7b5iL9Krkk+2xH6yZmjQ5Z_VpnJ59BX-3sd9d@mail.gmail.com>

Hi All,
I'm facing into a scenario where I need to remotely destroy, or unbind a
subscriber from a queue or even close an exchange. For example, taking into
account a third-party authentication server (I call it "Auth Server") wich
gives the subscriber some access rights to use with RabbitMQ in order to
connect to the broker; the policy may require that the subscriber can be
connected with the broker for only one hour, after that it should be
stopped. Here is my question. Is there any possibility for the Auth Server
to remotely destroy a queue, an exchange or a channel on the RabbitMQ
server? Thanks in advance for any response.
Cristoforo.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110208/6bbd0a1b/attachment.htm>

From gmr at myyearbook.com  Tue Feb  8 16:41:02 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 8 Feb 2011 11:41:02 -0500
Subject: [rabbitmq-discuss] Pika 0.9.1a Released
In-Reply-To: <EB192628D03CD94B9D9F7A735B3F50BD292A618A10@SBPOMB2.sbp.lan>
References: <EB192628D03CD94B9D9F7A735B3F50BD292A618A10@SBPOMB2.sbp.lan>
Message-ID: <AANLkTinoaW3VYbndQmoseV2B0CEdLUedL6nWxbeN+ShM@mail.gmail.com>

On Tue, Feb 8, 2011 at 10:46 AM, Geurt Schimmel
<GSchimmel at schubergphilis.com> wrote:
>
> The documention url is http://tonyg.github.com/pika/, not https://tonyg.github.com/pika/

Correct, sorry about that.

> Examples on http://www.rabbitmq.com/getstarted.html still point to version 0.5.x, but when you follow the documentation, it will install Pika 0.9.2. As a result of this, the examples are broken.

You can install 0.5.2 with PIP:

pip install -e git+git://github.com/tonyg/pika.git at v0.5.2#egg=pika-v0.5.2

From jerryk at vmware.com  Tue Feb  8 17:15:56 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 8 Feb 2011 09:15:56 -0800
Subject: [rabbitmq-discuss] RabbitMQ Test case - Possible Memory Leak
 problem
In-Reply-To: <AANLkTim1cEhCHOjaug57am3K-qmJrCMuP945U6K=c3UW@mail.gmail.com>
References: <AANLkTimgA6tNpstggKpeKTj2yUC+xdWGpuAD+CvYP9jq@mail.gmail.com>
	<20110114160023.GE18402@rabbitmq.com>
	<AANLkTi=dDJLJrf67+KrA1Y6TxFYEs48_oisjyyeo-mwX@mail.gmail.com>
	<F78BCF638F95D74A99D036114107EDB5023948CC50@EXCH-MBX-3.vmware.com>,
	<AANLkTim1cEhCHOjaug57am3K-qmJrCMuP945U6K=c3UW@mail.gmail.com>
Message-ID: <F78BCF638F95D74A99D036114107EDB5023948CD83@EXCH-MBX-3.vmware.com>

Hi, Cristofo...

> Hi Jerry, sorry to bother you again! if you remember our discussion
> about some rabbitmq crash problems. However I think i've found a
> solution wich seems for me to work. I've used all the previous
> configurations and test applications with the last version of Erlang
> Installed on my win 2003 machine (so I'm moved from the erlang
> "R13B03" to the "R14B01") and thanks to this version, my test
> application works fine. As I said before, my intentions were to
> compare RabbitMQ with ActiveMQ and now I finally got out some useful
> results. if you are interesting I can send you a Excel file which
> reports (thanks to some diagrams...) the differences between the two
> servers. Thanks.  Cristoforo.

No bother at all!  I'm glad you've got a solution that's viable for
you now.  That said, there are still some issues with memory handling
in the Windows version of Erlang, but as we discussed previously they
tend to only manifest when the process is under significant memory
stress, as it might get, for example, when a significant imbalance
between producers and consumers exists for too long.  We've yet to see
those issues under Linux, so long term, at least until the Windows
Erlang situation improves, deploying on that OS is always something to
keep in mind.

If you're able to share your data and test results, I think we'd
really appreciate seeing that.  Depending on what the data contain,
someone on the team may even have some suggestions on optimization
for your specific scenario.

Best regards,
Jerry

From harvey.robin at gmail.com  Tue Feb  8 19:55:33 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Tue, 8 Feb 2011 19:55:33 +0000
Subject: [rabbitmq-discuss] New Open source AMQP implementation,
 problems with integrating using different langauges
In-Reply-To: <4D510F71.1090101@rabbitmq.com>
References: <302921.41550.qm@web111413.mail.gq1.yahoo.com>
	<AANLkTi=7paA4bBQkdLdppMwxhyczKbuwQEzkXXPbdhuy@mail.gmail.com>
	<4D510F71.1090101@rabbitmq.com>
Message-ID: <AANLkTi=bsMrC_-Ynyok-dnYV2J0zxGD-zOW_FS80dN04@mail.gmail.com>

Hi,

I have now fixed this issue, amqphp can now receive messages which don't
have a content-type header.  The patch is here:

https://github.com/BraveSirRobin/amqphp/commit/addafac7237605dc150f6a2975d6d7dbe3292120

Thanks Finn,
--Robin

On Tue, Feb 8, 2011 at 9:40 AM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 08/02/11 09:21, Robin Harvey wrote:
>
>> Are the content-type / content-encoding parameters required by Amqp /
>> RabbitMQ?
>>
>
> No.
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110208/3a503d83/attachment.htm>

From jerryk at vmware.com  Tue Feb  8 20:56:55 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 8 Feb 2011 12:56:55 -0800
Subject: [rabbitmq-discuss] is there any possibility to remotely unbind
 a	queue or close an exchange?
In-Reply-To: <AANLkTi=7b5iL9Krkk+2xH6yZmjQ5Z_VpnJ59BX-3sd9d@mail.gmail.com>
References: <AANLkTi=7b5iL9Krkk+2xH6yZmjQ5Z_VpnJ59BX-3sd9d@mail.gmail.com>
Message-ID: <F78BCF638F95D74A99D036114107EDB5023948CD85@EXCH-MBX-3.vmware.com>

Hi, Cristoforo...

> I'm facing into a scenario where I need to remotely destroy, or unbind
> a subscriber from a queue or even close an exchange. For example,
> taking into account a third-party authentication server (I call it
> "Auth Server") wich gives the subscriber some access rights to use
> with RabbitMQ in order to connect to the broker; the policy may
> require that the subscriber can be connected with the broker for only
> one hour, after that it should be stopped. Here is my question. Is
> there any possibility for the Auth Server to remotely destroy a queue,
> an exchange or a channel on the RabbitMQ server? Thanks in advance for
> any response.


Assuming I'm following you correctly, and that this third party entity
you're building that you want to handle the cleaning up of bindings,
queues, exchanges, etc. is itself a Rabbit client and has connected to
the broker with suitable permissions, you should be able to do such
things.

Check out our AMQP quick reference at:

http://www.rabbitmq.com/amqp-0-9-1-quickref.html

Methods you're likely to find of interest are queue.unbind,
exchange.unbind, queue.delete and exchange.delete.  You'll likely find
invoking them to be fairly straightforward (IIRC you're a user of the
.NET client?).  Be sure to check the documentation carefully to make
sure a given teardown method tears down all you expect and not more
(for example queue.delete cancels all consumers on the queue in
question).

Best regards,
Jerry

From taicki at gmail.com  Tue Feb  8 19:26:37 2011
From: taicki at gmail.com (Taek Joo Kim)
Date: Tue, 8 Feb 2011 14:26:37 -0500
Subject: [rabbitmq-discuss] exceptions on fast opening a number of
 connections / exception on TCP connection
In-Reply-To: <AANLkTikh3Zsv1xBv-eqAR8w3dTiSi-3mF5k3aOuD0eCY@mail.gmail.com>
References: <4D4459FF.4090404@gmail.com>
	<AANLkTikh3Zsv1xBv-eqAR8w3dTiSi-3mF5k3aOuD0eCY@mail.gmail.com>
Message-ID: <AANLkTi=HJmR08O4NvsmybmNbFnq8i_UJO55nFR9LRoeB@mail.gmail.com>

Hi.

Actually I saw this log message and am trying to debug. In our case, I
did not get any exceptions on the client side.

Could I ask what the cause is? Does the broken framing mean pika's issue?

FYI, we are using pika 0.5.2 and rabbitmq-server 2.1.1.

Thanks,
Taek

On Mon, Feb 7, 2011 at 2:00 PM, Marek Majkowski <majek04 at gmail.com> wrote:
>
> On Sat, Jan 29, 2011 at 18:18, Marcin Krol <mrkafk at gmail.com> wrote:
> > I wrote a "stress test" function that (relatively) quickly does the
> > following: it creates a number of threads that open a new connection to
> > Rabbit, do RPC call over Rabbit, close the connection, sleep some
> > milliseconds and iterate again.
> >
> > I'm getting following exceptions in Rabbit log:
> >
> > =ERROR REPORT==== 29-Jan-2011::18:06:04 ===
> > exception on TCP connection <0.22244.4> from 10.0.0.234:54501
> > {inet_error,enomem}
>
> For a record, this error is triggered by a broken framing. For example:
> echo -e "AMQP\x00\x00\x09\x01AMQP\x00\x00\x09\x01"|nc localhost 5672
>
> Cheers,
> ?Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From adam.rosenberger1 at gmail.com  Wed Feb  9 01:27:41 2011
From: adam.rosenberger1 at gmail.com (adam.rosenberger1 at gmail.com)
Date: Wed, 09 Feb 2011 01:27:41 +0000
Subject: [rabbitmq-discuss] C# Work Queue Question
Message-ID: <90e6ba4fc224080f37049bcf5fea@google.com>

Hello,

I am new to RabbitMQ and was working on translating the work queue example  
into c# [http://www.rabbitmq.com/tutorial-two-python.html]. I've done some  
googling and read through a fair amount of documentation on the rabbit  
site, but I must be missing something. I can't seem to figure out why the  
following scenario works, but the other one doesn't:

Works: Start two clients, then start the server that provides the tasks.
Does not Work: Start the server that provides the tasks, then start two  
clients.

When I start the server first, only the first client receives messages. If  
I kill the first client before it finishes processing all the messages,  
then the second client finally starts picking up the unacknowledged  
messages left in the queue. I tried this using both Subscription and  
QueueingBasisConsumer.

I must be missing something obvious, but I can't seem to figure out what.  
Thanks for any help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110209/d8514e88/attachment-0001.htm>

From majek04 at gmail.com  Wed Feb  9 09:11:33 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 9 Feb 2011 09:11:33 +0000
Subject: [rabbitmq-discuss] exceptions on fast opening a number of
 connections / exception on TCP connection
In-Reply-To: <AANLkTi=HJmR08O4NvsmybmNbFnq8i_UJO55nFR9LRoeB@mail.gmail.com>
References: <4D4459FF.4090404@gmail.com>
	<AANLkTikh3Zsv1xBv-eqAR8w3dTiSi-3mF5k3aOuD0eCY@mail.gmail.com>
	<AANLkTi=HJmR08O4NvsmybmNbFnq8i_UJO55nFR9LRoeB@mail.gmail.com>
Message-ID: <AANLkTinprBTHAJ+9O4Ao5eLALH2Ufm2f1fWo8OfPhPvc@mail.gmail.com>

On Tue, Feb 8, 2011 at 19:26, Taek Joo Kim <taicki at gmail.com> wrote:
> Actually I saw this log message and am trying to debug. In our case, I
> did not get any exceptions on the client side.
>
> Could I ask what the cause is? Does the broken framing mean pika's issue?

It is caused by using one pika connection or channel in multiple threads.
Pika is not multithreaded.

Cheers,
  Marek

> On Mon, Feb 7, 2011 at 2:00 PM, Marek Majkowski <majek04 at gmail.com> wrote:
>> On Sat, Jan 29, 2011 at 18:18, Marcin Krol <mrkafk at gmail.com> wrote:
>> > I wrote a "stress test" function that (relatively) quickly does the
>> > following: it creates a number of threads that open a new connection to
>> > Rabbit, do RPC call over Rabbit, close the connection, sleep some
>> > milliseconds and iterate again.
>> >
>> > I'm getting following exceptions in Rabbit log:
>> >
>> > =ERROR REPORT==== 29-Jan-2011::18:06:04 ===
>> > exception on TCP connection <0.22244.4> from 10.0.0.234:54501
>> > {inet_error,enomem}
>>
>> For a record, this error is triggered by a broken framing. For example:
>> echo -e "AMQP\x00\x00\x09\x01AMQP\x00\x00\x09\x01"|nc localhost 5672

From Waseem_Hawaldar at mindtree.com  Wed Feb  9 09:40:26 2011
From: Waseem_Hawaldar at mindtree.com (Waseem Hawaldar)
Date: Wed, 9 Feb 2011 09:40:26 +0000
Subject: [rabbitmq-discuss] Failing to connect/reconnect to rabbitMq.
In-Reply-To: <4D516BE3.2090604@rabbitmq.com>
References: <192E282CAB256F41A2161A9E1BAA7C5E08D394@MTW02MBX01.mindtree.com>
	<AANLkTi=webtYMHFOWh4Soo_o-9_6eUTJ8cxFZxK0D6Q8@mail.gmail.com>
	<4D516BE3.2090604@rabbitmq.com>
Message-ID: <192E282CAB256F41A2161A9E1BAA7C5E08D567@MTW02MBX01.mindtree.com>

Hi Emile,

        First of all I would like to thank you for your reply.


        I am sending some more stack trace as follows:

 [INFO] [rEnrol.dispatcher.13] [org.mule.transport.vm.VMMessageDispatcher] - Connected: endpoint.outbound.vm://enrol.response

 [ERROR] [sponseToEnrollment.4] [org.mule.retry.notifiers.ConnectNotifier] - Failed to connect/reconnect: endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UIDEnrolRspQ&replyToExchange. Root Exception was: Failed to create com.rabbitmq.client.Channel. Type: class org.mule.api.lifecycle.InitialisationException


Please suggest me some tips or possibilities of what can cause this error.


Regards,
Waseem

Waseem Hawaldar| Open Source Practice | MindTree Ltd | Ecospace, outer ring road , Belandur(Accenture Office).  Bangalore-560 059, INDIA | Project Aadhaar - UIDAI |Mob: +91 9900588758 | email: waseem_hawaldar at mindtree.com| www.mindtree.com |





-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: Tuesday, February 08, 2011 9:44 PM
To: Waseem Hawaldar
Cc: David Sinclair; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Failing to connect/reconnect to rabbitMq.

Hi Waseem,

Is there anything in the RabbitMQ logfile at the corresponding time? Is
it possible to get a full stacktrace? What was the state of the network
at this point? Was this a reconnection?

Regards

Emile

On 08/02/11 16:03, David Sinclair wrote:
> That is the whole error? Can't tell to much just from that.
>
> On Tue, Feb 8, 2011 at 10:58 AM, Waseem Hawaldar
> <Waseem_Hawaldar at mindtree.com <mailto:Waseem_Hawaldar at mindtree.com>> wrote:
>
>     When I start pumping messages to RabbitMQ version 1.8. I am finding
>     this below mentioned error:
>
>     org.mule.retry.notifiers.ConnectNotifier] - Failed to
>     connect/reconnect:
>     endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UIDEnrolRspQ&replyToExchange.
>     Root Exception was: Failed to create com.rabbitmq.client.Channel.
>     Type: class org.mule.api.lifecycle.InitialisationException

________________________________

http://www.mindtree.com/email/disclaimer.html

From alexandru at rabbitmq.com  Wed Feb  9 09:57:00 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 9 Feb 2011 09:57:00 +0000
Subject: [rabbitmq-discuss] publish messages after certain period
In-Reply-To: <D903D238-0FD1-4D78-8DE8-5495225D458D@gmail.com>
References: <D903D238-0FD1-4D78-8DE8-5495225D458D@gmail.com>
Message-ID: <20110209095700.GA3442@dakota.eng.vmware.com>

Hi Denny,

> Basically, I'd like to be able to publish a message.  I'd want that message held for 30 seconds prior to it actually being delivered.  After 30 seconds the message can be delivered to the appropriate queue(s).  During the 30 second window, I'd have the option of removing the message preventing it from being delivered altogether.
>
> Would RabbitMQ be able to handle this type of scenario? 

It can't handle it insomuch as there's no configuration option for it.
Of course, you could build a system that does the same thing.

For instance, you could:
  1) have all producers publish to a single 'incoming' queue, and have
  them include the delivery time and the intended destination queue in
  the message or in the message headers;
  2) have a consumer consuming one message at a time (via basic.get or
  with basic.consume and basic.qos) from the incoming queue and
  republishing the messages to the destination queues; since this
  consumer handles messages one at a time, it can wait if it receives a
  message to early; this consumer would also have the option of
  discarding removed messages; it could be notified of which messages to
  remove by reading from another queue;
  3) have normal consumers use the destination queues.

RabbitMQ doesn't do this automatically because
  1) it's a messaging system, not a database; it's designed to handle
  messages as quickly as possible, not store them for arbitrary lengths
  of time;
  2) once on a queue, a message cannot be altered or removed; i.e. you
  can't remove a message from the middle of a queue.

Hope this helps.

Cheers,
Alex

On Mon, Feb 07, 2011 at 02:07:27PM -0600, Denny Swindle wrote:
> I'm pretty much a newbie at using RabbitMQ.  We have a instance running on one of our servers for an application we have and so far it's been working great for what we need.  But now I have a scenario and I'm wondering if it's possible to leverage RabbitMQ.  
> 
> Basically, I'd like to be able to publish a message.  I'd want that message held for 30 seconds prior to it actually being delivered.  After 30 seconds the message can be delivered to the appropriate queue(s).  During the 30 second window, I'd have the option of removing the message preventing it from being delivered altogether.
> 
> Would RabbitMQ be able to handle this type of scenario? 
> 
> Thanks -
> Denny
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Wed Feb  9 11:14:00 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 09 Feb 2011 11:14:00 +0000
Subject: [rabbitmq-discuss] C# Work Queue Question
In-Reply-To: <90e6ba4fc224080f37049bcf5fea@google.com>
References: <90e6ba4fc224080f37049bcf5fea@google.com>
Message-ID: <4D5276F8.9020305@rabbitmq.com>

Hi Adam,

On 09/02/11 01:27, adam.rosenberger1 at gmail.com wrote:
> Hello,
>
> I am new to RabbitMQ and was working on translating the work queue
> example into c# [http://www.rabbitmq.com/tutorial-two-python.html]. I've
> done some googling and read through a fair amount of documentation on
> the rabbit site, but I must be missing something. I can't seem to figure
> out why the following scenario works, but the other one doesn't:
>
> Works: Start two clients, then start the server that provides the tasks.
> Does not Work: Start the server that provides the tasks, then start two
> clients.
>
> When I start the server first, only the first client receives messages.

Are you forgetting to set QoS on the channel? ( http://bit.ly/iiUWyh )

Between starting the first and second client, the first client will have 
an opportunity to get all the messages if they can be processed fast 
enough. Try adding more dots to have the tasks take longer to complete. 
Subsequent work items that are issued once both workers are running and 
that involve comparable effort should be shared evenly between workers.

If this still doesn't work then feel free to share your code.


Regards

Emile



From paul.j.winters at gmail.com  Wed Feb  9 11:22:59 2011
From: paul.j.winters at gmail.com (Paul Winters)
Date: Wed, 9 Feb 2011 05:22:59 -0600
Subject: [rabbitmq-discuss] Unable to start Rabbit Server or Service
Message-ID: <AANLkTim9Rk-YSzTCdRGiAVBLX8RnNjR+RjVSMesxYAVi@mail.gmail.com>

Greetings.  We are currently trying to run Rabbit on an enterprise level
server that has multiple network cards/ip addresses.  When I run the
rabbitmq-server.bat file, the first call to erl.exe works, the second call
fails with the attached crash dump.  A theory is that Rabbit is grabbing the
wrong IP, but we are unsure.

Also when trying to run erlang installation verification I get the following
error:
Error in process <0.36.0> with exit value: {{case_clause, {1,{'EXIT',
{enoent, [{erlang, open_port,[{spawn,"d:/Program Files/ DRS/DRS
Web/erl5.7.4/lib/gs-1.5.11/priv/tcl/bin/wish84s.exe d:\Program Files\DRS\DRS
Web\erl5.7.4\lib\gs-1.5.11\priv\gstk.tcl...

I think the issues might be related.

We have turned off the firewalls the policy monitoring software, etc without
success.

Any suggestions as to what could be causing the issue?

Thanks in advance.
Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110209/1be62544/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.dump
Type: application/octet-stream
Size: 351519 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110209/1be62544/attachment-0001.obj>

From emile at rabbitmq.com  Wed Feb  9 11:29:38 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 09 Feb 2011 11:29:38 +0000
Subject: [rabbitmq-discuss] Failing to connect/reconnect to rabbitMq.
In-Reply-To: <192E282CAB256F41A2161A9E1BAA7C5E08D567@MTW02MBX01.mindtree.com>
References: <192E282CAB256F41A2161A9E1BAA7C5E08D394@MTW02MBX01.mindtree.com>
	<AANLkTi=webtYMHFOWh4Soo_o-9_6eUTJ8cxFZxK0D6Q8@mail.gmail.com>
	<4D516BE3.2090604@rabbitmq.com>
	<192E282CAB256F41A2161A9E1BAA7C5E08D567@MTW02MBX01.mindtree.com>
Message-ID: <4D527AA2.1040308@rabbitmq.com>

Hi Waseem,

I'm afraid this is not enough information to diagnose the problem. There 
is no indication whether the channel creation attempt even reached the 
broker. Try to narrow down the scope of the problem by replicating with 
the minimal amount of code.

Also, was there an entry in the RabbitMQ logfile at the time of the 
error? What was the state of the network at this point? Was this a 
reconnection?

You could use the AMQP tracer tool if you are still stuck. See 
http://www.rabbitmq.com/examples.html#tracer . If you are using a 
version 1.8 Java client then use the version 1.8 tracer.

Regards

Emile


On 09/02/11 09:40, Waseem Hawaldar wrote:
> Hi Emile,
>
> First of all I would like to thank you for your reply.
>
>
> I am sending some more stack trace as follows:
>
> [INFO] [rEnrol.dispatcher.13]
> [org.mule.transport.vm.VMMessageDispatcher] - Connected:
> endpoint.outbound.vm://enrol.response
>
> [ERROR] [sponseToEnrollment.4]
> [org.mule.retry.notifiers.ConnectNotifier] - Failed to
> connect/reconnect:
> endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UIDEnrolRspQ&replyToExchange.
> Root Exception was: Failed to create com.rabbitmq.client.Channel.
> Type: class org.mule.api.lifecycle.InitialisationException
>
>
> Please suggest me some tips or possibilities of what can cause this
> error.
>
>
> Regards, Waseem
>
> Waseem Hawaldar| Open Source Practice | MindTree Ltd | Ecospace,
> outer ring road , Belandur(Accenture Office).  Bangalore-560 059,
> INDIA | Project Aadhaar - UIDAI |Mob: +91 9900588758 | email:
> waseem_hawaldar at mindtree.com| www.mindtree.com |
>
>
>
>
>
> -----Original Message----- From: Emile Joubert
> [mailto:emile at rabbitmq.com] Sent: Tuesday, February 08, 2011 9:44 PM
> To: Waseem Hawaldar Cc: David Sinclair;
> rabbitmq-discuss at lists.rabbitmq.com Subject: Re: [rabbitmq-discuss]
> Failing to connect/reconnect to rabbitMq.
>
> Hi Waseem,
>
> Is there anything in the RabbitMQ logfile at the corresponding time?
> Is it possible to get a full stacktrace? What was the state of the
> network at this point? Was this a reconnection?
>
> Regards
>
> Emile
>
> On 08/02/11 16:03, David Sinclair wrote:
>> That is the whole error? Can't tell to much just from that.
>>
>> On Tue, Feb 8, 2011 at 10:58 AM, Waseem Hawaldar
>> <Waseem_Hawaldar at mindtree.com<mailto:Waseem_Hawaldar at mindtree.com>>
>> wrote:
>>
>> When I start pumping messages to RabbitMQ version 1.8. I am
>> finding this below mentioned error:
>>
>> org.mule.retry.notifiers.ConnectNotifier] - Failed to
>> connect/reconnect:
>> endpoint.outbound.amqp://ABISExchange:direct/?queue=&durable=true&exchange-durable=true&defaultQueue=ACC_UIDEnrolRspQ&replyToExchange.

From matthew at rabbitmq.com  Wed Feb  9 11:42:38 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 9 Feb 2011 11:42:38 +0000
Subject: [rabbitmq-discuss] Unable to start Rabbit Server or Service
In-Reply-To: <AANLkTim9Rk-YSzTCdRGiAVBLX8RnNjR+RjVSMesxYAVi@mail.gmail.com>
References: <AANLkTim9Rk-YSzTCdRGiAVBLX8RnNjR+RjVSMesxYAVi@mail.gmail.com>
Message-ID: <20110209114237.GM11100@rabbitmq.com>

On Wed, Feb 09, 2011 at 05:22:59AM -0600, Paul Winters wrote:
> Also when trying to run erlang installation verification I get the following
> error:
> Error in process <0.36.0> with exit value: {{case_clause, {1,{'EXIT',
> {enoent, [{erlang, open_port,[{spawn,"d:/Program Files/ DRS/DRS
> Web/erl5.7.4/lib/gs-1.5.11/priv/tcl/bin/wish84s.exe d:\Program Files\DRS\DRS
> Web\erl5.7.4\lib\gs-1.5.11\priv\gstk.tcl...

Well, that suggests that it's unable to find
d:/Program Files/ DRS/DRSWeb/erl5.7.4/lib/gs-1.5.11/priv/tcl/bin/wish84s.exe

It could be spaces related - in fact that's pretty likely - that
particular form of spawn will think that "d:/Program" is the name of the
executable. But this is all from the "erlang installation verification"
which I've never even heard of before, and it would not in the least
surprise me if that thing doesn't work reliably on Windows.

We have spent a fair amount of time making Rabbit be robust against
spaces in paths, so it shouldn't be that issue affecting Rabbit.

Do you have the rabbitmq logs themselves available? They sometimes tell
us more than just the crashdump.

Matthew

From paul.j.winters at gmail.com  Wed Feb  9 11:57:30 2011
From: paul.j.winters at gmail.com (Paul Winters)
Date: Wed, 9 Feb 2011 05:57:30 -0600
Subject: [rabbitmq-discuss] Unable to start Rabbit Server or Service
In-Reply-To: <20110209114237.GM11100@rabbitmq.com>
References: <AANLkTim9Rk-YSzTCdRGiAVBLX8RnNjR+RjVSMesxYAVi@mail.gmail.com>
	<20110209114237.GM11100@rabbitmq.com>
Message-ID: <AANLkTikE1DYB933Z7RvGTHiKARivEqFdQjxRogb6UXRJ@mail.gmail.com>

Thanks for the quick response.  The install verification is nothing more
than popping up a toolbar from an erlang shell.  It is on the erlang
website.  I verified that "wish" file is present.

No logs are written to the log directory when I try to start Rabbit, that
RABBITMQ_BASE is used for (files are there but they are empty).  Is there
another place for logs?

Thanks,
Paul

On Wed, Feb 9, 2011 at 5:42 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Wed, Feb 09, 2011 at 05:22:59AM -0600, Paul Winters wrote:
> > Also when trying to run erlang installation verification I get the
> following
> > error:
> > Error in process <0.36.0> with exit value: {{case_clause, {1,{'EXIT',
> > {enoent, [{erlang, open_port,[{spawn,"d:/Program Files/ DRS/DRS
> > Web/erl5.7.4/lib/gs-1.5.11/priv/tcl/bin/wish84s.exe d:\Program
> Files\DRS\DRS
> > Web\erl5.7.4\lib\gs-1.5.11\priv\gstk.tcl...
>
> Well, that suggests that it's unable to find
> d:/Program Files/
> DRS/DRSWeb/erl5.7.4/lib/gs-1.5.11/priv/tcl/bin/wish84s.exe
>
> It could be spaces related - in fact that's pretty likely - that
> particular form of spawn will think that "d:/Program" is the name of the
> executable. But this is all from the "erlang installation verification"
> which I've never even heard of before, and it would not in the least
> surprise me if that thing doesn't work reliably on Windows.
>
> We have spent a fair amount of time making Rabbit be robust against
> spaces in paths, so it shouldn't be that issue affecting Rabbit.
>
> Do you have the rabbitmq logs themselves available? They sometimes tell
> us more than just the crashdump.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110209/6d2917ef/attachment.htm>

From emile at rabbitmq.com  Wed Feb  9 12:51:43 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 09 Feb 2011 12:51:43 +0000
Subject: [rabbitmq-discuss] Unable to start Rabbit Server or Service
In-Reply-To: <AANLkTim9Rk-YSzTCdRGiAVBLX8RnNjR+RjVSMesxYAVi@mail.gmail.com>
References: <AANLkTim9Rk-YSzTCdRGiAVBLX8RnNjR+RjVSMesxYAVi@mail.gmail.com>
Message-ID: <4D528DDF.6070005@rabbitmq.com>

On 09/02/11 11:22, Paul Winters wrote:
> Greetings.  We are currently trying to run Rabbit on an enterprise level
> server that has multiple network cards/ip addresses.  When I run the
> rabbitmq-server.bat file, the first call to erl.exe works, the second
> call fails with the attached crash dump.  A theory is that Rabbit is
> grabbing the wrong IP, but we are unsure.
>
> Also when trying to run erlang installation verification I get the
> following error:
> Error in process <0.36.0> with exit value: {{case_clause, {1,{'EXIT',
> {enoent, [{erlang, open_port,[{spawn,"d:/Program Files/ DRS/DRS
> Web/erl5.7.4/lib/gs-1.5.11/priv/tcl/bin/wish84s.exe d:\Program
> Files\DRS\DRS Web\erl5.7.4\lib\gs-1.5.11\priv\gstk.tcl...
>
> I think the issues might be related.

toolbar:start() works fine for me on R13B03 on Windows even if the 
Erlang installation path contains spaces. You should check that you are 
able to launch wish84s independently.

Are you running the broker as an application or a service? What is the 
console output? Does %APPDATA%\RabbitMQ not contain anything at all? Do 
you get the same error when you use the new windows installer? (See
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-February/011128.html 
)

Regards

Emile

From paul.j.winters at gmail.com  Wed Feb  9 14:43:09 2011
From: paul.j.winters at gmail.com (Paul Winters)
Date: Wed, 9 Feb 2011 08:43:09 -0600
Subject: [rabbitmq-discuss] Unable to start Rabbit Server or Service
In-Reply-To: <4D528DDF.6070005@rabbitmq.com>
References: <AANLkTim9Rk-YSzTCdRGiAVBLX8RnNjR+RjVSMesxYAVi@mail.gmail.com>
	<4D528DDF.6070005@rabbitmq.com>
Message-ID: <AANLkTi=pqiFCBNZszSfyTrGuan_yOAjpip2qiF+MbXsa@mail.gmail.com>

Emile,
Thanks so much, here are the answers to your questions.

Are you running the broker as an application or a service? Broker for now.
Service later.  Neither work.

What is the console output?  I modified the batch file to output some
variables.  I tried to set the NODE_IP_ADDRESS and received the same error.

Activating RabbitMQ plugins ...
0 plugins activated:
______________________________________
erl started
______________________________________
**********************************
RABBITMQ_NODE_IP_ADDRESS=1XX.2XX.1XX.2XX
ERLANG_HOME=D:\Program Files\DRS\DRS Web\erl5.7.4
RABBITMQ_EBIN_PATH=
RABBITMQ_BOOT_FILE=D:/ProgramData/DRS/DRS
Web/RabbitDB/db/rabbit at UXXXXXXZ-mnesia\plugins-scratch\rabbit
RABBITMQ_CONFIG_ARG=
RABBITMQ_NODENAME=rabbit at UTINHPRZ
RABBITMQ_LOG_BASE=D:/ProgramData/DRS/DRS Web/RabbitDB/log
RABBITMQ_MNESIA_DIR=D:/ProgramData/DRS/DRS
Web/RabbitDB/db/rabbit at UXXXXXXZ-mnesia
CLUSTER_CONFIG=
RABBITMQ_SERVER_START_ARGS=
STAR=
**********************************
{"Kernel pid
terminated",application_controller,"{application_start_failure,os_mon,{shutdown,{os_mon,start,[normal,[]]}}}"}


Does %APPDATA%\RabbitMQ not contain anything at all? It contains the DB and
logs directory and some files.
In the "...mnesia\plugins-scratch\" folder there is a rabbit.boot,
rabbit.rel, rabbit.script.  In the logs directory there are logs, but they
are empty.

Do you get the same error when you use the new windows installer? Yes.

The installation process works on XP, Vista and Windows 2003.  The only
difference I have found on this box is the multiple network cards.

Thanks in advance,
Paul

On Wed, Feb 9, 2011 at 6:51 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> On 09/02/11 11:22, Paul Winters wrote:
>
>> Greetings.  We are currently trying to run Rabbit on an enterprise level
>> server that has multiple network cards/ip addresses.  When I run the
>> rabbitmq-server.bat file, the first call to erl.exe works, the second
>> call fails with the attached crash dump.  A theory is that Rabbit is
>> grabbing the wrong IP, but we are unsure.
>>
>> Also when trying to run erlang installation verification I get the
>> following error:
>> Error in process <0.36.0> with exit value: {{case_clause, {1,{'EXIT',
>> {enoent, [{erlang, open_port,[{spawn,"d:/Program Files/ DRS/DRS
>> Web/erl5.7.4/lib/gs-1.5.11/priv/tcl/bin/wish84s.exe d:\Program
>> Files\DRS\DRS Web\erl5.7.4\lib\gs-1.5.11\priv\gstk.tcl...
>>
>> I think the issues might be related.
>>
>
> toolbar:start() works fine for me on R13B03 on Windows even if the Erlang
> installation path contains spaces. You should check that you are able to
> launch wish84s independently.
>
> Are you running the broker as an application or a service? What is the
> console output? Does %APPDATA%\RabbitMQ not contain anything at all? Do you
> get the same error when you use the new windows installer? (See
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-February/011128.html)
>
> Regards
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110209/df815219/attachment.htm>

From adam.rosenberger1 at gmail.com  Wed Feb  9 15:05:13 2011
From: adam.rosenberger1 at gmail.com (Adam Rosenberger)
Date: Wed, 9 Feb 2011 09:05:13 -0600
Subject: [rabbitmq-discuss] C# Work Queue Question
Message-ID: <AANLkTi=nbbz7b=w1Md3GLwucQVhJ2vfqvW-bTKO7T9Gi@mail.gmail.com>

Hi Emile,

I was setting the qos on the server, but not the clients, which explains why
things worked when I started the server first. But when I started the
clients first, I was only declaring the queue. Thanks a lot for the tip.

I have one more question. The python example only sets the value for the
prefetch count, while the c# API expects a value for prefetch size as well.
I set this value to zero after reading the qos reference - does that sound
correct for the work queue example?

Thanks,
Adam
On Feb 9, 2011 5:14 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110209/62666bc2/attachment.htm>

From olle.jonsson at gmail.com  Wed Feb  9 15:06:17 2011
From: olle.jonsson at gmail.com (Olle Jonsson)
Date: Wed, 9 Feb 2011 16:06:17 +0100
Subject: [rabbitmq-discuss] Another Use-case?
Message-ID: <AANLkTi==YRq+qPcxrgHOwCbX6bp2FCqeReuN5KcoJrQV@mail.gmail.com>

Would Facebook's Real-time
updates<http://developers.facebook.com/docs/api/realtime>be a typical
AMQP job?

Sample PHP callback to that
API<https://github.com/facebook/real-time/blob/master/samples/php/callback.php>

My question: Would it be good and AMQP-like to have that *callback.php* file
(aka "the end-point") enqueue messages instead of working on them?

best regards from the sidelines,
   Olle
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110209/1c91eb45/attachment.htm>

From emile at rabbitmq.com  Wed Feb  9 15:08:29 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 09 Feb 2011 15:08:29 +0000
Subject: [rabbitmq-discuss] Unable to start Rabbit Server or Service
In-Reply-To: <AANLkTi=pqiFCBNZszSfyTrGuan_yOAjpip2qiF+MbXsa@mail.gmail.com>
References: <AANLkTim9Rk-YSzTCdRGiAVBLX8RnNjR+RjVSMesxYAVi@mail.gmail.com>	<4D528DDF.6070005@rabbitmq.com>
	<AANLkTi=pqiFCBNZszSfyTrGuan_yOAjpip2qiF+MbXsa@mail.gmail.com>
Message-ID: <4D52ADED.4030605@rabbitmq.com>

Paul,

Your Erlang installation appears to suffer some problem relating to 
spawning OS processes. This is probably quite independent of RabbitMQ.

Are executables allowed to launch from within
D:/ProgramData/DRS/DRS Web/ by the user running Erlang?
Is that directory a local disk with sufficient permissions, not a 
mounted network share?

Were you able to launch wish84s independently?

The multiple network cards shouldn't cause any problems. RabbitMQ 
listens on the default interface (:: or 0.0.0.0) by default.

Regards

Emile



On 09/02/11 14:43, Paul Winters wrote:
> Emile,
> Thanks so much, here are the answers to your questions.
>
> Are you running the broker as an application or a service? Broker for
> now.  Service later.  Neither work.
>
> What is the console output?  I modified the batch file to output some
> variables.  I tried to set the NODE_IP_ADDRESS and received the same error.
>
> Activating RabbitMQ plugins ...
> 0 plugins activated:
> ______________________________________
> erl started
> ______________________________________
> **********************************
> RABBITMQ_NODE_IP_ADDRESS=1XX.2XX.1XX.2XX
> ERLANG_HOME=D:\Program Files\DRS\DRS Web\erl5.7.4
> RABBITMQ_EBIN_PATH=
> RABBITMQ_BOOT_FILE=D:/ProgramData/DRS/DRS
> Web/RabbitDB/db/rabbit at UXXXXXXZ-mnesia\plugins-scratch\rabbit
> RABBITMQ_CONFIG_ARG=
> RABBITMQ_NODENAME=rabbit at UTINHPRZ
> RABBITMQ_LOG_BASE=D:/ProgramData/DRS/DRS Web/RabbitDB/log
> RABBITMQ_MNESIA_DIR=D:/ProgramData/DRS/DRS
> Web/RabbitDB/db/rabbit at UXXXXXXZ-mnesia
> CLUSTER_CONFIG=
> RABBITMQ_SERVER_START_ARGS=
> STAR=
> **********************************
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,os_mon,{shutdown,{os_mon,start,[normal,[]]}}}"}
>
>
> Does %APPDATA%\RabbitMQ not contain anything at all? It contains the DB
> and logs directory and some files.
> In the "...mnesia\plugins-scratch\" folder there is a rabbit.boot,
> rabbit.rel, rabbit.script.  In the logs directory there are logs, but
> they are empty.
>
> Do you get the same error when you use the new windows installer? Yes.
>
> The installation process works on XP, Vista and Windows 2003.  The only
> difference I have found on this box is the multiple network cards.
>
> Thanks in advance,
> Paul
>
> On Wed, Feb 9, 2011 at 6:51 AM, Emile Joubert <emile at rabbitmq.com
> <mailto:emile at rabbitmq.com>> wrote:
>
>     On 09/02/11 11:22, Paul Winters wrote:
>
>         Greetings.  We are currently trying to run Rabbit on an
>         enterprise level
>         server that has multiple network cards/ip addresses.  When I run the
>         rabbitmq-server.bat file, the first call to erl.exe works, the
>         second
>         call fails with the attached crash dump.  A theory is that Rabbit is
>         grabbing the wrong IP, but we are unsure.
>
>         Also when trying to run erlang installation verification I get the
>         following error:
>         Error in process <0.36.0> with exit value: {{case_clause,
>         {1,{'EXIT',
>         {enoent, [{erlang, open_port,[{spawn,"d:/Program Files/ DRS/DRS
>         Web/erl5.7.4/lib/gs-1.5.11/priv/tcl/bin/wish84s.exe d:\Program
>         Files\DRS\DRS Web\erl5.7.4\lib\gs-1.5.11\priv\gstk.tcl...
>
>         I think the issues might be related.
>
>
>     toolbar:start() works fine for me on R13B03 on Windows even if the
>     Erlang installation path contains spaces. You should check that you
>     are able to launch wish84s independently.
>
>     Are you running the broker as an application or a service? What is
>     the console output? Does %APPDATA%\RabbitMQ not contain anything at
>     all? Do you get the same error when you use the new windows
>     installer? (See
>     http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-February/011128.html
>     )

From emile at rabbitmq.com  Wed Feb  9 15:16:35 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 09 Feb 2011 15:16:35 +0000
Subject: [rabbitmq-discuss] C# Work Queue Question
In-Reply-To: <AANLkTi=nbbz7b=w1Md3GLwucQVhJ2vfqvW-bTKO7T9Gi@mail.gmail.com>
References: <AANLkTi=nbbz7b=w1Md3GLwucQVhJ2vfqvW-bTKO7T9Gi@mail.gmail.com>
Message-ID: <4D52AFD3.1050504@rabbitmq.com>

Hi Adam,

On 09/02/11 15:05, Adam Rosenberger wrote:

> I have one more question. The python example only sets the value for the
> prefetch count, while the c# API expects a value for prefetch size as
> well. I set this value to zero after reading the qos reference - does
> that sound correct for the work queue example?

Yes. The broker conformance page has some information about this:

http://www.rabbitmq.com/specification.html#methods

"The server supports non-global prefetch count limits; global limits and 
prefetch size limits are not implemented."

The C# client exposes more features than the RabbitMQ broker implements 
in this case. Prefetch size and global limits are only useful when using 
the RabbitMQ C# client to connect to a non-RabbitMQ AMQP broker.


Regards

Emile

From harvey.robin at gmail.com  Wed Feb  9 15:40:40 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Wed, 9 Feb 2011 15:40:40 +0000
Subject: [rabbitmq-discuss] Another Use-case?
In-Reply-To: <AANLkTi==YRq+qPcxrgHOwCbX6bp2FCqeReuN5KcoJrQV@mail.gmail.com>
References: <AANLkTi==YRq+qPcxrgHOwCbX6bp2FCqeReuN5KcoJrQV@mail.gmail.com>
Message-ID: <AANLkTimnuWQkah9xfATh8B6zaVcLzWd==3vs7=FJ0m1f@mail.gmail.com>

Hi Olle,

By the looks of things, the Facebook server only sends notifications as HTTP
GET and POST, so if you wanted to use RabbitMQ your Facebook callback would
be an intermediary that passes messages on to RabbitMQ:


(Facebook) ----HTTP---> (Your HTTP server (Apache)) ---Amqp----> (RabbitMQ)

Thanks,
--Robin




On Wed, Feb 9, 2011 at 3:06 PM, Olle Jonsson <olle.jonsson at gmail.com> wrote:

> Would Facebook's Real-time updates<http://developers.facebook.com/docs/api/realtime>be a typical AMQP job?
>
> Sample PHP callback to that API<https://github.com/facebook/real-time/blob/master/samples/php/callback.php>
>
> My question: Would it be good and AMQP-like to have that *callback.php* file
> (aka "the end-point") enqueue messages instead of working on them?
>
> best regards from the sidelines,
>    Olle
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110209/6de8d534/attachment.htm>

From jbrisbin at vmware.com  Wed Feb  9 15:43:47 2011
From: jbrisbin at vmware.com (Jonathan Brisbin)
Date: Wed, 9 Feb 2011 07:43:47 -0800
Subject: [rabbitmq-discuss] errors in riak_queue impl
In-Reply-To: <20110208161443.GC5122@wellquite.org>
References: <5FFE8196-60D2-41A1-8E2B-2917341776F9@vmware.com>
	<AANLkTimCigD6XauvdR8BvnzuDJtLnRGcP54dJ-Oi5=ou@mail.gmail.com>
	<20110208161443.GC5122@wellquite.org>
Message-ID: <21A5E9D3-2663-4C94-98F8-DB2270890DA1@vmware.com>

I think I might be returning something incorrectly from fetch. Now I'm getting the following:

=ERROR REPORT==== 9-Feb-2011::10:40:38 ===
connection <0.209.0> (running), channel 1 - error:
shutdown

=WARNING REPORT==== 9-Feb-2011::10:40:38 ===
Non-AMQP exit reason 'shutdown'

I can't find where this is coming from.

I'm returning from fetch the following:

=INFO REPORT==== 9-Feb-2011::10:40:38 ===
fetch result: {{basic_message,
                   {resource,<<"/">>,exchange,<<"test">>},
                   <<>>,
                   {content,60,
                       {'P_basic',"application/json",undefined,
                           {dict,5,16,16,8,80,48,
                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],
                                 [["X-Riak-Meta-Bar",98,97,122]],
                                 [],[],[],
                                 [["X-Riak-Meta-Guid",87,104,104,72,90,43,84,
                                   65,99,88,116,78,74,86,120,50,101,121,82,86,
                                   103,103,61,61]],
                                 [],[],[],
                                 [["X-Riak-Meta-Queue",116,101,115,116]],
                                 [],[],
                                 [["X-Riak-Meta-Foo",55]],
                                 [],[],
                                 [["X-Riak-Meta-Classid",54,48]]}}},
                           undefined,undefined,undefined,undefined,undefined,
                           undefined,undefined,undefined,undefined,undefined,
                           undefined},
                       undefined,undefined,
                       [<<"{\"test\":\"value\", \"int\": 14}">>]},
                   <<90,24,71,103,228,192,113,123,77,37,92,118,123,36,85,130>>,
                   undefined},
               true,"0",0}

Not sure what I'm missing, though.

Any ideas?

Thanks!

jb


On Feb 8, 2011, at 11:14 AM, Matthew Sackman wrote:

> On Tue, Feb 08, 2011 at 03:47:00PM +0000, Robert Raschke wrote:
>>> =WARNING REPORT==== 8-Feb-2011::10:27:55 ===
>>> Non-AMQP exit reason '{{badrecord,resource},
>>>                      [{rabbit_channel,handle_cast,2},
>>>                       {gen_server2,handle_msg,2},
>>>                       {proc_lib,init_p_do_apply,3}]}'
>>> 
>>> 
>> Shot in the dark:
>> 
>> Looks like the 'resource' record doesn't match up somewhere; maybe it's got
>> different number of fields in different locations.
> 
> Probably something like you're using an #amqqueue where you should just
> be using a #resource, or you're using a binary where you should be using
> a #resource... something like that.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Thanks!

Jon Brisbin

Twitter: @j_brisbin
Skype: jon.brisbin



From olle.jonsson at gmail.com  Wed Feb  9 16:10:11 2011
From: olle.jonsson at gmail.com (Olle Jonsson)
Date: Wed, 9 Feb 2011 17:10:11 +0100
Subject: [rabbitmq-discuss] Another Use-case?
In-Reply-To: <AANLkTimnuWQkah9xfATh8B6zaVcLzWd==3vs7=FJ0m1f@mail.gmail.com>
References: <AANLkTi==YRq+qPcxrgHOwCbX6bp2FCqeReuN5KcoJrQV@mail.gmail.com>
	<AANLkTimnuWQkah9xfATh8B6zaVcLzWd==3vs7=FJ0m1f@mail.gmail.com>
Message-ID: <AANLkTimtEKTc1eGmhCkFcTfs4XN8=WeQLWn0vz7CTqvU@mail.gmail.com>

> (Facebook) ----HTTP---> (Your HTTP server (Apache)) ---Amqp----> (RabbitMQ)

Thanks for painting a picture. Yes, the above was my vision of it.
(The transport "Facebook ---GET/POST----> RabbitMQ" never even
occurred to me.)

My question was more "is work queues a good match for things like
this, or is the problem too small?" Apologies if this is below par for
this mailing list.

From russell at borogove.org  Thu Feb 10 00:24:35 2011
From: russell at borogove.org (Russell Borogove)
Date: Wed, 9 Feb 2011 16:24:35 -0800
Subject: [rabbitmq-discuss] File descriptor limits in management plugin
In-Reply-To: <AANLkTimjK7Z0uSwTBPnz_AOECqEGiZpKOpeac=9Ni77i@mail.gmail.com>
References: <AANLkTikDp8Zc_tS+OkbvoasPxEJzXMMZEZg4VRA+Cgnf@mail.gmail.com>
	<4D3711AC.6010604@rabbitmq.com>
	<AANLkTimjK7Z0uSwTBPnz_AOECqEGiZpKOpeac=9Ni77i@mail.gmail.com>
Message-ID: <016A7C94-74A3-4DDA-A4C8-A11C14714AB9@borogove.org>

Sebastian, how exactly did you fix this problem? I have the same issue.

On Jan 19, 2011, at 9:28 AM, Sebastian Latza wrote:

> Simon,
> 
> I checked the descriptor limit by cat-ing /proc/sys/fs/files-max and
> setting it in /etc/security.conf but actually forgot to invoke ulimit
> to set the proper user limit. I did that now and everything works
> perfectly. Thanks for helping me figure that out.
> 
> Sebastian
> 
> 2011/1/19 Simon MacMullen <simon at rabbitmq.com>:
>> On 19/01/11 16:21, Sebastian Latza wrote:
>>> 
>>> I'm currently running RabbitMQ 2.2.0 with the most recent
>>> (pre-packaged) management plugin. The web console "Nodes and Ports"
>>> section says that I'm using about 800 of 1024 available file
>>> descriptors, which confuses me a bit since my OS limit is set to about
>>> 100000. Is this just a bug in the management console or does the
>>> Erlang VM somehow override this system-wide setting?
>> 
>> Erlang does not change anything.
>> 
>> Which OS are you using and how is RabbitMQ installed?
>> 
>> What does "ulimit -n" say when invoked as the user that is running RabbitMQ?
>> 
>> Cheers, Simon
>> --
>> Simon MacMullen
>> Staff Engineer, RabbitMQ
>> SpringSource, a division of VMware
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From prayadav at gmail.com  Thu Feb 10 08:40:28 2011
From: prayadav at gmail.com (Prashant)
Date: Thu, 10 Feb 2011 00:40:28 -0800 (PST)
Subject: [rabbitmq-discuss] Creating Multiple Consumers bounded to same
	channel in different threads
Message-ID: <7b2bcb79-0c36-41a4-925e-427928e8abde@24g2000yqa.googlegroups.com>

Hi,

I was trying to have a single controller module that set and spawns
multiple consumers ( as and when we need more consumers). Once I set
up the connection and channel I go about creating multiple consumers.
Once i start the Controller module I see either Consumer 1 created or
consumer 2 created and served .
i have ensured that consumer creation and serving goes in parallel i.e
basically having two threads for 2 consumers .

Now, I have read somewhere about rabbitmq single threaded model .Does
the above scenario is failing cause of it or its something else.
Can you guys throw in some pointerd to dynamically create and start
consumes ( I have consumers adding and leaving )

Regds
Prashant

From alfonso.pantoja at gmail.com  Thu Feb 10 09:26:53 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Thu, 10 Feb 2011 10:26:53 +0100
Subject: [rabbitmq-discuss] Message redelivering doubt with one and with
	more than one consumers.
Message-ID: <AANLkTim96T8TGNP7QKW31GXyUU8_r=55dFJ07rrCrxZ=@mail.gmail.com>

Hi,

on the RabbitMQ FAQ page I see the response to

"Can you explain the cases where a message might be delivered to a
consumer more than once?"
the following:

"If a message is delivered to a consumer, and that consumer then dies
(or closes the channel which has the subscription to the queue, or
closes the connection itself) without acking the message, then
RabbitMQ will reinject the message into the queue. If that same
consumer then reconnects and creates a new subscription to the same
queue, it's possible it'll receive the same message again. This is 'at
least once' delivery and is very deliberate design to ensure that
messages are not lost in transit."


So my doubt is:

In a scenario with one consumer as I saw in my tests, the consumer
received messages with the Redelivered=true AMQP header atribute.
The consumer was based in the classes provided by the .NET API and as
I remember the consumer-tag is random generated by the server.

When there is a only one consumer (with a random consumer-tag name)
and a message is not acked when the consumer is reconnected (so has
another random tag name) that message is redelivered?
Based on my experience I think this is true but don't understand that
"If that same consumer then reconnects and creates a new subscription
to the same queue"...
By the was my consumer always tries to create the queue and the
bindings every time it connects to RabbitMQ.

And also I'm wondering how this behavior acts when there are more than
one consumer (same queue and same bindings)...

Under what circumstances an unack message wouldn't be redelivered again?

Thank you in advance.

Regards,

Alfonso










The consumer can also call basic.recover which tells rabbit to resend
all the messages sent to the consumer for which rabbit has not
received an ack for. This basically amounts to the consumer saying "I
know you sent me some messages, but I've forgotten what they are.
Could you resend them all again?".

From jasonjwwilliams at gmail.com  Thu Feb 10 09:40:55 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 10 Feb 2011 02:40:55 -0700
Subject: [rabbitmq-discuss] Creating Multiple Consumers bounded to same
	channel in different threads
In-Reply-To: <7b2bcb79-0c36-41a4-925e-427928e8abde@24g2000yqa.googlegroups.com>
References: <7b2bcb79-0c36-41a4-925e-427928e8abde@24g2000yqa.googlegroups.com>
Message-ID: <025248BB-4174-484F-9668-A48797AAFD57@gmail.com>

Most of the libraries don't support sharing channels between threads. But part of the advantage of channels is that they're cheap to create, so you can share a connection between threads by giving each threads its own channel on the connection. 

-J

Sent via iPhone

Is your e-mail Premiere?

On Feb 10, 2011, at 1:40, Prashant <prayadav at gmail.com> wrote:

> Hi,
> 
> I was trying to have a single controller module that set and spawns
> multiple consumers ( as and when we need more consumers). Once I set
> up the connection and channel I go about creating multiple consumers.
> Once i start the Controller module I see either Consumer 1 created or
> consumer 2 created and served .
> i have ensured that consumer creation and serving goes in parallel i.e
> basically having two threads for 2 consumers .
> 
> Now, I have read somewhere about rabbitmq single threaded model .Does
> the above scenario is failing cause of it or its something else.
> Can you guys throw in some pointerd to dynamically create and start
> consumes ( I have consumers adding and leaving )
> 
> Regds
> Prashant
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alfonso.pantoja at gmail.com  Thu Feb 10 09:44:14 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Thu, 10 Feb 2011 10:44:14 +0100
Subject: [rabbitmq-discuss] Strategy for consuming queues and ordering
Message-ID: <AANLkTimkk1cCojwsf3q5v27O-yUWft3tXcssVm6mVP_X@mail.gmail.com>

Hi,

Can anyone tell me how to deal with queues that contain messages that
are higly recommended by business logic to be ordered?

As far as I know when messages are not acked and a BasicRecover(true)
is done or the consumer is reconnected all these messages are requeued
so the order is lost.

The more suitable strategy I've found in queues where ordering is
important is to use one consumer that stops the consuming process
conditioned to the treatment of the message. In other words, it does
not consume any more message until the current message is, for
example, successfully stored in the database.
The drawback of this is that in case of a consumer is disconnected the
current message is not acked so it will be requeued so the order will
be lost.



Advice on this would be really appreciated :)


Thank you in advance.



Regards,

Alfonso

From rtrlists at googlemail.com  Thu Feb 10 09:55:31 2011
From: rtrlists at googlemail.com (Robert Raschke)
Date: Thu, 10 Feb 2011 09:55:31 +0000
Subject: [rabbitmq-discuss] Strategy for consuming queues and ordering
In-Reply-To: <AANLkTimkk1cCojwsf3q5v27O-yUWft3tXcssVm6mVP_X@mail.gmail.com>
References: <AANLkTimkk1cCojwsf3q5v27O-yUWft3tXcssVm6mVP_X@mail.gmail.com>
Message-ID: <AANLkTinxqC6WLvsTk=ntdbrWRhum8KHHufjp1Beq5Mt9@mail.gmail.com>

Hi Alfonso,

On Thu, Feb 10, 2011 at 9:44 AM, Alfonso Pantoja
<alfonso.pantoja at gmail.com>wrote:

> Can anyone tell me how to deal with queues that contain messages that
> are higly recommended by business logic to be ordered?
>
> As far as I know when messages are not acked and a BasicRecover(true)
> is done or the consumer is reconnected all these messages are requeued
> so the order is lost.
>
> The more suitable strategy I've found in queues where ordering is
> important is to use one consumer that stops the consuming process
> conditioned to the treatment of the message. In other words, it does
> not consume any more message until the current message is, for
> example, successfully stored in the database.
> The drawback of this is that in case of a consumer is disconnected the
> current message is not acked so it will be requeued so the order will
> be lost.
>
>
>
> Advice on this would be really appreciated :)
>
>
Whenever I hear about the problem of the required order of messages having
to be preserved, I start to wonder if the problem at hand is really best
suited to messaging. Could it be that you might be better served by
something like a (normal) work queue?

If you require things to be done in a certain order, then you need to have a
place to actually keep them in that order. Messaging isn't the place to do
this.

Your scenario sounds like you would like to store your "stuff" in order
someplace, have a worker mark it as being worked upon, and remove it only
once the worker is finished.

Sorry for not giving much rabbity help,
Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110210/9668ac06/attachment.htm>

From Chris.Hampson at arm.com  Thu Feb 10 10:50:57 2011
From: Chris.Hampson at arm.com (Chris Hampson)
Date: Thu, 10 Feb 2011 10:50:57 +0000
Subject: [rabbitmq-discuss] Strange Management Plugin Error
In-Reply-To: <4D4FF594.3050900@rabbitmq.com>
References: <A610E03AD50BFC4D95529A36D37FA55E169794BA70@GEORGE.Emea.Arm.com>
	<4D4FE1E8.5080808@rabbitmq.com> <4D4FEABE.6020909@rabbitmq.com>
	<A610E03AD50BFC4D95529A36D37FA55E169794BACB@GEORGE.Emea.Arm.com>
	<4D4FF594.3050900@rabbitmq.com>
Message-ID: <A610E03AD50BFC4D95529A36D37FA55E169794C306@GEORGE.Emea.Arm.com>

I think I can confirm its fixed now. 2-3 days with no stack traces at all.

I think we can mark this one solved.


> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: 07 February 2011 13:37
> To: Chris Hampson
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Strange Management Plugin Error
>
> On 07/02/11 13:34, Chris Hampson wrote:
> > I've just upgraded all our nodes to R14B (5.8.1) from the repository
> > mentioned in the set of posts you pointed me at.
>
> Oh, it actually exists now? That's good news.
>
> Cheers, Simon
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>


-- IMPORTANT NOTICE: The contents of this email and any attachments are confidential and may also be privileged. If you are not the intended recipient, please notify the sender immediately and do not disclose the contents to any other person, use it for any purpose, or store or copy the information in any medium.  Thank you.


From Chris.Hampson at arm.com  Thu Feb 10 10:53:22 2011
From: Chris.Hampson at arm.com (Chris Hampson)
Date: Thu, 10 Feb 2011 10:53:22 +0000
Subject: [rabbitmq-discuss] Strange Management Plugin Error
In-Reply-To: <4D4FF594.3050900@rabbitmq.com>
References: <A610E03AD50BFC4D95529A36D37FA55E169794BA70@GEORGE.Emea.Arm.com>
	<4D4FE1E8.5080808@rabbitmq.com> <4D4FEABE.6020909@rabbitmq.com>
	<A610E03AD50BFC4D95529A36D37FA55E169794BACB@GEORGE.Emea.Arm.com>
	<4D4FF594.3050900@rabbitmq.com>
Message-ID: <A610E03AD50BFC4D95529A36D37FA55E169794C307@GEORGE.Emea.Arm.com>

Sorry, I think that last email went prematurely :-\ sorry people.

Anyhoo, Problem solved, I think we're all fixed up now, no strange errors at all for 2-3 days. For anyone searching in the future here's what fixed it...

>I've just upgraded all our nodes to R14B (5.8.1) from the repository mentioned in the set of posts you pointed me at.
>(http://repos.fedorapeople.org/repos/peter/erlang/ for any users experiencing the same problem).

Many thanks to Shane for pointing us in the right direction :-)

> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: 07 February 2011 13:37
> To: Chris Hampson
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Strange Management Plugin Error
>
> On 07/02/11 13:34, Chris Hampson wrote:
> > I've just upgraded all our nodes to R14B (5.8.1) from the repository
> > mentioned in the set of posts you pointed me at.
>
> Oh, it actually exists now? That's good news.
>
> Cheers, Simon
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>


-- IMPORTANT NOTICE: The contents of this email and any attachments are confidential and may also be privileged. If you are not the intended recipient, please notify the sender immediately and do not disclose the contents to any other person, use it for any purpose, or store or copy the information in any medium.  Thank you.


From abhishek.kona at gmail.com  Thu Feb 10 10:59:44 2011
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Thu, 10 Feb 2011 16:29:44 +0530
Subject: [rabbitmq-discuss] Java handleShutdownSignal startegy
Message-ID: <4D53C520.6060305@gmail.com>

Hi folks,

I am designing a system which needs to get updates by a push model.
I am using rabbitmq to publish messages to a queue.

The clients will be using the Channel.basicConsume for getting messages.
I want to know what are the best strategies for handling shutdown (due 
to RabbitMQ going down  and coming back up / network partition)  in the 
client code
In the method:

handleShutdownSignal


I want the clients to try to handle the shutdown by retrying for a few 
times.
Are there any examples for this? or any pointers on how to go about it?

All thoughts are welcome.

Thanks

Abhishek Kona

From simon at rabbitmq.com  Thu Feb 10 11:07:21 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 10 Feb 2011 11:07:21 +0000
Subject: [rabbitmq-discuss] Strange Management Plugin Error
In-Reply-To: <A610E03AD50BFC4D95529A36D37FA55E169794C306@GEORGE.Emea.Arm.com>
References: <A610E03AD50BFC4D95529A36D37FA55E169794BA70@GEORGE.Emea.Arm.com>	<4D4FE1E8.5080808@rabbitmq.com>
	<4D4FEABE.6020909@rabbitmq.com>
	<A610E03AD50BFC4D95529A36D37FA55E169794BACB@GEORGE.Emea.Arm.com>
	<4D4FF594.3050900@rabbitmq.com>
	<A610E03AD50BFC4D95529A36D37FA55E169794C306@GEORGE.Emea.Arm.com>
Message-ID: <4D53C6E9.1020402@rabbitmq.com>

On 10/02/11 10:50, Chris Hampson wrote:
> I think I can confirm its fixed now. 2-3 days with no stack traces at all.
>
> I think we can mark this one solved.

If you have the time / energy, I'd be interested in hearing how you got 
the mgmt plugin to start at all under R12B05 (since then maybe we can 
get it working properly on older Erlang).

On my CentOS 5 VM I have:

erlang.i386             R12B-5.10.el5      installed
rabbitmq-server.noarch  2.3.1-1            installed

and with rabbitmq-mochiweb-2.3.1.ez installed, RabbitMQ will not start.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From prayadav at gmail.com  Thu Feb 10 12:23:28 2011
From: prayadav at gmail.com (Prashant)
Date: Thu, 10 Feb 2011 04:23:28 -0800 (PST)
Subject: [rabbitmq-discuss] Creating Multiple Consumers bounded to same
	channel in different threads
In-Reply-To: <025248BB-4174-484F-9668-A48797AAFD57@gmail.com>
References: <7b2bcb79-0c36-41a4-925e-427928e8abde@24g2000yqa.googlegroups.com>
	<025248BB-4174-484F-9668-A48797AAFD57@gmail.com>
Message-ID: <10c8b49b-4201-4fa2-931c-bb579a998ca3@o7g2000prn.googlegroups.com>

I already did that :) ( that was what I tried and it works!!!).Still
am confused as to why we would neeed to open a channel for each
consumer. The troulble is I have dynamic number of consumers and am
afraid woudl this approach will scale well( 40 consumers -> 40
channels). Also , there might be some idle consumers( I am planning to
develope provision to detect idle consumers by computing last
delivery ) and close the consumer ( basicCancel ) and further close
the channel as well ( close( message)).
Do you think this approach would scale well ?

Later
P

On Feb 10, 9:40?am, "Jason J. W. Williams" <jasonjwwilli... at gmail.com>
wrote:
> Most of the libraries don't support sharing channels between threads. But part of the advantage of channels is that they're cheap to create, so you can share a connection between threads by giving each threads its own channel on the connection.
>
> -J
>
> Sent via iPhone
>
> Is your e-mail Premiere?
>
> On Feb 10, 2011, at 1:40, Prashant <praya... at gmail.com> wrote:
>
>
>
> > Hi,
>
> > I was trying to have a single controller module that set and spawns
> > multiple consumers ( as and when we need more consumers). Once I set
> > up the connection and channel I go about creating multiple consumers.
> > Once i start the Controller module I see either Consumer 1 created or
> > consumer 2 created and served .
> > i have ensured that consumer creation and serving goes in parallel i.e
> > basically having two threads for 2 consumers .
>
> > Now, I have read somewhere about rabbitmq single threaded model .Does
> > the above scenario is failing cause of it or its something else.
> > Can you guys throw in some pointerd to dynamically create and start
> > consumes ( I have consumers adding and leaving )
>
> > Regds
> > Prashant
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Feb 10 12:31:11 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 10 Feb 2011 12:31:11 +0000
Subject: [rabbitmq-discuss] Creating Multiple Consumers bounded to same
 channel in different threads
In-Reply-To: <10c8b49b-4201-4fa2-931c-bb579a998ca3@o7g2000prn.googlegroups.com>
References: <7b2bcb79-0c36-41a4-925e-427928e8abde@24g2000yqa.googlegroups.com>	<025248BB-4174-484F-9668-A48797AAFD57@gmail.com>
	<10c8b49b-4201-4fa2-931c-bb579a998ca3@o7g2000prn.googlegroups.com>
Message-ID: <4D53DA8F.7030404@rabbitmq.com>

On 10/02/11 12:23, Prashant wrote:
> I already did that :) ( that was what I tried and it works!!!).Still
> am confused as to why we would neeed to open a channel for each
> consumer.

It's not that you *need* to, it's just that most client libraries don't 
make their channel implementations threadsafe. If you use a library that 
does, or if you have one thread with multiple consumers, you don't need 
to open a channel per consumer.

> The troulble is I have dynamic number of consumers and am
> afraid woudl this approach will scale well( 40 consumers ->  40
> channels).

Channels are slightly more expensive in the server than consumers. But 
only slightly. RabbitMQ is designed to scale to very large numbers of 
channels.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From werchmeister at gmail.com  Thu Feb 10 13:43:47 2011
From: werchmeister at gmail.com (Torsten W. Hansen)
Date: Thu, 10 Feb 2011 14:43:47 +0100
Subject: [rabbitmq-discuss] Web server error
Message-ID: <AANLkTinJ=qUY8dFK8O-OE_CmkgNGgkO5pNVf5n3vZ3NQ@mail.gmail.com>

Hello,

I have installed RabbitMQ and Erlang on a computer with Windows 7 home
edition for testing purposes. I have also installed the plug-ins needed for
the web monitor service.

When I enter localhost:55672 in my browser I get the following message
returned:

RabbitMQ Web Server

Contexts available:

   - /rpc
   - /rabbitmq_lib

 Why isn't the monitor displayed?

Best regards,
Torsten
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110210/09d84c83/attachment.htm>

From underattack7 at googlemail.com  Thu Feb 10 15:21:30 2011
From: underattack7 at googlemail.com (underattack7)
Date: Thu, 10 Feb 2011 15:21:30 +0000
Subject: [rabbitmq-discuss] rabbitmq-c: how to catch a broken pipe with the
	rabbitmq server
Message-ID: <AANLkTimr5OF_2NDjOGsMWWAv7eLmazgZu5mKaYTUttQE@mail.gmail.com>

Hi,

I am using the rabbitmq-c C libraries to publish messages to a Rabbitmq
exchange.

Problem I have is that when rabbitmq server stops for some reason
(rabbtmqctl stop_app / start_app for instance), the socket between my
publisher program and rabbitmq is destroyed but I don't manage to catch any
error code properly so that the program can try to establish a new
connection.

When I stop rabbitmq, my publisher program exits with the message: "Broken
Pipe" when it tries to send a message.

Is there a way to check the socket before sending a message so that I can
try to re-establish a connection ?

The way I publish is :

rc = amqp_basic_publish(amqp_connection, 1,  amqp_cstring_bytes("Exchange"),
amqp_cstring_bytes(routingkey), 0, 0, NULL, body);

if (rc < 0)  {
    printf("error during publish : %s\n", strerror(-rc)) ;
 }

problem is that if rabbitmq is stopped,  the line "rc = amqp_basic_publish
...make the program exit, I cannot get the rc value).

Thanks,
Regards,

Fab
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110210/1cfe8c6f/attachment.htm>

From david at rabbitmq.com  Thu Feb 10 17:11:38 2011
From: david at rabbitmq.com (David Wragg)
Date: Thu, 10 Feb 2011 17:11:38 +0000
Subject: [rabbitmq-discuss] rabbitmq-c: how to catch a broken pipe with
	the rabbitmq server
In-Reply-To: <AANLkTimr5OF_2NDjOGsMWWAv7eLmazgZu5mKaYTUttQE@mail.gmail.com>
	(underattack7@googlemail.com's message of "Thu, 10 Feb 2011 15:21:30
	+0000")
References: <AANLkTimr5OF_2NDjOGsMWWAv7eLmazgZu5mKaYTUttQE@mail.gmail.com>
Message-ID: <yrv4c1v3fhl11.fsf@dwragg.eng.vmware.com>

Hi,

underattack7 <underattack7 at googlemail.com> writes:
> I am using the rabbitmq-c C libraries to publish messages to a Rabbitmq
> exchange.
>
> Problem I have is that when rabbitmq server stops for some reason
> (rabbtmqctl stop_app / start_app for instance), the socket between my
> publisher program and rabbitmq is destroyed but I don't manage to catch any
> error code properly so that the program can try to establish a new
> connection.
>
> When I stop rabbitmq, my publisher program exits with the message: "Broken
> Pipe" when it tries to send a message.

Sounds like a bug.  What platform are you on?

> Is there a way to check the socket before sending a message so that I can
> try to re-establish a connection ?
>
> The way I publish is :
>
> rc = amqp_basic_publish(amqp_connection, 1,  amqp_cstring_bytes("Exchange"),
> amqp_cstring_bytes(routingkey), 0, 0, NULL, body);
>
> if (rc < 0)  {
>     printf("error during publish : %s\n", strerror(-rc)) ;
>  }

You should be using "amqp_error_string(-rc)" there, not strerror.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From jasonjwwilliams at gmail.com  Thu Feb 10 18:32:02 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 10 Feb 2011 11:32:02 -0700
Subject: [rabbitmq-discuss] Connection Error
Message-ID: <AANLkTindhHQEyixD-NrDx=0YEJSnEVm=LBT1bXBgzxbf@mail.gmail.com>

Hi Y'all,

I'm having some issues connecting to Rabbit using the 0-9-1 AMQP spec
file with txamqp. Working with Esteve on the txamqp side, but I was
curious if anyone had some pointers on what this error message means
from Rabbit (I get it on connect):

{channel0_error,starting,
    {error,function_clause,'connection.start_ok',
        [{rabbit_binary_parser,parse_field_value,
             [<<119,112,109,95,97,112,105,0,119,112,109,95,97,112,105>>]},
         {rabbit_binary_parser,parse_table,1},
         {rabbit_auth_mechanism_amqplain,handle_response,2},
         {rabbit_reader,auth_phase,2},
         {rabbit_reader,handle_method0,3},
         {rabbit_reader,mainloop,2},
         {rabbit_reader,start_connection,7},
         {proc_lib,init_p_do_apply,3}]}}

Any help is greatly appreciated. Thank you in advance.

-J

From matthias at rabbitmq.com  Thu Feb 10 19:00:17 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 10 Feb 2011 19:00:17 +0000
Subject: [rabbitmq-discuss] Connection Error
In-Reply-To: <AANLkTindhHQEyixD-NrDx=0YEJSnEVm=LBT1bXBgzxbf@mail.gmail.com>
References: <AANLkTindhHQEyixD-NrDx=0YEJSnEVm=LBT1bXBgzxbf@mail.gmail.com>
Message-ID: <4D5435C1.30600@rabbitmq.com>

Jason,

On 10/02/11 18:32, Jason J. W. Williams wrote:
> I'm having some issues connecting to Rabbit using the 0-9-1 AMQP spec
> file with txamqp. Working with Esteve on the txamqp side, but I was
> curious if anyone had some pointers on what this error message means
> from Rabbit (I get it on connect):
>
> {channel0_error,starting,
>      {error,function_clause,'connection.start_ok',
>          [{rabbit_binary_parser,parse_field_value,
>               [<<119,112,109,95,97,112,105,0,119,112,109,95,97,112,105>>]},
>           {rabbit_binary_parser,parse_table,1},
>           {rabbit_auth_mechanism_amqplain,handle_response,2},
>           {rabbit_reader,auth_phase,2},
>           {rabbit_reader,handle_method0,3},
>           {rabbit_reader,mainloop,2},
>           {rabbit_reader,start_connection,7},
>           {proc_lib,init_p_do_apply,3}]}}

Looks like the client selected the AMQPLAIN auth mechanism but sent auth 
data in accordance with the PLAIN mechanism.

Matthias.

From chen650 at yahoo.com  Thu Feb 10 20:02:13 2011
From: chen650 at yahoo.com (alex chen)
Date: Thu, 10 Feb 2011 12:02:13 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-c: how to catch a broken pipe with
	the rabbitmq server
In-Reply-To: <yrv4c1v3fhl11.fsf@dwragg.eng.vmware.com>
References: <AANLkTimr5OF_2NDjOGsMWWAv7eLmazgZu5mKaYTUttQE@mail.gmail.com>
	<yrv4c1v3fhl11.fsf@dwragg.eng.vmware.com>
Message-ID: <487996.61630.qm@web31803.mail.mud.yahoo.com>

we ran into the same problem before.  the workaround was to ignore SIGPIPE 
using:
   signal(SIGPIPE, SIG_IGN);

from the man page for "write":
EPIPE
fd is connected to a pipe or socket whose reading end is closed. When this 
happens the writing process will also receive a SIGPIPE signal. (Thus, the write 
return value is seen only if the program catches, blocks or ignores this 
signal.)

-alex





________________________________
From: David Wragg <david at rabbitmq.com>
To: underattack7 <underattack7 at googlemail.com>
Cc: rabbitmq-discuss <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Thu, February 10, 2011 9:11:38 AM
Subject: Re: [rabbitmq-discuss] rabbitmq-c: how to catch a broken pipe with the 
rabbitmq server

Hi,

underattack7 <underattack7 at googlemail.com> writes:
> I am using the rabbitmq-c C libraries to publish messages to a Rabbitmq
> exchange.
>
> Problem I have is that when rabbitmq server stops for some reason
> (rabbtmqctl stop_app / start_app for instance), the socket between my
> publisher program and rabbitmq is destroyed but I don't manage to catch any
> error code properly so that the program can try to establish a new
> connection.
>
> When I stop rabbitmq, my publisher program exits with the message: "Broken
> Pipe" when it tries to send a message.

Sounds like a bug.  What platform are you on?

> Is there a way to check the socket before sending a message so that I can
> try to re-establish a connection ?
>
> The way I publish is :
>
> rc = amqp_basic_publish(amqp_connection, 1,  amqp_cstring_bytes("Exchange"),
> amqp_cstring_bytes(routingkey), 0, 0, NULL, body);
>
> if (rc < 0)  {
>     printf("error during publish : %s\n", strerror(-rc)) ;
>  }

You should be using "amqp_error_string(-rc)" there, not strerror.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110210/4919f2ef/attachment-0001.htm>

From jasonjwwilliams at gmail.com  Thu Feb 10 21:28:53 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 10 Feb 2011 14:28:53 -0700
Subject: [rabbitmq-discuss] Connection Error
In-Reply-To: <4D5435C1.30600@rabbitmq.com>
References: <AANLkTindhHQEyixD-NrDx=0YEJSnEVm=LBT1bXBgzxbf@mail.gmail.com>
	<4D5435C1.30600@rabbitmq.com>
Message-ID: <AANLkTi=C+OtbMrW9SDc8yXaDRgvJKicF1JAc8VP6QwLD@mail.gmail.com>

Hmm...wonder why changing the spec file causes that. I'll check with
Esteve. Thank you Matthias.

-J

On Thu, Feb 10, 2011 at 12:00 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Jason,
>
> On 10/02/11 18:32, Jason J. W. Williams wrote:
>>
>> I'm having some issues connecting to Rabbit using the 0-9-1 AMQP spec
>> file with txamqp. Working with Esteve on the txamqp side, but I was
>> curious if anyone had some pointers on what this error message means
>> from Rabbit (I get it on connect):
>>
>> {channel0_error,starting,
>> ? ? {error,function_clause,'connection.start_ok',
>> ? ? ? ? [{rabbit_binary_parser,parse_field_value,
>> ? ? ? ? ? ? ?[<<119,112,109,95,97,112,105,0,119,112,109,95,97,112,105>>]},
>> ? ? ? ? ?{rabbit_binary_parser,parse_table,1},
>> ? ? ? ? ?{rabbit_auth_mechanism_amqplain,handle_response,2},
>> ? ? ? ? ?{rabbit_reader,auth_phase,2},
>> ? ? ? ? ?{rabbit_reader,handle_method0,3},
>> ? ? ? ? ?{rabbit_reader,mainloop,2},
>> ? ? ? ? ?{rabbit_reader,start_connection,7},
>> ? ? ? ? ?{proc_lib,init_p_do_apply,3}]}}
>
> Looks like the client selected the AMQPLAIN auth mechanism but sent auth
> data in accordance with the PLAIN mechanism.
>
> Matthias.
>

From shead at galileoprocessing.com  Thu Feb 10 22:54:48 2011
From: shead at galileoprocessing.com (Shane Head)
Date: Thu, 10 Feb 2011 15:54:48 -0700
Subject: [rabbitmq-discuss] Synchronous publish with C client
Message-ID: <C979BAC8.3A7D%shead@galileoprocessing.com>

I know that publish is asynchronous, but from other threads I've read I thought that selecting the channel for a transaction, calling publish and then calling commit could be used to accomplish it.  I've tried doing this in my C code and have been unable to get it to work.  I'm using the amq.direct exchange and sending to a nonexistent queue using the mandatory and immediate flags.  It appears as though the message is being silently dropped by the server though.  I'm running rabbitmQ version 2.2.  Here is the code I'm using.  Please let me know of any errors there might be in my logic or code.  All I get is

[*] Sending some message

outputted when I run this.  I would expect to see the 'Error committingtx' print if the queue does not exist though.

int main(int argc, char *argv[])
{
    int rc;
    int sockfd;
    uint16_t channel = 1;
    amqp_rpc_reply_t reply;

    amqp_connection_state_t conn = amqp_new_connection();
    //Connect
    sockfd = amqp_open_socket("localhost", 5672);
    if (sockfd < 0)
    {
        printf("Error connecting to localhost:5672\n");
        return 1;
    }
    amqp_set_sockfd(conn, sockfd);
    amqp_login(conn, "/" /* vhost */, 0 /* channel_max */,
                131072 /* frame_max */, 0 /* heartbeat */,
                AMQP_SASL_METHOD_PLAIN, "guest", "guest");

    //Create a channel
    amqp_channel_open(conn, channel);

    //Set up tx
    amqp_tx_select(conn, channel);
    reply = amqp_get_rpc_reply(conn);
    if (reply.reply_type != AMQP_RESPONSE_NORMAL)
    {
        printf("Error selecting tx\n");
        return 1;
    }

    //Send  message
    const char *message = "some message";
    printf("[*] Sending %s\n", message);
    amqp_basic_properties_t props;
    memset(&props, 0x00, sizeof(props));
    props.delivery_mode = 2; //persistent

    rc = amqp_basic_publish(conn, channel, amqp_cstring_bytes("amq.direct"),
                            amqp_cstring_bytes("nonexistent_queue"), 1 /*mandatory*/,
                            1 /*immediate*/, &props, amqp_cstring_bytes(message));
    if (rc != 0)
    {
        char *errstr = amqp_error_string(-rc);
        printf("Error publishing: %s\n", errstr);
        free(errstr);
    }

    //Now send commit and see if it worked
    amqp_tx_commit(conn, channel);
    reply = amqp_get_rpc_reply(conn);
    if (reply.reply_type != AMQP_RESPONSE_NORMAL)
    {
        printf("Error committing tx\n");
        return 1;
    }

    reply = amqp_channel_close(conn, channel, AMQP_REPLY_SUCCESS);
    if (reply.reply_type != AMQP_RESPONSE_NORMAL)
    {
        printf("Error closing channel\n");
    }
    amqp_connection_close(conn, AMQP_REPLY_SUCCESS);
    amqp_destroy_connection(conn);

    return 0;
}

Cheers,
Shane



***************
This e-mail and any files transmitted with it may contain confidential and/or proprietary information. It is intended solely for the use of the individual or entity who is the intended recipient. Unauthorized use of this information is prohibited. If you have received this in error, please contact the sender by replying to this message and delete this material from any system it may be on.
***************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110210/8f10f07a/attachment.htm>

From wsmith at tacc.utexas.edu  Thu Feb 10 23:45:44 2011
From: wsmith at tacc.utexas.edu (Warren Smith)
Date: Thu, 10 Feb 2011 17:45:44 -0600
Subject: [rabbitmq-discuss] rabbitmq-auth-mechanism-ssl plugin, TCP,
	SASL EXTERNAL
Message-ID: <083D5377F8EC294D884D590409EFE70D7113956550@MAIL02.austin.utexas.edu>


To make a long story short: Should RabbitMQ be offering SASL EXTERNAL when the client connects using TCP (without SSL)? Or is it doing this because I've made a configuration mistake?


I've been trying out the new rabbitmq-auth-mechanism-ssl plugin in RabbitMQ 2.3.1 (with erlang R14B01). I seem to have it working ok - clients connecting over SSL present a certificate and the CN is used as the RabbitMQ username.

When I use the RabbitMQ 2.3.1 Java client with just TCP and the default user/pass, it doesn't work out of the box. I get an exception:

Exception in thread "main" com.rabbitmq.client.PossibleAuthenticationFailureException: Possibly caused by authentication failure
                at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:289)

The error in the rabbitmq log is:

=ERROR REPORT==== 10-Feb-2011::15:02:27 ===
exception on TCP connection <0.209.0> from xxx.xxx.xxx.xxx:33669
{channel0_error,starting,
                {amqp_error,access_refused,
                            "EXTERNAL login refused: not SSL connection",
                            'connection.start_ok'}}

The rabbitmq.config has:

  [
    {rabbit, [
      {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']},
      {ssl_listeners, [{"0.0.0.0",5671}]},
      {ssl_options, [{cacertfile,".../cacert.pem"},
                     {certfile,".../cert.pem"},
                     {keyfile,".../key.pem"},
                     {verify,verify_peer},
                     {fail_if_no_peer_cert,true}]}
    ]}
  ].

I believe I need the 'EXTERNAL' so that the rabbitmq-auth-mechanism-ssl plugin gets used. However, that plugin won't work with a TCP connection and the Java client tries to use EXTERNAL, causing the error. I worked around this when using the Java client by creating a class that implements SaslConfig that only specifies PLAIN and setSaslConfig() to this on the ConnectionFactory.

It seems like RabbitMQ shouldn't be offering EXTERNAL in this situation when the available EXTERNAL mechanism doesn't work with TCP, but I'm not sure if it is doing this because that is how RabbitMQ works or because I made a mistake in my configuration...

Thanks,


Warren
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110210/1351eecf/attachment.htm>

From alexandru at rabbitmq.com  Fri Feb 11 00:35:00 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 11 Feb 2011 02:35:00 +0200
Subject: [rabbitmq-discuss] Synchronous publish with C client
In-Reply-To: <C979BAC8.3A7D%shead@galileoprocessing.com>
References: <C979BAC8.3A7D%shead@galileoprocessing.com>
Message-ID: <20110211003500.GA2361@dakota.doc.ic.ac.uk>

Hi,

What you're seeing is [almost] the correct behaviour.  Sending a
mandatory/immediate message to a nonexistent queue (or a queue with no
consumers) is not considered an error, so the commit will succeed.  In
this case, the broker will however respond with a basic.return message
informing the client of the lost message.

Unfortunately, I don't think our C client has anyway of handling
basic.returns, so you're out of luck.

The other clients are all capable of handling basic.returns (and
publisher confirms if you're using 2.3.1), so you might want to consider
using one of them.  Have a look at this blogpost, it covers what you're
trying to achieve:
  http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/

Hope this helps.

Cheers,
Alex

On Thu, Feb 10, 2011 at 03:54:48PM -0700, Shane Head wrote:
> I know that publish is asynchronous, but from other threads I've read I thought that selecting the channel for a transaction, calling publish and then calling commit could be used to accomplish it.  I've tried doing this in my C code and have been unable to get it to work.  I'm using the amq.direct exchange and sending to a nonexistent queue using the mandatory and immediate flags.  It appears as though the message is being silently dropped by the server though.  I'm running rabbitmQ version 2.2.  Here is the code I'm using.  Please let me know of any errors there might be in my logic or code.  All I get is
> 
> [*] Sending some message
> 
> outputted when I run this.  I would expect to see the 'Error committingtx' print if the queue does not exist though.
> 
> int main(int argc, char *argv[])
> {
>     int rc;
>     int sockfd;
>     uint16_t channel = 1;
>     amqp_rpc_reply_t reply;
> 
>     amqp_connection_state_t conn = amqp_new_connection();
>     //Connect
>     sockfd = amqp_open_socket("localhost", 5672);
>     if (sockfd < 0)
>     {
>         printf("Error connecting to localhost:5672\n");
>         return 1;
>     }
>     amqp_set_sockfd(conn, sockfd);
>     amqp_login(conn, "/" /* vhost */, 0 /* channel_max */,
>                 131072 /* frame_max */, 0 /* heartbeat */,
>                 AMQP_SASL_METHOD_PLAIN, "guest", "guest");
> 
>     //Create a channel
>     amqp_channel_open(conn, channel);
> 
>     //Set up tx
>     amqp_tx_select(conn, channel);
>     reply = amqp_get_rpc_reply(conn);
>     if (reply.reply_type != AMQP_RESPONSE_NORMAL)
>     {
>         printf("Error selecting tx\n");
>         return 1;
>     }
> 
>     //Send  message
>     const char *message = "some message";
>     printf("[*] Sending %s\n", message);
>     amqp_basic_properties_t props;
>     memset(&props, 0x00, sizeof(props));
>     props.delivery_mode = 2; //persistent
> 
>     rc = amqp_basic_publish(conn, channel, amqp_cstring_bytes("amq.direct"),
>                             amqp_cstring_bytes("nonexistent_queue"), 1 /*mandatory*/,
>                             1 /*immediate*/, &props, amqp_cstring_bytes(message));
>     if (rc != 0)
>     {
>         char *errstr = amqp_error_string(-rc);
>         printf("Error publishing: %s\n", errstr);
>         free(errstr);
>     }
> 
>     //Now send commit and see if it worked
>     amqp_tx_commit(conn, channel);
>     reply = amqp_get_rpc_reply(conn);
>     if (reply.reply_type != AMQP_RESPONSE_NORMAL)
>     {
>         printf("Error committing tx\n");
>         return 1;
>     }
> 
>     reply = amqp_channel_close(conn, channel, AMQP_REPLY_SUCCESS);
>     if (reply.reply_type != AMQP_RESPONSE_NORMAL)
>     {
>         printf("Error closing channel\n");
>     }
>     amqp_connection_close(conn, AMQP_REPLY_SUCCESS);
>     amqp_destroy_connection(conn);
> 
>     return 0;
> }
> 
> Cheers,
> Shane
> 
> 
> 
> ***************
> This e-mail and any files transmitted with it may contain confidential and/or proprietary information. It is intended solely for the use of the individual or entity who is the intended recipient. Unauthorized use of this information is prohibited. If you have received this in error, please contact the sender by replying to this message and delete this material from any system it may be on.
> ***************

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexandru at rabbitmq.com  Fri Feb 11 00:45:48 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 11 Feb 2011 02:45:48 +0200
Subject: [rabbitmq-discuss] it correct way to creating consumer as an
 daemon thread?
In-Reply-To: <30870170.post@talk.nabble.com>
References: <30870170.post@talk.nabble.com>
Message-ID: <20110211004547.GB2361@dakota.doc.ic.ac.uk>

Hi,

That would work.  Alternatively, you could just subclass
QueueingConsumer or DefaultConsumer.  Doing this would give you more
fine-grained control over the connection.  For instance, if this is a
long running daemon, you should take into account connection failure, so
you'd need to override handleShutdownSignal.  Also, unless you
basicConsume with autoAck enabled, don't forget to ack the deliveries.

> consumer that are infinite run and
> poll queue where message are arrives.

That's not polling.  You could use basicGet instead of basicConsume.
*That* would be polling and it would be less efficient than consuming.
So, you're doing the right thing.

Cheers,
Alex

On Mon, Feb 07, 2011 at 08:15:25PM -0800, sam_mis wrote:
> 
> Hi
> 
> i am using Rabbitmq Java client library. consumer that are infinite run and
> poll queue where message are arrives.
> 
> 
>          boolean runInfinite = true;
>          while (runInfinite)
>           {
>                  QueueingConsumer.Delivery task;
>              try 
>                {
>                task= consumer.nextDelivery();
>                } 
>              catch (InterruptedException ie) 
>                {
>                continue;
>                }
>          }
> consumer infinitely run i want to make it daemon thread.it is correct way to
> make it daemon thread and there are other option.
> 
> Thanks
> 
> -- 
> View this message in context: http://old.nabble.com/it-correct-way-to-creating-consumer-as-an-daemon-thread--tp30870170p30870170.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Fri Feb 11 01:07:14 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 11 Feb 2011 03:07:14 +0200
Subject: [rabbitmq-discuss] disk space not released after persistent
 messages are consumed
In-Reply-To: <AANLkTikfrhX3wWMfwzRDLn3GDq+Ers+31tnuokONxT-i@mail.gmail.com>
References: <AANLkTikfrhX3wWMfwzRDLn3GDq+Ers+31tnuokONxT-i@mail.gmail.com>
Message-ID: <20110211010714.GC2361@dakota.doc.ic.ac.uk>

Hi,

> After running this code I end up with a 3MB file in the
> msg_store_persistent directory, even though rabbitmqctl list_queues
> shows 0 messages in the queue. After restarting RabbitMQ server that
> file grew by another 800KB. Any advice is greatly appreciated.

That's more or less expected.

The broker tries to write the messages to disk in files stored in that
directory.  The persister always has at least one file open and it will
append to it any new messages.  Since it only *appends* to the files,
even if the messages get delivered to consumers, they'll still be on
disk.  Normally, the persister will delete files that only contain stale
messages, but it won't do this to the file it's currently writing to.
When the current file exceeds msg_store_file_size_limit, it will start
on a new file.  At that point, if the old file doesn't have any more
messages, it will delete it.  The size limit is about 16 Mb by default,
so it's unsurprising that you have a 3 Mb file lying around.

You can set msg_store_file_size_limit in rabbitmq.config. 

Does this answer your question?

Cheers,
Alex

On Mon, Feb 07, 2011 at 05:27:07PM -0800, Jianing Hu wrote:
> Hi,
> 
> RabbitMQ newbie here so apologies in advance if what I'm doing is
> obviously wrong.
> 
> I'm experimenting with RabbigMQ 2.1.1 and it seems my persistent
> message storage file keeps growing despite of messages being consumed.
> Here's the code I used for testing. I'm using perl with Net::RabbitMQ
> 
>     use Net::RabbitMQ;
>     my $mq = Net::RabbitMQ->new();
>     $mq->connect("localhost", {
>         user => 'guest',
>         password => 'guest'
>     });
>     $mq->channel_open(1);
>     $mq->queue_declare(1, 'test', {
>         passive => 0,
>         durable => 1,
>         exclusive => 0,
>         auto_delete => 0
>     });
> 
>     my $data = 'foobar' x 200;
>     for (1..100000) {
>         $mq->publish(1, 'test', $data, {}, { delivery_mode => 2});
>     }
> 
>     $mq->consume(1, 'test', {
>         no_ack => 0
>     });
>     for (1..100000) {
>         my $msg = $mq->recv();
>         $mq->ack(1, $msg->{delivery_tag});
>     }
> 
> After running this code I end up with a 3MB file in the
> msg_store_persistent directory, even though rabbitmqctl list_queues
> shows 0 messages in the queue. After restarting RabbitMQ server that
> file grew by another 800KB. Any advice is greatly appreciated.
> 
> Thanks,
> - Jianing
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From bill.wannamaker at gmail.com  Fri Feb 11 08:47:08 2011
From: bill.wannamaker at gmail.com (Bill Wannamaker)
Date: Fri, 11 Feb 2011 00:47:08 -0800
Subject: [rabbitmq-discuss] Custom Routing?
Message-ID: <AANLkTik=hgSpUagHkUbseG5=hUicGsjQG+NDQ19JSoTD@mail.gmail.com>

Folks,

I'm new to AMQP and RabbitMQ and had some questions about how I should
go about modeling the following problem with exchanges and queues:

A. I have consumers with a routing tag (not unique -- multiple
   consumers may have the same routing tag)

B. Messages are enqueued with a routing tag.

C. Each message should be delivered only once to a consumer among the
   set of consumers for which the function

      canConsume?(consumerRoutingTag, messageRoutingTag)*

   is true.

* canConsume?(aTag, msgTag) = ((aTag & msgTag) == msgTag)


How do I go about configuring my exchange and queues? Do I...

1. Create a queue for each consumer and create a rabbit_exchange_type
   that only delivers to a queue for which canConsumer? is true

2. Create a queue for each consumerRoutingTag (multiple consumers can
   end up on the same queue) and create a rabbit_exchange_type that
   only delivers to a queue for which canConsumer? is true

3. Have a single queue and then somehow scan each consumer for which
   canConsumer? is true for each incoming message and then deliver to
   that consumer?


I would appreciate any guidance here on how to route messages most
effectively to consumers given the above scenario. Further, if I write
my own rabbit_exchange_type, is there support in RabbitMQ for helping
me fairly distribute messages across the candidate lists? Would the
rabbit_exchange_type be the same as

https://github.com/rabbitmq/rabbitmq-external-exchange

Thanks a bunch!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110211/290c22e5/attachment.htm>

From underattack7 at googlemail.com  Fri Feb 11 09:57:19 2011
From: underattack7 at googlemail.com (underattack7)
Date: Fri, 11 Feb 2011 09:57:19 +0000
Subject: [rabbitmq-discuss] rabbitmq-c: how to catch a broken pipe with
 the rabbitmq server
In-Reply-To: <487996.61630.qm@web31803.mail.mud.yahoo.com>
References: <AANLkTimr5OF_2NDjOGsMWWAv7eLmazgZu5mKaYTUttQE@mail.gmail.com>
	<yrv4c1v3fhl11.fsf@dwragg.eng.vmware.com>
	<487996.61630.qm@web31803.mail.mud.yahoo.com>
Message-ID: <AANLkTikqG5Q2Mdj14WusVmo6XdrFtKpacbXmZJf3f5z+@mail.gmail.com>

Thanks for this info.

Fab

On 10 February 2011 20:02, alex chen <chen650 at yahoo.com> wrote:

> we ran into the same problem before.  the workaround was to ignore SIGPIPE
> using:
>    signal(SIGPIPE, SIG_IGN);
>
> from the man page for "write":*
> EPIPE**
> fd* is connected to a pipe or socket whose reading end is closed. When
> this happens the writing process will also receive a *SIGPIPE* signal.
> (Thus, the write return value is seen only if the program catches, blocks or
> ignores this signal.)
>
> -alex
>
>
> ------------------------------
> *From:* David Wragg <david at rabbitmq.com>
> *To:* underattack7 <underattack7 at googlemail.com>
> *Cc:* rabbitmq-discuss <rabbitmq-discuss at lists.rabbitmq.com>
> *Sent:* Thu, February 10, 2011 9:11:38 AM
> *Subject:* Re: [rabbitmq-discuss] rabbitmq-c: how to catch a broken pipe
> with the rabbitmq server
>
> Hi,
>
> underattack7 <underattack7 at googlemail.com> writes:
> > I am using the rabbitmq-c C libraries to publish messages to a Rabbitmq
> > exchange.
> >
> > Problem I have is that when rabbitmq server stops for some reason
> > (rabbtmqctl stop_app / start_app for instance), the socket between my
> > publisher program and rabbitmq is destroyed but I don't manage to catch
> any
> > error code properly so that the program can try to establish a new
> > connection.
> >
> > When I stop rabbitmq, my publisher program exits with the message:
> "Broken
> > Pipe" when it tries to send a message.
>
> Sounds like a bug.  What platform are you on?
>
> > Is there a way to check the socket before sending a message so that I can
> > try to re-establish a connection ?
> >
> > The way I publish is :
> >
> > rc = amqp_basic_publish(amqp_connection, 1,
> amqp_cstring_bytes("Exchange"),
> > amqp_cstring_bytes(routingkey), 0, 0, NULL, body);
> >
> > if (rc < 0)  {
> >    printf("error during publish : %s\n", strerror(-rc)) ;
> >  }
>
> You should be using "amqp_error_string(-rc)" there, not strerror.
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110211/853bb5cc/attachment.htm>

From simon at rabbitmq.com  Fri Feb 11 10:29:11 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 11 Feb 2011 10:29:11 +0000
Subject: [rabbitmq-discuss] rabbitmq-auth-mechanism-ssl plugin, TCP,
 SASL EXTERNAL
In-Reply-To: <083D5377F8EC294D884D590409EFE70D7113956550@MAIL02.austin.utexas.edu>
References: <083D5377F8EC294D884D590409EFE70D7113956550@MAIL02.austin.utexas.edu>
Message-ID: <4D550F77.2090203@rabbitmq.com>

On 10/02/11 23:45, Warren Smith wrote:
> To make a long story short: Should RabbitMQ be offering SASL EXTERNAL
> when the client connects using TCP (without SSL)? Or is it doing this
> because I?ve made a configuration mistake?

Hmm. That's by design, sort of. The idea is that the server always 
announces the same mechanisms. That may not be ideal, as you've noted.

>  I worked
> around this when using the Java client by creating a class that
> implements SaslConfig that only specifies PLAIN and setSaslConfig() to
> this on the ConnectionFactory.

That sounds like the best thing to do ATM.

I'll have a think about this and see if we can prevent EXTERNAL from 
being announced on non-SSL connections.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Fri Feb 11 10:34:16 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 11 Feb 2011 10:34:16 +0000
Subject: [rabbitmq-discuss] JSON-RPC reference?
In-Reply-To: <AANLkTimMf4uuCVaOpmeEDzrXgdEkWv2qKsva9s1GneBm@mail.gmail.com>
References: <AANLkTinX7sboOrht3QTYtMmCcU_FA_52dK6T_ocmVoOm@mail.gmail.com>
	<AANLkTin7jqAaW005DaRmP_NYiwwejKo-rOzsq=-4UV36@mail.gmail.com>
	<AANLkTinZjv1dUUAKd-SDOC7=JvvhM00VAQVko0XevT5z@mail.gmail.com>
	<AANLkTi=Hf9ky7v7Lavw_Q3LoaaXq_TPVRr+XJYPha8JA@mail.gmail.com>
	<4D5021DF.9000806@rabbitmq.com>
	<AANLkTimMf4uuCVaOpmeEDzrXgdEkWv2qKsva9s1GneBm@mail.gmail.com>
Message-ID: <4D5510A8.3040107@rabbitmq.com>

On 07/02/11 19:58, Brian Jones wrote:
> What are the statistics based on? I'd be slow to trust download numbers
> since it's not currently practical to evaluate it for suitability
> without downloading the source.

You have a point. But download numbers are the only way we have to gauge 
the popularity of plugins, tempting as it is to make them all phone home :)

I was going off downloads of the binaries, which are hopefully slightly 
more correlated with actual use.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Fri Feb 11 10:38:56 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 11 Feb 2011 10:38:56 +0000
Subject: [rabbitmq-discuss] Web server error
In-Reply-To: <AANLkTinJ=qUY8dFK8O-OE_CmkgNGgkO5pNVf5n3vZ3NQ@mail.gmail.com>
References: <AANLkTinJ=qUY8dFK8O-OE_CmkgNGgkO5pNVf5n3vZ3NQ@mail.gmail.com>
Message-ID: <4D5511C0.3070505@rabbitmq.com>

On 10/02/11 13:43, Torsten W. Hansen wrote:
> I have installed RabbitMQ and Erlang on a computer with Windows 7 home
> edition for testing purposes. I have also installed the plug-ins needed
> for the web monitor service.
>
> When I enter localhost:55672 in my browser I get the following message
> returned:
<snip>

Hi Torsten. For whatever reason, the management plugin is not installing 
its contexts into rabbitmq-mochiweb. Can you tell me:

* Exactly which plugins are installed
* Which versions of RabbitMQ and Erlang you're using
* Is there anything at looks like an error in the server logs?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Fri Feb 11 10:47:21 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 11 Feb 2011 10:47:21 +0000
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
In-Reply-To: <4D51392F.8000508@telecom-sudparis.eu>
References: <4D51392F.8000508@telecom-sudparis.eu>
Message-ID: <4D5513B9.1010202@rabbitmq.com>

Hi Denis.

On 08/02/11 12:38, Denis Conan wrote:
> my objective is to run the Java Client on Android.
>
> Do not hesitate to tell me if I started off with the wrong idea.

That's... not unreasonable. We don't guarantee that the Java client will 
run on Android (in particular we don't test it).

> I didn't see any specific release for Android. So, I took the Java
> Client for J2SE. I was able to adapt the previous version 2.2.0 of the
> Java Client for running on Android: removal of packages json and
> jsonrpc, and correct a call to super in the constructor of the class
> PossibleAuthenticationFailureException.

Ironically I think that might be fixed in 2.3.1 (it was also 
incompatible with Java 1.5).

> As I see, the new version 2.3.1 now has authentication with SASL.
> Unfortunately, there is no package javax.security.sasl in Android JRE.
> So, I tried to manage this lack by replacing the classes of this package
> by the ones in aSMACK (http://code.google.com/p/asmack/). The
> compilation is ok, but the execution throws the following exception.

...but it would be a pity if the introduction of more SASL mechanisms 
were to make it unusable on Android.

> java.io.IOException: No compatible authentication mechanism found -
> server offered [PLAIN AMQPLAIN]

So whatever SASL implementation you've cooked up somehow does not 
support PLAIN (I would not expect it to support AMQPLAIN).

This seems odd, as it looks like Smack contains support for PLAIN:

http://code.google.com/p/asmack/source/browse/src/custom/de/measite/smack/SaslClientFactory.java

If you can't get this working, then you can of course stick with the 
2.2.0 client and an upgraded server. But being stuck with an old client 
isn't fun, so I'll have a think about how easy it would be to patch the 
old homebrew SASL back in for Android.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Fri Feb 11 11:15:42 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 11 Feb 2011 11:15:42 +0000
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
In-Reply-To: <4D5513B9.1010202@rabbitmq.com>
References: <4D51392F.8000508@telecom-sudparis.eu>
	<4D5513B9.1010202@rabbitmq.com>
Message-ID: <4D551A5E.2050804@rabbitmq.com>

On 11/02/11 10:47, Simon MacMullen wrote:
> If you can't get this working, then you can of course stick with the
> 2.2.0 client and an upgraded server. But being stuck with an old client
> isn't fun, so I'll have a think about how easy it would be to patch the
> old homebrew SASL back in for Android.

Attached is a minimal patch to remove javax.security.sasl from 2.3.1's 
AMQConnection.java and do PLAIN by hand. Any other class that imports 
javax.security.sasl can just be deleted.

I haven't tested this on Android, and it will blow up if the server has 
PLAIN disabled, but it may help you.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

-------------- next part --------------
A non-text attachment was scrubbed...
Name: unsasl.patch
Type: text/x-patch
Size: 2817 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110211/10a7916e/attachment.bin>

From simon at rabbitmq.com  Fri Feb 11 11:32:01 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 11 Feb 2011 11:32:01 +0000
Subject: [rabbitmq-discuss] Web server error
In-Reply-To: <AANLkTimbVYwbSeM7ioNpqmmXp9fSd7fL-OaJt_4qN8mr@mail.gmail.com>
References: <AANLkTinJ=qUY8dFK8O-OE_CmkgNGgkO5pNVf5n3vZ3NQ@mail.gmail.com>	<4D5511C0.3070505@rabbitmq.com>
	<AANLkTimbVYwbSeM7ioNpqmmXp9fSd7fL-OaJt_4qN8mr@mail.gmail.com>
Message-ID: <4D551E31.7000108@rabbitmq.com>

On 11/02/11 11:20, Torsten W. Hansen wrote:
> Hi Simon,
>
> Thanks for getting back to me.

No problem. Please keep rabbitmq-discuss CCed so that other people can 
learn too.

> I have a snapshot of the plugins installed.

So you have the plugins installed for rabbitmq-jsonrpc-channel. From 
your previous mail it sounded like you wanted the management plugin? If 
so, please install:

webmachine-2.3.1.ez
rabbitmq-management-2.3.1.ez
rabbitmq-management-agent-2.3.1.ez

Alternatively if you wanted rabbitmq-jsonrpc-channel, you should be 
aware that out of the box it doesn't do much, but if you install 
rabbitmq-jsonrpc-channel-examples-2.3.1.ez you can see some example apps.

 > I don't find any logs.

They should be in %APPDATA%\RabbitMQ\logs on Windows, but I don't think 
that's needed now.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Fri Feb 11 11:49:21 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 11 Feb 2011 11:49:21 +0000
Subject: [rabbitmq-discuss] Another Use-case?
In-Reply-To: <AANLkTi==YRq+qPcxrgHOwCbX6bp2FCqeReuN5KcoJrQV@mail.gmail.com>
References: <AANLkTi==YRq+qPcxrgHOwCbX6bp2FCqeReuN5KcoJrQV@mail.gmail.com>
Message-ID: <AANLkTinrsc=QJd4TqcHHmGh9g2ELwDpjAgP444d_GZS8@mail.gmail.com>

On Wed, Feb 9, 2011 at 15:06, Olle Jonsson <olle.jonsson at gmail.com> wrote:
> Would Facebook's Real-time updates be a typical AMQP job?
> Sample PHP callback to that API
>
> My question: Would it be good and AMQP-like to have that callback.php?file
> (aka "the end-point") enqueue messages instead of working on them?
> best regards from the sidelines,

I guess you could just do the work in 'callback.php'.
I'm not sure what guarantees does the facebook give you
but it seems probable to receive two updates relating to the
same object (user) at the same time.

If your app doesn't take that into account, you may end up
in having a race condition between those two requests.

To make sure you process only one update at a time
you could serialize them - RabbitMQ queue is
a perfect choice for that.

The other advantage of offloading work to rabbit, is that
on facebook update you may want to query facebook
API to receive updated details. That may take some time
and you don't want any blocking in code to run inside
a web server (like apache+php).

Cheers,
  Marek

From rob at rabbitmq.com  Fri Feb 11 13:16:25 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 11 Feb 2011 13:16:25 +0000
Subject: [rabbitmq-discuss] rabbitmq-stomp adapter tweaks
In-Reply-To: <82106507-d30b-410b-b842-afe0a7e1a276@33g2000pru.googlegroups.com>
References: <82106507-d30b-410b-b842-afe0a7e1a276@33g2000pru.googlegroups.com>
Message-ID: <cd6a9c0f35decd2acab7355f8d9cbcc0@rabbitmq.com>

The easiest way to do this is to tweak the reader so that it fires off
the CONNECT frame to the processor once the TCP connection is
established.

This means that changes to the processor internals won't affect your
patch. I got this working with the attached patch.

Hope this helps,

Rob

On Wed, 2 Feb 2011 01:48:04 -0800 (PST), SonicSNES <dis1 at sonicsnes.net>
wrote:
> I've been moving around a bunch of code in rabbitmq-stomp to tailor it
> specifically for my app, and hit one tiny roadblock which is
> preventing me from finishing.
> 
> How would I go about bypassing the login sequence, so the client gets
> a CONNECTED as soon as it connects? I'm trying to call do_login from
> init, but my with limited erlang skills, all I can get it to do is
> hang, time out, or catch on fire. I'd assume it's just a tiny bit of
> code, but I'm stumped.
> 
> -- SS
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
diff -r 18a5ff568af9 src/rabbit_stomp_reader.erl
--- a/src/rabbit_stomp_reader.erl	Fri Feb 11 12:19:45 2011 +0000
+++ b/src/rabbit_stomp_reader.erl	Fri Feb 11 13:15:50 2011 +0000
@@ -49,6 +49,13 @@
             PeerAddressS = inet_parse:ntoa(PeerAddress),
             error_logger:info_msg("starting STOMP connection ~p from ~s:~p~n",
                                   [self(), PeerAddressS, PeerPort]),
+
+            %% Send CONNECT frame automatically
+            ConnectFrame = #stomp_frame{command = "CONNECT",
+                                        headers = [{"login", "guest"},
+                                                   {"passcode", "guest"}]},
+            rabbit_stomp_processor:process_frame(ProcessorPid, ConnectFrame),
+
             ParseState = rabbit_stomp_frame:initial_state(),
             try
                 ?MODULE:mainloop(#reader_state{socket        = Sock,

From adam.rosenberger1 at gmail.com  Fri Feb 11 15:18:32 2011
From: adam.rosenberger1 at gmail.com (Adam Rosenberger)
Date: Fri, 11 Feb 2011 09:18:32 -0600
Subject: [rabbitmq-discuss] C# Request Reply Question
Message-ID: <AANLkTinYcBwrdWEQE9Skor9fcG0tMPcpbdJgx_7XQ01S@mail.gmail.com>

Hello,

I created a simple request reply example by deriving from SimpleRpcServer
and using SimpleRpcClient. Based on the pattern from the c# examples, I used
the same queue name for both the client and server.

This worked well; however, the website example in python uses a separate
request and reply queue, which makes more sense to me. I looked at
Subscription and a couple other classes in reflector but didn't find
anything obvious.

Can anyone provide any insight as to why the c# example uses the same queue
on both sides as opposed to the python example in the getting started
section?

Thanks,
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110211/b71df985/attachment.htm>

From bmurphy1976 at gmail.com  Fri Feb 11 18:32:12 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Fri, 11 Feb 2011 12:32:12 -0600
Subject: [rabbitmq-discuss] C# Request Reply Question
In-Reply-To: <AANLkTinYcBwrdWEQE9Skor9fcG0tMPcpbdJgx_7XQ01S@mail.gmail.com>
References: <AANLkTinYcBwrdWEQE9Skor9fcG0tMPcpbdJgx_7XQ01S@mail.gmail.com>
Message-ID: <AANLkTi=TxDKPHfLsCwzjeAVcDYnU94G2u99CaYbRUWhv@mail.gmail.com>

On Fri, Feb 11, 2011 at 9:18 AM, Adam Rosenberger
<adam.rosenberger1 at gmail.com> wrote:
> I created a simple request reply example by deriving from SimpleRpcServer and using SimpleRpcClient. Based on the pattern from the c# examples, I used the same queue name for both the client and server.
>
> This worked well; however, the website example in python uses a separate request and reply queue, which makes more sense to me. I looked at Subscription and a couple other classes in reflector but didn't find anything obvious.
>
> Can anyone provide any insight as to why the c# example uses the same queue on both sides as opposed to the python example in the getting started section?
>
> Thanks,
> Adam

I haven't looked at the samples in a long time, and you didn't provide
any of your code.? I find it odd that you would send a response using
the same queue name.? Usually you would send the response message back
to the sender directly using the sender's reply address.  This is the
code I use to respond to a sender:

// Get sender address
var replyAddress = PublicationAddress.Parse(request.BasicProperties.ReplyTo);

// Don't remember if this is necessary, but it was in my code
if (replyAddress == null)
  replyAddress = new PublicationAddress(
    ExchangeType.Direct, "", request.BasicProperties.ReplyTo);

// Reply to sender
model.BasicPublish(replyAddress, basicProperties, data);

Bryan

From bmurphy1976 at gmail.com  Fri Feb 11 18:37:56 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Fri, 11 Feb 2011 12:37:56 -0600
Subject: [rabbitmq-discuss] Strategy for consuming queues and ordering
In-Reply-To: <AANLkTinxqC6WLvsTk=ntdbrWRhum8KHHufjp1Beq5Mt9@mail.gmail.com>
References: <AANLkTimkk1cCojwsf3q5v27O-yUWft3tXcssVm6mVP_X@mail.gmail.com>
	<AANLkTinxqC6WLvsTk=ntdbrWRhum8KHHufjp1Beq5Mt9@mail.gmail.com>
Message-ID: <AANLkTik98C7CZhHJ5biMyey06x2h3=kORivHCvr43S78@mail.gmail.com>

On Thu, Feb 10, 2011 at 3:55 AM, Robert Raschke <rtrlists at googlemail.com> wrote:
>> Can anyone tell me how to deal with queues that contain messages that
>> are higly recommended by business logic to be ordered?

snip

> Whenever I hear about the problem of the required order of messages having
> to be preserved, I start to wonder if the problem at hand is really best
> suited to messaging. Could it be that you might be better served by
> something like a (normal) work queue?
>
> If you require things to be done in a certain order, then you need to have a
> place to actually keep them in that order. Messaging isn't the place to do
> this.

I agree.  If it needs to absolutely be in order, we put the message in
a database transactionally and then send a "hey something changed go
look at the database" message.

Bryan

From max.bridgewater at gmail.com  Sat Feb 12 02:45:12 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Fri, 11 Feb 2011 21:45:12 -0500
Subject: [rabbitmq-discuss] Are Exchanges really necessary?
Message-ID: <AANLkTinTNCDzkVfPEHFzC0+n3TeCrOK+bxfa6KbEXNqq@mail.gmail.com>

Hi,

It's very likely that I don't really understand the concept of
exchange. So please bear with me. Say I bind the queue with routing
key "WashingtonPost" to the topic exchange "politics" using pattern
"africa.egypt.#". Now if we get rid of the concept of exchange.
Wouldn't this be equivalent to binding the "WashingtonPost" to the
pattern "politics.africa.egypt.#"?

What am I missing that makes the exchange paradigm so necessary in AMQP?

Thanks,
Max.

From rajitha33 at yahoo.com  Sat Feb 12 07:01:34 2011
From: rajitha33 at yahoo.com (Rajitha Jayawickrama)
Date: Fri, 11 Feb 2011 23:01:34 -0800 (PST)
Subject: [rabbitmq-discuss] USP of RabbitMQ
Message-ID: <401602.12963.qm@web32803.mail.mud.yahoo.com>

Hi,
?
I'm a Software Architect of a software development company and we run our own 
product (E-Learning System) for Educational domain and we have large number of 
Asian Universities as our client base.
?
We are looking for a highly reliable messaging system for our software product 
and I would like to know what is Unique Selling Point of RabbitMQ and why it 
could be one of the best options for messaging, compared with other commercial 
Messaging Systems?
?
Thanks,
Rajitha


      

From rajitha33 at gmail.com  Sat Feb 12 07:04:58 2011
From: rajitha33 at gmail.com (Romesh)
Date: Fri, 11 Feb 2011 23:04:58 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Vs other competitors
Message-ID: <c9e9bc46-71ad-4a38-8a85-5e099951ee3c@8g2000prb.googlegroups.com>

Hi,

I would like to know what is Unique Selling Point of RabbitMQ and why
it could be one of the best options for messaging, compared with other
commercial Messaging Systems?

Thanks


From ciprian.craciun at gmail.com  Sat Feb 12 18:14:05 2011
From: ciprian.craciun at gmail.com (Ciprian Dorin Craciun)
Date: Sat, 12 Feb 2011 20:14:05 +0200
Subject: [rabbitmq-discuss] Are Exchanges really necessary?
In-Reply-To: <AANLkTinTNCDzkVfPEHFzC0+n3TeCrOK+bxfa6KbEXNqq@mail.gmail.com>
References: <AANLkTinTNCDzkVfPEHFzC0+n3TeCrOK+bxfa6KbEXNqq@mail.gmail.com>
Message-ID: <AANLkTimrFqAiBojT+92xL01TiBsi_t0Y=j1CO+dS_q60@mail.gmail.com>

On Sat, Feb 12, 2011 at 04:45, Max Bridgewater
<max.bridgewater at gmail.com> wrote:
> Hi,
>
> It's very likely that I don't really understand the concept of
> exchange. So please bear with me. Say I bind the queue with routing
> key "WashingtonPost" to the topic exchange "politics" using pattern
> "africa.egypt.#". Now if we get rid of the concept of exchange.
> Wouldn't this be equivalent to binding the "WashingtonPost" to the
> pattern "politics.africa.egypt.#"?
>
> What am I missing that makes the exchange paradigm so necessary in AMQP?
>
> Thanks,
> Max.


    Although I can't provide a direct answer to your question, I would
say that at least from a security point of view, exchanges are very
useful as they allow me to explicitly allow / disallow which users can
either post or consume messages. (It is impossible to use ACL's on
routing keys.)

    For example if I would to replace D-Bus with AMQP, only anyone
could subscribe to the "os.control" exchange (both the control daemon
but also interested users / applications), but only an OS operator
could publish messages to that particular exchange to for example
reboot the OS.

    Further more, exchanges determine how routing is done -- some
based on the routing key, others based on headers -- and in recent
versions of RabbitMQ (2.2.0?) you can bind exchanges to exchanges,
thus offering you a poor-man AND / OR operators.

    I hope others could provide you with a better / more to the point answer.

    Ciprian.

From gmr at myyearbook.com  Sat Feb 12 21:50:52 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sat, 12 Feb 2011 16:50:52 -0500
Subject: [rabbitmq-discuss] Pika v0.9.3 Released
Message-ID: <AANLkTi=rkkniGd_ev4rD_yS9u8eCtuYAZjQ-cUxHRsmD@mail.gmail.com>

This is mainly a bugfix released focusing on the
adapters.blocking_connection and pika.log modules. All users using 0.9.1 or
higher are recommended to upgrade to this version.

Download:

  http://pypi.python.org/packages/source/p/pika/pika-v0.9.3.tar.gz
  MD5 File Signature: 2446b25d8cdca825d29af18fb50460c9

Installation:

  Install via pip or easy_install with the package name of pika.

Documentation:

http://tonyg.github.com/pika/

Changelog:

* Python 2.7 added to test runner
* BlockingChannelTransport.rpc method now returns response frame when
received.
* BlockingChannelTransport.send_method now looks to an object wide wait
variable while processing events
* BlockingChannel.basic_consume now waits inside the function
BlockingChannel.stop_consuming is called
* BlockingChannel._on_consume_ok removed
* pika.log refactored to use logging.getLogger('pika') - Thanks Kamil Kisiel
* Added @method_call decorator method to pika.log, all logging.debug
statements in pika where it was tracking the call
  of a method have been removed and the @pika.log.method_call decorator has
been put in place for those
  methods
* Added setup and FormatOutput to pika.log. Allows for color debug output on
console.
* See http://tonyg.github.com/pika/log for an overview on new pika.log
module behavior.
* Documentation _build directory content removed from git and distribution
tarball
* pika.object _repr_ format is now wrapped in <>
* Documentation cleanup and fixes
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110212/170f0ff2/attachment.htm>

From nmthien at gmail.com  Sat Feb 12 23:28:43 2011
From: nmthien at gmail.com (Thien Nguyen Minh)
Date: Sat, 12 Feb 2011 17:28:43 -0600
Subject: [rabbitmq-discuss] speed limit on a queue
Message-ID: <AANLkTi=KcOhSwkuXUTMLJ3c02m9KSGv_cLZZjUAg5WhR@mail.gmail.com>

Hi,

I'm doing a test on the speed of retrieving message out of a queue. With 1
consumer, the speed is around 20 msg / s. When I increase the number of
consumers (hosted on different machines) to 10, the speed is 90 msg / s. The
speed doesn't change much when I use 10 consumers on the same queue. So is
there a limit on the speed of retrieving message from a queue?

Thanks,

Thien.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110212/93412a7a/attachment.htm>

From max.bridgewater at gmail.com  Sun Feb 13 01:30:48 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Sat, 12 Feb 2011 20:30:48 -0500
Subject: [rabbitmq-discuss] queueDeclarePassive Shutting down the channel
Message-ID: <AANLkTimQGbKOjS=J_VezeTA0291vpS2Y06ZhSUr_1Vs=@mail.gmail.com>

Hi,

I'm using the Java client and I notice that  queueDeclarePassive()
shuts down the channel if no queue exists with the specified name. I'm
not sure if I'm doing something wrong or this is how this is supposed
to behave. Here is my code; please advise.

public class QueuePassiveDeclare {
	
	public static void main(String[] argv) throws Exception {
		String host = "localhost";
		String vhost = "MyVHost";
		String user = "guest";
		String name = "myQueue";

		ConnectionFactory factory = new ConnectionFactory();
		factory.setHost(host);
		factory.setPassword(user);
		factory.setUsername(user);
		factory.setVirtualHost(vhost);
		Connection conn = factory.newConnection();
		Channel chan = conn.createChannel();
		chan.queueDeclarePassive(name);

	}
}

Thanks,
Max.

From alexandru at rabbitmq.com  Sun Feb 13 01:49:43 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Sun, 13 Feb 2011 03:49:43 +0200
Subject: [rabbitmq-discuss] queueDeclarePassive Shutting down the channel
In-Reply-To: <AANLkTimQGbKOjS=J_VezeTA0291vpS2Y06ZhSUr_1Vs=@mail.gmail.com>
References: <AANLkTimQGbKOjS=J_VezeTA0291vpS2Y06ZhSUr_1Vs=@mail.gmail.com>
Message-ID: <20110213014943.GA2358@dakota>

Hi Max,

Attempting to declare a non existent queue (even if you do so passively)
causes a not-found exception, which is a soft-error that takes down the
channel.

If you really want to use *declarePassive, you should wrap it in a
try...catch and handle the exception somehow.

As a rule, you shouldn't need to use *declarePassive.  The *declare
operations are idempotent, so you'd normally just declare the resource
before using it (i.e. open channel, declare the queue, publish to it,
close channel).

Cheers,
Alex

On Sat, Feb 12, 2011 at 08:30:48PM -0500, Max Bridgewater wrote:
> Hi,
> 
> I'm using the Java client and I notice that  queueDeclarePassive()
> shuts down the channel if no queue exists with the specified name. I'm
> not sure if I'm doing something wrong or this is how this is supposed
> to behave. Here is my code; please advise.
> 
> public class QueuePassiveDeclare {
> 	
> 	public static void main(String[] argv) throws Exception {
> 		String host = "localhost";
> 		String vhost = "MyVHost";
> 		String user = "guest";
> 		String name = "myQueue";
> 
> 		ConnectionFactory factory = new ConnectionFactory();
> 		factory.setHost(host);
> 		factory.setPassword(user);
> 		factory.setUsername(user);
> 		factory.setVirtualHost(vhost);
> 		Connection conn = factory.newConnection();
> 		Channel chan = conn.createChannel();
> 		chan.queueDeclarePassive(name);
> 
> 	}
> }
> 
> Thanks,
> Max.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexis at rabbitmq.com  Sun Feb 13 20:26:56 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sun, 13 Feb 2011 20:26:56 +0000
Subject: [rabbitmq-discuss] Custom Routing?
In-Reply-To: <AANLkTik=hgSpUagHkUbseG5=hUicGsjQG+NDQ19JSoTD@mail.gmail.com>
References: <AANLkTik=hgSpUagHkUbseG5=hUicGsjQG+NDQ19JSoTD@mail.gmail.com>
Message-ID: <AANLkTimg3S=21KCCz53VAe3aQ-qQeBJrPvuP28h1Z7Vp@mail.gmail.com>

Bill

IIUC you are talking about this case:
http://www.rabbitmq.com/tutorial-three-python.html  In this instance
you would use (1) in your list below. Does that make sense?  Let me
know if I have misunderstood.

Note: in your (C) your phrase "only once" opens a potential can of
worms.  Please do feel free to describe your use case in more detail
if the above proves helpful.

alexis


On Fri, Feb 11, 2011 at 8:47 AM, Bill Wannamaker
<bill.wannamaker at gmail.com> wrote:
> Folks,
> I'm new to AMQP and RabbitMQ and had some questions about how I should
> go about modeling the following problem with exchanges and queues:
> A. I have consumers with a routing tag (not unique -- multiple
> ?? consumers may have the same routing tag)
> B. Messages are enqueued with a routing tag.
> C. Each message should be delivered only once to a consumer among the
> ?? set of consumers for which the function
>
> ?? ? ?canConsume?(consumerRoutingTag, messageRoutingTag)*
> ?? is true.
> * canConsume?(aTag, msgTag) = ((aTag & msgTag) == msgTag)
>
> How do I go about configuring my exchange and queues? Do I...
> 1. Create a queue for each consumer and create a rabbit_exchange_type
> ?? that only delivers to a queue for which canConsumer? is true
> 2. Create a queue for each consumerRoutingTag (multiple consumers can
> ?? end up on the same queue) and create a rabbit_exchange_type that
> ?? only delivers to a queue for which canConsumer? is true
> 3. Have a single queue and then somehow scan each consumer for which
> ?? canConsumer? is true for each incoming message and then deliver to
> ?? that consumer?
>
> I would appreciate any guidance here on how to?route messages most
> effectively to consumers given the above?scenario. Further, if I write
> my own rabbit_exchange_type, is there?support in RabbitMQ for helping
> me fairly distribute messages across?the candidate lists? Would the
> rabbit_exchange_type be the same as
>
> https://github.com/rabbitmq/rabbitmq-external-exchange
> Thanks a bunch!
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From alexis at rabbitmq.com  Sun Feb 13 20:32:54 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sun, 13 Feb 2011 20:32:54 +0000
Subject: [rabbitmq-discuss] speed limit on a queue
In-Reply-To: <AANLkTi=KcOhSwkuXUTMLJ3c02m9KSGv_cLZZjUAg5WhR@mail.gmail.com>
References: <AANLkTi=KcOhSwkuXUTMLJ3c02m9KSGv_cLZZjUAg5WhR@mail.gmail.com>
Message-ID: <AANLkTimz-K8x6v2GaK90XrU1GtX5YCmMcBbbw0Z1T6mr@mail.gmail.com>

Thien

The RabbitMQ server can handle much higher rates than that, so perhaps
your current limit is due to how you have set up your client.

In principle, speed may be limited by many other things too.  For
example if you require messages to be saved to disk in a reliable
manner, the disk write will take time, and this depends on your
hardware and other things about your set-up.

alexis



On Sat, Feb 12, 2011 at 11:28 PM, Thien Nguyen Minh <nmthien at gmail.com> wrote:
> Hi,
> I'm doing a test on the speed of retrieving message out of a queue. With 1
> consumer, the speed is around 20 msg / s. When I increase the number of
> consumers (hosted on different machines) to 10, the speed is 90 msg / s. The
> speed doesn't change much when I use 10 consumers on the same queue. So is
> there a limit on the speed of retrieving message from a queue?
> Thanks,
> Thien.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From james.r.carr at gmail.com  Sun Feb 13 21:18:09 2011
From: james.r.carr at gmail.com (James Carr)
Date: Sun, 13 Feb 2011 16:18:09 -0500
Subject: [rabbitmq-discuss] Custom Routing?
In-Reply-To: <AANLkTik=hgSpUagHkUbseG5=hUicGsjQG+NDQ19JSoTD@mail.gmail.com>
References: <AANLkTik=hgSpUagHkUbseG5=hUicGsjQG+NDQ19JSoTD@mail.gmail.com>
Message-ID: <AANLkTinngkSxH4xb2uVDSVcK6+p+Ww4_eRAboSjHKwpJ@mail.gmail.com>

I gave a rabbitMQ presentation recently and thought my solution to
"custom" routing was a pretty good approach. Essentially it takes
advantage of the DynamicRouter pattern from EIP. A consumer decides it
wants to be notified of data that meets a certain criteria beyond what
one can accomplish with routing keys and sends a command message that
contains that criteria and a routing key it'd like messages that meet
that criteria to be published on. On the publish side it evaluates
each message using the criteria and publishes any matches.

Just thought I'd point it out in case it might be helpful.


Thanks,
James

On Fri, Feb 11, 2011 at 3:47 AM, Bill Wannamaker
<bill.wannamaker at gmail.com> wrote:
> Folks,
> I'm new to AMQP and RabbitMQ and had some questions about how I should
> go about modeling the following problem with exchanges and queues:
> A. I have consumers with a routing tag (not unique -- multiple
> ?? consumers may have the same routing tag)
> B. Messages are enqueued with a routing tag.
> C. Each message should be delivered only once to a consumer among the
> ?? set of consumers for which the function
>
> ?? ? ?canConsume?(consumerRoutingTag, messageRoutingTag)*
> ?? is true.
> * canConsume?(aTag, msgTag) = ((aTag & msgTag) == msgTag)
>
> How do I go about configuring my exchange and queues? Do I...
> 1. Create a queue for each consumer and create a rabbit_exchange_type
> ?? that only delivers to a queue for which canConsumer? is true
> 2. Create a queue for each consumerRoutingTag (multiple consumers can
> ?? end up on the same queue) and create a rabbit_exchange_type that
> ?? only delivers to a queue for which canConsumer? is true
> 3. Have a single queue and then somehow scan each consumer for which
> ?? canConsumer? is true for each incoming message and then deliver to
> ?? that consumer?
>
> I would appreciate any guidance here on how to?route messages most
> effectively to consumers given the above?scenario. Further, if I write
> my own rabbit_exchange_type, is there?support in RabbitMQ for helping
> me fairly distribute messages across?the candidate lists? Would the
> rabbit_exchange_type be the same as
>
> https://github.com/rabbitmq/rabbitmq-external-exchange
> Thanks a bunch!
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From br at versly.com  Mon Feb 14 07:23:56 2011
From: br at versly.com (Benjamin Renaud)
Date: Sun, 13 Feb 2011 23:23:56 -0800
Subject: [rabbitmq-discuss] Custom authentication and authorization
Message-ID: <AANLkTiki6408cQpxpOYSbaLyrKGhURQVzUX7YgdYs6Av@mail.gmail.com>

Hi Everyone,

I've started reading on Rabbit MQ's plugin's and the custom auth, but I
wanted to check with the list before I launched into implementing our
solution.

We run RabbitMQ over the public Internet (.NET clients talking to an EC2
cloud). On subscription, we'd like to run an authentication/authorization
process, which would query our user server for auth/auth via REST. From what
I gather, the right way to do this is to write a plugin for Rabbit, perhaps
starting from an existing plugin as a starting point?

Thanks for any pointers,
Benjamin




-- 
ben renaud
versly.com
br at versly.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110213/9ed9172a/attachment.htm>

From isaias at madiva.com  Mon Feb 14 08:59:29 2011
From: isaias at madiva.com (=?ISO-8859-1?Q?Isa=EDas_Espejo_Badia?=)
Date: Mon, 14 Feb 2011 09:59:29 +0100
Subject: [rabbitmq-discuss] Java client getMessageCount problem
Message-ID: <AANLkTikT1ZjLZPQtLNEKCzKQcS4fsaRSCdiyTdQND7Zz@mail.gmail.com>

Hi all

I have a queue declared how passive and I am using the getMessageCount
method but this method return 0 although queue has one element.

This queue is passive to the thread that count but it is active for othe
thread that get and put element.

is there other way to count the queue elements that show the real elements?
(elements waiting for ack and when only there is a element)

Thank you very mucha

Regards
Isa?as


[image: LinkedIn] <http://es.linkedin.com/in/isaiaseb/> [image:
Twitter]<http://twitter.com/isaiasEB>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110214/accb6d88/attachment.htm>

From simon at rabbitmq.com  Mon Feb 14 10:30:19 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 Feb 2011 10:30:19 +0000
Subject: [rabbitmq-discuss] Custom authentication and authorization
In-Reply-To: <AANLkTiki6408cQpxpOYSbaLyrKGhURQVzUX7YgdYs6Av@mail.gmail.com>
References: <AANLkTiki6408cQpxpOYSbaLyrKGhURQVzUX7YgdYs6Av@mail.gmail.com>
Message-ID: <4D59043B.6090201@rabbitmq.com>

On 14/02/11 07:23, Benjamin Renaud wrote:
> I've started reading on Rabbit MQ's plugin's and the custom auth, but I
> wanted to check with the list before I launched into implementing our
> solution.
>
> We run RabbitMQ over the public Internet (.NET clients talking to an EC2
> cloud). On subscription, we'd like to run an
> authentication/authorization process, which would query our user server
> for auth/auth via REST. From what I gather, the right way to do this is
> to write a plugin for Rabbit, perhaps starting from an existing plugin
> as a starting point?

Yes.

You would need to write an implementation of the rabbit_auth_backend 
behaviour. You should look at:

rabbitmq-server/src/rabbit_auth_backend.erl
  - the behaviour itself

rabbitmq-server/include/rabbit_auth_backend_spec.erl
  - the type signatures for the behaviour

rabbitmq-server/src/rabbit_auth_backend_internal.erl
  - the implementation of the built in auth database. Note that you only
    need to look at the code before the comment
    "Manipulation of the user database".

rabbitmq-auth-backend-ldap/src/rabbit_auth_backend_ldap.erl
  - alternate implementation using LDAP

You'll need to configure RabbitMQ to use your plugin. Set the 
auth_backends variable for the rabbit application to a list of 
authentication plugins to try in order.

And tell us of your experiences here :)

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From fabiomargarido at gmail.com  Mon Feb 14 11:53:27 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Mon, 14 Feb 2011 09:53:27 -0200
Subject: [rabbitmq-discuss] Lost messages after consumer crash
In-Reply-To: <AANLkTinS5JuHmMb4DnQ3TTkiN=WbEO9H+iCiivfe4A5r@mail.gmail.com>
References: <AANLkTinS5JuHmMb4DnQ3TTkiN=WbEO9H+iCiivfe4A5r@mail.gmail.com>
Message-ID: <AANLkTin2aaWL2gf6X6D3p5Myvc=X=f9-CQ68b2W9kzKP@mail.gmail.com>

Hi there.
I'm new to RabbitMQ and this list. I've searched the archives but
haven't found an answer for my question, sorry if it's been asked
before.
I've downloaded the server and Java client packages and started
playing around. I've slightly modified the example Java code so that
the producer sends 100000 messages in a loop. Each message contains a
sequential number.
I've noticed that if I crash (Ctrl+C) the consumer in the middle if
the message reception flow and then start it up again, there's a gap
in the messages delivered, i.e., the sequential numbers after the
restart don't pick up from where they stopped. I thought this might be
related to Java and only the printing of the messages, but some quick
analysis of the network traces showed that apparently the non printed
messages are missing from the transmission.
Changing to transaction mode and manual ack didn't seem to help.
Has anyone seen this behavior before? Am I missing something? How can
I guarantee that all the messages are delivered?
Thanks in advance.

Fabio

From alexis at rabbitmq.com  Mon Feb 14 12:14:32 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 14 Feb 2011 12:14:32 +0000
Subject: [rabbitmq-discuss] USP of RabbitMQ
In-Reply-To: <401602.12963.qm@web32803.mail.mud.yahoo.com>
References: <401602.12963.qm@web32803.mail.mud.yahoo.com>
Message-ID: <AANLkTimYON2iT1qdz4w7PvKqMXOvwb8+Ryvc3eD-GV9m@mail.gmail.com>

Rajitha

I'd say that our main selling point is offering you a low cost way to
scale and integrate using messaging, without compromising on stability
and scale.  RabbitMQ is fully commercially supported and has a very
responsive team and community.  We make an extra effort to listen to
customers' needs.

Please see: http://www.springsource.com/products/messaging

Here is a recent blog post that discusses RabbitMQ in relation to
cloud, where stability and scale are important:
http://edelsonmedia.com/?p=685

Best wishes

alexis




On Sat, Feb 12, 2011 at 7:01 AM, Rajitha Jayawickrama
<rajitha33 at yahoo.com> wrote:
> Hi,
>
> I'm a Software Architect of a software development company and we run our own
> product (E-Learning System) for Educational domain and we have large number of
> Asian Universities as our client base.
>
> We are looking for a highly reliable messaging system for our software product
> and I would like to know what is Unique Selling Point of RabbitMQ and why it
> could be one of the best options for messaging, compared with other commercial
> Messaging Systems?
>
> Thanks,
> Rajitha
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From fabiomargarido at gmail.com  Mon Feb 14 11:50:47 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Mon, 14 Feb 2011 09:50:47 -0200
Subject: [rabbitmq-discuss] Lost messages after consumer crash
Message-ID: <AANLkTinS5JuHmMb4DnQ3TTkiN=WbEO9H+iCiivfe4A5r@mail.gmail.com>

Hi there.
I'm new to RabbitMQ and this list. I've searched the archives but
haven't found an answer for my question, sorry if it's been asked
before.
I've downloaded the server and Java client packages and started
playing around. I've slightly modified the example Java code so that
the producer sends 100000 messages in a loop. Each message contains a
sequential number.
I've noticed that if I crash (Ctrl+C) the consumer in the middle if
the message reception flow and then start it up again, there's a gap
in the messages delivered, i.e., the sequential numbers after the
restart don't pick up from where they stopped. I thought this might be
related to Java and only the printing of the messages, but some quick
analysis of the network traces showed that apparently the non printed
messages are missing from the transmission.
Changing to transaction mode and manual ack didn't seem to help.
Has anyone seen this behavior before? Am I missing something? How can
I guarantee that all the messages are delivered?
Thanks in advance.

Fabio

From to.bartkus at gmail.com  Mon Feb 14 13:22:02 2011
From: to.bartkus at gmail.com (Tomas Bartkus)
Date: Mon, 14 Feb 2011 14:22:02 +0100
Subject: [rabbitmq-discuss] AMQP basic_recover
Message-ID: <AANLkTikyod5ME8ctTmrSgmRLCs2J-0tOK0-cwLk+mGRp@mail.gmail.com>

Hello,

I have this is a piece of code to process a message:

public function processMessage($message)
{
    try{
         execute($message);
         $this->_queue->remove($message);
                  $this->_queue->commit();
    } catch (Exception $e) {
            $this->_queue->getChannel()->basic_reject($message->getId(),
true);
            //$this->_queue->getChannel()->basic_recover(true);
            $this->_queue->rollback();
    }
}

All I want to do is just to redeliver a message after some exception occurs.
But if I use basic_recover(true)I get an error - "PRECONDITION_FAILED -
unknown delivery tag 2".

Then I have noticed for example when I ask to redeliver a message with
delivery tag [1] (because I have got an exception) I get a second message
with delivery tag [2] and once I try to commit it I get "PRECONDITION_FAILED
- unknown delivery tag 2". Its like if X message fails and I ask to
redeliver it, next X+1 message that arrives, will fail witn an error
"PRECONDITION_FAILED
- unknown delivery tag X+1" when i will try to commit it.

Then I have tried to use basic_reject($message->getId(), true); and it
works, all messages are redelivered.

Perhaps I am doing something wrong here regarding basic_recover?

I am using RabbitMQ 2.3.1

Thank you for your answers!

Tomas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110214/2091d2bd/attachment.htm>

From alexandru at rabbitmq.com  Mon Feb 14 13:45:24 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 14 Feb 2011 15:45:24 +0200
Subject: [rabbitmq-discuss] Lost messages after consumer crash
In-Reply-To: <AANLkTinS5JuHmMb4DnQ3TTkiN=WbEO9H+iCiivfe4A5r@mail.gmail.com>
References: <AANLkTinS5JuHmMb4DnQ3TTkiN=WbEO9H+iCiivfe4A5r@mail.gmail.com>
Message-ID: <20110214134524.GA2368@dakota.doc.ic.ac.uk>

Hi,

Have a look at this (only applies to 2.3.0):
  http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/

If that doesn't help, could you post the code you're using?

Cheers,
Alex

On Mon, Feb 14, 2011 at 09:50:47AM -0200, Fabio Margarido wrote:
> Hi there.
> I'm new to RabbitMQ and this list. I've searched the archives but
> haven't found an answer for my question, sorry if it's been asked
> before.
> I've downloaded the server and Java client packages and started
> playing around. I've slightly modified the example Java code so that
> the producer sends 100000 messages in a loop. Each message contains a
> sequential number.
> I've noticed that if I crash (Ctrl+C) the consumer in the middle if
> the message reception flow and then start it up again, there's a gap
> in the messages delivered, i.e., the sequential numbers after the
> restart don't pick up from where they stopped. I thought this might be
> related to Java and only the printing of the messages, but some quick
> analysis of the network traces showed that apparently the non printed
> messages are missing from the transmission.
> Changing to transaction mode and manual ack didn't seem to help.
> Has anyone seen this behavior before? Am I missing something? How can
> I guarantee that all the messages are delivered?
> Thanks in advance.
> 
> Fabio
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Mon Feb 14 13:55:42 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 Feb 2011 13:55:42 +0000
Subject: [rabbitmq-discuss] Lost messages after consumer crash
In-Reply-To: <AANLkTinS5JuHmMb4DnQ3TTkiN=WbEO9H+iCiivfe4A5r@mail.gmail.com>
References: <AANLkTinS5JuHmMb4DnQ3TTkiN=WbEO9H+iCiivfe4A5r@mail.gmail.com>
Message-ID: <4D59345E.4090400@rabbitmq.com>

On 14/02/11 11:50, Fabio Margarido wrote:
> I've noticed that if I crash (Ctrl+C) the consumer in the middle if
> the message reception flow and then start it up again, there's a gap
> in the messages delivered, i.e., the sequential numbers after the
> restart don't pick up from where they stopped.
<snip>
> Changing to transaction mode and manual ack didn't seem to help.
> Has anyone seen this behavior before? Am I missing something? How can
> I guarantee that all the messages are delivered?

Note: you must use manual acks. When you ack a message, you are saying 
you have taken responsibility for it (persisted it or whatever). 
RabbitMQ will never redeliver messages you have acked.

Note 2: when redelivering un-acked messages due to a client crash, the 
messages get reinserted at the *beginning* of the queue. Thus you will 
still see gaps in the message sequence, but those messages will be 
delivered later.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From alexandru at rabbitmq.com  Mon Feb 14 13:58:53 2011
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Mon, 14 Feb 2011 15:58:53 +0200
Subject: [rabbitmq-discuss] Lost messages after consumer crash
In-Reply-To: <20110214134524.GA2368@dakota.doc.ic.ac.uk>
References: <AANLkTinS5JuHmMb4DnQ3TTkiN=WbEO9H+iCiivfe4A5r@mail.gmail.com>
	<20110214134524.GA2368@dakota.doc.ic.ac.uk>
Message-ID: <20110214135853.GB2368@dakota.doc.ic.ac.uk>

Hi again,

The confirm stuff is to get the server to take responsibility for the
messages (so, after you get the confirm for the message, you know it's
either been written to disk or sent to a consumer).

In general, the only way to see if a certain consumer has received a
message is to have that consumer publish an acknowledgement message to
some queue for the producer to see.


> > I've noticed that if I crash (Ctrl+C) the consumer in the middle if
> > the message reception flow and then start it up again, there's a gap
> > in the messages delivered

Check if the messages aren't being sent at the end (if a consumer
consumes a messages and dies before ack'ing, the messages are requeued
at the end).

> > Changing to ... manual ack didn't seem to help.

Make sure you're not in autoack mode.  If you are, it's possible that
the java client isn't flushing it's stdout buffer before dying.

Cheers,
Alex

On Mon, Feb 14, 2011 at 03:45:24PM +0200, Alexandru Scvor?ov wrote:
> Hi,
> 
> Have a look at this (only applies to 2.3.0):
>   http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/
> 
> If that doesn't help, could you post the code you're using?
> 
> Cheers,
> Alex
> 
> On Mon, Feb 14, 2011 at 09:50:47AM -0200, Fabio Margarido wrote:
> > Hi there.
> > I'm new to RabbitMQ and this list. I've searched the archives but
> > haven't found an answer for my question, sorry if it's been asked
> > before.
> > I've downloaded the server and Java client packages and started
> > playing around. I've slightly modified the example Java code so that
> > the producer sends 100000 messages in a loop. Each message contains a
> > sequential number.
> > I've noticed that if I crash (Ctrl+C) the consumer in the middle if
> > the message reception flow and then start it up again, there's a gap
> > in the messages delivered, i.e., the sequential numbers after the
> > restart don't pick up from where they stopped. I thought this might be
> > related to Java and only the printing of the messages, but some quick
> > analysis of the network traces showed that apparently the non printed
> > messages are missing from the transmission.
> > Changing to transaction mode and manual ack didn't seem to help.
> > Has anyone seen this behavior before? Am I missing something? How can
> > I guarantee that all the messages are delivered?
> > Thanks in advance.
> > 
> > Fabio
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jbrisbin at vmware.com  Mon Feb 14 15:12:28 2011
From: jbrisbin at vmware.com (Jonathan Brisbin)
Date: Mon, 14 Feb 2011 07:12:28 -0800
Subject: [rabbitmq-discuss] Can I get your input for a RabbitMQ cookbook?
Message-ID: <913E964B4BC95A4F8644D0E6A8452D9E0DCCB0@EXCH-MBX-3.vmware.com>

Would anyone like to express an interest in a particular topic for a
potential RabbitMQ cookbook project I might be working on? We're
trying to come up with an outline and I want to make sure it's
targeted to what people actually want to read about, so if you've got
an idea about some topic you'd like to see covered, please let me know
off list.

Some of the topics will be:

Interoperability (STOMP, Celery, etc...)
Performance tuning
Plugin authoring
Configuration
[Put your topic here]

Please let me know if you've got a particular pain point you'd like to
see more well-documented. I'll be working closely with the Rabbit
folks to make it as useful as possible.

Thanks!

Jon Brisbin

jon (at) jbrisbin.com
http://jbrisbin.com
Twitter: @j_brisbin

From mlortiz at uci.cu  Mon Feb 14 16:00:52 2011
From: mlortiz at uci.cu (Ing. Marcos Ortiz Valmaseda)
Date: Mon, 14 Feb 2011 11:00:52 -0500 (CST)
Subject: [rabbitmq-discuss] Can I get your input for a RabbitMQ cookbook?
In-Reply-To: <567298912.3089921297699132468.JavaMail.root@ucimail4.uci.cu>
Message-ID: <1000083016.3091551297699252776.JavaMail.root@ucimail4.uci.cu>

Well, I think that would be very useful this book. There are many people working with RabbitMQ today on production?s systems.
I?ll do my suggestions:
Interoperability (STOMP, Celery, etc...)
Performance tuning
Plugin authoring
Configuration
[Put your topic here]
  A world of Messages
  A minor overview of Message Oriented Middlewares
  AMQP
  Introduction to RabbitMQ
   - Architecture
   - Major features
  Differentes scenarios supported by AMQP and RabbitMQ
  Installing and Configuring RabbitMQ
  RabbitMQ Clients
   - Java
   - .Net
   - Python
   - Ruby
  Clustering
  Hacking RabbitMQ
  Success Cases 

Regards
-- 
Ing. Marcos Lu?s Ort?z Valmaseda
Software Engineer
Centro de Tecnolog?as de Gesti?n de Datos (DATEC)
Universidad de las Ciencias Inform?ticas

http://www.linkedin.com/in/marcosluis2186
http://postgresql.uci.cu


From mlortiz at uci.cu  Mon Feb 14 16:02:32 2011
From: mlortiz at uci.cu (Ing. Marcos Ortiz Valmaseda)
Date: Mon, 14 Feb 2011 11:02:32 -0500 (CST)
Subject: [rabbitmq-discuss] Can I get your input for a RabbitMQ cookbook?
In-Reply-To: <913E964B4BC95A4F8644D0E6A8452D9E0DCCB0@EXCH-MBX-3.vmware.com>
Message-ID: <1353315324.3093341297699352169.JavaMail.root@ucimail4.uci.cu>

Sorry, a term is missing:

Interoperability (STOMP, Celery, etc...)
Performance tuning
Plugin authoring
Configuration
[Put your topic here]
 * Securing RabbitMQ clusters


-- 
Ing. Marcos Lu?s Ort?z Valmaseda
Software Engineer

Centro de Tecnolog?as de Gesti?n de Datos (DATEC)
Universidad de las Ciencias Inform?ticas
http://postgresql.uci.cu


From fabiomargarido at gmail.com  Mon Feb 14 16:31:47 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Mon, 14 Feb 2011 14:31:47 -0200
Subject: [rabbitmq-discuss] Lost messages after consumer crash
In-Reply-To: <20110214135853.GB2368@dakota.doc.ic.ac.uk>
References: <AANLkTinS5JuHmMb4DnQ3TTkiN=WbEO9H+iCiivfe4A5r@mail.gmail.com>
	<20110214134524.GA2368@dakota.doc.ic.ac.uk>
	<20110214135853.GB2368@dakota.doc.ic.ac.uk>
Message-ID: <AANLkTi=zEqu1s7eb5aedp04nCExoc3Lti1Sn+-6SqEMm@mail.gmail.com>

On Mon, Feb 14, 2011 at 11:58, Alexandru Scvortov
<alexandru at rabbitmq.com> wrote:
> Check if the messages aren't being sent at the end (if a consumer
> consumes a messages and dies before ack'ing, the messages are requeued
> at the end).

Hi,
thank you very much Alex and Simon for your quick replies. After a
more thorough check, I've confirmed that the messages are indeed
delivered out of the expected order, as you've both pointed out.
I'm sorry for the unnecessary noise on the list, at least I (and
hopefully someone else) have learned a bit more about the inner
workings of RabbitMQ.
I'll also take a look at the lightweight confirms and introduce them
in my testing scenarios.
Thanks again.

Fabio

From gregory.mostizky at gmail.com  Mon Feb 14 16:25:51 2011
From: gregory.mostizky at gmail.com (Gregory Mostizky)
Date: Mon, 14 Feb 2011 08:25:51 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ management plugin fails when trying to
 define queue with x-message-ttl (w/ fix)
Message-ID: <070e9d5f-dc7f-461f-af77-e1476cb2057d@l22g2000pre.googlegroups.com>

The reason for this is that it considers the argument to be string
instead of integer.

I've made a fix on github.com:
https://github.com/gregorymostizky/rabbitmq-management/commit/4aaed8d888222b1d7ef099c0ebd030f9a4f6f06a

It basically just adds the 'x-message-ttl' to a list of integer
parameters.

Thanks,
Gregory

From simon at rabbitmq.com  Mon Feb 14 16:53:08 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 Feb 2011 16:53:08 +0000
Subject: [rabbitmq-discuss] RabbitMQ management plugin fails when trying
 to define queue with x-message-ttl (w/ fix)
In-Reply-To: <070e9d5f-dc7f-461f-af77-e1476cb2057d@l22g2000pre.googlegroups.com>
References: <070e9d5f-dc7f-461f-af77-e1476cb2057d@l22g2000pre.googlegroups.com>
Message-ID: <4D595DF4.60501@rabbitmq.com>

On 14/02/11 16:25, Gregory Mostizky wrote:
> I've made a fix on github.com:
> https://github.com/gregorymostizky/rabbitmq-management/commit/4aaed8d888222b1d7ef099c0ebd030f9a4f6f06a

Hi Gregory.

Unfortunately to accept your patch I'd need to get you to sign a 
contributor agreement (yeah, I know). For a presumably tiny fix like 
this it's probably better if I just treat this as a bug report (for 
which, thanks...)

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From bmurphy1976 at gmail.com  Mon Feb 14 16:56:34 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Mon, 14 Feb 2011 10:56:34 -0600
Subject: [rabbitmq-discuss] Multiple rabbitmq servers,
	one or more consumers (.NET)
Message-ID: <AANLkTi=H6x5iC=YDec0x=D0z_gG7eB2K0yU0YnjNtMuK@mail.gmail.com>

I'm working on some advanced HA strategies for our infrastructure.
One thing I'm experimenting with is setting up one or many consumers
that can poll from queues on multiple RabbitMQ servers.

The idea is simple, set up multiple redundant servers configured the
same.  Send messages round-robin to the various servers, and then poll
the servers for messages.  If a server goes off the reservation, pull
it from the list until it comes back online or is replaced with a new
one and keep processing messages from the remaining servers.

I know there are other strategies to do this, but I wanted to
experiment with a few different techniques to see what works best for
us and learn a little bit more about how the driver works.

I dug around in the .NET driver code and managed to pull together an
implementation that uses a SharedQueue and multiple
connections/models.  I had to extend QueueingBasicConsumer and
BasicDeliverEventArgs to add a few properties that allow me to map the
messages back to the appropriate connection/model for acking.

This appears to work great at first pass, however, I don't believe
this will work well for long running jobs in a load balanced scenario
(multiple consumers).  What I believe will happen is this (using a
BasicQos of prefetchSize=0, prefetchCount=1):

message 1 --> rabbitmq server 1 --> consumer 1 shared local queue
message 2 --> rabbitmq server 2 --> consumer 1 shared local queue

(BasicQos of 1 is per model, and there's a model per connection, which
means there's a model per rabbitmq server)

locally:

consumer 1 shared local queue --> message 1 --> message 1
consumer 1 shared local queue --> message 2 --> blocked on message 1

and consumer 2 (3, 4, 5, etc.) are sitting idle because message 2 has
been allocated to consumer 1.

Instead of using model.BasicConsume, I could use model.BasicGet with a
timeout to fetch messages, but I've found the performance of this
method to be dreadful in the past so I wanted to try this method
first.

So, my basic question, is there a simple way I get message 2 to not
block on message 1 and instead get delivered to a different consumer,
or am I barking up the wrong tree here?

Thanks!
Bryan

From alexandru at rabbitmq.com  Mon Feb 14 18:06:12 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 14 Feb 2011 20:06:12 +0200
Subject: [rabbitmq-discuss] Message redelivering doubt with one and with
 more than one consumers.
In-Reply-To: <AANLkTim96T8TGNP7QKW31GXyUU8_r=55dFJ07rrCrxZ=@mail.gmail.com>
References: <AANLkTim96T8TGNP7QKW31GXyUU8_r=55dFJ07rrCrxZ=@mail.gmail.com>
Message-ID: <20110214180612.GC2368@dakota.doc.ic.ac.uk>

Hi,

> In a scenario with one consumer as I saw in my tests, the consumer
> received messages with the Redelivered=true AMQP header atribute.
> The consumer was based in the classes provided by the .NET API and as
> I remember the consumer-tag is random generated by the server.

Sounds good.

> When there is a only one consumer (with a random consumer-tag name)
> and a message is not acked when the consumer is reconnected (so has
> another random tag name) that message is redelivered?

Yes, un-ack'd messages will be redelivered to the consumer when it
reconnects.  Be aware, though, they will be redelivered *after* the
messages still on the queue (i.e. the undelivered ones) are delivered.

So, if the following messages are published to the queue:
  1 2 3 4 5 6

And the following are delivered but not ack'd by the consumer:
  1 2 3

If the consumer crashes and reconnects, the messages delivered in order
will be:
  4 5 6 1 2 3

> Based on my experience I think this is true but don't understand that
> "If that same consumer then reconnects and creates a new subscription
> to the same queue"...

That's just another way of saying it reconnects and starts consuming
again.

> By the was my consumer always tries to create the queue and the
> bindings every time it connects to RabbitMQ.

That's perfect.  You should always do that.

> And also I'm wondering how this behavior acts when there are more than
> one consumer (same queue and same bindings)...

Messages are delivered one at a time to consumers in round-robin order.
If a message is delivered and the consumer dies, the message is
republished to the queue and a consumer will eventually get it (note
that it may be the same client if it reconnects).

> Under what circumstances an unack message wouldn't be redelivered again?

In none of the circumstances we were talking about.  A client can
basic.reject{requeue=false} a message, in which case it will not be
requeued.

Hope this helps.

Cheers,
Alex

On Thu, Feb 10, 2011 at 10:26:53AM +0100, Alfonso Pantoja wrote:
> Hi,
> 
> on the RabbitMQ FAQ page I see the response to
> 
> "Can you explain the cases where a message might be delivered to a
> consumer more than once?"
> the following:
> 
> "If a message is delivered to a consumer, and that consumer then dies
> (or closes the channel which has the subscription to the queue, or
> closes the connection itself) without acking the message, then
> RabbitMQ will reinject the message into the queue. If that same
> consumer then reconnects and creates a new subscription to the same
> queue, it's possible it'll receive the same message again. This is 'at
> least once' delivery and is very deliberate design to ensure that
> messages are not lost in transit."
> 
> 
> So my doubt is:
> 
> In a scenario with one consumer as I saw in my tests, the consumer
> received messages with the Redelivered=true AMQP header atribute.
> The consumer was based in the classes provided by the .NET API and as
> I remember the consumer-tag is random generated by the server.
> 
> When there is a only one consumer (with a random consumer-tag name)
> and a message is not acked when the consumer is reconnected (so has
> another random tag name) that message is redelivered?
> Based on my experience I think this is true but don't understand that
> "If that same consumer then reconnects and creates a new subscription
> to the same queue"...
> By the was my consumer always tries to create the queue and the
> bindings every time it connects to RabbitMQ.
> 
> And also I'm wondering how this behavior acts when there are more than
> one consumer (same queue and same bindings)...
> 
> Under what circumstances an unack message wouldn't be redelivered again?
> 
> Thank you in advance.
> 
> Regards,
> 
> Alfonso
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> The consumer can also call basic.recover which tells rabbit to resend
> all the messages sent to the consumer for which rabbit has not
> received an ack for. This basically amounts to the consumer saying "I
> know you sent me some messages, but I've forgotten what they are.
> Could you resend them all again?".
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jbrisbin at vmware.com  Mon Feb 14 19:33:20 2011
From: jbrisbin at vmware.com (Jonathan Brisbin)
Date: Mon, 14 Feb 2011 11:33:20 -0800
Subject: [rabbitmq-discuss] Message persistence format
Message-ID: <00781A9C-B247-4A10-84D1-AE8C7EC67413@vmware.com>

I've tracked down some problems I've been having with a Riak-based message persister to not having a properly-constructed #basic_message record to give back to the broker. I see some differences between those returned from a working version of a backing queue versus the ones returned from mine.

I'm wondering, then, if there's some guidance you can give on the way to persist messages outside of an Erlang context. Ideally, one should be able to work with the message content. This means storing the individual pieces that make up a message in various ways (headers/links to metadata documents, etc...). But it's easier if I simply serialize the Erlang term for the message and reconstitute it later. It then has all the internal properties it needs on it, etc...

What are the fewest possible pieces of information I need to construct a valid #basic_message record?

Thanks!

Jon Brisbin
SpringSource (a division of VMware)

Twitter: @j_brisbin



From matthew at rabbitmq.com  Mon Feb 14 19:36:47 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 14 Feb 2011 19:36:47 +0000
Subject: [rabbitmq-discuss] Message persistence format
In-Reply-To: <00781A9C-B247-4A10-84D1-AE8C7EC67413@vmware.com>
References: <00781A9C-B247-4A10-84D1-AE8C7EC67413@vmware.com>
Message-ID: <20110214193646.GA2563@wellquite.org>

On Mon, Feb 14, 2011 at 11:33:20AM -0800, Jonathan Brisbin wrote:
> What are the fewest possible pieces of information I need to construct a valid #basic_message record?

We just do term_to_binary and then later on binary_to_term. Are you
doing this and finding it's not working?

Matthew

From matthew at rabbitmq.com  Mon Feb 14 19:53:18 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 14 Feb 2011 19:53:18 +0000
Subject: [rabbitmq-discuss] Message persistence format
In-Reply-To: <98D6325E-5229-4AF7-9D14-3AF9C49A392B@vmware.com>
References: <00781A9C-B247-4A10-84D1-AE8C7EC67413@vmware.com>
	<20110214193646.GA2563@wellquite.org>
	<98D6325E-5229-4AF7-9D14-3AF9C49A392B@vmware.com>
Message-ID: <20110214195317.GB2563@wellquite.org>

On Mon, Feb 14, 2011 at 11:42:50AM -0800, Jonathan Brisbin wrote:
> I'm trying to not do that. :)
> I'd like to deal with the message separately (maybe it's JSON?)

AMQP message bodies are entirely opaque. You should not hope to
interpret them at all within the broker. They are stored as a list of
binary fragments within basic_message. All fields within basic_message
must be completely restored faithfully.

The advantage of using term_to_binary and friends is that when we change
basic_message, which we are actually currently doing, nothing needs
changing (slight lie - we have to alter everything on disk, but that's
not so hard). If you make your msg_store equiv (not BQ) dependent on the
structure of the values in write/read/remove then you're only creating
more work for yourself.

Matthew

From alfonso.pantoja at gmail.com  Mon Feb 14 22:24:14 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Mon, 14 Feb 2011 23:24:14 +0100
Subject: [rabbitmq-discuss] Message redelivering doubt with one and with
 more than one consumers.
In-Reply-To: <20110214180612.GC2368@dakota.doc.ic.ac.uk>
References: <AANLkTim96T8TGNP7QKW31GXyUU8_r=55dFJ07rrCrxZ=@mail.gmail.com>
	<20110214180612.GC2368@dakota.doc.ic.ac.uk>
Message-ID: <AANLkTikomXB8JX65s6oz_XhOYL8RoXMfRg7W-bg9kNkB@mail.gmail.com>

Hi Alex,

Thank for that clear explanation. You really helped me.

In the first approach of my code I didn't ack messages that couldn't
be processed by my business logic (for instance when they couldn't be
stored in the database due to a connection error) so I counted then
un-ack'd messages and when they reach a threshold number I called
basic.recover because as I read on the documentation basic.reject was
not implemented in 1.7.2.
Now using 2.2.0 version (server and API) I replaced basic.recover with
basic.reject which doesn't requeue the whole messages in the queue as
basic.recover did (and the CPU wasn't very 'happy' with it)

The use of basic.reject{requeue=true} implies that there is no need to
un-ack messages thus counting those messages and calling basic.recover
to put them again in the queue is not necessary.
So when receiving messages the only possible actions are basic.ack for
messages OK, basic.reject{requeue=true}  for messages that couldn't be
processed and basic.reject{requeue=false} for discarding the messages
we don't want to process.
In this scenario I think that un-ack'd messages are only possible when
the consumer crashes or it is stopped so basic.recover calls are
totally unnecessary because, as you said, the messages will be requeue
when a consumer is connected again.
An also I suppose it is better to actively response to Rabbit about
the messages (discarding  or requeing using basic.reject) instead of
"not respoding" for un-ack them.

Am I right or am I missing something?


Best regards,


Alfonso










2011/2/14 Alexandru Scvor?ov <alexandru at rabbitmq.com>:
> Hi,
>
>> In a scenario with one consumer as I saw in my tests, the consumer
>> received messages with the Redelivered=true AMQP header atribute.
>> The consumer was based in the classes provided by the .NET API and as
>> I remember the consumer-tag is random generated by the server.
>
> Sounds good.
>
>> When there is a only one consumer (with a random consumer-tag name)
>> and a message is not acked when the consumer is reconnected (so has
>> another random tag name) that message is redelivered?
>
> Yes, un-ack'd messages will be redelivered to the consumer when it
> reconnects. ?Be aware, though, they will be redelivered *after* the
> messages still on the queue (i.e. the undelivered ones) are delivered.
>
> So, if the following messages are published to the queue:
> ?1 2 3 4 5 6
>
> And the following are delivered but not ack'd by the consumer:
> ?1 2 3
>
> If the consumer crashes and reconnects, the messages delivered in order
> will be:
> ?4 5 6 1 2 3
>
>> Based on my experience I think this is true but don't understand that
>> "If that same consumer then reconnects and creates a new subscription
>> to the same queue"...
>
> That's just another way of saying it reconnects and starts consuming
> again.
>
>> By the was my consumer always tries to create the queue and the
>> bindings every time it connects to RabbitMQ.
>
> That's perfect. ?You should always do that.
>
>> And also I'm wondering how this behavior acts when there are more than
>> one consumer (same queue and same bindings)...
>
> Messages are delivered one at a time to consumers in round-robin order.
> If a message is delivered and the consumer dies, the message is
> republished to the queue and a consumer will eventually get it (note
> that it may be the same client if it reconnects).
>
>> Under what circumstances an unack message wouldn't be redelivered again?
>
> In none of the circumstances we were talking about. ?A client can
> basic.reject{requeue=false} a message, in which case it will not be
> requeued.
>
> Hope this helps.
>
> Cheers,
> Alex
>
> On Thu, Feb 10, 2011 at 10:26:53AM +0100, Alfonso Pantoja wrote:
>> Hi,
>>
>> on the RabbitMQ FAQ page I see the response to
>>
>> "Can you explain the cases where a message might be delivered to a
>> consumer more than once?"
>> the following:
>>
>> "If a message is delivered to a consumer, and that consumer then dies
>> (or closes the channel which has the subscription to the queue, or
>> closes the connection itself) without acking the message, then
>> RabbitMQ will reinject the message into the queue. If that same
>> consumer then reconnects and creates a new subscription to the same
>> queue, it's possible it'll receive the same message again. This is 'at
>> least once' delivery and is very deliberate design to ensure that
>> messages are not lost in transit."
>>
>>
>> So my doubt is:
>>
>> In a scenario with one consumer as I saw in my tests, the consumer
>> received messages with the Redelivered=true AMQP header atribute.
>> The consumer was based in the classes provided by the .NET API and as
>> I remember the consumer-tag is random generated by the server.
>>
>> When there is a only one consumer (with a random consumer-tag name)
>> and a message is not acked when the consumer is reconnected (so has
>> another random tag name) that message is redelivered?
>> Based on my experience I think this is true but don't understand that
>> "If that same consumer then reconnects and creates a new subscription
>> to the same queue"...
>> By the was my consumer always tries to create the queue and the
>> bindings every time it connects to RabbitMQ.
>>
>> And also I'm wondering how this behavior acts when there are more than
>> one consumer (same queue and same bindings)...
>>
>> Under what circumstances an unack message wouldn't be redelivered again?
>>
>> Thank you in advance.
>>
>> Regards,
>>
>> Alfonso
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> The consumer can also call basic.recover which tells rabbit to resend
>> all the messages sent to the consumer for which rabbit has not
>> received an ack for. This basically amounts to the consumer saying "I
>> know you sent me some messages, but I've forgotten what they are.
>> Could you resend them all again?".
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alfonso.pantoja at gmail.com  Mon Feb 14 22:37:51 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Mon, 14 Feb 2011 23:37:51 +0100
Subject: [rabbitmq-discuss] Strategy for consuming queues and ordering
In-Reply-To: <AANLkTik98C7CZhHJ5biMyey06x2h3=kORivHCvr43S78@mail.gmail.com>
References: <AANLkTimkk1cCojwsf3q5v27O-yUWft3tXcssVm6mVP_X@mail.gmail.com>
	<AANLkTinxqC6WLvsTk=ntdbrWRhum8KHHufjp1Beq5Mt9@mail.gmail.com>
	<AANLkTik98C7CZhHJ5biMyey06x2h3=kORivHCvr43S78@mail.gmail.com>
Message-ID: <AANLkTi=Go-NQiyMAZCWpVSRgTOBUHMbsEfP5VgJ29_uh@mail.gmail.com>

Thank you Robby and Bryan for you answers.

In my case the requirement  is to update a user connection status in
the database (online/offline). We started to use the Timestamp header
of  AMQP and I think that if comparing that timestamp with a timestamp
stored in the database is safe enough in case of the messages don't
arrive in the expected order.
In this situation I suppose the most critical point is not to loose
any message (in other words it wouldn't be acceptable a user would be
offline due to a online message had lost)


Regards,

Alfonso



2011/2/11 Bryan Murphy <bmurphy1976 at gmail.com>:
> On Thu, Feb 10, 2011 at 3:55 AM, Robert Raschke <rtrlists at googlemail.com> wrote:
>>> Can anyone tell me how to deal with queues that contain messages that
>>> are higly recommended by business logic to be ordered?
>
> snip
>
>> Whenever I hear about the problem of the required order of messages having
>> to be preserved, I start to wonder if the problem at hand is really best
>> suited to messaging. Could it be that you might be better served by
>> something like a (normal) work queue?
>>
>> If you require things to be done in a certain order, then you need to have a
>> place to actually keep them in that order. Messaging isn't the place to do
>> this.
>
> I agree. ?If it needs to absolutely be in order, we put the message in
> a database transactionally and then send a "hey something changed go
> look at the database" message.
>
> Bryan
>

From hujn at polyvore.com  Mon Feb 14 22:52:01 2011
From: hujn at polyvore.com (Jianing Hu)
Date: Mon, 14 Feb 2011 14:52:01 -0800
Subject: [rabbitmq-discuss] disk space not released after persistent
 messages are consumed
In-Reply-To: <20110211010714.GC2361@dakota.doc.ic.ac.uk>
References: <AANLkTikfrhX3wWMfwzRDLn3GDq+Ers+31tnuokONxT-i@mail.gmail.com>
	<20110211010714.GC2361@dakota.doc.ic.ac.uk>
Message-ID: <AANLkTikUBro2FziFXy945ZaUOiy6FtWUsC5xS7OviMjS@mail.gmail.com>

Thanks for the explanation. I ran a longer test and that is indeed the
behavior. The old file got deleted eventually.

Thanks,
- Jianing

On Thu, Feb 10, 2011 at 5:07 PM, Alexandru Scvor?ov
<alexandru at rabbitmq.com> wrote:
> Hi,
>
>> After running this code I end up with a 3MB file in the
>> msg_store_persistent directory, even though rabbitmqctl list_queues
>> shows 0 messages in the queue. After restarting RabbitMQ server that
>> file grew by another 800KB. Any advice is greatly appreciated.
>
> That's more or less expected.
>
> The broker tries to write the messages to disk in files stored in that
> directory. ?The persister always has at least one file open and it will
> append to it any new messages. ?Since it only *appends* to the files,
> even if the messages get delivered to consumers, they'll still be on
> disk. ?Normally, the persister will delete files that only contain stale
> messages, but it won't do this to the file it's currently writing to.
> When the current file exceeds msg_store_file_size_limit, it will start
> on a new file. ?At that point, if the old file doesn't have any more
> messages, it will delete it. ?The size limit is about 16 Mb by default,
> so it's unsurprising that you have a 3 Mb file lying around.
>
> You can set msg_store_file_size_limit in rabbitmq.config.
>
> Does this answer your question?
>
> Cheers,
> Alex
>
> On Mon, Feb 07, 2011 at 05:27:07PM -0800, Jianing Hu wrote:
>> Hi,
>>
>> RabbitMQ newbie here so apologies in advance if what I'm doing is
>> obviously wrong.
>>
>> I'm experimenting with RabbigMQ 2.1.1 and it seems my persistent
>> message storage file keeps growing despite of messages being consumed.
>> Here's the code I used for testing. I'm using perl with Net::RabbitMQ
>>
>> ? ? use Net::RabbitMQ;
>> ? ? my $mq = Net::RabbitMQ->new();
>> ? ? $mq->connect("localhost", {
>> ? ? ? ? user => 'guest',
>> ? ? ? ? password => 'guest'
>> ? ? });
>> ? ? $mq->channel_open(1);
>> ? ? $mq->queue_declare(1, 'test', {
>> ? ? ? ? passive => 0,
>> ? ? ? ? durable => 1,
>> ? ? ? ? exclusive => 0,
>> ? ? ? ? auto_delete => 0
>> ? ? });
>>
>> ? ? my $data = 'foobar' x 200;
>> ? ? for (1..100000) {
>> ? ? ? ? $mq->publish(1, 'test', $data, {}, { delivery_mode => 2});
>> ? ? }
>>
>> ? ? $mq->consume(1, 'test', {
>> ? ? ? ? no_ack => 0
>> ? ? });
>> ? ? for (1..100000) {
>> ? ? ? ? my $msg = $mq->recv();
>> ? ? ? ? $mq->ack(1, $msg->{delivery_tag});
>> ? ? }
>>
>> After running this code I end up with a 3MB file in the
>> msg_store_persistent directory, even though rabbitmqctl list_queues
>> shows 0 messages in the queue. After restarting RabbitMQ server that
>> file grew by another 800KB. Any advice is greatly appreciated.
>>
>> Thanks,
>> - Jianing
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alexandru at rabbitmq.com  Mon Feb 14 23:38:53 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 15 Feb 2011 01:38:53 +0200
Subject: [rabbitmq-discuss] Message redelivering doubt with one and with
 more than one consumers.
In-Reply-To: <AANLkTikomXB8JX65s6oz_XhOYL8RoXMfRg7W-bg9kNkB@mail.gmail.com>
References: <AANLkTim96T8TGNP7QKW31GXyUU8_r=55dFJ07rrCrxZ=@mail.gmail.com>
	<20110214180612.GC2368@dakota.doc.ic.ac.uk>
	<AANLkTikomXB8JX65s6oz_XhOYL8RoXMfRg7W-bg9kNkB@mail.gmail.com>
Message-ID: <20110214233853.GB2366@dakota.doc.ic.ac.uk>

Hi Alfonso,

> The use of basic.reject{requeue=true} implies that there is no need to
> un-ack messages thus counting those messages and calling basic.recover
> to put them again in the queue is not necessary.
> So when receiving messages the only possible actions are basic.ack for
> messages OK, basic.reject{requeue=true}  for messages that couldn't be
> processed and basic.reject{requeue=false} for discarding the messages
> we don't want to process.
> In this scenario I think that un-ack'd messages are only possible when
> the consumer crashes or it is stopped so basic.recover calls are
> totally unnecessary because, as you said, the messages will be requeue
> when a consumer is connected again.
> Am I right or am I missing something?

That sounds about right.

Basic.recover means ``requeue all unacknowledged messages now''.
Basic.reject means ``requeue/discard the following messages now''.

So, basic.reject{requeue=true} can be seen as a more specific version of
basic.recover{requeue=true}.

> An also I suppose it is better to actively response to Rabbit about
> the messages (discarding  or requeing using basic.reject) instead of
> "not respoding" for un-ack them.

It depends.  For instance, from the broker's point of view, there's no
difference in overhead between un-ack'd messages and undelivered
messages.  Rejecting{requeue=false} and ack'ing messages will free up
some RAM and some disk space.

It's probably good practice to tell the broker what it should do with
the messages as soon as possible, but it doesn't matter that much.  If
the broker starts running out of RAM, it will write more messages to
disk.  If it's really running low on RAM, it will throttle publishers.

Cheers,
Alex

On Mon, Feb 14, 2011 at 11:24:14PM +0100, Alfonso Pantoja wrote:
> Hi Alex,
> 
> Thank for that clear explanation. You really helped me.
> 
> In the first approach of my code I didn't ack messages that couldn't
> be processed by my business logic (for instance when they couldn't be
> stored in the database due to a connection error) so I counted then
> un-ack'd messages and when they reach a threshold number I called
> basic.recover because as I read on the documentation basic.reject was
> not implemented in 1.7.2.
> Now using 2.2.0 version (server and API) I replaced basic.recover with
> basic.reject which doesn't requeue the whole messages in the queue as
> basic.recover did (and the CPU wasn't very 'happy' with it)
> 
> The use of basic.reject{requeue=true} implies that there is no need to
> un-ack messages thus counting those messages and calling basic.recover
> to put them again in the queue is not necessary.
> So when receiving messages the only possible actions are basic.ack for
> messages OK, basic.reject{requeue=true}  for messages that couldn't be
> processed and basic.reject{requeue=false} for discarding the messages
> we don't want to process.
> In this scenario I think that un-ack'd messages are only possible when
> the consumer crashes or it is stopped so basic.recover calls are
> totally unnecessary because, as you said, the messages will be requeue
> when a consumer is connected again.
> An also I suppose it is better to actively response to Rabbit about
> the messages (discarding  or requeing using basic.reject) instead of
> "not respoding" for un-ack them.
> 
> Am I right or am I missing something?
> 
> 
> Best regards,
> 
> 
> Alfonso
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 2011/2/14 Alexandru Scvor?ov <alexandru at rabbitmq.com>:
> > Hi,
> >
> >> In a scenario with one consumer as I saw in my tests, the consumer
> >> received messages with the Redelivered=true AMQP header atribute.
> >> The consumer was based in the classes provided by the .NET API and as
> >> I remember the consumer-tag is random generated by the server.
> >
> > Sounds good.
> >
> >> When there is a only one consumer (with a random consumer-tag name)
> >> and a message is not acked when the consumer is reconnected (so has
> >> another random tag name) that message is redelivered?
> >
> > Yes, un-ack'd messages will be redelivered to the consumer when it
> > reconnects. ?Be aware, though, they will be redelivered *after* the
> > messages still on the queue (i.e. the undelivered ones) are delivered.
> >
> > So, if the following messages are published to the queue:
> > ?1 2 3 4 5 6
> >
> > And the following are delivered but not ack'd by the consumer:
> > ?1 2 3
> >
> > If the consumer crashes and reconnects, the messages delivered in order
> > will be:
> > ?4 5 6 1 2 3
> >
> >> Based on my experience I think this is true but don't understand that
> >> "If that same consumer then reconnects and creates a new subscription
> >> to the same queue"...
> >
> > That's just another way of saying it reconnects and starts consuming
> > again.
> >
> >> By the was my consumer always tries to create the queue and the
> >> bindings every time it connects to RabbitMQ.
> >
> > That's perfect. ?You should always do that.
> >
> >> And also I'm wondering how this behavior acts when there are more than
> >> one consumer (same queue and same bindings)...
> >
> > Messages are delivered one at a time to consumers in round-robin order.
> > If a message is delivered and the consumer dies, the message is
> > republished to the queue and a consumer will eventually get it (note
> > that it may be the same client if it reconnects).
> >
> >> Under what circumstances an unack message wouldn't be redelivered again?
> >
> > In none of the circumstances we were talking about. ?A client can
> > basic.reject{requeue=false} a message, in which case it will not be
> > requeued.
> >
> > Hope this helps.
> >
> > Cheers,
> > Alex
> >
> > On Thu, Feb 10, 2011 at 10:26:53AM +0100, Alfonso Pantoja wrote:
> >> Hi,
> >>
> >> on the RabbitMQ FAQ page I see the response to
> >>
> >> "Can you explain the cases where a message might be delivered to a
> >> consumer more than once?"
> >> the following:
> >>
> >> "If a message is delivered to a consumer, and that consumer then dies
> >> (or closes the channel which has the subscription to the queue, or
> >> closes the connection itself) without acking the message, then
> >> RabbitMQ will reinject the message into the queue. If that same
> >> consumer then reconnects and creates a new subscription to the same
> >> queue, it's possible it'll receive the same message again. This is 'at
> >> least once' delivery and is very deliberate design to ensure that
> >> messages are not lost in transit."
> >>
> >>
> >> So my doubt is:
> >>
> >> In a scenario with one consumer as I saw in my tests, the consumer
> >> received messages with the Redelivered=true AMQP header atribute.
> >> The consumer was based in the classes provided by the .NET API and as
> >> I remember the consumer-tag is random generated by the server.
> >>
> >> When there is a only one consumer (with a random consumer-tag name)
> >> and a message is not acked when the consumer is reconnected (so has
> >> another random tag name) that message is redelivered?
> >> Based on my experience I think this is true but don't understand that
> >> "If that same consumer then reconnects and creates a new subscription
> >> to the same queue"...
> >> By the was my consumer always tries to create the queue and the
> >> bindings every time it connects to RabbitMQ.
> >>
> >> And also I'm wondering how this behavior acts when there are more than
> >> one consumer (same queue and same bindings)...
> >>
> >> Under what circumstances an unack message wouldn't be redelivered again?
> >>
> >> Thank you in advance.
> >>
> >> Regards,
> >>
> >> Alfonso
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >> The consumer can also call basic.recover which tells rabbit to resend
> >> all the messages sent to the consumer for which rabbit has not
> >> received an ack for. This basically amounts to the consumer saying "I
> >> know you sent me some messages, but I've forgotten what they are.
> >> Could you resend them all again?".
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >

From michael.s.klishin at gmail.com  Tue Feb 15 05:57:11 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 15 Feb 2011 08:57:11 +0300
Subject: [rabbitmq-discuss] Can I get your input for a RabbitMQ cookbook?
In-Reply-To: <913E964B4BC95A4F8644D0E6A8452D9E0DCCB0@EXCH-MBX-3.vmware.com>
References: <913E964B4BC95A4F8644D0E6A8452D9E0DCCB0@EXCH-MBX-3.vmware.com>
Message-ID: <AANLkTi=3mXoYr074+-iqQYmL6=LO0F24R_cTR2nfAXsu@mail.gmail.com>

Jonathan,

Is your plan to focus on RabbitMQ specifically or AMQP in general?
When I talk to people about AMQP and RabbitMQ, I mostly hear the following
questions:

* Is there an easy to use client for my programming language of choice?
Should I use sync or async library?
* So, how do I use all those queues and exchanges to make my shiny Web app
talk to all those other apps?
* Can I use RabbitMQ to build [a description of fault-tolerancy
requirements]?

and, of course,

* What is Erlang cookie and why my rabbit doesn't want to eat it?

while I personally would love to read a book that covers

* Messaging patterns
* RabbitMQ plugin development

It all depends on who is your audience.

2011/2/14 Jonathan Brisbin <jbrisbin at vmware.com>

> Please let me know if you've got a particular pain point you'd like to
> see more well-documented. I'll be working closely with the Rabbit
> folks to make it as useful as possible.
>

-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110215/0cdd83a5/attachment.htm>

From starbuxman at gmail.com  Tue Feb 15 07:12:59 2011
From: starbuxman at gmail.com (Josh Long)
Date: Mon, 14 Feb 2011 23:12:59 -0800
Subject: [rabbitmq-discuss] Can I get your input for a RabbitMQ cookbook?
In-Reply-To: <AANLkTi=3mXoYr074+-iqQYmL6=LO0F24R_cTR2nfAXsu@mail.gmail.com>
References: <913E964B4BC95A4F8644D0E6A8452D9E0DCCB0@EXCH-MBX-3.vmware.com>
	<AANLkTi=3mXoYr074+-iqQYmL6=LO0F24R_cTR2nfAXsu@mail.gmail.com>
Message-ID: <AANLkTi=s=t3U3e8UVcMHOPrBx-1ZpM_2G18H02ZMrK-q@mail.gmail.com>

And please don't forget Spring AMQP when you talk about the clients! :-)

Generally, concrete, real world cluster deployment and tuning would be
welcome along with disections of the various topologies. The
open-souce JMS brokers have generally pretty crummy documentation, and
lots of consultant-friendly back-door features. It'd be nice to combat
that with even clearer, unambiguous, detailed help on getting
clustering to work and an idea of the performance characteristics and
so on.

Thanks,
Josh Long
Spring Developer Advocate, SpringSource, a division of VMware
Co-Author of Apress' "Spring Enterprise Recipes" and "Spring Recipes,
2nd Edition"
http://www.joshlong.com | http://twitter.com/starbuxman
Infoq.com editor (http://www.infoq.com/author/Josh-Long)





On Mon, Feb 14, 2011 at 9:57 PM, Michael Klishin
<michael.s.klishin at gmail.com> wrote:
> Jonathan,
> Is your plan to focus on RabbitMQ specifically or AMQP in general?
> When I talk to people about AMQP and RabbitMQ, I mostly hear the following
> questions:
> * Is there an easy to use client for my programming language of choice?
> Should I use sync or async library?
> * So, how do I use all those queues and exchanges to make my shiny Web app
> talk to all those other apps?
> * Can I use RabbitMQ to build [a description of fault-tolerancy
> requirements]?
> and, of course,
> * What is Erlang cookie and why my rabbit doesn't want to eat it?
> while I personally would love to read a book that covers
> * Messaging patterns
> * RabbitMQ plugin development
> It all depends on who is your audience.
> 2011/2/14 Jonathan Brisbin?<jbrisbin at vmware.com>
>>
>> Please let me know if you've got a particular pain point you'd like to
>> see more well-documented. I'll be working closely with the Rabbit
>> folks to make it as useful as possible.
>
> --
> MK
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From simon at rabbitmq.com  Tue Feb 15 10:25:19 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 15 Feb 2011 10:25:19 +0000
Subject: [rabbitmq-discuss] Custom authentication and authorization
In-Reply-To: <AANLkTimepwyAKQ+oge2UQ0AHSRGMEhgSLQ73VrYhaCBr@mail.gmail.com>
References: <AANLkTimepwyAKQ+oge2UQ0AHSRGMEhgSLQ73VrYhaCBr@mail.gmail.com>
Message-ID: <4D5A548F.1030203@rabbitmq.com>

(We prefer to keep rabbitmq-discuss in the loop; this is of general 
interest.)

Hi Benjamin. The idea of securing access to RabbitMQ resources based on 
secret names is perfectly reasonable providing that:

* Any attacker can't use rabbitmqctl

* Furthermore, any attacker can't see the Erlang cookie

   - This is in fact always true, possession of the cookie lets you do
     anything, but I thought I should mention it.

* Any attacker can't use the management plugin

We go to some effort to ensure that server-generated names for queues 
are unguessable; the intent is to allow exactly this sort of security model.

That said, would there be general interest in a hypothetical 
rabbitmq-auth-backend-http plugin?

Cheers, Simon

On 15/02/11 01:05, Benjamin Renaud wrote:
> Simon,
>
> Thanks a lot for your response! These are very useful pointers and
> it's much appreciated.
>
> First a bit of background - we're all very experienced Java, C and
> Ruby developers, but we have no Erlang experience whatsoever.
> Securing something like Rabbit using a custom module represents a lot
> of work, and  as I was looking into this some more, we came up with
> an idea of securing the whole system, and I was wondering if you
> could give me some feedback on it?
>
> The basic idea would be to make every exchange name a secret 256-bit
> key that could only be obtained using a regular (authenticated and
> authorized) REST call to our usual REST server.
>
> It would require that a client (attacker) not be able to list all
> active exchanges, and to run all traffic over HTTPS. Does that sound
> like a workable solution?
>
> Thanks!
>
> Benjamin
>
>
> On 14/02/11 07:23, Benjamin Renaud wrote:
>> /  I've started reading on Rabbit MQ's plugin's and the custom
>> auth, but I
> />/  wanted to check with the list before I launched into
> implementing our />/  solution. />/ />/  We run RabbitMQ over the
> public Internet (.NET clients talking to an EC2 />/  cloud). On
> subscription, we'd like to run an />/  authentication/authorization
> process, which would query our user server />/  for auth/auth via
> REST. From what I gather, the right way to do this is />/  to write a
> plugin for Rabbit, perhaps starting from an existing plugin />/  as a
> starting point? / Yes.
>
> You would need to write an implementation of the rabbit_auth_backend
> behaviour. You should look at:
>
> rabbitmq-server/src/rabbit_auth_backend.erl - the behaviour itself
>
> rabbitmq-server/include/rabbit_auth_backend_spec.erl - the type
> signatures for the behaviour
>
> rabbitmq-server/src/rabbit_auth_backend_internal.erl - the
> implementation of the built in auth database. Note that you only need
> to look at the code before the comment "Manipulation of the user
> database".
>
> rabbitmq-auth-backend-ldap/src/rabbit_auth_backend_ldap.erl -
> alternate implementation using LDAP
>
> You'll need to configure RabbitMQ to use your plugin. Set the
> auth_backends variable for the rabbit application to a list of
> authentication plugins to try in order.
>
> And tell us of your experiences here :)
>
> Cheers, Simon
>
> -- Simon MacMullen Staff Engineer, RabbitMQ SpringSource, a division
> of VMware
>


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From jiri.krutil.ext at deutsche-boerse.com  Tue Feb 15 11:50:56 2011
From: jiri.krutil.ext at deutsche-boerse.com (jiri.krutil.ext at deutsche-boerse.com)
Date: Tue, 15 Feb 2011 12:50:56 +0100
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
Message-ID: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>

Hi

Here at Deutsche Boerse there are big plans for a brand new realtime risk 
management system. The project is very ambitious as to the requied 
performance and of course it must be bullet-proof robust, reliable, 
fault-tolerant, etc.

It seems that this will require a message broker of some sort. AMQP could 
have a good chance since it has already been adopted here for two other 
projects.

I would personally like RabbitMQ, but I think that Apache Qpid will be a 
strong competitor, because:

1. It has a C++ broker which should supposedly be faster than Erlang. I 
personaly don't think that C++ always means faster, but some people here 
do.
2. It seems to care better for its C/C++ clients than RabbitMQ. And most 
of the clients will be C/C++.
3. The fact that the latest Qpid Java JMS client is a disaster will 
probably not bother anyone around here too much.

So my questions are:

- Are there some performance benchmarks available comparing RabbitMQ to 
Qpid?
- Is the RabbitMQ C client mature enough to be used for such job?
- What limitations does the C client have compared to the Java client?
- Is there a chance that the C client would become officially supported?

I'm afraid the last one might be a show-stopper as I think it would not be 
acceptable around here to use something marked as experimental in 
production.

I'm not sure how many people are considering to use AMQP from C or C++, 
but I guess there must be enough of them for RabbitMQ to consider 
supporting them officially. At least in finance C/C++ still seems to be 
used quite a lot.

Cheers
Jiri



----------------------------------------------------------------------------
Deutsche B?rse Services s.r.o.
Managing Directors/Gesch?ftsf?hrung:
Michael Gassmann, Mats Andersson.
Limited liability company with registered office at
Vladislavova 1390/17, postal code: 110 00 Prague 1,
recorded in the Commercial Register IC: 275 77 015.
Maintained by the city court in Prague,
Sec. C, File No. 116874.
-----------------------------------------
Diese E-Mail enthaelt vertrauliche oder rechtlich geschuetzte Informationen.
Wenn Sie nicht der beabsichtigte Empfaenger sind, informieren Sie bitte
sofort den Absender und loeschen Sie diese E-Mail. Das unbefugte Kopieren
dieser E-Mail oder die unbefugte Weitergabe der enthaltenen Informationen
ist nicht gestattet.

The information contained in this message is confidential or protected by
law. If you are not the intended recipient, please contact the sender and
delete this message. Any unauthorised copying of this message or
unauthorised distribution of the information contained herein is prohibited.

Legally required information for business correspondence/
Gesetzliche Pflichtangaben fuer Geschaeftskorrespondenz:
http://deutsche-boerse.com/letterhead
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110215/4089af1b/attachment.htm>

From alexis at rabbitmq.com  Tue Feb 15 12:09:25 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 15 Feb 2011 12:09:25 +0000
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
Message-ID: <AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>

Jiri

Many customers use the C client in production.  The reason it is
marked as experimental is that we would like to improve it.  How much
would such plans impact your use?

alexis


On Tue, Feb 15, 2011 at 11:50 AM,  <jiri.krutil.ext at deutsche-boerse.com> wrote:
>
> Hi
>
> Here at Deutsche Boerse there are big plans for a brand new realtime risk
> management system. The project is very ambitious as to the requied
> performance and of course it must be bullet-proof robust, reliable,
> fault-tolerant, etc.
>
> It seems that this will require a message broker of some sort. AMQP could
> have a good chance since it has already been adopted here for two other
> projects.
>
> I would personally like RabbitMQ, but I think that Apache Qpid will be a
> strong competitor, because:
>
> 1. It has a C++ broker which should supposedly be faster than Erlang. I
> personaly don't think that C++ always means faster, but some people here do.
> 2. It seems to care better for its C/C++ clients than RabbitMQ. And most of
> the clients will be C/C++.
> 3. The fact that the latest Qpid Java JMS client is a disaster will probably
> not bother anyone around here too much.
>
> So my questions are:
>
> - Are there some performance benchmarks available comparing RabbitMQ to
> Qpid?
> - Is the RabbitMQ C client mature enough to be used for such job?
> - What limitations does the C client have compared to the Java client?
> - Is there a chance that the C client would become officially supported?
>
> I'm afraid the last one might be a show-stopper as I think it would not be
> acceptable around here to use something marked as experimental in
> production.
>
> I'm not sure how many people are considering to use AMQP from C or C++, but
> I guess there must be enough of them for RabbitMQ to consider supporting
> them officially. At least in finance C/C++ still seems to be used quite a
> lot.
>
> Cheers
> Jiri
>
>
> ----------------------------------------------------------------------------
> Deutsche B?rse Services s.r.o.
> Managing Directors/Gesch?ftsf?hrung:
> Michael Gassmann, Mats Andersson.
> Limited liability company with registered office at
> Vladislavova 1390/17, postal code: 110 00 Prague 1,
> recorded in the Commercial Register IC: 275 77 015.
> Maintained by the city court in Prague,
> Sec. C, File No. 116874.
>
> -----------------------------------------
> Diese E-Mail enthaelt vertrauliche oder rechtlich geschuetzte Informationen.
> Wenn Sie nicht der beabsichtigte Empfaenger sind, informieren Sie bitte
> sofort den Absender und loeschen Sie diese E-Mail. Das unbefugte Kopieren
> dieser E-Mail oder die unbefugte Weitergabe der enthaltenen Informationen
> ist nicht gestattet.
>
> The information contained in this message is confidential or protected by
> law. If you are not the intended recipient, please contact the sender and
> delete this message. Any unauthorised copying of this message or
> unauthorised distribution of the information contained herein is prohibited.
>
> Legally required information for business correspondence/
> Gesetzliche Pflichtangaben fuer Geschaeftskorrespondenz:
> http://deutsche-boerse.com/letterhead
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From jiri at krutil.com  Tue Feb 15 12:41:53 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Tue, 15 Feb 2011 13:41:53 +0100
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
	<AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>
Message-ID: <20110215134153.17841mrw5brha1tw@webmail.active24.cz>

Alex

> Many customers use the C client in production.  The reason it is
> marked as experimental is that we would like to improve it.  How much
> would such plans impact your use?

First I must admit I have no experience with the C client whatsoever.  
I was looking for some documentation, but found just a readme file,  
which mensions some threading issues. I also vaguely remember seeing  
posts mentioning some other limitations in this list.

Maybe the C client is just fine as is. But on the other hand, you may  
have some reasons for not supporting it officially. I was hoping that  
you would honestly tell me what the limitations of the C client are;  
that would help a lot in evaluating its chances around here.

Should you decide to improve it in any way, or more importantly  
embrace it and put a "supported" sticker on it, that would definitely  
help a lot. I assume Deutsche Boerse would be willing to pay for  
official support and it would be quite unfortunate to have a client  
for the main platform excluded from that.

(And of course an object-oriented C++ wrapper around the C client  
would make things easier to use. I don't suppose that anything like  
that exists?)

Jiri


From matthias at rabbitmq.com  Tue Feb 15 12:51:22 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 15 Feb 2011 12:51:22 +0000
Subject: [rabbitmq-discuss] Java client getMessageCount problem
In-Reply-To: <AANLkTikT1ZjLZPQtLNEKCzKQcS4fsaRSCdiyTdQND7Zz@mail.gmail.com>
References: <AANLkTikT1ZjLZPQtLNEKCzKQcS4fsaRSCdiyTdQND7Zz@mail.gmail.com>
Message-ID: <4D5A76CA.8000903@rabbitmq.com>

Isa?as,

On 14/02/11 08:59, Isa?as Espejo Badia wrote:
> I have a queue declared how passive and I am using the getMessageCount
> method but this method return 0 although queue has one element.
> [...]
> is there other way to count the queue elements that show the real
> elements? (elements waiting for ack and when only there is a element)

Messages that have been delivered to a client and are pending 
acknowledgement are not included in the count in queue.declare-ok. 
That's because it would be surprising to, say, get back a count of 1 and 
then find that basic.get returns 'empty'.

You can get the unacked count via 'rabbitmqctl list_queues' or the 
management plugin. It's rarely something that is useful in an 
application since it is so ephemeral. What are you trying to accomplish?


Regards,

Matthias.

From matthias at rabbitmq.com  Tue Feb 15 12:55:58 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 15 Feb 2011 12:55:58 +0000
Subject: [rabbitmq-discuss] AMQP basic_recover
In-Reply-To: <AANLkTikyod5ME8ctTmrSgmRLCs2J-0tOK0-cwLk+mGRp@mail.gmail.com>
References: <AANLkTikyod5ME8ctTmrSgmRLCs2J-0tOK0-cwLk+mGRp@mail.gmail.com>
Message-ID: <4D5A77DE.70703@rabbitmq.com>

On 14/02/11 13:22, Tomas Bartkus wrote:
 > I have tried to use basic_reject($message->getId(), true); and it
 > works, all messages are redelivered.
 >
 > Perhaps I am doing something wrong here regarding basic_recover?

See the recent thread 
http://old.nabble.com/Message-redelivering-doubt-with-one-and-with-more-than-one-consumers.-tt30890632.html, 
which probably answers your question.

Regards,

Matthias.

From alexis at rabbitmq.com  Tue Feb 15 13:11:23 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 15 Feb 2011 13:11:23 +0000
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <20110215134153.17841mrw5brha1tw@webmail.active24.cz>
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
	<AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>
	<20110215134153.17841mrw5brha1tw@webmail.active24.cz>
Message-ID: <AANLkTikh5LzK2pGuxR3ajxtT_ktSNo+BwCLEFK9PXuTq@mail.gmail.com>

Jiri

We are certainly willing to improve the C client and it is something
that is on the "todo" list.  I am not the right person to comment on
the main areas of proposed improvement.  The C client is not covered
by our standard commercial support at present but this is always
evolving and we would also consider custom support arrangements on a
case by case basis -- perhaps we could take that off-list?

Yes there is a C++ wrapper which is here: https://github.com/akalend/amqpcpp

I have cc'd the author, Alexandre.

In relation to performance, as always it comes down to what your use
cases are.  The Rabbit implementation is quite efficient, in most
cases but not all.  What kind of scenarios did you have in mind?

alexis



On Tue, Feb 15, 2011 at 12:41 PM, Jiri Krutil <jiri at krutil.com> wrote:
> Alex
>
>> Many customers use the C client in production. ?The reason it is
>> marked as experimental is that we would like to improve it. ?How much
>> would such plans impact your use?
>
> First I must admit I have no experience with the C client whatsoever. I was
> looking for some documentation, but found just a readme file, which mensions
> some threading issues. I also vaguely remember seeing posts mentioning some
> other limitations in this list.
>
> Maybe the C client is just fine as is. But on the other hand, you may have
> some reasons for not supporting it officially. I was hoping that you would
> honestly tell me what the limitations of the C client are; that would help a
> lot in evaluating its chances around here.
>
> Should you decide to improve it in any way, or more importantly embrace it
> and put a "supported" sticker on it, that would definitely help a lot. I
> assume Deutsche Boerse would be willing to pay for official support and it
> would be quite unfortunate to have a client for the main platform excluded
> from that.
>
> (And of course an object-oriented C++ wrapper around the C client would make
> things easier to use. I don't suppose that anything like that exists?)
>
> Jiri
>
>

From eberhard.wolff at gmail.com  Tue Feb 15 13:23:42 2011
From: eberhard.wolff at gmail.com (Eberhard Wolff)
Date: Tue, 15 Feb 2011 14:23:42 +0100
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
Message-ID: <4D5A7E5E.4060903@gmail.com>

Hi Jiri,

On 15.02.11 12:50, jiri.krutil.ext at deutsche-boerse.com remarked:
> 1. It has a C++ broker which should supposedly be faster than Erlang. I
> personaly don't think that C++ always means faster, but some people here
> do.

Benchmarks are always hard of course but there is the somewhat famous 
comparison of Erlang and C++ at Motorola:

http://www.slideshare.net/Arbow/comparing-cpp-and-erlang-for-motorola-telecoms-software

Erlang was invented for telco applications and I believe the 
characteristics of telco applications are the same as for message 
brokers i.e. high concurrency, high availability etc. So I think the 
prejudice against Erlang's performance is not really justifiable.

Just my 0.02? of course,

Eberhard


-- 
Eberhard Wolff        Contradiction Is Balance         Skype: ebr.wolff
		Blog: http://JandIandMe.blogspot.com/
			


From david at rabbitmq.com  Tue Feb 15 13:51:13 2011
From: david at rabbitmq.com (David Wragg)
Date: Tue, 15 Feb 2011 13:51:13 +0000
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <20110215134153.17841mrw5brha1tw@webmail.active24.cz> (Jiri
	Krutil's message of "Tue, 15 Feb 2011 13:41:53 +0100")
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
	<AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>
	<20110215134153.17841mrw5brha1tw@webmail.active24.cz>
Message-ID: <yrv4ctyg5csoe.fsf@dwragg.eng.vmware.com>

Hi Jiri,

Jiri Krutil <jiri at krutil.com> writes:
> Maybe the C client is just fine as is. But on the other hand, you may
> have some reasons for not supporting it officially. I was hoping that
> you would honestly tell me what the limitations of the C client are;
> that would help a lot in evaluating its chances around here.

The current C client is widely used, and stable, and we fix bugs and add
features to it as issues are reported.

On the other hand, the C client lacks a number of features that can not
be easily added without significant changes to the API it presents
(things like support for nonblocking operation, multiple threads
accessing a single connection, more conventional memory management, SSL
support).  So it is likely that at some point we will introduce a new C
client with a new set of APIs, and phase out our support of the current
C client.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From jiri at krutil.com  Tue Feb 15 13:52:07 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Tue, 15 Feb 2011 14:52:07 +0100
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <AANLkTikh5LzK2pGuxR3ajxtT_ktSNo+BwCLEFK9PXuTq@mail.gmail.com>
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
	<AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>
	<20110215134153.17841mrw5brha1tw@webmail.active24.cz>
	<AANLkTikh5LzK2pGuxR3ajxtT_ktSNo+BwCLEFK9PXuTq@mail.gmail.com>
Message-ID: <20110215145207.114146ntwgqq1rsw@webmail.active24.cz>

Alexis

> We are certainly willing to improve the C client and it is something
> that is on the "todo" list.

That would be great.

> Yes there is a C++ wrapper which is here: https://github.com/akalend/amqpcpp

Will look at it. Did you consider referencing it from  
www.rabbitmq.com/how.html#clients ?

> In relation to performance, as always it comes down to what your use
> cases are.  The Rabbit implementation is quite efficient, in most
> cases but not all.  What kind of scenarios did you have in mind?

Our use case might look like this:
- mostly pub/sub messaging with topic exchanges and word-based binding  
key matching
- few producers and hundreds or thousands of consumers using the same exchange
- no need for persistency or delivery guarantees, no transactions
- mostly auto-acking messages
- message payload usually less than 2 Kb
- relying on order of message delivery to a large extent (but never  
reject or not ack messages)
- we need low latency

Jiri


From alexis at rabbitmq.com  Tue Feb 15 13:58:38 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 15 Feb 2011 13:58:38 +0000
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <20110215145207.114146ntwgqq1rsw@webmail.active24.cz>
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
	<AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>
	<20110215134153.17841mrw5brha1tw@webmail.active24.cz>
	<AANLkTikh5LzK2pGuxR3ajxtT_ktSNo+BwCLEFK9PXuTq@mail.gmail.com>
	<20110215145207.114146ntwgqq1rsw@webmail.active24.cz>
Message-ID: <AANLkTikjX5hfkKbNSXPFH0HAg755i=Ee77UaCX7DUiJM@mail.gmail.com>

Jiri,

On Tue, Feb 15, 2011 at 1:52 PM, Jiri Krutil <jiri at krutil.com> wrote:
> Alexis
>
>> We are certainly willing to improve the C client and it is something
>> that is on the "todo" list.
>
> That would be great.

Indeed.  See David's comments.


>> Yes there is a C++ wrapper which is here:
>> https://github.com/akalend/amqpcpp
>
> Will look at it. Did you consider referencing it from
> www.rabbitmq.com/how.html#clients ?

Good point.


>> In relation to performance, as always it comes down to what your use
>> cases are. ?The Rabbit implementation is quite efficient, in most
>> cases but not all. ?What kind of scenarios did you have in mind?
>
> Our use case might look like this:
> - mostly pub/sub messaging with topic exchanges and word-based binding key
> matching
> - few producers and hundreds or thousands of consumers using the same
> exchange
> - no need for persistency or delivery guarantees, no transactions
> - mostly auto-acking messages
> - message payload usually less than 2 Kb
> - relying on order of message delivery to a large extent (but never reject
> or not ack messages)
> - we need low latency

Understood.

I have three questions:

How low latency?
What ingress rate?
Would pubsub be broadcast (direct/topic exchange) or anycast (shared
queue)?  I assume the former...

alexis

From jiri at krutil.com  Tue Feb 15 14:08:27 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Tue, 15 Feb 2011 15:08:27 +0100
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <AANLkTikjX5hfkKbNSXPFH0HAg755i=Ee77UaCX7DUiJM@mail.gmail.com>
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
	<AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>
	<20110215134153.17841mrw5brha1tw@webmail.active24.cz>
	<AANLkTikh5LzK2pGuxR3ajxtT_ktSNo+BwCLEFK9PXuTq@mail.gmail.com>
	<20110215145207.114146ntwgqq1rsw@webmail.active24.cz>
	<AANLkTikjX5hfkKbNSXPFH0HAg755i=Ee77UaCX7DUiJM@mail.gmail.com>
Message-ID: <20110215150827.6197587wproe6akg@webmail.active24.cz>

Alexis

> How low latency?

Ideally sub-millisecond. We would probably have an in-house farm of  
co-located servers on good network hardware that need to communicate.

> What ingress rate?

Few thousand messages per second max.

> Would pubsub be broadcast (direct/topic exchange) or anycast (shared
> queue)?  I assume the former...

Broadcast using one topic exchange. Each subscriber would have an  
auto-delete exclusive queue with a few different bindings to the  
exchange.


From alexis at rabbitmq.com  Tue Feb 15 14:28:35 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 15 Feb 2011 14:28:35 +0000
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <20110215150827.6197587wproe6akg@webmail.active24.cz>
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
	<AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>
	<20110215134153.17841mrw5brha1tw@webmail.active24.cz>
	<AANLkTikh5LzK2pGuxR3ajxtT_ktSNo+BwCLEFK9PXuTq@mail.gmail.com>
	<20110215145207.114146ntwgqq1rsw@webmail.active24.cz>
	<AANLkTikjX5hfkKbNSXPFH0HAg755i=Ee77UaCX7DUiJM@mail.gmail.com>
	<20110215150827.6197587wproe6akg@webmail.active24.cz>
Message-ID: <AANLkTimCRnNya+YGf9KTOewJEY4jQfDT5ENydMJXqsFk@mail.gmail.com>

Jiri

On Tue, Feb 15, 2011 at 2:08 PM, Jiri Krutil <jiri at krutil.com> wrote:
> Alexis
>
>> How low latency?
>
> Ideally sub-millisecond. We would probably have an in-house farm of
> co-located servers on good network hardware that need to communicate.

Should be ok if you don't swamp the CPU.


>> What ingress rate?
>
> Few thousand messages per second max.

OK, that's well within bounds.


>> Would pubsub be broadcast (direct/topic exchange) or anycast (shared
>> queue)? ?I assume the former...
>
> Broadcast using one topic exchange. Each subscriber would have an
> auto-delete exclusive queue with a few different bindings to the exchange.

What's the typical fanout ratio going to be?

Regarding your use of topics, please read this:
http://www.rabbitmq.com/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1/

alexis

From Alister.Morton at tradition.com  Tue Feb 15 15:23:55 2011
From: Alister.Morton at tradition.com (Alister Morton)
Date: Tue, 15 Feb 2011 15:23:55 +0000
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <20110215145207.114146ntwgqq1rsw@webmail.active24.cz>
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
	<AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>
	<20110215134153.17841mrw5brha1tw@webmail.active24.cz>
	<AANLkTikh5LzK2pGuxR3ajxtT_ktSNo+BwCLEFK9PXuTq@mail.gmail.com>
	<20110215145207.114146ntwgqq1rsw@webmail.active24.cz>
Message-ID: <5A46D132C446C04B9EFE8AD14E78910696B21776CD@SVR-2K3-BH-EMC.tradition.int>

> Yes there is a C++ wrapper which is here: https://github.com/akalend/amqpcpp

Will look at it. Did you consider referencing it from
www.rabbitmq.com/how.html#clients ?

I'm about to look at this - how nicely does it play with Visual Studio (i.e. does it require anything non VS to make it work)?

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.

From moseley at hank.org  Tue Feb 15 15:31:16 2011
From: moseley at hank.org (Bill Moseley)
Date: Tue, 15 Feb 2011 07:31:16 -0800
Subject: [rabbitmq-discuss] Can I get your input for a RabbitMQ cookbook?
In-Reply-To: <913E964B4BC95A4F8644D0E6A8452D9E0DCCB0@EXCH-MBX-3.vmware.com>
References: <913E964B4BC95A4F8644D0E6A8452D9E0DCCB0@EXCH-MBX-3.vmware.com>
Message-ID: <AANLkTik4nDZ3fsyg+=3vPsg4zV=ByzWGRBfqLrb_xt5d@mail.gmail.com>

On Mon, Feb 14, 2011 at 7:12 AM, Jonathan Brisbin <jbrisbin at vmware.com>wrote:

> Would anyone like to express an interest in a particular topic for a
> potential RabbitMQ cookbook project I might be working on? We're
> trying to come up with an outline and I want to make sure it's
> targeted to what people actually want to read about, so if you've got
> an idea about some topic you'd like to see covered, please let me know
> off list.
>
> Some of the topics will be:
>
> Interoperability (STOMP, Celery, etc...)
> Performance tuning
> Plugin authoring
> Configuration
> [Put your topic here]
>
>
These are a few of the topics that have come up at my company while
evaluating RabbitMQ -- some of which I've asked about on this list.  I'm not
sure if all would fit into "cookbook" type of examples.  Most are about how
to operate RabbitMQ in a production environment.

   - High Availability:  How to set up RabbitMQ such that a server failure
   will not disrupt service.
   For example, HAProxy or hardware load balancer.

   - Client connection management: Ensuring that clients gracefully handle
   connection failures.

   - Message durability: Scenarios when/why queue durability is appropriate.

   - Message replication:  When/why/how to replicate messages across brokers
   (e.g. Pacemaker example).
   And if messages are replicated how to prevent multiple consumers from
   processing the same message.

   - Clustering: As others have noted, how to scale RabbitMQ.
   How to add new servers into an active cluster and how to remove a server
   (and dealing with queues on the server that is removed).


As you might note, uptime is important to our company and those are all
about keeping RabbitMQ up and available. Oddly, at our company the message
durability/replication issue consumed the most discussion time -- that is,
making sure that a message produced is always processed[1].  (I think a
better/cleaner approach is to design with message loss in mind and when
needed, producers will re-send a message.)


   - Topic routing: This is covered in the tutorial, but it would be great
   to see some cookbook examples that demonstrate a few real-world scenarios.
   The power of topic routing was a feature that was difficult for some to
   grasp at our company.  Aggregating logs and tracking specific log types
   (e.g. error watchdog) could be one example.

   - Debugging: When things go wrong (and they always do) steps to figure
   out why RabbitMQ is not working, what happened, and how to fix.
   For example: figuring out if Mnesia DB is corrupt and need to remove.
    This is all about the 2am IT on-call person trying to solve a problem by
   following a "play book" of steps to get things running again.

   - Management of consumers: monitoring queue sizes, allocating resources
   to workers, tools available to monitor consumers across multiple machines,
   threaded consumers vs. forking model.

   - RPC in a web environment: This may be outside the scope for RabbitMQ,
   but our use cases have involved the need for RPC style of calls, but in a
   web-environment this is often meant polling by the web client (e.g. via
   AJAX) because it is not desirable to have a web process wait on a RPC
   response.  But, in a polling web environment you cannot rely on the message
   ever being consumed.  What I've done is passed the unique return-queue name
   in the AJAX request and used auto_delete and x-expires on the temporary
   queue to have it removed if the web client fails to fetch the response.
   I'm not convinced that is the best approach.




[1] Message durability was considered so important by some at our company
that we now send all messages to a single consumer that stores them in
Postgresql with Slony replication before being passed onto consumers.  I
would not recommend that approach -- and indeed with experience we've seen
messages that are that critical need to be tracked by the application's
database anyway so making the messages durable adds little benefit.

-- 
Bill Moseley
moseley at hank.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110215/72c5216d/attachment.htm>

From jiri at krutil.com  Tue Feb 15 15:35:14 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Tue, 15 Feb 2011 16:35:14 +0100
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <AANLkTimCRnNya+YGf9KTOewJEY4jQfDT5ENydMJXqsFk@mail.gmail.com>
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
	<AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>
	<20110215134153.17841mrw5brha1tw@webmail.active24.cz>
	<AANLkTikh5LzK2pGuxR3ajxtT_ktSNo+BwCLEFK9PXuTq@mail.gmail.com>
	<20110215145207.114146ntwgqq1rsw@webmail.active24.cz>
	<AANLkTikjX5hfkKbNSXPFH0HAg755i=Ee77UaCX7DUiJM@mail.gmail.com>
	<20110215150827.6197587wproe6akg@webmail.active24.cz>
	<AANLkTimCRnNya+YGf9KTOewJEY4jQfDT5ENydMJXqsFk@mail.gmail.com>
Message-ID: <20110215163514.103330pjt7wjkoqo@webmail.active24.cz>

Alexis

> What's the typical fanout ratio going to be?

Between 1 : 1000 and 1 : 5000.

Jiri


From alexis at rabbitmq.com  Tue Feb 15 15:44:53 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 15 Feb 2011 15:44:53 +0000
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <20110215163514.103330pjt7wjkoqo@webmail.active24.cz>
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
	<AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>
	<20110215134153.17841mrw5brha1tw@webmail.active24.cz>
	<AANLkTikh5LzK2pGuxR3ajxtT_ktSNo+BwCLEFK9PXuTq@mail.gmail.com>
	<20110215145207.114146ntwgqq1rsw@webmail.active24.cz>
	<AANLkTikjX5hfkKbNSXPFH0HAg755i=Ee77UaCX7DUiJM@mail.gmail.com>
	<20110215150827.6197587wproe6akg@webmail.active24.cz>
	<AANLkTimCRnNya+YGf9KTOewJEY4jQfDT5ENydMJXqsFk@mail.gmail.com>
	<20110215163514.103330pjt7wjkoqo@webmail.active24.cz>
Message-ID: <AANLkTimb545iaAUbzpP9v9DXoebL-+-vQtS6aAsRkVWi@mail.gmail.com>

On Tue, Feb 15, 2011 at 3:35 PM, Jiri Krutil <jiri at krutil.com> wrote:
> Alexis
>
>> What's the typical fanout ratio going to be?
>
> Between 1 : 1000 and 1 : 5000.

So if the ingress is, eg, 3,000 mps, the egress might be 3,000,000?
That seems high.

From jiri at krutil.com  Tue Feb 15 15:51:46 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Tue, 15 Feb 2011 16:51:46 +0100
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <AANLkTimb545iaAUbzpP9v9DXoebL-+-vQtS6aAsRkVWi@mail.gmail.com>
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
	<AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>
	<20110215134153.17841mrw5brha1tw@webmail.active24.cz>
	<AANLkTikh5LzK2pGuxR3ajxtT_ktSNo+BwCLEFK9PXuTq@mail.gmail.com>
	<20110215145207.114146ntwgqq1rsw@webmail.active24.cz>
	<AANLkTikjX5hfkKbNSXPFH0HAg755i=Ee77UaCX7DUiJM@mail.gmail.com>
	<20110215150827.6197587wproe6akg@webmail.active24.cz>
	<AANLkTimCRnNya+YGf9KTOewJEY4jQfDT5ENydMJXqsFk@mail.gmail.com>
	<20110215163514.103330pjt7wjkoqo@webmail.active24.cz>
	<AANLkTimb545iaAUbzpP9v9DXoebL-+-vQtS6aAsRkVWi@mail.gmail.com>
Message-ID: <20110215165146.578439avur2ahq80@webmail.active24.cz>

>>> What's the typical fanout ratio going to be?
>>
>> Between 1 : 1000 and 1 : 5000.
>
> So if the ingress is, eg, 3,000 mps, the egress might be 3,000,000?
> That seems high.

Yeah, that's really a lot, but it probably won't be that much. It's  
hard to estimate these things, because the inbound messages that  
appear very often usually have lower fanout ratio. It is not easy to  
estimate this precisely right now.

If the egress would be too high, we could:
- limit the ingress to some extent (reduce price update rate)
- reduce parallelism of the calculation, resulting in fewer consumers  
and lower fanout ratio





From alexis at rabbitmq.com  Tue Feb 15 16:41:11 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 15 Feb 2011 16:41:11 +0000
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <20110215165146.578439avur2ahq80@webmail.active24.cz>
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
	<AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>
	<20110215134153.17841mrw5brha1tw@webmail.active24.cz>
	<AANLkTikh5LzK2pGuxR3ajxtT_ktSNo+BwCLEFK9PXuTq@mail.gmail.com>
	<20110215145207.114146ntwgqq1rsw@webmail.active24.cz>
	<AANLkTikjX5hfkKbNSXPFH0HAg755i=Ee77UaCX7DUiJM@mail.gmail.com>
	<20110215150827.6197587wproe6akg@webmail.active24.cz>
	<AANLkTimCRnNya+YGf9KTOewJEY4jQfDT5ENydMJXqsFk@mail.gmail.com>
	<20110215163514.103330pjt7wjkoqo@webmail.active24.cz>
	<AANLkTimb545iaAUbzpP9v9DXoebL-+-vQtS6aAsRkVWi@mail.gmail.com>
	<20110215165146.578439avur2ahq80@webmail.active24.cz>
Message-ID: <AANLkTimH7ax9xyFaZg++g=y3QxU4vx7WFPcxzfEcA49P@mail.gmail.com>

Well, at this point I should suggest writing a test harness ;-)


On Tue, Feb 15, 2011 at 3:51 PM, Jiri Krutil <jiri at krutil.com> wrote:
>>>> What's the typical fanout ratio going to be?
>>>
>>> Between 1 : 1000 and 1 : 5000.
>>
>> So if the ingress is, eg, 3,000 mps, the egress might be 3,000,000?
>> That seems high.
>
> Yeah, that's really a lot, but it probably won't be that much. It's hard to
> estimate these things, because the inbound messages that appear very often
> usually have lower fanout ratio. It is not easy to estimate this precisely
> right now.
>
> If the egress would be too high, we could:
> - limit the ingress to some extent (reduce price update rate)
> - reduce parallelism of the calculation, resulting in fewer consumers and
> lower fanout ratio
>
>
>
>
>

From Alister.Morton at tradition.com  Tue Feb 15 16:56:58 2011
From: Alister.Morton at tradition.com (Alister Morton)
Date: Tue, 15 Feb 2011 16:56:58 +0000
Subject: [rabbitmq-discuss] Is the C client a show-stopper for rabbit?
In-Reply-To: <AANLkTimH7ax9xyFaZg++g=y3QxU4vx7WFPcxzfEcA49P@mail.gmail.com>
References: <OFFDD96895.04F03445-ONC1257838.003E95DB-C1257838.00411706@deutsche-boerse.com>
	<AANLkTikq6dz-OXDNLcqzSZi3xjPsRbb14ObONXmoKUe=@mail.gmail.com>
	<20110215134153.17841mrw5brha1tw@webmail.active24.cz>
	<AANLkTikh5LzK2pGuxR3ajxtT_ktSNo+BwCLEFK9PXuTq@mail.gmail.com>
	<20110215145207.114146ntwgqq1rsw@webmail.active24.cz>
	<AANLkTikjX5hfkKbNSXPFH0HAg755i=Ee77UaCX7DUiJM@mail.gmail.com>
	<20110215150827.6197587wproe6akg@webmail.active24.cz>
	<AANLkTimCRnNya+YGf9KTOewJEY4jQfDT5ENydMJXqsFk@mail.gmail.com>
	<20110215163514.103330pjt7wjkoqo@webmail.active24.cz>
	<AANLkTimb545iaAUbzpP9v9DXoebL-+-vQtS6aAsRkVWi@mail.gmail.com>
	<20110215165146.578439avur2ahq80@webmail.active24.cz>
	<AANLkTimH7ax9xyFaZg++g=y3QxU4vx7WFPcxzfEcA49P@mail.gmail.com>
Message-ID: <5A46D132C446C04B9EFE8AD14E78910696B2177748@SVR-2K3-BH-EMC.tradition.int>

> I know, but the C++ client is not built by us - it's a community project.

Yes, and while I appreciate that fact, there's probably a big market out there for a "properly" supported C++ client.

This seems to be a bit of a blind spot for a lot of projects which begin life on linux platforms - here's a huge windows base out there (as you recognise with your .NET client) for whom ruby, python, perl etc are anathema, and they would love to use the tools that are out there but can't.

It's also something I'm mildly concerned about with RabbitMQ's reliance on Erlang/OTP - where is the 64 bit windows OTP?

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.

From irrer at umich.edu  Tue Feb 15 17:20:04 2011
From: irrer at umich.edu (Jim Irrer)
Date: Tue, 15 Feb 2011 12:20:04 -0500
Subject: [rabbitmq-discuss] Massive distributed pub/sub system
In-Reply-To: <AANLkTi=dUObt7azQRystVBOGLEk=_69NczfoceOKeCO8@mail.gmail.com>
References: <AANLkTikD2fMdS_sdc8cRvEWCQeyL2PyP7KVFf5ncwXme@mail.gmail.com>
	<4D4189F4.6010609@rabbitmq.com>
	<AANLkTimCxsRP4ceCGbErPpr0W3n_MOM7j5MFiMHz4SNp@mail.gmail.com>
	<AANLkTi=dUObt7azQRystVBOGLEk=_69NczfoceOKeCO8@mail.gmail.com>
Message-ID: <AANLkTi=DSEokyxhGjCFP3ykMGmdo9mN7EpD=iJQ31E2V@mail.gmail.com>

BTW - Thanks for the article reference.  That helped.

The only real disadvantage to AMQP is not monitoring
whether clients are present/active or not, and that
requirement is application specific.

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Jan 28, 2011 at 7:51 AM, Jim Apperly <jim at rabbitmq.com> wrote:

> On 27 January 2011 19:25, Jim Irrer <irrer at umich.edu> wrote:
>
>> Would XMPP be more appropriate for this application?  I'm not real
>> familiar with it but I've heard that it has different strengths than AMQP.
>> I'm interested in the pros and cons.
>>
>
> This may help shed some light:
>
> http://www.opensourcery.co.za/2009/04/19/to-amqp-or-to-xmpp-that-is-the-question/
>
> Jim
>
>
>
> Thanks,
>>
>> - Jim
>>
>> Jim Irrer     irrer at umich.edu       (734) 647-4409
>> University of Michigan Hospital Radiation Oncology
>> 519 W. William St.             Ann Arbor, MI 48103
>>
>>
>>
>> On Thu, Jan 27, 2011 at 10:06 AM, Michael Bridgen <mikeb at rabbitmq.com>wrote:
>>
>>> Hi Kaiduan,
>>>
>>> Your questions suggest you're attempting something very interesting,
>>> which I would love to hear more about.  Federation and distribution are very
>>> much on our minds here at Rabbit Towers, as you might imagine.
>>>
>>> In the meantime ---
>>>
>>>
>>>  1) Any user can subscribe to the interested topic, but only topic
>>>> owner can publish message to the group. There is no limit on the
>>>> number of subscribers in each group. Potentially it can be huge, for
>>>> example, the fans of U2 around the world.
>>>>
>>>
>>> Is there anything that determines who can own topics?  For example, is it
>>> just the first person to declare a topic that is the exclusive publisher to
>>> that topic?  Can the publishing rights, so to speak, be handed to another
>>> publisher?
>>>
>>>
>>>  2) User including subscriber and publisher is not always connected to
>>>> the system, and not always connected to the same node in the system,
>>>> and the message delivery should be guaranteed. When publisher
>>>> publishes a message, the system should deliver the message to all
>>>> subscribers. If the subscriber is connected to the system, the message
>>>> should be delivered immediately. If the subscriber is not connected,
>>>> system should hold the message, and the next time the user comes
>>>> connected, system will deliver the message to the user. Just imagine
>>>> the user can be any mobile user and moves out of cellular coverage.
>>>>
>>>
>>> So far as I know, this is still an area of active research.  Typically,
>>> distributed pub/sub systems like Scribe and Hermes give rather weak
>>> guarantees of delivery and ordering and so on.
>>>
>>> In particular, "If the subscriber is not connected, system should hold
>>> the message, and the next time the user comes connected, system will deliver
>>> the message to the user" is difficult if the subscriber can connect to any
>>> node, and I don't think most pub/sub systems would allow that.
>>>
>>>
>>>  3) The system should be able to support tens to hundreds of millions
>>>> users spreading around the world, so the system will consist hundred
>>>> of nodes located in different physical locations.
>>>>
>>>
>>> This is rather ambitious.  But systems on this kind of scale are indeed
>>> being built: http://ci.oceanobservatories.org/ for instance.
>>>
>>>
>>>  4) The number of topics/groups in the system is unlimited.
>>>>
>>>> 5) As to the latency, it should be in the range of 1 minute if
>>>> subscriber is connected.
>>>>
>>>> It looks like RabbitMQ already has functionalities to meet the above
>>>> requirement, for example, fan out exchange, and persistent message.
>>>> The following is my understanding on how to build the above system
>>>> with RabbitMQ,
>>>>
>>>
>>> Perhaps, in the sense that it can be a building block.  But it doesn't
>>> fulfill all the requirements you've given above, "out of the box".  In other
>>> words, you (or we) would have to invent a substantial part of the
>>> technology.
>>>
>>>
>>>  a) Publisher creates an exchange. For example, U2 creates an exchange
>>>> noted as "U2" for "U2's next world wide tour" on Node 1.
>>>>
>>>> b) Each subscriber creates a queue in the system. For example, Alice
>>>> creates a queue noted as "Alice" on Node 2 and binds to exchange U2;
>>>> and Bob creates a queue noted as "Bob" on Node 3 and binds to exchange
>>>> "U2" on Node 2.
>>>>
>>>> c) U2 publishes a message, m1 on Node 1 to exchange "U2"; and RabbitMQ
>>>> will deliver the message m1 to queue "Alice" on Node 2 and to queue
>>>> "Bob" on Node 3.
>>>>
>>>> How we handles the following scenarios?
>>>>
>>>> 1) When U2 wants to publish a message, but Node 1 is done.
>>>>
>>>> 2) When message m1 is delivered to queue "Alice" on Node 2, Node 2
>>>> crashed or the network link between Node 1 (publisher's node) is
>>>> disconnected? Will exchange "U2" on Node 1 persist the message?
>>>>
>>>
>>> No; the message will be lost so far as Alice is concerned.  In AMQP
>>> terms, you're asking for queues to be replicated.  Rabbit doesn't do this,
>>> yet.
>>>
>>> (Actually, we are working on queue replication right now.  I think you
>>> would need both replication and some kind of queue migration or
>>> distribution.)
>>>
>>>
>>>  3) After message m1 is arrived on queue "Alice", but the connection
>>>> between Alice and Node 2 is gone, the message will be stored on Node
>>>> 2, right? Next time, Alice connects to the system, but she is
>>>> connected to Node n instead of Node 2, how to handle this?
>>>>
>>>
>>> In Rabbit's clustering as it works now, the messages will be delivered
>>> across the cluster to Node n.
>>>
>>>
>>>  4) What is the multi-cast technology used in RabbitMQ to deliver the
>>>> message to queues located on different locations spreading around
>>>> different countries?
>>>>
>>>
>>> There isn't any right now.  Clustering is really for nodes that are
>>> co-located and have reliable connections.  It uses Erlang's distribution
>>> mechanism, which essentially forms a fully-connected graph of nodes.  It
>>> doesn't really scale beyond a handful of nodes.
>>>
>>> There /is/ a plugin called the "shovel", which will relay messages from
>>> one broker to another.  However, it is statically configured, and
>>> constrained by using AMQP to do the relaying (i.e., you cannot tell it to
>>> relay all messages from a direct exchange; only to relay, e.g., messages
>>> with a particular routing key).
>>>
>>>
>>> Regards,
>>> Michael
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110215/65fa7334/attachment.htm>

From mdecourci at googlemail.com  Tue Feb 15 17:48:34 2011
From: mdecourci at googlemail.com (Michael De Courci)
Date: Tue, 15 Feb 2011 17:48:34 +0000
Subject: [rabbitmq-discuss] rabbitMq use of the setcookie option
Message-ID: <AANLkTi=WO2CQGLvjeUG=JW1H-j1Zp5xZyNjpU7mSbM=5@mail.gmail.com>

We are trying to understand how cookies are used with Rabbit MQ, from my
understanding;
1) Rabbit MQ servers (rabbitmq-server or rabbitmq-server.bat) can be started
without the "setcookie" option, in this case they will use the cookie
defined in the .erlang.cookie file in the user home folder.  If all Rabbit
MQ servers share the same cookie or .erlang.cookie file, then they can
communicate

2) Rabbit MQ servers (rabbitmq-server or rabbitmq-server.bat) can be started
with the same "setcookie" option, for example, setcookie "FREDABC", where "
FREDABC" is the shared cookie used to communicate.

Q) What happens when servers use setcookie cookie, see
http://www.rabbitmq.com/clustering.html#setup, is cookie a variable in the
script, or is this a misunderstanding ?


-- 
Regards
Michael de Courci
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110215/63ca9237/attachment.htm>

From m at mlcastle.net  Wed Feb 16 01:49:13 2011
From: m at mlcastle.net (mike castleman)
Date: Tue, 15 Feb 2011 20:49:13 -0500
Subject: [rabbitmq-discuss] rabbitmq-c and amqp_send_frame_to
Message-ID: <4D5B2D19.6000000@mlcastle.net>

hi,

As previously mentioned, I'm trying to abuse the C librabbitmq in order
to develop an AMQP application in an event-based manner.

Tony Garnock-Jones' rais project has been helpful here, but it seems
that in order to send frames to an output buffer, it makes use of the
amqp_send_frame_to() function. However, it looks like[1] this function
has been eliminated from librabbitmq last October.

Is there any chance of amqp_send_frame_to() coming back? Or is there any
other suggested way to make librabbitmq construct a frame without
immediately sending it onto the socket?

It is possible that for our application the frames are generally going
to be small, so we might only call amqp_send_frame() when the socket is
ready for writing and hope that the send() call inside there won't ever
block (or return EWOULDBLOCK). But this seems fragile, to say the least.

thanks a lot,
mlc

[1]
https://github.com/rabbitmq/rabbitmq-c/commit/e50a94ba2fd471c61509ed3120f42d4506d99ffb

From jeffh at delasco.com  Wed Feb 16 05:14:18 2011
From: jeffh at delasco.com (Jeff Hinrichs)
Date: Tue, 15 Feb 2011 23:14:18 -0600
Subject: [rabbitmq-discuss] looking for a javascript library recommendation
Message-ID: <AANLkTimKCJCx=j5k4mEe4XRoE1TVvyahyprrSnOR16DE@mail.gmail.com>

Looking for recommendations for js libraries to communicate with RabbitMQ.

expected usage patterns: Topic based exchanges, mostly consuming, some rpc
desirable attributes: fewer dependencies are a plus,  no problems
co-existing with jquery, actively developed, good community/docs

Best,

-Jeff
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110215/98fa391a/attachment-0001.htm>

From rtrlists at googlemail.com  Wed Feb 16 09:46:10 2011
From: rtrlists at googlemail.com (Robert Raschke)
Date: Wed, 16 Feb 2011 09:46:10 +0000
Subject: [rabbitmq-discuss] rabbitMq use of the setcookie option
In-Reply-To: <AANLkTi=WO2CQGLvjeUG=JW1H-j1Zp5xZyNjpU7mSbM=5@mail.gmail.com>
References: <AANLkTi=WO2CQGLvjeUG=JW1H-j1Zp5xZyNjpU7mSbM=5@mail.gmail.com>
Message-ID: <AANLkTikS8gg3OSP-8_dF16W_kNA577z5hH7tGHK85OjZ@mail.gmail.com>

Hi Michael,

On Tue, Feb 15, 2011 at 5:48 PM, Michael De Courci <mdecourci at googlemail.com
> wrote:

> We are trying to understand how cookies are used with Rabbit MQ, from my
> understanding;
> 1) Rabbit MQ servers (rabbitmq-server or rabbitmq-server.bat) can be
> started without the "setcookie" option, in this case they will use the
> cookie defined in the .erlang.cookie file in the user home folder.  If all
> Rabbit MQ servers share the same cookie or .erlang.cookie file, then they
> can communicate
>
> 2) Rabbit MQ servers (rabbitmq-server or rabbitmq-server.bat) can be
> started with the same "setcookie" option, for example, setcookie "FREDABC",where "
> FREDABC" is the shared cookie used to communicate.
>
> Q) What happens when servers use setcookie cookie, see
> http://www.rabbitmq.com/clustering.html#setup, is cookie a variable in the
> script, or is this a misunderstanding ?
>
>
Cookies in Erlang are used by the distributed communication system between
nodes; that is, in Erlang, not AMQP. If you start several Erlang nodes, then
they can only "see" each other and send messages to each other if their
cookies match.

It is something that sits underneath RabbitMQ as part of the Erlang
infrastructure.

If you want to delve deeper, you can find more information here:
http://www.erlang.org/doc/reference_manual/distributed.html#id80929 ,
http://www.erlang.org/doc/man/erlang.html#set_cookie-2 .

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110216/85c5586a/attachment.htm>

From gramatron at gmail.com  Wed Feb 16 07:45:16 2011
From: gramatron at gmail.com (z0r1k)
Date: Tue, 15 Feb 2011 23:45:16 -0800 (PST)
Subject: [rabbitmq-discuss] Old version of php-rabbit from
	http://code.google.com/p/php-rabbit/
Message-ID: <f5a713dd-3e37-4365-aee6-196cc3223e98@r21g2000yqd.googlegroups.com>

Hi all,

I'm maintaining old project which is using php-rabbit and we need to
move it to another server.
The problem is that we should build php-rabbit PHP library, but we
cannot get source code from google code.

We've installed http://pecl.php.net/package/amqp but app is still not
working.
I assume that it's because API/Class structure was changed. Our
instance using "AMQPConnect" class but on php.net I found that now
"AMQPConnection" class assumed to be used.

Any way how we could get source code to build old version of php
module?

Thanks in advance.

BR,
Michael

From david at rabbitmq.com  Wed Feb 16 11:26:16 2011
From: david at rabbitmq.com (David Wragg)
Date: Wed, 16 Feb 2011 11:26:16 +0000
Subject: [rabbitmq-discuss] rabbitmq-c and amqp_send_frame_to
In-Reply-To: <4D5B2D19.6000000@mlcastle.net> (mike castleman's message of
	"Tue, 15 Feb 2011 20:49:13 -0500")
References: <4D5B2D19.6000000@mlcastle.net>
Message-ID: <yrv4cpqqscjaf.fsf@dwragg.eng.vmware.com>

Hi Mike,

mike castleman <m at mlcastle.net> writes:
> Is there any chance of amqp_send_frame_to() coming back? Or is there any
> other suggested way to make librabbitmq construct a frame without
> immediately sending it onto the socket?
>
> It is possible that for our application the frames are generally going
> to be small, so we might only call amqp_send_frame() when the socket is
> ready for writing and hope that the send() call inside there won't ever
> block (or return EWOULDBLOCK). But this seems fragile, to say the
> least.

rabbitmq-c development is focused on its use as a self-contained AMQP
client. We try to preserve the API functions aimed at typical AMQP
client applications, rather than ones that seem more like librabbitmq
internals (as this makes evolving the library difficult - librabbitmq
exposes way too much of its internals, IMHO).

(There's a trade-off in library design, particularly for C: One option
is that library can expose clearly designated public APIs.  The upside
is that further development of that library is easy - you simply have to
make sure that you preserve the APIs an their behaviour.  The downside
is that the library can only really support the use cases envisaged when
those APIs were designed.  The other option is to expose more or less
everything, and allow applications to use the library as a "toolbox".
The upside here is that is it probably possible to make the library
serve a wide range of use cases, as applications can borrow whatever
functionality is relevant and ignore the rest.  The downside is that
this tends to freeze the implementation, and would make it difficult to
provide good documentation.)

Perhaps the appropriate thing is to fork a version of rabbitmq-c that
meets your needs on github?

With that said, if we received a nice patch that restored
amqp_send_from_to (and we'd need the author to sign our contributor
agreement), I expect we would incoporate that.  But I can't promise that
we wouldn't remove the function again later on.

As I may have mentioned before, it is our goal to release a C client
that does support non-blocking support nicely at some point in the
future.  But this is likely to be done by having an API specifically
designed for that use case.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From alfonso.pantoja at gmail.com  Wed Feb 16 14:27:44 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Wed, 16 Feb 2011 15:27:44 +0100
Subject: [rabbitmq-discuss] Message redelivering doubt with one and with
 more than one consumers.
In-Reply-To: <20110214233853.GB2366@dakota.doc.ic.ac.uk>
References: <AANLkTim96T8TGNP7QKW31GXyUU8_r=55dFJ07rrCrxZ=@mail.gmail.com>
	<20110214180612.GC2368@dakota.doc.ic.ac.uk>
	<AANLkTikomXB8JX65s6oz_XhOYL8RoXMfRg7W-bg9kNkB@mail.gmail.com>
	<20110214233853.GB2366@dakota.doc.ic.ac.uk>
Message-ID: <AANLkTiky106QB=8cDPEqNKaBT8TE26j55wEO30XBWt7C@mail.gmail.com>

Thank you very much Alex.

It is always very interesting (and useful) to know how external
commands affects to the server behavior :)

Regards,


Alfonso



2011/2/15 Alexandru Scvor?ov <alexandru at rabbitmq.com>:

> It depends. ?For instance, from the broker's point of view, there's no
> difference in overhead between un-ack'd messages and undelivered
> messages. ?Rejecting{requeue=false} and ack'ing messages will free up
> some RAM and some disk space.
>
> It's probably good practice to tell the broker what it should do with
> the messages as soon as possible, but it doesn't matter that much. ?If
> the broker starts running out of RAM, it will write more messages to
> disk. ?If it's really running low on RAM, it will throttle publishers.
>

From Denis.Conan at telecom-sudparis.eu  Wed Feb 16 14:52:51 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Wed, 16 Feb 2011 15:52:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
In-Reply-To: <4D5513B9.1010202@rabbitmq.com>
References: <4D51392F.8000508@telecom-sudparis.eu>
	<4D5513B9.1010202@rabbitmq.com>
Message-ID: <4D5BE4C3.9030004@telecom-sudparis.eu>

Le 11/02/2011 11:47, Simon MacMullen a ?crit :
> Hi Denis.
>
> On 08/02/11 12:38, Denis Conan wrote:
>> my objective is to run the Java Client on Android.
>>
>> Do not hesitate to tell me if I started off with the wrong idea.
>
> That's... not unreasonable. We don't guarantee that the Java client will
> run on Android (in particular we don't test it).

Hello,

thank you for your detailed answer and for the patch (not already tested).

Are you willing to consider the support of Android Java clients in the future? 
or do you consider that AMQP clients for smartphones are out of the scope of 
RabbitMQ target?

>> I didn't see any specific release for Android. So, I took the Java
>> Client for J2SE. I was able to adapt the previous version 2.2.0 of the
>> Java Client for running on Android: removal of packages json and
>> jsonrpc, and correct a call to super in the constructor of the class
>> PossibleAuthenticationFailureException.
>
> Ironically I think that might be fixed in 2.3.1 (it was also
> incompatible with Java 1.5).

Yes, of course, I have noticed the change.

>> As I see, the new version 2.3.1 now has authentication with SASL.
>> Unfortunately, there is no package javax.security.sasl in Android JRE.
>> So, I tried to manage this lack by replacing the classes of this package
>> by the ones in aSMACK (http://code.google.com/p/asmack/). The
>> compilation is ok, but the execution throws the following exception.
>
> ...but it would be a pity if the introduction of more SASL mechanisms
> were to make it unusable on Android.
>
>> java.io.IOException: No compatible authentication mechanism found -
>> server offered [PLAIN AMQPLAIN]
>
> So whatever SASL implementation you've cooked up somehow does not
> support PLAIN (I would not expect it to support AMQPLAIN).
>
> This seems odd, as it looks like Smack contains support for PLAIN:
>
> http://code.google.com/p/asmack/source/browse/src/custom/de/measite/smack/SaslClientFactory.java

If it seems odd to you, then I need to investigate more. I will let you know if 
more successful.

> If you can't get this working, then you can of course stick with the
> 2.2.0 client and an upgraded server. But being stuck with an old client
> isn't fun, so I'll have a think about how easy it would be to patch the
> old homebrew SASL back in for Android.
>
> Cheers, Simon
>

Cheers

-- 
Denis Conan

From jerryk at vmware.com  Wed Feb 16 17:40:59 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 16 Feb 2011 09:40:59 -0800
Subject: [rabbitmq-discuss] rabbitMq use of the setcookie option
In-Reply-To: <AANLkTikS8gg3OSP-8_dF16W_kNA577z5hH7tGHK85OjZ@mail.gmail.com>
References: <AANLkTi=WO2CQGLvjeUG=JW1H-j1Zp5xZyNjpU7mSbM=5@mail.gmail.com>,
	<AANLkTikS8gg3OSP-8_dF16W_kNA577z5hH7tGHK85OjZ@mail.gmail.com>
Message-ID: <F78BCF638F95D74A99D036114107EDB5023948CE49@EXCH-MBX-3.vmware.com>

> Cookies in Erlang are used by the distributed communication system
> between nodes; that is, in Erlang, not AMQP. If you start several
> Erlang nodes, then they can only "see" each other and send messages to
> each other if their cookies match.
>
> It is something that sits underneath RabbitMQ as part of the Erlang
> infrastructure.
>
> If you want to delve deeper, you can find more information here:
> http://www.erlang.org/doc/reference_manual/distributed.html#id80929 ,
> http://www.erlang.org/doc/man/erlang.html#set_cookie-2 .

Michael:

What Robby says is correct; I'd like to add that if you're interested
in knowing more about how some of the Erlang and OTP stuff that
underlies RabbitMQ works the following book from Manning may be useful
to you:

http://www.manning.com/logan/

In particular, chapter 8 introduces the use of Erlang in distributed
programming, including fairly careful discussion of cookies,
connecting nodes, resource discovery, etc.  Giving it a read might
dispel some of the mystery around these issues in a Rabbit context.
You might also find the treatment a bit more clear and leisurely than
some of the core Erlang documentation.

Best regards,
Jerry

From simon at rabbitmq.com  Wed Feb 16 19:05:07 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 16 Feb 2011 19:05:07 +0000
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
In-Reply-To: <4D5BE4C3.9030004@telecom-sudparis.eu>
References: <4D51392F.8000508@telecom-sudparis.eu>
	<4D5513B9.1010202@rabbitmq.com>
	<4D5BE4C3.9030004@telecom-sudparis.eu>
Message-ID: <4D5C1FE3.7090404@rabbitmq.com>

On 16/02/2011 2:52PM, Denis Conan wrote:
> Are you willing to consider the support of Android Java clients in the
> future? or do you consider that AMQP clients for smartphones are out of
> the scope of RabbitMQ target?

Good question. It seems that the existing Java client is close enough to 
being Android compatible that it would be a pity not to. On the other 
hand, I don't think any of us have experience with Android development 
so there may be subtleties I'm missing. We're looking into it at the moment.

Cheers, Simon

From alexis at rabbitmq.com  Wed Feb 16 19:47:51 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 16 Feb 2011 19:47:51 +0000
Subject: [rabbitmq-discuss] looking for a javascript library
	recommendation
In-Reply-To: <AANLkTimKCJCx=j5k4mEe4XRoE1TVvyahyprrSnOR16DE@mail.gmail.com>
References: <AANLkTimKCJCx=j5k4mEe4XRoE1TVvyahyprrSnOR16DE@mail.gmail.com>
Message-ID: <AANLkTi=8BH_vsj9mVNg4bpxcEC9KPCgz-iYD6PCAYsGE@mail.gmail.com>

Jeff

I shan't dare to recommend something but you might want to consider:
http://www.rabbitmq.com/blog/2010/11/12/rabbitmq-nodejs-rabbitjs/

I am not sure if this addresses your needs.  If it does not then let
us know, since there are other options.

alexis


On Wed, Feb 16, 2011 at 5:14 AM, Jeff Hinrichs <jeffh at delasco.com> wrote:
> Looking for recommendations for js libraries to communicate with RabbitMQ.
> expected usage patterns: Topic based exchanges, mostly consuming, some rpc
> desirable attributes: fewer?dependencies?are a plus, ?no problems
> co-existing with jquery, actively developed, good community/docs
> Best,
> -Jeff
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From max.bridgewater at gmail.com  Wed Feb 16 19:58:29 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Wed, 16 Feb 2011 14:58:29 -0500
Subject: [rabbitmq-discuss] looking for a javascript library
	recommendation
In-Reply-To: <AANLkTi=8BH_vsj9mVNg4bpxcEC9KPCgz-iYD6PCAYsGE@mail.gmail.com>
References: <AANLkTimKCJCx=j5k4mEe4XRoE1TVvyahyprrSnOR16DE@mail.gmail.com>
	<AANLkTi=8BH_vsj9mVNg4bpxcEC9KPCgz-iYD6PCAYsGE@mail.gmail.com>
Message-ID: <AANLkTi=kYajyrqfxH8B5RkxKxMOv8LD137w+n1PU5_KC@mail.gmail.com>

Alex,

It seems to me that Jeff is looking for a Javascript client for
RabbitMQ. Nodejs, however is server side. Am I maybe misunderstanding
something?

Max.

On Wed, Feb 16, 2011 at 2:47 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Jeff
>
> I shan't dare to recommend something but you might want to consider:
> http://www.rabbitmq.com/blog/2010/11/12/rabbitmq-nodejs-rabbitjs/
>
> I am not sure if this addresses your needs. ?If it does not then let
> us know, since there are other options.
>
> alexis
>
>
> On Wed, Feb 16, 2011 at 5:14 AM, Jeff Hinrichs <jeffh at delasco.com> wrote:
>> Looking for recommendations for js libraries to communicate with RabbitMQ.
>> expected usage patterns: Topic based exchanges, mostly consuming, some rpc
>> desirable attributes: fewer?dependencies?are a plus, ?no problems
>> co-existing with jquery, actively developed, good community/docs
>> Best,
>> -Jeff
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alexis at rabbitmq.com  Wed Feb 16 20:00:13 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 16 Feb 2011 20:00:13 +0000
Subject: [rabbitmq-discuss] looking for a javascript library
	recommendation
In-Reply-To: <AANLkTi=kYajyrqfxH8B5RkxKxMOv8LD137w+n1PU5_KC@mail.gmail.com>
References: <AANLkTimKCJCx=j5k4mEe4XRoE1TVvyahyprrSnOR16DE@mail.gmail.com>
	<AANLkTi=8BH_vsj9mVNg4bpxcEC9KPCgz-iYD6PCAYsGE@mail.gmail.com>
	<AANLkTi=kYajyrqfxH8B5RkxKxMOv8LD137w+n1PU5_KC@mail.gmail.com>
Message-ID: <AANLkTimn239JwnkgyMqGGHbrRVppsq6avqfKzebSnoMP@mail.gmail.com>

Max - thank-you.

Jeff,

How about - http://www.rabbitmq.com/plugins.html#rabbitmq-jsonrpc-channel
?

alexis


On Wed, Feb 16, 2011 at 7:58 PM, Max Bridgewater
<max.bridgewater at gmail.com> wrote:
> Alex,
>
> It seems to me that Jeff is looking for a Javascript client for
> RabbitMQ. Nodejs, however is server side. Am I maybe misunderstanding
> something?
>
> Max.
>
> On Wed, Feb 16, 2011 at 2:47 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> Jeff
>>
>> I shan't dare to recommend something but you might want to consider:
>> http://www.rabbitmq.com/blog/2010/11/12/rabbitmq-nodejs-rabbitjs/
>>
>> I am not sure if this addresses your needs. ?If it does not then let
>> us know, since there are other options.
>>
>> alexis
>>
>>
>> On Wed, Feb 16, 2011 at 5:14 AM, Jeff Hinrichs <jeffh at delasco.com> wrote:
>>> Looking for recommendations for js libraries to communicate with RabbitMQ.
>>> expected usage patterns: Topic based exchanges, mostly consuming, some rpc
>>> desirable attributes: fewer?dependencies?are a plus, ?no problems
>>> co-existing with jquery, actively developed, good community/docs
>>> Best,
>>> -Jeff
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From jeffh at delasco.com  Wed Feb 16 20:59:31 2011
From: jeffh at delasco.com (Jeff Hinrichs)
Date: Wed, 16 Feb 2011 14:59:31 -0600
Subject: [rabbitmq-discuss] looking for a javascript library
	recommendation
In-Reply-To: <AANLkTikem-MpC_Z=Q3r+PNW10nXKZ6HRs=Cb+s=tn2O3@mail.gmail.com>
References: <AANLkTimKCJCx=j5k4mEe4XRoE1TVvyahyprrSnOR16DE@mail.gmail.com>
	<AANLkTi=8BH_vsj9mVNg4bpxcEC9KPCgz-iYD6PCAYsGE@mail.gmail.com>
	<AANLkTi=kYajyrqfxH8B5RkxKxMOv8LD137w+n1PU5_KC@mail.gmail.com>
	<AANLkTimn239JwnkgyMqGGHbrRVppsq6avqfKzebSnoMP@mail.gmail.com>
	<AANLkTikem-MpC_Z=Q3r+PNW10nXKZ6HRs=Cb+s=tn2O3@mail.gmail.com>
Message-ID: <AANLkTikVDpQyLeCii3pekAtJtk7s7F6Q-QT2WdnFczgE@mail.gmail.com>

On Wed, Feb 16, 2011 at 2:58 PM, Jeff Hinrichs <jeffh at delasco.com> wrote:

>
> -Jeff
>
>
>
> On Wed, Feb 16, 2011 at 2:00 PM, Alexis Richardson <alexis at rabbitmq.com>wrote:
>
>> Max - thank-you.
>>
>> Jeff,
>>
>> How about - http://www.rabbitmq.com/plugins.html#rabbitmq-jsonrpc-channel
>> ?
>>
>> alexis
>
>
> Alexis,
Thanks for your suggestions.  I took a look but didn't see any examples or
articles about interacting with the jsonrpc/rabbmitmq channel.  I'm off to
google for them now.  If you have any handy, I would appreciate it!

Best,
Jeff

> Jeff
>
>>
>> On Wed, Feb 16, 2011 at 7:58 PM, Max Bridgewater
>> <max.bridgewater at gmail.com> wrote:
>> > Alex,
>> >
>> > It seems to me that Jeff is looking for a Javascript client for
>> > RabbitMQ. Nodejs, however is server side. Am I maybe misunderstanding
>> > something?
>> >
>> > Max.
>> >
>> > On Wed, Feb 16, 2011 at 2:47 PM, Alexis Richardson <alexis at rabbitmq.com>
>> wrote:
>> >> Jeff
>> >>
>> >> I shan't dare to recommend something but you might want to consider:
>> >> http://www.rabbitmq.com/blog/2010/11/12/rabbitmq-nodejs-rabbitjs/
>> >>
>> >> I am not sure if this addresses your needs.  If it does not then let
>> >> us know, since there are other options.
>> >>
>> >> alexis
>> >>
>> >>
>> >> On Wed, Feb 16, 2011 at 5:14 AM, Jeff Hinrichs <jeffh at delasco.com>
>> wrote:
>> >>> Looking for recommendations for js libraries to communicate with
>> RabbitMQ.
>> >>> expected usage patterns: Topic based exchanges, mostly consuming, some
>> rpc
>> >>> desirable attributes: fewer dependencies are a plus,  no problems
>> >>> co-existing with jquery, actively developed, good community/docs
>> >>> Best,
>> >>> -Jeff
>> >>>
>> >>>
>> >>> _______________________________________________
>> >>> rabbitmq-discuss mailing list
>> >>> rabbitmq-discuss at lists.rabbitmq.com
>> >>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >>>
>> >>>
>> >> _______________________________________________
>> >> rabbitmq-discuss mailing list
>> >> rabbitmq-discuss at lists.rabbitmq.com
>> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >>
>> >
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110216/2e533923/attachment.htm>

From alexis at rabbitmq.com  Wed Feb 16 21:29:32 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 16 Feb 2011 21:29:32 +0000
Subject: [rabbitmq-discuss] looking for a javascript library
	recommendation
In-Reply-To: <AANLkTikVDpQyLeCii3pekAtJtk7s7F6Q-QT2WdnFczgE@mail.gmail.com>
References: <AANLkTimKCJCx=j5k4mEe4XRoE1TVvyahyprrSnOR16DE@mail.gmail.com>
	<AANLkTi=8BH_vsj9mVNg4bpxcEC9KPCgz-iYD6PCAYsGE@mail.gmail.com>
	<AANLkTi=kYajyrqfxH8B5RkxKxMOv8LD137w+n1PU5_KC@mail.gmail.com>
	<AANLkTimn239JwnkgyMqGGHbrRVppsq6avqfKzebSnoMP@mail.gmail.com>
	<AANLkTikem-MpC_Z=Q3r+PNW10nXKZ6HRs=Cb+s=tn2O3@mail.gmail.com>
	<AANLkTikVDpQyLeCii3pekAtJtk7s7F6Q-QT2WdnFczgE@mail.gmail.com>
Message-ID: <AANLkTinn_-Ss__2s5U2wZpR43k2o-pdHvyTi4Cwx535D@mail.gmail.com>

There should be some sample client code in the hg repo ... is that not the case?


On Wed, Feb 16, 2011 at 8:59 PM, Jeff Hinrichs <jeffh at delasco.com> wrote:
> On Wed, Feb 16, 2011 at 2:58 PM, Jeff Hinrichs <jeffh at delasco.com> wrote:
>>
>> -Jeff
>>
>>
>>
>> On Wed, Feb 16, 2011 at 2:00 PM, Alexis Richardson <alexis at rabbitmq.com>
>> wrote:
>>>
>>> Max - thank-you.
>>>
>>> Jeff,
>>>
>>> How about - http://www.rabbitmq.com/plugins.html#rabbitmq-jsonrpc-channel
>>> ?
>>>
>>> alexis
>
> Alexis,
> Thanks for your suggestions. ?I took a look but didn't see any examples or
> articles about interacting with the jsonrpc/rabbmitmq channel. ?I'm off to
> google for them now. ?If you have any handy, I would appreciate it!
> Best,
> Jeff
>>
>> Jeff
>>>
>>> On Wed, Feb 16, 2011 at 7:58 PM, Max Bridgewater
>>> <max.bridgewater at gmail.com> wrote:
>>> > Alex,
>>> >
>>> > It seems to me that Jeff is looking for a Javascript client for
>>> > RabbitMQ. Nodejs, however is server side. Am I maybe misunderstanding
>>> > something?
>>> >
>>> > Max.
>>> >
>>> > On Wed, Feb 16, 2011 at 2:47 PM, Alexis Richardson
>>> > <alexis at rabbitmq.com> wrote:
>>> >> Jeff
>>> >>
>>> >> I shan't dare to recommend something but you might want to consider:
>>> >> http://www.rabbitmq.com/blog/2010/11/12/rabbitmq-nodejs-rabbitjs/
>>> >>
>>> >> I am not sure if this addresses your needs. ?If it does not then let
>>> >> us know, since there are other options.
>>> >>
>>> >> alexis
>>> >>
>>> >>
>>> >> On Wed, Feb 16, 2011 at 5:14 AM, Jeff Hinrichs <jeffh at delasco.com>
>>> >> wrote:
>>> >>> Looking for recommendations for js libraries to communicate with
>>> >>> RabbitMQ.
>>> >>> expected usage patterns: Topic based exchanges, mostly consuming,
>>> >>> some rpc
>>> >>> desirable attributes: fewer?dependencies?are a plus, ?no problems
>>> >>> co-existing with jquery, actively developed, good community/docs
>>> >>> Best,
>>> >>> -Jeff
>>> >>>
>>> >>>
>>> >>> _______________________________________________
>>> >>> rabbitmq-discuss mailing list
>>> >>> rabbitmq-discuss at lists.rabbitmq.com
>>> >>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> >>>
>>> >>>
>>> >> _______________________________________________
>>> >> rabbitmq-discuss mailing list
>>> >> rabbitmq-discuss at lists.rabbitmq.com
>>> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> >>
>>> >
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From mikeb at rabbitmq.com  Wed Feb 16 23:15:28 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 16 Feb 2011 23:15:28 +0000
Subject: [rabbitmq-discuss] looking for a javascript
	library	recommendation
In-Reply-To: <AANLkTi=kYajyrqfxH8B5RkxKxMOv8LD137w+n1PU5_KC@mail.gmail.com>
References: <AANLkTimKCJCx=j5k4mEe4XRoE1TVvyahyprrSnOR16DE@mail.gmail.com>	<AANLkTi=8BH_vsj9mVNg4bpxcEC9KPCgz-iYD6PCAYsGE@mail.gmail.com>
	<AANLkTi=kYajyrqfxH8B5RkxKxMOv8LD137w+n1PU5_KC@mail.gmail.com>
Message-ID: <4D5C5A90.3090300@rabbitmq.com>

> It seems to me that Jeff is looking for a Javascript client for
> RabbitMQ. Nodejs, however is server side. Am I maybe misunderstanding
> something?

rabbit.js is indeed written for node.js, but it enables the Socket.IO 
library on clients to speak to RabbitMQ, in effect.  However it is 
toyware right now, and doesn't support topic routing.

There's also rabbit-socks, which is being actively worked on and is 
intended to support STOMP-over-websockets(/Socket.IO) among other 
things, in the not-too-distant future.  That's probably a better fit if 
you can wait, Jeff.

Oh and there's rabbitmq-jsonrpc-channel, which is available now but not 
being actively worked on, except to keep it up-to-date with RabbitMQ API 
changes.


Michael

> Max.
>
> On Wed, Feb 16, 2011 at 2:47 PM, Alexis Richardson<alexis at rabbitmq.com>  wrote:
>> Jeff
>>
>> I shan't dare to recommend something but you might want to consider:
>> http://www.rabbitmq.com/blog/2010/11/12/rabbitmq-nodejs-rabbitjs/
>>
>> I am not sure if this addresses your needs.  If it does not then let
>> us know, since there are other options.
>>
>> alexis
>>
>>
>> On Wed, Feb 16, 2011 at 5:14 AM, Jeff Hinrichs<jeffh at delasco.com>  wrote:
>>> Looking for recommendations for js libraries to communicate with RabbitMQ.
>>> expected usage patterns: Topic based exchanges, mostly consuming, some rpc
>>> desirable attributes: fewer dependencies are a plus,  no problems
>>> co-existing with jquery, actively developed, good community/docs
>>> Best,
>>> -Jeff
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Wed Feb 16 23:39:27 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 16 Feb 2011 23:39:27 +0000
Subject: [rabbitmq-discuss] Old version of php-rabbit
	from	http://code.google.com/p/php-rabbit/
In-Reply-To: <f5a713dd-3e37-4365-aee6-196cc3223e98@r21g2000yqd.googlegroups.com>
References: <f5a713dd-3e37-4365-aee6-196cc3223e98@r21g2000yqd.googlegroups.com>
Message-ID: <4D5C602F.2060003@rabbitmq.com>

Michael,

z0r1k wrote:
> I'm maintaining old project which is using php-rabbit and we need to
> move it to another server.
> The problem is that we should build php-rabbit PHP library, but we
> cannot get source code from google code.

I suggest you email Pieter de Zwart - afaict he was an active 
contributor to php-rabbit and he is the maintainer of the amqp package 
in pecl.


Regards,

Matthias.

From pdezwart at rubiconproject.com  Wed Feb 16 23:44:29 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Wed, 16 Feb 2011 15:44:29 -0800
Subject: [rabbitmq-discuss] Old version of php-rabbit from
 http://code.google.com/p/php-rabbit/
In-Reply-To: <f5a713dd-3e37-4365-aee6-196cc3223e98@r21g2000yqd.googlegroups.com>
Message-ID: <C981A15D.1801F%pdezwart@rubiconproject.com>

Hey Michael,

I think Alexandre answered you directly in a separate thread, but for the
sake of posterity, his answer is below.

HTH,
Pieter


On 2/16/11 10:41 AM, "Alexandre Kalendarev" <akalend at mail.ru> wrote:
Hi all,

the lats code of the php-rabbit with my patch  You can to find in the
russian google groups
https://groups.google.com/group/rabbitmq_rus/browse_thread/thread/8351a8008e
0be301?hl=ru
it support rabbitmq version 1.7.

Alexandre




On 2/15/11 11:45 PM, "z0r1k" <gramatron at gmail.com> wrote:

> Hi all,
> 
> I'm maintaining old project which is using php-rabbit and we need to
> move it to another server.
> The problem is that we should build php-rabbit PHP library, but we
> cannot get source code from google code.
> 
> We've installed http://pecl.php.net/package/amqp but app is still not
> working.
> I assume that it's because API/Class structure was changed. Our
> instance using "AMQPConnect" class but on php.net I found that now
> "AMQPConnection" class assumed to be used.
> 
> Any way how we could get source code to build old version of php
> module?
> 
> Thanks in advance.
> 
> BR,
> Michael
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-- 
the rubicon project

PIETER DE ZWART | LEAD, INTERFACES TEAM
??? P 310 207 0272 | x224
??? C 408 666 4443
??? F 323 466 7119


1925 S. BUNDY DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?MOST INNOVATIVE COMPANY? - AMERICAN BUSINESS AWARDS ?10
 REVV IS OPTIMIZING 1.4 MILLION ADS PER MINUTE



From max.bridgewater at gmail.com  Thu Feb 17 01:12:43 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Wed, 16 Feb 2011 20:12:43 -0500
Subject: [rabbitmq-discuss] Authenticating to Applications
Message-ID: <AANLkTi=yhL7+iFpdJUXUv+Wuoij_3rNS6_ztxo1emiiO@mail.gmail.com>

Hi,

Let's say I want to go with the built-in authentication mechanism and
I have an application running on top of RabbitMQ. Is there a way for
my application to know with certainty that a message is effectively
coming from a source A and not from B?

Even if A and B are authenticated, I don't find a way in the Java API
that tells me who sent the message. I was assuming that after
authentication, RabbitMQ would set the user-Id in BasicProperties.
Then, any attempt to temper with that ID would be detected by RabbitMQ
and the message discarded.

One solution at the application level would be to do it the HTTP way:
authenticate the user at the app level, create a sessionId or
correlation Id and ensure that all messages from the user have this
session Id. This, however, seems to me like reinventing something that
the messaging framework should already be doing.

Any idea?

Max.

From simon at rabbitmq.com  Thu Feb 17 07:52:23 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Feb 2011 07:52:23 +0000
Subject: [rabbitmq-discuss] Authenticating to Applications
In-Reply-To: <AANLkTi=yhL7+iFpdJUXUv+Wuoij_3rNS6_ztxo1emiiO@mail.gmail.com>
References: <AANLkTi=yhL7+iFpdJUXUv+Wuoij_3rNS6_ztxo1emiiO@mail.gmail.com>
Message-ID: <4D5CD3B7.2060809@rabbitmq.com>

On 17/02/2011 1:12AM, Max Bridgewater wrote:
> Even if A and B are authenticated, I don't find a way in the Java API
> that tells me who sent the message. I was assuming that after
> authentication, RabbitMQ would set the user-Id in BasicProperties.
> Then, any attempt to temper with that ID would be detected by RabbitMQ
> and the message discarded.

The server does not set the user-id property in case a publishing app 
does not want its identity revealed for whatever reason.

However, if *you* set the user-id property, the server will enforce it. 
Therefore if you see a user-id property, you can trust it.

See: http://www.rabbitmq.com/extensions.html#validated-user-id

Cheers, Simon

From alfonso.pantoja at gmail.com  Thu Feb 17 09:38:59 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Thu, 17 Feb 2011 10:38:59 +0100
Subject: [rabbitmq-discuss] Consuming queues using the same connection vs
	multple connections
Message-ID: <AANLkTindZWEwKHUUMa7R=uvZ1CR60REHxJjYYLrBWY11@mail.gmail.com>

Hi,

Can anyone tell me the drawbacks and/or advantages of consuming 2
queues on 2 channels in a single connection versus consume them using
1 channel for each (so 2 connections at all)?

Thank you in advance


Alfonso

From alexandru at rabbitmq.com  Thu Feb 17 10:28:26 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 17 Feb 2011 12:28:26 +0200
Subject: [rabbitmq-discuss] Consuming queues using the same connection
 vs multple connections
In-Reply-To: <AANLkTindZWEwKHUUMa7R=uvZ1CR60REHxJjYYLrBWY11@mail.gmail.com>
References: <AANLkTindZWEwKHUUMa7R=uvZ1CR60REHxJjYYLrBWY11@mail.gmail.com>
Message-ID: <20110217102826.GA2319@dakota.Home>

Hi,

> Can anyone tell me the drawbacks and/or advantages of consuming 2
> queues on 2 channels in a single connection versus consume them using
> 1 channel for each (so 2 connections at all)?

I assume you meant ``1 connection for each''.

Performance-wise there's not much difference.

One connection for each means that hard-errors on one channel will only
take down one of the two connections.  In addition, some AMQP methods
affect the entire connection, some more connections could mean more
fine-grained control.

You probably don't want multiple connections, though.

Cheers,
Alex

On Thu, Feb 17, 2011 at 10:38:59AM +0100, Alfonso Pantoja wrote:
> Hi,
> 
> Can anyone tell me the drawbacks and/or advantages of consuming 2
> queues on 2 channels in a single connection versus consume them using
> 1 channel for each (so 2 connections at all)?
> 
> Thank you in advance
> 
> 
> Alfonso
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Thu Feb 17 10:46:22 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 17 Feb 2011 12:46:22 +0200
Subject: [rabbitmq-discuss] Multiple rabbitmq servers,
 one or more consumers (.NET)
In-Reply-To: <AANLkTi=H6x5iC=YDec0x=D0z_gG7eB2K0yU0YnjNtMuK@mail.gmail.com>
References: <AANLkTi=H6x5iC=YDec0x=D0z_gG7eB2K0yU0YnjNtMuK@mail.gmail.com>
Message-ID: <20110217104622.GB2319@dakota.Home>

Hi Bryan,

> I know there are other strategies to do this

In particular, RabbitMQ clustering (which has nothing to do with HA)
sounds a bit (but not much) like what you're doing.

> What I believe will happen is this (using a
> BasicQos of prefetchSize=0, prefetchCount=1):

> and consumer 2 (3, 4, 5, etc.) are sitting idle because message 2 has
> been allocated to consumer 1.

Sounds right.

> So, my basic question, is there a simple way I get message 2 to not
> block on message 1 and instead get delivered to a different consumer,
> or am I barking up the wrong tree here?

You could not set prefetchCount to 1.

Otherwise, you might have to send the same message multiple times and
then ensure that they don't get processed twice.  From the broker's
perspective, there's no difference between a pre-fetched message and a
normal message.

If you need a more intelligent prefetchCount (i.e. pre-fetch the
message, but if it's not processed in a certain amount of time,
basic.reject{requeue=true} it), you'll need to write your own.  Starting
from QueueingBasicConsumer sounds like a good idea.

Does this answer your question?

Cheers,
Alex

On Mon, Feb 14, 2011 at 10:56:34AM -0600, Bryan Murphy wrote:
> I'm working on some advanced HA strategies for our infrastructure.
> One thing I'm experimenting with is setting up one or many consumers
> that can poll from queues on multiple RabbitMQ servers.
> 
> The idea is simple, set up multiple redundant servers configured the
> same.  Send messages round-robin to the various servers, and then poll
> the servers for messages.  If a server goes off the reservation, pull
> it from the list until it comes back online or is replaced with a new
> one and keep processing messages from the remaining servers.
> 
> I know there are other strategies to do this, but I wanted to
> experiment with a few different techniques to see what works best for
> us and learn a little bit more about how the driver works.
> 
> I dug around in the .NET driver code and managed to pull together an
> implementation that uses a SharedQueue and multiple
> connections/models.  I had to extend QueueingBasicConsumer and
> BasicDeliverEventArgs to add a few properties that allow me to map the
> messages back to the appropriate connection/model for acking.
> 
> This appears to work great at first pass, however, I don't believe
> this will work well for long running jobs in a load balanced scenario
> (multiple consumers).  What I believe will happen is this (using a
> BasicQos of prefetchSize=0, prefetchCount=1):
> 
> message 1 --> rabbitmq server 1 --> consumer 1 shared local queue
> message 2 --> rabbitmq server 2 --> consumer 1 shared local queue
> 
> (BasicQos of 1 is per model, and there's a model per connection, which
> means there's a model per rabbitmq server)
> 
> locally:
> 
> consumer 1 shared local queue --> message 1 --> message 1
> consumer 1 shared local queue --> message 2 --> blocked on message 1
> 
> and consumer 2 (3, 4, 5, etc.) are sitting idle because message 2 has
> been allocated to consumer 1.
> 
> Instead of using model.BasicConsume, I could use model.BasicGet with a
> timeout to fetch messages, but I've found the performance of this
> method to be dreadful in the past so I wanted to try this method
> first.
> 
> So, my basic question, is there a simple way I get message 2 to not
> block on message 1 and instead get delivered to a different consumer,
> or am I barking up the wrong tree here?
> 
> Thanks!
> Bryan
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From max.bridgewater at gmail.com  Thu Feb 17 12:35:27 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Thu, 17 Feb 2011 07:35:27 -0500
Subject: [rabbitmq-discuss] Authenticating to Applications
In-Reply-To: <4D5CD3B7.2060809@rabbitmq.com>
References: <AANLkTi=yhL7+iFpdJUXUv+Wuoij_3rNS6_ztxo1emiiO@mail.gmail.com>
	<4D5CD3B7.2060809@rabbitmq.com>
Message-ID: <AANLkTikMaC+P+-HGEQ1Xjn9fbwk0gBk46xA8FUweTemU@mail.gmail.com>

Thanks Simon. This looks like what I'm looking for. Is this userid
also enforced for the RPCClient? This doesn't seem to be working for
me. here is my code:

public class RabbitMQPublish {
	public static void main(String[] args)  throws Exception  {
			    Connection conn = null;
			    ConnectionFactory factory = new ConnectionFactory();
			    factory.setHost("localhost");
			   factory.setPassword("admin");
			    factory.setUsername("admin");
			    factory.setVirtualHost("MyLounge");
			    conn = factory.newConnection();
			    Channel chan = conn.createChannel();
			    BasicProperties p= new BasicProperties();
			    p.setUserId("adsssmins");
			    RpcClient rpc = new RpcClient(chan, "MyExchange", "Jobs");		
			    byte[] resp=rpc.primitiveCall(p," An interactive message".getBytes());
			    System.out.println(new String(resp));
			    Thread.sleep(10000);
			
			    chan.close();
			    conn.close();
	}
}


On Thu, Feb 17, 2011 at 2:52 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 17/02/2011 1:12AM, Max Bridgewater wrote:
>>
>> Even if A and B are authenticated, I don't find a way in the Java API
>> that tells me who sent the message. I was assuming that after
>> authentication, RabbitMQ would set the user-Id in BasicProperties.
>> Then, any attempt to temper with that ID would be detected by RabbitMQ
>> and the message discarded.
>
> The server does not set the user-id property in case a publishing app does
> not want its identity revealed for whatever reason.
>
> However, if *you* set the user-id property, the server will enforce it.
> Therefore if you see a user-id property, you can trust it.
>
> See: http://www.rabbitmq.com/extensions.html#validated-user-id
>
> Cheers, Simon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Thu Feb 17 12:41:37 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Feb 2011 12:41:37 +0000
Subject: [rabbitmq-discuss] Authenticating to Applications
In-Reply-To: <AANLkTikMaC+P+-HGEQ1Xjn9fbwk0gBk46xA8FUweTemU@mail.gmail.com>
References: <AANLkTi=yhL7+iFpdJUXUv+Wuoij_3rNS6_ztxo1emiiO@mail.gmail.com>	<4D5CD3B7.2060809@rabbitmq.com>
	<AANLkTikMaC+P+-HGEQ1Xjn9fbwk0gBk46xA8FUweTemU@mail.gmail.com>
Message-ID: <4D5D1781.2020002@rabbitmq.com>

On 17/02/11 12:35, Max Bridgewater wrote:
> Thanks Simon. This looks like what I'm looking for. Is this userid
> also enforced for the RPCClient? This doesn't seem to be working for
> me. here is my code:

It should be enforced for all clients (otherwise it's not much of a 
security feature!)

Your code works for me. Note this feature only debuted in 2.3.1 - are 
you running that version?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Thu Feb 17 12:46:07 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Feb 2011 12:46:07 +0000
Subject: [rabbitmq-discuss] Authenticating to Applications
In-Reply-To: <4D5D1781.2020002@rabbitmq.com>
References: <AANLkTi=yhL7+iFpdJUXUv+Wuoij_3rNS6_ztxo1emiiO@mail.gmail.com>	<4D5CD3B7.2060809@rabbitmq.com>	<AANLkTikMaC+P+-HGEQ1Xjn9fbwk0gBk46xA8FUweTemU@mail.gmail.com>
	<4D5D1781.2020002@rabbitmq.com>
Message-ID: <4D5D188F.6070303@rabbitmq.com>

On 17/02/11 12:41, Simon MacMullen wrote:
> Your code works for me. Note this feature only debuted in 2.3.1 - are
> you running that version?

That's 2.3.1 of the server, client version should not matter.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From mabrek at gmail.com  Thu Feb 17 16:03:59 2011
From: mabrek at gmail.com (mabrek)
Date: Thu, 17 Feb 2011 19:03:59 +0300
Subject: [rabbitmq-discuss] What is the current status and purpose of
	rabbitmq-ha project?
Message-ID: <AANLkTin0e+7vc11Z8o=8DN7kJ6SaRsw2-81TZwWSMDVE@mail.gmail.com>

Hello!

Recently I've discovered http://hg.rabbitmq.com/rabbitmq-ha/ , it
looks like initial implementation of queue mirroring.
What is the purpose of this project? Is it a tool to replicate queue
content between nodes in cluster or standalone backup tool?

Regards,
Anton Lebedevich.

From matthew at rabbitmq.com  Thu Feb 17 16:13:49 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 17 Feb 2011 16:13:49 +0000
Subject: [rabbitmq-discuss] What is the current status and purpose of
 rabbitmq-ha project?
In-Reply-To: <AANLkTin0e+7vc11Z8o=8DN7kJ6SaRsw2-81TZwWSMDVE@mail.gmail.com>
References: <AANLkTin0e+7vc11Z8o=8DN7kJ6SaRsw2-81TZwWSMDVE@mail.gmail.com>
Message-ID: <20110217161348.GD13859@rabbitmq.com>

On Thu, Feb 17, 2011 at 07:03:59PM +0300, mabrek wrote:
> Recently I've discovered http://hg.rabbitmq.com/rabbitmq-ha/ , it
> looks like initial implementation of queue mirroring.

It has that appearance, certainly.

> What is the purpose of this project? Is it a tool to replicate queue
> content between nodes in cluster or standalone backup tool?

The former. Note that development of this is no longer ongoing in the
separate repo as the changes needed to Rabbit itself were too extensive.
Thus it's now solely being developed as a branch of the broker, and that
repo should be removed.

Matthew

From jasonjwwilliams at gmail.com  Thu Feb 17 19:35:18 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 17 Feb 2011 12:35:18 -0700
Subject: [rabbitmq-discuss] Management Plugin Listen IPs
Message-ID: <AANLkTimF6UVO9ROCA3pNcp1cyGnSPQhw4MOxf1gLfHF+@mail.gmail.com>

Is it possible to control what IPs/interfaces the management plugin
listens on, like tcp_listeners for the main broker?

-J

From simon at rabbitmq.com  Thu Feb 17 19:41:33 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Feb 2011 19:41:33 +0000
Subject: [rabbitmq-discuss] Management Plugin Listen IPs
In-Reply-To: <AANLkTimF6UVO9ROCA3pNcp1cyGnSPQhw4MOxf1gLfHF+@mail.gmail.com>
References: <AANLkTimF6UVO9ROCA3pNcp1cyGnSPQhw4MOxf1gLfHF+@mail.gmail.com>
Message-ID: <4D5D79ED.4030909@rabbitmq.com>

On 17/02/2011 7:35PM, Jason J. W. Williams wrote:
 > Is it possible to control what IPs/interfaces the management plugin
 > listens on, like tcp_listeners for the main broker?

Not really. You can change the port but that's it.

This area of rabbit-mochiweb is due some attention hopefully.

Cheers, Simon

From jasonjwwilliams at gmail.com  Thu Feb 17 20:01:48 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 17 Feb 2011 13:01:48 -0700
Subject: [rabbitmq-discuss] Management Plugin Listen IPs
In-Reply-To: <4D5D79ED.4030909@rabbitmq.com>
References: <AANLkTimF6UVO9ROCA3pNcp1cyGnSPQhw4MOxf1gLfHF+@mail.gmail.com>
	<4D5D79ED.4030909@rabbitmq.com>
Message-ID: <AANLkTinZvibawQBpx=Avh5ni5FHpXS66DOBAsWjqF5A8@mail.gmail.com>

Hi Simon,

Thanks for the quick response. That would be very helpful.

-J

On Thu, Feb 17, 2011 at 12:41 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 17/02/2011 7:35PM, Jason J. W. Williams wrote:
>> Is it possible to control what IPs/interfaces the management plugin
>> listens on, like tcp_listeners for the main broker?
>
> Not really. You can change the port but that's it.
>
> This area of rabbit-mochiweb is due some attention hopefully.
>
> Cheers, Simon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From aniruddh_narayan at yahoo.co.in  Fri Feb 18 04:36:02 2011
From: aniruddh_narayan at yahoo.co.in (aniruddh narayan)
Date: Fri, 18 Feb 2011 10:06:02 +0530 (IST)
Subject: [rabbitmq-discuss] video streaming
Message-ID: <753750.36956.qm@web95415.mail.in2.yahoo.com>

HI
I was just looking at the options of streaming a video file( say h.264 format) using rabbitmq.
Just needed some pointer on it if it is possible?
thanks 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110218/b360336c/attachment-0001.htm>

From max.bridgewater at gmail.com  Fri Feb 18 08:21:18 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Fri, 18 Feb 2011 03:21:18 -0500
Subject: [rabbitmq-discuss] Management Plugins Crashing RabbitMQ
Message-ID: <AANLkTimQ=q+ZjoETcXd6d7TS-gwm2TNRFcA9nyBLFd_u@mail.gmail.com>

Hi,

I'm trying to run the management plugin (version 2.3.1) on RabbitMQ.
Unfortunately, it is causing RabbitMQ  (version 2.3.1) to crash.
Erlang version is R13B04.

/var/log/rabbitmq/startup.log

Starting all nodes...
Starting node rabbit at ip-10-117-47-112...
Activating RabbitMQ plugins ...
*WARNING* Undefined function erlang:max/2
*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
*WARNING* Undefined function lists:keyfind/3
*WARNING* Undefined function ssl:ssl_accept/3
*WARNING* Undefined function webmachine_resource:start_link/2
6 plugins activated:
* amqp_client-2.3.1
* mochiweb-1.3
* rabbit_management-2.3.1
* rabbit_management_agent-2.3.1
* rabbit_mochiweb-2.3.1
* webmachine-1.7.0

{"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}}"}

/var/log/rabbitmq/startup.err
Error: {node_start_failed,normal}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}})

From josh at gebaschtel.ch  Fri Feb 18 08:56:18 2011
From: josh at gebaschtel.ch (Josh Geisser)
Date: Fri, 18 Feb 2011 09:56:18 +0100
Subject: [rabbitmq-discuss] video streaming
In-Reply-To: <753750.36956.qm@web95415.mail.in2.yahoo.com>
References: <753750.36956.qm@web95415.mail.in2.yahoo.com>
Message-ID: <9C37154E143FE14CBA656B2D2232745F077FA20DA942@popeye.gebaschtel.bnet>

We stream MP3 data and that works quite fine. We use VLC to reencode the media into the right format, wrap the output stream into junks and publish them over the rabbit.

Big question is how to assemble the data back into a stream on the receiving site, most multimedia libraries we came across want the media source to be either a file or http-address, only a few can cope with a buffer like object.

Cheers
Josh

________________________________
Von: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] Im Auftrag von aniruddh narayan
Gesendet: Freitag, 18. Februar 2011 05:36
An: rabbitmq-discuss at lists.rabbitmq.com
Betreff: [rabbitmq-discuss] video streaming

HI
I was just looking at the options of streaming a video file( say h.264 format) using rabbitmq.
Just needed some pointer on it if it is possible?
thanks


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110218/71b96f62/attachment.htm>

From simon at rabbitmq.com  Fri Feb 18 10:29:00 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 18 Feb 2011 10:29:00 +0000
Subject: [rabbitmq-discuss] Management Plugins Crashing RabbitMQ
In-Reply-To: <AANLkTimQ=q+ZjoETcXd6d7TS-gwm2TNRFcA9nyBLFd_u@mail.gmail.com>
References: <AANLkTimQ=q+ZjoETcXd6d7TS-gwm2TNRFcA9nyBLFd_u@mail.gmail.com>
Message-ID: <4D5E49EC.3070004@rabbitmq.com>

On 18/02/11 08:21, Max Bridgewater wrote:
> I'm trying to run the management plugin (version 2.3.1) on RabbitMQ.
> Unfortunately, it is causing RabbitMQ  (version 2.3.1) to crash.
> Erlang version is R13B04.

I hope this doesn't sound rude, but: are you *absolutely* sure you're 
running R13B04? That list of undefined functions and the subsequent 
failure of rabbit_mochiweb to start is exactly what I get when running 
against R12B-5. When running against R13B04 there are fewer undefined 
function warnings and RabbitMQ starts correctly. Could there be an 
installation of R12B-5 still on your system somewhere?

Cheers, Simon

> /var/log/rabbitmq/startup.log
>
> Starting all nodes...
> Starting node rabbit at ip-10-117-47-112...
> Activating RabbitMQ plugins ...
> *WARNING* Undefined function erlang:max/2
> *WARNING* Undefined function fdsrv:bind_socket/2
> *WARNING* Undefined function fdsrv:start/0
> *WARNING* Undefined function fdsrv:stop/0
> *WARNING* Undefined function lists:keyfind/3
> *WARNING* Undefined function ssl:ssl_accept/3
> *WARNING* Undefined function webmachine_resource:start_link/2
> 6 plugins activated:
> * amqp_client-2.3.1
> * mochiweb-1.3
> * rabbit_management-2.3.1
> * rabbit_management_agent-2.3.1
> * rabbit_mochiweb-2.3.1
> * webmachine-1.7.0
>
> {"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}}"}
>
> /var/log/rabbitmq/startup.err
> Error: {node_start_failed,normal}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}})
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From shammi at arosys.com  Fri Feb 18 11:23:57 2011
From: shammi at arosys.com (cheepu)
Date: Fri, 18 Feb 2011 03:23:57 -0800 (PST)
Subject: [rabbitmq-discuss] How can we check that rabbitMQ server is running
 using java code?
Message-ID: <30957788.post@talk.nabble.com>


Hi,
How can i program my java code that will give information that RabbitMQ
server is running or not?

Thanks
-- 
View this message in context: http://old.nabble.com/How-can-we-check-that-rabbitMQ-server-is-running-using-java-code--tp30957788p30957788.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From vertolet666 at yandex.ru  Fri Feb 18 13:42:24 2011
From: vertolet666 at yandex.ru (DOBRO)
Date: Fri, 18 Feb 2011 05:42:24 -0800 (PST)
Subject: [rabbitmq-discuss]  Losing messages, why?
Message-ID: <30958766.post@talk.nabble.com>


Hi,

I've run into the issue of losing messages. I'm trying to figure out why
messages are lost, but can't understand yet.
I'm using RabbitMQ 2.3.1, Erlang R14B01.

Let me tell you how I organized messaging.

Several exchanges are declared:
all.fanout (type => 'fanout', passive => false, durable => false,
auto_delete => false);
main.direct (type => 'direct', passive => false, durable => false,
auto_delete => false);
board.direct (type => 'direct', passive => false, durable => false,
auto_delete => false);
boardchat.direct (type => 'direct', passive => false, durable => false,
auto_delete => false);

First client (Client1) connects to RabbitMQ and declares queue:
main_queue (passive => false, durable => false, exclusive => true,
auto_delete => false),
binds this main_queue to exchange main.direct with routing key "mainKey"
and starts to consume messages from main_queue with noAck = true.
This client is running on the server side.


Second client (Client2) (from other city or country) connects to RabbitMQ
and declares 4 queues (4 channels are opened: one channel per queue).
These 4 queues are:
all-queue-1 (passive => false, durable => false, exclusive => true,
auto_delete => false) is bound to exchange all.fanout,
board-queue-1 (passive => false, durable => false, exclusive => true,
auto_delete => false) is bound to exchange board.direct with routing key
"1234",
boardchat-queue-1 (passive => false, durable => false, exclusive => true,
auto_delete => false) is bound to exchange boardchat.direct with routing key
"1234",
Client2 starts consuming messages from queues all-queue-1, board-queue-1,
boardchat-queue-1 with noAck = true.

The third client (Client3) (from other city or country) connects to RabbitMQ
and declares 4 queues (4 channels are opened: one channel per queue).
These 4 queues are:
all-queue-2 (passive => false, durable => false, exclusive => true,
auto_delete => false) is bound to exchange all.fanout,
board-queue-2 (passive => false, durable => false, exclusive => true,
auto_delete => false) is bound to exchange board.direct with routing key
"1234",
boardchat-queue-2 (passive => false, durable => false, exclusive => true,
auto_delete => false) is bound to exchange boardchat.direct with routing key
"1234",
Client3 starts consuming messages from queues all-queue-2, board-queue-2,
boardchat-queue-2 with noAck = true.


Next, 
- Client2 publishes a message (message1) to exchange main.direct with
routing key "mainKey",
- Client1 receives this message, processes it and publish another message
(message2) to exchange board.direct with routing key "1234",
- Client2 and Client3 receive the message (message2) from Client1 and
process it,
- Client2 starts to publish message2 to exchange board.direct with routing
key "1234" every 10 seconds.

Sometimes Client3 stops to receive messages from Client1 and Client2 (from
queue board-queue-2) (even if Client2 publishes messages every 10 seconds).
However, Client3 receives messages from all other queues.

If Client3 
- deletes board-queue-2,
- closes the channel opened for this queue,
- opens another channel,
- declares queue board-queue-3 (passive => false, durable => false,
exclusive => true, auto_delete => false)
- binds the queue board-queue-3 to exchange board.direct with routing key
"1234",
- starts consuming messages from queue board-queue-3 with noAck = true

the situation comes to normal again.

Now I'm coming to a question.
Why Client3 loses messages? Where should I find a reason?

Thanks a lot!
 
-- 
View this message in context: http://old.nabble.com/Losing-messages%2C-why--tp30958766p30958766.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From yuesong.c at gmail.com  Fri Feb 18 16:31:47 2011
From: yuesong.c at gmail.com (Yuesong Wang)
Date: Fri, 18 Feb 2011 11:31:47 -0500
Subject: [rabbitmq-discuss] Why does Channel.queueDeclarePassive close the
	channel?
Message-ID: <0426C874-EC06-472C-B24C-215689858AD4@gmail.com>

Hi,

I'm experimenting with RabbitMQ (2.3.1) and the Java client. I tried to use Channel.queueDeclarePassive to detect the presence/absence of a queue, but if the queue does not exit, the method shuts down the channel. Any reason why it does that?

What I really want to do is for both the producers and consumers to automatically recover from a queue gone missing, e.g. the owner node in a cluster goes down (I'm simulating that by deleting the queue while both producers and consumers are running). The producer will recreate the queue (with queueDeclare) and the consumers will use queueDeclarePassive to find the queue. Is there an established pattern for doing that efficiently?

Thanks,

Yuesong

From simon at rabbitmq.com  Fri Feb 18 16:40:56 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 18 Feb 2011 16:40:56 +0000
Subject: [rabbitmq-discuss] Why does Channel.queueDeclarePassive close
 the	channel?
In-Reply-To: <0426C874-EC06-472C-B24C-215689858AD4@gmail.com>
References: <0426C874-EC06-472C-B24C-215689858AD4@gmail.com>
Message-ID: <4D5EA118.2000704@rabbitmq.com>

Hi Yuesong.

On 18/02/11 16:31, Yuesong Wang wrote:
> What I really want to do is for both the producers and consumers to
> automatically recover from a queue gone missing

In that case both producers and consumers should declare the queue 
actively. Declaring a queue that already exists is not a problem, and 
the costs associated with doing so are low.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From yuesong.c at gmail.com  Fri Feb 18 17:03:01 2011
From: yuesong.c at gmail.com (Yuesong Wang)
Date: Fri, 18 Feb 2011 12:03:01 -0500
Subject: [rabbitmq-discuss] Why does Channel.queueDeclarePassive close
	the channel?
In-Reply-To: <4D5EA118.2000704@rabbitmq.com>
References: <0426C874-EC06-472C-B24C-215689858AD4@gmail.com>
	<4D5EA118.2000704@rabbitmq.com>
Message-ID: <461B89FD-949B-402C-836D-14CC59D5F389@gmail.com>

Simon,

Thanks. It helps to know what's expensive and what's not

The AMQP reference says about active declare:

If [passive] not set and the queue exists, the server MUST check that the existing queue has the same values for durable, exclusive, auto-delete, and arguments fields. The server MUST respond with Declare-Ok if the requested queue matches these fields, and MUST raise a channel exception if not.

For that reason, I want to leave the active declare to producers so the consumers don't have to care whether the queue is durable, auto-delete and what not. A little bit less coupling. But I got what you said.

Now on the producer side, a dumb but easy way to make sure the queue gets recreated if missing is to always declare the queue and binding before every publish. It works but I'd imagine it is very inefficient, yeah? The consumer code is a bit more complicated with the use of QueueConsumer and Channel.basicConsumer. For a running consumer to use a recreated queue, do I have to instantiate a new QueueConsumer, and call Channel.basicConsumer again? I'm new to RabbitMQ and there seems to be a lot of options to go about this. Any pointers are much appreciated.

Yuesong

On Feb 18, 2011, at 11:40 AM, Simon MacMullen wrote:

> Hi Yuesong.
> 
> On 18/02/11 16:31, Yuesong Wang wrote:
>> What I really want to do is for both the producers and consumers to
>> automatically recover from a queue gone missing
> 
> In that case both producers and consumers should declare the queue actively. Declaring a queue that already exists is not a problem, and the costs associated with doing so are low.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110218/7942156d/attachment.htm>

From max.bridgewater at gmail.com  Fri Feb 18 20:35:08 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Fri, 18 Feb 2011 15:35:08 -0500
Subject: [rabbitmq-discuss] Management Plugins Crashing RabbitMQ
In-Reply-To: <4D5E49EC.3070004@rabbitmq.com>
References: <AANLkTimQ=q+ZjoETcXd6d7TS-gwm2TNRFcA9nyBLFd_u@mail.gmail.com>
	<4D5E49EC.3070004@rabbitmq.com>
Message-ID: <AANLkTimAh2nUs95emHAZCyHz7ONEfNUanEuLMfpzQm9a@mail.gmail.com>

Hi Simon,

The warnings might have indeed be from a previous run with a different
version of Erlang. But now, I installed a  new version on a brand new
EC2 instance. Checking the Erlang version with init:script_id().
results in: {"OTP  APN 181 01","R13B04"}.


The error messages are hereunder.

Thanks for your input.
Max.

/var/log/rabbitmq/startup.log

Starting node rabbit_1 at ip-10-112-95-130...
Activating RabbitMQ plugins ...
*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
*WARNING* Undefined function webmachine_resource:start_link/2
6 plugins activated:
* amqp_client-2.3.1
* mochiweb-1.3
* rabbit_management-2.3.1
* rabbit_management_agent-2.3.1
* rabbit_mochiweb-2.3.1
* webmachine-1.7.0

{"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}}"}


/var/log/rabbitmq/startup.err

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}})
Error: {node_start_failed,normal}


On Fri, Feb 18, 2011 at 5:29 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 18/02/11 08:21, Max Bridgewater wrote:
>>
>> I'm trying to run the management plugin (version 2.3.1) on RabbitMQ.
>> Unfortunately, it is causing RabbitMQ ?(version 2.3.1) to crash.
>> Erlang version is R13B04.
>
> I hope this doesn't sound rude, but: are you *absolutely* sure you're
> running R13B04? That list of undefined functions and the subsequent failure
> of rabbit_mochiweb to start is exactly what I get when running against
> R12B-5. When running against R13B04 there are fewer undefined function
> warnings and RabbitMQ starts correctly. Could there be an installation of
> R12B-5 still on your system somewhere?
>
> Cheers, Simon
>
>> /var/log/rabbitmq/startup.log
>>
>> Starting all nodes...
>> Starting node rabbit at ip-10-117-47-112...
>> Activating RabbitMQ plugins ...
>> *WARNING* Undefined function erlang:max/2
>> *WARNING* Undefined function fdsrv:bind_socket/2
>> *WARNING* Undefined function fdsrv:start/0
>> *WARNING* Undefined function fdsrv:stop/0
>> *WARNING* Undefined function lists:keyfind/3
>> *WARNING* Undefined function ssl:ssl_accept/3
>> *WARNING* Undefined function webmachine_resource:start_link/2
>> 6 plugins activated:
>> * amqp_client-2.3.1
>> * mochiweb-1.3
>> * rabbit_management-2.3.1
>> * rabbit_management_agent-2.3.1
>> * rabbit_mochiweb-2.3.1
>> * webmachine-1.7.0
>>
>> {"Kernel pid
>> terminated",application_controller,"{application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}}"}
>>
>> /var/log/rabbitmq/startup.err
>> Error: {node_start_failed,normal}
>>
>> Crash dump was written to: erl_crash.dump
>> Kernel pid terminated (application_controller)
>>
>> ({application_start_failure,rabbit_mochiweb,{shutdown,{rabbit_mochiweb_app,start,[normal,[]]}}})
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From hekevintran at gmail.com  Fri Feb 18 21:19:00 2011
From: hekevintran at gmail.com (hekevintran)
Date: Fri, 18 Feb 2011 13:19:00 -0800 (PST)
Subject: [rabbitmq-discuss] Why is RabbitMQ not persisting messages on a
	durable queue?
Message-ID: <de26a50f-64f1-484a-9914-c2a20e08e9d4@a21g2000prj.googlegroups.com>

I am using RabbitMQ with Django through Celery. I am using the most
basic setup:

    # RabbitMQ connection settings
    BROKER_HOST = 'localhost'
    BROKER_PORT = '5672'
    BROKER_USER = 'guest'
    BROKER_PASSWORD = 'guest'
    BROKER_VHOST = '/'

I imported a Celery task and queued it to run one year later. From the
iPython shell:

    In [1]: from apps.test_app.tasks import add

    In [2]: dt=datetime.datetime(2012, 2, 18, 10, 00)

    In [3]: add.apply_async((10, 6), eta=dt)
    DEBUG:amqplib:Start from server, version: 8.0, properties:
{u'information': 'Licensed under the MPL.  See http://www.rabbitmq.com/',
u'product': 'RabbitMQ', u'version': '2.2.0', u'copyright': 'Copyright
(C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and
Rabbit Technologies Ltd.', u'platform': 'Erlang/OTP'}, mechanisms:
['PLAIN', 'AMQPLAIN'], locales: ['en_US']
    DEBUG:amqplib:Open OK! known_hosts []
    DEBUG:amqplib:using channel_id: 1
    DEBUG:amqplib:Channel open
    DEBUG:amqplib:Closed channel #1
    Out[3]: <AsyncResult: cfc507a1-175f-438e-acea-8c989a120ab3>

RabbitMQ received this message in the celery queue:

    $  rabbitmqctl list_queues name messages durable
    Listing queues ...
    KTMacBook.local.celeryd.pidbox	0	false
    celery	1	true
    celeryctl_KTMacBook.local	0	true
    ...done.

I then killed RabbitMQ by hitting control-C followed by 'a' to abort.
When I start the server again and check it with rabbitmqctl, it says
that there are no messages in the celery queue:

    $  rabbitmqctl list_queues name messages durable
    Listing queues ...
    celery	0	true
    celeryctl_KTMacBook.local	0	true
    ...done.

The celery queue was durable. Why were the messages not persisted?
What do I need to do to make the messages persistent?

From gmr at myyearbook.com  Fri Feb 18 21:40:31 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Fri, 18 Feb 2011 16:40:31 -0500
Subject: [rabbitmq-discuss] Why is RabbitMQ not persisting messages on a
 durable queue?
In-Reply-To: <de26a50f-64f1-484a-9914-c2a20e08e9d4@a21g2000prj.googlegroups.com>
References: <de26a50f-64f1-484a-9914-c2a20e08e9d4@a21g2000prj.googlegroups.com>
Message-ID: <AANLkTikRf=J5NiKRRQg3i_q0W30ih+BH4BaCun+F+dJ=@mail.gmail.com>

Not sure of the celery underpinnings for specifying persistent messages,
perhaps it's documented, but you need to set the message delivery_mode = 2
in the message properties when calling Basic.Publish.

On Fri, Feb 18, 2011 at 4:19 PM, hekevintran <hekevintran at gmail.com> wrote:

> I am using RabbitMQ with Django through Celery. I am using the most
> basic setup:
>
>    # RabbitMQ connection settings
>    BROKER_HOST = 'localhost'
>    BROKER_PORT = '5672'
>    BROKER_USER = 'guest'
>    BROKER_PASSWORD = 'guest'
>    BROKER_VHOST = '/'
>
> I imported a Celery task and queued it to run one year later. From the
> iPython shell:
>
>    In [1]: from apps.test_app.tasks import add
>
>    In [2]: dt=datetime.datetime(2012, 2, 18, 10, 00)
>
>    In [3]: add.apply_async((10, 6), eta=dt)
>    DEBUG:amqplib:Start from server, version: 8.0, properties:
> {u'information': 'Licensed under the MPL.  See http://www.rabbitmq.com/',
> u'product': 'RabbitMQ', u'version': '2.2.0', u'copyright': 'Copyright
> (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and
> Rabbit Technologies Ltd.', u'platform': 'Erlang/OTP'}, mechanisms:
> ['PLAIN', 'AMQPLAIN'], locales: ['en_US']
>    DEBUG:amqplib:Open OK! known_hosts []
>    DEBUG:amqplib:using channel_id: 1
>    DEBUG:amqplib:Channel open
>    DEBUG:amqplib:Closed channel #1
>    Out[3]: <AsyncResult: cfc507a1-175f-438e-acea-8c989a120ab3>
>
> RabbitMQ received this message in the celery queue:
>
>    $  rabbitmqctl list_queues name messages durable
>    Listing queues ...
>    KTMacBook.local.celeryd.pidbox      0       false
>    celery      1       true
>    celeryctl_KTMacBook.local   0       true
>    ...done.
>
> I then killed RabbitMQ by hitting control-C followed by 'a' to abort.
> When I start the server again and check it with rabbitmqctl, it says
> that there are no messages in the celery queue:
>
>    $  rabbitmqctl list_queues name messages durable
>    Listing queues ...
>    celery      0       true
>    celeryctl_KTMacBook.local   0       true
>    ...done.
>
> The celery queue was durable. Why were the messages not persisted?
> What do I need to do to make the messages persistent?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110218/6ae65ec0/attachment.htm>

From hekevintran at gmail.com  Fri Feb 18 21:49:46 2011
From: hekevintran at gmail.com (hekevintran)
Date: Fri, 18 Feb 2011 13:49:46 -0800 (PST)
Subject: [rabbitmq-discuss] Why is RabbitMQ not persisting messages on a
	durable queue?
In-Reply-To: <AANLkTikRf=J5NiKRRQg3i_q0W30ih+BH4BaCun+F+dJ=@mail.gmail.com>
References: <de26a50f-64f1-484a-9914-c2a20e08e9d4@a21g2000prj.googlegroups.com>
	<AANLkTikRf=J5NiKRRQg3i_q0W30ih+BH4BaCun+F+dJ=@mail.gmail.com>
Message-ID: <24bab23f-2513-4639-baad-34e488b37eb2@y36g2000pra.googlegroups.com>

It looks like the delivery mode is already set to 2:

    In [1]: from apps.test_app.tasks import add

    In [2]: add.delivery_mode
    Out[2]: 2

This default cannot be changed in celery as far as I know.

On Feb 18, 1:40?pm, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> Not sure of the celery underpinnings for specifying persistent messages,
> perhaps it's documented, but you need to set the message delivery_mode = 2
> in the message properties when calling Basic.Publish.
>
>
>
> On Fri, Feb 18, 2011 at 4:19 PM, hekevintran <hekevint... at gmail.com> wrote:
> > I am using RabbitMQ with Django through Celery. I am using the most
> > basic setup:
>
> > ? ?# RabbitMQ connection settings
> > ? ?BROKER_HOST = 'localhost'
> > ? ?BROKER_PORT = '5672'
> > ? ?BROKER_USER = 'guest'
> > ? ?BROKER_PASSWORD = 'guest'
> > ? ?BROKER_VHOST = '/'
>
> > I imported a Celery task and queued it to run one year later. From the
> > iPython shell:
>
> > ? ?In [1]: from apps.test_app.tasks import add
>
> > ? ?In [2]: dt=datetime.datetime(2012, 2, 18, 10, 00)
>
> > ? ?In [3]: add.apply_async((10, 6), eta=dt)
> > ? ?DEBUG:amqplib:Start from server, version: 8.0, properties:
> > {u'information': 'Licensed under the MPL. ?Seehttp://www.rabbitmq.com/',
> > u'product': 'RabbitMQ', u'version': '2.2.0', u'copyright': 'Copyright
> > (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and
> > Rabbit Technologies Ltd.', u'platform': 'Erlang/OTP'}, mechanisms:
> > ['PLAIN', 'AMQPLAIN'], locales: ['en_US']
> > ? ?DEBUG:amqplib:Open OK! known_hosts []
> > ? ?DEBUG:amqplib:using channel_id: 1
> > ? ?DEBUG:amqplib:Channel open
> > ? ?DEBUG:amqplib:Closed channel #1
> > ? ?Out[3]: <AsyncResult: cfc507a1-175f-438e-acea-8c989a120ab3>
>
> > RabbitMQ received this message in the celery queue:
>
> > ? ?$ ?rabbitmqctl list_queues name messages durable
> > ? ?Listing queues ...
> > ? ?KTMacBook.local.celeryd.pidbox ? ? ?0 ? ? ? false
> > ? ?celery ? ? ?1 ? ? ? true
> > ? ?celeryctl_KTMacBook.local ? 0 ? ? ? true
> > ? ?...done.
>
> > I then killed RabbitMQ by hitting control-C followed by 'a' to abort.
> > When I start the server again and check it with rabbitmqctl, it says
> > that there are no messages in the celery queue:
>
> > ? ?$ ?rabbitmqctl list_queues name messages durable
> > ? ?Listing queues ...
> > ? ?celery ? ? ?0 ? ? ? true
> > ? ?celeryctl_KTMacBook.local ? 0 ? ? ? true
> > ? ?...done.
>
> > The celery queue was durable. Why were the messages not persisted?
> > What do I need to do to make the messages persistent?
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Fri Feb 18 22:44:17 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Sat, 19 Feb 2011 00:44:17 +0200
Subject: [rabbitmq-discuss] Why is RabbitMQ not persisting messages on a
 durable queue?
In-Reply-To: <24bab23f-2513-4639-baad-34e488b37eb2@y36g2000pra.googlegroups.com>
References: <de26a50f-64f1-484a-9914-c2a20e08e9d4@a21g2000prj.googlegroups.com>
	<AANLkTikRf=J5NiKRRQg3i_q0W30ih+BH4BaCun+F+dJ=@mail.gmail.com>
	<24bab23f-2513-4639-baad-34e488b37eb2@y36g2000pra.googlegroups.com>
Message-ID: <20110218224417.GA2329@dakota.doc.ic.ac.uk>

Hi,

A persistent message is one Rabbit will try to write to disk, but if the
server is killed before it gets the chance to do this, the message will
be lost.

There are a few ways to remedy this, either by using transactions or by
using confirms (see our recent blog posts).  That said, I don't know if
you can get Celery to use any of these mechanisms.

Cheers,
Alex

On Fri, Feb 18, 2011 at 01:49:46PM -0800, hekevintran wrote:
> It looks like the delivery mode is already set to 2:
> 
>     In [1]: from apps.test_app.tasks import add
> 
>     In [2]: add.delivery_mode
>     Out[2]: 2
> 
> This default cannot be changed in celery as far as I know.
> 
> On Feb 18, 1:40?pm, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> > Not sure of the celery underpinnings for specifying persistent messages,
> > perhaps it's documented, but you need to set the message delivery_mode = 2
> > in the message properties when calling Basic.Publish.
> >
> >
> >
> > On Fri, Feb 18, 2011 at 4:19 PM, hekevintran <hekevint... at gmail.com> wrote:
> > > I am using RabbitMQ with Django through Celery. I am using the most
> > > basic setup:
> >
> > > ? ?# RabbitMQ connection settings
> > > ? ?BROKER_HOST = 'localhost'
> > > ? ?BROKER_PORT = '5672'
> > > ? ?BROKER_USER = 'guest'
> > > ? ?BROKER_PASSWORD = 'guest'
> > > ? ?BROKER_VHOST = '/'
> >
> > > I imported a Celery task and queued it to run one year later. From the
> > > iPython shell:
> >
> > > ? ?In [1]: from apps.test_app.tasks import add
> >
> > > ? ?In [2]: dt=datetime.datetime(2012, 2, 18, 10, 00)
> >
> > > ? ?In [3]: add.apply_async((10, 6), eta=dt)
> > > ? ?DEBUG:amqplib:Start from server, version: 8.0, properties:
> > > {u'information': 'Licensed under the MPL. ?Seehttp://www.rabbitmq.com/',
> > > u'product': 'RabbitMQ', u'version': '2.2.0', u'copyright': 'Copyright
> > > (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and
> > > Rabbit Technologies Ltd.', u'platform': 'Erlang/OTP'}, mechanisms:
> > > ['PLAIN', 'AMQPLAIN'], locales: ['en_US']
> > > ? ?DEBUG:amqplib:Open OK! known_hosts []
> > > ? ?DEBUG:amqplib:using channel_id: 1
> > > ? ?DEBUG:amqplib:Channel open
> > > ? ?DEBUG:amqplib:Closed channel #1
> > > ? ?Out[3]: <AsyncResult: cfc507a1-175f-438e-acea-8c989a120ab3>
> >
> > > RabbitMQ received this message in the celery queue:
> >
> > > ? ?$ ?rabbitmqctl list_queues name messages durable
> > > ? ?Listing queues ...
> > > ? ?KTMacBook.local.celeryd.pidbox ? ? ?0 ? ? ? false
> > > ? ?celery ? ? ?1 ? ? ? true
> > > ? ?celeryctl_KTMacBook.local ? 0 ? ? ? true
> > > ? ?...done.
> >
> > > I then killed RabbitMQ by hitting control-C followed by 'a' to abort.
> > > When I start the server again and check it with rabbitmqctl, it says
> > > that there are no messages in the celery queue:
> >
> > > ? ?$ ?rabbitmqctl list_queues name messages durable
> > > ? ?Listing queues ...
> > > ? ?celery ? ? ?0 ? ? ? true
> > > ? ?celeryctl_KTMacBook.local ? 0 ? ? ? true
> > > ? ?...done.
> >
> > > The celery queue was durable. Why were the messages not persisted?
> > > What do I need to do to make the messages persistent?
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Fri Feb 18 22:55:47 2011
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Sat, 19 Feb 2011 00:55:47 +0200
Subject: [rabbitmq-discuss] Why is RabbitMQ not persisting messages on a
 durable queue?
In-Reply-To: <20110218224417.GA2329@dakota.doc.ic.ac.uk>
References: <de26a50f-64f1-484a-9914-c2a20e08e9d4@a21g2000prj.googlegroups.com>
	<AANLkTikRf=J5NiKRRQg3i_q0W30ih+BH4BaCun+F+dJ=@mail.gmail.com>
	<24bab23f-2513-4639-baad-34e488b37eb2@y36g2000pra.googlegroups.com>
	<20110218224417.GA2329@dakota.doc.ic.ac.uk>
Message-ID: <20110218225547.GB2329@dakota.doc.ic.ac.uk>

Also, are you running the latest version of the broker?  There was a bug
in versions of Rabbit before 2.3.0 that made the above problem worse.
RabbitMQ 2.3.1 can still lose messages if it's killed quickly enough,
but it should happen less often.

Cheers,
Alex

On Sat, Feb 19, 2011 at 12:44:17AM +0200, Alexandru Scvor?ov wrote:
> Hi,
> 
> A persistent message is one Rabbit will try to write to disk, but if the
> server is killed before it gets the chance to do this, the message will
> be lost.
> 
> There are a few ways to remedy this, either by using transactions or by
> using confirms (see our recent blog posts).  That said, I don't know if
> you can get Celery to use any of these mechanisms.
> 
> Cheers,
> Alex
> 
> On Fri, Feb 18, 2011 at 01:49:46PM -0800, hekevintran wrote:
> > It looks like the delivery mode is already set to 2:
> > 
> >     In [1]: from apps.test_app.tasks import add
> > 
> >     In [2]: add.delivery_mode
> >     Out[2]: 2
> > 
> > This default cannot be changed in celery as far as I know.
> > 
> > On Feb 18, 1:40?pm, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> > > Not sure of the celery underpinnings for specifying persistent messages,
> > > perhaps it's documented, but you need to set the message delivery_mode = 2
> > > in the message properties when calling Basic.Publish.
> > >
> > >
> > >
> > > On Fri, Feb 18, 2011 at 4:19 PM, hekevintran <hekevint... at gmail.com> wrote:
> > > > I am using RabbitMQ with Django through Celery. I am using the most
> > > > basic setup:
> > >
> > > > ? ?# RabbitMQ connection settings
> > > > ? ?BROKER_HOST = 'localhost'
> > > > ? ?BROKER_PORT = '5672'
> > > > ? ?BROKER_USER = 'guest'
> > > > ? ?BROKER_PASSWORD = 'guest'
> > > > ? ?BROKER_VHOST = '/'
> > >
> > > > I imported a Celery task and queued it to run one year later. From the
> > > > iPython shell:
> > >
> > > > ? ?In [1]: from apps.test_app.tasks import add
> > >
> > > > ? ?In [2]: dt=datetime.datetime(2012, 2, 18, 10, 00)
> > >
> > > > ? ?In [3]: add.apply_async((10, 6), eta=dt)
> > > > ? ?DEBUG:amqplib:Start from server, version: 8.0, properties:
> > > > {u'information': 'Licensed under the MPL. ?Seehttp://www.rabbitmq.com/',
> > > > u'product': 'RabbitMQ', u'version': '2.2.0', u'copyright': 'Copyright
> > > > (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and
> > > > Rabbit Technologies Ltd.', u'platform': 'Erlang/OTP'}, mechanisms:
> > > > ['PLAIN', 'AMQPLAIN'], locales: ['en_US']
> > > > ? ?DEBUG:amqplib:Open OK! known_hosts []
> > > > ? ?DEBUG:amqplib:using channel_id: 1
> > > > ? ?DEBUG:amqplib:Channel open
> > > > ? ?DEBUG:amqplib:Closed channel #1
> > > > ? ?Out[3]: <AsyncResult: cfc507a1-175f-438e-acea-8c989a120ab3>
> > >
> > > > RabbitMQ received this message in the celery queue:
> > >
> > > > ? ?$ ?rabbitmqctl list_queues name messages durable
> > > > ? ?Listing queues ...
> > > > ? ?KTMacBook.local.celeryd.pidbox ? ? ?0 ? ? ? false
> > > > ? ?celery ? ? ?1 ? ? ? true
> > > > ? ?celeryctl_KTMacBook.local ? 0 ? ? ? true
> > > > ? ?...done.
> > >
> > > > I then killed RabbitMQ by hitting control-C followed by 'a' to abort.
> > > > When I start the server again and check it with rabbitmqctl, it says
> > > > that there are no messages in the celery queue:
> > >
> > > > ? ?$ ?rabbitmqctl list_queues name messages durable
> > > > ? ?Listing queues ...
> > > > ? ?celery ? ? ?0 ? ? ? true
> > > > ? ?celeryctl_KTMacBook.local ? 0 ? ? ? true
> > > > ? ?...done.
> > >
> > > > The celery queue was durable. Why were the messages not persisted?
> > > > What do I need to do to make the messages persistent?
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.com
> > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >
> > >
> > >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Fri Feb 18 23:19:41 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 18 Feb 2011 15:19:41 -0800
Subject: [rabbitmq-discuss] How can we check that rabbitMQ server is
 running using java code?
In-Reply-To: <30957788.post@talk.nabble.com>
References: <30957788.post@talk.nabble.com>
Message-ID: <F78BCF638F95D74A99D036114107EDB5023948CF0F@EXCH-MBX-3.vmware.com>

> Hi,
> How can i program my java code that will give information that RabbitMQ
> server is running or not?
>

Hi, Cheepu...

>From where are you trying to find out whether the Rabbit broker is
running or not?  If you're trying to determine this from a remote Java
client, just seeing that the client can't connect to Rabbit at its
expected host and port by the exception that will be thrown if the
broker can't be reached ought to be sensible.  After all, if there's
nothing responding, there's not much more your remote application can
do.

If your Java code is a process on the same box, you may have a few
more options, including looking for the Erlang 'beam' process that
Rabbit is running in, exec-ing 'rabbitmqctl status', etc.

Best regards,
Jerry

From irrer at umich.edu  Fri Feb 18 23:31:20 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 18 Feb 2011 18:31:20 -0500
Subject: [rabbitmq-discuss] recording all messages
Message-ID: <AANLkTine8VTqPL_aGAcz9LCJp3TeBbC6VZ56SyrN5KC9@mail.gmail.com>

Howdy -

Is there a RabbitMQ plugin for recording all AMQP messages?  I was thinking
in terms of a development tool for diagnosing problems (knowing that it
would
be a huge drag on the system).

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110218/cac04f23/attachment.htm>

From max.bridgewater at gmail.com  Sat Feb 19 02:51:59 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Fri, 18 Feb 2011 21:51:59 -0500
Subject: [rabbitmq-discuss] Naming RabbitMQ nodes with complete domain names
Message-ID: <AANLkTikmB72_hinZGOvWy-UOD_W7ezyWzqB+1ZMD4JJ2@mail.gmail.com>

Hi,

This is probably a silly question but it really baffles me right now.
The original issue is this: I'm trying to use JInterface to connect to
a rabbitmq cluster hosted on EC2. But I keep getting "Cannot connect
to peer node". My understanding is that this error is happening
because I'm using the address 'rabbit at domain.org' to contact the
remote RabbitMQ node named: rabbit at domain. (Note the missing TLD).
That is, because there is no exact  match between the node name given
to JInterface and the name of the node it is connecting to, the
connection fails.

I desperately tried configuring RabbitMQ to take the complete domain
name (domain.org) instead of just the short domain name (domain). Any
suggestion on how to resolve this issue?

Beyond this, this problem begs the question of how do RabbitMQ nodes
located on different machines across different domains communicate
with each other if the only way they can be referred to each other by
short name? Up until now, I've only clustered nodes on the same
machine.

I'm sure missing something. Please enlighten me.

Sincerely,
Max.

From videlalvaro at gmail.com  Sat Feb 19 05:32:25 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 19 Feb 2011 13:32:25 +0800
Subject: [rabbitmq-discuss] Naming RabbitMQ nodes with complete domain
	names
In-Reply-To: <AANLkTikmB72_hinZGOvWy-UOD_W7ezyWzqB+1ZMD4JJ2@mail.gmail.com>
References: <AANLkTikmB72_hinZGOvWy-UOD_W7ezyWzqB+1ZMD4JJ2@mail.gmail.com>
Message-ID: <6E4EDE37-C738-47D3-AEEE-B8E002073098@gmail.com>

Have you tried changing the Erlang option -sname to -name?

That's the way Erlang uses to specify long names.

See http://erlang.org/doc/man/erl.html and then modify your rabbitmq-server script accordingly. 

Cheers,

Alvaro

Sent from my iFad

On Feb 19, 2011, at 10:51 AM, Max Bridgewater <max.bridgewater at gmail.com> wrote:

> Hi,
> 
> This is probably a silly question but it really baffles me right now.
> The original issue is this: I'm trying to use JInterface to connect to
> a rabbitmq cluster hosted on EC2. But I keep getting "Cannot connect
> to peer node". My understanding is that this error is happening
> because I'm using the address 'rabbit at domain.org' to contact the
> remote RabbitMQ node named: rabbit at domain. (Note the missing TLD).
> That is, because there is no exact  match between the node name given
> to JInterface and the name of the node it is connecting to, the
> connection fails.
> 
> I desperately tried configuring RabbitMQ to take the complete domain
> name (domain.org) instead of just the short domain name (domain). Any
> suggestion on how to resolve this issue?
> 
> Beyond this, this problem begs the question of how do RabbitMQ nodes
> located on different machines across different domains communicate
> with each other if the only way they can be referred to each other by
> short name? Up until now, I've only clustered nodes on the same
> machine.
> 
> I'm sure missing something. Please enlighten me.
> 
> Sincerely,
> Max.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From harvey.robin at gmail.com  Sat Feb 19 11:48:02 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Sat, 19 Feb 2011 11:48:02 +0000
Subject: [rabbitmq-discuss] What to do with "unwanted messages"
Message-ID: <AANLkTi=q7YkJ_NYXqAsYC9AhCiC1xha78ahwpjAXw_YE@mail.gmail.com>

Hi,

What is the recommended course of action for dealing with unwanted messages
in consumers?  If a consumer sends basic.cancel there's a possibility that
there will be one or more "undelivered" messages (depending on the
prefetch-count parameters), is it best to basic.reject these before or after
sending basic.cancel?

A connected issue here is that sending basic.cancel alters the sequence of
messages on the target queue, the undelivered message gets requeued at the
end of the queue.  AFAICS this is to be expected given how the basic.consume
mechanism works, but is there anything I can do to prevent this re-ordering?
 I suppose that using basic.get instead would probably do the trick, but is
there some combination of basic.reject and/or basic.recover that can also
prevent this re-ordering?


Thanks,
--Robin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110219/f1fb3ede/attachment.htm>

From max.bridgewater at gmail.com  Sat Feb 19 17:49:39 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Sat, 19 Feb 2011 12:49:39 -0500
Subject: [rabbitmq-discuss] Naming RabbitMQ nodes with complete domain
	names
In-Reply-To: <6E4EDE37-C738-47D3-AEEE-B8E002073098@gmail.com>
References: <AANLkTikmB72_hinZGOvWy-UOD_W7ezyWzqB+1ZMD4JJ2@mail.gmail.com>
	<6E4EDE37-C738-47D3-AEEE-B8E002073098@gmail.com>
Message-ID: <AANLkTimOPtEdSi4gTca4u8UvHfPQk+0=tT++C-1MtXK4@mail.gmail.com>

Hi Alvaro,

I believe you are right. The according modification of the rabbitmq
scripts seems not that straightforward. Here is what I've got sofar:

a) Changed the option -sname to -name in rabbitmq-multi
b) Changed the node name initialization in rabbitmq-env from
NODENAME=rabbit@${HOSTNAME%%.*} to #NODENAME=rabbit@${HOSTNAME}
c) Changed the node names in rabbitmq.config to use full host names.
d) Cleared the mnesia database.

Now, when I attempt to start the nodes, hereunder is what I get.
Apparently, despite these modifications rabbitmq/erlang is still
attempting to set the short name.

Any idea what else I'm missing?
Thanks,
Max.

============================================
Starting all nodes...
Starting node rabbit at ec2-174-122-225-215.compute-1.amazonaws.com...
Activating RabbitMQ plugins ...
0 plugins activated:

{error_logger,{{2011,2,19},{12,33,32}},"Can't set short node
name!\nPlease check your configuration\n",[]}


On Sat, Feb 19, 2011 at 12:32 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Have you tried changing the Erlang option -sname to -name?
>
> That's the way Erlang uses to specify long names.
>
> See http://erlang.org/doc/man/erl.html and then modify your rabbitmq-server script accordingly.
>
> Cheers,
>
> Alvaro
>
> Sent from my iFad
>
> On Feb 19, 2011, at 10:51 AM, Max Bridgewater <max.bridgewater at gmail.com> wrote:
>
>> Hi,
>>
>> This is probably a silly question but it really baffles me right now.
>> The original issue is this: I'm trying to use JInterface to connect to
>> a rabbitmq cluster hosted on EC2. But I keep getting "Cannot connect
>> to peer node". My understanding is that this error is happening
>> because I'm using the address 'rabbit at domain.org' to contact the
>> remote RabbitMQ node named: rabbit at domain. (Note the missing TLD).
>> That is, because there is no exact ?match between the node name given
>> to JInterface and the name of the node it is connecting to, the
>> connection fails.
>>
>> I desperately tried configuring RabbitMQ to take the complete domain
>> name (domain.org) instead of just the short domain name (domain). Any
>> suggestion on how to resolve this issue?
>>
>> Beyond this, this problem begs the question of how do RabbitMQ nodes
>> located on different machines across different domains communicate
>> with each other if the only way they can be referred to each other by
>> short name? Up until now, I've only clustered nodes on the same
>> machine.
>>
>> I'm sure missing something. Please enlighten me.
>>
>> Sincerely,
>> Max.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From videlalvaro at gmail.com  Sat Feb 19 18:19:36 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 20 Feb 2011 02:19:36 +0800
Subject: [rabbitmq-discuss] Naming RabbitMQ nodes with complete domain
	names
In-Reply-To: <AANLkTimOPtEdSi4gTca4u8UvHfPQk+0=tT++C-1MtXK4@mail.gmail.com>
References: <AANLkTikmB72_hinZGOvWy-UOD_W7ezyWzqB+1ZMD4JJ2@mail.gmail.com>
	<6E4EDE37-C738-47D3-AEEE-B8E002073098@gmail.com>
	<AANLkTimOPtEdSi4gTca4u8UvHfPQk+0=tT++C-1MtXK4@mail.gmail.com>
Message-ID: <DB37F2C2-7A68-406C-8099-9AD26771CDAD@gmail.com>

Restart the epmd process or if you are just running RabbitMQ then kill it after you stop the server.

Hope that helps.

Sent from my iFad

On Feb 20, 2011, at 1:49 AM, Max Bridgewater <max.bridgewater at gmail.com> wrote:

> Hi Alvaro,
> 
> I believe you are right. The according modification of the rabbitmq
> scripts seems not that straightforward. Here is what I've got sofar:
> 
> a) Changed the option -sname to -name in rabbitmq-multi
> b) Changed the node name initialization in rabbitmq-env from
> NODENAME=rabbit@${HOSTNAME%%.*} to #NODENAME=rabbit@${HOSTNAME}
> c) Changed the node names in rabbitmq.config to use full host names.
> d) Cleared the mnesia database.
> 
> Now, when I attempt to start the nodes, hereunder is what I get.
> Apparently, despite these modifications rabbitmq/erlang is still
> attempting to set the short name.
> 
> Any idea what else I'm missing?
> Thanks,
> Max.
> 
> ============================================
> Starting all nodes...
> Starting node rabbit at ec2-174-122-225-215.compute-1.amazonaws.com...
> Activating RabbitMQ plugins ...
> 0 plugins activated:
> 
> {error_logger,{{2011,2,19},{12,33,32}},"Can't set short node
> name!\nPlease check your configuration\n",[]}
> 
> 
> On Sat, Feb 19, 2011 at 12:32 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
>> Have you tried changing the Erlang option -sname to -name?
>> 
>> That's the way Erlang uses to specify long names.
>> 
>> See http://erlang.org/doc/man/erl.html and then modify your rabbitmq-server script accordingly.
>> 
>> Cheers,
>> 
>> Alvaro
>> 
>> Sent from my iFad
>> 
>> On Feb 19, 2011, at 10:51 AM, Max Bridgewater <max.bridgewater at gmail.com> wrote:
>> 
>>> Hi,
>>> 
>>> This is probably a silly question but it really baffles me right now.
>>> The original issue is this: I'm trying to use JInterface to connect to
>>> a rabbitmq cluster hosted on EC2. But I keep getting "Cannot connect
>>> to peer node". My understanding is that this error is happening
>>> because I'm using the address 'rabbit at domain.org' to contact the
>>> remote RabbitMQ node named: rabbit at domain. (Note the missing TLD).
>>> That is, because there is no exact  match between the node name given
>>> to JInterface and the name of the node it is connecting to, the
>>> connection fails.
>>> 
>>> I desperately tried configuring RabbitMQ to take the complete domain
>>> name (domain.org) instead of just the short domain name (domain). Any
>>> suggestion on how to resolve this issue?
>>> 
>>> Beyond this, this problem begs the question of how do RabbitMQ nodes
>>> located on different machines across different domains communicate
>>> with each other if the only way they can be referred to each other by
>>> short name? Up until now, I've only clustered nodes on the same
>>> machine.
>>> 
>>> I'm sure missing something. Please enlighten me.
>>> 
>>> Sincerely,
>>> Max.
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 

From max.bridgewater at gmail.com  Sat Feb 19 21:07:56 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Sat, 19 Feb 2011 16:07:56 -0500
Subject: [rabbitmq-discuss] Naming RabbitMQ nodes with complete domain
	names
In-Reply-To: <DB37F2C2-7A68-406C-8099-9AD26771CDAD@gmail.com>
References: <AANLkTikmB72_hinZGOvWy-UOD_W7ezyWzqB+1ZMD4JJ2@mail.gmail.com>
	<6E4EDE37-C738-47D3-AEEE-B8E002073098@gmail.com>
	<AANLkTimOPtEdSi4gTca4u8UvHfPQk+0=tT++C-1MtXK4@mail.gmail.com>
	<DB37F2C2-7A68-406C-8099-9AD26771CDAD@gmail.com>
Message-ID: <AANLkTi=jAO3GqPePoW0v_0NqyhQKHWEjZsH27S93Meq5@mail.gmail.com>

Thanks Alvaro. Unfortunately this still doesn't work for me. The steps
I followed are:

a) Stop rabbitmq
b) Change the option -sname to -name in rabbitmq-multi
c) Change the node name initialization in rabbitmq-env from
NODENAME=rabbit@${HOSTNAME%%.*} to #NODENAME=rabbit@${HOSTNAME}
d) Change the node names in rabbitmq.config to use full host names.
e) Cleare the mnesia database.
f) Reboot the complete machine
g) Start rabbitmq

The error message remains the same:
{error_logger,{{2011,2,19},{16,4,40}},"Can't set short node
name!\nPlease check your configuration\n",[]}

Regards,
Max.

On Sat, Feb 19, 2011 at 1:19 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Restart the epmd process or if you are just running RabbitMQ then kill it after you stop the server.
>
> Hope that helps.
>
> Sent from my iFad
>
> On Feb 20, 2011, at 1:49 AM, Max Bridgewater <max.bridgewater at gmail.com> wrote:
>
>> Hi Alvaro,
>>
>> I believe you are right. The according modification of the rabbitmq
>> scripts seems not that straightforward. Here is what I've got sofar:
>>
>> a) Changed the option -sname to -name in rabbitmq-multi
>> b) Changed the node name initialization in rabbitmq-env from
>> NODENAME=rabbit@${HOSTNAME%%.*} to #NODENAME=rabbit@${HOSTNAME}
>> c) Changed the node names in rabbitmq.config to use full host names.
>> d) Cleared the mnesia database.
>>
>> Now, when I attempt to start the nodes, hereunder is what I get.
>> Apparently, despite these modifications rabbitmq/erlang is still
>> attempting to set the short name.
>>
>> Any idea what else I'm missing?
>> Thanks,
>> Max.
>>
>> ============================================
>> Starting all nodes...
>> Starting node rabbit at ec2-174-122-225-215.compute-1.amazonaws.com...
>> Activating RabbitMQ plugins ...
>> 0 plugins activated:
>>
>> {error_logger,{{2011,2,19},{12,33,32}},"Can't set short node
>> name!\nPlease check your configuration\n",[]}
>>
>>
>> On Sat, Feb 19, 2011 at 12:32 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
>>> Have you tried changing the Erlang option -sname to -name?
>>>
>>> That's the way Erlang uses to specify long names.
>>>
>>> See http://erlang.org/doc/man/erl.html and then modify your rabbitmq-server script accordingly.
>>>
>>> Cheers,
>>>
>>> Alvaro
>>>
>>> Sent from my iFad
>>>
>>> On Feb 19, 2011, at 10:51 AM, Max Bridgewater <max.bridgewater at gmail.com> wrote:
>>>
>>>> Hi,
>>>>
>>>> This is probably a silly question but it really baffles me right now.
>>>> The original issue is this: I'm trying to use JInterface to connect to
>>>> a rabbitmq cluster hosted on EC2. But I keep getting "Cannot connect
>>>> to peer node". My understanding is that this error is happening
>>>> because I'm using the address 'rabbit at domain.org' to contact the
>>>> remote RabbitMQ node named: rabbit at domain. (Note the missing TLD).
>>>> That is, because there is no exact ?match between the node name given
>>>> to JInterface and the name of the node it is connecting to, the
>>>> connection fails.
>>>>
>>>> I desperately tried configuring RabbitMQ to take the complete domain
>>>> name (domain.org) instead of just the short domain name (domain). Any
>>>> suggestion on how to resolve this issue?
>>>>
>>>> Beyond this, this problem begs the question of how do RabbitMQ nodes
>>>> located on different machines across different domains communicate
>>>> with each other if the only way they can be referred to each other by
>>>> short name? Up until now, I've only clustered nodes on the same
>>>> machine.
>>>>
>>>> I'm sure missing something. Please enlighten me.
>>>>
>>>> Sincerely,
>>>> Max.
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>

From hekevintran at gmail.com  Sat Feb 19 21:19:43 2011
From: hekevintran at gmail.com (hekevintran)
Date: Sat, 19 Feb 2011 13:19:43 -0800 (PST)
Subject: [rabbitmq-discuss] Why is RabbitMQ not persisting messages on a
	durable queue?
In-Reply-To: <20110218225547.GB2329@dakota.doc.ic.ac.uk>
References: <de26a50f-64f1-484a-9914-c2a20e08e9d4@a21g2000prj.googlegroups.com>
	<AANLkTikRf=J5NiKRRQg3i_q0W30ih+BH4BaCun+F+dJ=@mail.gmail.com>
	<24bab23f-2513-4639-baad-34e488b37eb2@y36g2000pra.googlegroups.com>
	<20110218224417.GA2329@dakota.doc.ic.ac.uk>
	<20110218225547.GB2329@dakota.doc.ic.ac.uk>
Message-ID: <cd975db8-e88f-42ff-8c92-c8c23d83ccd0@u23g2000pro.googlegroups.com>

I was running version 2.2.0. Upgrading to 2.3.1 did the trick. Thanks!

Out of curiosity what was the bug that caused persistence to fail?

On Feb 18, 2:55?pm, Alexandru Scvortov <alexan... at rabbitmq.com> wrote:
> Also, are you running the latest version of the broker? ?There was a bug
> in versions of Rabbit before 2.3.0 that made the above problem worse.
> RabbitMQ 2.3.1 can still lose messages if it's killed quickly enough,
> but it should happen less often.
>
> Cheers,
> Alex
>
>
>
>
>
> On Sat, Feb 19, 2011 at 12:44:17AM +0200, Alexandru Scvor?ov wrote:
> > Hi,
>
> > A persistent message is one Rabbit will try to write to disk, but if the
> > server is killed before it gets the chance to do this, the message will
> > be lost.
>
> > There are a few ways to remedy this, either by using transactions or by
> > using confirms (see our recent blog posts). ?That said, I don't know if
> > you can get Celery to use any of these mechanisms.
>
> > Cheers,
> > Alex
>
> > On Fri, Feb 18, 2011 at 01:49:46PM -0800, hekevintran wrote:
> > > It looks like the delivery mode is already set to 2:
>
> > > ? ? In [1]: from apps.test_app.tasks import add
>
> > > ? ? In [2]: add.delivery_mode
> > > ? ? Out[2]: 2
>
> > > This default cannot be changed in celery as far as I know.
>
> > > On Feb 18, 1:40?pm, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> > > > Not sure of the celery underpinnings for specifying persistent messages,
> > > > perhaps it's documented, but you need to set the message delivery_mode = 2
> > > > in the message properties when calling Basic.Publish.
>
> > > > On Fri, Feb 18, 2011 at 4:19 PM, hekevintran <hekevint... at gmail.com> wrote:
> > > > > I am using RabbitMQ with Django through Celery. I am using the most
> > > > > basic setup:
>
> > > > > ? ?# RabbitMQ connection settings
> > > > > ? ?BROKER_HOST = 'localhost'
> > > > > ? ?BROKER_PORT = '5672'
> > > > > ? ?BROKER_USER = 'guest'
> > > > > ? ?BROKER_PASSWORD = 'guest'
> > > > > ? ?BROKER_VHOST = '/'
>
> > > > > I imported a Celery task and queued it to run one year later. From the
> > > > > iPython shell:
>
> > > > > ? ?In [1]: from apps.test_app.tasks import add
>
> > > > > ? ?In [2]: dt=datetime.datetime(2012, 2, 18, 10, 00)
>
> > > > > ? ?In [3]: add.apply_async((10, 6), eta=dt)
> > > > > ? ?DEBUG:amqplib:Start from server, version: 8.0, properties:
> > > > > {u'information': 'Licensed under the MPL. ?Seehttp://www.rabbitmq.com/',
> > > > > u'product': 'RabbitMQ', u'version': '2.2.0', u'copyright': 'Copyright
> > > > > (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and
> > > > > Rabbit Technologies Ltd.', u'platform': 'Erlang/OTP'}, mechanisms:
> > > > > ['PLAIN', 'AMQPLAIN'], locales: ['en_US']
> > > > > ? ?DEBUG:amqplib:Open OK! known_hosts []
> > > > > ? ?DEBUG:amqplib:using channel_id: 1
> > > > > ? ?DEBUG:amqplib:Channel open
> > > > > ? ?DEBUG:amqplib:Closed channel #1
> > > > > ? ?Out[3]: <AsyncResult: cfc507a1-175f-438e-acea-8c989a120ab3>
>
> > > > > RabbitMQ received this message in the celery queue:
>
> > > > > ? ?$ ?rabbitmqctl list_queues name messages durable
> > > > > ? ?Listing queues ...
> > > > > ? ?KTMacBook.local.celeryd.pidbox ? ? ?0 ? ? ? false
> > > > > ? ?celery ? ? ?1 ? ? ? true
> > > > > ? ?celeryctl_KTMacBook.local ? 0 ? ? ? true
> > > > > ? ?...done.
>
> > > > > I then killed RabbitMQ by hitting control-C followed by 'a' to abort.
> > > > > When I start the server again and check it with rabbitmqctl, it says
> > > > > that there are no messages in the celery queue:
>
> > > > > ? ?$ ?rabbitmqctl list_queues name messages durable
> > > > > ? ?Listing queues ...
> > > > > ? ?celery ? ? ?0 ? ? ? true
> > > > > ? ?celeryctl_KTMacBook.local ? 0 ? ? ? true
> > > > > ? ?...done.
>
> > > > > The celery queue was durable. Why were the messages not persisted?
> > > > > What do I need to do to make the messages persistent?
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-disc... at lists.rabbitmq.com
> > > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Sat Feb 19 21:46:03 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Sat, 19 Feb 2011 23:46:03 +0200
Subject: [rabbitmq-discuss] Why is RabbitMQ not persisting messages on a
 durable queue?
In-Reply-To: <cd975db8-e88f-42ff-8c92-c8c23d83ccd0@u23g2000pro.googlegroups.com>
References: <de26a50f-64f1-484a-9914-c2a20e08e9d4@a21g2000prj.googlegroups.com>
	<AANLkTikRf=J5NiKRRQg3i_q0W30ih+BH4BaCun+F+dJ=@mail.gmail.com>
	<24bab23f-2513-4639-baad-34e488b37eb2@y36g2000pra.googlegroups.com>
	<20110218224417.GA2329@dakota.doc.ic.ac.uk>
	<20110218225547.GB2329@dakota.doc.ic.ac.uk>
	<cd975db8-e88f-42ff-8c92-c8c23d83ccd0@u23g2000pro.googlegroups.com>
Message-ID: <20110219214603.GC2329@dakota.doc.ic.ac.uk>

> I was running version 2.2.0. Upgrading to 2.3.1 did the trick. Thanks!

Happy to hear that.

> Out of curiosity what was the bug that caused persistence to fail?

Queues use a timer to force periodic fsync()s.  That timer would
sometimes *not* get restarted leading to long delays before the messages
were actually written to disk.

Cheers,
Alex

On Sat, Feb 19, 2011 at 01:19:43PM -0800, hekevintran wrote:
> I was running version 2.2.0. Upgrading to 2.3.1 did the trick. Thanks!
> 
> Out of curiosity what was the bug that caused persistence to fail?
> 
> On Feb 18, 2:55?pm, Alexandru Scvortov <alexan... at rabbitmq.com> wrote:
> > Also, are you running the latest version of the broker? ?There was a bug
> > in versions of Rabbit before 2.3.0 that made the above problem worse.
> > RabbitMQ 2.3.1 can still lose messages if it's killed quickly enough,
> > but it should happen less often.
> >
> > Cheers,
> > Alex
> >
> >
> >
> >
> >
> > On Sat, Feb 19, 2011 at 12:44:17AM +0200, Alexandru Scvor?ov wrote:
> > > Hi,
> >
> > > A persistent message is one Rabbit will try to write to disk, but if the
> > > server is killed before it gets the chance to do this, the message will
> > > be lost.
> >
> > > There are a few ways to remedy this, either by using transactions or by
> > > using confirms (see our recent blog posts). ?That said, I don't know if
> > > you can get Celery to use any of these mechanisms.
> >
> > > Cheers,
> > > Alex
> >
> > > On Fri, Feb 18, 2011 at 01:49:46PM -0800, hekevintran wrote:
> > > > It looks like the delivery mode is already set to 2:
> >
> > > > ? ? In [1]: from apps.test_app.tasks import add
> >
> > > > ? ? In [2]: add.delivery_mode
> > > > ? ? Out[2]: 2
> >
> > > > This default cannot be changed in celery as far as I know.
> >
> > > > On Feb 18, 1:40?pm, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> > > > > Not sure of the celery underpinnings for specifying persistent messages,
> > > > > perhaps it's documented, but you need to set the message delivery_mode = 2
> > > > > in the message properties when calling Basic.Publish.
> >
> > > > > On Fri, Feb 18, 2011 at 4:19 PM, hekevintran <hekevint... at gmail.com> wrote:
> > > > > > I am using RabbitMQ with Django through Celery. I am using the most
> > > > > > basic setup:
> >
> > > > > > ? ?# RabbitMQ connection settings
> > > > > > ? ?BROKER_HOST = 'localhost'
> > > > > > ? ?BROKER_PORT = '5672'
> > > > > > ? ?BROKER_USER = 'guest'
> > > > > > ? ?BROKER_PASSWORD = 'guest'
> > > > > > ? ?BROKER_VHOST = '/'
> >
> > > > > > I imported a Celery task and queued it to run one year later. From the
> > > > > > iPython shell:
> >
> > > > > > ? ?In [1]: from apps.test_app.tasks import add
> >
> > > > > > ? ?In [2]: dt=datetime.datetime(2012, 2, 18, 10, 00)
> >
> > > > > > ? ?In [3]: add.apply_async((10, 6), eta=dt)
> > > > > > ? ?DEBUG:amqplib:Start from server, version: 8.0, properties:
> > > > > > {u'information': 'Licensed under the MPL. ?Seehttp://www.rabbitmq.com/',
> > > > > > u'product': 'RabbitMQ', u'version': '2.2.0', u'copyright': 'Copyright
> > > > > > (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and
> > > > > > Rabbit Technologies Ltd.', u'platform': 'Erlang/OTP'}, mechanisms:
> > > > > > ['PLAIN', 'AMQPLAIN'], locales: ['en_US']
> > > > > > ? ?DEBUG:amqplib:Open OK! known_hosts []
> > > > > > ? ?DEBUG:amqplib:using channel_id: 1
> > > > > > ? ?DEBUG:amqplib:Channel open
> > > > > > ? ?DEBUG:amqplib:Closed channel #1
> > > > > > ? ?Out[3]: <AsyncResult: cfc507a1-175f-438e-acea-8c989a120ab3>
> >
> > > > > > RabbitMQ received this message in the celery queue:
> >
> > > > > > ? ?$ ?rabbitmqctl list_queues name messages durable
> > > > > > ? ?Listing queues ...
> > > > > > ? ?KTMacBook.local.celeryd.pidbox ? ? ?0 ? ? ? false
> > > > > > ? ?celery ? ? ?1 ? ? ? true
> > > > > > ? ?celeryctl_KTMacBook.local ? 0 ? ? ? true
> > > > > > ? ?...done.
> >
> > > > > > I then killed RabbitMQ by hitting control-C followed by 'a' to abort.
> > > > > > When I start the server again and check it with rabbitmqctl, it says
> > > > > > that there are no messages in the celery queue:
> >
> > > > > > ? ?$ ?rabbitmqctl list_queues name messages durable
> > > > > > ? ?Listing queues ...
> > > > > > ? ?celery ? ? ?0 ? ? ? true
> > > > > > ? ?celeryctl_KTMacBook.local ? 0 ? ? ? true
> > > > > > ? ?...done.
> >
> > > > > > The celery queue was durable. Why were the messages not persisted?
> > > > > > What do I need to do to make the messages persistent?
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-disc... at lists.rabbitmq.com
> > > > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.com
> > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.r.carr at gmail.com  Sat Feb 19 22:02:13 2011
From: james.r.carr at gmail.com (James Carr)
Date: Sat, 19 Feb 2011 17:02:13 -0500
Subject: [rabbitmq-discuss] Alternative Message Store?
Message-ID: <AANLkTimvVuwZN8K9abv6QO36UPYf0F5DnwwtmTn-D-GG@mail.gmail.com>

Hi All,

Recently when giving a presentation on RabbitMQ at a local Java User
Group one question given was if it was possible to change where
RabbitMQ stores its messages. My answer was that it buffers them in
memory and when that reaches a threshold it stores them on disk, but I
have no idea if it is possible to change the storage mechanism without
resorting to plugins.

So... is it possible to change the storage mechanism to, say, couchdb,
riak or something?

Thanks,
James

From matthias at rabbitmq.com  Sat Feb 19 22:52:21 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 19 Feb 2011 22:52:21 +0000
Subject: [rabbitmq-discuss] Naming RabbitMQ nodes with complete domain
 names
In-Reply-To: <AANLkTi=jAO3GqPePoW0v_0NqyhQKHWEjZsH27S93Meq5@mail.gmail.com>
References: <AANLkTikmB72_hinZGOvWy-UOD_W7ezyWzqB+1ZMD4JJ2@mail.gmail.com>	<6E4EDE37-C738-47D3-AEEE-B8E002073098@gmail.com>	<AANLkTimOPtEdSi4gTca4u8UvHfPQk+0=tT++C-1MtXK4@mail.gmail.com>	<DB37F2C2-7A68-406C-8099-9AD26771CDAD@gmail.com>
	<AANLkTi=jAO3GqPePoW0v_0NqyhQKHWEjZsH27S93Meq5@mail.gmail.com>
Message-ID: <4D6049A5.1030204@rabbitmq.com>

Max,

Max Bridgewater wrote:
> Thanks Alvaro. Unfortunately this still doesn't work for me. The steps
> I followed are:
> 
> a) Stop rabbitmq
> b) Change the option -sname to -name in rabbitmq-multi

You'd also need to change this in rabbitmq-server.

However, ...

>>>>> The original issue is this: I'm trying to use JInterface to connect to
>>>>> a rabbitmq cluster hosted on EC2. But I keep getting "Cannot connect
>>>>> to peer node". My understanding is that this error is happening
>>>>> because I'm using the address 'rabbit at domain.org' to contact the
>>>>> remote RabbitMQ node named: rabbit at domain. (Note the missing TLD).
>>>>> That is, because there is no exact  match between the node name given
>>>>> to JInterface and the name of the node it is connecting to, the
>>>>> connection fails.
>>>>>
>>>>> I desperately tried configuring RabbitMQ to take the complete domain
>>>>> name (domain.org) instead of just the short domain name (domain). Any
>>>>> suggestion on how to resolve this issue?

I'd suggest configuring your local name resolution s.t. the hostname of 
the machine rabbit is running on resolves to the correct IP. That way 
you don't have to mess with long names.

Btw, what are you trying to accomplish with JInterface?


Regards,

Matthias.

From matthias at rabbitmq.com  Sat Feb 19 23:18:47 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 19 Feb 2011 23:18:47 +0000
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <30958766.post@talk.nabble.com>
References: <30958766.post@talk.nabble.com>
Message-ID: <4D604FD7.6030307@rabbitmq.com>

DOBRO wrote:
> Sometimes Client3 stops to receive messages from Client1 and Client2 (from
> queue board-queue-2) (even if Client2 publishes messages every 10 seconds).
> However, Client3 receives messages from all other queues.

When that happens I suggest you use the various rabbitmqctl list_* 
commands, or the rabbitmq-management plugin to investigate the state of 
your system, e.g.

- can you see all the exchanges, queues, bindings, connections, channels 
and consumers that should be present?

- are there messages building up in some of the queues?


Regards,

Matthias.

From rob at rabbitmq.com  Sat Feb 19 23:20:10 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Sat, 19 Feb 2011 23:20:10 +0000
Subject: [rabbitmq-discuss] Java handleShutdownSignal startegy
In-Reply-To: <4D53C520.6060305@gmail.com>
References: <4D53C520.6060305@gmail.com>
Message-ID: <4D60502A.9040309@rabbitmq.com>

Abishek,

I think the best strategy will depend on how many consumers you have per 
connection and whether you want multiple consumers (if you have them) to 
reconnect independently if their channel dies.

If you want to handle channel death on a per consumer basis, then using 
handleShutdownSignal on Consumer is fine. You'll need to make sure that 
when you open a new channel as part of the retry that you have moved 
work off the connection thread. Basically, you need to start a new 
thread in handleShutdownSignal before starting to interact with the 
connection.

I think a better solution is to use a ShutdownListener that can be 
attached to either the channel or the connection (or both). This is 
slightly more robust because it will allow retry to happen if the 
consumer hasn't yet been created (maybe there is an intermittent failure 
during startup).

Regards,

Rob

Abhishek Kona wrote:
> Abishek,
>
> I think the best strategy will depend on how many consumers you have per
> connection and whether you want multiple consumers (if you have them) to
> reconnect independently if their channel dies.
>
> If you want to handle channel death on a per consumer basis, then using
> handleShutdownSignal on Consumer is fine. You'll need to make sure that
> when you open a new channel as part of the retry that you have moved
> work off the connection thread. Basically, you need to start a new
> thread in handleShutdownSignal before starting to interact with the
> connection.
>
> I think a better solution is to use a ShutdownListener that can be
> attached to either the channel or the connection (or both). This is
> slightly more robust because it will allow retry to happen if the
> consumer hasn't yet been created (maybe there is an intermittent failure
> during startup).
>
> Regards,
>
> Rob

From james.r.carr at gmail.com  Sun Feb 20 01:23:37 2011
From: james.r.carr at gmail.com (James Carr)
Date: Sat, 19 Feb 2011 20:23:37 -0500
Subject: [rabbitmq-discuss] recording all messages
In-Reply-To: <AANLkTine8VTqPL_aGAcz9LCJp3TeBbC6VZ56SyrN5KC9@mail.gmail.com>
References: <AANLkTine8VTqPL_aGAcz9LCJp3TeBbC6VZ56SyrN5KC9@mail.gmail.com>
Message-ID: <AANLkTikeJD-vmHb3sNoysVz_08F8TaGRqVBYCJVTX4S7@mail.gmail.com>

I have actually been wondering the same thing. It'd be interesting to
know if there is a way to implement an EIP style wiretap outside of
just creating a queue for the routing key of the messages I want to
watch.


Thanks,
James


On Fri, Feb 18, 2011 at 6:31 PM, Jim Irrer <irrer at umich.edu> wrote:
> Howdy -
>
> Is there a RabbitMQ plugin for recording all AMQP messages?? I was thinking
> in terms of a development tool for diagnosing problems (knowing that it
> would
> be a huge drag on the system).
>
> Thanks,
>
> - Jim
>
> Jim Irrer? ?? irrer at umich.edu? ? ?? (734) 647-4409
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.? ? ? ? ? ?? Ann Arbor, MI 48103
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From matthias at rabbitmq.com  Sun Feb 20 11:50:14 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 20 Feb 2011 11:50:14 +0000
Subject: [rabbitmq-discuss] recording all messages
In-Reply-To: <AANLkTikeJD-vmHb3sNoysVz_08F8TaGRqVBYCJVTX4S7@mail.gmail.com>
References: <AANLkTine8VTqPL_aGAcz9LCJp3TeBbC6VZ56SyrN5KC9@mail.gmail.com>
	<AANLkTikeJD-vmHb3sNoysVz_08F8TaGRqVBYCJVTX4S7@mail.gmail.com>
Message-ID: <4D60FFF6.7090001@rabbitmq.com>

Jim, James,

James Carr wrote:
> On Fri, Feb 18, 2011 at 6:31 PM, Jim Irrer <irrer at umich.edu> wrote:
>> Is there a RabbitMQ plugin for recording all AMQP messages?  I was thinking
>> in terms of a development tool for diagnosing problems (knowing that it
>> would
>> be a huge drag on the system).
 >
> I have actually been wondering the same thing. It'd be interesting to
> know if there is a way to implement an EIP style wiretap outside of
> just creating a queue for the routing key of the messages I want to
> watch.

I can think of at least five ways of doing that:

1) tap into the network stream with wireshark, which understands AMQP.

2) insert a logging AMQP proxy. Writing AMQP proxies is really quite 
straightforward. See, for example, rabbit's tracer 
(http://www.rabbitmq.com/examples.html#tracer).

3) Bind a logging queue to the various exchanges that messages get 
published to, with the same binding keys as the other queues in the 
system, and log messages from an AMQP client consuming from that queue. 
This only works for fairly static configurations, i.e. where the 
exchanges, queues and their bindings are known in advance. And it cannot 
log messages sent to the default exchange, since that does not permit 
explicit bindings.

4) As 3), but create fanout exchange intermediaries for all exchanges, 
bind the aforementioned logging queue to that and bind the real 
exchanges to the intermediaries with exchange-to-exchange bindings. The 
advantage over 3) is that the logging queue only needs one binding to 
each intermediate exchange. Hence this can cope with dynamic queue 
creation & binding. However, publishers will need modifying to publish 
to the intermediate exchanges.

5) write a rabbit plugin that taps into rabbit's internal message 
routing APIs using Erlang's tracing functionality.


Regards,

Matthias.

From matthias at rabbitmq.com  Sun Feb 20 18:44:06 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 20 Feb 2011 18:44:06 +0000
Subject: [rabbitmq-discuss] What to do with "unwanted messages"
In-Reply-To: <AANLkTi=q7YkJ_NYXqAsYC9AhCiC1xha78ahwpjAXw_YE@mail.gmail.com>
References: <AANLkTi=q7YkJ_NYXqAsYC9AhCiC1xha78ahwpjAXw_YE@mail.gmail.com>
Message-ID: <4D6160F6.3020209@rabbitmq.com>

Robin,

Robin Harvey wrote:
> What is the recommended course of action for dealing with unwanted 
> messages in consumers?  If a consumer sends basic.cancel there's a 
> possibility that there will be one or more "undelivered" messages 
> (depending on the prefetch-count parameters), is it best to basic.reject 
> these before or after sending basic.cancel?

You could get the client send a basic.cancel and then basic.reject all 
messages received already and until the basic.cancel-ok arrives.

However, since you mention "unwanted" messages, why would you cancel the 
consumer? Wouldn't you just want to reject individual messages but 
continue consuming?

> A connected issue here is that sending basic.cancel alters the sequence 
> of messages on the target queue, the undelivered message gets requeued 
> at the end of the queue.

basic.cancel does not result in any requeueing of messages. It simply 
tells the server to stop sending messages to the consumer.

However, basic.reject, recover, and nack, and channel/connection 
termination do all cause requeuing. And yes, those messages go to the 
back of the queue.

However, since the subject of this email mentioned "unwanted" messages, 
why do you want them requeued at all?

> is there anything I can do to prevent this re-ordering?

No. In theory rabbit could preserve the order when requeuing and there 
is just a single consumer. But a) that would be going beyond the 
guarantees provided by the AMQP spec, and b) as soon as there is more 
than one consumer there is no sensible way to preserve the order.

> I suppose that using basic.get instead would probably 
> do the trick

Requeuing of a message fetched with basic.get behaves no different from 
that of a message received as a result of a basic.consume.

Regards,

Matthias.

From jasonjwwilliams at gmail.com  Sun Feb 20 20:30:51 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sun, 20 Feb 2011 13:30:51 -0700
Subject: [rabbitmq-discuss] Cluster Disk Node Functions
Message-ID: <AANLkTikk_JBLJXs+HOJRo1==FN7RBegk8Kq1ODdXRRNb@mail.gmail.com>

Hey Guys,

In the cluster docs it says all disk nodes in a cluster are required
for a node to leave "and a few other functions". I can't seem to find
what those are and I was curious if you could help? Thanks!

-J

From jasonjwwilliams at gmail.com  Sun Feb 20 20:32:03 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sun, 20 Feb 2011 13:32:03 -0700
Subject: [rabbitmq-discuss] Cluster - Changing Node Types
Message-ID: <AANLkTin1WiMuNjhn1_Q9H=AuqnHmi8R04Loaby7zkU56@mail.gmail.com>

In the cluster docs it has instructions for changing a node's type
from RAM to disk, but the commands look identical to just adding a
node. Is there an arg missing or does specifying two other nodes when
joining indicate the current node should be disk-based? Thank you in
advance.

-J

From alexis at rabbitmq.com  Sun Feb 20 20:36:20 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sun, 20 Feb 2011 20:36:20 +0000
Subject: [rabbitmq-discuss] Alternative Message Store?
In-Reply-To: <AANLkTimvVuwZN8K9abv6QO36UPYf0F5DnwwtmTn-D-GG@mail.gmail.com>
References: <AANLkTimvVuwZN8K9abv6QO36UPYf0F5DnwwtmTn-D-GG@mail.gmail.com>
Message-ID: <AANLkTin5+tO_uUM_hCW3viUxr8oWomSyFvX568b25i1k@mail.gmail.com>

Yes it is - various folks have been working on this...

alexis


On Sat, Feb 19, 2011 at 10:02 PM, James Carr <james.r.carr at gmail.com> wrote:
> Hi All,
>
> Recently when giving a presentation on RabbitMQ at a local Java User
> Group one question given was if it was possible to change where
> RabbitMQ stores its messages. My answer was that it buffers them in
> memory and when that reaches a threshold it stores them on disk, but I
> have no idea if it is possible to change the storage mechanism without
> resorting to plugins.
>
> So... is it possible to change the storage mechanism to, say, couchdb,
> riak or something?
>
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Sun Feb 20 21:06:11 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 20 Feb 2011 21:06:11 +0000
Subject: [rabbitmq-discuss] Alternative Message Store?
In-Reply-To: <AANLkTin5+tO_uUM_hCW3viUxr8oWomSyFvX568b25i1k@mail.gmail.com>
References: <AANLkTimvVuwZN8K9abv6QO36UPYf0F5DnwwtmTn-D-GG@mail.gmail.com>
	<AANLkTin5+tO_uUM_hCW3viUxr8oWomSyFvX568b25i1k@mail.gmail.com>
Message-ID: <4D618243.4030108@rabbitmq.com>

James,

Alexis Richardson wrote:
> On Sat, Feb 19, 2011 at 10:02 PM, James Carr <james.r.carr at gmail.com> wrote:
>> Recently when giving a presentation on RabbitMQ at a local Java User
>> Group one question given was if it was possible to change where
>> RabbitMQ stores its messages. My answer was that it buffers them in
>> memory and when that reaches a threshold it stores them on disk, but I
>> have no idea if it is possible to change the storage mechanism without
>> resorting to plugins.
>>
>> So... is it possible to change the storage mechanism to, say, couchdb,
>> riak or something?
 >>
 > Yes it is - various folks have been working on this...

But it *does* require writing a plug-in. Though that's not surprising - 
how else could it be done?

http://www.rabbitmq.com/blog/2011/01/20/rabbitmq-backing-stores-databases-and-disks/ 
is worth a read.


Matthias.

From matthias at rabbitmq.com  Sun Feb 20 21:09:57 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 20 Feb 2011 21:09:57 +0000
Subject: [rabbitmq-discuss] Cluster - Changing Node Types
In-Reply-To: <AANLkTin1WiMuNjhn1_Q9H=AuqnHmi8R04Loaby7zkU56@mail.gmail.com>
References: <AANLkTin1WiMuNjhn1_Q9H=AuqnHmi8R04Loaby7zkU56@mail.gmail.com>
Message-ID: <4D618325.2040106@rabbitmq.com>

Jason,

Jason J. W. Williams wrote:
> In the cluster docs it has instructions for changing a node's type
> from RAM to disk, but the commands look identical to just adding a
> node. Is there an arg missing or does specifying two other nodes when
> joining indicate the current node should be disk-based? Thank you in
> advance.

 From http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#cluster :

<quote>
If the current node is to become a disk node it needs to appear in the 
cluster node list. Otherwise it becomes a ram node.
</quote>

Matthias.

From jasonjwwilliams at gmail.com  Sun Feb 20 21:42:07 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sun, 20 Feb 2011 14:42:07 -0700
Subject: [rabbitmq-discuss] Cluster - Changing Node Types
In-Reply-To: <4D618325.2040106@rabbitmq.com>
References: <AANLkTin1WiMuNjhn1_Q9H=AuqnHmi8R04Loaby7zkU56@mail.gmail.com>
	<4D618325.2040106@rabbitmq.com>
Message-ID: <AANLkTi=zucXCkTXHDQcqgBQoUN3LohyPK+qV-p-AP0=A@mail.gmail.com>

Hi Matthias,

Thank you for the clarification.

-J

On Sun, Feb 20, 2011 at 2:09 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Jason,
>
> Jason J. W. Williams wrote:
>>
>> In the cluster docs it has instructions for changing a node's type
>> from RAM to disk, but the commands look identical to just adding a
>> node. Is there an arg missing or does specifying two other nodes when
>> joining indicate the current node should be disk-based? Thank you in
>> advance.
>
> From http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#cluster :
>
> <quote>
> If the current node is to become a disk node it needs to appear in the
> cluster node list. Otherwise it becomes a ram node.
> </quote>
>
> Matthias.
>

From simon at pretty.co.uk  Sun Feb 20 19:12:01 2011
From: simon at pretty.co.uk (simon dixon)
Date: Sun, 20 Feb 2011 19:12:01 +0000
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
Message-ID: <AANLkTikiOe-erSVNku1nQ5Nh-fptf0exFJ7ewmk1YfNr@mail.gmail.com>

>Are you willing to consider the support of Android Java clients in the
future?
>or do you consider that AMQP clients for smartphones are out of the scope
of
>RabbitMQ target?

+1 for rabbitMQ support on android, i'm also using it

Cheers
Simon

-- 
Simon Dixon

\ PRETTY

E:  simon at pretty.co.uk
W: www.pretty.co.uk

A: 11 clink street studios
A: London SE1 9DG

F: 087 1433 4095
T: 020 7378 8815
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110220/68b9878c/attachment-0001.htm>

From therevoltingx at gmail.com  Sun Feb 20 22:11:17 2011
From: therevoltingx at gmail.com (Miguel Morales)
Date: Sun, 20 Feb 2011 14:11:17 -0800
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
In-Reply-To: <AANLkTikiOe-erSVNku1nQ5Nh-fptf0exFJ7ewmk1YfNr@mail.gmail.com>
References: <AANLkTikiOe-erSVNku1nQ5Nh-fptf0exFJ7ewmk1YfNr@mail.gmail.com>
Message-ID: <AANLkTi=xk8XPQAKQk3-MshMv8xNR0sZ_G4PFd3oyStgu@mail.gmail.com>

Same here.  I setup a project to test it some time ago:
https://github.com/therevoltingx/rabbitmq_android_test
The biggest issue at the time was the objects being allocated for
every message.  This wrecked havoc in the android GC.

On Sun, Feb 20, 2011 at 11:12 AM, simon dixon <simon at pretty.co.uk> wrote:
>>Are you willing to consider the support of Android Java clients in the
>> future?
>>or do you consider that AMQP clients for smartphones are out of the scope
>> of
>>RabbitMQ target?
> +1 for rabbitMQ support on android, i'm also using it
> Cheers
> Simon
>
> --
> Simon Dixon
>
> \ PRETTY
>
> E: ?simon at pretty.co.uk
> W:?www.pretty.co.uk
>
> A: 11 clink street studios
> A: London SE1 9DG
>
> F: 087 1433 4095
> T: 020 7378 8815
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
~ Jeremiah:9:23-24
Android 2D MMORPG: http://developingthedream.blogspot.com/,
http://www.youtube.com/user/revoltingx

From jasonjwwilliams at gmail.com  Mon Feb 21 00:04:38 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sun, 20 Feb 2011 17:04:38 -0700
Subject: [rabbitmq-discuss] Pika reconnection error
Message-ID: <AANLkTik+k9WAgKJjh+f3rELCbXJaXQpC-R-dHHpXijWM@mail.gmail.com>

Hi Guys,

Having some issues with a test cluster setup. It's a 3-node cluster
with 2-disk and 1-RAM nodes. The RAM node is joined to both disk
nodes.

rabbit at Phantome - disk
rabbit_1 at Phantome - disk
rabbit_2 at Phantome - RAM

In front of the cluster is an HAProxy instance listening on port 5670
doing simple round-robin TCP load balancing between the cluster
members.

As long as all the nodes are running I can have my consumer connect
through the load balancer to any node and successfully consume.
Likewise with the producer. However, when I shutdown the node the
consumer is currently connected to and allow Pika to do the
reconnection, I get this error:

error: uncaptured python exception, closing channel
<pika.asyncore_adapter.RabbitDispatcher connected at 0x632350> (<class
'pika.exceptions.ChannelClosed'>:Connection.Close(class_id = 0,
method_id = 0, reply_code = 541, reply_text = 'INTERNAL_ERROR')
[/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/asyncore.py|read|74]
[/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/asyncore.py|handle_read_event|413]
[build/bdist.macosx-10.6-universal/egg/pika/asyncore_adapter.py|handle_read|86]
[build/bdist.macosx-10.6-universal/egg/pika/connection.py|on_data_available|268]
[build/bdist.macosx-10.6-universal/egg/pika/connection.py|_login2|375]
[build/bdist.macosx-10.6-universal/egg/pika/connection.py|handle_connection_open|201]
[cluster_test_consumer.py|on_connection_open|53]
[build/bdist.macosx-10.6-universal/egg/pika/spec.py|queue_declare|3003]
[build/bdist.macosx-10.6-universal/egg/pika/channel.py|_rpc|187]
[build/bdist.macosx-10.6-universal/egg/pika/connection.py|_rpc|326]
[build/bdist.macosx-10.6-universal/egg/pika/channel.py|wait_for_reply|125]
[build/bdist.macosx-10.6-universal/egg/pika/channel.py|_ensure|84])

Every few seconds Pika will attempt to reconnect the consumer and the
error repeats. The only unusual error in the Rabbit logs occurs on the
first reconnection: https://gist.github.com/836441

The rest of the time during these errors the logs look like this:
https://gist.github.com/836442

The consumer is disconnecting and reconnecting to HAProxy because the
stats show the connection moving between backend nodes.

The producer continues to operate correctly through the load balancer.

Consumer code is here: https://gist.github.com/836445

Any help/ideas are greatly appreciated.  Thank you in advance.

-J

From jasonjwwilliams at gmail.com  Mon Feb 21 00:13:25 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sun, 20 Feb 2011 17:13:25 -0700
Subject: [rabbitmq-discuss] Pika reconnection error
In-Reply-To: <AANLkTik+k9WAgKJjh+f3rELCbXJaXQpC-R-dHHpXijWM@mail.gmail.com>
References: <AANLkTik+k9WAgKJjh+f3rELCbXJaXQpC-R-dHHpXijWM@mail.gmail.com>
Message-ID: <AANLkTimUuhxdF+qn2t70SCdm21cbbqLwXOQh2vG=X=_C@mail.gmail.com>

BTW this problem only seems to occur when rabbit at Phantome is restarted
while the consumer is connected to it. Reconnections occur properly
when restarting rabbit_1 at Phantome and rabbit_2 at Phantome while the
consumer is connected.

Status of node rabbit_1 at Phantome ...
[{running_applications,[{rabbit,"RabbitMQ","2.3.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.16"},
                        {os_mon,"CPO  CXC 138 46","2.2.5"},
                        {sasl,"SASL  CXC 138 11","2.1.9.2"},
                        {stdlib,"ERTS  CXC 138 10","1.17.2"},
                        {kernel,"ERTS  CXC 138 10","2.14.2"}]},
 {nodes,[{disc,[rabbit_1 at Phantome,rabbit at Phantome]},
         {ram,[rabbit_2 at Phantome]}]},
 {running_nodes,[rabbit at Phantome,rabbit_2 at Phantome,rabbit_1 at Phantome]}]
...done.

-J

On Sun, Feb 20, 2011 at 5:04 PM, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
> Hi Guys,
>
> Having some issues with a test cluster setup. It's a 3-node cluster
> with 2-disk and 1-RAM nodes. The RAM node is joined to both disk
> nodes.
>
> rabbit at Phantome - disk
> rabbit_1 at Phantome - disk
> rabbit_2 at Phantome - RAM
>
> In front of the cluster is an HAProxy instance listening on port 5670
> doing simple round-robin TCP load balancing between the cluster
> members.
>
> As long as all the nodes are running I can have my consumer connect
> through the load balancer to any node and successfully consume.
> Likewise with the producer. However, when I shutdown the node the
> consumer is currently connected to and allow Pika to do the
> reconnection, I get this error:
>
> error: uncaptured python exception, closing channel
> <pika.asyncore_adapter.RabbitDispatcher connected at 0x632350> (<class
> 'pika.exceptions.ChannelClosed'>:Connection.Close(class_id = 0,
> method_id = 0, reply_code = 541, reply_text = 'INTERNAL_ERROR')
> [/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/asyncore.py|read|74]
> [/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/asyncore.py|handle_read_event|413]
> [build/bdist.macosx-10.6-universal/egg/pika/asyncore_adapter.py|handle_read|86]
> [build/bdist.macosx-10.6-universal/egg/pika/connection.py|on_data_available|268]
> [build/bdist.macosx-10.6-universal/egg/pika/connection.py|_login2|375]
> [build/bdist.macosx-10.6-universal/egg/pika/connection.py|handle_connection_open|201]
> [cluster_test_consumer.py|on_connection_open|53]
> [build/bdist.macosx-10.6-universal/egg/pika/spec.py|queue_declare|3003]
> [build/bdist.macosx-10.6-universal/egg/pika/channel.py|_rpc|187]
> [build/bdist.macosx-10.6-universal/egg/pika/connection.py|_rpc|326]
> [build/bdist.macosx-10.6-universal/egg/pika/channel.py|wait_for_reply|125]
> [build/bdist.macosx-10.6-universal/egg/pika/channel.py|_ensure|84])
>
> Every few seconds Pika will attempt to reconnect the consumer and the
> error repeats. The only unusual error in the Rabbit logs occurs on the
> first reconnection: https://gist.github.com/836441
>
> The rest of the time during these errors the logs look like this:
> https://gist.github.com/836442
>
> The consumer is disconnecting and reconnecting to HAProxy because the
> stats show the connection moving between backend nodes.
>
> The producer continues to operate correctly through the load balancer.
>
> Consumer code is here: https://gist.github.com/836445
>
> Any help/ideas are greatly appreciated. ?Thank you in advance.
>
> -J
>

From gmr at myyearbook.com  Mon Feb 21 00:30:25 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sun, 20 Feb 2011 19:30:25 -0500
Subject: [rabbitmq-discuss] Pika reconnection error
In-Reply-To: <AANLkTimUuhxdF+qn2t70SCdm21cbbqLwXOQh2vG=X=_C@mail.gmail.com>
References: <AANLkTik+k9WAgKJjh+f3rELCbXJaXQpC-R-dHHpXijWM@mail.gmail.com>
	<AANLkTimUuhxdF+qn2t70SCdm21cbbqLwXOQh2vG=X=_C@mail.gmail.com>
Message-ID: <AANLkTikuArBYAFUeMUx+4y2NvE7Q6deY3VG9JWHthMf9@mail.gmail.com>

I'd do a few things:

Since you're using 0.5.2, I'd use the SimpleReconnectionStrategy handler and
instead of extending the class like you are instead create a on_connected
method in your app, utilizing the Connection.addStateChangeHandler() method
to be notified when you are connected, and in this event handler do all of
your setup.

There was a bug report on the 0.5.2 branch with the reconnection handler
system. I did not trace that back, however.

You might be better served to check out the current version, as I have
tested the SRS pretty extensively, including cases where the server goes
away and comes back.  If you use 0.9.3 (or the soon to be released 0.94)
instead of the single callback function with a bool flag in 0.5.2, it has a
callback handler split out for each state:

Connection.add_on_close_callback(callback)
Connection.add_on_open_callback(callback)

In either version, I would suggest that the reconnection strategy class is
not the right place to handle your post-connection setup.

Regards,

Gavin

On Sun, Feb 20, 2011 at 7:13 PM, Jason J. W. Williams <
jasonjwwilliams at gmail.com> wrote:

> BTW this problem only seems to occur when rabbit at Phantome is restarted
> while the consumer is connected to it. Reconnections occur properly
> when restarting rabbit_1 at Phantome and rabbit_2 at Phantome while the
> consumer is connected.
>
> Status of node rabbit_1 at Phantome ...
> [{running_applications,[{rabbit,"RabbitMQ","2.3.0"},
>                        {mnesia,"MNESIA  CXC 138 12","4.4.16"},
>                        {os_mon,"CPO  CXC 138 46","2.2.5"},
>                        {sasl,"SASL  CXC 138 11","2.1.9.2"},
>                        {stdlib,"ERTS  CXC 138 10","1.17.2"},
>                        {kernel,"ERTS  CXC 138 10","2.14.2"}]},
>  {nodes,[{disc,[rabbit_1 at Phantome,rabbit at Phantome]},
>         {ram,[rabbit_2 at Phantome]}]},
>  {running_nodes,[rabbit at Phantome,rabbit_2 at Phantome,rabbit_1 at Phantome]}]
> ...done.
>
> -J
>
> On Sun, Feb 20, 2011 at 5:04 PM, Jason J. W. Williams
> <jasonjwwilliams at gmail.com> wrote:
> > Hi Guys,
> >
> > Having some issues with a test cluster setup. It's a 3-node cluster
> > with 2-disk and 1-RAM nodes. The RAM node is joined to both disk
> > nodes.
> >
> > rabbit at Phantome - disk
> > rabbit_1 at Phantome - disk
> > rabbit_2 at Phantome - RAM
> >
> > In front of the cluster is an HAProxy instance listening on port 5670
> > doing simple round-robin TCP load balancing between the cluster
> > members.
> >
> > As long as all the nodes are running I can have my consumer connect
> > through the load balancer to any node and successfully consume.
> > Likewise with the producer. However, when I shutdown the node the
> > consumer is currently connected to and allow Pika to do the
> > reconnection, I get this error:
> >
> > error: uncaptured python exception, closing channel
> > <pika.asyncore_adapter.RabbitDispatcher connected at 0x632350> (<class
> > 'pika.exceptions.ChannelClosed'>:Connection.Close(class_id = 0,
> > method_id = 0, reply_code = 541, reply_text = 'INTERNAL_ERROR')
> >
> [/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/asyncore.py|read|74]
> >
> [/System/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/asyncore.py|handle_read_event|413]
> >
> [build/bdist.macosx-10.6-universal/egg/pika/asyncore_adapter.py|handle_read|86]
> >
> [build/bdist.macosx-10.6-universal/egg/pika/connection.py|on_data_available|268]
> > [build/bdist.macosx-10.6-universal/egg/pika/connection.py|_login2|375]
> >
> [build/bdist.macosx-10.6-universal/egg/pika/connection.py|handle_connection_open|201]
> > [cluster_test_consumer.py|on_connection_open|53]
> > [build/bdist.macosx-10.6-universal/egg/pika/spec.py|queue_declare|3003]
> > [build/bdist.macosx-10.6-universal/egg/pika/channel.py|_rpc|187]
> > [build/bdist.macosx-10.6-universal/egg/pika/connection.py|_rpc|326]
> >
> [build/bdist.macosx-10.6-universal/egg/pika/channel.py|wait_for_reply|125]
> > [build/bdist.macosx-10.6-universal/egg/pika/channel.py|_ensure|84])
> >
> > Every few seconds Pika will attempt to reconnect the consumer and the
> > error repeats. The only unusual error in the Rabbit logs occurs on the
> > first reconnection: https://gist.github.com/836441
> >
> > The rest of the time during these errors the logs look like this:
> > https://gist.github.com/836442
> >
> > The consumer is disconnecting and reconnecting to HAProxy because the
> > stats show the connection moving between backend nodes.
> >
> > The producer continues to operate correctly through the load balancer.
> >
> > Consumer code is here: https://gist.github.com/836445
> >
> > Any help/ideas are greatly appreciated.  Thank you in advance.
> >
> > -J
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110220/3b6643f4/attachment-0001.htm>

From richardsbeats at gmail.com  Mon Feb 21 01:24:54 2011
From: richardsbeats at gmail.com (Gary Richards)
Date: Sun, 20 Feb 2011 17:24:54 -0800 (PST)
Subject: [rabbitmq-discuss] Hello World Example
Message-ID: <8ce0c1cf-3cbb-4df1-b970-c954eeb32681@r13g2000yqk.googlegroups.com>

When I try to use the Hello World example for Python I get the
following error:

TypeError: channel() takes at least 2 arguments (1 given)

Does anyone know what is wrong?

I use the following code:
#!/usr/bin/env python
import pika

connection = pika.AsyncoreConnection(pika.ConnectionParameters(
        host='localhost'))
channel = connection.channel()

channel.queue_declare(queue='hello')

channel.basic_publish(exchange='',
                      routing_key='hello',
                      body='Hello World!')
print " [x] Sent 'Hello World!'"
connection.close()

From mli at rmmsoft.com.cn  Mon Feb 21 07:19:59 2011
From: mli at rmmsoft.com.cn (Ming Li)
Date: Mon, 21 Feb 2011 07:19:59 +0000
Subject: [rabbitmq-discuss] MQ header question
Message-ID: <19F7DB1491CA0149AF64F65336540FEA0E62A457@server.rmmsoft.com.cn>

Hi,

I'm developing a stock quote distributing system, using Rabbit MQ.  It seem like the header(looks like GUID) is somewhat large, is there a way to reduce it to a minimum?  Is there some kind of settings that controls it? Is it possible that I have this setup wrong?

I'm trying to reduce data transmitted size.

Example:

0000   01 00 03 00 00 00 5f 00 3c 00 3c 21 61 6d 71 2e  ......_.<.<!amq.
0010   63 74 61 67 2d 4e 32 78 6d 34 6d 67 74 36 6a 78  ctag-N2xm4mgt6jx
0020   2f 4c 2b 45 39 48 36 58 78 61 41 3d 3d 00 00 00  /L+E9H6XxaA==...
0030   00 00 00 14 60 00 12 52 4d 4d 53 6f 66 74 5f 51  ....`..RMMSoft_Q
0040   75 6f 74 65 54 6f 70 69 63 1c 51 75 6f 74 65 54  uoteTopic.QuoteT
0050   6f 70 69 63 2e 43 46 46 45 58 2e 49 46 2e 46 2e  opic.CFFEX.IF.F.
0060   31 31 30 33 30 30 ce 02 00 03 00 00 00 3e 00 3c  110300


Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110221/becc8bbe/attachment.html>

From davorin.rusevljan at gmail.com  Mon Feb 21 07:28:18 2011
From: davorin.rusevljan at gmail.com (Davorin Rusevljan)
Date: Mon, 21 Feb 2011 08:28:18 +0100
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
In-Reply-To: <AANLkTi=xk8XPQAKQk3-MshMv8xNR0sZ_G4PFd3oyStgu@mail.gmail.com>
References: <AANLkTikiOe-erSVNku1nQ5Nh-fptf0exFJ7ewmk1YfNr@mail.gmail.com>
	<AANLkTi=xk8XPQAKQk3-MshMv8xNR0sZ_G4PFd3oyStgu@mail.gmail.com>
Message-ID: <AANLkTi=aD1C+XcQPGt68TfgJ_pbM3v-PvevwTG3u_ou4@mail.gmail.com>

On Sun, Feb 20, 2011 at 11:11 PM, Miguel Morales
<therevoltingx at gmail.com> wrote:
>>>Are you willing to consider the support of Android Java clients in the
>>> future?
>>>or do you consider that AMQP clients for smartphones are out of the scope
>>> of
>>>RabbitMQ target?
>> +1 for rabbitMQ support on android, i'm also using it

+1 Android platform is about to become very important one, it would be
a pity to miss it.

Davorin Rusevljan
http://www.cloud208.com/

From max.bridgewater at gmail.com  Mon Feb 21 07:35:17 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Mon, 21 Feb 2011 02:35:17 -0500
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
In-Reply-To: <4D51392F.8000508@telecom-sudparis.eu>
References: <4D51392F.8000508@telecom-sudparis.eu>
Message-ID: <AANLkTikqLXwvPwCdugu46eUAg+tG4W3LNZb14ToeNwgD@mail.gmail.com>

Anybody wants to join pitching in some bounties so the android API be
made production ready? I know RabbitMQ is now part of
SpringSource/VMWare, but nothing prevents the community from taking
leadership on some of the initiatives.

That is, having sufficient bounties to motivate a community member
might as well be a viable solution.

Max.

2011/2/8 Denis Conan <Denis.Conan at telecom-sudparis.eu>:
>
> Hi all,
>
> my objective is to run the Java Client on Android.
>
> Do not hesitate to tell me if I started off with the wrong idea.
>
> I didn't see any specific release for Android. So, I took the Java Client
> for J2SE. I was able to adapt the previous version 2.2.0 of the Java Client
> for running on Android: removal of packages json and jsonrpc, and correct a
> call to super in the constructor of the class
> PossibleAuthenticationFailureException.
>
> As I see, the new version 2.3.1 now has authentication with SASL.
> Unfortunately, there is no package javax.security.sasl in Android JRE. So, I
> tried to manage this lack by replacing the classes of this package by the
> ones in aSMACK (http://code.google.com/p/asmack/). The compilation is ok,
> but the execution throws the following exception.
>
> Any comment and/or help will be appreciated. Thanks in advance.
>
> java.io.IOException: No compatible authentication mechanism found - server
> offered [PLAIN AMQPLAIN]
> W/System.err( ?275): ? ?at
> com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:269)
> W/System.err( ?275): ? ?at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:382)
> W/System.err( ?275): ? ?at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:402)
> W/System.err( ?275): ? ?at
> eu.telecomsudparis.rabbitmq.tutorial.android.SendActivity.onCreate(SendActivity.java:26)
> W/System.err( ?275): ? ?at
> android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1047)
>
> The RabbitMQ server logs contains the following message:
>
> =INFO REPORT==== 8-Feb-2011::13:07:27 ===
> accepted TCP connection on [::]:5672 from 157.159.110.134:60291
>
> =INFO REPORT==== 8-Feb-2011::13:07:27 ===
> starting TCP connection <0.22221.0> from 157.159.110.134:60291
>
> =ERROR REPORT==== 8-Feb-2011::13:07:37 ===
> exception on TCP connection <0.22221.0> from 157.159.110.134:60291
> {handshake_timeout,frame_header}
>
> =INFO REPORT==== 8-Feb-2011::13:07:37 ===
> closing TCP connection <0.22221.0> from 157.159.110.134:60291
>
> --
> Denis Conan
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Mon Feb 21 07:43:04 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 21 Feb 2011 07:43:04 +0000
Subject: [rabbitmq-discuss] Pika reconnection error
In-Reply-To: <AANLkTik+k9WAgKJjh+f3rELCbXJaXQpC-R-dHHpXijWM@mail.gmail.com>
References: <AANLkTik+k9WAgKJjh+f3rELCbXJaXQpC-R-dHHpXijWM@mail.gmail.com>
Message-ID: <4D621788.4090707@rabbitmq.com>

Jason,

Jason J. W. Williams wrote:
> Every few seconds Pika will attempt to reconnect the consumer and the
> error repeats. The only unusual error in the Rabbit logs occurs on the
> first reconnection: https://gist.github.com/836441

That is a bug which we fixed a couple of weeks ago. So either wait for 
the next release or build from the current default head in hg.

Matthias.

From matthias at rabbitmq.com  Mon Feb 21 08:29:36 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 21 Feb 2011 08:29:36 +0000
Subject: [rabbitmq-discuss] Hello World Example
In-Reply-To: <8ce0c1cf-3cbb-4df1-b970-c954eeb32681@r13g2000yqk.googlegroups.com>
References: <8ce0c1cf-3cbb-4df1-b970-c954eeb32681@r13g2000yqk.googlegroups.com>
Message-ID: <4D622270.9090905@rabbitmq.com>

Gary,

On 21/02/11 01:24, Gary Richards wrote:
 > When I try to use the Hello World example for Python I get the
 > following error:
 >
 > TypeError: channel() takes at least 2 arguments (1 given)
 >
 > Does anyone know what is wrong?

 From http://www.rabbitmq.com/tutorial-one-python.html ...
<quote>
In this tutorial we're going to use pika version *0.5.2*
</quote>

Looks like you have a more recent version installed.


Regards,

Matthias.

From matthias at rabbitmq.com  Mon Feb 21 08:34:49 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 21 Feb 2011 08:34:49 +0000
Subject: [rabbitmq-discuss] MQ header question
In-Reply-To: <19F7DB1491CA0149AF64F65336540FEA0E62A457@server.rmmsoft.com.cn>
References: <19F7DB1491CA0149AF64F65336540FEA0E62A457@server.rmmsoft.com.cn>
Message-ID: <4D6223A9.406@rabbitmq.com>

On 21/02/11 07:19, Ming Li wrote:
> I?m developing a stock quote distributing system, using Rabbit MQ. It
> seem like the header(looks like GUID) is somewhat large, is there a way
> to reduce it to a minimum? Is there some kind of settings that controls
> it? Is it possible that I have this setup wrong?
>
> I?m trying to reduce data transmitted size.
>
> Example:
>
> 0000 01 00 03 00 00 00 5f 00 3c 00 3c 21 61 6d 71 2e ......_.<.<!amq.
>
> 0010 63 74 61 67 2d 4e 32 78 6d 34 6d 67 74 36 6a 78 ctag-N2xm4mgt6jx
>
> 0020 2f 4c 2b 45 39 48 36 58 78 61 41 3d 3d 00 00 00 /L+E9H6XxaA==...
>
> 0030 00 00 00 14 60 00 12 52 4d 4d 53 6f 66 74 5f 51 ....`..RMMSoft_Q
>
> 0040 75 6f 74 65 54 6f 70 69 63 1c 51 75 6f 74 65 54 uoteTopic.QuoteT
>
> 0050 6f 70 69 63 2e 43 46 46 45 58 2e 49 46 2e 46 2e opic.CFFEX.IF.F.
>
> 0060 31 31 30 33 30 30 ce 02 00 03 00 00 00 3e 00 3c 110300

The guid in there is a consumer tag which the server generates on 
basic.consume, and subsequently includes in message deliveries. The tag 
can be specified by the client instead, which allows you to make it as 
short as you like, though it has to be unique per channel.


Regards,

Matthias.

From Denis.Conan at telecom-sudparis.eu  Mon Feb 21 08:40:06 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Mon, 21 Feb 2011 09:40:06 +0100
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
In-Reply-To: <AANLkTi=xk8XPQAKQk3-MshMv8xNR0sZ_G4PFd3oyStgu@mail.gmail.com>
References: <AANLkTikiOe-erSVNku1nQ5Nh-fptf0exFJ7ewmk1YfNr@mail.gmail.com>
	<AANLkTi=xk8XPQAKQk3-MshMv8xNR0sZ_G4PFd3oyStgu@mail.gmail.com>
Message-ID: <4D6224E6.4000806@telecom-sudparis.eu>

Le 20/02/2011 23:11, Miguel Morales a ?crit :
> Same here.  I setup a project to test it some time ago:
> https://github.com/therevoltingx/rabbitmq_android_test
> The biggest issue at the time was the objects being allocated for
> every message.  This wrecked havoc in the android GC.

Hello,

it seems you started from a C library. Why not starting from the Java Client 
library?

With version 2.2.0, by removing the package json and modifying a few other 
classes, I obtained a version running on Android... Another issue appears with 
version 2.3.1 which is authentication.

CU

Denis

>
> On Sun, Feb 20, 2011 at 11:12 AM, simon dixon<simon at pretty.co.uk>  wrote:
>>> Are you willing to consider the support of Android Java clients in the
>>> future?
>>> or do you consider that AMQP clients for smartphones are out of the scope
>>> of
>>> RabbitMQ target?
>> +1 for rabbitMQ support on android, i'm also using it
>> Cheers
>> Simon
>>
>> --
>> Simon Dixon
>>
>> \ PRETTY
>>
>> E:  simon at pretty.co.uk
>> W: www.pretty.co.uk
>>
>> A: 11 clink street studios
>> A: London SE1 9DG
>>
>> F: 087 1433 4095
>> T: 020 7378 8815
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
>

From therevoltingx at gmail.com  Mon Feb 21 08:48:53 2011
From: therevoltingx at gmail.com (Miguel Morales)
Date: Mon, 21 Feb 2011 00:48:53 -0800
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
In-Reply-To: <4D6224E6.4000806@telecom-sudparis.eu>
References: <AANLkTikiOe-erSVNku1nQ5Nh-fptf0exFJ7ewmk1YfNr@mail.gmail.com>
	<AANLkTi=xk8XPQAKQk3-MshMv8xNR0sZ_G4PFd3oyStgu@mail.gmail.com>
	<4D6224E6.4000806@telecom-sudparis.eu>
Message-ID: <AANLkTik+G1eai8nJKfDdSjsL2HJeCRbf4x4XOGaL=KG_@mail.gmail.com>

I actually just experimented with the rabbitmq-c library, I did start
with the java library.
You can see it in the libs/ directory, I forget which version that one
is.  I believe it's pre 2.0
Everything works ok, but consuming messages fast will cause many GC
allocations leaving it only for basic usage.

2011/2/21 Denis Conan <Denis.Conan at telecom-sudparis.eu>:
> Le 20/02/2011 23:11, Miguel Morales a ?crit :
>>
>> Same here. ?I setup a project to test it some time ago:
>> https://github.com/therevoltingx/rabbitmq_android_test
>> The biggest issue at the time was the objects being allocated for
>> every message. ?This wrecked havoc in the android GC.
>
> Hello,
>
> it seems you started from a C library. Why not starting from the Java Client
> library?
>
> With version 2.2.0, by removing the package json and modifying a few other
> classes, I obtained a version running on Android... Another issue appears
> with version 2.3.1 which is authentication.
>
> CU
>
> Denis
>
>>
>> On Sun, Feb 20, 2011 at 11:12 AM, simon dixon<simon at pretty.co.uk> ?wrote:
>>>>
>>>> Are you willing to consider the support of Android Java clients in the
>>>> future?
>>>> or do you consider that AMQP clients for smartphones are out of the
>>>> scope
>>>> of
>>>> RabbitMQ target?
>>>
>>> +1 for rabbitMQ support on android, i'm also using it
>>> Cheers
>>> Simon
>>>
>>> --
>>> Simon Dixon
>>>
>>> \ PRETTY
>>>
>>> E: ?simon at pretty.co.uk
>>> W: www.pretty.co.uk
>>>
>>> A: 11 clink street studios
>>> A: London SE1 9DG
>>>
>>> F: 087 1433 4095
>>> T: 020 7378 8815
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
~ Jeremiah:9:23-24
Android 2D MMORPG: http://developingthedream.blogspot.com/,
http://www.youtube.com/user/revoltingx

From jasonjwwilliams at gmail.com  Mon Feb 21 09:10:02 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 21 Feb 2011 02:10:02 -0700
Subject: [rabbitmq-discuss] Pika reconnection error
In-Reply-To: <4D621788.4090707@rabbitmq.com>
References: <AANLkTik+k9WAgKJjh+f3rELCbXJaXQpC-R-dHHpXijWM@mail.gmail.com>
	<4D621788.4090707@rabbitmq.com>
Message-ID: <AANLkTinh0w-DSVDyKYMm5+qTjX206wkWBJut8zmq0NRX@mail.gmail.com>

Hi Matthias,

Thanks for the heads up. What causes the bug?

-J

On Mon, Feb 21, 2011 at 12:43 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Jason,
>
> Jason J. W. Williams wrote:
>>
>> Every few seconds Pika will attempt to reconnect the consumer and the
>> error repeats. The only unusual error in the Rabbit logs occurs on the
>> first reconnection: https://gist.github.com/836441
>
> That is a bug which we fixed a couple of weeks ago. So either wait for the
> next release or build from the current default head in hg.
>
> Matthias.
>

From bruce.bushby at gmail.com  Mon Feb 21 09:13:58 2011
From: bruce.bushby at gmail.com (bruce bushby)
Date: Mon, 21 Feb 2011 09:13:58 +0000
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
In-Reply-To: <AANLkTik+G1eai8nJKfDdSjsL2HJeCRbf4x4XOGaL=KG_@mail.gmail.com>
References: <AANLkTikiOe-erSVNku1nQ5Nh-fptf0exFJ7ewmk1YfNr@mail.gmail.com>
	<AANLkTi=xk8XPQAKQk3-MshMv8xNR0sZ_G4PFd3oyStgu@mail.gmail.com>
	<4D6224E6.4000806@telecom-sudparis.eu>
	<AANLkTik+G1eai8nJKfDdSjsL2HJeCRbf4x4XOGaL=KG_@mail.gmail.com>
Message-ID: <AANLkTikbZEvg4UQoK6Qtx9+SG52rj1J9x4VqMoXx4_ib@mail.gmail.com>

This may be slightly off topic ....RabbitMQ C client builds perfectly when
added to the "buildroot" framework.
I had to patch uClibc with "posix_spawn" which was taken from glibc.
I've not had a chance to send any messages yet, will post an update if there
are any problems.



./usr/lib/librabbitmq.so.0.0.0: ELF 32-bit LSB shared object, ARM, version 1
(SYSV), dynamically linked, stripped
./usr/bin/amqp-delete-queue:    ELF 32-bit LSB executable, ARM, version 1
(SYSV), dynamically linked (uses shared libs), stripped
./usr/bin/amqp-consume:         ELF 32-bit LSB executable, ARM, version 1
(SYSV), dynamically linked (uses shared libs), stripped
./usr/bin/amqp-get:             ELF 32-bit LSB executable, ARM, version 1
(SYSV), dynamically linked (uses shared libs), stripped
./usr/bin/amqp-declare-queue:   ELF 32-bit LSB executable, ARM, version 1
(SYSV), dynamically linked (uses shared libs), stripped
./usr/bin/amqp-publish:         ELF 32-bit LSB executable, ARM, version 1
(SYSV), dynamically linked (uses shared libs), stripped





On Mon, Feb 21, 2011 at 8:48 AM, Miguel Morales <therevoltingx at gmail.com>wrote:

> I actually just experimented with the rabbitmq-c library, I did start
> with the java library.
> You can see it in the libs/ directory, I forget which version that one
> is.  I believe it's pre 2.0
> Everything works ok, but consuming messages fast will cause many GC
> allocations leaving it only for basic usage.
>
> 2011/2/21 Denis Conan <Denis.Conan at telecom-sudparis.eu>:
> > Le 20/02/2011 23:11, Miguel Morales a ?crit :
> >>
> >> Same here.  I setup a project to test it some time ago:
> >> https://github.com/therevoltingx/rabbitmq_android_test
> >> The biggest issue at the time was the objects being allocated for
> >> every message.  This wrecked havoc in the android GC.
> >
> > Hello,
> >
> > it seems you started from a C library. Why not starting from the Java
> Client
> > library?
> >
> > With version 2.2.0, by removing the package json and modifying a few
> other
> > classes, I obtained a version running on Android... Another issue appears
> > with version 2.3.1 which is authentication.
> >
> > CU
> >
> > Denis
> >
> >>
> >> On Sun, Feb 20, 2011 at 11:12 AM, simon dixon<simon at pretty.co.uk>
>  wrote:
> >>>>
> >>>> Are you willing to consider the support of Android Java clients in the
> >>>> future?
> >>>> or do you consider that AMQP clients for smartphones are out of the
> >>>> scope
> >>>> of
> >>>> RabbitMQ target?
> >>>
> >>> +1 for rabbitMQ support on android, i'm also using it
> >>> Cheers
> >>> Simon
> >>>
> >>> --
> >>> Simon Dixon
> >>>
> >>> \ PRETTY
> >>>
> >>> E:  simon at pretty.co.uk
> >>> W: www.pretty.co.uk
> >>>
> >>> A: 11 clink street studios
> >>> A: London SE1 9DG
> >>>
> >>> F: 087 1433 4095
> >>> T: 020 7378 8815
> >>>
> >>> _______________________________________________
> >>> rabbitmq-discuss mailing list
> >>> rabbitmq-discuss at lists.rabbitmq.com
> >>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>>
> >>>
> >>
> >>
> >>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
>
>
> --
> ~ Jeremiah:9:23-24
> Android 2D MMORPG: http://developingthedream.blogspot.com/,
> http://www.youtube.com/user/revoltingx
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110221/9a8c1e9c/attachment.htm>

From matthias at rabbitmq.com  Mon Feb 21 09:16:59 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 21 Feb 2011 09:16:59 +0000
Subject: [rabbitmq-discuss] Pika reconnection error
In-Reply-To: <AANLkTinh0w-DSVDyKYMm5+qTjX206wkWBJut8zmq0NRX@mail.gmail.com>
References: <AANLkTik+k9WAgKJjh+f3rELCbXJaXQpC-R-dHHpXijWM@mail.gmail.com>	<4D621788.4090707@rabbitmq.com>
	<AANLkTinh0w-DSVDyKYMm5+qTjX206wkWBJut8zmq0NRX@mail.gmail.com>
Message-ID: <4D622D8B.8080605@rabbitmq.com>

Jason,

On 21/02/11 09:10, Jason J. W. Williams wrote:
> Thanks for the heads up. What causes the bug?

The bug is triggered when re-declaring a queue on a different cluster 
node. It was introduced in 2.3.0.

Matthias

From simon at rabbitmq.com  Mon Feb 21 11:07:02 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 21 Feb 2011 11:07:02 +0000
Subject: [rabbitmq-discuss] Management Plugins Crashing RabbitMQ
In-Reply-To: <AANLkTimAh2nUs95emHAZCyHz7ONEfNUanEuLMfpzQm9a@mail.gmail.com>
References: <AANLkTimQ=q+ZjoETcXd6d7TS-gwm2TNRFcA9nyBLFd_u@mail.gmail.com>	<4D5E49EC.3070004@rabbitmq.com>
	<AANLkTimAh2nUs95emHAZCyHz7ONEfNUanEuLMfpzQm9a@mail.gmail.com>
Message-ID: <4D624756.1080401@rabbitmq.com>

On 18/02/11 20:35, Max Bridgewater wrote:
> Hi Simon,
>
> The warnings might have indeed be from a previous run with a different
> version of Erlang. But now, I installed a  new version on a brand new
> EC2 instance. Checking the Erlang version with init:script_id().
> results in: {"OTP  APN 181 01","R13B04"}.
>
>
> The error messages are hereunder.

Hi Max. Is there anything interesting in 
/var/log/rabbitmq/rabbit@<hostname>.log or 
/var/log/rabbitmq/rabbit@<hostname>-sasl.log?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From richardsbeats at gmail.com  Mon Feb 21 12:23:27 2011
From: richardsbeats at gmail.com (Gary Richards)
Date: Mon, 21 Feb 2011 04:23:27 -0800 (PST)
Subject: [rabbitmq-discuss] Pika 0.9.3 & RabbitMQ
Message-ID: <3f8f3755-4818-431d-9e93-40d7f5b8d2c7@w19g2000yqa.googlegroups.com>

I'm using the examples that come with pika 0.9.3 but they don't work,
I get the following error:

AttributeError: 'ConnectionState' object has no attribute
'_waiting_for_protocol_header'

anyone know what it means?

I'm using Ubuntu 10.10

From gmr at myyearbook.com  Mon Feb 21 13:39:01 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 21 Feb 2011 08:39:01 -0500
Subject: [rabbitmq-discuss] Pika 0.9.3 & RabbitMQ
In-Reply-To: <3f8f3755-4818-431d-9e93-40d7f5b8d2c7@w19g2000yqa.googlegroups.com>
References: <3f8f3755-4818-431d-9e93-40d7f5b8d2c7@w19g2000yqa.googlegroups.com>
Message-ID: <90E0FAE3-E669-4195-A13F-39FC2263C22D@myyearbook.com>

Are you sure you're not using master out of github? Can you send a full traceback and python version?

On Feb 21, 2011, at 7:23 AM, Gary Richards <richardsbeats at gmail.com> wrote:

> I'm using the examples that come with pika 0.9.3 but they don't work,
> I get the following error:
> 
> AttributeError: 'ConnectionState' object has no attribute
> '_waiting_for_protocol_header'
> 
> anyone know what it means?
> 
> I'm using Ubuntu 10.10
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From richardsbeats at gmail.com  Mon Feb 21 16:09:48 2011
From: richardsbeats at gmail.com (Gary Richards)
Date: Mon, 21 Feb 2011 08:09:48 -0800 (PST)
Subject: [rabbitmq-discuss] Pika 0.9.3 & RabbitMQ
In-Reply-To: <90E0FAE3-E669-4195-A13F-39FC2263C22D@myyearbook.com>
References: <3f8f3755-4818-431d-9e93-40d7f5b8d2c7@w19g2000yqa.googlegroups.com>
	<90E0FAE3-E669-4195-A13F-39FC2263C22D@myyearbook.com>
Message-ID: <d79c65a8-9a30-4161-984b-c8d5432fab8a@a28g2000vbo.googlegroups.com>

this is the full trace:


Traceback (most recent call last):
  File "send.py", line 100, in <module>
    connection.ioloop.start()
  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
pika/adapters/select_connection.py", line 184, in start
    self.poller.start()
  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
pika/log.py", line 107, in debug_log
    return method(*args, **kwargs)
  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
pika/adapters/select_connection.py", line 445, in start
    self.poll()
  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
pika/adapters/select_connection.py", line 459, in poll
    self._handler(events[0][0], events[0][1])
  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
pika/adapters/base_connection.py", line 181, in _handle_events
    self._handle_read()
  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
pika/log.py", line 107, in debug_log
    return method(*args, **kwargs)
  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
pika/adapters/base_connection.py", line 210, in _handle_read
    self._on_data_available(data)
  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
pika/log.py", line 107, in debug_log
    return method(*args, **kwargs)
  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
pika/connection.py", line 577, in _on_data_available
    consumed_count, frame = self.state.handle_input(self._buffer)
  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
pika/log.py", line 107, in debug_log
    return method(*args, **kwargs)
  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
pika/connection.py", line 715, in handle_input
    data_out, frame = self._waiting_for_protocol_header(data_in)
AttributeError: 'ConnectionState' object has no attribute
'_waiting_for_protocol_header'

From gmr at myyearbook.com  Mon Feb 21 16:35:15 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 21 Feb 2011 11:35:15 -0500
Subject: [rabbitmq-discuss] Pika 0.9.3 & RabbitMQ
In-Reply-To: <d79c65a8-9a30-4161-984b-c8d5432fab8a@a28g2000vbo.googlegroups.com>
References: <3f8f3755-4818-431d-9e93-40d7f5b8d2c7@w19g2000yqa.googlegroups.com>
	<90E0FAE3-E669-4195-A13F-39FC2263C22D@myyearbook.com>
	<d79c65a8-9a30-4161-984b-c8d5432fab8a@a28g2000vbo.googlegroups.com>
Message-ID: <AANLkTi=sy9UEM5K67d-aMQwGw8Np8qORKrBYd7n3B5_h@mail.gmail.com>

That is odd, did you by chance install with pip against the github URL? I
have removed/reworked the code it's referencing in upcoming 0.9.4 but it's
there in 0.9.3:

https://github.com/tonyg/pika/blob/v0.9.3/pika/connection.py#L779

You're using 2.6 which is what my primary environment is in, would you do me
a favor and download 0.9.3 as a tarball from:

http://pypi.python.org/packages/source/p/pika/pika-v0.9.3.tar.gz

and in the root directory run "make test"  and email me off list with the
results? If that passes, can you run setup.py install from that dir and test
again with your app?

On Mon, Feb 21, 2011 at 11:09 AM, Gary Richards <richardsbeats at gmail.com>wrote:

> this is the full trace:
>
>
> Traceback (most recent call last):
>  File "send.py", line 100, in <module>
>    connection.ioloop.start()
>  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
> pika/adapters/select_connection.py", line 184, in start
>    self.poller.start()
>  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
> pika/log.py", line 107, in debug_log
>    return method(*args, **kwargs)
>  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
> pika/adapters/select_connection.py", line 445, in start
>    self.poll()
>  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
> pika/adapters/select_connection.py", line 459, in poll
>    self._handler(events[0][0], events[0][1])
>  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
> pika/adapters/base_connection.py", line 181, in _handle_events
>    self._handle_read()
>  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
> pika/log.py", line 107, in debug_log
>    return method(*args, **kwargs)
>  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
> pika/adapters/base_connection.py", line 210, in _handle_read
>    self._on_data_available(data)
>  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
> pika/log.py", line 107, in debug_log
>    return method(*args, **kwargs)
>  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
> pika/connection.py", line 577, in _on_data_available
>    consumed_count, frame = self.state.handle_input(self._buffer)
>  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
> pika/log.py", line 107, in debug_log
>    return method(*args, **kwargs)
>  File "/usr/local/lib/python2.6/dist-packages/pika-0.9.3-py2.6.egg/
> pika/connection.py", line 715, in handle_input
>    data_out, frame = self._waiting_for_protocol_header(data_in)
> AttributeError: 'ConnectionState' object has no attribute
> '_waiting_for_protocol_header'
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110221/b39da081/attachment.html>

From mark-erlang at aufflick.com  Mon Feb 21 22:42:24 2011
From: mark-erlang at aufflick.com (Mark Aufflick)
Date: Tue, 22 Feb 2011 09:42:24 +1100
Subject: [rabbitmq-discuss] (Lightweight) Publisher Confirms with the pika
	Python client
Message-ID: <AANLkTi=Bizeo7-=MoHHMSG1C6F9OYJf-95u_5Yq6SO4W@mail.gmail.com>

Hi all,

I have seen reference in passing on this list that all clients (except the C
client) support the lightweight publisher confirms (ie.
http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/).

I can't quite work out what this means in terms of using the Python pika
client. Firstly, creating a channel like so:

parameters = pika.ConnectionParameters('foo')
connection = BlockingConnection(parameters)
channel = connection.channel()
channel.queue_declare(queue='test', durable=True,
                     exclusive=False, auto_delete=False)


I'm then not sure how to put it into confirm mode. The java api seems to
have a selectConfirm() method that I don't see in the pika docs or source.

Once I have been able to put the channel into confirm mode, I then somehow
need to set the ack and nack callbacks. I see the channel.add_callback()
method, but the auto-generated (I'm guessing) docs are fairly opaque.

Hoping someone can shed some light on this? I'm also wondering if there is
an easy way to do a blocking publish that waits for the ack/nack and returns
success/failure.

Thanks,

Mark.
--
Mark Aufflick
 http://mark.aufflick.com/about/contact
 http://pumptheory.com/about
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110222/764c0415/attachment-0001.htm>

From gmr at myyearbook.com  Mon Feb 21 22:48:56 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 21 Feb 2011 17:48:56 -0500
Subject: [rabbitmq-discuss] (Lightweight) Publisher Confirms with the
 pika Python client
In-Reply-To: <AANLkTi=Bizeo7-=MoHHMSG1C6F9OYJf-95u_5Yq6SO4W@mail.gmail.com>
References: <AANLkTi=Bizeo7-=MoHHMSG1C6F9OYJf-95u_5Yq6SO4W@mail.gmail.com>
Message-ID: <AANLkTimMoFjyuKtQFoCpgCoWVPQc09_NT=sgYcSAOQ1F@mail.gmail.com>

There isn't currently tested Confirm support in Pika. I'll see if I can get
that tested and confirmed for 0.9.5.

On Mon, Feb 21, 2011 at 5:42 PM, Mark Aufflick <mark-erlang at aufflick.com>wrote:

> Hi all,
>
> I have seen reference in passing on this list that all clients (except the
> C client) support the lightweight publisher confirms (ie.
> http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/).
>
> I can't quite work out what this means in terms of using the Python pika
> client. Firstly, creating a channel like so:
>
> parameters = pika.ConnectionParameters('foo')
>
>
> connection = BlockingConnection(parameters)
>
>
> channel = connection.channel()
>
>
> channel.queue_declare(queue='test', durable=True,
>
>
>                      exclusive=False, auto_delete=False)
>
>
>
> I'm then not sure how to put it into confirm mode. The java api seems to
> have a selectConfirm() method that I don't see in the pika docs or source.
>
> Once I have been able to put the channel into confirm mode, I then somehow
> need to set the ack and nack callbacks. I see the channel.add_callback()
> method, but the auto-generated (I'm guessing) docs are fairly opaque.
>
> Hoping someone can shed some light on this? I'm also wondering if there is
> an easy way to do a blocking publish that waits for the ack/nack and returns
> success/failure.
>
> Thanks,
>
> Mark.
> --
> Mark Aufflick
>  http://mark.aufflick.com/about/contact
>  http://pumptheory.com/about
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110221/4ca89529/attachment.htm>

From jasonjwwilliams at gmail.com  Tue Feb 22 00:57:51 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 21 Feb 2011 17:57:51 -0700
Subject: [rabbitmq-discuss] txAMQP Helpers
Message-ID: <AANLkTikDKcHcOe3YyoaCc4t=Hc7N+bHdPQ9sdWmDo-Ut@mail.gmail.com>

Hi Guys,

In case it would be helpful to others, I've packaged Dan Siemon's
txamqp-twistd helper client and reconnecting factory
(http://git.coverfire.com/?p=txamqp-twistd.git;a=summary) into a true
Python package you can install and deploy. Only enhancement is the
factory now sports a self.deferred you can attach callbacks to that
will be fired after the first successful connection.

Repo is here:

https://github.com/williamsjj/txamqp-helpers

Also on pypi:

http://pypi.python.org/pypi/txamqp-helpers

-J

From gmr at myyearbook.com  Tue Feb 22 01:01:40 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 21 Feb 2011 20:01:40 -0500
Subject: [rabbitmq-discuss] Pika v0.9.4 Release
Message-ID: <AANLkTikEc8UhXWtHdNLkdoKGaphAsO_CieA4xwKjr1G7@mail.gmail.com>

Pika v0.9.4 has been released and pushed to PyPI. This is a bugfix
only release which primarily addresses a bug found with large frame
sizes (exceeding 1MB). Users of the previous 0.9 versions are
encouraged to upgrade to this version.

PIP users should run "pip install --upgrade pika"

Source tarball:
    http://pypi.python.org/packages/source/p/pika/pika-0.9.4.tar.gz
(md5 a00b44080c438e3233c05073a145e3dc)

Documentation:
    http://tonyg.github.com/pika/?0.9.4

From jdetreville at vmware.com  Tue Feb 22 03:49:06 2011
From: jdetreville at vmware.com (John DeTreville)
Date: Mon, 21 Feb 2011 19:49:06 -0800
Subject: [rabbitmq-discuss] Alternative Message Store?
In-Reply-To: <AANLkTimvVuwZN8K9abv6QO36UPYf0F5DnwwtmTn-D-GG@mail.gmail.com>
References: <AANLkTimvVuwZN8K9abv6QO36UPYf0F5DnwwtmTn-D-GG@mail.gmail.com>
Message-ID: <C406F347-D14D-439F-AB36-F628EC087063@vmware.com>

With plugins, you can in principal add your own storage mechanism. We are developing a few example plugins with different storage mechanisms, to help you when you develop yours.

For example, you can in principal keep your queue in a highly available distributed store. This might help you get high availability, but it is certainly not everything you will need.

That said, what do you want to achieve with a different storage mechanism?

Cheers,
John

On Feb 19, 2011, at 2:02 PM, James Carr wrote:

> Hi All,
> 
> Recently when giving a presentation on RabbitMQ at a local Java User
> Group one question given was if it was possible to change where
> RabbitMQ stores its messages. My answer was that it buffers them in
> memory and when that reaches a threshold it stores them on disk, but I
> have no idea if it is possible to change the storage mechanism without
> resorting to plugins.
> 
> So... is it possible to change the storage mechanism to, say, couchdb,
> riak or something?
> 
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From aniruddh_narayan at yahoo.co.in  Tue Feb 22 05:43:30 2011
From: aniruddh_narayan at yahoo.co.in (aniruddh narayan)
Date: Tue, 22 Feb 2011 11:13:30 +0530 (IST)
Subject: [rabbitmq-discuss] video/audio streaming over rabbitmq
Message-ID: <596244.47796.qm@web95415.mail.in2.yahoo.com>

HI
last week posted on this forum about the possibility of streaming video streaming .i tried it out ,but in vain ...can anybody please share any code base or sample implementation of the same...

thanks



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110222/2768b4ce/attachment-0001.htm>

From alexis at rabbitmq.com  Tue Feb 22 06:04:23 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 22 Feb 2011 06:04:23 +0000
Subject: [rabbitmq-discuss] txAMQP Helpers
In-Reply-To: <AANLkTikDKcHcOe3YyoaCc4t=Hc7N+bHdPQ9sdWmDo-Ut@mail.gmail.com>
References: <AANLkTikDKcHcOe3YyoaCc4t=Hc7N+bHdPQ9sdWmDo-Ut@mail.gmail.com>
Message-ID: <AANLkTin-wcCAF1Gb2ixjQECthrtuTdLAzx5zoExLYJV-@mail.gmail.com>

Jason

Thank-you.  Do you want us to list that on:
http://www.rabbitmq.com/devtools.html ?

alexis

On Tue, Feb 22, 2011 at 12:57 AM, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
> Hi Guys,
>
> In case it would be helpful to others, I've packaged Dan Siemon's
> txamqp-twistd helper client and reconnecting factory
> (http://git.coverfire.com/?p=txamqp-twistd.git;a=summary) into a true
> Python package you can install and deploy. Only enhancement is the
> factory now sports a self.deferred you can attach callbacks to that
> will be fired after the first successful connection.
>
> Repo is here:
>
> https://github.com/williamsjj/txamqp-helpers
>
> Also on pypi:
>
> http://pypi.python.org/pypi/txamqp-helpers
>
> -J
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alexis at rabbitmq.com  Tue Feb 22 06:07:14 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 22 Feb 2011 06:07:14 +0000
Subject: [rabbitmq-discuss] video/audio streaming over rabbitmq
In-Reply-To: <596244.47796.qm@web95415.mail.in2.yahoo.com>
References: <596244.47796.qm@web95415.mail.in2.yahoo.com>
Message-ID: <AANLkTimNdeB2yjx8n5t0RMdabdVtfZBm8krQvDuUAPD1@mail.gmail.com>

Try this: https://github.com/tonyg/camstream

Note that this will almost certainly not work with a recent version of
RabbitMQ.

alexis


On Tue, Feb 22, 2011 at 5:43 AM, aniruddh narayan <
aniruddh_narayan at yahoo.co.in> wrote:

> HI
> last week posted on this forum about the possibility of streaming video
> streaming .i tried it out ,but in vain ...can anybody please share any code
> base or sample implementation of the same...
>
> thanks
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110222/3404182b/attachment.htm>

From helf at hundsun.com  Tue Feb 22 06:53:19 2011
From: helf at hundsun.com (helf)
Date: Tue, 22 Feb 2011 14:53:19 +0800
Subject: [rabbitmq-discuss] Does anybody know how to deploy RabbitMQ on
	AIX-Unix system?
Message-ID: <000c01cbd25d$302c9250$9085b6f0$@hundsun.com>

Hi all,

Recently I am installing RabbitMQ server on AIX-Unix system. Unfortunately,
I can't compile Erlang on AIX-Unix system successfully. I searched the whole
rabbitmq-discuss archives and erlang-question archives, but couldn't find
any helpful info. L

Does anybody have experience in compiling Erlang or installing RabbitMQ
server on AIX-Unix system? 

 

Your reply will be appreciated!

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110222/d7af5d9e/attachment.htm>

From alexis at rabbitmq.com  Tue Feb 22 07:14:43 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 22 Feb 2011 07:14:43 +0000
Subject: [rabbitmq-discuss] Does anybody know how to deploy RabbitMQ on
 AIX-Unix system?
In-Reply-To: <000c01cbd25d$302c9250$9085b6f0$@hundsun.com>
References: <000c01cbd25d$302c9250$9085b6f0$@hundsun.com>
Message-ID: <AANLkTinOB_h3TG=S=5pQxtS1kcZvSNYKufoJWZC+jSTC@mail.gmail.com>

I can assure that this is possible and have bcc'd people who can help you.

alexis


On Tue, Feb 22, 2011 at 6:53 AM, helf <helf at hundsun.com> wrote:
> Hi all,
>
> Recently I am installing RabbitMQ server on AIX-Unix system. Unfortunately,
> I can?t compile Erlang on AIX-Unix system successfully. I searched the whole
> rabbitmq-discuss archives and erlang-question archives, but couldn?t find
> any helpful info. L
>
> Does anybody have experience in compiling Erlang or installing RabbitMQ
> server on AIX-Unix system?
>
>
>
> Your reply will be appreciated!
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From jasonjwwilliams at gmail.com  Tue Feb 22 07:26:31 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 22 Feb 2011 00:26:31 -0700
Subject: [rabbitmq-discuss] txAMQP Helpers
In-Reply-To: <AANLkTin-wcCAF1Gb2ixjQECthrtuTdLAzx5zoExLYJV-@mail.gmail.com>
References: <AANLkTikDKcHcOe3YyoaCc4t=Hc7N+bHdPQ9sdWmDo-Ut@mail.gmail.com>
	<AANLkTin-wcCAF1Gb2ixjQECthrtuTdLAzx5zoExLYJV-@mail.gmail.com>
Message-ID: <19FE8E1B-D4F7-4E22-A67D-876493C79FB6@gmail.com>

Hi Alexis,

That would be really helpful I think. At least until txAMQP integrates something like this into the core. Thank you. :)

-J

Sent via iPhone

Is your e-mail Premiere?

On Feb 21, 2011, at 23:04, Alexis Richardson <alexis at rabbitmq.com> wrote:

> Jason
> 
> Thank-you.  Do you want us to list that on:
> http://www.rabbitmq.com/devtools.html ?
> 
> alexis
> 
> On Tue, Feb 22, 2011 at 12:57 AM, Jason J. W. Williams
> <jasonjwwilliams at gmail.com> wrote:
>> Hi Guys,
>> 
>> In case it would be helpful to others, I've packaged Dan Siemon's
>> txamqp-twistd helper client and reconnecting factory
>> (http://git.coverfire.com/?p=txamqp-twistd.git;a=summary) into a true
>> Python package you can install and deploy. Only enhancement is the
>> factory now sports a self.deferred you can attach callbacks to that
>> will be fired after the first successful connection.
>> 
>> Repo is here:
>> 
>> https://github.com/williamsjj/txamqp-helpers
>> 
>> Also on pypi:
>> 
>> http://pypi.python.org/pypi/txamqp-helpers
>> 
>> -J
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 

From sunil at shopsocially.com  Tue Feb 22 09:00:50 2011
From: sunil at shopsocially.com (Sunil Arora)
Date: Tue, 22 Feb 2011 14:30:50 +0530
Subject: [rabbitmq-discuss] 2.1.1 versus 2.3.1
Message-ID: <6DD98642-E3CB-4343-8B68-5F06C17398B8@shopsocially.com>

Hi RabbitMQ folks,

We have been using RabbitMQ (version 2.2.0) with erlang version 5.7.2.

We have observed memory/cpu-load going up on our server running rabbitmq. We have to restart the server after it hits its VM limit. Someone pointed out that version 2.2.0 has some memory issues ( http://groups.google.com/group/celery-users/browse_thread/thread/b26579b70e7d21ae ). 

So we need an advise on which is the most stable version of rabbitmq that we should use. Is it 2.3.1 or 2.1.1 ?

Thanks in advance,
Sunil


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110222/dfc01a5d/attachment.htm>

From matthias at rabbitmq.com  Tue Feb 22 09:37:58 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 22 Feb 2011 09:37:58 +0000
Subject: [rabbitmq-discuss] Cluster Disk Node Functions
In-Reply-To: <AANLkTikk_JBLJXs+HOJRo1==FN7RBegk8Kq1ODdXRRNb@mail.gmail.com>
References: <AANLkTikk_JBLJXs+HOJRo1==FN7RBegk8Kq1ODdXRRNb@mail.gmail.com>
Message-ID: <4D6383F6.3090802@rabbitmq.com>

Jason,

On 20/02/11 20:30, Jason J. W. Williams wrote:
> In the cluster docs it says all disk nodes in a cluster are required
> for a node to leave "and a few other functions".

Where does it say that? I cannot find that quote anywhere on the rabbit 
web site.

Matthias.

From sunil at shopsocially.com  Tue Feb 22 09:50:42 2011
From: sunil at shopsocially.com (Sunil Arora)
Date: Tue, 22 Feb 2011 15:20:42 +0530
Subject: [rabbitmq-discuss] RabbitMQ Startup/Stopping
Message-ID: <AC54F926-6474-45FC-8BBB-CFB5B0058AB8@shopsocially.com>

Hi,

We have observed RabbitMQ takes a long time (way too long sometime) during startup/stopping. We are running it on Ubuntu and use normal init scripts that come with distribution to start or stop.

Is there any configuration or settings to speedup starting/stopping of rabbitmq?

Thanks
Sunil

From matthew at rabbitmq.com  Tue Feb 22 10:09:10 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 22 Feb 2011 10:09:10 +0000
Subject: [rabbitmq-discuss] RabbitMQ Startup/Stopping
In-Reply-To: <AC54F926-6474-45FC-8BBB-CFB5B0058AB8@shopsocially.com>
References: <AC54F926-6474-45FC-8BBB-CFB5B0058AB8@shopsocially.com>
Message-ID: <20110222100909.GA5409@wellquite.org>

Hi Sunil,

On Tue, Feb 22, 2011 at 03:20:42PM +0530, Sunil Arora wrote:
> We have observed RabbitMQ takes a long time (way too long sometime)
> during startup/stopping. We are running it on Ubuntu and use normal
> init scripts that come with distribution to start or stop.

Can you say which version of RabbitMQ this is, and, if it takes a long
time to start up, does this follow it being shut down with a "kill"
rather than shutdown cleanly?

Matthew

From matthew at rabbitmq.com  Tue Feb 22 10:12:56 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 22 Feb 2011 10:12:56 +0000
Subject: [rabbitmq-discuss] RabbitMQ Startup/Stopping
In-Reply-To: <20110222100909.GA5409@wellquite.org>
References: <AC54F926-6474-45FC-8BBB-CFB5B0058AB8@shopsocially.com>
	<20110222100909.GA5409@wellquite.org>
Message-ID: <20110222101255.GC5409@wellquite.org>

On Tue, Feb 22, 2011 at 10:09:10AM +0000, Matthew Sackman wrote:
> Can you say which version of RabbitMQ this is, and, if it takes a long
> time to start up, does this follow it being shut down with a "kill"
> rather than shutdown cleanly?

Also, when it's taking a long time to shutdown/startup, can you check
disk activity? It's probably working the harddiscs very hard. I'm
assuming you have a number of queues with a lot of persistent messages
in them?

Matthew

From sunil at shopsocially.com  Tue Feb 22 10:17:02 2011
From: sunil at shopsocially.com (Sunil Arora)
Date: Tue, 22 Feb 2011 15:47:02 +0530
Subject: [rabbitmq-discuss] RabbitMQ Startup/Stopping
In-Reply-To: <20110222100909.GA5409@wellquite.org>
References: <AC54F926-6474-45FC-8BBB-CFB5B0058AB8@shopsocially.com>
	<20110222100909.GA5409@wellquite.org>
Message-ID: <F2C80F7B-DE4C-415C-AD5A-406F52A79514@shopsocially.com>

We are using RabbitMQ 2.2.0 with erlang 5.7.2.

> Regarding, does this follow it being shut down with a "kill"
> rather than shutdown cleanly?
> 
Looking at the shutdown_log says "Stopping All nodes... OK done." Don't know how to trace if it was a case of force kill.


> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110222/49a6961e/attachment.htm>

From jiri at krutil.com  Tue Feb 22 10:17:37 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Tue, 22 Feb 2011 11:17:37 +0100
Subject: [rabbitmq-discuss] Problems with rabbitmq-auth-mechanism-ssl
Message-ID: <20110222111737.18686h3xjjh8likg@webmail.active24.cz>

Hi

I have upgraded my server and Java client to 2.3.1 and I'm trying the  
new SASL EXTERNAL authentication mechanism using  
rabbitmq-auth-mechanism-ssl plugin.

My rabbitmq.config contains:
[
     {rabbit, [
         {ssl_listeners, [{"0.0.0.0",5671}]},
         {ssl_options, [
             {cacertfile,"/home/alpha/ssl/ca/cacert.pem"},
             {certfile,"/home/alpha/ssl/server/servercert.pem"},
             {keyfile,"/home/alpha/ssl/server/serverkey.pem"},
             {verify,verify_peer},
             {fail_if_no_peer_cert,true},
             {auth_mechanisms,['EXTERNAL']}
         ]}
     ]}
].

I'm connecting from a Java client using a client certificate. The SSL  
handshake seems to work, but I can't seem to get the cert-based  
authentication working. My client cert has subject= /CN=CXAPI001

Not sure what should I do on the client side. Something like  
connectionFactory.setSaslConfig(new DefaultSaslConfig())?

This is what I'm getting in the server log:

=INFO REPORT==== 22-Feb-2011::10:22:05 ===
accepted TCP connection on 0.0.0.0:5671 from 172.20.12.132:1940

=INFO REPORT==== 22-Feb-2011::10:22:05 ===
starting TCP connection <0.325.0> from 172.20.12.132:1940

=INFO REPORT==== 22-Feb-2011::10:22:05 ===
upgraded TCP connection <0.325.0> to SSL

=ERROR REPORT==== 22-Feb-2011::10:22:08 ===
exception on TCP connection <0.325.0> from 172.20.12.132:1940
{channel0_error,starting,
                 {amqp_error,access_refused,
                             "PLAIN login refused: user 'guest' -  
invalid credentials",
                             'connection.start_ok'}}


From matthew at rabbitmq.com  Tue Feb 22 10:26:43 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 22 Feb 2011 10:26:43 +0000
Subject: [rabbitmq-discuss] RabbitMQ Startup/Stopping
In-Reply-To: <F2C80F7B-DE4C-415C-AD5A-406F52A79514@shopsocially.com>
References: <AC54F926-6474-45FC-8BBB-CFB5B0058AB8@shopsocially.com>
	<20110222100909.GA5409@wellquite.org>
	<F2C80F7B-DE4C-415C-AD5A-406F52A79514@shopsocially.com>
Message-ID: <20110222102642.GD5409@wellquite.org>

On Tue, Feb 22, 2011 at 03:47:02PM +0530, Sunil Arora wrote:
> We are using RabbitMQ 2.2.0 with erlang 5.7.2.
> 
> > Regarding, does this follow it being shut down with a "kill"
> > rather than shutdown cleanly?
>
> Looking at the shutdown_log says "Stopping All nodes... OK done."
> Don't know how to trace if it was a case of force kill.

Mmm, ok. Upgrading to 2.3.1 will definitely add one optimisation which
has the capacity to vastly reduce the amount of disk activity (if that
is indeed what's going on), but it's not clear whether that would apply
in your case.

Basically, Rabbit doesn't always write all data to disk immediately.
Consequently on shutdown, it can have a fair backlog to write out. This
can take some time. If you force kill it during this time, then on
startup, it has to do all sorts of consistency checks (the equiv. of an
fsck) which will take even longer. So whilst it may take 5 mins to shut
it down, it's by far the better idea to allow it to do that so that the
startup is then near instantaneous.

The optimisation mentioned above allows the elimination of disk activity
for queues that have been deleted. If Rabbit is heavily loaded, the part
of Rabbit that writes messages to disk can be some way behind the
various queues, and as such can still continue to write out messages for
queues that have since been deleted. We added an optimisation that
allows the detection of this situation and thus the elimination of these
writes. This may help you if this corresponds to your situation.

Matthew

From matthew at rabbitmq.com  Tue Feb 22 10:28:38 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 22 Feb 2011 10:28:38 +0000
Subject: [rabbitmq-discuss] 2.1.1 versus 2.3.1
In-Reply-To: <6DD98642-E3CB-4343-8B68-5F06C17398B8@shopsocially.com>
References: <6DD98642-E3CB-4343-8B68-5F06C17398B8@shopsocially.com>
Message-ID: <20110222102837.GE5409@wellquite.org>

Hi Sunil,

On Tue, Feb 22, 2011 at 02:30:50PM +0530, Sunil Arora wrote:
> We have been using RabbitMQ (version 2.2.0) with erlang version 5.7.2.
> 
> We have observed memory/cpu-load going up on our server running
> rabbitmq. We have to restart the server after it hits its VM limit.
> Someone pointed out that version 2.2.0 has some memory issues (
> http://groups.google.com/group/celery-users/browse_thread/thread/b26579b70e7d21ae
> ).

Why do you have to restart it? Is it actually crashing and running out
of RAM?

> So we need an advise on which is the most stable version of rabbitmq
> that we should use. Is it 2.3.1 or 2.1.1?

The latest version is always the best version to use.

Matthew

From sunil at shopsocially.com  Tue Feb 22 10:30:56 2011
From: sunil at shopsocially.com (Sunil Arora)
Date: Tue, 22 Feb 2011 16:00:56 +0530
Subject: [rabbitmq-discuss] RabbitMQ Startup/Stopping
In-Reply-To: <20110222101255.GC5409@wellquite.org>
References: <AC54F926-6474-45FC-8BBB-CFB5B0058AB8@shopsocially.com>
	<20110222100909.GA5409@wellquite.org>
	<20110222101255.GC5409@wellquite.org>
Message-ID: <1EF56BC3-A622-4877-AA6B-393B499147A7@shopsocially.com>

Thanks Matthew,

I will keep a watch on I/O next time i shut the node down.

Is there a good resource for configuration optimization for rabbitmq ?

Thanks
Sunil
On 22-Feb-2011, at 3:42 PM, Matthew Sackman wrote:

> On Tue, Feb 22, 2011 at 10:09:10AM +0000, Matthew Sackman wrote:
>> Can you say which version of RabbitMQ this is, and, if it takes a long
>> time to start up, does this follow it being shut down with a "kill"
>> rather than shutdown cleanly?
> 
> Also, when it's taking a long time to shutdown/startup, can you check
> disk activity? It's probably working the harddiscs very hard. I'm
> assuming you have a number of queues with a lot of persistent messages
> in them?
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Tue Feb 22 10:32:14 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 22 Feb 2011 10:32:14 +0000
Subject: [rabbitmq-discuss] Why does Channel.queueDeclarePassive close
 the channel?
In-Reply-To: <461B89FD-949B-402C-836D-14CC59D5F389@gmail.com>
References: <0426C874-EC06-472C-B24C-215689858AD4@gmail.com>
	<4D5EA118.2000704@rabbitmq.com>
	<461B89FD-949B-402C-836D-14CC59D5F389@gmail.com>
Message-ID: <4D6390AE.3040906@rabbitmq.com>

On 18/02/11 17:03, Yuesong Wang wrote:
> Now on the producer side, a dumb but easy way to make sure the queue
> gets recreated if missing is to always declare the queue and binding
> before every publish.  It works but I'd imagine it is very inefficient,
> yeah?

If you do so before every basic.publish invocation, yes! Declaring a 
queue or binding that already exists is pretty cheap on the server, but 
you still end up making a synchronous call over the network.

> The consumer code is a bit more complicated with the use of
> QueueConsumer and Channel.basicConsumer. For a running consumer to use a
> recreated queue, do I have to instantiate a new QueueConsumer, and call
> Channel.basicConsumer again? I'm new to RabbitMQ and there seems to be a
> lot of options to go about this. Any pointers are much appreciated.

The usual pattern would be to declare the objects you want to use after 
starting a channel. But if you're concerned about a queue going away 
then I suspect the best thing to do is catch the connection / channel 
closing, and then if that happens tear down, reconnect and redeclare.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Tue Feb 22 10:36:19 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 22 Feb 2011 10:36:19 +0000
Subject: [rabbitmq-discuss] RabbitMQ Startup/Stopping
In-Reply-To: <1EF56BC3-A622-4877-AA6B-393B499147A7@shopsocially.com>
References: <AC54F926-6474-45FC-8BBB-CFB5B0058AB8@shopsocially.com>
	<20110222100909.GA5409@wellquite.org>
	<20110222101255.GC5409@wellquite.org>
	<1EF56BC3-A622-4877-AA6B-393B499147A7@shopsocially.com>
Message-ID: <20110222103619.GF5409@wellquite.org>

Hi Sunil,

On Tue, Feb 22, 2011 at 04:00:56PM +0530, Sunil Arora wrote:
> Is there a good resource for configuration optimization for rabbitmq ?

No not really, and there's really very little you can tweek which will
likely improve performance. Improving disk performance is likely to be
key here. If you're on a virtualised platform, then giving it raw access
to the underlying disk might help, but a few disk benchmarks (e.g.
bonnie++) from within the VM might be revealing.

Matthew

From matthias at rabbitmq.com  Tue Feb 22 10:37:01 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 22 Feb 2011 10:37:01 +0000
Subject: [rabbitmq-discuss] Why does Channel.queueDeclarePassive close
 the channel?
In-Reply-To: <4D6390AE.3040906@rabbitmq.com>
References: <0426C874-EC06-472C-B24C-215689858AD4@gmail.com>	<4D5EA118.2000704@rabbitmq.com>	<461B89FD-949B-402C-836D-14CC59D5F389@gmail.com>
	<4D6390AE.3040906@rabbitmq.com>
Message-ID: <4D6391CD.3020902@rabbitmq.com>

On 22/02/11 10:32, Simon MacMullen wrote:
> Declaring a queue or binding that already exists is pretty cheap on
> the server, but you still end up making a synchronous call over the
> network.

...unless you specify the 'nowait' flag, which makes these commands 
one-way. Still, as Simon said, one typically only declares resources 
after opening a channel.


Matthias.

From sunil at shopsocially.com  Tue Feb 22 10:40:07 2011
From: sunil at shopsocially.com (Sunil Arora)
Date: Tue, 22 Feb 2011 16:10:07 +0530
Subject: [rabbitmq-discuss] 2.1.1 versus 2.3.1
In-Reply-To: <20110222102837.GE5409@wellquite.org>
References: <6DD98642-E3CB-4343-8B68-5F06C17398B8@shopsocially.com>
	<20110222102837.GE5409@wellquite.org>
Message-ID: <E25DF5F8-80A2-4E9A-8523-5466B03E401D@shopsocially.com>

We have observed it becomes unresponsive after that.

While upgrading from 2.2.0 to 2.3.1, do we have to upgrade our amqp clients as well?




On 22-Feb-2011, at 3:58 PM, Matthew Sackman wrote:

> Hi Sunil,
> 
> On Tue, Feb 22, 2011 at 02:30:50PM +0530, Sunil Arora wrote:
>> We have been using RabbitMQ (version 2.2.0) with erlang version 5.7.2.
>> 
>> We have observed memory/cpu-load going up on our server running
>> rabbitmq. We have to restart the server after it hits its VM limit.
>> Someone pointed out that version 2.2.0 has some memory issues (
>> http://groups.google.com/group/celery-users/browse_thread/thread/b26579b70e7d21ae
>> ).
> 
> Why do you have to restart it? Is it actually crashing and running out
> of RAM?
> 
>> So we need an advise on which is the most stable version of rabbitmq
>> that we should use. Is it 2.3.1 or 2.1.1?
> 
> The latest version is always the best version to use.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Tue Feb 22 10:47:25 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 22 Feb 2011 10:47:25 +0000
Subject: [rabbitmq-discuss] Problems with rabbitmq-auth-mechanism-ssl
In-Reply-To: <20110222111737.18686h3xjjh8likg@webmail.active24.cz>
References: <20110222111737.18686h3xjjh8likg@webmail.active24.cz>
Message-ID: <4D63943D.9030206@rabbitmq.com>

On 22/02/11 10:17, Jiri Krutil wrote:
> I have upgraded my server and Java client to 2.3.1 and I'm trying the
> new SASL EXTERNAL authentication mechanism using
> rabbitmq-auth-mechanism-ssl plugin.
>
> My rabbitmq.config contains:
> [
> {rabbit, [
> {ssl_listeners, [{"0.0.0.0",5671}]},
> {ssl_options, [
> {cacertfile,"/home/alpha/ssl/ca/cacert.pem"},
> {certfile,"/home/alpha/ssl/server/servercert.pem"},
> {keyfile,"/home/alpha/ssl/server/serverkey.pem"},
> {verify,verify_peer},
> {fail_if_no_peer_cert,true},
> {auth_mechanisms,['EXTERNAL']}
> ]}
> ]}
> ].

This certainly looks like it should work.

> I'm connecting from a Java client using a client certificate. The SSL
> handshake seems to work, but I can't seem to get the cert-based
> authentication working. My client cert has subject= /CN=CXAPI001
>
> Not sure what should I do on the client side. Something like
> connectionFactory.setSaslConfig(new DefaultSaslConfig())?

This should not be needed. The DefaultSaslConfig is used by default :) 
and will use Sun's standard algorithm for selecting a mechanism 
(whatever that is, but in practice it's always selected EXTERNAL for me 
when possible).

> This is what I'm getting in the server log:

> =ERROR REPORT==== 22-Feb-2011::10:22:08 ===
> exception on TCP connection <0.325.0> from 172.20.12.132:1940
> {channel0_error,starting,
> {amqp_error,access_refused,
> "PLAIN login refused: user 'guest' - invalid credentials",
> 'connection.start_ok'}}

But this is deeply suspicious. If you've specified 
{auth_mechanisms,['EXTERNAL']} in your configuration, it should not be 
possible to even start PLAIN authentication - that item specifies the 
entire list of mechanisms to offer. I therefore wonder if your 
configuration isn't getting picked up?

Do you have the mgmt plugin installed? If so, Overview > (node name) > 
Registry > Authentication Mechanisms will show you which mechanisms are 
installed and enabled.

If not, and you're able to compile the Java client (or run it in a 
debugger), checking the value of the "mechanisms" variable around line 
267 of AMQConnection.java will tell you what mechanisms the client is 
being offered.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthias at rabbitmq.com  Tue Feb 22 10:50:37 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 22 Feb 2011 10:50:37 +0000
Subject: [rabbitmq-discuss] 2.1.1 versus 2.3.1
In-Reply-To: <E25DF5F8-80A2-4E9A-8523-5466B03E401D@shopsocially.com>
References: <6DD98642-E3CB-4343-8B68-5F06C17398B8@shopsocially.com>	<20110222102837.GE5409@wellquite.org>
	<E25DF5F8-80A2-4E9A-8523-5466B03E401D@shopsocially.com>
Message-ID: <4D6394FD.2020002@rabbitmq.com>

Sunil,

On 22/02/11 10:40, Sunil Arora wrote:
> While upgrading from 2.2.0 to 2.3.1, do we have to upgrade our amqp
> clients as well?

No.

Any version of any client we have ever released should work with a
broker >= 2.0.0.

Clients >= 2.0.0 will only work with brokers >= 2.0.0, except for the
.net client which can speak to older brokers if configured to speak AMQP
0-8.


Matthias.

From aar at cpan.org  Tue Feb 22 10:55:27 2011
From: aar at cpan.org (Alessandro Ranellucci)
Date: Tue, 22 Feb 2011 11:55:27 +0100
Subject: [rabbitmq-discuss] Perl bindings for the Java client library
Message-ID: <r420ps-1066i-8DE91A535EE94126B203BBA2F78CDE82@thelonious.lan>

Hi all,

given the lack of complete or reliable Perl AMQP libraries, I 
worked on  bindings for the RabbitMQ Java client library:

http://search.cpan.org/perldoc?Net::RabbitMQ::Java

I'm going to test this module in production environment in the 
next months, until a better solution is available for Perl developers.
I think that the optimal solution will be to use the RabbitMQ C 
library, once it's done, and build full XS bindings. I'm 
available to cooperate on that.

In the mean time, my Java bindings are the only way to use 0-9-1 
and a number of features such as returned messages, publish 
confirm, shutdown handlers, exceptions, QoS etc.

Feedback welcome! ;-)

     - alessandro.


From emile at rabbitmq.com  Tue Feb 22 11:26:14 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 22 Feb 2011 11:26:14 +0000
Subject: [rabbitmq-discuss] Does anybody know how to deploy RabbitMQ on
 AIX-Unix system?
In-Reply-To: <AANLkTinOB_h3TG=S=5pQxtS1kcZvSNYKufoJWZC+jSTC@mail.gmail.com>
References: <000c01cbd25d$302c9250$9085b6f0$@hundsun.com>
	<AANLkTinOB_h3TG=S=5pQxtS1kcZvSNYKufoJWZC+jSTC@mail.gmail.com>
Message-ID: <4D639D56.5080007@rabbitmq.com>

Hi helf,

Perry Smith has published an AIX patch for R12B3 on the Erlang questions 
mailing list, which is a better forum for this question. Ideally Perry's 
patch should include SMP support and be included into the main Erlang 
source tree.

Regards

Emile


On 22/02/11 07:14, Alexis Richardson wrote:
> I can assure that this is possible and have bcc'd people who can help you.
>
> alexis
>
>
> On Tue, Feb 22, 2011 at 6:53 AM, helf<helf at hundsun.com>  wrote:
>> Hi all,
>>
>> Recently I am installing RabbitMQ server on AIX-Unix system. Unfortunately,
>> I can?t compile Erlang on AIX-Unix system successfully. I searched the whole
>> rabbitmq-discuss archives and erlang-question archives, but couldn?t find
>> any helpful info. L
>>
>> Does anybody have experience in compiling Erlang or installing RabbitMQ
>> server on AIX-Unix system?
>>
>>
>>
>> Your reply will be appreciated!


From helf at hundsun.com  Tue Feb 22 11:43:35 2011
From: helf at hundsun.com (helf)
Date: Tue, 22 Feb 2011 19:43:35 +0800
Subject: [rabbitmq-discuss] =?gb2312?b?tPC4tDogIERvZXMgYW55Ym9keSBrbm93?=
	=?gb2312?b?IGhvdyB0byBkZXBsb3kgUmFiYml0TVEgb24gQUlYLVVuaXggc3lz?=
	=?gb2312?b?dGVtPw==?=
In-Reply-To: <4D639D56.5080007@rabbitmq.com>
References: <000c01cbd25d$302c9250$9085b6f0$@hundsun.com>	<AANLkTinOB_h3TG=S=5pQxtS1kcZvSNYKufoJWZC+jSTC@mail.gmail.com>
	<4D639D56.5080007@rabbitmq.com>
Message-ID: <002b01cbd285$bce3f350$36abd9f0$@hundsun.com>

Hi Alex & Emile,

Thanks for you kindly help. ^_^ 



-----????-----
???: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] ?? Emile Joubert
????: 2011?2?22? 19:26
???: rabbitmq-discuss at lists.rabbitmq.com
??: Re: [rabbitmq-discuss] Does anybody know how to deploy RabbitMQ on
AIX-Unix system?

Hi helf,

Perry Smith has published an AIX patch for R12B3 on the Erlang questions
mailing list, which is a better forum for this question. Ideally Perry's
patch should include SMP support and be included into the main Erlang source
tree.

Regards

Emile


On 22/02/11 07:14, Alexis Richardson wrote:
> I can assure that this is possible and have bcc'd people who can help you.
>
> alexis
>
>
> On Tue, Feb 22, 2011 at 6:53 AM, helf<helf at hundsun.com>  wrote:
>> Hi all,
>>
>> Recently I am installing RabbitMQ server on AIX-Unix system. 
>> Unfortunately, I can?t compile Erlang on AIX-Unix system 
>> successfully. I searched the whole rabbitmq-discuss archives and 
>> erlang-question archives, but couldn?t find any helpful info. L
>>
>> Does anybody have experience in compiling Erlang or installing 
>> RabbitMQ server on AIX-Unix system?
>>
>>
>>
>> Your reply will be appreciated!

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From sunil at shopsocially.com  Tue Feb 22 11:54:20 2011
From: sunil at shopsocially.com (Sunil Arora)
Date: Tue, 22 Feb 2011 17:24:20 +0530
Subject: [rabbitmq-discuss] 2.1.1 versus 2.3.1
In-Reply-To: <4D6394FD.2020002@rabbitmq.com>
References: <6DD98642-E3CB-4343-8B68-5F06C17398B8@shopsocially.com>	<20110222102837.GE5409@wellquite.org>
	<E25DF5F8-80A2-4E9A-8523-5466B03E401D@shopsocially.com>
	<4D6394FD.2020002@rabbitmq.com>
Message-ID: <A14F28CC-A14E-482E-A510-44359FC98256@shopsocially.com>

Thanks Matthias,

The message exchange has been really helpful.  I will upgrade to 2.3.1 and see if problem persists.

#cheers
Sunil
On 22-Feb-2011, at 4:20 PM, Matthias Radestock wrote:

> Sunil,
> 
> On 22/02/11 10:40, Sunil Arora wrote:
>> While upgrading from 2.2.0 to 2.3.1, do we have to upgrade our amqp
>> clients as well?
> 
> No.
> 
> Any version of any client we have ever released should work with a
> broker >= 2.0.0.
> 
> Clients >= 2.0.0 will only work with brokers >= 2.0.0, except for the
> .net client which can speak to older brokers if configured to speak AMQP
> 0-8.
> 
> 
> Matthias.


From jiri at krutil.com  Tue Feb 22 12:10:48 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Tue, 22 Feb 2011 13:10:48 +0100
Subject: [rabbitmq-discuss] Problems with rabbitmq-auth-mechanism-ssl
In-Reply-To: <4D63943D.9030206@rabbitmq.com>
References: <20110222111737.18686h3xjjh8likg@webmail.active24.cz>
	<4D63943D.9030206@rabbitmq.com>
Message-ID: <20110222131048.61266xbn6fucd3oc@webmail.active24.cz>

> But this is deeply suspicious. If you've specified  
> {auth_mechanisms,['EXTERNAL']} in your configuration, it should not  
> be possible to even start PLAIN authentication - that item specifies  
> the entire list of mechanisms to offer. I therefore wonder if your  
> configuration isn't getting picked up?
>
> Do you have the mgmt plugin installed? If so, Overview > (node name)  
> > Registry > Authentication Mechanisms will show you which  
> mechanisms are installed and enabled.

The management plugin shows that only PLAIN and AMQPLAIN are enabled.

Somehow the auth_mechanisms setting in the config file is ignored by  
the broker, no matter which mechanisms I list there. (I have verified  
that the config file itself is being used.)

Any hints? Should I do something to install the  
rabbitmq-auth-mechanism-ssl plugin (other than copying the .ez file to  
the plugins dir)?

Cheers
Jiri


From aquino.gustavo at gmail.com  Tue Feb 22 12:10:38 2011
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 22 Feb 2011 09:10:38 -0300
Subject: [rabbitmq-discuss] Does anybody know how to deploy RabbitMQ on
	AIX-Unix system?
In-Reply-To: <000c01cbd25d$302c9250$9085b6f0$@hundsun.com>
References: <000c01cbd25d$302c9250$9085b6f0$@hundsun.com>
Message-ID: <7C50EC6E-71C8-47DB-BD20-CCC978422573@gmail.com>

Hi,

I did it in AIX on P550. You just need to compile all packages from  
source code by hand.

What happen when you try to compile it?

- Gustavo


On 22/02/2011, at 03:53, "helf" <helf at hundsun.com> wrote:

> Hi all,
>
> Recently I am installing RabbitMQ server on AIX-Unix system.  
> Unfortunately, I can?t compile Erlang on AIX-Unix system successfull 
> y. I searched the whole rabbitmq-discuss archives and erlang-questio 
> n archives, but couldn?t find any helpful info. L
>
> Does anybody have experience in compiling Erlang or installing  
> RabbitMQ server on AIX-Unix system?
>
>
>
> Your reply will be appreciated!
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110222/a59e8f57/attachment.htm>

From simon at rabbitmq.com  Tue Feb 22 12:20:19 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 22 Feb 2011 12:20:19 +0000
Subject: [rabbitmq-discuss] Problems with rabbitmq-auth-mechanism-ssl
In-Reply-To: <20110222131048.61266xbn6fucd3oc@webmail.active24.cz>
References: <20110222111737.18686h3xjjh8likg@webmail.active24.cz>
	<4D63943D.9030206@rabbitmq.com>
	<20110222131048.61266xbn6fucd3oc@webmail.active24.cz>
Message-ID: <4D63AA03.6010907@rabbitmq.com>

On 22/02/11 12:10, Jiri Krutil wrote:
> Somehow the auth_mechanisms setting in the config file is ignored by the
> broker, no matter which mechanisms I list there. (I have verified that
> the config file itself is being used.)

Gah.

Reading your config again, I see that you have auth_mechanisms nested 
under ssl_options. That's why it's being ignored.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From jiri at krutil.com  Tue Feb 22 13:08:08 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Tue, 22 Feb 2011 14:08:08 +0100
Subject: [rabbitmq-discuss] Problems with rabbitmq-auth-mechanism-ssl
In-Reply-To: <4D63AA03.6010907@rabbitmq.com>
References: <20110222111737.18686h3xjjh8likg@webmail.active24.cz>
	<4D63943D.9030206@rabbitmq.com>
	<20110222131048.61266xbn6fucd3oc@webmail.active24.cz>
	<4D63AA03.6010907@rabbitmq.com>
Message-ID: <20110222140808.20791f86jbrrfcro@webmail.active24.cz>

> Reading your config again, I see that you have auth_mechanisms  
> nested under ssl_options. That's why it's being ignored.

OK I see, sorry for that.
Now the authentication works fine.

Thanks!
Jiri


From emile at rabbitmq.com  Tue Feb 22 13:12:20 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 22 Feb 2011 13:12:20 +0000
Subject: [rabbitmq-discuss] Does anybody know how to deploy RabbitMQ on
 AIX-Unix system?
In-Reply-To: <7C50EC6E-71C8-47DB-BD20-CCC978422573@gmail.com>
References: <000c01cbd25d$302c9250$9085b6f0$@hundsun.com>
	<7C50EC6E-71C8-47DB-BD20-CCC978422573@gmail.com>
Message-ID: <4D63B634.2040703@rabbitmq.com>

On 22/02/11 12:10, Gustavo Aquino wrote:
> Hi,
>
> I did it in AIX on P550. You just need to compile all packages from
> source code by hand.
>
> What happen when you try to compile it?
>
> - Gustavo

Gustavo,

Erlang had support for pre-R12B3 versions of Erlang on AIX 4, but this 
is not recent enough for running RabbitMQ. Erlang on AIX support appears 
to be unmaintained. It fails to compile on recent versions of AIX, 
partly because "aix4" no longer matches in the configuration script. 
Perry Smith's patches goes some way toward fixing these problems, but 
some work remains, such as SMP support.

Regards

Emile

From harvey.robin at gmail.com  Tue Feb 22 13:26:03 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Tue, 22 Feb 2011 13:26:03 +0000
Subject: [rabbitmq-discuss] What to do with "unwanted messages"
In-Reply-To: <4D6160F6.3020209@rabbitmq.com>
References: <AANLkTi=q7YkJ_NYXqAsYC9AhCiC1xha78ahwpjAXw_YE@mail.gmail.com>
	<4D6160F6.3020209@rabbitmq.com>
Message-ID: <AANLkTimeXiBahaattf7+5mPPxjaJ6X_ihkyy6DEXTDW3@mail.gmail.com>

Hi Matthias,

Thanks for you help, that's cleared a few things up for me.  I had
mistakenly assumed that sending basic.cancel meant you couldn't ack or
reject messages after sending the cancel.

Thanks,
--Robin


On Sun, Feb 20, 2011 at 6:44 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Robin,
>
>
> Robin Harvey wrote:
>
>> What is the recommended course of action for dealing with unwanted
>> messages in consumers?  If a consumer sends basic.cancel there's a
>> possibility that there will be one or more "undelivered" messages (depending
>> on the prefetch-count parameters), is it best to basic.reject these before
>> or after sending basic.cancel?
>>
>
> You could get the client send a basic.cancel and then basic.reject all
> messages received already and until the basic.cancel-ok arrives.
>
> However, since you mention "unwanted" messages, why would you cancel the
> consumer? Wouldn't you just want to reject individual messages but continue
> consuming?
>
>
>  A connected issue here is that sending basic.cancel alters the sequence of
>> messages on the target queue, the undelivered message gets requeued at the
>> end of the queue.
>>
>
> basic.cancel does not result in any requeueing of messages. It simply tells
> the server to stop sending messages to the consumer.
>
> However, basic.reject, recover, and nack, and channel/connection
> termination do all cause requeuing. And yes, those messages go to the back
> of the queue.
>
> However, since the subject of this email mentioned "unwanted" messages, why
> do you want them requeued at all?
>
>
>  is there anything I can do to prevent this re-ordering?
>>
>
> No. In theory rabbit could preserve the order when requeuing and there is
> just a single consumer. But a) that would be going beyond the guarantees
> provided by the AMQP spec, and b) as soon as there is more than one consumer
> there is no sensible way to preserve the order.
>
>
>  I suppose that using basic.get instead would probably do the trick
>>
>
> Requeuing of a message fetched with basic.get behaves no different from
> that of a message received as a result of a basic.consume.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110222/e7c829a4/attachment.htm>

From jiri at krutil.com  Tue Feb 22 14:14:45 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Tue, 22 Feb 2011 15:14:45 +0100
Subject: [rabbitmq-discuss] Problems with rabbitmq-auth-mechanism-ssl
In-Reply-To: <4D63AA03.6010907@rabbitmq.com>
References: <20110222111737.18686h3xjjh8likg@webmail.active24.cz>
	<4D63943D.9030206@rabbitmq.com>
	<20110222131048.61266xbn6fucd3oc@webmail.active24.cz>
	<4D63AA03.6010907@rabbitmq.com>
Message-ID: <20110222151445.21095b34zesdod0c@webmail.active24.cz>

Simon

The management plugin displays a "Can log in with password" flag for users.

How do I disable the possibility to log in with password? I want to  
force the users to use SSL cert-based authentication (SASL EXTERNAL).

Cheers
Jiri


From simon at rabbitmq.com  Tue Feb 22 14:19:03 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 22 Feb 2011 14:19:03 +0000
Subject: [rabbitmq-discuss] Problems with rabbitmq-auth-mechanism-ssl
In-Reply-To: <20110222151445.21095b34zesdod0c@webmail.active24.cz>
References: <20110222111737.18686h3xjjh8likg@webmail.active24.cz>
	<4D63943D.9030206@rabbitmq.com>
	<20110222131048.61266xbn6fucd3oc@webmail.active24.cz>
	<4D63AA03.6010907@rabbitmq.com>
	<20110222151445.21095b34zesdod0c@webmail.active24.cz>
Message-ID: <4D63C5D7.4010806@rabbitmq.com>

On 22/02/11 14:14, Jiri Krutil wrote:
> Simon
>
> The management plugin displays a "Can log in with password" flag for users.
>
> How do I disable the possibility to log in with password? I want to
> force the users to use SSL cert-based authentication (SASL EXTERNAL).

If only EXTERNAL is available server-wide, then no user can log in with 
a password, you need PLAIN to do that. That flag is for if you want to 
prevent only certain users from logging in with a password. Essentially 
if it's not set it means the user has no password.

You can set this by using the "Add / update a user" form on the Users 
listing page. Enter the name of an existing user to set the password and 
administrator status for that user (yes, this could be clearer...)

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From jiri at krutil.com  Tue Feb 22 14:36:26 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Tue, 22 Feb 2011 15:36:26 +0100
Subject: [rabbitmq-discuss] Problems with rabbitmq-auth-mechanism-ssl
In-Reply-To: <4D63C5D7.4010806@rabbitmq.com>
References: <20110222111737.18686h3xjjh8likg@webmail.active24.cz>
	<4D63943D.9030206@rabbitmq.com>
	<20110222131048.61266xbn6fucd3oc@webmail.active24.cz>
	<4D63AA03.6010907@rabbitmq.com>
	<20110222151445.21095b34zesdod0c@webmail.active24.cz>
	<4D63C5D7.4010806@rabbitmq.com>
Message-ID: <20110222153626.26685nt2c7n2irk0@webmail.active24.cz>

>> The management plugin displays a "Can log in with password" flag for users.
>>
>> How do I disable the possibility to log in with password? I want to
>> force the users to use SSL cert-based authentication (SASL EXTERNAL).
>
> If only EXTERNAL is available server-wide, then no user can log in  
> with a password, you need PLAIN to do that. That flag is for if you  
> want to prevent only certain users from logging in with a password.  
> Essentially if it's not set it means the user has no password.
>
> You can set this by using the "Add / update a user" form on the  
> Users listing page. Enter the name of an existing user to set the  
> password and administrator status for that user (yes, this could be  
> clearer...)

We have a backend connecting to the broker using a non-encrypted TCP  
connection and PLAIN authentication. The backend uses a dedicated  
broker user account with full AMQP permissions.

We also have one admin account that is used for the management plugin API.

We then have customers connecting from public Internet that should be  
forced to use SSL with SASL EXTERNAL authentication. Each customer has  
its own broker account with limited AMQP permissions.

The firewall is set up to open only the SSL port to the public. That  
means no customer may connect using TCP without SSL.

The question is how do I make sure that the customers won't connect  
using SSL with PLAIN authentication. (Currently we set up customer  
accounts manually using rabbitmqctl, but we are planning to automate  
this using the management plugin API.)

I would like to have the password authentication disabled for new  
users by default. The only users than may login with a password are  
the backend and admin users.

Any hints?

Cheers
Jiri


From simon at rabbitmq.com  Tue Feb 22 14:52:20 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 22 Feb 2011 14:52:20 +0000
Subject: [rabbitmq-discuss] Problems with rabbitmq-auth-mechanism-ssl
In-Reply-To: <20110222153626.26685nt2c7n2irk0@webmail.active24.cz>
References: <20110222111737.18686h3xjjh8likg@webmail.active24.cz>
	<4D63943D.9030206@rabbitmq.com>
	<20110222131048.61266xbn6fucd3oc@webmail.active24.cz>
	<4D63AA03.6010907@rabbitmq.com>
	<20110222151445.21095b34zesdod0c@webmail.active24.cz>
	<4D63C5D7.4010806@rabbitmq.com>
	<20110222153626.26685nt2c7n2irk0@webmail.active24.cz>
Message-ID: <4D63CDA4.4000003@rabbitmq.com>

On 22/02/11 14:36, Jiri Krutil wrote:
<snip explanation>
> I would like to have the password authentication disabled for new users
> by default. The only users than may login with a password are the
> backend and admin users.

Ah, right. In that case either:

* Select "No password" in the management web UI, as in the previous mail

* Invoke rabbitmqctl clear_password <username>

* HTTP PUT a JSON document like:
   {"password_hash": "", "administrator": false}
   to /api/users/<name> of the management HTTP API.

for each user.

That last one is in fact not documented. Better fix that...

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From Denis.Conan at telecom-sudparis.eu  Tue Feb 22 15:19:07 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Tue, 22 Feb 2011 16:19:07 +0100
Subject: [rabbitmq-discuss] Pika and multi-threading
Message-ID: <4D63D3EB.1030400@telecom-sudparis.eu>


Hi all,

The Pika Web site says: "Pika does not have any notion of threading in the 
code. If you want to use Pika with threading, make sure you have a Pika 
connection per thread, created in that thread. It is not safe to share one Pika 
connection across threads."

When using the continuation-passing style mode with SelectConnection, what 
about the singleton object IOLoop? I created a connection on the main thread 
for a vhost, and then a second connection for a different vhost in a new 
thread, but callbacks of the main threads for the first vhost are called. Am I 
missing something?

Any help appreciated.

Denis

From gmr at myyearbook.com  Tue Feb 22 16:02:21 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 22 Feb 2011 11:02:21 -0500
Subject: [rabbitmq-discuss] Pika and multi-threading
In-Reply-To: <4D63D3EB.1030400@telecom-sudparis.eu>
References: <4D63D3EB.1030400@telecom-sudparis.eu>
Message-ID: <AANLkTikMTVgv2DWfUxD8G6n9Sgd_zx51w5W22biHRsQq@mail.gmail.com>

2011/2/22 Denis Conan <Denis.Conan at telecom-sudparis.eu>:
>
> Hi all,
>
> The Pika Web site says: "Pika does not have any notion of threading in the
> code. If you want to use Pika with threading, make sure you have a Pika
> connection per thread, created in that thread. It is not safe to share one
> Pika connection across threads."
>
> When using the continuation-passing style mode with SelectConnection, what
> about the singleton object IOLoop? I created a connection on the main thread
> for a vhost, and then a second connection for a different vhost in a new
> thread, but callbacks of the main threads for the first vhost are called. Am
> I missing something?

You're not, this is something I'm working through now. In essence,
there is a logical separation in the pika code between the core of how
pika does what it does and the connection adapters. The singleton
model for ioloops was a later addition that broke the model with
regard to threads. I have been working on fixing this to be thread
safe and will have something out soon on it.

From rajat.vig at gmail.com  Tue Feb 22 17:43:50 2011
From: rajat.vig at gmail.com (Rajat Vig)
Date: Tue, 22 Feb 2011 23:13:50 +0530
Subject: [rabbitmq-discuss] How to have multiple consumers for a Queue in
	Ruby
Message-ID: <AANLkTi=73P5pd0-P7xeuxRHqouEzuytkNqOyGDaow6Ct@mail.gmail.com>

Hi

We've written an application using the amqp gem with RabbitMQ.
Currently the bottleneck we've run into is that if there are too many
message incoming then processing the queue takes long.
After reading some messages on the list, I think allowing multiple consumers
is the way forward.

How do I do that? And are there any pitfalls/gotchas?

-Rajat
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110222/b12dc6a0/attachment.htm>

From jasonjwwilliams at gmail.com  Tue Feb 22 19:49:06 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 22 Feb 2011 12:49:06 -0700
Subject: [rabbitmq-discuss] Pika reconnection error
In-Reply-To: <4D622D8B.8080605@rabbitmq.com>
References: <AANLkTik+k9WAgKJjh+f3rELCbXJaXQpC-R-dHHpXijWM@mail.gmail.com>
	<4D621788.4090707@rabbitmq.com>
	<AANLkTinh0w-DSVDyKYMm5+qTjX206wkWBJut8zmq0NRX@mail.gmail.com>
	<4D622D8B.8080605@rabbitmq.com>
Message-ID: <AANLkTimtKs=XBTYg+MCbq9U+VDNTkmdnYngCvWKtPFot@mail.gmail.com>

Thank Matthias. :)


On Mon, Feb 21, 2011 at 2:16 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Jason,
>
> On 21/02/11 09:10, Jason J. W. Williams wrote:
>>
>> Thanks for the heads up. What causes the bug?
>
> The bug is triggered when re-declaring a queue on a different cluster node.
> It was introduced in 2.3.0.
>
> Matthias
>

From vertolet666 at yandex.ru  Tue Feb 22 20:09:05 2011
From: vertolet666 at yandex.ru (DOBRO)
Date: Tue, 22 Feb 2011 12:09:05 -0800 (PST)
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <4D604FD7.6030307@rabbitmq.com>
References: <30958766.post@talk.nabble.com> <4D604FD7.6030307@rabbitmq.com>
Message-ID: <30989184.post@talk.nabble.com>



Matthias Radestock-3 wrote:
> 
> When that happens I suggest you use the various rabbitmqctl list_* 
> commands, or the rabbitmq-management plugin to investigate the state of 
> your system, e.g.
> 
> - can you see all the exchanges, queues, bindings, connections, channels 
> and consumers that should be present?
> 
Yes, I can see all of them.


Matthias Radestock-3 wrote:
> 
> - are there messages building up in some of the queues?
> 
How can I detect such behaviour?

-- 
View this message in context: http://old.nabble.com/Losing-messages%2C-why--tp30958766p30989184.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From jerryk at vmware.com  Tue Feb 22 20:20:22 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 22 Feb 2011 12:20:22 -0800
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <30989184.post@talk.nabble.com>
References: <30958766.post@talk.nabble.com> <4D604FD7.6030307@rabbitmq.com>
	<30989184.post@talk.nabble.com>
Message-ID: <0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>

> Matthias Radestock-3 wrote:
>> 
>> - are there messages building up in some of the queues?
>> 
> How can I detect such behaviour?

DOBRO...

Try:

rabbitmqctl  list_queues messages messages_ready messages_unacknowledged

That will give you an idea of what's going on in your queues.  Be wary of things piling up unacknowledged.  That could mean you have clients that aren't auto-acking and aren't explicitly acking either, which will cause the broker to hang on to those messages because responsibility for them hasn't been taken by the client.

Best regards,
Jerry


From yoavglazner at gmail.com  Tue Feb 22 20:54:43 2011
From: yoavglazner at gmail.com (yoav glazner)
Date: Tue, 22 Feb 2011 22:54:43 +0200
Subject: [rabbitmq-discuss] Help with my priority queue design
Message-ID: <AANLkTik86H2PzTSSd3AK3jc4TR=MKC5B0VtQbToC5=og@mail.gmail.com>

Hi,

I wanted to show my design for a priority based task queue and get some
insight from experts.

The client create a queue named: "some_tasks_to_work_on2" and put his tasks
there,
then it puts the following message in a queue named "batch_states":
[{batch="some_tasks_to_work_on2", priority=3}]
now each worker can take the status message and get tasks from the batch.
if a few batches are in the status message then the worker check the queue
by the priority order.

a worker should also return the status message after reading it so other
workers can also read it.
now this is needed because i want workers to be able to wake up any time and
get the latest status.
In this approch I can add new batches on the fly and also change priorities.

Do you think there is a better way to do it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110222/048ca582/attachment.htm>

From vertolet666 at yandex.ru  Tue Feb 22 21:48:14 2011
From: vertolet666 at yandex.ru (DOBRO)
Date: Tue, 22 Feb 2011 13:48:14 -0800 (PST)
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>
References: <30958766.post@talk.nabble.com> <4D604FD7.6030307@rabbitmq.com>
	<30989184.post@talk.nabble.com>
	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>
Message-ID: <30990022.post@talk.nabble.com>




Jerry Kuch wrote:
> 
> DOBRO...
> 
> Try:
> 
> rabbitmqctl  list_queues messages messages_ready messages_unacknowledged
> 

Invoking
rabbitmqctl list_queues name messages messages_ready messages_unacknowledged

I get (for most of queues):
queue_name_1 0 0 0

and for some queues:
queue_name_2 239 239 0

i.e. "messages" and "messages_ready" are greater than zero, but
"messages_unacknowledged" are always the same (0).


-- 
View this message in context: http://old.nabble.com/Losing-messages%2C-why--tp30958766p30990022.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From irrer at umich.edu  Tue Feb 22 21:55:26 2011
From: irrer at umich.edu (Jim Irrer)
Date: Tue, 22 Feb 2011 16:55:26 -0500
Subject: [rabbitmq-discuss] How to have multiple consumers for a Queue
	in Ruby
In-Reply-To: <AANLkTi=73P5pd0-P7xeuxRHqouEzuytkNqOyGDaow6Ct@mail.gmail.com>
References: <AANLkTi=73P5pd0-P7xeuxRHqouEzuytkNqOyGDaow6Ct@mail.gmail.com>
Message-ID: <AANLkTinBK5optpu+sizWLNpJyC5HnujHs15XB_DNYtL4@mail.gmail.com>

Start multiple copies of the same program as different processes or
threads, and have them each bind to the same queue.  The default
RabbitMQ behavior seems to be a round robin as to which process
gets the next message.

This assumes that the messages on the queue can be processed in an
'embarrassingly parallel' sort of way.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Tue, Feb 22, 2011 at 12:43 PM, Rajat Vig <rajat.vig at gmail.com> wrote:

> Hi
>
> We've written an application using the amqp gem with RabbitMQ.
> Currently the bottleneck we've run into is that if there are too many
> message incoming then processing the queue takes long.
> After reading some messages on the list, I think allowing multiple
> consumers is the way forward.
>
> How do I do that? And are there any pitfalls/gotchas?
>
> -Rajat
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110222/745568a1/attachment.htm>

From stastny at 101ideas.cz  Tue Feb 22 22:11:25 2011
From: stastny at 101ideas.cz (=?UTF-8?B?SmFrdWIgxaDFpWFzdG7DvQ==?=)
Date: Tue, 22 Feb 2011 22:11:25 +0000
Subject: [rabbitmq-discuss] How to have multiple consumers for a Queue
	in Ruby
In-Reply-To: <AANLkTi=73P5pd0-P7xeuxRHqouEzuytkNqOyGDaow6Ct@mail.gmail.com>
References: <AANLkTi=73P5pd0-P7xeuxRHqouEzuytkNqOyGDaow6Ct@mail.gmail.com>
Message-ID: <AANLkTinsTdpqb0+pmzc2gUu4oaDv+_+4rZ-xENBWwoeR@mail.gmail.com>

Hi Rajat, could you maybe provide some more info? In general I'd agree with
Jim, although it depends, there are probably other solutions as well (like
more queues -> more granular design of the app with more consumers).

Jakub

http://www.flickr.com/photos/jakub-stastny
http://twitter.com/botanicus



On 22 February 2011 17:43, Rajat Vig <rajat.vig at gmail.com> wrote:

> Hi
>
> We've written an application using the amqp gem with RabbitMQ.
> Currently the bottleneck we've run into is that if there are too many
> message incoming then processing the queue takes long.
> After reading some messages on the list, I think allowing multiple
> consumers is the way forward.
>
> How do I do that? And are there any pitfalls/gotchas?
>
> -Rajat
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110222/35e69366/attachment.htm>

From jerryk at vmware.com  Tue Feb 22 22:36:40 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 22 Feb 2011 14:36:40 -0800
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <30990022.post@talk.nabble.com>
References: <30958766.post@talk.nabble.com> <4D604FD7.6030307@rabbitmq.com>
	<30989184.post@talk.nabble.com>
	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>,
	<30990022.post@talk.nabble.com>
Message-ID: <F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>

> Invoking
> rabbitmqctl list_queues name messages messages_ready messages_unacknowledged
>
> I get (for most of queues):
> queue_name_1 0 0 0

That looks good.  That's either a queue to which nobody is publishing,
or one that's being consumed from at a brisk enough rate that nothing
is being left behind, either ready to be delivered to clients, or
already delivered to a client but not yet acknowledged.

> and for some queues:
> queue_name_2 239 239 0
>
> i.e. "messages" and "messages_ready" are greater than zero, but
> "messages_unacknowledged" are always the same (0).

I think earlier in the thread we established that all of your
consumers are consuming with noAck=true, so therefore everything
should be getting ACK-ed as its consumed.  That would be consistent
with what we're seeing here, since there are no messages being
reported as unacknowledged by rabbitmqctl.  On the other hand, since a
message has to be delivered before it can be ACK-ed, one would also
think that the messages_ready (the second column from the right in
your output) should also read zero.

Has, perhaps, one of your consumers died?  Or become busy and stopped
consuming and acking from queue_name_2?

To investigate try:

rabbitmqctl list_consumers

That will show you the names of your queues, the id's of the channel
processes that created and now own the subscriptions, and tags that
let you identify a subscription within the channel.  You'll also be
reminded there about whether or not ACKs are expected for messages
going to that consumer, but since you have nothing un-ACKed above, you
don't seem to be having a problem with this.

Best regards,
Jerry

From matthias at rabbitmq.com  Tue Feb 22 22:52:34 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 22 Feb 2011 22:52:34 +0000
Subject: [rabbitmq-discuss] Cluster Disk Node Functions
In-Reply-To: <A40CA9CD-55CB-4ED0-BC6E-D8B2DDFA3016@gmail.com>
References: <AANLkTikk_JBLJXs+HOJRo1==FN7RBegk8Kq1ODdXRRNb@mail.gmail.com>
	<4D6383F6.3090802@rabbitmq.com>
	<A40CA9CD-55CB-4ED0-BC6E-D8B2DDFA3016@gmail.com>
Message-ID: <4D643E32.2020708@rabbitmq.com>

Jason,

Jason J. W. Williams wrote:
> I apologize for the in accurate quote...the exact quote is:
> 
> "All disk nodes must be running for certain operations, most notably 
> leaving a cluster, to succeed."
> 
> http://www.rabbitmq.com/clustering.html#restarting

No idea what that's about. Our current clustering expert (cc'ed) might 
be able shed some light.


Regards,

Matthias.

From vertolet666 at yandex.ru  Wed Feb 23 07:56:00 2011
From: vertolet666 at yandex.ru (DOBRO)
Date: Tue, 22 Feb 2011 23:56:00 -0800 (PST)
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>
References: <30958766.post@talk.nabble.com> <4D604FD7.6030307@rabbitmq.com>
	<30989184.post@talk.nabble.com>
	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>
	<30990022.post@talk.nabble.com>
	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>
Message-ID: <30992886.post@talk.nabble.com>



Jerry Kuch wrote:
> 
> To investigate try:
> 
> rabbitmqctl list_consumers
> 

For those queues which have "messages" and "messages_ready" 
"rabbitmqctl list_consumers" shows:

queue_name  <rabbit at myhost.2.7525.630>  queue_name  false

The queue name and the consumer tag are the same, is it ok?

BTW, all the queues which have "messages" and "messages_ready" are bound to
the same fanout exchange.


-- 
View this message in context: http://old.nabble.com/Losing-messages%2C-why--tp30958766p30992886.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From rajat.vig at gmail.com  Wed Feb 23 08:06:20 2011
From: rajat.vig at gmail.com (Rajat Vig)
Date: Wed, 23 Feb 2011 08:06:20 +0000
Subject: [rabbitmq-discuss] How to have multiple consumers for a Queue
	in Ruby
In-Reply-To: <AANLkTinsTdpqb0+pmzc2gUu4oaDv+_+4rZ-xENBWwoeR@mail.gmail.com>
References: <AANLkTi=73P5pd0-P7xeuxRHqouEzuytkNqOyGDaow6Ct@mail.gmail.com>
	<AANLkTinsTdpqb0+pmzc2gUu4oaDv+_+4rZ-xENBWwoeR@mail.gmail.com>
Message-ID: <AANLkTi=V6xE958b7x52_nWHxeXO6wGEtZAKPmeo9Owwr@mail.gmail.com>

Thanks for the suggestions. I'd the same thing in mind about being able to
start multiple of those processes.

There are 2 different kinds of consumers
1. Get the message and write it to a database or send it out to someplace
else.
Parallelizing this would be easy. Controlling would be more of a problem
here but manageable.

2. There's one large consumer which accepts different kinds of messages.
Like start/stop/abandon a game (which are always singular) and messages for
the game itself which are many.
I don't want to run this one many times since it might just run into
conflicts (though I can't see many currently - it does impose a rigid
discipline in the code).
The alternative that I'm thinking here is to internally re-route by
(generated) random keys and have multiple subscribers in the same
process. Would that work fine?
It not, I think breaking it further to a consumer for all admin messages and
multiple consumers for the game plays would be the way forward but it'll be
a significant refactor.

-Rajat

2011/2/22 Jakub ??astn? <stastny at 101ideas.cz>

> Hi Rajat, could you maybe provide some more info? In general I'd agree with
> Jim, although it depends, there are probably other solutions as well (like
> more queues -> more granular design of the app with more consumers).
>
> Jakub
>
> http://www.flickr.com/photos/jakub-stastny
> http://twitter.com/botanicus
>
>
>
> On 22 February 2011 17:43, Rajat Vig <rajat.vig at gmail.com> wrote:
>
>> Hi
>>
>> We've written an application using the amqp gem with RabbitMQ.
>> Currently the bottleneck we've run into is that if there are too many
>> message incoming then processing the queue takes long.
>> After reading some messages on the list, I think allowing multiple
>> consumers is the way forward.
>>
>> How do I do that? And are there any pitfalls/gotchas?
>>
>> -Rajat
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110223/6d533cff/attachment.htm>

From matthias at rabbitmq.com  Wed Feb 23 08:58:18 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 23 Feb 2011 08:58:18 +0000
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <30992886.post@talk.nabble.com>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>
	<30992886.post@talk.nabble.com>
Message-ID: <4D64CC2A.6010606@rabbitmq.com>

On 23/02/11 07:56, DOBRO wrote:
> For those queues which have "messages" and "messages_ready"
> "rabbitmqctl list_consumers" shows:
>
> queue_name<rabbit at myhost.2.7525.630>   queue_name  false
>
> The queue name and the consumer tag are the same, is it ok?

That should be fine.

In your original report you said that
<quote>
Sometimes Client3 stops to receive messages from Client1 and Client2 
(from queue board-queue-2) (even if Client2 publishes messages every 10 
seconds). However, Client3 receives messages from all other queues.
</quote>

Could you post the output of 
list_{exchanges,queues,bindings,consumers,connections,channels} *when 
the system is in that state*, i.e. when Client3 has stopped receiving 
messages from board-queue-2?


Regards,

Matthias.

From jim at rabbitmq.com  Wed Feb 23 09:25:27 2011
From: jim at rabbitmq.com (Jim Apperly)
Date: Wed, 23 Feb 2011 09:25:27 +0000
Subject: [rabbitmq-discuss] txAMQP Helpers
In-Reply-To: <AANLkTin-wcCAF1Gb2ixjQECthrtuTdLAzx5zoExLYJV-@mail.gmail.com>
References: <AANLkTikDKcHcOe3YyoaCc4t=Hc7N+bHdPQ9sdWmDo-Ut@mail.gmail.com>
	<AANLkTin-wcCAF1Gb2ixjQECthrtuTdLAzx5zoExLYJV-@mail.gmail.com>
Message-ID: <AANLkTimoj6qUZRurAft+MBxOVYR9ec4DfoANxGJSOXOD@mail.gmail.com>

On 22 February 2011 06:04, Alexis Richardson <alexis at rabbitmq.com> wrote:

> Jason
>
> Thank-you.  Do you want us to list that on:
> http://www.rabbitmq.com/devtools.html ?
>

Done.  You should see it on the live site shortly.

Jim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110223/d357e126/attachment.htm>

From helf at hundsun.com  Wed Feb 23 09:29:01 2011
From: helf at hundsun.com (helf)
Date: Wed, 23 Feb 2011 17:29:01 +0800
Subject: [rabbitmq-discuss] =?utf-8?b?562U5aSNOiAgRG9lcyBhbnlib2R5IGtub3cg?=
	=?utf-8?q?how_to_deploy_RabbitMQ_on_AIX-Unix_system=3F?=
In-Reply-To: <4D63B634.2040703@rabbitmq.com>
References: <000c01cbd25d$302c9250$9085b6f0$@hundsun.com>
	<7C50EC6E-71C8-47DB-BD20-CCC978422573@gmail.com>
	<4D63B634.2040703@rabbitmq.com>
Message-ID: <003001cbd33c$1affa090$50fee1b0$@hundsun.com>

Hi all,

Thanks to Emile's patch, I have installed Erlang on my AIX-Unix system successfully. And the RabbitMQ server is deployed on it too.

But now, there is another problem about rabbitmq-c client lib. Does anybody have experience on building rabbitmq-c client lib on AIX-Unix system? Or could you please give me some tips?

Attached is my building log.

Thanks:)


-----????-----
???: Emile Joubert [mailto:emile at rabbitmq.com] 
????: 2011?2?22? 21:12
???: Gustavo Aquino
??: helf; <rabbitmq-discuss at lists.rabbitmq.com>
??: Re: [rabbitmq-discuss] Does anybody know how to deploy RabbitMQ on AIX-Unix system?

On 22/02/11 12:10, Gustavo Aquino wrote:
> Hi,
>
> I did it in AIX on P550. You just need to compile all packages from 
> source code by hand.
>
> What happen when you try to compile it?
>
> - Gustavo

Gustavo,

Erlang had support for pre-R12B3 versions of Erlang on AIX 4, but this is not recent enough for running RabbitMQ. Erlang on AIX support appears to be unmaintained. It fails to compile on recent versions of AIX, partly because "aix4" no longer matches in the configuration script. 
Perry Smith's patches goes some way toward fixing these problems, but some work remains, such as SMP support.

Regards

Emile
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: building_log.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110223/60172681/attachment-0001.txt>

From yoavglazner at gmail.com  Wed Feb 23 09:48:05 2011
From: yoavglazner at gmail.com (yoav glazner)
Date: Wed, 23 Feb 2011 11:48:05 +0200
Subject: [rabbitmq-discuss] pika - HeartbeatChecker Bug?
Message-ID: <AANLkTi=Ssg5rJjeNLD55eaDhze0FCxg75gZKGBAPJ+0m@mail.gmail.com>

Hi,

I think there is a bug in pika's HeartbeatChecker.
When I run these scripts I get:
Traceback (most recent call last):

  File "D:\Testing\src\recv_demo.py", line 35, in <module>
    connection.ioloop.start()
  File "C:\Python26\Lib\site-packages\pika\adapters\select_connection.py",
line 184, in start
    self.poller.start()
  File "C:\Python26\Lib\site-packages\pika\log.py", line 107, in debug_log
    return method(*args, **kwargs)
  File "C:\Python26\Lib\site-packages\pika\adapters\select_connection.py",
line 264, in start
    self.process_timeouts()
  File "C:\Python26\Lib\site-packages\pika\adapters\select_connection.py",
line 250, in process_timeouts
    self._timeouts[timeout_id]['handler']()
  File "C:\Python26\Lib\site-packages\pika\log.py", line 107, in debug_log
    return method(*args, **kwargs)
  File "C:\Python26\lib\site-packages\pika\heartbeat.py", line 115, in
send_and_check
    self.connection.send_frame(Heartbeat())
AttributeError: 'SelectConnection' object has no attribute 'send_frame'

I don't always get this error, but if I chage send_frame to _send_frame it
seems to work...

Any thoughts?


Many Thanks,

Yoav Glazner
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110223/8b8b919f/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: task_sender.py
Type: application/octet-stream
Size: 743 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110223/8b8b919f/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: recv_demo.py
Type: application/octet-stream
Size: 864 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110223/8b8b919f/attachment-0001.obj>

From jiri at krutil.com  Wed Feb 23 09:56:38 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Wed, 23 Feb 2011 10:56:38 +0100
Subject: [rabbitmq-discuss] Java client blocked when opening channel
Message-ID: <20110223105638.11791vt2j7bhgb8g@webmail.active24.cz>

We have experienced a strange problem that we did not see before.

One of our threads got stuck inside AMQConnection.createChannel() and  
would not return. The thread dump shows this:

at java/lang/Object.wait(Native Method) at  
java/lang/Object.wait(Object.java:199(Compiled Code)) at  
com/rabbitmq/utility/BlockingCell.get(BlockingCell.java:64) at  
com/rabbitmq/utility/BlockingCell.uninterruptibleGet(BlockingCell.java:103) at  
com/rabbitmq/utility/BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:47) at com/rabbitmq/client/impl/AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:342) at com/rabbitmq/client/impl/AMQChannel.rpc(AMQChannel.java:215) at com/rabbitmq/client/impl/AMQChannel.exnWrappingRpc(AMQChannel.java:139) at com/rabbitmq/client/impl/ChannelN.open(ChannelN.java:125) at com/rabbitmq/client/impl/ChannelManager.createChannelInternal(ChannelManager.java:121) at com/rabbitmq/client/impl/ChannelManager.createChannel(ChannelManager.java:100) at  
com/rabbitmq/client/impl/AMQConnection.createChannel(AMQConnection.java:382)
... our code here ...

This blocked all the other threads that tried to open a channel. Some  
of these threads got stuck in AMQConnection.createChannel(), others in  
ChannelManager.createChannel(). All of them seemed to be waiting for  
the same ChannelManager lock.

The same scenario occurs in three consecutive thread dumps we have  
taken with 2 minute delays. The application would not recover for a  
long time, so we had to restart it.

We are running RabbitMQ 2.1.0 (both server and Java client).

Any ideas?


From matthias at rabbitmq.com  Wed Feb 23 10:14:49 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 23 Feb 2011 10:14:49 +0000
Subject: [rabbitmq-discuss] Java client blocked when opening channel
In-Reply-To: <20110223105638.11791vt2j7bhgb8g@webmail.active24.cz>
References: <20110223105638.11791vt2j7bhgb8g@webmail.active24.cz>
Message-ID: <4D64DE19.9000906@rabbitmq.com>

Jiri,

On 23/02/11 09:56, Jiri Krutil wrote:
> One of our threads got stuck inside AMQConnection.createChannel() and
> would not return.
> [...]
> We are running RabbitMQ 2.1.0 (both server and Java client).

A fix for a bug with similar symptoms appeared in the 2.3.x Java client, 
so I suggest you upgrade the client to 2.3.1. Might as well upgrade the 
server at the same time, though that's not strictly necessary.


Matthias.

From simonthorogood at hotmail.com  Wed Feb 23 10:41:17 2011
From: simonthorogood at hotmail.com (SimonT)
Date: Wed, 23 Feb 2011 02:41:17 -0800 (PST)
Subject: [rabbitmq-discuss] Auto-delete & x-expire being ignored
Message-ID: <aa8ddb07-b1f1-42a7-8b7b-823869f26617@a21g2000prj.googlegroups.com>

I'm trying to get a prototype working whereby a web app publishes 'per-
session' tasks to a batch service and then receives reponses on
session-specific queue. All seems to be working great except the
queues are hanging around depsite setting them to auto delete and with
an x-expire property.

C# Code to create the queue:

			channel.ExchangeDeclare("ss.newquotes", ExchangeType.Direct, true);
			channel.QueueDeclare(sessionQueueName, false, false, true, new
Hashtable { { "x-expire", 30000 } });
			channel.QueueBind(sessionQueueName, "ss.newquotes",
sessionQueueName);

The temp queues appears in the web management console (which is
awesome, by the way) with the expected properties:

AD (auto delete)
x-expire=30000

but they don't seem to go away. Any ideas?

From vertolet666 at yandex.ru  Wed Feb 23 10:49:44 2011
From: vertolet666 at yandex.ru (DOBRO)
Date: Wed, 23 Feb 2011 02:49:44 -0800 (PST)
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <4D64CC2A.6010606@rabbitmq.com>
References: <30958766.post@talk.nabble.com> <4D604FD7.6030307@rabbitmq.com>
	<30989184.post@talk.nabble.com>
	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>
	<30990022.post@talk.nabble.com>
	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>
	<30992886.post@talk.nabble.com> <4D64CC2A.6010606@rabbitmq.com>
Message-ID: <30993872.post@talk.nabble.com>




Matthias Radestock-3 wrote:
> 
> Could you post the output of 
> list_{exchanges,queues,bindings,consumers,connections,channels} *when 
> the system is in that state*, i.e. when Client3 has stopped receiving 
> messages from board-queue-2?
> 
Yes, sure. But there are hundreds of queues,bindings,consumers,connections
and channels.
-- 
View this message in context: http://old.nabble.com/Losing-messages%2C-why--tp30958766p30993872.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Wed Feb 23 10:54:01 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 23 Feb 2011 10:54:01 +0000
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <30993872.post@talk.nabble.com>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<30992886.post@talk.nabble.com>
	<4D64CC2A.6010606@rabbitmq.com> <30993872.post@talk.nabble.com>
Message-ID: <4D64E749.5070507@rabbitmq.com>

On 23/02/11 10:49, DOBRO wrote:
> Matthias Radestock-3 wrote:
>>
>> Could you post the output of
>> list_{exchanges,queues,bindings,consumers,connections,channels} *when
>> the system is in that state*, i.e. when Client3 has stopped receiving
>> messages from board-queue-2?
>>
> Yes, sure. But there are hundreds of queues,bindings,consumers,connections
> and channels.

That's fine. So I guess you have more than three clients connected? In 
which case, when it does go wrong and you send us the above output, 
please also identify which client has stopped receiving messages from 
which queue.


Matthias.

From vertolet666 at yandex.ru  Wed Feb 23 11:29:40 2011
From: vertolet666 at yandex.ru (DOBRO)
Date: Wed, 23 Feb 2011 03:29:40 -0800 (PST)
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <4D64E749.5070507@rabbitmq.com>
References: <30958766.post@talk.nabble.com> <4D604FD7.6030307@rabbitmq.com>
	<30989184.post@talk.nabble.com>
	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>
	<30990022.post@talk.nabble.com>
	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>
	<30992886.post@talk.nabble.com> <4D64CC2A.6010606@rabbitmq.com>
	<30993872.post@talk.nabble.com> <4D64E749.5070507@rabbitmq.com>
Message-ID: <30994123.post@talk.nabble.com>




Matthias Radestock-3 wrote:
> 
> So I guess you have more than three clients connected? 
> 
Yes, there are 200-300 clients connected. Each client declares several
queues.
To make it clear, my project is a chess gaming server. Each player can play
via browser (no downloads required).
In two words, when one player makes a move, his opponent does not receive
this move from server.
This behaviour occurs not often, but it happens.

Another issue (the same by its nature): a player sends a move to the server,
but the worker which is running on the server does not receive this move.

So, the pattern is:
- player sends a move to the server,
- one of the workers (on the server side) receives this move and processes
it (doing some updates in database),
- after the move is processed the server sends it back (as confirmation) to
opponents and all the spectators connected to the game.

The more popular time control is 1 minute per game. 
Can you imagine how the issue gets on player's nerves?... especially when
one tenth of second decides the outcome of the battle :)

If you want to see my project in action, I could post the link. No
registration required to watch live games.
Sorry, if it is out of the mailing list rules.


-- 
View this message in context: http://old.nabble.com/Losing-messages%2C-why--tp30958766p30994123.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From stastny at 101ideas.cz  Wed Feb 23 11:47:04 2011
From: stastny at 101ideas.cz (=?UTF-8?B?SmFrdWIgxaDFpWFzdG7DvQ==?=)
Date: Wed, 23 Feb 2011 11:47:04 +0000
Subject: [rabbitmq-discuss] How to have multiple consumers for a Queue
	in Ruby
In-Reply-To: <AANLkTi=V6xE958b7x52_nWHxeXO6wGEtZAKPmeo9Owwr@mail.gmail.com>
References: <AANLkTi=73P5pd0-P7xeuxRHqouEzuytkNqOyGDaow6Ct@mail.gmail.com>
	<AANLkTinsTdpqb0+pmzc2gUu4oaDv+_+4rZ-xENBWwoeR@mail.gmail.com>
	<AANLkTi=V6xE958b7x52_nWHxeXO6wGEtZAKPmeo9Owwr@mail.gmail.com>
Message-ID: <AANLkTi=SkN9sGhEyJWoTo-_jigGw=2jx_Xz_iQ3Aj6gG@mail.gmail.com>

Rajat,

about the second example, why more instances should be a problem? Having
more subscribers in the same process doesn't have much sense, in my opinion,
since the reactor pattern doesn't block -> you don't have to wait -> you
don't need to use threads for parallelisation. Threads can be an advantage,
but I don't think it'll be a big difference. Plus Ruby has GIL which means
threads are sort of useless anyway, well, especially if you use Ruby 1.8
which still has green threads. I'd say if you want to go this route, use
Kernel#fork, but then you have to be careful about consistency of state.
Breaking logic down sounds like a much better & cleaner way to go in my
opinion.

Jakub

http://www.flickr.com/photos/jakub-stastny
http://twitter.com/botanicus



2011/2/23 Rajat Vig <rajat.vig at gmail.com>

> Thanks for the suggestions. I'd the same thing in mind about being able to
> start multiple of those processes.
>
> There are 2 different kinds of consumers
> 1. Get the message and write it to a database or send it out to someplace
> else.
> Parallelizing this would be easy. Controlling would be more of a problem
> here but manageable.
>
> 2. There's one large consumer which accepts different kinds of messages.
> Like start/stop/abandon a game (which are always singular) and messages for
> the game itself which are many.
> I don't want to run this one many times since it might just run into
> conflicts (though I can't see many currently - it does impose a rigid
> discipline in the code).
> The alternative that I'm thinking here is to internally re-route by
> (generated) random keys and have multiple subscribers in the same
> process. Would that work fine?
> It not, I think breaking it further to a consumer for all admin messages
> and multiple consumers for the game plays would be the way forward but it'll
> be a significant refactor.
>
> -Rajat
>
> 2011/2/22 Jakub ??astn? <stastny at 101ideas.cz>
>
> Hi Rajat, could you maybe provide some more info? In general I'd agree with
>> Jim, although it depends, there are probably other solutions as well (like
>> more queues -> more granular design of the app with more consumers).
>>
>> Jakub
>>
>> http://www.flickr.com/photos/jakub-stastny
>> http://twitter.com/botanicus
>>
>>
>>
>> On 22 February 2011 17:43, Rajat Vig <rajat.vig at gmail.com> wrote:
>>
>>> Hi
>>>
>>> We've written an application using the amqp gem with RabbitMQ.
>>> Currently the bottleneck we've run into is that if there are too many
>>> message incoming then processing the queue takes long.
>>> After reading some messages on the list, I think allowing multiple
>>> consumers is the way forward.
>>>
>>> How do I do that? And are there any pitfalls/gotchas?
>>>
>>> -Rajat
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110223/972bb3b6/attachment.htm>

From max.bridgewater at gmail.com  Wed Feb 23 12:26:29 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Wed, 23 Feb 2011 07:26:29 -0500
Subject: [rabbitmq-discuss] Notification on Queue Shutdown
Message-ID: <AANLkTinvRFAv_EKY3M4oBQD6+uneqRtD-FuAapTHbMp=@mail.gmail.com>

Hi,

Is there a way to listen and be notified when RabbitMQ shuts down a
queue or be informed of when the last consumer leaves a queue?
Thanks,
Max.

From majek04 at gmail.com  Wed Feb 23 12:35:32 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 23 Feb 2011 12:35:32 +0000
Subject: [rabbitmq-discuss] Notification on Queue Shutdown
In-Reply-To: <AANLkTinvRFAv_EKY3M4oBQD6+uneqRtD-FuAapTHbMp=@mail.gmail.com>
References: <AANLkTinvRFAv_EKY3M4oBQD6+uneqRtD-FuAapTHbMp=@mail.gmail.com>
Message-ID: <AANLkTin+mV0aYVL99R3ph2RAa46Oe32pdTVx2P6D6=2O@mail.gmail.com>

On Wed, Feb 23, 2011 at 12:26, Max Bridgewater
<max.bridgewater at gmail.com> wrote:
> Is there a way to listen and be notified when RabbitMQ shuts down a
> queue or be informed of when the last consumer leaves a queue?

Rabbit won't automatically destroy a queue unless it's 'exclusive' or
'auto_delete'.

Queue.declare command returns three things: queue name, number of messages
in the queue and number of consumers. You can use this to check if there
is a consumer left.

Marek

From yuesong.c at gmail.com  Wed Feb 23 14:13:47 2011
From: yuesong.c at gmail.com (Yuesong Wang)
Date: Wed, 23 Feb 2011 09:13:47 -0500
Subject: [rabbitmq-discuss] What do you do when RabbitMQ goes down?
Message-ID: <779258B2-24A1-4966-B173-F29CB5093CE6@gmail.com>

Hi,

I was wondering what people do on the client side to gracefully handle when RabbitMQ server goes down (or network outage)? Assuming no HA setup. Do you queue your messages and keep trying to reconnect? Do you setup a cluster and build-in the capability to automatically connect to another node (with some work I can get that to work, but only for non-durable queues)? Any tips for a newbie?

Thanks,

Yuesong

From david at rabbitmq.com  Wed Feb 23 14:17:49 2011
From: david at rabbitmq.com (David Wragg)
Date: Wed, 23 Feb 2011 14:17:49 +0000
Subject: [rabbitmq-discuss] Does anybody know how to deploy RabbitMQ on
	AIX-Unix system?
In-Reply-To: <003001cbd33c$1affa090$50fee1b0$@hundsun.com> (helf@hundsun.com's
	message of "Wed, 23 Feb 2011 17:29:01 +0800")
References: <000c01cbd25d$302c9250$9085b6f0$@hundsun.com>
	<7C50EC6E-71C8-47DB-BD20-CCC978422573@gmail.com>
	<4D63B634.2040703@rabbitmq.com>
	<003001cbd33c$1affa090$50fee1b0$@hundsun.com>
Message-ID: <yrv4csjvehm2a.fsf_-_@dwragg.eng.vmware.com>

Hi,

"helf" <helf at hundsun.com> writes:
> Thanks to Emile's patch, I have installed Erlang on my AIX-Unix system
> successfully. And the RabbitMQ server is deployed on it too.
>
> But now, there is another problem about rabbitmq-c client lib. Does
> anybody have experience on building rabbitmq-c client lib on AIX-Unix
> system? Or could you please give me some tips?
>
> Attached is my building log.

It looks like there are several issues in that log, so I expect it will
be a slo process if I try to make guesses about how to address them.  It
would be better for someone with access to an AIX machine to work out
how to build rabbitmq-c successfully, and then send instructions out.

I'm not sure whether we still have access to an AIX machine to do this.
I'll find out.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From Denis.Conan at telecom-sudparis.eu  Wed Feb 23 14:29:24 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Wed, 23 Feb 2011 15:29:24 +0100
Subject: [rabbitmq-discuss] Pika and multi-threading
In-Reply-To: <AANLkTikMTVgv2DWfUxD8G6n9Sgd_zx51w5W22biHRsQq@mail.gmail.com>
References: <4D63D3EB.1030400@telecom-sudparis.eu>
	<AANLkTikMTVgv2DWfUxD8G6n9Sgd_zx51w5W22biHRsQq@mail.gmail.com>
Message-ID: <4D6519C4.4010306@telecom-sudparis.eu>

Le 22/02/2011 17:02, Gavin M. Roy a ?crit :
> 2011/2/22 Denis Conan<Denis.Conan at telecom-sudparis.eu>:
>>
>> Hi all,
>>
>> The Pika Web site says: "Pika does not have any notion of threading in the
>> code. If you want to use Pika with threading, make sure you have a Pika
>> connection per thread, created in that thread. It is not safe to share one
>> Pika connection across threads."
>>
>> When using the continuation-passing style mode with SelectConnection, what
>> about the singleton object IOLoop? I created a connection on the main thread
>> for a vhost, and then a second connection for a different vhost in a new
>> thread, but callbacks of the main threads for the first vhost are called. Am
>> I missing something?
>
> You're not, this is something I'm working through now. In essence,
> there is a logical separation in the pika code between the core of how
> pika does what it does and the connection adapters. The singleton
> model for ioloops was a later addition that broke the model with
> regard to threads. I have been working on fixing this to be thread
> safe and will have something out soon on it.
>

Thank your for the answer.

In the meantime, forking the process may be an alternative. Is there a "simple" 
mean to de-register a callback?

CU

Denis

From gmr at myyearbook.com  Wed Feb 23 15:28:19 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 23 Feb 2011 10:28:19 -0500
Subject: [rabbitmq-discuss] Pika and multi-threading
In-Reply-To: <4D6519C4.4010306@telecom-sudparis.eu>
References: <4D63D3EB.1030400@telecom-sudparis.eu>
	<AANLkTikMTVgv2DWfUxD8G6n9Sgd_zx51w5W22biHRsQq@mail.gmail.com>
	<4D6519C4.4010306@telecom-sudparis.eu>
Message-ID: <AANLkTikvA6m7+aDGRg9T+FAWrUKEr3MBd0wcm_38+4M4@mail.gmail.com>

2011/2/23 Denis Conan <Denis.Conan at telecom-sudparis.eu>

> Le 22/02/2011 17:02, Gavin M. Roy a ?crit :
>
>> 2011/2/22 Denis Conan<Denis.Conan at telecom-sudparis.eu>:
>>
>>
>>> Hi all,
>>>
>>> The Pika Web site says: "Pika does not have any notion of threading in
>>> the
>>> code. If you want to use Pika with threading, make sure you have a Pika
>>> connection per thread, created in that thread. It is not safe to share
>>> one
>>> Pika connection across threads."
>>>
>>> When using the continuation-passing style mode with SelectConnection,
>>> what
>>> about the singleton object IOLoop? I created a connection on the main
>>> thread
>>> for a vhost, and then a second connection for a different vhost in a new
>>> thread, but callbacks of the main threads for the first vhost are called.
>>> Am
>>> I missing something?
>>>
>>
>> You're not, this is something I'm working through now. In essence,
>> there is a logical separation in the pika code between the core of how
>> pika does what it does and the connection adapters. The singleton
>> model for ioloops was a later addition that broke the model with
>> regard to threads. I have been working on fixing this to be thread
>> safe and will have something out soon on it.
>>
>>
> Thank your for the answer.
>
> In the meantime, forking the process may be an alternative. Is there a
> "simple" mean to de-register a callback?
>

Simple is relative to how deep the it was that the callback was registered.
What type of callback do you want to unregister?

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110223/acd102b0/attachment.htm>

From Denis.Conan at telecom-sudparis.eu  Wed Feb 23 15:33:05 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Wed, 23 Feb 2011 16:33:05 +0100
Subject: [rabbitmq-discuss] Pika and multi-threading
In-Reply-To: <AANLkTikvA6m7+aDGRg9T+FAWrUKEr3MBd0wcm_38+4M4@mail.gmail.com>
References: <4D63D3EB.1030400@telecom-sudparis.eu>
	<AANLkTikMTVgv2DWfUxD8G6n9Sgd_zx51w5W22biHRsQq@mail.gmail.com>
	<4D6519C4.4010306@telecom-sudparis.eu>
	<AANLkTikvA6m7+aDGRg9T+FAWrUKEr3MBd0wcm_38+4M4@mail.gmail.com>
Message-ID: <4D6528B1.30109@telecom-sudparis.eu>

Le 23/02/2011 16:28, Gavin M. Roy a ?crit :
>
>
> 2011/2/23 Denis Conan <Denis.Conan at telecom-sudparis.eu
> <mailto:Denis.Conan at telecom-sudparis.eu>>
>
>     Le 22/02/2011 17:02, Gavin M. Roy a ?crit :
>
>         2011/2/22 Denis Conan<Denis.Conan at telecom-sudparis.eu
>         <mailto:Denis.Conan at telecom-sudparis.eu>>:
>
>
>             Hi all,
>
>             The Pika Web site says: "Pika does not have any notion of
>             threading in the
>             code. If you want to use Pika with threading, make sure you
>             have a Pika
>             connection per thread, created in that thread. It is not
>             safe to share one
>             Pika connection across threads."
>
>             When using the continuation-passing style mode with
>             SelectConnection, what
>             about the singleton object IOLoop? I created a connection on
>             the main thread
>             for a vhost, and then a second connection for a different
>             vhost in a new
>             thread, but callbacks of the main threads for the first
>             vhost are called. Am
>             I missing something?
>
>
>         You're not, this is something I'm working through now. In essence,
>         there is a logical separation in the pika code between the core
>         of how
>         pika does what it does and the connection adapters. The singleton
>         model for ioloops was a later addition that broke the model with
>         regard to threads. I have been working on fixing this to be thread
>         safe and will have something out soon on it.
>
>
>     Thank your for the answer.
>
>     In the meantime, forking the process may be an alternative. Is there
>     a "simple" mean to de-register a callback?
>
>
> Simple is relative to how deep the it was that the callback was
> registered. What type of callback do you want to unregister?

The one for the treatment of delivered messages that was registered in a 
basic_consume.

>
> Gavin


-- 
Denis Conan
Institut T?l?com, T?l?com SudParis
http://www-public.telecom-sudparis.eu/~conan

From gmr at myyearbook.com  Wed Feb 23 15:37:18 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 23 Feb 2011 10:37:18 -0500
Subject: [rabbitmq-discuss] Pika and multi-threading
In-Reply-To: <4D6528B1.30109@telecom-sudparis.eu>
References: <4D63D3EB.1030400@telecom-sudparis.eu>
	<AANLkTikMTVgv2DWfUxD8G6n9Sgd_zx51w5W22biHRsQq@mail.gmail.com>
	<4D6519C4.4010306@telecom-sudparis.eu>
	<AANLkTikvA6m7+aDGRg9T+FAWrUKEr3MBd0wcm_38+4M4@mail.gmail.com>
	<4D6528B1.30109@telecom-sudparis.eu>
Message-ID: <AANLkTinZ+9hf2FOZ53Uhop7e4GvUXH74S2wW_cTeGE=a@mail.gmail.com>

2011/2/23 Denis Conan <Denis.Conan at telecom-sudparis.eu>

> Le 23/02/2011 16:28, Gavin M. Roy a ?crit :
>
>> The one for the treatment of delivered messages that was registered in a
>> basic_consume.
>>
>
Not sure of the use case for that, does channel.basic_cancel() not do what
you want?

      def basic_cancel(self, consumer_tag, nowait=False, callback=None):
        Pass in the consumer tag to cancel a basic_consume request with. The
        consumer_tag is optionally passed to basic_consume as a parameter and
        it is always returned by the Basic.ConsumeOk frame. For more
        information see:

 http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.cancel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110223/933ee1ab/attachment.htm>

From simonthorogood at hotmail.com  Wed Feb 23 15:47:36 2011
From: simonthorogood at hotmail.com (SimonT)
Date: Wed, 23 Feb 2011 07:47:36 -0800 (PST)
Subject: [rabbitmq-discuss] Auto-delete & x-expire being ignored
In-Reply-To: <aa8ddb07-b1f1-42a7-8b7b-823869f26617@a21g2000prj.googlegroups.com>
References: <aa8ddb07-b1f1-42a7-8b7b-823869f26617@a21g2000prj.googlegroups.com>
Message-ID: <2b91850c-9f76-41da-bd8f-41320893e2d0@by6g2000vbb.googlegroups.com>

Ooops - x-expires not x-expire - works like a dream now...

From Denis.Conan at telecom-sudparis.eu  Wed Feb 23 15:55:15 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Wed, 23 Feb 2011 16:55:15 +0100
Subject: [rabbitmq-discuss] Pika and multi-threading
In-Reply-To: <AANLkTinZ+9hf2FOZ53Uhop7e4GvUXH74S2wW_cTeGE=a@mail.gmail.com>
References: <4D63D3EB.1030400@telecom-sudparis.eu>
	<AANLkTikMTVgv2DWfUxD8G6n9Sgd_zx51w5W22biHRsQq@mail.gmail.com>
	<4D6519C4.4010306@telecom-sudparis.eu>
	<AANLkTikvA6m7+aDGRg9T+FAWrUKEr3MBd0wcm_38+4M4@mail.gmail.com>
	<4D6528B1.30109@telecom-sudparis.eu>
	<AANLkTinZ+9hf2FOZ53Uhop7e4GvUXH74S2wW_cTeGE=a@mail.gmail.com>
Message-ID: <4D652DE3.9090201@telecom-sudparis.eu>

Le 23/02/2011 16:37, Gavin M. Roy a ?crit :
>
> 2011/2/23 Denis Conan <Denis.Conan at telecom-sudparis.eu
> <mailto:Denis.Conan at telecom-sudparis.eu>>
>
>     Le 23/02/2011 16:28, Gavin M. Roy a ?crit :
>
>         The one for the treatment of delivered messages that was
>         registered in a basic_consume.
>
>
> Not sure of the use case for that, does channel.basic_cancel() not do
> what you want?
>
>
> def basic_cancel(self, consumer_tag, nowait=False, callback=None):

I don't think so. It is for a local un-registration.

>
>
> Pass in the consumer tag to cancel a basic_consume request with. The
>
>
> consumer_tag is optionally passed to basic_consume as a parameter and
>
>
> it is always returned by the Basic.ConsumeOk frame. For more
>
>
> information see:
>
>
>
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.cancel



-- 
Denis Conan
Institut T?l?com, T?l?com SudParis
http://www-public.telecom-sudparis.eu/~conan

From majek04 at gmail.com  Wed Feb 23 16:40:13 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 23 Feb 2011 16:40:13 +0000
Subject: [rabbitmq-discuss] (Lightweight) Publisher Confirms with the
 pika Python client
In-Reply-To: <AANLkTi=Bizeo7-=MoHHMSG1C6F9OYJf-95u_5Yq6SO4W@mail.gmail.com>
References: <AANLkTi=Bizeo7-=MoHHMSG1C6F9OYJf-95u_5Yq6SO4W@mail.gmail.com>
Message-ID: <AANLkTikt0Qh7BX-Cbd_xxixD1hdiCB6tEk1a3D=iPv89@mail.gmail.com>

On Mon, Feb 21, 2011 at 22:42, Mark Aufflick <mark-erlang at aufflick.com> wrote:
> I have seen reference in passing on this list that all clients (except the C
> client) support the lightweight publisher confirms
> (ie.?http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/).
> I can't quite work out what this means in terms of using the Python pika
> client.

> I'm also wondering if there is
> an easy way to do a blocking publish that waits for the ack/nack and returns
> success/failure.

Achieving it was one of the main reasons to write Puka.
Every publish in Puka can be treated as a synchronous thing,
which can succeed or fail.

Cheers,
  Marek

From jasonjwwilliams at gmail.com  Wed Feb 23 16:53:48 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 23 Feb 2011 09:53:48 -0700
Subject: [rabbitmq-discuss] txAMQP Helpers
In-Reply-To: <AANLkTimoj6qUZRurAft+MBxOVYR9ec4DfoANxGJSOXOD@mail.gmail.com>
References: <AANLkTikDKcHcOe3YyoaCc4t=Hc7N+bHdPQ9sdWmDo-Ut@mail.gmail.com>
	<AANLkTin-wcCAF1Gb2ixjQECthrtuTdLAzx5zoExLYJV-@mail.gmail.com>
	<AANLkTimoj6qUZRurAft+MBxOVYR9ec4DfoANxGJSOXOD@mail.gmail.com>
Message-ID: <69104811-0F8C-4ED4-9190-4F8987786514@gmail.com>

Thanks Jim!

-J

Sent via iPhone

Is your e-mail Premiere?

On Feb 23, 2011, at 2:25, Jim Apperly <jim at rabbitmq.com> wrote:

> On 22 February 2011 06:04, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Jason
> 
> Thank-you.  Do you want us to list that on:
> http://www.rabbitmq.com/devtools.html ?
> 
> Done.  You should see it on the live site shortly.
> 
> Jim
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110223/e697d770/attachment.htm>

From gmr at myyearbook.com  Wed Feb 23 17:54:37 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 23 Feb 2011 12:54:37 -0500
Subject: [rabbitmq-discuss] pika - HeartbeatChecker Bug?
In-Reply-To: <AANLkTi=Ssg5rJjeNLD55eaDhze0FCxg75gZKGBAPJ+0m@mail.gmail.com>
References: <AANLkTi=Ssg5rJjeNLD55eaDhze0FCxg75gZKGBAPJ+0m@mail.gmail.com>
Message-ID: <AANLkTikriivueJ68YQGZ5PYtLn=LujEnORF6D1M1=S=R@mail.gmail.com>

Hi Yoav,

On Wed, Feb 23, 2011 at 4:48 AM, yoav glazner <yoavglazner at gmail.com> wrote:

> Hi,
>
> I think there is a bug in pika's HeartbeatChecker.
>

Indeed. I just committed a fix:

https://github.com/tonyg/pika/commit/a14e4c0c760aef592789412d3e72940defbac140

I don't always get this error, but if I chage send_frame to _send_frame it
> seems to work...
>

That is the fix, sorry for the inconvenience. I am working to add coverage
to test this and areas not covered by the unit tests. The fix will be in the
0.9.5 release which should come in the next week or two.

Regards,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110223/df01a3d3/attachment-0001.htm>

From suranakamal at gmail.com  Wed Feb 23 19:50:38 2011
From: suranakamal at gmail.com (Kamal Surana)
Date: Thu, 24 Feb 2011 01:20:38 +0530
Subject: [rabbitmq-discuss] RabbitMQ - StackOverflowError
Message-ID: <AANLkTi=ay-fFRZ84fv0xyBDBYgzwAEuM-EVNaUX7OF_W@mail.gmail.com>

Hi

We are seeing following error in our code, after which the connection is
getting closed/corrupt. There are lof of channels being created on the same
connection. What could be possible reason for this error?

Exception in thread "AMQP Connection xxxxxx001:5672"
java.lang.StackOverflowError
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:70)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
 at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110224/ece97828/attachment.htm>

From mli at rmmsoft.com.cn  Thu Feb 24 04:13:32 2011
From: mli at rmmsoft.com.cn (Ming Li)
Date: Thu, 24 Feb 2011 04:13:32 +0000
Subject: [rabbitmq-discuss] MQ header question
In-Reply-To: <4D6223A9.406@rabbitmq.com>
References: <19F7DB1491CA0149AF64F65336540FEA0E62A457@server.rmmsoft.com.cn>
	<4D6223A9.406@rabbitmq.com>
Message-ID: <19F7DB1491CA0149AF64F65336540FEA0E62CE04@server.rmmsoft.com.cn>

Hi,

Since I'm fairly new to this, can you elaborate how to accomplish this or sample code?

What I'm trying to accomplish is to minimize the data size as much as possible.

I'm very much appreciated your help,


>The guid in there is a consumer tag which the server generates on basic.consume, and subsequently includes in message deliveries. The tag can be specified by the 
> client  instead, which allows you to make it as short as you like, though it has to be unique per channel.


>Regards,

>Matthias.

From matthias at rabbitmq.com  Thu Feb 24 09:13:22 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 24 Feb 2011 09:13:22 +0000
Subject: [rabbitmq-discuss] MQ header question
In-Reply-To: <19F7DB1491CA0149AF64F65336540FEA0E62CE04@server.rmmsoft.com.cn>
References: <19F7DB1491CA0149AF64F65336540FEA0E62A457@server.rmmsoft.com.cn>
	<4D6223A9.406@rabbitmq.com>
	<19F7DB1491CA0149AF64F65336540FEA0E62CE04@server.rmmsoft.com.cn>
Message-ID: <4D662132.40102@rabbitmq.com>

Ming Li wrote:
> Since I'm fairly new to this, can you elaborate how to accomplish
> this or sample code?

See 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.consumer-tag 
- if you set that tag yourself then the server won't need to generate it.

Regards,

Matthias.

From rob at rabbitmq.com  Thu Feb 24 10:14:27 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 24 Feb 2011 10:14:27 +0000
Subject: [rabbitmq-discuss] RabbitMQ - StackOverflowError
In-Reply-To: <AANLkTi=ay-fFRZ84fv0xyBDBYgzwAEuM-EVNaUX7OF_W@mail.gmail.com>
References: <AANLkTi=ay-fFRZ84fv0xyBDBYgzwAEuM-EVNaUX7OF_W@mail.gmail.com>
Message-ID: <4D662F83.7070903@rabbitmq.com>

Kamal,

Which client version are you using? Those line numbers don't correspond 
to what I have for 2.3.1. If you're not on 2.3.1 yet you should try 
upgrading.

Regards,

Rob

On 23/02/11 19:50, Kamal Surana wrote:
> Hi
> We are seeing following error in our code, after which the connection
> is getting closed/corrupt. There are lof of channels being created on
> the same connection. What could be possible reason for this error?
> Exception in thread "AMQP Connection xxxxxx001:5672"
> java.lang.StackOverflowError
>  at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:70)
>  at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
>  at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
>  at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
>  at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)

From rob at rabbitmq.com  Thu Feb 24 12:00:44 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 24 Feb 2011 12:00:44 +0000
Subject: [rabbitmq-discuss] RabbitMQ - StackOverflowError
In-Reply-To: <4D662F83.7070903@rabbitmq.com>
References: <AANLkTi=ay-fFRZ84fv0xyBDBYgzwAEuM-EVNaUX7OF_W@mail.gmail.com>
	<4D662F83.7070903@rabbitmq.com>
Message-ID: <4D66486C.3010109@rabbitmq.com>

Kamal,

Further investigation shows that this bug is still present on 2.3.1. 
I've raised a bug and this will be fixed soon.

Regards,

Rob

On 24/02/11 10:14, Rob Harrop wrote:
> Kamal,
>
> Which client version are you using? Those line numbers don't 
> correspond to what I have for 2.3.1. If you're not on 2.3.1 yet you 
> should try upgrading.
>
> Regards,
>
> Rob
>
> On 23/02/11 19:50, Kamal Surana wrote:
>> Hi
>> We are seeing following error in our code, after which the connection
>> is getting closed/corrupt. There are lof of channels being created on
>> the same connection. What could be possible reason for this error?
>> Exception in thread "AMQP Connection xxxxxx001:5672"
>> java.lang.StackOverflowError
>>  at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:70)
>>  at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
>>  at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
>>  at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
>>  at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Thu Feb 24 12:13:03 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 24 Feb 2011 12:13:03 +0000
Subject: [rabbitmq-discuss] rabbitmq-auth-mechanism-ssl plugin, TCP,
 SASL EXTERNAL
In-Reply-To: <4D550F77.2090203@rabbitmq.com>
References: <083D5377F8EC294D884D590409EFE70D7113956550@MAIL02.austin.utexas.edu>
	<4D550F77.2090203@rabbitmq.com>
Message-ID: <4D664B4F.5070601@rabbitmq.com>

On 11/02/11 10:29, Simon MacMullen wrote:
> I'll have a think about this and see if we can prevent EXTERNAL from
> being announced on non-SSL connections.

We can. This will be in the next release.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Wed Feb 23 12:38:57 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 23 Feb 2011 12:38:57 +0000
Subject: [rabbitmq-discuss] Notification on Queue Shutdown
In-Reply-To: <AANLkTinvRFAv_EKY3M4oBQD6+uneqRtD-FuAapTHbMp=@mail.gmail.com>
References: <AANLkTinvRFAv_EKY3M4oBQD6+uneqRtD-FuAapTHbMp=@mail.gmail.com>
Message-ID: <20110223123856.GA22916@rabbitmq.com>

On Wed, Feb 23, 2011 at 07:26:29AM -0500, Max Bridgewater wrote:
> Is there a way to listen and be notified when RabbitMQ shuts down a
> queue or be informed of when the last consumer leaves a queue?

There is also an extension currently in development which will allow
suitably endowed clients to receive notifications from the broker when a
channel's consumption from a queue disappears - e.g. in the event of
someone else deleting a queue from which you're consuming.

Matthew

From stammailbox at gmail.com  Thu Feb 24 14:27:08 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Thu, 24 Feb 2011 16:27:08 +0200
Subject: [rabbitmq-discuss] Problem after upgrading to 2.3.1
Message-ID: <AANLkTikXEW7N0rcmMrdKUuOa999qt871RNgC1NfdzMCo@mail.gmail.com>

Hi,

In my company we are running rabbitmq 1.7.0 over windows.
I am trying now to upgrade the rabbitmq to the current 2.3.1 version and
encountered a problem.
Generally, after upgrade and no code change in the application side I am
getting the following exception

reply-code=406,reply-text=PRECONDITION_FAILED - unknown delivery tag
1,class-id=60,method-id=80),null,""}

First, I will Explain how my system works and then my exception.
when App A wants to send an async message to App B and receive an answer,
this is the algorythm:

1. App A generate a unique ID and puts it in the message object
2. Then App A subscribes to a new Queue with both the queue name and routing
key equals to the new uuid.
3. App B open the message, do some calculations and return the result to the
channel with the routingkey that it received.
4. App A gets the answer and close the queue.

So far everything went really well in 1.7.0. what went wrong in 2.3.1?

When Application A does basicPublish() application B immidiately throws
CentralExceptionHandler


com.rabbitmq.client.ShutdownSignalException: channel error; reason:
{#method<channel.close>(reply-code=406,reply-text=PRECONDITION_FAILED -
unknown delivery tag 1,class-id=60,method-id=80),null,""}
at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:191)
at
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:159)
at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:438)
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error;
reason:
{#method<channel.close>(reply-code=406,reply-text=PRECONDITION_FAILED -
unknown delivery tag 1,class-id=60,method-id=80),null,""}

Any one got some idea?
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110224/bb4c09f3/attachment.htm>

From matthew at rabbitmq.com  Thu Feb 24 14:31:12 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 24 Feb 2011 14:31:12 +0000
Subject: [rabbitmq-discuss] Problem after upgrading to 2.3.1
In-Reply-To: <AANLkTikXEW7N0rcmMrdKUuOa999qt871RNgC1NfdzMCo@mail.gmail.com>
References: <AANLkTikXEW7N0rcmMrdKUuOa999qt871RNgC1NfdzMCo@mail.gmail.com>
Message-ID: <20110224143111.GG32147@rabbitmq.com>

On Thu, Feb 24, 2011 at 04:27:08PM +0200, mysurf mail wrote:
> reply-code=406,reply-text=PRECONDITION_FAILED - unknown delivery tag
> 1,class-id=60,method-id=80),null,""}

Older versions of Rabbit didn't error if you acked the same message
multiple times. Currenty versions do, in order to conform with the AMQP
0-9-1 spec. It's very likely you're acknowledging the same message
multiple times in order to get this error message.

Can you check your application to see if this is the case?

Best wishes,

Matthew

From stammailbox at gmail.com  Thu Feb 24 15:48:28 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Thu, 24 Feb 2011 17:48:28 +0200
Subject: [rabbitmq-discuss] Problem after upgrading to 2.3.1
In-Reply-To: <20110224143111.GG32147@rabbitmq.com>
References: <AANLkTikXEW7N0rcmMrdKUuOa999qt871RNgC1NfdzMCo@mail.gmail.com>
	<20110224143111.GG32147@rabbitmq.com>
Message-ID: <AANLkTi=U6w_HaZYYGTD26P5QCWym90kN2amR_pzwN1c9@mail.gmail.com>

well,
It would be strange if we do.

What I basically see is that we start listening on the receiving
app (subscriber)  as follows:

            boolean durable = false;
            final boolean mandatory = true;
            final boolean immediate = true;
            channel.exchangeDeclare(exchangeName, "direct", durable,
mandatory, immediate, new HashMap<String, Object>());
            channel.queueDeclare(queueName, durable);
            channel.queueBind(queueName, exchangeName, routingKey);

            boolean noAck = true;
            queueingConsumer = new QueueingConsumer(channel);
            channel.basicConsume(queueName, noAck, queueingConsumer);

the sender uses

channel.basicPublish(exchangeName, routingKey,
MessageProperties.MINIMAL_BASIC, messageBodyBytes);

Thank you

On Thu, Feb 24, 2011 at 4:31 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Thu, Feb 24, 2011 at 04:27:08PM +0200, mysurf mail wrote:
> > reply-code=406,reply-text=PRECONDITION_FAILED - unknown delivery tag
> > 1,class-id=60,method-id=80),null,""}
>
> Older versions of Rabbit didn't error if you acked the same message
> multiple times. Currenty versions do, in order to conform with the AMQP
> 0-9-1 spec. It's very likely you're acknowledging the same message
> multiple times in order to get this error message.
>
> Can you check your application to see if this is the case?
>
> Best wishes,
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110224/3ddcd5e7/attachment.htm>

From scott.luxenberg at gmail.com  Thu Feb 24 16:21:48 2011
From: scott.luxenberg at gmail.com (Scott)
Date: Thu, 24 Feb 2011 16:21:48 +0000 (UTC)
Subject: [rabbitmq-discuss] Hello World Example
References: <8ce0c1cf-3cbb-4df1-b970-c954eeb32681@r13g2000yqk.googlegroups.com>
	<4D622270.9090905@rabbitmq.com>
Message-ID: <loom.20110224T172016-407@post.gmane.org>

Matthias Radestock <matthias at ...> writes:

> 
> <quote>
> In this tutorial we're going to use pika version *0.5.2*
> </quote>
> 
> Looks like you have a more recent version installed.
> 
> Regards,
> 
> Matthias.
> 


I am encountering this issue as well, but I do know I have pika 0.5.2 installed,
and not a more recent one...


From max.bridgewater at gmail.com  Thu Feb 24 16:26:55 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Thu, 24 Feb 2011 11:26:55 -0500
Subject: [rabbitmq-discuss] Notification on Queue Shutdown
In-Reply-To: <20110223123856.GA22916@rabbitmq.com>
References: <AANLkTinvRFAv_EKY3M4oBQD6+uneqRtD-FuAapTHbMp=@mail.gmail.com>
	<20110223123856.GA22916@rabbitmq.com>
Message-ID: <AANLkTim8O-4SoEWpy3aVPMZMVVPw-eDKftzUCLJU9=zy@mail.gmail.com>

Thanks. This is cool. I look forward to it. Allow me to ask another
question. When I declare an auto delete channel, is there a guarantee
that it will be up until the first consumer joins? That is, if the
first consumer joins after 10 hours, will the channel still be there?

Thanks,
Max.

On Wed, Feb 23, 2011 at 7:38 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Wed, Feb 23, 2011 at 07:26:29AM -0500, Max Bridgewater wrote:
>> Is there a way to listen and be notified when RabbitMQ shuts down a
>> queue or be informed of when the last consumer leaves a queue?
>
> There is also an extension currently in development which will allow
> suitably endowed clients to receive notifications from the broker when a
> channel's consumption from a queue disappears - e.g. in the event of
> someone else deleting a queue from which you're consuming.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From gmr at myyearbook.com  Thu Feb 24 16:27:38 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 24 Feb 2011 11:27:38 -0500
Subject: [rabbitmq-discuss] Hello World Example
In-Reply-To: <loom.20110224T172016-407@post.gmane.org>
References: <8ce0c1cf-3cbb-4df1-b970-c954eeb32681@r13g2000yqk.googlegroups.com>
	<4D622270.9090905@rabbitmq.com>
	<loom.20110224T172016-407@post.gmane.org>
Message-ID: <AANLkTinSoU7qx2LK-TJhdFMJGAprJWWSr8FkbqRVEyPB@mail.gmail.com>

On Thu, Feb 24, 2011 at 11:21 AM, Scott <scott.luxenberg at gmail.com> wrote:

>
>
> I am encountering this issue as well, but I do know I have pika 0.5.2
> installed,
> and not a more recent one...


The method signature for channel() changed in Pika 0.9, prior to that it did
not take the callback parameter. Perhaps you have a module pathing issue and
have two versions installed?  Did you install from source or
pip/easy_install?

Regards,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110224/cbee6aaf/attachment.htm>

From emile at rabbitmq.com  Thu Feb 24 16:48:54 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 24 Feb 2011 16:48:54 +0000
Subject: [rabbitmq-discuss] Help with my priority queue design
In-Reply-To: <AANLkTik86H2PzTSSd3AK3jc4TR=MKC5B0VtQbToC5=og@mail.gmail.com>
References: <AANLkTik86H2PzTSSd3AK3jc4TR=MKC5B0VtQbToC5=og@mail.gmail.com>
Message-ID: <4D668BF6.8060208@rabbitmq.com>

Hi yoav,

On 22/02/11 20:54, yoav glazner wrote:
> Hi,
>
> I wanted to show my design for a priority based task queue and get
> some insight from experts.
>
> The client create a queue named: "some_tasks_to_work_on2" and put his
>  tasks there, then it puts the following message in a queue named
> "batch_states": [{batch="some_tasks_to_work_on2", priority=3}] now
> each worker can take the status message and get tasks from the
> batch. if a few batches are in the status message then the worker
> check the queue by the priority order.
>
> a worker should also return the status message after reading it so
> other workers can also read it. now this is needed because i want
> workers to be able to wake up any time and get the latest status. In
> this approch I can add new batches on the fly and also change
> priorities.
>
> Do you think there is a better way to do it?

The usual way of implementing priorities is to use separate queues for 
each priority. So if you need two priority levels then declare queues Q1 
and Q2. Route messages to those queues based on priority and have 
clients consume from queues in that order. So Q2 messages won't be 
consumed unless Q1 is empty.

You might find this simpler than using indirection, which is what you 
appear to be doing.



Emile


From scott.luxenberg at gmail.com  Thu Feb 24 16:49:04 2011
From: scott.luxenberg at gmail.com (Scott Luxenberg)
Date: Thu, 24 Feb 2011 16:49:04 +0000 (UTC)
Subject: [rabbitmq-discuss] Hello World Example
References: <8ce0c1cf-3cbb-4df1-b970-c954eeb32681@r13g2000yqk.googlegroups.com>
	<4D622270.9090905@rabbitmq.com>
	<loom.20110224T172016-407@post.gmane.org>
	<AANLkTinSoU7qx2LK-TJhdFMJGAprJWWSr8FkbqRVEyPB@mail.gmail.com>
Message-ID: <loom.20110224T174448-691@post.gmane.org>

Gavin M. Roy <gmr at ...> writes:

> The method signature for channel() changed in Pika 0.9, prior to that it did
not take the callback parameter. Perhaps you have a module pathing issue and
have two versions installed? ?Did you install from source or pip/easy_install?
> 
> 
> Regards,
> 
> Gavin?
> 

I used the pip method as per the instructions in the tutorial, and I installed
our server from scratch so I do not believe there is a second version of pika on
our system, unless pika by default installs with python.


From sagar131 at gmail.com  Thu Feb 24 17:15:40 2011
From: sagar131 at gmail.com (Sagar Varpe)
Date: Thu, 24 Feb 2011 22:45:40 +0530
Subject: [rabbitmq-discuss] Exception in Creating Rabbit MQ Connection
Message-ID: <AANLkTinMBTYSsSyywBa0rgvaZS8jw4+Wv8DPYJR+O55y@mail.gmail.com>

Hi guys...

       I am using rabbitmq server 2.3 .and java client 2.3.1
        My application is in Scala.
       There are  about 8-9 Actors each has its own RabbitMQ QueueManager.
and every actor in checking for message in each queue for every 1 minute


   in each Queue Manager the getting connection method is like

   1. private def getConnection {
   2.     try {
   3.       conn = FACTORY.newConnection
   4.       if (conn == null) {
   5.         logger.info(" FAILED TO CREATE CONNECTION WITH RABBITMQ ON  "
   + FACTORY.getHost + ":" + FACTORY.getPort)
   6.       }
   7.       channel = conn.createChannel
   8.       if (channel == null) {
   9.         logger.info(" FAILED TO CREATE CHANNEL WITH RABBITMQ ON  " +
   FACTORY.getHost + ":" + FACTORY.getPort)
   10.       }
   11.       if (conn != null) {
   12.         val durable = true
   13.         channel.exchangeDeclare(EXCHANGE, "direct", durable)
   14.         channel.queueDeclare(QUEUE, durable, false, false, null)
   15.         channel queueBind (QUEUE, EXCHANGE, ROUTING_KEY)
   16.       }
   17.     } catch {
   18.       case e: Exception => logger.error("Exception In Getting
   Connection to RabbitMQ ", e)
   19.     }
   20.
   21.   }



  while publishing message on rabbitMQ Server . i am checking for null
connection .if it is null then creating new connection
  same for Getmessage .........

  I never close channel and connection for Rabbitmq .

 this work ............But afet some couple of hours it gives me exception


  Exception in Creating Rabbit MQ Connection
java.net.ConnectException: Connection timed out
       at java.net.PlainSocketImpl.socketConnect(Native Method)
       at
java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:310)
       at
java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:176)
       at
java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:163)
       at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:384)
       at java.net.Socket.connect(Socket.java:546)
       at java.net.Socket.connect(Socket.java:495)
       at
com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:338)
       at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:376)
       at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:399)


Is there any possible solution for this type of exception



-- 
Best Regards,
Sagar Varpe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110224/b66d6a09/attachment.htm>

From matthew at rabbitmq.com  Thu Feb 24 18:07:44 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 24 Feb 2011 18:07:44 +0000
Subject: [rabbitmq-discuss] Notification on Queue Shutdown
In-Reply-To: <AANLkTim8O-4SoEWpy3aVPMZMVVPw-eDKftzUCLJU9=zy@mail.gmail.com>
References: <AANLkTinvRFAv_EKY3M4oBQD6+uneqRtD-FuAapTHbMp=@mail.gmail.com>
	<20110223123856.GA22916@rabbitmq.com>
	<AANLkTim8O-4SoEWpy3aVPMZMVVPw-eDKftzUCLJU9=zy@mail.gmail.com>
Message-ID: <20110224180743.GJ32147@rabbitmq.com>

On Thu, Feb 24, 2011 at 11:26:55AM -0500, Max Bridgewater wrote:
> Thanks. This is cool. I look forward to it. Allow me to ask another
> question. When I declare an auto delete channel, is there a guarantee
> that it will be up until the first consumer joins? That is, if the
> first consumer joins after 10 hours, will the channel still be there?

No. Someone else could come along and delete the queue in the meantime.
Provided no one deletes it and the node on which the queue resides
doesn't die, then yes, it'll still be there, but that's the same for all
queues (well, exclusive queues will disappear if the connection that
created the queue disappears, but you get the picture).

Matthew

From sagar.varpe at wissen.co.in  Thu Feb 24 17:47:39 2011
From: sagar.varpe at wissen.co.in (sagar varpe)
Date: Thu, 24 Feb 2011 23:17:39 +0530
Subject: [rabbitmq-discuss] Fwd: Exception in Creating Rabbit MQ Connection
In-Reply-To: <AANLkTi=1-T07=__o1tCeX8BbzvVFOq3O23FbCFH+bfo_@mail.gmail.com>
References: <AANLkTi=1-T07=__o1tCeX8BbzvVFOq3O23FbCFH+bfo_@mail.gmail.com>
Message-ID: <AANLkTi=K4+4HW5aQ-gwhE-w2eW2z_LkKbE80hFvrMN+M@mail.gmail.com>

  Hi guys ,
              I am using RabbitMQ version 2.3 on server and in code I am
using java RabbitMQ client jar 2.3.1.

              The whole application is in Scala in which there are 10 actors
each has its own  Queue on RabbitMQ  Server.
               each Actor is accessing its Queue through its own methods
like get Message and addMessage.
               In Attachment I have  attached One sample code for Actor
methods .

               in every actor continuously checks for any Message in queue
like



   1.       def act {
   2.                this ! 1
   3.                 loop {
   4.                   react {
   5.                         case 1 =>
   processMessage(QueueManager.getMessage); this ! 1
   6.
   7.                          }
   8.                        }
   9.                       }


          this works fine ..But sometimes it gives me error like

 Exception in Creating Rabbit MQ Connection
java.net.ConnectException: Connection timed out
       at java.net.PlainSocketImpl.socketConnect(Native Method)
       at
java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:310)
       at
java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:176)
       at
java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:163)
       at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:384)
       at java.net.Socket.connect(Socket.java:546)
       at java.net.Socket.connect(Socket.java:495)
       at
com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:338)
       at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:376)
       at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:399)


    The server is running on its default port 5672. and actors are running
on same machine .
 the QueueManager is

object QueueManager {
  private val logger: Logger = Logger.getLogger(this.getClass.getName)
  private val FACTORY = RabbitMQConstants.getFactory

  private var conn: Connection = null
  private var channel: Channel = null

  /**
   * @return
   * com.prolinkd.actor.QueueObject
   * reads a Message from rabbitMQ Queue
   */
  def getMessage: QueueObject = synchronized{
    if (conn == null || (channel != null && (!channel.isOpen))) {
      getConnection
      if (conn == null) {
        return null
      }
    }
    var obj = new ConnectionObject
    try {
      val response = channel.basicGet(CONNECTION_QUEUE, false)
      if (response == null) return null
      val msg = new java.io.ObjectInputStream(
        new java.io.ByteArrayInputStream(response.getBody)).readObject()
      obj = msg.asInstanceOf[ConnectionObject]
      channel.basicAck(response.getEnvelope().getDeliveryTag(), false)
    } catch {
      case e: Exception => logger.error("error in Get Message", e);
//endConnection
    }
    //endConnection
    obj
  }


  /**
   * Get Connected with RabbitMQ Server
   */
  private def getConnection {
    try {
      conn = FACTORY.newConnection
      if (conn == null) {
        logger.info(" FAILED TO CREATE CONNECTION WITH RABBITMQ ON  " +
FACTORY.getHost + ":" + FACTORY.getPort)
      }
      channel = conn.createChannel
      if (channel == null) {
        logger.info(" FAILED TO CREATE CHANNEL WITH RABBITMQ ON  " +
FACTORY.getHost + ":" + FACTORY.getPort)
      }
      if (conn != null) {
        val durable = true
        channel.exchangeDeclare(CONNECTION_EXCHANGE, "direct", durable)
        channel.queueDeclare(CONNECTION_QUEUE, durable, false, false, null)
        channel queueBind (CONNECTION_QUEUE, CONNECTION_EXCHANGE,
CONNECTION_ROUTING_KEY)
      }
    } catch {
      case e: Exception => logger.error("Exception In Getting Connection to
RabbitMQ ", e)
    }

  }

}


we can't figure out the particular issue.can you guys  help us please

-- 
Regards,
Sagar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110224/085ee164/attachment-0001.htm>

From suranakamal at gmail.com  Fri Feb 25 00:05:16 2011
From: suranakamal at gmail.com (GMail)
Date: Fri, 25 Feb 2011 05:35:16 +0530
Subject: [rabbitmq-discuss] RabbitMQ - StackOverflowError
In-Reply-To: <4D662F83.7070903@rabbitmq.com>
References: <AANLkTi=ay-fFRZ84fv0xyBDBYgzwAEuM-EVNaUX7OF_W@mail.gmail.com>
	<4D662F83.7070903@rabbitmq.com>
Message-ID: <F582B376-4483-4789-821A-7E5A78DCD70B@gmail.com>

Using version 1.8.1. Trying to understand what could be the root cause. 

Saw one thing that lot of channels are being created but not closed. Can that be the reason?

On 24-Feb-2011, at 3:44 PM, Rob Harrop <rob at rabbitmq.com> wrote:

> Kamal,
> 
> Which client version are you using? Those line numbers don't correspond to what I have for 2.3.1. If you're not on 2.3.1 yet you should try upgrading.
> 
> Regards,
> 
> Rob
> 
> On 23/02/11 19:50, Kamal Surana wrote:
>> Hi
>> We are seeing following error in our code, after which the connection
>> is getting closed/corrupt. There are lof of channels being created on
>> the same connection. What could be possible reason for this error?
>> Exception in thread "AMQP Connection xxxxxx001:5672"
>> java.lang.StackOverflowError
>> at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:70)
>> at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
>> at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)
>> at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:86)
>> at com.rabbitmq.utility.IntAllocator.merge(IntAllocator.java:73)

From matthew at rabbitmq.com  Fri Feb 25 00:21:00 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 25 Feb 2011 00:21:00 +0000
Subject: [rabbitmq-discuss] RabbitMQ - StackOverflowError
In-Reply-To: <F582B376-4483-4789-821A-7E5A78DCD70B@gmail.com>
References: <AANLkTi=ay-fFRZ84fv0xyBDBYgzwAEuM-EVNaUX7OF_W@mail.gmail.com>
	<4D662F83.7070903@rabbitmq.com>
	<F582B376-4483-4789-821A-7E5A78DCD70B@gmail.com>
Message-ID: <20110225002059.GA6618@wellquite.org>

On Fri, Feb 25, 2011 at 05:35:16AM +0530, GMail wrote:
> Using version 1.8.1. Trying to understand what could be the root cause. 

The algorithm in use is recursive and seems to be exploding Java's
stack. We don't think there's anything functionally wrong with the
algorithm employed other than the fact it's recursive. It's currently
being rewritten to be less recursive.

> Saw one thing that lot of channels are being created but not closed. Can that be the reason?

We think it's likely to go wrong if the channel numbers are heavily
fragmented.

Matthew

From gmr at myyearbook.com  Fri Feb 25 03:02:37 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 24 Feb 2011 22:02:37 -0500
Subject: [rabbitmq-discuss] Announcing Vorpal Bunny 0.1
Message-ID: <AANLkTikmA9C2VM6JYqc67MaE28KOorvS9E=9-92y3a5t@mail.gmail.com>

Vorpal Bunny is an experimental rabbitmq-jsonrpc-channel PHP driver designed
to allow expedited single call HTTP delivery for Basic.Deliver calls to
RabbitMQ.

The goal is to be a light-weight tool for higher throughput with smaller
protocol overhead for single-call of Basic.Push per application execution.

Our use case is focused on PHP web applications that span hundreds of
servers with hundreds of backends each. With the existing AMQP drivers for
PHP, applications can not currently maintain consistent connections and
publish across application executions, instead they connect, publish and
disconnect.  Vorpal Bunny is intended to reduce the overhead on the RabbitMQ
server and the PHP application by using the jsonrpc-channel plugin, which
maintains its own channels per session inside RabbitMQ's running instance,
 eliminating most of the AMQP protocol overhead for one off message
delivery.

This is experimental for us and has not entered production, however I felt
it may be useful for those out there who are exploring the
rabbitmq-jsonrpc-channel plugin as well.

Example use:

 $vb = new VorpalBunny( 'localhost' );
 $vb->publish( "test_exchange", "test", "Hello World!" );


The design tries to employ PHP's APC cache if available to keep one session
with the RPC server active per Apache server on the RabbitMQ server.
Application flow is as follows:

  1. Construct object, determining of APC cache is available
  2. On first call of publish, establish a session with the
rabbitmq-jsonrpc-plugin, then send the message
  3. On subsequent calls, call publish will send without trying to establish
a session and then look for an error indicating the session has timed out or
is no longer available. If this is the case, re-establish the session and
retry the delivery.

Vorpal Bunny is available on GitHub at
https://github.com/myYearbook/VorpalBunny

You can also download 0.1 directly at
https://github.com/myYearbook/VorpalBunny/zipball/0.1

I will keep you all updated to our progress and observations to how well
this performs in a high delivery transaction environment.

Regards,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110224/4cfc24db/attachment.htm>

From gmr at myyearbook.com  Fri Feb 25 03:15:16 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 24 Feb 2011 22:15:16 -0500
Subject: [rabbitmq-discuss] Announcing Vorpal Bunny 0.1
In-Reply-To: <AANLkTikmA9C2VM6JYqc67MaE28KOorvS9E=9-92y3a5t@mail.gmail.com>
References: <AANLkTikmA9C2VM6JYqc67MaE28KOorvS9E=9-92y3a5t@mail.gmail.com>
Message-ID: <AANLkTim-iE6NxJciCZ_UzZJY3MnF1-awX3GoGyzrf=rq@mail.gmail.com>

Correction:

Vorpal Bunny is an experimental rabbitmq-jsonrpc-channel PHP driver designed
to allow expedited single call HTTP delivery for Basic.Publish calls to
RabbitMQ.

The goal is to be a light-weight tool for higher throughput with smaller
protocol overhead for single-call of Basic.Publish per application
execution.

On Thu, Feb 24, 2011 at 10:02 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

> Vorpal Bunny is an experimental rabbitmq-jsonrpc-channel PHP driver
> designed to allow expedited single call HTTP delivery for Basic.Deliver
> calls to RabbitMQ.
>
> The goal is to be a light-weight tool for higher throughput with smaller
> protocol overhead for single-call of Basic.Push per application execution.
>
> Our use case is focused on PHP web applications that span hundreds of
> servers with hundreds of backends each. With the existing AMQP drivers for
> PHP, applications can not currently maintain consistent connections and
> publish across application executions, instead they connect, publish and
> disconnect.  Vorpal Bunny is intended to reduce the overhead on the RabbitMQ
> server and the PHP application by using the jsonrpc-channel plugin, which
> maintains its own channels per session inside RabbitMQ's running instance,
>  eliminating most of the AMQP protocol overhead for one off message
> delivery.
>
> This is experimental for us and has not entered production, however I felt
> it may be useful for those out there who are exploring the
> rabbitmq-jsonrpc-channel plugin as well.
>
> Example use:
>
>  $vb = new VorpalBunny( 'localhost' );
>  $vb->publish( "test_exchange", "test", "Hello World!" );
>
>
> The design tries to employ PHP's APC cache if available to keep one session
> with the RPC server active per Apache server on the RabbitMQ server.
> Application flow is as follows:
>
>   1. Construct object, determining of APC cache is available
>   2. On first call of publish, establish a session with the
> rabbitmq-jsonrpc-plugin, then send the message
>   3. On subsequent calls, call publish will send without trying to
> establish a session and then look for an error indicating the session has
> timed out or is no longer available. If this is the case, re-establish the
> session and retry the delivery.
>
> Vorpal Bunny is available on GitHub at
> https://github.com/myYearbook/VorpalBunny
>
> You can also download 0.1 directly at
> https://github.com/myYearbook/VorpalBunny/zipball/0.1
>
> I will keep you all updated to our progress and observations to how well
> this performs in a high delivery transaction environment.
>
> Regards,
>
> Gavin
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110224/dd1803fc/attachment-0001.htm>

From rajat.vig at gmail.com  Fri Feb 25 04:55:03 2011
From: rajat.vig at gmail.com (Rajat Vig)
Date: Fri, 25 Feb 2011 04:55:03 +0000
Subject: [rabbitmq-discuss] How to have multiple consumers for a Queue
	in Ruby
In-Reply-To: <AANLkTi=SkN9sGhEyJWoTo-_jigGw=2jx_Xz_iQ3Aj6gG@mail.gmail.com>
References: <AANLkTi=73P5pd0-P7xeuxRHqouEzuytkNqOyGDaow6Ct@mail.gmail.com>
	<AANLkTinsTdpqb0+pmzc2gUu4oaDv+_+4rZ-xENBWwoeR@mail.gmail.com>
	<AANLkTi=V6xE958b7x52_nWHxeXO6wGEtZAKPmeo9Owwr@mail.gmail.com>
	<AANLkTi=SkN9sGhEyJWoTo-_jigGw=2jx_Xz_iQ3Aj6gG@mail.gmail.com>
Message-ID: <AANLkTinGE5dXDY8=sOuLkM3t-dEe-8tfPia7fhPwiLQf@mail.gmail.com>

Thanks for the ideas. I'll probably for now go with breaking down the logic
to consumers which need to be run once and consumers which could be many.
Threading inside the same consumer would be too troublesome and might not
get the same results.

We are using Ruby 1.9 but the GIL still exists.

-Rajat

2011/2/23 Jakub ??astn? <stastny at 101ideas.cz>

> Rajat,
>
> about the second example, why more instances should be a problem? Having
> more subscribers in the same process doesn't have much sense, in my opinion,
> since the reactor pattern doesn't block -> you don't have to wait -> you
> don't need to use threads for parallelisation. Threads can be an advantage,
> but I don't think it'll be a big difference. Plus Ruby has GIL which means
> threads are sort of useless anyway, well, especially if you use Ruby 1.8
> which still has green threads. I'd say if you want to go this route, use
> Kernel#fork, but then you have to be careful about consistency of state.
> Breaking logic down sounds like a much better & cleaner way to go in my
> opinion.
>
> Jakub
>
> http://www.flickr.com/photos/jakub-stastny
> http://twitter.com/botanicus
>
>
>
> 2011/2/23 Rajat Vig <rajat.vig at gmail.com>
>
> Thanks for the suggestions. I'd the same thing in mind about being able to
>> start multiple of those processes.
>>
>> There are 2 different kinds of consumers
>> 1. Get the message and write it to a database or send it out to someplace
>> else.
>> Parallelizing this would be easy. Controlling would be more of a problem
>> here but manageable.
>>
>> 2. There's one large consumer which accepts different kinds of messages.
>> Like start/stop/abandon a game (which are always singular) and messages
>> for the game itself which are many.
>> I don't want to run this one many times since it might just run into
>> conflicts (though I can't see many currently - it does impose a rigid
>> discipline in the code).
>> The alternative that I'm thinking here is to internally re-route by
>> (generated) random keys and have multiple subscribers in the same
>> process. Would that work fine?
>> It not, I think breaking it further to a consumer for all admin messages
>> and multiple consumers for the game plays would be the way forward but it'll
>> be a significant refactor.
>>
>> -Rajat
>>
>> 2011/2/22 Jakub ??astn? <stastny at 101ideas.cz>
>>
>> Hi Rajat, could you maybe provide some more info? In general I'd agree
>>> with Jim, although it depends, there are probably other solutions as well
>>> (like more queues -> more granular design of the app with more consumers).
>>>
>>> Jakub
>>>
>>> http://www.flickr.com/photos/jakub-stastny
>>> http://twitter.com/botanicus
>>>
>>>
>>>
>>> On 22 February 2011 17:43, Rajat Vig <rajat.vig at gmail.com> wrote:
>>>
>>>> Hi
>>>>
>>>> We've written an application using the amqp gem with RabbitMQ.
>>>> Currently the bottleneck we've run into is that if there are too many
>>>> message incoming then processing the queue takes long.
>>>> After reading some messages on the list, I think allowing multiple
>>>> consumers is the way forward.
>>>>
>>>> How do I do that? And are there any pitfalls/gotchas?
>>>>
>>>> -Rajat
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110225/d7f0b9ea/attachment.htm>

From sagar131 at gmail.com  Fri Feb 25 06:18:23 2011
From: sagar131 at gmail.com (sagar)
Date: Thu, 24 Feb 2011 22:18:23 -0800 (PST)
Subject: [rabbitmq-discuss] Exception in Creating Rabbit MQ Connection
Message-ID: <0b568d1a-92ed-400c-b912-89196fe84ef0@a11g2000pro.googlegroups.com>

 Hi guys ,
              I am using RabbitMQ version 2.3 on server and in code I
am using java RabbitMQ client jar 2.3.1.

              The whole application is in Scala in which there are 10
actors each has its own  Queue on RabbitMQ  Server.
               each Actor is accessing its Queue through its own
methods like get Message and addMessage.
               below I have  attached One sample code for Actor
methods in Queue Manger .

               in every actor continuously checks for any Message in
queue like


      def act {
               this ! 1
                loop {
                  react {
                        case 1 =>
processMessage(QueueManager.getMessage); this ! 1

                         }
                       }
                      }

          this works fine ..But sometimes it gives me error like

 Exception in Creating Rabbit MQ Connection
java.net.ConnectException: Connection timed out
       at java.net.PlainSocketImpl.socketConnect(Native Method)
       at
java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:
310)
       at
java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:
176)
       at
java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:
163)
       at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:384)
       at java.net.Socket.connect(Socket.java:546)
       at java.net.Socket.connect(Socket.java:495)
       at
com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:
338)
       at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:
376)
       at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:
399)


    The server is running on its default port 5672. and actors are
running on same machine .
 the QueueManager is


object QueueManager {
  private val logger: Logger = Logger.getLogger(this.getClass.getName)
  private val FACTORY = RabbitMQConstants.getFactory

  private var conn: Connection = null
  private var channel: Channel = null

  /**
   * @return
   * com.prolinkd.actor.QueueObject
   * reads a Message from rabbitMQ Queue
   */
  def getMessage: QueueObject = synchronized{
    if (conn == null || (channel != null && (!channel.isOpen))) {
      getConnection
      if (conn == null) {
        return null
      }
    }
    var obj = new ConnectionObject
    try {
      val response = channel.basicGet(CONNECTION_QUEUE, false)
      if (response == null) return null
      val msg = new java.io.ObjectInputStream(
        new
java.io.ByteArrayInputStream(response.getBody)).readObject()
      obj = msg.asInstanceOf[ConnectionObject]
      channel.basicAck(response.getEnvelope().getDeliveryTag(), false)
    } catch {
      case e: Exception => logger.error("error in Get Message", e); //
endConnection
    }
    //endConnection
    obj
  }


  /**
   * Get Connected with RabbitMQ Server
   */
  private def getConnection {
    try {
      conn = FACTORY.newConnection
      if (conn == null) {
        logger.info(" FAILED TO CREATE CONNECTION WITH RABBITMQ ON  "
+ FACTORY.getHost + ":" + FACTORY.getPort)
      }
      channel = conn.createChannel
      if (channel == null) {
        logger.info(" FAILED TO CREATE CHANNEL WITH RABBITMQ ON  " +
FACTORY.getHost + ":" + FACTORY.getPort)
      }
      if (conn != null) {
        val durable = true
        channel.exchangeDeclare(CONNECTION_EXCHANGE, "direct",
durable)
        channel.queueDeclare(CONNECTION_QUEUE, durable, false, false,
null)
        channel queueBind (CONNECTION_QUEUE, CONNECTION_EXCHANGE,
CONNECTION_ROUTING_KEY)
      }
    } catch {
      case e: Exception => logger.error("Exception In Getting
Connection to RabbitMQ ", e)
    }

  }

}


we can't figure out the particular issue.can you guys  help us please

From vishalsodani at gmail.com  Fri Feb 25 04:13:58 2011
From: vishalsodani at gmail.com (vishy)
Date: Thu, 24 Feb 2011 20:13:58 -0800 (PST)
Subject: [rabbitmq-discuss] How to do performance testing for large number
	of messages?
Message-ID: <0b3b35e7-a6d4-43a8-b0d4-e6a163ebe9e2@o39g2000prb.googlegroups.com>

Hi,

I have following setup-

I have various clients(dotnet application) who are sending messages to
RabbitMQ. We have a queue to which messages are forwarded. A consumer
reads from the queue, and forwards it to a SMS Gateway. The message is
sent using pysmpp library. Our goal is to be able to process 100000msg
\second. Can one queue handle so many messages? I also need some
guidance on how to go about testing and improving performance - what
parameters to look at etc?.

thanks

From emile at rabbitmq.com  Fri Feb 25 09:56:35 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 25 Feb 2011 09:56:35 +0000
Subject: [rabbitmq-discuss] Exception in Creating Rabbit MQ Connection
In-Reply-To: <0b568d1a-92ed-400c-b912-89196fe84ef0@a11g2000pro.googlegroups.com>
References: <0b568d1a-92ed-400c-b912-89196fe84ef0@a11g2000pro.googlegroups.com>
Message-ID: <4D677CD3.4090902@rabbitmq.com>

Hi sagar,

On 25/02/11 06:18, sagar wrote:
>   Hi guys ,
>                I am using RabbitMQ version 2.3 on server and in code I
> am using java RabbitMQ client jar 2.3.1.

The line numbers in you stacktrace indicate that you are using a client 
jar version 2.0.0 to 2.2.0. Can you try the same test with the version 
2.3.1 ? It you still see the same problem can you supply a minimal 
self-contained piece of code that triggers the bug?

Regards

Emile

From alfonso.pantoja at gmail.com  Fri Feb 25 10:57:25 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Fri, 25 Feb 2011 11:57:25 +0100
Subject: [rabbitmq-discuss] Error code 404 NOT_FOUND when declaring a queue
 in a clustered server (using .NET client)
Message-ID: <AANLkTin31yWLEqLWWaTFRqEKMNVvMxwL_PAq1-Ww=TW3@mail.gmail.com>

Hi,

Today I've got a code=404  NOT_FOUND  error when declaring a queue in a
clustered server.
We have 2 servers in that cluster. SERVER_1 and SERVER_2.
The message reported that the queue the consumer wanted to declare didn't
exist which hasn't too much sense...

The AMQP operation
was interrupted: AMQP close-reason, initiated by Peer, code=404,
text="NOT_FOUND - no queue  'alfonsoqueue' in vhost '/'"


SERVER_2 was offline and the .NET consumer tried to connect to SERVER1 (we
don't use the array of addresses feature, we point the consumer directly to
one single server).
The queues were created on server SERVER_1 and there were no queues in
 webadmin queue listing of SERVER_2.

By the way all our queues and exchanges are durable and the first thing the
consumer do is to a
channel.DeclareQueue(name=queue_name, durable=true)
In the source code I see this declaration is performed using nowait=false,
exclusive=false...

My
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110225/ef3f278c/attachment-0001.htm>

From alfonso.pantoja at gmail.com  Fri Feb 25 11:09:13 2011
From: alfonso.pantoja at gmail.com (Alfonso)
Date: Fri, 25 Feb 2011 03:09:13 -0800 (PST)
Subject: [rabbitmq-discuss] Error code 404 NOT_FOUND when declaring a
 queue in a clustered server (using .NET client)
In-Reply-To: <AANLkTin31yWLEqLWWaTFRqEKMNVvMxwL_PAq1-Ww=TW3@mail.gmail.com>
References: <AANLkTin31yWLEqLWWaTFRqEKMNVvMxwL_PAq1-Ww=TW3@mail.gmail.com>
Message-ID: <5c83e51a-ddff-4407-8c78-bc743a40294a@k38g2000vbn.googlegroups.com>

Continues from my previous post:

My question is:

Can you recommend me which is the best solution for consuming durable
queues in a clustered environment?

After the error SERVER_2 behavoir was strange. I created via consumer
another queue on it (a queue name didn't exist in SERVER_1 which
remained offline) and the queue were created but on the web admin all
its attributes were marked as "?" (Ready ?, Unacked ?, Total ?). I
also saw that sending a message had no effect on this as all
attributes continued being "?".

I hope someone could give me some advice on this.

Thank you in advance.

Regards,

Alfonso





From alexandru at rabbitmq.com  Fri Feb 25 11:17:00 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 25 Feb 2011 13:17:00 +0200
Subject: [rabbitmq-discuss] Error code 404 NOT_FOUND when declaring a
 queue in a clustered server (using .NET client)
In-Reply-To: <AANLkTin31yWLEqLWWaTFRqEKMNVvMxwL_PAq1-Ww=TW3@mail.gmail.com>
References: <AANLkTin31yWLEqLWWaTFRqEKMNVvMxwL_PAq1-Ww=TW3@mail.gmail.com>
Message-ID: <20110225111700.GF2332@dakota.eng.vmware.com>

Hi,

In a cluster, if a there's a durable queue on a down'ed node,
redeclaring that queue on another node will fail with NOT_FOUND.  The
only way to solve this is to bring back up the node holding the queue.

This seems to be what you're seeing, but you say all the queues were
declared on the online node.  Are you sure that's the case?

Does bringing the other node up solve the problem? 

Once up, can you delete the queue, redeclare it on SERVER_1, take down
SERVER_2 again and check if the problem still happens?

BTW, in the next message, you seem to have reversed SERVER_1 and
SERVER_2.

Cheers,
Alex

On Fri, Feb 25, 2011 at 11:57:25AM +0100, Alfonso Pantoja wrote:
> Hi,
> 
> Today I've got a code=404  NOT_FOUND  error when declaring a queue in a
> clustered server.
> We have 2 servers in that cluster. SERVER_1 and SERVER_2.
> The message reported that the queue the consumer wanted to declare didn't
> exist which hasn't too much sense...
> 
> The AMQP operation
> was interrupted: AMQP close-reason, initiated by Peer, code=404,
> text="NOT_FOUND - no queue  'alfonsoqueue' in vhost '/'"
> 
> 
> SERVER_2 was offline and the .NET consumer tried to connect to SERVER1 (we
> don't use the array of addresses feature, we point the consumer directly to
> one single server).
> The queues were created on server SERVER_1 and there were no queues in
>  webadmin queue listing of SERVER_2.
> 
> By the way all our queues and exchanges are durable and the first thing the
> consumer do is to a
> channel.DeclareQueue(name=queue_name, durable=true)
> In the source code I see this declaration is performed using nowait=false,
> exclusive=false...
> 
> My

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Fri Feb 25 11:46:03 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 25 Feb 2011 11:46:03 +0000
Subject: [rabbitmq-discuss] Problem after upgrading to 2.3.1
In-Reply-To: <AANLkTi=U6w_HaZYYGTD26P5QCWym90kN2amR_pzwN1c9@mail.gmail.com>
References: <AANLkTikXEW7N0rcmMrdKUuOa999qt871RNgC1NfdzMCo@mail.gmail.com>	<20110224143111.GG32147@rabbitmq.com>
	<AANLkTi=U6w_HaZYYGTD26P5QCWym90kN2amR_pzwN1c9@mail.gmail.com>
Message-ID: <4D67967B.1080103@rabbitmq.com>

On 24/02/11 15:48, mysurf mail wrote:
> What I basically see is that we start listening on the receiving
> app (subscriber)  as follows:
>
>              boolean durable = false;
>              final boolean mandatory = true;
>              final boolean immediate = true;
>              channel.exchangeDeclare(exchangeName, "direct", durable,
> mandatory, immediate, new HashMap<String, Object>());
>              channel.queueDeclare(queueName, durable);
>              channel.queueBind(queueName, exchangeName, routingKey);
>
>              boolean noAck = true;
>              queueingConsumer = new QueueingConsumer(channel);
>              channel.basicConsume(queueName, noAck, queueingConsumer);

So the client is consuming in noAck/autoAck mode, which means it *must 
not* basicAck the messages. The error

>      > reply-code=406,reply-text=PRECONDITION_FAILED - unknown delivery tag
>      > 1,class-id=60,method-id=80),null,""}

is most likely due it doing that.

Regards,

Matthias.

From emile at rabbitmq.com  Fri Feb 25 11:51:20 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 25 Feb 2011 11:51:20 +0000
Subject: [rabbitmq-discuss] Exception in Creating Rabbit MQ Connection
In-Reply-To: <4D677CD3.4090902@rabbitmq.com>
References: <0b568d1a-92ed-400c-b912-89196fe84ef0@a11g2000pro.googlegroups.com>
	<4D677CD3.4090902@rabbitmq.com>
Message-ID: <4D6797B8.5010009@rabbitmq.com>

Hi sagar,

On 25/02/11 09:56, Emile Joubert wrote:
> Hi sagar,
>
> On 25/02/11 06:18, sagar wrote:
>> Hi guys ,
>> I am using RabbitMQ version 2.3 on server and in code I
>> am using java RabbitMQ client jar 2.3.1.
>
> The line numbers in you stacktrace indicate that you are using a client
> jar version 2.0.0 to 2.2.0. Can you try the same test with the version
> 2.3.1 ? It you still see the same problem can you supply a minimal
> self-contained piece of code that triggers the bug?

Can you check whether the number of TCP connections to the broker 
remains steady or whether it grows? Your sample contains no code to 
close connections. Try "rabbitmqctl list_connections" on the broker or 
"netstat" on the client. If the number of connections rises as the test 
progresses then you may be running out of connections.


Regards

Emile


From bruce.bushby at gmail.com  Fri Feb 25 12:25:24 2011
From: bruce.bushby at gmail.com (bruce bushby)
Date: Fri, 25 Feb 2011 12:25:24 +0000
Subject: [rabbitmq-discuss] embedded rabbitmq-c client + openssl/openvpn
Message-ID: <AANLkTikF1p9JqKCFph9CJ_9oMrJEqWX1WN6CmkHK7J6p@mail.gmail.com>

Hi

I was wondering if any list members would share some setup tips about
configuring "rabbitmq-c client" with openssl/openvpn for secure
(certificate) encrypted message delivery?

I'm very new to Rabbit....spent the morning working through "hello world"
but ultimately need to focus on the C client which will run from an embedded
device. The device will be sending ascii text that has been compressed using
"bzip2"

I'm using Fedora 12 (client = 68f0c4b68086) &  Fedora 14 (server =
2.2.0-1.fc14)

I read:
http://www.rabbitmq.com/ssl.html

but it appears to focus on the server and java client....not that thats a
bad thing...just that I need to use the "C client"


Any help would be much appreciated!

Thanks
Bruce
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110225/7c3b30d7/attachment.htm>

From majek04 at gmail.com  Fri Feb 25 15:55:11 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 25 Feb 2011 15:55:11 +0000
Subject: [rabbitmq-discuss] How to do performance testing for large
 number of messages?
In-Reply-To: <0b3b35e7-a6d4-43a8-b0d4-e6a163ebe9e2@o39g2000prb.googlegroups.com>
References: <0b3b35e7-a6d4-43a8-b0d4-e6a163ebe9e2@o39g2000prb.googlegroups.com>
Message-ID: <AANLkTikJC=N0JMfMiPoa3nnDtjcVJBF-d8GAfh5oX3sy@mail.gmail.com>

On Fri, Feb 25, 2011 at 04:13, vishy <vishalsodani at gmail.com> wrote:
> I have various clients(dotnet application) who are sending messages to
> RabbitMQ. We have a queue to which messages are forwarded. A consumer
> reads from the queue, and forwards it to a SMS Gateway. The message is
> sent using pysmpp library.  Our goal is to be able to process 100000msg
> \second. Can one queue handle so many messages?

Take a look at 0MQ (zeromq).

> I also need some
> guidance on how to go about testing and improving performance - what
> parameters to look at etc?.

Benchmarking is generally hard, the only way to benchmark if your application
will be fast enough is to build the application and benchmark it end-to-end.
In most cases you're going to hit other bottlenecks before saturating Rabbit.

Cheers,
  Marek

From alexis at rabbitmq.com  Fri Feb 25 15:56:32 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 25 Feb 2011 15:56:32 +0000
Subject: [rabbitmq-discuss] How to do performance testing for large
 number of messages?
In-Reply-To: <AANLkTikJC=N0JMfMiPoa3nnDtjcVJBF-d8GAfh5oX3sy@mail.gmail.com>
References: <0b3b35e7-a6d4-43a8-b0d4-e6a163ebe9e2@o39g2000prb.googlegroups.com>
	<AANLkTikJC=N0JMfMiPoa3nnDtjcVJBF-d8GAfh5oX3sy@mail.gmail.com>
Message-ID: <AANLkTimD9xK4hC+VBnwM9K6tV1C+BzXgY7KCkuyh0x_9@mail.gmail.com>

Vishy

Why do you need just one queue for this?

alexis


On Fri, Feb 25, 2011 at 3:55 PM, Marek Majkowski <majek04 at gmail.com> wrote:
> On Fri, Feb 25, 2011 at 04:13, vishy <vishalsodani at gmail.com> wrote:
>> I have various clients(dotnet application) who are sending messages to
>> RabbitMQ. We have a queue to which messages are forwarded. A consumer
>> reads from the queue, and forwards it to a SMS Gateway. The message is
>> sent using pysmpp library. ?Our goal is to be able to process 100000msg
>> \second. Can one queue handle so many messages?
>
> Take a look at 0MQ (zeromq).
>
>> I also need some
>> guidance on how to go about testing and improving performance - what
>> parameters to look at etc?.
>
> Benchmarking is generally hard, the only way to benchmark if your application
> will be fast enough is to build the application and benchmark it end-to-end.
> In most cases you're going to hit other bottlenecks before saturating Rabbit.
>
> Cheers,
> ?Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From damien.jones at aclaro.com  Fri Feb 25 16:26:10 2011
From: damien.jones at aclaro.com (Damien Jones)
Date: Fri, 25 Feb 2011 09:26:10 -0700
Subject: [rabbitmq-discuss] 2.3.1 WCF Binding not honouring virtual host,
	username or password
Message-ID: <AANLkTin-ruDfqzXdWP5KwUOyfzuP3o5xTO=VcVUoPoTq@mail.gmail.com>

Hi all,

I configured the RabbitMQ server with a new user and a virtual host, and set
up my WCF bindings with the appropriate information.
Regardless my connections were always being set up for the default user and
vhost.
Debugging the RabbitMQ.ServiceModel it turned out that the ConnectionFactory
being used was missing the configuration settings, which I traced to the
private constructor of RabbitMQTransportBindingElement:

        private
RabbitMQTransportBindingElement(RabbitMQTransportBindingElement other)
            : this()
        {
            Broker = other.Broker;
            BrokerProtocol = other.BrokerProtocol;
        }

and resolved by adding initialization of the m_connectionFactory member:

        private
RabbitMQTransportBindingElement(RabbitMQTransportBindingElement other)
            : this()
        {
            m_connectionFactory.Password = other.ConnectionFactory.Password;
            m_connectionFactory.UserName = other.ConnectionFactory.UserName;
            m_connectionFactory.VirtualHost =
other.ConnectionFactory.VirtualHost;

            Broker = other.Broker;
            BrokerProtocol = other.BrokerProtocol;
        }

Is this a reasonable thing to do?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110225/d6f45d6a/attachment.htm>

From simon at rabbitmq.com  Fri Feb 25 18:19:29 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 25 Feb 2011 18:19:29 +0000
Subject: [rabbitmq-discuss] Error code 404 NOT_FOUND when declaring a
 queue in a clustered server (using .NET client)
In-Reply-To: <5c83e51a-ddff-4407-8c78-bc743a40294a@k38g2000vbn.googlegroups.com>
References: <AANLkTin31yWLEqLWWaTFRqEKMNVvMxwL_PAq1-Ww=TW3@mail.gmail.com>
	<5c83e51a-ddff-4407-8c78-bc743a40294a@k38g2000vbn.googlegroups.com>
Message-ID: <4D67F2B1.6090801@rabbitmq.com>

On 25/02/11 11:09, Alfonso wrote:
> After the error SERVER_2 behavoir was strange. I created via consumer
> another queue on it (a queue name didn't exist in SERVER_1 which
> remained offline) and the queue were created but on the web admin all
> its attributes were marked as "?" (Ready ?, Unacked ?, Total ?). I
> also saw that sending a message had no effect on this as all
> attributes continued being "?".

rabbitmq-management will show "?" for these items when it can't get 
information from its statistics database for them. This could be for one 
of several reasons:

* SERVER_2 does not have rabbitmq-management-agent installed
   - in which case all queues on that node will show "?"

* The management statistics database was located on the offline server
   - The stats database will come up on only one node in a cluster, that
     node will be one of the ones the full management plugin is
     installed on. If that node goes down you will lose statistics.

* The management statistics database was located on a server that was
   restarted while the rest of the cluster stayed up.
   - Unfortunately it doesn't deal well with that situation.

Note that the location of the stats database is displayed on the 
overview page.

Does one of these sound like it might be what happened?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From james.r.carr at gmail.com  Fri Feb 25 22:03:16 2011
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 25 Feb 2011 16:03:16 -0600
Subject: [rabbitmq-discuss] Generic AMQP Library?
Message-ID: <AANLkTi=sEF2O3cFJaCfbV6qAkrBc9ph6cfhCAZW5ZR8H@mail.gmail.com>

I know of the efforts of spring-amqp, but I'm curious if there is a
generic amqp client library for java available somewhere that just
strictly follows the protocol and as such is able to communicate with
any AMQP broker.

Thanks,
James

From alexis at rabbitmq.com  Fri Feb 25 22:24:49 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 25 Feb 2011 22:24:49 +0000
Subject: [rabbitmq-discuss] Generic AMQP Library?
In-Reply-To: <AANLkTi=sEF2O3cFJaCfbV6qAkrBc9ph6cfhCAZW5ZR8H@mail.gmail.com>
References: <AANLkTi=sEF2O3cFJaCfbV6qAkrBc9ph6cfhCAZW5ZR8H@mail.gmail.com>
Message-ID: <AANLkTin1G3cwwKvuYFZrmuXT9cJKdvoHABmF1NwMk0-3@mail.gmail.com>

James

Like this? http://www.rabbitmq.com/java-client.html

alexis


On Fri, Feb 25, 2011 at 10:03 PM, James Carr <james.r.carr at gmail.com> wrote:
> I know of the efforts of spring-amqp, but I'm curious if there is a
> generic amqp client library for java available somewhere that just
> strictly follows the protocol and as such is able to communicate with
> any AMQP broker.
>
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From moshima at advent.com  Fri Feb 25 23:38:15 2011
From: moshima at advent.com (Michi Oshima)
Date: Fri, 25 Feb 2011 15:38:15 -0800 (PST)
Subject: [rabbitmq-discuss] gen_event handler rabbit_error_logger
 crashed. Reason badarg
In-Reply-To: <4D26E040.4080207@rabbitmq.com>
References: <AANLkTikxzE04_yY=VyaYHw4dq_731hE_frZHgKBB+0ox@mail.gmail.com>
	<4D26E040.4080207@rabbitmq.com>
Message-ID: <31017300.post@talk.nabble.com>


Hi, 

I just got a similar error.  I'm wondering if this is something I should
worry about.

=ERROR REPORT==== 25-Feb-2011::22:27:15 ===
** gen_event handler rabbit_error_logger crashed.
** Was installed in error_logger
** Last event was: {info_msg,<0.112.0>,
                             {<0.139.0>,"Deleted vhost ~p~n",[<<"/">>]}}
** When handler state == {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>}
** Reason == {{badmatch,{error,not_found}},
              [{rabbit_error_logger,publish1,4},
               {rabbit_error_logger,handle_event,2},
               {gen_event,server_update,4},
               {gen_event,server_notify,4},
               {gen_event,handle_msg,5},
               {proc_lib,init_p_do_apply,3}]}

I'm using version 2.3.1:

# ./rabbitmqctl status
Status of node rabbit at loadtester ...
[{running_applications,[{rabbit,"RabbitMQ","2.3.1"},
                        {ssl,"Erlang/OTP SSL application","4.1.1"},
                        {public_key,"Public key infrastructure","0.10"},
                        {crypto,"CRYPTO version 2","2.0.2"},
                        {os_mon,"CPO  CXC 138 46","2.2.5"},
                        {sasl,"SASL  CXC 138 11","2.1.9.2"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.16"},
                        {stdlib,"ERTS  CXC 138 10","1.17.2"},
                        {kernel,"ERTS  CXC 138 10","2.14.2"}]},
 {nodes,[{disc,[rabbit at loadtester]}]},
 {running_nodes,[rabbit at loadtester]}]
...done.

I'm running this on CentOS 5.  Erlang version is R14B01.  I had to build
Erlang myself as I couldn't find a suitable RPM.  Above error apparently
happens when I delete the default virtual host, as a part of my setup.  I do
this through JInterface.

Hm.  Could it be that I should not be deleting the virtual host "/"?

Michi Oshima
-- 
View this message in context: http://old.nabble.com/gen_event-handler-rabbit_error_logger-crashed.-Reason-badarg-tp30593834p31017300.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From vertolet666 at yandex.ru  Sat Feb 26 08:12:04 2011
From: vertolet666 at yandex.ru (DOBRO)
Date: Sat, 26 Feb 2011 00:12:04 -0800 (PST)
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>
References: <30958766.post@talk.nabble.com> <4D604FD7.6030307@rabbitmq.com>
	<30989184.post@talk.nabble.com>
	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>
	<30990022.post@talk.nabble.com>
	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>
Message-ID: <31018690.post@talk.nabble.com>



Jerry Kuch wrote:
> 
> I think earlier in the thread we established that all of your
> consumers are consuming with noAck=true, so therefore everything
> should be getting ACK-ed as its consumed.  That would be consistent
> with what we're seeing here, since there are no messages being
> reported as unacknowledged by rabbitmqctl.  On the other hand, since a
> message has to be delivered before it can be ACK-ed, one would also
> think that the messages_ready (the second column from the right in
> your output) should also read zero.
> 
> Has, perhaps, one of your consumers died?  Or become busy and stopped
> consuming and acking from queue_name_2?
> 
> To investigate try:
> 
> rabbitmqctl list_consumers
> 

I've found out that for some queues the values of "messages" and
"messages_ready" become grow up in time.
Here is the selective output:

# rabbitmqctl list_queues name messages messages_ready
messages_unacknowledged
allplayers-11334-1298702053625  137     137     0

Trying this command every 10-20 seconds:

allplayers-11334-1298702053625  148     148     0
allplayers-11334-1298702053625  177     177     0
allplayers-11334-1298702053625  246     246     0


Listing consumers for that queue:
# rabbitmqctl list_consumers
allplayers-11334-1298702053625  <rabbit at chessvegas.3.30209.103>
allplayers-11334-1298702053625  false

Hmmm... the consumer is not died.

-- 
View this message in context: http://old.nabble.com/Losing-messages%2C-why--tp30958766p31018690.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From vertolet666 at yandex.ru  Sat Feb 26 10:32:41 2011
From: vertolet666 at yandex.ru (DOBRO)
Date: Sat, 26 Feb 2011 02:32:41 -0800 (PST)
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <31018690.post@talk.nabble.com>
References: <30958766.post@talk.nabble.com> <4D604FD7.6030307@rabbitmq.com>
	<30989184.post@talk.nabble.com>
	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>
	<30990022.post@talk.nabble.com>
	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>
	<31018690.post@talk.nabble.com>
Message-ID: <31019159.post@talk.nabble.com>


Now I understand why messages_ready in some queues grow up in time.
That's because of connection was closed not properly.

Actually, these queues disappear later.



-- 
View this message in context: http://old.nabble.com/Losing-messages%2C-why--tp30958766p31019159.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthew at rabbitmq.com  Sat Feb 26 11:05:30 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 26 Feb 2011 11:05:30 +0000
Subject: [rabbitmq-discuss] gen_event handler rabbit_error_logger
 crashed. Reason badarg
In-Reply-To: <31017300.post@talk.nabble.com>
References: <AANLkTikxzE04_yY=VyaYHw4dq_731hE_frZHgKBB+0ox@mail.gmail.com>
	<4D26E040.4080207@rabbitmq.com> <31017300.post@talk.nabble.com>
Message-ID: <20110226110529.GA26515@wellquite.org>

On Fri, Feb 25, 2011 at 03:38:15PM -0800, Michi Oshima wrote:
> Hm.  Could it be that I should not be deleting the virtual host "/"?

Well you can, and it's not a disaster if you do, however, we should
certainly make it not explode.

One thing you could do is to change the default_vhost in your
rabbitmq.config to a vhost that's not going to be deleted. Maybe create
a vhost specifically for the log msgs? You'll likely have to create
that, then reconfigure rabbit then start it again. Your rabbitmq.config
should contain a {default_vhost, <<"my-vhost">>} entry, so the simplest
form would be:

[{rabbit, [{default_vhost, <<"my-vhost">>}]}].

Note you'll have to make sure "my-vhost" exists yourself - Rabbit will
always create the default_vhost itself if it's starting from an empty
database (e.g. fresh install). After that, it'll just assume the default
vhost exists.

Best wishes,

Matthew

From vertolet666 at yandex.ru  Sat Feb 26 15:57:05 2011
From: vertolet666 at yandex.ru (DOBRO)
Date: Sat, 26 Feb 2011 07:57:05 -0800 (PST)
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <4D64CC2A.6010606@rabbitmq.com>
References: <30958766.post@talk.nabble.com> <4D604FD7.6030307@rabbitmq.com>
	<30989184.post@talk.nabble.com>
	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>
	<30990022.post@talk.nabble.com>
	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>
	<30992886.post@talk.nabble.com> <4D64CC2A.6010606@rabbitmq.com>
Message-ID: <31020537.post@talk.nabble.com>



Matthias Radestock-3 wrote:
> 
> Could you post the output of 
> list_{exchanges,queues,bindings,consumers,connections,channels} *when 
> the system is in that state*, i.e. when Client3 has stopped receiving 
> messages from board-queue-2?
> 
I've run into the issue today. As I previously said, several workers are
running on the server side and one of them (or two, or three....) stops to
receive messages. I don't know how many workers don't receive messages, but
not all of them because some messages are received.
Each worker declares its own queue with the keyword "daemon".

Here is the output for the those queues.

All the exchanges, at first:
# rabbitmqctl list_exchanges
Listing exchanges ...
amq.direct      direct
amq.topic       topic
players.fanout  fanout
board.direct    direct
amq.rabbitmq.log        topic
chess.direct    direct
amq.fanout      fanout
control.direct  direct
boardchat.direct        direct
amq.headers     headers
player.direct   direct
        direct
amq.match       headers
...done.


# rabbitmqctl list_queues name messages messages_ready
messages_unacknowledged |grep daemon
daemon-8698-1298682602  0       0       0
daemon-8711-1298682602  0       0       0
daemon-8700-1298682602  0       0       0
daemon-8699-1298682602  0       0       0
daemon-8704-1298682602  0       0       0
daemon-8710-1298682602  0       0       0
daemon-8706-1298682602  0       0       0
daemon-8702-1298682602  0       0       0
daemon-8701-1298682602  0       0       0
daemon-8707-1298682602  0       0       0


# rabbitmqctl list_bindings |grep daemon
        exchange        daemon-8698-1298682602  queue  
daemon-8698-1298682602  []
        exchange        daemon-8699-1298682602  queue  
daemon-8699-1298682602  []
        exchange        daemon-8700-1298682602  queue  
daemon-8700-1298682602  []
        exchange        daemon-8701-1298682602  queue  
daemon-8701-1298682602  []
        exchange        daemon-8702-1298682602  queue  
daemon-8702-1298682602  []
        exchange        daemon-8704-1298682602  queue  
daemon-8704-1298682602  []
        exchange        daemon-8706-1298682602  queue  
daemon-8706-1298682602  []
        exchange        daemon-8707-1298682602  queue  
daemon-8707-1298682602  []
        exchange        daemon-8710-1298682602  queue  
daemon-8710-1298682602  []
        exchange        daemon-8711-1298682602  queue  
daemon-8711-1298682602  []
chess.direct    exchange        daemon-8698-1298682602  queue   chess1  []
chess.direct    exchange        daemon-8699-1298682602  queue   chess2  []
chess.direct    exchange        daemon-8700-1298682602  queue   chess3  []
chess.direct    exchange        daemon-8701-1298682602  queue   chess4  []
chess.direct    exchange        daemon-8702-1298682602  queue   chess5  []
chess.direct    exchange        daemon-8704-1298682602  queue   chess6  []
control.direct  exchange        daemon-8706-1298682602  queue   control1       
[]
control.direct  exchange        daemon-8707-1298682602  queue   control2       
[]
control.direct  exchange        daemon-8710-1298682602  queue   control3       
[]
control.direct  exchange        daemon-8711-1298682602  queue   control4       
[]


# rabbitmqctl list_consumers |grep daemon
daemon-8698-1298682602  <rabbit at chessvegas.3.16847.98> 
amq.ctag-mGzA8h3PQX9SYqfHsTbFoQ==       false
daemon-8711-1298682602  <rabbit at chessvegas.3.16879.98> 
amq.ctag-LeWFV1gcOLF4iB4i1xldiw==       false
daemon-8700-1298682602  <rabbit at chessvegas.3.16855.98> 
amq.ctag-ab4d0pzQk+ETs/8wff8l2A==       false
daemon-8699-1298682602  <rabbit at chessvegas.3.16843.98> 
amq.ctag-IUAIdFG0yFgZTHfpqhCflQ==       false
daemon-8704-1298682602  <rabbit at chessvegas.3.16863.98> 
amq.ctag-6GHV7K92ftrn52KP0cyCoQ==       false
daemon-8710-1298682602  <rabbit at chessvegas.3.16875.98> 
amq.ctag-6OEY3JjW/BRUxGSLb6Q/4w==       false
daemon-8706-1298682602  <rabbit at chessvegas.3.16867.98> 
amq.ctag-4Y7OlCKjwehWUOUbVqzuSg==       false
daemon-8702-1298682602  <rabbit at chessvegas.3.16859.98> 
amq.ctag-GdhhfvkdAE+5y71Zvw5TDw==       false
daemon-8701-1298682602  <rabbit at chessvegas.3.16850.98> 
amq.ctag-ydVIFHR1x9SmRnbIFKOFtA==       false
daemon-8707-1298682602  <rabbit at chessvegas.3.16871.98> 
amq.ctag-kIUon3Gm/FfbOQItUtjo8Q==       false


# rabbitmqctl list_connections | grep 127.0.0.1
guest   127.0.0.1       52880   running
guest   127.0.0.1       40492   running
guest   127.0.0.1       41502   running
guest   127.0.0.1       58173   running
guest   127.0.0.1       58174   running
guest   127.0.0.1       44878   running
guest   127.0.0.1       58176   running
guest   127.0.0.1       58178   running
guest   127.0.0.1       58180   running
guest   127.0.0.1       58182   running
guest   127.0.0.1       58184   running
guest   127.0.0.1       58186   running
guest   127.0.0.1       58188   running
guest   127.0.0.1       58190   running


# rabbitmqctl list_channels
<rabbit at chessvegas.3.16847.98>  guest   false   1       0
<rabbit at chessvegas.3.16879.98>  guest   false   1       0
<rabbit at chessvegas.3.16855.98>  guest   false   1       0
<rabbit at chessvegas.3.16843.98>  guest   false   1       0
<rabbit at chessvegas.3.16863.98>  guest   false   1       0
<rabbit at chessvegas.3.16875.98>  guest   false   1       0
<rabbit at chessvegas.3.16867.98>  guest   false   1       0
<rabbit at chessvegas.3.16859.98>  guest   false   1       0
<rabbit at chessvegas.3.16850.98>  guest   false   1       0
<rabbit at chessvegas.3.16871.98>  guest   false   1       0

Thank you for support.

-- 
View this message in context: http://old.nabble.com/Losing-messages%2C-why--tp30958766p31020537.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From stammailbox at gmail.com  Sun Feb 27 09:54:49 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Sun, 27 Feb 2011 11:54:49 +0200
Subject: [rabbitmq-discuss] Problem after upgrading to 2.3.1
In-Reply-To: <4D67967B.1080103@rabbitmq.com>
References: <AANLkTikXEW7N0rcmMrdKUuOa999qt871RNgC1NfdzMCo@mail.gmail.com>
	<20110224143111.GG32147@rabbitmq.com>
	<AANLkTi=U6w_HaZYYGTD26P5QCWym90kN2amR_pzwN1c9@mail.gmail.com>
	<4D67967B.1080103@rabbitmq.com>
Message-ID: <AANLkTim7TrJ3L4Gh1fzfK5fFUtMhwn6UJO1hdgB9ze25@mail.gmail.com>

well , thank you for your quick response.
Well, it seemed fine when I tried to do it all in my local computer (two
apps and rabbit)
but when I upgraded the clients in the production environment (whoops) the
clients threw the following exception:
(side note: I did not change any property (socket,port etc ) in the client
side. so i am guessing firewall is not an option because everything worked
with the former version of rabbit - 1.7.0.  )

com.rabbitmq.client.ShutdownSignalException: connection error; reason:
java.net.SocketException: Connection reset
at com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:588)
at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:454)
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error;
reason: java.net.SocketException: Connection reset
... 2 more
Caused by: java.net.SocketException: Connection reset
at java.net.SocketInputStream.read(Unknown Source)
at java.io.BufferedInputStream.fill(Unknown Source)
at java.io.BufferedInputStream.read(Unknown Source)
at java.io.DataInputStream.readUnsignedByte(Unknown Source)
at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:117)
at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:151)
at com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:379)
at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:420)

Thank you

On Fri, Feb 25, 2011 at 1:46 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 24/02/11 15:48, mysurf mail wrote:
>
>> What I basically see is that we start listening on the receiving
>> app (subscriber)  as follows:
>>
>>             boolean durable = false;
>>             final boolean mandatory = true;
>>             final boolean immediate = true;
>>             channel.exchangeDeclare(exchangeName, "direct", durable,
>> mandatory, immediate, new HashMap<String, Object>());
>>             channel.queueDeclare(queueName, durable);
>>             channel.queueBind(queueName, exchangeName, routingKey);
>>
>>             boolean noAck = true;
>>             queueingConsumer = new QueueingConsumer(channel);
>>             channel.basicConsume(queueName, noAck, queueingConsumer);
>>
>
> So the client is consuming in noAck/autoAck mode, which means it *must not*
> basicAck the messages. The error
>
>
>      > reply-code=406,reply-text=PRECONDITION_FAILED - unknown delivery tag
>>     > 1,class-id=60,method-id=80),null,""}
>>
>
> is most likely due it doing that.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110227/b224c0d2/attachment.htm>

From imransaadi at gmail.com  Sat Feb 26 03:18:01 2011
From: imransaadi at gmail.com (P120D1GY)
Date: Fri, 25 Feb 2011 19:18:01 -0800 (PST)
Subject: [rabbitmq-discuss] Missing erlang functions?
In-Reply-To: <AANLkTik++JPKzp96xUgChx63A0RqDYgvYwnB+Uk6VQ0i@mail.gmail.com>
References: <AANLkTin6hHAL0W-PEv3=abrSyeKoQ_RYbZ7TYqyBjJvQ@mail.gmail.com>
	<88C3727C-AACA-4121-B2CC-E36467BD8D9A@vmware.com>
	<AANLkTimGLEks-V24ZZTNCSuHcGRFQivrpUc3UjdPiTys@mail.gmail.com>
	<AANLkTik++JPKzp96xUgChx63A0RqDYgvYwnB+Uk6VQ0i@mail.gmail.com>
Message-ID: <3df0478c-9298-4366-a629-d0a9a354cdca@q40g2000prh.googlegroups.com>

If you're using MacPorts, you need to install erlang with SSL via the
following command:
sudo port sync
sudo port install erlang +ssl

Source: http://wiki.basho.com/Installing-Erlang.html

Hopefully this helps someone :-)

On Jan 21, 6:34?pm, Meredith Gregory <lgreg.mered... at gmail.com> wrote:
> Dear Jerry,
>
> Thanks for the tip -- i see i was being dense before and you were referring
> to the erlang port.
>
> Best wishes,
>
> --greg
>
> On Fri, Jan 21, 2011 at 5:55 PM, Meredith Gregory
> <lgreg.mered... at gmail.com>wrote:
>
>
>
>
>
>
>
>
>
> > Dear Jerry,
>
> > Is the port now called something else?
>
> > bash-3.2$ sudo port variants rabbitmq-server
> > Password:
> > rabbitmq-server has no variants
> > bash-3.2$
>
> > Best wishes,
>
> > --greg
>
> > On Fri, Jan 21, 2011 at 5:51 PM, Jerry Kuch <jer... at vmware.com> wrote:
>
> >> Hi, Greg... ?Did you install using Darwin ports on a Mac by any chance?
> >> ?You'll want to use the '+ssl' port variant if so...
>
> >> Jerry
>
> >> On Jan 21, 2011, at 5:45 PM, Meredith Gregory wrote:
>
> >> > Dear Rabbitters,
>
> >> > Out of the blue my rabbitmq installation has started complaining about
> >> missing erlang functions. i tried updating both the erlang and the rabbit
> >> installations. i'm still getting the same complaint. i suspect this has
> >> something to do with RabbitMQ now throwing an exception in a code stack that
> >> was working. Any clues?
>
> >> > Best wishes,
>
> >> > --greg
>
> >> > bash-3.2$ sudo rabbitmq-server
> >> > Activating RabbitMQ plugins ...
> >> > *WARNING* Undefined function crypto:des3_cbc_decrypt/5
> >> > *WARNING* Undefined function crypto:start/0
> >> > *WARNING* Undefined function ssl:close/1
> >> > *WARNING* Undefined function ssl:controlling_process/2
> >> > *WARNING* Undefined function ssl:peercert/1
> >> > *WARNING* Undefined function ssl:peername/1
> >> > *WARNING* Undefined function ssl:recv/3
> >> > *WARNING* Undefined function ssl:send/2
> >> > *WARNING* Undefined function ssl:sockname/1
> >> > *WARNING* Undefined function ssl:ssl_accept/3
> >> > 0 plugins activated:
>
> >> > +---+ ? +---+
> >> > | ? | ? | ? |
> >> > | ? | ? | ? |
> >> > | ? | ? | ? |
> >> > | ? +---+ ? +-------+
> >> > | ? ? ? ? ? ? ? ? ? |
> >> > | RabbitMQ ?+---+ ? |
> >> > | ? ? ? ? ? | ? | ? |
> >> > | ? v2.2.0 ?+---+ ? |
> >> > | ? ? ? ? ? ? ? ? ? |
> >> > +-------------------+
> >> > AMQP 0-9-1 / 0-9 / 0-8
> >> > Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies
> >> LLC., and Rabbit Technologies Ltd.
> >> > Licensed under the MPL. ?Seehttp://www.rabbitmq.com/
>
> >> > node ? ? ? ? ? : rabbit at BiosimiMac1-2
> >> > app descriptor :
> >> /Users/lgm/work/src/devtools/rabbit/rabbitmq_server-2.2.0/sbin/../ebin/rabb it.app
> >> > home dir ? ? ? : /Users/lgm
> >> > cookie hash ? ?: 7vyF5kbCgbq9jjMP2sUa3w==
> >> > log ? ? ? ? ? ?: /var/log/rabbitmq/rab... at BiosimiMac1-2.log
> >> > sasl log ? ? ? : /var/log/rabbitmq/rab... at BiosimiMac1-2-sasl.log
> >> > database dir ? : /var/lib/rabbitmq/mnesia/rabbit at BiosimiMac1-2
> >> > erlang version : 5.8.2
>
> >> > starting file handle cache server
> >> ...done
> >> > starting worker pool
> >> ?...done
> >> > starting database
> >> ...done
> >> > starting codec correctness check
> >> ?...done
> >> > -- external infrastructure ready
> >> > starting statistics event manager
> >> ...done
> >> > starting logging server
> >> ...done
> >> > starting exchange type registry
> >> ...done
> >> > starting exchange type direct
> >> ...done
> >> > starting exchange type fanout
> >> ...done
> >> > starting exchange type headers
> >> ?...done
> >> > starting exchange type topic
> >> ?...done
> >> > -- kernel ready
> >> > starting alarm handler
> >> ?...done
> >> > starting node monitor
> >> ...done
> >> > starting cluster delegate
> >> ...done
> >> > starting guid generator
> >> ...done
> >> > starting memory monitor
> >> ...done
> >> > -- core initialized
> >> > starting empty DB check
> >> ...done
> >> > starting exchange recovery
> >> ?...done
> >> > starting queue supervisor and queue recovery
> >> ?...done
> >> > -- message delivery logic ready
> >> > starting error log relay
> >> ?...done
> >> > starting networking
> >> ...done
> >> > -- network listeners available
>
> >> > broker running
>
> >> > --
> >> > L.G. Meredith
> >> > Managing Partner
> >> > Biosimilarity LLC
> >> > 7329 39th Ave SW
> >> > Seattle, WA 98136
>
> >> > +1 206.650.3740
>
> >> >http://biosimilarity.blogspot.com
>
> >> > <ATT00001..txt>
>
> > --
> > L.G. Meredith
> > Managing Partner
> > Biosimilarity LLC
> > 7329 39th Ave SW
> > Seattle, WA 98136
>
> > +1 206.650.3740
>
> >http://biosimilarity.blogspot.com
>
> --
> L.G. Meredith
> Managing Partner
> Biosimilarity LLC
> 7329 39th Ave SW
> Seattle, WA 98136
>
> +1 206.650.3740
>
> http://biosimilarity.blogspot.com
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Sun Feb 27 10:40:32 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 27 Feb 2011 10:40:32 +0000
Subject: [rabbitmq-discuss] Problem after upgrading to 2.3.1
In-Reply-To: <AANLkTim7TrJ3L4Gh1fzfK5fFUtMhwn6UJO1hdgB9ze25@mail.gmail.com>
References: <AANLkTikXEW7N0rcmMrdKUuOa999qt871RNgC1NfdzMCo@mail.gmail.com>
	<20110224143111.GG32147@rabbitmq.com>
	<AANLkTi=U6w_HaZYYGTD26P5QCWym90kN2amR_pzwN1c9@mail.gmail.com>
	<4D67967B.1080103@rabbitmq.com>
	<AANLkTim7TrJ3L4Gh1fzfK5fFUtMhwn6UJO1hdgB9ze25@mail.gmail.com>
Message-ID: <20110227104032.GA16174@wellquite.org>

On Sun, Feb 27, 2011 at 11:54:49AM +0200, mysurf mail wrote:
> Well, it seemed fine when I tried to do it all in my local computer (two
> apps and rabbit)
> but when I upgraded the clients in the production environment (whoops) the
> clients threw the following exception:
> (side note: I did not change any property (socket,port etc ) in the client
> side. so i am guessing firewall is not an option because everything worked
> with the former version of rabbit - 1.7.0.  )

This is likely a dumb question, but could you just confirm whether or
not you upgraded the server at the same time? Client versions >= 2.0.0
will not talk (normally - the .Net client can be made to) happily to
versions of the broker < 2.0.0.

Matthew

From stammailbox at gmail.com  Sun Feb 27 11:06:41 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Sun, 27 Feb 2011 13:06:41 +0200
Subject: [rabbitmq-discuss] Problem after upgrading to 2.3.1
In-Reply-To: <20110227104032.GA16174@wellquite.org>
References: <AANLkTikXEW7N0rcmMrdKUuOa999qt871RNgC1NfdzMCo@mail.gmail.com>
	<20110224143111.GG32147@rabbitmq.com>
	<AANLkTi=U6w_HaZYYGTD26P5QCWym90kN2amR_pzwN1c9@mail.gmail.com>
	<4D67967B.1080103@rabbitmq.com>
	<AANLkTim7TrJ3L4Gh1fzfK5fFUtMhwn6UJO1hdgB9ze25@mail.gmail.com>
	<20110227104032.GA16174@wellquite.org>
Message-ID: <AANLkTi=DnNatY=UJFroYA_tRho41Czi6Xe+PFLDrkVPC@mail.gmail.com>

Well, its ok to ask dumb questions, I am afraid I did something dumb and
didnt find it out yet...

Anyway, yes I did.
I upgraded the server, upgraded the two application (java apps).
(BTW - in the clients server there is no erlang. erlan is installed only in
the rabbitMQ server only )
when I put all the exe's (using exe4j for java )  in my dev computer -
everthing works as designed.
I copy one exe to the production server and I get the SocketExceptio out of
com.rabbitmq.client.impl.Frame.readFrom.

should I install erlang in the clients server also?

everuthing works great with 1.7.0 and no new port or IP was added (So it is
not firewall)

On Sun, Feb 27, 2011 at 12:40 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Sun, Feb 27, 2011 at 11:54:49AM +0200, mysurf mail wrote:
> > Well, it seemed fine when I tried to do it all in my local computer (two
> > apps and rabbit)
> > but when I upgraded the clients in the production environment (whoops)
> the
> > clients threw the following exception:
> > (side note: I did not change any property (socket,port etc ) in the
> client
> > side. so i am guessing firewall is not an option because everything
> worked
> > with the former version of rabbit - 1.7.0.  )
>
> This is likely a dumb question, but could you just confirm whether or
> not you upgraded the server at the same time? Client versions >= 2.0.0
> will not talk (normally - the .Net client can be made to) happily to
> versions of the broker < 2.0.0.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110227/ee4208c7/attachment.htm>

From stammailbox at gmail.com  Sun Feb 27 13:06:58 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Sun, 27 Feb 2011 15:06:58 +0200
Subject: [rabbitmq-discuss] socket error while using rabbitmq and a NAT
	(Network address translation)
Message-ID: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>

Hi ,
I am writing a new mail because my last issue was solved .
It is just that on a certain computer my application stopped working.
So it is a new issue and I will explain and paste the exception below.

Basically, I did three things :
1. I upgraded from 1.7.0 to 2.3.1 (installed a new erlang also)
2. I upgraded the client jars
3. changed the protocol to ack = true;

channel.basicConsume(queueName, true, queueingConsumer);

well, that certain computer is behind a firewall, and has a NAT (Network
Address Translation ).
It did work prior to the upgrade with the NAT (mySQL also handles it pretty
well).
with the same ports.
Maybe it is the bidirectional channel (since I added acking? I dont think
so...).

what I can see is that.
when the client tries to connect it writes in the logs

Connection closed abruptly

And now, behold, the exception :

PlatformException: com.rabbitmq.client.ShutdownSignalException:
connection error; reason: java.net.SocketException: Connection reset
	at com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:588)
	at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:454)
Caused by: com.rabbitmq.client.ShutdownSignalException: connection
error; reason: java.net.SocketException: Connection reset
	... 2 more
Caused by: java.net.SocketException: Connection reset
	at java.net.SocketInputStream.read(Unknown Source)
	at java.io.BufferedInputStream.fill(Unknown Source)
	at java.io.BufferedInputStream.read(Unknown Source)
	at java.io.DataInputStream.readUnsignedByte(Unknown Source)
	at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:117)
	at com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:151)
	at com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:379)
	at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:420)
11:21:41,187 WARN  SoundUtil - Error in playing sound : emergency
com.google.common.collect.ComputationException:
com.barak.capital.model.exception.PlatformException: Error loading
sound : emergency.wav, from file.
	at com.google.common.collect.MapMaker$StrategyImpl.compute(MapMaker.java:602)
	at com.google.common.collect.MapMaker$StrategyImpl.compute(MapMaker.java:462)
	at com.google.common.collect.CustomConcurrentHashMap$ComputingImpl.get(CustomConcurrentHashMap.java:2045)
	at com.programa17.mmm.utils.SoundUtil$2.call(SoundUtil.java:115)
	at java.util.concurrent.FutureTask$Sync.innerRun(Unknown Source)
	at java.util.concurrent.FutureTask.run(Unknown Source)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
	at java.lang.Thread.run(Unknown Source)
Caused by: com.barak.capital.model.exception.PlatformException: Error
loading sound : emergency.wav, from file.
	at com.programa17.mmm.utils.SoundUtil$1.apply(SoundUtil.java:97)
	at com.programa17.mmm.utils.SoundUtil$1.apply(SoundUtil.java:77)
	at com.google.common.collect.MapMaker$StrategyImpl.compute(MapMaker.java:592)
	... 8 more
Caused by: java.io.FileNotFoundException: emergency.wav (The system
cannot find the file specified)
	at java.io.FileInputStream.open(Native Method)
	at java.io.FileInputStream.<init>(Unknown Source)
	at com.sun.media.sound.WaveFileReader.getAudioInputStream(Unknown Source)
	at javax.sound.sampled.AudioSystem.getAudioInputStream(Unknown Source)
	at com.programa17.mmm.utils.SoundUtil$1.apply(SoundUtil.java:81)
	... 10 more
11:21:41,187 ERROR CentralExceptionHandler - central exception handler
: warning found :

Any Idea? thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110227/65d813e4/attachment.htm>

From adamka at dgt.com.pl  Sun Feb 27 19:30:21 2011
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Sun, 27 Feb 2011 20:30:21 +0100
Subject: [rabbitmq-discuss] Message properties
In-Reply-To: <AANLkTin-ruDfqzXdWP5KwUOyfzuP3o5xTO=VcVUoPoTq@mail.gmail.com>
References: <AANLkTin-ruDfqzXdWP5KwUOyfzuP3o5xTO=VcVUoPoTq@mail.gmail.com>
Message-ID: <4D6AA64D.3000602@dgt.com.pl>

Hi,

Can somebody explain me some message properties(meaning and effect):


    *

      AppId

    *

      ClusterId

    *

      ContentEncoding

    *

      ContentType

      CorrelationId

    *

      Headers

    *

      MessageId

    *

      ReplyTo

    *

      ReplyToAddress

    *

      Timestamp

    *

      Type

    *

      UserId



Regards,
Adam

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110227/ca54ee42/attachment.htm>

From matthias at rabbitmq.com  Sun Feb 27 19:52:58 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 27 Feb 2011 19:52:58 +0000
Subject: [rabbitmq-discuss] Message properties
In-Reply-To: <4D6AA64D.3000602@dgt.com.pl>
References: <AANLkTin-ruDfqzXdWP5KwUOyfzuP3o5xTO=VcVUoPoTq@mail.gmail.com>
	<4D6AA64D.3000602@dgt.com.pl>
Message-ID: <4D6AAB9A.7040804@rabbitmq.com>

Adam,

Adam Kaminiecki wrote:
> Can somebody explain me some message properties(meaning and effect):

See the AMQP spec, e.g. the field list as described in 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.basic

Applications can generally use these in any way they like; Rabbit only 
pays attention to the delivery-mode and user-id fields (see 
http://www.rabbitmq.com/extensions.html#validated-user-id for the latter).

Regards,

Matthias.

From nickolay.vinogradov at gmail.com  Sun Feb 27 23:37:34 2011
From: nickolay.vinogradov at gmail.com (Nickolay VInogradov)
Date: Sun, 27 Feb 2011 15:37:34 -0800 (PST)
Subject: [rabbitmq-discuss] There are no messages in the msg_store_persistent
Message-ID: <b15fcf3c-cbe0-4a4e-99e3-f2592010f783@u3g2000vbe.googlegroups.com>

Hello,

Server 2.3.1.
Client - Perl, Net::RabbitMQ.

# rabbitmqctl list_queues
Listing queues ...
smtp_feed       0
mail_feed       206034
lenta_feed      0
...done.

But there are no messages in the persistent directory:
# ls -l /var/lib/rabbitmq/mnesia/rabbit\@memcached2/
msg_store_persistent/
total 0
-rw-r--r-- 1 root root 0 Feb 22 23:41 0.rdq

# du -hs /var/lib/rabbitmq/mnesia/rabbit\@memcached2/
120K    /var/lib/rabbitmq/mnesia/rabbit at memcached2/

What happens with messages? Where they are stored???

From matthias at rabbitmq.com  Mon Feb 28 07:40:45 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Feb 2011 07:40:45 +0000
Subject: [rabbitmq-discuss] Message properties
In-Reply-To: <AANLkTint-8A5D_OjVT5pjLaROytjicnaKdATmwSp0DcB@mail.gmail.com>
References: <AANLkTin-ruDfqzXdWP5KwUOyfzuP3o5xTO=VcVUoPoTq@mail.gmail.com>	<4D6AA64D.3000602@dgt.com.pl>	<4D6AAB9A.7040804@rabbitmq.com>
	<AANLkTint-8A5D_OjVT5pjLaROytjicnaKdATmwSp0DcB@mail.gmail.com>
Message-ID: <4D6B517D.4010802@rabbitmq.com>

James,

James Carr wrote:
> Although Adam asked about fields I already knew about, I did come 
> across a bit of confusion recently while implementing my AMQP based 
> replication plugin for ehcache over the weekend. I've been using the 
> type field to specify the class name of objects that are replicated
> in caches on a cluster but I'm wondering if that's the proper field
> to use.

Beyond their brief descriptions the AMQP spec says nothing about the
purpose of these fields, though their intended use isn't all that hard 
to guess from the names and descriptions.

> I also noticed that there is a className header on BasicProperties

Presumably you are referring to the RabbitMQ Java client APIs. 
getClassName is just an ordinary getter method. AMQP groups its 
functionality into "classes" (confusingly, since they have nothing to do 
with classes in the OO sense). So BasicProperties.getClassName will 
return "basic".

Regards,

Matthias.

From vishalsodani at gmail.com  Mon Feb 28 08:45:06 2011
From: vishalsodani at gmail.com (vishy)
Date: Mon, 28 Feb 2011 00:45:06 -0800 (PST)
Subject: [rabbitmq-discuss] How to do performance testing for large
	number of messages?
In-Reply-To: <AANLkTimD9xK4hC+VBnwM9K6tV1C+BzXgY7KCkuyh0x_9@mail.gmail.com>
References: <0b3b35e7-a6d4-43a8-b0d4-e6a163ebe9e2@o39g2000prb.googlegroups.com>
	<AANLkTikJC=N0JMfMiPoa3nnDtjcVJBF-d8GAfh5oX3sy@mail.gmail.com>
	<AANLkTimD9xK4hC+VBnwM9K6tV1C+BzXgY7KCkuyh0x_9@mail.gmail.com>
Message-ID: <48ac5fd8-2ae5-49bb-ba7c-e0a3410dc988@r4g2000prm.googlegroups.com>

That is the way it has been implemented. It is our first RabbitMQ
installation. Do you have any other ideas? I am open to suggestions.

On Feb 25, 8:56?pm, Alexis Richardson <ale... at rabbitmq.com> wrote:
> Vishy
>
> Why do you need just one queue for this?
>
> alexis
>
>
>
> On Fri, Feb 25, 2011 at 3:55 PM, Marek Majkowski <maje... at gmail.com> wrote:
> > On Fri, Feb 25, 2011 at 04:13, vishy <vishalsod... at gmail.com> wrote:
> >> I have various clients(dotnet application) who are sending messages to
> >> RabbitMQ. We have a queue to which messages are forwarded. A consumer
> >> reads from the queue, and forwards it to a SMS Gateway. The message is
> >> sent using pysmpp library. ?Our goal is to be able to process 100000msg
> >> \second. Can one queue handle so many messages?
>
> > Take a look at 0MQ (zeromq).
>
> >> I also need some
> >> guidance on how to go about testing and improving performance - what
> >> parameters to look at etc?.
>
> > Benchmarking is generally hard, the only way to benchmark if your application
> > will be fast enough is to build the application and benchmark it end-to-end.
> > In most cases you're going to hit other bottlenecks before saturating Rabbit.
>
> > Cheers,
> > ?Marek
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From david at rabbitmq.com  Mon Feb 28 09:36:43 2011
From: david at rabbitmq.com (David Wragg)
Date: Mon, 28 Feb 2011 09:36:43 +0000
Subject: [rabbitmq-discuss] embedded rabbitmq-c client + openssl/openvpn
In-Reply-To: <AANLkTikF1p9JqKCFph9CJ_9oMrJEqWX1WN6CmkHK7J6p@mail.gmail.com>
	(bruce bushby's message of "Fri, 25 Feb 2011 12:25:24 +0000")
References: <AANLkTikF1p9JqKCFph9CJ_9oMrJEqWX1WN6CmkHK7J6p@mail.gmail.com>
Message-ID: <yrv4cwrkkv6tw.fsf@dwragg.eng.vmware.com>

Hi Bruce,

bruce bushby <bruce.bushby at gmail.com> writes:
> I was wondering if any list members would share some setup tips about
> configuring "rabbitmq-c client" with openssl/openvpn for secure
> (certificate) encrypted message delivery?
>
> I'm very new to Rabbit....spent the morning working through "hello world"
> but ultimately need to focus on the C client which will run from an embedded
> device. The device will be sending ascii text that has been compressed using
> "bzip2"
>
> I'm using Fedora 12 (client = 68f0c4b68086) &  Fedora 14 (server =
> 2.2.0-1.fc14)
>
> I read:
> http://www.rabbitmq.com/ssl.html
>
> but it appears to focus on the server and java client....not that thats a
> bad thing...just that I need to use the "C client"

Not all AMQP clients support SSL.  The C client currently doesn't
support SSL, which is one of the reasons it is not counted among the
RabbitMQ "supported" clients (which all include SSL).

Adding SSL support to the C client is on the todo list, but there's no
fixed schedule for when this will happen.

You could look into other approaches to encrypting the traffic between
the client and server, e.g. an encrypted VPN.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From matthias at rabbitmq.com  Mon Feb 28 09:59:05 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Feb 2011 09:59:05 +0000
Subject: [rabbitmq-discuss] How to do performance testing for
 large	number of messages?
In-Reply-To: <48ac5fd8-2ae5-49bb-ba7c-e0a3410dc988@r4g2000prm.googlegroups.com>
References: <0b3b35e7-a6d4-43a8-b0d4-e6a163ebe9e2@o39g2000prb.googlegroups.com>	<AANLkTikJC=N0JMfMiPoa3nnDtjcVJBF-d8GAfh5oX3sy@mail.gmail.com>	<AANLkTimD9xK4hC+VBnwM9K6tV1C+BzXgY7KCkuyh0x_9@mail.gmail.com>
	<48ac5fd8-2ae5-49bb-ba7c-e0a3410dc988@r4g2000prm.googlegroups.com>
Message-ID: <4D6B71E9.7050702@rabbitmq.com>

Vishy,

On 28/02/11 08:45, vishy wrote:
> On Feb 25, 8:56 pm, Alexis Richardson<ale... at rabbitmq.com>  wrote:
>> Why do you need just one queue for this?
> That is the way it has been implemented. It is our first RabbitMQ
> installation. Do you have any other ideas? I am open to suggestions.

You say that the plan is for the messages to be sent to an SMS gateway 
using pysmpp. Have you benchmarked that part of the system? I haven't 
worked with SMS gateways for a while, but I'd be amazed if they can 
handle your stated goal of 100,000 messages a second.

Regards,

Matthias.

From matthew at rabbitmq.com  Mon Feb 28 10:27:05 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 28 Feb 2011 10:27:05 +0000
Subject: [rabbitmq-discuss] There are no messages in the
 msg_store_persistent
In-Reply-To: <b15fcf3c-cbe0-4a4e-99e3-f2592010f783@u3g2000vbe.googlegroups.com>
References: <b15fcf3c-cbe0-4a4e-99e3-f2592010f783@u3g2000vbe.googlegroups.com>
Message-ID: <20110228102705.GA32701@rabbitmq.com>

On Sun, Feb 27, 2011 at 03:37:34PM -0800, Nickolay VInogradov wrote:
> Hello,
> 
> Server 2.3.1.
> Client - Perl, Net::RabbitMQ.
> 
> # rabbitmqctl list_queues
> Listing queues ...
> smtp_feed       0
> mail_feed       206034
> lenta_feed      0
> ...done.
> 
> But there are no messages in the persistent directory:
> # ls -l /var/lib/rabbitmq/mnesia/rabbit\@memcached2/
> msg_store_persistent/
> total 0
> -rw-r--r-- 1 root root 0 Feb 22 23:41 0.rdq
> 
> # du -hs /var/lib/rabbitmq/mnesia/rabbit\@memcached2/
> 120K    /var/lib/rabbitmq/mnesia/rabbit at memcached2/
> 
> What happens with messages? Where they are stored???

They _may_ be written to disk if you publish with delivery_mode = 2.
Even if they are published as such, there may be a time delay between
them being published and actually ending up on disk. If you safely shut
down rabbit (i.e. don't kill it hard) then you should see the messages
appear on disk if they have been published correctly.

Alternatively, if you use transactions or publisher confirms then you
should get confirmation back from the broker once they have been safely
written to disk.

Best wishes,

Matthew

From steve at rabbitmq.com  Mon Feb 28 11:53:11 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 28 Feb 2011 11:53:11 +0000
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
In-Reply-To: <AANLkTikbZEvg4UQoK6Qtx9+SG52rj1J9x4VqMoXx4_ib@mail.gmail.com>
References: <AANLkTikiOe-erSVNku1nQ5Nh-fptf0exFJ7ewmk1YfNr@mail.gmail.com>
	<AANLkTi=xk8XPQAKQk3-MshMv8xNR0sZ_G4PFd3oyStgu@mail.gmail.com>
	<4D6224E6.4000806@telecom-sudparis.eu>
	<AANLkTik+G1eai8nJKfDdSjsL2HJeCRbf4x4XOGaL=KG_@mail.gmail.com>
	<AANLkTikbZEvg4UQoK6Qtx9+SG52rj1J9x4VqMoXx4_ib@mail.gmail.com>
Message-ID: <72256CBC-81FD-4852-A878-17EAA8CB6A74@rabbitmq.com>

Several posts here have shown an interest in getting (and maintaining) the Java Client running on Android.

We now have a Bugzilla request which addresses this.  We will be aiming to get the standard Java Client to run on Android with reasonable performance (i.e. not too many GCs). General improvements to the Java Client will be made available on the Android platform as a matter of course.

I am new to the Android space (just now trying the SDK and Eclipse ADT plugin on a Mac) so if you have any information regarding patches, workarounds, noticed issues, or general advice, please can you post here, or contact me directly.

Thank you.
Steve Powell
<steve at rabbitmq.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110228/e3e0bdb4/attachment.htm>

From emile at rabbitmq.com  Mon Feb 28 12:26:08 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 28 Feb 2011 12:26:08 +0000
Subject: [rabbitmq-discuss] 2.3.1 WCF Binding not honouring virtual host,
 username or password
In-Reply-To: <AANLkTin-ruDfqzXdWP5KwUOyfzuP3o5xTO=VcVUoPoTq@mail.gmail.com>
References: <AANLkTin-ruDfqzXdWP5KwUOyfzuP3o5xTO=VcVUoPoTq@mail.gmail.com>
Message-ID: <4D6B9460.7030201@rabbitmq.com>

Hi Damien,

On 25/02/11 16:26, Damien Jones wrote:
> Hi all,
>
> I configured the RabbitMQ server with a new user and a virtual host, and
> set up my WCF bindings with the appropriate information.
> Regardless my connections were always being set up for the default user
> and vhost.
> Debugging the RabbitMQ.ServiceModel it turned out that the
> ConnectionFactory being used was missing the configuration settings,
> which I traced to the private constructor of
> RabbitMQTransportBindingElement:

[...]

> Is this a reasonable thing to do?

Thanks - you have uncovered a bug. Your suggested solution looks 
reasonable to me. I will file a ticket to get it solved.

Regards

Emile

From james.r.carr at gmail.com  Mon Feb 28 13:01:32 2011
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 28 Feb 2011 07:01:32 -0600
Subject: [rabbitmq-discuss] Preventing Publisher from Consuming Own Messages?
Message-ID: <AANLkTimhO2C8S9ipO=cMCscPx1X1N1F_EN5DE52FjJ=F@mail.gmail.com>

Hey All,

I'm working on an AMQP based cache replication plugin and so far it
has worked great. Each node on the cluster essentially opens its own
queue up on the exchange to receive cache update events and then
publishes on each put, eviction, etc.

One minor problem I've had however is the publishes also consumes its
own messages. My quick hack solution to it was to just put some logic
in the client code to filter out messages sent by the same node but
I'm wondering if the broker has some built in way to prevent delivery
of messages on a queue bound to the same publisher?


Thanks,
James

From simonthorogood at hotmail.com  Mon Feb 28 15:13:21 2011
From: simonthorogood at hotmail.com (SimonT)
Date: Mon, 28 Feb 2011 07:13:21 -0800 (PST)
Subject: [rabbitmq-discuss] Thrift vs. Protocol Buffers as serialization
	formats
Message-ID: <6a761861-8f53-4903-87ef-0452cec8c9aa@k16g2000vbq.googlegroups.com>

Anyone care to share their experiences with using either of these
(specificially, as the 'on-the-wire' format for RabbitMQ messages)? In
particular, would be interested to know about:

- Ease of managing the (re)generation of message formats for use
across multiple platforms (in our case, C# and Python)
- Serialisation/Deserialisation performance
- Serialized message size



From matthias at rabbitmq.com  Mon Feb 28 15:13:15 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Feb 2011 15:13:15 +0000
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <31019159.post@talk.nabble.com>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com>
Message-ID: <4D6BBB8B.2000707@rabbitmq.com>

On 26/02/11 10:32, DOBRO wrote:
> Now I understand why messages_ready in some queues grow up in time.
> That's because of connection was closed not properly.
>
> Actually, these queues disappear later.

So is there still a problem? Has the original "some workers stop 
receiving messages from some queues" issue been resolved?


Matthias.

From matthias at rabbitmq.com  Mon Feb 28 15:27:38 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Feb 2011 15:27:38 +0000
Subject: [rabbitmq-discuss] Preventing Publisher from Consuming Own
	Messages?
In-Reply-To: <AANLkTimhO2C8S9ipO=cMCscPx1X1N1F_EN5DE52FjJ=F@mail.gmail.com>
References: <AANLkTimhO2C8S9ipO=cMCscPx1X1N1F_EN5DE52FjJ=F@mail.gmail.com>
Message-ID: <4D6BBEEA.8040509@rabbitmq.com>

James,

On 28/02/11 13:01, James Carr wrote:
> One minor problem I've had however is the publishes also consumes its
> own messages. My quick hack solution to it was to just put some logic
> in the client code to filter out messages sent by the same node but
> I'm wondering if the broker has some built in way to prevent delivery
> of messages on a queue bound to the same publisher?

You could probably cook something up with alternate exchanges and 
internal exchanges, but the approach you have implemented above is 
actually not so bad and its relative cost decreases as the cluster grows.

Regards,

Matthias.

From Chris.Hampson at arm.com  Mon Feb 28 15:27:42 2011
From: Chris.Hampson at arm.com (Chris Hampson)
Date: Mon, 28 Feb 2011 15:27:42 +0000
Subject: [rabbitmq-discuss] Clustering over a WAN
In-Reply-To: <4D6BBB8B.2000707@rabbitmq.com>
References: <30958766.post@talk.nabble.com>	<4D604FD7.6030307@rabbitmq.com>
	<30989184.post@talk.nabble.com>
	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>
	<30990022.post@talk.nabble.com>
	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>
	<31018690.post@talk.nabble.com>	<31019159.post@talk.nabble.com>
	<4D6BBB8B.2000707@rabbitmq.com>
Message-ID: <A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>

Hi Guys,

We're currently attempting to maintain a RabbitMQ cluster over a WAN between some of our sites, 2 in the US, one in the UK and another in India.

For the most part this seems to be working fine, but it seems a little fragile and we can't seem to get it to recover from failures very well.

Currently we have one disk node, and three RAM nodes, I've set the net_ticktime quite high to try to decrease the chances of timeouts, but we still seem to run into about one problem a week.

Quite often if there is a communication problem at all we end up with a segmented network, and normally the RAM nodes all gang up and ignore the disk node happily going about their business.

If anyone can provide any advice to aid our situation we'd be most grateful (even if it is "don't do that you loony, separate them out and shovel messages between sites when necessary")

There never seems to be much in the log files in the event of a cluster break up, but on request I can go hunting for snippets if they'll be useful.

Many thanks in advance,

Chris

-- IMPORTANT NOTICE: The contents of this email and any attachments are confidential and may also be privileged. If you are not the intended recipient, please notify the sender immediately and do not disclose the contents to any other person, use it for any purpose, or store or copy the information in any medium.  Thank you.


From mabrek at gmail.com  Mon Feb 28 15:34:09 2011
From: mabrek at gmail.com (Anton Lebedevich)
Date: Mon, 28 Feb 2011 18:34:09 +0300
Subject: [rabbitmq-discuss] announcing rabbitmq-redis bridge
Message-ID: <4D6BC071.7030701@gmail.com>

Hello,

I've recently pushed to https://github.com/mabrek/rabbitmq-redis new
experimental plugin.

This plugin moves messages between RabbitMQ and Redis Pub/Sub
(http://redis.io/topics/pubsub) using erldis. It was inspired by
RabbitMQ-shovel and shares the same idea with the exception that it
connects Redis pub/sub channels to RabbitMQ queues or exchanges.

Regards,
Anton Lebedevich.

From emile at rabbitmq.com  Mon Feb 28 15:34:16 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 28 Feb 2011 15:34:16 +0000
Subject: [rabbitmq-discuss] socket error while using rabbitmq and a NAT
 (Network address translation)
In-Reply-To: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>
Message-ID: <4D6BC078.8030600@rabbitmq.com>

Hi,

There is no reason why an AMQP connection won't work over NAT. This is 
equally for version 1.7.0 and 2.3.1. It is likely that the cause for 
this error is at the network layer.

Does the broker logfile contain any other relevant messages other than 
the one about the abrupt disconnection?

Can you get "rabbitmqctl list_connections" on the broker to list the 
connection from the client at any time?
Are you able to establish an AMQP channel and issue the basicConsume(), 
or does the error occur earlier during connection establishment?

Do you have any way of checking the state of the connection on the NAT 
device?

Establishing the AMQP connection via the AMQP Tracer ( 
http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html ) might 
also provide useful diagnostic information.



-Emile




On 27/02/11 13:06, mysurf mail wrote:
> Hi ,
> I am writing a new mail because my last issue was solved .
> It is just that on a certain computer my application stopped working.
> So it is a new issue and I will explain and paste the exception below.
>
> Basically, I did three things :
> 1. I upgraded from 1.7.0 to 2.3.1 (installed a new erlang also)
> 2. I upgraded the client jars
> 3. changed the protocol to ack = true;
>
> channel.basicConsume(queueName, true, queueingConsumer);
>
> well, that certain computer is behind a firewall, and has a NAT (Network
> Address Translation ).
> It did work prior to the upgrade with the NAT (mySQL also handles it
> pretty well).
> with the same ports.
> Maybe it is the bidirectional channel (since I added acking? I dont
> think so...).
>
> what I can see is that.
> when the client tries to connect it writes in the logs
>
> Connection closed abruptly
>
> And now, behold, the exception :

[...]

From mark.pork at gmail.com  Mon Feb 28 15:44:06 2011
From: mark.pork at gmail.com (butterdave2)
Date: Mon, 28 Feb 2011 07:44:06 -0800 (PST)
Subject: [rabbitmq-discuss] backport-util-concurrent upgrade from 3.0 to 3.1?
Message-ID: <31030812.post@talk.nabble.com>


Hi there,

I've noticed there's a new version of backport-util-concurrent (3.1) but the
java client dependencies are still on 3.0. Is it ok to use 3.1?

Thanks,

Dave Park
-- 
View this message in context: http://old.nabble.com/backport-util-concurrent-upgrade-from-3.0-to-3.1--tp31030812p31030812.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Mon Feb 28 15:49:57 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 28 Feb 2011 15:49:57 +0000
Subject: [rabbitmq-discuss] Clustering over a WAN
In-Reply-To: <A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>
References: <30958766.post@talk.nabble.com>	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>	<31019159.post@talk.nabble.com>	<4D6BBB8B.2000707@rabbitmq.com>
	<A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>
Message-ID: <4D6BC425.1050204@rabbitmq.com>

On 28/02/11 15:27, Chris Hampson wrote:
> If anyone can provide any advice to aid our situation we'd be most
> grateful (even if it is "don't do that you loony, separate them out
> and shovel messages between sites when necessary")

I'm afraid it is going to be along those lines. RabbitMQ clusters don't 
deal very well with netsplits and probably should not be used over a WAN.

I'm looking into adding federation support to future versions of 
RabbitMQ (which would be much more WAN-friendly), so I'd be interested 
to know more about your use case.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Mon Feb 28 15:51:27 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 28 Feb 2011 15:51:27 +0000
Subject: [rabbitmq-discuss] Clustering over a WAN
In-Reply-To: <A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>
References: <A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>
Message-ID: <20110228155125.GC32701@rabbitmq.com>

On Mon, Feb 28, 2011 at 03:27:42PM +0000, Chris Hampson wrote:
> We're currently attempting to maintain a RabbitMQ cluster over a WAN between some of our sites, 2 in the US, one in the UK and another in India.

That's a bad idea.

> For the most part this seems to be working fine, but it seems a little fragile and we can't seem to get it to recover from failures very well.

Correct. Mnesia, which Rabbit uses to store all sorts of data (though
not messages), copes poorly with network partitions.

> If anyone can provide any advice to aid our situation we'd be most
> grateful (even if it is "don't do that you loony, separate them out
> and shovel messages between sites when necessary")

Yeah, the latter's a fair summary of my advice on this ;) We do state
quite prominantly that clustering is not for HA, though I admit we state
it on http://www.rabbitmq.com/pacemaker.html rather than
http://www.rabbitmq.com/clustering.html which is not really as helpful
as it could be.

The problem is that mnesia, and by extension Rabbit, goes for the
Consistency and Availability part of the CAP triangle, and so just does
not cope well with partitions ocurring.
http://en.wikipedia.org/wiki/CAP_theorem

We are working on solving some of these problems in a number of
different ways. If the shovel is a viable solution then I'd recommend
you use that, otherwise please let us know some more details of your use
case and we should be able to advise further.

Best wishes,

Matthew

From rob at rabbitmq.com  Mon Feb 28 16:04:53 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Mon, 28 Feb 2011 16:04:53 +0000
Subject: [rabbitmq-discuss] backport-util-concurrent upgrade from 3.0 to
	3.1?
In-Reply-To: <31030812.post@talk.nabble.com>
References: <31030812.post@talk.nabble.com>
Message-ID: <D2BC585A-1DAB-4344-92D8-4DE01721546C@rabbitmq.com>

Dave,

Since 2.3.0 we removed support for Java 1.4 so we no longer use backport-util-concurrent.

For older clients we haven't tested the new release of buc but I'm guessing the level of support will depend heavily on what retrotranslator uses.

Regards,

Rob



On 28 Feb 2011, at 15:44, butterdave2 <mark.pork at gmail.com> wrote:

> 
> Hi there,
> 
> I've noticed there's a new version of backport-util-concurrent (3.1) but the
> java client dependencies are still on 3.0. Is it ok to use 3.1?
> 
> Thanks,
> 
> Dave Park
> -- 
> View this message in context: http://old.nabble.com/backport-util-concurrent-upgrade-from-3.0-to-3.1--tp31030812p31030812.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Chris.Hampson at arm.com  Mon Feb 28 16:17:44 2011
From: Chris.Hampson at arm.com (Chris Hampson)
Date: Mon, 28 Feb 2011 16:17:44 +0000
Subject: [rabbitmq-discuss] Clustering over a WAN
In-Reply-To: <20110228155125.GC32701@rabbitmq.com>
References: <A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>
	<20110228155125.GC32701@rabbitmq.com>
Message-ID: <A610E03AD50BFC4D95529A36D37FA55E1697F7B98B@GEORGE.Emea.Arm.com>

Thanks Simon and Matthew for the quick responses.

I was beginning to figure that perhaps what we were trying to do was going to be problematic, which is a shame as it would've been a very neat solution to what we're trying to do.

In essence our use case is as follows:

We have groups of users and resources at each of the sites, each of these sites also have a compute cluster. We wanted a system whereby a user could essentially have a client that could subscribe to events in a site generated by the compute cluster, jobs starting/finishing, status updates, warnings etc. and act accordingly, be it automatically or through some kind of notification and then human interaction.

We also wanted to allow (very selectively) for a user at one site to subscribe for certain messages published to other sites (placing a ban on blanket subscriptions to minimise unnecessary bandwidth being wasted).

We figured this could be implemented with a cluster, all clients connecting to their local broker but publishing to a common exchange. In our tests this worked well, with users also being able to selectively get messages from other sites as well as their own (working out a scheme of users and permissions for this was fun, but we achieved it in the end).

This was essentially it, we then planned other applications on top of this base, it was shaping up nicely until we started experiencing the cluster break ups :-\

I've just looked into the shovel plugin further, and it looks as if it may not be quite dynamic enough for our use (we don't want to be re-tweaking config files every time we set up a new pattern) :-( it's beginning to look like the best way forward for now is separate brokers with custom clients acting as the shovels between sites, consuming on one, then publishing to another as necessary.

Any advice and/or tips are most welcome here, we're quite new to the world of messaging, and may be approaching this backwards (which would be a shame, as we thought we'd found a very nice solution). ;-)

Cheers,

Chris

> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
> discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew Sackman
> Sent: 28 February 2011 15:51
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Clustering over a WAN
>
> On Mon, Feb 28, 2011 at 03:27:42PM +0000, Chris Hampson wrote:
> > We're currently attempting to maintain a RabbitMQ cluster over a WAN
> between some of our sites, 2 in the US, one in the UK and another in
> India.
>
> That's a bad idea.
>
> > For the most part this seems to be working fine, but it seems a
> little fragile and we can't seem to get it to recover from failures
> very well.
>
> Correct. Mnesia, which Rabbit uses to store all sorts of data (though
> not messages), copes poorly with network partitions.
>
> > If anyone can provide any advice to aid our situation we'd be most
> > grateful (even if it is "don't do that you loony, separate them out
> > and shovel messages between sites when necessary")
>
> Yeah, the latter's a fair summary of my advice on this ;) We do state
> quite prominantly that clustering is not for HA, though I admit we
> state
> it on http://www.rabbitmq.com/pacemaker.html rather than
> http://www.rabbitmq.com/clustering.html which is not really as helpful
> as it could be.
>
> The problem is that mnesia, and by extension Rabbit, goes for the
> Consistency and Availability part of the CAP triangle, and so just does
> not cope well with partitions ocurring.
> http://en.wikipedia.org/wiki/CAP_theorem
>
> We are working on solving some of these problems in a number of
> different ways. If the shovel is a viable solution then I'd recommend
> you use that, otherwise please let us know some more details of your
> use
> case and we should be able to advise further.
>
> Best wishes,
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- IMPORTANT NOTICE: The contents of this email and any attachments are confidential and may also be privileged. If you are not the intended recipient, please notify the sender immediately and do not disclose the contents to any other person, use it for any purpose, or store or copy the information in any medium.  Thank you.


From jiri at krutil.com  Mon Feb 28 16:25:00 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Mon, 28 Feb 2011 17:25:00 +0100
Subject: [rabbitmq-discuss] Choosing SASL authentication mechanism
Message-ID: <20110228172500.15524vbvl6r9xhmo@webmail.active24.cz>

Hi

When experimenting with the rabbitmq-auth-mechanism-ssl plugin, we  
have seen a strange inconsistency in which SASL mechanism is chosen  
for client authentication on different broker installations.

We have two instances of the 2.3.1 broker installed on different boxes  
by different people. Both brokers are configured to use PLAIN,  
AMQPLAIN and EXTERNAL mechanisms.

We are connecting to both brokers using the same Java client (version  
2.3.1). The Java client uses the default SASL configuration.

When trying to connect, one broker uses the EXTERNAL mechanism as  
expected. But the other broker uses PLAIN authentication (which fails  
on invalid user/password).

When we override the default SaslConfig on the client side with a  
config that only has EXTERNAL in the mechanisms list, then both  
brokers use EXTERNAL and things work fine.

So my questions are:
- How does the broker choose the SASL mechanism to be used?
- What installation or configuration mistakes could affect this decision?

Cheers
Jiri


From jon at jbrisbin.com  Mon Feb 28 16:37:04 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 28 Feb 2011 10:37:04 -0600
Subject: [rabbitmq-discuss] Clustering over a WAN
In-Reply-To: <20110228155125.GC32701@rabbitmq.com>
References: <A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>
	<20110228155125.GC32701@rabbitmq.com>
Message-ID: <BED156B9-E9DC-428C-88BF-C74EEA5F0FB1@jbrisbin.com>

Would any of these issues be resolved by using a distributed K/V store as the backend for both messages and metadata? I know the internals of using mnesia to store all that metadata can't easily be abstracted, but if you didn't have that particular hurdle to jump, would that make clustering any easier?

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin


On Feb 28, 2011, at 9:51 AM, Matthew Sackman wrote:

> On Mon, Feb 28, 2011 at 03:27:42PM +0000, Chris Hampson wrote:
>> We're currently attempting to maintain a RabbitMQ cluster over a WAN between some of our sites, 2 in the US, one in the UK and another in India.
> 
> That's a bad idea.
> 
>> For the most part this seems to be working fine, but it seems a little fragile and we can't seem to get it to recover from failures very well.
> 
> Correct. Mnesia, which Rabbit uses to store all sorts of data (though
> not messages), copes poorly with network partitions.
> 
>> If anyone can provide any advice to aid our situation we'd be most
>> grateful (even if it is "don't do that you loony, separate them out
>> and shovel messages between sites when necessary")
> 
> Yeah, the latter's a fair summary of my advice on this ;) We do state
> quite prominantly that clustering is not for HA, though I admit we state
> it on http://www.rabbitmq.com/pacemaker.html rather than
> http://www.rabbitmq.com/clustering.html which is not really as helpful
> as it could be.
> 
> The problem is that mnesia, and by extension Rabbit, goes for the
> Consistency and Availability part of the CAP triangle, and so just does
> not cope well with partitions ocurring.
> http://en.wikipedia.org/wiki/CAP_theorem
> 
> We are working on solving some of these problems in a number of
> different ways. If the shovel is a viable solution then I'd recommend
> you use that, otherwise please let us know some more details of your use
> case and we should be able to advise further.
> 
> Best wishes,
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From simon at rabbitmq.com  Mon Feb 28 16:55:19 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 28 Feb 2011 16:55:19 +0000
Subject: [rabbitmq-discuss] Choosing SASL authentication mechanism
In-Reply-To: <20110228172500.15524vbvl6r9xhmo@webmail.active24.cz>
References: <20110228172500.15524vbvl6r9xhmo@webmail.active24.cz>
Message-ID: <4D6BD377.3030206@rabbitmq.com>

On 28/02/11 16:25, Jiri Krutil wrote:
> We are connecting to both brokers using the same Java client (version
> 2.3.1). The Java client uses the default SASL configuration.
>
> When trying to connect, one broker uses the EXTERNAL mechanism as
> expected. But the other broker uses PLAIN authentication (which fails on
> invalid user/password).

Huh. that is weird.

> When we override the default SaslConfig on the client side with a config
> that only has EXTERNAL in the mechanisms list, then both brokers use
> EXTERNAL and things work fine.
>
> So my questions are:
> - How does the broker choose the SASL mechanism to be used?

The broker doesn't choose. The broker offers a list of options to the 
client, and the client chooses one.

In the Java client by default we just invoke 
javax.security.sasl.Sasl.getSaslClient(String[]), which effectively 
leaves the decision up to Sun. The Javadoc here:

http://download.oracle.com/javase/6/docs/api/javax/security/sasl/Sasl.html#createSaslClient(java.lang.String[], 
java.lang.String, java.lang.String, java.lang.String, java.util.Map, 
javax.security.auth.callback.CallbackHandler)

purports to tell you how the selection process works, although it's 
pretty vague - i.e. it "uses the JCA Security Provider Framework".

Having said that, if the brokers are offering the same mechanisms then 
the JCA should at least make a consistent decision. I would hope. But 
maybe not. In theory the order of the mechanisms as reported by the 
broker should not matter, but maybe to JCA it does.

 From your experience I'm starting to wonder if the Java client has the 
right design. All our other clients contain their own SASL 
implementation and you just pick which mechanism you want to use. Maybe 
the Java client should be more like that too.

 > - What installation or configuration mistakes could affect this decision?

If it's the same client both times, I have no idea. If it were different 
clients I would suggest different JDK versions or something similar.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Mon Feb 28 17:04:25 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 28 Feb 2011 17:04:25 +0000
Subject: [rabbitmq-discuss] Thrift vs. Protocol Buffers as serialization
	formats
In-Reply-To: <6a761861-8f53-4903-87ef-0452cec8c9aa@k16g2000vbq.googlegroups.com>
References: <6a761861-8f53-4903-87ef-0452cec8c9aa@k16g2000vbq.googlegroups.com>
Message-ID: <AANLkTimo31+AASUB+=QuHLxzN5-GhbS4J2zKNLJYNHbJ@mail.gmail.com>

On Mon, Feb 28, 2011 at 15:13, SimonT <simonthorogood at hotmail.com> wrote:
> Anyone care to share their experiences with using either of these
> (specificially, as the 'on-the-wire' format for RabbitMQ messages)? In
> particular, would be interested to know about:
>
> - Ease of managing the (re)generation of message formats for use
> across multiple platforms (in our case, C# and Python)
> - Serialisation/Deserialisation performance
> - Serialized message size

In my projects the performance of (de)serialization doesn't matter
that much. But flexibility and simplicity matters a lot.

I tend to use JSON and I'm happy with it. Language support is
brilliand, it's simple and fast enough.

Cheers,
  Marek

From vertolet666 at yandex.ru  Mon Feb 28 17:11:29 2011
From: vertolet666 at yandex.ru (DOBRO Sergei)
Date: Mon, 28 Feb 2011 20:11:29 +0300
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <4D6BBB8B.2000707@rabbitmq.com>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
Message-ID: <36051298913090@web35.yandex.ru>

Matthias,

I can confirm that the issue is not resolved yet.
Those queues which have messages_ready are not relevant to the case because all of them are bound to the other (fanout) exchange. Each worker's queue is bound to another direct exchange with its own routing key.

I've noticed that the issue occurs chiefly when the worker's queue is in heavy load state.

But when the workers stop receving messages, none of their queues have messages_ready or messages_unacknowledged.
Here is the output I've saved when it happened last time.

# rabbitmqctl list_queues name messages messages_ready messages_unacknowledged |grep daemon
daemon-8698-1298682602  0       0       0
daemon-8711-1298682602  0       0       0
daemon-8700-1298682602  0       0       0
daemon-8699-1298682602  0       0       0
daemon-8704-1298682602  0       0       0
daemon-8710-1298682602  0       0       0
daemon-8706-1298682602  0       0       0
daemon-8702-1298682602  0       0       0
daemon-8701-1298682602  0       0       0
daemon-8707-1298682602  0       0       0

The full output of rabbitmqctl list_{exchanges,queues,bindings,consumers,connections,channels} I have published here:
http://old.nabble.com/Losing-messages%2C-why--td30958766.html

BTW, workers are Perl (Net::RabbitMQ) clients. Does it matter?

Thanks a lot for your support!

DOBRO.

28.02.2011, 18:13, "Matthias Radestock" <matthias at rabbitmq.com>:
> On 26/02/11 10:32, DOBRO wrote:
>
>> ?Now I understand why messages_ready in some queues grow up in time.
>> ?That's because of connection was closed not properly.
>>
>> ?Actually, these queues disappear later.
>
> So is there still a problem? Has the original "some workers stop
> receiving messages from some queues" issue been resolved?
>
> Matthias.

From matthew at rabbitmq.com  Mon Feb 28 17:14:35 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 28 Feb 2011 17:14:35 +0000
Subject: [rabbitmq-discuss] Clustering over a WAN
In-Reply-To: <BED156B9-E9DC-428C-88BF-C74EEA5F0FB1@jbrisbin.com>
References: <A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>
	<20110228155125.GC32701@rabbitmq.com>
	<BED156B9-E9DC-428C-88BF-C74EEA5F0FB1@jbrisbin.com>
Message-ID: <20110228171434.GD32701@rabbitmq.com>

On Mon, Feb 28, 2011 at 10:37:04AM -0600, Jon Brisbin wrote:
> Would any of these issues be resolved by using a distributed K/V store
> as the backend for both messages and metadata? I know the internals of
> using mnesia to store all that metadata can't easily be abstracted,
> but if you didn't have that particular hurdle to jump, would that make
> clustering any easier?

Quite possibly, but for example, we rely on transactions quite a lot in
mnesia which eg Riak doesn't have. If we did try and replace mnesia with
something that doesn't support transactions then it's very likely we
wouldn't be able to achieve all sorts of guarantees that are currently
required by AMQP.

There is no magic bullet to these problems.

Matthew

From matthias at rabbitmq.com  Mon Feb 28 17:25:39 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Feb 2011 17:25:39 +0000
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <36051298913090@web35.yandex.ru>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru>
Message-ID: <4D6BDA93.8060206@rabbitmq.com>

On 28/02/11 17:11, DOBRO Sergei wrote:
> I've noticed that the issue occurs chiefly when the worker's queue is
> in heavy load state.
>
> But when the workers stop receving messages, none of their queues
> have messages_ready or messages_unacknowledged. Here is the output
> I've saved when it happened last time.
> [...]

In the list_* output you sent, which consumers/queues are in the 
"broken" state where their connected clients aren't receiving messages?

If all workers have the queues and bindings you expect, and their queues 
are empty then I can think of just three ways in which messages might 
get "lost":

1) The server sends the messages to the client but for some reason they 
never make it to the client side application.

2) Some other consumer is consuming messages from the same queues.

3) The messages are never published in the first place.

Perhaps you could attach a network tap when the system is "broken" to 
see what is getting sent to the clients?


Regards,

Matthias.

From jdetreville at vmware.com  Mon Feb 28 17:26:44 2011
From: jdetreville at vmware.com (John DeTreville)
Date: Mon, 28 Feb 2011 09:26:44 -0800
Subject: [rabbitmq-discuss] Clustering over a WAN
In-Reply-To: <BED156B9-E9DC-428C-88BF-C74EEA5F0FB1@jbrisbin.com>
References: <A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>
	<20110228155125.GC32701@rabbitmq.com>
	<BED156B9-E9DC-428C-88BF-C74EEA5F0FB1@jbrisbin.com>
Message-ID: <229274F1-CA00-455E-9FEF-66C42CB261D9@vmware.com>

Yes, but...

Some users want geographic distribution, and while that's pretty much impossible in Mnesia (which even so is already a distributed database!), it doesn't become a whole lot easier with a different distributed database. 

One possible approach to building a geographically distributed messaging system (possibly as an eventual successor or supplement to RabbitMQ) would be to provide eventual consistency instead of the stronger consistency currently provided, perhaps building it on top of an appropriate eventual-consistency database system. This would unfortunately require pervasive changes in the queuing API. 

In my spare time, I've been thinking a little about the design of such an API, and I'll post some more details shortly. 

Cheers,
John

On Feb 28, 2011, at 8:37, "Jon Brisbin" <jon at jbrisbin.com> wrote:

> Would any of these issues be resolved by using a distributed K/V store as the backend for both messages and metadata? I know the internals of using mnesia to store all that metadata can't easily be abstracted, but if you didn't have that particular hurdle to jump, would that make clustering any easier?
> 
> Jon Brisbin
> 
> http://jbrisbin.com
> Twitter: @j_brisbin
> 
> 
> On Feb 28, 2011, at 9:51 AM, Matthew Sackman wrote:
> 
>> On Mon, Feb 28, 2011 at 03:27:42PM +0000, Chris Hampson wrote:
>>> We're currently attempting to maintain a RabbitMQ cluster over a WAN between some of our sites, 2 in the US, one in the UK and another in India.
>> 
>> That's a bad idea.
>> 
>>> For the most part this seems to be working fine, but it seems a little fragile and we can't seem to get it to recover from failures very well.
>> 
>> Correct. Mnesia, which Rabbit uses to store all sorts of data (though
>> not messages), copes poorly with network partitions.
>> 
>>> If anyone can provide any advice to aid our situation we'd be most
>>> grateful (even if it is "don't do that you loony, separate them out
>>> and shovel messages between sites when necessary")
>> 
>> Yeah, the latter's a fair summary of my advice on this ;) We do state
>> quite prominantly that clustering is not for HA, though I admit we state
>> it on http://www.rabbitmq.com/pacemaker.html rather than
>> http://www.rabbitmq.com/clustering.html which is not really as helpful
>> as it could be.
>> 
>> The problem is that mnesia, and by extension Rabbit, goes for the
>> Consistency and Availability part of the CAP triangle, and so just does
>> not cope well with partitions ocurring.
>> http://en.wikipedia.org/wiki/CAP_theorem
>> 
>> We are working on solving some of these problems in a number of
>> different ways. If the shovel is a viable solution then I'd recommend
>> you use that, otherwise please let us know some more details of your use
>> case and we should be able to advise further.
>> 
>> Best wishes,
>> 
>> Matthew
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From moshima at advent.com  Mon Feb 28 17:57:41 2011
From: moshima at advent.com (Michi Oshima)
Date: Mon, 28 Feb 2011 09:57:41 -0800 (PST)
Subject: [rabbitmq-discuss] Queue with auto_delete=True not getting deleted
Message-ID: <31032343.post@talk.nabble.com>


Hi,

Queues created with auto_delete set to True are not always getting deleted
upon client process termination.  There is no other client processes using
the same queue.

I'm wondering if there is a way to ensure deletion.  I cannot use set
exclusive to True, as I have to let another client process bind the queue.

I'm using a .NET client to create a queue thusly:

    channel.QueueDeclare(qname, false, false, true, null); // channel is
IModel.

That is: durable=False, exclusive=False, auto_delete=True.

I'm finding that the queue does not get deleted when I terminate the .NET
client process immediately after I declare the queue.

On the other hand, if the client process is terminated after the queue is
bound, the queue gets deleted properly.

I'm on RabbitMQ 2.3.1, runing on Erlang version R14B01

Thanks always for addressing my questions.

Michi Oshima
-- 
View this message in context: http://old.nabble.com/Queue-with-auto_delete%3DTrue-not-getting-deleted-tp31032343p31032343.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Mon Feb 28 18:09:36 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Feb 2011 18:09:36 +0000
Subject: [rabbitmq-discuss] Queue with auto_delete=True not getting
	deleted
In-Reply-To: <31032343.post@talk.nabble.com>
References: <31032343.post@talk.nabble.com>
Message-ID: <4D6BE4E0.4020102@rabbitmq.com>

Michi,

On 28/02/11 17:57, Michi Oshima wrote:
> I'm wondering if there is a way to ensure deletion.  I cannot use set
> exclusive to True, as I have to let another client process bind the queue.
>
> I'm using a .NET client to create a queue thusly:
>
>      channel.QueueDeclare(qname, false, false, true, null); // channel is
> IModel.
>
> That is: durable=False, exclusive=False, auto_delete=True.
>
> I'm finding that the queue does not get deleted when I terminate the .NET
> client process immediately after I declare the queue.
>
> On the other hand, if the client process is terminated after the queue is
> bound, the queue gets deleted properly.

Auto-deletion kicks in when the last consumer has been removed. But for 
that to happen there must be a consumer to start with.

You may want to set a lease on the queue. See 
http://www.rabbitmq.com/extensions.html#queue-leases.

Regards,

Matthias.

From holger.hoffstaette at googlemail.com  Mon Feb 28 18:19:15 2011
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Mon, 28 Feb 2011 19:19:15 +0100
Subject: [rabbitmq-discuss] backport-util-concurrent upgrade from 3.0 to
	3.1?
References: <31030812.post@talk.nabble.com>
Message-ID: <pan.2011.02.28.18.19.15.67625@googlemail.com>

On Mon, 28 Feb 2011 07:44:06 -0800, butterdave2 wrote:

> I've noticed there's a new version of backport-util-concurrent (3.1) but
> the java client dependencies are still on 3.0. Is it ok to use 3.1?

That "new" release is several years old already :) and would work just
fine. IIRC more up to date releases of retrotranslator use it as well.

-h



From alexis at rabbitmq.com  Mon Feb 28 19:44:51 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 28 Feb 2011 19:44:51 +0000
Subject: [rabbitmq-discuss] Clustering over a WAN
In-Reply-To: <229274F1-CA00-455E-9FEF-66C42CB261D9@vmware.com>
References: <A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>
	<20110228155125.GC32701@rabbitmq.com>
	<BED156B9-E9DC-428C-88BF-C74EEA5F0FB1@jbrisbin.com>
	<229274F1-CA00-455E-9FEF-66C42CB261D9@vmware.com>
Message-ID: <AANLkTimTG8dxLWvS0oWnC9VQA88anrDymJORP8xjP0Cu@mail.gmail.com>

Another approach is to create federation models in new exchange types.

alexis


On Mon, Feb 28, 2011 at 5:26 PM, John DeTreville <jdetreville at vmware.com> wrote:
> Yes, but...
>
> Some users want geographic distribution, and while that's pretty much impossible in Mnesia (which even so is already a distributed database!), it doesn't become a whole lot easier with a different distributed database.
>
> One possible approach to building a geographically distributed messaging system (possibly as an eventual successor or supplement to RabbitMQ) would be to provide eventual consistency instead of the stronger consistency currently provided, perhaps building it on top of an appropriate eventual-consistency database system. This would unfortunately require pervasive changes in the queuing API.
>
> In my spare time, I've been thinking a little about the design of such an API, and I'll post some more details shortly.
>
> Cheers,
> John
>
> On Feb 28, 2011, at 8:37, "Jon Brisbin" <jon at jbrisbin.com> wrote:
>
>> Would any of these issues be resolved by using a distributed K/V store as the backend for both messages and metadata? I know the internals of using mnesia to store all that metadata can't easily be abstracted, but if you didn't have that particular hurdle to jump, would that make clustering any easier?
>>
>> Jon Brisbin
>>
>> http://jbrisbin.com
>> Twitter: @j_brisbin
>>
>>
>> On Feb 28, 2011, at 9:51 AM, Matthew Sackman wrote:
>>
>>> On Mon, Feb 28, 2011 at 03:27:42PM +0000, Chris Hampson wrote:
>>>> We're currently attempting to maintain a RabbitMQ cluster over a WAN between some of our sites, 2 in the US, one in the UK and another in India.
>>>
>>> That's a bad idea.
>>>
>>>> For the most part this seems to be working fine, but it seems a little fragile and we can't seem to get it to recover from failures very well.
>>>
>>> Correct. Mnesia, which Rabbit uses to store all sorts of data (though
>>> not messages), copes poorly with network partitions.
>>>
>>>> If anyone can provide any advice to aid our situation we'd be most
>>>> grateful (even if it is "don't do that you loony, separate them out
>>>> and shovel messages between sites when necessary")
>>>
>>> Yeah, the latter's a fair summary of my advice on this ;) We do state
>>> quite prominantly that clustering is not for HA, though I admit we state
>>> it on http://www.rabbitmq.com/pacemaker.html rather than
>>> http://www.rabbitmq.com/clustering.html which is not really as helpful
>>> as it could be.
>>>
>>> The problem is that mnesia, and by extension Rabbit, goes for the
>>> Consistency and Availability part of the CAP triangle, and so just does
>>> not cope well with partitions ocurring.
>>> http://en.wikipedia.org/wiki/CAP_theorem
>>>
>>> We are working on solving some of these problems in a number of
>>> different ways. If the shovel is a viable solution then I'd recommend
>>> you use that, otherwise please let us know some more details of your use
>>> case and we should be able to advise further.
>>>
>>> Best wishes,
>>>
>>> Matthew
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From vertolet666 at yandex.ru  Mon Feb 28 20:13:26 2011
From: vertolet666 at yandex.ru (DOBRO Sergei)
Date: Mon, 28 Feb 2011 23:13:26 +0300
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <4D6BDA93.8060206@rabbitmq.com>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
Message-ID: <91131298924006@web116.yandex.ru>


> In the list_* output you sent, which consumers/queues are in the
> "broken" state where their connected clients aren't receiving messages?
>
All the consumers, queues, bindings and connections are present.

I just can say that when the workers stop receiving messages I restart them and everything goes fine.
Mysticism :)

From moshima at advent.com  Mon Feb 28 20:50:38 2011
From: moshima at advent.com (Michi Oshima)
Date: Mon, 28 Feb 2011 12:50:38 -0800 (PST)
Subject: [rabbitmq-discuss] gen_event handler rabbit_error_logger
 crashed. Reason badarg
In-Reply-To: <20110226110529.GA26515@wellquite.org>
References: <AANLkTikxzE04_yY=VyaYHw4dq_731hE_frZHgKBB+0ox@mail.gmail.com>
	<4D26E040.4080207@rabbitmq.com> <31017300.post@talk.nabble.com>
	<20110226110529.GA26515@wellquite.org>
Message-ID: <31035546.post@talk.nabble.com>


Thanks, Matthew.

I don't really need to delete "/".  So, I'll leave it alone.  

How about the user "guest"?  Can I delete it without any negative effect?

Originally I was planning on "wiping clean" the RabbitMQ server, as a part
of my setup routine.  I was doing this:

1. Delete all default exchanges.
2. Delete the default virtual host "/".
3. Delete the user "guest".

I think I still need to delete the user "guest".  This is to prevent
unauthorized use of the messaging system.  

I will leave the default virtual host "/" alone, as well as the default
exchanges.  (IIRC, deleting default exchanges resulted in more obvious
errors in the log.)

Michi Oshima

-- 
View this message in context: http://old.nabble.com/gen_event-handler-rabbit_error_logger-crashed.-Reason-badarg-tp30593834p31035546.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From pdezwart at rubiconproject.com  Mon Feb 28 21:15:23 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 28 Feb 2011 13:15:23 -0800
Subject: [rabbitmq-discuss] Building a recent rabbitmq-c with 0-8 protocol
Message-ID: <C991506B.18E05%pdezwart@rubiconproject.com>

Hey everyone,

I sincerely hope that this is stupid question with an easy answer. I am
trying to build a somewhat recent version of the rabbitmq-c library to use
with the PHP extension, but that uses the 0-8 protocol since our production
broker is still 1.7.2 (working on upgrading that, but that?s a separate
discussion.)

To do so, I edited the configure file to point to the amqp-rabbitmq-0.8.json
codegen spec, changed the Makefile to not build tools, examples and tests
(those broke,) and tried to un it. According to my server however, its still
trying to use 0-9-1 (Expected 0x000A000A method frame on channel 0, got
frame type 65)

Should this have worked? Am I maybe just installing this wrong? I cleaned
out all librabbitmq.so files and symlinks, so I doubt its the problem, but I
am looking for a sanity check here.

Thanks,
Pieter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110228/2aff97ee/attachment.htm>

From mikeb at rabbitmq.com  Mon Feb 28 21:57:39 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Mon, 28 Feb 2011 21:57:39 +0000
Subject: [rabbitmq-discuss] Clustering over a WAN
In-Reply-To: <AANLkTimTG8dxLWvS0oWnC9VQA88anrDymJORP8xjP0Cu@mail.gmail.com>
References: <A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>	<20110228155125.GC32701@rabbitmq.com>	<BED156B9-E9DC-428C-88BF-C74EEA5F0FB1@jbrisbin.com>	<229274F1-CA00-455E-9FEF-66C42CB261D9@vmware.com>
	<AANLkTimTG8dxLWvS0oWnC9VQA88anrDymJORP8xjP0Cu@mail.gmail.com>
Message-ID: <4D6C1A53.1050701@rabbitmq.com>

> Another approach is to create federation models in new exchange
> types.

Why have new exchange types -- why not just federate those that exist
already?

> On Mon, Feb 28, 2011 at 5:26 PM, John
> DeTreville<jdetreville at vmware.com>  wrote:
>> Yes, but...
>>
>> Some users want geographic distribution, and while that's pretty
>> much impossible in Mnesia (which even so is already a distributed
>> database!), it doesn't become a whole lot easier with a different
>> distributed database.
>>
>> One possible approach to building a geographically distributed
>> messaging system (possibly as an eventual successor or supplement
>> to RabbitMQ) would be to provide eventual consistency instead of
>> the stronger consistency currently provided, perhaps building it on
>> top of an appropriate eventual-consistency database system. This
>> would unfortunately require pervasive changes in the queuing API.
>>
>> In my spare time, I've been thinking a little about the design of
>> such an API, and I'll post some more details shortly.
>>
>> Cheers, John
>>
>> On Feb 28, 2011, at 8:37, "Jon Brisbin"<jon at jbrisbin.com>  wrote:
>>
>>> Would any of these issues be resolved by using a distributed K/V
>>> store as the backend for both messages and metadata? I know the
>>> internals of using mnesia to store all that metadata can't easily
>>> be abstracted, but if you didn't have that particular hurdle to
>>> jump, would that make clustering any easier?
>>>
>>> Jon Brisbin
>>>
>>> http://jbrisbin.com Twitter: @j_brisbin
>>>
>>>
>>> On Feb 28, 2011, at 9:51 AM, Matthew Sackman wrote:
>>>
>>>> On Mon, Feb 28, 2011 at 03:27:42PM +0000, Chris Hampson wrote:
>>>>> We're currently attempting to maintain a RabbitMQ cluster
>>>>> over a WAN between some of our sites, 2 in the US, one in the
>>>>> UK and another in India.
>>>>
>>>> That's a bad idea.
>>>>
>>>>> For the most part this seems to be working fine, but it seems
>>>>> a little fragile and we can't seem to get it to recover from
>>>>> failures very well.
>>>>
>>>> Correct. Mnesia, which Rabbit uses to store all sorts of data
>>>> (though not messages), copes poorly with network partitions.
>>>>
>>>>> If anyone can provide any advice to aid our situation we'd be
>>>>> most grateful (even if it is "don't do that you loony,
>>>>> separate them out and shovel messages between sites when
>>>>> necessary")
>>>>
>>>> Yeah, the latter's a fair summary of my advice on this ;) We do
>>>> state quite prominantly that clustering is not for HA, though I
>>>> admit we state it on http://www.rabbitmq.com/pacemaker.html
>>>> rather than http://www.rabbitmq.com/clustering.html which is
>>>> not really as helpful as it could be.
>>>>
>>>> The problem is that mnesia, and by extension Rabbit, goes for
>>>> the Consistency and Availability part of the CAP triangle, and
>>>> so just does not cope well with partitions ocurring.
>>>> http://en.wikipedia.org/wiki/CAP_theorem
>>>>
>>>> We are working on solving some of these problems in a number
>>>> of different ways. If the shovel is a viable solution then I'd
>>>> recommend you use that, otherwise please let us know some more
>>>> details of your use case and we should be able to advise
>>>> further.
>>>>
>>>> Best wishes,
>>>>
>>>> Matthew _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>>
>>>
>>>>
_______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>>
_______________________________________________
>> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>>
_______________________________________________
> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexis at rabbitmq.com  Mon Feb 28 21:59:56 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 28 Feb 2011 21:59:56 +0000
Subject: [rabbitmq-discuss] Clustering over a WAN
In-Reply-To: <4D6C1A53.1050701@rabbitmq.com>
References: <A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>
	<20110228155125.GC32701@rabbitmq.com>
	<BED156B9-E9DC-428C-88BF-C74EEA5F0FB1@jbrisbin.com>
	<229274F1-CA00-455E-9FEF-66C42CB261D9@vmware.com>
	<AANLkTimTG8dxLWvS0oWnC9VQA88anrDymJORP8xjP0Cu@mail.gmail.com>
	<4D6C1A53.1050701@rabbitmq.com>
Message-ID: <AANLkTinAOQZwyuTyhys_ixyk3g8EGW-NS30v+OWNjR1d@mail.gmail.com>

On Mon, Feb 28, 2011 at 9:57 PM, Michael Bridgen <mikeb at rabbitmq.com> wrote:
>> Another approach is to create federation models in new exchange
>> types.
>
> Why have new exchange types -- why not just federate those that exist
> already?

Yes, that would be spiff too.




>
>> On Mon, Feb 28, 2011 at 5:26 PM, John
>> DeTreville<jdetreville at vmware.com> ?wrote:
>>>
>>> Yes, but...
>>>
>>> Some users want geographic distribution, and while that's pretty
>>> much impossible in Mnesia (which even so is already a distributed
>>> database!), it doesn't become a whole lot easier with a different
>>> distributed database.
>>>
>>> One possible approach to building a geographically distributed
>>> messaging system (possibly as an eventual successor or supplement
>>> to RabbitMQ) would be to provide eventual consistency instead of
>>> the stronger consistency currently provided, perhaps building it on
>>> top of an appropriate eventual-consistency database system. This
>>> would unfortunately require pervasive changes in the queuing API.
>>>
>>> In my spare time, I've been thinking a little about the design of
>>> such an API, and I'll post some more details shortly.
>>>
>>> Cheers, John
>>>
>>> On Feb 28, 2011, at 8:37, "Jon Brisbin"<jon at jbrisbin.com> ?wrote:
>>>
>>>> Would any of these issues be resolved by using a distributed K/V
>>>> store as the backend for both messages and metadata? I know the
>>>> internals of using mnesia to store all that metadata can't easily
>>>> be abstracted, but if you didn't have that particular hurdle to
>>>> jump, would that make clustering any easier?
>>>>
>>>> Jon Brisbin
>>>>
>>>> http://jbrisbin.com Twitter: @j_brisbin
>>>>
>>>>
>>>> On Feb 28, 2011, at 9:51 AM, Matthew Sackman wrote:
>>>>
>>>>> On Mon, Feb 28, 2011 at 03:27:42PM +0000, Chris Hampson wrote:
>>>>>>
>>>>>> We're currently attempting to maintain a RabbitMQ cluster
>>>>>> over a WAN between some of our sites, 2 in the US, one in the
>>>>>> UK and another in India.
>>>>>
>>>>> That's a bad idea.
>>>>>
>>>>>> For the most part this seems to be working fine, but it seems
>>>>>> a little fragile and we can't seem to get it to recover from
>>>>>> failures very well.
>>>>>
>>>>> Correct. Mnesia, which Rabbit uses to store all sorts of data
>>>>> (though not messages), copes poorly with network partitions.
>>>>>
>>>>>> If anyone can provide any advice to aid our situation we'd be
>>>>>> most grateful (even if it is "don't do that you loony,
>>>>>> separate them out and shovel messages between sites when
>>>>>> necessary")
>>>>>
>>>>> Yeah, the latter's a fair summary of my advice on this ;) We do
>>>>> state quite prominantly that clustering is not for HA, though I
>>>>> admit we state it on http://www.rabbitmq.com/pacemaker.html
>>>>> rather than http://www.rabbitmq.com/clustering.html which is
>>>>> not really as helpful as it could be.
>>>>>
>>>>> The problem is that mnesia, and by extension Rabbit, goes for
>>>>> the Consistency and Availability part of the CAP triangle, and
>>>>> so just does not cope well with partitions ocurring.
>>>>> http://en.wikipedia.org/wiki/CAP_theorem
>>>>>
>>>>> We are working on solving some of these problems in a number
>>>>> of different ways. If the shovel is a viable solution then I'd
>>>>> recommend you use that, otherwise please let us know some more
>>>>> details of your use case and we should be able to advise
>>>>> further.
>>>>>
>>>>> Best wishes,
>>>>>
>>>>> Matthew _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>>
>>>>
>>>>>
> _______________________________________________
>>>>
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>>
> _______________________________________________
>>>
>>> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>>
> _______________________________________________
>>
>> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthew at rabbitmq.com  Mon Feb 28 22:05:23 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 28 Feb 2011 22:05:23 +0000
Subject: [rabbitmq-discuss] gen_event handler rabbit_error_logger
 crashed. Reason badarg
In-Reply-To: <31035546.post@talk.nabble.com>
References: <AANLkTikxzE04_yY=VyaYHw4dq_731hE_frZHgKBB+0ox@mail.gmail.com>
	<4D26E040.4080207@rabbitmq.com> <31017300.post@talk.nabble.com>
	<20110226110529.GA26515@wellquite.org>
	<31035546.post@talk.nabble.com>
Message-ID: <20110228220522.GA24275@wellquite.org>

On Mon, Feb 28, 2011 at 12:50:38PM -0800, Michi Oshima wrote:
> How about the user "guest"?  Can I delete it without any negative effect?

Yes, that'll be fine.

> Originally I was planning on "wiping clean" the RabbitMQ server, as a part
> of my setup routine.  I was doing this:
> 
> 1. Delete all default exchanges.
> 2. Delete the default virtual host "/".
> 3. Delete the user "guest".
> 
> I think I still need to delete the user "guest".  This is to prevent
> unauthorized use of the messaging system.  

Sure. It's actually illegal to delete the default exchanges IIRC. Not
that I think anyone'll prosecute, but I'm pretty sure it just won't
work.

Best wishes,

Matthew

From david at rabbitmq.com  Mon Feb 28 22:26:50 2011
From: david at rabbitmq.com (David Wragg)
Date: Mon, 28 Feb 2011 22:26:50 +0000
Subject: [rabbitmq-discuss] Building a recent rabbitmq-c with 0-8
	protocol
In-Reply-To: <C991506B.18E05%pdezwart@rubiconproject.com> (Pieter de Zwart's
	message of "Mon, 28 Feb 2011 13:15:23 -0800")
References: <C991506B.18E05%pdezwart@rubiconproject.com>
Message-ID: <yrv4cfwr7aj85.fsf@dwragg.eng.vmware.com>

Hi Pieter,

Pieter de Zwart <pdezwart at rubiconproject.com> writes:
> I sincerely hope that this is stupid question with an easy answer. I am
> trying to build a somewhat recent version of the rabbitmq-c library to use
> with the PHP extension, but that uses the 0-8 protocol since our production
> broker is still 1.7.2 (working on upgrading that, but that?s a separate
> discussion.)
>
> To do so, I edited the configure file to point to the amqp-rabbitmq-0.8.json
> codegen spec, changed the Makefile to not build tools, examples and tests
> (those broke,) and tried to un it. According to my server however, its still
> trying to use 0-9-1 (Expected 0x000A000A method frame on channel 0, got
> frame type 65)
>
> Should this have worked? Am I maybe just installing this wrong? I cleaned
> out all librabbitmq.so files and symlinks, so I doubt its the problem, but I
> am looking for a sanity check here.

There is no intention for this to work.  There are AMQP
version-dependent areas outside of the generated code.  You can see the
complete changes that were involved in the switch of the C client to
0-9-1 at <http://hg.rabbitmq.com/rabbitmq-c/rev/168205522459>.

With that said, it's probably not that difficult to revert the changes.
If you don't care about the changes outside of librabbitmq/, and you
discard the changes to code that wasn't generated back then but is now,
it looks to me like there are only a couple of changes relevant (to
librabbitmq/amqp_socket.c and librabbitmq/codegen.py).

Perhaps we should be gratified that people are still running the 1.7.2
broker in production.  But I'd strongly recommend you upgrade at the
earliest opportunity, both for the many enhancements and for the bug
fixes.  You do know that old 0-8 clients can still talk to the latest
versions of the broker, so you don't have to upgrade your whole AMQP 0-8
infrastructure at once?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From bogus@does.not.exist.com  Mon Feb 21 11:07:19 2011
From: bogus@does.not.exist.com ()
Date: Mon, 21 Feb 2011 11:07:19 -0000
Subject: No subject
Message-ID: <mailman.0.1299189742.14905.rabbitmq-discuss@lists.rabbitmq.com>

ubuntu at rabbit2:~$ sudo rabbitmqctl list_queues name messages durable
Listing queues ...
jiggleflop    1       false
...done.
ubuntu at rabbit2:~$ irb -rubygems -rbunny
irb(main):001:0> (b=Bunny.new).start
=> :connected
irb(main):002:0> b.queue('jiggleflop').pop[:payload]
=> "hello"
irb(main):003:0> exit

So far so good.  Now, I stop rabbit back on the node where I created the queue:

ubuntu at rabbit1:~$ sudo rabbitmqctl stop_app
Stopping node rabbit at rabbit1 ...
...done.

And look again from the other side:

ubuntu at rabbit2:~$ sudo rabbitmqctl list_queues
Listing queues ...
...done.
ubuntu at rabbit2:~$

OK, the queue's gone. It wasn't durable, so  I should have the
all-clear to declare and recreate it?

ubuntu at rabbit2:~$ irb -rubygems -rbunny
irb(main):001:0> (b=Bunny.new).start
=> :connected
irb(main):002:0> b.queue('jiggleflop')
Bunny::ForcedConnectionCloseError: Error Reply Code: 541
Error Reply Text: INTERNAL_ERROR

Not only can I not declare the queue, but even trying to do so has
hosed my connection to Rabbit:

irb(main):003:0> b.queue('flappydoodle')
Bunny::ConnectionError: Not connected to server

If I reconnect, I can declare a different queue:

irb(main):004:0> (b=Bunny.new).start
=> :connected
irb(main):005:0> b.queue('flappydoodle').publish("booya!")
nil

But still not the one that used to exist on the downed node:

irb(main):006:0> b.queue('jiggleflop')
Bunny::ForcedConnectionCloseError: Error Reply Code: 541
Error Reply Text: INTERNAL_ERROR

Below is the contents of rabbit at rabbit2.log corresponding to the above message.

=ERROR REPORT==== 3-Mar-2011::16:30:43 ===
** Generic server <0.31140.23> terminating
** Last message in was {init,false}
** When Server state == {q,{amqqueue,{resource,<<"/">>,queue,<<"jiggleflop">>},
                                     false,false,none,[],<0.31140.23>},
                           none,false,rabbit_variable_queue,undefined,
                           {[],[]},
                           {[],[]},
                           undefined,undefined,undefined,undefined,
                           {state,fine,undefined},
                           {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},
                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                           undefined,undefined}
** Reason for termination ==
** {bad_return_value,
       {error,
           {badarg,
               [{erlang,is_process_alive,[<3039.17457.20>]},
                {rabbit_amqqueue,'-internal_declare/2-fun-3-',2},
                {rabbit_misc,'-execute_mnesia_tx_with_tail/1-fun-0-',1},
                {mnesia_tm,apply_fun,3},
                {mnesia_tm,execute_transaction,5},
                {worker_pool_worker,handle_call,3},
                {gen_server2,handle_msg,2},
                {proc_lib,wake_up,3}]}}}

=ERROR REPORT==== 3-Mar-2011::16:30:43 ===
** Generic server <0.31098.23> terminating
** Last message in was {'$gen_cast',
                           {method,
                               {'queue.declare',1,<<"jiggleflop">>,false,
                                   false,false,false,false,[]},
                               none}}
** When Server state == {ch,running,1,<0.31095.23>,<0.31097.23>,undefined,
                            #Fun<rabbit_channel_sup.0.123274458>,none,
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            1,
                            {[],[]},
                            {[],[]},
                            {user,<<"guest">>,true,
                                rabbit_auth_backend_internal,
                                {internal_user,<<"guest">>,
                                    <<167,104,147,29,51,174,238,60,197,220,53,
                                      95,33,74,109,229,87,242,107,47>>,
                                    true}},
                            <<"/">>,<<>>,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            <0.31093.23>,
                            {state,fine,undefined},
                            false,1,
                            {0,nil},
                            []}
** Reason for termination ==
** {{{bad_return_value,
         {error,
             {badarg,
                 [{erlang,is_process_alive,[<3039.17457.20>]},
                  {rabbit_amqqueue,'-internal_declare/2-fun-3-',2},
                  {rabbit_misc,'-execute_mnesia_tx_with_tail/1-fun-0-',1},
                  {mnesia_tm,apply_fun,3},
                  {mnesia_tm,execute_transaction,5},
                  {worker_pool_worker,handle_call,3},
                  {gen_server2,handle_msg,2},
                  {proc_lib,wake_up,3}]}}},
     {gen_server2,call,[<0.31140.23>,{init,false}]}},
    [{gen_server2,call,2},
     {rabbit_amqqueue,declare,5},
     {rabbit_channel,handle_method,3},
     {rabbit_channel,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,wake_up,3}]}

=ERROR REPORT==== 3-Mar-2011::16:30:43 ===
connection <0.31095.23> (running), channel 1 - error:
{{{bad_return_value,
      {error,
          {badarg,
              [{erlang,is_process_alive,[<3039.17457.20>]},
               {rabbit_amqqueue,'-internal_declare/2-fun-3-',2},
               {rabbit_misc,'-execute_mnesia_tx_with_tail/1-fun-0-',1},
               {mnesia_tm,apply_fun,3},
               {mnesia_tm,execute_transaction,5},
               {worker_pool_worker,handle_call,3},
               {gen_server2,handle_msg,2},
               {proc_lib,wake_up,3}]}}},
  {gen_server2,call,[<0.31140.23>,{init,false}]}},
 [{gen_server2,call,2},
  {rabbit_amqqueue,declare,5},
  {rabbit_channel,handle_method,3},
  {rabbit_channel,handle_cast,2},
  {gen_server2,handle_msg,2},
  {proc_lib,wake_up,3}]}

=WARNING REPORT==== 3-Mar-2011::16:30:43 ===
Non-AMQP exit reason '{{{bad_return_value,
                         {error,
                          {badarg,
                           [{erlang,is_process_alive,[<3039.17457.20>]},
                            {rabbit_amqqueue,'-internal_declare/2-fun-3-',2},
                            {rabbit_misc,
                             '-execute_mnesia_tx_with_tail/1-fun-0-',1},
                            {mnesia_tm,apply_fun,3},
                            {mnesia_tm,execute_transaction,5},
                            {worker_pool_worker,handle_call,3},
                            {gen_server2,handle_msg,2},
                            {proc_lib,wake_up,3}]}}},
                        {gen_server2,call,[<0.31140.23>,{init,false}]}},
                       [{gen_server2,call,2},
                        {rabbit_amqqueue,declare,5},
                        {rabbit_channel,handle_method,3},
                        {rabbit_channel,handle_cast,2},
                        {gen_server2,handle_msg,2},
                        {proc_lib,wake_up,3}]}'

=INFO REPORT==== 3-Mar-2011::16:30:43 ===
closing TCP connection <0.31095.23> from 127.0.0.1:39949

From bogus@does.not.exist.com  Mon Feb 21 11:07:19 2011
From: bogus@does.not.exist.com ()
Date: Mon, 21 Feb 2011 11:07:19 -0000
Subject: No subject
Message-ID: <mailman.1.1299687041.14905.rabbitmq-discuss@lists.rabbitmq.com>

d limit to the number of virtual hosts that can be configured within a Rabb=
itMQ cluster, save available disk and memory resources.

Is this true for a crazy number of virtual hosts, say 10,000?  And there's =
no performance cost for this?  Can anyone offer a success story? =20

Thanks,
Brian=

From bogus@does.not.exist.com  Mon Feb 21 11:07:19 2011
From: bogus@does.not.exist.com ()
Date: Mon, 21 Feb 2011 11:07:19 -0000
Subject: No subject
Message-ID: <mailman.2.1299687112.14905.rabbitmq-discuss@lists.rabbitmq.com>

d limit to the number of virtual hosts that can be configured within a Rabb=
itMQ cluster, save available disk and memory resources.

Is this true for a crazy number of virtual hosts, say 10,000?  And there's =
no performance cost for this?  Can anyone offer a success story? =20

Thanks,
Brian


From bogus@does.not.exist.com  Mon Feb 21 11:07:19 2011
From: bogus@does.not.exist.com ()
Date: Mon, 21 Feb 2011 11:07:19 -0000
Subject: No subject
Message-ID: <mailman.3.1299764185.14905.rabbitmq-discuss@lists.rabbitmq.com>

exclusive queues, is that correct? I've tried creating a named,
durable queue for all consumers to read from, but in this case the
message can only be consumed once.

Is there something I'm missing?

Thank you.

On Thu, Mar 3, 2011 at 22:07, Michael Bridgen <mikeb at rabbitmq.com> wrote:
> Fabio,
>
> Aces, glad to hear it's working for you thus far.
>
> On this:
>
>> Just a final question: the previous README file on github said
>> something about including the plugin on the main RabbitMQ code, but I
>> figured this had been written some time ago because it mentioned
>> version 1.7.1. Is this still in your (and RabbitMQ developers) plans?
>> Best regards.
>
> =A0-- I was referring to the exchange plugin mechanism overall, on which =
I was
> finishing (largely other people's!) work at the time. =A0That mechanism h=
as
> been in mainstream rabbitmq since then, and has changed a bit, but is pre=
tty
> stable.
>
> The Last Value Caching exchange will likely stay a plugin for the
> foreseeable future, rather than being baked into rabbitmq-server. =A0But =
if
> you follow this list you'll know this is not the last word ..
>
> Michael
>
>>> Oh. =A0Looks like github's upload and download system is totally broken=
.
>>> (I've
>>> now tried to upload it a few times).
>>>
>>> I've attached the ez so it can be stopped by mail filters instead.
>>
>> Hi Michael.
>> Sorry for the extra trouble.
>>
>> I've now rebooted my RabbitMQ server and run a few basic tests and
>> everything seems to be working as expected. Thank you again for all
>> your help and your work on the plugin. I'll keep building my test
>> scenarios and I'll let you know if something else comes up.
>>
>> Just a final question: the previous README file on github said
>> something about including the plugin on the main RabbitMQ code, but I
>> figured this had been written some time ago because it mentioned
>> version 1.7.1. Is this still in your (and RabbitMQ developers) plans?
>> Best regards.
>
>

From bogus@does.not.exist.com  Mon Feb 21 11:07:19 2011
From: bogus@does.not.exist.com ()
Date: Mon, 21 Feb 2011 11:07:19 -0000
Subject: No subject
Message-ID: <mailman.4.1299865805.14905.rabbitmq-discuss@lists.rabbitmq.com>

to  /etc/rabbitmq/rabbitmq.conf.d. Any chance when this config file is done
away with a .d type implementation can be made to replace it?

-Brian

--20cf307ca1dc16a0bb049e388ee9
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Many thanks Simon,<div><br></div><div>That did the trick!<br><br><div class=
=3D"gmail_quote"><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8=
ex;border-left:1px #ccc solid;padding-left:1ex;">
<br>
Finally, can I ask what benefit you&#39;re getting from using the old confi=
guration file? We&#39;d like to do away with it at some point, and it would=
 be nice to be sure we weren&#39;t breaking anything :)<br>
<br></blockquote><div><br></div><div>Yes, it&#39;s due to the modularity it=
 provides. =A0Here is my rabbitmq.conf file:</div><div>=A0</div></div><div>=
for CONFIGFILE in `ls /etc/rabbitmq/rabbitmq.conf.d |sort -r`; do</div><div=
>
=A0=A0 =A0. /etc/rabbitmq/rabbitmq.conf.d/$CONFIGFILE</div><div>done</div><=
/div><div><br></div><div>From there each plugin package can just install it=
s snippet to=A0=A0/etc/rabbitmq/rabbitmq.conf.d. Any chance when this confi=
g file is done away with a .d type implementation can be made to replace it=
?</div>
<div><br></div><div>-Brian</div><div><br></div>

--20cf307ca1dc16a0bb049e388ee9--

From bogus@does.not.exist.com  Mon Feb 21 11:07:19 2011
From: bogus@does.not.exist.com ()
Date: Mon, 21 Feb 2011 11:07:19 -0000
Subject: No subject
Message-ID: <mailman.5.1300114914.14905.rabbitmq-discuss@lists.rabbitmq.com>

Basically the system that consumed messages, for some
reason, was too slow. That, obviously, put a lot of stress
on RabbitMQ, and as it was before rabbit 2.0, at some point
Rabbit just died due to out-of-memory situation.

Reddit guys were unhappy to see Rabbit go down, but
in fact Rabbit was not the source of their problems.
It was just a side-effect of something else misbehaving.

Cheers,
  Marek

On Fri, Mar 11, 2011 at 19:30, Marcel Meyer <marcel.meyer at gmail.com> wrote:
> Great!=C2=A0Do you know whether this was documented as some anti-pattern?=
 Is
> there more about the specific issues they faced?
> On Fri, Mar 11, 2011 at 12:13 PM, Alexis Richardson <alexis at rabbitmq.com>
> wrote:
>>
>> Hi Marcel
>>
>> Yes, I believe so. =C2=A0 Matthew went to see them. =C2=A0As I recall th=
e main
>> issues were actually not with Rabbit, but some of how they had used
>> messaging was worth discussing.
>>
>> alexis
>>
>>
>> On Fri, Mar 11, 2011 at 5:07 PM, Marcel Meyer <marcel.meyer at gmail.com>
>> wrote:
>> > Hi there Rabbit Community,
>> > I am researching queues and found this=C2=A0thread about reddit's grip=
es
>> > (http://www.reddit.com/tb/c2spc) and noticed that RabbitMQ Support
>> > reached
>> > out to them.
>> > Were there issues resolved? They upgraded ERTS as a "stopgap" fix, but
>> > wanted to yank the technology all together. Did they?
>> > Regards,
>> > Marcel
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From bogus@does.not.exist.com  Mon Feb 21 11:07:19 2011
From: bogus@does.not.exist.com ()
Date: Mon, 21 Feb 2011 11:07:19 -0000
Subject: No subject
Message-ID: <mailman.6.1300392174.14905.rabbitmq-discuss@lists.rabbitmq.com>

exclusive queues, is that correct? I&#39;ve tried creating a named,<br>
durable queue for all consumers to read from, but in this case the<br>
message can only be consumed once.<br>
<br>
Is there something I&#39;m missing?<br>
<br>
Thank you.<br>
<div><div></div><div class=3D"h5"><br>
On Thu, Mar 3, 2011 at 22:07, Michael Bridgen &lt;<a href=3D"mailto:mikeb at r=
abbitmq.com">mikeb at rabbitmq.com</a>&gt; wrote:<br>
&gt; Fabio,<br>
&gt;<br>
&gt; Aces, glad to hear it&#39;s working for you thus far.<br>
&gt;<br>
&gt; On this:<br>
&gt;<br>
&gt;&gt; Just a final question: the previous README file on github said<br>
&gt;&gt; something about including the plugin on the main RabbitMQ code, bu=
t I<br>
&gt;&gt; figured this had been written some time ago because it mentioned<b=
r>
&gt;&gt; version 1.7.1. Is this still in your (and RabbitMQ developers) pla=
ns?<br>
&gt;&gt; Best regards.<br>
&gt;<br>
&gt; =A0-- I was referring to the exchange plugin mechanism overall, on whi=
ch I was<br>
&gt; finishing (largely other people&#39;s!) work at the time. =A0That mech=
anism has<br>
&gt; been in mainstream rabbitmq since then, and has changed a bit, but is =
pretty<br>
&gt; stable.<br>
&gt;<br>
&gt; The Last Value Caching exchange will likely stay a plugin for the<br>
&gt; foreseeable future, rather than being baked into rabbitmq-server. =A0B=
ut if<br>
&gt; you follow this list you&#39;ll know this is not the last word ..<br>
&gt;<br>
&gt; Michael<br>
&gt;<br>
&gt;&gt;&gt; Oh. =A0Looks like github&#39;s upload and download system is t=
otally broken.<br>
&gt;&gt;&gt; (I&#39;ve<br>
&gt;&gt;&gt; now tried to upload it a few times).<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; I&#39;ve attached the ez so it can be stopped by mail filters =
instead.<br>
&gt;&gt;<br>
&gt;&gt; Hi Michael.<br>
&gt;&gt; Sorry for the extra trouble.<br>
&gt;&gt;<br>
&gt;&gt; I&#39;ve now rebooted my RabbitMQ server and run a few basic tests=
 and<br>
&gt;&gt; everything seems to be working as expected. Thank you again for al=
l<br>
&gt;&gt; your help and your work on the plugin. I&#39;ll keep building my t=
est<br>
&gt;&gt; scenarios and I&#39;ll let you know if something else comes up.<br=
>
&gt;&gt;<br>
&gt;&gt; Just a final question: the previous README file on github said<br>
&gt;&gt; something about including the plugin on the main RabbitMQ code, bu=
t I<br>
&gt;&gt; figured this had been written some time ago because it mentioned<b=
r>
&gt;&gt; version 1.7.1. Is this still in your (and RabbitMQ developers) pla=
ns?<br>
&gt;&gt; Best regards.<br>
&gt;<br>
&gt;<br>
</div></div></blockquote></div><br></div>

--0016e65ae75888dc14049eb30ad3--

From bogus@does.not.exist.com  Mon Feb 21 11:07:19 2011
From: bogus@does.not.exist.com ()
Date: Mon, 21 Feb 2011 11:07:19 -0000
Subject: No subject
Message-ID: <mailman.7.1300995694.14905.rabbitmq-discuss@lists.rabbitmq.com>

"There usually is a few weeks lag between a new release and its
appearance in the central Maven repository. Be patient."

;-)

now to the mailing list too...

On Thu, Mar 24, 2011 at 8:34 PM, Jon Brisbin <jon at jbrisbin.com> wrote:
> Just wondering if the 2.4.0 Java jars are in a Maven repo anywhere? I don't see them in central but didn't know if they were on the SpringSource release repo or something?
>
> I'm working on updating my Log4J appender to work with the latest stuff...
>
> Thanks!
>
> Jon Brisbin
>
> http://jbrisbin.com
> Twitter: @j_brisbin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From bogus@does.not.exist.com  Mon Feb 21 11:07:19 2011
From: bogus@does.not.exist.com ()
Date: Mon, 21 Feb 2011 11:07:19 -0000
Subject: No subject
Message-ID: <mailman.8.1301054764.14905.rabbitmq-discuss@lists.rabbitmq.com>

their focus is the ability to deliver a message immediately and report an
error if they cannot contact the server.

Implementing messaging from a M2M platform, there will be times when there
is no communication between the client and the server...but the application
may still want to submit messages which should be queued until such time as
the "local queue" so to speak can contact the server and delivery the
messages.

In summary, leaving the "retry/retransmission" of message to the
messaging infrastructure...rather then have the application monitor/poll
connectivity to the server.

Is something like this possible?


Thanks
Bruce

--90e6ba6e8be400adb3049f4d6a11
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi<div><br></div><div>I was wondering what others are doing with regards to=
 &quot;queuing&quot; local messages for deliver when the network is availab=
le.</div><div><br></div><div>From my limited experience playing to &quot;ra=
bbitmq-c client&quot; and Python &quot;pika&quot;, their focus is the abili=
ty to deliver a message immediately and report an error if they cannot cont=
act the server.=A0</div>
<div><br></div><div>Implementing messaging from a M2M platform, there will =
be times when there is no communication between the client and the server..=
.but the application may still want to submit messages which should be queu=
ed until such time as the &quot;local queue&quot; so to speak can contact t=
he server and delivery the messages.=A0</div>
<div><br></div><div>In summary, leaving the &quot;retry/retransmission&quot=
; of message to the messaging=A0infrastructure...rather then have the appli=
cation monitor/poll connectivity to the server.</div><div><br></div><div>
Is something like this possible?</div><div><br></div><div><br></div><div>Th=
anks</div><div>Bruce</div><div><br></div><div><br></div><div><br></div><div=
><br></div><div><br></div><div><br></div>

--90e6ba6e8be400adb3049f4d6a11--

From bogus@does.not.exist.com  Mon Feb 21 11:07:19 2011
From: bogus@does.not.exist.com ()
Date: Mon, 21 Feb 2011 11:07:19 -0000
Subject: No subject
Message-ID: <mailman.9.1301348035.14905.rabbitmq-discuss@lists.rabbitmq.com>

reporting by default the maximum file size. You want "ulimit -n"

Matthew

