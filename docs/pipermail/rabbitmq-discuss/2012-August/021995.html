<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Exchange/queue setup question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Exchange/queue%20setup%20question&In-Reply-To=%3CCC57D9D2.1F9D1%25wchrisjohnson%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021994.html">
   <LINK REL="Next"  HREF="022013.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Exchange/queue setup question</H1>
    <B>Chris Johnson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Exchange/queue%20setup%20question&In-Reply-To=%3CCC57D9D2.1F9D1%25wchrisjohnson%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] Exchange/queue setup question">wchrisjohnson at gmail.com
       </A><BR>
    <I>Mon Aug 20 17:10:58 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021994.html">[rabbitmq-discuss] Is it possible to receive multiple messages then return an ACK to Rabbitmq Server?
</A></li>
        <LI>Next message: <A HREF="022013.html">[rabbitmq-discuss] Exchange/queue setup question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21995">[ date ]</a>
              <a href="thread.html#21995">[ thread ]</a>
              <a href="subject.html#21995">[ subject ]</a>
              <a href="author.html#21995">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I need a second pair of eyes on a small RMQ app I'm working on.
I suspect the issue I'm seeing is related to how I am defining my exchanges
and queues.

If I connect with two clients, I'll see every other message appear on my
client. If I connect with three clients, I see every third message, and so
on. In other words, it appears to 1) be deleting every message that gets
produced on consumption, and 2) round robins which consumer gets each
message.

What I want to see is all clients get the same message each time one is
posted.

Is a topic approach the best approach for this, or is fanout the better way
to handle this?

Here's the specifics of how my producer and consumer is set up:


PRODUCER (client=bunny)
=====================

@topic_exchange ||= client.exchange(&quot;internal.platformalert&quot;, :type =&gt;
:<i>topic,
</I>                                    :durable =&gt; true, :autodelete =&gt; false)
@queue ||= client.queue(&quot;internal.platformalert.#&quot;, :durable =&gt; true,
                        :autodelete =&gt; false, :arguments =&gt; {'x-ha-policy'
=&gt; 'all'})
queue.bind(e, :key =&gt; &quot;alert&quot;)
exchange.publish(message, :key =&gt; &quot;alert&quot;, :persistent =&gt; true)


CONSUMER (client=ruby-amqp)
=====================

exchange = channel.topic(&quot;internal.platformalert&quot;, :durable =&gt; true,
:<i>autodelete =&gt; false)
</I>queue    = channel.queue(&quot;internal.platformalert.#&quot;, :durable =&gt; true,
:<i>autodelete =&gt; false,
</I>                       :arguments =&gt; {'x-ha-policy' =&gt; 'all'})
queue.bind(exchange, :routing_key =&gt; &quot;alert&quot;)
queue.subscribe(:ack =&gt; false) do |header, body|
&#138; do stuff
end


Many thanks!

Chris


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120820/6b52062a/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120820/6b52062a/attachment.htm</A>&gt;
</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021994.html">[rabbitmq-discuss] Is it possible to receive multiple messages then return an ACK to Rabbitmq Server?
</A></li>
	<LI>Next message: <A HREF="022013.html">[rabbitmq-discuss] Exchange/queue setup question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21995">[ date ]</a>
              <a href="thread.html#21995">[ thread ]</a>
              <a href="subject.html#21995">[ subject ]</a>
              <a href="author.html#21995">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
