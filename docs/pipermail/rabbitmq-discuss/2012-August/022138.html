<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Shovel restart command hanging
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shovel%20restart%20command%20hanging&In-Reply-To=%3CE94F626F5C43D14F8B8479C5EBD790388A7DDA1D%40vmexchange02.seegrid.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022159.html">
   <LINK REL="Next"  HREF="022139.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Shovel restart command hanging</H1>
    <B>Elizabeth Liao</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shovel%20restart%20command%20hanging&In-Reply-To=%3CE94F626F5C43D14F8B8479C5EBD790388A7DDA1D%40vmexchange02.seegrid.local%3E"
       TITLE="[rabbitmq-discuss] Shovel restart command hanging">eliao at seegrid.com
       </A><BR>
    <I>Mon Aug 27 23:47:37 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022159.html">[rabbitmq-discuss] Fwd: Excessive memory consumption of one server in cluster setup
</A></li>
        <LI>Next message: <A HREF="022139.html">[rabbitmq-discuss] Shovel restart command hanging
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22138">[ date ]</a>
              <a href="thread.html#22138">[ thread ]</a>
              <a href="subject.html#22138">[ subject ]</a>
              <a href="author.html#22138">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Currently we are running Rabbitmq 2.8.2 and are running into some problems with a shovel configuration.  We were running into the shovel wedge issues that was mentioned in another discussion on this mailing list. It appeared to be sometimes resolved by the command: rabbitmqctl eval 'application:stop(rabbitmq_shovel), application:start(rabbitmq_shovel).'  However, other sometimes, executing this command would hang.  

Our other observations were as follows:
  * Executing all rabbit commands were hang (rabbitmqctl status, /etc/init.d/rabbitmq-server status). A control-c breaks out of it
  * Rabbitmq continues to handle all messages  
  * Error messages from logs below
  * I have all all logs and the contents of the MNESIA_BASE directory if needed
 
We noticed that 2.8.6 RabbitMQ contains shovel fixes. Would the new version of RabbitMQ prevent the problems that we're seeing - we know that it will prevent a shovel from getting stuck in the terminated state but is something else also going on?  and if not, what is the recommended fix? 

Thanks!

Liz
---------------
Errors from &lt;nodename&gt;.log:
=ERROR REPORT==== 27-Aug-2012::15:53:17 ===
** Last message in was socket_closed
** When Server state == {state,amqp_network_connection,
                            {state,#Port&lt;0.211307&gt;,5,&lt;0.11430.8&gt;,131072,
                                undefined,false},
                            &lt;0.11417.8&gt;,&lt;0.11420.8&gt;,
                            {amqp_params_network,&lt;&lt;&quot;user1&quot;&gt;&gt;,
                                &lt;&lt;&quot;pass1&quot;&gt;&gt;,&lt;&lt;&quot;/&quot;&gt;&gt;,
                                &quot;host1&quot;,5672,0,0,5,infinity,
                                none,
                                [#Fun&lt;amqp_auth_mechanisms.plain.3&gt;,
                                 #Fun&lt;amqp_auth_mechanisms.amqplain.3&gt;],
                                [],[]},
                            0,
                            [{&lt;&lt;&quot;capabilities&quot;&gt;&gt;,table,
                              [{&lt;&lt;&quot;publisher_confirms&quot;&gt;&gt;,bool,true},
                               {&lt;&lt;&quot;exchange_exchange_bindings&quot;&gt;&gt;,bool,true},
                               {&lt;&lt;&quot;basic.nack&quot;&gt;&gt;,bool,true},
                               {&lt;&lt;&quot;consumer_cancel_notify&quot;&gt;&gt;,bool,true}]},
                             {&lt;&lt;&quot;copyright&quot;&gt;&gt;,longstr,
                              &lt;&lt;&quot;Copyright (C) 2007-2012 VMware, Inc.&quot;&gt;&gt;},
                             {&lt;&lt;&quot;information&quot;&gt;&gt;,longstr,
                              &lt;&lt;&quot;Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/&quot;">http://www.rabbitmq.com/&quot;</A>&gt;&gt;},
                             {&lt;&lt;&quot;platform&quot;&gt;&gt;,longstr,&lt;&lt;&quot;Erlang/OTP&quot;&gt;&gt;},
                             {&lt;&lt;&quot;product&quot;&gt;&gt;,longstr,&lt;&lt;&quot;RabbitMQ&quot;&gt;&gt;},
                             {&lt;&lt;&quot;version&quot;&gt;&gt;,longstr,&lt;&lt;&quot;2.8.2&quot;&gt;&gt;}],
                            #Fun&lt;amqp_connection_sup.0.39273983&gt;,
                            #Fun&lt;amqp_connection_sup.2.54430129&gt;,false}
** Reason for termination == 
** socket_closed_unexpectedly

Output from &lt;nodname&gt;-sasl.log:

=CRASH REPORT==== 27-Aug-2012::15:53:17 ===
  crasher:
    pid: &lt;0.11418.8&gt;
    registered_name: []
    exception exit: socket_closed_unexpectedly
      in function  gen_server:terminate/6
    initial call: amqp_gen_connection:init/1
    ancestors: [&lt;0.11417.8&gt;,amqp_sup,&lt;0.201.0&gt;]
    messages: []
    links: [&lt;0.11416.8&gt;,&lt;0.11417.8&gt;,#Port&lt;0.211307&gt;]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 610
    stack_size: 23
    reductions: 782
  neighbours:

=SUPERVISOR REPORT==== 27-Aug-2012::15:53:17 ===
     Supervisor: {&lt;0.11417.8&gt;,amqp_connection_sup}
     Context:    child_terminated
     Reason:     socket_closed_unexpectedly
     Offender:   [{pid,&lt;0.11418.8&gt;},
                  {name,connection},
                  {mfa,
                      {amqp_gen_connection,start_link,
                          [amqp_network_connection,
                           {amqp_params_network,&lt;&lt;&quot;user1&quot;&gt;&gt;,
                               &lt;&lt;&quot;pass1&quot;&gt;&gt;,&lt;&lt;&quot;/&quot;&gt;&gt;,
                               &quot;host1&quot;,5672,0,0,5,infinity,
                               none,
                               [#Fun&lt;amqp_auth_mechanisms.plain.3&gt;,
                                #Fun&lt;amqp_auth_mechanisms.amqplain.3&gt;],
                               [],[]},
                           #Fun&lt;amqp_connection_sup.0.39273983&gt;,
                           #Fun&lt;amqp_connection_sup.2.54430129&gt;,[]]}},
                  {restart_type,intrinsic},
                  {shutdown,brutal_kill},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 27-Aug-2012::15:53:17 ===
     Supervisor: {&lt;0.11417.8&gt;,amqp_connection_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,&lt;0.11418.8&gt;},
                  {name,connection},
                  {mfa,
                      {amqp_gen_connection,start_link,
                          [amqp_network_connection,
                           {amqp_params_network,&lt;&lt;&quot;user1&quot;&gt;&gt;,
                               &lt;&lt;&quot;pass1&quot;&gt;&gt;,&lt;&lt;&quot;/&quot;&gt;&gt;,
                               &quot;host1&quot;,5672,0,0,5,infinity,
                               none,
                               [#Fun&lt;amqp_auth_mechanisms.plain.3&gt;,
                                #Fun&lt;amqp_auth_mechanisms.amqplain.3&gt;],
                               [],[]},
                           #Fun&lt;amqp_connection_sup.0.39273983&gt;,
                           #Fun&lt;amqp_connection_sup.2.54430129&gt;,[]]}},
                  {restart_type,intrinsic},
                  {shutdown,brutal_kill},
                  {child_type,worker}]
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022159.html">[rabbitmq-discuss] Fwd: Excessive memory consumption of one server in cluster setup
</A></li>
	<LI>Next message: <A HREF="022139.html">[rabbitmq-discuss] Shovel restart command hanging
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22138">[ date ]</a>
              <a href="thread.html#22138">[ thread ]</a>
              <a href="subject.html#22138">[ subject ]</a>
              <a href="author.html#22138">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
