<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] How to achieve HA consumers?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20achieve%20HA%20consumers%3F&In-Reply-To=%3C87pq67gv2x.wl%25francesco%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022120.html">
   <LINK REL="Next"  HREF="022207.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] How to achieve HA consumers?</H1>
    <B>Francesco Mazzoli</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20achieve%20HA%20consumers%3F&In-Reply-To=%3C87pq67gv2x.wl%25francesco%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] How to achieve HA consumers?">francesco at rabbitmq.com
       </A><BR>
    <I>Fri Aug 31 12:27:34 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022120.html">[rabbitmq-discuss] How to achieve HA consumers?
</A></li>
        <LI>Next message: <A HREF="022207.html">[rabbitmq-discuss] How to achieve HA consumers?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22205">[ date ]</a>
              <a href="thread.html#22205">[ thread ]</a>
              <a href="subject.html#22205">[ subject ]</a>
              <a href="author.html#22205">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

This is done easily by having acks enabled.  When the first consumer dies, the
unacked messages will be requeued, and the second consumer can start consuming.

Now, the only issues is for the second consumer to find out when to start
consuming.  This can be done in a multitude of ways, but we'll propose two:

  * The second consumer polls the first in some way and starts consuming when it
    realises the first consumer is dead.  This is simple and should serve you
    right, but it's not that nice performance wise.

  * You create a second queue that we'll call &quot;token queue&quot;, and you publish one
    dummy message in it, with acks enabled.  Then, a consumer wishing to consume
    from your queue, will:

      - Consume from the token queue
      - Start consuming from the actual queue
      - When shutting down, publish a dummy message to the token queue

    In this way your token queue will act a semaphore that will guarantee
    exclusive access to the queue.  When a consumer die, the message in the
    token queue will be requeued, and the next consumer will be able to consume
    it and then start consuming from the other queue.

    This method scales to an arbitrary number of consumers.

I hope this suggestions help.

--
Francesco * Often in error, never in doubt
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022120.html">[rabbitmq-discuss] How to achieve HA consumers?
</A></li>
	<LI>Next message: <A HREF="022207.html">[rabbitmq-discuss] How to achieve HA consumers?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22205">[ date ]</a>
              <a href="thread.html#22205">[ thread ]</a>
              <a href="subject.html#22205">[ subject ]</a>
              <a href="author.html#22205">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
