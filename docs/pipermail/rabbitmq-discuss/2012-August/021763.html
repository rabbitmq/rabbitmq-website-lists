<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20TCP%20Backpressure%20/%20Flow%20Control%20in%20C%23%0A%20producer&In-Reply-To=%3CF216F12DEE15B7429FB03C58643375521C4C38FA%40AMXPRD0410MB377.eurprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021761.html">
   <LINK REL="Next"  HREF="021766.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer</H1>
    <B>Ulli Berthold - Exactag GmbH</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20TCP%20Backpressure%20/%20Flow%20Control%20in%20C%23%0A%20producer&In-Reply-To=%3CF216F12DEE15B7429FB03C58643375521C4C38FA%40AMXPRD0410MB377.eurprd04.prod.outlook.com%3E"
       TITLE="[rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer">berthold at exactag.com
       </A><BR>
    <I>Wed Aug  8 09:35:01 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021761.html">[rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer
</A></li>
        <LI>Next message: <A HREF="021766.html">[rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21763">[ date ]</a>
              <a href="thread.html#21763">[ thread ]</a>
              <a href="subject.html#21763">[ subject ]</a>
              <a href="author.html#21763">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias,

Rabbit does handle it, yes, but it slows down the inbound messages at some point (like several million messages in queue, with lots of disk space still available).

And we are using rabbit so we don't have to implement our very own queueing system which would likely just add much more complexity, again, we're talking millions of messages per hour. Just a single minute of backlog in the local queue means 30.000+ messages stored locally... We considered RabbitMQ / Shovel but I'm not too sure that would keep up with the load.

We would love a way to disable (or better, suppress) the whole backpressure system until the server is really at its memory and disk limit. Currently it seems to partially depend on the processing speed of the queue readers and the queue sizes. Again, an alternative to just know when backpressure is applied would help us too because we could temporarily send the next messages through an alternate route. An in-program queue would definitely increase complexity almost beyond the point of usefulness of the queueing system - why use an existing one if I got to build one anyways?

Regards

Ulli

-----Urspr&#252;ngliche Nachricht-----
Von: Matthias Radestock [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>] 
Gesendet: Mittwoch, 8. August 2012 10:21
An: Ulli Berthold - Exactag GmbH
Cc: Discussions about RabbitMQ
Betreff: Re: AW: AW: [rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer

Ulli,

On 08/08/12 09:03, Ulli Berthold - Exactag GmbH wrote:
&gt;<i> My problem is that we are talking web tracking here, so it's at least
</I>&gt;<i> 500 events per second, originating from 4 different web servers 
</I>&gt;<i> running 8 threads each on average. Data stream will increase to over 
</I>&gt;<i> 3.000/s as soon as we can handle that load.
</I>
RabbitMQ should be able to handle that easily, even when writing to disk.

&gt;<i> The basic understanding
</I>&gt;<i> so far was that rabbit would cache the message queue on disk when 
</I>&gt;<i> there is too much incoming data, so we could use the quieter night 
</I>&gt;<i> times to handle the data that didn't make it in time.
</I>
Right.

&gt;<i> I didn't see an easy way to check the queue length, except maybe for 
</I>&gt;<i> rest requests?
</I>
I wasn't talking about an AMQP queue. I suggested that at the client you have the following setup:

publisher thread -&gt; .net queue -&gt; shoveling thread

The helper thread pulls items off the .net queue and publishes them to RabbitMQ. The publisher thread can look at the queue's length before deciding whether to place another item in it or write to disk. 
Effectively the length of the .net queue becomes a measure of the TCP back pressure experienced by the shoveling thread.

Matthias.


</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021761.html">[rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer
</A></li>
	<LI>Next message: <A HREF="021766.html">[rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21763">[ date ]</a>
              <a href="thread.html#21763">[ thread ]</a>
              <a href="subject.html#21763">[ subject ]</a>
              <a href="author.html#21763">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
