<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] request, reply connections and channels
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20request%2C%20reply%20connections%20and%20channels&In-Reply-To=%3C501F9EF0.7040506%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021726.html">
   <LINK REL="Next"  HREF="021734.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] request, reply connections and channels</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20request%2C%20reply%20connections%20and%20channels&In-Reply-To=%3C501F9EF0.7040506%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] request, reply connections and channels">emile at rabbitmq.com
       </A><BR>
    <I>Mon Aug  6 11:39:44 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021726.html">[rabbitmq-discuss] request, reply connections and channels
</A></li>
        <LI>Next message: <A HREF="021734.html">[rabbitmq-discuss] request, reply connections and channels
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21730">[ date ]</a>
              <a href="thread.html#21730">[ thread ]</a>
              <a href="subject.html#21730">[ subject ]</a>
              <a href="author.html#21730">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

On 06/08/12 04:44, cogitate wrote:
&gt;<i> i'd like to throw an exception/error when basicPublish is called on a
</I>&gt;<i> non-existent exchange [on the broker].
</I>&gt;<i> it seems setting mandatory=true, and registering a returnListener on the
</I>&gt;<i> channel won't work (since, the connection for req and reply are different )
</I>
The mandatory option is relevant when a message cannot be routed to a
queue. Attempting to publish to a non-existent exchange is a very
different issue and the return-listener is not used to report this
condition.

&gt;<i> what are my options besides switching to using the same connection for
</I>&gt;<i> req/reply? any configuration on the broker that might help will be quite
</I>&gt;<i> useful.
</I>
A possible option is to guarantee that the exchange cannot be absent.
Assign permissions in a way that guarantees exchanges cannot be deleted.

Another option is to use publisher confirms:
www.rabbitmq.com/extensions.html#confirms
These should inform the client of a channel exception, though I don't
know exactly how this gets reported in Pika.

&gt;<i> # using python client:
</I>&gt;<i> not sure why, but it simply works! i don't even set mandatory=true. the pika
</I>&gt;<i> client simply doesn't allow me to publish to a non-existent exchange on the
</I>&gt;<i> broker.
</I>
I'm not familiar enough with Pika to explain this, but regardless of the
AMQP client you choose to use, is is impossible to use the same channel
to do useful work after a channel exception was raised. The mandatory
flag is unlikely to play any part.

&gt;<i>  it seems i can solve the problem by
</I>&gt;<i> reqChannel.exchangeDeclarePassive(&lt;non_existent_exchange&gt;)
</I>&gt;<i> is this advisable for every call from a performance point-of-view?
</I>
When you publish to a non-existent exchange a channel exception is
raised, closing the channel. Publishing is an asynchronous operation, so
the caller is unaware of this until the next synchronous operation.
Issuing an exchange passive declare is a synchronous operation which
will alert the caller if the channel has closed. You could use any other
synchronous operation.

Interspersing publishes with synchronous operations is likely to reduce
the maximum possible publish speed dramatically.


-Emile
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021726.html">[rabbitmq-discuss] request, reply connections and channels
</A></li>
	<LI>Next message: <A HREF="021734.html">[rabbitmq-discuss] request, reply connections and channels
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21730">[ date ]</a>
              <a href="thread.html#21730">[ thread ]</a>
              <a href="subject.html#21730">[ subject ]</a>
              <a href="author.html#21730">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
