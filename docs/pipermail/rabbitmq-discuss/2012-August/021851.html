<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] When I declared mirrored queues using spring-rabbit API, one of them is sometimes failed.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20When%20I%20declared%20mirrored%20queues%20using%0A%20spring-rabbit%20API%2C%20one%20of%20them%20is%20sometimes%20failed.&In-Reply-To=%3CCA%2B_TFtGzfYZu%3DWSxs0Sk1XYFPsVXZWVO6uWopEfQjJLYPhqqUw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022014.html">
   <LINK REL="Next"  HREF="021856.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] When I declared mirrored queues using spring-rabbit API, one of them is sometimes failed.</H1>
    <B>Min Cha</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20When%20I%20declared%20mirrored%20queues%20using%0A%20spring-rabbit%20API%2C%20one%20of%20them%20is%20sometimes%20failed.&In-Reply-To=%3CCA%2B_TFtGzfYZu%3DWSxs0Sk1XYFPsVXZWVO6uWopEfQjJLYPhqqUw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] When I declared mirrored queues using spring-rabbit API, one of them is sometimes failed.">minslovey at gmail.com
       </A><BR>
    <I>Tue Aug 14 08:54:53 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022014.html">[rabbitmq-discuss] RabbitMQ - Service Crash
</A></li>
        <LI>Next message: <A HREF="021856.html">[rabbitmq-discuss] When I declared mirrored queues using spring-rabbit API, one of them is sometimes failed.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21851">[ date ]</a>
              <a href="thread.html#21851">[ thread ]</a>
              <a href="subject.html#21851">[ subject ]</a>
              <a href="author.html#21851">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all.
First of all, thanks for rabbitmq team &amp; community. With rabbitmq, our
production environment has been improving.
I am very pleased if you help me.

*Environment*

1. rabbit-mq 2.8.4(and java client 2.8.4), spring-amqp 1.1.0, spring-rabbit
1.1.0.
2. erlang RB15B01

*Problem*

1. When I declared mirrored queues using spring-rabbit API, one of them is
sometimes failed.
2. As a result, the failed queue(s) does not exist.
3. When I rerun my code without any changes, it is sometimes success.
4. Code for declaring the queues is as following.

*&lt;bean id=&quot;notificationAddCommentQueue&quot;
class=&quot;org.springframework.amqp.core.Queue&quot;&gt;*
* &lt;constructor-arg name=&quot;name&quot; value=&quot;cafe.notification.addComment&quot; /&gt;*
* &lt;constructor-arg name=&quot;autoDelete&quot; value=&quot;false&quot; /&gt;*
* &lt;constructor-arg name=&quot;exclusive&quot; value=&quot;false&quot; /&gt;*
* &lt;constructor-arg name=&quot;durable&quot; value=&quot;true&quot; /&gt;*
* &lt;constructor-arg name=&quot;arguments&quot;&gt;*
* &lt;map&gt;*
* &lt;entry key=&quot;x-ha-policy&quot; value=&quot;all&quot; /&gt;*
* &lt;/map&gt;*
* &lt;/constructor-arg&gt;*
*&lt;/bean&gt;*
*
*
*...*

*for (Queue queue : queues) {*
*  rabbitAdmin.deleteQueue(queue.getName());*
*  rabbitAdmin.declareQueue(queue);*
*}*

5. Error logs on rabbitmq-server is as following.

*=INFO REPORT==== 14-Aug-2012::16:32:05 ===*
*Mirrored-queue (queue 'cafe.ping' in vhost 'cafe'): Promoting slave
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mq1 at NVCAFMQ1501.3.853.2</A>&gt; to master*
*
*
*=ERROR REPORT==== 14-Aug-2012::16:32:06 ===*
*** Generic server &lt;0.854.2&gt; terminating*
*** Last message in was {'$gen_cast',*
*                        {broadcast,*
*                         {delete_and_terminate,*
*                          {{case_clause,{error,not_found}},*
*                           [{rabbit_amqqueue_process,i,2,[]},*
*
{rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,*
*                             []},*
*
{rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,*
*                             []},*
*                            {rabbit_amqqueue_process,infos,2,[]},*
*                            {rabbit_amqqueue_process,emit_stats,2,[]},*
*                            {rabbit_event,if_enabled,3,[]},*
*
{rabbit_amqqueue_process,handle_pre_hibernate,1,*
*                             []},*
*                            {gen_server2,pre_hibernate,1,[]}]}}}}*
*** When Server state == {state,*
*                            {4,&lt;0.854.2&gt;},*
*                            {{4,&lt;0.854.2&gt;},undefined},*
*                            {{4,&lt;0.854.2&gt;},undefined},*
*                            {resource,&lt;&lt;&quot;cafe&quot;&gt;&gt;,queue,&lt;&lt;&quot;cafe.ping&quot;&gt;&gt;},*
*                            rabbit_mirror_queue_coordinator,*
*                            {9,*
*                             [{{4,&lt;0.854.2&gt;},*
*                               {view_member,*
*                                   {4,&lt;0.854.2&gt;},*
*                                   [],*
*                                   {4,&lt;0.854.2&gt;},*
*                                   {4,&lt;0.854.2&gt;}}}]},*
*                            4,[],*
*                            [&lt;0.855.2&gt;],*
*                            {[],[]},*
*                            [],undefined}*
*** Reason for termination == *
*** {{case_clause,{error,not_found}},*
*    [{rabbit_amqqueue_process,i,2,[]},*
*     {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,[]},*
*     {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,[]},*
*     {rabbit_amqqueue_process,infos,2,[]},*
*     {rabbit_amqqueue_process,emit_stats,2,[]},*
*     {rabbit_event,if_enabled,3,[]},*
*     {rabbit_amqqueue_process,handle_pre_hibernate,1,[]},*
*     {gen_server2,pre_hibernate,1,[]}]}*


                                 [{file,&quot;proc_lib.erl&quot;},{line,227}]}]}}
** When Server state == {q,
                         {amqqueue,
                          {resource,&lt;&lt;&quot;cafe&quot;&gt;&gt;,queue,&lt;&lt;&quot;cafe.ping&quot;&gt;&gt;},
                          true,false,none,
                          [{&lt;&lt;&quot;x-ha-policy&quot;&gt;&gt;,longstr,&lt;&lt;&quot;all&quot;&gt;&gt;}],
                          &lt;0.22597.1&gt;,[],all},
                         none,false,rabbit_mirror_queue_master,
                         {state,&lt;0.22598.1&gt;,&lt;0.22781.1&gt;,
                          rabbit_variable_queue,
                          {vqstate,
                           {0,{[],[]}},
                           {0,{[],[]}},
                           {delta,undefined,0,undefined},
                           {0,{[],[]}},
                           {1,
                            {[{msg_status,0,

 &lt;&lt;176,245,83,92,212,158,235,71,163,59,227,246,
                                 180,233,129,198&gt;&gt;,
                               {basic_message,

{resource,&lt;&lt;&quot;cafe&quot;&gt;&gt;,exchange,&lt;&lt;&quot;cafe.ping&quot;&gt;&gt;},
                                [&lt;&lt;&quot;cafe.ping&quot;&gt;&gt;],
                                {content,60,
                                 {'P_basic',&lt;&lt;&quot;application/json&quot;&gt;&gt;,
                                  &lt;&lt;&quot;UTF-8&quot;&gt;&gt;,
                                  [{&lt;&lt;&quot;__TypeId__&quot;&gt;&gt;,longstr,
                                    &lt;&lt;&quot;java.lang.String&quot;&gt;&gt;}],

2,0,undefined,undefined,undefined,undefined,
                                  undefined,undefined,undefined,undefined,
                                  undefined},

 &lt;&lt;248,0,16,97,112,112,108,105,99,97,116,105,

 111,110,47,106,115,111,110,5,85,84,70,45,56,

 0,0,0,32,10,95,95,84,121,112,101,73,100,95,

 95,83,0,0,0,16,106,97,118,97,46,108,97,110,
                                   103,46,83,116,114,105,110,103,2,0&gt;&gt;,
                                 rabbit_framing_amqp_0_9_1,
                                 [&lt;&lt;&quot;\&quot;NVCAFBE1501.nhnjp.ism
cafe-api-server : Tue Aug 14 16:32:03 JST 2012\&quot;&quot;&gt;&gt;]},

&lt;&lt;176,245,83,92,212,158,235,71,163,59,227,246,
                                  180,233,129,198&gt;&gt;,
                                true},
                               true,false,true,true,
                               {message_properties,undefined,false}}],
                             []}},
                           1,
                           {0,nil},
                           undefined,
                           {0,nil},
                           {qistate,

&quot;/home/www/rabbitmq_server-2.8.4/sbin/../var/lib/rabbitmq/mnesia/mq2/queues/9QF3UUJUE12OVYVA26GQJ1FFU&quot;,
                            {{dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

...




-- 
Min Cha, Software Developer

Projects involved
- CoRepository : <A HREF="https://github.com/MinCha/corepository">https://github.com/MinCha/corepository</A>
- Good-Samples : <A HREF="http://code.google.com/p/good-samples/">http://code.google.com/p/good-samples/</A>

Blog
- (Eng) <A HREF="http://minslovey.blogspot.com">http://minslovey.blogspot.com</A>
- (Kor) <A HREF="http://minslovey.tistory.com">http://minslovey.tistory.com</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/dc8d9767/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/dc8d9767/attachment.htm</A>&gt;
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022014.html">[rabbitmq-discuss] RabbitMQ - Service Crash
</A></li>
	<LI>Next message: <A HREF="021856.html">[rabbitmq-discuss] When I declared mirrored queues using spring-rabbit API, one of them is sometimes failed.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21851">[ date ]</a>
              <a href="thread.html#21851">[ thread ]</a>
              <a href="subject.html#21851">[ subject ]</a>
              <a href="author.html#21851">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
