<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on	ConnectionShutdown
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20.Net%20RabbitMQ.Client%20Issue%3A%20Deadlock%20on%0A%09ConnectionShutdown&In-Reply-To=%3C503367A3.5060107%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022000.html">
   <LINK REL="Next"  HREF="022015.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on	ConnectionShutdown</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20.Net%20RabbitMQ.Client%20Issue%3A%20Deadlock%20on%0A%09ConnectionShutdown&In-Reply-To=%3C503367A3.5060107%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on	ConnectionShutdown">emile at rabbitmq.com
       </A><BR>
    <I>Tue Aug 21 11:49:07 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022000.html">[rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on	ConnectionShutdown
</A></li>
        <LI>Next message: <A HREF="022015.html">[rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on	ConnectionShutdown
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22012">[ date ]</a>
              <a href="thread.html#22012">[ thread ]</a>
              <a href="subject.html#22012">[ subject ]</a>
              <a href="author.html#22012">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Derek,

On 20/08/12 19:29, Derek Greer wrote:
&gt;<i> There appears to be a deadlock if you attempt to dispose, close, or
</I>&gt;<i> abort a channel within the context of an IConnection.ConnectionShutdown
</I>&gt;<i> event.
</I>
Instead of deadlock I get an IO exception. An attempt to close the
channel requires network access, but it is no longer possible for the
channel to communicate over the network.

System.IO.IOException:
 Unable to write data to the transport connection:
 An existing connection was forcibly closed by the remote host.
System.Net.Sockets.SocketException:
 An existing connection was forcibly closed by the remote host

&gt;<i> if (channel != null &amp;&amp; channel.IsOpen)
</I>&gt;<i> {
</I>&gt;<i> Console.WriteLine(&quot;Closing channel ...&quot;);
</I>&gt;<i> channel.Close(); // &lt;- Never returns
</I>&gt;<i> Console.WriteLine(&quot;Channel closed.&quot;);
</I>&gt;<i> }
</I>
This code is flawed, because the state of the channel could change
between the query and the action. There is no need to explicitly shut
down the channel when the connection shuts down as this will be done by
the library. Parties can register their interest in channel shutdown
using IModel.ModelShutdown.


-Emile

</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022000.html">[rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on	ConnectionShutdown
</A></li>
	<LI>Next message: <A HREF="022015.html">[rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on	ConnectionShutdown
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22012">[ date ]</a>
              <a href="thread.html#22012">[ thread ]</a>
              <a href="subject.html#22012">[ subject ]</a>
              <a href="author.html#22012">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
