<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publisher%20Confirms%20stop%20occurring%20when%0A%20Consumer%20is%20present%20and%20queue%20is%20large&In-Reply-To=%3CCAGWz9vXSUTLAZnhgkuWCY3vKPMTg5QpTatrbiKszQYuVw3O-Yw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022213.html">
   <LINK REL="Next"  HREF="022176.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large</H1>
    <B>Cameron Davison</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publisher%20Confirms%20stop%20occurring%20when%0A%20Consumer%20is%20present%20and%20queue%20is%20large&In-Reply-To=%3CCAGWz9vXSUTLAZnhgkuWCY3vKPMTg5QpTatrbiKszQYuVw3O-Yw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large">cameron.davison at gmail.com
       </A><BR>
    <I>Wed Aug 29 22:07:10 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022213.html">[rabbitmq-discuss] Rabbitmq server crash.
</A></li>
        <LI>Next message: <A HREF="022176.html">[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22175">[ date ]</a>
              <a href="thread.html#22175">[ thread ]</a>
              <a href="subject.html#22175">[ subject ]</a>
              <a href="author.html#22175">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It has been a while since I wrote to the group. I was wondering if
this bug ever was fixed in a more recent release?

Thanks,
Cameron

On Fri, Nov 4, 2011 at 12:32 PM, Jerry Kuch &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jerryk at vmware.com</A>&gt; wrote:
&gt;<i> Do watch for our upcoming &quot;Cursing and Screaming as a Service&quot; (CaSaaS)
</I>&gt;<i> offering! :-)
</I>&gt;<i>
</I>&gt;<i> Jerry
</I>&gt;<i>
</I>&gt;<i> ----- Original Message -----
</I>&gt;<i> From: &quot;Matthew Sackman&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt;
</I>&gt;<i> To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> Sent: Friday, November 4, 2011 8:38:22 AM
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
</I>&gt;<i>
</I>&gt;<i> Hi Cameron,
</I>&gt;<i>
</I>&gt;<i> On Wed, Nov 02, 2011 at 12:10:21AM -0500, Cameron Davison wrote:
</I>&gt;&gt;<i> Thank you for the reply. Do y'all have a bug tracker that I would be
</I>&gt;&gt;<i> able to watch so that I can know when y'all address this issue?
</I>&gt;<i>
</I>&gt;<i> We do have a bug tracker but alas it's not public because we all like to
</I>&gt;<i> curse and scream at each other and generally feel that making it public
</I>&gt;<i> would preclude us from doing that, which would be bad for morale.
</I>&gt;<i>
</I>&gt;&gt;<i> Do you
</I>&gt;&gt;<i> know if this same thing would be even worse for a mirrored queue
</I>&gt;&gt;<i> rabbit mq cluster?
</I>&gt;<i>
</I>&gt;<i> I don't think this bug will affect mirrored queues in a worse way than
</I>&gt;<i> non-mirrored queues...
</I>&gt;<i>
</I>&gt;&gt;<i> I am seeing a lot of degradation in write
</I>&gt;&gt;<i> throughput while reading when doing mirrored queue cluster. All I
</I>&gt;&gt;<i> really want is high availability such that if one server crashed the
</I>&gt;&gt;<i> slave in the cluster will become the master and allow for continued
</I>&gt;&gt;<i> throughput. Is this the correct way to that?
</I>&gt;<i>
</I>&gt;<i> Yes - you are doing things the right way. Mirrored queues are much
</I>&gt;<i> slower than non-mirrored queues due to the additional work that has to
</I>&gt;<i> be done. You should probably expect to see about a ten-fold decrease in
</I>&gt;<i> performance.
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://old.nabble.com/Mirror-queues-and-poor-write-performance-td32727693.html">http://old.nabble.com/Mirror-queues-and-poor-write-performance-td32727693.html</A>
</I>&gt;<i> reports that I can get a little over 2kHz on a single mirrored queue
</I>&gt;<i> with one consumer keeping the queue empty.
</I>&gt;<i>
</I>&gt;<i> But the bug that you've identified will certainly affect mirrored queues
</I>&gt;<i> as well as non-mirrored queues.
</I>&gt;<i>
</I>&gt;<i> One thing you could try is on the consumer:
</I>&gt;<i> 1. Try a fairly healthy qos prefetch size N (eg N=100)
</I>&gt;<i> 2. Only ack every N/2 (eg 50) msgs but turn on the &quot;multiple&quot; flag in
</I>&gt;<i> the ack.
</I>&gt;<i>
</I>&gt;<i> The effect of these changes will be to reduce the consumer-related
</I>&gt;<i> messages that the queue has to deal with, and so will hopefully allow
</I>&gt;<i> the queue to process the publishes faster (and issue the confirms).
</I>&gt;<i>
</I>&gt;<i> If you're able to try these changes, I'd be interested in what
</I>&gt;<i> improvements (if any) they achieve for you.
</I>&gt;<i>
</I>&gt;<i> Best wishes,
</I>&gt;<i>
</I>&gt;<i> Matthew
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022213.html">[rabbitmq-discuss] Rabbitmq server crash.
</A></li>
	<LI>Next message: <A HREF="022176.html">[rabbitmq-discuss] Publisher Confirms stop occurring when Consumer is present and queue is large
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22175">[ date ]</a>
              <a href="thread.html#22175">[ thread ]</a>
              <a href="subject.html#22175">[ subject ]</a>
              <a href="author.html#22175">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
