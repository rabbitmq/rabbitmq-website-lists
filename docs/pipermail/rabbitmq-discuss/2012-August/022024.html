<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] How many queues can one broker support
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20many%20queues%20can%20one%20broker%20support&In-Reply-To=%3CCALPqkio7B5s2-0jkXzvRSgCKoH%2BcfTWEpLane-pCGt98yWYvcg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022022.html">
   <LINK REL="Next"  HREF="022020.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] How many queues can one broker support</H1>
    <B>Brett Cameron</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20many%20queues%20can%20one%20broker%20support&In-Reply-To=%3CCALPqkio7B5s2-0jkXzvRSgCKoH%2BcfTWEpLane-pCGt98yWYvcg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] How many queues can one broker support">brett.r.cameron at gmail.com
       </A><BR>
    <I>Tue Aug 21 23:15:39 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022022.html">[rabbitmq-discuss] How many queues can one broker support
</A></li>
        <LI>Next message: <A HREF="022020.html">[rabbitmq-discuss] Shovel terminated status
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22024">[ date ]</a>
              <a href="thread.html#22024">[ thread ]</a>
              <a href="subject.html#22024">[ subject ]</a>
              <a href="author.html#22024">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sharon,

Further to Simon's comments, each connection will consume ~66K memory and
each connection also creates 8 Erlang processes (or thereabouts), so you'd
need to factor in this memory usage and ensure that Erlang is able to spin
up the required number of processes. You'd obviously also need to tweak a
few system parameters to allow that many connections/sockets - all quite
doable of course, but I'd concur with Simon that unless you have a pretty
grunty server you could face some challenges. That being said, Erlang (and
by inference RabbitMQ) can certainly handle this sort of thing... you might
like to have a look at <A HREF="http://www.youtube.com/watch?v=wDk6l3tPBuw.">http://www.youtube.com/watch?v=wDk6l3tPBuw.</A>

Brett


On Wed, Aug 22, 2012 at 4:16 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> Hi Sharon.
</I>&gt;<i>
</I>&gt;<i> There isn't a hard coded limit of course, but ~10M queues sounds
</I>&gt;<i> optimistic, especially if combined with ~10M TCP connections.
</I>&gt;<i>
</I>&gt;<i> I don't think 1) and 2) are all that different. Unless you need the
</I>&gt;<i> wildcard matching of a topic exchange you might as well pick a direct
</I>&gt;<i> exchange.
</I>&gt;<i>
</I>&gt;<i> But in both cases you have millions of connections / consumers / queues.
</I>&gt;<i> That *is* quite a lot to support on one machine. Are all these consumers
</I>&gt;<i> going to connect simultaneously? You may have trouble raising the fd limit
</I>&gt;<i> that high.
</I>&gt;<i>
</I>&gt;<i> Also each connection / consumer / queue will take a few kb of memory even
</I>&gt;<i> when idle - so that could eat up quite a few GB before you do anything.
</I>&gt;<i>
</I>&gt;<i> My gut feeling is that supporting that many simultaneous connections will
</I>&gt;<i> be a problem before the raw number of queues is.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 21/08/12 15:27, sharonbn wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hello,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am investigating using RabbitMQ and AMQP to push notifications from our
</I>&gt;&gt;<i> web app to client apps on Android devices.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In our case, we have few publishers and many consumers (millions, perhaps
</I>&gt;&gt;<i> ~10M), all connected to the broker and ready to consume messages.
</I>&gt;&gt;<i> every now and then, the publisher needs to send one message to one and
</I>&gt;&gt;<i> only
</I>&gt;&gt;<i> one consumer.
</I>&gt;&gt;<i> each consumer will receive few dozens of messages daily. Message
</I>&gt;&gt;<i> acknowledgements is not mandatory.
</I>&gt;&gt;<i> btw, the broker (or cluster?) will be hosted on AWS EC2 instances.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I was wondering if there are any limitations on number of connected
</I>&gt;&gt;<i> consumers and what's the best strategy to implement such a scenario.  From
</I>&gt;&gt;<i> the documentation, it seems to me there are two ways to do this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> first of all, each client app already reports a unique identifier to the
</I>&gt;&gt;<i> web
</I>&gt;&gt;<i> app (this is done prior to any message sending).  this unique id, known on
</I>&gt;&gt;<i> both sides, can be used to ensure routing of the message to the specific
</I>&gt;&gt;<i> client.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1) The most obvious way is to have one direct-exchange and create an
</I>&gt;&gt;<i> exclusive queue per consumer with the unique id as the queue name.  this
</I>&gt;&gt;<i> means there will be millions of queues that are most of the time empty or
</I>&gt;&gt;<i> nearly empty.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2) Have one topic-exchange with (how many?) queues.  the unique id will be
</I>&gt;&gt;<i> used as topic name.  Here we have millions of topic names.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> which is the best solutions (or perhaps a third option)?  any other
</I>&gt;&gt;<i> considerations in this use case?  any special configuration/settings? any
</I>&gt;&gt;<i> help is appreciated :)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Sharon.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> View this message in context: <A HREF="http://rabbitmq.1065348.n5.**">http://rabbitmq.1065348.n5.**</A>
</I>&gt;&gt;<i> nabble.com/How-many-queues-**can-one-broker-support-**tp21539.html&lt;<A HREF="http://rabbitmq.1065348.n5.nabble.com/How-many-queues-can-one-broker-support-tp21539.html">http://rabbitmq.1065348.n5.nabble.com/How-many-queues-can-one-broker-support-tp21539.html</A>&gt;
</I>&gt;&gt;<i> Sent from the RabbitMQ mailing list archive at Nabble.com.
</I>&gt;&gt;<i> ______________________________**_________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.</A>**rabbitmq.com&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i>
</I>&gt;<i> ______________________________**_________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.</A>**rabbitmq.com&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/cce46501/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120822/cce46501/attachment.htm</A>&gt;
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022022.html">[rabbitmq-discuss] How many queues can one broker support
</A></li>
	<LI>Next message: <A HREF="022020.html">[rabbitmq-discuss] Shovel terminated status
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22024">[ date ]</a>
              <a href="thread.html#22024">[ thread ]</a>
              <a href="subject.html#22024">[ subject ]</a>
              <a href="author.html#22024">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
