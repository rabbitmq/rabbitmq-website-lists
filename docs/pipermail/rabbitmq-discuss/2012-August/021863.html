<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Spring AMQP: would like to put message to queue and send ACK immediately
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Spring%20AMQP%3A%20would%20like%20to%20put%20message%20to%20queue%0A%20and%20send%20ACK%20immediately&In-Reply-To=%3Cdd6e670b-6539-4694-a5bd-f70ff1fff7b0%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021854.html">
   <LINK REL="Next"  HREF="021864.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Spring AMQP: would like to put message to queue and send ACK immediately</H1>
    <B>bunny</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Spring%20AMQP%3A%20would%20like%20to%20put%20message%20to%20queue%0A%20and%20send%20ACK%20immediately&In-Reply-To=%3Cdd6e670b-6539-4694-a5bd-f70ff1fff7b0%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Spring AMQP: would like to put message to queue and send ACK immediately">sunnybunny14 at gmail.com
       </A><BR>
    <I>Tue Aug 14 13:13:42 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021854.html">[rabbitmq-discuss] haigha 0.5.1 - 0.5.3 gevent transport is broken
</A></li>
        <LI>Next message: <A HREF="021864.html">[rabbitmq-discuss] Spring AMQP: would like to put message to queue and send ACK immediately
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21863">[ date ]</a>
              <a href="thread.html#21863">[ thread ]</a>
              <a href="subject.html#21863">[ subject ]</a>
              <a href="author.html#21863">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> 0 down vote favorite&lt;<A HREF="http://stackoverflow.com/questions/11951508/spring-amqp-would-like-to-put-message-to-queue-and-send-ack-immediately#">http://stackoverflow.com/questions/11951508/spring-amqp-would-like-to-put-message-to-queue-and-send-ack-immediately#</A>&gt; 
  
I wrote Java application, that sends messages to RabbitMQ. Then Flume picks 
messages up from RabbitMQ queue. I'm interested that nobody pulls messages 
from the queue, except flume.

My application uses Spring AMQP Java plugin.
The problem: 

With the code below, message comes to RabbitMQ queue and stays 
'Unknowledges' for ever. As I understand, RabbitMQ is waiting for ACK from 
MessageListener, but MessageListener will never ACK. Does anybody have idea 
how to fix it?

The code:

public class MyAmqpConfiguration {

    @Autowired
    ConnectionFactory connectionFactory;

    @Bean
    public SimpleMessageListenerContainer messageListenerContainer() {

    SimpleMessageListenerContainer container = new SimpleMessageListenerContainer(connectionFactory);
    container.setQueues(activityLogsQueue());
    container.setMessageListener(MyMessageListener());
            container.setConcurrentConsumers(3);

    return container;
    }

        @Bean(name=&quot;myTemplate&quot;)
        public RabbitTemplate rabbitTemplate() {
        RabbitTemplate template = new RabbitTemplate(connectionFactory);
        template.setMessageConverter(MyMessageConverter());
        return template;
        }
}


public class MyMessageListener implements MessageListener {


   public MyMessageListener(MessageConverter converter, MyMessageHandler&lt;MyObject&gt; messageHandler) {
      this.converter = converter;
      this.messageHandler = messageHandler;
    }

   @Override
   public void onMessage(Message message) {
     this.messageHandler.doThings();
   }

}

public class MyMessageHandler  {

     @Autowired
     @Qualifier(&quot;myTemplate&quot;)
     RabbitTemplate template;

     @Override
     public void handleMessage(MyObject thing) {
         template.convertAndSend(exchange, routingKey, thing);
     }

}


public class MyMessageConverter extends JsonMessageConverter {

    @Override
     protected Message createMessage(Object object, MessageProperties messageProperties) { 
        //do things
     }

     @Override
     public Object fromMessage(Message message) throws MessageConversionException {
         throw new UnsupportedOperationException(&quot;fromMessage is not supported in &quot;+this.getClass().getName());
     }


}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/0e03e04c/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120814/0e03e04c/attachment.htm</A>&gt;
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021854.html">[rabbitmq-discuss] haigha 0.5.1 - 0.5.3 gevent transport is broken
</A></li>
	<LI>Next message: <A HREF="021864.html">[rabbitmq-discuss] Spring AMQP: would like to put message to queue and send ACK immediately
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21863">[ date ]</a>
              <a href="thread.html#21863">[ thread ]</a>
              <a href="subject.html#21863">[ subject ]</a>
              <a href="author.html#21863">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
