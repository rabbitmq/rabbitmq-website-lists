<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Shovel terminated status
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shovel%20terminated%20status&In-Reply-To=%3CE94F626F5C43D14F8B8479C5EBD790388A7DCB43%40vmexchange02.seegrid.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022026.html">
   <LINK REL="Next"  HREF="022087.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Shovel terminated status</H1>
    <B>Elizabeth Liao</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shovel%20terminated%20status&In-Reply-To=%3CE94F626F5C43D14F8B8479C5EBD790388A7DCB43%40vmexchange02.seegrid.local%3E"
       TITLE="[rabbitmq-discuss] Shovel terminated status">eliao at seegrid.com
       </A><BR>
    <I>Thu Aug 23 15:57:46 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022026.html">[rabbitmq-discuss] Shovel terminated status
</A></li>
        <LI>Next message: <A HREF="022087.html">[rabbitmq-discuss] Shovel terminated status
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22068">[ date ]</a>
              <a href="thread.html#22068">[ thread ]</a>
              <a href="subject.html#22068">[ subject ]</a>
              <a href="author.html#22068">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ah I had forgotten to test the reconnect_delay parameter.  Thanks!

As for the unclosed connections, I'm looking under the &quot;Connections&quot; tab in the RabbitMQ Management plugin of the broker that is initiating the 3 shovels with another broker. On the broker that is initiating the connections, 'rabbitmqctl list_connections' does not return any connections and 'rabbitmqctl list_channels' returns the channels associated with the 2 running shovels. 'rabbitmqctl reset' clears the list of unclosed connections listed on the management plugin.

Every time the terminated shovel tries to reconnect, there are 6 (2*# of shovels?) more connections listed under the Connections tab.  It seems to happen (so far) only for the termination reason of &quot;cannot redeclare exchange with different type&quot;.  I've tried to terminate shovel by deleting an exchange as well.

Also as a note, I'm testing shovel with the version of RabbitMQ that we use currently and unfortunately can't upgrade at the moment.

Thanks

Liz
________________________________________
From: Matthias Radestock [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>]
Sent: Tuesday, August 21, 2012 7:32 PM
To: Discussions about RabbitMQ
Cc: Elizabeth Liao
Subject: Re: [rabbitmq-discuss] Shovel terminated status

Liz,

On 21/08/12 16:45, Elizabeth Liao wrote:
&gt;<i> Questions: In the documentation, it states that the timestamp from  $
</I>&gt;<i> rabbitmqctl eval 'rabbit_shovel_status:status().' is the time when
</I>&gt;<i> shovel entered the state.  I've observed this for the running and
</I>&gt;<i> starting state but not for the terminated state.  The timestamp for
</I>&gt;<i> the terminated state appears to be the current time.
</I>
Your config has a reconnect_delay of 1 (second), so when the shovel
initialisation fails it will attempt to reconnect after one second,
which puts the shovel in the 'starting' state, fail and go straight back
to the 'terminated' state. Then one second later the same happens. And
so on. Hence the moving timestamp.

&gt;<i> Additionally, it seems when a shovel is in the terminated state and
</I>&gt;<i> periodically trying to reconnect, there are many connections left
</I>&gt;<i> open with no active channels.
</I>
What exactly are you observing here? The number of connections returned
by 'rabbitmqctl list_connections' at the broker the shovel is connecting to?

Btw, it would be good if you conducted your testing with the latest
RabbitMQ version. Makes it easier for us to investigate any problems.


Regards,

Matthias.
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022026.html">[rabbitmq-discuss] Shovel terminated status
</A></li>
	<LI>Next message: <A HREF="022087.html">[rabbitmq-discuss] Shovel terminated status
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22068">[ date ]</a>
              <a href="thread.html#22068">[ thread ]</a>
              <a href="subject.html#22068">[ subject ]</a>
              <a href="author.html#22068">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
