<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] HA queue disappears when a node rejoins the	cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20queue%20disappears%20when%20a%20node%20rejoins%20the%0A%09cluster&In-Reply-To=%3CCACLE7izix%3DPy-Fx%2B5pk4Gxw80XfnPaKTeZ1S36FhKO_KaFtxdg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022109.html">
   <LINK REL="Next"  HREF="022153.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] HA queue disappears when a node rejoins the	cluster</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20queue%20disappears%20when%20a%20node%20rejoins%20the%0A%09cluster&In-Reply-To=%3CCACLE7izix%3DPy-Fx%2B5pk4Gxw80XfnPaKTeZ1S36FhKO_KaFtxdg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] HA queue disappears when a node rejoins the	cluster">mpietrek at skytap.com
       </A><BR>
    <I>Tue Aug 28 19:12:19 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022109.html">[rabbitmq-discuss] HA queue disappears when a node rejoins the	cluster
</A></li>
        <LI>Next message: <A HREF="022153.html">[rabbitmq-discuss] HA queue disappears when a node rejoins the	cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22152">[ date ]</a>
              <a href="thread.html#22152">[ thread ]</a>
              <a href="subject.html#22152">[ subject ]</a>
              <a href="author.html#22152">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Just pinging this thread as it seems to have gone dead, and it feels like a
serious issue with clustering/HA in 2.8.6.

When we last left off, Matthias had asked for the logs for the two other
brokers when the queue disappeared. My last message contained the contents
of those logs.

Thanks,

Matt

On Fri, Aug 24, 2012 at 11:22 AM, Matt Pietrek &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mpietrek at skytap.com</A>&gt; wrote:

&gt;<i> &gt; The logs for play and util from around the same time might offer us some
</I>&gt;<i> more clues.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> What I sent was <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play.log.</A>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play2.log</A> doesn't look nearly as interesting:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> Limiting to approx 924 file handles (829 sockets)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> Memory limit set to 399MB of 999MB total.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> Disk free limit set to 100MB
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> Management plugin upgraded statistics to fine.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> msg_store_transient: using rabbit_msg_store_ets_index to provide index
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
</I>&gt;<i>
</I>&gt;<i> =WARNING REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> msg_store_persistent: recovery terms differ from present
</I>&gt;<i> rebuilding indices from scratch
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> Adding mirror of queue 'unit_test' in vhost '/' on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play2</A>:
</I>&gt;<i> &lt;0.261.0&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> Adding mirror of queue 'test' in vhost '/' on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play2</A>: &lt;0.263.0&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> Adding mirror of queue 'XXXX' in vhost '/' on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play2</A>: &lt;0.266.0&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> Adding mirror of queue 'XYZZY' in vhost '/' on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play2</A>:
</I>&gt;<i> &lt;0.268.0&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> Adding mirror of queue 'system_test' in vhost '/' on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play2</A>:
</I>&gt;<i> &lt;0.271.0&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> started TCP Listener on 0.0.0.0:5672
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play</A> up
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at util</A> up
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> Management agent started.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> Management plugin started. Port: 55672, path: /
</I>&gt;<i>
</I>&gt;<i> And here is <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at util.log</A>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
</I>&gt;<i> Mirrored-queue (queue 'charon' in vhost '/'): Slave &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at util.3.262.0</A>&gt;
</I>&gt;<i> saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play2.2.271.0</A>&gt;
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
</I>&gt;<i> Mirrored-queue (queue 'charon' in vhost '/'): Promoting slave
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at util.3.262.0</A>&gt; to master
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
</I>&gt;<i> Mirrored-queue (queue 'system_test' in vhost '/'): Slave
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at util.3.264.0</A>&gt; saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play2.2.273.0</A>&gt;
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
</I>&gt;<i> Mirrored-queue (queue 'system_test' in vhost '/'): Promoting slave
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at util.3.264.0</A>&gt; to master
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
</I>&gt;<i> rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play2</A> down
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
</I>&gt;<i> Mirrored-queue (queue 'cmcmd' in vhost '/'): Slave &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at util.3.258.0</A>&gt;
</I>&gt;<i> saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play2.2.267.0</A>&gt;
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
</I>&gt;<i> Mirrored-queue (queue 'cmcmd' in vhost '/'): Promoting slave
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at util.3.258.0</A>&gt; to master
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
</I>&gt;<i> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Slave
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at util.3.260.0</A>&gt; saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play2.2.269.0</A>&gt;
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:06 ===
</I>&gt;<i> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Promoting
</I>&gt;<i> slave &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at util.3.260.0</A>&gt; to master
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> Mirrored-queue (queue 'unit_test' in vhost '/'): Master
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at util.3.2457.0</A>&gt; saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play2.3.261.0</A>&gt;
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 24-Aug-2012::10:29:12 ===
</I>&gt;<i> rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play2</A> up
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Fri, Aug 24, 2012 at 10:51 AM, Matthias Radestock &lt;
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Matt,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 24/08/12 18:34, Matt Pietrek wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I was able to reproduce this in exactly the same way with 2.8.6 and
</I>&gt;&gt;&gt;<i> Erlang R15B01.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Here's the log from <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at play.log.</A> When play2 goes down and comes back
</I>&gt;&gt;&gt;<i> up, the 'unit_test' queue (the only queue with messages) disappears.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Just to confirm, the queues are mirrored across *three* nodes - play,
</I>&gt;&gt;<i> play2 and util, right?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The logs for play and util from around the same time might offer us some
</I>&gt;&gt;<i> more clues.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Matthias.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/9febb102/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120828/9febb102/attachment.htm</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022109.html">[rabbitmq-discuss] HA queue disappears when a node rejoins the	cluster
</A></li>
	<LI>Next message: <A HREF="022153.html">[rabbitmq-discuss] HA queue disappears when a node rejoins the	cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22152">[ date ]</a>
              <a href="thread.html#22152">[ thread ]</a>
              <a href="subject.html#22152">[ subject ]</a>
              <a href="author.html#22152">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
