<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbitmq server crash.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20server%20crash.&In-Reply-To=%3CC1CC286E-316B-405E-952B-09B18A095A20%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022189.html">
   <LINK REL="Next"  HREF="022213.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbitmq server crash.</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20server%20crash.&In-Reply-To=%3CC1CC286E-316B-405E-952B-09B18A095A20%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Rabbitmq server crash.">tim at rabbitmq.com
       </A><BR>
    <I>Fri Aug 31 10:46:16 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022189.html">[rabbitmq-discuss] Rabbitmq server crash.
</A></li>
        <LI>Next message: <A HREF="022213.html">[rabbitmq-discuss] Rabbitmq server crash.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22199">[ date ]</a>
              <a href="thread.html#22199">[ thread ]</a>
              <a href="subject.html#22199">[ subject ]</a>
              <a href="author.html#22199">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

On 29 Aug 2012, at 13:12, Pankaj Mishra wrote:

&gt;<i> Hi,
</I>&gt;<i>  
</I>&gt;<i> We experienced a strange problem with rabbitmq server running in cluster. Actually according to
</I>&gt;<i> Log file the master of the server crashed. Post that all my publishers continue to send message without
</I>&gt;<i> Throwing any exception but all those messages were dropped silently by rabbitmq server. Consumer were not able
</I>&gt;<i> To get any of those messages until we restarted the rabbitmq server again.
</I>&gt;<i>  
</I>&gt;<i> I have attached with this mail the server crash log for master as well as for slave.
</I>
According to the master log, the mnesia database has become inconsistent, which is not a good sign. It looks very much like a network partition has occurred here:

%% from master.log

=INFO REPORT==== 7-Aug-2012::18:42:24 ===
rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MyTimes160</A> down

%% from slave.log

=INFO REPORT==== 7-Aug-2012::18:42:25 ===
rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MyTimes159</A> down

According to the logs, both the master and the slave observed the other node disappear, which seems consistent with the network partition theory.

%% from master.log

=INFO REPORT==== 7-Aug-2012::18:42:25 ===
Mirrored-queue (queue 'cms' in vhost '/'): Master &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MyTimes159.3.444.0</A>&gt; saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MyTimes160.2.595.0</A>&gt; 

=INFO REPORT==== 7-Aug-2012::18:42:25 ===
Mirrored-queue (queue 'mytimes' in vhost '/'): Master &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MyTimes159.3.437.0</A>&gt; saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MyTimes160.2.591.0</A>&gt; 

%% from slave.log

=INFO REPORT==== 7-Aug-2012::18:42:25 ===
Mirrored-queue (queue 'mytimes' in vhost '/'): Slave &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MyTimes160.2.591.0</A>&gt; saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MyTimes159.3.437.0</A>&gt; 

=INFO REPORT==== 7-Aug-2012::18:42:25 ===
Mirrored-queue (queue 'cms' in vhost '/'): Slave &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MyTimes160.2.595.0</A>&gt; saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at MyTimes159.3.444.0</A>&gt; 


Rabbit is not partition tolerant, so I would expect things might go wrong under such circumstances, but I would not expect messages to be silently dropped. My reading of the logs so far is that when the partitioned database state is reached, a message is sent to the gm ring on the 'master' node (the {<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mnesia_locker,rabbit at MyTimes160</A>,granted} message) which isn't handled, thereby crashing the gm handling process. Once that is down, other things start to go wrong. The parent supervisor will have restarted the failed process to get things back into a consistent state, but it looks as though because mnesia has its knickers in a twist about the partitioned database, that the recovery can't take place properly.

We will look into this asap, but can you confirm that a net split did in fact take place around the time this problem started appearing?
 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120831/eacaf45b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120831/eacaf45b/attachment.htm</A>&gt;
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022189.html">[rabbitmq-discuss] Rabbitmq server crash.
</A></li>
	<LI>Next message: <A HREF="022213.html">[rabbitmq-discuss] Rabbitmq server crash.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22199">[ date ]</a>
              <a href="thread.html#22199">[ thread ]</a>
              <a href="subject.html#22199">[ subject ]</a>
              <a href="author.html#22199">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
