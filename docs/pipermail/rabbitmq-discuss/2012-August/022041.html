<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ and Warrens
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20and%20Warrens&In-Reply-To=%3C87mx1nkt5w.wl%25francesco%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021852.html">
   <LINK REL="Next"  HREF="021853.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ and Warrens</H1>
    <B>Francesco Mazzoli</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20and%20Warrens&In-Reply-To=%3C87mx1nkt5w.wl%25francesco%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ and Warrens">francesco at rabbitmq.com
       </A><BR>
    <I>Wed Aug 22 13:28:11 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021852.html">[rabbitmq-discuss] RabbitMQ and Warrens
</A></li>
        <LI>Next message: <A HREF="021853.html">[rabbitmq-discuss] haigha 0.5.3 crashes when closing channel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22041">[ date ]</a>
              <a href="thread.html#22041">[ thread ]</a>
              <a href="subject.html#22041">[ subject ]</a>
              <a href="author.html#22041">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Adam,

At Tue, 14 Aug 2012 00:59:28 -0700 (PDT),
Adam Petrovic wrote:
&gt;<i> Hi. I am just reading up about the concept of HAProxy load-balanced warrens
</I>&gt;<i> (active / standby nodes) and I can't quite come up with a solution to a
</I>&gt;<i> bugging question.
</I>&gt;<i> 
</I>&gt;<i> I understand that the concept of the load balanced warren is for HAProxy to
</I>&gt;<i> automatically fail over to the standby node, should the active node fail and
</I>&gt;<i> go down. In doing so, any existing messages on the active node would be lost
</I>&gt;<i> until this node is brought back up.
</I>&gt;<i> 
</I>&gt;<i> Which brings me to my question, what happens to the pending (still to be
</I>&gt;<i> consumed) messages on the standby node when the active node is brought back
</I>&gt;<i> up.  Are they lost, or should the application logic handle this itself?
</I>&gt;<i> Because as far as I know, HAProxy has no way of dealing with this issue.
</I>
The first thing you should do is make sure that you need this kind of
active/passive configuration.  If your cluster resides in a local network, you
might want to look at RabbitMQ own clustering, which will let you connect to any
node in the cluster seamlessly, see &lt;<A HREF="http://www.rabbitmq.com/clustering.html">http://www.rabbitmq.com/clustering.html</A>&gt;.

Otherwise, I'm don't know much HAProxy, but a good option in this situation
would be to instruct HAProxy to promote the standby node to active node when the
active fails, and make the once-active node a standby node when it comes back
up.  This has the converse problem of what to do with the messages left on the
active node.

If that's not possible, you might want to look for a way to instruct HAProxy to
notify you when the active node comes back up, stop publishing, wait for all the
messages to be consumed on the stanby node, tell HAProxy to restore the active
node, and then start publishing again.  But that's tricky, especially the &quot;wait
for messages to be consumed&quot; part.

--
Francesco * Often in error, never in doubt
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021852.html">[rabbitmq-discuss] RabbitMQ and Warrens
</A></li>
	<LI>Next message: <A HREF="021853.html">[rabbitmq-discuss] haigha 0.5.3 crashes when closing channel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22041">[ date ]</a>
              <a href="thread.html#22041">[ thread ]</a>
              <a href="subject.html#22041">[ subject ]</a>
              <a href="author.html#22041">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
