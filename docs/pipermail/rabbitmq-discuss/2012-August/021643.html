<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Mnesia corrupting after node joining cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mnesia%20corrupting%20after%20node%20joining%20cluster&In-Reply-To=%3C50196B71.1010009%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021642.html">
   <LINK REL="Next"  HREF="021655.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Mnesia corrupting after node joining cluster</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mnesia%20corrupting%20after%20node%20joining%20cluster&In-Reply-To=%3C50196B71.1010009%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Mnesia corrupting after node joining cluster">matthias at rabbitmq.com
       </A><BR>
    <I>Wed Aug  1 18:46:25 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021642.html">[rabbitmq-discuss] Mnesia corrupting after node joining cluster
</A></li>
        <LI>Next message: <A HREF="021655.html">[rabbitmq-discuss] OSGi and RabbitMQ Service layer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21643">[ date ]</a>
              <a href="thread.html#21643">[ thread ]</a>
              <a href="subject.html#21643">[ subject ]</a>
              <a href="author.html#21643">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David,

On 01/08/12 18:20, David Brown wrote:
&gt;<i> has there been any work on this issue (i.e. errors when doing admin work
</I>&gt;<i> on a cluster)?
</I>
yes, but it will likely be a few months before these changes make it 
into a release.

&gt;<i> I've got a tiny, two node development cluster.  Removing
</I>&gt;<i> the ram node caused the remaining (disc) node to fail on startup with a
</I>&gt;<i> mnesia related error when I restarted it.  Eventually, the remaining
</I>&gt;<i> (disc) node started up, but it still thinks the other node is clustered
</I>&gt;<i> with it.  I've tried everything to try and get this node to realize it
</I>&gt;<i> is the only node left in the cluster, nothing works.  FWIW the removed
</I>&gt;<i> node does realize it is no longer part of the two node cluster.
</I>&gt;<i>
</I>&gt;<i> I was very careful in terms of following the exact steps in the
</I>&gt;<i> 'Breaking up a cluster' section on the rabbitmq web site.
</I>
Hmm. It certainly looks like the disk node still thinks it is clustered 
with the ram node, and consequently it will fail to merge its schema 
with it when starting. That really shouldn't happen if you indeed 
followed the documented steps when breaking up the cluster, in 
particular the disk node was up and running when removing the ram node.

If you can reproduce the problem then please post a transcript of the 
commands.

&gt;<i> At this point, I'm a bit concerned about basing our production
</I>&gt;<i> systems around rabbitmq (we're a small hedge fund) when it seems to
</I>&gt;<i> fail on the simplest of tasks.
</I>
Clustering is hardly the &quot;simplest of tasks&quot; - sending and receiving 
messages is ;)

The clustering code hasn't changed much in 4+ years. It is stable but 
suffers from little mistakes resulting in situations that are hard to 
recover from - that's what Francesco is addressing.

I suggest you conduct some more experiments and keep transcripts of 
everything you are doing. Then, if you do encounter a weird situation it 
will be much easier to reproduce and diagnose the problem.

Also, are you sure you actually *need* clustering? It does, by 
necessity, add a significant amount of complexity and possible failure 
modes, so only use it if you have to.

Regards,

Matthias.
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021642.html">[rabbitmq-discuss] Mnesia corrupting after node joining cluster
</A></li>
	<LI>Next message: <A HREF="021655.html">[rabbitmq-discuss] OSGi and RabbitMQ Service layer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21643">[ date ]</a>
              <a href="thread.html#21643">[ thread ]</a>
              <a href="subject.html#21643">[ subject ]</a>
              <a href="author.html#21643">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
