<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20TCP%20Backpressure%20/%20Flow%20Control%20in%20C%23%0A%20producer&In-Reply-To=%3CF216F12DEE15B7429FB03C58643375521C4C3C52%40AMXPRD0410MB377.eurprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021768.html">
   <LINK REL="Next"  HREF="021771.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer</H1>
    <B>Ulli Berthold - Exactag GmbH</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20TCP%20Backpressure%20/%20Flow%20Control%20in%20C%23%0A%20producer&In-Reply-To=%3CF216F12DEE15B7429FB03C58643375521C4C3C52%40AMXPRD0410MB377.eurprd04.prod.outlook.com%3E"
       TITLE="[rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer">berthold at exactag.com
       </A><BR>
    <I>Wed Aug  8 12:55:59 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021768.html">[rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer
</A></li>
        <LI>Next message: <A HREF="021771.html">[rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21770">[ date ]</a>
              <a href="thread.html#21770">[ thread ]</a>
              <a href="subject.html#21770">[ subject ]</a>
              <a href="author.html#21770">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matthias,

well, it does happen here... There are times when our queues grow to a couple of million messages (which actually was not a problem in 2.7.1), in 2.8.4 it went into flow control mode when the CPU load got higher though not limiting out.

Our problem is that we constantly produce lots of messages which have to be forwarded within milliseconds or we will run into frontend delays which should not occur.
I'm looking for a way to keep the queueing server accepting messages at the highest possible rate no matter what, for as long as it's not &quot;full&quot; (memory, disk, cpu). There is no real way for us to limit the input. And we know that the consumers will clear out the queues sooner or later, just not in real time.

And when we finally reach a point where the server is almost full, I'd curious if the flow control events of the C# driver will ever be fired? As I said, that would enable us to use a file-based fallback that's mostly intended for queuing server downtimes.

channel = connection.CreateModel();
    channel.ChannelFlow(true);
    channel.FlowControl += new RabbitMQ.Client.Events.FlowControlEventHandler(channel_FlowControl);

Regards from Germany

Ulli

-----Urspr&#252;ngliche Nachricht-----
Von: Matthias Radestock [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>] 
Gesendet: Mittwoch, 8. August 2012 11:50
An: Ulli Berthold - Exactag GmbH
Cc: Discussions about RabbitMQ
Betreff: Re: AW: AW: AW: AW: [rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer

Ulli,

On 08/08/12 10:29, Ulli Berthold - Exactag GmbH wrote:
&gt;<i> we're running rabbit 2.8.4 / 2.8.5 on 64bit linux servers with 64bit 
</I>&gt;<i> erlang and plenty of memory, and there was no &quot;high watermark&quot;
</I>&gt;<i> warning in the logs either. Just to make sure i'm not erring to much
</I>&gt;<i> - if the rabbit web ui shows a connection as &quot;flow&quot; instead of 
</I>&gt;<i> &quot;running&quot; or &quot;blocked&quot; that does mean it is in flow control 
</I>&gt;<i> (backpressure), correct?
</I>
Correct, but as noted at
<A HREF="http://www.rabbitmq.com/memory.html#per-connection,">http://www.rabbitmq.com/memory.html#per-connection,</A> this kind of flow control is triggered many times a second.

It's really not something an application should need to worry about. And it does *not* mean the producer is blocked, since there are many buffers between the application and the broker connection handler that need to fill up first. That way spikes can be absorbed.

Obviously if producers attempt to publish at a *sustained* rate that is higher than the broker can handle then backpressure will propagate to the client and slow them down. The point at which that happens should be way higher than the 3kHz rate you anticipate.

Matthias.


</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021768.html">[rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer
</A></li>
	<LI>Next message: <A HREF="021771.html">[rabbitmq-discuss] TCP Backpressure / Flow Control in C# producer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21770">[ date ]</a>
              <a href="thread.html#21770">[ thread ]</a>
              <a href="subject.html#21770">[ subject ]</a>
              <a href="author.html#21770">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
