<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Timeout for hung connection on rabbitmq server?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Timeout%20for%20hung%20connection%20on%20rabbitmq%20server%3F&In-Reply-To=%3C20120813140809.290f73f6%40beans.lunch.za.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021882.html">
   <LINK REL="Next"  HREF="021835.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Timeout for hung connection on rabbitmq server?</H1>
    <B>Andrew McGill</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Timeout%20for%20hung%20connection%20on%20rabbitmq%20server%3F&In-Reply-To=%3C20120813140809.290f73f6%40beans.lunch.za.net%3E"
       TITLE="[rabbitmq-discuss] Timeout for hung connection on rabbitmq server?">list2012 at lunch.za.net
       </A><BR>
    <I>Mon Aug 13 13:08:09 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021882.html">[rabbitmq-discuss] RabbitMQ Monitoring
</A></li>
        <LI>Next message: <A HREF="021835.html">[rabbitmq-discuss] Timeout for hung connection on rabbitmq	server?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21827">[ date ]</a>
              <a href="thread.html#21827">[ thread ]</a>
              <a href="subject.html#21827">[ subject ]</a>
              <a href="author.html#21827">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi rabbitmq list folks,

I have a rabbitmq client on a dynamic IP address.  This client connects to a rabbitmq server, and the connection is in ESTABLISHED state.  Some time later, the IP address of the client changes (without prior notice to the client), and the client makes a new connection to the rabbitmq server.  The trouble is that messages for the queue are sent to the OLD IP address, which is pretty much a black hole.  As far as the rabbitmq server is concerned nothing has occurred to indicate that the connection is down.  This situation seems to persist for quite a long time (at least 20 minutes) until some kind of timeout happens on the server.  

 * Is there a way to set the timeout value for a failed keepalive (assuming keepalive packets are in fact being sent... I see the default tcp timeout for Linux is two hours + 11 minutes, which is not quite what I need.)

 * Alternatively, is there something in this configuration which will stop keepalive from noticing that a connection has died?  (e.g. something to do with the SSL connection parameters?) 

 * Even more alternatively, is there some way that the newest client connection can identify itself as the best and most suitable instance of itself when it makes the new connection?  

If it makes any difference, the client software is AMQPlib for PHP, using SSL.

The server rabbitmq config says:

[
  {rabbit, [
    {tcp_listeners,[]},
    {tcp_listen_options, [binary,
                     {packet, raw},
                     {reuseaddr, true},
                     {backlog, 128},
                     {nodelay, true},
                     {exit_on_close, false},
                     {keepalive, true}]},
    {ssl_listeners,[5671]},
    {ssl_options, [{cacertfile,&quot;/etc/rabbitmq/ca.crt&quot;},
                    {certfile,&quot;/etc/rabbitmq/rmq.crt&quot;},
                    {keyfile,&quot;/etc/rabbitmq/rmq.rsakey&quot;},
                    {verify,verify_peer},
                    {keepalive, true},
                    {fail_if_no_peer_cert,true}]}
  ]}
].

&amp;:-)
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021882.html">[rabbitmq-discuss] RabbitMQ Monitoring
</A></li>
	<LI>Next message: <A HREF="021835.html">[rabbitmq-discuss] Timeout for hung connection on rabbitmq	server?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21827">[ date ]</a>
              <a href="thread.html#21827">[ thread ]</a>
              <a href="subject.html#21827">[ subject ]</a>
              <a href="author.html#21827">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
