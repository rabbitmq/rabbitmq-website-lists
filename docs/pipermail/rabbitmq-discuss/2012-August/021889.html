<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Optimizing RabbitMQ
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Optimizing%20RabbitMQ&In-Reply-To=%3CCAEk0_N7g8Bnrm65PCqPhjLCogc9zyVDvLYgvZwqbeGxSq0%2Bn-Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021880.html">
   <LINK REL="Next"  HREF="021954.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Optimizing RabbitMQ</H1>
    <B>Tom Wrigglesworth</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Optimizing%20RabbitMQ&In-Reply-To=%3CCAEk0_N7g8Bnrm65PCqPhjLCogc9zyVDvLYgvZwqbeGxSq0%2Bn-Q%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Optimizing RabbitMQ">tadw99 at googlemail.com
       </A><BR>
    <I>Wed Aug 15 14:59:30 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021880.html">[rabbitmq-discuss] Optimizing RabbitMQ
</A></li>
        <LI>Next message: <A HREF="021954.html">[rabbitmq-discuss] Optimizing RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21889">[ date ]</a>
              <a href="thread.html#21889">[ thread ]</a>
              <a href="subject.html#21889">[ subject ]</a>
              <a href="author.html#21889">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Thanks for your reply.

So is the 40ms the time it takes for a message to travel from the game
&gt;<i> logic server to the web browser?
</I>

It's the time between the message being published and the message being
delivered. I have output from wireshark looking something similar to:

      #     Time          From                   To
 Protocol   Length   Info
...
    155 1.539600    127.0.0.1             127.0.0.1             AMQP
115     Basic.Publish
    157 1.579834    127.0.0.1             127.0.0.1             AMQP
3873   Content-Header Content-Body
    159 1.580942    127.0.0.1             127.0.0.1             AMQP
3963   Basic-Deliver Content-Header Content-Body
    160 1.590769    127.0.0.1             127.0.0.1             AMQP
115     Basic.Publish
    162 1.627732    127.0.0.1             127.0.0.1             AMQP
3873   Content-Header Content-Body
    164 1.628295    127.0.0.1             127.0.0.1             AMQP
3963   Basic-Deliver Content-Header Content-Body
    165 1.638748    127.0.0.1             127.0.0.1             AMQP
115     Basic.Publish
    167 1.675834    127.0.0.1             127.0.0.1             AMQP
3873   Content-Header Content-Body
    169 1.676850    127.0.0.1             127.0.0.1             AMQP
3963   Basic-Deliver Content-Header Content-Body
...

This looks to me like it is AMQP that is taking about 40ms between publish
and deliver. Is this because of certain server settings i'm running,
interference from the node server running at the same time on the same
machine or some other reason?

Thank you for your time.

Tom.

On 15 August 2012 12:18, Matthias Radestock &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt; wrote:

&gt;<i> To,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 15/08/12 12:07, Emile Joubert wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On 14/08/12 21:32, Tom Wrigg wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Is there a way to turn off acknowledgements? would this make things
</I>&gt;&gt;&gt;<i> faster?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes, you can consume in auto-ack mode. Or you can impact performance
</I>&gt;&gt;<i> much less and get the advantages of acknowledgements if you acknowledge
</I>&gt;&gt;<i> messages in batches.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Are there any other methods I could use to increase speed/ reduce
</I>&gt;&gt;&gt;<i> latency?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here are some suggestions, which you should benchmark with your own
</I>&gt;&gt;<i> workload.
</I>&gt;&gt;<i> [snip]
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Actually, if you are seeing 40ms latency it is very, very unlikely that
</I>&gt;<i> the RabbitMQ broker is responsible for most of that.
</I>&gt;<i>
</I>&gt;<i>  Game Logic server ---&gt; AMQP topic exchange ---&gt; websockets ---&gt;
</I>&gt;&gt;&gt;<i> web-browser.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> So is the 40ms the time it takes for a message to travel from the game
</I>&gt;<i> logic server to the web browser? If so I suggest you measure the latency at
</I>&gt;<i> each step. It could easily be that the bulk of the 40ms is simply network
</I>&gt;<i> latency between your node instance and the web browser, or between node and
</I>&gt;<i> the broker. Or it could be that node/node-amqp are slow.
</I>&gt;<i>
</I>&gt;<i>  Why is it taking so long to route a message? I've read of servers
</I>&gt;&gt;<i> doing 12,000+ messages per second.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> A lot more than that, actually - see <A HREF="http://www.rabbitmq.com/blog/**">http://www.rabbitmq.com/blog/**</A>
</I>&gt;<i> 2012/04/25/rabbitmq-**performance-measurements-part-**2/&lt;<A HREF="http://www.rabbitmq.com/blog/2012/04/25/rabbitmq-performance-measurements-part-2/">http://www.rabbitmq.com/blog/2012/04/25/rabbitmq-performance-measurements-part-2/</A>&gt;.
</I>&gt;<i> However, you are confusing latency with throughput. High throughput is
</I>&gt;<i> still possible in situations when there is high latency, as long as
</I>&gt;<i> synchronous operations are avoided. High prefetch limits or even using
</I>&gt;<i> no-ack are one way to achieve that on the consuming side.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Matthias.
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/56d73d7e/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120815/56d73d7e/attachment.htm</A>&gt;
</PRE>


































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021880.html">[rabbitmq-discuss] Optimizing RabbitMQ
</A></li>
	<LI>Next message: <A HREF="021954.html">[rabbitmq-discuss] Optimizing RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21889">[ date ]</a>
              <a href="thread.html#21889">[ thread ]</a>
              <a href="subject.html#21889">[ subject ]</a>
              <a href="author.html#21889">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
