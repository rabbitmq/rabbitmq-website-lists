From alexis at rabbitmq.com  Tue May  1 06:34:10 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 1 May 2012 06:34:10 +0100
Subject: [rabbitmq-discuss] Can I set the level of replication for
 rabbitmq clustering?
In-Reply-To: <CAHSyJgKSbCu+SbfRmyLkUH9LX50rnV0GB0357=+w1-TqPEohJQ@mail.gmail.com>
References: <CAHSyJgKSbCu+SbfRmyLkUH9LX50rnV0GB0357=+w1-TqPEohJQ@mail.gmail.com>
Message-ID: <CACOPnvcbQMPD+sVrPZmB=rau9LvkSDuPu9mC+W=HuVnpFYA05A@mail.gmail.com>

Gautam

Have you considered managing the work load by migrating consumers
instead of queues?  This is not only substantially less expensive, but
it's also much better supported by Rabbit.

To your question: while it is possible to manage the number of
replicas, this is for mirroring and not migration.  Therefore, even if
you assume zero network cost, you will still need multiple consumers
on what is in effect a single logical queue.

alexis


On Mon, Apr 30, 2012 at 9:54 PM, Gautam Bakshi <gautam.bakshi at gmail.com> wrote:
> Hi Everyone!
>
> My work items are very small but amount of work is very large ?and network
> IO is quite a large overhead(not Rabbit's fault, my bandwidth is limited).
> So I'm thinking of running a local rabbitmq on each of my worker servers and
> then replicating work locally for them to pull and push messages to.
>
> I can write a program that messages the queue by monitoring them and if one
> servers queue gets empty it takes a few thousand from another server but I'm
> wondering if thats needed if I use the clustering feature??I know how to set
> it up but how it works is a bit unclear to me. ?Can I set the replication
> not to replicate everything all the time but only a few jobs when the queues
> get below a specific threshold?
>
> Also, right now I'm using localhost to connect but if all my access is
> entirely local is there a faster way to connect such a direct socket? ?Any
> suggestions or ideas would be greatly appreciated.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From mcumings at narrativescience.com  Tue May  1 16:07:38 2012
From: mcumings at narrativescience.com (Michael Cumings)
Date: Tue, 1 May 2012 10:07:38 -0500
Subject: [rabbitmq-discuss] RabbitMQ Management shows messages and no queues
Message-ID: <CAMscK0b5G6j1r7w2uCp0SA18D_eRHM-fwp2X8M32SHHi+Xh=wA@mail.gmail.com>

I'm betting there's a simple answer that I can't find in google.

The Management Overview was showing 100 messages ready.  The Queues tab had
no queues.  In both, I was showing all vhosts.  Command line rabbitmqctl
list_queues also returned no queues.  I reset one of the servers and the
number of messages went down.  I went through and reset all three servers
in the cluster and they all disappeared.  This happened in a development
environment where there had been no use for over 12 hours, but there were
still 3 connections open.  I'm using version 2.8.1 installed directly from
the deb on the RabbitMQ repo.

What can cause this to happen?  Where were those messages?  Is there a way
for me view and interact with messages in that state?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120501/702b2ba5/attachment.htm>

From james.e.bias at emory.edu  Tue May  1 19:32:01 2012
From: james.e.bias at emory.edu (Bias, James)
Date: Tue, 1 May 2012 18:32:01 +0000
Subject: [rabbitmq-discuss] --version support
Message-ID: <75967481FE40C7458D967B1E2422A5B516E5E27F@e14mbx22n.Enterprise.emory.net>

if you guys are going to make a linux daemon, please at least obey some of the standard conventions.
The big one I would like you guys to fix is --version.
You daemon should respond with its current version, some programs just spit out a number(which is all that is really needed), others include a link to the home page and a short text about the program.
Just having it spit out the version number would be enough to make me and the other sysadmins happy.

________________________________

This e-mail message (including any attachments) is for the sole use of
the intended recipient(s) and may contain confidential and privileged
information. If the reader of this message is not the intended
recipient, you are hereby notified that any dissemination, distribution
or copying of this message (including any attachments) is strictly
prohibited.

If you have received this message in error, please contact
the sender by reply e-mail message and destroy all copies of the
original message (including attachments).

From alex.gronholm at nextday.fi  Tue May  1 23:38:15 2012
From: alex.gronholm at nextday.fi (=?UTF-8?B?QWxleCBHcsO2bmhvbG0=?=)
Date: Wed, 02 May 2012 01:38:15 +0300
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <4F9EC4D8.1090308@rabbitmq.com>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>	<4ED8C280.9020707@rabbitmq.com>	<19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>	<4ED8C82E.1070906@rabbitmq.com>	<855F810E-DE11-413C-B3D6-D65D5CA82EC9@rabbitmq.com>	<5024586.436.1323053328384.JavaMail.geo-discussion-forums@yqkp3>	<A9B0DFE2-DA9D-4FE0-BD67-29174617F598@rabbitmq.com>	<20398578.95.1323605677788.JavaMail.geo-discussion-forums@yqfm20>
	<4F98D869.60400@nextday.fi> <4F9EC4D8.1090308@rabbitmq.com>
Message-ID: <4FA065D7.3040707@nextday.fi>

30.04.2012 19:59, Matthias Radestock kirjoitti:
> Alex,
>
> On 26/04/12 06:08, Alex Gr?nholm wrote:
>>> You want requests to either be processed or (reliably) not
>>> processed. You never want the clients to be in any doubt about
>>> whether the request was processed or not. So you wait forever in
>>> the client. However, requests that get discarded never return so
>>> the client doesn't know. So you want expiry to trigger replies to
>>> the clients. (Per-queue message TTLs also don't return.) >>
>>>
>>>  Sounds about right.
>>>
>>> Let's see -- how would we do this without a dead-letter mechanism? >>
>> Now that the dead-letter mechanism is part of the server, I don't still
>> don't see how this could be done. The dead lettered RPC commands would
>> still have to be processed somewhere.
>
> Right. Ideally you'd need a way to specify a dead-letter destination 
> *per message*. However, working with what is possible today, instead 
> you could just have a single "dead request" queue to which all expired 
> requests get routed. And then have a small app simply consuming 
> messages from that queue and replying to them with some sort of error 
> indication.
That did occur to me, but if I was able to launch an "answering machine" 
app, why not the real one too while I'm at it?

Thanks for the answer, but is there any hope for a real solution? Could 
this be cleanly done with a plugin?
>
> Regards,
>
> Matthias.


From konstantin.kalin at gmail.com  Wed May  2 00:48:58 2012
From: konstantin.kalin at gmail.com (Konstantin Kalin)
Date: Tue, 1 May 2012 16:48:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Direct vs Topic exchange - Question
Message-ID: <87d7fc6b-cad6-42ab-8a34-afe1846e8332@a8g2000pbe.googlegroups.com>

Hello,

I tried to check performance difference between Direct and Topic
exchanges with simple key (no * and #) and got unexpected results.

My test is simple: 10 publishers and 10 consumers (10 queues binded to
the exchange). Each consumer and publisher have own channel and
connection (1 to 1 relation). The routing key is pretty simple as
well: key.X where X is number of publisher/consumer. The exchanges are
declared with nowait=true. The publisher client code controls the rate
of message per second.

Test 1 - I run test for Direct exchange I get ~40k messages per second
according to RabbitMQ management plugin. CPU load is 80% on RabbitMQ
and Memory is always below the watermark. Seems to be good. RabbitMQ
management plugin shows "No flow" control on publishers connections.

Test 2 - I run same test for Topic exchange I get constantly ~4k
messages per second. CPU is around ~15% and Memory is ~200k out of
1.5Gb on RabbitMQ node. RabbitMQ management plugin shows constant
"Flow" control on publishers connections.

Could you please advise that I'm doing wrong? Why does RabbitMQ force
"Flow" control in case of Topic Exchange? I see "Flow" control on
Direct Exchange when Memory reaches high-water mark and CPU is ~90%.

I tested with RabbitMQ 2.7.0 and 2.8.2. The result is the same.  I use
Erlang client library.

Thank you,
Kostya.

From matthias at rabbitmq.com  Wed May  2 06:26:23 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 02 May 2012 06:26:23 +0100
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <4FA065D7.3040707@nextday.fi>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>	<4ED8C280.9020707@rabbitmq.com>	<19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>	<4ED8C82E.1070906@rabbitmq.com>	<855F810E-DE11-413C-B3D6-D65D5CA82EC9@rabbitmq.com>	<5024586.436.1323053328384.JavaMail.geo-discussion-forums@yqkp3>	<A9B0DFE2-DA9D-4FE0-BD67-29174617F598@rabbitmq.com>	<20398578.95.1323605677788.JavaMail.geo-discussion-forums@yqfm20>	<4F98D869.60400@nextday.fi>
	<4F9EC4D8.1090308@rabbitmq.com> <4FA065D7.3040707@nextday.fi>
Message-ID: <4FA0C57F.3060305@rabbitmq.com>

Alex,

On 01/05/12 23:38, Alex Gr?nholm wrote:
> 30.04.2012 19:59, Matthias Radestock kirjoitti:
>> Right. Ideally you'd need a way to specify a dead-letter destination
>> *per message*. However, working with what is possible today, instead
>> you could just have a single "dead request" queue to which all expired
>> requests get routed. And then have a small app simply consuming
>> messages from that queue and replying to them with some sort of error
>> indication.
> That did occur to me, but if I was able to launch an "answering machine"
> app, why not the real one too while I'm at it?
>
> Thanks for the answer, but is there any hope for a real solution? Could
> this be cleanly done with a plugin?

Yep. It could be done cleanly with a plugin that employs the Erlang 
client in 'direct' mode to implement said "answering machine" app.

Of course if you take that approach to the extreme then you'd write your 
*entire* app as a plugin ;)

Matthias.

From matthias at rabbitmq.com  Wed May  2 06:43:53 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 02 May 2012 06:43:53 +0100
Subject: [rabbitmq-discuss] log process
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD369647EA@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>	<5F389C517756284F80239F55BCA5DDDD36964188@G9W0721.americas.hpqcorp.net>	<CAHZsVQamUcKi5+4dwcGVCp1Q-HgMW30zoSkGvkNX41h5VLM+yg@mail.gmail.com>
	<5F389C517756284F80239F55BCA5DDDD369647EA@G9W0721.americas.hpqcorp.net>
Message-ID: <4FA0C999.6010406@rabbitmq.com>

Andrea,

On 26/04/12 10:37, Rosa, Andrea (HP Cloud Services) wrote:
> Here the configuration I am using:
>
> cat /etc/logrotate.d/rabbitmq-server [...]

That looks fine - it's the default logrotate configuration we ship :)

> Rabbitmq didn't produce log files for 5 days, from the .log.1 to .log
> file there is a gap of 5 days

That is normal; with the given config the logs will be rotated weekly.

> The server was running during this gap and it's impossible not to
> have log entries in the log file as our system was running and
> producing entries.

Are you saying the .log file was empty?

Matthias.

From alex.gronholm at nextday.fi  Wed May  2 08:20:20 2012
From: alex.gronholm at nextday.fi (=?UTF-8?B?QWxleCBHcsO2bmhvbG0=?=)
Date: Wed, 02 May 2012 10:20:20 +0300
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <4FA0C57F.3060305@rabbitmq.com>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>	<4ED8C280.9020707@rabbitmq.com>	<19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>	<4ED8C82E.1070906@rabbitmq.com>	<855F810E-DE11-413C-B3D6-D65D5CA82EC9@rabbitmq.com>	<5024586.436.1323053328384.JavaMail.geo-discussion-forums@yqkp3>	<A9B0DFE2-DA9D-4FE0-BD67-29174617F598@rabbitmq.com>	<20398578.95.1323605677788.JavaMail.geo-discussion-forums@yqfm20>	<4F98D869.60400@nextday.fi>
	<4F9EC4D8.1090308@rabbitmq.com> <4FA065D7.3040707@nextday.fi>
	<4FA0C57F.3060305@rabbitmq.com>
Message-ID: <4FA0E034.1060207@nextday.fi>

02.05.2012 08:26, Matthias Radestock kirjoitti:
> Alex,
>
> On 01/05/12 23:38, Alex Gr?nholm wrote:
>> 30.04.2012 19:59, Matthias Radestock kirjoitti:
>>> Right. Ideally you'd need a way to specify a dead-letter destination
>>> *per message*. However, working with what is possible today, instead
>>> you could just have a single "dead request" queue to which all expired
>>> requests get routed. And then have a small app simply consuming
>>> messages from that queue and replying to them with some sort of error
>>> indication.
>> That did occur to me, but if I was able to launch an "answering machine"
>> app, why not the real one too while I'm at it?
>>
>> Thanks for the answer, but is there any hope for a real solution? Could
>> this be cleanly done with a plugin?
>
> Yep. It could be done cleanly with a plugin that employs the Erlang 
> client in 'direct' mode to implement said "answering machine" app.
>
> Of course if you take that approach to the extreme then you'd write 
> your *entire* app as a plugin ;)
>
> Matthias.
No thanks, I've looked into the Erlang language and while I like many of 
the ideas and patterns it employs, Python's syntax still wins big time 
for its power and efficiency.

From emile at rabbitmq.com  Wed May  2 10:57:29 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 02 May 2012 10:57:29 +0100
Subject: [rabbitmq-discuss] --version support
In-Reply-To: <75967481FE40C7458D967B1E2422A5B516E5E27F@e14mbx22n.Enterprise.emory.net>
References: <75967481FE40C7458D967B1E2422A5B516E5E27F@e14mbx22n.Enterprise.emory.net>
Message-ID: <4FA10509.4040702@rabbitmq.com>

On 01/05/12 19:32, Bias, James wrote:
> if you guys are going to make a linux daemon, please at least obey
> some of the standard conventions. The big one I would like you guys
> to fix is --version. You daemon should respond with its current
> version, some programs just spit out a number(which is all that is
> really needed), others include a link to the home page and a short
> text about the program. Just having it spit out the version number
> would be enough to make me and the other sysadmins happy.

RabbitMQ does not only run on Linux and could be better described as a
multiplatform Erlang service than a linux daemon.

RabbitMQ cannot report its own version without starting up. Once the
broker has started up up you can determine the version number using
"rabbitmqctl status", which will report the versions of all running
Erlang applications under "running_applications".

You will also find the version reported in the startup banner (typically
/var/log/rabbitmq/startup_log) after starting up.

If you want to query the version without starting up the broker, and you
installed RabbitMQ from a package, then you could query your package
manager for the version.


-Emile



From andrea.rosa at hp.com  Wed May  2 11:58:12 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Wed, 2 May 2012 10:58:12 +0000
Subject: [rabbitmq-discuss] log process
In-Reply-To: <4FA0C999.6010406@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>
	<5F389C517756284F80239F55BCA5DDDD36964188@G9W0721.americas.hpqcorp.net>
	<CAHZsVQamUcKi5+4dwcGVCp1Q-HgMW30zoSkGvkNX41h5VLM+yg@mail.gmail.com>
	<5F389C517756284F80239F55BCA5DDDD369647EA@G9W0721.americas.hpqcorp.net>
	<4FA0C999.6010406@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD3696750E@G9W0721.americas.hpqcorp.net>

Hi Matthias

Thanks for your reply.

>That looks fine - it's the default logrotate configuration we ship :)


That's fine

>
>> Rabbitmq didn't produce log files for 5 days, from the .log.1 to .log
>> file there is a gap of 5 days
>
>That is normal; with the given config the logs will be rotated weekly.
>> The server was running during this gap and it's impossible not to
>> have log entries in the log file as our system was running and
>> producing entries.
>
>Are you saying the .log file was empty?


Sorry I didn't explain this thing very well.
According to the timestamp in the log, the last entry was 5 days old and it was really strange and unlikely as the system produces a lot of log entries every day.
I am thinking about some failure in the log rotate as the last entry in the log was:

>INFO REPORT==== 15-Apr-2012::06:30:37 === Rotating logs with suffix ''

Regards
--
Andrea

From matthias at rabbitmq.com  Wed May  2 13:24:29 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 02 May 2012 13:24:29 +0100
Subject: [rabbitmq-discuss] log process
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD3696750E@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>	<5F389C517756284F80239F55BCA5DDDD36964188@G9W0721.americas.hpqcorp.net>	<CAHZsVQamUcKi5+4dwcGVCp1Q-HgMW30zoSkGvkNX41h5VLM+yg@mail.gmail.com>
	<5F389C517756284F80239F55BCA5DDDD369647EA@G9W0721.americas.hpqcorp.net>
	<4FA0C999.6010406@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3696750E@G9W0721.americas.hpqcorp.net>
Message-ID: <4FA1277D.3070704@rabbitmq.com>

Andrea,

On 02/05/12 11:58, Rosa, Andrea (HP Cloud Services) wrote:
>> Are you saying the .log file was empty?
>
>
> Sorry I didn't explain this thing very well. According to the
> timestamp in the log, the last entry was 5 days old and it was really
> strange and unlikely as the system produces a lot of log entries
> every day. I am thinking about some failure in the log rotate as the
> last entry in the log was:
>
>> INFO REPORT==== 15-Apr-2012::06:30:37 === Rotating logs with suffix
>> ''

Where was that entry? In the .log.1 file or the .log file? If it was in 
the former then that is expected, i.e. it's the last thing written 
before the log is rotated.

The current log entries should always go into the .log file. Hence my 
question whether that file was empty, or perhaps did not exist at all.

Matthias.

From andrea.rosa at hp.com  Wed May  2 14:22:28 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Wed, 2 May 2012 13:22:28 +0000
Subject: [rabbitmq-discuss] log process
In-Reply-To: <4FA1277D.3070704@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>
	<5F389C517756284F80239F55BCA5DDDD36964188@G9W0721.americas.hpqcorp.net>
	<CAHZsVQamUcKi5+4dwcGVCp1Q-HgMW30zoSkGvkNX41h5VLM+yg@mail.gmail.com>
	<5F389C517756284F80239F55BCA5DDDD369647EA@G9W0721.americas.hpqcorp.net>
	<4FA0C999.6010406@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3696750E@G9W0721.americas.hpqcorp.net>
	<4FA1277D.3070704@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD369675C3@G9W0721.americas.hpqcorp.net>



>>> INFO REPORT==== 15-Apr-2012::06:30:37 === Rotating logs with suffix
>>> ''
>
>Where was that entry? In the .log.1 file or the .log file? If it was in
>the former then that is expected, i.e. it's the last thing written
>before the log is rotated.


Yes, it was the last entry in .log.1

>
>The current log entries should always go into the .log file. Hence my
>question whether that file was empty, or perhaps did not exist at all.

The .log file did not exist at all.

Thanks
--
ar

From simon at rabbitmq.com  Wed May  2 14:34:02 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 02 May 2012 14:34:02 +0100
Subject: [rabbitmq-discuss] Direct vs Topic exchange - Question
In-Reply-To: <87d7fc6b-cad6-42ab-8a34-afe1846e8332@a8g2000pbe.googlegroups.com>
References: <87d7fc6b-cad6-42ab-8a34-afe1846e8332@a8g2000pbe.googlegroups.com>
Message-ID: <4FA137CA.2000809@rabbitmq.com>

On 02/05/12 00:48, Konstantin Kalin wrote:
> Test 1 - I run test for Direct exchange I get ~40k messages per second
> according to RabbitMQ management plugin. CPU load is 80% on RabbitMQ
> and Memory is always below the watermark. Seems to be good. RabbitMQ
> management plugin shows "No flow" control on publishers connections.
>
> Test 2 - I run same test for Topic exchange I get constantly ~4k
> messages per second. CPU is around ~15% and Memory is ~200k out of
> 1.5Gb on RabbitMQ node. RabbitMQ management plugin shows constant
> "Flow" control on publishers connections.

This is very odd, and not what I would expect at all.

Topic exchanges are slower than direct exchanges - the routing logic is 
after all more complicated - but it certainly shouldn't be a factor of 10.

Also, if you are pushing messages as fast as you can at Rabbit 2.8.0+, 
it should go into flow control regardless of where the actual bottleneck is.

Can you post the code you were running?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed May  2 14:46:44 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 02 May 2012 14:46:44 +0100
Subject: [rabbitmq-discuss] Which dll to reference when building my own
 Producer-Consumer wrapper?
In-Reply-To: <e84d3895-51ee-4e5d-83c1-ab211a43d28e@ri8g2000pbc.googlegroups.com>
References: <e84d3895-51ee-4e5d-83c1-ab211a43d28e@ri8g2000pbc.googlegroups.com>
Message-ID: <4FA13AC4.40603@rabbitmq.com>

Hi,

On 27/04/12 21:07, cadeli wrote:
> Beginner question here.
> I am building my first Producer - Consumer .Net4.0 app, using
> AMQP-0-9. I reference MessageBus.dll.
> Just noticed that the Spring AMQP implementation references
> RabbitMQ.Client.dll.
> Should I switch? What would be the advantages/disadvantages?

How did you obtain MessageBus.dll? RabbitMQ.Client.dll is an artefact of
the RabbitMQ .NET client and we are able to answer questions about that.

-Emile


From konstantin.kalin at gmail.com  Wed May  2 17:09:14 2012
From: konstantin.kalin at gmail.com (Konstantin Kalin)
Date: Wed, 2 May 2012 09:09:14 -0700
Subject: [rabbitmq-discuss] Direct vs Topic exchange - Question
In-Reply-To: <4FA137CA.2000809@rabbitmq.com>
References: <87d7fc6b-cad6-42ab-8a34-afe1846e8332@a8g2000pbe.googlegroups.com>
	<4FA137CA.2000809@rabbitmq.com>
Message-ID: <314905EC-5B0F-4469-BDCD-FF86F6C12078@gmail.com>

Hello, Simon.

Thank you for looking at this. Please see inline. 

On May 2, 2012, at 6:34 AM, Simon MacMullen wrote:

> On 02/05/12 00:48, Konstantin Kalin wrote:
>> Test 1 - I run test for Direct exchange I get ~40k messages per second
>> according to RabbitMQ management plugin. CPU load is 80% on RabbitMQ
>> and Memory is always below the watermark. Seems to be good. RabbitMQ
>> management plugin shows "No flow" control on publishers connections.
>> 
>> Test 2 - I run same test for Topic exchange I get constantly ~4k
>> messages per second. CPU is around ~15% and Memory is ~200k out of
>> 1.5Gb on RabbitMQ node. RabbitMQ management plugin shows constant
>> "Flow" control on publishers connections.
> 
> This is very odd, and not what I would expect at all.
> 
> Topic exchanges are slower than direct exchanges - the routing logic is after all more complicated - but it certainly shouldn't be a factor of 10.
> 
> Also, if you are pushing messages as fast as you can at Rabbit 2.8.0+, it should go into flow control regardless of where the actual bottleneck is.
> 
> Can you post the code you were running?
> 

Sure. Please look at attached file. It contains the source code that I runs. It can be compiled using rebar.
Here is short explanation for the code:
apps ->
	common - library module. It contains connection pool, publisher and consumer worker modules. I use connection pool since I also do testing for RabbitMQ cluster.
	consumer - Consumer app. It's kinda stupid app with one supervisor to start consumer workers and API helpers functions. See consumer.erl
	publisher - Publisher app. It's same as the consumer app. There is API module as well (publisher.erl)
lib ->
	rabbit_common
	amqp_client 

All code is pretty straight forward. Connection pool accepts URLs and amount of connections per URL. It works in Round-Robin mode. Publisher does "basic.publish" and Consumer uses subscription. 

I will continue digging it. What's odd for me RabbitMQ does "Flow control" when it seems to be fine: Memory and CPU are low on RabbitMQ node. It looks like there is no reason to do "flow control". 

P.S. RabbitMQ node is VM with 8 CPUs and 4Gb memory. 


> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware

Thank you,
Kostya.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitMQ.tar.gz
Type: application/x-gzip
Size: 481510 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120502/ba8f7e71/attachment.bin>

From zilvinas.saltys at gmail.com  Wed May  2 17:49:01 2012
From: zilvinas.saltys at gmail.com (=?UTF-8?B?xb1pbHZpbmFzIMWgYWx0eXM=?=)
Date: Wed, 2 May 2012 17:49:01 +0100
Subject: [rabbitmq-discuss] cluster write/read performance
Message-ID: <CAC3L7Ff2DpRpZr-Ki9kffyP6zM8DQ_0=6n0tHXhcEu5xzRMtYA@mail.gmail.com>

Hi,

Let's say I have 3 remote rabbitmq brokers around the world and I need to
consume messages from them to a central cluster. As I understand from the
documentation all write operations happen on the master and then the master
replicates to slaves.

That means that the cluster's write/read performance is only as fast as the
master? In that case what happens if my master can no longer keep up and
starts lagging further and further behind from the remote brokers? Does it
mean I need to set up another independent cluster with it's own master to
deal with it?

If I'm still on the right path there is no real advantage to have more than
2 nodes in a cluster if all you need to do is consume from the cluster and
have a failover if something goes wrong as all consumes happen only on the
master ?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120502/402edb25/attachment.htm>

From james.poole at rsa.com  Wed May  2 20:24:07 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Wed, 2 May 2012 15:24:07 -0400
Subject: [rabbitmq-discuss] SSL Certificate Error
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D707F76EE52C@MX36A.corp.emc.com>

Can anyone help me understand what is happening when I try to enable SSL
using Non-OpenSSL certificates?  The certificates being used are working as
SSL Server certificates with Apache 2.2.22, but when I use them with
RabbitMQ, it is failing.  Also, if I generate OpenSSL certificates to test
with, the same setup works (same config file, server, etc).

 


From paulmedev at gmail.com  Thu May  3 01:01:10 2012
From: paulmedev at gmail.com (Paul Wehner)
Date: Wed, 2 May 2012 20:01:10 -0400
Subject: [rabbitmq-discuss] heroku beta
Message-ID: <60E7A332-060C-4155-A7DC-EF92D0F43935@gmail.com>

Would someone over at RabbitMQ be able to add me to the private heroku beta?

When I read the following blog post, it makes it sound as if its public:

http://blog.heroku.com/archives/2011/8/31/rabbitmq_add_on_now_available_on_heroku/

However, when I click the first link in the blog post:

https://addons.heroku.com/rabbitmq

It tells me that the test is only available to private beta users.

Thanks,
Paul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120502/d15f6765/attachment.htm>

From paulmedev at gmail.com  Thu May  3 02:09:31 2012
From: paulmedev at gmail.com (Paul Wehner)
Date: Wed, 2 May 2012 21:09:31 -0400
Subject: [rabbitmq-discuss] heroku beta
In-Reply-To: <D40CD772-4F25-40A9-88C9-583169AA0A90@rbcon.com>
References: <60E7A332-060C-4155-A7DC-EF92D0F43935@gmail.com>
	<D40CD772-4F25-40A9-88C9-583169AA0A90@rbcon.com>
Message-ID: <F2CF64EA-6809-4ACE-9CBA-26FD385BFDC2@gmail.com>

I'm sorry, I don't know what "IIRC" means. Is that another email list or webpage where I should ask? Should I do it as a support request or something over at Heroku?

Thanks,
Paul

On May 2, 2012, at 8:07 PM, Jerry Kuch wrote:

> IIRC, our friends at Heroku will have to sign you up. There uses to be a
> public signup page but without a real computer to hand I'm having trouble finding it just now...
> 
> Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).
> 
> 
> On May 2, 2012, at 5:01 PM, Paul Wehner <paulmedev at gmail.com> wrote:
> 
>> Would someone over at RabbitMQ be able to add me to the private heroku beta?
>> 
>> When I read the following blog post, it makes it sound as if its public:
>> 
>> http://blog.heroku.com/archives/2011/8/31/rabbitmq_add_on_now_available_on_heroku/
>> 
>> However, when I click the first link in the blog post:
>> 
>> https://addons.heroku.com/rabbitmq
>> 
>> It tells me that the test is only available to private beta users.
>> 
>> Thanks,
>> Paul
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120502/4ddf9497/attachment.htm>

From gautam.bakshi at gmail.com  Thu May  3 04:34:41 2012
From: gautam.bakshi at gmail.com (Gautam Bakshi)
Date: Wed, 2 May 2012 23:34:41 -0400
Subject: [rabbitmq-discuss] please help understanding why my pool of
	channels are blocking.
Message-ID: <CAHSyJgJvZ+NXn1+51i5KN10HZ3mQY56Cz+KjiPfzMVuEaEwpsg@mail.gmail.com>

Hi Everyone,

I'm playing around with Rabbitmq(sorry for flooding the list lately) and am
having some weird problems in my tests.  I have a multi-threaded
application that I was considering using rabbitmq to manage the queue but
I'm getting alot of blocking between my channels.  Is there a preferred way
to setup pools?

I'm a bit new to Java so I used to the pools from apache commons but when I
profile the channels are all blocking each other.  To test if dedicated
connections per thread worked better I made an example of it as well and it
does not block when the same program has a single channel per connection.

So my question, do channels block each other or am I doing something
wrong(using java api wrong or misunderstanding connection/channels)?  Is
there a more preferred way? Unrelated to the question, but I was also
wondering is there any difference between channels and connections in terms
of throughput(i.e. would there be any benefit of using dedicated
connections ignoring the overhead in establishing/maintaining the
connection)?

Here's the test code(it simply sends to a thread a bunch of data to write
the queue). If it helps I'm using v2.7.1, installed from MacPorts):


import org.apache.commons.pool.BasePoolableObjectFactory;
import org.apache.commons.pool.ObjectPool;
import org.apache.commons.pool.PoolableObjectFactory;
import org.apache.commons.pool.impl.GenericObjectPool;

import java.io.IOException;
import java.util.NoSuchElementException;
import java.util.Set;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.LinkedBlockingDeque;
import java.util.concurrent.ThreadPoolExecutor;
import java.util.concurrent.TimeUnit;


import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.MessageProperties;

public class PoolExample {

private static ExecutorService executor_worker;
 static {
        final int numberOfThreads_ThreadPoolExecutor = 20;
        executor_worker =
Executors.newFixedThreadPool(numberOfThreads_ThreadPoolExecutor);
}
    public static void main(String[] args) throws Exception {
    System.out.println("starting..");
    ObjectPool<Channel> pool =
                new GenericObjectPool<Channel>(
                new ConnectionPoolableObjectFactory(), 50);
    for (int x = 0; x<500000000; x++) {
    executor_worker.submit(new MyRunnable(x, pool));
    }
    }
}

/*
 //this is a version that creates its own connection per channel
 class ConnectionPoolableObjectFactory
        extends BasePoolableObjectFactory<Channel> {

    private static final ConnectionFactory factory = newConnectionFactory();

    private static ConnectionFactory newConnectionFactory() {
        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("localhost");
        return factory;
    }

    @Override
    public Channel makeObject() throws Exception {
        System.out.println("new channel");
    return factory.newConnection().createChannel();

    }

    @Override
    public boolean validateObject(Channel channel) {
        return channel.isOpen();
    }

    @Override
    public void destroyObject(Channel channel) throws Exception {
    System.out.println("closing");
        channel.close();
    }

    @Override
    public void passivateObject(Channel channel) throws Exception {
        //System.out.println("sent back to queue");
    }
}
*/

//this version pools channels
class ConnectionPoolableObjectFactory extends
BasePoolableObjectFactory<Channel> {

private final Connection connection;

ConnectionPoolableObjectFactory() throws IOException {
ConnectionFactory factory = new ConnectionFactory();
factory.setHost("localhost");
connection = factory.newConnection();
}

@Override
public Channel makeObject() throws Exception {
return connection.createChannel();
}

@Override
public boolean validateObject(Channel channel) {
return channel.isOpen();
}

@Override
public void destroyObject(Channel channel) throws Exception {
channel.close();
}

@Override
public void passivateObject(Channel channel) throws Exception {
//do nothing
}
}


class MyRunnable implements Runnable{
protected int x = 0;
protected ObjectPool<Channel> pool;
    public MyRunnable(int x, ObjectPool<Channel> pool) {
// TODO Auto-generated constructor stub
    this.x = x;
    this.pool = pool;
}

public void run(){
        try {
                Channel channel = pool.borrowObject();
            String message = Integer.toString(x);
            channel.basicPublish( "", "task_queue",
                        MessageProperties.PERSISTENT_TEXT_PLAIN,
                        message.getBytes());
            pool.returnObject(channel);
} catch (NoSuchElementException e) {
// TODO Auto-generated catch block
e.printStackTrace();
} catch (IllegalStateException e) {
// TODO Auto-generated catch block
e.printStackTrace();
} catch (Exception e) {
// TODO Auto-generated catch block
e.printStackTrace();
}
    }
}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120502/b0e244a6/attachment.htm>

From vim at aryehleib.com  Thu May  3 08:48:48 2012
From: vim at aryehleib.com (Aryeh Leib Taurog)
Date: Thu, 3 May 2012 10:48:48 +0300
Subject: [rabbitmq-discuss] broken release?
Message-ID: <20120503074848.GA2485@localhost>

We are evaluating RabbitMQ/pika for our stack.  I have it installed, 
via the rabbitmq debian/apt repository, on a ubuntu lucid test server.  
Yesterday morning, the apt package manager updated rabbitmq-server 
from 2.8.1-1 to 2.8.2-1.  At that point, it stopped working 
altogether.

I tried the send.py/receive.py from the Hello World tutorial and got 
nothing.  I downloaded the java client and ran the tracer.  Here's the 
output I get when I point send.py at it:

Invoked as: Tracer 5673 localhost 5672
com.rabbitmq.tools.Tracer.WITHHOLD_INBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.WITHHOLD_OUTBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.NO_ASSEMBLE_FRAMES = false
com.rabbitmq.tools.Tracer.NO_DECODE_FRAMES = false
com.rabbitmq.tools.Tracer.SUPPRESS_COMMAND_BODIES = false
1335986940645: <Tracer-0> ch#0 <- {#method<connection.start>(version-major=0, version-minor=9, server-properties={product=RabbitMQ, information=Licensed under the MPL.  See http://www.rabbitmq.com/, platform=Erlang/OTP, capabilities={exchange_exchange_bindings=true, consumer_cancel_notify=true, basic.nack=true, publisher_confirms=true}, copyright=Copyright (C) 2007-2012 VMware, Inc., version=2.8.2}, mechanisms=PLAIN AMQPLAIN, locales=en_US), null, ""}
1335986940645: <Tracer-0> ch#0 -> {#method<connection.start-ok>(client-properties={product=Pika Python AMQP Client Library}, mechanism=PLAIN, response=1335986940646: <Tracer-0> ch#0 <- {#method<connection.tune>(channel-max=0, frame-max=131072, heartbeat=0), null, ""}
1335986940681: <Tracer-0> ch#0 -> {#method<connection.tune-ok>(channel-max=0, frame-max=131072, heartbeat=0), null, ""}
1335986940682: <Tracer-0> ch#0 -> {#method<connection.open>(virtual-host=/, capabilities=, insist=true), null, ""}
1335986940724: <Tracer-0> ch#0 <- {#method<connection.open-ok>(known-hosts=), null, ""}
1335986940761: <Tracer-0> ch#1 -> {#method<channel.open>(out-of-band=), null, ""}
1335986940802: <Tracer-0> ch#1 <- {#method<channel.open-ok>(channel-id=), null, ""}
1335986940842: <Tracer-0> ch#1 -> {#method<queue.declare>(ticket=0, queue=hello, passive=false, durable=false, exclusive=false, auto-delete=false, nowait=false, arguments={}), null, ""}
1335986940884: <Tracer-0> ch#1 <- {#method<queue.declare-ok>(queue=hello, message-count=0, consumer-count=1), null, ""}
1335986940924: <Tracer-0> ch#1 -> {#method<basic.publish>(ticket=0, exchange=, routing-key=hello, mandatory=false, immediate=false), #contentHeader<basic>(content-type=null, content-encoding=null, headers=null, delivery-mode=null, priority=null, correlation-id=null, reply-to=null, expiration=null, message-id=null, timestamp=null, type=null, user-id=null, app-id=null, cluster-id=null), "Hello World!"}
1335986940925: <Tracer-0> ch#1 -> {#method<channel.close>(reply-code=200, reply-text=Normal shutdown, class-id=0, method-id=0), null, ""}
1335986940935: <Tracer-0> uncaught java.io.EOFException
        at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:273)
        at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:95)
        at com.rabbitmq.tools.Tracer$DirectionHandler.readFrame(Tracer.java:271)
        at com.rabbitmq.tools.Tracer$DirectionHandler.doFrame(Tracer.java:305)
        at com.rabbitmq.tools.Tracer$DirectionHandler.run(Tracer.java:343)
        at java.lang.Thread.run(Thread.java:662)

Stopped.

Here's the output of rabbitmqctl status:
[{pid,1594},
 {running_applications,[{rabbit,"RabbitMQ","2.8.2"},
                        {os_mon,"CPO  CXC 138 46","2.2.4"},
                        {sasl,"SASL  CXC 138 11","2.1.8"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.12"},
                        {stdlib,"ERTS  CXC 138 10","1.16.4"},
                        {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,26105944},
          {processes,10233072},
          {processes_used,10213160},
          {system,15872872},
          {atom,1119593},
          {atom_used,1112534},
          {binary,88664},
          {code,12015821},
          {ets,793224}]},
 {vm_memory_high_watermark,0.3999999997973079},
 {vm_memory_limit,1578749132},
 {disk_free_limit,3946872832},
 {disk_free,3124989952},
 {file_descriptors,[{total_limit,924},
                    {total_used,5},
                    {sockets_limit,829},
                    {sockets_used,3}]},
 {processes,[{limit,1048576},{used,137}]},
 {run_queue,0},
 {uptime,939}]


I see a warning in the rabbitmq log about connection_closed_abruptly, 
but it doesn't seem to correspond to the issue, since I don't see the 
message repeated when I re-run send.py.

I was able to resolve the problem by removing the new version of 
rabbitmq-server with 'apt-get remove' then downloading the previous 
version from the rabbitmq site and reinstalling that with dpkg.

This raises questions in my mind about using rabbitmq in our 
production stack.  Are 'latest releases' from the repository 
considered stable?  Are people using rabbitmq in production on ubuntu?  
Ubuntu lucid is a pretty popular server platform, and there isn't much 
unusual about my test machine.  Has no one else reported any problems?

Also I am surprised that there doesn't seem to be any public bug 
tracker.  I gather that RabbitMQ is the open-source effort of a 
private enterprise, but that is hardly an excuse.  MySQL and Java both 
have public bug trackers.

with appreciation,
Aryeh Leib Taurog


From matthias at rabbitmq.com  Thu May  3 09:36:04 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 03 May 2012 09:36:04 +0100
Subject: [rabbitmq-discuss] log process
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD369675C3@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>	<5F389C517756284F80239F55BCA5DDDD36964188@G9W0721.americas.hpqcorp.net>	<CAHZsVQamUcKi5+4dwcGVCp1Q-HgMW30zoSkGvkNX41h5VLM+yg@mail.gmail.com>
	<5F389C517756284F80239F55BCA5DDDD369647EA@G9W0721.americas.hpqcorp.net>
	<4FA0C999.6010406@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3696750E@G9W0721.americas.hpqcorp.net>
	<4FA1277D.3070704@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD369675C3@G9W0721.americas.hpqcorp.net>
Message-ID: <4FA24374.5080707@rabbitmq.com>

Andrea,

On 02/05/12 14:22, Rosa, Andrea (HP Cloud Services) wrote:
>>>> INFO REPORT==== 15-Apr-2012::06:30:37 === Rotating logs with suffix
>>>> ''
>>
>> Where was that entry? In the .log.1 file or the .log file? If it was in
>> the former then that is expected, i.e. it's the last thing written
>> before the log is rotated.
>
>
> Yes, it was the last entry in .log.1
>
>>
>> The current log entries should always go into the .log file. Hence my
>> question whether that file was empty, or perhaps did not exist at all.
>
> The .log file did not exist at all.

What log entries were you expecting to see during the 5 days since the 
log was rolled to .1? ? AMQP connect/disconnect events?

Did the log rotation work fine previously?

One thing to try is performing a manual log rotation with

   sudo mv /var/log/rabbitmq/<node>.log /var/log/rabbmitq/<node>.bak
   sudo /etc/init.d/rabbitmq-server rotate-logs

and then do something that normally results in a log entry, e.g. 
establish an AMQP connection. That *should* re-create the .log file, 
containing the expected entry.


Matthias.

From emile at rabbitmq.com  Thu May  3 09:45:32 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 03 May 2012 09:45:32 +0100
Subject: [rabbitmq-discuss] broken release?
In-Reply-To: <20120503074848.GA2485@localhost>
References: <20120503074848.GA2485@localhost>
Message-ID: <4FA245AC.1070003@rabbitmq.com>


Hi,

On 03/05/12 08:48, Aryeh Leib Taurog wrote:
> We are evaluating RabbitMQ/pika for our stack.  I have it installed, 
> via the rabbitmq debian/apt repository, on a ubuntu lucid test server.  
> Yesterday morning, the apt package manager updated rabbitmq-server 
> from 2.8.1-1 to 2.8.2-1.  At that point, it stopped working 
> altogether.

Could you tell us more about what is not working? Does the logfile
contain anything relevant? Can you send a sample program that
illustrates the problem?

1335986940645: <Tracer-0> ch#0 ->
{#method<connection.start-ok>(client-properties={product=Pika Python
AMQP Client Library}, mechanism=PLAIN, response=
[ ... missing content ... ]
1335986940646: <Tracer-0> ch#0 <-
{#method<connection.tune>(channel-max=0, frame-max=131072, heartbeat=0),
null, ""}

Except for the line above the trace output looks normal. Did you edit
the output before sending? How does this output differ from what you see
with v2.8.1 ?

> I see a warning in the rabbitmq log about connection_closed_abruptly, 

That entry will correspond to a client closing a connection without
sending an AMQP close method first - a harmless event.

> I was able to resolve the problem by removing the new version of 
> rabbitmq-server with 'apt-get remove' then downloading the previous 
> version from the rabbitmq site and reinstalling that with dpkg.
> 
> This raises questions in my mind about using rabbitmq in our 
> production stack.  Are 'latest releases' from the repository 
> considered stable?  Are people using rabbitmq in production on ubuntu?  
> Ubuntu lucid is a pretty popular server platform, and there isn't much 
> unusual about my test machine.  Has no one else reported any problems?

No problems specific to release 2.8.2 have been reported. The latest
version is considered stable and releases are tested on Ubuntu.

> Also I am surprised that there doesn't seem to be any public bug 
> tracker.  I gather that RabbitMQ is the open-source effort of a 
> private enterprise, but that is hardly an excuse.  MySQL and Java both 
> have public bug trackers.

The RabbitMQ bugtracker is not public at this time and the mailing list
is the correct place to report bugs.


-Emile



From matthias at rabbitmq.com  Thu May  3 10:15:21 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 03 May 2012 10:15:21 +0100
Subject: [rabbitmq-discuss] broken release?
In-Reply-To: <4FA245AC.1070003@rabbitmq.com>
References: <20120503074848.GA2485@localhost> <4FA245AC.1070003@rabbitmq.com>
Message-ID: <4FA24CA9.7020508@rabbitmq.com>

On 03/05/12 09:45, Emile Joubert wrote:
> On 03/05/12 08:48, Aryeh Leib Taurog wrote:
>> We are evaluating RabbitMQ/pika for our stack.  I have it installed,
>> via the rabbitmq debian/apt repository, on a ubuntu lucid test server.
>> Yesterday morning, the apt package manager updated rabbitmq-server
>> from 2.8.1-1 to 2.8.2-1.  At that point, it stopped working
>> altogether.
>
> Could you tell us more about what is not working? Does the logfile
> contain anything relevant?

I think I know what is happening based on the OP's report...

>>  {disk_free_limit,3946872832},
>>  {disk_free,3124989952},

i.e. there is insufficient disk space and therefore publishing 
connections are probably being blocked.

The log file should contain alarms relating to that condition.


Regards,

Matthias

From andrea.rosa at hp.com  Thu May  3 10:15:29 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Thu, 3 May 2012 09:15:29 +0000
Subject: [rabbitmq-discuss] log process
In-Reply-To: <4FA24374.5080707@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>
	<5F389C517756284F80239F55BCA5DDDD36964188@G9W0721.americas.hpqcorp.net>
	<CAHZsVQamUcKi5+4dwcGVCp1Q-HgMW30zoSkGvkNX41h5VLM+yg@mail.gmail.com>
	<5F389C517756284F80239F55BCA5DDDD369647EA@G9W0721.americas.hpqcorp.net>
	<4FA0C999.6010406@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3696750E@G9W0721.americas.hpqcorp.net>
	<4FA1277D.3070704@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD369675C3@G9W0721.americas.hpqcorp.net>
	<4FA24374.5080707@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD36968FD5@G9W0721.americas.hpqcorp.net>

Matthias,

>What log entries were you expecting to see during the 5 days since the
>log was rolled to .1? ? AMQP connect/disconnect events?
>
>Did the log rotation work fine previously?
>
>One thing to try is performing a manual log rotation with
>
>   sudo mv /var/log/rabbitmq/<node>.log /var/log/rabbmitq/<node>.bak
>   sudo /etc/init.d/rabbitmq-server rotate-logs
>
>and then do something that normally results in a log entry, e.g.
>establish an AMQP connection. That *should* re-create the .log file,
>containing the expected entry.

The log rotation work fine previously and also after that day, it seems that it was a sporadic case.
I am just curious to understand if the logging is executed by a separate process, because the server didn't produce log but it was still working for at least 4 days, then we discovered an issue and we restarted the server.

Thanks for your time
--
Andrea

From matthias at rabbitmq.com  Thu May  3 10:27:33 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 03 May 2012 10:27:33 +0100
Subject: [rabbitmq-discuss] log process
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD36968FD5@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>	<5F389C517756284F80239F55BCA5DDDD36964188@G9W0721.americas.hpqcorp.net>	<CAHZsVQamUcKi5+4dwcGVCp1Q-HgMW30zoSkGvkNX41h5VLM+yg@mail.gmail.com>
	<5F389C517756284F80239F55BCA5DDDD369647EA@G9W0721.americas.hpqcorp.net>
	<4FA0C999.6010406@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3696750E@G9W0721.americas.hpqcorp.net>
	<4FA1277D.3070704@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD369675C3@G9W0721.americas.hpqcorp.net>
	<4FA24374.5080707@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD36968FD5@G9W0721.americas.hpqcorp.net>
Message-ID: <4FA24F85.6000708@rabbitmq.com>

Andrea,

On 03/05/12 10:15, Rosa, Andrea (HP Cloud Services) wrote:
> I am just curious to understand if the logging is executed by a
> separate process, because the server didn't produce log but it was
> still working for at least 4 days, then we discovered an issue and we
> restarted the server.

Well, this is Erlang, so everything is a separate *Erlang* process :)

Was there anything noteworthy in the sasl logs?

Matthias.

From johnson at edocom.cn  Thu May  3 10:28:36 2012
From: johnson at edocom.cn (johnson)
Date: Thu, 3 May 2012 17:28:36 +0800
Subject: [rabbitmq-discuss] RabbitMq Tutorial One cannot work under CentOS5.5
Message-ID: <2012050317283643324013@edocom.cn>

Hi guys,

I am quite new to RabbitMq and now try to learn it from the tutorial. I installed the windows version and the LINUX version (CentOS 5.5) of RabbitMQ 2.8.2. The Erlang version is R14B03 in Linux. In Windows, everything is fine. But in CENTOS5.5, after sending the message, the program cannot exit and always stuck. Hence, the receiver also cannot get the message. Can you point out how to debug it? Thanks a lot!

http://www.rabbitmq.com/tutorials/tutorial-one-java.html

import com.rabbitmq.client.ConnectionFactory;import com.rabbitmq.client.Connection;import com.rabbitmq.client.Channel;public class Send {  private final static String QUEUE_NAME = "hello";  public static void main(String[] argv) throws Exception {      	          ConnectionFactory factory = new ConnectionFactory();    factory.setHost("localhost");    Connection connection = factory.newConnection();    Channel channel = connection.createChannel();    channel.queueDeclare(QUEUE_NAME, false, false, false, null);    String message = "Hello World!";    channel.basicPublish("", QUEUE_NAME, null, message.getBytes());    System.out.println(" [x] Sent '" + message + "'");        channel.close();    connection.close();  }}import com.rabbitmq.client.ConnectionFactory;import com.rabbitmq.client.Connection;import com.rabbitmq.client.Channel;import com.rabbitmq.client.QueueingConsumer;public class Recv {    private final static String QUEUE_NAME = "hello";    public static void main(String[] argv) throws Exception {    ConnectionFactory factory = new ConnectionFactory();    factory.setHost("localhost");    Connection connection = factory.newConnection();    Channel channel = connection.createChannel();    channel.queueDeclare(QUEUE_NAME, false, false, false, null);    System.out.println(" [*] Waiting for messages. To exit press CTRL+C");        QueueingConsumer consumer = new QueueingConsumer(channel);    channel.basicConsume(QUEUE_NAME, true, consumer);        while (true) {      QueueingConsumer.Delivery delivery = consumer.nextDelivery();      String message = new String(delivery.getBody());      System.out.println(" [x] Received '" + message + "'");    }  }}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120503/6100e380/attachment.htm>

From emile at rabbitmq.com  Thu May  3 10:36:19 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 03 May 2012 10:36:19 +0100
Subject: [rabbitmq-discuss] SSL Certificate Error
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D707F76EE52C@MX36A.corp.emc.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707F76EE52C@MX36A.corp.emc.com>
Message-ID: <4FA25193.1000102@rabbitmq.com>


Hi James,

On 02/05/12 20:24, james.poole at rsa.com wrote:
> Can anyone help me understand what is happening when I try to enable SSL
> using Non-OpenSSL certificates?  The certificates being used are working
> as SSL Server certificates with Apache 2.2.22, but when I use them with
> RabbitMQ, it is failing.  Also, if I generate OpenSSL certificates to
> test with, the same setup works (same config file, server, etc).

Unfortunately "ecertfile" is a generic error that does not allow any
more precise diagnosis than what you already concluded:

> From the online docs, it definitely looks like Erlang is having problems
> with the Server Certificate (?ecertfile? reference), but how would I
> debug this further to try and diagnose the cause?

Have you tried the steps in the SSL troubleshooting guide?
http://www.rabbitmq.com/troubleshooting-ssl.html

If that doesn't work then analyse the differences between the
certificates and reduce them incrementally.

You didn't say which version of Erlang you were using. (Line numbers
suggest R15B?) On average the quality of Erlang SSL increases with
versions, so try a later version.

If you do find a solution then please let us know.


-Emile



From glenn.oliveira at lmco.com  Wed May  2 19:43:03 2012
From: glenn.oliveira at lmco.com (Oliveira, Glenn)
Date: Wed, 02 May 2012 18:43:03 +0000
Subject: [rabbitmq-discuss] rabbitmq-server cannot start
Message-ID: <F35E3887388A5B4B8FD53A3C9C40A16305C3E7@HDXDSP33.us.lmco.com>

We are having problems restarting the rabbitmq server.

/sbin/service rabbitmq-server start

(returns)



Starting ..FAILED check /var/log/startup[_log , _err]



The _err file says the erlang crash dump written to erl_crash.dump.  What do I need to look for in this file? I didn't see any specific message that indicated a specific problem.  Unfortuately, the erl_crash.dump resides on a Linux RHEL5 server NOT on the internet.





Prior to the "crash", I did a "force_reset" without doing a "stop_app".



How can I restart rabbitmq-server?

Thanks,
Glenn  (720-922-5963)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120502/95108b12/attachment.htm>

From jerryk at rbcon.com  Thu May  3 01:07:48 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Wed, 2 May 2012 17:07:48 -0700
Subject: [rabbitmq-discuss] heroku beta
In-Reply-To: <60E7A332-060C-4155-A7DC-EF92D0F43935@gmail.com>
References: <60E7A332-060C-4155-A7DC-EF92D0F43935@gmail.com>
Message-ID: <D40CD772-4F25-40A9-88C9-583169AA0A90@rbcon.com>

IIRC, our friends at Heroku will have to sign you up. There uses to be a
public signup page but without a real computer to hand I'm having trouble finding it just now...

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On May 2, 2012, at 5:01 PM, Paul Wehner <paulmedev at gmail.com> wrote:

> Would someone over at RabbitMQ be able to add me to the private heroku beta?
> 
> When I read the following blog post, it makes it sound as if its public:
> 
> http://blog.heroku.com/archives/2011/8/31/rabbitmq_add_on_now_available_on_heroku/
> 
> However, when I click the first link in the blog post:
> 
> https://addons.heroku.com/rabbitmq
> 
> It tells me that the test is only available to private beta users.
> 
> Thanks,
> Paul
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120502/0043d24c/attachment.htm>

From simon at rabbitmq.com  Thu May  3 10:38:32 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 May 2012 10:38:32 +0100
Subject: [rabbitmq-discuss] rabbitmq-server cannot start
In-Reply-To: <F35E3887388A5B4B8FD53A3C9C40A16305C3E7@HDXDSP33.us.lmco.com>
References: <F35E3887388A5B4B8FD53A3C9C40A16305C3E7@HDXDSP33.us.lmco.com>
Message-ID: <4FA25218.4040904@rabbitmq.com>

On 02/05/12 19:43, Oliveira, Glenn wrote:
> I didn't see any specific message that indicated a specific problem.

Is there nothing at all in the _log and _err files that looks like an error?

Can you post them somewhere? Possibly also the rabbit@$(hostname).log?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu May  3 10:42:22 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 May 2012 10:42:22 +0100
Subject: [rabbitmq-discuss] broken release?
In-Reply-To: <4FA24CA9.7020508@rabbitmq.com>
References: <20120503074848.GA2485@localhost> <4FA245AC.1070003@rabbitmq.com>
	<4FA24CA9.7020508@rabbitmq.com>
Message-ID: <4FA252FE.205@rabbitmq.com>

On 03/05/12 10:15, Matthias Radestock wrote:
> i.e. there is insufficient disk space and therefore publishing
> connections are probably being blocked.

To add to this: 2.8.2 introduced disk space monitoring. By default 
RabbitMQ will refuse to accept messages when (free disc space) < 
(physical memory). You can change this behaviour following instructions at:

http://www.rabbitmq.com/memory.html#diskfreesup

...but you should be aware that this feature is there for a reason - 
under heavy load a RabbitMQ server can page all its messages out to 
disc. If doing this exhausts disc space, bad things will happen.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware

From silver.buyer at yahoo.com  Thu May  3 10:49:57 2012
From: silver.buyer at yahoo.com (Joseph Goldberg)
Date: Thu, 3 May 2012 02:49:57 -0700 (PDT)
Subject: [rabbitmq-discuss] fix,
	rabbitmq websockets and streaming quote help project
In-Reply-To: <1336033752.71089.YahooMailNeo@web121605.mail.ne1.yahoo.com>
References: <1336033752.71089.YahooMailNeo@web121605.mail.ne1.yahoo.com>
Message-ID: <1336038597.21301.YahooMailNeo@web121603.mail.ne1.yahoo.com>



?

 

Can someone help me getting user authentication done with websockets and rabbitmq to consume and distribute streaming quotes to my subscribed users.
I have a wave file of our conversation over skype, where he gives other details.

?http://armstrongonsoftware.blogspot.ca/2009/12/comet-is-dead-long-live-websockets.html

http://blog.dberg.org/2012/04/using-gproc-and-cowboy-to-pass-messages.html

[6:46:27 PM] Adam Denenberg: Our last step is to actually broadcast a message that contains this format. ?Now, here is where you need to roll your own logic to determine how you want to ingest messages (queue, webservice, etc), but once your app gets the message you are waiting for all you need is one line to send the message:

gproc:send({p, l, ?WSKey}, {self(), ?WSKey, Msg})
[6:46:44 PM] Adam Denenberg: This simply sends message "Msg" to all the processes that were registered with the key ?WSKey and then gets handled in websocket_info and thus passed over the websocket connection.


also need fix protocol?implementation?done with MQ and sequence number checking which he does not do


http://www.codeproject.com/Articles/35439/Fix-Protocol-C-Fix-Engine-Source-Code


Yes that's true. but tcpip messages are not erroneus/corrupted. the point of this code is to be fast - eg i do not verify the checksum. in fact i don't even bother to check the incoming message sequence number. i just have two safety checks in the code which check the message starts 8= and then 35=.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120503/006e4838/attachment.htm>

From simon at rabbitmq.com  Thu May  3 10:51:05 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 May 2012 10:51:05 +0100
Subject: [rabbitmq-discuss] cluster write/read performance
In-Reply-To: <CAC3L7Ff2DpRpZr-Ki9kffyP6zM8DQ_0=6n0tHXhcEu5xzRMtYA@mail.gmail.com>
References: <CAC3L7Ff2DpRpZr-Ki9kffyP6zM8DQ_0=6n0tHXhcEu5xzRMtYA@mail.gmail.com>
Message-ID: <4FA25509.60302@rabbitmq.com>

On 02/05/12 17:49, ?ilvinas ?altys wrote:
> Let's say I have 3 remote rabbitmq brokers around the world and I need
> to consume messages from them to a central cluster. As I understand from
> the documentation all write operations happen on the master and then the
> master replicates to slaves.

That's how *mirrored queues* work. Mirrored queues are a feature that 
you can use when clustering, but they're not the only thing.

> That means that the cluster's write/read performance is only as fast as
> the master? In that case what happens if my master can no longer keep up
> and starts lagging further and further behind from the remote brokers?

Just to be clear here, when you say "remote brokers" you are planning to 
connect them with federation / shovel to a central cluster? Clustering 
over a WAN is not recommended - see http://www.rabbitmq.com/distributed.html

> Does it mean I need to set up another independent cluster with it's own
> master to deal with it?

I'm not sure what this means.

> If I'm still on the right path there is no real advantage to have more
> than 2 nodes in a cluster if all you need to do is consume from the
> cluster and have a failover if something goes wrong as all consumes
> happen only on the master ?

Yes, if you're just aiming to have redundancy in your queues. But you 
might want to have a cluster with lots of non-mirrored queues 
distributed around the cluster - in that case you would add more nodes 
to get more capacity.

(You can also have mirrored queues on a subset of cluster nodes to 
achieve the same goal, but the mechanism for doing that is currently a 
bit awkward.)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From vim at aryehleib.com  Thu May  3 10:51:17 2012
From: vim at aryehleib.com (Aryeh Leib Taurog)
Date: Thu, 3 May 2012 12:51:17 +0300
Subject: [rabbitmq-discuss] broken release?
In-Reply-To: <4FA24CA9.7020508@rabbitmq.com>
References: <20120503074848.GA2485@localhost> <4FA245AC.1070003@rabbitmq.com>
	<4FA24CA9.7020508@rabbitmq.com>
Message-ID: <20120503095117.GB2485@localhost>

On Thu, May 03, 2012 at 10:15:21AM +0100, Matthias Radestock wrote:
> On 03/05/12 09:45, Emile Joubert wrote:
> >On 03/05/12 08:48, Aryeh Leib Taurog wrote:
> >>We are evaluating RabbitMQ/pika for our stack.  I have it installed,
> >>via the rabbitmq debian/apt repository, on a ubuntu lucid test server.
> >>Yesterday morning, the apt package manager updated rabbitmq-server
> >>from 2.8.1-1 to 2.8.2-1.  At that point, it stopped working
> >>altogether.
> >
> >Could you tell us more about what is not working? Does the logfile
> >contain anything relevant?
> 
> I think I know what is happening based on the OP's report...
> 
> >> {disk_free_limit,3946872832},
> >> {disk_free,3124989952},
> 
> i.e. there is insufficient disk space and therefore publishing
> connections are probably being blocked.
> 
> The log file should contain alarms relating to that condition.

I would suggest in such a case an error should be returned to the 
publisher.

Where on the disk is the space required?  In what units are those 
numbers?  They don't seem to correspond to anything on my system. How 
much disk space do I need?  I had this problem with the first 
tutorial, so the message body is only 12 bytes.  Also, does this 
explain why v 2.8.1 works with no apparent problems?

Here's what df reports:

Filesystem           1K-blocks      Used Available Use% Mounted on
/dev/sda2              4128448   1321368   2597368  34% /
none                   1922248       300   1921948   1% /dev
none                   1927184      1032   1926152   1% /dev/shm
none                   1927184       344   1926840   1% /var/run
none                   1927184         0   1927184   0% /var/lock
none                   1927184         0   1927184   0% /lib/init/rw
/dev/sda7              4128448    185616   3733120   5% /tmp
/dev/sda1               253871    157338     83426  66% /boot
/dev/sda8             45694372  11201536  34028608  25% /home
/dev/sda5             16513960   6760840   9417576  42% /usr
/dev/sda6              4128448    867992   3050744  23% /var



From andrea.rosa at hp.com  Thu May  3 11:03:01 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Thu, 3 May 2012 10:03:01 +0000
Subject: [rabbitmq-discuss] log process
In-Reply-To: <4FA24F85.6000708@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>
	<5F389C517756284F80239F55BCA5DDDD36964188@G9W0721.americas.hpqcorp.net>
	<CAHZsVQamUcKi5+4dwcGVCp1Q-HgMW30zoSkGvkNX41h5VLM+yg@mail.gmail.com>
	<5F389C517756284F80239F55BCA5DDDD369647EA@G9W0721.americas.hpqcorp.net>
	<4FA0C999.6010406@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3696750E@G9W0721.americas.hpqcorp.net>
	<4FA1277D.3070704@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD369675C3@G9W0721.americas.hpqcorp.net>
	<4FA24374.5080707@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD36968FD5@G9W0721.americas.hpqcorp.net>
	<4FA24F85.6000708@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD369690F1@G9W0721.americas.hpqcorp.net>

>Well, this is Erlang, so everything is a separate *Erlang* process :)

:)

>Was there anything noteworthy in the sasl logs?

Nothing special just the "normal" error:
=SUPERVISOR REPORT==== ===
     Supervisor: {<0.27003.2311>,
                                           rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     noproc
     Offender:   [{pid,<0.27009.2311>},
                  {name,channel_sup},
                  {mfa,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]

--
Andrea

From simon at rabbitmq.com  Thu May  3 11:12:38 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 May 2012 11:12:38 +0100
Subject: [rabbitmq-discuss] Direct vs Topic exchange - Question
In-Reply-To: <314905EC-5B0F-4469-BDCD-FF86F6C12078@gmail.com>
References: <87d7fc6b-cad6-42ab-8a34-afe1846e8332@a8g2000pbe.googlegroups.com>
	<4FA137CA.2000809@rabbitmq.com>
	<314905EC-5B0F-4469-BDCD-FF86F6C12078@gmail.com>
Message-ID: <4FA25A16.9050509@rabbitmq.com>

On 02/05/12 17:09, Konstantin Kalin wrote:
> Sure. Please look at attached file.

1> publisher:start_publish(<<"topic">>, <<"topic">>, 100000, 100000).
** exception error: undefined function connections:get/0
      in function  publisher:start_publish/4 (src/publisher.erl, line 27)

OK, that's just a typo I assume, I'll change it to:

   Connection = connections:get_connection(),

1> publisher:start_publish(<<"topic">>, <<"topic">>, 100000, 100000).
** exception exit: {noproc,{gen_server,call,[connections,get]}}
      in function  gen_server:call/2 (gen_server.erl, line 180)
      in call from publisher:start_publish/4 (src/publisher.erl, line 27)

So it looks like the connection server is not getting started?

I am starting your app with:

erl -pa apps/common/ebin -pa apps/publisher/ebin -s publisher start 
'["amqp://localhost"]'

  - is that correct? Can you give more precise instructions for how to 
run this app without debugging it? ;)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Thu May  3 11:53:14 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 03 May 2012 11:53:14 +0100
Subject: [rabbitmq-discuss] heroku beta
In-Reply-To: <F2CF64EA-6809-4ACE-9CBA-26FD385BFDC2@gmail.com>
References: <60E7A332-060C-4155-A7DC-EF92D0F43935@gmail.com>	<D40CD772-4F25-40A9-88C9-583169AA0A90@rbcon.com>
	<F2CF64EA-6809-4ACE-9CBA-26FD385BFDC2@gmail.com>
Message-ID: <4FA2639A.90601@rabbitmq.com>

Paul,

On 03/05/12 02:09, Paul Wehner wrote:
> Should I do it as a support request or something over at Heroku?

http://beta.heroku.com/signup

Matthias.

From simon at rabbitmq.com  Thu May  3 11:55:40 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 May 2012 11:55:40 +0100
Subject: [rabbitmq-discuss] RabbitMQ Management shows messages and no
 queues
In-Reply-To: <CAMscK0b5G6j1r7w2uCp0SA18D_eRHM-fwp2X8M32SHHi+Xh=wA@mail.gmail.com>
References: <CAMscK0b5G6j1r7w2uCp0SA18D_eRHM-fwp2X8M32SHHi+Xh=wA@mail.gmail.com>
Message-ID: <4FA2642C.7000302@rabbitmq.com>

On 01/05/12 16:07, Michael Cumings wrote:
> I'm betting there's a simple answer that I can't find in google.
>
> The Management Overview was showing 100 messages ready.  The Queues tab
> had no queues.  In both, I was showing all vhosts.  Command line
> rabbitmqctl list_queues also returned no queues.  I reset one of the
> servers and the number of messages went down.  I went through and reset
> all three servers in the cluster and they all disappeared.  This
> happened in a development environment where there had been no use for
> over 12 hours, but there were still 3 connections open.  I'm using
> version 2.8.1 installed directly from the deb on the RabbitMQ repo.
>
> What can cause this to happen?  Where were those messages?  Is there a
> way for me view and interact with messages in that state?

Hmm, this is a weird one. The overview code is really simple: it gets a 
list of all queues, retrieves message statistics for them, and then sums 
them. It really should not be able to count messages if there are no queues.

I wonder whether this was a caching issue at the HTTP level or something.

Of course, if you have a way to reproduce this I'm anxious to hear of it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From vim at aryehleib.com  Thu May  3 12:29:03 2012
From: vim at aryehleib.com (Aryeh Leib Taurog)
Date: Thu, 3 May 2012 14:29:03 +0300
Subject: [rabbitmq-discuss] broken release?
In-Reply-To: <4FA25BB5.7000903@rabbitmq.com>
References: <20120503074848.GA2485@localhost> <4FA245AC.1070003@rabbitmq.com>
	<20120503100808.GC2485@localhost> <4FA25BB5.7000903@rabbitmq.com>
Message-ID: <20120503112903.GD2485@localhost>

On Thu, May 03, 2012 at 11:19:33AM +0100, Emile Joubert wrote:
> 
> Hi,
> 
> I believe my colleagues Matthias and Simon have correctly identified the
> problem: your /var partition is too small. You need to store data in a
> larger partition or reduce the free space limit.

Yes, I see.  I upgraded back to 2.8.2 and after adjusting the 
disk_free_limit it does indeed work.  Thank you all.


Is there any way to detect in the publisher whether or not messages 
are actually being queued?  With pika 0.9.5, as I mentioned, there was 
no indication of failure on either client.

Is there a way to move the location on disk somewhere other than /var?

Would it be possible to configure RabbitMQ to discard *oldest* 
messages as opposed to *newest* messages in situations where there 
isn't enough memory?  I believe that qpid for example uses some kind 
of circular buffer for message transport, so that would happen by 
default.

Is there any way I could receive an alert, say by e-mail, or at least 
on some message queue, when flow-control events occur?  All I see 
regarding 'monitoring' in the documentation are interactive tools.
I would want to be alerted if:

 * Memory usage exceeds a certain level
 * Messages are paged to disk
 * Disk usage exceeds a certain level

appreciatively,
Aryeh Leib Taurog


From emile at rabbitmq.com  Thu May  3 16:02:57 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 03 May 2012 16:02:57 +0100
Subject: [rabbitmq-discuss] broken release?
In-Reply-To: <20120503112903.GD2485@localhost>
References: <20120503074848.GA2485@localhost> <4FA245AC.1070003@rabbitmq.com>
	<20120503100808.GC2485@localhost> <4FA25BB5.7000903@rabbitmq.com>
	<20120503112903.GD2485@localhost>
Message-ID: <4FA29E21.600@rabbitmq.com>


Hi,

On 03/05/12 12:29, Aryeh Leib Taurog wrote:
> Is there any way to detect in the publisher whether or not messages 
> are actually being queued?  With pika 0.9.5, as I mentioned, there was 
> no indication of failure on either client.

The broker was blocking the producer and would have accepted the message
when more disk space became available. That is different from the broker
receiving the message and discarding it, or from the message being lost
due to the broker crashing. That's not what happened.

Publication is an asynchronous so there is no way to return an outcome
of the command as a value. You can attempt to detect a blocking broker
by using publish confirms with a timeout. See
http://www.rabbitmq.com/extensions.html#publishing

A publisher can only be sure that a message was received by the broker
when a publish confirm is received. In your case the client probably
closed the socket while part of the message was still in network buffers.

> Is there a way to move the location on disk somewhere other than /var?

You can select a location for the logfiles and the database. See
http://www.rabbitmq.com/relocate.html

> Would it be possible to configure RabbitMQ to discard *oldest* 
> messages as opposed to *newest* messages in situations where there 
> isn't enough memory?  I believe that qpid for example uses some kind 
> of circular buffer for message transport, so that would happen by 
> default.

To be clear, no messages were discarded. If you run out of memory (or
out of disk space with v2.8.2 and later) the broker will block producers
from sending any more messages until conditions return to normal.

> Is there any way I could receive an alert, say by e-mail, or at least 
> on some message queue, when flow-control events occur?  All I see 
> regarding 'monitoring' in the documentation are interactive tools.
> I would want to be alerted if:
> 
>  * Memory usage exceeds a certain level
>  * Messages are paged to disk
>  * Disk usage exceeds a certain level

All log messages are also sent to amq.rabbitmq.log exchange, so you
could consume those messages to find out if limits are exceeded. You
could also query the broker state with the REST API (part of the
Management plugin). You could also use the output of the "rabbitmqctl
status" command to obtain this information.

There is no API for alerting when transient messages are paged to disk
and this happens transparently.

-Emile



From m.luchak at smartasking.com  Thu May  3 16:38:49 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Thu, 3 May 2012 11:38:49 -0400 (EDT)
Subject: [rabbitmq-discuss] =?utf-8?q?AMQP=2EBasicProperties=2EsetMessageI?=
	=?utf-8?q?d=28=29_deprecated?=
Message-ID: <1336059529.667520297@apps.rackspace.com>


Hey All,
 
I am attempting to set the message ID (on a producer) and see that AMQP.BasicProperties.setMessageId() is deprecated.  I believe that I should/could be using builder but the messageID is returning as null.
 

 AMQP.BasicProperties props = new AMQP.BasicProperties(); 
  props.builder().messageId(" yadada ");
  props.builder().build();
 
channel.basicPublish(EXCHANGE_NAME, routingKey, props, message.getBytes());
 
does not return a messageID using:

  QueueingConsumer.Delivery delivery = consumer.nextDelivery();
  delivery.getProperties().getMessageId()
 
Using the deprecated AMQP.BasicProperties.setMessageId() works fine:
 props.setMessageId("yadada");
 
can someone point me in the right direction please.
 
Thanks,
Matthew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120503/5a4c082a/attachment.htm>

From emile at rabbitmq.com  Thu May  3 16:44:17 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 03 May 2012 16:44:17 +0100
Subject: [rabbitmq-discuss] immediate, mandatory flag with no consumers
In-Reply-To: <AC888676-0872-4116-A55E-03FE45C567D8@etrade.com>
References: <fa3b9c55-7577-41c3-80f2-9176d4736a30@u7g2000yqc.googlegroups.com>
	<4F996269.1050005@rabbitmq.com>
	<CAPwx=WNGYvmRaQe5F1_0w5bObzKuhdORGnwKhoT6sX-yUZaTBw@mail.gmail.com>
	<4F99787E.8030501@rabbitmq.com>
	<AC888676-0872-4116-A55E-03FE45C567D8@etrade.com>
Message-ID: <4FA2A7D1.9070105@rabbitmq.com>

Hi,

On 26/04/12 19:46, Unni, Monish wrote:
> btw : this code is client-side, and i am testing if the server is up.
>  emile, if you could send me the code that you tried as a
> stand-alone, it might help much. as it is - thank you very much for
> looking at it.

Apologies for the delayed response. Please find attached, a slightly
modified version of the code you provided. The output provided is

[ERROR:Service :REPLY_QUEUE seems down, returning with code=313
message=NO_CONSUMERS]
[ERROR:Service :REPLY_QUEUE seems down, returning with code=312
message=NO_ROUTE]

-Emile

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Test.java
Type: text/x-java
Size: 1588 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120503/345a9853/attachment.java>

From vim at aryehleib.com  Thu May  3 16:47:11 2012
From: vim at aryehleib.com (Aryeh Leib Taurog)
Date: Thu, 3 May 2012 18:47:11 +0300
Subject: [rabbitmq-discuss] broken release?
In-Reply-To: <4FA29E21.600@rabbitmq.com>
References: <20120503074848.GA2485@localhost> <4FA245AC.1070003@rabbitmq.com>
	<20120503100808.GC2485@localhost> <4FA25BB5.7000903@rabbitmq.com>
	<20120503112903.GD2485@localhost> <4FA29E21.600@rabbitmq.com>
Message-ID: <20120503154711.GF2485@localhost>


On Thu, May 03, 2012 at 04:02:57PM +0100, Emile Joubert wrote:
> 
> 

Very helpful answers.  I have a clearer picture now.  One thing I can
definitely say is the support on the mailing list is responsive.
Thank you all again.

with appreciation,
Aryeh Leib Taurog


From matthias at rabbitmq.com  Thu May  3 18:12:03 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 03 May 2012 18:12:03 +0100
Subject: [rabbitmq-discuss] log process
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD369690F1@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>	<5F389C517756284F80239F55BCA5DDDD36964188@G9W0721.americas.hpqcorp.net>	<CAHZsVQamUcKi5+4dwcGVCp1Q-HgMW30zoSkGvkNX41h5VLM+yg@mail.gmail.com>
	<5F389C517756284F80239F55BCA5DDDD369647EA@G9W0721.americas.hpqcorp.net>
	<4FA0C999.6010406@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3696750E@G9W0721.americas.hpqcorp.net>
	<4FA1277D.3070704@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD369675C3@G9W0721.americas.hpqcorp.net>
	<4FA24374.5080707@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD36968FD5@G9W0721.americas.hpqcorp.net>
	<4FA24F85.6000708@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD369690F1@G9W0721.americas.hpqcorp.net>
Message-ID: <4FA2BC63.5070000@rabbitmq.com>

Andrea,

On 03/05/12 11:03, Rosa, Andrea (HP Cloud Services) wrote:
>> Was there anything noteworthy in the sasl logs?
>
> Nothing special just the "normal" error:

Right. I've run out of ideas what to look at next. The logging / log 
rotation code hasn't changed for ages and there have been no previous 
reports of the problem you experienced. If you do see this happening 
again, perhaps you could keep the broker running for a bit while we 
think of various ways of poking it.

Matthias.

From konstantin.kalin at gmail.com  Thu May  3 20:45:20 2012
From: konstantin.kalin at gmail.com (Konstantin Kalin)
Date: Thu, 3 May 2012 12:45:20 -0700
Subject: [rabbitmq-discuss] Direct vs Topic exchange - Question
In-Reply-To: <4FA25A16.9050509@rabbitmq.com>
References: <87d7fc6b-cad6-42ab-8a34-afe1846e8332@a8g2000pbe.googlegroups.com>
	<4FA137CA.2000809@rabbitmq.com>
	<314905EC-5B0F-4469-BDCD-FF86F6C12078@gmail.com>
	<4FA25A16.9050509@rabbitmq.com>
Message-ID: <A00D3409-DCA0-4D76-ABB7-99B0ACBA746F@gmail.com>

Hello, Simon.

Thank you for looking at this. Sorry for causing troubles. Please see inline.

On May 3, 2012, at 3:12 AM, Simon MacMullen wrote:

> On 02/05/12 17:09, Konstantin Kalin wrote:
> 
> OK, that's just a typo I assume, I'll change it to:
> 
>  Connection = connections:get_connection(),
> 
Yep. It was typo. 

> 
> So it looks like the connection server is not getting started?
> 
Yes. Connection was not created. 
Actually I don't know why AMQP connections are not created if you start apps from command line using -s. It works fine when an app is started in Erlang shell using same "start" function.

I created start_publisher.sh and start_consumer.sh scripts. The scripts don't start the application actually. But they put proper ERL_LIBS and search path. Publisher and Consumer apps cannot work in same Erlang VMs because each app tries to create own Connection pool.

I have added comments for API methods in publisher.erl and consumer.erl. See attached file. 

Here are steps that I use to start the test:
Consumer:
1) start_consumer.sh
2) consumer:start(["amqp://guest:guest at 10.10.161.237:5672"]). 
3) consumer:start_consumer(<<"topic">>, <<"topic">>).
Publisher:
1) start_publisher.sh
2) publisher:start(["amqp://guest:guest at 10.10.161.237:5672"]).
3) publisher:start_publish(<<"topic">>, <<"topic">>, 1000, 1000).

Hope it will work now :)

I run several tests yesterday and got more confusing results:
Topic Exchange
1) 1 Consumer and 1 publisher - RabbitMQ shows ~10k per second. (4 times less than same test with Direct)
2) 10 Consumers and 10 publishers - RabbitMQ shows ~4k per second. (10 times less than same test with Direct). 
3) 100 Consumers and 100 publishers - RabbitMQ shows same ~4k per second. (10 times less than same test with Direct). 

And I see "Flow control" on Publisher connections. CPU is ~300% and Memory is ~300kb (VM is 8 CPU and 4Gb). So VM machine is slightly loaded. 

> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware

Thank you,
Kostya. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120503/b3f648e6/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitMQ.tar.gz
Type: application/x-gzip
Size: 481986 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120503/b3f648e6/attachment.bin>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120503/b3f648e6/attachment-0001.htm>

From ask at celeryproject.org  Thu May  3 22:21:11 2012
From: ask at celeryproject.org (Ask Solem)
Date: Thu, 3 May 2012 22:21:11 +0100
Subject: [rabbitmq-discuss] RFC - new exchange type idea
In-Reply-To: <5FD73FB4097D46A282084C268D19EF03@gmail.com>
References: <CAMcAHLU241feUdYNsZg0stpQmJk+22qTU+ipu5m9cJMJ6ewGfw@mail.gmail.com>
	<708689AA-8883-4017-BE81-5A6905CFF602@gmail.com>
	<CACOPnveOFxDC2OhQug5jGjFMeoKUgrUdNgGUy4zSJVdK-BVvLQ@mail.gmail.com>
	<5FD73FB4097D46A282084C268D19EF03@gmail.com>
Message-ID: <DBE2A46F-4779-4506-9B56-876826D30F5E@celeryproject.org>


On 27 Apr 2012, at 16:18, Alvaro Videla wrote:

>> 
>> All of these projects are motivated by ease of use and a simple API.
>> Let's make Rabbit easier to use.
>> 

I have been hard at work lately trying to make Celery easier
to use.  A new API has been in the works for a long time,
as I've "silently" replaced things behind the scenes.

Many seem to think that task queues is an easy problem where
all you need is a few list operations.  That may be true in
some cases, but you are likely to meet challenges down the road
that we have already solved, and for operations it is very
valuable to have a common base to share knowledge and tools
around.

I understand that Celery+RabbitMQ may seem like a hard beast
to tame, so I want to make it easier to get started with.
I'm converting the documentation to use the new API,
and I'm writing a new tutorial, so stay tuned!


-- 
Ask Solem
twitter.com/asksol | +44 (0)7713357179

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120503/91b6535d/attachment.pgp>

From munni at etrade.com  Fri May  4 05:19:08 2012
From: munni at etrade.com (Unni, Monish)
Date: Fri, 4 May 2012 04:19:08 +0000
Subject: [rabbitmq-discuss] immediate, mandatory flag with no consumers
In-Reply-To: <4FA2A7D1.9070105@rabbitmq.com>
References: <fa3b9c55-7577-41c3-80f2-9176d4736a30@u7g2000yqc.googlegroups.com>
	<4F996269.1050005@rabbitmq.com>
	<CAPwx=WNGYvmRaQe5F1_0w5bObzKuhdORGnwKhoT6sX-yUZaTBw@mail.gmail.com>
	<4F99787E.8030501@rabbitmq.com>
	<AC888676-0872-4116-A55E-03FE45C567D8@etrade.com>
	<4FA2A7D1.9070105@rabbitmq.com>
Message-ID: <A3FFF2F5-B03D-4F0D-930B-1CEB2FA3004A@etrade.com>

np, emile, thanks.
i got this code working ... however .. :),

what i am doing for the jvm is the following:
1] provide a configuration for clients to connect using configuration = number_of_connections, number_of_channels 
when a client configures "number_of_connections = 2 , number_of channels = 3" , the idea is to allow the client to get an effective throughput of 2 x 3 (i.e 3 channels per connection ) = 6 

2] for publishing messages i use a connection with a request channel. for receiving messages, i start consumers on *it's own connection* ( for throughput ). 
i am guessing this is the reason the code was not working for me ( since, the return callback listener was on a different connection )

so, questions: 
* is it okay to pair request-reply channels and use the same connection to provide "maximum" concurrency?
* how can we get this feature working for "C" clients ( C- api ) ?
* and last : is my understanding right ( from observation ) that the request channel and reply-channels have to share the same connection for this feature to work?

thanks and regards,
-monish

On May 3, 2012, at 8:44 AM, Emile Joubert wrote:

> Hi,
> 
> On 26/04/12 19:46, Unni, Monish wrote:
>> btw : this code is client-side, and i am testing if the server is up.
>> emile, if you could send me the code that you tried as a
>> stand-alone, it might help much. as it is - thank you very much for
>> looking at it.
> 
> Apologies for the delayed response. Please find attached, a slightly
> modified version of the code you provided. The output provided is
> 
> [ERROR:Service :REPLY_QUEUE seems down, returning with code=313
> message=NO_CONSUMERS]
> [ERROR:Service :REPLY_QUEUE seems down, returning with code=312
> message=NO_ROUTE]
> 
> -Emile
> 
> <Test.java>


From emile at rabbitmq.com  Fri May  4 10:33:11 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 04 May 2012 10:33:11 +0100
Subject: [rabbitmq-discuss] immediate, mandatory flag with no consumers
In-Reply-To: <A3FFF2F5-B03D-4F0D-930B-1CEB2FA3004A@etrade.com>
References: <fa3b9c55-7577-41c3-80f2-9176d4736a30@u7g2000yqc.googlegroups.com>
	<4F996269.1050005@rabbitmq.com>
	<CAPwx=WNGYvmRaQe5F1_0w5bObzKuhdORGnwKhoT6sX-yUZaTBw@mail.gmail.com>
	<4F99787E.8030501@rabbitmq.com>
	<AC888676-0872-4116-A55E-03FE45C567D8@etrade.com>
	<4FA2A7D1.9070105@rabbitmq.com>
	<A3FFF2F5-B03D-4F0D-930B-1CEB2FA3004A@etrade.com>
Message-ID: <4FA3A257.6000709@rabbitmq.com>

Hi,

On 04/05/12 05:19, Unni, Monish wrote:
> * is it okay to pair request-reply channels and use the same
> connection to provide "maximum" concurrency?

It is okay to send and receive messages on the same connection. Bear in
mind that if the broker decides to block the connection then all
channels in that connection will be affected. I'm not sure you will
achieve higher concurrency this way.

> * how can we get this feature working for "C" clients ( C- api ) ?

Have you taken a look at the C client examples?

> * and last : is my understanding right ( from observation ) that the
> request channel and reply-channels have to share the same connection
> for this feature to work?

In general requests and their corresponding replies do not have to share
a connection, but for basic.return to work the return handler must share
a channel with the publisher.

-Emile


From jayeshdalwadi2007 at gmail.com  Fri May  4 10:13:56 2012
From: jayeshdalwadi2007 at gmail.com (jayesh dalwadi)
Date: Fri, 4 May 2012 02:13:56 -0700 (PDT)
Subject: [rabbitmq-discuss] Node Not Found In AWS VPC For Create RabbitMQ
	cluster ?
Message-ID: <eaa5f851-579c-4084-ade5-460313c386a2@ot8g2000pbb.googlegroups.com>

try to configure RabbitMQ cluster on AWS VPC

i exchange the cookies from master node to second node
and do the following step
sudo /etc/init.d/rabbitmq-server stop sudo rabbitmqctl stop_app sudo
rabbitmqctl reset sudo rabbitmqctl cluster rabbit at ip-10-0-2-215
gives an error

Clustering node 'rabbit at ip-10-0-2-108' with
['rabbit at ip-10-0-2-215'] ...
Error: {no_running_cluster_nodes,['rabbit at ip-10-0-2-215'],
['rabbit at ip-10-0-2-215']}

All port in firewall configuration able to ping between that two
server

i am using RabbitMQ -v 2.8.2

From simon at rabbitmq.com  Fri May  4 11:11:59 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 04 May 2012 11:11:59 +0100
Subject: [rabbitmq-discuss] Direct vs Topic exchange - Question
In-Reply-To: <A00D3409-DCA0-4D76-ABB7-99B0ACBA746F@gmail.com>
References: <87d7fc6b-cad6-42ab-8a34-afe1846e8332@a8g2000pbe.googlegroups.com>
	<4FA137CA.2000809@rabbitmq.com>
	<314905EC-5B0F-4469-BDCD-FF86F6C12078@gmail.com>
	<4FA25A16.9050509@rabbitmq.com>
	<A00D3409-DCA0-4D76-ABB7-99B0ACBA746F@gmail.com>
Message-ID: <4FA3AB6F.6030201@rabbitmq.com>

Thanks. I was able to get this to run.

However, with the code as it stands I think it's hard to measure 
performance of the broker. In order to see how fast the broker can go, 
you need to have the client pushing it as hard as it can - therefore the 
broker pretty much needs to enter flow control by definition.

I attempted to make this happen by setting the rate limit in the client 
to 100,000 msg/s. However, this caused the memory usage of the client to 
explode - due to the line 115 of publisher_wrk.erl:

     amqp_channel:cast(Channel, Publish, Msg).

Since this is pushing messages as fast as possible into the client 
channel process, you end up filling its mailbox as you can give it 
messages faster than it can send them out on the wire.

After only a few seconds of this the client process was so big that my 
machine started to swap badly, bits of RabbitMQ got swapped out, and 
performance became very poor.

Changing this cast to a call slows the client down a bit (but not much) 
but makes its memory use stable at high message rates. With this change 
in place, and a very high rate limit, I was able to get:

direct, 1 producer,   1 consumer:   ~25kHz
topic,  1 producer,   1 consumer:   ~14kHz
direct, 10 producers, 10 consumers: ~25kHz
         (but queues grew since consumers could not keep up)
topic,  10 producers, 10 consumers: ~16kHz

on my workstation. This is very roughly what I would expect - with tiny 
messages quite a lot of the cost of each message is routing, and topic 
routing *is* more complex.

So I'm afraid I don't really trust the results you got - how were you 
choosing a rate limit for the client? Too low and you're not driving the 
broker as hard as you can, and with that cast in place, too high and 
you'll start to eat all memory and eventually cause RabbitMQ to get 
swapped out.

Cheers, Simon

On 03/05/12 20:45, Konstantin Kalin wrote:
> Hello, Simon.
>
> Thank you for looking at this. Sorry for causing troubles. Please see
> inline.
>
> On May 3, 2012, at 3:12 AM, Simon MacMullen wrote:
>
>> On 02/05/12 17:09, Konstantin Kalin wrote:
>>
>> OK, that's just a typo I assume, I'll change it to:
>>
>> Connection = connections:get_connection(),
>>
> Yep. It was typo.
>
>>
>> So it looks like the connection server is not getting started?
>>
> Yes. Connection was not created.
> Actually I don't know why AMQP connections are not created if you start
> apps from command line using *-s*. It works fine when an app is started
> in Erlang shell using same "start" function.
>
> I created start_publisher.sh and start_consumer.sh scripts. The scripts
> don't start the application actually. But they put proper ERL_LIBS and
> search path. Publisher and Consumer apps cannot work in same Erlang VMs
> because each app tries to create own Connection pool.
>
> I have added comments for API methods in publisher.erl and consumer.erl.
> See attached file.
>
> Here are steps that I use to start the test:
> _Consumer_:
> 1) start_consumer.sh
> 2) consumer:start(["amqp://guest:guest at 10.10.161.237:5672"]).
> 3) consumer:start_consumer(<<"topic">>, <<"topic">>).
> _Publisher_:
> 1) start_publisher.sh
> 2) publisher:start(["amqp://guest:guest at 10.10.161.237:5672"]).
> 3) publisher:start_publish(<<"topic">>, <<"topic">>, 1000, 1000).
>
> Hope it will work now :)
>
> I run several tests yesterday and got more confusing results:
> Topic Exchange
> 1) 1 Consumer and 1 publisher - RabbitMQ shows ~10k per second. (4 times
> less than same test with Direct)
> 2) 10 Consumers and 10 publishers - RabbitMQ shows ~4k per second. (10
> times less than same test with Direct).
> 3) 100 Consumers and 100 publishers - RabbitMQ shows same ~4k per
> second. (10 times less than same test with Direct).
>
> And I see "Flow control" on Publisher connections. CPU is ~300% and
> Memory is ~300kb (VM is 8 CPU and 4Gb). So VM machine is slightly loaded.
>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>
> Thank you,
> Kostya.
>
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Fri May  4 11:51:57 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 04 May 2012 11:51:57 +0100
Subject: [rabbitmq-discuss] RabbitMq Tutorial One cannot work under
	CentOS5.5
In-Reply-To: <2012050317283643324013@edocom.cn>
References: <2012050317283643324013@edocom.cn>
Message-ID: <4FA3B4CD.3090508@rabbitmq.com>

On 03/05/12 10:28, johnson wrote:
> I am quite new to RabbitMq and now try to learn it from the tutorial. I 
> installed the windows version and the LINUX version (CentOS 5.5) of 
> RabbitMQ 2.8.2. The Erlang version is R14B03 in Linux. In Windows, 
> everything is fine. But in CENTOS5.5, after sending the message, the 
> program cannot exit and always stuck.

Is there anything noteworthy in the broker logs?

Matthias.

From steve at rabbitmq.com  Fri May  4 12:01:15 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 4 May 2012 12:01:15 +0100
Subject: [rabbitmq-discuss] please help understanding why my pool of
	channels are blocking.
In-Reply-To: <CAHSyJgJvZ+NXn1+51i5KN10HZ3mQY56Cz+KjiPfzMVuEaEwpsg@mail.gmail.com>
References: <CAHSyJgJvZ+NXn1+51i5KN10HZ3mQY56Cz+KjiPfzMVuEaEwpsg@mail.gmail.com>
Message-ID: <6226D9BC-C0D6-472F-B9F0-ECA95B624558@rabbitmq.com>

Hi Guatam,

At first sight, this looks like it should work -- your (large) number of
tasks, will get gated through the 20 threads, which will use the 50
channels. It ought to be the case that there are always more than enough
channels to be 'in use' at any one time. The thread pool will dispatch
the tasks to threads as they become available....

I'll experiment to see if I can reproduce your experience, and get back
to you next week (after the bank holiday w/e here).

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 3 May 2012, at 04:34, Gautam Bakshi wrote:

> Hi Everyone,
> 
> I'm playing around with Rabbitmq(sorry for flooding the list lately) and am having some weird problems in my tests.  I have a multi-threaded application that I was considering using rabbitmq to manage the queue but I'm getting alot of blocking between my channels.  Is there a preferred way to setup pools?
> 
> I'm a bit new to Java so I used to the pools from apache commons but when I profile the channels are all blocking each other.  To test if dedicated connections per thread worked better I made an example of it as well and it does not block when the same program has a single channel per connection.  
> 
> So my question, do channels block each other or am I doing something wrong(using java api wrong or misunderstanding connection/channels)?  Is there a more preferred way? Unrelated to the question, but I was also wondering is there any difference between channels and connections in terms of throughput(i.e. would there be any benefit of using dedicated connections ignoring the overhead in establishing/maintaining the connection)?
> 
> Here's the test code(it simply sends to a thread a bunch of data to write the queue). If it helps I'm using v2.7.1, installed from MacPorts):
> 
> 
> import org.apache.commons.pool.BasePoolableObjectFactory;
> import org.apache.commons.pool.ObjectPool;
> import org.apache.commons.pool.PoolableObjectFactory;
> import org.apache.commons.pool.impl.GenericObjectPool;
> 
> import java.io.IOException;
> import java.util.NoSuchElementException;
> import java.util.Set;
> import java.util.concurrent.ExecutorService;
> import java.util.concurrent.Executors;
> import java.util.concurrent.LinkedBlockingDeque;
> import java.util.concurrent.ThreadPoolExecutor;
> import java.util.concurrent.TimeUnit;
> 
> 
> import com.rabbitmq.client.ConnectionFactory;
> import com.rabbitmq.client.Connection;
> import com.rabbitmq.client.Channel;
> import com.rabbitmq.client.MessageProperties;
> 
> public class PoolExample {
>     
> 	private static ExecutorService executor_worker;
> 	
> 	static {
>         final int numberOfThreads_ThreadPoolExecutor = 20;
>         executor_worker = Executors.newFixedThreadPool(numberOfThreads_ThreadPoolExecutor);
> 	}
> 	
>     public static void main(String[] args) throws Exception {
>     	System.out.println("starting.."); 	   		
>     	ObjectPool<Channel> pool =
>                 new GenericObjectPool<Channel>(
>                 new ConnectionPoolableObjectFactory(), 50);
>     	for (int x = 0; x<500000000; x++) {
>     		executor_worker.submit(new MyRunnable(x, pool));
>     	}
>     }
> }
> 
> /*
>  //this is a version that creates its own connection per channel
>  class ConnectionPoolableObjectFactory
>         extends BasePoolableObjectFactory<Channel> {
> 
>     private static final ConnectionFactory factory = newConnectionFactory();
> 
>     private static ConnectionFactory newConnectionFactory() {
>         ConnectionFactory factory = new ConnectionFactory();
>         factory.setHost("localhost");
>         return factory;
>     }
> 
>     @Override
>     public Channel makeObject() throws Exception {
>         System.out.println("new channel");
>     	return factory.newConnection().createChannel();
>         
>     }
> 
>     @Override
>     public boolean validateObject(Channel channel) {
>         return channel.isOpen();
>     }
> 
>     @Override
>     public void destroyObject(Channel channel) throws Exception {
>     	System.out.println("closing");
>         channel.close();
>     }
> 
>     @Override
>     public void passivateObject(Channel channel) throws Exception {
>         //System.out.println("sent back to queue");
>     }
> }
> */
> 
> //this version pools channels 
> class ConnectionPoolableObjectFactory extends BasePoolableObjectFactory<Channel> {
> 
> 	private final Connection connection;
> 
> 	ConnectionPoolableObjectFactory() throws IOException {
> 		ConnectionFactory factory = new ConnectionFactory();
> 		factory.setHost("localhost");
> 		connection = factory.newConnection();
> 	}
> 
> 	@Override
> 	public Channel makeObject() throws Exception {
> 		return connection.createChannel();
> 	}
> 
> 	@Override
> 	public boolean validateObject(Channel channel) {
> 		return channel.isOpen();
> 	}
> 
> 	@Override
> 	public void destroyObject(Channel channel) throws Exception {
> 		channel.close();
> 	}
> 
> 	@Override
> 	public void passivateObject(Channel channel) throws Exception {
> 		//do nothing
> 	}
> }
> 
> 
> class MyRunnable implements Runnable{  
> 	protected int x = 0;
> 	protected ObjectPool<Channel> pool;
> 	
>     public MyRunnable(int x, ObjectPool<Channel> pool) {
> 		// TODO Auto-generated constructor stub
>     	this.x = x;
>     	this.pool = pool;
> 	}
> 
> 	public void run(){
>         try {
>                 Channel channel = pool.borrowObject();
>             	String message = Integer.toString(x);
>             	channel.basicPublish( "", "task_queue", 
>                         MessageProperties.PERSISTENT_TEXT_PLAIN,
>                         message.getBytes());
>             	pool.returnObject(channel);
> 		} catch (NoSuchElementException e) {
> 			// TODO Auto-generated catch block
> 			e.printStackTrace();
> 		} catch (IllegalStateException e) {
> 			// TODO Auto-generated catch block
> 			e.printStackTrace();
> 		} catch (Exception e) {
> 			// TODO Auto-generated catch block
> 			e.printStackTrace();
> 		} 
>     }
> }
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120504/9a50fcd0/attachment.htm>

From matthias at rabbitmq.com  Fri May  4 12:24:40 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 04 May 2012 12:24:40 +0100
Subject: [rabbitmq-discuss] please help understanding why my pool
 of	channels are blocking.
In-Reply-To: <CAHSyJgJvZ+NXn1+51i5KN10HZ3mQY56Cz+KjiPfzMVuEaEwpsg@mail.gmail.com>
References: <CAHSyJgJvZ+NXn1+51i5KN10HZ3mQY56Cz+KjiPfzMVuEaEwpsg@mail.gmail.com>
Message-ID: <4FA3BC78.1000106@rabbitmq.com>

On 03/05/12 04:34, Gautam Bakshi wrote:
> I have a multi-threaded application that I was considering using
> rabbitmq to manage the queue but I'm getting alot of blocking between
> my channels.  Is there a preferred way to setup pools?
>
> I'm a bit new to Java so I used to the pools from apache commons but
>  when I profile the channels are all blocking each other.  To test if
>  dedicated connections per thread worked better I made an example of
> it as well and it does not block when the same program has a single
> channel per connection.
>
> So my question, do channels block each other or am I doing something
>  wrong(using java api wrong or misunderstanding
> connection/channels)?

Channels are multiplexed on the underlying connection. So when an app
is, say, publishing messages on multiple channels, these activities will
be serialised at the point the client interacts with the network socket.

> there a more preferred way? Unrelated to the question, but I was also
>  wondering is there any difference between channels and connections
> in terms of throughput(i.e. would there be any benefit of using
> dedicated connections ignoring the overhead in
> establishing/maintaining the connection)?

You can get exploit more parallelism in both the client and server when
using multiple connections compared to multiple channels. But it is
ultimately more costly in CPU and memory. Plus of course network
capacity is bounded, so if you are saturating that with a single
connection then using more than one will not gain anything.

So the answer on whether multiple channels or multiple connections are
better very much depends on the application, the hardware environment
at the client and broker end, and the network. Hence your best bet is to 
conduct some tests, which you are already doing :)

Regards,

Matthias.

From andrea.rosa at hp.com  Fri May  4 12:33:50 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Fri, 4 May 2012 11:33:50 +0000
Subject: [rabbitmq-discuss] log process
In-Reply-To: <4FA2BC63.5070000@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>
	<5F389C517756284F80239F55BCA5DDDD36964188@G9W0721.americas.hpqcorp.net>
	<CAHZsVQamUcKi5+4dwcGVCp1Q-HgMW30zoSkGvkNX41h5VLM+yg@mail.gmail.com>
	<5F389C517756284F80239F55BCA5DDDD369647EA@G9W0721.americas.hpqcorp.net>
	<4FA0C999.6010406@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD3696750E@G9W0721.americas.hpqcorp.net>
	<4FA1277D.3070704@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD369675C3@G9W0721.americas.hpqcorp.net>
	<4FA24374.5080707@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD36968FD5@G9W0721.americas.hpqcorp.net>
	<4FA24F85.6000708@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD369690F1@G9W0721.americas.hpqcorp.net>
	<4FA2BC63.5070000@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD369697BF@G9W0721.americas.hpqcorp.net>

>Right. I've run out of ideas what to look at next. The logging / log
>rotation code hasn't changed for ages and there have been no previous
>reports of the problem you experienced. If you do see this happening
>again, perhaps you could keep the broker running for a bit while we
>think of various ways of poking it.

Sure, thanks
--
ar

From simon at rabbitmq.com  Fri May  4 14:28:45 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 04 May 2012 14:28:45 +0100
Subject: [rabbitmq-discuss] Node Not Found In AWS VPC For Create
 RabbitMQ cluster ?
In-Reply-To: <eaa5f851-579c-4084-ade5-460313c386a2@ot8g2000pbb.googlegroups.com>
References: <eaa5f851-579c-4084-ade5-460313c386a2@ot8g2000pbb.googlegroups.com>
Message-ID: <4FA3D98D.6010804@rabbitmq.com>

On 04/05/12 10:13, jayesh dalwadi wrote:
> sudo /etc/init.d/rabbitmq-server stop sudo rabbitmqctl stop_app sudo
> rabbitmqctl reset sudo rabbitmqctl cluster rabbit at ip-10-0-2-215
> gives an error

You should not be running "sudo /etc/init.d/rabbitmq-server stop" first. 
The rest of the commands are correct.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri May  4 14:52:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 04 May 2012 14:52:08 +0100
Subject: [rabbitmq-discuss] Node Not Found In AWS VPC For Create
 RabbitMQ cluster ?
In-Reply-To: <CAHmVawrJK6CZefNZTKP89hoPV89jJL7OWuroHADkzNF_EpHWHg@mail.gmail.com>
References: <eaa5f851-579c-4084-ade5-460313c386a2@ot8g2000pbb.googlegroups.com>	<4FA3D98D.6010804@rabbitmq.com>
	<CAHmVawrJK6CZefNZTKP89hoPV89jJL7OWuroHADkzNF_EpHWHg@mail.gmail.com>
Message-ID: <4FA3DF08.1070702@rabbitmq.com>

Please leave rabbitmq-discuss on the CC list.

It's not clear whether you are saying that you *did* run "sudo 
/etc/init.d/rabbitmq-server stop" first or not. You should not. In any 
case, if you have done that then you will need to run "sudo 
/etc/init.d/rabbitmq-server start" first to bring your server back up again.

Cheers, Simon

On 04/05/12 14:49, jayesh dalwadi wrote:
>
>
> On Fri, May 4, 2012 at 6:58 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 04/05/12 10:13, jayesh dalwadi wrote:
>
>         sudo /etc/init.d/rabbitmq-server stop sudo rabbitmqctl stop_app sudo
>         rabbitmqctl reset sudo rabbitmqctl cluster rabbit at ip-10-0-2-215
>         gives an error
>
>
>     You should not be running "sudo /etc/init.d/rabbitmq-server stop"
>     first. The rest of the commands are correct.
>
>     Cheers, Simon
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>
>
> i execute that command first then also its not work
>
>
> --
> LOOSER IS THE ONE WHO CREATES A WINNER SO I DONT MIND LOOSING


-- 
Simon MacMullen
RabbitMQ, VMware

From gautam.bakshi at gmail.com  Fri May  4 15:43:49 2012
From: gautam.bakshi at gmail.com (Gautam Bakshi)
Date: Fri, 4 May 2012 10:43:49 -0400
Subject: [rabbitmq-discuss] please help understanding why my pool of
 channels are blocking.
In-Reply-To: <4FA3BC78.1000106@rabbitmq.com>
References: <CAHSyJgJvZ+NXn1+51i5KN10HZ3mQY56Cz+KjiPfzMVuEaEwpsg@mail.gmail.com>
	<4FA3BC78.1000106@rabbitmq.com>
Message-ID: <CAHSyJg+mxvPmxFh9YzytLvYmb0dJNBUdTV-4cAjU6=WQh8b8xg@mail.gmail.com>

Thanks Matthias and Steve.

Is there a better(or more common/supported) way to pool channels(so I
reduce blocking on threaded message passing)?  I'd rather not waste
anyone's time if there's already a tried and test solution out there for
pooling.

Enjoy the holidays!

On Fri, May 4, 2012 at 7:24 AM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 03/05/12 04:34, Gautam Bakshi wrote:
>
>> I have a multi-threaded application that I was considering using
>> rabbitmq to manage the queue but I'm getting alot of blocking between
>> my channels.  Is there a preferred way to setup pools?
>>
>> I'm a bit new to Java so I used to the pools from apache commons but
>>  when I profile the channels are all blocking each other.  To test if
>>  dedicated connections per thread worked better I made an example of
>> it as well and it does not block when the same program has a single
>> channel per connection.
>>
>> So my question, do channels block each other or am I doing something
>>  wrong(using java api wrong or misunderstanding
>> connection/channels)?
>>
>
> Channels are multiplexed on the underlying connection. So when an app
> is, say, publishing messages on multiple channels, these activities will
> be serialised at the point the client interacts with the network socket.
>
>
>  there a more preferred way? Unrelated to the question, but I was also
>>  wondering is there any difference between channels and connections
>> in terms of throughput(i.e. would there be any benefit of using
>> dedicated connections ignoring the overhead in
>> establishing/maintaining the connection)?
>>
>
> You can get exploit more parallelism in both the client and server when
> using multiple connections compared to multiple channels. But it is
> ultimately more costly in CPU and memory. Plus of course network
> capacity is bounded, so if you are saturating that with a single
> connection then using more than one will not gain anything.
>
> So the answer on whether multiple channels or multiple connections are
> better very much depends on the application, the hardware environment
> at the client and broker end, and the network. Hence your best bet is to
> conduct some tests, which you are already doing :)
>
> Regards,
>
> Matthias.
>



-- 
Regards,

Gautam Bakshi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120504/304d299a/attachment.htm>

From davidfooks at turbulenz.biz  Fri May  4 14:19:57 2012
From: davidfooks at turbulenz.biz (David Fooks)
Date: Fri, 4 May 2012 06:19:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Clustering and rabbitmqctl hangs
Message-ID: <31001085.746.1336137597481.JavaMail.geo-discussion-forums@vbuo17>

Hi,

I'm seeing the following behaviour when trying to test "A cluster on a 
single machine" http://www.rabbitmq.com/clustering.html#single-machine

I'm running the following script with sudo:

RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit1 rabbitmq-server -detached
RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=rabbit2 rabbitmq-server -detached
RABBITMQ_NODE_PORT=5674 RABBITMQ_NODENAME=rabbit3 rabbitmq-server -detached

Which outputs:

Activating RabbitMQ plugins ...
6 plugins activated:
* amqp_client-2.8.1
* mochiweb-1.3-rmq2.8.1-git
* rabbitmq_management-2.8.1
* rabbitmq_management_agent-2.8.1
* rabbitmq_mochiweb-2.8.1
* webmachine-1.7.0-rmq2.8.1-hg

Activating RabbitMQ plugins ...
6 plugins activated:
* amqp_client-2.8.1
* mochiweb-1.3-rmq2.8.1-git
* rabbitmq_management-2.8.1
* rabbitmq_management_agent-2.8.1
* rabbitmq_mochiweb-2.8.1
* webmachine-1.7.0-rmq2.8.1-hg

Activating RabbitMQ plugins ...
6 plugins activated:
* amqp_client-2.8.1
* mochiweb-1.3-rmq2.8.1-git
* rabbitmq_management-2.8.1
* rabbitmq_management_agent-2.8.1
* rabbitmq_mochiweb-2.8.1
* webmachine-1.7.0-rmq2.8.1-hg

Ok, looks good. So now I want to check that that all works and I run:

$> sudo rabbitmqctl -n rabbit1 at dfooks-ubuntu64 status
Status of node 'rabbit1 at dfooks-ubuntu64' ...
[{pid,9141},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.8.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.8.1"},
      {rabbit,"RabbitMQ","2.8.1"},
      {os_mon,"CPO  CXC 138 46","2.2.5"},
      {sasl,"SASL  CXC 138 11","2.1.9.3"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.1"},
      {webmachine,"webmachine","1.7.0-rmq2.8.1-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.1-git"},
      {inets,"INETS  CXC 138 49","5.5.2"},
      {mnesia,"MNESIA  CXC 138 12","4.4.17"},
      {stdlib,"ERTS  CXC 138 10","1.17.3"},
      {kernel,"ERTS  CXC 138 10","2.14.3"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:3:3] [rq:3] 
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,30671136},
      {processes,11642648},
      {processes_used,11633784},
      {system,19028488},
      {atom,1339001},
      {atom_used,1316698},
      {binary,156016},
      {code,14610757},
      {ets,1061320}]},
 {vm_memory_high_watermark,0.39999999961788246},
 {vm_memory_limit,418719334},
 {file_descriptors,
    
 [{total_limit,924},{total_used,3},{sockets_limit,829},{sockets_used,1}]},
 {processes,[{limit,1048576},{used,170}]},
 {run_queue,0},
 {uptime,703}]
...done.

 Again, good its running. However, if I now try and run

$> sudo rabbitmqctl -n rabbit2 at dfooks-ubuntu64 status
Status of node 'rabbit2 at dfooks-ubuntu64' ...

Then the command just hangs and I have to ctrl-c. This happens with all of 
the rabbitmqctrl commands I've tried so far (app_stop, app_start, stop). 
Anybody got some suggestions?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120504/942379b8/attachment.htm>

From davidfooks at turbulenz.biz  Fri May  4 14:25:32 2012
From: davidfooks at turbulenz.biz (David Fooks)
Date: Fri, 4 May 2012 06:25:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Clustering and rabbitmqctl hangs
In-Reply-To: <31001085.746.1336137597481.JavaMail.geo-discussion-forums@vbuo17>
References: <31001085.746.1336137597481.JavaMail.geo-discussion-forums@vbuo17>
Message-ID: <14496343.23.1336137932831.JavaMail.geo-discussion-forums@vbkk11>

Oops, right I needed the next set of commands:

RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit1 
RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners 
[{mgmt,[{port,55672}]}]" rabbitmq-server -detached
RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=rabbit2 
RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners 
[{mgmt,[{port,55673}]}]" rabbitmq-server -detached
RABBITMQ_NODE_PORT=5674 RABBITMQ_NODENAME=rabbit3 
RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners 
[{mgmt,[{port,55674}]}]" rabbitmq-server -detached

To set up the monitoring as well!

On Friday, 4 May 2012 14:19:57 UTC+1, David Fooks wrote:
>
> Hi,
>
> I'm seeing the following behaviour when trying to test "A cluster on a 
> single machine" http://www.rabbitmq.com/clustering.html#single-machine
>
> I'm running the following script with sudo:
>
> RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit1 rabbitmq-server -detached
> RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=rabbit2 rabbitmq-server -detached
> RABBITMQ_NODE_PORT=5674 RABBITMQ_NODENAME=rabbit3 rabbitmq-server -detached
>
> Which outputs:
>
> Activating RabbitMQ plugins ...
> 6 plugins activated:
> * amqp_client-2.8.1
> * mochiweb-1.3-rmq2.8.1-git
> * rabbitmq_management-2.8.1
> * rabbitmq_management_agent-2.8.1
> * rabbitmq_mochiweb-2.8.1
> * webmachine-1.7.0-rmq2.8.1-hg
>
> Activating RabbitMQ plugins ...
> 6 plugins activated:
> * amqp_client-2.8.1
> * mochiweb-1.3-rmq2.8.1-git
> * rabbitmq_management-2.8.1
> * rabbitmq_management_agent-2.8.1
> * rabbitmq_mochiweb-2.8.1
> * webmachine-1.7.0-rmq2.8.1-hg
>
> Activating RabbitMQ plugins ...
> 6 plugins activated:
> * amqp_client-2.8.1
> * mochiweb-1.3-rmq2.8.1-git
> * rabbitmq_management-2.8.1
> * rabbitmq_management_agent-2.8.1
> * rabbitmq_mochiweb-2.8.1
> * webmachine-1.7.0-rmq2.8.1-hg
>
> Ok, looks good. So now I want to check that that all works and I run:
>
> $> sudo rabbitmqctl -n rabbit1 at dfooks-ubuntu64 status
> Status of node 'rabbit1 at dfooks-ubuntu64' ...
> [{pid,9141},
>  {running_applications,
>      [{rabbitmq_management,"RabbitMQ Management Console","2.8.1"},
>       {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.1"},
>       {amqp_client,"RabbitMQ AMQP Client","2.8.1"},
>       {rabbit,"RabbitMQ","2.8.1"},
>       {os_mon,"CPO  CXC 138 46","2.2.5"},
>       {sasl,"SASL  CXC 138 11","2.1.9.3"},
>       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.1"},
>       {webmachine,"webmachine","1.7.0-rmq2.8.1-hg"},
>       {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.1-git"},
>       {inets,"INETS  CXC 138 49","5.5.2"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.17"},
>       {stdlib,"ERTS  CXC 138 10","1.17.3"},
>       {kernel,"ERTS  CXC 138 10","2.14.3"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:3:3] [rq:3] 
> [async-threads:30] [kernel-poll:true]\n"},
>  {memory,
>      [{total,30671136},
>       {processes,11642648},
>       {processes_used,11633784},
>       {system,19028488},
>       {atom,1339001},
>       {atom_used,1316698},
>       {binary,156016},
>       {code,14610757},
>       {ets,1061320}]},
>  {vm_memory_high_watermark,0.39999999961788246},
>  {vm_memory_limit,418719334},
>  {file_descriptors,
>     
>  [{total_limit,924},{total_used,3},{sockets_limit,829},{sockets_used,1}]},
>  {processes,[{limit,1048576},{used,170}]},
>  {run_queue,0},
>  {uptime,703}]
> ...done.
>
>  Again, good its running. However, if I now try and run
>
> $> sudo rabbitmqctl -n rabbit2 at dfooks-ubuntu64 status
> Status of node 'rabbit2 at dfooks-ubuntu64' ...
>
> Then the command just hangs and I have to ctrl-c. This happens with all of 
> the rabbitmqctrl commands I've tried so far (app_stop, app_start, stop). 
> Anybody got some suggestions?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120504/878c5ca5/attachment.htm>

From davidfooks at turbulenz.biz  Fri May  4 17:46:29 2012
From: davidfooks at turbulenz.biz (David Fooks)
Date: Fri, 4 May 2012 09:46:29 -0700 (PDT)
Subject: [rabbitmq-discuss] A cluster on a single machine
Message-ID: <26900763.505.1336149989357.JavaMail.geo-discussion-forums@vbbh3>

Hi,

I'm trying to emulate the guide here: 
http://www.rabbitmq.com/clustering.html

But I'm having a lot of issues! Every time I run I seem to be getting a 
different crash. Is this feature actually supported in 2.8.1?

Is there a proper way to completely reset all of the state that rabbitmq 
creates about other nodes/the cluster? My clean up script at the moment 
looks like this:

rm /var/run/rabbitmq/*
rm -f /var/log/rabbitmq/*
rm -rf /var/lib/rabbitmq/*

Here is my start-up script (I'm running this with sudo):

RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit1 
RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners 
[{mgmt,[{port,55672}]}]" rabbitmq-server -detached
RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=rabbit2 
RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners 
[{mgmt,[{port,55673}]}]" rabbitmq-server -detached
RABBITMQ_NODE_PORT=5674 RABBITMQ_NODENAME=rabbit3 
RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners 
[{mgmt,[{port,55674}]}]" rabbitmq-server -detached

ps -ef | grep rabbit1 | grep -v grep | awk '{print $2}' > 
/var/run/rabbitmq/rabbit1.pid
ps -ef | grep rabbit2 | grep -v grep | awk '{print $2}' > 
/var/run/rabbitmq/rabbit2.pid
ps -ef | grep rabbit3 | grep -v grep | awk '{print $2}' > 
/var/run/rabbitmq/rabbit3.pid

rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid
rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid

rabbitmqctl -n rabbit1 stop_app
rabbitmqctl -n rabbit1 reset
rabbitmqctl -n rabbit1 start_app

rabbitmqctl -n rabbit2 stop_app
rabbitmqctl -n rabbit2 reset
rabbitmqctl -n rabbit2 start_app

rabbitmqctl -n rabbit3 stop_app
rabbitmqctl -n rabbit3 reset
rabbitmqctl -n rabbit3 start_app

rabbitmqctl -n rabbit1 status
rabbitmqctl -n rabbit2 status
rabbitmqctl -n rabbit3 status

rabbitmqctl -n rabbit3 stop_app
rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64 
rabbit2 at dfooks-ubuntu64
rabbitmqctl -n rabbit3 start_app

If I run the "clean" script and then this script I get the following 
warning (after all of the status returns ok):

...
Stopping node 'rabbit3 at dfooks-ubuntu64' ...
...done.
Clustering node 'rabbit3 at dfooks-ubuntu64' with ['rabbit1 at dfooks-ubuntu64',
                                                'rabbit2 at dfooks-ubuntu64'] 
...
Error: {unable_to_join_cluster,
           ['rabbit1 at dfooks-ubuntu64','rabbit2 at dfooks-ubuntu64'],
           {merge_schema_failed,
               "Incompatible schema cookies. Please, restart from old 
backup.'rabbit1 at dfooks-ubuntu64' = 
[{name,schema},{type,set},{ram_copies,[]},{disc_copies,['rabbit1 at dfooks-ubuntu64']},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1336,149567,596521},'rabbit1 at dfooks-ubuntu64'}},{version,{{3,0},{'rabbit1 at dfooks-ubuntu64',{1336,149572,870479}}}}], 
'rabbit3 at dfooks-ubuntu64' = 
[{name,schema},{type,set},{ram_copies,['rabbit3 at dfooks-ubuntu64']},{disc_copies,['rabbit2 at dfooks-ubuntu64']},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1336,149568,520459},'rabbit2 at dfooks-ubuntu64'}},{version,{{3,0},{'rabbit3 at dfooks-ubuntu64',{1336,149572,882518}}}}]\n"}}
Starting node 'rabbit3 at dfooks-ubuntu64' ...
Error: {cannot_start_application,rabbitmq_management,
           {bad_return,
               {{rabbit_mgmt_app,start,[normal,[]]},
                {'EXIT',
                    {shutdown,
                        {gen_server2,call,
                            
[<4885.932.0>,{init,<4885.930.0>},infinity]}}}}}}

I've read about this error in other threads but it generally seems to be 
about network settings being reconfigured between nodes. I shouldn't have 
these problems since each instance is on the same machine.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120504/72c26779/attachment.htm>

From simon at rabbitmq.com  Fri May  4 18:00:51 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 04 May 2012 18:00:51 +0100
Subject: [rabbitmq-discuss] A cluster on a single machine
In-Reply-To: <26900763.505.1336149989357.JavaMail.geo-discussion-forums@vbbh3>
References: <26900763.505.1336149989357.JavaMail.geo-discussion-forums@vbbh3>
Message-ID: <4FA40B43.7000201@rabbitmq.com>

On 04/05/12 17:46, David Fooks wrote:
> Hi,
>
> I'm trying to emulate the guide here:
> http://www.rabbitmq.com/clustering.html
>
> But I'm having a lot of issues! Every time I run I seem to be getting a
> different crash. Is this feature actually supported in 2.8.1?

Yes! But running a cluster on a single machine is more fiddly than 
running it on separate machines as you need to make sure the nodes don't 
tread on each other. I don't think that's your problem though.

> Is there a proper way to completely reset all of the state that rabbitmq
> creates about other nodes/the cluster? My clean up script at the moment
> looks like this:
>
> rm /var/run/rabbitmq/*
> rm -f /var/log/rabbitmq/*
> rm -rf /var/lib/rabbitmq/*

OK, that should be fine.

> Here is my start-up script (I'm running this with sudo):
>
> RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit1
> RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners
> [{mgmt,[{port,55672}]}]" rabbitmq-server -detached
> RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=rabbit2
> RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners
> [{mgmt,[{port,55673}]}]" rabbitmq-server -detached
> RABBITMQ_NODE_PORT=5674 RABBITMQ_NODENAME=rabbit3
> RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners
> [{mgmt,[{port,55674}]}]" rabbitmq-server -detached
>
> ps -ef | grep rabbit1 | grep -v grep | awk '{print $2}' >
> /var/run/rabbitmq/rabbit1.pid
> ps -ef | grep rabbit2 | grep -v grep | awk '{print $2}' >
> /var/run/rabbitmq/rabbit2.pid
> ps -ef | grep rabbit3 | grep -v grep | awk '{print $2}' >
> /var/run/rabbitmq/rabbit3.pid

Ew, those ps'es are not nice. You may prefer to set RABBITMQ_PID_FILE 
for each startup, although this means you cannot use -detached (instead 
just background it with &)

> rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
> rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid
> rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid
>
> rabbitmqctl -n rabbit1 stop_app
> rabbitmqctl -n rabbit1 reset
> rabbitmqctl -n rabbit1 start_app
>
> rabbitmqctl -n rabbit2 stop_app
> rabbitmqctl -n rabbit2 reset
> rabbitmqctl -n rabbit2 start_app
>
> rabbitmqctl -n rabbit3 stop_app
> rabbitmqctl -n rabbit3 reset
> rabbitmqctl -n rabbit3 start_app

> rabbitmqctl -n rabbit1 status
> rabbitmqctl -n rabbit2 status
> rabbitmqctl -n rabbit3 status
>
> rabbitmqctl -n rabbit3 stop_app
> rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64
> rabbit2 at dfooks-ubuntu64
> rabbitmqctl -n rabbit3 start_app

But here's the problem. You need to do:

rabbitmqctl -n rabbit3 stop_app
rabbitmqctl -n rabbit3 reset
rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64 \
     rabbit2 at dfooks-ubuntu64
rabbitmqctl -n rabbit3 start_app

Instead you are doing something like (considering only rabbit3):

rabbitmqctl -n rabbit3 stop_app
rabbitmqctl -n rabbit3 reset
rabbitmqctl -n rabbit3 start_app
rabbitmqctl -n rabbit3 stop_app
rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64 \
     rabbit2 at dfooks-ubuntu64
rabbitmqctl -n rabbit3 start_app

Clustering can only take place when the state is *completely* reset - 
the fact that you are starting and stopping the app again between reset 
and cluster is recreating a blank database...

<snip>
> {merge_schema_failed, "Incompatible schema cookies.
<snip>

...which is exactly what would lead to this error message.

And yes, at some point we hope to make clustering easier to use.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From davidfooks at turbulenz.biz  Fri May  4 17:53:29 2012
From: davidfooks at turbulenz.biz (David Fooks)
Date: Fri, 4 May 2012 09:53:29 -0700 (PDT)
Subject: [rabbitmq-discuss] A cluster on a single machine
In-Reply-To: <26900763.505.1336149989357.JavaMail.geo-discussion-forums@vbbh3>
References: <26900763.505.1336149989357.JavaMail.geo-discussion-forums@vbbh3>
Message-ID: <10143683.692.1336150409331.JavaMail.geo-discussion-forums@vbep19>

Ok the above script is missing something:

...
rabbitmqctl -n rabbit3 stop_app
rabbitmqctl -n rabbit3 reset
rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64 
rabbit2 at dfooks-ubuntu64
rabbitmqctl -n rabbit3 start_app

But this after this change I still get the error.

On Friday, 4 May 2012 17:46:29 UTC+1, David Fooks wrote:
>
> Hi,
>
> I'm trying to emulate the guide here: 
> http://www.rabbitmq.com/clustering.html
>
> But I'm having a lot of issues! Every time I run I seem to be getting a 
> different crash. Is this feature actually supported in 2.8.1?
>
> Is there a proper way to completely reset all of the state that rabbitmq 
> creates about other nodes/the cluster? My clean up script at the moment 
> looks like this:
>
> rm /var/run/rabbitmq/*
> rm -f /var/log/rabbitmq/*
> rm -rf /var/lib/rabbitmq/*
>
> Here is my start-up script (I'm running this with sudo):
>
> RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit1 
> RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners 
> [{mgmt,[{port,55672}]}]" rabbitmq-server -detached
> RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=rabbit2 
> RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners 
> [{mgmt,[{port,55673}]}]" rabbitmq-server -detached
> RABBITMQ_NODE_PORT=5674 RABBITMQ_NODENAME=rabbit3 
> RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners 
> [{mgmt,[{port,55674}]}]" rabbitmq-server -detached
>
> ps -ef | grep rabbit1 | grep -v grep | awk '{print $2}' > 
> /var/run/rabbitmq/rabbit1.pid
> ps -ef | grep rabbit2 | grep -v grep | awk '{print $2}' > 
> /var/run/rabbitmq/rabbit2.pid
> ps -ef | grep rabbit3 | grep -v grep | awk '{print $2}' > 
> /var/run/rabbitmq/rabbit3.pid
>
> rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
> rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid
> rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid
>
> rabbitmqctl -n rabbit1 stop_app
> rabbitmqctl -n rabbit1 reset
> rabbitmqctl -n rabbit1 start_app
>
> rabbitmqctl -n rabbit2 stop_app
> rabbitmqctl -n rabbit2 reset
> rabbitmqctl -n rabbit2 start_app
>
> rabbitmqctl -n rabbit3 stop_app
> rabbitmqctl -n rabbit3 reset
> rabbitmqctl -n rabbit3 start_app
>
> rabbitmqctl -n rabbit1 status
> rabbitmqctl -n rabbit2 status
> rabbitmqctl -n rabbit3 status
>
> rabbitmqctl -n rabbit3 stop_app
> rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64 
> rabbit2 at dfooks-ubuntu64
> rabbitmqctl -n rabbit3 start_app
>
> If I run the "clean" script and then this script I get the following 
> warning (after all of the status returns ok):
>
> ...
> Stopping node 'rabbit3 at dfooks-ubuntu64' ...
> ...done.
> Clustering node 'rabbit3 at dfooks-ubuntu64' with ['rabbit1 at dfooks-ubuntu64',
>                                                 'rabbit2 at dfooks-ubuntu64'] 
> ...
> Error: {unable_to_join_cluster,
>            ['rabbit1 at dfooks-ubuntu64','rabbit2 at dfooks-ubuntu64'],
>            {merge_schema_failed,
>                "Incompatible schema cookies. Please, restart from old 
> backup.'rabbit1 at dfooks-ubuntu64' = 
> [{name,schema},{type,set},{ram_copies,[]},{disc_copies,['rabbit1 at dfooks-ubuntu64']},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1336,149567,596521},'rabbit1 at dfooks-ubuntu64'}},{version,{{3,0},{'rabbit1 at dfooks-ubuntu64',{1336,149572,870479}}}}], 
> 'rabbit3 at dfooks-ubuntu64' = 
> [{name,schema},{type,set},{ram_copies,['rabbit3 at dfooks-ubuntu64']},{disc_copies,['rabbit2 at dfooks-ubuntu64']},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1336,149568,520459},'rabbit2 at dfooks-ubuntu64'}},{version,{{3,0},{'rabbit3 at dfooks-ubuntu64',{1336,149572,882518}}}}]\n"}}
> Starting node 'rabbit3 at dfooks-ubuntu64' ...
> Error: {cannot_start_application,rabbitmq_management,
>            {bad_return,
>                {{rabbit_mgmt_app,start,[normal,[]]},
>                 {'EXIT',
>                     {shutdown,
>                         {gen_server2,call,
>                             
> [<4885.932.0>,{init,<4885.930.0>},infinity]}}}}}}
>
> I've read about this error in other threads but it generally seems to be 
> about network settings being reconfigured between nodes. I shouldn't have 
> these problems since each instance is on the same machine.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120504/0d5a14a2/attachment.htm>

From francesco at rabbitmq.com  Fri May  4 18:09:09 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 04 May 2012 18:09:09 +0100
Subject: [rabbitmq-discuss] A cluster on a single machine
In-Reply-To: <4FA40B43.7000201@rabbitmq.com>
References: <26900763.505.1336149989357.JavaMail.geo-discussion-forums@vbbh3>
	<4FA40B43.7000201@rabbitmq.com>
Message-ID: <4FA40D35.9040900@rabbitmq.com>

> rabbitmqctl -n rabbit3 stop_app
> rabbitmqctl -n rabbit3 reset
> rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64 \
> rabbit2 at dfooks-ubuntu64
> rabbitmqctl -n rabbit3 start_app

There's another problem with this: you're making rabbit3 believe that 
rabbi1 and rabbit2 are in the same cluster, which will lead to bad things.

So the correct way of doing this would be

rabbitctl -n rabbit2 stop_app
rabbitctl -n rabbit2 reset
rabbitctl -n rabbit2 cluster rabbit1 at dfooks-ubuntu64
rabbitctl -n rabbit2 start_app

to cluster rabbit2 with rabbit1, and then what Simon said.

Francesco.

From lucas.vella at neoex.com.br  Fri May  4 19:40:50 2012
From: lucas.vella at neoex.com.br (Lucas Vella)
Date: Fri, 4 May 2012 15:40:50 -0300
Subject: [rabbitmq-discuss] Per queue serialized delivery guarantee
Message-ID: <CAC-F2epuLbVDCFcwirnSP3xCaooh9WUFdPS6jS_WKuE8dyJ6Yg@mail.gmail.com>

I have multiple queues and multiple consumers. To achieve load
balancing, any consumer may consume from any queue, but for logic
consistency in the system, no queue may deliver a message before
receiving ack from the last message delivered from that queue. There
may be a very large number of queues.

Is this scenario possible with RabbitMQ? I was working on the
assumption that no message from a particular queue would be delivered
if the was a pending unacknowledged message there, and a free consumer
would pick a message from another queue, but that was not true for the
tests I made, and serialization was only guaranteed if there was one
consumer per queue. Also, the API did not provide any means for a
consumer to read from "all available queues".

Maybe I was thinking with the wrong abstractions, and I could, inside
the same queue, guarantee the serial delivery of the messages based on
some logic attribute in the message header, like "no message with
attribute X will be delivered if there is an unacknowledged message
with this same attribute X". Is that possible?

What do you suggest?

--
Lucas Clemente Vella

From munni at etrade.com  Fri May  4 20:43:05 2012
From: munni at etrade.com (Unni, Monish)
Date: Fri, 4 May 2012 19:43:05 +0000
Subject: [rabbitmq-discuss] immediate, mandatory flag with no consumers
In-Reply-To: <4FA3A257.6000709@rabbitmq.com>
References: <fa3b9c55-7577-41c3-80f2-9176d4736a30@u7g2000yqc.googlegroups.com>
	<4F996269.1050005@rabbitmq.com>
	<CAPwx=WNGYvmRaQe5F1_0w5bObzKuhdORGnwKhoT6sX-yUZaTBw@mail.gmail.com>
	<4F99787E.8030501@rabbitmq.com>
	<AC888676-0872-4116-A55E-03FE45C567D8@etrade.com>
	<4FA2A7D1.9070105@rabbitmq.com>
	<A3FFF2F5-B03D-4F0D-930B-1CEB2FA3004A@etrade.com>
	<4FA3A257.6000709@rabbitmq.com>
Message-ID: <57E70C22-4040-4F88-8B6F-32580537AF02@etrade.com>

Thanks for your replies Emile!

the only thing close to the c-client for basic.return i found this : https://groups.google.com/forum/#!msg/rabbitmq-discuss/fHL9tQHj4s0/FxCQxx4khKQJ
not sure if it does the same thing as java-api.

or if you could link me to github for this functionality.

kind regards,
-monish

On May 4, 2012, at 2:33 AM, Emile Joubert wrote:

> Hi,
> 
> On 04/05/12 05:19, Unni, Monish wrote:
>> * is it okay to pair request-reply channels and use the same
>> connection to provide "maximum" concurrency?
> 
> It is okay to send and receive messages on the same connection. Bear in
> mind that if the broker decides to block the connection then all
> channels in that connection will be affected. I'm not sure you will
> achieve higher concurrency this way.
> 
>> * how can we get this feature working for "C" clients ( C- api ) ?
> 
> Have you taken a look at the C client examples?
> 
>> * and last : is my understanding right ( from observation ) that the
>> request channel and reply-channels have to share the same connection
>> for this feature to work?
> 
> In general requests and their corresponding replies do not have to share
> a connection, but for basic.return to work the return handler must share
> a channel with the publisher.
> 
> -Emile
> 


From aaron at agoragames.com  Fri May  4 20:54:58 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Fri, 4 May 2012 15:54:58 -0400
Subject: [rabbitmq-discuss] exchange.unbind method enumeration
Message-ID: <CAHiEoM60QPwoBH1h4VHqo=w_t4BNuyP8u++ddwBkC8UN0d9_ig@mail.gmail.com>

I'm implementing rabbit extensions in haigha and I'm curious if
there's a bug in the documentation for exchange.unbind. Specifically,
it's documented as method id 40, but unbind-ok is 51. It would appear
that spec is intended to mirror queue.bind, which uses 50 and 51.

-Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From konstantin.kalin at gmail.com  Fri May  4 21:51:00 2012
From: konstantin.kalin at gmail.com (Konstantin Kalin)
Date: Fri, 4 May 2012 13:51:00 -0700
Subject: [rabbitmq-discuss] Direct vs Topic exchange - Question
In-Reply-To: <4FA3AB6F.6030201@rabbitmq.com>
References: <87d7fc6b-cad6-42ab-8a34-afe1846e8332@a8g2000pbe.googlegroups.com>
	<4FA137CA.2000809@rabbitmq.com>
	<314905EC-5B0F-4469-BDCD-FF86F6C12078@gmail.com>
	<4FA25A16.9050509@rabbitmq.com>
	<A00D3409-DCA0-4D76-ABB7-99B0ACBA746F@gmail.com>
	<4FA3AB6F.6030201@rabbitmq.com>
Message-ID: <144C8DEA-9686-4C66-9962-120E8AE5B321@gmail.com>

Hello, Simon.

Thank you for your help here. See inline. 

On May 4, 2012, at 3:11 AM, Simon MacMullen wrote:

>    amqp_channel:cast(Channel, Publish, Msg).
> 
> Since this is pushing messages as fast as possible into the client channel process, you end up filling its mailbox as you can give it messages faster than it can send them out on the wire.
> 

Yes. I know about this and this is why I created rate control on Client side. I thought that amqp_channel:cast(Channel, Publish, Msg) is better way to create a load :) Well, I have changed it to amqp_channel:call. Thank you for the advice. 


> direct, 1 producer,   1 consumer:   ~25kHz
> topic,  1 producer,   1 consumer:   ~14kHz
> direct, 10 producers, 10 consumers: ~25kHz
>        (but queues grew since consumers could not keep up)
> topic,  10 producers, 10 consumers: ~16kHz
> 
> on my workstation. This is very roughly what I would expect - with tiny messages quite a lot of the cost of each message is routing, and topic routing *is* more complex.
> 

Well. It looks much better than I have :) And this is why I have asked to guide me what I'm doing wrong. I believe that RabbitMQ is great product and this is why I spend time on different tests to gain better understanding how it works. Thus I will use RabbitMQ more effectively. 
  
> So I'm afraid I don't really trust the results you got - how were you choosing a rate limit for the client? Too low and you're not driving the broker as hard as you can, and with that cast in place, too high and you'll start to eat all memory and eventually cause RabbitMQ to get swapped out.
> 
Understood. Usually the load test results causes a lot of confusions and questions since people makes load-tests for particular cases. 
Please don't treat me wrong. I don't blame RabbitMQ. I rather will blame me for these strange results. 

Let me explain my test setup:
I have two physical servers: 16 AuthenticAMD CPU, 16 Gb memory each. I use one physical server to virtualize RabbitMQ using KVM. RabbitMQ has 8 CPU and 4Gb. And there are no other VMs running on this physical server. And I use second physical server to run Consumer/Publisher code that you tried. 

I repeated the test with direct and topic exchanges after I modified the code as mentioted above. 
10 consumers and publishers for each type of exchange. I started publishing using following commands:
Test 1 - publisher:start_publish(<<"kkalin_test1">>, <<"topic">>, 20000, 20000, 10, 0).
Test 2 - publisher:start_publish(<<"kkalin_test">>, <<"direct">>, 20000, 20000, 10, 0). 

I got: ~4k for Topic and ~60k for Direct :) See attached screenshots. I don't understand why. And I think it's hard to blame that publisher_wrk works slow for Topic exchange. There is no dedicated logic in software code that can affect messages rate depending on Exchange type. Same code, same machines and results with big differences. :(

May be you can provide a few advices what I can check to understand where is a bottle neck? 
According to vmstat and htop, RabbitMQ and Client servers were not loaded in case of Topic Exchange. Looks like that RabbitMQ and Publisher are waiting each other. 

Thank you for patience,
Kostya. 





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120504/cab52660/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screen Shot 2012-05-04 at 12.57.24 PM.png
Type: image/png
Size: 92029 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120504/cab52660/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screen Shot 2012-05-04 at 1.09.10 PM.png
Type: image/png
Size: 95550 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120504/cab52660/attachment-0001.png>

From matthias at rabbitmq.com  Fri May  4 22:04:41 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 04 May 2012 22:04:41 +0100
Subject: [rabbitmq-discuss] exchange.unbind method enumeration
In-Reply-To: <CAHiEoM60QPwoBH1h4VHqo=w_t4BNuyP8u++ddwBkC8UN0d9_ig@mail.gmail.com>
References: <CAHiEoM60QPwoBH1h4VHqo=w_t4BNuyP8u++ddwBkC8UN0d9_ig@mail.gmail.com>
Message-ID: <4FA44469.4070409@rabbitmq.com>

On 04/05/12 20:54, Aaron Westendorf wrote:
> I'm implementing rabbit extensions in haigha and I'm curious if
> there's a bug in the documentation for exchange.unbind. Specifically,
> it's documented as method id 40, but unbind-ok is 51. It would appear
> that spec is intended to mirror queue.bind, which uses 50 and 51.

We discovered that a year ago. It's in the spec and hence lots of code 
out there. Too late to change, I'm afraid.

Matthias.

From mpietrek at skytap.com  Fri May  4 23:55:43 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 4 May 2012 15:55:43 -0700
Subject: [rabbitmq-discuss] Hang on "starting database ...." remains in
	2.8.2 cluster
Message-ID: <CACLE7iykgZBFJaSCAs6+K6veXFGrweUiKWvT_QnGE-u6DhLJDQ@mail.gmail.com>

I've written this alias before about this topic, and the problem
remains in 2.8.2. See:
    http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/018414.html

I have a three node cluster running RabbitMQ 2.82/Erlang R13B03 on Ubuntu 10.04.

Once the cluster is up and running properly (as observed by the Web
UI), I then start/stop individual nodes in the cluster:
    rabbitmqctl stop
    rabbitmq-server

Inevitably one of the nodes won't come back up, waiting forever on
"starting" the database (no 30 second timeout... Forever.)

The only way to get all three nodes functioning again together is to
forcibly stop the other two nodes, then restart them all again.


The first item below is the console output as captured via nohup,
showing "starting database" as the last item.
The second item below is the last few lines of the rabbit@<node>.log
file, showing the node shutting down, then beginning to start up
again.

Is it likely that a newer Erlang version would help out?
What else can I provide to help diagnose this?

Thanks,

Matt

--------
node           : rabbit at util
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-2.8.2/sbin/../ebin/rabbit.app
home dir       : /home/mpietrek
config file(s) : /home/mpietrek/work/var/run/rabbitmq.config
cookie hash    : pR5H9kY3Wra/XdLELT5hgQ==
log            :
/home/mpietrek/work/logs/util.mpietrek.internal.illumita.com/rabbit at util.log
sasl log       :
/home/mpietrek/work/logs/util.mpietrek.internal.illumita.com/rabbit at util-sasl.log
database dir   : /home/mpietrek/work/var/lib/rabbit at util
erlang version : 5.7.4

-- rabbit boot start
starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...

--------

=INFO REPORT==== 4-May-2012::15:02:14 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: permanent

=INFO REPORT==== 4-May-2012::15:02:14 ===
stopped TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 4-May-2012::15:02:14 ===
    application: rabbit
    exited: stopped
    type: permanent

=INFO REPORT==== 4-May-2012::15:02:14 ===
    application: os_mon
    exited: stopped
    type: permanent

=INFO REPORT==== 4-May-2012::15:02:14 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 4-May-2012::15:02:14 ===
Halting Erlang VM

=INFO REPORT==== 4-May-2012::15:02:52 ===
Limiting to approx 924 file handles (829 sockets)

From zongyong at gmail.com  Fri May  4 20:47:52 2012
From: zongyong at gmail.com (Zongyong Zheng)
Date: Fri, 4 May 2012 12:47:52 -0700 (PDT)
Subject: [rabbitmq-discuss] .Net client DeclareQueue durable queue,
 queue is deleted after the client application exits.
Message-ID: <caa8a235-e906-4c04-9bb5-b9c90cea0c15@y3g2000vbn.googlegroups.com>

Hi,

I am new to RabbitMQ. I used the RabbitMQ 2.8.1 .Net client in my
client application to connect the RabbitMQ server. I did declare my
queue is durable = true, auto-delete=false, exclusive = false. then
bind the queue to an existing exchange. After the client application
terminates, the queue got deleted. Why did it get deleted even I
declared it durable?  I need the queue to be durable, so that after
client application restarts, the subscription to the queue will work.

I knew if I can manually create the queue via RabbitMQ management http
API on the RabbitMQ server, the queue will be durable. However, this
workaround is not acceptable to me.

I have to use the .Net client to create a durable queue. Any help will
be appreciated.

Thanks,

James

From francis.ridder at gmail.com  Sat May  5 00:52:06 2012
From: francis.ridder at gmail.com (Francis Ridder)
Date: Fri, 4 May 2012 16:52:06 -0700
Subject: [rabbitmq-discuss] RabbitMQ 2.8.2 Disk Space Monitoring issue
Message-ID: <CAO1=DnGJbgA4BR=2py+LKjzAzAivOnYXqrSVvPXKPheeK5JXdQ@mail.gmail.com>

Hello,
       I ran into an issue with the Disk Space monitoring. By default
it is set to 1.0x RAM however this default does not work if you have
more RAM than disk space. The box that our rabbit runs on has more ram
then disk space
so with 2.8.2 we get
 {disk_free_limit,76171264000},
 {disk_free,62065946624},
disk 63gb ... ram 72GB
as such we get a "Disk free space limit now exceeded. Free
bytes:62065909760 Limit:76171264000" immediately on startup. We fixed
it by setting the diskpace to 50% of ram. Is there a particular reason
why you would want space free to be more than 1.0 RAM or is it meant
to be a sensible default?

From matthias at rabbitmq.com  Sat May  5 12:41:07 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 05 May 2012 12:41:07 +0100
Subject: [rabbitmq-discuss] AMQP.BasicProperties.setMessageId()
	deprecated
In-Reply-To: <1336059529.667520297@apps.rackspace.com>
References: <1336059529.667520297@apps.rackspace.com>
Message-ID: <4FA511D3.8090401@rabbitmq.com>

Matthew,

On 03/05/12 16:38, m.luchak at smartasking.com wrote:
> I am attempting to set the message ID (on a producer) and see that
> AMQP.BasicProperties.setMessageId() is deprecated. I believe that I
> should/could be using builder but the messageID is returning as null.
>
> AMQP.BasicProperties props = new AMQP.BasicProperties();
> props.builder().messageId(" yadada ");
> props.builder().build();
> channel.basicPublish(EXCHANGE_NAME, routingKey, props, message.getBytes());
>
> does not return a messageID

See the example at http://www.rabbitmq.com/api-guide.html for usage of 
the builder classes. You may also want to read up on the builder pattern 
in general. The mistake in the above is that basicPublish is invoked 
with the plain props object constructed in the first line, rather than 
the object produced by the builder.

Regards,

Matthias.

From jayeshdalwadi2007 at gmail.com  Sat May  5 13:26:09 2012
From: jayeshdalwadi2007 at gmail.com (jayesh dalwadi)
Date: Sat, 5 May 2012 05:26:09 -0700 (PDT)
Subject: [rabbitmq-discuss] How To Load-Distribution in RabbitMQ cluster?
Message-ID: <7dc6a60f-8a78-484c-8bb9-881fac683329@k10g2000pbk.googlegroups.com>

Hi I create three RabbitMQ servers running in cluster on EC2

I want to scale out RabbitMQ cluster base on CPU utilization but when
I publish message only one server utilizes CPU and other RabbitMQ-
server not utilize CPU

so how can i distribute the load across the RabbitMQ cluster ?

From jeff at jefftrout.com  Mon May  7 13:09:42 2012
From: jeff at jefftrout.com (Jeff)
Date: Mon, 07 May 2012 08:09:42 -0400
Subject: [rabbitmq-discuss] How To Load-Distribution in RabbitMQ cluster?
In-Reply-To: <7dc6a60f-8a78-484c-8bb9-881fac683329@k10g2000pbk.googlegroups.com>
References: <7dc6a60f-8a78-484c-8bb9-881fac683329@k10g2000pbk.googlegroups.com>
Message-ID: <57A045F0-42CC-4D07-9C1D-C3905561E75C@jefftrout.com>


On May 5, 2012, at 8:26 AM, jayesh dalwadi wrote:

> Hi I create three RabbitMQ servers running in cluster on EC2
> 
> I want to scale out RabbitMQ cluster base on CPU utilization but when
> I publish message only one server utilizes CPU and other RabbitMQ-
> server not utilize CPU
> 
> so how can i distribute the load across the RabbitMQ cluster ?


we're using haproxy to load balance our rabbit cluster
been working great since december. we're just doing simple rr balancing, but haproxy does support more involved balancing.

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

--
Jeff Trout <jeff at jefftrout.com>
http://www.stuarthamm.net/
http://www.dellsmartexitin.com/




From aaron at agoragames.com  Mon May  7 13:38:20 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 7 May 2012 08:38:20 -0400
Subject: [rabbitmq-discuss] exchange.unbind method enumeration
In-Reply-To: <4FA44469.4070409@rabbitmq.com>
References: <CAHiEoM60QPwoBH1h4VHqo=w_t4BNuyP8u++ddwBkC8UN0d9_ig@mail.gmail.com>
	<4FA44469.4070409@rabbitmq.com>
Message-ID: <CAHiEoM4ntWHx8i9bdpMGgacBtWcnTRh7Hdx4eNZ3SExjzH_u_Q@mail.gmail.com>

Good to know. The official spec has a lot of documentation bugs in it,
so I'll ask about anything else I come across that's suspicious.

On Fri, May 4, 2012 at 5:04 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> On 04/05/12 20:54, Aaron Westendorf wrote:
>>
>> I'm implementing rabbit extensions in haigha and I'm curious if
>> there's a bug in the documentation for exchange.unbind. Specifically,
>> it's documented as method id 40, but unbind-ok is 51. It would appear
>> that spec is intended to mirror queue.bind, which uses 50 and 51.
>
>
> We discovered that a year ago. It's in the spec and hence lots of code out
> there. Too late to change, I'm afraid.
>
> Matthias.



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From gmr at myyearbook.com  Mon May  7 15:35:08 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 7 May 2012 10:35:08 -0400
Subject: [rabbitmq-discuss] 2.7.1 / R14B04 Crash Report: ~1PB RAM allocation
	failure
Message-ID: <CAL_e=0q7_K5icvXonudbciMP5ZTyd=oPbDNebhWVtm+KhRJdqw@mail.gmail.com>

I had a fun crash this morning on a production machine. Notice the amount
of memory trying to be allocated? Is there anything the RabbitMQ dev's
would like? The full erl_crash.dump or core file (6.4GB) -- I'd prefer to
send those off list.

Gavin

=erl_crash_dump:0.1
Mon May  7 09:52:27 2012
Slogan: std_alloc: Cannot allocate 1124304355803072 bytes of memory (of
type "arg_reg").
System version: Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:24:24]
[rq:24] [async-threads:30] [hipe] [kernel-poll:true]
Compiled: Mon Oct 31 11:49:56 2011
Taints:
Atoms: 24135
=memory
total: 5351658512
processes: 290453824
processes_used: 289852904
system: 5061204688
atom: 1686881
atom_used: 1671116
binary: 88067864
code: 16581071
ets: 4654237544
=hash_table:atom_tab
size: 19289
used: 13794
objs: 24135
depth: 8
=index_table:atom_tab
size: 24576
limit: 1048576
entries: 24135
=hash_table:module_code
size: 797
used: 533
objs: 612
depth: 3
=index_table:module_code
size: 1024
limit: 65536
entries: 612
=hash_table:export_list
size: 6421
used: 5118
objs: 10224
depth: 7
=index_table:export_list
size: 10240
limit: 524288
entries: 10224
=hash_table:secondary_export_table
size: 97
used: 0
objs: 0
depth: 0
=hash_table:process_reg
size: 97
used: 65
objs: 113
depth: 6
=hash_table:fun_table
size: 2411
used: 1769
objs: 3103
depth: 7
=hash_table:node_table
size: 5
used: 3
objs: 6
depth: 4
=hash_table:dist_table
size: 5
used: 2
objs: 5
depth: 3
=allocated_areas
sys_misc: 25277398
static: 239599616
atom_space: 360536 344971
atom_table: 351033
module_table: 14684
export_table: 133404
register_table: 868
fun_table: 19378
module_refs: 16384
loaded_code: 15087933
dist_table: 1971
node_table: 419
bits_bufs_size: 0
bif_timer: 130312
link_lh: 0
proc: 10760848 10368016
atom_entry: 975312 975112
module_entry: 49904 49264
reg_proc: 4904 4624
fun_entry: 275864 274368
db_tab: 44912 28272
export_entry: 987192 985656
monitor_sh: 766048 669280
nlink_sh: 1224984 1113944
driver_event_data_state: 56 56
driver_select_data_state: 14312 10248
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120507/9ff028a3/attachment.htm>

From alan.antonuk at gmail.com  Mon May  7 17:18:10 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 7 May 2012 12:18:10 -0400
Subject: [rabbitmq-discuss] immediate, mandatory flag with no consumers
In-Reply-To: <57E70C22-4040-4F88-8B6F-32580537AF02@etrade.com>
References: <fa3b9c55-7577-41c3-80f2-9176d4736a30@u7g2000yqc.googlegroups.com>
	<4F996269.1050005@rabbitmq.com>
	<CAPwx=WNGYvmRaQe5F1_0w5bObzKuhdORGnwKhoT6sX-yUZaTBw@mail.gmail.com>
	<4F99787E.8030501@rabbitmq.com>
	<AC888676-0872-4116-A55E-03FE45C567D8@etrade.com>
	<4FA2A7D1.9070105@rabbitmq.com>
	<A3FFF2F5-B03D-4F0D-930B-1CEB2FA3004A@etrade.com>
	<4FA3A257.6000709@rabbitmq.com>
	<57E70C22-4040-4F88-8B6F-32580537AF02@etrade.com>
Message-ID: <CAAt2poJN9bxc51wUxViKSexiiqmdiKYWssH=bCy-Tr694=W2oQ@mail.gmail.com>

Monish;

As a short answer: there the rabbitmq-c does not provide an easy-to-use
interface to deal with basic.return messages from the broker.

The long answer: it is possible, with a bit of work:

The easy part: reading a basic.return message from the broker, its almost
the same as a basic.deliver of a message:
- Read the method (1 frame), only instead of a basic.deliver, you get a
basic.return method
- Read the message header (1 frame)
- Read message body (1+ frames)

Example code:
https://github.com/alanxz/rabbitmq-c/blob/master/examples/amqp_consumer.c#L75
Note that line 83 will need to compare against AMQP_BASIC_RETURN_METHOD
instead of AMQP_BASIC_DELIVER_METHOD

That's the easy part, the hard part requires a bit more explanation:

As you can already tell the rabbitmq-c client works a bit differently from
the Java and C# clients in that it doesn't have its own internal event loop
that deals the the asynchronous bits of AMQP, so using the library forces
you to think about how you're going to handle these asynchronous messages
from the broker.

The first thing to note is that basic.publish method is an asynchronous[1]
AMQP method: a client sends a basic.publish on a channel, and does wait for
the broker to respond before continuing.  In fact: if all you're doing is
publishing messages to the broker, the broker won't send anything to the
client unless something goes wrong (this is part of what makes AMQP a
high-performance messaging protocol).  Whats more: since the basic.publish
is asynchronous, if something goes wrong on the broker, you won't know
immediately after publishing (e.g., calling the rabbitmq-c
amqp_basic_publish(...) function ). The failure is transmitted as an AMQP
method 'at some point in the future' meaning, likely you'll get an error
pretty quickly, but you have to be able to deal with the case that it might
happen a bit later.

Since rabbitmq-c doesn't have its own thread sitting there dealing with
error messages, and the amqp_basic_publish(...) doesn't do any sort of read
on the socket from the broker (the return value only indicates an error if
there was a failure writing the message to the socket to the broker), you
have to check periodically for methods from the broker.

You do this by using amqp_simple_wait_frame().  However this can block on a
read() on the socket if the broker hasn't sent anything.  The way to get
around this is to use amqp_get_sockfd() on the connection object, then use
something like select(), amqp_frames_enqueued(), and amqp_data_in_buffer()
to detect there is potentially a frame to be read from the broker.

An example of a library that does this is SimpleAmqpClient:
https://github.com/alanxz/SimpleAmqpClient/blob/master/src/Channel.cpp#L283 .
It uses publisher-confirms to make the basic.publish method a synchronous
process.  If you sift through the ChannelImpl::GetMethodOnChannel()
implementation, you can see what needs to be done to poll the socket for
frames.

[1] The AMQP basic.publish method can be made synchronous by enabling
publisher-confirms. However, this does come at a performance cost: there is
a full network round-trip for each basic.publish.

HTH
-Alan

As a personal plug the SimpleAmqpClient library can be found:
https://github.com/alanxz/SimpleAmqpClient. It wraps the rabbitmq-c library
in a (hopefully) easy-to-use synchronous c++ interface.  Since it uses
publisher-confirms and waits for a confirmation before allowing another
message to be sent, it won't have the best message publish through-put (I
can get 3-4k-msg/s, whereas using unconfirmed messages I've seen as high as
20-25k-msg/s over a single connection).

On Fri, May 4, 2012 at 3:43 PM, Unni, Monish <munni at etrade.com> wrote:

> Thanks for your replies Emile!
>
> the only thing close to the c-client for basic.return i found this :
> https://groups.google.com/forum/#!msg/rabbitmq-discuss/fHL9tQHj4s0/FxCQxx4khKQJ
> not sure if it does the same thing as java-api.
>
> or if you could link me to github for this functionality.
>
> kind regards,
> -monish
>
> On May 4, 2012, at 2:33 AM, Emile Joubert wrote:
>
> > Hi,
> >
> > On 04/05/12 05:19, Unni, Monish wrote:
> >> * is it okay to pair request-reply channels and use the same
> >> connection to provide "maximum" concurrency?
> >
> > It is okay to send and receive messages on the same connection. Bear in
> > mind that if the broker decides to block the connection then all
> > channels in that connection will be affected. I'm not sure you will
> > achieve higher concurrency this way.
> >
> >> * how can we get this feature working for "C" clients ( C- api ) ?
> >
> > Have you taken a look at the C client examples?
> >
> >> * and last : is my understanding right ( from observation ) that the
> >> request channel and reply-channels have to share the same connection
> >> for this feature to work?
> >
> > In general requests and their corresponding replies do not have to share
> > a connection, but for basic.return to work the return handler must share
> > a channel with the publisher.
> >
> > -Emile
> >
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120507/5e189b69/attachment.htm>

From bozhidar.bozhanov at gmail.com  Mon May  7 17:44:31 2012
From: bozhidar.bozhanov at gmail.com (Bozhidar Bozhanov)
Date: Mon, 7 May 2012 19:44:31 +0300
Subject: [rabbitmq-discuss] HA Queues lost when a node dies
Message-ID: <CACGcny8FO=oEV41B1jxGpHsa2TmsORxg26GzE_PsrGaOWaq4pg@mail.gmail.com>

Hi,

We are currently trying to run RabbitMQ (2.8.1) in a cluster and use
highly-available queues. We have around 50 queues. Each queue is
registered with one of the nodes (at random), as master, and using
x-ha-policy=all. We have 2 nodes in the cluster.

The management console shows that the cluster is successfully created,
and that the queues are highly-available and properly mirrored. Then
we kill one of the nodes (with kill -9) to simulate system failure. We
have tried this five times, and each time a different result was
observed:
- only 1 queue 'survived' (the metadata about the others was deleted
and they were not visible in the management console, nor we could send
or consume messages to/from them)
- all but 3 queues survived
- only 10 queues survived
- all queues survived
- all but 1 queue survived

The queues that survived properly switched their master node to the
only remaining one.

The results are random, as it seems. Is this expected behaviour? Is it
likely to be fixed in 2.8.2. And how can we make sure that if a node
dies, the queues don't get deleted.

From davidfooks at turbulenz.biz  Mon May  7 12:05:10 2012
From: davidfooks at turbulenz.biz (David Fooks)
Date: Mon, 7 May 2012 12:05:10 +0100
Subject: [rabbitmq-discuss] A cluster on a single machine
In-Reply-To: <4FA40B43.7000201@rabbitmq.com>
References: <26900763.505.1336149989357.JavaMail.geo-discussion-forums@vbbh3>
	<4FA40B43.7000201@rabbitmq.com>
Message-ID: <CAAR1VGeN42CVZaq_DuhEwVCBUw2e-uQtSPHOvfUv7HiyzhUkqg@mail.gmail.com>

Hi Simon,

Yup, I spotted that just after posting. It now reads:

...
rabbitmqctl -n rabbit3 stop_app
rabbitmqctl -n rabbit3 reset
rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64rabbit2@dfooks-ubuntu64
rabbitmqctl -n rabbit3 start_app

However, after that fix I'm still seeing the same error.

Thanks for the tip on RABBITMQ_PID_FILE (it should be documented that it
doesn't work with -detached).

On 4 May 2012 18:00, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 04/05/12 17:46, David Fooks wrote:
>
>> Hi,
>>
>> I'm trying to emulate the guide here:
>> http://www.rabbitmq.com/**clustering.html<http://www.rabbitmq.com/clustering.html>
>>
>> But I'm having a lot of issues! Every time I run I seem to be getting a
>> different crash. Is this feature actually supported in 2.8.1?
>>
>
> Yes! But running a cluster on a single machine is more fiddly than running
> it on separate machines as you need to make sure the nodes don't tread on
> each other. I don't think that's your problem though.
>
>  Is there a proper way to completely reset all of the state that rabbitmq
>> creates about other nodes/the cluster? My clean up script at the moment
>> looks like this:
>>
>> rm /var/run/rabbitmq/*
>> rm -f /var/log/rabbitmq/*
>> rm -rf /var/lib/rabbitmq/*
>>
>
> OK, that should be fine.
>
>  Here is my start-up script (I'm running this with sudo):
>>
>> RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit1
>> RABBITMQ_SERVER_START_ARGS="-**rabbitmq_mochiweb listeners
>> [{mgmt,[{port,55672}]}]" rabbitmq-server -detached
>> RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=rabbit2
>> RABBITMQ_SERVER_START_ARGS="-**rabbitmq_mochiweb listeners
>> [{mgmt,[{port,55673}]}]" rabbitmq-server -detached
>> RABBITMQ_NODE_PORT=5674 RABBITMQ_NODENAME=rabbit3
>> RABBITMQ_SERVER_START_ARGS="-**rabbitmq_mochiweb listeners
>> [{mgmt,[{port,55674}]}]" rabbitmq-server -detached
>>
>> ps -ef | grep rabbit1 | grep -v grep | awk '{print $2}' >
>> /var/run/rabbitmq/rabbit1.pid
>> ps -ef | grep rabbit2 | grep -v grep | awk '{print $2}' >
>> /var/run/rabbitmq/rabbit2.pid
>> ps -ef | grep rabbit3 | grep -v grep | awk '{print $2}' >
>> /var/run/rabbitmq/rabbit3.pid
>>
>
> Ew, those ps'es are not nice. You may prefer to set RABBITMQ_PID_FILE for
> each startup, although this means you cannot use -detached (instead just
> background it with &)
>
>  rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
>> rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid
>> rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid
>>
>> rabbitmqctl -n rabbit1 stop_app
>> rabbitmqctl -n rabbit1 reset
>> rabbitmqctl -n rabbit1 start_app
>>
>> rabbitmqctl -n rabbit2 stop_app
>> rabbitmqctl -n rabbit2 reset
>> rabbitmqctl -n rabbit2 start_app
>>
>> rabbitmqctl -n rabbit3 stop_app
>> rabbitmqctl -n rabbit3 reset
>> rabbitmqctl -n rabbit3 start_app
>>
>
>  rabbitmqctl -n rabbit1 status
>> rabbitmqctl -n rabbit2 status
>> rabbitmqctl -n rabbit3 status
>>
>> rabbitmqctl -n rabbit3 stop_app
>> rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64
>> rabbit2 at dfooks-ubuntu64
>> rabbitmqctl -n rabbit3 start_app
>>
>
> But here's the problem. You need to do:
>
> rabbitmqctl -n rabbit3 stop_app
> rabbitmqctl -n rabbit3 reset
> rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64 \
>    rabbit2 at dfooks-ubuntu64
> rabbitmqctl -n rabbit3 start_app
>
> Instead you are doing something like (considering only rabbit3):
>
> rabbitmqctl -n rabbit3 stop_app
> rabbitmqctl -n rabbit3 reset
> rabbitmqctl -n rabbit3 start_app
> rabbitmqctl -n rabbit3 stop_app
> rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64 \
>    rabbit2 at dfooks-ubuntu64
> rabbitmqctl -n rabbit3 start_app
>
> Clustering can only take place when the state is *completely* reset - the
> fact that you are starting and stopping the app again between reset and
> cluster is recreating a blank database...
>
> <snip>
>
>> {merge_schema_failed, "Incompatible schema cookies.
>>
> <snip>
>
> ...which is exactly what would lead to this error message.
>
> And yes, at some point we hope to make clustering easier to use.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120507/8730068d/attachment.htm>

From francesco at rabbitmq.com  Mon May  7 18:06:15 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 07 May 2012 18:06:15 +0100
Subject: [rabbitmq-discuss] HA Queues lost when a node dies
In-Reply-To: <CACGcny8FO=oEV41B1jxGpHsa2TmsORxg26GzE_PsrGaOWaq4pg@mail.gmail.com>
References: <CACGcny8FO=oEV41B1jxGpHsa2TmsORxg26GzE_PsrGaOWaq4pg@mail.gmail.com>
Message-ID: <4FA80107.5080807@rabbitmq.com>

Hi Bozhidar,

It's hard to tell what happened without looking at the logs and without 
knowing your setup; but a number of severe bugs related to HA were fixed 
in 2.8.2,  so it's definitely worth a try.

If the situation does not improve, please post more details on the list.

Francesco.

On 07/05/12 17:44, Bozhidar Bozhanov wrote:
> Hi,
>
> We are currently trying to run RabbitMQ (2.8.1) in a cluster and use
> highly-available queues. We have around 50 queues. Each queue is
> registered with one of the nodes (at random), as master, and using
> x-ha-policy=all. We have 2 nodes in the cluster.
>
> The management console shows that the cluster is successfully created,
> and that the queues are highly-available and properly mirrored. Then
> we kill one of the nodes (with kill -9) to simulate system failure. We
> have tried this five times, and each time a different result was
> observed:
> - only 1 queue 'survived' (the metadata about the others was deleted
> and they were not visible in the management console, nor we could send
> or consume messages to/from them)
> - all but 3 queues survived
> - only 10 queues survived
> - all queues survived
> - all but 1 queue survived
>
> The queues that survived properly switched their master node to the
> only remaining one.
>
> The results are random, as it seems. Is this expected behaviour? Is it
> likely to be fixed in 2.8.2. And how can we make sure that if a node
> dies, the queues don't get deleted.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From pablomolnar at gmail.com  Mon May  7 18:32:44 2012
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Mon, 7 May 2012 14:32:44 -0300
Subject: [rabbitmq-discuss] Queues with high memory consumption
Message-ID: <CANVSfp+9KMvWHp5FL+jsH1fFh6zAJG3F5Vi0Z=RGi=5qN_ea2w@mail.gmail.com>

Hello,

I'm trying to figure out why the memory consumption of some queues are
extremely high although there is almost none messages ready to consume.
For instance this queue has only 3 messages but consumes 2.4GB of RAM.

{
   "exclusive_consumer_tag":"",
   "messages_ready":0,
   "messages_unacknowledged":3,
   "messages":3,
   "consumers":25,
   "memory":2586777216,
   "slave_nodes":[

   ],
   "backing_queue_status":{
      "q1":0,
      "q2":0,
      "delta":[
         "delta",
         "undefined",
         0,
         "undefined"
      ],
      "q3":0,
      "q4":0,
      "len":0,
      "pending_acks":3,
      "target_ram_count":0,
      "ram_msg_count":0,
      "ram_ack_count":0,
      "next_seq_id":72528926,
      "persistent_count":3,
      "avg_ingress_rate":42.456013780009044,
      "avg_egress_rate":42.456013780009044,
      "avg_ack_ingress_rate":42.456013780009044,
      "avg_ack_egress_rate":42.456013780009044
   },
   "messages_details":{
      "rate":0.0,
      "interval":5035424,
      "last_event":1336411139483
   },
   "messages_ready_details":{
      "rate":0.0,
      "interval":5035424,
      "last_event":1336411139483
   },
   "messages_unacknowledged_details":{
      "rate":0.0,
      "interval":5035424,
      "last_event":1336411139483
   },
   "incoming":[
      {
         "stats":{
            "publish":1734006,
            "publish_details":{
               "rate":102.09667507804102,
               "interval":13252280,
               "last_event":1336411142499
            }
         },
         "exchange":{
            "name":"items_feed_ex",
            "vhost":"items"
         }
      }
   ],
   "deliveries":[
      {
         "stats":{
            "ack":49131,
            "ack_details":{
               "rate":1.175108844456718,
               "interval":5105910,
               "last_event":1336411141663
            },
            "deliver":49153,
            "deliver_details":{
               "rate":0.9792573703805982,
               "interval":5105910,
               "last_event":1336411141663
            },
            "deliver_get":49153,
            "deliver_get_details":{
               "rate":0.9792573703805982,
               "interval":5105910,
               "last_event":1336411141663
            },
            "redeliver":24,
            "redeliver_details":{
               "rate":0.0,
               "interval":5105910,
               "last_event":1336411141663
            }
         },
         "channel_details":{
            "name":"172.16.151.171:45194:49",
            "number":49,
            "connection_name":"172.16.151.171:45194",
            "peer_address":"172.16.151.171",
            "peer_port":45194
         }
      },
      {
         "stats":{
            "ack":40909,
            "ack_details":{
               "rate":1.3173608970399655,
               "interval":5313654,
               "last_event":1336411141077
            },
            "deliver":40929,
            "deliver_details":{
               "rate":1.3173608970399655,
               "interval":5313654,
               "last_event":1336411141077
            },
            "deliver_get":40929,
            "deliver_get_details":{
               "rate":1.3173608970399655,
               "interval":5313654,
               "last_event":1336411141077
            },
            "redeliver":23,
            "redeliver_details":{
               "rate":0.0,
               "interval":5313654,
               "last_event":1336411141077
            }
         },
         "channel_details":{
            "name":"172.16.151.171:36273:49",
            "number":49,
            "connection_name":"172.16.151.171:36273",
            "peer_address":"172.16.151.171",
            "peer_port":36273
         }
      },
      {
         "stats":{
            "ack":23080,
            "ack_details":{
               "rate":0,
               "interval":5059374,
               "last_event":1335489316168
            },
            "deliver":23091,
            "deliver_details":{
               "rate":0,
               "interval":5059374,
               "last_event":1335489316168
            },
            "deliver_get":23091,
            "deliver_get_details":{
               "rate":0,
               "interval":5059374,
               "last_event":1335489316168
            },
            "redeliver":10,
            "redeliver_details":{
               "rate":0,
               "interval":5059374,
               "last_event":1335489316168
            }
         },
         "channel_details":{
            "name":"172.16.158.120:35852:46",
            "number":46,
            "connection_name":"unknown",
            "peer_address":"unknown",
            "peer_port":"unknown"
         }
      },
      {
         "stats":{
            "ack":43723,
            "ack_details":{
               "rate":1.0083279485819967,
               "interval":5950445,
               "last_event":1336411141292
            },
            "deliver":43744,
            "deliver_details":{
               "rate":1.0083279485819967,
               "interval":5950445,
               "last_event":1336411141292
            },
            "deliver_get":43744,
            "deliver_get_details":{
               "rate":1.0083279485819967,
               "interval":5950445,
               "last_event":1336411141292
            },
            "redeliver":23,
            "redeliver_details":{
               "rate":0.0,
               "interval":5950445,
               "last_event":1336411141292
            }
         },
         "channel_details":{
            "name":"172.16.151.171:36331:47",
            "number":47,
            "connection_name":"172.16.151.171:36331",
            "peer_address":"172.16.151.171",
            "peer_port":36331
         }
      },
      {
         "stats":{
            "ack":43757,
            "ack_details":{
               "rate":1.331257079434969,
               "interval":5258188,
               "last_event":1336411141021
            },
            "deliver":43785,
            "deliver_details":{
               "rate":1.331257079434969,
               "interval":5258188,
               "last_event":1336411141021
            },
            "deliver_get":43785,
            "deliver_get_details":{
               "rate":1.331257079434969,
               "interval":5258188,
               "last_event":1336411141021
            },
            "redeliver":28,
            "redeliver_details":{
               "rate":0.0,
               "interval":5258188,
               "last_event":1336411141021
            }
         },
         "channel_details":{
            "name":"172.16.151.171:36331:50",
            "number":50,
            "connection_name":"172.16.151.171:36331",
            "peer_address":"172.16.151.171",
            "peer_port":36331
         }
      },
      {
         "stats":{
            "ack":48273,
            "ack_details":{
               "rate":1.0928432247180737,
               "interval":5490266,
               "last_event":1336411141855
            },
            "deliver":48294,
            "deliver_details":{
               "rate":1.0928432247180737,
               "interval":5490266,
               "last_event":1336411141855
            },
            "deliver_get":48294,
            "deliver_get_details":{
               "rate":1.0928432247180737,
               "interval":5490266,
               "last_event":1336411141855
            },
            "redeliver":23,
            "redeliver_details":{
               "rate":0.0,
               "interval":5490266,
               "last_event":1336411141855
            }
         },
         "channel_details":{
            "name":"172.16.151.171:54223:47",
            "number":47,
            "connection_name":"172.16.151.171:54223",
            "peer_address":"172.16.151.171",
            "peer_port":54223
         }
      },
      {
         "stats":{
            "ack":32942,
            "ack_details":{
               "rate":0,
               "interval":6038414,
               "last_event":1336251911407
            },
            "deliver":32953,
            "deliver_details":{
               "rate":0,
               "interval":6038414,
               "last_event":1336251911407
            },
            "deliver_get":32953,
            "deliver_get_details":{
               "rate":0,
               "interval":6038414,
               "last_event":1336251911407
            },
            "redeliver":12,
            "redeliver_details":{
               "rate":0,
               "interval":6038414,
               "last_event":1336251911407
            }
         },
         "channel_details":{
            "name":"172.16.151.171:33574:18",
            "number":18,
            "connection_name":"172.16.151.171:33574",
            "peer_address":"172.16.151.171",
            "peer_port":33574
         }
      },
      {
         "stats":{
            "ack":47480,
            "ack_details":{
               "rate":1.1202831179495683,
               "interval":5355789,
               "last_event":1336411141566
            },
            "deliver":47506,
            "deliver_details":{
               "rate":1.1202831179495683,
               "interval":5355789,
               "last_event":1336411141566
            },
            "deliver_get":47506,
            "deliver_get_details":{
               "rate":1.1202831179495683,
               "interval":5355789,
               "last_event":1336411141566
            },
            "redeliver":24,
            "redeliver_details":{
               "rate":0.0,
               "interval":5355789,
               "last_event":1336411141566
            }
         },
         "channel_details":{
            "name":"172.16.151.171:37028:48",
            "number":48,
            "connection_name":"172.16.151.171:37028",
            "peer_address":"172.16.151.171",
            "peer_port":37028
         }
      },
      {
         "stats":{
            "ack":49126,
            "ack_details":{
               "rate":1.3996433708691025,
               "interval":5001274,
               "last_event":1336411140664
            },
            "deliver":49150,
            "deliver_details":{
               "rate":1.3996433708691025,
               "interval":5001274,
               "last_event":1336411140664
            },
            "deliver_get":49150,
            "deliver_get_details":{
               "rate":1.3996433708691025,
               "interval":5001274,
               "last_event":1336411140664
            },
            "redeliver":23,
            "redeliver_details":{
               "rate":0.0,
               "interval":5001274,
               "last_event":1336411140664
            }
         },
         "channel_details":{
            "name":"172.16.151.171:45194:48",
            "number":48,
            "connection_name":"172.16.151.171:45194",
            "peer_address":"172.16.151.171",
            "peer_port":45194
         }
      },
      {
         "stats":{
            "ack":40918,
            "ack_details":{
               "rate":1.109675109321493,
               "interval":5406988,
               "last_event":1336411141761
            },
            "deliver":40942,
            "deliver_details":{
               "rate":1.109675109321493,
               "interval":5406988,
               "last_event":1336411141761
            },
            "deliver_get":40942,
            "deliver_get_details":{
               "rate":1.109675109321493,
               "interval":5406988,
               "last_event":1336411141761
            },
            "redeliver":24,
            "redeliver_details":{
               "rate":0.0,
               "interval":5406988,
               "last_event":1336411141761
            }
         },
         "channel_details":{
            "name":"172.16.151.171:36273:48",
            "number":48,
            "connection_name":"172.16.151.171:36273",
            "peer_address":"172.16.151.171",
            "peer_port":36273
         }
      },
      {
         "stats":{
            "ack":32993,
            "ack_details":{
               "rate":0,
               "interval":7659109,
               "last_event":1336251913994
            },
            "deliver":33002,
            "deliver_details":{
               "rate":0,
               "interval":7659109,
               "last_event":1336251913994
            },
            "deliver_get":33002,
            "deliver_get_details":{
               "rate":0,
               "interval":7659109,
               "last_event":1336251913994
            },
            "redeliver":8,
            "redeliver_details":{
               "rate":0,
               "interval":7659109,
               "last_event":1336251913994
            }
         },
         "channel_details":{
            "name":"172.16.151.171:33574:20",
            "number":20,
            "connection_name":"172.16.151.171:33574",
            "peer_address":"172.16.151.171",
            "peer_port":33574
         }
      },
      {
         "stats":{
            "ack":43713,
            "ack_details":{
               "rate":1.080307152929721,
               "interval":5553976,
               "last_event":1336411141955
            },
            "deliver":43736,
            "deliver_details":{
               "rate":1.080307152929721,
               "interval":5553976,
               "last_event":1336411141955
            },
            "deliver_get":43736,
            "deliver_get_details":{
               "rate":1.080307152929721,
               "interval":5553976,
               "last_event":1336411141955
            },
            "redeliver":18,
            "redeliver_details":{
               "rate":0.0,
               "interval":5553976,
               "last_event":1336411141955
            }
         },
         "channel_details":{
            "name":"172.16.151.171:36331:46",
            "number":46,
            "connection_name":"172.16.151.171:36331",
            "peer_address":"172.16.151.171",
            "peer_port":36331
         }
      },
      {
         "stats":{
            "ack":43756,
            "ack_details":{
               "rate":1.0079945729572193,
               "interval":5952413,
               "last_event":1336411141306
            },
            "deliver":43778,
            "deliver_details":{
               "rate":1.0079945729572193,
               "interval":5952413,
               "last_event":1336411141306
            },
            "deliver_get":43778,
            "deliver_get_details":{
               "rate":1.0079945729572193,
               "interval":5952413,
               "last_event":1336411141306
            },
            "redeliver":21,
            "redeliver_details":{
               "rate":0.0,
               "interval":5952413,
               "last_event":1336411141306
            }
         },
         "channel_details":{
            "name":"172.16.151.171:36331:49",
            "number":49,
            "connection_name":"172.16.151.171:36331",
            "peer_address":"172.16.151.171",
            "peer_port":36331
         }
      },
      {
         "stats":{
            "ack":48197,
            "ack_details":{
               "rate":1.0859767818164048,
               "interval":5524980,
               "last_event":1336411141929
            },
            "deliver":48218,
            "deliver_details":{
               "rate":1.0859767818164048,
               "interval":5524980,
               "last_event":1336411141929
            },
            "deliver_get":48218,
            "deliver_get_details":{
               "rate":1.0859767818164048,
               "interval":5524980,
               "last_event":1336411141929
            },
            "redeliver":28,
            "redeliver_details":{
               "rate":0.0,
               "interval":5524980,
               "last_event":1336411141929
            }
         },
         "channel_details":{
            "name":"172.16.151.171:54223:46",
            "number":46,
            "connection_name":"172.16.151.171:54223",
            "peer_address":"172.16.151.171",
            "peer_port":54223
         }
      },
      {
         "stats":{
            "ack":48177,
            "ack_details":{
               "rate":1.2549852046208556,
               "interval":5577755,
               "last_event":1336411140980
            },
            "deliver":48201,
            "deliver_details":{
               "rate":1.2549852046208556,
               "interval":5577755,
               "last_event":1336411140980
            },
            "deliver_get":48201,
            "deliver_get_details":{
               "rate":1.2549852046208556,
               "interval":5577755,
               "last_event":1336411140980
            },
            "redeliver":26,
            "redeliver_details":{
               "rate":0.0,
               "interval":5577755,
               "last_event":1336411140980
            }
         },
         "channel_details":{
            "name":"172.16.151.171:54223:50",
            "number":50,
            "connection_name":"172.16.151.171:54223",
            "peer_address":"172.16.151.171",
            "peer_port":54223
         }
      },
      {
         "stats":{
            "ack":30521,
            "ack_details":{
               "rate":0,
               "interval":10018546,
               "last_event":1336251916943
            },
            "deliver":30532,
            "deliver_details":{
               "rate":0,
               "interval":10018546,
               "last_event":1336251916943
            },
            "deliver_get":30532,
            "deliver_get_details":{
               "rate":0,
               "interval":10018546,
               "last_event":1336251916943
            },
            "redeliver":12,
            "redeliver_details":{
               "rate":0,
               "interval":10018546,
               "last_event":1336251916943
            }
         },
         "channel_details":{
            "name":"172.16.151.171:33574:17",
            "number":17,
            "connection_name":"172.16.151.171:33574",
            "peer_address":"172.16.151.171",
            "peer_port":33574
         }
      },
      {
         "stats":{
            "ack":47417,
            "ack_details":{
               "rate":1.3417528966528247,
               "interval":5217056,
               "last_event":1336411140740
            },
            "deliver":47442,
            "deliver_details":{
               "rate":1.3417528966528247,
               "interval":5217056,
               "last_event":1336411140740
            },
            "deliver_get":47442,
            "deliver_get_details":{
               "rate":1.3417528966528247,
               "interval":5217056,
               "last_event":1336411140740
            },
            "redeliver":25,
            "redeliver_details":{
               "rate":0.0,
               "interval":5217056,
               "last_event":1336411140740
            }
         },
         "channel_details":{
            "name":"172.16.151.171:37028:49",
            "number":49,
            "connection_name":"172.16.151.171:37028",
            "peer_address":"172.16.151.171",
            "peer_port":37028
         }
      },
      {
         "stats":{
            "ack":49175,
            "ack_details":{
               "rate":1.1231077739835453,
               "interval":5342319,
               "last_event":1336411141704
            },
            "deliver":49200,
            "deliver_details":{
               "rate":1.1231077739835453,
               "interval":5342319,
               "last_event":1336411141704
            },
            "deliver_get":49200,
            "deliver_get_details":{
               "rate":1.1231077739835453,
               "interval":5342319,
               "last_event":1336411141704
            },
            "redeliver":23,
            "redeliver_details":{
               "rate":0.0,
               "interval":5342319,
               "last_event":1336411141704
            }
         },
         "channel_details":{
            "name":"172.16.151.171:45194:47",
            "number":47,
            "connection_name":"172.16.151.171:45194",
            "peer_address":"172.16.151.171",
            "peer_port":45194
         }
      },
      {
         "stats":{
            "ack":40909,
            "ack_details":{
               "rate":1.3533183656322094,
               "interval":5172471,
               "last_event":1336411140765
            },
            "deliver":40927,
            "deliver_details":{
               "rate":1.3533183656322094,
               "interval":5172471,
               "last_event":1336411140765
            },
            "deliver_get":40927,
            "deliver_get_details":{
               "rate":1.3533183656322094,
               "interval":5172471,
               "last_event":1336411140765
            },
            "redeliver":19,
            "redeliver_details":{
               "rate":0.0,
               "interval":5172471,
               "last_event":1336411140765
            }
         },
         "channel_details":{
            "name":"172.16.151.171:36273:47",
            "number":47,
            "connection_name":"172.16.151.171:36273",
            "peer_address":"172.16.151.171",
            "peer_port":36273
         }
      },
      {
         "stats":{
            "ack":26779,
            "ack_details":{
               "rate":0,
               "interval":5053059,
               "last_event":1335489316759
            },
            "deliver":26793,
            "deliver_details":{
               "rate":0,
               "interval":5053059,
               "last_event":1335489316759
            },
            "deliver_get":26793,
            "deliver_get_details":{
               "rate":0,
               "interval":5053059,
               "last_event":1335489316759
            },
            "redeliver":14,
            "redeliver_details":{
               "rate":0,
               "interval":5053059,
               "last_event":1335489316759
            }
         },
         "channel_details":{
            "name":"172.16.158.120:35852:48",
            "number":48,
            "connection_name":"unknown",
            "peer_address":"unknown",
            "peer_port":"unknown"
         }
      },
      {
         "stats":{
            "ack":32934,
            "ack_details":{
               "rate":0,
               "interval":6831513,
               "last_event":1336251912217
            },
            "deliver":32948,
            "deliver_details":{
               "rate":0,
               "interval":6831513,
               "last_event":1336251912217
            },
            "deliver_get":32948,
            "deliver_get_details":{
               "rate":0,
               "interval":6831513,
               "last_event":1336251912217
            },
            "redeliver":13,
            "redeliver_details":{
               "rate":0,
               "interval":6831513,
               "last_event":1336251912217
            }
         },
         "channel_details":{
            "name":"172.16.151.171:33574:19",
            "number":19,
            "connection_name":"172.16.151.171:33574",
            "peer_address":"172.16.151.171",
            "peer_port":33574
         }
      },
      {
         "stats":{
            "ack":48244,
            "ack_details":{
               "rate":1.0902719756127965,
               "interval":5503214,
               "last_event":1336411141854
            },
            "deliver":48264,
            "deliver_details":{
               "rate":1.0902719756127965,
               "interval":5503214,
               "last_event":1336411141854
            },
            "deliver_get":48264,
            "deliver_get_details":{
               "rate":1.0902719756127965,
               "interval":5503214,
               "last_event":1336411141854
            },
            "redeliver":23,
            "redeliver_details":{
               "rate":0.0,
               "interval":5503214,
               "last_event":1336411141854
            }
         },
         "channel_details":{
            "name":"172.16.151.171:54223:49",
            "number":49,
            "connection_name":"172.16.151.171:54223",
            "peer_address":"172.16.151.171",
            "peer_port":54223
         }
      },
      {
         "stats":{
            "ack":47451,
            "ack_details":{
               "rate":1.0455790564938563,
               "interval":5738447,
               "last_event":1336411142260
            },
            "deliver":47471,
            "deliver_details":{
               "rate":1.0455790564938563,
               "interval":5738447,
               "last_event":1336411142260
            },
            "deliver_get":47471,
            "deliver_get_details":{
               "rate":1.0455790564938563,
               "interval":5738447,
               "last_event":1336411142260
            },
            "redeliver":15,
            "redeliver_details":{
               "rate":0.0,
               "interval":5738447,
               "last_event":1336411142260
            }
         },
         "channel_details":{
            "name":"172.16.151.171:37028:47",
            "number":47,
            "connection_name":"172.16.151.171:37028",
            "peer_address":"172.16.151.171",
            "peer_port":37028
         }
      },
      {
         "stats":{
            "ack":49218,
            "ack_details":{
               "rate":1.382819846230433,
               "interval":5062120,
               "last_event":1336411140624
            },
            "deliver":49239,
            "deliver_details":{
               "rate":1.382819846230433,
               "interval":5062120,
               "last_event":1336411140624
            },
            "deliver_get":49239,
            "deliver_get_details":{
               "rate":1.382819846230433,
               "interval":5062120,
               "last_event":1336411140624
            },
            "redeliver":27,
            "redeliver_details":{
               "rate":0.0,
               "interval":5062120,
               "last_event":1336411140624
            }
         },
         "channel_details":{
            "name":"172.16.151.171:45194:46",
            "number":46,
            "connection_name":"172.16.151.171:45194",
            "peer_address":"172.16.151.171",
            "peer_port":45194
         }
      },
      {
         "stats":{
            "ack":49108,
            "ack_details":{
               "rate":1.104551303646676,
               "interval":5432070,
               "last_event":1336411141703
            },
            "deliver":49129,
            "deliver_details":{
               "rate":1.104551303646676,
               "interval":5432070,
               "last_event":1336411141703
            },
            "deliver_get":49129,
            "deliver_get_details":{
               "rate":1.104551303646676,
               "interval":5432070,
               "last_event":1336411141703
            },
            "redeliver":22,
            "redeliver_details":{
               "rate":0.0,
               "interval":5432070,
               "last_event":1336411141703
            }
         },
         "channel_details":{
            "name":"172.16.151.171:45194:50",
            "number":50,
            "connection_name":"172.16.151.171:45194",
            "peer_address":"172.16.151.171",
            "peer_port":45194
         }
      },
      {
         "stats":{
            "ack":32352,
            "ack_details":{
               "rate":0,
               "interval":6799028,
               "last_event":1336251913770
            },
            "deliver":32364,
            "deliver_details":{
               "rate":0,
               "interval":6799028,
               "last_event":1336251913770
            },
            "deliver_get":32364,
            "deliver_get_details":{
               "rate":0,
               "interval":6799028,
               "last_event":1336251913770
            },
            "redeliver":10,
            "redeliver_details":{
               "rate":0,
               "interval":6799028,
               "last_event":1336251913770
            }
         },
         "channel_details":{
            "name":"172.16.151.171:33574:2",
            "number":2,
            "connection_name":"172.16.151.171:33574",
            "peer_address":"172.16.151.171",
            "peer_port":33574
         }
      },
      {
         "stats":{
            "ack":40890,
            "ack_details":{
               "rate":1.120705596243395,
               "interval":5353770,
               "last_event":1336411141647
            },
            "deliver":40915,
            "deliver_details":{
               "rate":1.120705596243395,
               "interval":5353770,
               "last_event":1336411141647
            },
            "deliver_get":40915,
            "deliver_get_details":{
               "rate":1.120705596243395,
               "interval":5353770,
               "last_event":1336411141647
            },
            "redeliver":27,
            "redeliver_details":{
               "rate":0.0,
               "interval":5353770,
               "last_event":1336411141647
            }
         },
         "channel_details":{
            "name":"172.16.151.171:36273:46",
            "number":46,
            "connection_name":"172.16.151.171:36273",
            "peer_address":"172.16.151.171",
            "peer_port":36273
         }
      },
      {
         "stats":{
            "ack":40855,
            "ack_details":{
               "rate":1.0549101849468536,
               "interval":5687688,
               "last_event":1336411142163
            },
            "deliver":40876,
            "deliver_details":{
               "rate":1.0549101849468536,
               "interval":5687688,
               "last_event":1336411142163
            },
            "deliver_get":40876,
            "deliver_get_details":{
               "rate":1.0549101849468536,
               "interval":5687688,
               "last_event":1336411142163
            },
            "redeliver":27,
            "redeliver_details":{
               "rate":0.0,
               "interval":5687688,
               "last_event":1336411142163
            }
         },
         "channel_details":{
            "name":"172.16.151.171:36273:50",
            "number":50,
            "connection_name":"172.16.151.171:36273",
            "peer_address":"172.16.151.171",
            "peer_port":36273
         }
      },
      {
         "stats":{
            "ack":43743,
            "ack_details":{
               "rate":1.256502851004969,
               "interval":5571018,
               "last_event":1336411140786
            },
            "deliver":43772,
            "deliver_details":{
               "rate":1.256502851004969,
               "interval":5571018,
               "last_event":1336411140786
            },
            "deliver_get":43772,
            "deliver_get_details":{
               "rate":1.256502851004969,
               "interval":5571018,
               "last_event":1336411140786
            },
            "redeliver":27,
            "redeliver_details":{
               "rate":0.0,
               "interval":5571018,
               "last_event":1336411140786
            }
         },
         "channel_details":{
            "name":"172.16.151.171:36331:48",
            "number":48,
            "connection_name":"172.16.151.171:36331",
            "peer_address":"172.16.151.171",
            "peer_port":36331
         }
      },
      {
         "stats":{
            "ack":48130,
            "ack_details":{
               "rate":1.1080557499783006,
               "interval":5414890,
               "last_event":1336411141739
            },
            "deliver":48153,
            "deliver_details":{
               "rate":1.1080557499783006,
               "interval":5414890,
               "last_event":1336411141739
            },
            "deliver_get":48153,
            "deliver_get_details":{
               "rate":1.1080557499783006,
               "interval":5414890,
               "last_event":1336411141739
            },
            "redeliver":28,
            "redeliver_details":{
               "rate":0.0,
               "interval":5414890,
               "last_event":1336411141739
            }
         },
         "channel_details":{
            "name":"172.16.151.171:54223:48",
            "number":48,
            "connection_name":"172.16.151.171:54223",
            "peer_address":"172.16.151.171",
            "peer_port":54223
         }
      },
      {
         "stats":{
            "ack":47426,
            "ack_details":{
               "rate":1.3911343010990955,
               "interval":5031865,
               "last_event":1336411140418
            },
            "deliver":47448,
            "deliver_details":{
               "rate":1.3911343010990955,
               "interval":5031865,
               "last_event":1336411140418
            },
            "deliver_get":47448,
            "deliver_get_details":{
               "rate":1.3911343010990955,
               "interval":5031865,
               "last_event":1336411140418
            },
            "redeliver":22,
            "redeliver_details":{
               "rate":0.0,
               "interval":5031865,
               "last_event":1336411140418
            }
         },
         "channel_details":{
            "name":"172.16.151.171:37028:46",
            "number":46,
            "connection_name":"172.16.151.171:37028",
            "peer_address":"172.16.151.171",
            "peer_port":37028
         }
      },
      {
         "stats":{
            "ack":47457,
            "ack_details":{
               "rate":1.1238103764783491,
               "interval":5338979,
               "last_event":1336411139488
            },
            "deliver":47477,
            "deliver_details":{
               "rate":1.1238103764783491,
               "interval":5338979,
               "last_event":1336411139488
            },
            "deliver_get":47477,
            "deliver_get_details":{
               "rate":1.1238103764783491,
               "interval":5338979,
               "last_event":1336411139488
            },
            "redeliver":17,
            "redeliver_details":{
               "rate":0.0,
               "interval":5338979,
               "last_event":1336411139488
            }
         },
         "channel_details":{
            "name":"172.16.151.171:37028:50",
            "number":50,
            "connection_name":"172.16.151.171:37028",
            "peer_address":"172.16.151.171",
            "peer_port":37028
         }
      }
   ],
   "message_stats":{
      "ack":1358784,
      "ack_details":{
         "rate":29.480283582699396,
         "interval":10018546,
         "last_event":1336411142260
      },
      "deliver":1359432,
      "deliver_details":{
         "rate":29.284432108623275,
         "interval":10018546,
         "last_event":1336411142260
      },
      "deliver_get":1359432,
      "deliver_get_details":{
         "rate":29.284432108623275,
         "interval":10018546,
         "last_event":1336411142260
      },
      "redeliver":666,
      "redeliver_details":{
         "rate":0.0,
         "interval":10018546,
         "last_event":1336411142260
      },
      "publish":1734006,
      "publish_details":{
         "rate":102.09667507804099,
         "interval":13252280,
         "last_event":1336411142499
      }
   },
   "consumer_details":[
      {
         "channel_details":{
            "name":"172.16.151.171:54223:46",
            "number":46,
            "connection_name":"172.16.151.171:54223",
            "peer_address":"172.16.151.171",
            "peer_port":54223
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-wFzKNbMZrteA6PKaJySWAc",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:54223:47",
            "number":47,
            "connection_name":"172.16.151.171:54223",
            "peer_address":"172.16.151.171",
            "peer_port":54223
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-wkAxxLU80XJR8wqEpSCubc",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:54223:48",
            "number":48,
            "connection_name":"172.16.151.171:54223",
            "peer_address":"172.16.151.171",
            "peer_port":54223
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-AEOLa3Q5gk53J1gWU3yeKv",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:54223:49",
            "number":49,
            "connection_name":"172.16.151.171:54223",
            "peer_address":"172.16.151.171",
            "peer_port":54223
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-AXU5FGdQusfKxM_2yHr6Ra",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:54223:50",
            "number":50,
            "connection_name":"172.16.151.171:54223",
            "peer_address":"172.16.151.171",
            "peer_port":54223
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-ANrmI0q3PIectJFt95zSx7",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:45194:46",
            "number":46,
            "connection_name":"172.16.151.171:45194",
            "peer_address":"172.16.151.171",
            "peer_port":45194
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-AH6alSt2nC60fKRCgPw_C2",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:45194:47",
            "number":47,
            "connection_name":"172.16.151.171:45194",
            "peer_address":"172.16.151.171",
            "peer_port":45194
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-Q3mfQAZHq8MuQiVQHrHuh3",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:45194:48",
            "number":48,
            "connection_name":"172.16.151.171:45194",
            "peer_address":"172.16.151.171",
            "peer_port":45194
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-AuF42epadwStjdibAL0WU4",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:45194:49",
            "number":49,
            "connection_name":"172.16.151.171:45194",
            "peer_address":"172.16.151.171",
            "peer_port":45194
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-wByt8dne0DKkZbRqkwwV5d",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:45194:50",
            "number":50,
            "connection_name":"172.16.151.171:45194",
            "peer_address":"172.16.151.171",
            "peer_port":45194
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-AtmHCcgeDc22WL5GT6oyAi",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:37028:46",
            "number":46,
            "connection_name":"172.16.151.171:37028",
            "peer_address":"172.16.151.171",
            "peer_port":37028
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-gqrMfHul8Qlg6bNhJnBibY",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:37028:47",
            "number":47,
            "connection_name":"172.16.151.171:37028",
            "peer_address":"172.16.151.171",
            "peer_port":37028
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-w7sbfc0wThZXnM9GByVnLr",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:37028:49",
            "number":49,
            "connection_name":"172.16.151.171:37028",
            "peer_address":"172.16.151.171",
            "peer_port":37028
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-wftXOf1wQo0QLudxc6h5Dc",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:37028:48",
            "number":48,
            "connection_name":"172.16.151.171:37028",
            "peer_address":"172.16.151.171",
            "peer_port":37028
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-AsKyOqupPEQ-z66rC_cO_e",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:37028:50",
            "number":50,
            "connection_name":"172.16.151.171:37028",
            "peer_address":"172.16.151.171",
            "peer_port":37028
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-AN9CBjslXtNJulkwO1AsLo",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:36273:46",
            "number":46,
            "connection_name":"172.16.151.171:36273",
            "peer_address":"172.16.151.171",
            "peer_port":36273
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-Q40Ykqv5lxO5jXQIH8qeii",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:36273:47",
            "number":47,
            "connection_name":"172.16.151.171:36273",
            "peer_address":"172.16.151.171",
            "peer_port":36273
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-QLqO0WzKhJgYWqnTkxCVsy",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:36273:48",
            "number":48,
            "connection_name":"172.16.151.171:36273",
            "peer_address":"172.16.151.171",
            "peer_port":36273
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-Ac2ptOPwhFCnAwNlwyl8b5",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:36273:49",
            "number":49,
            "connection_name":"172.16.151.171:36273",
            "peer_address":"172.16.151.171",
            "peer_port":36273
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-gvU8OiS2W-SJ6dQACeZqYX",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:36273:50",
            "number":50,
            "connection_name":"172.16.151.171:36273",
            "peer_address":"172.16.151.171",
            "peer_port":36273
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-QApQVB-d0PDpVZYDZTWsLC",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:36331:46",
            "number":46,
            "connection_name":"172.16.151.171:36331",
            "peer_address":"172.16.151.171",
            "peer_port":36331
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-QyyT1kYbrmOypBx_cCb9El",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:36331:47",
            "number":47,
            "connection_name":"172.16.151.171:36331",
            "peer_address":"172.16.151.171",
            "peer_port":36331
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-AWNIHoLnIrSs-rRbGlYefk",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:36331:48",
            "number":48,
            "connection_name":"172.16.151.171:36331",
            "peer_address":"172.16.151.171",
            "peer_port":36331
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-ADQz44E00QKduPSM3r6EfX",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:36331:49",
            "number":49,
            "connection_name":"172.16.151.171:36331",
            "peer_address":"172.16.151.171",
            "peer_port":36331
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-AtN-iVuD_KU5S8AJS8P_ET",
         "exclusive":false,
         "ack_required":true
      },
      {
         "channel_details":{
            "name":"172.16.151.171:36331:50",
            "number":50,
            "connection_name":"172.16.151.171:36331",
            "peer_address":"172.16.151.171",
            "peer_port":36331
         },
         "queue_details":{
            "name":"items_bigqueue",
            "vhost":"items"
         },
         "consumer_tag":"amq.ctag-wuYNkpbMVPjTEFDIG4Xt4q",
         "exclusive":false,
         "ack_required":true
      }
   ],
   "name":"items_bigqueue",
   "vhost":"items",
   "durable":true,
   "auto_delete":false,
   "arguments":{

   },
   "node":"rabbit at i-00000007-asm"
}

Cheers,
Pablo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120507/5771052a/attachment.htm>

From pablomolnar at gmail.com  Mon May  7 19:28:58 2012
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Mon, 7 May 2012 15:28:58 -0300
Subject: [rabbitmq-discuss] Queues with high memory consumption
In-Reply-To: <CANVSfp+9KMvWHp5FL+jsH1fFh6zAJG3F5Vi0Z=RGi=5qN_ea2w@mail.gmail.com>
References: <CANVSfp+9KMvWHp5FL+jsH1fFh6zAJG3F5Vi0Z=RGi=5qN_ea2w@mail.gmail.com>
Message-ID: <CANVSfp+7HTWCoezKabcZSZ3qvggKODUVpz7=FrEZymsBW+KPqQ@mail.gmail.com>

My apologies, I haven't specified my environment:

rabbitmqctl status
Status of node 'rabbit at i-00000140-csm' ...
[{pid,20106},
 {running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","2.7.1"},
      {rabbitmq_management,"RabbitMQ Management Console","2.7.1"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
      {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
      {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {os_mon,"CPO  CXC 138 46","2.2.8"},
      {sasl,"SASL  CXC 138 11","2.2"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
      {inets,"INETS  CXC 138 49","5.8"},
      {mnesia,"MNESIA  CXC 138 12","4.6"},
      {stdlib,"ERTS  CXC 138 10","1.18"},
      {kernel,"ERTS  CXC 138 10","2.15"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R15B (erts-5.9) [source] [64-bit] [smp:4:4] [async-threads:0]
[hipe] [kernel-poll:false]\n"},
 {memory,
     [{total,4736488576},
      {processes,3832122172},
      {processes_used,3832066481},
      {system,904366404},
      {atom,561761},
      {atom_used,551430},
      {binary,98523592},
      {code,15193946},
      {ets,717445688}]},
 {vm_memory_high_watermark,0.6999999999761628},
 {vm_memory_limit,5873161011}]
...done.


[oraweb at i-00000140-csm ~]$ rabbitmqctl cluster_status
Cluster status of node 'rabbit at i-00000140-csm' ...
[{nodes,[{disc,['rabbit at i-0000001a-zsm','rabbit at i-00000007-asm']},
         {ram,['rabbit at i-00000140-csm','rabbit at i-000000ed-wsm',
               'rabbit at i-00000009-asm']}]},
 {running_nodes,['rabbit at i-0000001a-zsm','rabbit at i-00000009-asm',
                 'rabbit at i-000000ed-wsm','rabbit at i-00000007-asm',
                 'rabbit at i-00000140-csm']}]
...done.

curl to /api/nodes

[
   {
      "name":"rabbit at i-00000007-asm",
      "type":"disc",
      "running":true,
      "os_pid":"2355",
      "mem_ets":80370184,
      "mem_binary":172171304,
      "mem_proc":2660549995,
      "mem_proc_used":2660237395,
      "mem_atom":1320161,
      "mem_atom_used":1289709,
      "mem_code":15193946,
      "fd_used":39,
      "fd_total":131072,
      "sockets_used":12,
      "sockets_total":117872,
      "mem_used":3010567112,
      "mem_limit":5017881804,
      "mem_alarm":false,
      "proc_used":586,
      "proc_total":32768,
      "statistics_level":"fine",
      "erlang_version":"R15B",
      "uptime":954105232,
      "run_queue":1,
      "processors":2,
      "exchange_types":[
         {
            "name":"topic",
            "description":
"AMQP topic exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"fanout",
            "description":
"AMQP fanout exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"direct",
            "description":
"AMQP direct exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"headers",
            "description":
"AMQP headers exchange, as per the AMQP specification",
            "enabled":true
         }
      ],
      "auth_mechanisms":[
         {
            "name":"PLAIN",
            "description":"SASL PLAIN authentication mechanism",
            "enabled":true
         },
         {
            "name":"AMQPLAIN",
            "description":"QPid AMQPLAIN mechanism",
            "enabled":true
         },
         {
            "name":"RABBIT-CR-DEMO",
            "description":
"RabbitMQ Demo challenge-response authentication mechanism",
            "enabled":false
         }
      ],
      "applications":[
         {
            "name":"amqp_client",
            "description":"RabbitMQ AMQP Client",
            "version":"2.7.1"
         },
         {
            "name":"inets",
            "description":"INETS  CXC 138 49",
            "version":"5.8"
         },
         {
            "name":"kernel",
            "description":"ERTS  CXC 138 10",
            "version":"2.15"
         },
         {
            "name":"mnesia",
            "description":"MNESIA  CXC 138 12",
            "version":"4.6"
         },
         {
            "name":"mochiweb",
            "description":"MochiMedia Web Server",
            "version":"1.3-rmq2.7.1-git"
         },
         {
            "name":"os_mon",
            "description":"CPO  CXC 138 46",
            "version":"2.2.8"
         },
         {
            "name":"rabbit",
            "description":"RabbitMQ",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_management",
            "description":"RabbitMQ Management Console",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_management_agent",
            "description":"RabbitMQ Management Agent",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_management_visualiser",
            "description":"RabbitMQ Visualiser",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_mochiweb",
            "description":"RabbitMQ Mochiweb Embedding",
            "version":"2.7.1"
         },
         {
            "name":"sasl",
            "description":"SASL  CXC 138 11",
            "version":"2.2"
         },
         {
            "name":"stdlib",
            "description":"ERTS  CXC 138 10",
            "version":"1.18"
         },
         {
            "name":"webmachine",
            "description":"webmachine",
            "version":"1.7.0-rmq2.7.1-hg"
         }
      ]
   },
   {
      "name":"rabbit at i-00000009-asm",
      "type":"ram",
      "running":true,
      "os_pid":"752",
      "mem_ets":31523784,
      "mem_binary":8080608,
      "mem_proc":155907055,
      "mem_proc_used":155933036,
      "mem_atom":1779921,
      "mem_atom_used":1753310,
      "mem_code":15219988,
      "fd_used":48,
      "fd_total":131072,
      "sockets_used":21,
      "sockets_total":117872,
      "mem_used":294359264,
      "mem_limit":5017881804,
      "mem_alarm":false,
      "proc_used":655,
      "proc_total":32768,
      "statistics_level":"fine",
      "erlang_version":"R15B",
      "uptime":1532913870,
      "run_queue":0,
      "processors":2,
      "exchange_types":[
         {
            "name":"topic",
            "description":
"AMQP topic exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"fanout",
            "description":
"AMQP fanout exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"direct",
            "description":
"AMQP direct exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"headers",
            "description":
"AMQP headers exchange, as per the AMQP specification",
            "enabled":true
         }
      ],
      "auth_mechanisms":[
         {
            "name":"PLAIN",
            "description":"SASL PLAIN authentication mechanism",
            "enabled":true
         },
         {
            "name":"AMQPLAIN",
            "description":"QPid AMQPLAIN mechanism",
            "enabled":true
         },
         {
            "name":"RABBIT-CR-DEMO",
            "description":
"RabbitMQ Demo challenge-response authentication mechanism",
            "enabled":false
         }
      ],
      "applications":[
         {
            "name":"amqp_client",
            "description":"RabbitMQ AMQP Client",
            "version":"2.7.1"
         },
         {
            "name":"inets",
            "description":"INETS  CXC 138 49",
            "version":"5.8"
         },
         {
            "name":"kernel",
            "description":"ERTS  CXC 138 10",
            "version":"2.15"
         },
         {
            "name":"mnesia",
            "description":"MNESIA  CXC 138 12",
            "version":"4.6"
         },
         {
            "name":"mochiweb",
            "description":"MochiMedia Web Server",
            "version":"1.3-rmq2.7.1-git"
         },
         {
            "name":"os_mon",
            "description":"CPO  CXC 138 46",
            "version":"2.2.8"
         },
         {
            "name":"rabbit",
            "description":"RabbitMQ",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_management",
            "description":"RabbitMQ Management Console",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_management_agent",
            "description":"RabbitMQ Management Agent",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_mochiweb",
            "description":"RabbitMQ Mochiweb Embedding",
            "version":"2.7.1"
         },
         {
            "name":"sasl",
            "description":"SASL  CXC 138 11",
            "version":"2.2"
         },
         {
            "name":"stdlib",
            "description":"ERTS  CXC 138 10",
            "version":"1.18"
         },
         {
            "name":"webmachine",
            "description":"webmachine",
            "version":"1.7.0-rmq2.7.1-hg"
         }
      ]
   },
   {
      "name":"rabbit at i-0000001a-zsm",
      "type":"disc",
      "running":true,
      "os_pid":"15193",
      "mem_ets":57934352,
      "mem_binary":41261304,
      "mem_proc":984084797,
      "mem_proc_used":983864979,
      "mem_atom":695185,
      "mem_atom_used":672799,
      "mem_code":15225838,
      "fd_used":57,
      "fd_total":131072,
      "sockets_used":11,
      "sockets_total":117872,
      "mem_used":1177935432,
      "mem_limit":5017881804,
      "mem_alarm":false,
      "proc_used":618,
      "proc_total":32768,
      "statistics_level":"fine",
      "erlang_version":"R15B",
      "uptime":82787221,
      "run_queue":0,
      "processors":2,
      "exchange_types":[
         {
            "name":"topic",
            "description":
"AMQP topic exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"fanout",
            "description":
"AMQP fanout exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"direct",
            "description":
"AMQP direct exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"headers",
            "description":
"AMQP headers exchange, as per the AMQP specification",
            "enabled":true
         }
      ],
      "auth_mechanisms":[
         {
            "name":"PLAIN",
            "description":"SASL PLAIN authentication mechanism",
            "enabled":true
         },
         {
            "name":"AMQPLAIN",
            "description":"QPid AMQPLAIN mechanism",
            "enabled":true
         },
         {
            "name":"RABBIT-CR-DEMO",
            "description":
"RabbitMQ Demo challenge-response authentication mechanism",
            "enabled":false
         }
      ],
      "applications":[
         {
            "name":"amqp_client",
            "description":"RabbitMQ AMQP Client",
            "version":"2.7.1"
         },
         {
            "name":"inets",
            "description":"INETS  CXC 138 49",
            "version":"5.8"
         },
         {
            "name":"kernel",
            "description":"ERTS  CXC 138 10",
            "version":"2.15"
         },
         {
            "name":"mnesia",
            "description":"MNESIA  CXC 138 12",
            "version":"4.6"
         },
         {
            "name":"mochiweb",
            "description":"MochiMedia Web Server",
            "version":"1.3-rmq2.7.1-git"
         },
         {
            "name":"os_mon",
            "description":"CPO  CXC 138 46",
            "version":"2.2.8"
         },
         {
            "name":"rabbit",
            "description":"RabbitMQ",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_management",
            "description":"RabbitMQ Management Console",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_management_agent",
            "description":"RabbitMQ Management Agent",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_management_visualiser",
            "description":"RabbitMQ Visualiser",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_mochiweb",
            "description":"RabbitMQ Mochiweb Embedding",
            "version":"2.7.1"
         },
         {
            "name":"sasl",
            "description":"SASL  CXC 138 11",
            "version":"2.2"
         },
         {
            "name":"stdlib",
            "description":"ERTS  CXC 138 10",
            "version":"1.18"
         },
         {
            "name":"webmachine",
            "description":"webmachine",
            "version":"1.7.0-rmq2.7.1-hg"
         }
      ]
   },
   {
      "name":"rabbit at i-000000ed-wsm",
      "type":"ram",
      "running":true,
      "os_pid":"6451",
      "mem_ets":39572576,
      "mem_binary":71107032,
      "mem_proc":1325493043,
      "mem_proc_used":1325494995,
      "mem_atom":2074889,
      "mem_atom_used":2073540,
      "mem_code":15225838,
      "fd_used":47,
      "fd_total":131072,
      "sockets_used":19,
      "sockets_total":117872,
      "mem_used":1536134064,
      "mem_limit":5017685196,
      "mem_alarm":false,
      "proc_used":1213,
      "proc_total":32768,
      "statistics_level":"fine",
      "erlang_version":"R15B",
      "uptime":2017204497,
      "run_queue":23,
      "processors":4,
      "exchange_types":[
         {
            "name":"topic",
            "description":
"AMQP topic exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"fanout",
            "description":
"AMQP fanout exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"direct",
            "description":
"AMQP direct exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"headers",
            "description":
"AMQP headers exchange, as per the AMQP specification",
            "enabled":true
         }
      ],
      "auth_mechanisms":[
         {
            "name":"PLAIN",
            "description":"SASL PLAIN authentication mechanism",
            "enabled":true
         },
         {
            "name":"AMQPLAIN",
            "description":"QPid AMQPLAIN mechanism",
            "enabled":true
         },
         {
            "name":"RABBIT-CR-DEMO",
            "description":
"RabbitMQ Demo challenge-response authentication mechanism",
            "enabled":false
         }
      ],
      "applications":[
         {
            "name":"amqp_client",
            "description":"RabbitMQ AMQP Client",
            "version":"2.7.1"
         },
         {
            "name":"inets",
            "description":"INETS  CXC 138 49",
            "version":"5.8"
         },
         {
            "name":"kernel",
            "description":"ERTS  CXC 138 10",
            "version":"2.15"
         },
         {
            "name":"mnesia",
            "description":"MNESIA  CXC 138 12",
            "version":"4.6"
         },
         {
            "name":"mochiweb",
            "description":"MochiMedia Web Server",
            "version":"1.3-rmq2.7.1-git"
         },
         {
            "name":"os_mon",
            "description":"CPO  CXC 138 46",
            "version":"2.2.8"
         },
         {
            "name":"rabbit",
            "description":"RabbitMQ",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_management",
            "description":"RabbitMQ Management Console",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_management_agent",
            "description":"RabbitMQ Management Agent",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_management_visualiser",
            "description":"RabbitMQ Visualiser",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_mochiweb",
            "description":"RabbitMQ Mochiweb Embedding",
            "version":"2.7.1"
         },
         {
            "name":"sasl",
            "description":"SASL  CXC 138 11",
            "version":"2.2"
         },
         {
            "name":"stdlib",
            "description":"ERTS  CXC 138 10",
            "version":"1.18"
         },
         {
            "name":"webmachine",
            "description":"webmachine",
            "version":"1.7.0-rmq2.7.1-hg"
         }
      ]
   },
   {
      "name":"rabbit at i-00000140-csm",
      "type":"ram",
      "running":true,
      "os_pid":"20106",
      "mem_ets":729336240,
      "mem_binary":100785248,
      "mem_proc":3863316567,
      "mem_proc_used":3863545491,
      "mem_atom":561761,
      "mem_atom_used":551523,
      "mem_code":15193946,
      "fd_used":114,
      "fd_total":131072,
      "sockets_used":1,
      "sockets_total":117872,
      "mem_used":4781589152,
      "mem_limit":5873161011,
      "mem_alarm":false,
      "proc_used":176,
      "proc_total":32768,
      "statistics_level":"fine",
      "erlang_version":"R15B",
      "uptime":16101251,
      "run_queue":3,
      "processors":4,
      "exchange_types":[
         {
            "name":"topic",
            "description":
"AMQP topic exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"fanout",
            "description":
"AMQP fanout exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"direct",
            "description":
"AMQP direct exchange, as per the AMQP specification",
            "enabled":true
         },
         {
            "name":"headers",
            "description":
"AMQP headers exchange, as per the AMQP specification",
            "enabled":true
         }
      ],
      "auth_mechanisms":[
         {
            "name":"PLAIN",
            "description":"SASL PLAIN authentication mechanism",
            "enabled":true
         },
         {
            "name":"AMQPLAIN",
            "description":"QPid AMQPLAIN mechanism",
            "enabled":true
         },
         {
            "name":"RABBIT-CR-DEMO",
            "description":
"RabbitMQ Demo challenge-response authentication mechanism",
            "enabled":false
         }
      ],
      "applications":[
         {
            "name":"amqp_client",
            "description":"RabbitMQ AMQP Client",
            "version":"2.7.1"
         },
         {
            "name":"inets",
            "description":"INETS  CXC 138 49",
            "version":"5.8"
         },
         {
            "name":"kernel",
            "description":"ERTS  CXC 138 10",
            "version":"2.15"
         },
         {
            "name":"mnesia",
            "description":"MNESIA  CXC 138 12",
            "version":"4.6"
         },
         {
            "name":"mochiweb",
            "description":"MochiMedia Web Server",
            "version":"1.3-rmq2.7.1-git"
         },
         {
            "name":"os_mon",
            "description":"CPO  CXC 138 46",
            "version":"2.2.8"
         },
         {
            "name":"rabbit",
            "description":"RabbitMQ",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_management",
            "description":"RabbitMQ Management Console",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_management_agent",
            "description":"RabbitMQ Management Agent",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_management_visualiser",
            "description":"RabbitMQ Visualiser",
            "version":"2.7.1"
         },
         {
            "name":"rabbitmq_mochiweb",
            "description":"RabbitMQ Mochiweb Embedding",
            "version":"2.7.1"
         },
         {
            "name":"sasl",
            "description":"SASL  CXC 138 11",
            "version":"2.2"
         },
         {
            "name":"stdlib",
            "description":"ERTS  CXC 138 10",
            "version":"1.18"
         },
         {
            "name":"webmachine",
            "description":"webmachine",
            "version":"1.7.0-rmq2.7.1-hg"
         }
      ]
   }
]

On Mon, May 7, 2012 at 2:32 PM, Pablo Molnar <pablomolnar at gmail.com> wrote:

> Hello,
>
> I'm trying to figure out why the memory consumption of some queues are
> extremely high although there is almost none messages ready to consume.
> For instance this queue has only 3 messages but consumes 2.4GB of RAM.
>
> {
>    "exclusive_consumer_tag":"",
>    "messages_ready":0,
>    "messages_unacknowledged":3,
>    "messages":3,
>    "consumers":25,
>    "memory":2586777216,
>    "slave_nodes":[
>
>    ],
>    "backing_queue_status":{
>       "q1":0,
>       "q2":0,
>       "delta":[
>          "delta",
>          "undefined",
>          0,
>          "undefined"
>       ],
>       "q3":0,
>       "q4":0,
>       "len":0,
>       "pending_acks":3,
>       "target_ram_count":0,
>       "ram_msg_count":0,
>       "ram_ack_count":0,
>       "next_seq_id":72528926,
>       "persistent_count":3,
>       "avg_ingress_rate":42.456013780009044,
>       "avg_egress_rate":42.456013780009044,
>       "avg_ack_ingress_rate":42.456013780009044,
>       "avg_ack_egress_rate":42.456013780009044
>    },
>    "messages_details":{
>       "rate":0.0,
>       "interval":5035424,
>       "last_event":1336411139483
>    },
>    "messages_ready_details":{
>       "rate":0.0,
>       "interval":5035424,
>       "last_event":1336411139483
>    },
>    "messages_unacknowledged_details":{
>       "rate":0.0,
>       "interval":5035424,
>       "last_event":1336411139483
>    },
>    "incoming":[
>       {
>          "stats":{
>             "publish":1734006,
>             "publish_details":{
>                "rate":102.09667507804102,
>                "interval":13252280,
>                "last_event":1336411142499
>             }
>          },
>          "exchange":{
>             "name":"items_feed_ex",
>             "vhost":"items"
>          }
>       }
>    ],
>    "deliveries":[
>       {
>          "stats":{
>             "ack":49131,
>             "ack_details":{
>                "rate":1.175108844456718,
>                "interval":5105910,
>                "last_event":1336411141663
>             },
>             "deliver":49153,
>             "deliver_details":{
>                "rate":0.9792573703805982,
>                "interval":5105910,
>                "last_event":1336411141663
>             },
>             "deliver_get":49153,
>             "deliver_get_details":{
>                "rate":0.9792573703805982,
>                "interval":5105910,
>                "last_event":1336411141663
>             },
>             "redeliver":24,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5105910,
>                "last_event":1336411141663
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:45194:49",
>             "number":49,
>             "connection_name":"172.16.151.171:45194",
>             "peer_address":"172.16.151.171",
>             "peer_port":45194
>          }
>       },
>       {
>          "stats":{
>             "ack":40909,
>             "ack_details":{
>                "rate":1.3173608970399655,
>                "interval":5313654,
>                "last_event":1336411141077
>             },
>             "deliver":40929,
>             "deliver_details":{
>                "rate":1.3173608970399655,
>                "interval":5313654,
>                "last_event":1336411141077
>             },
>             "deliver_get":40929,
>             "deliver_get_details":{
>                "rate":1.3173608970399655,
>                "interval":5313654,
>                "last_event":1336411141077
>             },
>             "redeliver":23,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5313654,
>                "last_event":1336411141077
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:36273:49",
>             "number":49,
>             "connection_name":"172.16.151.171:36273",
>             "peer_address":"172.16.151.171",
>             "peer_port":36273
>          }
>       },
>       {
>          "stats":{
>             "ack":23080,
>             "ack_details":{
>                "rate":0,
>                "interval":5059374,
>                "last_event":1335489316168
>             },
>             "deliver":23091,
>             "deliver_details":{
>                "rate":0,
>                "interval":5059374,
>                "last_event":1335489316168
>             },
>             "deliver_get":23091,
>             "deliver_get_details":{
>                "rate":0,
>                "interval":5059374,
>                "last_event":1335489316168
>             },
>             "redeliver":10,
>             "redeliver_details":{
>                "rate":0,
>                "interval":5059374,
>                "last_event":1335489316168
>             }
>          },
>          "channel_details":{
>             "name":"172.16.158.120:35852:46",
>             "number":46,
>             "connection_name":"unknown",
>             "peer_address":"unknown",
>             "peer_port":"unknown"
>          }
>       },
>       {
>          "stats":{
>             "ack":43723,
>             "ack_details":{
>                "rate":1.0083279485819967,
>                "interval":5950445,
>                "last_event":1336411141292
>             },
>             "deliver":43744,
>             "deliver_details":{
>                "rate":1.0083279485819967,
>                "interval":5950445,
>                "last_event":1336411141292
>             },
>             "deliver_get":43744,
>             "deliver_get_details":{
>                "rate":1.0083279485819967,
>                "interval":5950445,
>                "last_event":1336411141292
>             },
>             "redeliver":23,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5950445,
>                "last_event":1336411141292
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:36331:47",
>             "number":47,
>             "connection_name":"172.16.151.171:36331",
>             "peer_address":"172.16.151.171",
>             "peer_port":36331
>          }
>       },
>       {
>          "stats":{
>             "ack":43757,
>             "ack_details":{
>                "rate":1.331257079434969,
>                "interval":5258188,
>                "last_event":1336411141021
>             },
>             "deliver":43785,
>             "deliver_details":{
>                "rate":1.331257079434969,
>                "interval":5258188,
>                "last_event":1336411141021
>             },
>             "deliver_get":43785,
>             "deliver_get_details":{
>                "rate":1.331257079434969,
>                "interval":5258188,
>                "last_event":1336411141021
>             },
>             "redeliver":28,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5258188,
>                "last_event":1336411141021
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:36331:50",
>             "number":50,
>             "connection_name":"172.16.151.171:36331",
>             "peer_address":"172.16.151.171",
>             "peer_port":36331
>          }
>       },
>       {
>          "stats":{
>             "ack":48273,
>             "ack_details":{
>                "rate":1.0928432247180737,
>                "interval":5490266,
>                "last_event":1336411141855
>             },
>             "deliver":48294,
>             "deliver_details":{
>                "rate":1.0928432247180737,
>                "interval":5490266,
>                "last_event":1336411141855
>             },
>             "deliver_get":48294,
>             "deliver_get_details":{
>                "rate":1.0928432247180737,
>                "interval":5490266,
>                "last_event":1336411141855
>             },
>             "redeliver":23,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5490266,
>                "last_event":1336411141855
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:54223:47",
>             "number":47,
>             "connection_name":"172.16.151.171:54223",
>             "peer_address":"172.16.151.171",
>             "peer_port":54223
>          }
>       },
>       {
>          "stats":{
>             "ack":32942,
>             "ack_details":{
>                "rate":0,
>                "interval":6038414,
>                "last_event":1336251911407
>             },
>             "deliver":32953,
>             "deliver_details":{
>                "rate":0,
>                "interval":6038414,
>                "last_event":1336251911407
>             },
>             "deliver_get":32953,
>             "deliver_get_details":{
>                "rate":0,
>                "interval":6038414,
>                "last_event":1336251911407
>             },
>             "redeliver":12,
>             "redeliver_details":{
>                "rate":0,
>                "interval":6038414,
>                "last_event":1336251911407
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:33574:18",
>             "number":18,
>             "connection_name":"172.16.151.171:33574",
>             "peer_address":"172.16.151.171",
>             "peer_port":33574
>          }
>       },
>       {
>          "stats":{
>             "ack":47480,
>             "ack_details":{
>                "rate":1.1202831179495683,
>                "interval":5355789,
>                "last_event":1336411141566
>             },
>             "deliver":47506,
>             "deliver_details":{
>                "rate":1.1202831179495683,
>                "interval":5355789,
>                "last_event":1336411141566
>             },
>             "deliver_get":47506,
>             "deliver_get_details":{
>                "rate":1.1202831179495683,
>                "interval":5355789,
>                "last_event":1336411141566
>             },
>             "redeliver":24,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5355789,
>                "last_event":1336411141566
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:37028:48",
>             "number":48,
>             "connection_name":"172.16.151.171:37028",
>             "peer_address":"172.16.151.171",
>             "peer_port":37028
>          }
>       },
>       {
>          "stats":{
>             "ack":49126,
>             "ack_details":{
>                "rate":1.3996433708691025,
>                "interval":5001274,
>                "last_event":1336411140664
>             },
>             "deliver":49150,
>             "deliver_details":{
>                "rate":1.3996433708691025,
>                "interval":5001274,
>                "last_event":1336411140664
>             },
>             "deliver_get":49150,
>             "deliver_get_details":{
>                "rate":1.3996433708691025,
>                "interval":5001274,
>                "last_event":1336411140664
>             },
>             "redeliver":23,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5001274,
>                "last_event":1336411140664
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:45194:48",
>             "number":48,
>             "connection_name":"172.16.151.171:45194",
>             "peer_address":"172.16.151.171",
>             "peer_port":45194
>          }
>       },
>       {
>          "stats":{
>             "ack":40918,
>             "ack_details":{
>                "rate":1.109675109321493,
>                "interval":5406988,
>                "last_event":1336411141761
>             },
>             "deliver":40942,
>             "deliver_details":{
>                "rate":1.109675109321493,
>                "interval":5406988,
>                "last_event":1336411141761
>             },
>             "deliver_get":40942,
>             "deliver_get_details":{
>                "rate":1.109675109321493,
>                "interval":5406988,
>                "last_event":1336411141761
>             },
>             "redeliver":24,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5406988,
>                "last_event":1336411141761
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:36273:48",
>             "number":48,
>             "connection_name":"172.16.151.171:36273",
>             "peer_address":"172.16.151.171",
>             "peer_port":36273
>          }
>       },
>       {
>          "stats":{
>             "ack":32993,
>             "ack_details":{
>                "rate":0,
>                "interval":7659109,
>                "last_event":1336251913994
>             },
>             "deliver":33002,
>             "deliver_details":{
>                "rate":0,
>                "interval":7659109,
>                "last_event":1336251913994
>             },
>             "deliver_get":33002,
>             "deliver_get_details":{
>                "rate":0,
>                "interval":7659109,
>                "last_event":1336251913994
>             },
>             "redeliver":8,
>             "redeliver_details":{
>                "rate":0,
>                "interval":7659109,
>                "last_event":1336251913994
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:33574:20",
>             "number":20,
>             "connection_name":"172.16.151.171:33574",
>             "peer_address":"172.16.151.171",
>             "peer_port":33574
>          }
>       },
>       {
>          "stats":{
>             "ack":43713,
>             "ack_details":{
>                "rate":1.080307152929721,
>                "interval":5553976,
>                "last_event":1336411141955
>             },
>             "deliver":43736,
>             "deliver_details":{
>                "rate":1.080307152929721,
>                "interval":5553976,
>                "last_event":1336411141955
>             },
>             "deliver_get":43736,
>             "deliver_get_details":{
>                "rate":1.080307152929721,
>                "interval":5553976,
>                "last_event":1336411141955
>             },
>             "redeliver":18,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5553976,
>                "last_event":1336411141955
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:36331:46",
>             "number":46,
>             "connection_name":"172.16.151.171:36331",
>             "peer_address":"172.16.151.171",
>             "peer_port":36331
>          }
>       },
>       {
>          "stats":{
>             "ack":43756,
>             "ack_details":{
>                "rate":1.0079945729572193,
>                "interval":5952413,
>                "last_event":1336411141306
>             },
>             "deliver":43778,
>             "deliver_details":{
>                "rate":1.0079945729572193,
>                "interval":5952413,
>                "last_event":1336411141306
>             },
>             "deliver_get":43778,
>             "deliver_get_details":{
>                "rate":1.0079945729572193,
>                "interval":5952413,
>                "last_event":1336411141306
>             },
>             "redeliver":21,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5952413,
>                "last_event":1336411141306
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:36331:49",
>             "number":49,
>             "connection_name":"172.16.151.171:36331",
>             "peer_address":"172.16.151.171",
>             "peer_port":36331
>          }
>       },
>       {
>          "stats":{
>             "ack":48197,
>             "ack_details":{
>                "rate":1.0859767818164048,
>                "interval":5524980,
>                "last_event":1336411141929
>             },
>             "deliver":48218,
>             "deliver_details":{
>                "rate":1.0859767818164048,
>                "interval":5524980,
>                "last_event":1336411141929
>             },
>             "deliver_get":48218,
>             "deliver_get_details":{
>                "rate":1.0859767818164048,
>                "interval":5524980,
>                "last_event":1336411141929
>             },
>             "redeliver":28,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5524980,
>                "last_event":1336411141929
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:54223:46",
>             "number":46,
>             "connection_name":"172.16.151.171:54223",
>             "peer_address":"172.16.151.171",
>             "peer_port":54223
>          }
>       },
>       {
>          "stats":{
>             "ack":48177,
>             "ack_details":{
>                "rate":1.2549852046208556,
>                "interval":5577755,
>                "last_event":1336411140980
>             },
>             "deliver":48201,
>             "deliver_details":{
>                "rate":1.2549852046208556,
>                "interval":5577755,
>                "last_event":1336411140980
>             },
>             "deliver_get":48201,
>             "deliver_get_details":{
>                "rate":1.2549852046208556,
>                "interval":5577755,
>                "last_event":1336411140980
>             },
>             "redeliver":26,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5577755,
>                "last_event":1336411140980
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:54223:50",
>             "number":50,
>             "connection_name":"172.16.151.171:54223",
>             "peer_address":"172.16.151.171",
>             "peer_port":54223
>          }
>       },
>       {
>          "stats":{
>             "ack":30521,
>             "ack_details":{
>                "rate":0,
>                "interval":10018546,
>                "last_event":1336251916943
>             },
>             "deliver":30532,
>             "deliver_details":{
>                "rate":0,
>                "interval":10018546,
>                "last_event":1336251916943
>             },
>             "deliver_get":30532,
>             "deliver_get_details":{
>                "rate":0,
>                "interval":10018546,
>                "last_event":1336251916943
>             },
>             "redeliver":12,
>             "redeliver_details":{
>                "rate":0,
>                "interval":10018546,
>                "last_event":1336251916943
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:33574:17",
>             "number":17,
>             "connection_name":"172.16.151.171:33574",
>             "peer_address":"172.16.151.171",
>             "peer_port":33574
>          }
>       },
>       {
>          "stats":{
>             "ack":47417,
>             "ack_details":{
>                "rate":1.3417528966528247,
>                "interval":5217056,
>                "last_event":1336411140740
>             },
>             "deliver":47442,
>             "deliver_details":{
>                "rate":1.3417528966528247,
>                "interval":5217056,
>                "last_event":1336411140740
>             },
>             "deliver_get":47442,
>             "deliver_get_details":{
>                "rate":1.3417528966528247,
>                "interval":5217056,
>                "last_event":1336411140740
>             },
>             "redeliver":25,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5217056,
>                "last_event":1336411140740
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:37028:49",
>             "number":49,
>             "connection_name":"172.16.151.171:37028",
>             "peer_address":"172.16.151.171",
>             "peer_port":37028
>          }
>       },
>       {
>          "stats":{
>             "ack":49175,
>             "ack_details":{
>                "rate":1.1231077739835453,
>                "interval":5342319,
>                "last_event":1336411141704
>             },
>             "deliver":49200,
>             "deliver_details":{
>                "rate":1.1231077739835453,
>                "interval":5342319,
>                "last_event":1336411141704
>             },
>             "deliver_get":49200,
>             "deliver_get_details":{
>                "rate":1.1231077739835453,
>                "interval":5342319,
>                "last_event":1336411141704
>             },
>             "redeliver":23,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5342319,
>                "last_event":1336411141704
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:45194:47",
>             "number":47,
>             "connection_name":"172.16.151.171:45194",
>             "peer_address":"172.16.151.171",
>             "peer_port":45194
>          }
>       },
>       {
>          "stats":{
>             "ack":40909,
>             "ack_details":{
>                "rate":1.3533183656322094,
>                "interval":5172471,
>                "last_event":1336411140765
>             },
>             "deliver":40927,
>             "deliver_details":{
>                "rate":1.3533183656322094,
>                "interval":5172471,
>                "last_event":1336411140765
>             },
>             "deliver_get":40927,
>             "deliver_get_details":{
>                "rate":1.3533183656322094,
>                "interval":5172471,
>                "last_event":1336411140765
>             },
>             "redeliver":19,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5172471,
>                "last_event":1336411140765
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:36273:47",
>             "number":47,
>             "connection_name":"172.16.151.171:36273",
>             "peer_address":"172.16.151.171",
>             "peer_port":36273
>          }
>       },
>       {
>          "stats":{
>             "ack":26779,
>             "ack_details":{
>                "rate":0,
>                "interval":5053059,
>                "last_event":1335489316759
>             },
>             "deliver":26793,
>             "deliver_details":{
>                "rate":0,
>                "interval":5053059,
>                "last_event":1335489316759
>             },
>             "deliver_get":26793,
>             "deliver_get_details":{
>                "rate":0,
>                "interval":5053059,
>                "last_event":1335489316759
>             },
>             "redeliver":14,
>             "redeliver_details":{
>                "rate":0,
>                "interval":5053059,
>                "last_event":1335489316759
>             }
>          },
>          "channel_details":{
>             "name":"172.16.158.120:35852:48",
>             "number":48,
>             "connection_name":"unknown",
>             "peer_address":"unknown",
>             "peer_port":"unknown"
>          }
>       },
>       {
>          "stats":{
>             "ack":32934,
>             "ack_details":{
>                "rate":0,
>                "interval":6831513,
>                "last_event":1336251912217
>             },
>             "deliver":32948,
>             "deliver_details":{
>                "rate":0,
>                "interval":6831513,
>                "last_event":1336251912217
>             },
>             "deliver_get":32948,
>             "deliver_get_details":{
>                "rate":0,
>                "interval":6831513,
>                "last_event":1336251912217
>             },
>             "redeliver":13,
>             "redeliver_details":{
>                "rate":0,
>                "interval":6831513,
>                "last_event":1336251912217
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:33574:19",
>             "number":19,
>             "connection_name":"172.16.151.171:33574",
>             "peer_address":"172.16.151.171",
>             "peer_port":33574
>          }
>       },
>       {
>          "stats":{
>             "ack":48244,
>             "ack_details":{
>                "rate":1.0902719756127965,
>                "interval":5503214,
>                "last_event":1336411141854
>             },
>             "deliver":48264,
>             "deliver_details":{
>                "rate":1.0902719756127965,
>                "interval":5503214,
>                "last_event":1336411141854
>             },
>             "deliver_get":48264,
>             "deliver_get_details":{
>                "rate":1.0902719756127965,
>                "interval":5503214,
>                "last_event":1336411141854
>             },
>             "redeliver":23,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5503214,
>                "last_event":1336411141854
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:54223:49",
>             "number":49,
>             "connection_name":"172.16.151.171:54223",
>             "peer_address":"172.16.151.171",
>             "peer_port":54223
>          }
>       },
>       {
>          "stats":{
>             "ack":47451,
>             "ack_details":{
>                "rate":1.0455790564938563,
>                "interval":5738447,
>                "last_event":1336411142260
>             },
>             "deliver":47471,
>             "deliver_details":{
>                "rate":1.0455790564938563,
>                "interval":5738447,
>                "last_event":1336411142260
>             },
>             "deliver_get":47471,
>             "deliver_get_details":{
>                "rate":1.0455790564938563,
>                "interval":5738447,
>                "last_event":1336411142260
>             },
>             "redeliver":15,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5738447,
>                "last_event":1336411142260
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:37028:47",
>             "number":47,
>             "connection_name":"172.16.151.171:37028",
>             "peer_address":"172.16.151.171",
>             "peer_port":37028
>          }
>       },
>       {
>          "stats":{
>             "ack":49218,
>             "ack_details":{
>                "rate":1.382819846230433,
>                "interval":5062120,
>                "last_event":1336411140624
>             },
>             "deliver":49239,
>             "deliver_details":{
>                "rate":1.382819846230433,
>                "interval":5062120,
>                "last_event":1336411140624
>             },
>             "deliver_get":49239,
>             "deliver_get_details":{
>                "rate":1.382819846230433,
>                "interval":5062120,
>                "last_event":1336411140624
>             },
>             "redeliver":27,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5062120,
>                "last_event":1336411140624
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:45194:46",
>             "number":46,
>             "connection_name":"172.16.151.171:45194",
>             "peer_address":"172.16.151.171",
>             "peer_port":45194
>          }
>       },
>       {
>          "stats":{
>             "ack":49108,
>             "ack_details":{
>                "rate":1.104551303646676,
>                "interval":5432070,
>                "last_event":1336411141703
>             },
>             "deliver":49129,
>             "deliver_details":{
>                "rate":1.104551303646676,
>                "interval":5432070,
>                "last_event":1336411141703
>             },
>             "deliver_get":49129,
>             "deliver_get_details":{
>                "rate":1.104551303646676,
>                "interval":5432070,
>                "last_event":1336411141703
>             },
>             "redeliver":22,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5432070,
>                "last_event":1336411141703
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:45194:50",
>             "number":50,
>             "connection_name":"172.16.151.171:45194",
>             "peer_address":"172.16.151.171",
>             "peer_port":45194
>          }
>       },
>       {
>          "stats":{
>             "ack":32352,
>             "ack_details":{
>                "rate":0,
>                "interval":6799028,
>                "last_event":1336251913770
>             },
>             "deliver":32364,
>             "deliver_details":{
>                "rate":0,
>                "interval":6799028,
>                "last_event":1336251913770
>             },
>             "deliver_get":32364,
>             "deliver_get_details":{
>                "rate":0,
>                "interval":6799028,
>                "last_event":1336251913770
>             },
>             "redeliver":10,
>             "redeliver_details":{
>                "rate":0,
>                "interval":6799028,
>                "last_event":1336251913770
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:33574:2",
>             "number":2,
>             "connection_name":"172.16.151.171:33574",
>             "peer_address":"172.16.151.171",
>             "peer_port":33574
>          }
>       },
>       {
>          "stats":{
>             "ack":40890,
>             "ack_details":{
>                "rate":1.120705596243395,
>                "interval":5353770,
>                "last_event":1336411141647
>             },
>             "deliver":40915,
>             "deliver_details":{
>                "rate":1.120705596243395,
>                "interval":5353770,
>                "last_event":1336411141647
>             },
>             "deliver_get":40915,
>             "deliver_get_details":{
>                "rate":1.120705596243395,
>                "interval":5353770,
>                "last_event":1336411141647
>             },
>             "redeliver":27,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5353770,
>                "last_event":1336411141647
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:36273:46",
>             "number":46,
>             "connection_name":"172.16.151.171:36273",
>             "peer_address":"172.16.151.171",
>             "peer_port":36273
>          }
>       },
>       {
>          "stats":{
>             "ack":40855,
>             "ack_details":{
>                "rate":1.0549101849468536,
>                "interval":5687688,
>                "last_event":1336411142163
>             },
>             "deliver":40876,
>             "deliver_details":{
>                "rate":1.0549101849468536,
>                "interval":5687688,
>                "last_event":1336411142163
>             },
>             "deliver_get":40876,
>             "deliver_get_details":{
>                "rate":1.0549101849468536,
>                "interval":5687688,
>                "last_event":1336411142163
>             },
>             "redeliver":27,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5687688,
>                "last_event":1336411142163
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:36273:50",
>             "number":50,
>             "connection_name":"172.16.151.171:36273",
>             "peer_address":"172.16.151.171",
>             "peer_port":36273
>          }
>       },
>       {
>          "stats":{
>             "ack":43743,
>             "ack_details":{
>                "rate":1.256502851004969,
>                "interval":5571018,
>                "last_event":1336411140786
>             },
>             "deliver":43772,
>             "deliver_details":{
>                "rate":1.256502851004969,
>                "interval":5571018,
>                "last_event":1336411140786
>             },
>             "deliver_get":43772,
>             "deliver_get_details":{
>                "rate":1.256502851004969,
>                "interval":5571018,
>                "last_event":1336411140786
>             },
>             "redeliver":27,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5571018,
>                "last_event":1336411140786
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:36331:48",
>             "number":48,
>             "connection_name":"172.16.151.171:36331",
>             "peer_address":"172.16.151.171",
>             "peer_port":36331
>          }
>       },
>       {
>          "stats":{
>             "ack":48130,
>             "ack_details":{
>                "rate":1.1080557499783006,
>                "interval":5414890,
>                "last_event":1336411141739
>             },
>             "deliver":48153,
>             "deliver_details":{
>                "rate":1.1080557499783006,
>                "interval":5414890,
>                "last_event":1336411141739
>             },
>             "deliver_get":48153,
>             "deliver_get_details":{
>                "rate":1.1080557499783006,
>                "interval":5414890,
>                "last_event":1336411141739
>             },
>             "redeliver":28,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5414890,
>                "last_event":1336411141739
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:54223:48",
>             "number":48,
>             "connection_name":"172.16.151.171:54223",
>             "peer_address":"172.16.151.171",
>             "peer_port":54223
>          }
>       },
>       {
>          "stats":{
>             "ack":47426,
>             "ack_details":{
>                "rate":1.3911343010990955,
>                "interval":5031865,
>                "last_event":1336411140418
>             },
>             "deliver":47448,
>             "deliver_details":{
>                "rate":1.3911343010990955,
>                "interval":5031865,
>                "last_event":1336411140418
>             },
>             "deliver_get":47448,
>             "deliver_get_details":{
>                "rate":1.3911343010990955,
>                "interval":5031865,
>                "last_event":1336411140418
>             },
>             "redeliver":22,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5031865,
>                "last_event":1336411140418
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:37028:46",
>             "number":46,
>             "connection_name":"172.16.151.171:37028",
>             "peer_address":"172.16.151.171",
>             "peer_port":37028
>          }
>       },
>       {
>          "stats":{
>             "ack":47457,
>             "ack_details":{
>                "rate":1.1238103764783491,
>                "interval":5338979,
>                "last_event":1336411139488
>             },
>             "deliver":47477,
>             "deliver_details":{
>                "rate":1.1238103764783491,
>                "interval":5338979,
>                "last_event":1336411139488
>             },
>             "deliver_get":47477,
>             "deliver_get_details":{
>                "rate":1.1238103764783491,
>                "interval":5338979,
>                "last_event":1336411139488
>             },
>             "redeliver":17,
>             "redeliver_details":{
>                "rate":0.0,
>                "interval":5338979,
>                "last_event":1336411139488
>             }
>          },
>          "channel_details":{
>             "name":"172.16.151.171:37028:50",
>             "number":50,
>             "connection_name":"172.16.151.171:37028",
>             "peer_address":"172.16.151.171",
>             "peer_port":37028
>          }
>       }
>    ],
>    "message_stats":{
>       "ack":1358784,
>       "ack_details":{
>          "rate":29.480283582699396,
>          "interval":10018546,
>          "last_event":1336411142260
>       },
>       "deliver":1359432,
>       "deliver_details":{
>          "rate":29.284432108623275,
>          "interval":10018546,
>          "last_event":1336411142260
>       },
>       "deliver_get":1359432,
>       "deliver_get_details":{
>          "rate":29.284432108623275,
>          "interval":10018546,
>          "last_event":1336411142260
>       },
>       "redeliver":666,
>       "redeliver_details":{
>          "rate":0.0,
>          "interval":10018546,
>          "last_event":1336411142260
>       },
>       "publish":1734006,
>       "publish_details":{
>          "rate":102.09667507804099,
>          "interval":13252280,
>          "last_event":1336411142499
>       }
>    },
>    "consumer_details":[
>       {
>          "channel_details":{
>             "name":"172.16.151.171:54223:46",
>             "number":46,
>             "connection_name":"172.16.151.171:54223",
>             "peer_address":"172.16.151.171",
>             "peer_port":54223
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-wFzKNbMZrteA6PKaJySWAc",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:54223:47",
>             "number":47,
>             "connection_name":"172.16.151.171:54223",
>             "peer_address":"172.16.151.171",
>             "peer_port":54223
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-wkAxxLU80XJR8wqEpSCubc",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:54223:48",
>             "number":48,
>             "connection_name":"172.16.151.171:54223",
>             "peer_address":"172.16.151.171",
>             "peer_port":54223
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-AEOLa3Q5gk53J1gWU3yeKv",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:54223:49",
>             "number":49,
>             "connection_name":"172.16.151.171:54223",
>             "peer_address":"172.16.151.171",
>             "peer_port":54223
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-AXU5FGdQusfKxM_2yHr6Ra",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:54223:50",
>             "number":50,
>             "connection_name":"172.16.151.171:54223",
>             "peer_address":"172.16.151.171",
>             "peer_port":54223
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-ANrmI0q3PIectJFt95zSx7",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:45194:46",
>             "number":46,
>             "connection_name":"172.16.151.171:45194",
>             "peer_address":"172.16.151.171",
>             "peer_port":45194
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-AH6alSt2nC60fKRCgPw_C2",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:45194:47",
>             "number":47,
>             "connection_name":"172.16.151.171:45194",
>             "peer_address":"172.16.151.171",
>             "peer_port":45194
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-Q3mfQAZHq8MuQiVQHrHuh3",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:45194:48",
>             "number":48,
>             "connection_name":"172.16.151.171:45194",
>             "peer_address":"172.16.151.171",
>             "peer_port":45194
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-AuF42epadwStjdibAL0WU4",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:45194:49",
>             "number":49,
>             "connection_name":"172.16.151.171:45194",
>             "peer_address":"172.16.151.171",
>             "peer_port":45194
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-wByt8dne0DKkZbRqkwwV5d",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:45194:50",
>             "number":50,
>             "connection_name":"172.16.151.171:45194",
>             "peer_address":"172.16.151.171",
>             "peer_port":45194
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-AtmHCcgeDc22WL5GT6oyAi",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:37028:46",
>             "number":46,
>             "connection_name":"172.16.151.171:37028",
>             "peer_address":"172.16.151.171",
>             "peer_port":37028
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-gqrMfHul8Qlg6bNhJnBibY",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:37028:47",
>             "number":47,
>             "connection_name":"172.16.151.171:37028",
>             "peer_address":"172.16.151.171",
>             "peer_port":37028
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-w7sbfc0wThZXnM9GByVnLr",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:37028:49",
>             "number":49,
>             "connection_name":"172.16.151.171:37028",
>             "peer_address":"172.16.151.171",
>             "peer_port":37028
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-wftXOf1wQo0QLudxc6h5Dc",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:37028:48",
>             "number":48,
>             "connection_name":"172.16.151.171:37028",
>             "peer_address":"172.16.151.171",
>             "peer_port":37028
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-AsKyOqupPEQ-z66rC_cO_e",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:37028:50",
>             "number":50,
>             "connection_name":"172.16.151.171:37028",
>             "peer_address":"172.16.151.171",
>             "peer_port":37028
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-AN9CBjslXtNJulkwO1AsLo",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:36273:46",
>             "number":46,
>             "connection_name":"172.16.151.171:36273",
>             "peer_address":"172.16.151.171",
>             "peer_port":36273
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-Q40Ykqv5lxO5jXQIH8qeii",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:36273:47",
>             "number":47,
>             "connection_name":"172.16.151.171:36273",
>             "peer_address":"172.16.151.171",
>             "peer_port":36273
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-QLqO0WzKhJgYWqnTkxCVsy",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:36273:48",
>             "number":48,
>             "connection_name":"172.16.151.171:36273",
>             "peer_address":"172.16.151.171",
>             "peer_port":36273
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-Ac2ptOPwhFCnAwNlwyl8b5",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:36273:49",
>             "number":49,
>             "connection_name":"172.16.151.171:36273",
>             "peer_address":"172.16.151.171",
>             "peer_port":36273
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-gvU8OiS2W-SJ6dQACeZqYX",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:36273:50",
>             "number":50,
>             "connection_name":"172.16.151.171:36273",
>             "peer_address":"172.16.151.171",
>             "peer_port":36273
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-QApQVB-d0PDpVZYDZTWsLC",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:36331:46",
>             "number":46,
>             "connection_name":"172.16.151.171:36331",
>             "peer_address":"172.16.151.171",
>             "peer_port":36331
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-QyyT1kYbrmOypBx_cCb9El",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:36331:47",
>             "number":47,
>             "connection_name":"172.16.151.171:36331",
>             "peer_address":"172.16.151.171",
>             "peer_port":36331
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-AWNIHoLnIrSs-rRbGlYefk",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:36331:48",
>             "number":48,
>             "connection_name":"172.16.151.171:36331",
>             "peer_address":"172.16.151.171",
>             "peer_port":36331
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-ADQz44E00QKduPSM3r6EfX",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:36331:49",
>             "number":49,
>             "connection_name":"172.16.151.171:36331",
>             "peer_address":"172.16.151.171",
>             "peer_port":36331
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-AtN-iVuD_KU5S8AJS8P_ET",
>          "exclusive":false,
>          "ack_required":true
>       },
>       {
>          "channel_details":{
>             "name":"172.16.151.171:36331:50",
>             "number":50,
>             "connection_name":"172.16.151.171:36331",
>             "peer_address":"172.16.151.171",
>             "peer_port":36331
>          },
>          "queue_details":{
>             "name":"items_bigqueue",
>             "vhost":"items"
>          },
>          "consumer_tag":"amq.ctag-wuYNkpbMVPjTEFDIG4Xt4q",
>          "exclusive":false,
>          "ack_required":true
>       }
>    ],
>    "name":"items_bigqueue",
>    "vhost":"items",
>    "durable":true,
>    "auto_delete":false,
>    "arguments":{
>
>    },
>    "node":"rabbit at i-00000007-asm"
> }
>
> Cheers,
> Pablo
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120507/b3c2674b/attachment-0001.htm>

From kenneth at loafman.com  Mon May  7 20:10:33 2012
From: kenneth at loafman.com (Kenneth Loafman)
Date: Mon, 7 May 2012 14:10:33 -0500
Subject: [rabbitmq-discuss] 1 Fanout Exchange, 2 queues, 1 slow, 1 fast
Message-ID: <CAD-_Ma0nqA7icq1dydGOYniiKhtRTJUJ65QEJT5UKrm4TzE8rQ@mail.gmail.com>

Hi,

I've got a fanout exchange running two queues.  One queue is responding
very quickly like normal, the other is intermittent.  What would cause
this?  The fast queue has 3 consumers, the slow queue has 64 consumers.  Is
there a limit to how many consumers can be attached to a queue?

I'm on the current version, 2.8.2, Ubuntu Lucid, up-to-date.  What would
you need to diagnose the problem.

...Thanks,
...Ken
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120507/3566bc8a/attachment.htm>

From konstantin.kalin at gmail.com  Mon May  7 23:24:24 2012
From: konstantin.kalin at gmail.com (Konstantin Kalin)
Date: Mon, 7 May 2012 15:24:24 -0700
Subject: [rabbitmq-discuss] Direct vs Topic exchange - Question
In-Reply-To: <144C8DEA-9686-4C66-9962-120E8AE5B321@gmail.com>
References: <87d7fc6b-cad6-42ab-8a34-afe1846e8332@a8g2000pbe.googlegroups.com>
	<4FA137CA.2000809@rabbitmq.com>
	<314905EC-5B0F-4469-BDCD-FF86F6C12078@gmail.com>
	<4FA25A16.9050509@rabbitmq.com>
	<A00D3409-DCA0-4D76-ABB7-99B0ACBA746F@gmail.com>
	<4FA3AB6F.6030201@rabbitmq.com>
	<144C8DEA-9686-4C66-9962-120E8AE5B321@gmail.com>
Message-ID: <D51F868A-9EC9-44E4-A419-FC72E2B93593@gmail.com>

Hello, Simon.

Finally I found an answer why we had different results with same test code. Something is wrong between KVM virtualization and RabbitMQ when Topic Exchange is used :) At least once I started RabbitMQ on physical server I get understandable results: 90k on Direct Exchange and 75k on Topic exchange. I have checked Network link for RabbitMQ VM and it doesn't look bad. I will continue digging around to find an explanation why it happens. If you can provide any additional advice I will really appreciate it.  

Thank you,
Konstantin. 

On May 4, 2012, at 1:51 PM, Konstantin Kalin wrote:

> Hello, Simon.
> 
> Thank you for your help here. See inline. 
> 
> On May 4, 2012, at 3:11 AM, Simon MacMullen wrote:
> 
>>    amqp_channel:cast(Channel, Publish, Msg).
>> 
>> Since this is pushing messages as fast as possible into the client channel process, you end up filling its mailbox as you can give it messages faster than it can send them out on the wire.
>> 
> 
> Yes. I know about this and this is why I created rate control on Client side. I thought that amqp_channel:cast(Channel, Publish, Msg) is better way to create a load :) Well, I have changed it to amqp_channel:call. Thank you for the advice. 
> 
> 
>> direct, 1 producer,   1 consumer:   ~25kHz
>> topic,  1 producer,   1 consumer:   ~14kHz
>> direct, 10 producers, 10 consumers: ~25kHz
>>        (but queues grew since consumers could not keep up)
>> topic,  10 producers, 10 consumers: ~16kHz
>> 
>> on my workstation. This is very roughly what I would expect - with tiny messages quite a lot of the cost of each message is routing, and topic routing *is* more complex.
>> 
> 
> Well. It looks much better than I have :) And this is why I have asked to guide me what I'm doing wrong. I believe that RabbitMQ is great product and this is why I spend time on different tests to gain better understanding how it works. Thus I will use RabbitMQ more effectively. 
>   
>> So I'm afraid I don't really trust the results you got - how were you choosing a rate limit for the client? Too low and you're not driving the broker as hard as you can, and with that cast in place, too high and you'll start to eat all memory and eventually cause RabbitMQ to get swapped out.
>> 
> Understood. Usually the load test results causes a lot of confusions and questions since people makes load-tests for particular cases. 
> Please don't treat me wrong. I don't blame RabbitMQ. I rather will blame me for these strange results. 
> 
> Let me explain my test setup:
> I have two physical servers: 16 AuthenticAMD CPU, 16 Gb memory each. I use one physical server to virtualize RabbitMQ using KVM. RabbitMQ has 8 CPU and 4Gb. And there are no other VMs running on this physical server. And I use second physical server to run Consumer/Publisher code that you tried. 
> 
> I repeated the test with direct and topic exchanges after I modified the code as mentioted above. 
> 10 consumers and publishers for each type of exchange. I started publishing using following commands:
> Test 1 - publisher:start_publish(<<"kkalin_test1">>, <<"topic">>, 20000, 20000, 10, 0).
> Test 2 - publisher:start_publish(<<"kkalin_test">>, <<"direct">>, 20000, 20000, 10, 0). 
> 
> I got: ~4k for Topic and ~60k for Direct :) See attached screenshots. I don't understand why. And I think it's hard to blame that publisher_wrk works slow for Topic exchange. There is no dedicated logic in software code that can affect messages rate depending on Exchange type. Same code, same machines and results with big differences. :(
> 
> May be you can provide a few advices what I can check to understand where is a bottle neck? 
> According to vmstat and htop, RabbitMQ and Client servers were not loaded in case of Topic Exchange. Looks like that RabbitMQ and Publisher are waiting each other. 
> 
> Thank you for patience,
> Kostya. 
> 
> <Screen Shot 2012-05-04 at 12.57.24 PM.png>
> <Screen Shot 2012-05-04 at 1.09.10 PM.png>
> 
> 
> 


From videlalvaro at gmail.com  Mon May  7 23:29:10 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 8 May 2012 00:29:10 +0200
Subject: [rabbitmq-discuss] Direct vs Topic exchange - Question
In-Reply-To: <D51F868A-9EC9-44E4-A419-FC72E2B93593@gmail.com>
References: <87d7fc6b-cad6-42ab-8a34-afe1846e8332@a8g2000pbe.googlegroups.com>
	<4FA137CA.2000809@rabbitmq.com>
	<314905EC-5B0F-4469-BDCD-FF86F6C12078@gmail.com>
	<4FA25A16.9050509@rabbitmq.com>
	<A00D3409-DCA0-4D76-ABB7-99B0ACBA746F@gmail.com>
	<4FA3AB6F.6030201@rabbitmq.com>
	<144C8DEA-9686-4C66-9962-120E8AE5B321@gmail.com>
	<D51F868A-9EC9-44E4-A419-FC72E2B93593@gmail.com>
Message-ID: <FFA115EFB0D647368BF9C294B7B25BD9@gmail.com>

Have you checked Disk I/O performance? 

A binding on a topic exchange has a bit more entries in Mnesia than the other exchanges. 

Regards,

Alvaro 

-- 
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)


On Tuesday, May 8, 2012 at 12:24 AM, Konstantin Kalin wrote:

> Hello, Simon.
> 
> Finally I found an answer why we had different results with same test code. Something is wrong between KVM virtualization and RabbitMQ when Topic Exchange is used :) At least once I started RabbitMQ on physical server I get understandable results: 90k on Direct Exchange and 75k on Topic exchange. I have checked Network link for RabbitMQ VM and it doesn't look bad. I will continue digging around to find an explanation why it happens. If you can provide any additional advice I will really appreciate it. 
> 
> Thank you,
> Konstantin. 
> 
> On May 4, 2012, at 1:51 PM, Konstantin Kalin wrote:
> 
> > Hello, Simon.
> > 
> > Thank you for your help here. See inline. 
> > 
> > On May 4, 2012, at 3:11 AM, Simon MacMullen wrote:
> > 
> > > amqp_channel:cast(Channel, Publish, Msg).
> > > 
> > > Since this is pushing messages as fast as possible into the client channel process, you end up filling its mailbox as you can give it messages faster than it can send them out on the wire.
> > 
> > Yes. I know about this and this is why I created rate control on Client side. I thought that amqp_channel:cast(Channel, Publish, Msg) is better way to create a load :) Well, I have changed it to amqp_channel:call. Thank you for the advice. 
> > 
> > 
> > > direct, 1 producer, 1 consumer: ~25kHz
> > > topic, 1 producer, 1 consumer: ~14kHz
> > > direct, 10 producers, 10 consumers: ~25kHz
> > > (but queues grew since consumers could not keep up)
> > > topic, 10 producers, 10 consumers: ~16kHz
> > > 
> > > on my workstation. This is very roughly what I would expect - with tiny messages quite a lot of the cost of each message is routing, and topic routing *is* more complex.
> > 
> > Well. It looks much better than I have :) And this is why I have asked to guide me what I'm doing wrong. I believe that RabbitMQ is great product and this is why I spend time on different tests to gain better understanding how it works. Thus I will use RabbitMQ more effectively. 
> > 
> > > So I'm afraid I don't really trust the results you got - how were you choosing a rate limit for the client? Too low and you're not driving the broker as hard as you can, and with that cast in place, too high and you'll start to eat all memory and eventually cause RabbitMQ to get swapped out.
> > 
> > Understood. Usually the load test results causes a lot of confusions and questions since people makes load-tests for particular cases. 
> > Please don't treat me wrong. I don't blame RabbitMQ. I rather will blame me for these strange results. 
> > 
> > Let me explain my test setup:
> > I have two physical servers: 16 AuthenticAMD CPU, 16 Gb memory each. I use one physical server to virtualize RabbitMQ using KVM. RabbitMQ has 8 CPU and 4Gb. And there are no other VMs running on this physical server. And I use second physical server to run Consumer/Publisher code that you tried. 
> > 
> > I repeated the test with direct and topic exchanges after I modified the code as mentioted above. 
> > 10 consumers and publishers for each type of exchange. I started publishing using following commands:
> > Test 1 - publisher:start_publish(<<"kkalin_test1">>, <<"topic">>, 20000, 20000, 10, 0).
> > Test 2 - publisher:start_publish(<<"kkalin_test">>, <<"direct">>, 20000, 20000, 10, 0). 
> > 
> > I got: ~4k for Topic and ~60k for Direct :) See attached screenshots. I don't understand why. And I think it's hard to blame that publisher_wrk works slow for Topic exchange. There is no dedicated logic in software code that can affect messages rate depending on Exchange type. Same code, same machines and results with big differences. :(
> > 
> > May be you can provide a few advices what I can check to understand where is a bottle neck? 
> > According to vmstat and htop, RabbitMQ and Client servers were not loaded in case of Topic Exchange. Looks like that RabbitMQ and Publisher are waiting each other. 
> > 
> > Thank you for patience,
> > Kostya. 
> > 
> > <Screen Shot 2012-05-04 at 12.57.24 PM.png>
> > <Screen Shot 2012-05-04 at 1.09.10 PM.png>
> > 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/41d65805/attachment.htm>

From clarsen at euphoriaaudio.com  Tue May  8 01:54:00 2012
From: clarsen at euphoriaaudio.com (Chris Larsen)
Date: Mon, 7 May 2012 20:54:00 -0400
Subject: [rabbitmq-discuss] Missing Durable Queues on Startup
Message-ID: <001d01cd2cb5$0eb184b0$2c148e10$@euphoriaaudio.com>

Hello, we ran into an odd situation today where RabbitMQ seemed to start
properly but it didn't load most of the durable queues from the mnesia.
Running stop_app, then start_app brought back some of the queues but not
all. After we found out that not all queues were restored (after a few
hours), running stop_app, then start_app again brought the rest of the
queues online. Has anyone run into a similar situation?

 

Here are some notes about our setup with a few log entries from the logs
below. We have 6 machines in the cluster split into pairs running drbd and
pacemaker for failover. A glitchy switch caused one of these pairs to
split-brain and both MQ resources wound up on the same physical host. Drbd
seemed to be fine and after we resolved the split-brain, that's when we
noticed the missing queues. There weren't any errors in the startup_log or
startup_err files. We're not using HA in rabbit itself, the queues are just
persistent and durable on each node in the cluster.

 

We had a number of messages in the SASL logs with "nodedown" so I wonder if
the MQ instances simply didn't join the cluster properly the first couple of
times but finally did on the last try? I didn't check the status of the
nodes in the cluster on each node (as suggested elsewhere) in between
restarts but I'll give that a try if it happens again. Thanks for your help!

 

RabbitMQ 2.5.1

Erlang R13B03

Ubuntu Server 64bit 2.6.38-10

drbd 8.3.7

 

=ERROR REPORT==== 7-May-2012::10:11:30 ===

Mnesia('rabbit2 at host2'): ** ERROR ** Mnesia on 'rabbit2 at host2' could not
connect to node(s) ['rabbit1 at host1']

 

=INFO REPORT==== 7-May-2012::10:11:30 ===

Limiting to approx 32668 file handles (29399 sockets)

 

=INFO REPORT==== 7-May-2012::10:12:46 ===

msg_store_transient: using rabbit_msg_store_ets_index to provide index

 

=INFO REPORT==== 7-May-2012::10:12:46 ===

msg_store_persistent: using rabbit_msg_store_ets_index to provide index

 

=WARNING REPORT==== 7-May-2012::10:12:46 ===

msg_store_persistent: rebuilding indices from scratch

 

=INFO REPORT==== 7-May-2012::10:12:46 ===

started TCP Listener on 192.168.1.1:5672

 

=ERROR REPORT==== 7-May-2012::10:13:42 ===

Mnesia('rabbit2 at host2'): ** ERROR ** mnesia_event got
{inconsistent_database, starting_partitioned_network, 'rabbit1 at host3'}

 

=ERROR REPORT==== 7-May-2012::10:13:42 ===

Mnesia('rabbit2 at host2'): ** ERROR ** mnesia_event got
{inconsistent_database, starting_partitioned_network, 'rabbit2 at host4'}

 

=SUPERVISOR REPORT==== 7-May-2012::10:13:32 ===

     Supervisor: {<0.11398.2442>,rabbit_channel_sup}

     Context:    shutdown

     Reason:     reached_max_restart_intensity

     Offender:   [{pid,<0.11400.2442>},

                  {name,channel},

                  {mfa,

                      {rabbit_channel,start_link,

                          [1,<0.11368.2442>,<0.11399.2442>,<0.11368.2442>,

                           rabbit_framing_amqp_0_9_1,

                           {user,<<"my_app">>,true,

                               rabbit_auth_backend_internal,

                               {internal_user,<<"my_app">>,

 
<<199,64,175,52,127,65,248,9,70,171,15,9,5,

                                     122,73,4,195,147,238,67>>,

                                   true}},

                           <<"/my_app">>,[],<0.11366.2442>,

                           #Fun<rabbit_channel_sup.0.15412730>]}},

                  {restart_type,intrinsic},

                  {shutdown,4294967295},

                  {child_type,worker}]

 

 

=CRASH REPORT==== 7-May-2012::10:13:33 ===

  crasher:

    initial call: gen:init_it/6

    pid: <0.25562.2442>

    registered_name: []

    exception exit: {{badmatch,

                         {error,

                             [{<7748.8396.531>,

                               {exit,

                                   {nodedown,'rabbit1 at host1'},

                                   []}}]}},

                     [{rabbit_channel,terminate,2},

                      {gen_server2,terminate,3},

                      {proc_lib,wake_up,3}]}

      in function  gen_server2:terminate/3

    ancestors: [<0.25560.2442>,<0.25544.2442>,<0.25542.2442>,

                  rabbit_tcp_client_sup,rabbit_sup,<0.124.0>]

    messages: []

    links: [<0.25560.2442>]

    dictionary: [{{exchange_stats,

                       {resource,<<"/my_app">>,exchange,

                           <<"service.exchange">>}},

                   [{confirm,6},{publish,6}]},

                  {{queue_exchange_stats,

                       {<0.253.0>,

                        {resource,<<"/my_app">>,exchange,

                            <<"data.exchange">>}}},

                   [{confirm,6},{publish,6}]},

                  {delegate,delegate_4},

                  {{monitoring,<0.253.0>},true},

                  {{exchange_stats,

                       {resource,<<"/my_app">>,exchange,

                           <<"data.exchange">>}},

                   [{confirm,6},{publish,6}]},

                  {guid,{{11,<0.25562.2442>},11}}]

    trap_exit: true

    status: running

    heap_size: 987

    stack_size: 24

    reductions: 11357

  neighbours:

 

=SUPERVISOR REPORT==== 7-May-2012::10:13:33 ===

     Supervisor: {<0.25560.2442>,rabbit_channel_sup}

     Context:    child_terminated

     Reason:     {{badmatch,

                      {error,

                          [{<7748.8396.531>,

                            {exit,{nodedown,'rabbit1 at host1'},[]}}]}},

                  [{rabbit_channel,terminate,2},

                   {gen_server2,terminate,3},

                   {proc_lib,wake_up,3}]}

     Offender:   [{pid,<0.25562.2442>},

                  {name,channel},

                  {mfa,

                      {rabbit_channel,start_link,

                          [1,<0.25545.2442>,<0.25561.2442>,<0.25545.2442>,

                           rabbit_framing_amqp_0_9_1,

                           {user,<<"my_app">>,true,

                               rabbit_auth_backend_internal,

                               {internal_user,<<"my_app">>,

 
<<199,64,175,52,127,65,248,9,70,171,15,9,5,

                                     122,73,4,195,147,238,67>>,

                                   true}},

                           <<"/my_app">>,[],<0.25543.2442>,

                           #Fun<rabbit_channel_sup.0.15412730>]}},

                  {restart_type,intrinsic},

                  {shutdown,4294967295},

                  {child_type,worker}]

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120507/41fc7d3b/attachment.htm>

From munni at etrade.com  Tue May  8 02:33:21 2012
From: munni at etrade.com (Unni, Monish)
Date: Tue, 8 May 2012 01:33:21 +0000
Subject: [rabbitmq-discuss] immediate, mandatory flag with no consumers
In-Reply-To: <CAAt2poJN9bxc51wUxViKSexiiqmdiKYWssH=bCy-Tr694=W2oQ@mail.gmail.com>
References: <fa3b9c55-7577-41c3-80f2-9176d4736a30@u7g2000yqc.googlegroups.com>
	<4F996269.1050005@rabbitmq.com>
	<CAPwx=WNGYvmRaQe5F1_0w5bObzKuhdORGnwKhoT6sX-yUZaTBw@mail.gmail.com>
	<4F99787E.8030501@rabbitmq.com>
	<AC888676-0872-4116-A55E-03FE45C567D8@etrade.com>
	<4FA2A7D1.9070105@rabbitmq.com>
	<A3FFF2F5-B03D-4F0D-930B-1CEB2FA3004A@etrade.com>
	<4FA3A257.6000709@rabbitmq.com>
	<57E70C22-4040-4F88-8B6F-32580537AF02@etrade.com>
	<CAAt2poJN9bxc51wUxViKSexiiqmdiKYWssH=bCy-Tr694=W2oQ@mail.gmail.com>
Message-ID: <9399B902-3BA9-43FB-B9D3-D7CF3ADB9A09@etrade.com>

this is super cool, Alan! thanks for the great pointers!

we also found for rabbitmq, we could use "alternate-exchange" (extension), since, we are mostly calling services that are built in-house.
this seems to be a very generic way to handle "non-routable" calls.
the restriction seems to be this  exchange cannot be built on "amq.direct" as an "alternate-exchange" needs to be specified at the time of creation - is this right?

for "no-consumers" i am not sure if we have any "broker" level setting except using "dead-letter-messages" as given : http://www.rabbitmq.com/extensions.html#dead-letter-messages
[also, we are loosely-coupled, i.e we really don't want "transaction-level" broker semantics, so "confirmation" is not an option...]

am i right? are there any other settings we can make use of?

regards,
-monish



On May 7, 2012, at 9:18 AM, Alan Antonuk wrote:

Monish;

As a short answer: there the rabbitmq-c does not provide an easy-to-use interface to deal with basic.return messages from the broker.

The long answer: it is possible, with a bit of work:

The easy part: reading a basic.return message from the broker, its almost the same as a basic.deliver of a message:
- Read the method (1 frame), only instead of a basic.deliver, you get a basic.return method
- Read the message header (1 frame)
- Read message body (1+ frames)

Example code: https://github.com/alanxz/rabbitmq-c/blob/master/examples/amqp_consumer.c#L75  Note that line 83 will need to compare against AMQP_BASIC_RETURN_METHOD instead of AMQP_BASIC_DELIVER_METHOD

That's the easy part, the hard part requires a bit more explanation:

As you can already tell the rabbitmq-c client works a bit differently from the Java and C# clients in that it doesn't have its own internal event loop that deals the the asynchronous bits of AMQP, so using the library forces you to think about how you're going to handle these asynchronous messages from the broker.

The first thing to note is that basic.publish method is an asynchronous[1] AMQP method: a client sends a basic.publish on a channel, and does wait for the broker to respond before continuing.  In fact: if all you're doing is publishing messages to the broker, the broker won't send anything to the client unless something goes wrong (this is part of what makes AMQP a high-performance messaging protocol).  Whats more: since the basic.publish is asynchronous, if something goes wrong on the broker, you won't know immediately after publishing (e.g., calling the rabbitmq-c amqp_basic_publish(...) function ). The failure is transmitted as an AMQP method 'at some point in the future' meaning, likely you'll get an error pretty quickly, but you have to be able to deal with the case that it might happen a bit later.

Since rabbitmq-c doesn't have its own thread sitting there dealing with error messages, and the amqp_basic_publish(...) doesn't do any sort of read on the socket from the broker (the return value only indicates an error if there was a failure writing the message to the socket to the broker), you have to check periodically for methods from the broker.

You do this by using amqp_simple_wait_frame().  However this can block on a read() on the socket if the broker hasn't sent anything.  The way to get around this is to use amqp_get_sockfd() on the connection object, then use something like select(), amqp_frames_enqueued(), and amqp_data_in_buffer() to detect there is potentially a frame to be read from the broker.

An example of a library that does this is SimpleAmqpClient: https://github.com/alanxz/SimpleAmqpClient/blob/master/src/Channel.cpp#L283 . It uses publisher-confirms to make the basic.publish method a synchronous process.  If you sift through the ChannelImpl::GetMethodOnChannel() implementation, you can see what needs to be done to poll the socket for frames.

[1] The AMQP basic.publish method can be made synchronous by enabling publisher-confirms. However, this does come at a performance cost: there is a full network round-trip for each basic.publish.

HTH
-Alan

As a personal plug the SimpleAmqpClient library can be found: https://github.com/alanxz/SimpleAmqpClient. It wraps the rabbitmq-c library in a (hopefully) easy-to-use synchronous c++ interface.  Since it uses publisher-confirms and waits for a confirmation before allowing another message to be sent, it won't have the best message publish through-put (I can get 3-4k-msg/s, whereas using unconfirmed messages I've seen as high as 20-25k-msg/s over a single connection).

On Fri, May 4, 2012 at 3:43 PM, Unni, Monish <munni at etrade.com<mailto:munni at etrade.com>> wrote:
Thanks for your replies Emile!

the only thing close to the c-client for basic.return i found this : https://groups.google.com/forum/#!msg/rabbitmq-discuss/fHL9tQHj4s0/FxCQxx4khKQJ
not sure if it does the same thing as java-api.

or if you could link me to github for this functionality.

kind regards,
-monish

On May 4, 2012, at 2:33 AM, Emile Joubert wrote:

> Hi,
>
> On 04/05/12 05:19, Unni, Monish wrote:
>> * is it okay to pair request-reply channels and use the same
>> connection to provide "maximum" concurrency?
>
> It is okay to send and receive messages on the same connection. Bear in
> mind that if the broker decides to block the connection then all
> channels in that connection will be affected. I'm not sure you will
> achieve higher concurrency this way.
>
>> * how can we get this feature working for "C" clients ( C- api ) ?
>
> Have you taken a look at the C client examples?
>
>> * and last : is my understanding right ( from observation ) that the
>> request channel and reply-channels have to share the same connection
>> for this feature to work?
>
> In general requests and their corresponding replies do not have to share
> a connection, but for basic.return to work the return handler must share
> a channel with the publisher.
>
> -Emile
>

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From konstantin.kalin at gmail.com  Tue May  8 04:48:40 2012
From: konstantin.kalin at gmail.com (Konstantin Kalin)
Date: Mon, 7 May 2012 20:48:40 -0700
Subject: [rabbitmq-discuss] Direct vs Topic exchange - Question
In-Reply-To: <FFA115EFB0D647368BF9C294B7B25BD9@gmail.com>
References: <87d7fc6b-cad6-42ab-8a34-afe1846e8332@a8g2000pbe.googlegroups.com>
	<4FA137CA.2000809@rabbitmq.com>
	<314905EC-5B0F-4469-BDCD-FF86F6C12078@gmail.com>
	<4FA25A16.9050509@rabbitmq.com>
	<A00D3409-DCA0-4D76-ABB7-99B0ACBA746F@gmail.com>
	<4FA3AB6F.6030201@rabbitmq.com>
	<144C8DEA-9686-4C66-9962-120E8AE5B321@gmail.com>
	<D51F868A-9EC9-44E4-A419-FC72E2B93593@gmail.com>
	<FFA115EFB0D647368BF9C294B7B25BD9@gmail.com>
Message-ID: <D8A04561-EBC4-4248-B050-72EF72675194@gmail.com>

Hello, Alvaro.

Thank you for the advise. I had already checked that. Disk IO seems to be fine and VM is slightly loaded. Looks like there is a bottleneck and it's visible surprisingly only when Topic Exchange is used. I will continue digging. If I find an explanation I will let the community know. Initially this strange behavior was totally mystery since I didn't think I could have it because of Virtualization :)

Thank you,
Konstantin.

On May 7, 2012, at 3:29 PM, Alvaro Videla wrote:

> Have you checked Disk I/O performance? 
> 
> A binding on a topic exchange has a bit more entries in Mnesia than the other exchanges.
> 
> Regards,
> 
> Alvaro
> 
> -- 
> Sent with Sparrow
> 
> On Tuesday, May 8, 2012 at 12:24 AM, Konstantin Kalin wrote:
> 
>> Hello, Simon.
>> 
>> Finally I found an answer why we had different results with same test code. Something is wrong between KVM virtualization and RabbitMQ when Topic Exchange is used :) At least once I started RabbitMQ on physical server I get understandable results: 90k on Direct Exchange and 75k on Topic exchange. I have checked Network link for RabbitMQ VM and it doesn't look bad. I will continue digging around to find an explanation why it happens. If you can provide any additional advice I will really appreciate it.
>> 
>> Thank you,
>> Konstantin.
>> 
>> On May 4, 2012, at 1:51 PM, Konstantin Kalin wrote:
>> 
>>> Hello, Simon.
>>> 
>>> Thank you for your help here. See inline.
>>> 
>>> On May 4, 2012, at 3:11 AM, Simon MacMullen wrote:
>>> 
>>>> amqp_channel:cast(Channel, Publish, Msg).
>>>> 
>>>> Since this is pushing messages as fast as possible into the client channel process, you end up filling its mailbox as you can give it messages faster than it can send them out on the wire.
>>> 
>>> Yes. I know about this and this is why I created rate control on Client side. I thought that amqp_channel:cast(Channel, Publish, Msg) is better way to create a load :) Well, I have changed it to amqp_channel:call. Thank you for the advice.
>>> 
>>> 
>>>> direct, 1 producer, 1 consumer: ~25kHz
>>>> topic, 1 producer, 1 consumer: ~14kHz
>>>> direct, 10 producers, 10 consumers: ~25kHz
>>>> (but queues grew since consumers could not keep up)
>>>> topic, 10 producers, 10 consumers: ~16kHz
>>>> 
>>>> on my workstation. This is very roughly what I would expect - with tiny messages quite a lot of the cost of each message is routing, and topic routing *is* more complex.
>>> 
>>> Well. It looks much better than I have :) And this is why I have asked to guide me what I'm doing wrong. I believe that RabbitMQ is great product and this is why I spend time on different tests to gain better understanding how it works. Thus I will use RabbitMQ more effectively.
>>>> So I'm afraid I don't really trust the results you got - how were you choosing a rate limit for the client? Too low and you're not driving the broker as hard as you can, and with that cast in place, too high and you'll start to eat all memory and eventually cause RabbitMQ to get swapped out.
>>> Understood. Usually the load test results causes a lot of confusions and questions since people makes load-tests for particular cases.
>>> Please don't treat me wrong. I don't blame RabbitMQ. I rather will blame me for these strange results.
>>> 
>>> Let me explain my test setup:
>>> I have two physical servers: 16 AuthenticAMD CPU, 16 Gb memory each. I use one physical server to virtualize RabbitMQ using KVM. RabbitMQ has 8 CPU and 4Gb. And there are no other VMs running on this physical server. And I use second physical server to run Consumer/Publisher code that you tried.
>>> 
>>> I repeated the test with direct and topic exchanges after I modified the code as mentioted above.
>>> 10 consumers and publishers for each type of exchange. I started publishing using following commands:
>>> Test 1 - publisher:start_publish(<<"kkalin_test1">>, <<"topic">>, 20000, 20000, 10, 0).
>>> Test 2 - publisher:start_publish(<<"kkalin_test">>, <<"direct">>, 20000, 20000, 10, 0).
>>> 
>>> I got: ~4k for Topic and ~60k for Direct :) See attached screenshots. I don't understand why. And I think it's hard to blame that publisher_wrk works slow for Topic exchange. There is no dedicated logic in software code that can affect messages rate depending on Exchange type. Same code, same machines and results with big differences. :(
>>> 
>>> May be you can provide a few advices what I can check to understand where is a bottle neck?
>>> According to vmstat and htop, RabbitMQ and Client servers were not loaded in case of Topic Exchange. Looks like that RabbitMQ and Publisher are waiting each other.
>>> 
>>> Thank you for patience,
>>> Kostya.
>>> 
>>> <Screen Shot 2012-05-04 at 12.57.24 PM.png>
>>> <Screen Shot 2012-05-04 at 1.09.10 PM.png>
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120507/125040fc/attachment.htm>

From matthias at rabbitmq.com  Tue May  8 07:51:10 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 08 May 2012 07:51:10 +0100
Subject: [rabbitmq-discuss] Direct vs Topic exchange - Question
In-Reply-To: <FFA115EFB0D647368BF9C294B7B25BD9@gmail.com>
References: <87d7fc6b-cad6-42ab-8a34-afe1846e8332@a8g2000pbe.googlegroups.com>	<4FA137CA.2000809@rabbitmq.com>	<314905EC-5B0F-4469-BDCD-FF86F6C12078@gmail.com>	<4FA25A16.9050509@rabbitmq.com>	<A00D3409-DCA0-4D76-ABB7-99B0ACBA746F@gmail.com>	<4FA3AB6F.6030201@rabbitmq.com>	<144C8DEA-9686-4C66-9962-120E8AE5B321@gmail.com>	<D51F868A-9EC9-44E4-A419-FC72E2B93593@gmail.com>
	<FFA115EFB0D647368BF9C294B7B25BD9@gmail.com>
Message-ID: <4FA8C25E.6030206@rabbitmq.com>

On 07/05/12 23:29, Alvaro Videla wrote:
> Have you checked Disk I/O performance?
>
> A binding on a topic exchange has a bit more entries in Mnesia than the
> other exchanges.

That would only affect creation/deletion of durable 
exchanges/queues/bindings. Message routing does not touch the disk.

Matthias.

From ka.fukui at ms.scsk.jp  Tue May  8 10:09:13 2012
From: ka.fukui at ms.scsk.jp (Katsushi Fukui)
Date: Tue, 08 May 2012 18:09:13 +0900
Subject: [rabbitmq-discuss] Mirrored queue failover
In-Reply-To: <4F8FA5A7.3060502@ms.scsk.jp>
References: <4F7D5C28.8000202@ms.scsk.jp> <20120405112633.GA17466@rabbitmq.com>
	<4F7E5B59.4060005@ms.scsk.jp> <4F855310.1050407@ms.scsk.jp>
	<20120416131639.GB14212@wellquite.org> <4F8D31EF.4050709@ms.scsk.jp>
	<4F8FA5A7.3060502@ms.scsk.jp>
Message-ID: <4FA8E2B9.1060601@ms.scsk.jp>

I also checked this issue with v2.8.2, but the situation is not improved.

Kats


(2012/04/19 14:41), Katsushi Fukui wrote:
> Hi Matthew,
>
> I found an interesting behavior and logs when I repeatedly restarted a node of the cluster.
> I rebuilt a new cluster and checked a logs of the mirrored queue again. Now the master of the mirrored queue is rabbit1, the slaves are rabbit2 and rabbit3. When rabbit3 is stopped, the logs of the rabbit1 shows:
> =INFO REPORT==== 19-Apr-2012::11:18:58 ===
> Mirrored-queue (queue 'que1' in vhost '/'): Master <rabbit at rabbit1.2.594.0> saw deaths of mirrors <rabbit at rabbit3.3.229.0>
>
> =INFO REPORT==== 19-Apr-2012::11:18:59 ===
> rabbit on node rabbit at rabbit3 down
>
>
> This means that que1 detected death of the queue slave on rabbit3 and node is down. But if I repeat restarting the slaves over and over, sometime logs shows like this:
> =INFO REPORT==== 19-Apr-2012::11:56:26 ===
> Mirrored-queue (queue 'que1' in vhost '/'): Master <rabbit at rabbit1.2.594.0> saw deaths of mirrors <rabbit at rabbit3.3.229.0>
>
> =INFO REPORT==== 19-Apr-2012::11:56:26 ===
> rabbit on node rabbit at rabbit3 down
>
> =INFO REPORT==== 19-Apr-2012::11:56:35 ===
> rabbit on node rabbit at rabbit3 up
>
> =INFO REPORT==== 19-Apr-2012::11:56:38 ===
> rabbit on node rabbit at rabbit2 down
>
> =INFO REPORT==== 19-Apr-2012::11:59:32 ===
> rabbit on node rabbit at rabbit2 up
>
>
> Despite stopping rabbit2, que1 doesn't report death of mirror. Now rabbit2 is up, but que1 has only one slave on rabbit3.?Next, I stopped rabbit3 and the logs shows:
> =INFO REPORT==== 19-Apr-2012::12:00:04 ===
> Mirrored-queue (queue 'que1' in vhost '/'): Master <rabbit at rabbit1.2.594.0> saw deaths of mirrors <rabbit at rabbit2.3.229.0> <rabbit at rabbit3.1.227.0>
>
> =INFO REPORT==== 19-Apr-2012::12:00:04 ===
> rabbit on node rabbit at rabbit3 down
>
> Que1 detected deaths of two slaves. Finally I restarted rabbit2 and rabbit3, so que1 got two slaves.
> It looks there is a case a mirrored queue can not detect the failure of the slaves.
>
> Kats
>
>
>> Thank you, Matthew,
>>
>> I created an exchange "ex1" that is bound to que1, and published a message using a publisher was connected to rabbit3 as you suggested.
>> I could send it without returning error, but the logs of rabbit3 shows this error:
>> =ERROR REPORT==== 17-Apr-2012::11:12:30 ===
>> Discarding message {'$gen_cast',{deliver,{delivery,false,false,<0.3061.0>,{basic_message,{resource,<<1 byte>>,exchange,<<3 bytes>>},[<<5 bytes>>],{content,60,{'P_basic',<<10 bytes>>,undefined,undefined,2,0,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined},<<15 bytes>>,rabbit_framing_amqp_0_9_1,[<<12 bytes>>]},<<16 bytes>>,true},undefined},flow}} from <0.3061.0> to <0.229.0> in an old incarnation (3) of this node (2)
>>
>> The result of list_queues is:
>> # ./rabbitmqctl list_queues name messages slave_pids synchronised_slave_pids
>> Listing queues ...
>> que1 1 [<rabbit at rabbit2.1.229.0>] [<rabbit at rabbit2.1.229.0>]
>> ...done.
>>
>> I wonder if this problem is only occurred in my environment.
>>



From simon at rabbitmq.com  Tue May  8 10:53:15 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 May 2012 10:53:15 +0100
Subject: [rabbitmq-discuss] A cluster on a single machine
In-Reply-To: <CAAR1VGeN42CVZaq_DuhEwVCBUw2e-uQtSPHOvfUv7HiyzhUkqg@mail.gmail.com>
References: <26900763.505.1336149989357.JavaMail.geo-discussion-forums@vbbh3>	<4FA40B43.7000201@rabbitmq.com>
	<CAAR1VGeN42CVZaq_DuhEwVCBUw2e-uQtSPHOvfUv7HiyzhUkqg@mail.gmail.com>
Message-ID: <4FA8ED0B.3020508@rabbitmq.com>

On 07/05/12 12:05, David Fooks wrote:
> However, after that fix I'm still seeing the same error.

David, did you see this?

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/019883.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue May  8 10:56:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 May 2012 10:56:55 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.2 Disk Space Monitoring issue
In-Reply-To: <CAO1=DnGJbgA4BR=2py+LKjzAzAivOnYXqrSVvPXKPheeK5JXdQ@mail.gmail.com>
References: <CAO1=DnGJbgA4BR=2py+LKjzAzAivOnYXqrSVvPXKPheeK5JXdQ@mail.gmail.com>
Message-ID: <4FA8EDE7.4040009@rabbitmq.com>

On 05/05/12 00:52, Francis Ridder wrote:
> Is there a particular reason
> why you would want space free to be more than 1.0 RAM or is it meant
> to be a sensible default?

Under memory pressure RabbitMQ can page out all the messages in memory - 
it's unlikely to be good news if disc space runs out when this happens.

Of course if you have a gargantuan amount of RAM you are less likely to 
get into this situation in the first place.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From davidfooks at turbulenz.biz  Tue May  8 10:58:40 2012
From: davidfooks at turbulenz.biz (David Fooks)
Date: Tue, 8 May 2012 02:58:40 -0700 (PDT)
Subject: [rabbitmq-discuss] A cluster on a single machine
In-Reply-To: <10143683.692.1336150409331.JavaMail.geo-discussion-forums@vbep19>
References: <26900763.505.1336149989357.JavaMail.geo-discussion-forums@vbbh3>
	<10143683.692.1336150409331.JavaMail.geo-discussion-forums@vbep19>
Message-ID: <27171000.378.1336471120876.JavaMail.geo-discussion-forums@vbqq1>

Right after a hint about using RABBITMQ_PID_FILE (without -detached) I now 
have four scripts. The first 3 are one line scripts run in separate tabs:

RABBITMQ_NODE_PORT=5672 RABBITMQ_PID_FILE="/var/run/rabbitmq/rabbit1.pid" 
RABBITMQ_NODENAME=rabbit1 RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb 
listeners [{mgmt,[{port,55672}]}]" rabbitmq-server
RABBITMQ_NODE_PORT=5673 RABBITMQ_PID_FILE="/var/run/rabbitmq/rabbit2.pid" 
RABBITMQ_NODENAME=rabbit2 RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb 
listeners [{mgmt,[{port,55673}]}]" rabbitmq-server
RABBITMQ_NODE_PORT=5674 RABBITMQ_PID_FILE="/var/run/rabbitmq/rabbit3.pid" 
RABBITMQ_NODENAME=rabbit3 RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb 
listeners [{mgmt,[{port,55674}]}]" rabbitmq-server

Viewing the outputs of these shows that they all have the same cookie hash.

I then run the following start up script:

rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid
rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid

rabbitmqctl -n rabbit1 stop_app
rabbitmqctl -n rabbit1 reset
rabbitmqctl -n rabbit1 start_app

rabbitmqctl -n rabbit2 stop_app
rabbitmqctl -n rabbit2 reset
rabbitmqctl -n rabbit2 start_app

rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid

rabbitmqctl -n rabbit1 status
rabbitmqctl -n rabbit2 status

rabbitmqctl -n rabbit3 stop_app
rabbitmqctl -n rabbit3 reset
rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64 
rabbit2 at dfooks-ubuntu64
rabbitmqctl -n rabbit3 start_app

rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid

rabbitmqctl -n rabbit3 status

But I'm still seeing the following error:

Clustering node 'rabbit3 at dfooks-ubuntu64' with ['rabbit1 at dfooks-ubuntu64',
                                                'rabbit2 at dfooks-ubuntu64'] 
...
Error: {unable_to_join_cluster,
           ['rabbit1 at dfooks-ubuntu64','rabbit2 at dfooks-ubuntu64'],
           {merge_schema_failed,
               "Incompatible schema cookies. Please, restart from old 
backup.'rabbit1 at dfooks-ubuntu64' = 
[{name,schema},{type,set},{ram_copies,[]},{disc_copies,['rabbit1 at dfooks-ubuntu64']},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1336,470172,840474},'rabbit1 at dfooks-ubuntu64'}},{version,{{3,0},{'rabbit1 at dfooks-ubuntu64',{1336,470175,994704}}}}], 
'rabbit3 at dfooks-ubuntu64' = 
[{name,schema},{type,set},{ram_copies,['rabbit3 at dfooks-ubuntu64']},{disc_copies,['rabbit2 at dfooks-ubuntu64']},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1336,470173,940236},'rabbit2 at dfooks-ubuntu64'}},{version,{{3,0},{'rabbit3 at dfooks-ubuntu64',{1336,470176,11792}}}}]\n"}}

So now I am resetting the node but I'm still seeing this issue. Any ideas? 
I might give up and use 2 VMs.

On Friday, 4 May 2012 17:53:29 UTC+1, David Fooks wrote:
>
> Ok the above script is missing something:
>
> ...
> rabbitmqctl -n rabbit3 stop_app
> rabbitmqctl -n rabbit3 reset
> rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64 
> rabbit2 at dfooks-ubuntu64
> rabbitmqctl -n rabbit3 start_app
>
> But this after this change I still get the error.
>
> On Friday, 4 May 2012 17:46:29 UTC+1, David Fooks wrote:
>>
>> Hi,
>>
>> I'm trying to emulate the guide here: 
>> http://www.rabbitmq.com/clustering.html
>>
>> But I'm having a lot of issues! Every time I run I seem to be getting a 
>> different crash. Is this feature actually supported in 2.8.1?
>>
>> Is there a proper way to completely reset all of the state that rabbitmq 
>> creates about other nodes/the cluster? My clean up script at the moment 
>> looks like this:
>>
>> rm /var/run/rabbitmq/*
>> rm -f /var/log/rabbitmq/*
>> rm -rf /var/lib/rabbitmq/*
>>
>> Here is my start-up script (I'm running this with sudo):
>>
>> RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit1 
>> RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners 
>> [{mgmt,[{port,55672}]}]" rabbitmq-server -detached
>> RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=rabbit2 
>> RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners 
>> [{mgmt,[{port,55673}]}]" rabbitmq-server -detached
>> RABBITMQ_NODE_PORT=5674 RABBITMQ_NODENAME=rabbit3 
>> RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners 
>> [{mgmt,[{port,55674}]}]" rabbitmq-server -detached
>>
>> ps -ef | grep rabbit1 | grep -v grep | awk '{print $2}' > 
>> /var/run/rabbitmq/rabbit1.pid
>> ps -ef | grep rabbit2 | grep -v grep | awk '{print $2}' > 
>> /var/run/rabbitmq/rabbit2.pid
>> ps -ef | grep rabbit3 | grep -v grep | awk '{print $2}' > 
>> /var/run/rabbitmq/rabbit3.pid
>>
>> rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
>> rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid
>> rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid
>>
>> rabbitmqctl -n rabbit1 stop_app
>> rabbitmqctl -n rabbit1 reset
>> rabbitmqctl -n rabbit1 start_app
>>
>> rabbitmqctl -n rabbit2 stop_app
>> rabbitmqctl -n rabbit2 reset
>> rabbitmqctl -n rabbit2 start_app
>>
>> rabbitmqctl -n rabbit3 stop_app
>> rabbitmqctl -n rabbit3 reset
>> rabbitmqctl -n rabbit3 start_app
>>
>> rabbitmqctl -n rabbit1 status
>> rabbitmqctl -n rabbit2 status
>> rabbitmqctl -n rabbit3 status
>>
>> rabbitmqctl -n rabbit3 stop_app
>> rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64 
>> rabbit2 at dfooks-ubuntu64
>> rabbitmqctl -n rabbit3 start_app
>>
>> If I run the "clean" script and then this script I get the following 
>> warning (after all of the status returns ok):
>>
>> ...
>> Stopping node 'rabbit3 at dfooks-ubuntu64' ...
>> ...done.
>> Clustering node 'rabbit3 at dfooks-ubuntu64' with ['rabbit1 at dfooks-ubuntu64',
>>                                                 
>> 'rabbit2 at dfooks-ubuntu64'] ...
>> Error: {unable_to_join_cluster,
>>            ['rabbit1 at dfooks-ubuntu64','rabbit2 at dfooks-ubuntu64'],
>>            {merge_schema_failed,
>>                "Incompatible schema cookies. Please, restart from old 
>> backup.'rabbit1 at dfooks-ubuntu64' = 
>> [{name,schema},{type,set},{ram_copies,[]},{disc_copies,['rabbit1 at dfooks-ubuntu64']},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1336,149567,596521},'rabbit1 at dfooks-ubuntu64'}},{version,{{3,0},{'rabbit1 at dfooks-ubuntu64',{1336,149572,870479}}}}], 
>> 'rabbit3 at dfooks-ubuntu64' = 
>> [{name,schema},{type,set},{ram_copies,['rabbit3 at dfooks-ubuntu64']},{disc_copies,['rabbit2 at dfooks-ubuntu64']},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1336,149568,520459},'rabbit2 at dfooks-ubuntu64'}},{version,{{3,0},{'rabbit3 at dfooks-ubuntu64',{1336,149572,882518}}}}]\n"}}
>> Starting node 'rabbit3 at dfooks-ubuntu64' ...
>> Error: {cannot_start_application,rabbitmq_management,
>>            {bad_return,
>>                {{rabbit_mgmt_app,start,[normal,[]]},
>>                 {'EXIT',
>>                     {shutdown,
>>                         {gen_server2,call,
>>                             
>> [<4885.932.0>,{init,<4885.930.0>},infinity]}}}}}}
>>
>> I've read about this error in other threads but it generally seems to be 
>> about network settings being reconfigured between nodes. I shouldn't have 
>> these problems since each instance is on the same machine.
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/27bb2d4f/attachment.htm>

From simon at rabbitmq.com  Tue May  8 10:59:24 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 May 2012 10:59:24 +0100
Subject: [rabbitmq-discuss] .Net client DeclareQueue durable queue,
 queue is deleted after the client application exits.
In-Reply-To: <caa8a235-e906-4c04-9bb5-b9c90cea0c15@y3g2000vbn.googlegroups.com>
References: <caa8a235-e906-4c04-9bb5-b9c90cea0c15@y3g2000vbn.googlegroups.com>
Message-ID: <4FA8EE7C.6090508@rabbitmq.com>

On 04/05/12 20:47, Zongyong Zheng wrote:
> I knew if I can manually create the queue via RabbitMQ management http
> API on the RabbitMQ server, the queue will be durable. However, this
> workaround is not acceptable to me.

What does the .Net-created queue look like in the management plugin? 
i.e. are you *sure* that you are creating the queue durable, 
non-autodelete, non-exclusive? That's the only explanation I can think of...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From francesco at rabbitmq.com  Tue May  8 11:01:27 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 08 May 2012 11:01:27 +0100
Subject: [rabbitmq-discuss] A cluster on a single machine
In-Reply-To: <27171000.378.1336471120876.JavaMail.geo-discussion-forums@vbqq1>
References: <26900763.505.1336149989357.JavaMail.geo-discussion-forums@vbbh3>
	<10143683.692.1336150409331.JavaMail.geo-discussion-forums@vbep19>
	<27171000.378.1336471120876.JavaMail.geo-discussion-forums@vbqq1>
Message-ID: <4FA8EEF7.8020707@rabbitmq.com>

Hi David,

The problem is that you're not clustering the nodes in the correct 
sequence, I think you missed my previous message: 
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/019883.html

Francesco.

On 08/05/12 10:58, David Fooks wrote:
> Right after a hint about using RABBITMQ_PID_FILE (without -detached) I
> now have four scripts. The first 3 are one line scripts run in separate
> tabs:
>
> RABBITMQ_NODE_PORT=5672
> RABBITMQ_PID_FILE="/var/run/rabbitmq/rabbit1.pid"
> RABBITMQ_NODENAME=rabbit1 RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb
> listeners [{mgmt,[{port,55672}]}]" rabbitmq-server
> RABBITMQ_NODE_PORT=5673
> RABBITMQ_PID_FILE="/var/run/rabbitmq/rabbit2.pid"
> RABBITMQ_NODENAME=rabbit2 RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb
> listeners [{mgmt,[{port,55673}]}]" rabbitmq-server
> RABBITMQ_NODE_PORT=5674
> RABBITMQ_PID_FILE="/var/run/rabbitmq/rabbit3.pid"
> RABBITMQ_NODENAME=rabbit3 RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb
> listeners [{mgmt,[{port,55674}]}]" rabbitmq-server
>
> Viewing the outputs of these shows that they all have the same cookie hash.
>
> I then run the following start up script:
>
> rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
> rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid
> rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid
>
> rabbitmqctl -n rabbit1 stop_app
> rabbitmqctl -n rabbit1 reset
> rabbitmqctl -n rabbit1 start_app
>
> rabbitmqctl -n rabbit2 stop_app
> rabbitmqctl -n rabbit2 reset
> rabbitmqctl -n rabbit2 start_app
>
> rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
> rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid
>
> rabbitmqctl -n rabbit1 status
> rabbitmqctl -n rabbit2 status
>
> rabbitmqctl -n rabbit3 stop_app
> rabbitmqctl -n rabbit3 reset
> rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64
> rabbit2 at dfooks-ubuntu64
> rabbitmqctl -n rabbit3 start_app
>
> rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid
>
> rabbitmqctl -n rabbit3 status
>
> But I'm still seeing the following error:
>
> Clustering node 'rabbit3 at dfooks-ubuntu64' with ['rabbit1 at dfooks-ubuntu64',
> 'rabbit2 at dfooks-ubuntu64'] ...
> Error: {unable_to_join_cluster,
> ['rabbit1 at dfooks-ubuntu64','rabbit2 at dfooks-ubuntu64'],
> {merge_schema_failed,
> "Incompatible schema cookies. Please, restart from old
> backup.'rabbit1 at dfooks-ubuntu64' =
> [{name,schema},{type,set},{ram_copies,[]},{disc_copies,['rabbit1 at dfooks-ubuntu64']},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1336,470172,840474},'rabbit1 at dfooks-ubuntu64'}},{version,{{3,0},{'rabbit1 at dfooks-ubuntu64',{1336,470175,994704}}}}],
> 'rabbit3 at dfooks-ubuntu64' =
> [{name,schema},{type,set},{ram_copies,['rabbit3 at dfooks-ubuntu64']},{disc_copies,['rabbit2 at dfooks-ubuntu64']},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1336,470173,940236},'rabbit2 at dfooks-ubuntu64'}},{version,{{3,0},{'rabbit3 at dfooks-ubuntu64',{1336,470176,11792}}}}]\n"}}
>
> So now I am resetting the node but I'm still seeing this issue. Any
> ideas? I might give up and use 2 VMs.
>
> On Friday, 4 May 2012 17:53:29 UTC+1, David Fooks wrote:
>
>     Ok the above script is missing something:
>
>     ...
>     rabbitmqctl -n rabbit3 stop_app
>     rabbitmqctl -n rabbit3 reset
>     rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64
>     rabbit2 at dfooks-ubuntu64
>     rabbitmqctl -n rabbit3 start_app
>
>     But this after this change I still get the error.
>
>     On Friday, 4 May 2012 17:46:29 UTC+1, David Fooks wrote:
>
>         Hi,
>
>         I'm trying to emulate the guide here:
>         http://www.rabbitmq.com/clustering.html
>         <http://www.rabbitmq.com/clustering.html>
>
>         But I'm having a lot of issues! Every time I run I seem to be
>         getting a different crash. Is this feature actually supported in
>         2.8.1?
>
>         Is there a proper way to completely reset all of the state that
>         rabbitmq creates about other nodes/the cluster? My clean up
>         script at the moment looks like this:
>
>         rm /var/run/rabbitmq/*
>         rm -f /var/log/rabbitmq/*
>         rm -rf /var/lib/rabbitmq/*
>
>         Here is my start-up script (I'm running this with sudo):
>
>         RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit1
>         RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners
>         [{mgmt,[{port,55672}]}]" rabbitmq-server -detached
>         RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=rabbit2
>         RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners
>         [{mgmt,[{port,55673}]}]" rabbitmq-server -detached
>         RABBITMQ_NODE_PORT=5674 RABBITMQ_NODENAME=rabbit3
>         RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners
>         [{mgmt,[{port,55674}]}]" rabbitmq-server -detached
>
>         ps -ef | grep rabbit1 | grep -v grep | awk '{print $2}' >
>         /var/run/rabbitmq/rabbit1.pid
>         ps -ef | grep rabbit2 | grep -v grep | awk '{print $2}' >
>         /var/run/rabbitmq/rabbit2.pid
>         ps -ef | grep rabbit3 | grep -v grep | awk '{print $2}' >
>         /var/run/rabbitmq/rabbit3.pid
>
>         rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
>         rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid
>         rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid
>
>         rabbitmqctl -n rabbit1 stop_app
>         rabbitmqctl -n rabbit1 reset
>         rabbitmqctl -n rabbit1 start_app
>
>         rabbitmqctl -n rabbit2 stop_app
>         rabbitmqctl -n rabbit2 reset
>         rabbitmqctl -n rabbit2 start_app
>
>         rabbitmqctl -n rabbit3 stop_app
>         rabbitmqctl -n rabbit3 reset
>         rabbitmqctl -n rabbit3 start_app
>
>         rabbitmqctl -n rabbit1 status
>         rabbitmqctl -n rabbit2 status
>         rabbitmqctl -n rabbit3 status
>
>         rabbitmqctl -n rabbit3 stop_app
>         rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64
>         rabbit2 at dfooks-ubuntu64
>         rabbitmqctl -n rabbit3 start_app
>
>         If I run the "clean" script and then this script I get the
>         following warning (after all of the status returns ok):
>
>         ...
>         Stopping node 'rabbit3 at dfooks-ubuntu64' ...
>         ...done.
>         Clustering node 'rabbit3 at dfooks-ubuntu64' with
>         ['rabbit1 at dfooks-ubuntu64',
>         'rabbit2 at dfooks-ubuntu64'] ...
>         Error: {unable_to_join_cluster,
>         ['rabbit1 at dfooks-ubuntu64','rabbit2 at dfooks-ubuntu64'],
>         {merge_schema_failed,
>         "Incompatible schema cookies. Please, restart from old
>         backup.'rabbit1 at dfooks-ubuntu64' =
>         [{name,schema},{type,set},{ram_copies,[]},{disc_copies,['rabbit1 at dfooks-ubuntu64']},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1336,149567,596521},'rabbit1 at dfooks-ubuntu64'}},{version,{{3,0},{'rabbit1 at dfooks-ubuntu64',{1336,149572,870479}}}}],
>         'rabbit3 at dfooks-ubuntu64' =
>         [{name,schema},{type,set},{ram_copies,['rabbit3 at dfooks-ubuntu64']},{disc_copies,['rabbit2 at dfooks-ubuntu64']},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1336,149568,520459},'rabbit2 at dfooks-ubuntu64'}},{version,{{3,0},{'rabbit3 at dfooks-ubuntu64',{1336,149572,882518}}}}]\n"}}
>         Starting node 'rabbit3 at dfooks-ubuntu64' ...
>         Error: {cannot_start_application,rabbitmq_management,
>         {bad_return,
>         {{rabbit_mgmt_app,start,[normal,[]]},
>         {'EXIT',
>         {shutdown,
>         {gen_server2,call,
>         [<4885.932.0>,{init,<4885.930.0>},infinity]}}}}}}
>
>         I've read about this error in other threads but it generally
>         seems to be about network settings being reconfigured between
>         nodes. I shouldn't have these problems since each instance is on
>         the same machine.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From clarsen at llnw.com  Tue May  8 01:45:37 2012
From: clarsen at llnw.com (Chris Larsen)
Date: Mon, 7 May 2012 20:45:37 -0400
Subject: [rabbitmq-discuss] Missing Durable Queues on Startup
Message-ID: <4fdc6b6461db2c9f559bfd61b000631d@mail.gmail.com>

Hello, we ran into an odd situation today where RabbitMQ seemed to start
properly but it didn't load most of the durable queues from the mnesia.
Running stop_app, then start_app brought back some of the queues but not
all. After we found out that not all queues were restored (after a few
hours), running stop_app, then start_app again brought the rest of the
queues online. Has anyone run into a similar situation?



Here are some notes about our setup with a few log entries from the logs
below. We have 6 machines in the cluster split into pairs running drbd and
pacemaker for failover. A glitchy switch caused one of these pairs to
split-brain and both MQ resources wound up on the same physical host. Drbd
seemed to be fine and after we resolved the split-brain, that's when we
noticed the missing queues. There weren't any errors in the startup_log or
startup_err files. We?re not using HA in rabbit itself, the queues are just
persistent and durable on each node in the cluster.



We had a number of messages in the SASL logs with ?nodedown? so I wonder if
the MQ instances simply didn?t join the cluster properly the first couple
of times but finally did on the last try? I didn?t check the status of the
nodes in the cluster on each node (as suggested elsewhere) in between
restarts but I?ll give that a try if it happens again. Thanks for your help!



RabbitMQ 2.5.1

Erlang R13B03

Ubuntu Server 64bit 2.6.38-10

drbd 8.3.7



=ERROR REPORT==== 7-May-2012::10:11:30 ===

Mnesia('rabbit2 at host2'): ** ERROR ** Mnesia on 'rabbit2 at host2' could not
connect to node(s) ['rabbit1 at host1']



=INFO REPORT==== 7-May-2012::10:11:30 ===

Limiting to approx 32668 file handles (29399 sockets)



=INFO REPORT==== 7-May-2012::10:12:46 ===

msg_store_transient: using rabbit_msg_store_ets_index to provide index



=INFO REPORT==== 7-May-2012::10:12:46 ===

msg_store_persistent: using rabbit_msg_store_ets_index to provide index



=WARNING REPORT==== 7-May-2012::10:12:46 ===

msg_store_persistent: rebuilding indices from scratch



=INFO REPORT==== 7-May-2012::10:12:46 ===

started TCP Listener on 192.168.1.1:5672



=ERROR REPORT==== 7-May-2012::10:13:42 ===

Mnesia('rabbit2 at host2'): ** ERROR ** mnesia_event got
{inconsistent_database, starting_partitioned_network, 'rabbit1 at host3'}



=ERROR REPORT==== 7-May-2012::10:13:42 ===

Mnesia('rabbit2 at host2'): ** ERROR ** mnesia_event got
{inconsistent_database, starting_partitioned_network, 'rabbit2 at host4'}



=SUPERVISOR REPORT==== 7-May-2012::10:13:32 ===

     Supervisor: {<0.11398.2442>,rabbit_channel_sup}

     Context:    shutdown

     Reason:     reached_max_restart_intensity

     Offender:   [{pid,<0.11400.2442>},

                  {name,channel},

                  {mfa,

                      {rabbit_channel,start_link,

                          [1,<0.11368.2442>,<0.11399.2442>,<0.11368.2442>,

                           rabbit_framing_amqp_0_9_1,

                           {user,<<"my_app">>,true,

                               rabbit_auth_backend_internal,

                               {internal_user,<<"my_app">>,


<<199,64,175,52,127,65,248,9,70,171,15,9,5,

                                     122,73,4,195,147,238,67>>,

                                   true}},

                           <<"/my_app">>,[],<0.11366.2442>,

                           #Fun<rabbit_channel_sup.0.15412730>]}},

                  {restart_type,intrinsic},

                  {shutdown,4294967295},

                  {child_type,worker}]





=CRASH REPORT==== 7-May-2012::10:13:33 ===

  crasher:

    initial call: gen:init_it/6

    pid: <0.25562.2442>

    registered_name: []

    exception exit: {{badmatch,

                         {error,

                             [{<7748.8396.531>,

                               {exit,

                                   {nodedown,'rabbit1 at host1'},

                                   []}}]}},

                     [{rabbit_channel,terminate,2},

                      {gen_server2,terminate,3},

                      {proc_lib,wake_up,3}]}

      in function  gen_server2:terminate/3

    ancestors: [<0.25560.2442>,<0.25544.2442>,<0.25542.2442>,

                  rabbit_tcp_client_sup,rabbit_sup,<0.124.0>]

    messages: []

    links: [<0.25560.2442>]

    dictionary: [{{exchange_stats,

                       {resource,<<"/my_app">>,exchange,

                           <<"service.exchange">>}},

                   [{confirm,6},{publish,6}]},

                  {{queue_exchange_stats,

                       {<0.253.0>,

                        {resource,<<"/my_app">>,exchange,

                            <<"data.exchange">>}}},

                   [{confirm,6},{publish,6}]},

                  {delegate,delegate_4},

                  {{monitoring,<0.253.0>},true},

                  {{exchange_stats,

                       {resource,<<"/my_app">>,exchange,

                           <<"data.exchange">>}},

                   [{confirm,6},{publish,6}]},

                  {guid,{{11,<0.25562.2442>},11}}]

    trap_exit: true

    status: running

    heap_size: 987

    stack_size: 24

    reductions: 11357

  neighbours:



=SUPERVISOR REPORT==== 7-May-2012::10:13:33 ===

     Supervisor: {<0.25560.2442>,rabbit_channel_sup}

     Context:    child_terminated

     Reason:     {{badmatch,

                      {error,

                          [{<7748.8396.531>,

                            {exit,{nodedown,'rabbit1 at host1'},[]}}]}},

                  [{rabbit_channel,terminate,2},

                   {gen_server2,terminate,3},

                   {proc_lib,wake_up,3}]}

     Offender:   [{pid,<0.25562.2442>},

                  {name,channel},

                  {mfa,

                      {rabbit_channel,start_link,

                          [1,<0.25545.2442>,<0.25561.2442>,<0.25545.2442>,

                           rabbit_framing_amqp_0_9_1,

                           {user,<<"my_app">>,true,

                               rabbit_auth_backend_internal,

                               {internal_user,<<"my_app">>,


<<199,64,175,52,127,65,248,9,70,171,15,9,5,

                                     122,73,4,195,147,238,67>>,

                                   true}},

                           <<"/my_app">>,[],<0.25543.2442>,

                           #Fun<rabbit_channel_sup.0.15412730>]}},

                  {restart_type,intrinsic},

                  {shutdown,4294967295},

                  {child_type,worker}]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120507/022b8f63/attachment.htm>

From adam.schaible at gmail.com  Tue May  8 02:43:39 2012
From: adam.schaible at gmail.com (schaibaa)
Date: Mon, 7 May 2012 18:43:39 -0700 (PDT)
Subject: [rabbitmq-discuss] Updating RabbitMQ to latest version
Message-ID: <9a2c93aa-95f6-4552-ac8a-24d1ee47c7dd@s7g2000yqm.googlegroups.com>

Hello everyone,

I haven't found a good way to update RabbitMQ yet.  The few times I've
done it, I've had to uninstall, delete database, recluster, etc.

I am largely unfamiliar with best practices here.. but the RabbitMQ
site doesn't really have much information in this regard.  Anyone have
suggestions?

From quanta.linux at gmail.com  Tue May  8 10:11:38 2012
From: quanta.linux at gmail.com (Quan Tong Anh)
Date: Tue, 8 May 2012 02:11:38 -0700 (PDT)
Subject: [rabbitmq-discuss] Cannot change the STOMP port on the CentOS?
Message-ID: <5806296.344.1336468298228.JavaMail.geo-discussion-forums@pbcvs3>

- rabbitmq-server-2.8.2-1

# cat rabbitmq.config 
[
  {rabbitmq_stomp, [{tcp_listeners, [{"127.0.0.1", 6163},
                                     {"::1",       6163}]}]}
].


Restarting the rabbitmq-server, but it still listen to the default port:

# netstat -nlp | grep 4316
tcp        0      0 0.0.0.0:58424               0.0.0.0:*                   
LISTEN      4316/beam.smp       
tcp        0      0 :::5672                     :::*                       
 LISTEN      4316/beam.smp       
tcp        0      0 :::61613                    :::*                       
 LISTEN      4316/beam.smp       


I suspect that the init script doesn't read the config file. I've tried to 
put the following in the `rabbitmq-env.conf`:

CONFIG_FILE=/etc/rabbitmq/rabbitmq.config


but nothing changes.  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/555bd6e3/attachment.htm>

From simon at rabbitmq.com  Tue May  8 11:18:11 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 May 2012 11:18:11 +0100
Subject: [rabbitmq-discuss] Updating RabbitMQ to latest version
In-Reply-To: <9a2c93aa-95f6-4552-ac8a-24d1ee47c7dd@s7g2000yqm.googlegroups.com>
References: <9a2c93aa-95f6-4552-ac8a-24d1ee47c7dd@s7g2000yqm.googlegroups.com>
Message-ID: <4FA8F2E3.1080706@rabbitmq.com>

On 08/05/12 02:43, schaibaa wrote:
> I haven't found a good way to update RabbitMQ yet.  The few times I've
> done it, I've had to uninstall, delete database, recluster, etc.

Before 2.1.0 RabbitMQ did not have a good upgrade story. Are you still 
having problems post 2.1.0? If so please report them here.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From francesco at rabbitmq.com  Tue May  8 11:21:26 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 08 May 2012 11:21:26 +0100
Subject: [rabbitmq-discuss] Updating RabbitMQ to latest version
In-Reply-To: <9a2c93aa-95f6-4552-ac8a-24d1ee47c7dd@s7g2000yqm.googlegroups.com>
References: <9a2c93aa-95f6-4552-ac8a-24d1ee47c7dd@s7g2000yqm.googlegroups.com>
Message-ID: <4FA8F3A6.70701@rabbitmq.com>

Hi,

Since version 2.1.1 to update RabbitMQ to a new version all you need to 
do is install the new version and restart it, without the need to delete 
the persistent data. If you have a cluster you have to be careful to 
start disc nodes first, more information in the clustering guide: 
http://www.rabbitmq.com/clustering.html#upgrading

Francesco.

On 08/05/12 02:43, schaibaa wrote:
> Hello everyone,
>
> I haven't found a good way to update RabbitMQ yet.  The few times I've
> done it, I've had to uninstall, delete database, recluster, etc.
>
> I am largely unfamiliar with best practices here.. but the RabbitMQ
> site doesn't really have much information in this regard.  Anyone have
> suggestions?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Tue May  8 11:25:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 May 2012 11:25:06 +0100
Subject: [rabbitmq-discuss] Cannot change the STOMP port on the CentOS?
In-Reply-To: <5806296.344.1336468298228.JavaMail.geo-discussion-forums@pbcvs3>
References: <5806296.344.1336468298228.JavaMail.geo-discussion-forums@pbcvs3>
Message-ID: <4FA8F482.8050001@rabbitmq.com>

On 08/05/12 10:11, Quan Tong Anh wrote:
> I suspect that the init script doesn't read the config file.

I suspect you are right. Does the /var/log/rabbitmq/startup_log contain 
a line like:

config file(s) : /etc/rabbitmq/rabbitmq.config

?

If not (that should be the location by default using RPMs, you should 
not need to set CONFIG_FILE) then is /etc/rabbitmq/rabbitmq.config 
readable by the rabbitmq user?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue May  8 11:47:05 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 08 May 2012 11:47:05 +0100
Subject: [rabbitmq-discuss] 1 Fanout Exchange, 2 queues, 1 slow, 1 fast
In-Reply-To: <CAD-_Ma0nqA7icq1dydGOYniiKhtRTJUJ65QEJT5UKrm4TzE8rQ@mail.gmail.com>
References: <CAD-_Ma0nqA7icq1dydGOYniiKhtRTJUJ65QEJT5UKrm4TzE8rQ@mail.gmail.com>
Message-ID: <4FA8F9A9.7070901@rabbitmq.com>


Hi Kenneth,

On 07/05/12 20:10, Kenneth Loafman wrote:
> I've got a fanout exchange running two queues.  One queue is responding
> very quickly like normal, the other is intermittent.  What would cause
> this?  The fast queue has 3 consumers, the slow queue has 64 consumers.
>  Is there a limit to how many consumers can be attached to a queue?

If you say the queue is responding intermittently, what do you mean
exactly? Are you measuring latency between publish and deliver, or
something else?

The broker does not impose a fixed limit on the number of subscribers to
a queue, but the server capacity may be a limit.

It is possible that the problem is caused by some behaviour of the
clients, or a difference in pre-fetch count. Do you get more comparable
performance if you set the pre-fetch count to 3 on the "intermittent" queue?

Depending on what you are measuring you may wish to enable the firehose
tracer for debugging:

http://www.rabbitmq.com/firehose.html



-Emile



From davidfooks at turbulenz.biz  Tue May  8 11:46:45 2012
From: davidfooks at turbulenz.biz (David Fooks)
Date: Tue, 8 May 2012 11:46:45 +0100
Subject: [rabbitmq-discuss] A cluster on a single machine
In-Reply-To: <4FA8ED0B.3020508@rabbitmq.com>
References: <26900763.505.1336149989357.JavaMail.geo-discussion-forums@vbbh3>
	<4FA40B43.7000201@rabbitmq.com>
	<CAAR1VGeN42CVZaq_DuhEwVCBUw2e-uQtSPHOvfUv7HiyzhUkqg@mail.gmail.com>
	<4FA8ED0B.3020508@rabbitmq.com>
Message-ID: <CAAR1VGf4Uw+XU-TCf-mOG3DVyLtdrocFEf-_8qa5gaRivL1g1w@mail.gmail.com>

No I didn't spot that, I was looking in the google group (which doesn't get
your replies) thanks for the hint!

Thanks guys its working now. For reference the new working script is:

rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid
rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid

rabbitmqctl -n rabbit1 stop_app
rabbitmqctl -n rabbit1 reset
rabbitmqctl -n rabbit1 start_app

rabbitmqctl -n rabbit2 stop_app
rabbitmqctl -n rabbit2 reset
rabbitmqctl -n rabbit2 start_app

rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid

rabbitmqctl -n rabbit1 status
rabbitmqctl -n rabbit2 status

rabbitmqctl -n rabbit3 stop_app
rabbitmqctl -n rabbit3 reset
rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64
rabbitmqctl -n rabbit3 cluster rabbit2 at dfooks-ubuntu64
rabbitmqctl -n rabbit3 start_app

rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid

rabbitmqctl -n rabbit3 status


On 8 May 2012 10:53, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 07/05/12 12:05, David Fooks wrote:
>
>> However, after that fix I'm still seeing the same error.
>>
>
> David, did you see this?
>
> http://lists.rabbitmq.com/**pipermail/rabbitmq-discuss/**
> 2012-May/019883.html<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/019883.html>
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/27745eba/attachment.htm>

From francesco at rabbitmq.com  Tue May  8 11:52:13 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 08 May 2012 11:52:13 +0100
Subject: [rabbitmq-discuss] Hang on "starting database ...." remains in
 2.8.2 cluster
In-Reply-To: <CACLE7iykgZBFJaSCAs6+K6veXFGrweUiKWvT_QnGE-u6DhLJDQ@mail.gmail.com>
References: <CACLE7iykgZBFJaSCAs6+K6veXFGrweUiKWvT_QnGE-u6DhLJDQ@mail.gmail.com>
Message-ID: <4FA8FADD.1050105@rabbitmq.com>

Hi Matt,

Predictably I can't reproduce this. Since you say that it'll happen 
"inevitably" (while if I understand correctly in your previous messages 
it was tricky to reproduce), can you send us more information about your 
setup and the steps on how to trigger the problem?

Francesco.

On 04/05/12 23:55, Matt Pietrek wrote:
> I've written this alias before about this topic, and the problem
> remains in 2.8.2. See:
>      http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/018414.html
>
> I have a three node cluster running RabbitMQ 2.82/Erlang R13B03 on Ubuntu 10.04.
>
> Once the cluster is up and running properly (as observed by the Web
> UI), I then start/stop individual nodes in the cluster:
>      rabbitmqctl stop
>      rabbitmq-server
>
> Inevitably one of the nodes won't come back up, waiting forever on
> "starting" the database (no 30 second timeout... Forever.)
>
> The only way to get all three nodes functioning again together is to
> forcibly stop the other two nodes, then restart them all again.
>
>
> The first item below is the console output as captured via nohup,
> showing "starting database" as the last item.
> The second item below is the last few lines of the rabbit@<node>.log
> file, showing the node shutting down, then beginning to start up
> again.
>
> Is it likely that a newer Erlang version would help out?
> What else can I provide to help diagnose this?
>
> Thanks,
>
> Matt
>
> --------
> node           : rabbit at util
> app descriptor :
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.8.2/sbin/../ebin/rabbit.app
> home dir       : /home/mpietrek
> config file(s) : /home/mpietrek/work/var/run/rabbitmq.config
> cookie hash    : pR5H9kY3Wra/XdLELT5hgQ==
> log            :
> /home/mpietrek/work/logs/util.mpietrek.internal.illumita.com/rabbit at util.log
> sasl log       :
> /home/mpietrek/work/logs/util.mpietrek.internal.illumita.com/rabbit at util-sasl.log
> database dir   : /home/mpietrek/work/var/lib/rabbit at util
> erlang version : 5.7.4
>
> -- rabbit boot start
> starting file handle cache server                                     ...done
> starting worker pool                                                  ...done
> starting database                                                     ...
>
> --------
>
> =INFO REPORT==== 4-May-2012::15:02:14 ===
>      application: rabbitmq_management_agent
>      exited: stopped
>      type: permanent
>
> =INFO REPORT==== 4-May-2012::15:02:14 ===
> stopped TCP Listener on 0.0.0.0:5672
>
> =INFO REPORT==== 4-May-2012::15:02:14 ===
>      application: rabbit
>      exited: stopped
>      type: permanent
>
> =INFO REPORT==== 4-May-2012::15:02:14 ===
>      application: os_mon
>      exited: stopped
>      type: permanent
>
> =INFO REPORT==== 4-May-2012::15:02:14 ===
>      application: mnesia
>      exited: stopped
>      type: permanent
>
> =INFO REPORT==== 4-May-2012::15:02:14 ===
> Halting Erlang VM
>
> =INFO REPORT==== 4-May-2012::15:02:52 ===
> Limiting to approx 924 file handles (829 sockets)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From davidfooks at turbulenz.biz  Tue May  8 11:54:19 2012
From: davidfooks at turbulenz.biz (David Fooks)
Date: Tue, 8 May 2012 11:54:19 +0100
Subject: [rabbitmq-discuss] A cluster on a single machine
In-Reply-To: <CAAR1VGf4Uw+XU-TCf-mOG3DVyLtdrocFEf-_8qa5gaRivL1g1w@mail.gmail.com>
References: <26900763.505.1336149989357.JavaMail.geo-discussion-forums@vbbh3>
	<4FA40B43.7000201@rabbitmq.com>
	<CAAR1VGeN42CVZaq_DuhEwVCBUw2e-uQtSPHOvfUv7HiyzhUkqg@mail.gmail.com>
	<4FA8ED0B.3020508@rabbitmq.com>
	<CAAR1VGf4Uw+XU-TCf-mOG3DVyLtdrocFEf-_8qa5gaRivL1g1w@mail.gmail.com>
Message-ID: <CAAR1VGfiKUyT5am1-akVaXYhmuiWo0pxM-r4HrR4dXf=wabP8A@mail.gmail.com>

And with the whole cluster working correctly:

rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid
rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid

rabbitmqctl -n rabbit1 stop_app
rabbitmqctl -n rabbit1 reset
rabbitmqctl -n rabbit1 start_app

rabbitmqctl -n rabbit2 stop_app
rabbitmqctl -n rabbit2 reset
rabbitmqctl -n rabbit2 cluster rabbit1 at dfooks-ubuntu64
rabbitmqctl -n rabbit2 start_app

rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid

rabbitmqctl -n rabbit1 status
rabbitmqctl -n rabbit2 status

rabbitmqctl -n rabbit3 stop_app
rabbitmqctl -n rabbit3 reset
rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64
rabbitmqctl -n rabbit3 cluster rabbit2 at dfooks-ubuntu64
rabbitmqctl -n rabbit3 start_app

rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid

rabbitmqctl -n rabbit3 status

On 8 May 2012 11:46, David Fooks <davidfooks at turbulenz.biz> wrote:

> No I didn't spot that, I was looking in the google group (which doesn't
> get your replies) thanks for the hint!
>
> Thanks guys its working now. For reference the new working script is:
>
> rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
> rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid
> rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid
>
> rabbitmqctl -n rabbit1 stop_app
> rabbitmqctl -n rabbit1 reset
> rabbitmqctl -n rabbit1 start_app
>
> rabbitmqctl -n rabbit2 stop_app
> rabbitmqctl -n rabbit2 reset
> rabbitmqctl -n rabbit2 start_app
>
> rabbitmqctl -n rabbit1 wait /var/run/rabbitmq/rabbit1.pid
> rabbitmqctl -n rabbit2 wait /var/run/rabbitmq/rabbit2.pid
>
> rabbitmqctl -n rabbit1 status
> rabbitmqctl -n rabbit2 status
>
> rabbitmqctl -n rabbit3 stop_app
> rabbitmqctl -n rabbit3 reset
> rabbitmqctl -n rabbit3 cluster rabbit1 at dfooks-ubuntu64
> rabbitmqctl -n rabbit3 cluster rabbit2 at dfooks-ubuntu64
> rabbitmqctl -n rabbit3 start_app
>
> rabbitmqctl -n rabbit3 wait /var/run/rabbitmq/rabbit3.pid
>
> rabbitmqctl -n rabbit3 status
>
>
> On 8 May 2012 10:53, Simon MacMullen <simon at rabbitmq.com> wrote:
>
>> On 07/05/12 12:05, David Fooks wrote:
>>
>>> However, after that fix I'm still seeing the same error.
>>>
>>
>> David, did you see this?
>>
>> http://lists.rabbitmq.com/**pipermail/rabbitmq-discuss/**
>> 2012-May/019883.html<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/019883.html>
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/16927462/attachment.htm>

From matti.linnanvuori at portalify.com  Tue May  8 12:04:12 2012
From: matti.linnanvuori at portalify.com (Matti Linnanvuori)
Date: Tue, 8 May 2012 14:04:12 +0300
Subject: [rabbitmq-discuss] RabbitMQ 2.8.1 reorders messages?
Message-ID: <CA005D70-2BC1-4BEF-A12F-240F2DA916A2@portalify.com>

Hi!

I noticed that a Net::RabbitMQ Perl client gets a message with a later timestamp before another message with an earlier timestamp. The timestamp was created by a client and it was included in the message payload. The client that publishes the messages publishes them in a direct, non-passive, durable, non-auto-delete exchange. The client that received the messages receives them from a queue that is non-passive, durable, non-exclusive, non-auto-delete, bound to the exchange and consumes from that queue.

Message ordering guarantees exist, so that behaviour surprises me:
http://www.rabbitmq.com/semantics.html

regards, Matti Linnanvuori


From emile at rabbitmq.com  Tue May  8 12:16:11 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 08 May 2012 12:16:11 +0100
Subject: [rabbitmq-discuss] immediate, mandatory flag with no consumers
In-Reply-To: <9399B902-3BA9-43FB-B9D3-D7CF3ADB9A09@etrade.com>
References: <fa3b9c55-7577-41c3-80f2-9176d4736a30@u7g2000yqc.googlegroups.com>
	<4F996269.1050005@rabbitmq.com>
	<CAPwx=WNGYvmRaQe5F1_0w5bObzKuhdORGnwKhoT6sX-yUZaTBw@mail.gmail.com>
	<4F99787E.8030501@rabbitmq.com>
	<AC888676-0872-4116-A55E-03FE45C567D8@etrade.com>
	<4FA2A7D1.9070105@rabbitmq.com>
	<A3FFF2F5-B03D-4F0D-930B-1CEB2FA3004A@etrade.com>
	<4FA3A257.6000709@rabbitmq.com>
	<57E70C22-4040-4F88-8B6F-32580537AF02@etrade.com>
	<CAAt2poJN9bxc51wUxViKSexiiqmdiKYWssH=bCy-Tr694=W2oQ@mail.gmail.com>
	<9399B902-3BA9-43FB-B9D3-D7CF3ADB9A09@etrade.com>
Message-ID: <4FA9007B.9030202@rabbitmq.com>

Hi,

On 08/05/12 02:33, Unni, Monish wrote:
> we also found for rabbitmq, we could use "alternate-exchange"
> (extension), since, we are mostly calling services that are built
> in-house. this seems to be a very generic way to handle
> "non-routable" calls. the restriction seems to be this  exchange
> cannot be built on "amq.direct" as an "alternate-exchange" needs to
> be specified at the time of creation - is this right?

You can specify an alternate exchange for any exchange type, not only
direct exchanges. The alternate exchange must be named at declaration
time of the exchange making use of it.

> for "no-consumers" i am not sure if we have any "broker" level
> setting except using "dead-letter-messages" as given :
> http://www.rabbitmq.com/extensions.html#dead-letter-messages [also,
> we are loosely-coupled, i.e we really don't want "transaction-level"
> broker semantics, so "confirmation" is not an option...]

If a message is successfully routed to a queue then dead letter handling
will not come into effect, because the message wasn't dropped.

One way to handle the "no-consumers" scenario is to allow consumers to
declare their own queues and bindings. You can then make use of
alternate exchanges (or the mandatory publication flag) to handle
unroutable messages. In this case the presence of consumers and routes
should correspond. This solution won't work if messages must be
delivered only to a single consumer.

Another option is to let a shared queue expire when the last consumer
unsubscribes. Messages destined for such a queue will become unroutable
when the last consumer leaves. This can then be handled with alternate
exchanges (or the mandatory flag). Consumers should declare the shared
queue before subscribing, in case there were no other subscribers.
(See queue leases: http://www.rabbitmq.com/extensions.html#lifetimes)

If your client supports the immediate publication flag then that could
also be used.


-Emile


From matthias at rabbitmq.com  Tue May  8 12:22:55 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 08 May 2012 12:22:55 +0100
Subject: [rabbitmq-discuss] Queues with high memory consumption
In-Reply-To: <CANVSfp+7HTWCoezKabcZSZ3qvggKODUVpz7=FrEZymsBW+KPqQ@mail.gmail.com>
References: <CANVSfp+9KMvWHp5FL+jsH1fFh6zAJG3F5Vi0Z=RGi=5qN_ea2w@mail.gmail.com>
	<CANVSfp+7HTWCoezKabcZSZ3qvggKODUVpz7=FrEZymsBW+KPqQ@mail.gmail.com>
Message-ID: <4FA9020F.5040102@rabbitmq.com>

Pablo,

On 07/05/12 19:28, Pablo Molnar wrote:
> I'm trying to figure out why the memory consumption of some queues
> are  extremely high although there is almost none messages ready to consume.
> For instance this queue has only 3 messages but consumes 2.4GB of
> RAM.

That is not necessarily a problem, in particular ...

> {
>    "exclusive_consumer_tag":"",
>    "messages_ready":0,
>    "messages_unacknowledged":3,
>    "messages":3,
>    "consumers":25,
>    "memory":2586777216,
>    "slave_nodes":[
>
>    ],
>    "backing_queue_status":{
>       "q1":0,
>       "q2":0,
>       "delta":[
>          "delta",
>          "undefined",
>          0,
>          "undefined"
>       ],
>       "q3":0,
>       "q4":0,
>       "len":0,
>       "pending_acks":3,
>       "target_ram_count":0,
>       "ram_msg_count":0,
>       "ram_ack_count":0,
>       "next_seq_id":72528926,
>       "persistent_count":3,
>       "avg_ingress_rate":42.456013780009044,
>       "avg_egress_rate":42.456013780009044,
>       "avg_ack_ingress_rate":42.456013780009044,
>       "avg_ack_egress_rate":42.456013780009044
>    },  ...

...this is a slow-moving, but not idle queue. I suspect what happened is 
that at some point the queue did have lots of messages in it, hence 
requiring lots of memory. Those messages subsequently got drained, but 
the since the queue is slow moving it can take a while for Erlang's gc 
to reclaim memory.

Unless this is causing any other problems I wouldn't worry about it.

> rabbitmqctl status
> Status of node 'rabbit at i-00000140-csm' ...
> [{pid,20106},
>  {running_applications,
>      [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","2.7.1"},
>       {rabbitmq_management,"RabbitMQ Management Console","2.7.1"},
>       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
>       {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
>       {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
>       {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
>       {rabbit,"RabbitMQ","2.7.1"},
>       {os_mon,"CPO  CXC 138 46","2.2.8"},
>       {sasl,"SASL  CXC 138 11","2.2"},
>       {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
>       {inets,"INETS  CXC 138 49","5.8"},
>       {mnesia,"MNESIA  CXC 138 12","4.6"},
>       {stdlib,"ERTS  CXC 138 10","1.18"},
>       {kernel,"ERTS  CXC 138 10","2.15"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang R15B (erts-5.9) [source] [64-bit] [smp:4:4] [async-threads:0] [hipe] [kernel-poll:false]\n"},
>  {memory,
>      [{total,4736488576},
>       {processes,3832122172},
>       {processes_used,3832066481},
>       {system,904366404},
>       {atom,561761},
>       {atom_used,551430},
>       {binary,98523592},
>       {code,15193946},
>       {ets,717445688}]},
>  {vm_memory_high_watermark,0.6999999999761628},
>  {vm_memory_limit,5873161011}]
> ...done.

You may want to upgrade to the latest Erlang (R15B01) and rabbit 
(2.8.2), though I doubt that will make a difference.


Regards,

Matthias.

From emile at rabbitmq.com  Tue May  8 12:26:05 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 08 May 2012 12:26:05 +0100
Subject: [rabbitmq-discuss] immediate, mandatory flag with no consumers
In-Reply-To: <4FA9007B.9030202@rabbitmq.com>
References: <fa3b9c55-7577-41c3-80f2-9176d4736a30@u7g2000yqc.googlegroups.com>
	<4F996269.1050005@rabbitmq.com>
	<CAPwx=WNGYvmRaQe5F1_0w5bObzKuhdORGnwKhoT6sX-yUZaTBw@mail.gmail.com>
	<4F99787E.8030501@rabbitmq.com>
	<AC888676-0872-4116-A55E-03FE45C567D8@etrade.com>
	<4FA2A7D1.9070105@rabbitmq.com>
	<A3FFF2F5-B03D-4F0D-930B-1CEB2FA3004A@etrade.com>
	<4FA3A257.6000709@rabbitmq.com>
	<57E70C22-4040-4F88-8B6F-32580537AF02@etrade.com>
	<CAAt2poJN9bxc51wUxViKSexiiqmdiKYWssH=bCy-Tr694=W2oQ@mail.gmail.com>
	<9399B902-3BA9-43FB-B9D3-D7CF3ADB9A09@etrade.com>
	<4FA9007B.9030202@rabbitmq.com>
Message-ID: <4FA902CD.20300@rabbitmq.com>

On 08/05/12 12:16, Emile Joubert wrote:
>> "non-routable" calls. the restriction seems to be this  exchange
>> cannot be built on "amq.direct" as an "alternate-exchange" needs to
>> be specified at the time of creation - is this right?
> 
> You can specify an alternate exchange for any exchange type, not only
> direct exchanges.

I misread your question - you are correct that it is impossible to
redeclare the standard exchanges to specify an alternative exchange. The
solution is not to use the default exchange. Use your own direct
exchange, declare it with an alternate exchange and create the bindings
you need.


-Emile




From emile at rabbitmq.com  Tue May  8 12:32:06 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 08 May 2012 12:32:06 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.1 reorders messages?
In-Reply-To: <CA005D70-2BC1-4BEF-A12F-240F2DA916A2@portalify.com>
References: <CA005D70-2BC1-4BEF-A12F-240F2DA916A2@portalify.com>
Message-ID: <4FA90436.2040701@rabbitmq.com>

Hi Matti,

On 08/05/12 12:04, Matti Linnanvuori wrote:
> I noticed that a Net::RabbitMQ Perl client gets a message with a
> later timestamp before another message with an earlier timestamp. The

The broker preserves the order of messages along a single path between a
publisher and consumer. If you are seeing messages out of order then it
means there was more than one path between the producer and consumer.
Check that you don't have multiple channels or subscriptions.

-Emile


From steve at rabbitmq.com  Tue May  8 12:35:28 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 8 May 2012 12:35:28 +0100
Subject: [rabbitmq-discuss] please help understanding why my pool of
	channels are blocking.
In-Reply-To: <CAHSyJg+mxvPmxFh9YzytLvYmb0dJNBUdTV-4cAjU6=WQh8b8xg@mail.gmail.com>
References: <CAHSyJgJvZ+NXn1+51i5KN10HZ3mQY56Cz+KjiPfzMVuEaEwpsg@mail.gmail.com>
	<4FA3BC78.1000106@rabbitmq.com>
	<CAHSyJg+mxvPmxFh9YzytLvYmb0dJNBUdTV-4cAjU6=WQh8b8xg@mail.gmail.com>
Message-ID: <06086441-24B3-4DB8-8975-3B31CA4552AE@rabbitmq.com>

Gautam, 

Of course, as Matthias pointed out, everything eventually goes down a
connection. If this is shared between the channels then SENDing
messages from the client will clearly serialise at the connection level.
This is what I'm seeing here, too.

Individual messages are not split into chunks (as they would have to be
to multi-plex them with others on the network connection), so each
message will block out all other activity on the connection until it
is completed.  Larger messages will block for longer.

The reason why you might want multiple channels on one connection is if
you want to multi-thread work at the client end -- for example Consumer
callback work. Each connection has a thread-pool of executors to run
consumer callbacks (deliveries and so on) so that multiple channels can
run their callbacks simultaneously. Frames received from the server
still come in serially over the connection, but the callbacks they
trigger can run in independent threads if they are for distinct
channels.  You appear not to be doing any consuming, so this is not
your problem.

AFAIK there isn't a standard for multi-plexing channels/connections at
the client end, but I suggest that you simply increase the number of
underlying connections to relieve the bottleneck you are seeing. If, for
instance, you introduce, 5 connections with 10 channels each you could
see if this helps things.

Varying the number of channels per connection will allow you to tune the
potential contention for each connection. Only you can tell what 
the likely contention is to be.  The selector process for channels might
want to favour channels which are for connections with fewer used
channels already.

Let us know how you fare.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 4 May 2012, at 15:43, Gautam Bakshi wrote:

> Thanks Matthias and Steve. 
> 
> Is there a better(or more common/supported) way to pool channels(so I reduce blocking on threaded message passing)?  I'd rather not waste anyone's time if there's already a tried and test solution out there for pooling.
> 
> Enjoy the holidays!
> 
> On Fri, May 4, 2012 at 7:24 AM, Matthias Radestock <matthias at rabbitmq.com> wrote:
> On 03/05/12 04:34, Gautam Bakshi wrote:
> I have a multi-threaded application that I was considering using
> rabbitmq to manage the queue but I'm getting alot of blocking between
> my channels.  Is there a preferred way to setup pools?
> 
> I'm a bit new to Java so I used to the pools from apache commons but
>  when I profile the channels are all blocking each other.  To test if
>  dedicated connections per thread worked better I made an example of
> it as well and it does not block when the same program has a single
> channel per connection.
> 
> So my question, do channels block each other or am I doing something
>  wrong(using java api wrong or misunderstanding
> connection/channels)?
> 
> Channels are multiplexed on the underlying connection. So when an app
> is, say, publishing messages on multiple channels, these activities will
> be serialised at the point the client interacts with the network socket.
> 
> 
> there a more preferred way? Unrelated to the question, but I was also
>  wondering is there any difference between channels and connections
> in terms of throughput(i.e. would there be any benefit of using
> dedicated connections ignoring the overhead in
> establishing/maintaining the connection)?
> 
> You can get exploit more parallelism in both the client and server when
> using multiple connections compared to multiple channels. But it is
> ultimately more costly in CPU and memory. Plus of course network
> capacity is bounded, so if you are saturating that with a single
> connection then using more than one will not gain anything.
> 
> So the answer on whether multiple channels or multiple connections are
> better very much depends on the application, the hardware environment
> at the client and broker end, and the network. Hence your best bet is to conduct some tests, which you are already doing :)
> 
> Regards,
> 
> Matthias.
> 
> 
> 
> -- 
> Regards,
> 
> Gautam Bakshi
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/2ec2eb74/attachment.htm>

From simon at rabbitmq.com  Tue May  8 13:21:19 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 May 2012 13:21:19 +0100
Subject: [rabbitmq-discuss] please help understanding why my pool
 of	channels are blocking.
In-Reply-To: <06086441-24B3-4DB8-8975-3B31CA4552AE@rabbitmq.com>
References: <CAHSyJgJvZ+NXn1+51i5KN10HZ3mQY56Cz+KjiPfzMVuEaEwpsg@mail.gmail.com>	<4FA3BC78.1000106@rabbitmq.com>	<CAHSyJg+mxvPmxFh9YzytLvYmb0dJNBUdTV-4cAjU6=WQh8b8xg@mail.gmail.com>
	<06086441-24B3-4DB8-8975-3B31CA4552AE@rabbitmq.com>
Message-ID: <4FA90FBF.4090502@rabbitmq.com>

On 08/05/12 12:35, Steve Powell wrote:
> Individual messages are not split into chunks (as they would have to be
> to multi-plex them with others on the network connection), so each
> message will block out all other activity on the connection until it
> is completed.  Larger messages will block for longer.

Messages *are* split into chunks - the chunks are frames.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matti.linnanvuori at portalify.com  Tue May  8 14:17:33 2012
From: matti.linnanvuori at portalify.com (Matti Linnanvuori)
Date: Tue, 8 May 2012 16:17:33 +0300
Subject: [rabbitmq-discuss] RabbitMQ 2.8.1 reorders messages?
In-Reply-To: <4FA90436.2040701@rabbitmq.com>
References: <CA005D70-2BC1-4BEF-A12F-240F2DA916A2@portalify.com>
	<4FA90436.2040701@rabbitmq.com>
Message-ID: <ECB66EC8-D950-41E0-B051-3A53660ABDFF@portalify.com>

Hi!

I did not see any multiple channels or subscriptions for queue.test.cassidian-in in the command output below. The same process has multiple channels and subscriptions, but every one of them is for different queues bound to different exchanges.

pmc-inst-test:~ # rabbitmqctl list_bindings
Listing bindings ...
	exchange	queue.pmc.cassidian-in	queue	queue.pmc.cassidian-in	[]
	exchange	queue.pmc.email-in	queue	queue.pmc.email-in	[]
	exchange	queue.pmc.router-in	queue	queue.pmc.router-in	[]
	exchange	queue.pmc.sf-in	queue	queue.pmc.sf-in	[]
	exchange	queue.pmc.smpp-in	queue	queue.pmc.smpp-in	[]
	exchange	queue.test.cassidian-in	queue	queue.test.cassidian-in[]
	exchange	queue.test.router-in	queue	queue.test.router-in	[]
	exchange	queue.test.sf-in	queue	queue.test.sf-in	[]
exchange.pmc.cassidian-in	exchange	queue.pmc.cassidian-in	queue	[]
exchange.pmc.email-in	exchange	queue.pmc.email-in	queue		[]
exchange.pmc.router-in	exchange	queue.pmc.router-in	queue		[]
exchange.pmc.sf-in	exchange	queue.pmc.sf-in	queue		[]
exchange.pmc.smpp-in	exchange	queue.pmc.smpp-in	queue		[]
...done.
pmc-inst-test:~ # rabbitmqctl list_channels
Listing channels ...
<'rabbit at pmc-inst-test'.3.17232.1>	guest	1	0
<'rabbit at pmc-inst-test'.3.19077.1>	guest	1	0
<'rabbit at pmc-inst-test'.3.19085.1>	guest	1	0
<'rabbit at pmc-inst-test'.3.19093.1>	guest	1	0
<'rabbit at pmc-inst-test'.3.19101.1>	guest	1	0
...done.
pmc-inst-test:~ # rabbitmqctl list_consumers
Listing consumers ...
queue.test.sf-in	<'rabbit at pmc-inst-test'.3.19085.1>	amq.ctag-QDX5Y9HIl5OZeRJ9FEvuxg	false
queue.test.router-in	<'rabbit at pmc-inst-test'.3.19077.1>	amq.ctag-QW3TcrGH04lQlFVxU5JYJY	false
queue.pmc.router-in	<'rabbit at pmc-inst-test'.3.19101.1>	amq.ctag-QbjUQTtXysVuwr-FBbaQVk	false
queue.pmc.router-in	<'rabbit at pmc-inst-test'.3.17232.1>	amq.ctag-ACYmqR2Ife0EjHnnn6YQ9W	false
queue.test.cassidian-in	<'rabbit at pmc-inst-test'.3.19093.1>	amq.ctag-gDuO4VdoRM6ovTZSMugROZ	false
queue.pmc.sf-in	<'rabbit at pmc-inst-test'.3.19113.1>	amq.ctag-QTvhZtd_Eu-ofpS9KvUFWT	true
...done.


On May 8, 2012, at 2:32 PM, Emile Joubert wrote:

> Hi Matti,
> 
> On 08/05/12 12:04, Matti Linnanvuori wrote:
>> I noticed that a Net::RabbitMQ Perl client gets a message with a
>> later timestamp before another message with an earlier timestamp. The
> 
> The broker preserves the order of messages along a single path between a
> publisher and consumer. If you are seeing messages out of order then it
> means there was more than one path between the producer and consumer.
> Check that you don't have multiple channels or subscriptions.
> 
> -Emile
> 

regards, Matti Linnanvuori

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/1a114eb9/attachment.htm>

From emile at rabbitmq.com  Tue May  8 14:34:27 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 08 May 2012 14:34:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.1 reorders messages?
In-Reply-To: <ECB66EC8-D950-41E0-B051-3A53660ABDFF@portalify.com>
References: <CA005D70-2BC1-4BEF-A12F-240F2DA916A2@portalify.com>
	<4FA90436.2040701@rabbitmq.com>
	<ECB66EC8-D950-41E0-B051-3A53660ABDFF@portalify.com>
Message-ID: <4FA920E3.7040904@rabbitmq.com>

Hi,

On 08/05/12 14:17, Matti Linnanvuori wrote:
> I did not see any multiple channels or subscriptions
> for queue.test.cassidian-in in the command output below.

While not the queue you mentioned, I see there are multiple channels
associated with 'queue.pmc.router-in':

> queue.pmc.router-in<'rabbit at pmc-inst-test'.3.19101.1>amq.ctag-QbjUQTtXysVuwr-FBbaQVkfalse
> queue.pmc.router-in<'rabbit at pmc-inst-test'.3.17232.1>amq.ctag-ACYmqR2Ife0EjHnnn6YQ9Wfalse

Bear in mind that publishing along multiple channels can also lead to
messages being interleaved in unexpected ways.


-Emile



From kenneth at loafman.com  Tue May  8 14:44:43 2012
From: kenneth at loafman.com (Kenneth Loafman)
Date: Tue, 8 May 2012 08:44:43 -0500
Subject: [rabbitmq-discuss] 1 Fanout Exchange, 2 queues, 1 slow, 1 fast
In-Reply-To: <4FA8F9A9.7070901@rabbitmq.com>
References: <CAD-_Ma0nqA7icq1dydGOYniiKhtRTJUJ65QEJT5UKrm4TzE8rQ@mail.gmail.com>
	<4FA8F9A9.7070901@rabbitmq.com>
Message-ID: <CAD-_Ma14yw0xr7mzE+r8RaFvpyMJVOFQL-k+BwK_Ti-Opid8UQ@mail.gmail.com>

Thanks for the reply.

By intermittent, I mean burst, pause, burst, pause, ...

The problem has been 'solved' for now.  We were using basic_get and 96
consumers was too much even with a 1 second delay on no-data-received
(we're swapping over to callbacks ASAP).  I reduced the number of consumers
to 32 and got much better throughput, so the queue is keeping up now.

...Ken


On Tue, May 8, 2012 at 5:47 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Kenneth,
>
> On 07/05/12 20:10, Kenneth Loafman wrote:
> > I've got a fanout exchange running two queues.  One queue is responding
> > very quickly like normal, the other is intermittent.  What would cause
> > this?  The fast queue has 3 consumers, the slow queue has 64 consumers.
> >  Is there a limit to how many consumers can be attached to a queue?
>
> If you say the queue is responding intermittently, what do you mean
> exactly? Are you measuring latency between publish and deliver, or
> something else?
>
> The broker does not impose a fixed limit on the number of subscribers to
> a queue, but the server capacity may be a limit.
>
> It is possible that the problem is caused by some behaviour of the
> clients, or a difference in pre-fetch count. Do you get more comparable
> performance if you set the pre-fetch count to 3 on the "intermittent"
> queue?
>
> Depending on what you are measuring you may wish to enable the firehose
> tracer for debugging:
>
> http://www.rabbitmq.com/firehose.html
>
>
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/af071491/attachment.htm>

From james.poole at rsa.com  Tue May  8 14:54:10 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Tue, 8 May 2012 09:54:10 -0400
Subject: [rabbitmq-discuss] SSL Certificate Error
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D707F76EE52C@MX36A.corp.emc.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707F76EE52C@MX36A.corp.emc.com>
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D70807D7903C@MX36A.corp.emc.com>

In case anyone runs into a similar issue, we found that our certificate had
a subject length of over 64 characters.  This length limit seems like it is
not part of the actual standard (LDAP doesn't enforce it), but in any case,
shortening the subject fixed the issue.

 

An error message stating the cause could have been a real time saver J

 

-James

 

From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of
james.poole at rsa.com
Sent: Wednesday, May 02, 2012 3:24 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] SSL Certificate Error

 

Can anyone help me understand what is happening when I try to enable SSL
using Non-OpenSSL certificates?  The certificates being used are working as
SSL Server certificates with Apache 2.2.22, but when I use them with
RabbitMQ, it is failing.  Also, if I generate OpenSSL certificates to test
with, the same setup works (same config file, server, etc).

 


From steve at rabbitmq.com  Tue May  8 15:09:23 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 8 May 2012 15:09:23 +0100
Subject: [rabbitmq-discuss] please help understanding why my pool
	of	channels are blocking.
In-Reply-To: <4FA90FBF.4090502@rabbitmq.com>
References: <CAHSyJgJvZ+NXn1+51i5KN10HZ3mQY56Cz+KjiPfzMVuEaEwpsg@mail.gmail.com>	<4FA3BC78.1000106@rabbitmq.com>	<CAHSyJg+mxvPmxFh9YzytLvYmb0dJNBUdTV-4cAjU6=WQh8b8xg@mail.gmail.com>
	<06086441-24B3-4DB8-8975-3B31CA4552AE@rabbitmq.com>
	<4FA90FBF.4090502@rabbitmq.com>
Message-ID: <16F3FE3F-F733-4F1E-B9F5-18283E229E3D@rabbitmq.com>

Of course they are -- silly me.  Sorry, Gautam, Simon is right. 
This means that the largest non-interleaved unit is the
maximum frame size. Still the connection is the bottleneck.

I apologise if I misled  you.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 8 May 2012, at 13:21, Simon MacMullen wrote:

> On 08/05/12 12:35, Steve Powell wrote:
>> Individual messages are not split into chunks (as they would have to be
>> to multi-plex them with others on the network connection), so each
>> message will block out all other activity on the connection until it
>> is completed.  Larger messages will block for longer.
> 
> Messages *are* split into chunks - the chunks are frames.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/d7971b8d/attachment.htm>

From steve at rabbitmq.com  Tue May  8 15:12:54 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 8 May 2012 15:12:54 +0100
Subject: [rabbitmq-discuss] Cannot change the STOMP port on the CentOS?
In-Reply-To: <4FA8F482.8050001@rabbitmq.com>
References: <5806296.344.1336468298228.JavaMail.geo-discussion-forums@pbcvs3>
	<4FA8F482.8050001@rabbitmq.com>
Message-ID: <45EA8294-15D0-467E-8E5C-E6B9F7B01896@rabbitmq.com>

The CONFIG_FILE setting should not have the .config extension:

RABBITMQ_CONFIG_FILE	The name of the configuration file, without the .config extension. If the configuration file is present it is used by the server to configure RabbitMQ components. This file is also used to auto-configure RabbitMQ clusters.

Hope this fixes it.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 8 May 2012, at 11:25, Simon MacMullen wrote:

> On 08/05/12 10:11, Quan Tong Anh wrote:
>> I suspect that the init script doesn't read the config file.
> 
> I suspect you are right. Does the /var/log/rabbitmq/startup_log contain a line like:
> 
> config file(s) : /etc/rabbitmq/rabbitmq.config
> 
> ?
> 
> If not (that should be the location by default using RPMs, you should not need to set CONFIG_FILE) then is /etc/rabbitmq/rabbitmq.config readable by the rabbitmq user?
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/220373fd/attachment.htm>

From emile at rabbitmq.com  Tue May  8 15:33:05 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 08 May 2012 15:33:05 +0100
Subject: [rabbitmq-discuss] SSL Certificate Error
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D70807D7903C@MX36A.corp.emc.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707F76EE52C@MX36A.corp.emc.com>
	<FC3463BECF39B74996BF6ADDCB9BE7D70807D7903C@MX36A.corp.emc.com>
Message-ID: <4FA92EA1.40801@rabbitmq.com>

Hi James,

On 08/05/12 14:54, james.poole at rsa.com wrote:
> In case anyone runs into a similar issue, we found that our certificate
> had a subject length of over 64 characters.  This length limit seems
> like it is not part of the actual standard (LDAP doesn?t enforce it),
> but in any case, shortening the subject fixed the issue.

Thanks for getting back to the list with your solution. Was subject
length really the only difference between a working and non-working
(ecertfile error) certificate? The chances of that seem somewhat remote.
Out of interest, were you been able to confirm your hypothesis with more
than one set of certificates that differ in subject length alone?

-Emile



From simon at rabbitmq.com  Tue May  8 15:32:09 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 May 2012 15:32:09 +0100
Subject: [rabbitmq-discuss] 2.7.1 / R14B04 Crash Report: ~1PB RAM
 allocation failure
In-Reply-To: <CAL_e=0q7_K5icvXonudbciMP5ZTyd=oPbDNebhWVtm+KhRJdqw@mail.gmail.com>
References: <CAL_e=0q7_K5icvXonudbciMP5ZTyd=oPbDNebhWVtm+KhRJdqw@mail.gmail.com>
Message-ID: <4FA92E69.7090002@rabbitmq.com>

On 07/05/12 15:35, Gavin M. Roy wrote:
> Slogan: std_alloc: Cannot allocate 1124304355803072 bytes of memory (of
> type "arg_reg").

Hmm. This makes *very* little sense to me - I can't think of anything 
besides memory corruption that could cause this ("arg_reg" should never 
be huge anyway). See my analysis and plea for help here:

http://erlang.org/pipermail/erlang-questions/2012-May/066593.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Tue May  8 15:33:01 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 8 May 2012 15:33:01 +0100
Subject: [rabbitmq-discuss] Missing Durable Queues on Startup
In-Reply-To: <4fdc6b6461db2c9f559bfd61b000631d@mail.gmail.com>
References: <4fdc6b6461db2c9f559bfd61b000631d@mail.gmail.com>
Message-ID: <AA028E5E-95B7-41F2-A8C3-E34340E4A3B8@rabbitmq.com>

Hi Chris,

I'm no expert on setups like these, but, based upon other
questions and answers in this m/l, I would want to know:

a) are all the nodes in your cluster disk nodes?
b) was the node that you stop/started a disk node or a ram node?
c) when the cluster was restarted did you start all the disk nodes
   first?

When you say:

> We?re not using HA in rabbit itself, the queues are just
> persistent and durable on each node in the cluster.

can you be more precise? I assumed that the node you restarted was the
one that held the queues you were missing.

You appear to be running version 2.5.1. Clustering has had some fixes
applied to it since then.

I would recommend upgrading to the latest release.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 8 May 2012, at 01:45, Chris Larsen wrote:

> Hello, we ran into an odd situation today where RabbitMQ seemed to start properly but it didn't load most of the durable queues from the mnesia. Running stop_app, then start_app brought back some of the queues but not all. After we found out that not all queues were restored (after a few hours), running stop_app, then start_app again brought the rest of the queues online. Has anyone run into a similar situation?
>  
> Here are some notes about our setup with a few log entries from the logs below. We have 6 machines in the cluster split into pairs running drbd and pacemaker for failover. A glitchy switch caused one of these pairs to split-brain and both MQ resources wound up on the same physical host. Drbd seemed to be fine and after we resolved the split-brain, that's when we noticed the missing queues. There weren't any errors in the startup_log or startup_err files. We?re not using HA in rabbit itself, the queues are just persistent and durable on each node in the cluster.
>  
> We had a number of messages in the SASL logs with ?nodedown? so I wonder if the MQ instances simply didn?t join the cluster properly the first couple of times but finally did on the last try? I didn?t check the status of the nodes in the cluster on each node (as suggested elsewhere) in between restarts but I?ll give that a try if it happens again. Thanks for your help!
>  
> RabbitMQ 2.5.1
> Erlang R13B03
> Ubuntu Server 64bit 2.6.38-10
> drbd 8.3.7
>  
> =ERROR REPORT==== 7-May-2012::10:11:30 ===
> Mnesia('rabbit2 at host2'): ** ERROR ** Mnesia on 'rabbit2 at host2' could not connect to node(s) ['rabbit1 at host1']
>  
> =INFO REPORT==== 7-May-2012::10:11:30 ===
> Limiting to approx 32668 file handles (29399 sockets)
>  
> =INFO REPORT==== 7-May-2012::10:12:46 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>  
> =INFO REPORT==== 7-May-2012::10:12:46 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>  
> =WARNING REPORT==== 7-May-2012::10:12:46 ===
> msg_store_persistent: rebuilding indices from scratch
>  
> =INFO REPORT==== 7-May-2012::10:12:46 ===
> started TCP Listener on 192.168.1.1:5672
>  
> =ERROR REPORT==== 7-May-2012::10:13:42 ===
> Mnesia('rabbit2 at host2'): ** ERROR ** mnesia_event got {inconsistent_database, starting_partitioned_network, 'rabbit1 at host3'}
>  
> =ERROR REPORT==== 7-May-2012::10:13:42 ===
> Mnesia('rabbit2 at host2'): ** ERROR ** mnesia_event got {inconsistent_database, starting_partitioned_network, 'rabbit2 at host4'}
>  
> =SUPERVISOR REPORT==== 7-May-2012::10:13:32 ===
>      Supervisor: {<0.11398.2442>,rabbit_channel_sup}
>      Context:    shutdown
>      Reason:     reached_max_restart_intensity
>      Offender:   [{pid,<0.11400.2442>},
>                   {name,channel},
>                   {mfa,
>                       {rabbit_channel,start_link,
>                           [1,<0.11368.2442>,<0.11399.2442>,<0.11368.2442>,
>                            rabbit_framing_amqp_0_9_1,
>                            {user,<<"my_app">>,true,
>                                rabbit_auth_backend_internal,
>                                {internal_user,<<"my_app">>,
>                                    <<199,64,175,52,127,65,248,9,70,171,15,9,5,
>                                      122,73,4,195,147,238,67>>,
>                                    true}},
>                            <<"/my_app">>,[],<0.11366.2442>,
>                            #Fun<rabbit_channel_sup.0.15412730>]}},
>                   {restart_type,intrinsic},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
>  
>  
> =CRASH REPORT==== 7-May-2012::10:13:33 ===
>   crasher:
>     initial call: gen:init_it/6
>     pid: <0.25562.2442>
>     registered_name: []
>     exception exit: {{badmatch,
>                          {error,
>                              [{<7748.8396.531>,
>                                {exit,
>                                    {nodedown,'rabbit1 at host1'},
>                                    []}}]}},
>                      [{rabbit_channel,terminate,2},
>                       {gen_server2,terminate,3},
>                       {proc_lib,wake_up,3}]}
>       in function  gen_server2:terminate/3
>     ancestors: [<0.25560.2442>,<0.25544.2442>,<0.25542.2442>,
>                   rabbit_tcp_client_sup,rabbit_sup,<0.124.0>]
>     messages: []
>     links: [<0.25560.2442>]
>     dictionary: [{{exchange_stats,
>                        {resource,<<"/my_app">>,exchange,
>                            <<"service.exchange">>}},
>                    [{confirm,6},{publish,6}]},
>                   {{queue_exchange_stats,
>                        {<0.253.0>,
>                         {resource,<<"/my_app">>,exchange,
>                             <<"data.exchange">>}}},
>                    [{confirm,6},{publish,6}]},
>                   {delegate,delegate_4},
>                   {{monitoring,<0.253.0>},true},
>                   {{exchange_stats,
>                        {resource,<<"/my_app">>,exchange,
>                            <<"data.exchange">>}},
>                    [{confirm,6},{publish,6}]},
>                   {guid,{{11,<0.25562.2442>},11}}]
>     trap_exit: true
>     status: running
>     heap_size: 987
>     stack_size: 24
>     reductions: 11357
>   neighbours:
>  
> =SUPERVISOR REPORT==== 7-May-2012::10:13:33 ===
>      Supervisor: {<0.25560.2442>,rabbit_channel_sup}
>      Context:    child_terminated
>      Reason:     {{badmatch,
>                       {error,
>                           [{<7748.8396.531>,
>                             {exit,{nodedown,'rabbit1 at host1'},[]}}]}},
>                   [{rabbit_channel,terminate,2},
>                    {gen_server2,terminate,3},
>                    {proc_lib,wake_up,3}]}
>      Offender:   [{pid,<0.25562.2442>},
>                   {name,channel},
>                   {mfa,
>                       {rabbit_channel,start_link,
>                           [1,<0.25545.2442>,<0.25561.2442>,<0.25545.2442>,
>                            rabbit_framing_amqp_0_9_1,
>                            {user,<<"my_app">>,true,
>                                rabbit_auth_backend_internal,
>                                {internal_user,<<"my_app">>,
>                                    <<199,64,175,52,127,65,248,9,70,171,15,9,5,
>                                      122,73,4,195,147,238,67>>,
>                                    true}},
>                            <<"/my_app">>,[],<0.25543.2442>,
>                            #Fun<rabbit_channel_sup.0.15412730>]}},
>                   {restart_type,intrinsic},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From james.poole at rsa.com  Tue May  8 15:42:53 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Tue, 8 May 2012 10:42:53 -0400
Subject: [rabbitmq-discuss] Request Handshake Timeout Increase
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D70807D7907A@MX36A.corp.emc.com>

We have been fighting with getting RabbitMQ to work with SSL enabled using
the .NET client, and we have finally tracked down the root cause.

 

We were seeing the handshake timeout issue mentioned in this thread:

http://old.nabble.com/handshake_timeout-td33108733.html

 

"{handshake_timeout,handshake}"

 

It turns out that Microsoft has a default policy that tries to connect to
Windows Update on the internet to validate Certificate Authorities.  If the
client machine is not connected to the internet (our likely customer
deployment scenario and our development environment), then this can cause a
15 second delay when validating certificates.  Since the RabbitMQ handshake
timeout is 10 seconds, then this fails and closes the connection.  This was
only seen from the .NET client, and not the Java client.

 

I verified that disabling the local machine policy (directions here
http://technet.microsoft.com/en-us/library/cc749331%28v=ws.10%29.aspx)
allowed the SSL connection to immediately succeed.

 

My question is this. Is there any way we could have the handshake timeout
increased to something higher (20 seconds?) when SSL is enabled?  This would
save us a lot of hassle explaining to customers why communications fail and
requiring them to enable the AD policy exception.

 

-James

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/b2d011b0/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7449 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/b2d011b0/attachment.bin>

From clarsen at llnw.com  Tue May  8 16:12:40 2012
From: clarsen at llnw.com (Chris Larsen)
Date: Tue, 8 May 2012 11:12:40 -0400
Subject: [rabbitmq-discuss] Missing Durable Queues on Startup
In-Reply-To: <AA028E5E-95B7-41F2-A8C3-E34340E4A3B8@rabbitmq.com>
References: <4fdc6b6461db2c9f559bfd61b000631d@mail.gmail.com>
	<AA028E5E-95B7-41F2-A8C3-E34340E4A3B8@rabbitmq.com>
Message-ID: <79f15fd27b56222337c7e6d754bdf8ae@mail.gmail.com>

Thanks Steve!

> a) are all the nodes in your cluster disk nodes?

Yep, everything is a disk node

> b) was the node that you stop/started a disk node or a ram node?

The node stopped/started was a disk node

> c) when the cluster was restarted did you start all the disk nodes
first?

We didn't restart the whole cluster, just these two nodes in the cluster.
The other nodes were running happily.

> When you say:
>> We're not using HA in rabbit itself, the queues are just persistent
>> and durable on each node in the cluster.

> Can you be more precise? I assumed that the node you restarted was the
one that held the queues you were missing.

Yeah, I read about the HA mirrored queues and such but due to our
throughput and the way rabbit replicated at the time, it made more sense
for us to use DRBD. So we aren't using any of Rabbit's HA features at this
time.

> You appear to be running version 2.5.1. Clustering has had some fixes
applied to it since then.
> I would recommend upgrading to the latest release.

I'll look through the change logs and maybe upgrade our dev cluster and
see how it goes. Thanks!

From emile at rabbitmq.com  Tue May  8 16:16:07 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 08 May 2012 16:16:07 +0100
Subject: [rabbitmq-discuss] Request Handshake Timeout Increase
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D70807D7907A@MX36A.corp.emc.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D70807D7907A@MX36A.corp.emc.com>
Message-ID: <4FA938B7.1000003@rabbitmq.com>

Hi James,

On 08/05/12 15:42, james.poole at rsa.com wrote:
> My question is this? Is there any way we could have the handshake
> timeout increased to something higher (20 seconds?) when SSL is
> enabled?  This would save us a lot of hassle explaining to customers why
> communications fail and requiring them to enable the AD policy exception.

There is an SSL timeout of 5s defined here:

http://hg.rabbitmq.com/rabbitmq-server/file/e852cd4060d3/src/rabbit_networking.erl#l39

and a generic AMQP handshake timeout of 10s here:

 http://hg.rabbitmq.com/rabbitmq-server/file/e852cd4060d3/src/rabbit_reader.erl#l30

Neither of these are configurable values at present, so experimenting
will require recompiling the broker.



-Emile




From steve at rabbitmq.com  Tue May  8 16:40:08 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 8 May 2012 16:40:08 +0100
Subject: [rabbitmq-discuss] Per queue serialized delivery guarantee
In-Reply-To: <CAC-F2epuLbVDCFcwirnSP3xCaooh9WUFdPS6jS_WKuE8dyJ6Yg@mail.gmail.com>
References: <CAC-F2epuLbVDCFcwirnSP3xCaooh9WUFdPS6jS_WKuE8dyJ6Yg@mail.gmail.com>
Message-ID: <8723A554-7D54-43B0-B391-5C39BE68D2AB@rabbitmq.com>

Hi Lucas,

If there are consumers listening to a queue with fewer messages
unacknowledged than their own pre-fetch count, then the broker will
deliver a message to one of those consumers (if there is one to
deliver).

It is not possible to tell RabbitMQ to limit total deliveries to many
consumers at once (though I suppose that might be useful).

You do not say when a message received by a consumer is acknowledged,
though if it is consistency you need I assume this happens only when the
message has been 'processed' in some way.

If there were one consumer per queue, the messages could be dispatched
from that consumer to workers (for processing) with acks sent only when
the required processing for each message is completed.

If you wish these other workers could be listening to their own queues,
though it might be tricky to load-balance dispatching based upon whether
they are busy or not.

> Maybe I was thinking with the wrong abstractions, and I could, inside
> the same queue, guarantee the serial delivery of the messages based on
> some logic attribute in the message header, like "no message with
> attribute X will be delivered if there is an unacknowledged message
> with this same attribute X". Is that possible?

You appear to want to select messages from a queue based upon some
criterion. I believe this is not possible. The only message you can
ever consume from a queue is the one at the front.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 4 May 2012, at 19:40, Lucas Vella wrote:

> I have multiple queues and multiple consumers. To achieve load
> balancing, any consumer may consume from any queue, but for logic
> consistency in the system, no queue may deliver a message before
> receiving ack from the last message delivered from that queue. There
> may be a very large number of queues.
> 
> Is this scenario possible with RabbitMQ? I was working on the
> assumption that no message from a particular queue would be delivered
> if the was a pending unacknowledged message there, and a free consumer
> would pick a message from another queue, but that was not true for the
> tests I made, and serialization was only guaranteed if there was one
> consumer per queue. Also, the API did not provide any means for a
> consumer to read from "all available queues".
> 
> Maybe I was thinking with the wrong abstractions, and I could, inside
> the same queue, guarantee the serial delivery of the messages based on
> some logic attribute in the message header, like "no message with
> attribute X will be delivered if there is an unacknowledged message
> with this same attribute X". Is that possible?
> 
> What do you suggest?
> 
> --
> Lucas Clemente Vella
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From james.poole at rsa.com  Tue May  8 16:50:37 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Tue, 8 May 2012 11:50:37 -0400
Subject: [rabbitmq-discuss] SSL Certificate Error
In-Reply-To: <4FA92EA1.40801@rabbitmq.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707F76EE52C@MX36A.corp.emc.com>
	<FC3463BECF39B74996BF6ADDCB9BE7D70807D7903C@MX36A.corp.emc.com>
	<4FA92EA1.40801@rabbitmq.com>
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D70807D790D5@MX36A.corp.emc.com>

Signs are pointing to this being an issue with OpenSSL.  If I try to manually 
create a cert with OpenSSL using a subject of length greater than 64, it 
fails:

problems making Certificate Request
6532:error:0D07A097:asn1 encoding routines:ASN1_mbstring_ncopy:string too 
long:.
\crypto\asn1\a_mbstr.c:154:maxsize=64

Our certificates where we were seeing the issue were created with another tool 
(not OpenSSL) which didn't have this restriction.

The certificate that fails has a subject name of 72 chars.

-James

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: Tuesday, May 08, 2012 10:33 AM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] SSL Certificate Error

Hi James,

On 08/05/12 14:54, james.poole at rsa.com wrote:
> In case anyone runs into a similar issue, we found that our certificate
> had a subject length of over 64 characters.  This length limit seems
> like it is not part of the actual standard (LDAP doesn't enforce it),
> but in any case, shortening the subject fixed the issue.

Thanks for getting back to the list with your solution. Was subject
length really the only difference between a working and non-working
(ecertfile error) certificate? The chances of that seem somewhat remote.
Out of interest, were you been able to confirm your hypothesis with more
than one set of certificates that differ in subject length alone?

-Emile



-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7449 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/cda08d22/attachment.bin>

From emile at rabbitmq.com  Tue May  8 17:26:19 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 08 May 2012 17:26:19 +0100
Subject: [rabbitmq-discuss] SSL Certificate Error
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D70807D790D5@MX36A.corp.emc.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D707F76EE52C@MX36A.corp.emc.com>
	<FC3463BECF39B74996BF6ADDCB9BE7D70807D7903C@MX36A.corp.emc.com>
	<4FA92EA1.40801@rabbitmq.com>
	<FC3463BECF39B74996BF6ADDCB9BE7D70807D790D5@MX36A.corp.emc.com>
Message-ID: <4FA9492B.4070800@rabbitmq.com>

Hi James,

On 08/05/12 16:50, james.poole at rsa.com wrote:
> Signs are pointing to this being an issue with OpenSSL.  If I try to manually 
> create a cert with OpenSSL using a subject of length greater than 64, it 
> fails:

Thanks for making me aware of this. RFC3280 and RFC5280 confirms the 64
character limit. It would appear that the standards prevent you creating
subjects that are any longer than 64 characters.

> Our certificates where we were seeing the issue were created with another tool 
> (not OpenSSL) which didn't have this restriction.

The other tool is in violation of the spec! I would suggest adhering to
the spec for the best chance of interoperability.


-Emile


From nithyanirmal at gmail.com  Tue May  8 19:04:07 2012
From: nithyanirmal at gmail.com (Nithya Vijayakumar)
Date: Tue, 8 May 2012 11:04:07 -0700
Subject: [rabbitmq-discuss] service rabbitmq-server start stuck due to
	inet_gethost 4
Message-ID: <CAJinw2pgz6wC4xWCCX0+NUd29za8fsjU5QJjbWm+Pcf5q6xKEQ@mail.gmail.com>

We are using rabbitmq server 2.7.1 in two node auto clustering mode.

   Once in a while we are getting complaint that rabbitmq did not complete
the installation. What is happening underneath is "service rabbitmq-server
start" is getting stuck,  and subsequent installation steps also gets stuck
going into loop and many many runs trying to complete. I think
"inet_gethost 4" might be the culprit. Any suggestions on how to fix this?

  ps awfux | more

  root     19848  0.0  0.0 106412  1612 pts/0    S+   17:03   0:00  |
      \_ /bin/sh /sbin/service puppet debug
  root     19853  0.0  0.0 106624  1632 pts/0    S+   17:03   0:00  |
          \_ /bin/bash /etc/init.d/puppet debug
  root     19858  1.2  3.1 166288 64416 pts/0    S+   17:03   0:03  |
              \_ /usr/bin/ruby /usr/sbin/puppetd --server=
director.ecp-deploy.com --fqdn amq.ecp-deploy.com -o --no-daemonize -v
  root     20390  0.0  0.0   9760  1516 ?        Ss   17:03   0:00  |
                  \_ /bin/sh /sbin/service rabbitmq-server start
  root     20395  0.0  0.0   9500  1276 ?        S    17:03   0:00  |
                      \_ /bin/sh /etc/init.d/rabbitmq-server start
  root     20422  0.0  0.0   9496  1196 ?        Ss   17:03   0:00  |
                          \_ /bin/sh /usr/sbin/rabbitmq-server
  root     20433  0.0  0.0  42512  1384 ?        S    17:03   0:00  |
                          |   \_ su rabbitmq -s /bin/sh -c
/usr/lib/rabbitmq/bin/rabbitmq-server
  rabbitmq 20436  0.2  1.6 585140 33536 ?        Ssl  17:03   0:00  |
                          |       \_ /usr/lib64/erlang/erts-5.8.5/bin/beam
-W w -K true -A30 -P 1048576 -- -root /usr/lib64/erlang -progname erl --
-home /var/li
  b/rabbitmq -- -noshell -noinput -name *rabbit at amq.ecp-deploy.com* -boot *
/opt/cisco/rabbitmq/data/rabbit at amq.ecp-deploy.com-plugins-expand/rabbit*-config
/etc/rabbitmq/rabbitmq -kernel inet_dist_listen_min 45001 -kernel
inet_dist_li
  sten_max 45002 -kernel inet_default_connect_options [{nodelay,true}]
-sasl errlog_type error -sasl sasl_error_logger false -rabbit error_logger
{file,"*/opt/cisco/rabbitmq/log/rabbit at amq.ecp-deploy.com.log*" <*
mailto:/opt/cisco/rabbitmq/log/rabbit at amq.ecp-deploy.com.log</opt/cisco/rabbitmq/log/rabbit at amq.ecp-deploy.com.log>
*> } -rabbit sasl_error_log
  ger {file,"*/opt/cisco/rabbitmq/log/rabbit at amq.ecp-deploy.com-sasl.log*" <
*mailto:/opt/cisco/rabbitmq/log/rabbit at amq.ecp-deploy.com-sasl.log</opt/cisco/rabbitmq/log/rabbit at amq.ecp-deploy.com-sasl.log>
*> } -os_mon start_cpu_sup true -os_mon start_disksup false -os_mon
start_memsup false -mnesia dir "*
/opt/cisco/rabbitmq/data/rabbit at amq.ecp-deploy.com*" <*
mailto:/opt/cisco/rabbitmq/data/rabbit at amq.ecp-deploy.com</opt/cisco/rabbitmq/data/rabbit at amq.ecp-deploy.com>
*>
  rabbitmq 20513  0.0  0.0  10844   496 ?        Ss   17:03   0:00  |
                          |           \_ inet_gethost 4
  rabbitmq 20514  0.0  0.0  11056   412 ?        S    17:03   0:00  |
                          |               \_ inet_gethost 4
  root     20423  0.0  0.0   9496  1216 ?        S    17:03   0:00  |
                          \_ /bin/sh /usr/sbin/rabbitmqctl wait
/var/run/rabbitmq/pid
  root     20439  0.0  0.0  42512  1384 ?        S    17:03   0:00  |
                              \_ su rabbitmq -s /bin/sh -c
/usr/lib/rabbitmq/bin/rabbitmqctl  "wait" "/var/run/rabbitmq/pid"
  rabbitmq 20442  0.0  0.4  32312 10260 ?        Ss   17:03   0:00  |
                                  \_ /usr/lib64/erlang/erts-5.8.5/bin/beam
-- -root /usr/lib64/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa
/usr/lib/ra
  bbitmq/lib/rabbitmq_server-2.7.1/sbin/../ebin -noshell -noinput -hidden
-name rabbitmqctl20442 -s rabbit_control -nodename *
rabbit at amq.ecp-deploy.com* -extra wait /var/run/rabbitmq/pid
  rabbitmq 20468  0.0  0.0  10844   492 ?        Ss   17:03   0:00  |
                                      \_ inet_gethost 4
  rabbitmq 20469  0.0  0.0  11056   360 ?        S    17:03   0:00  |
                                          \_ inet_gethost 4

Thanks,
Nithya
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/cae7b55b/attachment.htm>

From matthias at rabbitmq.com  Tue May  8 19:07:59 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 08 May 2012 19:07:59 +0100
Subject: [rabbitmq-discuss] Request Handshake Timeout Increase
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D70807D7907A@MX36A.corp.emc.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D70807D7907A@MX36A.corp.emc.com>
Message-ID: <4FA960FF.6060106@rabbitmq.com>

James,

On 08/05/12 15:42, james.poole at rsa.com wrote:
> It turns out that Microsoft has a default policy that tries to connect
> to Windows Update on the internet to validate Certificate Authorities.
> If the client machine is not connected to the internet (our likely
> customer deployment scenario and our development environment), then this
> can cause a 15 second delay when validating certificates. Since the
> RabbitMQ handshake timeout is 10 seconds, then this fails and closes the
> connection. This was only seen from the .NET client, and not the Java
> client.
>
> I verified that disabling the local machine policy (directions here
> http://technet.microsoft.com/en-us/library/cc749331%28v=ws.10%29.aspx)
> allowed the SSL connection to immediately succeed.

 From the description of that policy it sounds like disabling would 
cause connections to fail:
<quote>
If the user is presented with a certificate issued by a root 
certification authority that is not directly trusted, and the Update 
Root Certificates feature is turned off through Group Policy, the user 
can be prevented from completing the action that required authentication.
</quote>

Though this may depend on the policy settings of the app. Have you 
looked at http://www.rabbitmq.com/ssl.html#trust-dotNET?

Also, the policy appears to only come into play when hitherto unknown 
root certificates are encountered. So it should be possible to avoid 
that situation by getting a server certificate with a root CA that 
Windows trusts by default.


Matthias.

From uday.subbarayan at yahoo.com  Tue May  8 22:34:40 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Tue, 8 May 2012 14:34:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Stomp Javascript Client
Message-ID: <1336512880.71218.YahooMailNeo@web44914.mail.sp1.yahoo.com>

Hi Guys,
? ?I looked at the Rabbit MQ Stomp adapter:
http://www.rabbitmq.com/stomp.html?

We should be able to push messages directly from RabbitMQ/Stomp to browser if we have a Javascript client which can connect to Rabbit. Am I correct? We don't need Node.js as a broker in the middle, right?

Thanks,
-Uday.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120508/feb50355/attachment.htm>

From mpietrek at skytap.com  Wed May  9 00:38:51 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 8 May 2012 16:38:51 -0700
Subject: [rabbitmq-discuss] Hang on "starting database ...." remains in
 2.8.2 cluster
In-Reply-To: <4FA8FADD.1050105@rabbitmq.com>
References: <CACLE7iykgZBFJaSCAs6+K6veXFGrweUiKWvT_QnGE-u6DhLJDQ@mail.gmail.com>
	<4FA8FADD.1050105@rabbitmq.com>
Message-ID: <CACLE7iz-9PMrZ_Q+Wsu_ntEafqt_CK555rfX0v0Y_cYNVNf+jw@mail.gmail.com>

Hi Francesco,

I run rabbitmq on 3 separate Ubuntu 10.04 64 bit VMs. Clustering is
enabled via the rabbitmq config file that lists all three hosts (all
them A, B, and C)

I start up all the VMs concurrently (via Capistrano) and verify that
the cluster is running as expected. I then go through this sequence:

--------
# On host A:
rabbitmqctl -n rabbit at A stop
nohup $RABBITMQ_SCRIPT_DIR/rabbitmq-server &
rabbitmqctl wait $PIDFILE

# On host B:
rabbitmqctl -n rabbit at B stop
nohup $RABBITMQ_SCRIPT_DIR/rabbitmq-server &
rabbitmqctl wait $PIDFILE

# On host C:
rabbitmqctl -n rabbit at C stop
nohup $RABBITMQ_SCRIPT_DIR/rabbitmq-server &
rabbitmqctl wait $PIDFILE
--------

The idea being to bring down one server while still retaining two in
the cluster.

During one of the start operations (it's not consistent from run to
run), rabbitmq-server will not finish starting up. The last line in
that node's nohup.dat file is:

"starting database   ....."

FWIW, it might be helpful to put the shutdown/startup commands in a
script that you can loop over repeatedly so as to try the whole
sequence numerous times. We use Capistrano here to execute actions on
remote machines, but you can probably use SSH to get the same effect
from a script file.

Let me know if you have other questions about our setup,

Matt


On Tue, May 8, 2012 at 3:52 AM, Francesco Mazzoli
<francesco at rabbitmq.com> wrote:
> Hi Matt,
>
> Predictably I can't reproduce this. Since you say that it'll happen
> "inevitably" (while if I understand correctly in your previous messages it
> was tricky to reproduce), can you send us more information about your setup
> and the steps on how to trigger the problem?
>
> Francesco.
>
>
> On 04/05/12 23:55, Matt Pietrek wrote:
>>
>> I've written this alias before about this topic, and the problem
>> remains in 2.8.2. See:
>>
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/018414.html
>>
>> I have a three node cluster running RabbitMQ 2.82/Erlang R13B03 on Ubuntu
>> 10.04.
>>
>> Once the cluster is up and running properly (as observed by the Web
>> UI), I then start/stop individual nodes in the cluster:
>> ? ? rabbitmqctl stop
>> ? ? rabbitmq-server
>>
>> Inevitably one of the nodes won't come back up, waiting forever on
>> "starting" the database (no 30 second timeout... Forever.)
>>
>> The only way to get all three nodes functioning again together is to
>> forcibly stop the other two nodes, then restart them all again.
>>
>>
>> The first item below is the console output as captured via nohup,
>> showing "starting database" as the last item.
>> The second item below is the last few lines of the rabbit@<node>.log
>> file, showing the node shutting down, then beginning to start up
>> again.
>>
>> Is it likely that a newer Erlang version would help out?
>> What else can I provide to help diagnose this?
>>
>> Thanks,
>>
>> Matt
>>
>> --------
>> node ? ? ? ? ? : rabbit at util
>> app descriptor :
>> /usr/lib/rabbitmq/lib/rabbitmq_server-2.8.2/sbin/../ebin/rabbit.app
>> home dir ? ? ? : /home/mpietrek
>> config file(s) : /home/mpietrek/work/var/run/rabbitmq.config
>> cookie hash ? ?: pR5H9kY3Wra/XdLELT5hgQ==
>> log ? ? ? ? ? ?:
>>
>> /home/mpietrek/work/logs/util.mpietrek.internal.illumita.com/rabbit at util.log
>> sasl log ? ? ? :
>>
>> /home/mpietrek/work/logs/util.mpietrek.internal.illumita.com/rabbit at util-sasl.log
>> database dir ? : /home/mpietrek/work/var/lib/rabbit at util
>> erlang version : 5.7.4
>>
>> -- rabbit boot start
>> starting file handle cache server
>> ...done
>> starting worker pool
>> ?...done
>> starting database ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ...
>>
>> --------
>>
>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>> ? ? application: rabbitmq_management_agent
>> ? ? exited: stopped
>> ? ? type: permanent
>>
>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>> stopped TCP Listener on 0.0.0.0:5672
>>
>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>> ? ? application: rabbit
>> ? ? exited: stopped
>> ? ? type: permanent
>>
>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>> ? ? application: os_mon
>> ? ? exited: stopped
>> ? ? type: permanent
>>
>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>> ? ? application: mnesia
>> ? ? exited: stopped
>> ? ? type: permanent
>>
>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>> Halting Erlang VM
>>
>> =INFO REPORT==== 4-May-2012::15:02:52 ===
>> Limiting to approx 924 file handles (829 sockets)
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From zongyong at gmail.com  Wed May  9 07:50:45 2012
From: zongyong at gmail.com (Zongyong Zheng)
Date: Wed, 9 May 2012 01:50:45 -0500
Subject: [rabbitmq-discuss] .Net client DeclareQueue durable queue,
 queue is deleted after the client application exits.
In-Reply-To: <4FA8EE7C.6090508@rabbitmq.com>
References: <caa8a235-e906-4c04-9bb5-b9c90cea0c15@y3g2000vbn.googlegroups.com>
	<4FA8EE7C.6090508@rabbitmq.com>
Message-ID: <CAEctOe4TYbv85x3nYLVbJ2t1ArkVAfsM-AadnDe5dG9T8DQqaQ@mail.gmail.com>

Thank you very much for your reply. Never Mind. My mistake. code auto
completion messed up the order of the three Boolean parameters. ;-)

Zongyong

On Tue, May 8, 2012 at 4:59 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 04/05/12 20:47, Zongyong Zheng wrote:
>
>> I knew if I can manually create the queue via RabbitMQ management http
>> API on the RabbitMQ server, the queue will be durable. However, this
>> workaround is not acceptable to me.
>>
>
> What does the .Net-created queue look like in the management plugin? i.e.
> are you *sure* that you are creating the queue durable, non-autodelete,
> non-exclusive? That's the only explanation I can think of...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120509/a73b1077/attachment.htm>

From s.ramanan.venkata at gmail.com  Wed May  9 07:35:25 2012
From: s.ramanan.venkata at gmail.com (Venkat)
Date: Tue, 8 May 2012 23:35:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Stale connections when using rabbitmq
Message-ID: <9f89e912-8e35-4a86-9bfe-5f07908c6e1a@e9g2000yqm.googlegroups.com>

Hi,

I have a web server which communicates with my backend using rabbitmq.
The web server receives req at the rate of 3000/sec. I had a rabbitmq
server on 8GB i7 machine. I saw rabbitmq refusing further connections
after a while. When I did rabbitmqctl list_connections, I saw lot of
connections in 'blocked'/'blocking' state. I recently moved from
memcache based queue for want of async nature. Please suggest me ways
to debug this situation.

[Note: I reduced the RAM to 2GB to reproduce it quicker]

Listing connections ...
guest			blocked
guest			blocked
guest	172.16.223.114	51914	blocked
guest	172.16.223.113	33600	blocked
guest	172.16.223.114	46209	blocked
guest	172.16.223.114	53108	blocked
guest	172.16.223.114	52984	blocked
guest	172.16.223.114	52310	blocked
guest	172.16.223.114	51776	blocked
guest			blocked
guest	172.16.223.114	52390	blocked
guest			blocked
guest	172.16.223.114	53374	blocked
guest	172.16.223.114	53252	blocked
guest			blocked
guest	172.16.223.114	39293	blocking
guest	172.16.223.114	52772	blocked
guest	172.16.223.114	52000	blocked
guest			blocked
guest	172.16.223.114	53072	blocked
guest	172.16.223.114	52852	blocked
guest	172.16.223.114	51862	blocked
guest	172.16.223.114	53601	blocked
guest			blocked
guest	172.16.223.114	52258	blocked
guest			blocked
guest			blocked
guest	172.16.223.114	39286	blocked
guest	172.16.223.114	53200	blocked
guest			blocked
guest	172.16.223.114	51746	blocked
guest	172.16.223.114	52940	blocked
guest	172.16.223.114	32803	blocked
guest	172.16.223.114	53020	blocked
guest	172.16.223.114	52346	blocked

root at testmachine3:~/$ sudo rabbitmqctl list_connections | wc -l
830

sudo rabbitmqctl status
Status of node rabbit at testmachine3 ...
[{pid,939},
 {running_applications,[{rabbit,"RabbitMQ","2.7.1"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.17"},
                        {os_mon,"CPO  CXC 138 46","2.2.5"},
                        {sasl,"SASL  CXC 138 11","2.1.9.3"},
                        {stdlib,"ERTS  CXC 138 10","1.17.3"},
                        {kernel,"ERTS  CXC 138 10","2.14.3"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:
2:2] [rq:2] [async-threads:30] [kernel-poll:true]\n"},
 {memory,[{total,1626268744},
          {processes,1296143128},
          {processes_used,1296128032},
          {system,330125616},
          {atom,3600969},
          {atom_used,3573207},
          {binary,6811184},
          {code,11216694},
          {ets,305365584}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,1593409536}]
...done.

When my web server tries to connect to rabbitmq at this stage it give
me the following exception.

  File "/usr/local/lib/python2.7/dist-packages/msgbroker.py", line
194, in __init__
    self.connection =
pika.BlockingConnection(pika.ConnectionParameters(host=host_server))

  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
blocking_connection.py", line 32, in __init__
    BaseConnection.__init__(self, parameters, None,
reconnection_strategy)

  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
base_connection.py", line 50, in __init__
    reconnection_strategy)

  File "/usr/local/lib/python2.7/dist-packages/pika/connection.py",
line 170, in __init__
    self._connect()

  File "/usr/local/lib/python2.7/dist-packages/pika/connection.py",
line 228, in _connect
    self.parameters.port or  spec.PORT)

  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
blocking_connection.py", line 44, in _adapter_connect
    self._handle_read()

  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
base_connection.py", line 151, in _handle_read
    data = self.socket.recv(self._suggested_buffer_size)

timeout: timed out

Thanks,

From sudheermaddukuri at gmail.com  Wed May  9 08:10:51 2012
From: sudheermaddukuri at gmail.com (Sudheer Maddukuri)
Date: Wed, 9 May 2012 00:10:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Centralized web logging options.
In-Reply-To: <CAGtiFWVppgh-iQzts44P5rK9TEWwJp0E-Ojhqn1-sO6LsuBpdQ@mail.gmail.com>
References: <CAKhN_m5bViVyThm-2_2AwvDY5QKtL_by=J9N-gONk-ZrkvcH_w@mail.gmail.com>
	<1332415858.18176.6.camel@workstation.wmmi.net>
	<ED51A8FBDD4F4F6F94B3619293ACE328@myyearbook.com>
	<CAGtiFWVppgh-iQzts44P5rK9TEWwJp0E-Ojhqn1-sO6LsuBpdQ@mail.gmail.com>
Message-ID: <25195000.29.1336547451459.JavaMail.geo-discussion-forums@yndz2>

Hi,

I am working on a similar implementation. Can you please provide more 
details about how you made this work?

Eagerly waiting for a reply.

Thanks,
Sudheer

On Thursday, 22 March 2012 18:43:04 UTC+5:30, David Sinclair wrote:
>
> We are using Flume https://cwiki.apache.org/FLUME/ with the RabbitMQ 
> Plugin https://github.com/stampy88/flume-amqp-plugin. Works like a charm
>
> On Thu, Mar 22, 2012 at 9:05 AM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>
>>  
>>  On Thursday, March 22, 2012 at 7:30 AM, Adam Tauno Williams wrote:
>>
>> On Sat, 2012-02-25 at 06:25 +0700, Bill Moseley wrote:
>>
>> We have a busy pool of web servers running Apache that are currently
>> logging on each machine. I'm looking at using RabbitMQ and a
>> centralized log server.
>>
>>
>> A syslog -> rabbit adaptor would be nice. But I haven't found such a
>> thing.
>>
>> https://github.com/bkjones/bevis 
>>
>>  
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120509/f838bd55/attachment.htm>

From simon at rabbitmq.com  Wed May  9 11:18:03 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 09 May 2012 11:18:03 +0100
Subject: [rabbitmq-discuss] Stale connections when using rabbitmq
In-Reply-To: <9f89e912-8e35-4a86-9bfe-5f07908c6e1a@e9g2000yqm.googlegroups.com>
References: <9f89e912-8e35-4a86-9bfe-5f07908c6e1a@e9g2000yqm.googlegroups.com>
Message-ID: <4FAA445B.2070401@rabbitmq.com>

It sounds like you are overloading your RabbitMQ server - with 2.7.1 
messages would queue up indefinitely in process mailboxes, eventually 
filling up enough RAM that all connections will block. With 2.8.0+ 
individual connections will be throttled instead.

You might want to upgrade to 2.8.2 since that has some performance 
improvements anyway. You might also want to try turning hipe_compile on 
to get a performance boost. But if you are maxing out your server then 
ultimately you'll need bigger hardware or more machines.

Cheers, Simon

On 09/05/12 07:35, Venkat wrote:
> Hi,
>
> I have a web server which communicates with my backend using rabbitmq.
> The web server receives req at the rate of 3000/sec. I had a rabbitmq
> server on 8GB i7 machine. I saw rabbitmq refusing further connections
> after a while. When I did rabbitmqctl list_connections, I saw lot of
> connections in 'blocked'/'blocking' state. I recently moved from
> memcache based queue for want of async nature. Please suggest me ways
> to debug this situation.
>
> [Note: I reduced the RAM to 2GB to reproduce it quicker]
>
> Listing connections ...
> guest			blocked
> guest			blocked
> guest	172.16.223.114	51914	blocked
> guest	172.16.223.113	33600	blocked
> guest	172.16.223.114	46209	blocked
> guest	172.16.223.114	53108	blocked
> guest	172.16.223.114	52984	blocked
> guest	172.16.223.114	52310	blocked
> guest	172.16.223.114	51776	blocked
> guest			blocked
> guest	172.16.223.114	52390	blocked
> guest			blocked
> guest	172.16.223.114	53374	blocked
> guest	172.16.223.114	53252	blocked
> guest			blocked
> guest	172.16.223.114	39293	blocking
> guest	172.16.223.114	52772	blocked
> guest	172.16.223.114	52000	blocked
> guest			blocked
> guest	172.16.223.114	53072	blocked
> guest	172.16.223.114	52852	blocked
> guest	172.16.223.114	51862	blocked
> guest	172.16.223.114	53601	blocked
> guest			blocked
> guest	172.16.223.114	52258	blocked
> guest			blocked
> guest			blocked
> guest	172.16.223.114	39286	blocked
> guest	172.16.223.114	53200	blocked
> guest			blocked
> guest	172.16.223.114	51746	blocked
> guest	172.16.223.114	52940	blocked
> guest	172.16.223.114	32803	blocked
> guest	172.16.223.114	53020	blocked
> guest	172.16.223.114	52346	blocked
>
> root at testmachine3:~/$ sudo rabbitmqctl list_connections | wc -l
> 830
>
> sudo rabbitmqctl status
> Status of node rabbit at testmachine3 ...
> [{pid,939},
>   {running_applications,[{rabbit,"RabbitMQ","2.7.1"},
>                          {mnesia,"MNESIA  CXC 138 12","4.4.17"},
>                          {os_mon,"CPO  CXC 138 46","2.2.5"},
>                          {sasl,"SASL  CXC 138 11","2.1.9.3"},
>                          {stdlib,"ERTS  CXC 138 10","1.17.3"},
>                          {kernel,"ERTS  CXC 138 10","2.14.3"}]},
>   {os,{unix,linux}},
>   {erlang_version,"Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:
> 2:2] [rq:2] [async-threads:30] [kernel-poll:true]\n"},
>   {memory,[{total,1626268744},
>            {processes,1296143128},
>            {processes_used,1296128032},
>            {system,330125616},
>            {atom,3600969},
>            {atom_used,3573207},
>            {binary,6811184},
>            {code,11216694},
>            {ets,305365584}]},
>   {vm_memory_high_watermark,0.4},
>   {vm_memory_limit,1593409536}]
> ...done.
>
> When my web server tries to connect to rabbitmq at this stage it give
> me the following exception.
>
>    File "/usr/local/lib/python2.7/dist-packages/msgbroker.py", line
> 194, in __init__
>      self.connection =
> pika.BlockingConnection(pika.ConnectionParameters(host=host_server))
>
>    File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
> blocking_connection.py", line 32, in __init__
>      BaseConnection.__init__(self, parameters, None,
> reconnection_strategy)
>
>    File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
> base_connection.py", line 50, in __init__
>      reconnection_strategy)
>
>    File "/usr/local/lib/python2.7/dist-packages/pika/connection.py",
> line 170, in __init__
>      self._connect()
>
>    File "/usr/local/lib/python2.7/dist-packages/pika/connection.py",
> line 228, in _connect
>      self.parameters.port or  spec.PORT)
>
>    File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
> blocking_connection.py", line 44, in _adapter_connect
>      self._handle_read()
>
>    File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
> base_connection.py", line 151, in _handle_read
>      data = self.socket.recv(self._suggested_buffer_size)
>
> timeout: timed out
>
> Thanks,
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed May  9 11:21:07 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 09 May 2012 11:21:07 +0100
Subject: [rabbitmq-discuss] service rabbitmq-server start stuck due to
 inet_gethost 4
In-Reply-To: <CAJinw2pgz6wC4xWCCX0+NUd29za8fsjU5QJjbWm+Pcf5q6xKEQ@mail.gmail.com>
References: <CAJinw2pgz6wC4xWCCX0+NUd29za8fsjU5QJjbWm+Pcf5q6xKEQ@mail.gmail.com>
Message-ID: <4FAA4513.6060007@rabbitmq.com>

inet_gethost is a process that is started by the Erlang VM - it should 
always be there; it's not part of startup.

It would be useful to know where rabbit is getting stuck on startup - 
what ends up in the logs?

Cheers, Simon

On 08/05/12 19:04, Nithya Vijayakumar wrote:
>
>         We are using rabbitmq server 2.7.1 in two node auto clustering mode.
>
>             Once in a while we are getting complaint that rabbitmq did
>         not complete the installation. What is happening underneath is
>         "service rabbitmq-server start" is getting stuck,  and
>         subsequent installation steps also gets stuck going into loop
>         and many many runs trying to complete. I think "inet_gethost 4"
>         might be the culprit. Any suggestions on how to fix this?
>
>            ps awfux | more
>
>            root     19848  0.0  0.0 106412  1612 pts/0    S+   17:03
>            0:00  |       \_ /bin/sh /sbin/service puppet debug
>            root     19853  0.0  0.0 106624  1632 pts/0    S+   17:03
>            0:00  |           \_ /bin/bash /etc/init.d/puppet debug
>            root     19858  1.2  3.1 166288 64416 pts/0    S+   17:03
>            0:03  |               \_ /usr/bin/ruby /usr/sbin/puppetd
>         --server=director.ecp-deploy.com
>         <http://director.ecp-deploy.com> --fqdn amq.ecp-deploy.com
>         <http://amq.ecp-deploy.com> -o --no-daemonize -v
>            root     20390  0.0  0.0   9760  1516 ?        Ss   17:03
>            0:00  |                   \_ /bin/sh /sbin/service
>         rabbitmq-server start
>            root     20395  0.0  0.0   9500  1276 ?        S    17:03
>            0:00  |                       \_ /bin/sh
>         /etc/init.d/rabbitmq-server start
>            root     20422  0.0  0.0   9496  1196 ?        Ss   17:03
>            0:00  |                           \_ /bin/sh
>         /usr/sbin/rabbitmq-server
>            root     20433  0.0  0.0  42512  1384 ?        S    17:03
>            0:00  |                           |   \_ su rabbitmq -s
>         /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmq-server
>            rabbitmq 20436  0.2  1.6 585140 33536 ?        Ssl  17:03
>            0:00  |                           |       \_
>         /usr/lib64/erlang/erts-5.8.5/bin/beam -W w -K true -A30 -P
>         1048576 -- -root /usr/lib64/erlang -progname erl -- -home /var/li
>            b/rabbitmq -- -noshell -noinput -name
>         _rabbit at amq.ecp-deploy.com_ -boot
>         _/opt/cisco/rabbitmq/data/rabbit at amq.ecp-deploy.com-plugins-expand/rabbit_
>         -config /etc/rabbitmq/rabbitmq -kernel inet_dist_listen_min
>         45001 -kernel inet_dist_li
>            sten_max 45002 -kernel inet_default_connect_options
>         [{nodelay,true}] -sasl errlog_type error -sasl sasl_error_logger
>         false -rabbit error_logger
>         {file,"_/opt/cisco/rabbitmq/log/rabbit at amq.ecp-deploy.com.log_"
>         <_mailto:/opt/cisco/rabbitmq/log/rabbit at amq.ecp-deploy.com.log_>
>         } -rabbit sasl_error_log
>            ger
>         {file,"_/opt/cisco/rabbitmq/log/rabbit at amq.ecp-deploy.com-sasl.log_"
>         <_mailto:/opt/cisco/rabbitmq/log/rabbit at amq.ecp-deploy.com-sasl.log_>
>         } -os_mon start_cpu_sup true -os_mon start_disksup false -os_mon
>         start_memsup false -mnesia dir
>         "_/opt/cisco/rabbitmq/data/rabbit at amq.ecp-deploy.com_"
>         <_mailto:/opt/cisco/rabbitmq/data/rabbit at amq.ecp-deploy.com_>
>            rabbitmq 20513  0.0  0.0  10844   496 ?        Ss   17:03
>            0:00  |                           |           \_ inet_gethost 4
>            rabbitmq 20514  0.0  0.0  11056   412 ?        S    17:03
>            0:00  |                           |               \_
>         inet_gethost 4
>            root     20423  0.0  0.0   9496  1216 ?        S    17:03
>            0:00  |                           \_ /bin/sh
>         /usr/sbin/rabbitmqctl wait /var/run/rabbitmq/pid
>            root     20439  0.0  0.0  42512  1384 ?        S    17:03
>            0:00  |                               \_ su rabbitmq -s
>         /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl "wait"
>         "/var/run/rabbitmq/pid"
>            rabbitmq 20442  0.0  0.4  32312 10260 ?        Ss   17:03
>            0:00  |                                   \_
>         /usr/lib64/erlang/erts-5.8.5/bin/beam -- -root /usr/lib64/erlang
>         -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/ra
>            bbitmq/lib/rabbitmq_server-2.7.1/sbin/../ebin -noshell
>         -noinput -hidden -name rabbitmqctl20442 -s rabbit_control
>         -nodename _rabbit at amq.ecp-deploy.com_ -extra wait
>         /var/run/rabbitmq/pid
>            rabbitmq 20468  0.0  0.0  10844   492 ?        Ss   17:03
>            0:00  |                                       \_ inet_gethost 4
>            rabbitmq 20469  0.0  0.0  11056   360 ?        S    17:03
>            0:00  |                                           \_
>         inet_gethost 4
>
>         Thanks,
>         Nithya
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Wed May  9 12:06:18 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 9 May 2012 13:06:18 +0200
Subject: [rabbitmq-discuss] service rabbitmq-server start stuck due to
 inet_gethost 4
In-Reply-To: <4FAA4513.6060007@rabbitmq.com>
References: <CAJinw2pgz6wC4xWCCX0+NUd29za8fsjU5QJjbWm+Pcf5q6xKEQ@mail.gmail.com>
	<4FAA4513.6060007@rabbitmq.com>
Message-ID: <CAMcAHLU4+5wxFbXmOBQfJrCrYe7zdLUa9uUi-PJAjJhjXH26hA@mail.gmail.com>

I had a similar problem perhaps? at least related until I added this line
to my /etc/hosts on My mac:

127.0.0.1 alvaro.local

of course adapt it to your environment and see if it helps.

On Wed, May 9, 2012 at 12:21 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> inet_gethost is a process that is started by the Erlang VM - it should
> always be there; it's not part of startup.
>
> It would be useful to know where rabbit is getting stuck on startup - what
> ends up in the logs?
>
> Cheers, Simon
>
>
> On 08/05/12 19:04, Nithya Vijayakumar wrote:
>
>>
>>        We are using rabbitmq server 2.7.1 in two node auto clustering
>> mode.
>>
>>            Once in a while we are getting complaint that rabbitmq did
>>        not complete the installation. What is happening underneath is
>>        "service rabbitmq-server start" is getting stuck,  and
>>        subsequent installation steps also gets stuck going into loop
>>        and many many runs trying to complete. I think "inet_gethost 4"
>>        might be the culprit. Any suggestions on how to fix this?
>>
>>           ps awfux | more
>>
>>           root     19848  0.0  0.0 106412  1612 pts/0    S+   17:03
>>           0:00  |       \_ /bin/sh /sbin/service puppet debug
>>           root     19853  0.0  0.0 106624  1632 pts/0    S+   17:03
>>           0:00  |           \_ /bin/bash /etc/init.d/puppet debug
>>           root     19858  1.2  3.1 166288 64416 pts/0    S+   17:03
>>           0:03  |               \_ /usr/bin/ruby /usr/sbin/puppetd
>>        --server=director.ecp-deploy.**com<http://director.ecp-deploy.com>
>>        <http://director.ecp-deploy.**com <http://director.ecp-deploy.com>>
>> --fqdn amq.ecp-deploy.com
>>        <http://amq.ecp-deploy.com> -o --no-daemonize -v
>>
>>           root     20390  0.0  0.0   9760  1516 ?        Ss   17:03
>>           0:00  |                   \_ /bin/sh /sbin/service
>>        rabbitmq-server start
>>           root     20395  0.0  0.0   9500  1276 ?        S    17:03
>>           0:00  |                       \_ /bin/sh
>>        /etc/init.d/rabbitmq-server start
>>           root     20422  0.0  0.0   9496  1196 ?        Ss   17:03
>>           0:00  |                           \_ /bin/sh
>>        /usr/sbin/rabbitmq-server
>>           root     20433  0.0  0.0  42512  1384 ?        S    17:03
>>           0:00  |                           |   \_ su rabbitmq -s
>>        /bin/sh -c /usr/lib/rabbitmq/bin/**rabbitmq-server
>>           rabbitmq 20436  0.2  1.6 585140 33536 ?        Ssl  17:03
>>           0:00  |                           |       \_
>>        /usr/lib64/erlang/erts-5.8.5/**bin/beam -W w -K true -A30 -P
>>        1048576 -- -root /usr/lib64/erlang -progname erl -- -home /var/li
>>           b/rabbitmq -- -noshell -noinput -name
>>        _rabbit at amq.ecp-deploy.com_ -boot
>>        _/opt/cisco/rabbitmq/data/**rabbit at amq.ecp-deploy.com-**
>> plugins-expand/rabbit_
>>
>>        -config /etc/rabbitmq/rabbitmq -kernel inet_dist_listen_min
>>        45001 -kernel inet_dist_li
>>           sten_max 45002 -kernel inet_default_connect_options
>>        [{nodelay,true}] -sasl errlog_type error -sasl sasl_error_logger
>>        false -rabbit error_logger
>>        {file,"_/opt/cisco/rabbitmq/**log/rabbit at amq.ecp-deploy.com.**
>> log_"
>>        <_mailto:/opt/cisco/rabbitmq/**log/rabbit at amq.ecp-deploy.com.**
>> log_>
>>        } -rabbit sasl_error_log
>>           ger
>>        {file,"_/opt/cisco/rabbitmq/**log/rabbit at amq.ecp-deploy.com-**
>> sasl.log_"
>>        <_mailto:/opt/cisco/rabbitmq/**log/rabbit at amq.ecp-deploy.com-**
>> sasl.log_>
>>
>>        } -os_mon start_cpu_sup true -os_mon start_disksup false -os_mon
>>        start_memsup false -mnesia dir
>>        "_/opt/cisco/rabbitmq/data/**rabbit at amq.ecp-deploy.com_"
>>        <_mailto:/opt/cisco/rabbitmq/**data/rabbit at amq.ecp-deploy.**com_>
>>
>>           rabbitmq 20513  0.0  0.0  10844   496 ?        Ss   17:03
>>           0:00  |                           |           \_ inet_gethost 4
>>           rabbitmq 20514  0.0  0.0  11056   412 ?        S    17:03
>>           0:00  |                           |               \_
>>        inet_gethost 4
>>           root     20423  0.0  0.0   9496  1216 ?        S    17:03
>>           0:00  |                           \_ /bin/sh
>>        /usr/sbin/rabbitmqctl wait /var/run/rabbitmq/pid
>>           root     20439  0.0  0.0  42512  1384 ?        S    17:03
>>           0:00  |                               \_ su rabbitmq -s
>>        /bin/sh -c /usr/lib/rabbitmq/bin/**rabbitmqctl "wait"
>>        "/var/run/rabbitmq/pid"
>>           rabbitmq 20442  0.0  0.4  32312 10260 ?        Ss   17:03
>>           0:00  |                                   \_
>>        /usr/lib64/erlang/erts-5.8.5/**bin/beam -- -root /usr/lib64/erlang
>>        -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/ra
>>           bbitmq/lib/rabbitmq_server-2.**7.1/sbin/../ebin -noshell
>>        -noinput -hidden -name rabbitmqctl20442 -s rabbit_control
>>        -nodename _rabbit at amq.ecp-deploy.com_ -extra wait
>>
>>        /var/run/rabbitmq/pid
>>           rabbitmq 20468  0.0  0.0  10844   492 ?        Ss   17:03
>>           0:00  |                                       \_ inet_gethost 4
>>           rabbitmq 20469  0.0  0.0  11056   360 ?        S    17:03
>>           0:00  |                                           \_
>>        inet_gethost 4
>>
>>        Thanks,
>>        Nithya
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120509/ef03215d/attachment.htm>

From francesco at rabbitmq.com  Wed May  9 14:27:06 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 09 May 2012 14:27:06 +0100
Subject: [rabbitmq-discuss] Hang on "starting database ...." remains in
 2.8.2 cluster
In-Reply-To: <CACLE7iz-9PMrZ_Q+Wsu_ntEafqt_CK555rfX0v0Y_cYNVNf+jw@mail.gmail.com>
References: <CACLE7iykgZBFJaSCAs6+K6veXFGrweUiKWvT_QnGE-u6DhLJDQ@mail.gmail.com>
	<4FA8FADD.1050105@rabbitmq.com>
	<CACLE7iz-9PMrZ_Q+Wsu_ntEafqt_CK555rfX0v0Y_cYNVNf+jw@mail.gmail.com>
Message-ID: <4FAA70AA.6060407@rabbitmq.com>

Hi Matt,

I've tried to reproduce your setup locally and I never get hanging 
nodes. I've attached the bash script and the config I'm using, can you 
confirm that that corresponds to what you're doing?

You can use the script like this:
     ./test 10
Where "10" is the number of times the node will be restarted.

Francesco.

On 09/05/12 00:38, Matt Pietrek wrote:
> Hi Francesco,
>
> I run rabbitmq on 3 separate Ubuntu 10.04 64 bit VMs. Clustering is
> enabled via the rabbitmq config file that lists all three hosts (all
> them A, B, and C)
>
> I start up all the VMs concurrently (via Capistrano) and verify that
> the cluster is running as expected. I then go through this sequence:
>
> --------
> # On host A:
> rabbitmqctl -n rabbit at A stop
> nohup $RABBITMQ_SCRIPT_DIR/rabbitmq-server&
> rabbitmqctl wait $PIDFILE
>
> # On host B:
> rabbitmqctl -n rabbit at B stop
> nohup $RABBITMQ_SCRIPT_DIR/rabbitmq-server&
> rabbitmqctl wait $PIDFILE
>
> # On host C:
> rabbitmqctl -n rabbit at C stop
> nohup $RABBITMQ_SCRIPT_DIR/rabbitmq-server&
> rabbitmqctl wait $PIDFILE
> --------
>
> The idea being to bring down one server while still retaining two in
> the cluster.
>
> During one of the start operations (it's not consistent from run to
> run), rabbitmq-server will not finish starting up. The last line in
> that node's nohup.dat file is:
>
> "starting database   ....."
>
> FWIW, it might be helpful to put the shutdown/startup commands in a
> script that you can loop over repeatedly so as to try the whole
> sequence numerous times. We use Capistrano here to execute actions on
> remote machines, but you can probably use SSH to get the same effect
> from a script file.
>
> Let me know if you have other questions about our setup,
>
> Matt
>
>
> On Tue, May 8, 2012 at 3:52 AM, Francesco Mazzoli
> <francesco at rabbitmq.com>  wrote:
>> Hi Matt,
>>
>> Predictably I can't reproduce this. Since you say that it'll happen
>> "inevitably" (while if I understand correctly in your previous messages it
>> was tricky to reproduce), can you send us more information about your setup
>> and the steps on how to trigger the problem?
>>
>> Francesco.
>>
>>
>> On 04/05/12 23:55, Matt Pietrek wrote:
>>>
>>> I've written this alias before about this topic, and the problem
>>> remains in 2.8.2. See:
>>>
>>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/018414.html
>>>
>>> I have a three node cluster running RabbitMQ 2.82/Erlang R13B03 on Ubuntu
>>> 10.04.
>>>
>>> Once the cluster is up and running properly (as observed by the Web
>>> UI), I then start/stop individual nodes in the cluster:
>>>      rabbitmqctl stop
>>>      rabbitmq-server
>>>
>>> Inevitably one of the nodes won't come back up, waiting forever on
>>> "starting" the database (no 30 second timeout... Forever.)
>>>
>>> The only way to get all three nodes functioning again together is to
>>> forcibly stop the other two nodes, then restart them all again.
>>>
>>>
>>> The first item below is the console output as captured via nohup,
>>> showing "starting database" as the last item.
>>> The second item below is the last few lines of the rabbit@<node>.log
>>> file, showing the node shutting down, then beginning to start up
>>> again.
>>>
>>> Is it likely that a newer Erlang version would help out?
>>> What else can I provide to help diagnose this?
>>>
>>> Thanks,
>>>
>>> Matt
>>>
>>> --------
>>> node           : rabbit at util
>>> app descriptor :
>>> /usr/lib/rabbitmq/lib/rabbitmq_server-2.8.2/sbin/../ebin/rabbit.app
>>> home dir       : /home/mpietrek
>>> config file(s) : /home/mpietrek/work/var/run/rabbitmq.config
>>> cookie hash    : pR5H9kY3Wra/XdLELT5hgQ==
>>> log            :
>>>
>>> /home/mpietrek/work/logs/util.mpietrek.internal.illumita.com/rabbit at util.log
>>> sasl log       :
>>>
>>> /home/mpietrek/work/logs/util.mpietrek.internal.illumita.com/rabbit at util-sasl.log
>>> database dir   : /home/mpietrek/work/var/lib/rabbit at util
>>> erlang version : 5.7.4
>>>
>>> -- rabbit boot start
>>> starting file handle cache server
>>> ...done
>>> starting worker pool
>>>   ...done
>>> starting database                                                     ...
>>>
>>> --------
>>>
>>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>>>      application: rabbitmq_management_agent
>>>      exited: stopped
>>>      type: permanent
>>>
>>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>>> stopped TCP Listener on 0.0.0.0:5672
>>>
>>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>>>      application: rabbit
>>>      exited: stopped
>>>      type: permanent
>>>
>>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>>>      application: os_mon
>>>      exited: stopped
>>>      type: permanent
>>>
>>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>>>      application: mnesia
>>>      exited: stopped
>>>      type: permanent
>>>
>>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>>> Halting Erlang VM
>>>
>>> =INFO REPORT==== 4-May-2012::15:02:52 ===
>>> Limiting to approx 924 file handles (829 sockets)
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>

-------------- next part --------------
[
 {rabbit, [{cluster_nodes, [rabbit at mcnulty, hare at mcnulty, franc at mcnulty]}]}
].
-------------- next part --------------
#!/bin/bash

rabbitmq_server=~/src/rabbitmq-umbrella/rabbitmq-server/scripts/rabbitmq-server
rabbitmqctl=~/src/rabbitmq-umbrella/rabbitmq-server/scripts/rabbitmqctl

function start {
    RABBITMQ_NODE_PORT=$2 \
    RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb listeners [{mgmt,[{port,5"$2"}]}]" \
    RABBITMQ_NODENAME=$1 \
    RABBITMQ_MNESIA_DIR=/tmp/rabbitmq-$1-mnesia \
    RABBITMQ_PLUGINS_EXPAND_DIR=/tmp/rabbitmq-$1-plugins-scratch \
    RABBITMQ_LOG_BASE=/tmp \
    RABBITMQ_CONFIG_FILE=`pwd`/rabbitmq \
    $rabbitmq_server </dev/null &>/dev/null &

    $rabbitmqctl -n $1 wait /tmp/rabbitmq-$1-mnesia.pid
}

function stop {
    $rabbitmqctl -n $1 stop /tmp/rabbitmq-$1-mnesia.pid
}

function restart {
    stop $1
    start $1 $2
}

# To use the functions on their own
if [ $1 = "start" ]; then
    start $2 $3
elif [ $1 = "stop" ]; then
    stop $2
elif [ $1 = "restart" ]; then
    restart $2 $3
elif [ $1 = "clean" ]; then
    rm -rf /tmp/rabbit*
    rm -rf /tmp/hare*
    rm -rf /tmp/franc*
elif ! [[ $1 =~ ^[0-9]+$ ]] ; then
    name=`basename $0`
    echo "Usage:"
    echo "./$name start nodename port"
    echo "./$name stop nodename"
    echo "./$name restart nodename port"
    echo "./$name n -- n is the number of times the nodes will be restarted"
else
    echo "----------------------------------------------------------"
    echo "---- Starting nodes --------------------------------------"
    echo "----------------------------------------------------------"

    start rabbit 5672
    start hare 5673
    start franc 5674

    for (( i = 1; i <= $1; i++ )); do
        echo "----------------------------------------------------------"
        echo "---- Restarting nodes ------------------------------------"
        echo "----------------------------------------------------------"
        
        restart rabbit 5672
        restart hare 5673
        restart franc 5674
    done
    
    echo "----------------------------------------------------------"
    echo "---- Stopping nodes -------------------------------------"
    echo "----------------------------------------------------------"
    
    stop rabbit 
    stop hare 
    stop franc 
fi


From francesco at rabbitmq.com  Wed May  9 14:29:00 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 09 May 2012 14:29:00 +0100
Subject: [rabbitmq-discuss] Hang on "starting database ...." remains in
 2.8.2 cluster
In-Reply-To: <4FAA70AA.6060407@rabbitmq.com>
References: <CACLE7iykgZBFJaSCAs6+K6veXFGrweUiKWvT_QnGE-u6DhLJDQ@mail.gmail.com>
	<4FA8FADD.1050105@rabbitmq.com>
	<CACLE7iz-9PMrZ_Q+Wsu_ntEafqt_CK555rfX0v0Y_cYNVNf+jw@mail.gmail.com>
	<4FAA70AA.6060407@rabbitmq.com>
Message-ID: <4FAA711C.6050805@rabbitmq.com>

Oh and of course you should change the "rabbitmq_server" and 
"rabbitmqctl" variables to reflect the location of those scripts on your 
machine.

Francesco.

On 09/05/12 14:27, Francesco Mazzoli wrote:
> Hi Matt,
>
> I've tried to reproduce your setup locally and I never get hanging
> nodes. I've attached the bash script and the config I'm using, can you
> confirm that that corresponds to what you're doing?
>
> You can use the script like this:
> ./test 10
> Where "10" is the number of times the node will be restarted.
>
> Francesco.
>
> On 09/05/12 00:38, Matt Pietrek wrote:
>> Hi Francesco,
>>
>> I run rabbitmq on 3 separate Ubuntu 10.04 64 bit VMs. Clustering is
>> enabled via the rabbitmq config file that lists all three hosts (all
>> them A, B, and C)
>>
>> I start up all the VMs concurrently (via Capistrano) and verify that
>> the cluster is running as expected. I then go through this sequence:
>>
>> --------
>> # On host A:
>> rabbitmqctl -n rabbit at A stop
>> nohup $RABBITMQ_SCRIPT_DIR/rabbitmq-server&
>> rabbitmqctl wait $PIDFILE
>>
>> # On host B:
>> rabbitmqctl -n rabbit at B stop
>> nohup $RABBITMQ_SCRIPT_DIR/rabbitmq-server&
>> rabbitmqctl wait $PIDFILE
>>
>> # On host C:
>> rabbitmqctl -n rabbit at C stop
>> nohup $RABBITMQ_SCRIPT_DIR/rabbitmq-server&
>> rabbitmqctl wait $PIDFILE
>> --------
>>
>> The idea being to bring down one server while still retaining two in
>> the cluster.
>>
>> During one of the start operations (it's not consistent from run to
>> run), rabbitmq-server will not finish starting up. The last line in
>> that node's nohup.dat file is:
>>
>> "starting database ....."
>>
>> FWIW, it might be helpful to put the shutdown/startup commands in a
>> script that you can loop over repeatedly so as to try the whole
>> sequence numerous times. We use Capistrano here to execute actions on
>> remote machines, but you can probably use SSH to get the same effect
>> from a script file.
>>
>> Let me know if you have other questions about our setup,
>>
>> Matt
>>
>>
>> On Tue, May 8, 2012 at 3:52 AM, Francesco Mazzoli
>> <francesco at rabbitmq.com> wrote:
>>> Hi Matt,
>>>
>>> Predictably I can't reproduce this. Since you say that it'll happen
>>> "inevitably" (while if I understand correctly in your previous
>>> messages it
>>> was tricky to reproduce), can you send us more information about your
>>> setup
>>> and the steps on how to trigger the problem?
>>>
>>> Francesco.
>>>
>>>
>>> On 04/05/12 23:55, Matt Pietrek wrote:
>>>>
>>>> I've written this alias before about this topic, and the problem
>>>> remains in 2.8.2. See:
>>>>
>>>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/018414.html
>>>>
>>>>
>>>> I have a three node cluster running RabbitMQ 2.82/Erlang R13B03 on
>>>> Ubuntu
>>>> 10.04.
>>>>
>>>> Once the cluster is up and running properly (as observed by the Web
>>>> UI), I then start/stop individual nodes in the cluster:
>>>> rabbitmqctl stop
>>>> rabbitmq-server
>>>>
>>>> Inevitably one of the nodes won't come back up, waiting forever on
>>>> "starting" the database (no 30 second timeout... Forever.)
>>>>
>>>> The only way to get all three nodes functioning again together is to
>>>> forcibly stop the other two nodes, then restart them all again.
>>>>
>>>>
>>>> The first item below is the console output as captured via nohup,
>>>> showing "starting database" as the last item.
>>>> The second item below is the last few lines of the rabbit@<node>.log
>>>> file, showing the node shutting down, then beginning to start up
>>>> again.
>>>>
>>>> Is it likely that a newer Erlang version would help out?
>>>> What else can I provide to help diagnose this?
>>>>
>>>> Thanks,
>>>>
>>>> Matt
>>>>
>>>> --------
>>>> node : rabbit at util
>>>> app descriptor :
>>>> /usr/lib/rabbitmq/lib/rabbitmq_server-2.8.2/sbin/../ebin/rabbit.app
>>>> home dir : /home/mpietrek
>>>> config file(s) : /home/mpietrek/work/var/run/rabbitmq.config
>>>> cookie hash : pR5H9kY3Wra/XdLELT5hgQ==
>>>> log :
>>>>
>>>> /home/mpietrek/work/logs/util.mpietrek.internal.illumita.com/rabbit at util.log
>>>>
>>>> sasl log :
>>>>
>>>> /home/mpietrek/work/logs/util.mpietrek.internal.illumita.com/rabbit at util-sasl.log
>>>>
>>>> database dir : /home/mpietrek/work/var/lib/rabbit at util
>>>> erlang version : 5.7.4
>>>>
>>>> -- rabbit boot start
>>>> starting file handle cache server
>>>> ...done
>>>> starting worker pool
>>>> ...done
>>>> starting database ...
>>>>
>>>> --------
>>>>
>>>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>>>> application: rabbitmq_management_agent
>>>> exited: stopped
>>>> type: permanent
>>>>
>>>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>>>> stopped TCP Listener on 0.0.0.0:5672
>>>>
>>>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>>>> application: rabbit
>>>> exited: stopped
>>>> type: permanent
>>>>
>>>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>>>> application: os_mon
>>>> exited: stopped
>>>> type: permanent
>>>>
>>>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>>>> application: mnesia
>>>> exited: stopped
>>>> type: permanent
>>>>
>>>> =INFO REPORT==== 4-May-2012::15:02:14 ===
>>>> Halting Erlang VM
>>>>
>>>> =INFO REPORT==== 4-May-2012::15:02:52 ===
>>>> Limiting to approx 924 file handles (829 sockets)
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>


From steve at rabbitmq.com  Wed May  9 16:06:58 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 9 May 2012 16:06:58 +0100
Subject: [rabbitmq-discuss] Stomp Javascript Client
In-Reply-To: <1336512880.71218.YahooMailNeo@web44914.mail.sp1.yahoo.com>
References: <1336512880.71218.YahooMailNeo@web44914.mail.sp1.yahoo.com>
Message-ID: <94C352C7-F30F-4288-997C-C4B70FEE97A3@rabbitmq.com>

Hi Uday,

The STOMP plugin enables any STOMP client to communicate with a RabbitMQ
broker using the simple STOMP protocol.

'Connect to Rabbit with a * client' normally means using AMQP, and
doesn't need to involve STOMP.

If the browser can be made to send STOMP frames and receive STOMP frames
then it can talk to RabbitMQ+STOMP broker but may not need any
Rabbit-specific code in the browser at all.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 8 May 2012, at 22:34, Uday Subbarayan wrote:

> Hi Guys,
>    I looked at the Rabbit MQ Stomp adapter:
> http://www.rabbitmq.com/stomp.html 
> 
> We should be able to push messages directly from RabbitMQ/Stomp to browser if we have a Javascript client which can connect to Rabbit. Am I correct? We don't need Node.js as a broker in the middle, right?
> 
> Thanks,
> -Uday.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From majek04 at gmail.com  Wed May  9 17:35:52 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 9 May 2012 17:35:52 +0100
Subject: [rabbitmq-discuss] Stomp Javascript Client
In-Reply-To: <1336512880.71218.YahooMailNeo@web44914.mail.sp1.yahoo.com>
References: <1336512880.71218.YahooMailNeo@web44914.mail.sp1.yahoo.com>
Message-ID: <CABzX+qxLCtZCN9cKyWyzzGz0++r6vbSFEEGe5BeJ9svz5KCHMA@mail.gmail.com>

On Tue, May 8, 2012 at 10:34 PM, Uday Subbarayan
<uday.subbarayan at yahoo.com> wrote:
> ? ?I looked at the Rabbit MQ Stomp adapter:
> http://www.rabbitmq.com/stomp.html
>
> We should be able to push messages directly from RabbitMQ/Stomp to browser
> if we have a Javascript client which can connect to Rabbit. Am I correct? We
> don't need Node.js as a broker in the middle, right?

Uday,

I'm not sure how familiar you are with our build process, but we have a
RabbitMQ-Web-Stomp plugin in the works, which does exactly what
you want - exposes STOMP by using SockJS (ie: websockets).

Take a look at the code:
  https://github.com/rabbitmq/rabbitmq-web-stomp
  https://github.com/rabbitmq/rabbitmq-web-stomp-examples

Alternatively, wait until we'll formally release it :)

Cheers,
    Marek

From nithyanirmal at gmail.com  Wed May  9 23:05:46 2012
From: nithyanirmal at gmail.com (Nithya Vijayakumar)
Date: Wed, 9 May 2012 15:05:46 -0700
Subject: [rabbitmq-discuss] service rabbitmq-server start stuck due to
 inet_gethost 4
In-Reply-To: <CAMcAHLU4+5wxFbXmOBQfJrCrYe7zdLUa9uUi-PJAjJhjXH26hA@mail.gmail.com>
References: <CAJinw2pgz6wC4xWCCX0+NUd29za8fsjU5QJjbWm+Pcf5q6xKEQ@mail.gmail.com>
	<4FAA4513.6060007@rabbitmq.com>
	<CAMcAHLU4+5wxFbXmOBQfJrCrYe7zdLUa9uUi-PJAjJhjXH26hA@mail.gmail.com>
Message-ID: <CAJinw2qD01=rU2sBewL95mT2UQiWdPEDc8Q6RF7_JS+9wOxPyw@mail.gmail.com>

Thank Alvaro for the tip, will try it out.

Simon, I don't seem to have the startup_log from when it happened. After I
did kill -i on the inet_gethost 4 processes and restarted rabbitmq, it came
up fine. The log got overwritten though. Since it is not always
reproducible and happens every now and then, I can't recreate now. Will
send the log if I see it again.

Any other suggestions beyond what Alvaro has suggested?

Thanks,
Nithya

On Wed, May 9, 2012 at 4:06 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:

> I had a similar problem perhaps? at least related until I added this line
> to my /etc/hosts on My mac:
>
> 127.0.0.1 alvaro.local
>
> of course adapt it to your environment and see if it helps.
>
>
> On Wed, May 9, 2012 at 12:21 PM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> inet_gethost is a process that is started by the Erlang VM - it should
>> always be there; it's not part of startup.
>>
>> It would be useful to know where rabbit is getting stuck on startup -
>> what ends up in the logs?
>>
>> Cheers, Simon
>>
>>
>> On 08/05/12 19:04, Nithya Vijayakumar wrote:
>>
>>>
>>>        We are using rabbitmq server 2.7.1 in two node auto clustering
>>> mode.
>>>
>>>            Once in a while we are getting complaint that rabbitmq did
>>>        not complete the installation. What is happening underneath is
>>>        "service rabbitmq-server start" is getting stuck,  and
>>>        subsequent installation steps also gets stuck going into loop
>>>        and many many runs trying to complete. I think "inet_gethost 4"
>>>        might be the culprit. Any suggestions on how to fix this?
>>>
>>>           ps awfux | more
>>>
>>>           root     19848  0.0  0.0 106412  1612 pts/0    S+   17:03
>>>           0:00  |       \_ /bin/sh /sbin/service puppet debug
>>>           root     19853  0.0  0.0 106624  1632 pts/0    S+   17:03
>>>           0:00  |           \_ /bin/bash /etc/init.d/puppet debug
>>>           root     19858  1.2  3.1 166288 64416 pts/0    S+   17:03
>>>           0:03  |               \_ /usr/bin/ruby /usr/sbin/puppetd
>>>        --server=director.ecp-deploy.**com<http://director.ecp-deploy.com>
>>>        <http://director.ecp-deploy.**com<http://director.ecp-deploy.com>>
>>> --fqdn amq.ecp-deploy.com
>>>        <http://amq.ecp-deploy.com> -o --no-daemonize -v
>>>
>>>           root     20390  0.0  0.0   9760  1516 ?        Ss   17:03
>>>           0:00  |                   \_ /bin/sh /sbin/service
>>>        rabbitmq-server start
>>>           root     20395  0.0  0.0   9500  1276 ?        S    17:03
>>>           0:00  |                       \_ /bin/sh
>>>        /etc/init.d/rabbitmq-server start
>>>           root     20422  0.0  0.0   9496  1196 ?        Ss   17:03
>>>           0:00  |                           \_ /bin/sh
>>>        /usr/sbin/rabbitmq-server
>>>           root     20433  0.0  0.0  42512  1384 ?        S    17:03
>>>           0:00  |                           |   \_ su rabbitmq -s
>>>        /bin/sh -c /usr/lib/rabbitmq/bin/**rabbitmq-server
>>>           rabbitmq 20436  0.2  1.6 585140 33536 ?        Ssl  17:03
>>>           0:00  |                           |       \_
>>>        /usr/lib64/erlang/erts-5.8.5/**bin/beam -W w -K true -A30 -P
>>>        1048576 -- -root /usr/lib64/erlang -progname erl -- -home /var/li
>>>           b/rabbitmq -- -noshell -noinput -name
>>>        _rabbit at amq.ecp-deploy.com_ -boot
>>>        _/opt/cisco/rabbitmq/data/**rabbit at amq.ecp-deploy.com-**
>>> plugins-expand/rabbit_
>>>
>>>        -config /etc/rabbitmq/rabbitmq -kernel inet_dist_listen_min
>>>        45001 -kernel inet_dist_li
>>>           sten_max 45002 -kernel inet_default_connect_options
>>>        [{nodelay,true}] -sasl errlog_type error -sasl sasl_error_logger
>>>        false -rabbit error_logger
>>>        {file,"_/opt/cisco/rabbitmq/**log/rabbit at amq.ecp-deploy.com.**
>>> log_"
>>>        <_mailto:/opt/cisco/rabbitmq/**log/rabbit at amq.ecp-deploy.com.**
>>> log_>
>>>        } -rabbit sasl_error_log
>>>           ger
>>>        {file,"_/opt/cisco/rabbitmq/**log/rabbit at amq.ecp-deploy.com-**
>>> sasl.log_"
>>>        <_mailto:/opt/cisco/rabbitmq/**log/rabbit at amq.ecp-deploy.com-**
>>> sasl.log_>
>>>
>>>        } -os_mon start_cpu_sup true -os_mon start_disksup false -os_mon
>>>        start_memsup false -mnesia dir
>>>        "_/opt/cisco/rabbitmq/data/**rabbit at amq.ecp-deploy.com_"
>>>        <_mailto:/opt/cisco/rabbitmq/**data/rabbit at amq.ecp-deploy.**com_>
>>>
>>>           rabbitmq 20513  0.0  0.0  10844   496 ?        Ss   17:03
>>>           0:00  |                           |           \_ inet_gethost 4
>>>           rabbitmq 20514  0.0  0.0  11056   412 ?        S    17:03
>>>           0:00  |                           |               \_
>>>        inet_gethost 4
>>>           root     20423  0.0  0.0   9496  1216 ?        S    17:03
>>>           0:00  |                           \_ /bin/sh
>>>        /usr/sbin/rabbitmqctl wait /var/run/rabbitmq/pid
>>>           root     20439  0.0  0.0  42512  1384 ?        S    17:03
>>>           0:00  |                               \_ su rabbitmq -s
>>>        /bin/sh -c /usr/lib/rabbitmq/bin/**rabbitmqctl "wait"
>>>        "/var/run/rabbitmq/pid"
>>>           rabbitmq 20442  0.0  0.4  32312 10260 ?        Ss   17:03
>>>           0:00  |                                   \_
>>>        /usr/lib64/erlang/erts-5.8.5/**bin/beam -- -root
>>> /usr/lib64/erlang
>>>        -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/ra
>>>           bbitmq/lib/rabbitmq_server-2.**7.1/sbin/../ebin -noshell
>>>        -noinput -hidden -name rabbitmqctl20442 -s rabbit_control
>>>        -nodename _rabbit at amq.ecp-deploy.com_ -extra wait
>>>
>>>        /var/run/rabbitmq/pid
>>>           rabbitmq 20468  0.0  0.0  10844   492 ?        Ss   17:03
>>>           0:00  |                                       \_ inet_gethost 4
>>>           rabbitmq 20469  0.0  0.0  11056   360 ?        S    17:03
>>>           0:00  |                                           \_
>>>        inet_gethost 4
>>>
>>>        Thanks,
>>>        Nithya
>>>
>>>
>>>
>>> ______________________________**_________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>>
>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120509/b40dc7dc/attachment.htm>

From pablomolnar at gmail.com  Wed May  9 23:30:55 2012
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Wed, 9 May 2012 19:30:55 -0300
Subject: [rabbitmq-discuss] Queues with high memory consumption
In-Reply-To: <4FA9020F.5040102@rabbitmq.com>
References: <CANVSfp+9KMvWHp5FL+jsH1fFh6zAJG3F5Vi0Z=RGi=5qN_ea2w@mail.gmail.com>
	<CANVSfp+7HTWCoezKabcZSZ3qvggKODUVpz7=FrEZymsBW+KPqQ@mail.gmail.com>
	<4FA9020F.5040102@rabbitmq.com>
Message-ID: <CANVSfpJhyUTFQOR=s85SOSnCCBHPxxMyc+9M+j-S3Ws3AeacFw@mail.gmail.com>

Actually is causing me headaches because the memory of the node keeps
rising to beyond the watermark level and that freezes all my rabbitmq
cluster. For instance right node I have a node with 4.3GB used with a
watermark of 4.7GB and all ndoe queues are updated (empties). I've pated
the node status and queue details below.

Any idea how to solve this?

curl .../api/nodes/rabbit at i-000000ed-wsm
{
   "name":"rabbit at i-000000ed-wsm",
   "type":"ram",
   "running":true,
   "os_pid":"6451",
   "mem_ets":54743192,
   "mem_binary":206280808,
   "mem_proc":4284714760,
   "mem_proc_used":4284698594,
   "mem_atom":2107665,
   "mem_atom_used":2076476,
   "mem_code":15225838,
   "fd_used":42,
   "fd_total":131072,
   "sockets_used":14,
   "sockets_total":117872,
   "mem_used":4645571200,
   "mem_limit":5017685196,
   "mem_alarm":false,
   "proc_used":618,
   "proc_total":32768,
   "statistics_level":"fine",
   "erlang_version":"R15B",
   "uptime":2203242331,
   "run_queue":5,
   "processors":4,
   "exchange_types":[
      {
         "name":"topic",
         "description":"AMQP topic exchange, as per the AMQP specification",
         "enabled":true
      },
      {
         "name":"fanout",
         "description":"AMQP fanout exchange, as per the AMQP
specification",
         "enabled":true
      },
      {
         "name":"direct",
         "description":"AMQP direct exchange, as per the AMQP
specification",
         "enabled":true
      },
      {
         "name":"headers",
         "description":"AMQP headers exchange, as per the AMQP
specification",
         "enabled":true
      }
   ],
   "auth_mechanisms":[
      {
         "name":"PLAIN",
         "description":"SASL PLAIN authentication mechanism",
         "enabled":true
      },
      {
         "name":"AMQPLAIN",
         "description":"QPid AMQPLAIN mechanism",
         "enabled":true
      },
      {
         "name":"RABBIT-CR-DEMO",
         "description":"RabbitMQ Demo challenge-response authentication
mechanism",
         "enabled":false
      }
   ],
   "applications":[
      {
         "name":"amqp_client",
         "description":"RabbitMQ AMQP Client",
         "version":"2.7.1"
      },
      {
         "name":"inets",
         "description":"INETS  CXC 138 49",
         "version":"5.8"
      },
      {
         "name":"kernel",
         "description":"ERTS  CXC 138 10",
         "version":"2.15"
      },
      {
         "name":"mnesia",
         "description":"MNESIA  CXC 138 12",
         "version":"4.6"
      },
      {
         "name":"mochiweb",
         "description":"MochiMedia Web Server",
         "version":"1.3-rmq2.7.1-git"
      },
      {
         "name":"os_mon",
         "description":"CPO  CXC 138 46",
         "version":"2.2.8"
      },
      {
         "name":"rabbit",
         "description":"RabbitMQ",
         "version":"2.7.1"
      },
      {
         "name":"rabbitmq_management",
         "description":"RabbitMQ Management Console",
         "version":"2.7.1"
      },
      {
         "name":"rabbitmq_management_agent",
         "description":"RabbitMQ Management Agent",
         "version":"2.7.1"
      },
      {
         "name":"rabbitmq_management_visualiser",
         "description":"RabbitMQ Visualiser",
         "version":"2.7.1"
      },
      {
         "name":"rabbitmq_mochiweb",
         "description":"RabbitMQ Mochiweb Embedding",
         "version":"2.7.1"
      },
      {
         "name":"sasl",
         "description":"SASL  CXC 138 11",
         "version":"2.2"
      },
      {
         "name":"stdlib",
         "description":"ERTS  CXC 138 10",
         "version":"1.18"
      },
      {
         "name":"webmachine",
         "description":"webmachine",
         "version":"1.7.0-rmq2.7.1-hg"
      }
   ]
}



rabbitmqctl status
Status of node 'rabbit at i-00000140-csm' ...
[{pid,739},
 {running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","2.7.1"},
      {rabbitmq_management,"RabbitMQ Management Console","2.7.1"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
      {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
      {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {os_mon,"CPO  CXC 138 46","2.2.8"},
      {sasl,"SASL  CXC 138 11","2.2"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
      {inets,"INETS  CXC 138 49","5.8"},
      {mnesia,"MNESIA  CXC 138 12","4.6"},
      {stdlib,"ERTS  CXC 138 10","1.18"},
      {kernel,"ERTS  CXC 138 10","2.15"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R15B (erts-5.9) [source] [64-bit] [smp:4:4] [async-threads:0]
[hipe] [kernel-poll:false]\n"},
 {memory,
     [{total,4404012432},
      {processes,4148260149},
      {processes_used,4148259728},
      {system,255752283},
      {atom,561761},
      {atom_used,550271},
      {binary,81414464},
      {code,15193946},
      {ets,86119376}]},
 {vm_memory_high_watermark,0.799999999904651},
 {vm_memory_limit,6712184012}]
...done.



Here I'm attaches the queue details. The first two queues consumes 3.5GB
https://gist.github.com/2649372



On Tue, May 8, 2012 at 8:22 AM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> Pablo,
>
>
> On 07/05/12 19:28, Pablo Molnar wrote:
>
>> I'm trying to figure out why the memory consumption of some queues
>> are  extremely high although there is almost none messages ready to
>> consume.
>> For instance this queue has only 3 messages but consumes 2.4GB of
>> RAM.
>>
>
> That is not necessarily a problem, in particular ...
>
>  {
>>   "exclusive_consumer_tag":"",
>>   "messages_ready":0,
>>   "messages_unacknowledged":3,
>>   "messages":3,
>>   "consumers":25,
>>   "memory":2586777216,
>>   "slave_nodes":[
>>
>>   ],
>>   "backing_queue_status":{
>>      "q1":0,
>>      "q2":0,
>>      "delta":[
>>         "delta",
>>         "undefined",
>>         0,
>>         "undefined"
>>      ],
>>      "q3":0,
>>      "q4":0,
>>      "len":0,
>>      "pending_acks":3,
>>      "target_ram_count":0,
>>      "ram_msg_count":0,
>>      "ram_ack_count":0,
>>      "next_seq_id":72528926,
>>      "persistent_count":3,
>>      "avg_ingress_rate":42.**456013780009044,
>>      "avg_egress_rate":42.**456013780009044,
>>      "avg_ack_ingress_rate":42.**456013780009044,
>>      "avg_ack_egress_rate":42.**456013780009044
>>   },  ...
>>
>
> ...this is a slow-moving, but not idle queue. I suspect what happened is
> that at some point the queue did have lots of messages in it, hence
> requiring lots of memory. Those messages subsequently got drained, but the
> since the queue is slow moving it can take a while for Erlang's gc to
> reclaim memory.
>
> Unless this is causing any other problems I wouldn't worry about it.
>
>
>  rabbitmqctl status
>> Status of node 'rabbit at i-00000140-csm' ...
>> [{pid,20106},
>>  {running_applications,
>>     [{rabbitmq_management_**visualiser,"RabbitMQ Visualiser","2.7.1"},
>>      {rabbitmq_management,"RabbitMQ Management Console","2.7.1"},
>>      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
>>      {webmachine,"webmachine","1.7.**0-rmq2.7.1-hg"},
>>      {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
>>      {rabbitmq_management_agent,"**RabbitMQ Management Agent","2.7.1"},
>>      {rabbit,"RabbitMQ","2.7.1"},
>>      {os_mon,"CPO  CXC 138 46","2.2.8"},
>>      {sasl,"SASL  CXC 138 11","2.2"},
>>      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
>>      {inets,"INETS  CXC 138 49","5.8"},
>>      {mnesia,"MNESIA  CXC 138 12","4.6"},
>>      {stdlib,"ERTS  CXC 138 10","1.18"},
>>      {kernel,"ERTS  CXC 138 10","2.15"}]},
>>  {os,{unix,linux}},
>>  {erlang_version,
>>     "Erlang R15B (erts-5.9) [source] [64-bit] [smp:4:4] [async-threads:0]
>> [hipe] [kernel-poll:false]\n"},
>>  {memory,
>>     [{total,4736488576},
>>      {processes,3832122172},
>>      {processes_used,3832066481},
>>      {system,904366404},
>>      {atom,561761},
>>      {atom_used,551430},
>>      {binary,98523592},
>>      {code,15193946},
>>      {ets,717445688}]},
>>  {vm_memory_high_watermark,0.**6999999999761628},
>>  {vm_memory_limit,5873161011}]
>> ...done.
>>
>
> You may want to upgrade to the latest Erlang (R15B01) and rabbit (2.8.2),
> though I doubt that will make a difference.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120509/de8c9417/attachment.htm>

From josh at gebaschtel.ch  Thu May 10 01:10:32 2012
From: josh at gebaschtel.ch (Josh Geisser)
Date: Thu, 10 May 2012 00:10:32 +0000
Subject: [rabbitmq-discuss] basicpublish Android to Java?
Message-ID: <B8B68C3D41791846910BA4C7AF61D25B05D265@ganymede.gebaschtel.bnet>

Hi Muhammad

I think I had the same issue (based on the same tutorial), publishing first message resulted in nothing, and then publishing a 2nd time threw a
a com.rabbitmq.client.AlreadyClosedException: clean connection shutdown; reason: Attempt to use closed channel

As my environment was quite old I thought of starting all over again with a fresh installation of everything. And somehow it's working now :)
mChannel.basicPublish() can just be invoked from the Main-thread as simple as it should be.

I also hit a exeption that I'm not allowed to open network connection (open TCP session?) from main activity, which I could overwrite with

/* overwrite the android.os.NetworkOnMainThreadException */
        StrictMode.ThreadPolicy policy = new StrictMode.ThreadPolicy.Builder().permitAll().build();
        StrictMode.setThreadPolicy(policy);
/* not sure this is a good thing, but seems to work */

Just in case you're still into this.

Cheers
Josh

Tutorial http://simonwdixon.wordpress.com/2011/06/03/getting-started-with-rabbitmq-on-android-part-1/
currently using rabbit 2.8.2 java lib with SDK19/ADT18.0.0/IndigoSR2 in an Android 4.0.3 project, not tested on physical device yet :'(

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Kamran
Sent: Montag, 20. Februar 2012 15:08
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] basicpublish Android to Java?

Thanks,
           the consumer of android works fine
        	   mQueue = mModel.queueDeclare().getQueue();
        	   MySubscription = new QueueingConsumer(mModel);
        	   mModel.basicConsume(mQueue, false, MySubscription);"

and the list_consumers shows the declared queues.

The problem lies in the publisher/sender in Android, maybe I should re- install the environment.


On Feb 20, 2:49?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> On 20/02/12 13:30, Kamran wrote:
>
> > ? ? private final static String QUEUE_NAME = "hello"; 
> > MessageConsumer("192.168.2.3","logs","fanout");
>
> How does your consumer know which queue to listen on?
>
> You can confirm whether your message consumer is correctly registered 
> by running "rabbitmqctl list_consumers" or "rabbitmqctl list_queue 
> consumers". If your consumer is listed in the results then it should 
> receive messages. If it is not listed then the registration is faulty.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/
> mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

--
----
ASG at hnet

-- 
----
ASG at hnet

From uday.subbarayan at yahoo.com  Thu May 10 02:13:32 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Wed, 9 May 2012 18:13:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Stomp Javascript Client
In-Reply-To: <94C352C7-F30F-4288-997C-C4B70FEE97A3@rabbitmq.com>
References: <1336512880.71218.YahooMailNeo@web44914.mail.sp1.yahoo.com>
	<94C352C7-F30F-4288-997C-C4B70FEE97A3@rabbitmq.com>
Message-ID: <1336612412.17781.YahooMailNeo@web44901.mail.sp1.yahoo.com>

Hi Steve,
? ? Thanks. Which one you will recommend?

a) Browser/Javascript ----stomp---> Stomp enabled Rabbit MQ

OR

b) Browser/Javascript ----AMQP----> RabbitMQ

Thanks,
-Uday.


________________________________
 From: Steve Powell <steve at rabbitmq.com>
To: Uday Subbarayan <uday.subbarayan at yahoo.com> 
Cc: RabbitMQ Discuss <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Wednesday, May 9, 2012 8:06 AM
Subject: Re: [rabbitmq-discuss] Stomp Javascript Client
 
Hi Uday,

The STOMP plugin enables any STOMP client to communicate with a RabbitMQ
broker using the simple STOMP protocol.

'Connect to Rabbit with a * client' normally means using AMQP, and
doesn't need to involve STOMP.

If the browser can be made to send STOMP frames and receive STOMP frames
then it can talk to RabbitMQ+STOMP broker but may not need any
Rabbit-specific code in the browser at all.

Steve Powell? (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 8 May 2012, at 22:34, Uday Subbarayan wrote:

> Hi Guys,
>? ? I looked at the Rabbit MQ Stomp adapter:
> http://www.rabbitmq.com/stomp.html 
> 
> We should be able to push messages directly from RabbitMQ/Stomp to browser if we have a Javascript client which can connect to Rabbit. Am I correct? We don't need Node.js as a broker in the middle, right?
> 
> Thanks,
> -Uday.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120509/86b2dea0/attachment.htm>

From uday.subbarayan at yahoo.com  Thu May 10 02:23:33 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Wed, 9 May 2012 18:23:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Stomp Javascript Client
In-Reply-To: <CABzX+qxLCtZCN9cKyWyzzGz0++r6vbSFEEGe5BeJ9svz5KCHMA@mail.gmail.com>
References: <1336512880.71218.YahooMailNeo@web44914.mail.sp1.yahoo.com>
	<CABzX+qxLCtZCN9cKyWyzzGz0++r6vbSFEEGe5BeJ9svz5KCHMA@mail.gmail.com>
Message-ID: <1336613013.93726.YahooMailNeo@web44914.mail.sp1.yahoo.com>

Marek,
? ? ? ? ?Just to be clear...what is the configuration here?

a)?Browser/Javascript----web socket-----> Node.js+RabbitMQ integrated

OR

b)?Browser/Javascript----web socket-----> RabbitMQ+ Native WebSocket support

OR

c)Browser/Javascript----web socket-----> Node.js --->RabbitMQ (here we need to take care of installing Node)

Thanks,
-Uday.

________________________________
 From: Marek Majkowski <majek04 at gmail.com>
To: Uday Subbarayan <uday.subbarayan at yahoo.com> 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Wednesday, May 9, 2012 9:35 AM
Subject: Re: [rabbitmq-discuss] Stomp Javascript Client
 
On Tue, May 8, 2012 at 10:34 PM, Uday Subbarayan
<uday.subbarayan at yahoo.com> wrote:
> ? ?I looked at the Rabbit MQ Stomp adapter:
> http://www.rabbitmq.com/stomp.html
>
> We should be able to push messages directly from RabbitMQ/Stomp to browser
> if we have a Javascript client which can connect to Rabbit. Am I correct? We
> don't need Node.js as a broker in the middle, right?

Uday,

I'm not sure how familiar you are with our build process, but we have a
RabbitMQ-Web-Stomp plugin in the works, which does exactly what
you want - exposes STOMP by using SockJS (ie: websockets).

Take a look at the code:
? https://github.com/rabbitmq/rabbitmq-web-stomp
? https://github.com/rabbitmq/rabbitmq-web-stomp-examples

Alternatively, wait until we'll formally release it :)

Cheers,
? ? Marek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120509/1c8c9eb3/attachment.htm>

From monish.unni at gmail.com  Thu May 10 05:09:56 2012
From: monish.unni at gmail.com (cogitate)
Date: Wed, 9 May 2012 21:09:56 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq memory leak in 2.7.0/2.8.1
Message-ID: <19ca86b0-2ee3-4baa-9035-18f2ab602fae@g6g2000pbq.googlegroups.com>

We are in the advanced stage of performance testing of a demanding
application.  This application consists of a large number (2357)
processes that connect to a local RabbitMQ server.

RabbitMQ version: 2.7.0-1
Erlang version: Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:
24:24] [rq:24] [async-threads:0] [hipe] [kernel-poll:false]
Linux kernel: Linux plt68w98m7 2.6.18-212.el5 #1 SMP Wed Aug 11
23:22:39 EDT 2010 x86_64 x86_64 x86_64 GNU/Linux
Red Hat Enterprise Linux Server release 5.5 (Tikanga)
Hardware: Dell R610 with 24GB memory and 24 CPUs.
RabbitMQ server configuration:  default configuration from the rpm
package, no customization.

2357 application processes are using 40 distinct durable queues, with
each process listening to a unique queue. Below is the distribution of
number of processes listening for each queue:
numprocs=1
numprocs=1
numprocs=1
numprocs=1
numprocs=300
numprocs=300
numprocs=10
numprocs=40
numprocs=10
numprocs=300
numprocs=3
numprocs=10
numprocs=10
numprocs=300
numprocs=10
numprocs=20
numprocs=60
numprocs=60
numprocs=4
numprocs=5
numprocs=300
numprocs=30
numprocs=10
numprocs=1
numprocs=60
numprocs=160
numprocs=15
numprocs=80
numprocs=10
numprocs=10
numprocs=160
numprocs=5
numprocs=10
numprocs=10
numprocs=10
numprocs=5
numprocs=5
numprocs=15
numprocs=10
numprocs=5

If an application process needs to send messages to another
application, the sender process creates a unique "auto-delete
exclusive" reply queue. The queue is kept until the process is
shutdown.

When the application processes are processing large number of
messages, you would see RabbitMQ "beam.smp" consume increasingly more
memory.
When all application processes are terminated and no messages remain
in any queues (viewed via RabbitMQ management http interface), the
memory consumption of beam.smp would not go down.

When the application processes are started and another performance run
is performed, the memory usage of beam.smp keeps going higher.

further we ran the same tests with:
erlang-R15B01-0.x86_64.rpm
rabbitmq-server-2.8.1-0.i386.rpm

I have a tester that allows one service call to fan out 120 service
calls.
When I ran the tester with a loop count of 10,000, it would generate
about 1.2M calls. After the test is finished, you end up with 475MB
virtual memory and 335MB resident memory. In the middle of the
testing, I have seen memory usage up to 700M virtual memory and 400MB
resident memory.

If you restart the test, the memory would keep going up. Imaging that
we want to keep our servers up for a release cycle, we would run  out
of memory.

Any pointers/suggestions will be very helpful.
regards,
-monish

From matthias at rabbitmq.com  Thu May 10 07:02:23 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 10 May 2012 07:02:23 +0100
Subject: [rabbitmq-discuss] Queues with high memory consumption
In-Reply-To: <CANVSfpJhyUTFQOR=s85SOSnCCBHPxxMyc+9M+j-S3Ws3AeacFw@mail.gmail.com>
References: <CANVSfp+9KMvWHp5FL+jsH1fFh6zAJG3F5Vi0Z=RGi=5qN_ea2w@mail.gmail.com>	<CANVSfp+7HTWCoezKabcZSZ3qvggKODUVpz7=FrEZymsBW+KPqQ@mail.gmail.com>	<4FA9020F.5040102@rabbitmq.com>
	<CANVSfpJhyUTFQOR=s85SOSnCCBHPxxMyc+9M+j-S3Ws3AeacFw@mail.gmail.com>
Message-ID: <4FAB59EF.9020300@rabbitmq.com>

Pablo,

On 09/05/12 23:30, Pablo Molnar wrote:
> Actually is causing me headaches because the memory of the node keeps
> rising to beyond the watermark level and that freezes all my rabbitmq
> cluster. For instance right node I have a node with 4.3GB used with a
> watermark of 4.7GB and all ndoe queues are updated (empties).

As I said in my earlier reply, please upgrade Erlang to R15B01 and 
RabbitMQ to 2.8.2. That may not solve the problem but will give us a 
better base line to investigate further.

Matthias.

From matthias at rabbitmq.com  Thu May 10 07:17:40 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 10 May 2012 07:17:40 +0100
Subject: [rabbitmq-discuss] rabbitmq memory leak in 2.7.0/2.8.1
In-Reply-To: <19ca86b0-2ee3-4baa-9035-18f2ab602fae@g6g2000pbq.googlegroups.com>
References: <19ca86b0-2ee3-4baa-9035-18f2ab602fae@g6g2000pbq.googlegroups.com>
Message-ID: <4FAB5D84.6050506@rabbitmq.com>

Monish,

On 10/05/12 05:09, cogitate wrote:
> We are in the advanced stage of performance testing of a demanding
> application.  This application consists of a large number (2357)
> processes that connect to a local RabbitMQ server.
>
> RabbitMQ version: 2.7.0-1
> Erlang version: Erlang R14B02 (erts-5.8.3) [source] [64-bit] [smp:
> 24:24] [rq:24] [async-threads:0] [hipe] [kernel-poll:false]
> Linux kernel: Linux plt68w98m7 2.6.18-212.el5 #1 SMP Wed Aug 11
> 23:22:39 EDT 2010 x86_64 x86_64 x86_64 GNU/Linux
> Red Hat Enterprise Linux Server release 5.5 (Tikanga)
> Hardware: Dell R610 with 24GB memory and 24 CPUs.
> RabbitMQ server configuration:  default configuration from the rpm
> package, no customization.
> [...]
> further we ran the same tests with:
> erlang-R15B01-0.x86_64.rpm
> rabbitmq-server-2.8.1-0.i386.rpm

The latter is a much better base to investigate this further, though you 
should upgrade rabbit to 2.8.2. Please run all further tests on that.

> I have a tester that allows one service call to fan out 120 service
> calls.
> When I ran the tester with a loop count of 10,000, it would generate
> about 1.2M calls. After the test is finished, you end up with 475MB
> virtual memory and 335MB resident memory. In the middle of the
> testing, I have seen memory usage up to 700M virtual memory and 400MB
> resident memory.
>
> If you restart the test, the memory would keep going up. Imaging that
> we want to keep our servers up for a release cycle, we would run  out
> of memory.

The memory use may stabilise at some point. I would recommend running 
your tests for a longer duration to see whether that happens. If memory 
use does indeed keep creeping up, please send us the output of 
'rabbitmqctl report' at that point.

Regards,

Matthias.

From tonygarnockjones at gmail.com  Thu May 10 13:51:24 2012
From: tonygarnockjones at gmail.com (Tony Garnock-Jones)
Date: Thu, 10 May 2012 08:51:24 -0400
Subject: [rabbitmq-discuss] Active Queue Management
Message-ID: <CAM8fPiRTxLVZaB6Rx=NWOC4jPbVSqQU3qhsLy4hpOh=2d_6Xcw@mail.gmail.com>

"In short, any queue that could ever be a bottleneck needs management." -
http://gettys.wordpress.com/2012/05/08/fundamental-progress-solving-bufferbloat/

It's interesting to note that the same queue-management issues that appear
on the Internet at large crop up not only within brokers like RabbitMQ
themselves, but also within messaging client libraries. (You are trapped in
a maze of congested queues, all different.) Ad-hoc solutions scale quite a
long way inside a process, and not nearly so far across process boundaries;
I wonder if implementing some "real" AQM within a process, e.g. in client
libraries or within brokers, would help at all? Maybe for clustering and
federation.

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120510/7b1ead7f/attachment.htm>

From matthew at rabbitmq.com  Thu May 10 14:16:03 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 10 May 2012 14:16:03 +0100
Subject: [rabbitmq-discuss] Active Queue Management
In-Reply-To: <CAM8fPiRTxLVZaB6Rx=NWOC4jPbVSqQU3qhsLy4hpOh=2d_6Xcw@mail.gmail.com>
References: <CAM8fPiRTxLVZaB6Rx=NWOC4jPbVSqQU3qhsLy4hpOh=2d_6Xcw@mail.gmail.com>
Message-ID: <20120510131602.GB26212@rabbitmq.com>

On Thu, May 10, 2012 at 08:51:24AM -0400, Tony Garnock-Jones wrote:
> It's interesting to note that the same queue-management issues that appear
> on the Internet at large crop up not only within brokers like RabbitMQ
> themselves, but also within messaging client libraries. (You are trapped in
> a maze of congested queues, all different.) Ad-hoc solutions scale quite a
> long way inside a process, and not nearly so far across process boundaries;
> I wonder if implementing some "real" AQM within a process, e.g. in client
> libraries or within brokers, would help at all? Maybe for clustering and
> federation.

I'm actually in the process of implementing CoDel in the Java client.
What it should allow for (I hope - unless I've misunderstood something)
is to be able to not set a QoS or, set a pretty arbitrary QoS, but then
the algorithm ensures the client-side buffer doesn't just remain full.
The assumption is that the transition from "delivery to the client" to
"processing the message on the client" is the fast->slow bandwidth
transition that AQM is meant to manage.

But I may be wrong on one or more of these assumptions!

Matthew

From majek04 at gmail.com  Thu May 10 14:29:07 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 10 May 2012 14:29:07 +0100
Subject: [rabbitmq-discuss] Stomp Javascript Client
In-Reply-To: <1336613013.93726.YahooMailNeo@web44914.mail.sp1.yahoo.com>
References: <1336512880.71218.YahooMailNeo@web44914.mail.sp1.yahoo.com>
	<CABzX+qxLCtZCN9cKyWyzzGz0++r6vbSFEEGe5BeJ9svz5KCHMA@mail.gmail.com>
	<1336613013.93726.YahooMailNeo@web44914.mail.sp1.yahoo.com>
Message-ID: <CABzX+qx2X46ZKwRW8nXKCV=noaYenn_xv-BzfgHh2BeiKfopcA@mail.gmail.com>

On Thu, May 10, 2012 at 2:23 AM, Uday Subbarayan
<uday.subbarayan at yahoo.com> wrote:
> Marek,
> ? ? ? ? ?Just to be clear...what is the configuration here?
>
> a)?Browser/Javascript----web socket-----> Node.js+RabbitMQ integrated
>
> OR
>
> b)?Browser/Javascript----web socket-----> RabbitMQ+ Native WebSocket support
>
> OR
>
> c)Browser/Javascript----web socket-----> Node.js --->RabbitMQ (here we need
> to take care of installing Node)

RabbitMQ-web-stomp is a rabbitmq plugin. So:

browser --- (websocket/sockjs-porotocol) ---> rabbitmq with web-stomp plugin

internally rabbitmq-web-stomp is:

sockjs --> rabbitmq-stomp --> rabbitmq-server


Cheers,
    Marek

From pgross at gmail.com  Thu May 10 16:40:23 2012
From: pgross at gmail.com (Paul Gross)
Date: Thu, 10 May 2012 10:40:23 -0500
Subject: [rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
Message-ID: <4FABE167.9080900@gmail.com>

We are seeing weird issues with RabbmitMQ and CPU/Memory. Basically, we 
run tests locally and on our build server. In both cases, we create a 
couple of queues, push messages through (not many, maybe a few hundred), 
and consume them. This works fine for a few days.

Then, all of a sudden, RabbitMQ goes nuts. It consumes all available CPU 
and memory until it crashes the server. As far as we can tell, nothing 
is different right before this happens. We have to manually kill 
RabbitMQ, and when it comes back up, the queue has less than 10 
messages. The last time this happened, the only thing in the log was 
"Mnesia is overloaded."

This happens both locally on a MacPro (10.7.3) and on our build server 
(Ubuntu 10.04).

These images are from munin, and give an idea of what's going on:

http://dl.dropbox.com/u/15440955/rabbitmq-cpu.png
http://dl.dropbox.com/u/15440955/rabbitmq-memory.png

We are looking for help on how to debug this problem. We cannot directly 
reproduce the problem, but it happens every couple of days.

Here is our setup on the build server:

    $ sudo rabbitmqctl status
    Status of node 'rabbit at ci-rabbitmq' ...
    [{pid,31302},
      {running_applications,[{rabbit,"RabbitMQ","2.7.1"},
                             {os_mon,"CPO  CXC 138 46","2.2.4"},
                             {sasl,"SASL  CXC 138 11","2.1.8"},
                             {mnesia,"MNESIA  CXC 138 12","4.4.12"},
                             {stdlib,"ERTS  CXC 138 10","1.16.4"},
                             {kernel,"ERTS  CXC 138 10","2.13.4"}]},
      {os,{unix,linux}},
      {erlang_version,"Erlang R13B03 (erts-5.7.4) [source] [64-bit]
    [smp:4:4] [rq:4] [async-threads:30] [h
    ipe] [kernel-poll:true]\n"},
      {memory,[{total,40501088},
               {processes,15379528},
               {processes_used,15355904},
               {system,25121560},
               {atom,1113129},
               {atom_used,1103706},
               {binary,8548768},
               {code,11903849},
               {ets,1436704}]},
      {vm_memory_high_watermark,0.19999999923056544},
      {vm_memory_limit,207944908}]
    ...done.


And here is our setup on the MacPro:

    Status of node rabbit at yoshi ...
    [{pid,70356},
      {running_applications,[{rabbit,"RabbitMQ","2.7.1"},
                             {mnesia,"MNESIA  CXC 138 12","4.6"},
                             {os_mon,"CPO  CXC 138 46","2.2.8"},
                             {sasl,"SASL  CXC 138 11","2.2"},
                             {stdlib,"ERTS  CXC 138 10","1.18"},
                             {kernel,"ERTS  CXC 138 10","2.15"}]},
      {os,{unix,darwin}},
      {erlang_version,"Erlang R15B (erts-5.9) [source] [64-bit]
    [smp:16:16] [async-threads:30] [hipe] [kernel-poll:true]\n"},
      {memory,[{total,39776688},
               {processes,13068508},
               {processes_used,13068480},
               {system,26708180},
               {atom,504409},
               {atom_used,475853},
               {binary,8659336},
               {code,11916223},
               {ets,1464712}]},
      {vm_memory_high_watermark,0.3999999999026046},
      {vm_memory_limit,3285576908}]
    ...done.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120510/08ba4552/attachment.htm>

From matthias at rabbitmq.com  Thu May 10 17:07:21 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 10 May 2012 17:07:21 +0100
Subject: [rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
In-Reply-To: <4FABE167.9080900@gmail.com>
References: <4FABE167.9080900@gmail.com>
Message-ID: <4FABE7B9.5010509@rabbitmq.com>

Paul,

On 10/05/12 16:40, Paul Gross wrote:
> We are seeing weird issues with RabbmitMQ and CPU/Memory. Basically, we
> run tests locally and on our build server. In both cases, we create a
> couple of queues, push messages through (not many, maybe a few hundred),
> and consume them. This works fine for a few days.
>
> Then, all of a sudden, RabbitMQ goes nuts. It consumes all available CPU
> and memory until it crashes the server. As far as we can tell, nothing
> is different right before this happens. We have to manually kill
> RabbitMQ, and when it comes back up, the queue has less than 10
> messages. The last time this happened, the only thing in the log was
> "Mnesia is overloaded."

The "mnesia is overloaded" message could be an indication of a high rate 
of queue/exchange/binding creation/deletion. But I suspect it may also 
be triggered at low creation/deletion rates when rabbit is generally 
busy, so this may be a red herring.

> This happens both locally on a MacPro (10.7.3) and on our build server
> (Ubuntu 10.04).
>
> These images are from munin, and give an idea of what's going on:
>
> http://dl.dropbox.com/u/15440955/rabbitmq-cpu.png
> http://dl.dropbox.com/u/15440955/rabbitmq-memory.png
>
> We are looking for help on how to debug this problem. We cannot directly
> reproduce the problem, but it happens every couple of days.
>
> Here is our setup on the build server:
>     {rabbit,"RabbitMQ","2.7.1"},
>     {erlang_version,"Erlang R13B03 ..."}
>     [...]
> And here is our setup on the MacPro:
>     {rabbit,"RabbitMQ","2.7.1"},
>     {erlang_version,"Erlang R15B ..."}

There have been numerous stability improvements since 2.7.1, so I 
suggest you upgrade to the latest rabbit version (2.8.2). Also, R13B03 
is quite ancient, so you should really upgrade that too - R15B01 is the 
latest.

If you still see the same behaviour then try to set up some alarms that 
catch the problem in the early stages and grab the output of 
'rabbitmqctl report'.


Regards,

Matthias.

From james.poole at rsa.com  Thu May 10 19:53:58 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Thu, 10 May 2012 14:53:58 -0400
Subject: [rabbitmq-discuss] Request Handshake Timeout Increase
In-Reply-To: <4FA960FF.6060106@rabbitmq.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D70807D7907A@MX36A.corp.emc.com>
	<4FA960FF.6060106@rabbitmq.com>
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D70807D79710@MX36A.corp.emc.com>

Yeah, the simple fix would be to just add our root CA to the Windows Trust 
Store as a "trusted CA".  However, this is not what we want to do, since this 
would be a security risk.  We don't want the entire machine to trust our CA, 
but we want only our product (rabbit client) to trust the CA.  (This is going 
to be in customer environments who are sensitive to security... not an 
internal deployment)

When the internet is available on the machine, the .NET client fails to find 
the CA, but then our registered certificate validation callback is run, and we 
can manually inspect the certificate, validate it is "our" certificate, and 
let the SSL handshake proceed.

If the internet is not available, the 15 second delay causes the handshake to 
time out and close the SSL connection before we get a chance to handle the 
certificate validation.

To get around this, we would just need the timeout (pointed out by Emile - 
http://hg.rabbitmq.com/rabbitmq-server/file/e852cd4060d3/src/rabbit_reader.erl#l30) 
to be relaxed to 20 seconds.  This would give the client enough time to wait 
for the Windows 15 second delay, verify the certificate, and allow the SSL 
connection to be established.

-James

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com]
Sent: Tuesday, May 08, 2012 2:08 PM
To: Poole, James
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Request Handshake Timeout Increase

James,

On 08/05/12 15:42, james.poole at rsa.com wrote:
> It turns out that Microsoft has a default policy that tries to connect
> to Windows Update on the internet to validate Certificate Authorities.
> If the client machine is not connected to the internet (our likely
> customer deployment scenario and our development environment), then this
> can cause a 15 second delay when validating certificates. Since the
> RabbitMQ handshake timeout is 10 seconds, then this fails and closes the
> connection. This was only seen from the .NET client, and not the Java
> client.
>
> I verified that disabling the local machine policy (directions here
> http://technet.microsoft.com/en-us/library/cc749331%28v=ws.10%29.aspx)
> allowed the SSL connection to immediately succeed.

 From the description of that policy it sounds like disabling would
cause connections to fail:
<quote>
If the user is presented with a certificate issued by a root
certification authority that is not directly trusted, and the Update
Root Certificates feature is turned off through Group Policy, the user
can be prevented from completing the action that required authentication.
</quote>

Though this may depend on the policy settings of the app. Have you
looked at http://www.rabbitmq.com/ssl.html#trust-dotNET?

Also, the policy appears to only come into play when hitherto unknown
root certificates are encountered. So it should be possible to avoid
that situation by getting a server certificate with a root CA that
Windows trusts by default.


Matthias.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7449 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120510/4458910e/attachment.bin>

From uday.subbarayan at yahoo.com  Thu May 10 20:17:09 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Thu, 10 May 2012 12:17:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Stomp Javascript Client
In-Reply-To: <CABzX+qx2X46ZKwRW8nXKCV=noaYenn_xv-BzfgHh2BeiKfopcA@mail.gmail.com>
References: <1336512880.71218.YahooMailNeo@web44914.mail.sp1.yahoo.com>
	<CABzX+qxLCtZCN9cKyWyzzGz0++r6vbSFEEGe5BeJ9svz5KCHMA@mail.gmail.com>
	<1336613013.93726.YahooMailNeo@web44914.mail.sp1.yahoo.com>
	<CABzX+qx2X46ZKwRW8nXKCV=noaYenn_xv-BzfgHh2BeiKfopcA@mail.gmail.com>
Message-ID: <1336677429.23250.YahooMailNeo@web44902.mail.sp1.yahoo.com>

Thanks. This is very good and helps to expose Rabbit MQ directly over the web to browser. Look fwd to try this feature. You can also use us for beta.

When are you integrating this plug-in and releasing it? We are on RHEL 6.2.

Thanks,
-Uday.


________________________________
 From: Marek Majkowski <majek04 at gmail.com>
To: Uday Subbarayan <uday.subbarayan at yahoo.com> 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Thursday, May 10, 2012 6:29 AM
Subject: Re: [rabbitmq-discuss] Stomp Javascript Client
 
On Thu, May 10, 2012 at 2:23 AM, Uday Subbarayan
<uday.subbarayan at yahoo.com> wrote:
> Marek,
> ? ? ? ? ?Just to be clear...what is the configuration here?
>
> a)?Browser/Javascript----web socket-----> Node.js+RabbitMQ integrated
>
> OR
>
> b)?Browser/Javascript----web socket-----> RabbitMQ+ Native WebSocket support
>
> OR
>
> c)Browser/Javascript----web socket-----> Node.js --->RabbitMQ (here we need
> to take care of installing Node)

RabbitMQ-web-stomp is a rabbitmq plugin. So:

browser --- (websocket/sockjs-porotocol) ---> rabbitmq with web-stomp plugin

internally rabbitmq-web-stomp is:

sockjs --> rabbitmq-stomp --> rabbitmq-server


Cheers,
? ? Marek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120510/af1609a4/attachment.htm>

From tonygarnockjones at gmail.com  Thu May 10 20:51:34 2012
From: tonygarnockjones at gmail.com (Tony Garnock-Jones)
Date: Thu, 10 May 2012 15:51:34 -0400
Subject: [rabbitmq-discuss] qpid-multicastmain
Message-ID: <CAM8fPiRsXWpihM_uJX_KENqfGNBxKZmHgUUrSU-FtyKLCiB4FA@mail.gmail.com>

Hi all,

Today I've ported RabbitMQ's MulticastMain program from the RabbitMQ AMQP
APIs to the internal Qpid client APIs. The result can be found here:
https://github.com/tonyg/qpid-multicastmain

I'm slightly surprised to see that it seems to run a little slower than the
Rabbit native version. Perhaps I'm doing something brain-damaged with the
Qpid APIs.

To run it, "ant", then "java -jar
out/artifacts/qpid_multicastmain_jar/qpid-multicastmain.jar". It should
support most of the options of the native version of the program, naturally
excepting things like publisher confirms.

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120510/09ffc2dd/attachment.htm>

From fanchyna at gmail.com  Thu May 10 21:44:40 2012
From: fanchyna at gmail.com (fanchyna)
Date: Thu, 10 May 2012 13:44:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Error when installing Erlang: requires:
	libodbc.so.1() (64bit)
Message-ID: <3be25c45-4e77-478b-a10a-94c32f3ccbe0@p1g2000vbv.googlegroups.com>

Hi, I have encountered an error when I attempted to installed rabbitmq
on my RHEL 6 x86 system. The error message is

Error: Package: erlang-R12B-5.10.el5.x86_64 (epel)
           Requires: libodbc.so.1()(64bit)
 You could try using --skip-broken to work around the problem
 You could try running: rpm -Va --nofiles --nodigest

I have installed the most recent version of EPEL:

epel-release-6-6.noarch



But I cannot find libodbc.so.1() from yum or the rpm repository
online. Can any one advise me what to do?


From jerryk at rbcon.com  Thu May 10 23:20:13 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Thu, 10 May 2012 15:20:13 -0700
Subject: [rabbitmq-discuss] Error when installing Erlang: requires:
 libodbc.so.1() (64bit)
In-Reply-To: <3be25c45-4e77-478b-a10a-94c32f3ccbe0@p1g2000vbv.googlegroups.com>
References: <3be25c45-4e77-478b-a10a-94c32f3ccbe0@p1g2000vbv.googlegroups.com>
Message-ID: <CAE0Sz=ydcbsCxgsxxjTj=1XuZL5bMGbFCJaiK6OVrCevFiB19w@mail.gmail.com>

Please see the instructions here:

http://www.rabbitmq.com/install-rpm.html

In addition to the setup of the EPEL and fedorapeople repositories
documented within, you'll also want to make sure your RHEL system is
properly rhn_register'ed and updated.

With that taken care of, these instructions should let you install a more
up to date Erlang than the somewhat old R12B, along with its dependencies...

Best regards,
Jerry

On Thu, May 10, 2012 at 1:44 PM, fanchyna <fanchyna at gmail.com> wrote:

> Hi, I have encountered an error when I attempted to installed rabbitmq
> on my RHEL 6 x86 system. The error message is
>
> Error: Package: erlang-R12B-5.10.el5.x86_64 (epel)
>           Requires: libodbc.so.1()(64bit)
>  You could try using --skip-broken to work around the problem
>  You could try running: rpm -Va --nofiles --nodigest
>
> I have installed the most recent version of EPEL:
>
> epel-release-6-6.noarch
>
>
>
> But I cannot find libodbc.so.1() from yum or the rpm repository
> online. Can any one advise me what to do?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120510/19d9cff0/attachment.htm>

From sudheermaddukuri at gmail.com  Fri May 11 05:52:38 2012
From: sudheermaddukuri at gmail.com (Sudheer Maddukuri)
Date: Thu, 10 May 2012 21:52:38 -0700 (PDT)
Subject: [rabbitmq-discuss] Centralized web logging options.
In-Reply-To: <25195000.29.1336547451459.JavaMail.geo-discussion-forums@yndz2>
References: <CAKhN_m5bViVyThm-2_2AwvDY5QKtL_by=J9N-gONk-ZrkvcH_w@mail.gmail.com>
	<1332415858.18176.6.camel@workstation.wmmi.net>
	<ED51A8FBDD4F4F6F94B3619293ACE328@myyearbook.com>
	<CAGtiFWVppgh-iQzts44P5rK9TEWwJp0E-Ojhqn1-sO6LsuBpdQ@mail.gmail.com>
	<25195000.29.1336547451459.JavaMail.geo-discussion-forums@yndz2>
Message-ID: <22390336.608.1336711958669.JavaMail.geo-discussion-forums@vbfx1>

Will be glad if somebody can answer my post here.  

On Wednesday, 9 May 2012 12:40:51 UTC+5:30, Sudheer Maddukuri wrote:
>
> Hi,
>
> I am working on a similar implementation. Can you please provide more 
> details about how you made this work?
>
> Eagerly waiting for a reply.
>
> Thanks,
> Sudheer
>
> On Thursday, 22 March 2012 18:43:04 UTC+5:30, David Sinclair wrote:
>>
>> We are using Flume https://cwiki.apache.org/FLUME/ with the RabbitMQ 
>> Plugin https://github.com/stampy88/flume-amqp-plugin. Works like a charm
>>
>> On Thu, Mar 22, 2012 at 9:05 AM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>>
>>>  
>>>  On Thursday, March 22, 2012 at 7:30 AM, Adam Tauno Williams wrote:
>>>
>>> On Sat, 2012-02-25 at 06:25 +0700, Bill Moseley wrote:
>>>
>>> We have a busy pool of web servers running Apache that are currently
>>> logging on each machine. I'm looking at using RabbitMQ and a
>>> centralized log server.
>>>
>>>
>>> A syslog -> rabbit adaptor would be nice. But I haven't found such a
>>> thing.
>>>
>>> https://github.com/bkjones/bevis 
>>>
>>>  
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120510/6a822642/attachment.htm>

From matthew at rabbitmq.com  Fri May 11 12:20:37 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 11 May 2012 12:20:37 +0100
Subject: [rabbitmq-discuss] Active Queue Management
In-Reply-To: <20120510131602.GB26212@rabbitmq.com>
References: <CAM8fPiRTxLVZaB6Rx=NWOC4jPbVSqQU3qhsLy4hpOh=2d_6Xcw@mail.gmail.com>
	<20120510131602.GB26212@rabbitmq.com>
Message-ID: <20120511112036.GC12512@wellquite.org>

On Thu, May 10, 2012 at 02:16:03PM +0100, Matthew Sackman wrote:
> I'm actually in the process of implementing CoDel in the Java client.

Which I've done, and blogged about:
http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/

It seems to work quite nicely for the use cases it's intended for. As
ever, all feedback welcome (along with ports to other languages!).

Matthew

From holger.hoffstaette at googlemail.com  Fri May 11 13:36:53 2012
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Fri, 11 May 2012 14:36:53 +0200
Subject: [rabbitmq-discuss] Active Queue Management
References: <CAM8fPiRTxLVZaB6Rx=NWOC4jPbVSqQU3qhsLy4hpOh=2d_6Xcw@mail.gmail.com>
	<20120510131602.GB26212@rabbitmq.com>
	<20120511112036.GC12512@wellquite.org>
Message-ID: <pan.2012.05.11.12.36.51.583000@googlemail.com>

On Fri, 11 May 2012 12:20:37 +0100, Matthew Sackman wrote:

> On Thu, May 10, 2012 at 02:16:03PM +0100, Matthew Sackman wrote:
>> I'm actually in the process of implementing CoDel in the Java client.
> 
> Which I've done, and blogged about:
> http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/
> 
> It seems to work quite nicely for the use cases it's intended for. As
> ever, all feedback welcome (along with ports to other languages!).

Nice! Maybe prefer nanoTime() in Delivery() and dequeued(), as otherwise
you will probably see issues with clock granularity and jumps. Should not
be a problem as you only need relative time, and nanoTime is (de facto)
monotonic, though unfortunately a bit more expensive to call.
The Linux kernel module implementation landed yesterday as well, maybe you
want to double-check: http://www.spinics.net/lists/netdev/msg198099.html

-h



From matthew at rabbitmq.com  Fri May 11 13:49:02 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 11 May 2012 13:49:02 +0100
Subject: [rabbitmq-discuss] Active Queue Management
In-Reply-To: <pan.2012.05.11.12.36.51.583000@googlemail.com>
References: <CAM8fPiRTxLVZaB6Rx=NWOC4jPbVSqQU3qhsLy4hpOh=2d_6Xcw@mail.gmail.com>
	<20120510131602.GB26212@rabbitmq.com>
	<20120511112036.GC12512@wellquite.org>
	<pan.2012.05.11.12.36.51.583000@googlemail.com>
Message-ID: <20120511124902.GD12512@wellquite.org>

On Fri, May 11, 2012 at 02:36:53PM +0200, Holger Hoffstaette wrote:
> On Fri, 11 May 2012 12:20:37 +0100, Matthew Sackman wrote:
> 
> > On Thu, May 10, 2012 at 02:16:03PM +0100, Matthew Sackman wrote:
> >> I'm actually in the process of implementing CoDel in the Java client.
> > 
> > Which I've done, and blogged about:
> > http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/
> > 
> > It seems to work quite nicely for the use cases it's intended for. As
> > ever, all feedback welcome (along with ports to other languages!).
> 
> Nice! Maybe prefer nanoTime() in Delivery() and dequeued(), as otherwise
> you will probably see issues with clock granularity and jumps. Should not
> be a problem as you only need relative time, and nanoTime is (de facto)
> monotonic, though unfortunately a bit more expensive to call.
> The Linux kernel module implementation landed yesterday as well, maybe you
> want to double-check: http://www.spinics.net/lists/netdev/msg198099.html

Thanks for the pointer. I've been out of the Java world since 2006 so
I'm not surprised I've lost touch with the "nuances" of the APIs. I'll
take a look.

BTW, for anyone else wanting to try this stuff out, the "tc" tool from
the iproute package allows you to artificially add delays (and packet
loss) to network interfaces. This is useful in combination with the
CoDelConsumer example (https://gist.github.com/2658727), to watch the
CoDel algorithm kick in as prefetch buffer sojourn time increases.

For example:

Add a 50ms delay to all packets going over loopback:
# tc qdisc add dev lo root netem delay 50ms

And remove it:
# tc qdisc del dev lo root

I promise you the world doesn't end if you make loopback have delay or
loss!

Matthew

From rmadhwan at gmail.com  Fri May 11 13:51:25 2012
From: rmadhwan at gmail.com (Rakesh)
Date: Fri, 11 May 2012 05:51:25 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Memory Leak
Message-ID: <e2444e03-bfb2-4458-8726-bb67ecc5834c@s9g2000pbq.googlegroups.com>

We are using RabbitMQ in our project and while running PurifyPlus on
the application, I found memory leaks in librabbitmq.
How do I submit the fixes for this?


MLK: 47579136 bytes leaked in 363 blocks
  * This memory was allocated from:
	calloc         [rtlib.o]
	amqp_pool_alloc [amqp_mem.c:140]
	amqp_handle_input [amqp_connection.c:197]
	wait_frame_inner [amqp_socket.c:168]
	amqp_simple_rpc [amqp_socket.c:286]
	amqp_simple_rpc_decoded [amqp_socket.c:353]
	amqp_basic_qos [amqp_framing.c:2006]
	CRabbitQueueReader::readMessage(int&) [RabbitQueueReader.cpp:204]
  * Block of 131072 bytes (363 times); last block at 0x18269dc8

MLK: 262144 bytes leaked in 2 blocks
  * This memory was allocated from:
	calloc         [rtlib.o]
	amqp_pool_alloc [amqp_mem.c:140]
	amqp_decode_method [amqp_framing.c:187]
	amqp_handle_input [amqp_connection.c:272]
	wait_frame_inner [amqp_socket.c:168]
	amqp_simple_wait_method [amqp_socket.c:218]
	amqp_login     [amqp_socket.c:383]
	CRabbitQueueWriter::openConnection() [RabbitQueueWriter.cpp:78]
  * Block of 131072 bytes (2 times); last block at 0xa135df8

From fanchyna at gmail.com  Fri May 11 16:46:25 2012
From: fanchyna at gmail.com (JIAN WU)
Date: Fri, 11 May 2012 11:46:25 -0400
Subject: [rabbitmq-discuss] Error when installing Erlang: requires:
 libodbc.so.1() (64bit)
In-Reply-To: <CAE0Sz=ydcbsCxgsxxjTj=1XuZL5bMGbFCJaiK6OVrCevFiB19w@mail.gmail.com>
References: <3be25c45-4e77-478b-a10a-94c32f3ccbe0@p1g2000vbv.googlegroups.com>
	<CAE0Sz=ydcbsCxgsxxjTj=1XuZL5bMGbFCJaiK6OVrCevFiB19w@mail.gmail.com>
Message-ID: <CAPXPY5JkYCLU-vwVWDKrC8mypoiQ-zgzct8U36MKwofuSi1_QA@mail.gmail.com>

thanks. I was able to install rabbitmq on my rhel 6.

-John

On Thu, May 10, 2012 at 6:20 PM, Jerry Kuch <jerryk at rbcon.com> wrote:

> Please see the instructions here:
>
> http://www.rabbitmq.com/install-rpm.html
>
> In addition to the setup of the EPEL and fedorapeople repositories
> documented within, you'll also want to make sure your RHEL system is
> properly rhn_register'ed and updated.
>
> With that taken care of, these instructions should let you install a more
> up to date Erlang than the somewhat old R12B, along with its dependencies...
>
> Best regards,
> Jerry
>
>
> On Thu, May 10, 2012 at 1:44 PM, fanchyna <fanchyna at gmail.com> wrote:
>
>> Hi, I have encountered an error when I attempted to installed rabbitmq
>> on my RHEL 6 x86 system. The error message is
>>
>> Error: Package: erlang-R12B-5.10.el5.x86_64 (epel)
>>           Requires: libodbc.so.1()(64bit)
>>  You could try using --skip-broken to work around the problem
>>  You could try running: rpm -Va --nofiles --nodigest
>>
>> I have installed the most recent version of EPEL:
>>
>> epel-release-6-6.noarch
>>
>>
>>
>> But I cannot find libodbc.so.1() from yum or the rpm repository
>> online. Can any one advise me what to do?
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120511/a7f14be1/attachment.htm>

From james.mcmahon at TASC.COM  Fri May 11 18:50:08 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Fri, 11 May 2012 17:50:08 +0000
Subject: [rabbitmq-discuss] Initiating queue monitoring,
 but returning to main method with indication of success
In-Reply-To: <4F44D8E7.3050906@rabbitmq.com>
References: <C974010E949511448F6DC6F748F604D90FEB1959@TSEAMB01>,
	<4F44D498.7060404@rabbitmq.com>
	<C974010E949511448F6DC6F748F604D90FEB1A06@TSEAMB01>,
	<4F44D8E7.3050906@rabbitmq.com>
Message-ID: <C974010E949511448F6DC6F748F604D90FEE6942@TSEAMB01>

     Simon, in this example we had referenced in this discussion thread - what is "ticket", and how does that get created?

     I tried to visit the AMQP site to find some class library description but did not find the AMQP methods detailed there.

     Thank you for your help.

Jim


    boolean autoAck = false;
channel.basicConsume(ticket, queueName, autoAck,
     new DefaultConsumer(channel) {
         @Override
         public void handleDelivery(String consumerTag,
                                    Envelope envelope,
                                    AMQP.BasicProperties properties,
                                    byte[] body)
             throws IOException
         {
             String routingKey = envelope.getRoutingKey();
             String contentType = properties.contentType;
             long deliveryTag = envelope.getDeliveryTag();
             //
             // my custom handling stuff here
             //
             channel.basicAck(deliveryTag, false);
         }
     });




CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.

From jondtaylor at gmail.com  Fri May 11 22:25:56 2012
From: jondtaylor at gmail.com (Jon Taylor)
Date: Fri, 11 May 2012 14:25:56 -0700
Subject: [rabbitmq-discuss] RabbitMQ connection question
Message-ID: <CADmaSA9uQ_WudVzOCJ1PSW0X0sS5r7RXyMVB1YSUQUMK3_6kCQ@mail.gmail.com>

Hello

I'm looking for some input on an issue connecting to to RabbitMQ with PHP
or an admin tool/plugin. My service is reporting to be running now that it
is configured.

I have set up this send.php and receive.php example from:
https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php. I am not
able to connect to the service.


I tried to install a status plugin without success:
http://www.lshift.net/blog/2009/11/30/introducing-rabbitmq-status-plugin


Also I can't install/run the command line management tools (I would use
this to verify the service and test it):
http://www.rabbitmq.com/management-cli.html

>rabbitmqadmin -V test list exchanges
>   File "/usr/local/bin/rabbitmqadmin", line 287
>     except ConfigParserError as error:
>                               ^
> SyntaxError: invalid syntax"


Details:
OS: CentOS 5
Details: RabbitMQ version: 2.2.0
Python: 2.4.3

Any input is Much appreciated.

Thanks
Jon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120511/52e43672/attachment.htm>

From travis at fantasymoguls.com  Sat May 12 01:03:15 2012
From: travis at fantasymoguls.com (Travis)
Date: Sat, 12 May 2012 00:03:15 +0000 (UTC)
Subject: [rabbitmq-discuss] Problems with RabbitMQ & EC2 64-bit instance
Message-ID: <loom.20120512T015224-908@post.gmane.org>

I've installed RabbitMQ following these instructions:
http://www.rabbitmq.com/ec2.html

The install works great, rabbitmqctl status looks great.

However, running the test (also on install page) 
'runjava com.rabbitmq.examples.MulticastMain'.  
I get the output:
starting consumer #0
starting producer #0

Then nothing.  No connection error, no response, no messages
added to the queue.  

The problem occurs on an AWS m1.large instance 
(64-bit) running ubuntu (Linux fbb3web01 
2.6.32-312-ec2 #24-Ubuntu SMP Fri 
Jan 7 18:30:50 UTC 2011 x86_64 GNU/Linux Ubuntu 
10.04.4 LTS)

When I run the same install on an AWS small 
(32-bit, same ubuntu), the MulticastMain test works great.

I've used the java api Tracer class and the connections 
are made, messages are published, just nothing goes 
into a queue (best I can tell).

I'm new to RabbitMQ, so maybe I'm just missing something simple.

Anyone run into this?

Thanks,
Travis


From Bin.Chen at kla-tencor.com  Sat May 12 01:45:30 2012
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Fri, 11 May 2012 17:45:30 -0700
Subject: [rabbitmq-discuss] RabbitMQ termination error question
In-Reply-To: <CADmaSA9uQ_WudVzOCJ1PSW0X0sS5r7RXyMVB1YSUQUMK3_6kCQ@mail.gmail.com>
References: <CADmaSA9uQ_WudVzOCJ1PSW0X0sS5r7RXyMVB1YSUQUMK3_6kCQ@mail.gmail.com>
Message-ID: <BCC407A444557E41B0D8B0260D68499204E0EAF0@CA1EXCLV07.adcorp.kla-tencor.com>

We recently encountered some fatal errors on two RabbitMQ servers.

Can someone provide some clue on the following error report in RabbitMQ
log?

 

 

=ERROR REPORT==== 7-May-2012::15:24:00 ===

** Generic server rabbit_mgmt_db terminating

** Last message in was {'$gen_cast',

{event,

{event,channel_stats,

[{pid,<0.17420.3183>},

{transactional,false},

{confirm,false},

{consumer_count,0},

{messages_unacknowledged,0},

{messages_unconfirmed,0},

{messages_uncommitted,0},

{acks_uncommitted,0},

{prefetch_count,1},

{client_flow_blocked,false},

{channel_queue_stats,[{<0.1142.3183>,[{ack,1}]}]},

{channel_exchange_stats,[]},

{channel_queue_exchange_stats,[]}],

{1336,375440,491821}}}}

** When Server state == {state,[{channel_exchange_stats,274515},

{channel_queue_exchange_stats,278612},

{channel_queue_stats,270418},

{channel_stats,262224},

{connection_stats,258127},

{consumers,266321},

{queue_stats,254030}],

5000}

** Reason for termination ==

** {badarith,[{rabbit_mgmt_db,rate,5},

{rabbit_mgmt_db,'-rates/5-lc$^0/1-0-',5},

{rabbit_mgmt_db,'-rates/5-lc$^1/1-1-',6},

{rabbit_mgmt_db,rates,5},

{rabbit_mgmt_db,handle_fine_stat,7},

{rabbit_mgmt_db,'-handle_fine_stats/4-lc$^1/1-1-',4},

{rabbit_mgmt_db,'-handle_event/2-lc$^1/1-0-',4},

{rabbit_mgmt_db,handle_event,2}]}

 

 

Best regards,

--Bin

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120511/fa4618e2/attachment.htm>

From jayeshdalwadi2007 at gmail.com  Sat May 12 06:25:27 2012
From: jayeshdalwadi2007 at gmail.com (jayesh dalwadi)
Date: Fri, 11 May 2012 22:25:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem With Distribute load Using HAproxy ?
Message-ID: <b796ee96-3d8e-4770-b2ab-c15882a7364c@x6g2000pbh.googlegroups.com>

hello
i create HAproxy TCP Base load balance but problem is when i publish
message using that load balancer that time my connection establish to
one node and that node hava all the message

example

i create two node of RabbitMQ its behind  HAproxy loadbalncer and when
i start my publisher program that time my publish message not get
distributed between that nodes only one node get all the message

how can i distribute my publish message to different node can any body
give suggestion that how can it possible


my publisher program is

public class RabbitMQ {
	private static ConnectionFactory factory = new ConnectionFactory();
	private static Connection connection;
	private static Channel channel;

	public static void main(String args[]){

		try {

			ConnectionFactory factory = new ConnectionFactory();
			factory.setHost("192.168.137.1");
			factory.setPort(5672);
			connection=  factory.newConnection();
			channel = connection.createChannel();
			Map<String, Object> args1 = new HashMap<String, Object>();
			args1.put("x-ha-policy", "all");

			channel.queueDeclare("Queue1",false, false, false, args1);
			channel.queueDeclare("Queue2",false, false, false, args1);
			channel.exchangeDeclare("test1","direct");
			channel.queueBind("Queue1","test1", "ex1");
			channel.queueBind("Queue2","test1", "ex2");

			for (int i=0;i<100000;i++){
	
channel.basicPublish("test1","ex2",MessageProperties.PERSISTENT_TEXT_PLAIN,"test
message".getBytes());
			}

		}catch (IOException e) {

			e.printStackTrace();

		}

	}

}




From emile at rabbitmq.com  Sat May 12 09:58:09 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Sat, 12 May 2012 09:58:09 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ & EC2 64-bit instance
In-Reply-To: <loom.20120512T015224-908@post.gmane.org>
References: <loom.20120512T015224-908@post.gmane.org>
Message-ID: <4FAE2621.7030904@rabbitmq.com>

Hi,

On 12/05/12 01:03, Travis wrote:
> The problem occurs on an AWS m1.large instance 

> When I run the same install on an AWS small 
> (32-bit, same ubuntu), the MulticastMain test works great.

The most likely cause is that disk free space monitoring is blocking
publishers. The broker logfile will confirm this.

You will need to lower the free space limit on machines with more RAM
than free disk space. For more details see

http://www.rabbitmq.com/memory.html#diskfreesup


-Emile



From aluenkinglee at gmail.com  Sat May 12 10:44:01 2012
From: aluenkinglee at gmail.com (aluen)
Date: Sat, 12 May 2012 02:44:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Can rabbitMQ publish an object to the queue?
Message-ID: <13083543.16.1336815841857.JavaMail.geo-discussion-forums@ynz24>

I have learned the Tutorials <http://www.rabbitmq.com/getstarted.html> on 
the rabbitmq website  and  all the cases work well.So  I want to do more 
with it . 
I found that all the cases just publish a string to the queue ,can other 
object publish to queue? have a try . I did as follows:

*send.py*

# encoding=utf8
import pika

class message:
id = 1
name = ""
body = ""
def __init__(self,name="message",body="hello world"):
self.name = name
self.body = body
def set_name(self,name):
self.name = name
def set_body(self,body):
self.body = body
msg = message() *# I want to put this kind of object publish to the queue*

connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()
channel.queue_declare(queue='hello')
channel.basic_publish(exchange='',
                      routing_key='hello',
                      body=msg)
print " [x] Sent 'Hello World!'"
connection.close()

then i run this script , and i got this warning:

Traceback (most recent call last):
  File "send.py", line 24, in <module>
    body=msg)
  File "build/bdist.linux-i686/egg/pika/adapters/blocking_connection.py", 
line 285, in basic_publish
  File "build/bdist.linux-i686/egg/pika/adapters/blocking_connection.py", 
line 241, in send_method
  File "build/bdist.linux-i686/egg/pika/connection.py", line 669, in 
_send_method
*AttributeError: message instance has no attribute '__len__'*

the underline words is what I want to ask,how to  deal with it , can I put 
an object to the queue because I hope to do like this ,do you have other 
method? Thanks!!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120512/477a4329/attachment.htm>

From sameek at arosys.com  Sun May 13 14:00:32 2012
From: sameek at arosys.com (sameekmishra)
Date: Sun, 13 May 2012 06:00:32 -0700 (PDT)
Subject: [rabbitmq-discuss] How to implement rabbitmq cluster and
 active-active highly available queues on Debian Linux?
Message-ID: <33823297.post@talk.nabble.com>


HI 

I want to use rabbitmq cluster and active-active highly available queues on
Debian Linux 6.04.please provide details how to implements and what are the
component is required to implement.


Thanks
-- 
View this message in context: http://old.nabble.com/How-to-implement-rabbitmq-cluster-and-active-active-highly-available-queues-on-Debian-Linux--tp33823297p33823297.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From michael.justin at gmx.net  Sun May 13 19:45:02 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Sun, 13 May 2012 20:45:02 +0200
Subject: [rabbitmq-discuss] STOMP + SSL with OpenSSL - tlsv1 alert internal
	error
Message-ID: <joovfg$610$1@dough.gmane.org>

Hello,

using current RabbitMQ 2.8.2 with this rabbitmq.config file

[
   {rabbitmq_stomp, [{tcp_listeners, [61613]},
                     {ssl_listeners, [61614]}]}
].

The STOMP client gets this error message from OpenSSL version 1.0.1:

Error connecting with SSL.
error:14094438:SSL routines:SSL3_READ_BYTES:tlsv1 alert internal error

Do I need additional configuration steps for the SSL STOMP adapter?

Many thanks in advance!

Michael Justin


From michael.justin at gmx.net  Sun May 13 19:57:53 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Sun, 13 May 2012 20:57:53 +0200
Subject: [rabbitmq-discuss] STOMP + SSL with OpenSSL - tlsv1 alert
	internal error
In-Reply-To: <joovfg$610$1@dough.gmane.org>
References: <joovfg$610$1@dough.gmane.org>
Message-ID: <jop07j$dge$1@dough.gmane.org>

Update:

Erlang R14B02 (erts-5.8.3)

1> ssl:versions().

[{ssl_app,"4.1.4"},
  {supported,[tlsv1,sslv3]},
  {available,[tlsv1,sslv3]}]


From michael.justin at gmx.net  Sun May 13 20:03:03 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Sun, 13 May 2012 21:03:03 +0200
Subject: [rabbitmq-discuss] STOMP + SSL with OpenSSL - tlsv1 alert
	internal error
In-Reply-To: <joovfg$610$1@dough.gmane.org>
References: <joovfg$610$1@dough.gmane.org>
Message-ID: <jop0h9$gcd$1@dough.gmane.org>

Here is the output of OpenSSL s_client -connect localhost:61614


Loading 'screen' into random state - done
CONNECTED(0000013C)
2548:error:14094438:SSL routines:SSL3_READ_BYTES:tlsv1 alert internal 
error:.\ss
l\s3_pkt.c:1240:SSL alert number 80
2548:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake 
failure:.\ssl\s23_lib
.c:177:
---
no peer certificate available
---
No client certificate CA names sent
---
SSL handshake has read 93 bytes and written 0 bytes
---
New, (NONE), Cipher is (NONE)
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
SSL-Session:
     Protocol  : TLSv1
     Cipher    : 0000
     Session-ID: 
C4575E4AEB5B5E65EEB94DECBE3DF5D298E97AE9B21397173FF2B42A2264EAED

     Session-ID-ctx:
     Master-Key:
     Key-Arg   : None
     PSK identity: None
     PSK identity hint: None
     SRP username: None
     Start Time: 1336935645
     Timeout   : 300 (sec)
     Verify return code: 0 (ok)
---
error in s_client
OpenSSL>



From iceblaze at gmail.com  Mon May 14 02:35:23 2012
From: iceblaze at gmail.com (iceblaze)
Date: Sun, 13 May 2012 18:35:23 -0700
Subject: [rabbitmq-discuss] Unable to cluster..
Message-ID: <CA+-WFvzuKiZWMFUe85rwLwq_8qOExRPvjQvdmfXTRj6ZfR3bGQ@mail.gmail.com>

Hello,

I seem to be having an issue clustering and I don't know why. I followed
the clustering guide to the T, and my node is reachable. See my pasted
history below:

[root at rabbit-test2 ~]# rabbitmqctl stop_app
Stopping node 'rabbit at rabbit-test2' ...
...done.
[root at rabbit-test2 ~]# rabbitmqctl reset
Resetting node 'rabbit at rabbit-test2' ...
...done.
[root at rabbit-test2 ~]# rabbitmqctl cluster rabbit at rabbit-test1
Clustering node 'rabbit at rabbit-test2' with ['rabbit at rabbit-test1'] ...
Error: {no_running_cluster_nodes,['rabbit at rabbit-test1'],
                                 ['rabbit at rabbit-test1']}
[root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test2status
Status of node 'rabbit at rabbit-test2' ...
[{pid,4430},
 {running_applications,[{sasl,"SASL  CXC 138 11","2.1.5.4"},
                        {stdlib,"ERTS  CXC 138 10","1.15.5"},
                        {kernel,"ERTS  CXC 138 10","2.12.5"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang (BEAM) emulator version 5.6.5 [source] [64-bit]
[smp:8] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,24418832},
          {processes,9356856},
          {processes_used,9271008},
          {system,15061976},
          {atom,1070481},
          {atom_used,1054613},
          {binary,68208},
          {code,11784351},
          {ets,542680}]},
 {processes,[{limit,1048576},{used,44}]},
 {run_queue,0},
 {uptime,421}]
...done.


Any ideas on why it can't cluster?

Thanks!

-James

-- 
"Of course, the actual government of any computer is run by that fascist
dictator known as the operating system. But a wise dictator knows when to
let the people think they're capitalists--and when to let them think
they're communists." - Programming Perl third edition
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120513/7900329b/attachment.htm>

From iceblaze at gmail.com  Mon May 14 02:36:42 2012
From: iceblaze at gmail.com (iceblaze)
Date: Sun, 13 May 2012 18:36:42 -0700
Subject: [rabbitmq-discuss] Unable to cluster..
In-Reply-To: <CA+-WFvzuKiZWMFUe85rwLwq_8qOExRPvjQvdmfXTRj6ZfR3bGQ@mail.gmail.com>
References: <CA+-WFvzuKiZWMFUe85rwLwq_8qOExRPvjQvdmfXTRj6ZfR3bGQ@mail.gmail.com>
Message-ID: <CA+-WFvyNbzwPnp_fwmphQy2GmgJNG1zAdfc8uVDwKjzRZR0qWw@mail.gmail.com>

I also forgot to mention that the erlang cookie is copied from rabbit-test1

-James

On Sun, May 13, 2012 at 6:35 PM, iceblaze <iceblaze at gmail.com> wrote:

> Hello,
>
> I seem to be having an issue clustering and I don't know why. I followed
> the clustering guide to the T, and my node is reachable. See my pasted
> history below:
>
> [root at rabbit-test2 ~]# rabbitmqctl stop_app
> Stopping node 'rabbit at rabbit-test2' ...
> ...done.
> [root at rabbit-test2 ~]# rabbitmqctl reset
> Resetting node 'rabbit at rabbit-test2' ...
> ...done.
> [root at rabbit-test2 ~]# rabbitmqctl cluster rabbit at rabbit-test1
> Clustering node 'rabbit at rabbit-test2' with ['rabbit at rabbit-test1'] ...
> Error: {no_running_cluster_nodes,['rabbit at rabbit-test1'],
>                                  ['rabbit at rabbit-test1']}
> [root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test2status
> Status of node 'rabbit at rabbit-test2' ...
> [{pid,4430},
>  {running_applications,[{sasl,"SASL  CXC 138 11","2.1.5.4"},
>                         {stdlib,"ERTS  CXC 138 10","1.15.5"},
>                         {kernel,"ERTS  CXC 138 10","2.12.5"}]},
>  {os,{unix,linux}},
>  {erlang_version,"Erlang (BEAM) emulator version 5.6.5 [source] [64-bit]
> [smp:8] [async-threads:30] [hipe] [kernel-poll:true]\n"},
>  {memory,[{total,24418832},
>           {processes,9356856},
>           {processes_used,9271008},
>           {system,15061976},
>           {atom,1070481},
>           {atom_used,1054613},
>           {binary,68208},
>           {code,11784351},
>           {ets,542680}]},
>  {processes,[{limit,1048576},{used,44}]},
>  {run_queue,0},
>  {uptime,421}]
> ...done.
>
>
> Any ideas on why it can't cluster?
>
> Thanks!
>
> -James
>
> --
> "Of course, the actual government of any computer is run by that fascist
> dictator known as the operating system. But a wise dictator knows when to
> let the people think they're capitalists--and when to let them think
> they're communists." - Programming Perl third edition
>



-- 
"Of course, the actual government of any computer is run by that fascist
dictator known as the operating system. But a wise dictator knows when to
let the people think they're capitalists--and when to let them think
they're communists." - Programming Perl third edition
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120513/0254ce8b/attachment.htm>

From bino at indoakses-online.com  Mon May 14 05:16:05 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Mon, 14 May 2012 11:16:05 +0700
Subject: [rabbitmq-discuss] is RabbitMQ for me ?
Message-ID: <4FB08705.5050104@indoakses-online.com>

Dear All ...
This is my first time jump to the MQ world.

I'm building a Fleet Telemtry system.
Since it's a 'Fleet', there is a time that my system will got network 
connection, and there is a time where my system in 'blank area'.

What I'm thinking is :
1. Build a telemetry loger that will always write the log to MQ
2. Build MQ 'Task worker' will process each stored Message. The process 
HTTP POST, and :
a. IF Success : Delete the task from MQ,
b. IF Failed : Leave the Task untouched

The MQ database have to be Persistance, so that if my system shutted 
down .. it'll proceed the next time it's started-up.

My programming language is Python

Question :
1. Is Rabbit MQ for me ?
2. If So, I read 
http://www.rabbitmq.com/tutorials/tutorial-one-python.html , so I'll use 
PIKA as pythin library.
How to tell RabbitMQ (using PIKA) that the Task is Done (and delete the 
task) ?
How to tell RabbitMQ (using PIKA) that the HTTP POST is failed and just 
leave the Task untouched ?

Is it just like ( adopted from the last code at 
http://www.rabbitmq.com/tutorials/tutorial-two-python.html ) :
----START----
def callback(ch, method, properties, body):
     print " [x] Received %r" % (body,)
     time.sleep( body.count('.') )
     welldonne = True
     try :
         do httppos
     except :
         welldone = False

     if welldone :
         ch.basic_ack(delivery_tag = method.delivery_tag)
     else
         ch.basic_ack(delivery_tag = False)
----STOP-----

Kindly please give me your enlightment.

Sincerely
-bino-


From alan.antonuk at gmail.com  Mon May 14 08:29:28 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 14 May 2012 03:29:28 -0400
Subject: [rabbitmq-discuss] RabbitMQ Memory Leak
In-Reply-To: <e2444e03-bfb2-4458-8726-bb67ecc5834c@s9g2000pbq.googlegroups.com>
References: <e2444e03-bfb2-4458-8726-bb67ecc5834c@s9g2000pbq.googlegroups.com>
Message-ID: <CAAt2poK5hnuE=i=+EdUuBdr0bueN50D5q8T8-3mxbEr6GWSGug@mail.gmail.com>

If you have a patch, fork the repository on github (
https://github.com/alanxz/rabbitmq-c) then submit a pull request there.

If you just have a bug to report, you can open an issue using the github
issue tracker

-Alan

On Fri, May 11, 2012 at 8:51 AM, Rakesh <rmadhwan at gmail.com> wrote:

> We are using RabbitMQ in our project and while running PurifyPlus on
> the application, I found memory leaks in librabbitmq.
> How do I submit the fixes for this?
>
>
> MLK: 47579136 bytes leaked in 363 blocks
>  * This memory was allocated from:
>        calloc         [rtlib.o]
>        amqp_pool_alloc [amqp_mem.c:140]
>        amqp_handle_input [amqp_connection.c:197]
>        wait_frame_inner [amqp_socket.c:168]
>        amqp_simple_rpc [amqp_socket.c:286]
>        amqp_simple_rpc_decoded [amqp_socket.c:353]
>        amqp_basic_qos [amqp_framing.c:2006]
>        CRabbitQueueReader::readMessage(int&) [RabbitQueueReader.cpp:204]
>  * Block of 131072 bytes (363 times); last block at 0x18269dc8
>
> MLK: 262144 bytes leaked in 2 blocks
>  * This memory was allocated from:
>        calloc         [rtlib.o]
>        amqp_pool_alloc [amqp_mem.c:140]
>        amqp_decode_method [amqp_framing.c:187]
>        amqp_handle_input [amqp_connection.c:272]
>        wait_frame_inner [amqp_socket.c:168]
>        amqp_simple_wait_method [amqp_socket.c:218]
>        amqp_login     [amqp_socket.c:383]
>        CRabbitQueueWriter::openConnection() [RabbitQueueWriter.cpp:78]
>  * Block of 131072 bytes (2 times); last block at 0xa135df8
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120514/a2b620a5/attachment.htm>

From emile at rabbitmq.com  Mon May 14 10:05:23 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 14 May 2012 10:05:23 +0100
Subject: [rabbitmq-discuss] Unable to cluster..
In-Reply-To: <CA+-WFvyNbzwPnp_fwmphQy2GmgJNG1zAdfc8uVDwKjzRZR0qWw@mail.gmail.com>
References: <CA+-WFvzuKiZWMFUe85rwLwq_8qOExRPvjQvdmfXTRj6ZfR3bGQ@mail.gmail.com>
	<CA+-WFvyNbzwPnp_fwmphQy2GmgJNG1zAdfc8uVDwKjzRZR0qWw@mail.gmail.com>
Message-ID: <4FB0CAD3.1000407@rabbitmq.com>

Hi,

On 14/05/12 02:36, iceblaze wrote:
> I seem to be having an issue clustering and I don't know why. I
> followed the clustering guide to the T, and my node is reachable.

The most common cause of these symptoms is a firewall. Have you taken a
look at http://www.rabbitmq.com/clustering.html#firewall and confirmed
that the nodes are reachable in the way required for clustering?

Also check that you are able to obtain the broker status from each the
prospective clustering partner node:
[root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test1 status


-Emile



From iceblaze at gmail.com  Mon May 14 10:08:47 2012
From: iceblaze at gmail.com (iceblaze)
Date: Mon, 14 May 2012 02:08:47 -0700
Subject: [rabbitmq-discuss] Unable to cluster..
In-Reply-To: <4FB0CAD3.1000407@rabbitmq.com>
References: <CA+-WFvzuKiZWMFUe85rwLwq_8qOExRPvjQvdmfXTRj6ZfR3bGQ@mail.gmail.com>
	<CA+-WFvyNbzwPnp_fwmphQy2GmgJNG1zAdfc8uVDwKjzRZR0qWw@mail.gmail.com>
	<4FB0CAD3.1000407@rabbitmq.com>
Message-ID: <CA+-WFvysaXMpHBY=8jREboikrS1Opxqfs2cNriF9EFfTqgOAmA@mail.gmail.com>

Hello Emile,

Yes, I did provide a status in my previous email, which suggests it's
reachable and not a firewall issue.

Cheers,

-James

On Mon, May 14, 2012 at 2:05 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 14/05/12 02:36, iceblaze wrote:
> > I seem to be having an issue clustering and I don't know why. I
> > followed the clustering guide to the T, and my node is reachable.
>
> The most common cause of these symptoms is a firewall. Have you taken a
> look at http://www.rabbitmq.com/clustering.html#firewall and confirmed
> that the nodes are reachable in the way required for clustering?
>
> Also check that you are able to obtain the broker status from each the
> prospective clustering partner node:
> [root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test1 status
>
>
> -Emile
>
>
>


-- 
"Of course, the actual government of any computer is run by that fascist
dictator known as the operating system. But a wise dictator knows when to
let the people think they're capitalists--and when to let them think
they're communists." - Programming Perl third edition
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120514/6beb217e/attachment.htm>

From iceblaze at gmail.com  Mon May 14 10:17:47 2012
From: iceblaze at gmail.com (iceblaze)
Date: Mon, 14 May 2012 02:17:47 -0700
Subject: [rabbitmq-discuss] Unable to cluster..
In-Reply-To: <CA+-WFvysaXMpHBY=8jREboikrS1Opxqfs2cNriF9EFfTqgOAmA@mail.gmail.com>
References: <CA+-WFvzuKiZWMFUe85rwLwq_8qOExRPvjQvdmfXTRj6ZfR3bGQ@mail.gmail.com>
	<CA+-WFvyNbzwPnp_fwmphQy2GmgJNG1zAdfc8uVDwKjzRZR0qWw@mail.gmail.com>
	<4FB0CAD3.1000407@rabbitmq.com>
	<CA+-WFvysaXMpHBY=8jREboikrS1Opxqfs2cNriF9EFfTqgOAmA@mail.gmail.com>
Message-ID: <CA+-WFvyNd790RpPqGH10-Hsa+AbHrPJ+Qb_dEhotuwa0OOxVnQ@mail.gmail.com>

Hello Emile,

Ha! I see that I actually did a status against itself (rabbit-test2), and
not rabbit at rabbit-test1. I will retry and report if I'm still having the
issue.

-James

On Mon, May 14, 2012 at 2:08 AM, iceblaze <iceblaze at gmail.com> wrote:

> Hello Emile,
>
> Yes, I did provide a status in my previous email, which suggests it's
> reachable and not a firewall issue.
>
> Cheers,
>
> -James
>
>
> On Mon, May 14, 2012 at 2:05 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>
>> Hi,
>>
>> On 14/05/12 02:36, iceblaze wrote:
>> > I seem to be having an issue clustering and I don't know why. I
>> > followed the clustering guide to the T, and my node is reachable.
>>
>> The most common cause of these symptoms is a firewall. Have you taken a
>> look at http://www.rabbitmq.com/clustering.html#firewall and confirmed
>> that the nodes are reachable in the way required for clustering?
>>
>> Also check that you are able to obtain the broker status from each the
>> prospective clustering partner node:
>> [root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test1 status
>>
>>
>> -Emile
>>
>>
>>
>
>
> --
> "Of course, the actual government of any computer is run by that fascist
> dictator known as the operating system. But a wise dictator knows when to
> let the people think they're capitalists--and when to let them think
> they're communists." - Programming Perl third edition
>



-- 
"Of course, the actual government of any computer is run by that fascist
dictator known as the operating system. But a wise dictator knows when to
let the people think they're capitalists--and when to let them think
they're communists." - Programming Perl third edition
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120514/2fe4077b/attachment.htm>

From emile at rabbitmq.com  Mon May 14 10:37:38 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 14 May 2012 10:37:38 +0100
Subject: [rabbitmq-discuss] STOMP + SSL with OpenSSL - tlsv1 alert
 internal error
In-Reply-To: <joovfg$610$1@dough.gmane.org>
References: <joovfg$610$1@dough.gmane.org>
Message-ID: <4FB0D262.3020907@rabbitmq.com>

Hi Michael,

On 13/05/12 19:45, Michael Justin wrote:
> [
>    {rabbitmq_stomp, [{tcp_listeners, [61613]},
>                      {ssl_listeners, [61614]}]}
> ].

The broker needs to be configured for SSL as described here:
http://www.rabbitmq.com/ssl.html

> no peer certificate available

The OpenSSL failure indicates that there is no certificate, because the
broker is not configured for SSL.


-Emile


From majek04 at gmail.com  Mon May 14 11:06:34 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 14 May 2012 11:06:34 +0100
Subject: [rabbitmq-discuss] Introducing RabbitMQ-Web-STOMP plugin!
Message-ID: <CABzX+qyf=pKtpRyZMcOjt72gDnuDJ9TBigX3qSrPqvwCOrRdyw@mail.gmail.com>

Good news!

We'd like to introduce a new plugin: RabbitMQ-Web-STOMP. It is our
recent attempt to expose messaging in browsers.

This plugin is basically a bridge between RabbitMQ-STOMP
and a Websockets server (SockJS).

Introductory blog post:
    http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/

Source code:
    https://github.com/rabbitmq/rabbitmq-web-stomp


Like always, feedback welcome!

Cheers,
    Marek Majkowski

From simon at rabbitmq.com  Mon May 14 11:20:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 May 2012 11:20:06 +0100
Subject: [rabbitmq-discuss] RabbitMQ connection question
In-Reply-To: <CADmaSA9uQ_WudVzOCJ1PSW0X0sS5r7RXyMVB1YSUQUMK3_6kCQ@mail.gmail.com>
References: <CADmaSA9uQ_WudVzOCJ1PSW0X0sS5r7RXyMVB1YSUQUMK3_6kCQ@mail.gmail.com>
Message-ID: <4FB0DC56.3010202@rabbitmq.com>

On 11/05/12 22:25, Jon Taylor wrote:
>
> I'm looking for some input on an issue connecting to to RabbitMQ with
> PHP or an admin tool/plugin. My service is reporting to be running now
> that it is configured.
>
> I have set up this send.php and receive.php example from:
> https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php. I am not
> able to connect to the service.

Error messages from the client? Anything in the server-side logs?

> I tried to install a status plugin without success:
> http://www.lshift.net/blog/2009/11/30/introducing-rabbitmq-status-plugin

The status plugin is ancient and has been superseded by the management 
plugin. The management plugin for RabbitMQ 2.2.0 is available from

http://www.rabbitmq.com/releases/plugins/v2.2.0/

but 2.2.0 is quite old and the management plugin was quite crude at that 
point. I would suggest you upgrade to RabbitMQ 2.8.2 and enable 
management as described at http://www.rabbitmq.com/plugins.html

> Also I can't install/run the command line management tools (I would use
> this to verify the service and test it):
> http://www.rabbitmq.com/management-cli.html

I think rabbitmqadmin needs Python 2.6 at least. Python 2.4 is 
definitely too old.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon May 14 11:22:50 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 May 2012 11:22:50 +0100
Subject: [rabbitmq-discuss] How to implement rabbitmq cluster and
 active-active highly available queues on Debian Linux?
In-Reply-To: <33823297.post@talk.nabble.com>
References: <33823297.post@talk.nabble.com>
Message-ID: <4FB0DCFA.6010802@rabbitmq.com>

On 13/05/12 14:00, sameekmishra wrote:
> I want to use rabbitmq cluster and active-active highly available queues on
> Debian Linux 6.04.please provide details how to implements and what are the
> component is required to implement.

This is a very vague question.

I suggest you start by downloading RabbitMQ for Debian:

http://www.rabbitmq.com/install-debian.html

and then read the docs on clustering:

http://www.rabbitmq.com/clustering.html

and mirrored queues:

http://www.rabbitmq.com/ha.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon May 14 11:36:27 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 May 2012 11:36:27 +0100
Subject: [rabbitmq-discuss] Can rabbitMQ publish an object to the queue?
In-Reply-To: <13083543.16.1336815841857.JavaMail.geo-discussion-forums@ynz24>
References: <13083543.16.1336815841857.JavaMail.geo-discussion-forums@ynz24>
Message-ID: <4FB0E02B.2010507@rabbitmq.com>

On 12/05/12 10:44, aluen wrote:
> the underline words is what I want to ask,how to  deal with it , can I
> put an object to the queue because I hope to do like this ,do you have
> other method? Thanks!!

Hi Aluen. RabbitMQ treats message bodies as opaque binary data. If you 
want to send objects you'll need to serialise them - if you're only 
using Python you could pickle the objects. Otherwise you would need to 
write out JSON or XML or similar.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Mon May 14 11:47:17 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 14 May 2012 11:47:17 +0100
Subject: [rabbitmq-discuss] Request Handshake Timeout Increase
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D70807D79710@MX36A.corp.emc.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D70807D7907A@MX36A.corp.emc.com>
	<4FA960FF.6060106@rabbitmq.com>
	<FC3463BECF39B74996BF6ADDCB9BE7D70807D79710@MX36A.corp.emc.com>
Message-ID: <4FB0E2B5.3070501@rabbitmq.com>

James,

On 10/05/12 19:53, james.poole at rsa.com wrote:
> Yeah, the simple fix would be to just add our root CA to the Windows Trust
> Store as a "trusted CA".  However, this is not what we want to do, since this
> would be a security risk.  We don't want the entire machine to trust our CA,
> but we want only our product (rabbit client) to trust the CA.  (This is going
> to be in customer environments who are sensitive to security... not an
> internal deployment)
>
> When the internet is available on the machine, the .NET client fails to find
> the CA, but then our registered certificate validation callback is run, and we
> can manually inspect the certificate, validate it is "our" certificate, and
> let the SSL handshake proceed.
>
> If the internet is not available, the 15 second delay causes the handshake to
> time out and close the SSL connection before we get a chance to handle the
> certificate validation.

So there is no way to preempt the cert retrieval, other than altering 
the machine-wide policy? That seems like a major omission in the .net 
SSL API. Having every connection take 15+ seconds to get established may 
be ok in your particular app but could be a showstopper in many other cases.

> To get around this, we would just need the timeout (pointed out by Emile -
> http://hg.rabbitmq.com/rabbitmq-server/file/e852cd4060d3/src/rabbit_reader.erl#l30)
> to be relaxed to 20 seconds.  This would give the client enough time to wait
> for the Windows 15 second delay, verify the certificate, and allow the SSL
> connection to be established.

As Emile mentioned, there are actually two timeouts:

1) ssl upgrade. This covers the upgrading of the tcp connection to ssl 
and should include all ssl handshaking. It's set to 5 seconds.

2) AMQP connection establishment. This covers the entire AMQP connection 
establishment handshake. It is set to 10 seconds and starts *after* the 
ssl upgrade has been completed.


 From the description of the problem I would expect you to encounter the 
*first* timeout, which result in a "error on AMQP connection ...: 
<Reason>" message in the logs. However, you said you are seeing a 
handshake_timeout error, which is raised by the *second* timeout. That 
is weird. Are you sure that is the error you saw?


Regards,

Matthias.

From majek04 at gmail.com  Mon May 14 11:47:22 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 14 May 2012 11:47:22 +0100
Subject: [rabbitmq-discuss] Stomp Javascript Client
In-Reply-To: <1336677429.23250.YahooMailNeo@web44902.mail.sp1.yahoo.com>
References: <1336512880.71218.YahooMailNeo@web44914.mail.sp1.yahoo.com>
	<CABzX+qxLCtZCN9cKyWyzzGz0++r6vbSFEEGe5BeJ9svz5KCHMA@mail.gmail.com>
	<1336613013.93726.YahooMailNeo@web44914.mail.sp1.yahoo.com>
	<CABzX+qx2X46ZKwRW8nXKCV=noaYenn_xv-BzfgHh2BeiKfopcA@mail.gmail.com>
	<1336677429.23250.YahooMailNeo@web44902.mail.sp1.yahoo.com>
Message-ID: <CABzX+qyP8AS87PDx-NMuxx1En+jSPO-6GST_i4XBmsmPUj6MOA@mail.gmail.com>

On Thu, May 10, 2012 at 8:17 PM, Uday Subbarayan
<uday.subbarayan at yahoo.com> wrote:
> Thanks. This is very good and helps to expose Rabbit MQ directly over the
> web to browser. Look fwd to try this feature. You can also use us for beta.
>
> When are you integrating this plug-in and releasing it? We are on RHEL 6.2.

RabbitMQ-Web-Stomp got released today:
    http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/020006.html

Cheers,
    Marek

From simon at rabbitmq.com  Mon May 14 12:11:20 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 May 2012 12:11:20 +0100
Subject: [rabbitmq-discuss] RabbitMQ termination error question
In-Reply-To: <BCC407A444557E41B0D8B0260D68499204E0EAF0@CA1EXCLV07.adcorp.kla-tencor.com>
References: <CADmaSA9uQ_WudVzOCJ1PSW0X0sS5r7RXyMVB1YSUQUMK3_6kCQ@mail.gmail.com>
	<BCC407A444557E41B0D8B0260D68499204E0EAF0@CA1EXCLV07.adcorp.kla-tencor.com>
Message-ID: <4FB0E858.609@rabbitmq.com>

On 12/05/12 01:45, Chen, Bin wrote:
> We recently encountered some fatal errors on two RabbitMQ servers.
>
> Can someone provide some clue on the following error report in RabbitMQ log?

What do you mean by fatal error? Did this cause any problems? I would 
hope at least that if rabbit_mgmt_db crashed like this then the 
supervsior should just restart it, and on recent RabbitMQ versions it 
should catch up automatically and you shouldn't notice anything. I 
assume this was not what happened? Which version are you running?

> ** {badarith,[{rabbit_mgmt_db,rate,5},

Also: that's odd. That code hasn't changed in absolutely ages, and it's 
pretty battle-hardened. Any ideas how you provoked this? :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Mon May 14 12:59:44 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 14 May 2012 15:59:44 +0400
Subject: [rabbitmq-discuss] Introducing RabbitMQ-Web-STOMP plugin!
In-Reply-To: <CABzX+qyf=pKtpRyZMcOjt72gDnuDJ9TBigX3qSrPqvwCOrRdyw@mail.gmail.com>
References: <CABzX+qyf=pKtpRyZMcOjt72gDnuDJ9TBigX3qSrPqvwCOrRdyw@mail.gmail.com>
Message-ID: <CAE3HoVQNVThPvLigMTO0qO7w=Y2r4owa3av98iuf=9X52TNGvw@mail.gmail.com>

2012/5/14 Marek Majkowski <majek04 at gmail.com>

> Introductory blog post:
>    http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/
>

Marek,

I don't know how "baked" this plugin (and SocksJS/STOMP bridging approach
in general) is but it would be much easier to try it out if there was a
RabbitMQ 2.8.3 release
that is 2.8.2 + this plugin bundled.
-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120514/d5d878df/attachment.htm>

From simon at rabbitmq.com  Mon May 14 13:04:22 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 May 2012 13:04:22 +0100
Subject: [rabbitmq-discuss] Introducing RabbitMQ-Web-STOMP plugin!
In-Reply-To: <CAE3HoVQNVThPvLigMTO0qO7w=Y2r4owa3av98iuf=9X52TNGvw@mail.gmail.com>
References: <CABzX+qyf=pKtpRyZMcOjt72gDnuDJ9TBigX3qSrPqvwCOrRdyw@mail.gmail.com>
	<CAE3HoVQNVThPvLigMTO0qO7w=Y2r4owa3av98iuf=9X52TNGvw@mail.gmail.com>
Message-ID: <4FB0F4C6.1050904@rabbitmq.com>

On 14/05/12 12:59, Michael Klishin wrote:
> I don't know how "baked" this plugin (and SocksJS/STOMP bridging
> approach in general) is but it would be much easier to try it out if
> there was a RabbitMQ 2.8.3 release
> that is 2.8.2 + this plugin bundled.

Hi Michael. I would describe it as experimental at the moment, but we're 
planning on including it in future releases.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From sameek at arosys.com  Mon May 14 17:16:44 2012
From: sameek at arosys.com (sameekmishra)
Date: Mon, 14 May 2012 09:16:44 -0700 (PDT)
Subject: [rabbitmq-discuss] getting error Mnesia could not connect to some
 nodes ?
Message-ID: <33831639.post@talk.nabble.com>


Hi 

I am using Debian operating system with two node.i have read the document
http://www.rabbitmq.com/clustering.html, document say that
/var/lib/rabbitmq/.erlang.cookie cookies are created,but on system i can see
any cookies to be made by rabbitmq server. when i issue following command i
am getting following error message:

root at server03:/home/arosys03# rabbitmqctl cluster rabbit at server04
Clustering node rabbit at server03 with [rabbit at server04] ...
Error: {failed_to_cluster_with,[rabbit at server04],
                               "Mnesia could not connect to some nodes

please clear who creates a cookie file and what will be the reason behind
this error?

Thanks
-- 
View this message in context: http://old.nabble.com/getting-error-Mnesia-could-not-connect-to-some-nodes---tp33831639p33831639.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From timya15 at gmail.com  Mon May 14 17:19:58 2012
From: timya15 at gmail.com (Timya Tortus)
Date: Mon, 14 May 2012 21:49:58 +0530
Subject: [rabbitmq-discuss] Federation Fanout
Message-ID: <CAJ1FMH66buJ16UgG0o-9vMgF2j=LX0Dh1C4zx4pAM2pK533TZw@mail.gmail.com>

Hi All,

Having 3 rabbitmq servers installed on one machine.
The configuration below, also attached are the config files.
1) node name: hare
host: localhost
tcp listener: 5672
mgmt listener: 55670
web console: 55672
config file: hare.config

2) node name: rabbit1
host: localhost
tcp listener: 5673
mgmt listener: 55673
web console: 55674
config file: rabbit1.config

3) node name: rabbit2
host: localhost
tcp listener: 5674
mgmt listener: 55675
web console: 55676
config file: rabbit2.config

 ------------------------------------------------
 | localhost (127.0.0.1)                        |
 |                           +--+ +--+          |
 |                 M1        |  | |  |      M1  |
 |               -------->   |  +-+  +--+   M3  |
 |                 M2        | rabbit1  |   M5  |
 |               -------->   |          |   M7  |
 |  +--+ +--+      M3        +----------+       |
 |  |  | |  |    -------->                      |
 |  |  +-+  +--+   M4                           |
 |  |  hare    | -------->                      |
 |  |          |   M5                           |
 |  +----------+ -------->    +--+ +--+         |
 |                 M6         |  | |  |     M2  |
 |               -------->    |  +-+  +--+  M4  |
 |                 M7         | rabbit2  |  M6  |
 |               -------->    |          |      |
 |                            +----------+      |
 ------------------------------------------------

Downstream messages are sent as M1, M2..... M7.
The messages received on the federated clients are as
rabbit1 receiving M1, M3, M5, M7
rabbit2 receiving M2, M4, M6

Why are all the messages not being received by both rabbit1 and rabbit2.

This also happens for the case below:
1) node name: hare
host: 204.11.52.128

2) node name: rabbit1
host: 192.168.1.1 (NAT: 204.8.156.142)

3) node name: rabbit2
host: 192.168.1.2 (NAT: 204.8.156.142)

i.e hare is a hosted rabbitmq server. While rabbit1 and rabbit2 are in a
local environment accessing hare.

Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120514/47073f56/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: hare.config
Type: application/octet-stream
Size: 166 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120514/47073f56/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit1.config
Type: application/octet-stream
Size: 1049 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120514/47073f56/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit2.config
Type: application/octet-stream
Size: 1051 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120514/47073f56/attachment-0002.obj>

From james.mcmahon at TASC.COM  Mon May 14 17:59:28 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Mon, 14 May 2012 16:59:28 +0000
Subject: [rabbitmq-discuss] What is ticket object,
	and how does it get created?
Message-ID: <C974010E949511448F6DC6F748F604D90FEE6D78@TSEAMB01>


The following sample code refers to an object "ticket", but I have not been able to find any examples of how ticket gets created, or what it represents. I found in the AMQP docs that it is an integer, but that is all. Can anyone provide me with an example of how to create ticket, and what it represents?

boolean autoAck = false;
channel.basicConsume(ticket, queueName, autoAck,
     new DefaultConsumer(channel) {
         @Override
         public void handleDelivery(String consumerTag,
                                    Envelope envelope,
                                    AMQP.BasicProperties properties,
                                    byte[] body)
             throws IOException
         {
             String routingKey = envelope.getRoutingKey();
             String contentType = properties.contentType;
             long deliveryTag = envelope.getDeliveryTag();
             //
             // my custom handling stuff here
             //
             channel.basicAck(deliveryTag, false);
         }
     });

Thanks very much for any help or reference to any further examples.

Jim Mc.

CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120514/c1ce28ad/attachment.htm>

From travis at fantasymoguls.com  Mon May 14 18:42:30 2012
From: travis at fantasymoguls.com (Travis)
Date: Mon, 14 May 2012 17:42:30 +0000 (UTC)
Subject: [rabbitmq-discuss] Problems with RabbitMQ & EC2 64-bit instance
References: <loom.20120512T015224-908@post.gmane.org>
	<4FAE2621.7030904@rabbitmq.com>
Message-ID: <loom.20120514T193855-705@post.gmane.org>

Emile Joubert <emile at ...> writes:

> 
> You will need to lower the free space limit on machines with more RAM
> than free disk space. For more details see
> 
> http://www.rabbitmq.com/memory.html#diskfreesup
> 

That was exactly the problem.  Thank you so much for the fix.  Pretty sure I
would've wasted quite a bit of time trying (and failing) to find that!



From nkodner at gmail.com  Mon May 14 19:32:36 2012
From: nkodner at gmail.com (Neil Kodner)
Date: Mon, 14 May 2012 14:32:36 -0400
Subject: [rabbitmq-discuss] strategies for guaranteeing order?
Message-ID: <CAOnzzivwtUFTA-wRrzq1nTqnmHWEAutRDGzP6veKaaHPR-csDg@mail.gmail.com>

I'm using RabbitMQ 2.6.1 and Pika .95 with a single producer process and a
single consumer process.

I have a business requirement to process messages in the exact order that
they were received. Fortunately, this is very low volume - maybe 1 message
every 10 or 15 minutes.

If consumer-side processing fails for any reason on the consumer end, I
need to resolve the issue and not consume any subsequent messages from the
queue until the original problem is fixed.

I'm noticing that if I don't acknowledge a message, that it goes back into
the queue but it seems to lose its place in line.

In case consumer-side processing fails, I could reject the message but then
when I get a new message from the queue, instead of re-retrieving the
failed message, I get the next one created.

In the real-world, I don't expect to have too many messages in my queue
unless it gets backed up due to failures.

I'm sure that I'm not the first person with this requirement-how do others
handle it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120514/31408114/attachment.htm>

From nkodner at gmail.com  Mon May 14 19:42:12 2012
From: nkodner at gmail.com (Neil Kodner)
Date: Mon, 14 May 2012 14:42:12 -0400
Subject: [rabbitmq-discuss] Guaranteeing order of messages consumed from
	queue
Message-ID: <CAOnzzisqQUSxh9pSFtwesJcERK8xdJJAVujmQc1WdzYiU+PV7A@mail.gmail.com>

I'm using RabbitMQ 2.6.1 and Pika .95 with a single producer process and a
single consumer process.

I have a business requirement to process messages in the exact order that
they were received. Fortunately, this is very low volume - maybe 1 message
every 10 or 15 minutes.

If consumer-side processing fails for any reason on the consumer end, I
need to resolve the issue and not consume any subsequent messages from the
queue until the original problem is fixed.

I'm noticing that if I don't acknowledge a message, that it goes back into
the queue but it seems to lose its place in line.

In case consumer-side processing fails, I could reject the message but then
when I get a new message from the queue, instead of re-retrieving the
failed message, I get the next one created.

In the real-world, I don't expect to have too many messages in my queue
unless it gets backed up due to failures.

I'm sure that I'm not the first person with this requirement-how do others
handle it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120514/e753eda0/attachment.htm>

From pgross at gmail.com  Mon May 14 19:48:57 2012
From: pgross at gmail.com (Paul Gross)
Date: Mon, 14 May 2012 13:48:57 -0500
Subject: [rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
In-Reply-To: <4FABE7B9.5010509@rabbitmq.com>
References: <4FABE167.9080900@gmail.com> <4FABE7B9.5010509@rabbitmq.com>
Message-ID: <4FB15399.9090504@gmail.com>


> There have been numerous stability improvements since 2.7.1, so I 
> suggest you upgrade to the latest rabbit version (2.8.2). Also, R13B03 
> is quite ancient, so you should really upgrade that too - R15B01 is 
> the latest.
>
> If you still see the same behaviour then try to set up some alarms 
> that catch the problem in the early stages and grab the output of 
> 'rabbitmqctl report'.
>
We are working on upgrading our rabbitmq and erlang. In the mean time, 
here is the output of 'rabbitmqctl report' on a MacPro right after 
rabbitmq went crazy before we had to kill it. Is there something unusual 
in these numbers?

[{pid,70356},
  {running_applications,[{rabbit,"RabbitMQ","2.7.1"},
                         {mnesia,"MNESIA  CXC 138 12","4.6"},
                         {os_mon,"CPO  CXC 138 46","2.2.8"},
                         {sasl,"SASL  CXC 138 11","2.2"},
                         {stdlib,"ERTS  CXC 138 10","1.18"},
                         {kernel,"ERTS  CXC 138 10","2.15"}]},
  {os,{unix,darwin}},
  {erlang_version,"Erlang R15B (erts-5.9) [source] [64-bit] [smp:16:16] [async-threads:30] [hipe] [kernel-poll:true]\n"},
  {memory,[{total,90264888},
           {processes,65595873},
           {processes_used,65591050},
           {system,24669015},
           {atom,504409},
           {atom_used,475985},
           {binary,6765008},
           {code,11916223},
           {ets,1291168}]},
  {vm_memory_high_watermark,0.3999999999026046},
  {vm_memory_limit,3285576908}]

Cluster status of node rabbit at yoshi ...
[{nodes,[{disc,[rabbit at yoshi]}]},{running_nodes,[rabbit at yoshi]}]

Application environment of node rabbit at yoshi ...
[{auth_backends,[rabbit_auth_backend_internal]},
  {auth_mechanisms,['PLAIN','AMQPLAIN']},
  {backing_queue_module,rabbit_variable_queue},
  {cluster_nodes,[]},
  {collect_statistics,none},
  {collect_statistics_interval,5000},
  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
  {default_user,<<"guest">>},
  {default_user_tags,[administrator]},
  {default_vhost,<<"/">>},
  {delegate_count,16},
  {error_logger,{file,"/usr/local/var/log/rabbitmq/rabbit at yoshi.log"}},
  {frame_max,131072},
  {hipe_compile,false},
  {included_applications,[]},
  {msg_store_file_size_limit,16777216},
  {msg_store_index_module,rabbit_msg_store_ets_index},
  {queue_index_max_journal_entries,262144},
  {sasl_error_logger,{file,"/usr/local/var/log/rabbitmq/rabbit at yoshi-sasl.log"}},
  {server_properties,[]},
  {ssl_listeners,[]},
  {ssl_options,[]},
  {tcp_listen_options,[binary,
                       {packet,raw},
                       {reuseaddr,true},
                       {backlog,128},
                       {nodelay,true},
                       {exit_on_close,false}]},
  {tcp_listeners,[5672]},
  {trace_vhosts,[]},
  {vm_memory_high_watermark,0.4}]

Connections:

Channels:

Queues on /:

Exchanges on /:
name	type	durable	auto_delete	internal	arguments
amq.direct	direct	true	false	false	[]
amq.topic	topic	true	false	false	[]
amq.rabbitmq.trace	topic	true	false	false	[]
amq.rabbitmq.log	topic	true	false	false	[]
amq.fanout	fanout	true	false	false	[]
amq.headers	headers	true	false	false	[]
	direct	true	false	false	[]
amq.match	headers	true	false	false	[]

Bindings on /:

Consumers on /:

Permissions on /:
user	configure	write	read
guest	.*	.*	.*

End of server status report
...done.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120514/90e5ba9e/attachment.htm>

From emile at rabbitmq.com  Mon May 14 19:49:53 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 14 May 2012 19:49:53 +0100
Subject: [rabbitmq-discuss] Guaranteeing order of messages consumed from
 queue
In-Reply-To: <CAOnzzisqQUSxh9pSFtwesJcERK8xdJJAVujmQc1WdzYiU+PV7A@mail.gmail.com>
References: <CAOnzzisqQUSxh9pSFtwesJcERK8xdJJAVujmQc1WdzYiU+PV7A@mail.gmail.com>
Message-ID: <4FB153D1.30607@rabbitmq.com>

Hi Neil,

On 14/05/12 19:42, Neil Kodner wrote:
> I'm using RabbitMQ 2.6.1 

> I'm noticing that if I don't acknowledge a message, that it goes back
> into the queue but it seems to lose its place in line. 

You should upgrade to at least v2.7.0 (but preferably the latest
version). Order of requeued messages was changed in v2.7.0 - they now
keep their place in the queue. For more details see
http://www.rabbitmq.com/semantics.html#ordering

-Emile



From michael.justin at gmx.net  Mon May 14 20:16:44 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Mon, 14 May 2012 21:16:44 +0200
Subject: [rabbitmq-discuss] ANN: Habari Client for RabbitMQ 1.2 - for Delphi
	and Free Pascal
Message-ID: <jorlmv$naj$1@dough.gmane.org>

May 8, 2012 - Habarisoft released version 1.3 of Habari Client for 
RabbitMQ, a library which provides easy access from Delphi and Free 
Pascal to RabbitMQ.

New in this version:

* Tested with RabbitMQ 2.8.2
* Client-Individual message acknowlegde
* Persistent message fix
* ReceiveNoWait improvement
* Extended RTTI suppression
* Improved Throughput test utility

Home page:
http://www.habarisoft.com/habari_rabbitmq.html

Getting Started Guide (PDF):
http://www.habarisoft.com/download/HabariRabbitMQGettingStarted.pdf

Regards
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/


From simon at rabbitmq.com  Mon May 14 20:37:17 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 May 2012 20:37:17 +0100
Subject: [rabbitmq-discuss] What is ticket object,
 and how does it get created?
In-Reply-To: <C974010E949511448F6DC6F748F604D90FEE6D78@TSEAMB01>
References: <C974010E949511448F6DC6F748F604D90FEE6D78@TSEAMB01>
Message-ID: <4FB15EED.8020105@rabbitmq.com>

On 14/05/2012 5:59PM, McMahon, James S (TASC) wrote:
> The following sample code refers to an object "ticket", but I have not
> been able to find any examples of how ticket gets created, or what it
> represents. I found in the AMQP docs that it is an integer, but that is
> all. Can anyone provide me with an example of how to create ticket, and
> what it represents?

I assume that must be very old sample code? AMQP 0-8 originally 
introduced the idea of a ticket as a token generated by the server 
representing a cached set of permissions after you had logged in. Or 
something, it was a rather dubious idea.

It was deprecated in 0-9-1 and RabbitMQ >= 2.0.0 will ignore it even 
when talking AMQP 0-8. Your client API should have removed references to 
it by now, but if you are using an elderly client for some reason, just 
pass 0.

Cheers, Simon

From simon at rabbitmq.com  Mon May 14 20:45:19 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 May 2012 20:45:19 +0100
Subject: [rabbitmq-discuss] Federation Fanout
In-Reply-To: <CAJ1FMH66buJ16UgG0o-9vMgF2j=LX0Dh1C4zx4pAM2pK533TZw@mail.gmail.com>
References: <CAJ1FMH66buJ16UgG0o-9vMgF2j=LX0Dh1C4zx4pAM2pK533TZw@mail.gmail.com>
Message-ID: <4FB160CF.5090604@rabbitmq.com>

On 14/05/2012 5:19PM, Timya Tortus wrote:
> Why are all the messages not being received by both rabbit1 and rabbit2.

Hi Timya. You are setting a local_nodename of "localhost" on both 
rabbit1 and rabbit2 - this is causing them both to identify themselves 
as the same node to hare; they then end up sharing the same upstream 
queue and thus only getting one set of messages between them.

You should either set local_nodename to something distinct on each 
downstream, or don't set it at all, and Rabbit will construct something 
from the machine's FQDN.

Cheers, Simon

From fanchyna at gmail.com  Mon May 14 18:07:56 2012
From: fanchyna at gmail.com (fanchyna)
Date: Mon, 14 May 2012 10:07:56 -0700 (PDT)
Subject: [rabbitmq-discuss] "Hello World" not work for rabbitmq
Message-ID: <c8abd03e-b395-460e-a554-5f577f999d89@n16g2000vbn.googlegroups.com>

Hi, I am new to rabbitmq, but for some (unknown) reason, the "hello
world" program does not work for me.
The send.py and receive.py are simply copied and pasted from the
tutorial page:

http://www.rabbitmq.com/tutorials/tutorial-one-python.html

rabbitmq is installed using "yum" on a RHEL 6. Python version is 2.6.
I started the server using

$ service rabbitmq-server start

and it prints "SUCCESS".

There is no error or warning messages by running send.py and
receive.py:

$ python send.py
 [x] Sent 'Hello World!'

$ python receive.py
 [*] Waiting for messages. To exit press CTRL+C

Then it never prints "Hello World!".

What's wrong with it?

From matthias at rabbitmq.com  Mon May 14 22:06:21 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 14 May 2012 22:06:21 +0100
Subject: [rabbitmq-discuss] Problems with RabbitMQ & EC2 64-bit instance
In-Reply-To: <loom.20120514T193855-705@post.gmane.org>
References: <loom.20120512T015224-908@post.gmane.org>	<4FAE2621.7030904@rabbitmq.com>
	<loom.20120514T193855-705@post.gmane.org>
Message-ID: <4FB173CD.7000705@rabbitmq.com>

On 14/05/12 18:42, Travis wrote:
> Emile Joubert<emile at ...>  writes:
>> You will need to lower the free space limit on machines with more RAM
>> than free disk space. For more details see
>>
>> http://www.rabbitmq.com/memory.html#diskfreesup
>
> That was exactly the problem.  Thank you so much for the fix.  Pretty sure I
> would've wasted quite a bit of time trying (and failing) to find that!

The rabbit log ought to contain a fairly obvious alarm message, so 
looking at the logs probably would have given you enough clues.

Matthias.

From Bin.Chen at kla-tencor.com  Tue May 15 00:11:44 2012
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Mon, 14 May 2012 16:11:44 -0700
Subject: [rabbitmq-discuss] RabbitMQ termination error question
In-Reply-To: <4FB0E858.609@rabbitmq.com>
References: <CADmaSA9uQ_WudVzOCJ1PSW0X0sS5r7RXyMVB1YSUQUMK3_6kCQ@mail.gmail.com>
	<BCC407A444557E41B0D8B0260D68499204E0EAF0@CA1EXCLV07.adcorp.kla-tencor.com>
	<4FB0E858.609@rabbitmq.com>
Message-ID: <BCC407A444557E41B0D8B0260D68499204E0ED79@CA1EXCLV07.adcorp.kla-tencor.com>

I am using version 2.7.1.

The error didn't cause the server crash immediately. The server crashed
about 3 hours later, instead.
Two servers had the same issues.

Could this be a memory related problem? The memory high watermark is set
to 819.2 MB by default.
Is it safe to raise it to 1819.2 MB?  I am running RabbitMQ on 64-bit
windows 2008 server.

Thanks,
--Bin

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Monday, May 14, 2012 4:11 AM
To: Chen, Bin
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ termination error question

On 12/05/12 01:45, Chen, Bin wrote:
> We recently encountered some fatal errors on two RabbitMQ servers.
>
> Can someone provide some clue on the following error report in
RabbitMQ log?

What do you mean by fatal error? Did this cause any problems? I would
hope at least that if rabbit_mgmt_db crashed like this then the
supervsior should just restart it, and on recent RabbitMQ versions it
should catch up automatically and you shouldn't notice anything. I
assume this was not what happened? Which version are you running?

> ** {badarith,[{rabbit_mgmt_db,rate,5},

Also: that's odd. That code hasn't changed in absolutely ages, and it's
pretty battle-hardened. Any ideas how you provoked this? :-)

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware

From matt.black at jbadigital.com  Tue May 15 00:44:39 2012
From: matt.black at jbadigital.com (Matt Black)
Date: Tue, 15 May 2012 09:44:39 +1000
Subject: [rabbitmq-discuss] RabbitMQ with djcelery and rabbitmqctl
	list_queues
Message-ID: <CAHPGP1Fw9X7YUzSJx86e9diXXSpRMj_5BmvRw-iPgcwBaJh-FA@mail.gmail.com>

Hello,

My application is currently receiving a lot of traffic, and generating a
lot of celery processes. I can see these in my application logs as events
are occurring.

When I run *rabbitmqctl list_queues* I would expect this to show a number
other than zero - but this not the case. I've now stopped any incoming
connections to the rabbit server and still the application log is busy with
celery tasks.

Can someone suggest why rabbitmqctl lists nothing in the queue? What
alternate approaches do I have for monitoring the task load on this server?

> sudo rabbitmqctl list_queues name messages_ready messages_unacknowledged
messages consumersListing queues ...
celery  0       0       0       0
...done.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120515/a1550f98/attachment.htm>

From iceblaze at gmail.com  Tue May 15 05:28:08 2012
From: iceblaze at gmail.com (iceblaze)
Date: Mon, 14 May 2012 21:28:08 -0700
Subject: [rabbitmq-discuss] Unable to cluster..
In-Reply-To: <CA+-WFvyNd790RpPqGH10-Hsa+AbHrPJ+Qb_dEhotuwa0OOxVnQ@mail.gmail.com>
References: <CA+-WFvzuKiZWMFUe85rwLwq_8qOExRPvjQvdmfXTRj6ZfR3bGQ@mail.gmail.com>
	<CA+-WFvyNbzwPnp_fwmphQy2GmgJNG1zAdfc8uVDwKjzRZR0qWw@mail.gmail.com>
	<4FB0CAD3.1000407@rabbitmq.com>
	<CA+-WFvysaXMpHBY=8jREboikrS1Opxqfs2cNriF9EFfTqgOAmA@mail.gmail.com>
	<CA+-WFvyNd790RpPqGH10-Hsa+AbHrPJ+Qb_dEhotuwa0OOxVnQ@mail.gmail.com>
Message-ID: <CA+-WFvwqtmJp7bAN8wg2CDuSedmWgAk-_BXp3k=_PQGaE=uQ-Q@mail.gmail.com>

Hello Emilie et all,

OK, so I am now getting a different, cryptic error when trying to cluster:

[root at rabbit-test2 ~]# rabbitmqctl cluster rabbit at rabbit-test1
Clustering node 'rabbit at rabbit-test2' with ['rabbit at rabbit-test1'] ...
Error: {unable_to_join_cluster,
           ['rabbit at rabbit-test1'],
           {aborted,
               {function_clause,
                   [{mnesia_schema,cs2list,
                        [{cstruct,schema,set,[],
                             ['rabbit at rabbit-test1'],
                             [],0,read_write,false,[],[],false,schema,
                             [table,cstruct],
                             [],[],
                             {{1336,612893,960781},'rabbit at rabbit-test1'},
                             {{6,0},
                              {'rabbit at rabbit-test1
',{1337,33903,595724}}}}]},
                    {mnesia_schema,do_merge_schema,0},
                    {mnesia_tm,apply_fun,3},
                    {mnesia_tm,execute_transaction,5},
                    {mnesia_schema,schema_coordinator,3}]}}}


And status now passes correctly as well:

[root at rabbit-test2 ~]# !90
rabbitmqctl -n rabbit at rabbit-test1 status
Status of node 'rabbit at rabbit-test1' ...
[{pid,3680},
 {running_applications,[{rabbit,"RabbitMQ","2.8.2"},
                        {os_mon,"CPO  CXC 138 46","2.2.6"},
                        {sasl,"SASL  CXC 138 11","2.1.9.4"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.19"},
                        {stdlib,"ERTS  CXC 138 10","1.17.4"},
                        {kernel,"ERTS  CXC 138 10","2.14.4"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:8:8]
[rq:8] [async-threads:30] [kernel-poll:true]\n"},
 {memory,[{total,25802032},
          {processes,10259256},
          {processes_used,10245896},
          {system,15542776},
          {atom,1136673},
          {atom_used,1134812},
          {binary,82912},
          {code,11341457},
          {ets,783296}]},
 {vm_memory_high_watermark,0.3999999999359184},
 {vm_memory_limit,2496816742},
 {disk_free_limit,6242041856},
 {disk_free,449332170752},
 {file_descriptors,[{total_limit,924},
                    {total_used,3},
                    {sockets_limit,829},
                    {sockets_used,1}]},
 {processes,[{limit,1048576},{used,125}]},
 {run_queue,0},
 {uptime,3743}]
...done.

Thanks,

-James

On Mon, May 14, 2012 at 2:17 AM, iceblaze <iceblaze at gmail.com> wrote:

> Hello Emile,
>
> Ha! I see that I actually did a status against itself (rabbit-test2), and
> not rabbit at rabbit-test1. I will retry and report if I'm still having the
> issue.
>
> -James
>
>
> On Mon, May 14, 2012 at 2:08 AM, iceblaze <iceblaze at gmail.com> wrote:
>
>> Hello Emile,
>>
>> Yes, I did provide a status in my previous email, which suggests it's
>> reachable and not a firewall issue.
>>
>> Cheers,
>>
>> -James
>>
>>
>> On Mon, May 14, 2012 at 2:05 AM, Emile Joubert <emile at rabbitmq.com>wrote:
>>
>>> Hi,
>>>
>>> On 14/05/12 02:36, iceblaze wrote:
>>> > I seem to be having an issue clustering and I don't know why. I
>>> > followed the clustering guide to the T, and my node is reachable.
>>>
>>> The most common cause of these symptoms is a firewall. Have you taken a
>>> look at http://www.rabbitmq.com/clustering.html#firewall and confirmed
>>> that the nodes are reachable in the way required for clustering?
>>>
>>> Also check that you are able to obtain the broker status from each the
>>> prospective clustering partner node:
>>> [root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test1 status
>>>
>>>
>>> -Emile
>>>
>>>
>>>
>>
>>
>> --
>> "Of course, the actual government of any computer is run by that fascist
>> dictator known as the operating system. But a wise dictator knows when to
>> let the people think they're capitalists--and when to let them think
>> they're communists." - Programming Perl third edition
>>
>
>
>
> --
> "Of course, the actual government of any computer is run by that fascist
> dictator known as the operating system. But a wise dictator knows when to
> let the people think they're capitalists--and when to let them think
> they're communists." - Programming Perl third edition
>



-- 
"Of course, the actual government of any computer is run by that fascist
dictator known as the operating system. But a wise dictator knows when to
let the people think they're capitalists--and when to let them think
they're communists." - Programming Perl third edition
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120514/b970f642/attachment.htm>

From Saravana.Prabhu at emc.com  Tue May 15 06:42:49 2012
From: Saravana.Prabhu at emc.com (Saravana.Prabhu at emc.com)
Date: Tue, 15 May 2012 01:42:49 -0400
Subject: [rabbitmq-discuss] RabbitMQ Management only via HTTP API
Message-ID: <978435FA08D0814BAD1CBA3899FE9FB40468625211@MX26A.corp.emc.com>

I would like to know if there is a way to disable the Management of RabbitMQ via Web UI and have only the API level of Management.

If the Management plug-in is disabled, then both the WebUI and API Management will be disabled.

My requirement is to manage and monitor RabbitMQ only via HTTP API's.

Thanks,
Prabhu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120515/e8c0a2ee/attachment.htm>

From simon at rabbitmq.com  Tue May 15 10:28:14 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 15 May 2012 10:28:14 +0100
Subject: [rabbitmq-discuss] RabbitMQ Management only via HTTP API
In-Reply-To: <978435FA08D0814BAD1CBA3899FE9FB40468625211@MX26A.corp.emc.com>
References: <978435FA08D0814BAD1CBA3899FE9FB40468625211@MX26A.corp.emc.com>
Message-ID: <4FB221AE.9020206@rabbitmq.com>

On 15/05/12 06:42, Saravana.Prabhu at emc.com wrote:
> I would like to know if there is a way to disable the Management of
> RabbitMQ via Web UI and have only the API level of Management.

No.

> If the Management plug-in is disabled, then both the WebUI and API
> Management will be disabled.
>
> My requirement is to manage and monitor RabbitMQ only via HTTP API's.

But what would that mean? The web UI is *just* a set of static resources 
that depend on the HTTP API to do their work. If there were a way to 
prevent the web UI resources from being served, there would be nothing 
to stop anyone from just loading them up from somewhere else.

What are you really trying to do here?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue May 15 11:06:02 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 15 May 2012 11:06:02 +0100
Subject: [rabbitmq-discuss] Unable to cluster..
In-Reply-To: <CA+-WFvwqtmJp7bAN8wg2CDuSedmWgAk-_BXp3k=_PQGaE=uQ-Q@mail.gmail.com>
References: <CA+-WFvzuKiZWMFUe85rwLwq_8qOExRPvjQvdmfXTRj6ZfR3bGQ@mail.gmail.com>
	<CA+-WFvyNbzwPnp_fwmphQy2GmgJNG1zAdfc8uVDwKjzRZR0qWw@mail.gmail.com>
	<4FB0CAD3.1000407@rabbitmq.com>
	<CA+-WFvysaXMpHBY=8jREboikrS1Opxqfs2cNriF9EFfTqgOAmA@mail.gmail.com>
	<CA+-WFvyNd790RpPqGH10-Hsa+AbHrPJ+Qb_dEhotuwa0OOxVnQ@mail.gmail.com>
	<CA+-WFvwqtmJp7bAN8wg2CDuSedmWgAk-_BXp3k=_PQGaE=uQ-Q@mail.gmail.com>
Message-ID: <4FB22A8A.2060601@rabbitmq.com>

Hi,

On 15/05/12 05:28, iceblaze wrote:

> OK, so I am now getting a different, cryptic error when trying to cluster:

You should not get that message if you follow the transcript in the
documentation. Did you perform the "reset" step? Otherwise please
provide a transcript of your steps that reproduce the problem.


-Emile


From jframe at gmail.com  Mon May 14 22:56:10 2012
From: jframe at gmail.com (Jason Frame)
Date: Mon, 14 May 2012 14:56:10 -0700 (PDT)
Subject: [rabbitmq-discuss] Transfering file from machine to machine using
	RabbitMQ
Message-ID: <25061768.2088.1337032570321.JavaMail.geo-discussion-forums@ynev2>

I am still new and getting used to RabbitMQ, and was wondering the best way 
to send a small file along with a message. We are looking at using this to 
send a message on a server using PHP and consuming using a .net client. 

Our typical message with have an associative array serialized to json, but 
for some of the messages, there will need to be an image or pdf file 
attached.  These files are relatively small (less than 20k) so they should 
not need to be chunked. I have been reading through the messages, and have 
not found any type of example or best practice on how to do this.

thanks
jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120514/c4e14e8f/attachment.htm>

From cybersayo at gmail.com  Tue May 15 08:49:25 2012
From: cybersayo at gmail.com (alkos)
Date: Tue, 15 May 2012 00:49:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Behind NAT issue with pika client :: keep alive
 :: heartbeat - How to detect dead connection
Message-ID: <44e62cab-d05a-4c6b-8d6c-499d19eceded@e20g2000vbm.googlegroups.com>

Hello,

I'm having pika client that act as consumer/producer in same time, rpc
scenario. As a consumer it waits for command from rabbitmq and when it
rcv's client execute function and returns result to rabbgitmq.
In lab conditions (permanent IP address without any firewall in
between client and rabbitmq server) there was no problem, at least not
in 3-4 days.
When we put client behind NAT, consumer stop rcv after few hours.
Problem, ofcourse was change end-to-end path of tcp connection. DHCP
would give different IP address to WAN interface of ADSL, or even to
PC with pika client. Previously established connection is still there
with ESTABLISHED status (netstat -t shows it) - even of rabbitmq
server I can still see that socket connection with ESTABLISHED
status.

I've tryed to put in rabbitmq.config keep alive option but with now
success at all.

Since I'm using RPC scenario, I'm using BlockingConnection.
Also, I've tryed to put heartbeat=True, but then script keep closing
and opens connection - probably due to callback function.
Even with threading class that implement function that is called in
callback I have the same issue.

I can hardly beleive that I'm the only one person who have this kind
of problem, since I didnt find any simple solution to this problem.

So, basicly my question is how to detect from within script that there
is no end-to-end connection to rabbitmq even though socket exists?

Thaks,

Aleks

From kilian.devouassoux at gmail.com  Tue May 15 10:10:27 2012
From: kilian.devouassoux at gmail.com (misterdev)
Date: Tue, 15 May 2012 02:10:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Best practice for 1 server, several agents,
 several kind of messages
Message-ID: <25378740.1919.1337073027997.JavaMail.geo-discussion-forums@vbvq7>



Hello,

First of all, english is not my native language, so I may (will) make some 
mistakes. But I hope everybody will understand me.
I am new to this messaging thing so I am looking for any good advice you 
could give me.

I am going to present you a scenario, and I would really appreciate if you 
could help me, by giving me ideas to implement it. Specifically if there is 
common design pattern I should use :

I have a server application with autonomous agents.
Each agent is on a specific server, and the number of agent can quickly 
increase (today, I have about 100 agents, in a few months, I could have 
1000 if everything goes as planned).
In this scenario, the number of messages per second, for each agent, is 
quite limited : juste a few messages / second / agent.

The dialog between the server application and an agent contains different 
kind of messages that I began to represent with the "topic exchange" kind 
of thing :

// Messages received for a watchdog installed on the agent1 :
agent1.watchdog.critical 
agent1.watchdog.warning

// Messages containing commands that sould be executed my the agent
agent1.cmd.immediate
agent1.cmd.delay

// Messages organizing file transfer between two components of my 
architecture
agent1.fileTransfer.historyFile1.send
agent1.fileTransfer.historyFile1.loaded
agent1.fileTransfer.historyFile1.failure
agent1.fileTransfer.historyFile2.send
agent1.fileTransfer.historyFile2.loaded
agent1.fileTransfer.historyFile2.failure

With this pattern, I will have about 10 to 20 queues for each agent (20 to 
40 if I have a queue for agent to server dialog and another one for server 
to agent dialog).

My initial questions are :
- Will there be a problem with this number of queues in my architecture ? 
(100 agent --> more than 2000 queues) and what should be the size of my 
server hosting the broker ?
- Is there a pattern that could help me ?
- Is it better to use messages headers to identify each message, instead of 
topic exchange ?
- Is it better to differentiate server to agent queue and agent to server 
queue, or is it ok if both read and write in the same queue ?

Note : Because my history files, that have to be transfered between the 
agent and the server, can size several Mo, I don't intend to send them via 
amqp protocol (except if there is no significant performance decrease by 
doing that ?)

To be honest, I read this article :
http://blog.springsource.com/2011/04/01/routing-topologies-for-performance-and-scalability-with-rabbitmq/

And i decided to inspire myself from the "Exchange-to-Exchange Scalable Use 
Case". But I use the perl library Net::RabbitMQ, which does not implement 
exchange to exchange bindings, so I have to modifiy it a little :

So I came with this architecture (see Image below)

I explain a little :
- the server application don't know when an agent will be "awake" and will 
start to talk. So i was thinking of using some kind of authentication thing 
:
    - Each agent, at first start, will begin to talk in a guest exchange, 
declaring and authenticating itself.
    - When the server application authenticates the agent, it will 
automatically bind a new queue to the "client exchange authenticated". 
    - When the agent receive a confirmation of the authentication, it will 
bind about 10 queues to the "server to client authenticated exchange" (with 
the topic exchange described before)
    
Regarding this scenario, what advice could you give me ?

Thanks in advance for any information / advice.

Kilian

The architecture : 

<https://lh4.googleusercontent.com/-4fdI32Uo8cQ/T7IdEM_FehI/AAAAAAAAAHo/6l74h0meAEc/s1600/RabbitMQ+Implementation.jpg>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120515/e5441fa4/attachment.htm>

From majek04 at gmail.com  Tue May 15 11:17:01 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 15 May 2012 11:17:01 +0100
Subject: [rabbitmq-discuss] "Hello World" not work for rabbitmq
In-Reply-To: <c8abd03e-b395-460e-a554-5f577f999d89@n16g2000vbn.googlegroups.com>
References: <c8abd03e-b395-460e-a554-5f577f999d89@n16g2000vbn.googlegroups.com>
Message-ID: <CABzX+qwFa4z5JRQQvKo6D7KegE1Px7hW2LxzoH_1tgL3Ppd1qw@mail.gmail.com>

On Mon, May 14, 2012 at 6:07 PM, fanchyna <fanchyna at gmail.com> wrote:
> Hi, I am new to rabbitmq, but for some (unknown) reason, the "hello
> world" program does not work for me.
> The send.py and receive.py are simply copied and pasted from the
> tutorial page:
>
> http://www.rabbitmq.com/tutorials/tutorial-one-python.html
>
> rabbitmq is installed using "yum" on a RHEL 6. Python version is 2.6.
> I started the server using
>
> $ service rabbitmq-server start
>
> and it prints "SUCCESS".
>
> There is no error or warning messages by running send.py and
> receive.py:
>
> $ python send.py
> ?[x] Sent 'Hello World!'
>
> $ python receive.py
> ?[*] Waiting for messages. To exit press CTRL+C
>
> Then it never prints "Hello World!".
>
> What's wrong with it?

It should work - receive.py should give you a message.

You need to figure out what's wrong - are you running
this on the same machine?

Try looking at rabbitmq-management plugin to see
if the queue was created, or run:
 sudo rabbitmqctl list_queues

Marek

From simon at rabbitmq.com  Tue May 15 11:22:01 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 15 May 2012 11:22:01 +0100
Subject: [rabbitmq-discuss] Behind NAT issue with pika client :: keep
 alive :: heartbeat - How to detect dead connection
In-Reply-To: <44e62cab-d05a-4c6b-8d6c-499d19eceded@e20g2000vbm.googlegroups.com>
References: <44e62cab-d05a-4c6b-8d6c-499d19eceded@e20g2000vbm.googlegroups.com>
Message-ID: <4FB22E49.9070104@rabbitmq.com>

On 15/05/12 08:49, alkos wrote:
> Also, I've tryed to put heartbeat=True, but then script keep closing
> and opens connection - probably due to callback function.

I'm not familiar with Pika, but usually heartbeat should be a number of 
seconds, with 0 to disable, not a boolean. I suspect heartbeats are what 
you need.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From james.mcmahon at TASC.COM  Tue May 15 11:44:23 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Tue, 15 May 2012 10:44:23 +0000
Subject: [rabbitmq-discuss] What is ticket object,
 and how does it get created?
In-Reply-To: <4FB15EED.8020105@rabbitmq.com>
References: <C974010E949511448F6DC6F748F604D90FEE6D78@TSEAMB01>,
	<4FB15EED.8020105@rabbitmq.com>
Message-ID: <C974010E949511448F6DC6F748F604D90FEE6EB3@TSEAMB01>

     Yes, you had provided me this example three months or so ago, Simon. I've just now gotten back to this development effort. I suppose what was not deprecated then is deprecated now.

     Thank you again for your help!

Jim
CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.

From alan.antonuk at gmail.com  Tue May 15 14:48:16 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 15 May 2012 09:48:16 -0400
Subject: [rabbitmq-discuss] Fwd:  RabbitMQ Memory Leak
In-Reply-To: <CAAt2poJ3Ud2o8mhpvowoaGJ9a5izsVCo_3D7DZD3MjgtE=OFhA@mail.gmail.com>
References: <e2444e03-bfb2-4458-8726-bb67ecc5834c@s9g2000pbq.googlegroups.com>
	<CAAt2poJ3Ud2o8mhpvowoaGJ9a5izsVCo_3D7DZD3MjgtE=OFhA@mail.gmail.com>
Message-ID: <CAAt2po+xjDPVT0K=e-4TqmnG2dN7M+mYUEuLTKvYEh5O0u54Tg@mail.gmail.com>

That should've gone to the whole list:

---------- Forwarded message ----------
From: Alan Antonuk <alan.antonuk at gmail.com>
Date: Tue, May 15, 2012 at 9:43 AM
Subject: Re: [rabbitmq-discuss] RabbitMQ Memory Leak
To: Rakesh <rmadhwan at gmail.com>


After stewing about this a bit more, I suspect you're never calling
amqp_maybe_release_buffers(), which is what releases memory allocated when
receiving frames from the broker.  You should do this after you have used
the data in the amqp_frame_t's you get from amqp_simple_wait_frame().

amqp_destroy_connection() should also release all memory associated with a
amqp_connection_state_t object

If the above is not helpful, could you post the minimum code required to
reproduce the memory leaks you're seeing.

-Alan

On Fri, May 11, 2012 at 8:51 AM, Rakesh <rmadhwan at gmail.com> wrote:

> We are using RabbitMQ in our project and while running PurifyPlus on
> the application, I found memory leaks in librabbitmq.
> How do I submit the fixes for this?
>
>
> MLK: 47579136 bytes leaked in 363 blocks
>  * This memory was allocated from:
>        calloc         [rtlib.o]
>        amqp_pool_alloc [amqp_mem.c:140]
>        amqp_handle_input [amqp_connection.c:197]
>        wait_frame_inner [amqp_socket.c:168]
>        amqp_simple_rpc [amqp_socket.c:286]
>        amqp_simple_rpc_decoded [amqp_socket.c:353]
>        amqp_basic_qos [amqp_framing.c:2006]
>        CRabbitQueueReader::readMessage(int&) [RabbitQueueReader.cpp:204]
>  * Block of 131072 bytes (363 times); last block at 0x18269dc8
>
> MLK: 262144 bytes leaked in 2 blocks
>  * This memory was allocated from:
>        calloc         [rtlib.o]
>        amqp_pool_alloc [amqp_mem.c:140]
>        amqp_decode_method [amqp_framing.c:187]
>        amqp_handle_input [amqp_connection.c:272]
>        wait_frame_inner [amqp_socket.c:168]
>        amqp_simple_wait_method [amqp_socket.c:218]
>        amqp_login     [amqp_socket.c:383]
>        CRabbitQueueWriter::openConnection() [RabbitQueueWriter.cpp:78]
>  * Block of 131072 bytes (2 times); last block at 0xa135df8
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120515/cf4ca3a4/attachment.htm>

From matthias at rabbitmq.com  Tue May 15 17:53:23 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 15 May 2012 17:53:23 +0100
Subject: [rabbitmq-discuss] Problem With Distribute load Using HAproxy ?
In-Reply-To: <b796ee96-3d8e-4770-b2ab-c15882a7364c@x6g2000pbh.googlegroups.com>
References: <b796ee96-3d8e-4770-b2ab-c15882a7364c@x6g2000pbh.googlegroups.com>
Message-ID: <4FB28A03.3000701@rabbitmq.com>

On 12/05/12 06:25, jayesh dalwadi wrote:
> i create HAproxy TCP Base load balance but problem is when i publish
> message using that load balancer that time my connection establish to
> one node and that node hava all the message
> [...]
> how can i distribute my publish message to different node

Establish more than one connection.

Matthias.

From iceblaze at gmail.com  Tue May 15 20:05:03 2012
From: iceblaze at gmail.com (iceblaze)
Date: Tue, 15 May 2012 12:05:03 -0700
Subject: [rabbitmq-discuss] Unable to cluster..
In-Reply-To: <4FB22A8A.2060601@rabbitmq.com>
References: <CA+-WFvzuKiZWMFUe85rwLwq_8qOExRPvjQvdmfXTRj6ZfR3bGQ@mail.gmail.com>
	<CA+-WFvyNbzwPnp_fwmphQy2GmgJNG1zAdfc8uVDwKjzRZR0qWw@mail.gmail.com>
	<4FB0CAD3.1000407@rabbitmq.com>
	<CA+-WFvysaXMpHBY=8jREboikrS1Opxqfs2cNriF9EFfTqgOAmA@mail.gmail.com>
	<CA+-WFvyNd790RpPqGH10-Hsa+AbHrPJ+Qb_dEhotuwa0OOxVnQ@mail.gmail.com>
	<CA+-WFvwqtmJp7bAN8wg2CDuSedmWgAk-_BXp3k=_PQGaE=uQ-Q@mail.gmail.com>
	<4FB22A8A.2060601@rabbitmq.com>
Message-ID: <CA+-WFvzq35hxG_OwgACA6cUYFtSvzY6VZPq=nOTFPBL1VVX2Lg@mail.gmail.com>

[root at rabbit-test2 ~]# !106
cp erlang.cookie /var/lib/rabbitmq/.erlang.cookie
cp: overwrite `/var/lib/rabbitmq/.erlang.cookie'? y
[root at rabbit-test2 ~]# /etc/init.d/rabbitmq-server restart
Restarting rabbitmq-server: SUCCESS
rabbitmq-server.
[root at rabbit-test2 ~]# rabbitmqctl stop_app
Stopping node 'rabbit at rabbit-test2' ...
...done.
[root at rabbit-test2 ~]# rabbitmqctl reset
Resetting node 'rabbit at rabbit-test2' ...
...done.
[root at rabbit-test2 ~]# rabbitmqctl cluster rabbit at rabbit-test1
Clustering node 'rabbit at rabbit-test2' with ['rabbit at rabbit-test1'] ...
Error: {unable_to_join_cluster,
           ['rabbit at rabbit-test1'],
           {aborted,
               {function_clause,
                   [{mnesia_schema,cs2list,
                        [{cstruct,schema,set,[],
                             ['rabbit at rabbit-test1'],
                             [],0,read_write,false,[],[],false,schema,
                             [table,cstruct],
                             [],[],
                             {{1336,612893,960781},'rabbit at rabbit-test1'},
                             {{10,0},
                              {'rabbit at rabbit-test1
',{1337,86607,493576}}}}]},
                    {mnesia_schema,do_merge_schema,0},
                    {mnesia_tm,apply_fun,3},
                    {mnesia_tm,execute_transaction,5},
                    {mnesia_schema,schema_coordinator,3}]}}}
[root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test1 status
Status of node 'rabbit at rabbit-test1' ...
[{pid,4502},
 {running_applications,[{rabbit,"RabbitMQ","2.8.2"},
                        {os_mon,"CPO  CXC 138 46","2.2.6"},
                        {sasl,"SASL  CXC 138 11","2.1.9.4"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.19"},
                        {stdlib,"ERTS  CXC 138 10","1.17.4"},
                        {kernel,"ERTS  CXC 138 10","2.14.4"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:8:8]
[rq:8] [async-threads:30] [kernel-poll:true]\n"},
 {memory,[{total,25740256},
          {processes,10127576},
          {processes_used,10115016},
          {system,15612680},
          {atom,1136673},
          {atom_used,1134546},
          {binary,158656},
          {code,11341457},
          {ets,778384}]},
 {vm_memory_high_watermark,0.3999999999359184},
 {vm_memory_limit,2496816742},
 {disk_free_limit,6242041856},
 {disk_free,449333911552},
 {file_descriptors,[{total_limit,924},
                    {total_used,3},
                    {sockets_limit,829},
                    {sockets_used,1}]},
 {processes,[{limit,1048576},{used,125}]},
 {run_queue,0},
 {uptime,77}]
...done.

I've also tried the same steps without restarting the server after copying
the erlang.cookie with the same results..

-James

On Tue, May 15, 2012 at 3:06 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 15/05/12 05:28, iceblaze wrote:
>
> > OK, so I am now getting a different, cryptic error when trying to
> cluster:
>
> You should not get that message if you follow the transcript in the
> documentation. Did you perform the "reset" step? Otherwise please
> provide a transcript of your steps that reproduce the problem.
>
>
> -Emile
>
>


-- 
"Of course, the actual government of any computer is run by that fascist
dictator known as the operating system. But a wise dictator knows when to
let the people think they're capitalists--and when to let them think
they're communists." - Programming Perl third edition
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120515/dec99232/attachment.htm>

From matthias at rabbitmq.com  Tue May 15 20:20:56 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 15 May 2012 20:20:56 +0100
Subject: [rabbitmq-discuss] Unable to cluster..
In-Reply-To: <CA+-WFvzq35hxG_OwgACA6cUYFtSvzY6VZPq=nOTFPBL1VVX2Lg@mail.gmail.com>
References: <CA+-WFvzuKiZWMFUe85rwLwq_8qOExRPvjQvdmfXTRj6ZfR3bGQ@mail.gmail.com>	<CA+-WFvyNbzwPnp_fwmphQy2GmgJNG1zAdfc8uVDwKjzRZR0qWw@mail.gmail.com>	<4FB0CAD3.1000407@rabbitmq.com>	<CA+-WFvysaXMpHBY=8jREboikrS1Opxqfs2cNriF9EFfTqgOAmA@mail.gmail.com>	<CA+-WFvyNd790RpPqGH10-Hsa+AbHrPJ+Qb_dEhotuwa0OOxVnQ@mail.gmail.com>	<CA+-WFvwqtmJp7bAN8wg2CDuSedmWgAk-_BXp3k=_PQGaE=uQ-Q@mail.gmail.com>	<4FB22A8A.2060601@rabbitmq.com>
	<CA+-WFvzq35hxG_OwgACA6cUYFtSvzY6VZPq=nOTFPBL1VVX2Lg@mail.gmail.com>
Message-ID: <4FB2AC98.5060402@rabbitmq.com>

On 15/05/12 20:05, iceblaze wrote:
> [root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test1 status
> [...[
>   {erlang_version,"Erlang R14B03 (erts-5.8.4) [source] [64-bit]
> [smp:8:8] [rq:8] [async-threads:30] [kernel-poll:true]\n"},

vs

> [root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test2 status
> [...]
> {erlang_version,"Erlang (BEAM) emulator version 5.6.5 [source]
> [64-bit] [smp:8] [async-threads:30] [hipe] [kernel-poll:true]\n"},

That's two different versions of Erlang - R14B03 vs R12B-5. There's your 
problem.

Matthias.

From iceblaze at gmail.com  Tue May 15 20:24:05 2012
From: iceblaze at gmail.com (iceblaze)
Date: Tue, 15 May 2012 12:24:05 -0700
Subject: [rabbitmq-discuss] Unable to cluster..
In-Reply-To: <4FB2AC98.5060402@rabbitmq.com>
References: <CA+-WFvzuKiZWMFUe85rwLwq_8qOExRPvjQvdmfXTRj6ZfR3bGQ@mail.gmail.com>
	<CA+-WFvyNbzwPnp_fwmphQy2GmgJNG1zAdfc8uVDwKjzRZR0qWw@mail.gmail.com>
	<4FB0CAD3.1000407@rabbitmq.com>
	<CA+-WFvysaXMpHBY=8jREboikrS1Opxqfs2cNriF9EFfTqgOAmA@mail.gmail.com>
	<CA+-WFvyNd790RpPqGH10-Hsa+AbHrPJ+Qb_dEhotuwa0OOxVnQ@mail.gmail.com>
	<CA+-WFvwqtmJp7bAN8wg2CDuSedmWgAk-_BXp3k=_PQGaE=uQ-Q@mail.gmail.com>
	<4FB22A8A.2060601@rabbitmq.com>
	<CA+-WFvzq35hxG_OwgACA6cUYFtSvzY6VZPq=nOTFPBL1VVX2Lg@mail.gmail.com>
	<4FB2AC98.5060402@rabbitmq.com>
Message-ID: <CA+-WFvwKidULc67p9cEFmHZ+hQ5K7Z--KTOg8cq-79FrhiZwDw@mail.gmail.com>

Hello Matthias,

Thanks! That is very strange because:

[root at rabbit-test2 ~]# rpm -qa |grep -i rabbit
rabbitmq-server-2.8.2-1

[root at rabbit-test1 ~]# rpm -qa |grep -i rabbit
rabbitmq-server-2.8.2-1

Although I did upgrade over an older rabbit package, so it must have failed
somewhere along the line

-James

On Tue, May 15, 2012 at 12:20 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 15/05/12 20:05, iceblaze wrote:
>
>> [root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test1 status
>> [...[
>>
>>  {erlang_version,"Erlang R14B03 (erts-5.8.4) [source] [64-bit]
>> [smp:8:8] [rq:8] [async-threads:30] [kernel-poll:true]\n"},
>>
>
> vs
>
>  [root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test2 status
>> [...]
>>
>> {erlang_version,"Erlang (BEAM) emulator version 5.6.5 [source]
>> [64-bit] [smp:8] [async-threads:30] [hipe] [kernel-poll:true]\n"},
>>
>
> That's two different versions of Erlang - R14B03 vs R12B-5. There's your
> problem.
>
> Matthias.
>



-- 
"Of course, the actual government of any computer is run by that fascist
dictator known as the operating system. But a wise dictator knows when to
let the people think they're capitalists--and when to let them think
they're communists." - Programming Perl third edition
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120515/3e6a5fee/attachment.htm>

From iceblaze at gmail.com  Tue May 15 20:25:41 2012
From: iceblaze at gmail.com (iceblaze)
Date: Tue, 15 May 2012 12:25:41 -0700
Subject: [rabbitmq-discuss] Unable to cluster..
In-Reply-To: <CA+-WFvwKidULc67p9cEFmHZ+hQ5K7Z--KTOg8cq-79FrhiZwDw@mail.gmail.com>
References: <CA+-WFvzuKiZWMFUe85rwLwq_8qOExRPvjQvdmfXTRj6ZfR3bGQ@mail.gmail.com>
	<CA+-WFvyNbzwPnp_fwmphQy2GmgJNG1zAdfc8uVDwKjzRZR0qWw@mail.gmail.com>
	<4FB0CAD3.1000407@rabbitmq.com>
	<CA+-WFvysaXMpHBY=8jREboikrS1Opxqfs2cNriF9EFfTqgOAmA@mail.gmail.com>
	<CA+-WFvyNd790RpPqGH10-Hsa+AbHrPJ+Qb_dEhotuwa0OOxVnQ@mail.gmail.com>
	<CA+-WFvwqtmJp7bAN8wg2CDuSedmWgAk-_BXp3k=_PQGaE=uQ-Q@mail.gmail.com>
	<4FB22A8A.2060601@rabbitmq.com>
	<CA+-WFvzq35hxG_OwgACA6cUYFtSvzY6VZPq=nOTFPBL1VVX2Lg@mail.gmail.com>
	<4FB2AC98.5060402@rabbitmq.com>
	<CA+-WFvwKidULc67p9cEFmHZ+hQ5K7Z--KTOg8cq-79FrhiZwDw@mail.gmail.com>
Message-ID: <CA+-WFvynDm_OjvpvX-4bOesLnDS1TKxQ85KD0+PTAsQCEjLaLA@mail.gmail.com>

Nevermind, you said erlang ;)

-James

On Tue, May 15, 2012 at 12:24 PM, iceblaze <iceblaze at gmail.com> wrote:

> Hello Matthias,
>
> Thanks! That is very strange because:
>
> [root at rabbit-test2 ~]# rpm -qa |grep -i rabbit
> rabbitmq-server-2.8.2-1
>
> [root at rabbit-test1 ~]# rpm -qa |grep -i rabbit
> rabbitmq-server-2.8.2-1
>
> Although I did upgrade over an older rabbit package, so it must have
> failed somewhere along the line
>
> -James
>
>
> On Tue, May 15, 2012 at 12:20 PM, Matthias Radestock <
> matthias at rabbitmq.com> wrote:
>
>> On 15/05/12 20:05, iceblaze wrote:
>>
>>> [root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test1 status
>>> [...[
>>>
>>>  {erlang_version,"Erlang R14B03 (erts-5.8.4) [source] [64-bit]
>>> [smp:8:8] [rq:8] [async-threads:30] [kernel-poll:true]\n"},
>>>
>>
>> vs
>>
>>  [root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test2 status
>>> [...]
>>>
>>> {erlang_version,"Erlang (BEAM) emulator version 5.6.5 [source]
>>> [64-bit] [smp:8] [async-threads:30] [hipe] [kernel-poll:true]\n"},
>>>
>>
>> That's two different versions of Erlang - R14B03 vs R12B-5. There's your
>> problem.
>>
>> Matthias.
>>
>
>
>
> --
> "Of course, the actual government of any computer is run by that fascist
> dictator known as the operating system. But a wise dictator knows when to
> let the people think they're capitalists--and when to let them think
> they're communists." - Programming Perl third edition
>



-- 
"Of course, the actual government of any computer is run by that fascist
dictator known as the operating system. But a wise dictator knows when to
let the people think they're capitalists--and when to let them think
they're communists." - Programming Perl third edition
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120515/58b28eaa/attachment.htm>

From iceblaze at gmail.com  Tue May 15 20:34:24 2012
From: iceblaze at gmail.com (iceblaze)
Date: Tue, 15 May 2012 12:34:24 -0700
Subject: [rabbitmq-discuss] Unable to cluster..
In-Reply-To: <CA+-WFvynDm_OjvpvX-4bOesLnDS1TKxQ85KD0+PTAsQCEjLaLA@mail.gmail.com>
References: <CA+-WFvzuKiZWMFUe85rwLwq_8qOExRPvjQvdmfXTRj6ZfR3bGQ@mail.gmail.com>
	<CA+-WFvyNbzwPnp_fwmphQy2GmgJNG1zAdfc8uVDwKjzRZR0qWw@mail.gmail.com>
	<4FB0CAD3.1000407@rabbitmq.com>
	<CA+-WFvysaXMpHBY=8jREboikrS1Opxqfs2cNriF9EFfTqgOAmA@mail.gmail.com>
	<CA+-WFvyNd790RpPqGH10-Hsa+AbHrPJ+Qb_dEhotuwa0OOxVnQ@mail.gmail.com>
	<CA+-WFvwqtmJp7bAN8wg2CDuSedmWgAk-_BXp3k=_PQGaE=uQ-Q@mail.gmail.com>
	<4FB22A8A.2060601@rabbitmq.com>
	<CA+-WFvzq35hxG_OwgACA6cUYFtSvzY6VZPq=nOTFPBL1VVX2Lg@mail.gmail.com>
	<4FB2AC98.5060402@rabbitmq.com>
	<CA+-WFvwKidULc67p9cEFmHZ+hQ5K7Z--KTOg8cq-79FrhiZwDw@mail.gmail.com>
	<CA+-WFvynDm_OjvpvX-4bOesLnDS1TKxQ85KD0+PTAsQCEjLaLA@mail.gmail.com>
Message-ID: <CA+-WFvxtD2P-VQmD9zPDr-gNjJB+S0W5k9+0HobuU+8inDKJKA@mail.gmail.com>

wahooo!! Thanks Matthias & Emile!

[root at rabbit-test2 ~]# rabbitmqctl cluster_status
Cluster status of node 'rabbit at rabbit-test2' ...
[{nodes,[{disc,['rabbit at rabbit-test1']},{ram,['rabbit at rabbit-test2']}]},
 {running_nodes,['rabbit at rabbit-test1','rabbit at rabbit-test2']}]
...done.



On Tue, May 15, 2012 at 12:25 PM, iceblaze <iceblaze at gmail.com> wrote:

> Nevermind, you said erlang ;)
>
> -James
>
>
> On Tue, May 15, 2012 at 12:24 PM, iceblaze <iceblaze at gmail.com> wrote:
>
>> Hello Matthias,
>>
>> Thanks! That is very strange because:
>>
>> [root at rabbit-test2 ~]# rpm -qa |grep -i rabbit
>> rabbitmq-server-2.8.2-1
>>
>> [root at rabbit-test1 ~]# rpm -qa |grep -i rabbit
>> rabbitmq-server-2.8.2-1
>>
>> Although I did upgrade over an older rabbit package, so it must have
>> failed somewhere along the line
>>
>> -James
>>
>>
>> On Tue, May 15, 2012 at 12:20 PM, Matthias Radestock <
>> matthias at rabbitmq.com> wrote:
>>
>>> On 15/05/12 20:05, iceblaze wrote:
>>>
>>>> [root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test1 status
>>>> [...[
>>>>
>>>>  {erlang_version,"Erlang R14B03 (erts-5.8.4) [source] [64-bit]
>>>> [smp:8:8] [rq:8] [async-threads:30] [kernel-poll:true]\n"},
>>>>
>>>
>>> vs
>>>
>>>  [root at rabbit-test2 ~]# rabbitmqctl -n rabbit at rabbit-test2 status
>>>> [...]
>>>>
>>>> {erlang_version,"Erlang (BEAM) emulator version 5.6.5 [source]
>>>> [64-bit] [smp:8] [async-threads:30] [hipe] [kernel-poll:true]\n"},
>>>>
>>>
>>> That's two different versions of Erlang - R14B03 vs R12B-5. There's your
>>> problem.
>>>
>>> Matthias.
>>>
>>
>>
>>
>> --
>> "Of course, the actual government of any computer is run by that fascist
>> dictator known as the operating system. But a wise dictator knows when to
>> let the people think they're capitalists--and when to let them think
>> they're communists." - Programming Perl third edition
>>
>
>
>
> --
> "Of course, the actual government of any computer is run by that fascist
> dictator known as the operating system. But a wise dictator knows when to
> let the people think they're capitalists--and when to let them think
> they're communists." - Programming Perl third edition
>



-- 
"Of course, the actual government of any computer is run by that fascist
dictator known as the operating system. But a wise dictator knows when to
let the people think they're capitalists--and when to let them think
they're communists." - Programming Perl third edition
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120515/2722092c/attachment.htm>

From matthias at rabbitmq.com  Wed May 16 07:54:48 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 16 May 2012 07:54:48 +0100
Subject: [rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
In-Reply-To: <4FB15399.9090504@gmail.com>
References: <4FABE167.9080900@gmail.com> <4FABE7B9.5010509@rabbitmq.com>
	<4FB15399.9090504@gmail.com>
Message-ID: <4FB34F38.2080507@rabbitmq.com>

Paul,

On 14/05/12 19:48, Paul Gross wrote:
> here is the output of 'rabbitmqctl report' on a MacPro right after
> rabbitmq went crazy before we had to kill it. Is there something unusual
> in these numbers?

That looks like a perfectly healthy rabbit.

There are no user-defined exchanges, queues or bindings - is that expected?

In your original email you said that "all of a sudden [...] RabbitMQ 
consumes all available CPU and memory", but in the report the memory 
usage is shown as 90MB, which isn't very high.

Are you sure that it is *rabbit* that is eating all the CPU & memory? 
Please check the CPU/memory usage of the beam.smp process and include 
that in your report next time the problem occurs.

Regards,

Matthias.

From bino at indoakses-online.com  Wed May 16 08:18:04 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Wed, 16 May 2012 14:18:04 +0700
Subject: [rabbitmq-discuss] question : How to not delete message from queue
Message-ID: <4FB354AC.2000203@indoakses-online.com>

Dear All ..

I try to run 
https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/worker.py
It work fine.

But I really need to be able to not delete message from queue, in case 
there is exception.

 From the original callback part :

-----Start----
def callback(ch, method, properties, body):
     print " [x] Received %r" % (body,)
     time.sleep( body.count('.') )
     print " [x] Done"
     ch.basic_ack(delivery_tag = method.delivery_tag)
-----Stop----

My question is how to do something like :
-----Start----
def callback(ch, method, properties, body):
     print " [x] Received %r" % (body,)
     time.sleep( body.count('.') )
     isSuceed = True
     try :
         print " [x] Done"
     except :
         isSucceed = False
     if isSucceed :
         ch.basic_ack(delivery_tag = method.delivery_tag)
     else :
         #Here is my question :
         #How to keep (not deleting) the message in Queue ?
-----Stop----

Kindly please give me your enlightment.

Sincerely
-bino-


From matthias at rabbitmq.com  Wed May 16 08:28:17 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 16 May 2012 08:28:17 +0100
Subject: [rabbitmq-discuss] is RabbitMQ for me ?
In-Reply-To: <4FB08705.5050104@indoakses-online.com>
References: <4FB08705.5050104@indoakses-online.com>
Message-ID: <4FB35711.1070905@rabbitmq.com>

Bino,

On 14/05/12 05:16, bino oetomo wrote:
> How to tell RabbitMQ (using PIKA) that the Task is Done (and delete the
> task) ?

basic.ack.

> How to tell RabbitMQ (using PIKA) that the HTTP POST is failed and just
> leave the Task untouched ?

basic.reject.

Regards,

Matthias.

From matthias at rabbitmq.com  Wed May 16 08:29:36 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 16 May 2012 08:29:36 +0100
Subject: [rabbitmq-discuss] question : How to not delete message from
 queue
In-Reply-To: <4FB354AC.2000203@indoakses-online.com>
References: <4FB354AC.2000203@indoakses-online.com>
Message-ID: <4FB35760.9090404@rabbitmq.com>

Bino,

On 16/05/12 08:18, bino oetomo wrote:
> My question is how to do something like :
> -----Start----
> def callback(ch, method, properties, body):
> print " [x] Received %r" % (body,)
> time.sleep( body.count('.') )
> isSuceed = True
> try :
> print " [x] Done"
> except :
> isSucceed = False
> if isSucceed :
> ch.basic_ack(delivery_tag = method.delivery_tag)
> else :
> #Here is my question :
> #How to keep (not deleting) the message in Queue ?
> -----Stop----

ch.basic_reject(delivery_tag = method.delivery_tag)

Matthias.

From matthias at rabbitmq.com  Wed May 16 08:41:08 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 16 May 2012 08:41:08 +0100
Subject: [rabbitmq-discuss] getting error Mnesia could not connect to
 some nodes ?
In-Reply-To: <33831639.post@talk.nabble.com>
References: <33831639.post@talk.nabble.com>
Message-ID: <4FB35A14.60401@rabbitmq.com>

On 14/05/12 17:16, sameekmishra wrote:
> root at server03:/home/arosys03# rabbitmqctl cluster rabbit at server04
> Clustering node rabbit at server03 with [rabbit at server04] ...
> Error: {failed_to_cluster_with,[rabbit at server04],
>                                 "Mnesia could not connect to some nodes
>
> please clear who creates a cookie file and what will be the reason behind
> this error?

I suggest you gather some additional diagnostics by running

on server03:
rabbitmqctl status
rabbitmqctl -n rabbit at server04 status

on server04:
rabbitmqctl status
rabbitmqctl -n rabbit at server03 status

Regards,

Matthias.

From bino at indoakses-online.com  Wed May 16 08:56:47 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Wed, 16 May 2012 14:56:47 +0700
Subject: [rabbitmq-discuss] question : How to not delete message from
 queue
In-Reply-To: <4FB35760.9090404@rabbitmq.com>
References: <4FB354AC.2000203@indoakses-online.com>
	<4FB35760.9090404@rabbitmq.com>
Message-ID: <4FB35DBF.2080807@indoakses-online.com>

Dear Matthias
On 05/16/2012 02:29 PM, Matthias Radestock wrote:
>
> ch.basic_reject(delivery_tag = method.delivery_tag)
>
Thankyou for your enlightment.
Now it work just like a champ

Sincerely
-bino-

From bino at indoakses-online.com  Wed May 16 09:36:13 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Wed, 16 May 2012 15:36:13 +0700
Subject: [rabbitmq-discuss] question : how to speed up the worker ?
Message-ID: <4FB366FD.2040103@indoakses-online.com>

Dear All,
Based on the 'sender' and 'worker' at 
http://www.rabbitmq.com/tutorials/tutorial-two-python.html ,
I wrote a small script.

1. Sender : Basically it just add a msg to the mq every 1 second.
Actualy, it's part of my python-twisted script.
The script just forward any msg comming trough my serial port to the MQ
I connect my Arduino to my SerialPort, and it send msg every 1 seconds

2. Worker : just to read stored msg , and print each to stdout.
it just a plain copy-paste from the example.

The sender is work fine.

But the worker need to wait a couple of seconds to read the next msg.

Kindly please give me your enlightment on what to do to make the worker 
not to delay between every loop/read.
Actualy , soon I'll need the worker to make 'paralel' work (if it 
doable), since this solution will need to forward queued msg to a HTTP 
server.
In my deployment plan, the queued msg potentialy will reach 7000 msg and 
up (1 msg per second, 2 or more working hour)

Sincerely
-bino-

From videlalvaro at gmail.com  Wed May 16 09:45:20 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 16 May 2012 10:45:20 +0200
Subject: [rabbitmq-discuss] question : how to speed up the worker ?
In-Reply-To: <4FB366FD.2040103@indoakses-online.com>
References: <4FB366FD.2040103@indoakses-online.com>
Message-ID: <CAMcAHLXvU2_Ru+wNLtmydMA=Yv0L2VoZh=UwPK_hba3aACNbhg@mail.gmail.com>

If you need to do parallel work then just start many workers for the same
queue.

Regarding how many messages you can queue is up to the available hard disk
space.

If you are asking about "amount of messages per second", RabbitMQ can
easily do 12.000 msg/sec in 2 years old laptops.

Regards,

Alvaro

On Wed, May 16, 2012 at 10:36 AM, bino oetomo <bino at indoakses-online.com>wrote:

> Dear All,
> Based on the 'sender' and 'worker' at http://www.rabbitmq.com/**
> tutorials/tutorial-two-python.**html<http://www.rabbitmq.com/tutorials/tutorial-two-python.html>,
> I wrote a small script.
>
> 1. Sender : Basically it just add a msg to the mq every 1 second.
> Actualy, it's part of my python-twisted script.
> The script just forward any msg comming trough my serial port to the MQ
> I connect my Arduino to my SerialPort, and it send msg every 1 seconds
>
> 2. Worker : just to read stored msg , and print each to stdout.
> it just a plain copy-paste from the example.
>
> The sender is work fine.
>
> But the worker need to wait a couple of seconds to read the next msg.
>
> Kindly please give me your enlightment on what to do to make the worker
> not to delay between every loop/read.
> Actualy , soon I'll need the worker to make 'paralel' work (if it doable),
> since this solution will need to forward queued msg to a HTTP server.
> In my deployment plan, the queued msg potentialy will reach 7000 msg and
> up (1 msg per second, 2 or more working hour)
>
> Sincerely
> -bino-
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120516/cf1d606b/attachment.htm>

From bino at indoakses-online.com  Wed May 16 09:50:20 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Wed, 16 May 2012 15:50:20 +0700
Subject: [rabbitmq-discuss] question : how to speed up the worker ?
In-Reply-To: <CAMcAHLXvU2_Ru+wNLtmydMA=Yv0L2VoZh=UwPK_hba3aACNbhg@mail.gmail.com>
References: <4FB366FD.2040103@indoakses-online.com>
	<CAMcAHLXvU2_Ru+wNLtmydMA=Yv0L2VoZh=UwPK_hba3aACNbhg@mail.gmail.com>
Message-ID: <4FB36A4C.50907@indoakses-online.com>

Dear All.
Please ignore my 'delay' problem
I found that in the example script .. there is ---> time.sleep( 
body.count('.') )
I remove that line ... and now it work fine.

C/Q Alvaro:
Thankyou for your enlightment.
On 05/16/2012 03:45 PM, Alvaro Videla wrote:
> If you need to do parallel work then just start many workers for the same
> queue.
>
Is there any potential that a single msg is consumed by multiple worker ?

Sincerely
-bino-

From tim at rabbitmq.com  Wed May 16 09:55:15 2012
From: tim at rabbitmq.com (tim)
Date: Wed, 16 May 2012 09:55:15 +0100
Subject: [rabbitmq-discuss] question : how to speed up the worker ?
In-Reply-To: <4FB36A4C.50907@indoakses-online.com>
References: <4FB366FD.2040103@indoakses-online.com>
	<CAMcAHLXvU2_Ru+wNLtmydMA=Yv0L2VoZh=UwPK_hba3aACNbhg@mail.gmail.com>
	<4FB36A4C.50907@indoakses-online.com>
Message-ID: <4FB36B73.3050609@rabbitmq.com>

>>
> Is there any potential that a single msg is consumed by multiple worker ?
>

It kind of depends. If one consumer rejects a message then others can 
pick it up. If you've set up a fanout exchange, then obviously this will 
happen all the time. You can also run into this scenario when running 
federation.

Tim

From videlalvaro at gmail.com  Wed May 16 09:56:22 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 16 May 2012 10:56:22 +0200
Subject: [rabbitmq-discuss] question : how to speed up the worker ?
In-Reply-To: <4FB36A4C.50907@indoakses-online.com>
References: <4FB366FD.2040103@indoakses-online.com>
	<CAMcAHLXvU2_Ru+wNLtmydMA=Yv0L2VoZh=UwPK_hba3aACNbhg@mail.gmail.com>
	<4FB36A4C.50907@indoakses-online.com>
Message-ID: <CAMcAHLWxAhSMsmh7Bds4M4CznK1FPB1otN3Wgx-Fj9eVnbjBvQ@mail.gmail.com>

Hi,

On Wed, May 16, 2012 at 10:50 AM, bino oetomo <bino at indoakses-online.com>wrote:
>
> Is there any potential that a single msg is consumed by multiple worker ?


Quick answer: No. If RabbitMQ sends a message to worker A then it won't be
sent to worker B, unless?

The message goes back to the queue, due to a basic reject for example, or a
consumer that crashed and didn't ack the message.

So basically message X from queue Y won't be at the same time in two
consumers. Please somebody correct me if I'm wrong.

-Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120516/d203311b/attachment.htm>

From videlalvaro at gmail.com  Wed May 16 09:57:22 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 16 May 2012 10:57:22 +0200
Subject: [rabbitmq-discuss] question : how to speed up the worker ?
In-Reply-To: <4FB36B73.3050609@rabbitmq.com>
References: <4FB366FD.2040103@indoakses-online.com>
	<CAMcAHLXvU2_Ru+wNLtmydMA=Yv0L2VoZh=UwPK_hba3aACNbhg@mail.gmail.com>
	<4FB36A4C.50907@indoakses-online.com>
	<4FB36B73.3050609@rabbitmq.com>
Message-ID: <CAMcAHLW1hGn+XkGnYUtQaJDFmc6p07OUKABrGk2Q4TKiKH9G-w@mail.gmail.com>

Hi,

On Wed, May 16, 2012 at 10:55 AM, tim <tim at rabbitmq.com> wrote:
>
> It kind of depends. If one consumer rejects a message then others can pick
> it up. If you've set up a fanout exchange, then obviously this will happen
> all the time. You can also run into this scenario when running federation.


I think for his use case fanout doesn't matter since we are talking about
many workers to the same queue, not many queues to one exchange.


> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120516/573c21af/attachment.htm>

From bino at indoakses-online.com  Wed May 16 10:01:59 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Wed, 16 May 2012 16:01:59 +0700
Subject: [rabbitmq-discuss] question : how to speed up the worker ?
In-Reply-To: <CAMcAHLWxAhSMsmh7Bds4M4CznK1FPB1otN3Wgx-Fj9eVnbjBvQ@mail.gmail.com>
References: <4FB366FD.2040103@indoakses-online.com>	<CAMcAHLXvU2_Ru+wNLtmydMA=Yv0L2VoZh=UwPK_hba3aACNbhg@mail.gmail.com>	<4FB36A4C.50907@indoakses-online.com>
	<CAMcAHLWxAhSMsmh7Bds4M4CznK1FPB1otN3Wgx-Fj9eVnbjBvQ@mail.gmail.com>
Message-ID: <4FB36D07.3070602@indoakses-online.com>

Dear All
c/q Alvaro
On 05/16/2012 03:56 PM, Alvaro Videla wrote:
> Hi,
>
> On Wed, May 16, 2012 at 10:50 AM, bino oetomo<bino at indoakses-online.com>wrote:
>> Is there any potential that a single msg is consumed by multiple worker ?
>
> Quick answer: No. If RabbitMQ sends a message to worker A then it won't be
> sent to worker B, unless?
>
> The message goes back to the queue, due to a basic reject for example, or a
> consumer that crashed and didn't ack the message.
>
> So basically message X from queue Y won't be at the same time in two
> consumers. Please somebody correct me if I'm wrong.
>
Ah .. great to know this.

The HTTP always have delay ... and it will slowing down my entire process.
Here is where paralel worker will come to help.

I really appreciate your enlightment.

Sincerely
-bino-

From tim at rabbitmq.com  Wed May 16 09:59:20 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 16 May 2012 09:59:20 +0100
Subject: [rabbitmq-discuss] question : how to speed up the worker ?
In-Reply-To: <CAMcAHLW1hGn+XkGnYUtQaJDFmc6p07OUKABrGk2Q4TKiKH9G-w@mail.gmail.com>
References: <4FB366FD.2040103@indoakses-online.com>
	<CAMcAHLXvU2_Ru+wNLtmydMA=Yv0L2VoZh=UwPK_hba3aACNbhg@mail.gmail.com>
	<4FB36A4C.50907@indoakses-online.com>
	<4FB36B73.3050609@rabbitmq.com>
	<CAMcAHLW1hGn+XkGnYUtQaJDFmc6p07OUKABrGk2Q4TKiKH9G-w@mail.gmail.com>
Message-ID: <4FB36C68.5040401@rabbitmq.com>

On 16/05/12 09:57, Alvaro Videla wrote:
> Hi,
>
> On Wed, May 16, 2012 at 10:55 AM, tim <tim at rabbitmq.com 
> <mailto:tim at rabbitmq.com>> wrote:
>
>     It kind of depends. If one consumer rejects a message then others
>     can pick it up. If you've set up a fanout exchange, then obviously
>     this will happen all the time. You can also run into this scenario
>     when running federation.
>
>
> I think for his use case fanout doesn't matter since we are talking 
> about many workers to the same queue, not many queues to one exchange.

Yes you're absolutely right - I was thinking more generally than his 
specific example. As you mentioned, the reject scenario is the main one 
to think about here.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120516/697ed0ec/attachment.htm>

From emile at rabbitmq.com  Wed May 16 10:31:54 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 16 May 2012 10:31:54 +0100
Subject: [rabbitmq-discuss] Best practice for 1 server, several agents,
 several kind of messages
In-Reply-To: <25378740.1919.1337073027997.JavaMail.geo-discussion-forums@vbvq7>
References: <25378740.1919.1337073027997.JavaMail.geo-discussion-forums@vbvq7>
Message-ID: <4FB3740A.5070306@rabbitmq.com>

Hi,

On 15/05/12 10:10, misterdev wrote:
> - Will there be a problem with this number of queues in my architecture
> ? (100 agent --> more than 2000 queues) and what should be the size of
> my server hosting the broker ?

As long as your broker hardware is adequate that should be fine. Brokers
on commodity hardware should easily be able to manage tens of thousands
of queues.

> - Is there a pattern that could help me ?

I would look at the topic routing tutorial:
http://www.rabbitmq.com/tutorials/tutorial-five-python.html

> - Is it better to use messages headers to identify each message, instead
> of topic exchange ?

If you want to be able to route based on different components of the
message type then use topics. This option gives you the most flexibility
and is probably most appropriate in your case.

> - Is it better to differentiate server to agent queue and agent to
> server queue, or is it ok if both read and write in the same queue ?

That depends on your application, but it typical to keep them separate.



-Emile




From bino at indoakses-online.com  Wed May 16 10:40:01 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Wed, 16 May 2012 16:40:01 +0700
Subject: [rabbitmq-discuss] question : how to speed up the worker ?
In-Reply-To: <4FB36C68.5040401@rabbitmq.com>
References: <4FB366FD.2040103@indoakses-online.com>	<CAMcAHLXvU2_Ru+wNLtmydMA=Yv0L2VoZh=UwPK_hba3aACNbhg@mail.gmail.com>	<4FB36A4C.50907@indoakses-online.com>	<4FB36B73.3050609@rabbitmq.com>	<CAMcAHLW1hGn+XkGnYUtQaJDFmc6p07OUKABrGk2Q4TKiKH9G-w@mail.gmail.com>
	<4FB36C68.5040401@rabbitmq.com>
Message-ID: <4FB375F1.9020008@indoakses-online.com>

Dear All
C/Q Tim and Alvaro

On 05/16/2012 03:59 PM, Tim Watson wrote:
> On 16/05/12 09:57, Alvaro Videla wrote:
>> Hi,
>>
>> On Wed, May 16, 2012 at 10:55 AM, tim <tim at rabbitmq.com 
>> <mailto:tim at rabbitmq.com>> wrote:
>>
>>     It kind of depends. If one consumer rejects a message then others
>>     can pick it up. If you've set up a fanout exchange, then obviously
>>     this will happen all the time. You can also run into this scenario
>>     when running federation.
>>
>>
>> I think for his use case fanout doesn't matter since we are talking 
>> about many workers to the same queue, not many queues to one exchange.
>
> Yes you're absolutely right - I was thinking more generally than his 
> specific example. As you mentioned, the reject scenario is the main 
> one to think about here.
>
Is there any potential conflict/problem when I use multi-worker that can 
do 'reject' ?

Sincerely
-bino-

From ylatrous at gmail.com  Tue May 15 20:51:49 2012
From: ylatrous at gmail.com (Y Latrous)
Date: Tue, 15 May 2012 12:51:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Reconnect to RabbitMQ broker
In-Reply-To: <4F670856.7070804@rabbitmq.com>
References: <26602465.2.1331779574134.JavaMail.geo-discussion-forums@pbgr4>	<4F61CD6C.4080006@rabbitmq.com>
	<8574a318-6680-4bda-bdb3-c8c548e480ca@r2g2000pbs.googlegroups.com>
	<4F670856.7070804@rabbitmq.com>
Message-ID: <21730213.244.1337111509091.JavaMail.geo-discussion-forums@ynbv35>

I'm having a similar issue described in this post. In my case, I'm getting "Connection 
refused" all the time. I use the same host and port number (and had to set 
the timeout to a minute) but the call to newConnection() on the factory 
always returns with "Connection refused".

The log from the server do not indicate anything specific to this 
connection. 

Any hint where to look?

Y.

On Monday, March 19, 2012 6:20:06 AM UTC-4, Simon MacMullen wrote:
>
> On 19/03/12 00:12, Matthew Ward wrote:
> > Is there a work-around / when will the bug fix be available? This is a
> > pretty crippling bug when trying to handle fault tolerance.
>
> The bug I was referring to was just hiding the error message in the Java 
> client (and will be fixed in 2.8.0). You need to look in the server logs 
> to see what the server is objecting to.
>
> Cheers, Simon
>
>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120515/6a0022dc/attachment.htm>

From jframe at gmail.com  Wed May 16 01:28:49 2012
From: jframe at gmail.com (Jason Frame)
Date: Tue, 15 May 2012 17:28:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Transfering file from machine to machine
 using RabbitMQ
In-Reply-To: <CAMcAHLUSaY-tF9Cc3HdMq99fWn_RWAEYyPp3Xx-p0Y+tzKJSew@mail.gmail.com>
References: <25061768.2088.1337032570321.JavaMail.geo-discussion-forums@ynev2>
	<CAMcAHLUSaY-tF9Cc3HdMq99fWn_RWAEYyPp3Xx-p0Y+tzKJSew@mail.gmail.com>
Message-ID: <16712295.263.1337128129854.JavaMail.geo-discussion-forums@pbcoo5>

Thanks for the example!

On Tuesday, May 15, 2012 4:06:11 AM UTC-7, Alvaro Videla wrote:
>
> This example here does exactly that: 
> https://github.com/videlalvaro/php-amqplib/blob/master/PhpAmqpLib/Tests/Functional/FileTransferTest.php
>
> On Mon, May 14, 2012 at 11:56 PM, Jason Frame wrote:
>
>> I am still new and getting used to RabbitMQ, and was wondering the best 
>> way to send a small file along with a message. We are looking at using this 
>> to send a message on a server using PHP and consuming using a .net client. 
>>
>> Our typical message with have an associative array serialized to json, 
>> but for some of the messages, there will need to be an image or pdf file 
>> attached.  These files are relatively small (less than 20k) so they should 
>> not need to be chunked. I have been reading through the messages, and have 
>> not found any type of example or best practice on how to do this.
>>
>> thanks
>> jason
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120515/c3afa5f1/attachment.htm>

From prdpksingh at gmail.com  Wed May 16 05:09:38 2012
From: prdpksingh at gmail.com (Pradeep Singh)
Date: Tue, 15 May 2012 21:09:38 -0700 (PDT)
Subject: [rabbitmq-discuss] Options for querying bindings for an exchange
Message-ID: <21126163.400.1337141378498.JavaMail.geo-discussion-forums@pbcvm10>

What are my options if I wanted to query what all bindings are there on a 
topic exchange per topic? Is using the management http api the only option? 
Can I use any of the client libraries to do this? I just would like to 
avoid going through http considering I already have a connection open to 
the broker. I've been using pika.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120515/13743683/attachment.htm>

From prdpksingh at gmail.com  Wed May 16 07:19:55 2012
From: prdpksingh at gmail.com (Pradeep Singh)
Date: Tue, 15 May 2012 23:19:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Options for querying bindings for an exchange
In-Reply-To: <21126163.400.1337141378498.JavaMail.geo-discussion-forums@pbcvm10>
References: <21126163.400.1337141378498.JavaMail.geo-discussion-forums@pbcvm10>
Message-ID: <9463144.538.1337149195567.JavaMail.geo-discussion-forums@pbbnx3>

Actually, now I wonder if it's possible *even* with the management http 
api. Doesn't look like I can filter bindings based on routing key, can I?

On Tuesday, May 15, 2012 9:09:38 PM UTC-7, Pradeep Singh wrote:
>
> What are my options if I wanted to query what all bindings are there on a 
> topic exchange per topic? Is using the management http api the only option? 
> Can I use any of the client libraries to do this? I just would like to 
> avoid going through http considering I already have a connection open to 
> the broker. I've been using pika.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120515/bc53351b/attachment.htm>

From simon at rabbitmq.com  Wed May 16 10:46:19 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 16 May 2012 10:46:19 +0100
Subject: [rabbitmq-discuss] Reconnect to RabbitMQ broker
In-Reply-To: <21730213.244.1337111509091.JavaMail.geo-discussion-forums@ynbv35>
References: <26602465.2.1331779574134.JavaMail.geo-discussion-forums@pbgr4>	<4F61CD6C.4080006@rabbitmq.com>	<8574a318-6680-4bda-bdb3-c8c548e480ca@r2g2000pbs.googlegroups.com>	<4F670856.7070804@rabbitmq.com>
	<21730213.244.1337111509091.JavaMail.geo-discussion-forums@ynbv35>
Message-ID: <4FB3776B.50801@rabbitmq.com>

On 15/05/12 20:51, Y Latrous wrote:
> I'm having a similar issue described in this post. In my case, I'm
> getting "Connection refused" all the time. I use the same host and port
> number (and had to set the timeout to a minute) but the call to
> newConnection() on the factory always returns with "Connection refused".
>
> The log from the server do not indicate anything specific to this
> connection.
>
> Any hint where to look?

Well, "connection refused" means you are connecting to something that 
does not have port 5672 open. So either your broker is not running, or 
you are not connecting where you think you are.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed May 16 10:47:41 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 16 May 2012 10:47:41 +0100
Subject: [rabbitmq-discuss] Options for querying bindings for an exchange
In-Reply-To: <9463144.538.1337149195567.JavaMail.geo-discussion-forums@pbbnx3>
References: <21126163.400.1337141378498.JavaMail.geo-discussion-forums@pbcvm10>
	<9463144.538.1337149195567.JavaMail.geo-discussion-forums@pbbnx3>
Message-ID: <4FB377BD.20204@rabbitmq.com>

You can filter them in your app :)

But no, management and rabbitmqctl are the only way to list bindings (or 
anything really) - why does your app need to know about this? What are 
you trying to do?

Cheers, Simon

On 16/05/12 07:19, Pradeep Singh wrote:
> Actually, now I wonder if it's possible /even/ with the management http
> api. Doesn't look like I can filter bindings based on routing key, can I?
>
> On Tuesday, May 15, 2012 9:09:38 PM UTC-7, Pradeep Singh wrote:
>
>     What are my options if I wanted to query what all bindings are there
>     on a topic exchange per topic? Is using the management http api the
>     only option? Can I use any of the client libraries to do this? I
>     just would like to avoid going through http considering I already
>     have a connection open to the broker. I've been using pika.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Wed May 16 11:15:01 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 16 May 2012 11:15:01 +0100
Subject: [rabbitmq-discuss] question : how to speed up the worker ?
In-Reply-To: <4FB375F1.9020008@indoakses-online.com>
References: <4FB366FD.2040103@indoakses-online.com>	<CAMcAHLXvU2_Ru+wNLtmydMA=Yv0L2VoZh=UwPK_hba3aACNbhg@mail.gmail.com>	<4FB36A4C.50907@indoakses-online.com>	<4FB36B73.3050609@rabbitmq.com>	<CAMcAHLW1hGn+XkGnYUtQaJDFmc6p07OUKABrGk2Q4TKiKH9G-w@mail.gmail.com>
	<4FB36C68.5040401@rabbitmq.com>
	<4FB375F1.9020008@indoakses-online.com>
Message-ID: <4FB37E25.3070308@rabbitmq.com>

On 16/05/12 10:40, bino oetomo wrote:
> Dear All
> C/Q Tim and Alvaro
>
> On 05/16/2012 03:59 PM, Tim Watson wrote:
>> On 16/05/12 09:57, Alvaro Videla wrote:
>>> Hi,
>>>
>>> On Wed, May 16, 2012 at 10:55 AM, tim <tim at rabbitmq.com 
>>> <mailto:tim at rabbitmq.com>> wrote:
>>>
>>>     It kind of depends. If one consumer rejects a message then others
>>>     can pick it up. If you've set up a fanout exchange, then obviously
>>>     this will happen all the time. You can also run into this scenario
>>>     when running federation.
>>>
>>>
>>> I think for his use case fanout doesn't matter since we are talking 
>>> about many workers to the same queue, not many queues to one exchange.
>>
>> Yes you're absolutely right - I was thinking more generally than his 
>> specific example. As you mentioned, the reject scenario is the main 
>> one to think about here.
>>
> Is there any potential conflict/problem when I use multi-worker that 
> can do 'reject' ?
>

Not really. Once a message has been delivered to a worker, it won't be 
seen by any other worker unless it is rejected and re-queued or the 
worker dies without sending an ACK. HTH.

Tim


From ask at rabbitmq.com  Wed May 16 12:55:34 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Wed, 16 May 2012 12:55:34 +0100
Subject: [rabbitmq-discuss] RabbitMQ with djcelery and rabbitmqctl
	list_queues
In-Reply-To: <CAHPGP1Fw9X7YUzSJx86e9diXXSpRMj_5BmvRw-iPgcwBaJh-FA@mail.gmail.com>
References: <CAHPGP1Fw9X7YUzSJx86e9diXXSpRMj_5BmvRw-iPgcwBaJh-FA@mail.gmail.com>
Message-ID: <FEA89AB6-DAFA-4D66-8478-7EA665813767@rabbitmq.com>


On 15 May 2012, at 00:44, Matt Black wrote:

> Hello,
> 
> My application is currently receiving a lot of traffic, and generating a lot of celery processes. I can see these in my application logs as events are occurring.
> 
> When I run rabbitmqctl list_queues I would expect this to show a number other than zero - but this not the case. I've now stopped any incoming connections to the rabbit server and still the application log is busy with celery tasks.
> 
> Can someone suggest why rabbitmqctl lists nothing in the queue? What alternate approaches do I have for monitoring the task load on this server?
> 
>> sudo rabbitmqctl list_queues name messages_ready messages_unacknowledged messages consumersListing queues ...
> celery  0       0       0       0
> ...done.
> 

Are you sure you are using rabbitmqctl with the correct virtual host?

The default is /, but you can use a different vhost by specifying the -p option:

  $ rabbitmqctl list_queues -p /other


From q4break at gmail.com  Wed May 16 12:58:15 2012
From: q4break at gmail.com (=?UTF-8?Q?Cosmin_Lu=C8=9B=C4=83?=)
Date: Wed, 16 May 2012 04:58:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Weird ansible-playbook behaviour when trying to
 start rabbitmq-server 2.8.2
Message-ID: <11115824.358.1337169495435.JavaMail.geo-discussion-forums@vbk4>

Hello,

Please allow me to cross reference this thread<https://groups.google.com/forum/#%21topic/ansible-project/9XKZoqsshE0>; I'm trying to install and start rabbitmq-server 2.8.2 (installed from a 
Debian package) using ansible (a tool that connects to remote machines 
using SSH and can performs various administrative tasks). 
Does anyone have an idea what has changed in the initialization scripts of 
rabbitmq since version 2.7.1 upwards that could cause the mentioned 
behaviour? 

Best regards,
Cosmin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120516/271f52c2/attachment.htm>

From simon at rabbitmq.com  Wed May 16 13:27:54 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 16 May 2012 13:27:54 +0100
Subject: [rabbitmq-discuss] Weird ansible-playbook behaviour when trying
 to start rabbitmq-server 2.8.2
In-Reply-To: <11115824.358.1337169495435.JavaMail.geo-discussion-forums@vbk4>
References: <11115824.358.1337169495435.JavaMail.geo-discussion-forums@vbk4>
Message-ID: <4FB39D4A.2070008@rabbitmq.com>

On 16/05/12 12:58, Cosmin Lu?? wrote:
> Hello,
>
> Please allow me to cross reference this thread
> <https://groups.google.com/forum/#%21topic/ansible-project/9XKZoqsshE0>
> ; I'm trying to install and start rabbitmq-server 2.8.2 (installed from
> a Debian package) using ansible (a tool that connects to remote machines
> using SSH and can performs various administrative tasks).
> Does anyone have an idea what has changed in the initialization scripts
> of rabbitmq since version 2.7.1 upwards that could cause the mentioned
> behaviour?

We changed a couple of things in the init script, mainly using 
start-stop-daemon instead of su to change the user, and using lsb-base 
functions instead of echo.

I can't reproduce what Michael DeHaan says over in the other thread:

> Ok, so the rabbitmq script sounds like it cares very much about the
> current directory, and when the current directory is gone, it blows
> up.   Please take this up with whoever maintains the distro init
> script, because it's doing stupid things
> and it should not care anything about the directory you first ran
> /sbin/service in.

I tried this from a deleted directory:

$ sudo service rabbitmq-server stop
sudo: cannot get working directory
sh: getcwd() failed: No such file or directory
  * Stopping message broker rabbitmq-server            [ OK ]

$ sudo service rabbitmq-server start
sudo: cannot get working directory
sh: getcwd() failed: No such file or directory
  * Starting message broker rabbitmq-server            [ OK ]

...and it worked fine. So I am not sure what's up here. If we are doing 
stupid things I would like to fix them, but I'm not sure we are.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mrtnlstr at gmail.com  Wed May 16 13:24:49 2012
From: mrtnlstr at gmail.com (mrtn)
Date: Wed, 16 May 2012 05:24:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Cannot start or stop RabbitMQ using rabbitmqctl
Message-ID: <806061f9-0694-4e04-ab4b-5ecb789b0458@w13g2000vbc.googlegroups.com>


Hi,

I installed the latest RabbitMQ via macports on OS X 10.6.8, and have
been trying to run it on localhost. However, after I started the
server using 'sudo rabbitmq-server -detached', I cannot stop the
server/node, nor can I start a new one (as expected). Below is the
output: first, I try to start a new server but failed because there is
already running; second, I then try to stop the existing server/node
but get told it is already down. Can anyone point out what is going on
here?!

mrtn:MyLab mrtn$ sudo rabbitmq-server -detached
Activating RabbitMQ plugins ...
0 plugins activated:

node with name "rabbit" already running on "h002"

DIAGNOSTICS
===========

nodes in question: [rabbit at h002]

hosts, their running nodes and ports:
- h002: [{rabbit,62428},{rabbitmqprelaunch12073,54048}]

current node details:
- node name: rabbitmqprelaunch12073 at h002
- home dir: /opt/local/var/lib/rabbitmq
- cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==

mrtn:MyLab mrtn$ sudo rabbitmqctl stop
Stopping and halting node rabbit at h002 ...
Error: unable to connect to node rabbit at h002: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at h002]

hosts, their running nodes and ports:
- h002: [{rabbit,62428},{rabbitmqctl12108,54053}]

current node details:
- node name: rabbitmqctl12108 at h002
- home dir: /opt/local/var/lib/rabbitmq
- cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==

From tim at rabbitmq.com  Wed May 16 13:42:39 2012
From: tim at rabbitmq.com (tim)
Date: Wed, 16 May 2012 13:42:39 +0100
Subject: [rabbitmq-discuss] Cannot start or stop RabbitMQ using
	rabbitmqctl
In-Reply-To: <806061f9-0694-4e04-ab4b-5ecb789b0458@w13g2000vbc.googlegroups.com>
References: <806061f9-0694-4e04-ab4b-5ecb789b0458@w13g2000vbc.googlegroups.com>
Message-ID: <4FB3A0BF.3080802@rabbitmq.com>

On 16/05/2012 13:24, mrtn wrote:
>
> Hi,
>
> I installed the latest RabbitMQ via macports on OS X 10.6.8, and have
> been trying to run it on localhost. However, after I started the
> server using 'sudo rabbitmq-server -detached', I cannot stop the
> server/node, nor can I start a new one (as expected). Below is the
> output: first, I try to start a new server but failed because there is
> already running; second, I then try to stop the existing server/node
> but get told it is already down. Can anyone point out what is going on
> here?!
>
> mrtn:MyLab mrtn$ sudo rabbitmq-server -detached
> Activating RabbitMQ plugins ...
> 0 plugins activated:
>
> node with name "rabbit" already running on "h002"
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit at h002]
>
> hosts, their running nodes and ports:
> - h002: [{rabbit,62428},{rabbitmqprelaunch12073,54048}]
>
> current node details:
> - node name: rabbitmqprelaunch12073 at h002
> - home dir: /opt/local/var/lib/rabbitmq
> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>
> mrtn:MyLab mrtn$ sudo rabbitmqctl stop
> Stopping and halting node rabbit at h002 ...
> Error: unable to connect to node rabbit at h002: nodedown
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit at h002]
>
> hosts, their running nodes and ports:
> - h002: [{rabbit,62428},{rabbitmqctl12108,54053}]
>
> current node details:
> - node name: rabbitmqctl12108 at h002
> - home dir: /opt/local/var/lib/rabbitmq
> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Is the existing rabbit running with the same Erlang cookie as the new 
one? The cookie hash produced by rabbitmqctl is for the current node, 
not the one you're attempting to contact.

The list of nodes/ports on the given host indicates which Erlang nodes 
are up, but not necessarily whether they're allowed to connect to or 
not. Check your cookie and let us know how you get on.

Tim

From mrtnlstr at gmail.com  Wed May 16 14:14:11 2012
From: mrtnlstr at gmail.com (Merton Lister)
Date: Wed, 16 May 2012 09:14:11 -0400
Subject: [rabbitmq-discuss] Cannot start or stop RabbitMQ using
	rabbitmqctl
In-Reply-To: <4FB3A0BF.3080802@rabbitmq.com>
References: <806061f9-0694-4e04-ab4b-5ecb789b0458@w13g2000vbc.googlegroups.com>
	<4FB3A0BF.3080802@rabbitmq.com>
Message-ID: <CALM-h96hhximxw9YgnmUML=jf-7NrnrZ0JSOcg7+Dgv9AFwBuw@mail.gmail.com>

Hi Tim,

Thanks for getting back to me. I am new to rabbitmq so not very familiar
with the details you're asking for.

Here is what I see in /opt/local/var/lib/rabbitmq/.erlang.cookie:

QFZXZBPOMTJNACQIMJOT

and sudo rabbitmqctl status gives me:

Status of node rabbit at h002 ...
Error: unable to connect to node rabbit at h002: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at h002]

hosts, their running nodes and ports:
- h002: [{rabbit,62428},{rabbitmqctl12565,55147}]

current node details:
- node name: rabbitmqctl12565 at h002
- home dir: /opt/local/var/lib/rabbitmq
- cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==

I installed rabbitmq by following the instructions given here:
http://www.rabbitmq.com/install-macports.html, after which I ran sudo
rabbitmq-server -detached to start the server. Now I want to stop the
server using sudo rabbitmqctl stop, but it simply does not allow me to do
so by the looks of it.

I wonder what causes this kind of behavior? Am I running *multiple*
rabbitmq servers/nodes on my machine now, and somehow I am not allowed to
access some of them? Your help is much appreciated. Thanks.



Best,
Merton

On Wed, May 16, 2012 at 8:42 AM, tim <tim at rabbitmq.com> wrote:

> On 16/05/2012 13:24, mrtn wrote:
>
>>
>> Hi,
>>
>> I installed the latest RabbitMQ via macports on OS X 10.6.8, and have
>> been trying to run it on localhost. However, after I started the
>> server using 'sudo rabbitmq-server -detached', I cannot stop the
>> server/node, nor can I start a new one (as expected). Below is the
>> output: first, I try to start a new server but failed because there is
>> already running; second, I then try to stop the existing server/node
>> but get told it is already down. Can anyone point out what is going on
>> here?!
>>
>> mrtn:MyLab mrtn$ sudo rabbitmq-server -detached
>> Activating RabbitMQ plugins ...
>> 0 plugins activated:
>>
>> node with name "rabbit" already running on "h002"
>>
>> DIAGNOSTICS
>> ===========
>>
>> nodes in question: [rabbit at h002]
>>
>> hosts, their running nodes and ports:
>> - h002: [{rabbit,62428},{**rabbitmqprelaunch12073,54048}]
>>
>> current node details:
>> - node name: rabbitmqprelaunch12073 at h002
>> - home dir: /opt/local/var/lib/rabbitmq
>> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>>
>> mrtn:MyLab mrtn$ sudo rabbitmqctl stop
>> Stopping and halting node rabbit at h002 ...
>> Error: unable to connect to node rabbit at h002: nodedown
>>
>> DIAGNOSTICS
>> ===========
>>
>> nodes in question: [rabbit at h002]
>>
>> hosts, their running nodes and ports:
>> - h002: [{rabbit,62428},{**rabbitmqctl12108,54053}]
>>
>> current node details:
>> - node name: rabbitmqctl12108 at h002
>> - home dir: /opt/local/var/lib/rabbitmq
>> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
> Is the existing rabbit running with the same Erlang cookie as the new one?
> The cookie hash produced by rabbitmqctl is for the current node, not the
> one you're attempting to contact.
>
> The list of nodes/ports on the given host indicates which Erlang nodes are
> up, but not necessarily whether they're allowed to connect to or not. Check
> your cookie and let us know how you get on.
>
> Tim
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120516/e6515d3c/attachment.htm>

From videlalvaro at gmail.com  Wed May 16 14:28:48 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 16 May 2012 15:28:48 +0200
Subject: [rabbitmq-discuss] Cannot start or stop RabbitMQ using
	rabbitmqctl
In-Reply-To: <CALM-h96hhximxw9YgnmUML=jf-7NrnrZ0JSOcg7+Dgv9AFwBuw@mail.gmail.com>
References: <806061f9-0694-4e04-ab4b-5ecb789b0458@w13g2000vbc.googlegroups.com>
	<4FB3A0BF.3080802@rabbitmq.com>
	<CALM-h96hhximxw9YgnmUML=jf-7NrnrZ0JSOcg7+Dgv9AFwBuw@mail.gmail.com>
Message-ID: <CAMcAHLVHKKhfPi920yQL-DF6VUN=jVRTw9x3jvU0PCOOTh7sWg@mail.gmail.com>

Hi,

Basically the erlang.cookie belongs to a particular user. So the Erlang
will load the cookie of the user running the commands rabbitmqctl,
rabbitmq-server and so on.

So if you want to gracefully stop that node you need to run *rabbitmqctl
stop* with the same user that is running your current rabbitmq process.

To find that user try running: *ps aux | grep rabbit*

-Alvaro

On Wed, May 16, 2012 at 3:14 PM, Merton Lister <mrtnlstr at gmail.com> wrote:

> Hi Tim,
>
> Thanks for getting back to me. I am new to rabbitmq so not very familiar
> with the details you're asking for.
>
> Here is what I see in /opt/local/var/lib/rabbitmq/.erlang.cookie:
>
> QFZXZBPOMTJNACQIMJOT
>
> and sudo rabbitmqctl status gives me:
>
> Status of node rabbit at h002 ...
> Error: unable to connect to node rabbit at h002: nodedown
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit at h002]
>
> hosts, their running nodes and ports:
> - h002: [{rabbit,62428},{rabbitmqctl12565,55147}]
>
> current node details:
> - node name: rabbitmqctl12565 at h002
> - home dir: /opt/local/var/lib/rabbitmq
> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>
> I installed rabbitmq by following the instructions given here:
> http://www.rabbitmq.com/install-macports.html, after which I ran sudo
> rabbitmq-server -detached to start the server. Now I want to stop the
> server using sudo rabbitmqctl stop, but it simply does not allow me to do
> so by the looks of it.
>
> I wonder what causes this kind of behavior? Am I running *multiple*
> rabbitmq servers/nodes on my machine now, and somehow I am not allowed to
> access some of them? Your help is much appreciated. Thanks.
>
>
>
> Best,
> Merton
>
> On Wed, May 16, 2012 at 8:42 AM, tim <tim at rabbitmq.com> wrote:
>
>> On 16/05/2012 13:24, mrtn wrote:
>>
>>>
>>> Hi,
>>>
>>> I installed the latest RabbitMQ via macports on OS X 10.6.8, and have
>>> been trying to run it on localhost. However, after I started the
>>> server using 'sudo rabbitmq-server -detached', I cannot stop the
>>> server/node, nor can I start a new one (as expected). Below is the
>>> output: first, I try to start a new server but failed because there is
>>> already running; second, I then try to stop the existing server/node
>>> but get told it is already down. Can anyone point out what is going on
>>> here?!
>>>
>>> mrtn:MyLab mrtn$ sudo rabbitmq-server -detached
>>> Activating RabbitMQ plugins ...
>>> 0 plugins activated:
>>>
>>> node with name "rabbit" already running on "h002"
>>>
>>> DIAGNOSTICS
>>> ===========
>>>
>>> nodes in question: [rabbit at h002]
>>>
>>> hosts, their running nodes and ports:
>>> - h002: [{rabbit,62428},{**rabbitmqprelaunch12073,54048}]
>>>
>>> current node details:
>>> - node name: rabbitmqprelaunch12073 at h002
>>> - home dir: /opt/local/var/lib/rabbitmq
>>> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>>>
>>> mrtn:MyLab mrtn$ sudo rabbitmqctl stop
>>> Stopping and halting node rabbit at h002 ...
>>> Error: unable to connect to node rabbit at h002: nodedown
>>>
>>> DIAGNOSTICS
>>> ===========
>>>
>>> nodes in question: [rabbit at h002]
>>>
>>> hosts, their running nodes and ports:
>>> - h002: [{rabbit,62428},{**rabbitmqctl12108,54053}]
>>>
>>> current node details:
>>> - node name: rabbitmqctl12108 at h002
>>> - home dir: /opt/local/var/lib/rabbitmq
>>> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>>> ______________________________**_________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>>
>>
>> Is the existing rabbit running with the same Erlang cookie as the new
>> one? The cookie hash produced by rabbitmqctl is for the current node, not
>> the one you're attempting to contact.
>>
>> The list of nodes/ports on the given host indicates which Erlang nodes
>> are up, but not necessarily whether they're allowed to connect to or not.
>> Check your cookie and let us know how you get on.
>>
>> Tim
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120516/1a0bbd22/attachment.htm>

From videlalvaro at gmail.com  Wed May 16 15:55:35 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 16 May 2012 16:55:35 +0200
Subject: [rabbitmq-discuss] Cannot start or stop RabbitMQ using
	rabbitmqctl
In-Reply-To: <CALM-h97RoN_93DbEpcZ_TDOk-aN=xJ8Wg0wf8=TiNNmde=WOsg@mail.gmail.com>
References: <806061f9-0694-4e04-ab4b-5ecb789b0458@w13g2000vbc.googlegroups.com>
	<4FB3A0BF.3080802@rabbitmq.com>
	<CALM-h96hhximxw9YgnmUML=jf-7NrnrZ0JSOcg7+Dgv9AFwBuw@mail.gmail.com>
	<CAMcAHLVHKKhfPi920yQL-DF6VUN=jVRTw9x3jvU0PCOOTh7sWg@mail.gmail.com>
	<CALM-h97RoN_93DbEpcZ_TDOk-aN=xJ8Wg0wf8=TiNNmde=WOsg@mail.gmail.com>
Message-ID: <CAMcAHLUm9m=WvwR3oXkskqmeaYDZpqbZQeg736KijYPtN=b4EQ@mail.gmail.com>

No idea :) Maybe you installed rabbitmq before and that installer created
that user?

Anyway? just do *sudo -u rabbitmq rabbitmqctl stop*

-Alvaro

On Wed, May 16, 2012 at 4:52 PM, Merton Lister <mrtnlstr at gmail.com> wrote:

> Hi Alvaro,
>
> Thanks for the pointer. This is my output:
>
> rabbitmq  5991   0.4  0.2  2492192  16184   ??  S     4:05PM   1:56.45
> /opt/local/lib/erlang/erts-5.9/bin/beam.smp -W w -K true -A30 -P 1048576 --
> -root /opt/local/lib/erlang -progname erl -- -home
> /opt/local/var/lib/rabbitmq -- -noshell -noinput -sname rabbit at mrtn-1-boot /opt/local/var/lib/rabbitmq/mnesia/rabbit at mrtn-1-plugins-expand/rabbit
> -kernel inet_default_connect_options [{nodelay,true}] -sasl errlog_type
> error -sasl sasl_error_logger false -rabbit error_logger
> {file,"/opt/local/var/log/rabbitmq/rabbit at mrtn-1.log"} -rabbit
> sasl_error_logger {file,"/opt/local/var/log/rabbitmq/rabbit at mrtn-1-sasl.log"}
> -os_mon start_cpu_sup false -os_mon start_disksup false -os_mon
> start_memsup false -mnesia dir
> "/opt/local/var/lib/rabbitmq/mnesia/rabbit at mrtn-1" -noshell -noinput
> mrtn     13062   0.0  0.0  2435120    528 s000  R+    9:57AM   0:00.00
> grep rabbit
> rabbitmq  6005   0.0  0.0  2435000    108   ??  S     4:05PM   0:00.00
> inet_gethost 4
> rabbitmq  6004   0.0  0.0  2434996    396   ??  Ss    4:05PM   0:00.01
> inet_gethost 4
> rabbitmq  5980   0.0  0.0  2435000    224   ??  S     4:05PM   0:00.50
> /opt/local/lib/erlang/erts-5.9/bin/epmd -daemon
>
> Strangely, why do I have a user named 'rabbitmq'?!
>
> On Wed, May 16, 2012 at 9:28 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:
>
>> Hi,
>>
>> Basically the erlang.cookie belongs to a particular user. So the Erlang
>> will load the cookie of the user running the commands rabbitmqctl,
>> rabbitmq-server and so on.
>>
>> So if you want to gracefully stop that node you need to run *rabbitmqctl
>> stop* with the same user that is running your current rabbitmq process.
>>
>> To find that user try running: *ps aux | grep rabbit*
>>
>> -Alvaro
>>
>>
>> On Wed, May 16, 2012 at 3:14 PM, Merton Lister <mrtnlstr at gmail.com>wrote:
>>
>>> Hi Tim,
>>>
>>> Thanks for getting back to me. I am new to rabbitmq so not very familiar
>>> with the details you're asking for.
>>>
>>> Here is what I see in /opt/local/var/lib/rabbitmq/.erlang.cookie:
>>>
>>> QFZXZBPOMTJNACQIMJOT
>>>
>>> and sudo rabbitmqctl status gives me:
>>>
>>> Status of node rabbit at h002 ...
>>> Error: unable to connect to node rabbit at h002: nodedown
>>>
>>> DIAGNOSTICS
>>> ===========
>>>
>>> nodes in question: [rabbit at h002]
>>>
>>> hosts, their running nodes and ports:
>>> - h002: [{rabbit,62428},{rabbitmqctl12565,55147}]
>>>
>>> current node details:
>>> - node name: rabbitmqctl12565 at h002
>>>  - home dir: /opt/local/var/lib/rabbitmq
>>> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>>>
>>> I installed rabbitmq by following the instructions given here:
>>> http://www.rabbitmq.com/install-macports.html, after which I ran sudo
>>> rabbitmq-server -detached to start the server. Now I want to stop the
>>> server using sudo rabbitmqctl stop, but it simply does not allow me to
>>> do so by the looks of it.
>>>
>>> I wonder what causes this kind of behavior? Am I running *multiple*
>>> rabbitmq servers/nodes on my machine now, and somehow I am not allowed to
>>> access some of them? Your help is much appreciated. Thanks.
>>>
>>>
>>>
>>> Best,
>>> Merton
>>>
>>> On Wed, May 16, 2012 at 8:42 AM, tim <tim at rabbitmq.com> wrote:
>>>
>>>> On 16/05/2012 13:24, mrtn wrote:
>>>>
>>>>>
>>>>> Hi,
>>>>>
>>>>> I installed the latest RabbitMQ via macports on OS X 10.6.8, and have
>>>>> been trying to run it on localhost. However, after I started the
>>>>> server using 'sudo rabbitmq-server -detached', I cannot stop the
>>>>> server/node, nor can I start a new one (as expected). Below is the
>>>>> output: first, I try to start a new server but failed because there is
>>>>> already running; second, I then try to stop the existing server/node
>>>>> but get told it is already down. Can anyone point out what is going on
>>>>> here?!
>>>>>
>>>>> mrtn:MyLab mrtn$ sudo rabbitmq-server -detached
>>>>> Activating RabbitMQ plugins ...
>>>>> 0 plugins activated:
>>>>>
>>>>> node with name "rabbit" already running on "h002"
>>>>>
>>>>> DIAGNOSTICS
>>>>> ===========
>>>>>
>>>>> nodes in question: [rabbit at h002]
>>>>>
>>>>> hosts, their running nodes and ports:
>>>>> - h002: [{rabbit,62428},{**rabbitmqprelaunch12073,54048}]
>>>>>
>>>>> current node details:
>>>>> - node name: rabbitmqprelaunch12073 at h002
>>>>> - home dir: /opt/local/var/lib/rabbitmq
>>>>> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>>>>>
>>>>> mrtn:MyLab mrtn$ sudo rabbitmqctl stop
>>>>> Stopping and halting node rabbit at h002 ...
>>>>> Error: unable to connect to node rabbit at h002: nodedown
>>>>>
>>>>> DIAGNOSTICS
>>>>> ===========
>>>>>
>>>>> nodes in question: [rabbit at h002]
>>>>>
>>>>> hosts, their running nodes and ports:
>>>>> - h002: [{rabbit,62428},{**rabbitmqctl12108,54053}]
>>>>>
>>>>> current node details:
>>>>> - node name: rabbitmqctl12108 at h002
>>>>> - home dir: /opt/local/var/lib/rabbitmq
>>>>> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>>>>> ______________________________**_________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>>>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>>>>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>>>>
>>>>
>>>> Is the existing rabbit running with the same Erlang cookie as the new
>>>> one? The cookie hash produced by rabbitmqctl is for the current node, not
>>>> the one you're attempting to contact.
>>>>
>>>> The list of nodes/ports on the given host indicates which Erlang nodes
>>>> are up, but not necessarily whether they're allowed to connect to or not.
>>>> Check your cookie and let us know how you get on.
>>>>
>>>> Tim
>>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120516/127671ec/attachment.htm>

From demetree at gmail.com  Wed May 16 16:13:42 2012
From: demetree at gmail.com (Demetree)
Date: Wed, 16 May 2012 08:13:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Orphaned RabbitMQ Connections Problem Causing
 Client to Not Communicate With Server
Message-ID: <44b177d5-fa27-42b6-adc5-a983981556c5@e9g2000pbh.googlegroups.com>

Hi,

I'm having an issue with our rabbit servers where one of our sites
cannot consistenly hold connections ( or so it seems ).  The symptom
is that the Rabbit MQ server shows multiple connections on multiple
ports, but they don't correspond to connections on the clients.
Netstats show a single connection on the client side.

When this situation arises, the clients no longer pull data down from
the queue.

We're not able to resolve this, and the logs show SSL errors, but this
also occurs on non-SSL connections.

Has anybody experienced this before, and have any suggestions?


We are connecting to the server with a  Java client.


Thanks for any input.


Demetree

From mrtnlstr at gmail.com  Wed May 16 15:52:43 2012
From: mrtnlstr at gmail.com (Merton Lister)
Date: Wed, 16 May 2012 10:52:43 -0400
Subject: [rabbitmq-discuss] Cannot start or stop RabbitMQ using
	rabbitmqctl
In-Reply-To: <CAMcAHLVHKKhfPi920yQL-DF6VUN=jVRTw9x3jvU0PCOOTh7sWg@mail.gmail.com>
References: <806061f9-0694-4e04-ab4b-5ecb789b0458@w13g2000vbc.googlegroups.com>
	<4FB3A0BF.3080802@rabbitmq.com>
	<CALM-h96hhximxw9YgnmUML=jf-7NrnrZ0JSOcg7+Dgv9AFwBuw@mail.gmail.com>
	<CAMcAHLVHKKhfPi920yQL-DF6VUN=jVRTw9x3jvU0PCOOTh7sWg@mail.gmail.com>
Message-ID: <CALM-h97RoN_93DbEpcZ_TDOk-aN=xJ8Wg0wf8=TiNNmde=WOsg@mail.gmail.com>

Hi Alvaro,

Thanks for the pointer. This is my output:

rabbitmq  5991   0.4  0.2  2492192  16184   ??  S     4:05PM   1:56.45
/opt/local/lib/erlang/erts-5.9/bin/beam.smp -W w -K true -A30 -P 1048576 --
-root /opt/local/lib/erlang -progname erl -- -home
/opt/local/var/lib/rabbitmq -- -noshell -noinput -sname rabbit at mrtn-1 -boot
/opt/local/var/lib/rabbitmq/mnesia/rabbit at mrtn-1-plugins-expand/rabbit
-kernel inet_default_connect_options [{nodelay,true}] -sasl errlog_type
error -sasl sasl_error_logger false -rabbit error_logger
{file,"/opt/local/var/log/rabbitmq/rabbit at mrtn-1.log"} -rabbit
sasl_error_logger {file,"/opt/local/var/log/rabbitmq/rabbit at mrtn-1-sasl.log"}
-os_mon start_cpu_sup false -os_mon start_disksup false -os_mon
start_memsup false -mnesia dir
"/opt/local/var/lib/rabbitmq/mnesia/rabbit at mrtn-1" -noshell -noinput
mrtn     13062   0.0  0.0  2435120    528 s000  R+    9:57AM   0:00.00 grep
rabbit
rabbitmq  6005   0.0  0.0  2435000    108   ??  S     4:05PM   0:00.00
inet_gethost 4
rabbitmq  6004   0.0  0.0  2434996    396   ??  Ss    4:05PM   0:00.01
inet_gethost 4
rabbitmq  5980   0.0  0.0  2435000    224   ??  S     4:05PM   0:00.50
/opt/local/lib/erlang/erts-5.9/bin/epmd -daemon

Strangely, why do I have a user named 'rabbitmq'?!

On Wed, May 16, 2012 at 9:28 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi,
>
> Basically the erlang.cookie belongs to a particular user. So the Erlang
> will load the cookie of the user running the commands rabbitmqctl,
> rabbitmq-server and so on.
>
> So if you want to gracefully stop that node you need to run *rabbitmqctl
> stop* with the same user that is running your current rabbitmq process.
>
> To find that user try running: *ps aux | grep rabbit*
>
> -Alvaro
>
>
> On Wed, May 16, 2012 at 3:14 PM, Merton Lister <mrtnlstr at gmail.com> wrote:
>
>> Hi Tim,
>>
>> Thanks for getting back to me. I am new to rabbitmq so not very familiar
>> with the details you're asking for.
>>
>> Here is what I see in /opt/local/var/lib/rabbitmq/.erlang.cookie:
>>
>> QFZXZBPOMTJNACQIMJOT
>>
>> and sudo rabbitmqctl status gives me:
>>
>> Status of node rabbit at h002 ...
>> Error: unable to connect to node rabbit at h002: nodedown
>>
>> DIAGNOSTICS
>> ===========
>>
>> nodes in question: [rabbit at h002]
>>
>> hosts, their running nodes and ports:
>> - h002: [{rabbit,62428},{rabbitmqctl12565,55147}]
>>
>> current node details:
>> - node name: rabbitmqctl12565 at h002
>>  - home dir: /opt/local/var/lib/rabbitmq
>> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>>
>> I installed rabbitmq by following the instructions given here:
>> http://www.rabbitmq.com/install-macports.html, after which I ran sudo
>> rabbitmq-server -detached to start the server. Now I want to stop the
>> server using sudo rabbitmqctl stop, but it simply does not allow me to
>> do so by the looks of it.
>>
>> I wonder what causes this kind of behavior? Am I running *multiple*
>> rabbitmq servers/nodes on my machine now, and somehow I am not allowed to
>> access some of them? Your help is much appreciated. Thanks.
>>
>>
>>
>> Best,
>> Merton
>>
>> On Wed, May 16, 2012 at 8:42 AM, tim <tim at rabbitmq.com> wrote:
>>
>>> On 16/05/2012 13:24, mrtn wrote:
>>>
>>>>
>>>> Hi,
>>>>
>>>> I installed the latest RabbitMQ via macports on OS X 10.6.8, and have
>>>> been trying to run it on localhost. However, after I started the
>>>> server using 'sudo rabbitmq-server -detached', I cannot stop the
>>>> server/node, nor can I start a new one (as expected). Below is the
>>>> output: first, I try to start a new server but failed because there is
>>>> already running; second, I then try to stop the existing server/node
>>>> but get told it is already down. Can anyone point out what is going on
>>>> here?!
>>>>
>>>> mrtn:MyLab mrtn$ sudo rabbitmq-server -detached
>>>> Activating RabbitMQ plugins ...
>>>> 0 plugins activated:
>>>>
>>>> node with name "rabbit" already running on "h002"
>>>>
>>>> DIAGNOSTICS
>>>> ===========
>>>>
>>>> nodes in question: [rabbit at h002]
>>>>
>>>> hosts, their running nodes and ports:
>>>> - h002: [{rabbit,62428},{**rabbitmqprelaunch12073,54048}]
>>>>
>>>> current node details:
>>>> - node name: rabbitmqprelaunch12073 at h002
>>>> - home dir: /opt/local/var/lib/rabbitmq
>>>> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>>>>
>>>> mrtn:MyLab mrtn$ sudo rabbitmqctl stop
>>>> Stopping and halting node rabbit at h002 ...
>>>> Error: unable to connect to node rabbit at h002: nodedown
>>>>
>>>> DIAGNOSTICS
>>>> ===========
>>>>
>>>> nodes in question: [rabbit at h002]
>>>>
>>>> hosts, their running nodes and ports:
>>>> - h002: [{rabbit,62428},{**rabbitmqctl12108,54053}]
>>>>
>>>> current node details:
>>>> - node name: rabbitmqctl12108 at h002
>>>> - home dir: /opt/local/var/lib/rabbitmq
>>>> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>>>> ______________________________**_________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>>>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>>>
>>>
>>> Is the existing rabbit running with the same Erlang cookie as the new
>>> one? The cookie hash produced by rabbitmqctl is for the current node, not
>>> the one you're attempting to contact.
>>>
>>> The list of nodes/ports on the given host indicates which Erlang nodes
>>> are up, but not necessarily whether they're allowed to connect to or not.
>>> Check your cookie and let us know how you get on.
>>>
>>> Tim
>>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120516/4b9d1a44/attachment.htm>

From mrtnlstr at gmail.com  Wed May 16 16:29:51 2012
From: mrtnlstr at gmail.com (Merton Lister)
Date: Wed, 16 May 2012 11:29:51 -0400
Subject: [rabbitmq-discuss] Cannot start or stop RabbitMQ using
	rabbitmqctl
In-Reply-To: <CAMcAHLUm9m=WvwR3oXkskqmeaYDZpqbZQeg736KijYPtN=b4EQ@mail.gmail.com>
References: <806061f9-0694-4e04-ab4b-5ecb789b0458@w13g2000vbc.googlegroups.com>
	<4FB3A0BF.3080802@rabbitmq.com>
	<CALM-h96hhximxw9YgnmUML=jf-7NrnrZ0JSOcg7+Dgv9AFwBuw@mail.gmail.com>
	<CAMcAHLVHKKhfPi920yQL-DF6VUN=jVRTw9x3jvU0PCOOTh7sWg@mail.gmail.com>
	<CALM-h97RoN_93DbEpcZ_TDOk-aN=xJ8Wg0wf8=TiNNmde=WOsg@mail.gmail.com>
	<CAMcAHLUm9m=WvwR3oXkskqmeaYDZpqbZQeg736KijYPtN=b4EQ@mail.gmail.com>
Message-ID: <CALM-h94gQ=mXUHzgmQshLo9WdS_in6=byNOBNC-+_G9oi=ruyA@mail.gmail.com>

Thanks a lot.

On Wed, May 16, 2012 at 10:55 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> No idea :) Maybe you installed rabbitmq before and that installer created
> that user?
>
> Anyway? just do *sudo -u rabbitmq rabbitmqctl stop*
>
> -Alvaro
>
> On Wed, May 16, 2012 at 4:52 PM, Merton Lister <mrtnlstr at gmail.com> wrote:
>
>> Hi Alvaro,
>>
>> Thanks for the pointer. This is my output:
>>
>> rabbitmq  5991   0.4  0.2  2492192  16184   ??  S     4:05PM   1:56.45
>> /opt/local/lib/erlang/erts-5.9/bin/beam.smp -W w -K true -A30 -P 1048576 --
>> -root /opt/local/lib/erlang -progname erl -- -home
>> /opt/local/var/lib/rabbitmq -- -noshell -noinput -sname rabbit at mrtn-1-boot /opt/local/var/lib/rabbitmq/mnesia/rabbit at mrtn-1-plugins-expand/rabbit
>> -kernel inet_default_connect_options [{nodelay,true}] -sasl errlog_type
>> error -sasl sasl_error_logger false -rabbit error_logger
>> {file,"/opt/local/var/log/rabbitmq/rabbit at mrtn-1.log"} -rabbit
>> sasl_error_logger {file,"/opt/local/var/log/rabbitmq/rabbit at mrtn-1-sasl.log"}
>> -os_mon start_cpu_sup false -os_mon start_disksup false -os_mon
>> start_memsup false -mnesia dir
>> "/opt/local/var/lib/rabbitmq/mnesia/rabbit at mrtn-1" -noshell -noinput
>> mrtn     13062   0.0  0.0  2435120    528 s000  R+    9:57AM   0:00.00
>> grep rabbit
>> rabbitmq  6005   0.0  0.0  2435000    108   ??  S     4:05PM   0:00.00
>> inet_gethost 4
>> rabbitmq  6004   0.0  0.0  2434996    396   ??  Ss    4:05PM   0:00.01
>> inet_gethost 4
>> rabbitmq  5980   0.0  0.0  2435000    224   ??  S     4:05PM   0:00.50
>> /opt/local/lib/erlang/erts-5.9/bin/epmd -daemon
>>
>> Strangely, why do I have a user named 'rabbitmq'?!
>>
>> On Wed, May 16, 2012 at 9:28 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:
>>
>>> Hi,
>>>
>>> Basically the erlang.cookie belongs to a particular user. So the Erlang
>>> will load the cookie of the user running the commands rabbitmqctl,
>>> rabbitmq-server and so on.
>>>
>>> So if you want to gracefully stop that node you need to run *rabbitmqctl
>>> stop* with the same user that is running your current rabbitmq process.
>>>
>>> To find that user try running: *ps aux | grep rabbit*
>>>
>>> -Alvaro
>>>
>>>
>>> On Wed, May 16, 2012 at 3:14 PM, Merton Lister <mrtnlstr at gmail.com>wrote:
>>>
>>>> Hi Tim,
>>>>
>>>> Thanks for getting back to me. I am new to rabbitmq so not very
>>>> familiar with the details you're asking for.
>>>>
>>>> Here is what I see in /opt/local/var/lib/rabbitmq/.erlang.cookie:
>>>>
>>>> QFZXZBPOMTJNACQIMJOT
>>>>
>>>> and sudo rabbitmqctl status gives me:
>>>>
>>>> Status of node rabbit at h002 ...
>>>> Error: unable to connect to node rabbit at h002: nodedown
>>>>
>>>> DIAGNOSTICS
>>>> ===========
>>>>
>>>> nodes in question: [rabbit at h002]
>>>>
>>>> hosts, their running nodes and ports:
>>>> - h002: [{rabbit,62428},{rabbitmqctl12565,55147}]
>>>>
>>>> current node details:
>>>> - node name: rabbitmqctl12565 at h002
>>>>  - home dir: /opt/local/var/lib/rabbitmq
>>>> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>>>>
>>>> I installed rabbitmq by following the instructions given here:
>>>> http://www.rabbitmq.com/install-macports.html, after which I ran sudo
>>>> rabbitmq-server -detached to start the server. Now I want to stop the
>>>> server using sudo rabbitmqctl stop, but it simply does not allow me to
>>>> do so by the looks of it.
>>>>
>>>> I wonder what causes this kind of behavior? Am I running *multiple*
>>>> rabbitmq servers/nodes on my machine now, and somehow I am not allowed to
>>>> access some of them? Your help is much appreciated. Thanks.
>>>>
>>>>
>>>>
>>>> Best,
>>>> Merton
>>>>
>>>> On Wed, May 16, 2012 at 8:42 AM, tim <tim at rabbitmq.com> wrote:
>>>>
>>>>> On 16/05/2012 13:24, mrtn wrote:
>>>>>
>>>>>>
>>>>>> Hi,
>>>>>>
>>>>>> I installed the latest RabbitMQ via macports on OS X 10.6.8, and have
>>>>>> been trying to run it on localhost. However, after I started the
>>>>>> server using 'sudo rabbitmq-server -detached', I cannot stop the
>>>>>> server/node, nor can I start a new one (as expected). Below is the
>>>>>> output: first, I try to start a new server but failed because there is
>>>>>> already running; second, I then try to stop the existing server/node
>>>>>> but get told it is already down. Can anyone point out what is going on
>>>>>> here?!
>>>>>>
>>>>>> mrtn:MyLab mrtn$ sudo rabbitmq-server -detached
>>>>>> Activating RabbitMQ plugins ...
>>>>>> 0 plugins activated:
>>>>>>
>>>>>> node with name "rabbit" already running on "h002"
>>>>>>
>>>>>> DIAGNOSTICS
>>>>>> ===========
>>>>>>
>>>>>> nodes in question: [rabbit at h002]
>>>>>>
>>>>>> hosts, their running nodes and ports:
>>>>>> - h002: [{rabbit,62428},{**rabbitmqprelaunch12073,54048}]
>>>>>>
>>>>>> current node details:
>>>>>> - node name: rabbitmqprelaunch12073 at h002
>>>>>> - home dir: /opt/local/var/lib/rabbitmq
>>>>>> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>>>>>>
>>>>>> mrtn:MyLab mrtn$ sudo rabbitmqctl stop
>>>>>> Stopping and halting node rabbit at h002 ...
>>>>>> Error: unable to connect to node rabbit at h002: nodedown
>>>>>>
>>>>>> DIAGNOSTICS
>>>>>> ===========
>>>>>>
>>>>>> nodes in question: [rabbit at h002]
>>>>>>
>>>>>> hosts, their running nodes and ports:
>>>>>> - h002: [{rabbit,62428},{**rabbitmqctl12108,54053}]
>>>>>>
>>>>>> current node details:
>>>>>> - node name: rabbitmqctl12108 at h002
>>>>>> - home dir: /opt/local/var/lib/rabbitmq
>>>>>> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>>>>>> ______________________________**_________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>>>>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>>>>>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>>>>>
>>>>>
>>>>> Is the existing rabbit running with the same Erlang cookie as the new
>>>>> one? The cookie hash produced by rabbitmqctl is for the current node, not
>>>>> the one you're attempting to contact.
>>>>>
>>>>> The list of nodes/ports on the given host indicates which Erlang nodes
>>>>> are up, but not necessarily whether they're allowed to connect to or not.
>>>>> Check your cookie and let us know how you get on.
>>>>>
>>>>> Tim
>>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120516/f24d59ba/attachment.htm>

From videlalvaro at gmail.com  Wed May 16 17:02:06 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 16 May 2012 18:02:06 +0200
Subject: [rabbitmq-discuss] Cannot start or stop RabbitMQ using
 rabbitmqctl
In-Reply-To: <CALM-h94BOgn+zZ4TDYe+WFnsPgAvEzgQyx8RmLGtRNFEPYvTeQ@mail.gmail.com>
References: <806061f9-0694-4e04-ab4b-5ecb789b0458@w13g2000vbc.googlegroups.com>
	<4FB3A0BF.3080802@rabbitmq.com>
	<CALM-h96hhximxw9YgnmUML=jf-7NrnrZ0JSOcg7+Dgv9AFwBuw@mail.gmail.com>
	<CAMcAHLVHKKhfPi920yQL-DF6VUN=jVRTw9x3jvU0PCOOTh7sWg@mail.gmail.com>
	<CALM-h97RoN_93DbEpcZ_TDOk-aN=xJ8Wg0wf8=TiNNmde=WOsg@mail.gmail.com>
	<CAMcAHLUm9m=WvwR3oXkskqmeaYDZpqbZQeg736KijYPtN=b4EQ@mail.gmail.com>
	<CALM-h94gQ=mXUHzgmQshLo9WdS_in6=byNOBNC-+_G9oi=ruyA@mail.gmail.com>
	<CALM-h94BOgn+zZ4TDYe+WFnsPgAvEzgQyx8RmLGtRNFEPYvTeQ@mail.gmail.com>
Message-ID: <39FBE9125E984038AB79D0B0E26AAE62@gmail.com>

Please keep rabbitmq-discuss CC'ed  

Well, I really don't know how the macports thing works since I don't use it.

Those scripts you mention are simple shell scripts so they can be run by whatever user you choose, that's is not Erlang nor RabbitMQ specific.

Erlang will automatically create an .erlang.cookie in your home folder for you anyway. So you just need to make sure that the same cookie used to start rabbit is the one used to run the administration commands.

More docs on the Erlang cookie are here http://erlang.org/doc/man/erl.html see the -setcookie flag

Regards,

Alvaro  

--  
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)


On Wednesday, May 16, 2012 at 5:46 PM, Merton Lister wrote:

> Hi Alvaro,
>  
> I've just noticed something here: http://www.rabbitmq.com/install-macports.html
>  
> The rabbitmq-server, rabbitmqctl, and other RabbitMQ-related scripts on the path automatically (through sudo) run in the context of the rabbitmq user, so that the Erlang cookie can be read from (sudo)$MACPORTS_PREFIX/var/lib/rabbitmq/.erlang.cookie.  
>  
> Does this mean that whenever I run rabbitmq-server on mac, it will always run as user 'rabbitmq', in which case, I will also have to stop it by using:  
>  
> sudo -u rabbitmq rabbitmqctl stop
>  
> Thanks!
>  
>  
>  
> Best,
> Merton
>  
> On Wed, May 16, 2012 at 11:29 AM, Merton Lister <mrtnlstr at gmail.com (mailto:mrtnlstr at gmail.com)> wrote:
> >  
> > Thanks a lot.
> >  
> >  
> > On Wed, May 16, 2012 at 10:55 AM, Alvaro Videla <videlalvaro at gmail.com (mailto:videlalvaro at gmail.com)> wrote:
> > > No idea :) Maybe you installed rabbitmq before and that installer created that user?
> > >  
> > > Anyway? just do sudo -u rabbitmq rabbitmqctl stop
> > >  
> > > -Alvaro
> > >  
> > > On Wed, May 16, 2012 at 4:52 PM, Merton Lister <mrtnlstr at gmail.com (mailto:mrtnlstr at gmail.com)> wrote:
> > > > Hi Alvaro,
> > > >  
> > > > Thanks for the pointer. This is my output:
> > > >  
> > > > rabbitmq  5991   0.4  0.2  2492192  16184   ??  S     4:05PM   1:56.45 /opt/local/lib/erlang/erts-5.9/bin/beam.smp -W w -K true -A30 -P 1048576 -- -root /opt/local/lib/erlang -progname erl -- -home /opt/local/var/lib/rabbitmq -- -noshell -noinput -sname rabbit at mrtn-1 -boot /opt/local/var/lib/rabbitmq/mnesia/rabbit at mrtn-1-plugins-expand/rabbit -kernel inet_default_connect_options [{nodelay,true}] -sasl errlog_type error -sasl sasl_error_logger false -rabbit error_logger {file,"/opt/local/var/log/rabbitmq/rabbit at mrtn-1.log (mailto:rabbit at mrtn-1.log)"} -rabbit sasl_error_logger {file,"/opt/local/var/log/rabbitmq/rabbit at mrtn-1-sasl.log (mailto:rabbit at mrtn-1-sasl.log)"} -os_mon start_cpu_sup false -os_mon start_disksup false -os_mon start_memsup false -mnesia dir "/opt/local/var/lib/rabbitmq/mnesia/rabbit at mrtn-1" -noshell -noinput  
> > > > mrtn     13062   0.0  0.0  2435120    528 s000  R+    9:57AM   0:00.00 grep rabbit
> > > > rabbitmq  6005   0.0  0.0  2435000    108   ??  S     4:05PM   0:00.00 inet_gethost 4
> > > > rabbitmq  6004   0.0  0.0  2434996    396   ??  Ss    4:05PM   0:00.01 inet_gethost 4
> > > > rabbitmq  5980   0.0  0.0  2435000    224   ??  S     4:05PM   0:00.50 /opt/local/lib/erlang/erts-5.9/bin/epmd -daemon
> > > >  
> > > >  
> > > > Strangely, why do I have a user named 'rabbitmq'?!
> > > >  
> > > > On Wed, May 16, 2012 at 9:28 AM, Alvaro Videla <videlalvaro at gmail.com (mailto:videlalvaro at gmail.com)> wrote:
> > > > > Hi,
> > > > >  
> > > > > Basically the erlang.cookie belongs to a particular user. So the Erlang will load the cookie of the user running the commands rabbitmqctl, rabbitmq-server and so on.
> > > > >  
> > > > > So if you want to gracefully stop that node you need to run rabbitmqctl stop with the same user that is running your current rabbitmq process.  
> > > > >  
> > > > > To find that user try running: ps aux | grep rabbit
> > > > >  
> > > > > -Alvaro
> > > > >  
> > > > >  
> > > > > On Wed, May 16, 2012 at 3:14 PM, Merton Lister <mrtnlstr at gmail.com (mailto:mrtnlstr at gmail.com)> wrote:
> > > > > > Hi Tim,
> > > > > >  
> > > > > > Thanks for getting back to me. I am new to rabbitmq so not very familiar with the details you're asking for.  
> > > > > >  
> > > > > > Here is what I see in /opt/local/var/lib/rabbitmq/.erlang.cookie:  
> > > > > >  
> > > > > > QFZXZBPOMTJNACQIMJOT
> > > > > >  
> > > > > > and sudo rabbitmqctl status gives me:  
> > > > > >  
> > > > > > Status of node rabbit at h002 ...
> > > > > > Error: unable to connect to node rabbit at h002: nodedown
> > > > > >  
> > > > > > DIAGNOSTICS
> > > > > > ===========
> > > > > >  
> > > > > > nodes in question: [rabbit at h002]
> > > > > >  
> > > > > > hosts, their running nodes and ports:
> > > > > > - h002: [{rabbit,62428},{rabbitmqctl12565,55147}]
> > > > > >  
> > > > > > current node details:
> > > > > > - node name: rabbitmqctl12565 at h002
> > > > > > - home dir: /opt/local/var/lib/rabbitmq
> > > > > > - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
> > > > > >  
> > > > > >  
> > > > > >  
> > > > > > I installed rabbitmq by following the instructions given here: http://www.rabbitmq.com/install-macports.html, after which I ran sudo rabbitmq-server -detached to start the server. Now I want to stop the server using sudo rabbitmqctl stop, but it simply does not allow me to do so by the looks of it.  
> > > > > >  
> > > > > > I wonder what causes this kind of behavior? Am I running *multiple* rabbitmq servers/nodes on my machine now, and somehow I am not allowed to access some of them? Your help is much appreciated. Thanks.  
> > > > > >  
> > > > > >  
> > > > > >  
> > > > > > Best,
> > > > > > Merton
> > > > > >  
> > > > > > On Wed, May 16, 2012 at 8:42 AM, tim <tim at rabbitmq.com (mailto:tim at rabbitmq.com)> wrote:
> > > > > > > On 16/05/2012 13:24, mrtn wrote:
> > > > > > > >  
> > > > > > > > Hi,
> > > > > > > >  
> > > > > > > > I installed the latest RabbitMQ via macports on OS X 10.6.8, and have
> > > > > > > > been trying to run it on localhost. However, after I started the
> > > > > > > > server using 'sudo rabbitmq-server -detached', I cannot stop the
> > > > > > > > server/node, nor can I start a new one (as expected). Below is the
> > > > > > > > output: first, I try to start a new server but failed because there is
> > > > > > > > already running; second, I then try to stop the existing server/node
> > > > > > > > but get told it is already down. Can anyone point out what is going on
> > > > > > > > here?!
> > > > > > > >  
> > > > > > > > mrtn:MyLab mrtn$ sudo rabbitmq-server -detached
> > > > > > > > Activating RabbitMQ plugins ...
> > > > > > > > 0 plugins activated:
> > > > > > > >  
> > > > > > > > node with name "rabbit" already running on "h002"
> > > > > > > >  
> > > > > > > > DIAGNOSTICS
> > > > > > > > ===========
> > > > > > > >  
> > > > > > > > nodes in question: [rabbit at h002]
> > > > > > > >  
> > > > > > > > hosts, their running nodes and ports:
> > > > > > > > - h002: [{rabbit,62428},{rabbitmqprelaunch12073,54048}]
> > > > > > > >  
> > > > > > > > current node details:
> > > > > > > > - node name: rabbitmqprelaunch12073 at h002
> > > > > > > > - home dir: /opt/local/var/lib/rabbitmq
> > > > > > > > - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
> > > > > > > >  
> > > > > > > > mrtn:MyLab mrtn$ sudo rabbitmqctl stop
> > > > > > > > Stopping and halting node rabbit at h002 ...
> > > > > > > > Error: unable to connect to node rabbit at h002: nodedown
> > > > > > > >  
> > > > > > > > DIAGNOSTICS
> > > > > > > > ===========
> > > > > > > >  
> > > > > > > > nodes in question: [rabbit at h002]
> > > > > > > >  
> > > > > > > > hosts, their running nodes and ports:
> > > > > > > > - h002: [{rabbit,62428},{rabbitmqctl12108,54053}]
> > > > > > > >  
> > > > > > > > current node details:
> > > > > > > > - node name: rabbitmqctl12108 at h002
> > > > > > > > - home dir: /opt/local/var/lib/rabbitmq
> > > > > > > > - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
> > > > > > > > _______________________________________________
> > > > > > > > rabbitmq-discuss mailing list
> > > > > > > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > > > > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > > > >  
> > > > > > > Is the existing rabbit running with the same Erlang cookie as the new one? The cookie hash produced by rabbitmqctl is for the current node, not the one you're attempting to contact.
> > > > > > >  
> > > > > > > The list of nodes/ports on the given host indicates which Erlang nodes are up, but not necessarily whether they're allowed to connect to or not. Check your cookie and let us know how you get on.
> > > > > > >  
> > > > > > > Tim
> > > > > >  
> > > > > >  
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > > >  
> > > > >  
> > > >  
> > >  
> >  
>  

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120516/250c0cda/attachment.htm>

From mrtnlstr at gmail.com  Wed May 16 17:06:17 2012
From: mrtnlstr at gmail.com (Merton Lister)
Date: Wed, 16 May 2012 12:06:17 -0400
Subject: [rabbitmq-discuss] Cannot start or stop RabbitMQ using
	rabbitmqctl
In-Reply-To: <39FBE9125E984038AB79D0B0E26AAE62@gmail.com>
References: <806061f9-0694-4e04-ab4b-5ecb789b0458@w13g2000vbc.googlegroups.com>
	<4FB3A0BF.3080802@rabbitmq.com>
	<CALM-h96hhximxw9YgnmUML=jf-7NrnrZ0JSOcg7+Dgv9AFwBuw@mail.gmail.com>
	<CAMcAHLVHKKhfPi920yQL-DF6VUN=jVRTw9x3jvU0PCOOTh7sWg@mail.gmail.com>
	<CALM-h97RoN_93DbEpcZ_TDOk-aN=xJ8Wg0wf8=TiNNmde=WOsg@mail.gmail.com>
	<CAMcAHLUm9m=WvwR3oXkskqmeaYDZpqbZQeg736KijYPtN=b4EQ@mail.gmail.com>
	<CALM-h94gQ=mXUHzgmQshLo9WdS_in6=byNOBNC-+_G9oi=ruyA@mail.gmail.com>
	<CALM-h94BOgn+zZ4TDYe+WFnsPgAvEzgQyx8RmLGtRNFEPYvTeQ@mail.gmail.com>
	<39FBE9125E984038AB79D0B0E26AAE62@gmail.com>
Message-ID: <CALM-h97wx8yPTkpmUaP4BLSfuH0ecst7x-2c2HnxoxJvY+q6Dw@mail.gmail.com>

Thanks.

How exactly could I make sure that:

the same cookie used to start rabbit is the one used to run the
> administration commands.


Is it done by comparing the string stored in $home/.erlang.cookie with
something else?

On Wed, May 16, 2012 at 12:02 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:

>  Please keep rabbitmq-discuss CC'ed
>
> Well, I really don't know how the macports thing works since I don't use
> it.
>
> Those scripts you mention are simple shell scripts so they can be run by
> whatever user you choose, that's is not Erlang nor RabbitMQ specific.
>
> Erlang will automatically create an .erlang.cookie in your home folder for
> you anyway. So you just need to make sure that the same cookie used to
> start rabbit is the one used to run the administration commands.
>
> More docs on the Erlang cookie are here http://erlang.org/doc/man/erl.htmlsee the -setcookie flag
>
> Regards,
>
> Alvaro
>
> --
> Sent with Sparrow <http://www.sparrowmailapp.com/?sig>
>
> On Wednesday, May 16, 2012 at 5:46 PM, Merton Lister wrote:
>
> Hi Alvaro,
>
> I've just noticed something here:
> http://www.rabbitmq.com/install-macports.html
>
> The rabbitmq-server, rabbitmqctl, and other RabbitMQ-related scripts on
> the path automatically (through sudo) *run in the context of the rabbitmq
> user*, so that the Erlang cookie can be read from (sudo)
> $MACPORTS_PREFIX/var/lib/rabbitmq/.erlang.cookie.
>
> Does this mean that whenever I run rabbitmq-server on mac, it will always
> run as user 'rabbitmq', in which case, I will also have to stop it by using:
>
> *sudo -u rabbitmq rabbitmqctl stop*
> *
> *
> Thanks!
>
>
>
> Best,
> Merton
>
> On Wed, May 16, 2012 at 11:29 AM, Merton Lister <mrtnlstr at gmail.com>wrote:
>
>
> Thanks a lot.
>
>
> On Wed, May 16, 2012 at 10:55 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:
>
> No idea :) Maybe you installed rabbitmq before and that installer created
> that user?
>
> Anyway? just do *sudo -u rabbitmq rabbitmqctl stop*
>
> -Alvaro
>
> On Wed, May 16, 2012 at 4:52 PM, Merton Lister <mrtnlstr at gmail.com> wrote:
>
> Hi Alvaro,
>
> Thanks for the pointer. This is my output:
>
> rabbitmq  5991   0.4  0.2  2492192  16184   ??  S     4:05PM   1:56.45
> /opt/local/lib/erlang/erts-5.9/bin/beam.smp -W w -K true -A30 -P 1048576 --
> -root /opt/local/lib/erlang -progname erl -- -home
> /opt/local/var/lib/rabbitmq -- -noshell -noinput -sname rabbit at mrtn-1-boot /opt/local/var/lib/rabbitmq/mnesia/rabbit at mrtn-1-plugins-expand/rabbit
> -kernel inet_default_connect_options [{nodelay,true}] -sasl errlog_type
> error -sasl sasl_error_logger false -rabbit error_logger
> {file,"/opt/local/var/log/rabbitmq/rabbit at mrtn-1.log"} -rabbit
> sasl_error_logger {file,"/opt/local/var/log/rabbitmq/
> rabbit at mrtn-1-sasl.log"} -os_mon start_cpu_sup false -os_mon
> start_disksup false -os_mon start_memsup false -mnesia dir
> "/opt/local/var/lib/rabbitmq/mnesia/rabbit at mrtn-1" -noshell -noinput
> mrtn     13062   0.0  0.0  2435120    528 s000  R+    9:57AM   0:00.00
> grep rabbit
> rabbitmq  6005   0.0  0.0  2435000    108   ??  S     4:05PM   0:00.00
> inet_gethost 4
> rabbitmq  6004   0.0  0.0  2434996    396   ??  Ss    4:05PM   0:00.01
> inet_gethost 4
> rabbitmq  5980   0.0  0.0  2435000    224   ??  S     4:05PM   0:00.50
> /opt/local/lib/erlang/erts-5.9/bin/epmd -daemon
>
> Strangely, why do I have a user named 'rabbitmq'?!
>
> On Wed, May 16, 2012 at 9:28 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:
>
> Hi,
>
> Basically the erlang.cookie belongs to a particular user. So the Erlang
> will load the cookie of the user running the commands rabbitmqctl,
> rabbitmq-server and so on.
>
> So if you want to gracefully stop that node you need to run *rabbitmqctl
> stop* with the same user that is running your current rabbitmq process.
>
> To find that user try running: *ps aux | grep rabbit*
>
> -Alvaro
>
>
> On Wed, May 16, 2012 at 3:14 PM, Merton Lister <mrtnlstr at gmail.com> wrote:
>
> Hi Tim,
>
> Thanks for getting back to me. I am new to rabbitmq so not very familiar
> with the details you're asking for.
>
> Here is what I see in /opt/local/var/lib/rabbitmq/.erlang.cookie:
>
> QFZXZBPOMTJNACQIMJOT
>
> and sudo rabbitmqctl status gives me:
>
> Status of node rabbit at h002 ...
> Error: unable to connect to node rabbit at h002: nodedown
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit at h002]
>
> hosts, their running nodes and ports:
> - h002: [{rabbit,62428},{rabbitmqctl12565,55147}]
>
> current node details:
> - node name: rabbitmqctl12565 at h002
>  - home dir: /opt/local/var/lib/rabbitmq
> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>
> I installed rabbitmq by following the instructions given here:
> http://www.rabbitmq.com/install-macports.html, after which I ran sudo
> rabbitmq-server -detached to start the server. Now I want to stop the
> server using sudo rabbitmqctl stop, but it simply does not allow me to do
> so by the looks of it.
>
> I wonder what causes this kind of behavior? Am I running *multiple*
> rabbitmq servers/nodes on my machine now, and somehow I am not allowed to
> access some of them? Your help is much appreciated. Thanks.
>
>
>
> Best,
> Merton
>
> On Wed, May 16, 2012 at 8:42 AM, tim <tim at rabbitmq.com> wrote:
>
> On 16/05/2012 13:24, mrtn wrote:
>
>
> Hi,
>
> I installed the latest RabbitMQ via macports on OS X 10.6.8, and have
> been trying to run it on localhost. However, after I started the
> server using 'sudo rabbitmq-server -detached', I cannot stop the
> server/node, nor can I start a new one (as expected). Below is the
> output: first, I try to start a new server but failed because there is
> already running; second, I then try to stop the existing server/node
> but get told it is already down. Can anyone point out what is going on
> here?!
>
> mrtn:MyLab mrtn$ sudo rabbitmq-server -detached
> Activating RabbitMQ plugins ...
> 0 plugins activated:
>
> node with name "rabbit" already running on "h002"
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit at h002]
>
> hosts, their running nodes and ports:
> - h002: [{rabbit,62428},{**rabbitmqprelaunch12073,54048}]
>
> current node details:
> - node name: rabbitmqprelaunch12073 at h002
> - home dir: /opt/local/var/lib/rabbitmq
> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
>
> mrtn:MyLab mrtn$ sudo rabbitmqctl stop
> Stopping and halting node rabbit at h002 ...
> Error: unable to connect to node rabbit at h002: nodedown
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit at h002]
>
> hosts, their running nodes and ports:
> - h002: [{rabbit,62428},{**rabbitmqctl12108,54053}]
>
> current node details:
> - node name: rabbitmqctl12108 at h002
> - home dir: /opt/local/var/lib/rabbitmq
> - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
> Is the existing rabbit running with the same Erlang cookie as the new one?
> The cookie hash produced by rabbitmqctl is for the current node, not the
> one you're attempting to contact.
>
> The list of nodes/ports on the given host indicates which Erlang nodes are
> up, but not necessarily whether they're allowed to connect to or not. Check
> your cookie and let us know how you get on.
>
> Tim
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120516/cf307a17/attachment.htm>

From videlalvaro at gmail.com  Wed May 16 17:14:02 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 16 May 2012 18:14:02 +0200
Subject: [rabbitmq-discuss] Cannot start or stop RabbitMQ using
 rabbitmqctl
In-Reply-To: <CALM-h97wx8yPTkpmUaP4BLSfuH0ecst7x-2c2HnxoxJvY+q6Dw@mail.gmail.com>
References: <806061f9-0694-4e04-ab4b-5ecb789b0458@w13g2000vbc.googlegroups.com>
	<4FB3A0BF.3080802@rabbitmq.com>
	<CALM-h96hhximxw9YgnmUML=jf-7NrnrZ0JSOcg7+Dgv9AFwBuw@mail.gmail.com>
	<CAMcAHLVHKKhfPi920yQL-DF6VUN=jVRTw9x3jvU0PCOOTh7sWg@mail.gmail.com>
	<CALM-h97RoN_93DbEpcZ_TDOk-aN=xJ8Wg0wf8=TiNNmde=WOsg@mail.gmail.com>
	<CAMcAHLUm9m=WvwR3oXkskqmeaYDZpqbZQeg736KijYPtN=b4EQ@mail.gmail.com>
	<CALM-h94gQ=mXUHzgmQshLo9WdS_in6=byNOBNC-+_G9oi=ruyA@mail.gmail.com>
	<CALM-h94BOgn+zZ4TDYe+WFnsPgAvEzgQyx8RmLGtRNFEPYvTeQ@mail.gmail.com>
	<39FBE9125E984038AB79D0B0E26AAE62@gmail.com>
	<CALM-h97wx8yPTkpmUaP4BLSfuH0ecst7x-2c2HnxoxJvY+q6Dw@mail.gmail.com>
Message-ID: <FCABD85AB9514AAF946D4D37A047B8AA@gmail.com>

Erlang takes the cookie from the user that starts Erlang. Yes Erlang is that mean.  

--  
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)


On Wednesday, May 16, 2012 at 6:06 PM, Merton Lister wrote:

> Thanks.
>  
> How exactly could I make sure that:
>  
> > the same cookie used to start rabbit is the one used to run the administration commands.
>  
> Is it done by comparing the string stored in $home/.erlang.cookie with something else?
> On Wed, May 16, 2012 at 12:02 PM, Alvaro Videla <videlalvaro at gmail.com (mailto:videlalvaro at gmail.com)> wrote:
> > Please keep rabbitmq-discuss CC'ed  
> >  
> > Well, I really don't know how the macports thing works since I don't use it.
> >  
> > Those scripts you mention are simple shell scripts so they can be run by whatever user you choose, that's is not Erlang nor RabbitMQ specific.  
> >  
> > Erlang will automatically create an .erlang.cookie in your home folder for you anyway. So you just need to make sure that the same cookie used to start rabbit is the one used to run the administration commands.  
> >  
> > More docs on the Erlang cookie are here http://erlang.org/doc/man/erl.html see the -setcookie flag
> >  
> > Regards,  
> >  
> > Alvaro  
> >  
> > --  
> > Sent with Sparrow (http://www.sparrowmailapp.com/?sig)
> >  
> >  
> > On Wednesday, May 16, 2012 at 5:46 PM, Merton Lister wrote:
> >  
> > > Hi Alvaro,
> > >  
> > > I've just noticed something here: http://www.rabbitmq.com/install-macports.html  
> > >  
> > > The rabbitmq-server, rabbitmqctl, and other RabbitMQ-related scripts on the path automatically (through sudo) run in the context of the rabbitmq user, so that the Erlang cookie can be read from (sudo)$MACPORTS_PREFIX/var/lib/rabbitmq/.erlang.cookie.  
> > >  
> > > Does this mean that whenever I run rabbitmq-server on mac, it will always run as user 'rabbitmq', in which case, I will also have to stop it by using:  
> > >  
> > > sudo -u rabbitmq rabbitmqctl stop
> > >  
> > > Thanks!
> > >  
> > >  
> > >  
> > > Best,
> > > Merton
> > >  
> > > On Wed, May 16, 2012 at 11:29 AM, Merton Lister <mrtnlstr at gmail.com (mailto:mrtnlstr at gmail.com)> wrote:
> > > >  
> > > > Thanks a lot.
> > > >  
> > > >  
> > > > On Wed, May 16, 2012 at 10:55 AM, Alvaro Videla <videlalvaro at gmail.com (mailto:videlalvaro at gmail.com)> wrote:
> > > > > No idea :) Maybe you installed rabbitmq before and that installer created that user?
> > > > >  
> > > > > Anyway? just do sudo -u rabbitmq rabbitmqctl stop
> > > > >  
> > > > > -Alvaro
> > > > >  
> > > > > On Wed, May 16, 2012 at 4:52 PM, Merton Lister <mrtnlstr at gmail.com (mailto:mrtnlstr at gmail.com)> wrote:
> > > > > > Hi Alvaro,
> > > > > >  
> > > > > > Thanks for the pointer. This is my output:
> > > > > >  
> > > > > > rabbitmq  5991   0.4  0.2  2492192  16184   ??  S     4:05PM   1:56.45 /opt/local/lib/erlang/erts-5.9/bin/beam.smp -W w -K true -A30 -P 1048576 -- -root /opt/local/lib/erlang -progname erl -- -home /opt/local/var/lib/rabbitmq -- -noshell -noinput -sname rabbit at mrtn-1 -boot /opt/local/var/lib/rabbitmq/mnesia/rabbit at mrtn-1-plugins-expand/rabbit -kernel inet_default_connect_options [{nodelay,true}] -sasl errlog_type error -sasl sasl_error_logger false -rabbit error_logger {file,"/opt/local/var/log/rabbitmq/rabbit at mrtn-1.log (mailto:rabbit at mrtn-1.log)"} -rabbit sasl_error_logger {file,"/opt/local/var/log/rabbitmq/rabbit at mrtn-1-sasl.log (mailto:rabbit at mrtn-1-sasl.log)"} -os_mon start_cpu_sup false -os_mon start_disksup false -os_mon start_memsup false -mnesia dir "/opt/local/var/lib/rabbitmq/mnesia/rabbit at mrtn-1" -noshell -noinput  
> > > > > > mrtn     13062   0.0  0.0  2435120    528 s000  R+    9:57AM   0:00.00 grep rabbit
> > > > > > rabbitmq  6005   0.0  0.0  2435000    108   ??  S     4:05PM   0:00.00 inet_gethost 4
> > > > > > rabbitmq  6004   0.0  0.0  2434996    396   ??  Ss    4:05PM   0:00.01 inet_gethost 4
> > > > > > rabbitmq  5980   0.0  0.0  2435000    224   ??  S     4:05PM   0:00.50 /opt/local/lib/erlang/erts-5.9/bin/epmd -daemon
> > > > > >  
> > > > > >  
> > > > > > Strangely, why do I have a user named 'rabbitmq'?!
> > > > > >  
> > > > > > On Wed, May 16, 2012 at 9:28 AM, Alvaro Videla <videlalvaro at gmail.com (mailto:videlalvaro at gmail.com)> wrote:
> > > > > > > Hi,
> > > > > > >  
> > > > > > > Basically the erlang.cookie belongs to a particular user. So the Erlang will load the cookie of the user running the commands rabbitmqctl, rabbitmq-server and so on.
> > > > > > >  
> > > > > > > So if you want to gracefully stop that node you need to run rabbitmqctl stop with the same user that is running your current rabbitmq process.  
> > > > > > >  
> > > > > > > To find that user try running: ps aux | grep rabbit
> > > > > > >  
> > > > > > > -Alvaro
> > > > > > >  
> > > > > > >  
> > > > > > > On Wed, May 16, 2012 at 3:14 PM, Merton Lister <mrtnlstr at gmail.com (mailto:mrtnlstr at gmail.com)> wrote:
> > > > > > > > Hi Tim,
> > > > > > > >  
> > > > > > > > Thanks for getting back to me. I am new to rabbitmq so not very familiar with the details you're asking for.  
> > > > > > > >  
> > > > > > > > Here is what I see in /opt/local/var/lib/rabbitmq/.erlang.cookie:  
> > > > > > > >  
> > > > > > > > QFZXZBPOMTJNACQIMJOT
> > > > > > > >  
> > > > > > > > and sudo rabbitmqctl status gives me:  
> > > > > > > >  
> > > > > > > > Status of node rabbit at h002 ...
> > > > > > > > Error: unable to connect to node rabbit at h002: nodedown
> > > > > > > >  
> > > > > > > > DIAGNOSTICS
> > > > > > > > ===========
> > > > > > > >  
> > > > > > > > nodes in question: [rabbit at h002]
> > > > > > > >  
> > > > > > > > hosts, their running nodes and ports:
> > > > > > > > - h002: [{rabbit,62428},{rabbitmqctl12565,55147}]
> > > > > > > >  
> > > > > > > > current node details:
> > > > > > > > - node name: rabbitmqctl12565 at h002
> > > > > > > > - home dir: /opt/local/var/lib/rabbitmq
> > > > > > > > - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
> > > > > > > >  
> > > > > > > >  
> > > > > > > >  
> > > > > > > > I installed rabbitmq by following the instructions given here: http://www.rabbitmq.com/install-macports.html, after which I ran sudo rabbitmq-server -detached to start the server. Now I want to stop the server using sudo rabbitmqctl stop, but it simply does not allow me to do so by the looks of it.  
> > > > > > > >  
> > > > > > > > I wonder what causes this kind of behavior? Am I running *multiple* rabbitmq servers/nodes on my machine now, and somehow I am not allowed to access some of them? Your help is much appreciated. Thanks.  
> > > > > > > >  
> > > > > > > >  
> > > > > > > >  
> > > > > > > > Best,
> > > > > > > > Merton
> > > > > > > >  
> > > > > > > > On Wed, May 16, 2012 at 8:42 AM, tim <tim at rabbitmq.com (mailto:tim at rabbitmq.com)> wrote:
> > > > > > > > > On 16/05/2012 13:24, mrtn wrote:
> > > > > > > > > >  
> > > > > > > > > > Hi,
> > > > > > > > > >  
> > > > > > > > > > I installed the latest RabbitMQ via macports on OS X 10.6.8, and have
> > > > > > > > > > been trying to run it on localhost. However, after I started the
> > > > > > > > > > server using 'sudo rabbitmq-server -detached', I cannot stop the
> > > > > > > > > > server/node, nor can I start a new one (as expected). Below is the
> > > > > > > > > > output: first, I try to start a new server but failed because there is
> > > > > > > > > > already running; second, I then try to stop the existing server/node
> > > > > > > > > > but get told it is already down. Can anyone point out what is going on
> > > > > > > > > > here?!
> > > > > > > > > >  
> > > > > > > > > > mrtn:MyLab mrtn$ sudo rabbitmq-server -detached
> > > > > > > > > > Activating RabbitMQ plugins ...
> > > > > > > > > > 0 plugins activated:
> > > > > > > > > >  
> > > > > > > > > > node with name "rabbit" already running on "h002"
> > > > > > > > > >  
> > > > > > > > > > DIAGNOSTICS
> > > > > > > > > > ===========
> > > > > > > > > >  
> > > > > > > > > > nodes in question: [rabbit at h002]
> > > > > > > > > >  
> > > > > > > > > > hosts, their running nodes and ports:
> > > > > > > > > > - h002: [{rabbit,62428},{rabbitmqprelaunch12073,54048}]
> > > > > > > > > >  
> > > > > > > > > > current node details:
> > > > > > > > > > - node name: rabbitmqprelaunch12073 at h002
> > > > > > > > > > - home dir: /opt/local/var/lib/rabbitmq
> > > > > > > > > > - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
> > > > > > > > > >  
> > > > > > > > > > mrtn:MyLab mrtn$ sudo rabbitmqctl stop
> > > > > > > > > > Stopping and halting node rabbit at h002 ...
> > > > > > > > > > Error: unable to connect to node rabbit at h002: nodedown
> > > > > > > > > >  
> > > > > > > > > > DIAGNOSTICS
> > > > > > > > > > ===========
> > > > > > > > > >  
> > > > > > > > > > nodes in question: [rabbit at h002]
> > > > > > > > > >  
> > > > > > > > > > hosts, their running nodes and ports:
> > > > > > > > > > - h002: [{rabbit,62428},{rabbitmqctl12108,54053}]
> > > > > > > > > >  
> > > > > > > > > > current node details:
> > > > > > > > > > - node name: rabbitmqctl12108 at h002
> > > > > > > > > > - home dir: /opt/local/var/lib/rabbitmq
> > > > > > > > > > - cookie hash: q7VU0JjCd0VG7jOEF9Hf/g==
> > > > > > > > > > _______________________________________________
> > > > > > > > > > rabbitmq-discuss mailing list
> > > > > > > > > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > > > > > > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > > > > > >  
> > > > > > > > > Is the existing rabbit running with the same Erlang cookie as the new one? The cookie hash produced by rabbitmqctl is for the current node, not the one you're attempting to contact.
> > > > > > > > >  
> > > > > > > > > The list of nodes/ports on the given host indicates which Erlang nodes are up, but not necessarily whether they're allowed to connect to or not. Check your cookie and let us know how you get on.
> > > > > > > > >  
> > > > > > > > > Tim
> > > > > > > >  
> > > > > > > >  
> > > > > > > > _______________________________________________
> > > > > > > > rabbitmq-discuss mailing list
> > > > > > > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > > > > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > > > > >  
> > > > > > >  
> > > > > >  
> > > > >  
> > > >  
> > >  
> >  
>  

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120516/7843b7bd/attachment.htm>

From matthias at rabbitmq.com  Wed May 16 18:54:36 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 16 May 2012 18:54:36 +0100
Subject: [rabbitmq-discuss] RabbitMQ termination error question
In-Reply-To: <BCC407A444557E41B0D8B0260D68499204E0ED79@CA1EXCLV07.adcorp.kla-tencor.com>
References: <CADmaSA9uQ_WudVzOCJ1PSW0X0sS5r7RXyMVB1YSUQUMK3_6kCQ@mail.gmail.com>
	<BCC407A444557E41B0D8B0260D68499204E0EAF0@CA1EXCLV07.adcorp.kla-tencor.com>
	<4FB0E858.609@rabbitmq.com>
	<BCC407A444557E41B0D8B0260D68499204E0ED79@CA1EXCLV07.adcorp.kla-tencor.com>
Message-ID: <4FB3E9DC.9030205@rabbitmq.com>

On 15/05/12 00:11, Chen, Bin wrote:
> I am using version 2.7.1.

You should upgrade. 2.8.2 contains a number of stability improvements.

> The error didn't cause the server crash immediately. The server crashed
> about 3 hours later, instead.

In that case the rabbit_mgmt_db error is unlikely to be cause. Were 
there any errors in the logs just before the crash? Did you get an 
erl_crash.dump?

> Could this be a memory related problem? The memory high watermark is set
> to 819.2 MB by default.
> Is it safe to raise it to 1819.2 MB?  I am running RabbitMQ on 64-bit
> windows 2008 server.

If rabbit is crashing because it is running out of memory then 
increasing the high watermark is the opposite of what you'd want to do.


Regards,

Matthias.

From 7xerocha at gmail.com  Thu May 17 02:27:29 2012
From: 7xerocha at gmail.com (=?UTF-8?B?6buE5aSn6bmP?=)
Date: Thu, 17 May 2012 09:27:29 +0800
Subject: [rabbitmq-discuss] How to deal with duplicated msgs when using HA
	mirror?
In-Reply-To: <CAB6nog+GRMjrNAafNMsNbfkrvEWfjuvA_tDXd+p1eaM-3Z4m2A@mail.gmail.com>
References: <CAB6nog+GRMjrNAafNMsNbfkrvEWfjuvA_tDXd+p1eaM-3Z4m2A@mail.gmail.com>
Message-ID: <CAB6nogLW+djn8E3SC-Y0LXEU79NcrheEZoHW4GvQAw3AvTTaiw@mail.gmail.com>

Hi all,

As the article <<High Availability in RabbitMQ: solving part of the
puzzle<http://www.rabbitmq.com/blog/2011/10/25/high-availability-in-rabbitmq-solving-part-of-the-puzzle/>>>
mentioned, when master breakdown,  the last ack maybe not sync to all
slave,so when a slave promote to be a new master, the msgs which actualy be
consumed maybe redelivered to the consumers.
Is there any way to  identify these duplicated messages? our  scenario is :
multi producers, multi queue (every consumer has a private queue ), a
direct exchange and a fanout exchange.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/5b90a64e/attachment.htm>

From bino at indoakses-online.com  Thu May 17 03:54:23 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Thu, 17 May 2012 09:54:23 +0700
Subject: [rabbitmq-discuss] question : how to speed up the worker ?
In-Reply-To: <4FB37E25.3070308@rabbitmq.com>
References: <4FB366FD.2040103@indoakses-online.com>	<CAMcAHLXvU2_Ru+wNLtmydMA=Yv0L2VoZh=UwPK_hba3aACNbhg@mail.gmail.com>	<4FB36A4C.50907@indoakses-online.com>	<4FB36B73.3050609@rabbitmq.com>	<CAMcAHLW1hGn+XkGnYUtQaJDFmc6p07OUKABrGk2Q4TKiKH9G-w@mail.gmail.com>
	<4FB36C68.5040401@rabbitmq.com>
	<4FB375F1.9020008@indoakses-online.com>
	<4FB37E25.3070308@rabbitmq.com>
Message-ID: <4FB4685F.9060007@indoakses-online.com>

Dear All.
On 05/16/2012 05:15 PM, Tim Watson wrote:
>> Is there any potential conflict/problem when I use multi-worker that 
>> can do 'reject' ?
>>
>
>
> Not really. Once a message has been delivered to a worker, it won't be 
> seen by any other worker unless it is rejected and re-queued or the 
> worker dies without sending an ACK. HTH.
>
> Tim
>
>

Since my concern about worker speed is caused by the fact that the fleet 
will only have a short time to transfer it's local data to the 'app server',
i try to find another work around , and I think i will deploy Sholve plugin.

That is  :
1. Fleet Side
a. Sender will send to local broker
b. Sholve will handle the transfer to remote-broker (located in a 
controll room)

2. Controll room side :
a. Broker will 'receive' msg from Fleet-Sholve
b. Worker will read and injecting the msg to Application-server.

Hopefully those scheme will :
A. Speed up the data unloading from fleet to server, and keep safe the 
process.
B. When I need to speed up the worker, I can do it on a single Engine. 
No need to re-config the fleet-side.

so All .....Kindly please give me your opinion about those scheme.

C/q : Tim and Alvaro, I really appreciate your enlightment.

Sincerely
-bino-

From askgax at pchome.com.tw  Thu May 17 04:06:50 2012
From: askgax at pchome.com.tw (=?UTF-8?B?aGFuay1wY2hvbWU=?=)
Date: Thu, 17 May 2012 11:06:50 +0800
Subject: [rabbitmq-discuss] =?utf-8?q?=7CSpam=7C_rabbitmq_2=2E8=2E2_with_h?=
	=?utf-8?q?eartbeat/DRBD_start_fail?=
Message-ID: <PChomeWebmail_askgax_1337223948@online.com.tw>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/e27f8c55/attachment.htm>

From bino at indoakses-online.com  Thu May 17 04:14:16 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Thu, 17 May 2012 10:14:16 +0700
Subject: [rabbitmq-discuss] basic configuration file in ubuntu.
Message-ID: <4FB46D08.3070405@indoakses-online.com>

Dear All.

Currently, I never care about configuration file
Since my setup is in a private engine.

But since I want to start learning about shovel, I need to install 
another MQ in another engine.
The engine is connected to internet.
So I think I've to care about security.

I want to set a username and password in the remote engine so that it 
only accept connection from my personal engine.

Both of the engine is UBUNTU
I tried to find the config file at /etc/rabbitmq ... but nothing there.

next I try to read the startup_log and I find :
----START----
node           : rabbit at bino-desktop
app descriptor : 
/usr/lib/rabbitmq/lib/rabbitmq_server-2.8.2/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : DtuVvHKwdr3B/meOCTQz7A==
log            : /var/log/rabbitmq/rabbit at bino-desktop.log
sasl log       : /var/log/rabbitmq/rabbit at bino-desktop-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at bino-desktop
erlang version : 5.7.4
----STOP-----

What I need to do ?

Sincerely
-bino-

From sameek at arosys.com  Thu May 17 05:27:34 2012
From: sameek at arosys.com (sameekmishra)
Date: Wed, 16 May 2012 21:27:34 -0700 (PDT)
Subject: [rabbitmq-discuss] can we implement high availability without using
 DRBD?
Message-ID: <33862277.post@talk.nabble.com>


Hi

can we manage the high availability without using DRBD,because have not
created any shared partition for DRBD device.please help how can i implment
high  availability.

Thanks
-- 
View this message in context: http://old.nabble.com/can-we-implement-high-availability-without-using-DRBD--tp33862277p33862277.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From bino at indoakses-online.com  Thu May 17 06:26:49 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Thu, 17 May 2012 12:26:49 +0700
Subject: [rabbitmq-discuss] rabbitMQ-2.8.2 : problem with credentials
Message-ID: <4FB48C19.7020209@indoakses-online.com>

Dear All ...
My System is RabitMQ 2.8.2 on Ubuntu-lucid.
Installed using apt-get from :
deb http://www.rabbitmq.com/debian/ testing main

I try to use credential, but got error msg.

Here it is :
==1.This is the sender01.py without credential=======
import pika
import sys

connection = 
pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
channel = connection.channel()

channel.queue_declare(queue='task_queue', durable=True)

message = ' '.join(sys.argv[1:]) or "Hello World!"
channel.basic_publish(exchange='',
     routing_key='task_queue',
     body=message,
     properties=pika.BasicProperties(delivery_mode = 2,))
print ' [x] Sent %r' % (message,)
connection.close()
==2. and the result is===============================
root at core /opt/oprekan# python ./sender01.py 'without credentials'
  [x] Sent 'without credentials'
==3. try to add 1 user===============================
root at core /opt/oprekan# rabbitmqctl add_user bino01 123456
Creating user "bino01" ...
...done.
==4. and this is sender02.py with credentials========
import pika
import sys

credentials = pika.PlainCredentials('bino01', '123456')
connection = 
pika.BlockingConnection(pika.ConnectionParameters(credentials=credentials,host='127.0.0.1'))
channel = connection.channel()
channel.queue_declare(queue='task_queue', durable=True)

message = ' '.join(sys.argv[1:]) or "Hello World!"
channel.basic_publish(exchange='',
     routing_key='task_queue',
     body=message,
     properties=pika.BasicProperties(delivery_mode = 2,))
print ' [x] Sent %r' % (message,)
connection.close()

==5. and here is the result============================
root at core /opt/oprekan# python ./sender02.py 'WITH credentials'
Traceback (most recent call last):
   File "./sender02.py", line 5, in <module>
     connection = 
pika.BlockingConnection(pika.ConnectionParameters(credentials=credentials,host='127.0.0.1'))
   File 
"/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", 
line 32, in __init__
     BaseConnection.__init__(self, parameters, None, reconnection_strategy)
   File 
"/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", 
line 50, in __init__
     reconnection_strategy)
   File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", 
line 170, in __init__
     self._connect()
   File "/usr/local/lib/python2.6/dist-packages/pika/connection.py", 
line 228, in _connect
     self.parameters.port or  spec.PORT)
   File 
"/usr/local/lib/python2.6/dist-packages/pika/adapters/blocking_connection.py", 
line 44, in _adapter_connect
     self._handle_read()
   File 
"/usr/local/lib/python2.6/dist-packages/pika/adapters/base_connection.py", 
line 151, in _handle_read
     data = self.socket.recv(self._suggested_buffer_size)
socket.timeout: timed out
====================================

Kindly please tell me what to do to fix this problem

sincerely
-bino-

From q4break at gmail.com  Thu May 17 07:12:30 2012
From: q4break at gmail.com (=?UTF-8?B?Q29zbWluIEx1yJvEgw==?=)
Date: Thu, 17 May 2012 09:12:30 +0300
Subject: [rabbitmq-discuss] Weird ansible-playbook behaviour when trying
 to start rabbitmq-server 2.8.2
In-Reply-To: <4FB39D4A.2070008@rabbitmq.com>
References: <11115824.358.1337169495435.JavaMail.geo-discussion-forums@vbk4>
	<4FB39D4A.2070008@rabbitmq.com>
Message-ID: <CAPiVX2Zj=DymiFjHb0bTca79sc1Pp5hw4UF7akTy-Aru1-iaDw@mail.gmail.com>

On Wed, May 16, 2012 at 3:27 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
>
>
> We changed a couple of things in the init script, mainly using
> start-stop-daemon instead of su to change the user, and using lsb-base
> functions instead of echo.
>
> I can't reproduce what Michael DeHaan says over in the other thread:
>
>> Ok, so the rabbitmq script sounds like it cares very much about the
>> current directory, and when the current directory is gone, it blows
>> up. ? Please take this up with whoever maintains the distro init
>> script, because it's doing stupid things
>> and it should not care anything about the directory you first ran
>> /sbin/service in.
>
>
> I tried this from a deleted directory:
>
> $ sudo service rabbitmq-server stop
> sudo: cannot get working directory
> sh: getcwd() failed: No such file or directory
> ?* Stopping message broker rabbitmq-server ? ? ? ? ? ?[ OK ]
>
> $ sudo service rabbitmq-server start
> sudo: cannot get working directory
> sh: getcwd() failed: No such file or directory
> ?* Starting message broker rabbitmq-server ? ? ? ? ? ?[ OK ]
>
> ...and it worked fine. So I am not sure what's up here. If we are doing
> stupid things I would like to fix them, but I'm not sure we are.
>

I tried something similar and wasn't able to reproduce it; it must be
something that ansible is doing which, in combination with rabbitmq's
init script causes that weird bug. I'll look into this when I have
some spare time and I'll get back to you if I find something.

Best regards,
Cosmin

From sameek at arosys.com  Thu May 17 08:57:35 2012
From: sameek at arosys.com (sameekmishra)
Date: Thu, 17 May 2012 00:57:35 -0700 (PDT)
Subject: [rabbitmq-discuss]  how can i verified that cluster was working?
Message-ID: <33862757.post@talk.nabble.com>


Hi

I have created cluster with two node.i got the following status when i
execute a command:

$server03>rabbitmqctl -n rabbit at server05 status
Status of node rabbit at server05 ...
[{pid,1721},
 {running_applications,[{rabbit,"RabbitMQ","2.5.0"},
                        {os_mon,"CPO  CXC 138 46","2.2.5"},
                        {sasl,"SASL  CXC 138 11","2.1.9.3"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.17"},
                        {stdlib,"ERTS  CXC 138 10","1.17.3"},
                        {kernel,"ERTS  CXC 138 10","2.14.3"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R14B02 (erts-5.8.3) [source] [smp:2:2] [rq:2]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,13223536},
          {processes,4905312},
          {processes_used,4903192},
          {system,8318224},
          {atom,735113},
          {atom_used,725360},
          {binary,462368},
          {code,5766650},
          {ets,361564}]}]
...done.


$server05>abbitmqctl -n rabbit at server03 status
Status of node rabbit at server03 ...
[{pid,1684},
 {running_applications,[{rabbit,"RabbitMQ","2.5.0"},
                        {os_mon,"CPO  CXC 138 46","2.2.5"},
                        {sasl,"SASL  CXC 138 11","2.1.9.3"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.17"},
                        {stdlib,"ERTS  CXC 138 10","1.17.3"},
                        {kernel,"ERTS  CXC 138 10","2.14.3"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R14B02 (erts-5.8.3) [source] [smp:2:2] [rq:2]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,13284456},
          {processes,4963904},
          {processes_used,4961784},
          {system,8320552},
          {atom,735113},
          {atom_used,725488},
          {binary,458664},
          {code,5766650},
          {ets,367736}]}]
...done.

also i have see cluster_status for both end :

$server03>rabbitmqctl cluster_status
Cluster status of node rabbit at server03 ...
[{nodes,[{disc,[rabbit at server05]},{ram,[rabbit at server03]}]},
 {running_nodes,[rabbit at server03]}]
...done.

$server05>rabbitmqctl cluster_status
Cluster status of node rabbit at server05 ...
[{nodes,[{disc,[rabbit at server05]},{ram,[rabbit at server03]}]},
 {running_nodes,[rabbit at server03]}]
...done.


can this is ok,means cluster was prepare. if u have any idea  to verified
that cluster was working,please guide me?

Thanks

-- 
View this message in context: http://old.nabble.com/how-can-i-verified-that-cluster-was-working--tp33862757p33862757.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From tim at rabbitmq.com  Thu May 17 10:16:35 2012
From: tim at rabbitmq.com (tim)
Date: Thu, 17 May 2012 10:16:35 +0100
Subject: [rabbitmq-discuss] rabbitMQ-2.8.2 : problem with credentials
In-Reply-To: <4FB48C19.7020209@indoakses-online.com>
References: <4FB48C19.7020209@indoakses-online.com>
Message-ID: <4FB4C1F3.8000106@rabbitmq.com>

On 17/05/2012 06:26, bino oetomo wrote:
>
> Kindly please tell me what to do to fix this problem
>

After adding the user, you need to run rabbitmqctl set_permissions (with 
the vhost path, user, etc) in order to enable access for that user.

From tim at rabbitmq.com  Thu May 17 10:23:55 2012
From: tim at rabbitmq.com (tim)
Date: Thu, 17 May 2012 10:23:55 +0100
Subject: [rabbitmq-discuss] basic configuration file in ubuntu.
In-Reply-To: <4FB46D08.3070405@indoakses-online.com>
References: <4FB46D08.3070405@indoakses-online.com>
Message-ID: <4FB4C3AB.6060706@rabbitmq.com>

On 17/05/2012 04:14, bino oetomo wrote:
> Dear All.
>
> Currently, I never care about configuration file
> Since my setup is in a private engine.
>
> But since I want to start learning about shovel, I need to install
> another MQ in another engine.
> The engine is connected to internet.
> So I think I've to care about security.
>
> I want to set a username and password in the remote engine so that it
> only accept connection from my personal engine.
>
> Both of the engine is UBUNTU
> I tried to find the config file at /etc/rabbitmq ... but nothing there.
>
> next I try to read the startup_log and I find :
> ----START----
> node : rabbit at bino-desktop
> app descriptor :
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.8.2/sbin/../ebin/rabbit.app
> home dir : /var/lib/rabbitmq
> config file(s) : (none)
> cookie hash : DtuVvHKwdr3B/meOCTQz7A==
> log : /var/log/rabbitmq/rabbit at bino-desktop.log
> sasl log : /var/log/rabbitmq/rabbit at bino-desktop-sasl.log
> database dir : /var/lib/rabbitmq/mnesia/rabbit at bino-desktop
> erlang version : 5.7.4
> ----STOP-----
>

You can simply create the config file in the expected location. Once 
you've configured both your broker instances correctly, you can specify 
the auth details and other connection settings in the shovel 
configuration - see http://www.rabbitmq.com/shovel.html for details.

From emile at rabbitmq.com  Thu May 17 10:44:18 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 17 May 2012 10:44:18 +0100
Subject: [rabbitmq-discuss] how can i verified that cluster was working?
In-Reply-To: <33862757.post@talk.nabble.com>
References: <33862757.post@talk.nabble.com>
Message-ID: <4FB4C872.4040303@rabbitmq.com>

Hi,

On 17/05/12 08:57, sameekmishra wrote:
> [{nodes,[{disc,[rabbit at server05]},{ram,[rabbit at server03]}]},
>  {running_nodes,[rabbit at server03]}]

The next step when creating a cluster is to start the rabbit application
on the node where the schema was reset. In your case you need to execute:

rabbitmqctl -n rabbit at server05 start_app

All nodes will be in the running state when you complete that step.

The clustering guide has more details:
http://www.rabbitmq.com/clustering.html


-Emile


From matthew at rabbitmq.com  Thu May 17 11:06:24 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 17 May 2012 11:06:24 +0100
Subject: [rabbitmq-discuss] How to deal with duplicated msgs when using
 HA mirror?
In-Reply-To: <CAB6nogLW+djn8E3SC-Y0LXEU79NcrheEZoHW4GvQAw3AvTTaiw@mail.gmail.com>
References: <CAB6nog+GRMjrNAafNMsNbfkrvEWfjuvA_tDXd+p1eaM-3Z4m2A@mail.gmail.com>
	<CAB6nogLW+djn8E3SC-Y0LXEU79NcrheEZoHW4GvQAw3AvTTaiw@mail.gmail.com>
Message-ID: <20120517100623.GA7602@rabbitmq.com>

Hi,

On Thu, May 17, 2012 at 09:27:29AM +0800, ??? wrote:
> As the article <<High Availability in RabbitMQ: solving part of the
> puzzle<http://www.rabbitmq.com/blog/2011/10/25/high-availability-in-rabbitmq-solving-part-of-the-puzzle/>>>
> mentioned, when master breakdown,  the last ack maybe not sync to all
> slave,so when a slave promote to be a new master, the msgs which actualy be
> consumed maybe redelivered to the consumers.
> Is there any way to  identify these duplicated messages? our  scenario is :
> multi producers, multi queue (every consumer has a private queue ), a
> direct exchange and a fanout exchange.

Actually, msg duplication can happen via a number of means not involving
HA at all. HA just adds a few more places where such duplication can
occur.

There is no automatic way: a msg that's has the "isDelivered" flag set
on it *may* have already been delivered to another client, which is to
say that if that flag isn't set, then you shouldn't have to test for
duplication. But really, you're going to have to have some sort of
client side cache of hashes of recently seen messages, or some such.

I'm afraid I'm not aware of any off-the-shelf solution for this, but
this problem crops up regularly so there should be a fair amount of
material out there on this stuff.

Matthew

From clay at sseband.com  Wed May 16 22:50:34 2012
From: clay at sseband.com (Clay McClure)
Date: Wed, 16 May 2012 14:50:34 -0700 (PDT)
Subject: [rabbitmq-discuss] Read-only access to STOMP topic
Message-ID: <0fa11742-8cbb-4125-94ee-a92c485c6734@d33g2000yqa.googlegroups.com>

Howdy,

I would like to grant a user read-only access to a STOMP topic, while
granting another user read-write access to that same topic. In this
way, I can be assured that topic subscribers cannot also post messages
to the topic. I've tried using the following permissions:

    rabbitmqctl set_permissions read-only-user '.*' '^$' '.*'
    rabbitmqctl set_permissions read-write-user '.*' '.*' '.*'

which would, in my view, prevent the read-only-user from writing to
any topic. However, it seems that write permission is required to bind
to an exchange (http://www.rabbitmq.com/access-control.html), so when
the read-only-user tries to SUBSCRIBE to the topic, we get:

    ACCESS_REFUSED - access to queue 'amq.gen-JUCwAsef2r336/
uzsYwAmA==' in vhost '/' refused for user 'read-only-user'

How can I grant read-only access to the topic?

Thanks,

Clay

From sanwariya_faizan at yahoo.com  Wed May 16 23:05:42 2012
From: sanwariya_faizan at yahoo.com (faiz)
Date: Wed, 16 May 2012 15:05:42 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ SMS
Message-ID: <725856.1291.1337205942473.JavaMail.geo-discussion-forums@ynbv35>

HI 
I WANT TO MAKE AN SMS SERVICE USING RABBITmQ
CONNECTING MY GSMMODEM WITH SIM CARD TO PC RUN AS 24/7 SERVICE
MY SMS SERVICE CONTAINS
GROUP SMS SERVICE
SMS BASED FOLLOW SERVICE LIKE TWIITER
SS BASED AUTOMATIC NEWS
IS IT POSSIBLE TO MAKE SMS SERVICE LIKE THIS IN RABBIT MQ?
IF YES
THEN HOW IS IT POSSIBLE
WHAT IS PROCEDURE TO CONNECT MY GSM MODEM WITH RABBIT MQ
I AM  USING WINDOWS
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120516/8705b7b2/attachment.htm>

From askgax at pchome.com.tw  Thu May 17 03:43:49 2012
From: askgax at pchome.com.tw (askgax)
Date: Wed, 16 May 2012 19:43:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq 2.8.2 with heartbeat/DRBD fail
Message-ID: <d5f7b883-4012-4354-a638-71145e1facf6@ki5g2000pbb.googlegroups.com>

Hi,

i build a simple highly available environment in rabbitmq 2.7.1/Erlang
R14B03 with heartbeat 3.0.4/DRBD 8.3.11,and it's work fine and stable,
last  week i upgrade rabbitmq to 2.8.2 , when i test heartbeat
takeover,it's can take ip and drbd disk to another node,but mq service
can't start ,i try to use "/etc/init.d/rabbitmq-server start" ,mq
service can start success, i check /etc/init.d/rabbitmq-server
script,it's only different in 3 point,

in 2.7.1
RABBITMQ_PID_FILE=$PID_FILE setsid $DAEMON

in 2.8.2
START_PROG="runuser rabbitmq --session-command"

[ -f /etc/default/${NAME} ] && . /etc/default/${NAME}

RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON


i check the initial proecss,when heartbeat takeover,mq service will
check status first,and run start_rabbitmq function,and i add logger
print some checkpoint to minitor start script, i found it didn't run
to start_rabbitmq function,

i try to use 2.7.1 start script,and 2.8.2 can manual start success,but
heartbeat takeover still start fail,

my os:centos5.5 x64

my ha.cf :

debug 1
debugfile /var/log/ha-debug
logfile /var/log/ha-log
logfacility local0
udpport 694
keepalive 1
deadtime 10
initdead 80
ucast eth1 10.19.100.4
respawn hacluster /usr/lib/heartbeat/ipfail
ping 172.19.1.252
node mq1
node mq2
auto_failback off

my haresource:

mq1 172.19.253.99/16/eth0 \
drbddisk::drbd1  Filesystem::/dev/drbd1::/media/drbd1 \
rabbitmq-server

Any help would be appreciated!
thanks for help!!

From simon at rabbitmq.com  Thu May 17 11:25:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 May 2012 11:25:57 +0100
Subject: [rabbitmq-discuss] Read-only access to STOMP topic
In-Reply-To: <0fa11742-8cbb-4125-94ee-a92c485c6734@d33g2000yqa.googlegroups.com>
References: <0fa11742-8cbb-4125-94ee-a92c485c6734@d33g2000yqa.googlegroups.com>
Message-ID: <4FB4D235.7000502@rabbitmq.com>

On 16/05/12 22:50, Clay McClure wrote:
> Howdy,

Hi!

> I would like to grant a user read-only access to a STOMP topic, while
> granting another user read-write access to that same topic. In this
> way, I can be assured that topic subscribers cannot also post messages
> to the topic. I've tried using the following permissions:
>
>      rabbitmqctl set_permissions read-only-user '.*' '^$' '.*'
>      rabbitmqctl set_permissions read-write-user '.*' '.*' '.*'
>
> which would, in my view, prevent the read-only-user from writing to
> any topic.

Yes. But it also prevents them from writing to any *queue*. Try:

rabbitmqctl set_permissions read-only-user '.*' '^amq.gen.*$' '.*'

to allow them to write to (i.e. bind) the queue they created.

or

rabbitmqctl set_permissions read-only-user '^amq.gen.*$' '^amq.gen.*$' '.*'

to restrict what they can create, as well.

> However, it seems that write permission is required to bind
> to an exchange (http://www.rabbitmq.com/access-control.html),

Write permission is required to bind to an exchange as a *destination*, 
when using exchange-to-exchange bindings. The idea is that read 
permission means "bind so that I can read messages from" and write means 
"bind so that I can write messages to".

Cheers, Simon


> so when
> the read-only-user tries to SUBSCRIBE to the topic, we get:
>
>      ACCESS_REFUSED - access to queue 'amq.gen-JUCwAsef2r336/
> uzsYwAmA==' in vhost '/' refused for user 'read-only-user'
>
> How can I grant read-only access to the topic?
>
> Thanks,
>
> Clay
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu May 17 11:29:47 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 17 May 2012 11:29:47 +0100
Subject: [rabbitmq-discuss] Rabbitmq 2.8.2 with heartbeat/DRBD fail
In-Reply-To: <d5f7b883-4012-4354-a638-71145e1facf6@ki5g2000pbb.googlegroups.com>
References: <d5f7b883-4012-4354-a638-71145e1facf6@ki5g2000pbb.googlegroups.com>
Message-ID: <4FB4D31B.9060500@rabbitmq.com>

Hi,

On 17/05/12 03:43, askgax wrote:
> i build a simple highly available environment in rabbitmq 2.7.1/Erlang
> R14B03 with heartbeat 3.0.4/DRBD 8.3.11,and it's work fine and stable,
> last  week i upgrade rabbitmq to 2.8.2 

[...]

Was there an error message in the broker logfile about the disk free
space limit? Do you have less free disk space than RAM on the partition
storing RabbitMQ data? If so then you should configure the disk free
limit to a less conservative value.

If disk free space is not the cause then the logfile should still
indicate the cause. Does it contain any error entries at startup?


-Emile





From simon at rabbitmq.com  Thu May 17 11:27:51 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 May 2012 11:27:51 +0100
Subject: [rabbitmq-discuss] can we implement high availability without
 using DRBD?
In-Reply-To: <33862277.post@talk.nabble.com>
References: <33862277.post@talk.nabble.com>
Message-ID: <4FB4D2A7.8070801@rabbitmq.com>

On 17/05/12 05:27, sameekmishra wrote:
> can we manage the high availability without using DRBD,because have not
> created any shared partition for DRBD device.please help how can i implment
> high  availability.

See http://www.rabbitmq.com/ha.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From nimmavadiraj at gmail.com  Thu May 17 11:37:32 2012
From: nimmavadiraj at gmail.com (vadiraj hebbar)
Date: Thu, 17 May 2012 16:07:32 +0530
Subject: [rabbitmq-discuss] Welcome to the "rabbitmq-discuss" mailing
	list (Digest mode)
In-Reply-To: <mailman.0.1337250811.9982.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.0.1337250811.9982.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <CALK6wMqCMcA3c5kMROqKp7orQXf26P92=FNzgDcNesHPH9dB7w@mail.gmail.com>

Hi i am new for rabbitmq  please tel me how to crate multiple exchange type
for multiple queue in java anybody explain with example.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/e22deb66/attachment.htm>

From videlalvaro at gmail.com  Thu May 17 11:39:48 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 17 May 2012 12:39:48 +0200
Subject: [rabbitmq-discuss] Welcome to the "rabbitmq-discuss" mailing
 list (Digest mode)
In-Reply-To: <CALK6wMqCMcA3c5kMROqKp7orQXf26P92=FNzgDcNesHPH9dB7w@mail.gmail.com>
References: <mailman.0.1337250811.9982.rabbitmq-discuss@lists.rabbitmq.com>
	<CALK6wMqCMcA3c5kMROqKp7orQXf26P92=FNzgDcNesHPH9dB7w@mail.gmail.com>
Message-ID: <5B1814D27AFD4547B1DFFCD04E353024@gmail.com>

Just follow through the tutorials: http://www.rabbitmq.com/tutorials/tutorial-one-java.html 

-Alvaro 

-- 
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)


On Thursday, May 17, 2012 at 12:37 PM, vadiraj hebbar wrote:

> 
> 
> Hi i am new for rabbitmq  please tel me how to crate multiple exchange type for multiple queue in java anybody explain with example.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/d217d436/attachment.htm>

From francesco at rabbitmq.com  Thu May 17 11:45:07 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 17 May 2012 11:45:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ SMS
In-Reply-To: <725856.1291.1337205942473.JavaMail.geo-discussion-forums@ynbv35>
References: <725856.1291.1337205942473.JavaMail.geo-discussion-forums@ynbv35>
Message-ID: <4FB4D6B3.7050707@rabbitmq.com>

Hi Faiz,

We're not aware of any SMS gateway for RabbitMQ, so the answer to your 
question is probably "not easily".

Francesco.

On 16/05/12 23:05, faiz wrote:
> HI
> I WANT TO MAKE AN SMS SERVICE USING RABBITmQ
> CONNECTING MY GSMMODEM WITH SIM CARD TO PC RUN AS 24/7 SERVICE
> MY SMS SERVICE CONTAINS
> GROUP SMS SERVICE
> SMS BASED FOLLOW SERVICE LIKE TWIITER
> SS BASED AUTOMATIC NEWS
> IS IT POSSIBLE TO MAKE SMS SERVICE LIKE THIS IN RABBIT MQ?
> IF YES
> THEN HOW IS IT POSSIBLE
> WHAT IS PROCEDURE TO CONNECT MY GSM MODEM WITH RABBIT MQ
> I AM USING WINDOWS
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From deil_87 at mail.ru  Thu May 17 11:52:19 2012
From: deil_87 at mail.ru (=?UTF-8?B?0JDQvdC00YDQtdC5INCh0L/QuNGA0LjQtNC+0L3QvtCy?=)
Date: Thu, 17 May 2012 14:52:19 +0400
Subject: [rabbitmq-discuss] =?utf-8?q?Error=3A_Can=27t_set_short_node_name?=
 =?utf-8?q?!_Please_check_your_configuration?=
Message-ID: <E1SUyJf-0005cv-Na.deil_87-mail-ru@f117.mail.ru>

"Let us know what you were trying to do, the error you received and relevant entries from the logfile and one of our engineers will help you get it fixed."

OS: Windows 7

I was trying next command:

> rabbitmqctl status

error:
{error_logger,{{2012,5,17},{14,39,42}},"Can't set short node name!\nPlease check your configuration\n",[]}
{error_logger,{{2012,5,17},{14,39,42}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.16.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,220}],[]]}
{error_logger,{{2012,5,17},{14,39,42}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqctl15024,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2012,5,17},{14,39,42}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2012,5,17},{14,39,42}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}


where I can set node name and how? How can I check my configuration? Thank us in advance!


PS 
> rabbitmq-service start
works fine. Output: Service RabbitMQ started.

but when I'm trying to start rabbit as a server... then I get the same error:

{error_logger,{{2012,5,17},{14,47,31}},"Can't set short node name!\nPlease check your configuration\n",[]}
{error_logger,{{2012,5,17},{14,47,31}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.16.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,249}],[]]}
{error_logger,{{2012,5,17},{14,47,31}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch8588,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2012,5,17},{14,47,31}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2012,5,17},{14,47,31}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}






From abdullahsaima at yahoo.com  Thu May 17 11:53:03 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Thu, 17 May 2012 11:53:03 +0100 (BST)
Subject: [rabbitmq-discuss] How schedualing of request and response is done
	in AMQP
Message-ID: <1337251983.2926.YahooMailNeo@web29703.mail.ird.yahoo.com>

Hi everyone.
?
I am interested to know what kind of schdualing is used in AMQP for request and response. 
How times are allocated to the clients?
?
Thanks?
Saima Asif
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/b135b4cb/attachment.htm>

From michael.s.klishin at gmail.com  Thu May 17 11:55:18 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 17 May 2012 14:55:18 +0400
Subject: [rabbitmq-discuss] Welcome to the "rabbitmq-discuss" mailing
	list (Digest mode)
In-Reply-To: <CALK6wMqCMcA3c5kMROqKp7orQXf26P92=FNzgDcNesHPH9dB7w@mail.gmail.com>
References: <mailman.0.1337250811.9982.rabbitmq-discuss@lists.rabbitmq.com>
	<CALK6wMqCMcA3c5kMROqKp7orQXf26P92=FNzgDcNesHPH9dB7w@mail.gmail.com>
Message-ID: <CFC70F32-930D-4D9C-A3E2-20B0FD1106F8@gmail.com>

vadiraj hebbar:

> Hi i am new for rabbitmq  please tel me how to crate multiple exchange type for multiple queue in java anybody explain with example.

I would recommend getting familiar with AMQP model fundamentals. It will make it much easier to make sense of key
Java client API elements, such as the Channel and Consumer interfaces.

http://www.rabbitmq.com/tutorials/amqp-concepts.html

MK


From sameek at arosys.com  Thu May 17 11:56:24 2012
From: sameek at arosys.com (sameekmishra)
Date: Thu, 17 May 2012 03:56:24 -0700 (PDT)
Subject: [rabbitmq-discuss] can we implement high availability without
 using DRBD?
In-Reply-To: <4FB4D2A7.8070801@rabbitmq.com>
References: <33862277.post@talk.nabble.com> <4FB4D2A7.8070801@rabbitmq.com>
Message-ID: <33863431.post@talk.nabble.com>


I have already read this document.i want to know that DRBD required partition
or it uses any free space in hard disk to stored file.if we can do then
please explain it.otherwise tell me the approach to followed to achieve high
availability without using DRBD.

Thanks



Simon MacMullen-2 wrote:
> 
> On 17/05/12 05:27, sameekmishra wrote:
>> can we manage the high availability without using DRBD,because have not
>> created any shared partition for DRBD device.please help how can i
>> implment
>> high  availability.
> 
> See http://www.rabbitmq.com/ha.html
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/can-we-implement-high-availability-without-using-DRBD--tp33862277p33863431.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthew at rabbitmq.com  Thu May 17 12:00:15 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 17 May 2012 12:00:15 +0100
Subject: [rabbitmq-discuss] How schedualing of request and response is
 done in AMQP
In-Reply-To: <1337251983.2926.YahooMailNeo@web29703.mail.ird.yahoo.com>
References: <1337251983.2926.YahooMailNeo@web29703.mail.ird.yahoo.com>
Message-ID: <20120517110015.GB7602@rabbitmq.com>

Hi Saima,

On Thu, May 17, 2012 at 11:53:03AM +0100, Saima Asif wrote:
> I am interested to know what kind of schdualing is used in AMQP for request and response. 
> How times are allocated to the clients?

Yes, we don't know either. We just rely on the Erlang schedular
schedling processes that have work to do. Whilst it does have a notion
of priorities, we don't use them (I think) and we do very very little to
explicitly influence the Erlang schedular at all.

Matthew

From brendan at soundcloud.com  Thu May 17 12:13:59 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Thu, 17 May 2012 13:13:59 +0200
Subject: [rabbitmq-discuss] can we implement high availability without
 using DRBD?
In-Reply-To: <33863431.post@talk.nabble.com>
References: <33862277.post@talk.nabble.com> <4FB4D2A7.8070801@rabbitmq.com>
	<33863431.post@talk.nabble.com>
Message-ID: <CAHZsVQaWh_u61iVN3LXNhk005+Y6tgHHQSX_+nvGHTcGwRgB7g@mail.gmail.com>

The document that you must have read which refers to DRBD is:
http://www.rabbitmq.com/pacemaker.html

Please read about M*irrored Queue Behaviour* via the link Simon mentioned
here: http://www.rabbitmq.com/ha.html

This will give you information about creating a highly available
active/active setup *without* using something like DRBD.

- Brendan

On Thu, May 17, 2012 at 12:56 PM, sameekmishra <sameek at arosys.com> wrote:

>
> I have already read this document.i want to know that DRBD required
> partition
> or it uses any free space in hard disk to stored file.if we can do then
> please explain it.otherwise tell me the approach to followed to achieve
> high
> availability without using DRBD.
>
> Thanks
>
>
>
> Simon MacMullen-2 wrote:
> >
> > On 17/05/12 05:27, sameekmishra wrote:
> >> can we manage the high availability without using DRBD,because have not
> >> created any shared partition for DRBD device.please help how can i
> >> implment
> >> high  availability.
> >
> > See http://www.rabbitmq.com/ha.html
> >
> > Cheers, Simon
> >
> > --
> > Simon MacMullen
> > RabbitMQ, VMware
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
> --
> View this message in context:
> http://old.nabble.com/can-we-implement-high-availability-without-using-DRBD--tp33862277p33863431.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/af35d96c/attachment.htm>

From sameek at arosys.com  Thu May 17 13:08:44 2012
From: sameek at arosys.com (sameekmishra)
Date: Thu, 17 May 2012 05:08:44 -0700 (PDT)
Subject: [rabbitmq-discuss] can we implement high availability without
 using DRBD?
In-Reply-To: <CAHZsVQaWh_u61iVN3LXNhk005+Y6tgHHQSX_+nvGHTcGwRgB7g@mail.gmail.com>
References: <33862277.post@talk.nabble.com> <4FB4D2A7.8070801@rabbitmq.com>
	<33863431.post@talk.nabble.com>
	<CAHZsVQaWh_u61iVN3LXNhk005+Y6tgHHQSX_+nvGHTcGwRgB7g@mail.gmail.com>
Message-ID: <33863776.post@talk.nabble.com>


I have implement the following points :

1.clustering with two node 
2.mirror queue 
3. installation and configuration of heartbeat on both nodes
4. installation of pacemaker.

I need to implement: if any node is failed to switch to other node without
know the client. 

as you say i have read it document-http://www.rabbitmq.com/pacemaker.html
but i can't able to find out without using DRBD.
please help me how i configure it.



Brendan Hay-2 wrote:
> 
> The document that you must have read which refers to DRBD is:
> http://www.rabbitmq.com/pacemaker.html
> 
> Please read about M*irrored Queue Behaviour* via the link Simon mentioned
> here: http://www.rabbitmq.com/ha.html
> 
> This will give you information about creating a highly available
> active/active setup *without* using something like DRBD.
> 
> - Brendan
> 
> On Thu, May 17, 2012 at 12:56 PM, sameekmishra <sameek at arosys.com> wrote:
> 
>>
>> I have already read this document.i want to know that DRBD required
>> partition
>> or it uses any free space in hard disk to stored file.if we can do then
>> please explain it.otherwise tell me the approach to followed to achieve
>> high
>> availability without using DRBD.
>>
>> Thanks
>>
>>
>>
>> Simon MacMullen-2 wrote:
>> >
>> > On 17/05/12 05:27, sameekmishra wrote:
>> >> can we manage the high availability without using DRBD,because have
>> not
>> >> created any shared partition for DRBD device.please help how can i
>> >> implment
>> >> high  availability.
>> >
>> > See http://www.rabbitmq.com/ha.html
>> >
>> > Cheers, Simon
>> >
>> > --
>> > Simon MacMullen
>> > RabbitMQ, VMware
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>>
>> --
>> View this message in context:
>> http://old.nabble.com/can-we-implement-high-availability-without-using-DRBD--tp33862277p33863431.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/can-we-implement-high-availability-without-using-DRBD--tp33862277p33863776.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From brendan at soundcloud.com  Thu May 17 13:24:53 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Thu, 17 May 2012 14:24:53 +0200
Subject: [rabbitmq-discuss] can we implement high availability without
 using DRBD?
In-Reply-To: <33863776.post@talk.nabble.com>
References: <33862277.post@talk.nabble.com> <4FB4D2A7.8070801@rabbitmq.com>
	<33863431.post@talk.nabble.com>
	<CAHZsVQaWh_u61iVN3LXNhk005+Y6tgHHQSX_+nvGHTcGwRgB7g@mail.gmail.com>
	<33863776.post@talk.nabble.com>
Message-ID: <CAHZsVQZDmu7jPoFeGP_GwK_aQvY8j-=LNoPzWS7Vjs-dTqMMWQ@mail.gmail.com>

The clustering + mirrored queue approach you've already got is what is
required to make RabbitMQ HA, you don't (additionally) need the
Heartbeat/DRBD shenanigans, get rid of that as it just complicates things.

Since you also mention making this transparent to the clients (which is
a separate issue), you will need to either embed the failover logic in the
client code (making clients aware of every node in the cluster), or use a
VIP, Proxy or something similar to present a single address/endpoint to the
clients.

Many people have success using a TCP load-balancing mechanism like LVS or
HAProxy in front of RabbitMQ.

This way if one of the nodes in your cluster goes down, the clients TCP
connection to the dead node is reset and when they reconnect to the Proxy
they will be directed to the healthy node, upon which the mirrored queue
would be master.


On Thu, May 17, 2012 at 2:08 PM, sameekmishra <sameek at arosys.com> wrote:

>
> I have implement the following points :
>
> 1.clustering with two node
> 2.mirror queue
> 3. installation and configuration of heartbeat on both nodes
> 4. installation of pacemaker.
>
> I need to implement: if any node is failed to switch to other node without
> know the client.
>
> as you say i have read it document-http://www.rabbitmq.com/pacemaker.html
> but i can't able to find out without using DRBD.
> please help me how i configure it.
>
>
>
> Brendan Hay-2 wrote:
> >
> > The document that you must have read which refers to DRBD is:
> > http://www.rabbitmq.com/pacemaker.html
> >
> > Please read about M*irrored Queue Behaviour* via the link Simon mentioned
> > here: http://www.rabbitmq.com/ha.html
> >
> > This will give you information about creating a highly available
> > active/active setup *without* using something like DRBD.
> >
> > - Brendan
> >
> > On Thu, May 17, 2012 at 12:56 PM, sameekmishra <sameek at arosys.com>
> wrote:
> >
> >>
> >> I have already read this document.i want to know that DRBD required
> >> partition
> >> or it uses any free space in hard disk to stored file.if we can do then
> >> please explain it.otherwise tell me the approach to followed to achieve
> >> high
> >> availability without using DRBD.
> >>
> >> Thanks
> >>
> >>
> >>
> >> Simon MacMullen-2 wrote:
> >> >
> >> > On 17/05/12 05:27, sameekmishra wrote:
> >> >> can we manage the high availability without using DRBD,because have
> >> not
> >> >> created any shared partition for DRBD device.please help how can i
> >> >> implment
> >> >> high  availability.
> >> >
> >> > See http://www.rabbitmq.com/ha.html
> >> >
> >> > Cheers, Simon
> >> >
> >> > --
> >> > Simon MacMullen
> >> > RabbitMQ, VMware
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> >
> >>
> >> --
> >> View this message in context:
> >>
> http://old.nabble.com/can-we-implement-high-availability-without-using-DRBD--tp33862277p33863431.html
> >> Sent from the RabbitMQ mailing list archive at Nabble.com.
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
> --
> View this message in context:
> http://old.nabble.com/can-we-implement-high-availability-without-using-DRBD--tp33862277p33863776.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/ce7801a9/attachment.htm>

From askgax at pchome.com.tw  Thu May 17 14:54:49 2012
From: askgax at pchome.com.tw (askgax)
Date: Thu, 17 May 2012 06:54:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq 2.8.2 with heartbeat/DRBD fail
In-Reply-To: <4FB4D31B.9060500@rabbitmq.com>
References: <d5f7b883-4012-4354-a638-71145e1facf6@ki5g2000pbb.googlegroups.com>
	<4FB4D31B.9060500@rabbitmq.com>
Message-ID: <33864330.post@talk.nabble.com>


Hi Emile,

thanks for reply,

my mq server have 4G ram,and disk usage status

[root at mq1 ~]# df -h
Filesystem            Size  Used Avail Use% Mounted on
/dev/vda3              26G  5.6G   19G  24% /
/dev/vda1              99M   12M   82M  13% /boot
tmpfs                 2.0G     0  2.0G   0% /dev/shm
/dev/drbd1             20G  176M   19G   1% /media/drbd1

both rabbitmq 2.7.1 and rabbitmq 2.8.2 environment are the same hardware
spec,

in rabbitmq 2.8.2 environment,execute heartbeat takeover,the debug log no
error about rabbitmq,

May 17 21:42:08 mq1 heartbeat: [2311]: debug: StartNextRemoteRscReq() -
calling hook
May 17 21:42:08 mq1 heartbeat: [2311]: debug: notify_world: invoking harc:
OLD status: active
May 17 21:42:08 mq1 heartbeat: [2311]: debug: Process [hb_takeover] started
pid 2561
May 17 21:42:08 mq1 heartbeat: [2311]: debug: Starting notify process
[hb_takeover]
May 17 21:42:08 mq1 heartbeat: [2561]: debug: notify_world: setting SIGCHLD
Handler to SIG_DFL
May 17 21:42:08 mq1 heartbeat: [2561]: debug: notify_world: Running harc
hb_takeover
harc[2561]:     2012/05/17_21:42:08 info: Running
/etc/ha.d//rc.d/hb_takeover hb_takeover
May 17 21:42:08 mq1 heartbeat: [2311]: info: Managed hb_takeover process
2561 exited with return code 0.
May 17 21:42:08 mq1 heartbeat: [2311]: debug: RscMgmtProc 'hb_takeover'
exited code 0
May 17 21:42:09 mq1 heartbeat: [2311]: debug: Received standby message me
from mq2 in state 0
May 17 21:42:09 mq1 heartbeat: [2311]: debug: ask_for_resources: other now
unstable
May 17 21:42:09 mq1 heartbeat: [2311]: info: mq2 wants to go standby [all]
May 17 21:42:09 mq1 heartbeat: [2311]: info: standby: other_holds_resources:
3
May 17 21:42:09 mq1 heartbeat: [2311]: debug: Sending standby [other] msg
May 17 21:42:09 mq1 heartbeat: [2311]: debug: Received standby message other
from mq1 in state 2
May 17 21:42:09 mq1 heartbeat: [2311]: info: New standby state: 2
May 17 21:42:09 mq1 heartbeat: [2311]: info: New standby state: 2
May 17 21:42:09 mq1 heartbeat: [2311]: debug: process_resources(2):  other
now unstable
May 17 21:42:09 mq1 heartbeat: [2311]: info: other_holds_resources: 0
May 17 21:42:09 mq1 heartbeat: [2311]: debug: hb_rsc_isstable:
ResourceMgmt_child_count: 0, other_is_stable: 0, takeover_in_progress: 0,
going_standby: 2, standby running(ms): 4395531970, resourcestate: 4
May 17 21:42:09 mq1 ipfail: [2341]: debug: Other side is unstable.
May 17 21:42:11 mq1 heartbeat: [2311]: debug: Received standby message done
from mq2 in state 2
May 17 21:42:11 mq1 heartbeat: [2311]: info: standby: acquire [all]
resources from mq2
May 17 21:42:11 mq1 heartbeat: [2311]: debug: Process [go_standby] started
pid 2612
May 17 21:42:11 mq1 heartbeat: [2311]: info: New standby state: 3
May 17 21:42:11 mq1 heartbeat: [2612]: info: acquire all HA resources
(standby).
May 17 21:42:11 mq1 heartbeat: [2612]: info: go_standby: who: 2 resource
set: all
May 17 21:42:11 mq1 heartbeat: [2612]: info: go_standby: (query/action):
(allkeys/takegroup)
ResourceManager[2625]:  2012/05/17_21:42:11 info: Acquiring resource group:
mq1 172.19.253.99/16/eth0 drbddisk::drbd1
Filesystem::/dev/drbd1::/media/drbd1 rabbitmq-server
IPaddr[2654]:   2012/05/17_21:42:11 INFO:  Resource is stopped
ResourceManager[2625]:  2012/05/17_21:42:11 info: Running
/etc/ha.d/resource.d/IPaddr 172.19.253.99/16/eth0 start
ResourceManager[2625]:  2012/05/17_21:42:11 debug: Starting
/etc/ha.d/resource.d/IPaddr 172.19.253.99/16/eth0 start
IPaddr[2748]:   2012/05/17_21:42:11 INFO: Using calculated netmask for
172.19.253.99: 255.255.0.0
IPaddr[2748]:   2012/05/17_21:42:11 DEBUG: Using calculated broadcast for
172.19.253.99: 172.19.255.255
IPaddr[2748]:   2012/05/17_21:42:11 INFO: eval ifconfig eth0:0 172.19.253.99
netmask 255.255.0.0 broadcast 172.19.255.255
IPaddr[2748]:   2012/05/17_21:42:11 DEBUG: Sending Gratuitous Arp for
172.19.253.99 on eth0:0 [eth0]
IPaddr[2722]:   2012/05/17_21:42:12 INFO:  Success
INFO:  Success
ResourceManager[2625]:  2012/05/17_21:42:12 debug:
/etc/ha.d/resource.d/IPaddr 172.19.253.99/16/eth0 start done. RC=0
ResourceManager[2625]:  2012/05/17_21:42:12 info: Running
/etc/ha.d/resource.d/drbddisk drbd1 start
ResourceManager[2625]:  2012/05/17_21:42:12 debug: Starting
/etc/ha.d/resource.d/drbddisk drbd1 start
ResourceManager[2625]:  2012/05/17_21:42:12 debug:
/etc/ha.d/resource.d/drbddisk drbd1 start done. RC=0
Filesystem[2916]:       2012/05/17_21:42:12 INFO:  Resource is stopped
ResourceManager[2625]:  2012/05/17_21:42:12 info: Running
/etc/ha.d/resource.d/Filesystem /dev/drbd1 /media/drbd1 start
ResourceManager[2625]:  2012/05/17_21:42:12 debug: Starting
/etc/ha.d/resource.d/Filesystem /dev/drbd1 /media/drbd1 start
Filesystem[2999]:       2012/05/17_21:42:12 INFO: Running start for
/dev/drbd1 on /media/drbd1
Filesystem[2999]:       2012/05/17_21:42:12 INFO: Starting filesystem check
on /dev/drbd1
fsck 1.39 (29-May-2006)
/dev/drbd1: clean, 442/2621440 files, 127224/5242683 blocks
Filesystem[2991]:       2012/05/17_21:42:13 INFO:  Success
INFO:  Success
ResourceManager[2625]:  2012/05/17_21:42:13 debug:
/etc/ha.d/resource.d/Filesystem /dev/drbd1 /media/drbd1 start done. RC=0
May 17 21:42:13 mq1 heartbeat: [2612]: info: all HA resource acquisition
completed (standby).
May 17 21:42:13 mq1 heartbeat: [2612]: debug: Sending standby [done] msg
May 17 21:42:13 mq1 heartbeat: [2612]: info: FIFO message [type
ask_resources] written rc=47
May 17 21:42:13 mq1 heartbeat: [2311]: debug: Received standby message done
from mq1 in state 3
May 17 21:42:13 mq1 heartbeat: [2311]: info: Standby resource acquisition
done [all].
May 17 21:42:13 mq1 heartbeat: [2311]: debug: Sending hold resources msg:
all, stable=1 # <none>
May 17 21:42:13 mq1 heartbeat: [2311]: info: AnnounceTakeover(local 1,
foreign 1, reason 'T_RESOURCES(us)' (1))
May 17 21:42:13 mq1 heartbeat: [2311]: debug: hb_rsc_isstable:
ResourceMgmt_child_count: 1, other_is_stable: 0, takeover_in_progress: 0,
going_standby: 0, standby running(ms): 0, resourcestate: 4
May 17 21:42:13 mq1 heartbeat: [2311]: info: New standby state: 0
May 17 21:42:13 mq1 heartbeat: [2311]: info: Managed go_standby process 2612
exited with return code 0.
May 17 21:42:13 mq1 heartbeat: [2311]: debug: RscMgmtProc 'go_standby'
exited code 0
May 17 21:42:13 mq1 heartbeat: [2311]: info: remote resource transition
completed.
May 17 21:42:13 mq1 heartbeat: [2311]: debug: Sending hold resources msg:
all, stable=1 # <none>
May 17 21:42:13 mq1 heartbeat: [2311]: info: AnnounceTakeover(local 1,
foreign 1, reason 'T_RESOURCES(us)' (1))
May 17 21:42:13 mq1 heartbeat: [2311]: debug: hb_rsc_isstable:
ResourceMgmt_child_count: 0, other_is_stable: 1, takeover_in_progress: 0,
going_standby: 0, standby running(ms): 0, resourcestate: 4
May 17 21:42:13 mq1 heartbeat: [2311]: debug: Calling PerformAutoFailback()
May 17 21:42:13 mq1 heartbeat: [2311]: info: other_holds_resources: 0
May 17 21:42:13 mq1 heartbeat: [2311]: debug: hb_rsc_isstable:
ResourceMgmt_child_count: 0, other_is_stable: 1, takeover_in_progress: 0,
going_standby: 0, standby running(ms): 0, resourcestate: 4
May 17 21:42:13 mq1 heartbeat: [2311]: info: other_holds_resources: 0
May 17 21:42:13 mq1 heartbeat: [2311]: debug: hb_rsc_isstable:
ResourceMgmt_child_count: 0, other_is_stable: 1, takeover_in_progress: 0,
going_standby: 0, standby running(ms): 0, resourcestate: 4
May 17 21:42:13 mq1 ipfail: [2341]: debug: Other side is now stable.
May 17 21:42:13 mq1 ipfail: [2341]: debug: Other side is now stable.
ARPING 172.19.253.99 from 172.19.253.99 eth0
Sent 10 probes (10 broadcast(s))
Received 0 response(s)


the same environment setting at rabbitmq 2.7.1 run heartbeat takeover,will
show rabbitmq start

May 17 18:09:26 mqhand1 heartbeat: [9216]: debug: notify_world: setting
SIGCHLD Handler to SIG_DFL
harc[9216]:     2012/05/17_18:09:27 info: Running
/etc/ha.d//rc.d/hb_takeover hb_takeover
May 17 18:09:27 mqhand1 heartbeat: [2216]: info: mqhand2 wants to go standby
[all]
May 17 18:09:27 mqhand1 ipfail: [2243]: debug: Other side is unstable.
May 17 18:09:30 mqhand1 heartbeat: [2216]: info: standby: acquire [all]
resources from mqhand2
May 17 18:09:30 mqhand1 heartbeat: [9233]: info: acquire all HA resources
(standby).
ResourceManager[9246]:  2012/05/17_18:09:31 info: Acquiring resource group:
mqhand1 172.19.253.100/24/eth0 drbddisk::drbd1
Filesystem::/dev/drbd1::/media/drbd1 rabbitmq-server
IPaddr[9274]:   2012/05/17_18:09:31 INFO:  Resource is stopped
ResourceManager[9246]:  2012/05/17_18:09:31 info: Running
/etc/ha.d/resource.d/IPaddr 172.19.253.100/24/eth0 start
IPaddr[9361]:   2012/05/17_18:09:31 INFO: Using calculated netmask for
172.19.253.100: 255.255.255.0
IPaddr[9361]:   2012/05/17_18:09:31 INFO: eval ifconfig eth0:0
172.19.253.100 netmask 255.255.255.0 broadcast 172.19.253.255
IPaddr[9335]:   2012/05/17_18:09:31 INFO:  Success
INFO:  Success
ResourceManager[9246]:  2012/05/17_18:09:31 info: Running
/etc/ha.d/resource.d/drbddisk drbd1 start
Filesystem[9498]:       2012/05/17_18:09:31 INFO:  Resource is stopped
ResourceManager[9246]:  2012/05/17_18:09:31 info: Running
/etc/ha.d/resource.d/Filesystem /dev/drbd1 /media/drbd1 start
Filesystem[9577]:       2012/05/17_18:09:31 INFO: Running start for
/dev/drbd1 on /media/drbd1
Filesystem[9577]:       2012/05/17_18:09:31 INFO: Starting filesystem check
on /dev/drbd1
fsck 1.39 (29-May-2006)
/dev/drbd1: clean, 863/10485760 files, 380283/20970783 blocks (check in 4
mounts)
Filesystem[9569]:       2012/05/17_18:09:31 INFO:  Success
INFO:  Success
ResourceManager[9246]:  2012/05/17_18:09:31 info: Running
/etc/init.d/rabbitmq-server  start
Starting rabbitmq-server: SUCCESS
rabbitmq-server.
May 17 18:09:36 mqhand1 heartbeat: [9233]: info: all HA resource acquisition
completed (standby).
May 17 18:09:36 mqhand1 heartbeat: [2216]: info: Standby resource
acquisition done [all].
May 17 18:09:36 mqhand1 heartbeat: [2216]: info: remote resource transition
completed.
May 17 18:09:36 mqhand1 ipfail: [2243]: debug: Other side is now stable.
May 17 18:09:36 mqhand1 ipfail: [2243]: debug: Other side is now stable.
ARPING 172.19.253.100 from 172.19.253.100 eth0
Sent 10 probes (10 broadcast(s))
Received 0 response(s)

so i'm confuse in the same environment setting,why rabbitmq 2.8.2 can't
start with heartbeat takeover?


Emile Joubert-2 wrote:
> 
> Hi,
> 
> On 17/05/12 03:43, askgax wrote:
>> i build a simple highly available environment in rabbitmq 2.7.1/Erlang
>> R14B03 with heartbeat 3.0.4/DRBD 8.3.11,and it's work fine and stable,
>> last  week i upgrade rabbitmq to 2.8.2 
> 
> [...]
> 
> Was there an error message in the broker logfile about the disk free
> space limit? Do you have less free disk space than RAM on the partition
> storing RabbitMQ data? If so then you should configure the disk free
> limit to a less conservative value.
> 
> If disk free space is not the cause then the logfile should still
> indicate the cause. Does it contain any error entries at startup?
> 
> 
> -Emile
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Rabbitmq-2.8.2-with-heartbeat-DRBD-fail-tp33863293p33864330.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From askgax at pchome.com.tw  Thu May 17 14:55:21 2012
From: askgax at pchome.com.tw (askgax)
Date: Thu, 17 May 2012 06:55:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq 2.8.2 with heartbeat/DRBD fail
In-Reply-To: <4FB4D31B.9060500@rabbitmq.com>
References: <d5f7b883-4012-4354-a638-71145e1facf6@ki5g2000pbb.googlegroups.com>
	<4FB4D31B.9060500@rabbitmq.com>
Message-ID: <33864333.post@talk.nabble.com>


Hi Emile,

thanks for reply,

my mq server have 4G ram,and disk usage status

[root at mq1 ~]# df -h
Filesystem            Size  Used Avail Use% Mounted on
/dev/vda3              26G  5.6G   19G  24% /
/dev/vda1              99M   12M   82M  13% /boot
tmpfs                 2.0G     0  2.0G   0% /dev/shm
/dev/drbd1             20G  176M   19G   1% /media/drbd1

both rabbitmq 2.7.1 and rabbitmq 2.8.2 environment are the same hardware
spec,

in rabbitmq 2.8.2 environment,execute heartbeat takeover,the debug log no
error about rabbitmq,

May 17 21:42:08 mq1 heartbeat: [2311]: debug: StartNextRemoteRscReq() -
calling hook
May 17 21:42:08 mq1 heartbeat: [2311]: debug: notify_world: invoking harc:
OLD status: active
May 17 21:42:08 mq1 heartbeat: [2311]: debug: Process [hb_takeover] started
pid 2561
May 17 21:42:08 mq1 heartbeat: [2311]: debug: Starting notify process
[hb_takeover]
May 17 21:42:08 mq1 heartbeat: [2561]: debug: notify_world: setting SIGCHLD
Handler to SIG_DFL
May 17 21:42:08 mq1 heartbeat: [2561]: debug: notify_world: Running harc
hb_takeover
harc[2561]:     2012/05/17_21:42:08 info: Running
/etc/ha.d//rc.d/hb_takeover hb_takeover
May 17 21:42:08 mq1 heartbeat: [2311]: info: Managed hb_takeover process
2561 exited with return code 0.
May 17 21:42:08 mq1 heartbeat: [2311]: debug: RscMgmtProc 'hb_takeover'
exited code 0
May 17 21:42:09 mq1 heartbeat: [2311]: debug: Received standby message me
from mq2 in state 0
May 17 21:42:09 mq1 heartbeat: [2311]: debug: ask_for_resources: other now
unstable
May 17 21:42:09 mq1 heartbeat: [2311]: info: mq2 wants to go standby [all]
May 17 21:42:09 mq1 heartbeat: [2311]: info: standby: other_holds_resources:
3
May 17 21:42:09 mq1 heartbeat: [2311]: debug: Sending standby [other] msg
May 17 21:42:09 mq1 heartbeat: [2311]: debug: Received standby message other
from mq1 in state 2
May 17 21:42:09 mq1 heartbeat: [2311]: info: New standby state: 2
May 17 21:42:09 mq1 heartbeat: [2311]: info: New standby state: 2
May 17 21:42:09 mq1 heartbeat: [2311]: debug: process_resources(2):  other
now unstable
May 17 21:42:09 mq1 heartbeat: [2311]: info: other_holds_resources: 0
May 17 21:42:09 mq1 heartbeat: [2311]: debug: hb_rsc_isstable:
ResourceMgmt_child_count: 0, other_is_stable: 0, takeover_in_progress: 0,
going_standby: 2, standby running(ms): 4395531970, resourcestate: 4
May 17 21:42:09 mq1 ipfail: [2341]: debug: Other side is unstable.
May 17 21:42:11 mq1 heartbeat: [2311]: debug: Received standby message done
from mq2 in state 2
May 17 21:42:11 mq1 heartbeat: [2311]: info: standby: acquire [all]
resources from mq2
May 17 21:42:11 mq1 heartbeat: [2311]: debug: Process [go_standby] started
pid 2612
May 17 21:42:11 mq1 heartbeat: [2311]: info: New standby state: 3
May 17 21:42:11 mq1 heartbeat: [2612]: info: acquire all HA resources
(standby).
May 17 21:42:11 mq1 heartbeat: [2612]: info: go_standby: who: 2 resource
set: all
May 17 21:42:11 mq1 heartbeat: [2612]: info: go_standby: (query/action):
(allkeys/takegroup)
ResourceManager[2625]:  2012/05/17_21:42:11 info: Acquiring resource group:
mq1 172.19.253.99/16/eth0 drbddisk::drbd1
Filesystem::/dev/drbd1::/media/drbd1 rabbitmq-server
IPaddr[2654]:   2012/05/17_21:42:11 INFO:  Resource is stopped
ResourceManager[2625]:  2012/05/17_21:42:11 info: Running
/etc/ha.d/resource.d/IPaddr 172.19.253.99/16/eth0 start
ResourceManager[2625]:  2012/05/17_21:42:11 debug: Starting
/etc/ha.d/resource.d/IPaddr 172.19.253.99/16/eth0 start
IPaddr[2748]:   2012/05/17_21:42:11 INFO: Using calculated netmask for
172.19.253.99: 255.255.0.0
IPaddr[2748]:   2012/05/17_21:42:11 DEBUG: Using calculated broadcast for
172.19.253.99: 172.19.255.255
IPaddr[2748]:   2012/05/17_21:42:11 INFO: eval ifconfig eth0:0 172.19.253.99
netmask 255.255.0.0 broadcast 172.19.255.255
IPaddr[2748]:   2012/05/17_21:42:11 DEBUG: Sending Gratuitous Arp for
172.19.253.99 on eth0:0 [eth0]
IPaddr[2722]:   2012/05/17_21:42:12 INFO:  Success
INFO:  Success
ResourceManager[2625]:  2012/05/17_21:42:12 debug:
/etc/ha.d/resource.d/IPaddr 172.19.253.99/16/eth0 start done. RC=0
ResourceManager[2625]:  2012/05/17_21:42:12 info: Running
/etc/ha.d/resource.d/drbddisk drbd1 start
ResourceManager[2625]:  2012/05/17_21:42:12 debug: Starting
/etc/ha.d/resource.d/drbddisk drbd1 start
ResourceManager[2625]:  2012/05/17_21:42:12 debug:
/etc/ha.d/resource.d/drbddisk drbd1 start done. RC=0
Filesystem[2916]:       2012/05/17_21:42:12 INFO:  Resource is stopped
ResourceManager[2625]:  2012/05/17_21:42:12 info: Running
/etc/ha.d/resource.d/Filesystem /dev/drbd1 /media/drbd1 start
ResourceManager[2625]:  2012/05/17_21:42:12 debug: Starting
/etc/ha.d/resource.d/Filesystem /dev/drbd1 /media/drbd1 start
Filesystem[2999]:       2012/05/17_21:42:12 INFO: Running start for
/dev/drbd1 on /media/drbd1
Filesystem[2999]:       2012/05/17_21:42:12 INFO: Starting filesystem check
on /dev/drbd1
fsck 1.39 (29-May-2006)
/dev/drbd1: clean, 442/2621440 files, 127224/5242683 blocks
Filesystem[2991]:       2012/05/17_21:42:13 INFO:  Success
INFO:  Success
ResourceManager[2625]:  2012/05/17_21:42:13 debug:
/etc/ha.d/resource.d/Filesystem /dev/drbd1 /media/drbd1 start done. RC=0
May 17 21:42:13 mq1 heartbeat: [2612]: info: all HA resource acquisition
completed (standby).
May 17 21:42:13 mq1 heartbeat: [2612]: debug: Sending standby [done] msg
May 17 21:42:13 mq1 heartbeat: [2612]: info: FIFO message [type
ask_resources] written rc=47
May 17 21:42:13 mq1 heartbeat: [2311]: debug: Received standby message done
from mq1 in state 3
May 17 21:42:13 mq1 heartbeat: [2311]: info: Standby resource acquisition
done [all].
May 17 21:42:13 mq1 heartbeat: [2311]: debug: Sending hold resources msg:
all, stable=1 # <none>
May 17 21:42:13 mq1 heartbeat: [2311]: info: AnnounceTakeover(local 1,
foreign 1, reason 'T_RESOURCES(us)' (1))
May 17 21:42:13 mq1 heartbeat: [2311]: debug: hb_rsc_isstable:
ResourceMgmt_child_count: 1, other_is_stable: 0, takeover_in_progress: 0,
going_standby: 0, standby running(ms): 0, resourcestate: 4
May 17 21:42:13 mq1 heartbeat: [2311]: info: New standby state: 0
May 17 21:42:13 mq1 heartbeat: [2311]: info: Managed go_standby process 2612
exited with return code 0.
May 17 21:42:13 mq1 heartbeat: [2311]: debug: RscMgmtProc 'go_standby'
exited code 0
May 17 21:42:13 mq1 heartbeat: [2311]: info: remote resource transition
completed.
May 17 21:42:13 mq1 heartbeat: [2311]: debug: Sending hold resources msg:
all, stable=1 # <none>
May 17 21:42:13 mq1 heartbeat: [2311]: info: AnnounceTakeover(local 1,
foreign 1, reason 'T_RESOURCES(us)' (1))
May 17 21:42:13 mq1 heartbeat: [2311]: debug: hb_rsc_isstable:
ResourceMgmt_child_count: 0, other_is_stable: 1, takeover_in_progress: 0,
going_standby: 0, standby running(ms): 0, resourcestate: 4
May 17 21:42:13 mq1 heartbeat: [2311]: debug: Calling PerformAutoFailback()
May 17 21:42:13 mq1 heartbeat: [2311]: info: other_holds_resources: 0
May 17 21:42:13 mq1 heartbeat: [2311]: debug: hb_rsc_isstable:
ResourceMgmt_child_count: 0, other_is_stable: 1, takeover_in_progress: 0,
going_standby: 0, standby running(ms): 0, resourcestate: 4
May 17 21:42:13 mq1 heartbeat: [2311]: info: other_holds_resources: 0
May 17 21:42:13 mq1 heartbeat: [2311]: debug: hb_rsc_isstable:
ResourceMgmt_child_count: 0, other_is_stable: 1, takeover_in_progress: 0,
going_standby: 0, standby running(ms): 0, resourcestate: 4
May 17 21:42:13 mq1 ipfail: [2341]: debug: Other side is now stable.
May 17 21:42:13 mq1 ipfail: [2341]: debug: Other side is now stable.
ARPING 172.19.253.99 from 172.19.253.99 eth0
Sent 10 probes (10 broadcast(s))
Received 0 response(s)


the same environment setting at rabbitmq 2.7.1 run heartbeat takeover,will
show rabbitmq start

May 17 18:09:26 mqhand1 heartbeat: [9216]: debug: notify_world: setting
SIGCHLD Handler to SIG_DFL
harc[9216]:     2012/05/17_18:09:27 info: Running
/etc/ha.d//rc.d/hb_takeover hb_takeover
May 17 18:09:27 mqhand1 heartbeat: [2216]: info: mqhand2 wants to go standby
[all]
May 17 18:09:27 mqhand1 ipfail: [2243]: debug: Other side is unstable.
May 17 18:09:30 mqhand1 heartbeat: [2216]: info: standby: acquire [all]
resources from mqhand2
May 17 18:09:30 mqhand1 heartbeat: [9233]: info: acquire all HA resources
(standby).
ResourceManager[9246]:  2012/05/17_18:09:31 info: Acquiring resource group:
mqhand1 172.19.253.100/24/eth0 drbddisk::drbd1
Filesystem::/dev/drbd1::/media/drbd1 rabbitmq-server
IPaddr[9274]:   2012/05/17_18:09:31 INFO:  Resource is stopped
ResourceManager[9246]:  2012/05/17_18:09:31 info: Running
/etc/ha.d/resource.d/IPaddr 172.19.253.100/24/eth0 start
IPaddr[9361]:   2012/05/17_18:09:31 INFO: Using calculated netmask for
172.19.253.100: 255.255.255.0
IPaddr[9361]:   2012/05/17_18:09:31 INFO: eval ifconfig eth0:0
172.19.253.100 netmask 255.255.255.0 broadcast 172.19.253.255
IPaddr[9335]:   2012/05/17_18:09:31 INFO:  Success
INFO:  Success
ResourceManager[9246]:  2012/05/17_18:09:31 info: Running
/etc/ha.d/resource.d/drbddisk drbd1 start
Filesystem[9498]:       2012/05/17_18:09:31 INFO:  Resource is stopped
ResourceManager[9246]:  2012/05/17_18:09:31 info: Running
/etc/ha.d/resource.d/Filesystem /dev/drbd1 /media/drbd1 start
Filesystem[9577]:       2012/05/17_18:09:31 INFO: Running start for
/dev/drbd1 on /media/drbd1
Filesystem[9577]:       2012/05/17_18:09:31 INFO: Starting filesystem check
on /dev/drbd1
fsck 1.39 (29-May-2006)
/dev/drbd1: clean, 863/10485760 files, 380283/20970783 blocks (check in 4
mounts)
Filesystem[9569]:       2012/05/17_18:09:31 INFO:  Success
INFO:  Success
ResourceManager[9246]:  2012/05/17_18:09:31 info: Running
/etc/init.d/rabbitmq-server  start
Starting rabbitmq-server: SUCCESS
rabbitmq-server.
May 17 18:09:36 mqhand1 heartbeat: [9233]: info: all HA resource acquisition
completed (standby).
May 17 18:09:36 mqhand1 heartbeat: [2216]: info: Standby resource
acquisition done [all].
May 17 18:09:36 mqhand1 heartbeat: [2216]: info: remote resource transition
completed.
May 17 18:09:36 mqhand1 ipfail: [2243]: debug: Other side is now stable.
May 17 18:09:36 mqhand1 ipfail: [2243]: debug: Other side is now stable.
ARPING 172.19.253.100 from 172.19.253.100 eth0
Sent 10 probes (10 broadcast(s))
Received 0 response(s)

so i'm confuse in the same environment setting,why rabbitmq 2.8.2 can't
start with heartbeat takeover?


Emile Joubert-2 wrote:
> 
> Hi,
> 
> On 17/05/12 03:43, askgax wrote:
>> i build a simple highly available environment in rabbitmq 2.7.1/Erlang
>> R14B03 with heartbeat 3.0.4/DRBD 8.3.11,and it's work fine and stable,
>> last  week i upgrade rabbitmq to 2.8.2 
> 
> [...]
> 
> Was there an error message in the broker logfile about the disk free
> space limit? Do you have less free disk space than RAM on the partition
> storing RabbitMQ data? If so then you should configure the disk free
> limit to a less conservative value.
> 
> If disk free space is not the cause then the logfile should still
> indicate the cause. Does it contain any error entries at startup?
> 
> 
> -Emile
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Rabbitmq-2.8.2-with-heartbeat-DRBD-fail-tp33863293p33864333.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alexander.ward at quibids.com  Thu May 17 15:08:56 2012
From: alexander.ward at quibids.com (Alexander Ward)
Date: Thu, 17 May 2012 09:08:56 -0500
Subject: [rabbitmq-discuss] How to deal with duplicated msgs when using
	HA mirror?
In-Reply-To: <20120517100623.GA7602@rabbitmq.com>
References: <CAB6nog+GRMjrNAafNMsNbfkrvEWfjuvA_tDXd+p1eaM-3Z4m2A@mail.gmail.com>
	<CAB6nogLW+djn8E3SC-Y0LXEU79NcrheEZoHW4GvQAw3AvTTaiw@mail.gmail.com>
	<20120517100623.GA7602@rabbitmq.com>
Message-ID: <CAKeoubXUipZk=73b4mZHJC0V1X+WOfFz2nuYjc5mGYATciO33w@mail.gmail.com>

What I've been doing is keeping a log in memcached of what tasks were in
process, and then persisting those to some kind of non-volatile storage,
along with their completion status. If I get a message for the same task, I
check to see if another process was already handling it before starting it
on one of the consumers.

- Alex

On Thu, May 17, 2012 at 5:06 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Hi,
>
> On Thu, May 17, 2012 at 09:27:29AM +0800, ??? wrote:
> > As the article <<High Availability in RabbitMQ: solving part of the
> > puzzle<
> http://www.rabbitmq.com/blog/2011/10/25/high-availability-in-rabbitmq-solving-part-of-the-puzzle/
> >>>
> > mentioned, when master breakdown,  the last ack maybe not sync to all
> > slave,so when a slave promote to be a new master, the msgs which actualy
> be
> > consumed maybe redelivered to the consumers.
> > Is there any way to  identify these duplicated messages? our  scenario
> is :
> > multi producers, multi queue (every consumer has a private queue ), a
> > direct exchange and a fanout exchange.
>
> Actually, msg duplication can happen via a number of means not involving
> HA at all. HA just adds a few more places where such duplication can
> occur.
>
> There is no automatic way: a msg that's has the "isDelivered" flag set
> on it *may* have already been delivered to another client, which is to
> say that if that flag isn't set, then you shouldn't have to test for
> duplication. But really, you're going to have to have some sort of
> client side cache of hashes of recently seen messages, or some such.
>
> I'm afraid I'm not aware of any off-the-shelf solution for this, but
> this problem crops up regularly so there should be a fair amount of
> material out there on this stuff.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/382d5d2f/attachment.htm>

From aaron at agoragames.com  Thu May 17 15:26:02 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 17 May 2012 10:26:02 -0400
Subject: [rabbitmq-discuss] haigha with rabbit extensions
Message-ID: <CAHiEoM4Q68MtbAc89O7s6hZD62mBWRKvrKC9dZtPqKxkRw7SHw@mail.gmail.com>

I released 0.5.2 yesterday which supports all of the RabbitMQ AMQP
extensions. I added/updated some documentation as well and
standardized on basic python sockets for applications that don't need
gevent or libevent support.  Feedback and bug reports appreciated,
this will be the last "major" release for awhile and I'm not expecting
significant API changes. I documented the anticipated roadmap in the
README.

https://github.com/agoragames/haigha


cheers,
Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From matthias at rabbitmq.com  Thu May 17 16:34:06 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 17 May 2012 16:34:06 +0100
Subject: [rabbitmq-discuss] Orphaned RabbitMQ Connections Problem
 Causing Client to Not Communicate With Server
In-Reply-To: <44b177d5-fa27-42b6-adc5-a983981556c5@e9g2000pbh.googlegroups.com>
References: <44b177d5-fa27-42b6-adc5-a983981556c5@e9g2000pbh.googlegroups.com>
Message-ID: <4FB51A6E.2050204@rabbitmq.com>

Demetree,

On 16/05/12 16:13, Demetree wrote:
> I'm having an issue with our rabbit servers where one of our sites
> cannot consistenly hold connections ( or so it seems ).  The symptom
> is that the Rabbit MQ server shows multiple connections on multiple
> ports, but they don't correspond to connections on the clients.
> Netstats show a single connection on the client side.
>
> When this situation arises, the clients no longer pull data down from
> the queue.
>
> We're not able to resolve this, and the logs show SSL errors, but this
> also occurs on non-SSL connections.
>
> Has anybody experienced this before, and have any suggestions?
>
>
> We are connecting to the server with a  Java client.

Try enabling heartbeats: 
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.8.2/rabbitmq-java-client-javadoc-2.8.2/com/rabbitmq/client/ConnectionFactory.html#setRequestedHeartbeat(int)

Matthias.

From fernandomorgenstern.fm at gmail.com  Thu May 17 14:32:10 2012
From: fernandomorgenstern.fm at gmail.com (Fernando Morgenstern)
Date: Thu, 17 May 2012 06:32:10 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ crash without errors
Message-ID: <a48684bd-27b6-477a-aa56-69e0efa05e18@l17g2000vbj.googlegroups.com>

Hi,

I have a RabbitMQ server which had been running for 2 months without
any problem. It handles 3 queues ( set as durable ) and a very low
message rate ( ~60/day ).

Last night it simply crashed and *lost all messages in queue*. It
seems to have stopped working around 4 am and only came back at 8 am
after a manual restart.

I tried to do a grep in /var/log/rabbitmq for ERROR but the only
messages that i found were these ones:

./rabbit at mr.log:=ERROR REPORT==== 14-May-2012::20:02:31 ===
./rabbit at mr.log-exception on TCP connection <0.26131.1469> from
127.0.0.1:62497
./rabbit at mr.log-{bad_header,<<"GET /api">>}

Which looks like a problem in client and shouldn't crash server.

My questions are:

1) How should i proceed to investigate this problem? Are there other
logs that i should look?

2) Why RabbitMQ lost all messages if all queues were set as durable?

RabbitMQ/Erlang version 2.7.1 / R14B04
OS: CentOS 6.0

From clay at sseband.com  Thu May 17 16:28:52 2012
From: clay at sseband.com (Clay McClure)
Date: Thu, 17 May 2012 11:28:52 -0400
Subject: [rabbitmq-discuss] Read-only access to STOMP topic
In-Reply-To: <4FB4D235.7000502@rabbitmq.com>
References: <0fa11742-8cbb-4125-94ee-a92c485c6734@d33g2000yqa.googlegroups.com>
	<4FB4D235.7000502@rabbitmq.com>
Message-ID: <CA+_KaB0=XUniHX1=PaoAEAV4cOS19r5Yk8gv89UXVk+RgRk_cA@mail.gmail.com>

Thanks Simon, that did the trick.

Now I'm trying to sort out why I'm seeing intermittent message loss. My
subscribers are long-running processes that CONNECT and SUBSCRIBE once at
start-up, so I don't think it's the same problem I've seen on the mailing
list re: receipt headers. My publishers, however, are short-lived,
ephemeral processes that CONNECT, SEND, and terminate. About 10% of the
time these messages aren't making it to the subscribers. Does this sound
like a known issue?

Thanks,

Clay


On Thu, May 17, 2012 at 6:25 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 16/05/12 22:50, Clay McClure wrote:
>
>> Howdy,
>>
>
> Hi!
>
>  I would like to grant a user read-only access to a STOMP topic, while
>> granting another user read-write access to that same topic. In this
>> way, I can be assured that topic subscribers cannot also post messages
>> to the topic. I've tried using the following permissions:
>>
>>     rabbitmqctl set_permissions read-only-user '.*' '^$' '.*'
>>     rabbitmqctl set_permissions read-write-user '.*' '.*' '.*'
>>
>> which would, in my view, prevent the read-only-user from writing to
>> any topic.
>>
>
> Yes. But it also prevents them from writing to any *queue*. Try:
>
> rabbitmqctl set_permissions read-only-user '.*' '^amq.gen.*$' '.*'
>
> to allow them to write to (i.e. bind) the queue they created.
>
> or
>
> rabbitmqctl set_permissions read-only-user '^amq.gen.*$' '^amq.gen.*$' '.*'
>
> to restrict what they can create, as well.
>
>  However, it seems that write permission is required to bind
>> to an exchange (http://www.rabbitmq.com/**access-control.html<http://www.rabbitmq.com/access-control.html>
>> ),
>>
>
> Write permission is required to bind to an exchange as a *destination*,
> when using exchange-to-exchange bindings. The idea is that read permission
> means "bind so that I can read messages from" and write means "bind so that
> I can write messages to".
>
> Cheers, Simon
>
>
>  so when
>> the read-only-user tries to SUBSCRIBE to the topic, we get:
>>
>>     ACCESS_REFUSED - access to queue 'amq.gen-JUCwAsef2r336/
>> uzsYwAmA==' in vhost '/' refused for user 'read-only-user'
>>
>> How can I grant read-only access to the topic?
>>
>> Thanks,
>>
>> Clay
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
Clay McClure
Management & Booking
Effective Entertainment LLC
404-314-1351
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/1c77ccbd/attachment.htm>

From ctlajoie at gmail.com  Thu May 17 18:33:45 2012
From: ctlajoie at gmail.com (Chris)
Date: Thu, 17 May 2012 11:33:45 -0600
Subject: [rabbitmq-discuss] What happens to messages delivered just before
	canceling consume?
Message-ID: <CAO-4Wf5QjFYf0VXqMiOJSXWMPRy=RUOrhLs-vyn27C_9+i9+ew@mail.gmail.com>

At some point in my consume loop, after acking a message, I need to
stop consuming (temporarily). I will have multiple consumer processes
running and the others must pick up the slack while this one is out of
the loop. I am using a prefetch count of 1, so I assume it's possible
for there to be 1 additional message delivered to my consumer *after*
I ack the final message, but *before* I cancel the consumer.

I have 2 questions regarding this additional message:
 1. If I do nothing, will it be eventually returned to the queue for
processing by another consumer?
 2. After doing basic.cancel to stop my consumer, can I read in the
aditional message and nack it, returning it to the queue?

From videlalvaro at gmail.com  Thu May 17 19:36:46 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 17 May 2012 20:36:46 +0200
Subject: [rabbitmq-discuss] RabbitMQ crash without errors
In-Reply-To: <a48684bd-27b6-477a-aa56-69e0efa05e18@l17g2000vbj.googlegroups.com>
References: <a48684bd-27b6-477a-aa56-69e0efa05e18@l17g2000vbj.googlegroups.com>
Message-ID: <0639BECCC3B04A8287A04BA951DEF70F@gmail.com>

Hi,


On Thursday, May 17, 2012 at 3:32 PM, Fernando Morgenstern wrote:

> 2) Why RabbitMQ lost all messages if all queues were set as durable?
> 
> 

 Queue durability just guarantees that the queue won't be deleted after a broker restart. If you want persistent messages then you need to publish your messages with delivery_mode=2.

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/679e592e/attachment.htm>

From bino at indoakses-online.com  Fri May 18 03:10:59 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Fri, 18 May 2012 09:10:59 +0700
Subject: [rabbitmq-discuss] basic configuration file in ubuntu.
In-Reply-To: <4FB4C3AB.6060706@rabbitmq.com>
References: <4FB46D08.3070405@indoakses-online.com>
	<4FB4C3AB.6060706@rabbitmq.com>
Message-ID: <4FB5AFB3.6060707@indoakses-online.com>

Dear All
C/q Tim, Thankyou for your enlightment
On 05/17/2012 04:23 PM, tim wrote:
>
>
> You can simply create the config file in the expected location. Once 
> you've configured both your broker instances correctly, you can 
> specify the auth details and other connection settings in the shovel 
> configuration - see http://www.rabbitmq.com/shovel.html for details.
>

I tried to write a very basic configuration (no credentials things), and 
it work.

Next I try to start playing with shovel
1. I Set another broker in another engine , let's name it 'core'
2. my shovel enabled in engine 'bino-desktop'

3. Before I add shovel config to my rabbitmq.config, the shovel status 
query only show '[]', I think it's because I didn't add the shovel 
config first.

4. I try to add shovel things to my config file, adopting the example 
configuration from http://www.rabbitmq.com/shovel.html , but only the 
'mandatory' things.
Here is my try (/etc/rabbitmq/.config) :
-----START----------
bino at bino-desktop:/etc/rabbitmq$ cat rabbitmq.config
[
     {mnesia, [{dump_log_write_threshold, 1000}]},
     {rabbit, [{tcp_listeners, [5673]}]},
     {rabbitmq_shovel,
         [{shovels,
             [{my_first_shovel,
                 {sources,[{broker, "amqp://"}]
                 },
                 {destinations,[{broker, 
"amqp://guest:guest at 192.168.10.241"}]
                 },
                 {queue, <<"task_queue">>}
             }]
         }]
     }
].

-----STOP-----------

5. try to restart the rabbitmq service ... and it failed.
I got this from the startup_err :
------START---------
bino at bino-desktop:/etc/rabbitmq$ cat /var/log/rabbitmq/startup_err

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) 
({application_start_failure,rabbitmq_shovel,{require_list_of_shovel_configurations,{rabbit_shovel,start,[normal,[]]}}})
------STOP----------

Kindly please tell me what to do .

Sincerely
-bino-

From bino at indoakses-online.com  Fri May 18 06:10:41 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Fri, 18 May 2012 12:10:41 +0700
Subject: [rabbitmq-discuss] basic configuration file in ubuntu.
In-Reply-To: <4FB5AFB3.6060707@indoakses-online.com>
References: <4FB46D08.3070405@indoakses-online.com>	<4FB4C3AB.6060706@rabbitmq.com>
	<4FB5AFB3.6060707@indoakses-online.com>
Message-ID: <4FB5D9D1.5030300@indoakses-online.com>

Dear All.
Kindly please ignore my previous post about shovel minimal config

Now it works.
I pick the config from 
https://github.com/rabbitinaction/sourcecode/blob/master/configs/rabbitmq/rabbitmq.config.shovel

Sincerely
-bino-

On 05/18/2012 09:10 AM, bino oetomo wrote:
> Dear All
> C/q Tim, Thankyou for your enlightment
> On 05/17/2012 04:23 PM, tim wrote:
>>
>>
>> You can simply create the config file in the expected location. Once 
>> you've configured both your broker instances correctly, you can 
>> specify the auth details and other connection settings in the shovel 
>> configuration - see http://www.rabbitmq.com/shovel.html for details.
>>
>
> I tried to write a very basic configuration (no credentials things), 
> and it work.
>
> Next I try to start playing with shovel
> 1. I Set another broker in another engine , let's name it 'core'
> 2. my shovel enabled in engine 'bino-desktop'
>
> 3. Before I add shovel config to my rabbitmq.config, the shovel status 
> query only show '[]', I think it's because I didn't add the shovel 
> config first.
>
> 4. I try to add shovel things to my config file, adopting the example 
> configuration from http://www.rabbitmq.com/shovel.html , but only the 
> 'mandatory' things.
> Here is my try (/etc/rabbitmq/.config) :
> -----START----------
> bino at bino-desktop:/etc/rabbitmq$ cat rabbitmq.config
> [
>     {mnesia, [{dump_log_write_threshold, 1000}]},
>     {rabbit, [{tcp_listeners, [5673]}]},
>     {rabbitmq_shovel,
>         [{shovels,
>             [{my_first_shovel,
>                 {sources,[{broker, "amqp://"}]
>                 },
>                 {destinations,[{broker, 
> "amqp://guest:guest at 192.168.10.241"}]
>                 },
>                 {queue, <<"task_queue">>}
>             }]
>         }]
>     }
> ].
>
> -----STOP-----------
>
> 5. try to restart the rabbitmq service ... and it failed.
> I got this from the startup_err :
> ------START---------
> bino at bino-desktop:/etc/rabbitmq$ cat /var/log/rabbitmq/startup_err
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller) 
> ({application_start_failure,rabbitmq_shovel,{require_list_of_shovel_configurations,{rabbit_shovel,start,[normal,[]]}}})
> ------STOP----------
>
> Kindly please tell me what to do .
>
> Sincerely
> -bino-
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From bino at indoakses-online.com  Fri May 18 09:13:36 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Fri, 18 May 2012 15:13:36 +0700
Subject: [rabbitmq-discuss] question,
	Shovel : different queue name between source and destination
Message-ID: <4FB604B0.8090300@indoakses-online.com>

Dear All ....

Is it possible to use shovel with different queue_name between source 
and destination ?

my current config file is :
--------START-----------
[
     {mnesia, [{dump_log_write_threshold, 100}
              ]},
     {rabbit, [{vm_memory_high_watermark, 0.4}
              ]},
     {rabbitmq_shovel,
        [{shovels,
          [{myshovel,
            [{sources, [{broker, "amqp://guest:guest at localhost"}]},
             {destinations, [{broker, 
"amqp://guest:guest at 192.168.10.241"}]},
             {queue, <<"task_queue">>},
             {reconnect_delay, 5}
            ]}
           ]
         }]
      }
].

--------STOP------------

What if the queue name at the source broker is 'src_q1' and at the 
destination broker is 'dst_q1' ?

Sincerely
-bino-

From brendan at soundcloud.com  Fri May 18 09:37:20 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Fri, 18 May 2012 10:37:20 +0200
Subject: [rabbitmq-discuss] question,
 Shovel : different queue name between source and destination
In-Reply-To: <4FB604B0.8090300@indoakses-online.com>
References: <4FB604B0.8090300@indoakses-online.com>
Message-ID: <CAHZsVQbpkZB_dF+qoaHWmK77Q7MZ0WF4V06rQyBj=wh1VOTFCQ@mail.gmail.com>

Bino,

You consume from a queue on one broker, and publish/shovel to an exchange
somewhere else..

Therefore, you can use the 'declarations' part of 'destination'
configuration to set up a differently named queue and bind it to the
exchange to which the messages are being published.

I've tried to outline the above in a (untested) configuration snippet here:
https://gist.github.com/2723964

It simply predeclares an exchange, queue, and binding on the source
'host1', so messages published to <<"source_exchange">> (with the direct
routing key) will be consumed by shovel, and then published to
<<"destination_exchange">> on the destination 'host2'.

Because of the declarations in the destination configuration, messages will
then be routed and queued in <<"destination_queue">>

Hopefully that makes sense.

- Brendan

On Fri, May 18, 2012 at 10:13 AM, bino oetomo <bino at indoakses-online.com>wrote:

> Dear All ....
>
> Is it possible to use shovel with different queue_name between source and
> destination ?
>
> my current config file is :
> --------START-----------
> [
>    {mnesia, [{dump_log_write_threshold, 100}
>             ]},
>    {rabbit, [{vm_memory_high_watermark, 0.4}
>             ]},
>    {rabbitmq_shovel,
>       [{shovels,
>         [{myshovel,
>           [{sources, [{broker, "amqp://guest:guest at localhost"**}]},
>            {destinations, [{broker, "amqp://guest:guest at 192.168.**10.241<guest%3Aguest at 192.168.10.241>
> "}]},
>            {queue, <<"task_queue">>},
>            {reconnect_delay, 5}
>           ]}
>          ]
>        }]
>     }
> ].
>
> --------STOP------------
>
> What if the queue name at the source broker is 'src_q1' and at the
> destination broker is 'dst_q1' ?
>
> Sincerely
> -bino-
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120518/be54a0ec/attachment.htm>

From andrea.rosa at hp.com  Fri May 18 10:09:40 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Fri, 18 May 2012 09:09:40 +0000
Subject: [rabbitmq-discuss] Orphaned RabbitMQ Connections Problem
 Causing Client to Not Communicate With Server
In-Reply-To: <44b177d5-fa27-42b6-adc5-a983981556c5@e9g2000pbh.googlegroups.com>
References: <44b177d5-fa27-42b6-adc5-a983981556c5@e9g2000pbh.googlegroups.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD3696DB29@G9W0721.americas.hpqcorp.net>



>-----Original Message-----
>From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
>discuss-bounces at lists.rabbitmq.com] On Behalf Of Demetree
>Sent: 16 May 2012 16:14
>To: rabbitmq-discuss at lists.rabbitmq.com
>Subject: [rabbitmq-discuss] Orphaned RabbitMQ Connections Problem
>Causing Client to Not Communicate With Server
>
>Hi,
>
>I'm having an issue with our rabbit servers where one of our sites
>cannot consistenly hold connections ( or so it seems ).  The symptom
>is that the Rabbit MQ server shows multiple connections on multiple
>ports, but they don't correspond to connections on the clients.
>Netstats show a single connection on the client side.
>
>When this situation arises, the clients no longer pull data down from
>the queue.
>
>We're not able to resolve this, and the logs show SSL errors, but this
>also occurs on non-SSL connections.
>
>Has anybody experienced this before, and have any suggestions?

I'd give a go also to the SO_KEEPALIVE option, I think you can enable it on rabbit - via  /etc/rabbitmq/rabbit.config
Let me know if it works
--
Andrea Rosa

From codevally.mail.list at gmail.com  Fri May 18 01:25:44 2012
From: codevally.mail.list at gmail.com (Roshan Pradeep)
Date: Thu, 17 May 2012 17:25:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Disk space monitoring watermark issue on 2.8.2
Message-ID: <b2672528-4ac4-4cad-8a45-909d74ad8236@googlegroups.com>

Hi 

Today I upgrade our local development RabbitMQ cluster to it's 2.8.2 new 
version. After checking cluster through monitoring tool I noticed some red 
boxes for diskspace watermark. I found this feature in the RabbitMQ 
documentation and could someone please explain me how this feature really 
works/importance in production environment. Because on my production it is 
2.7.1 installed.

Many Thanks

/Roshan  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/1c1f59e5/attachment.htm>

From codevally.mail.list at gmail.com  Fri May 18 02:00:40 2012
From: codevally.mail.list at gmail.com (Roshan Pradeep)
Date: Thu, 17 May 2012 18:00:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Disk space monitoring watermark issue on
	2.8.2
In-Reply-To: <b2672528-4ac4-4cad-8a45-909d74ad8236@googlegroups.com>
References: <b2672528-4ac4-4cad-8a45-909d74ad8236@googlegroups.com>
Message-ID: <7c13bc88-6999-4f0d-8f35-c5f616aed5dd@googlegroups.com>

In addition to the same issue, when I publishing high rate of messages, the 
yelllow box is on for the connection side and it says "Publishing rate 
recently restricted by server". 

Anyone know why is that?

/Roshan

On Friday, May 18, 2012 10:25:44 AM UTC+10, Roshan Pradeep wrote:
>
> Hi 
>
> Today I upgrade our local development RabbitMQ cluster to it's 2.8.2 new 
> version. After checking cluster through monitoring tool I noticed some red 
> boxes for diskspace watermark. I found this feature in the RabbitMQ 
> documentation and could someone please explain me how this feature really 
> works/importance in production environment. Because on my production it is 
> 2.7.1 installed.
>
> Many Thanks
>
> /Roshan  
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/ce7c5b2d/attachment.htm>

From jose.mico at gmail.com  Fri May 18 06:18:11 2012
From: jose.mico at gmail.com (=?UTF-8?Q?Jos=C3=A9_Mic=C3=B3?=)
Date: Thu, 17 May 2012 22:18:11 -0700 (PDT)
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of a burst
Message-ID: <226517f0-2ad1-4583-8a63-4c65b4bb247d@googlegroups.com>

I think I've found a somewhat serious bug in the STOMP adapter: after a 
burst of incoming messages, the last one remains buffered somewhere 
indefinitely and is not added to the queue until another message is 
received from the same connection (same with topics). This cause and 
excessive delay to deliver the message to consumers, if it is ever 
delivered. Besides that, that last message is lost if the connection is not 
properly closed.

I've attached a simple script which replicates the bug. It sends burst of 
100 small messages to a queue every 10 seconds. Using the management 
console, we can inspect the count of Ready messages. The expected 
progression is 100 ... 200 ... 300 ... 400 ... 500, but very frequently 
(not always) we get 99 ... 199 ... 299 ... 399 ... 499, as the last message 
is not queued.

Could be that the STOMP parser gets confused after an incomplete frame was 
read from tcp buffer? Any ideas?

Regards,
Jos?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/59a5e2d2/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: stomp_bug.pl
Type: text/x-perl
Size: 1181 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120517/59a5e2d2/attachment.pl>

From emile at rabbitmq.com  Fri May 18 10:44:00 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 18 May 2012 10:44:00 +0100
Subject: [rabbitmq-discuss] What happens to messages delivered just
 before canceling consume?
In-Reply-To: <CAO-4Wf5QjFYf0VXqMiOJSXWMPRy=RUOrhLs-vyn27C_9+i9+ew@mail.gmail.com>
References: <CAO-4Wf5QjFYf0VXqMiOJSXWMPRy=RUOrhLs-vyn27C_9+i9+ew@mail.gmail.com>
Message-ID: <4FB619E0.2020700@rabbitmq.com>

Hi,

On 17/05/12 18:33, Chris wrote:
> At some point in my consume loop, after acking a message, I need to
> stop consuming (temporarily). I will have multiple consumer processes
> running and the others must pick up the slack while this one is out of
> the loop. I am using a prefetch count of 1, so I assume it's possible
> for there to be 1 additional message delivered to my consumer *after*
> I ack the final message, but *before* I cancel the consumer.

The prefetch count determines how many unacknowledged messages a
consumer is allowed to hold. Yes, it is possible for another delivery to
reach the consumer after sending the ack and before receiving the
cancel-ok.

> I have 2 questions regarding this additional message:
>  1. If I do nothing, will it be eventually returned to the queue for
> processing by another consumer?

Unacknowledged messages will be returned to the broker when the channel
is closed, or is any of these methods are invoked with requeue:
basic.recover, basic.reject and basic.nack.

>  2. After doing basic.cancel to stop my consumer, can I read in the
> aditional message and nack it, returning it to the queue?

Yes, nack with requeue. Alternatively you could cancel the subscription
before acknowledging the last message. Another option is to turn off
prefetching (prefetch = 0). If you need more precise control over when
clients may receive messages, and you don't care about throughput then
consider using basic.get.

-Emile


From simon at rabbitmq.com  Fri May 18 10:44:28 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 18 May 2012 10:44:28 +0100
Subject: [rabbitmq-discuss] What happens to messages delivered just
 before canceling consume?
In-Reply-To: <4FB619E0.2020700@rabbitmq.com>
References: <CAO-4Wf5QjFYf0VXqMiOJSXWMPRy=RUOrhLs-vyn27C_9+i9+ew@mail.gmail.com>
	<4FB619E0.2020700@rabbitmq.com>
Message-ID: <4FB619FC.8020304@rabbitmq.com>

On 18/05/12 10:44, Emile Joubert wrote:
>> >    2. After doing basic.cancel to stop my consumer, can I read in the
>> >  aditional message and nack it, returning it to the queue?
> Yes, nack with requeue. Alternatively you could cancel the subscription
> before acknowledging the last message.

Probably the simplest thing to do.

> Another option is to turn off prefetching (prefetch = 0).

Um, doesn't that just mean you get a deluge of messages instead?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Fri May 18 10:53:50 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 18 May 2012 10:53:50 +0100
Subject: [rabbitmq-discuss] Read-only access to STOMP topic
In-Reply-To: <CA+_KaB0=XUniHX1=PaoAEAV4cOS19r5Yk8gv89UXVk+RgRk_cA@mail.gmail.com>
References: <0fa11742-8cbb-4125-94ee-a92c485c6734@d33g2000yqa.googlegroups.com>
	<4FB4D235.7000502@rabbitmq.com>
	<CA+_KaB0=XUniHX1=PaoAEAV4cOS19r5Yk8gv89UXVk+RgRk_cA@mail.gmail.com>
Message-ID: <00DA04FD-B32C-4EE3-9CC0-95BA755EBED9@rabbitmq.com>

Clay,

This looks like a bug (two people appear to have spotted this!), but
while we investigate, you could try making the publishers ask for a
receipt for the SEND. It is possible that terminating abruptly may
interfere with the propagation of the last message.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 17 May 2012, at 16:28, Clay McClure wrote:

> Thanks Simon, that did the trick.
> 
> Now I'm trying to sort out why I'm seeing intermittent message loss. My subscribers are long-running processes that CONNECT and SUBSCRIBE once at start-up, so I don't think it's the same problem I've seen on the mailing list re: receipt headers. My publishers, however, are short-lived, ephemeral processes that CONNECT, SEND, and terminate. About 10% of the time these messages aren't making it to the subscribers. Does this sound like a known issue?
> 
> Thanks,
> 
> Clay
> 
> 
> On Thu, May 17, 2012 at 6:25 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 16/05/12 22:50, Clay McClure wrote:
> Howdy,
> 
> Hi!
> 
> I would like to grant a user read-only access to a STOMP topic, while
> granting another user read-write access to that same topic. In this
> way, I can be assured that topic subscribers cannot also post messages
> to the topic. I've tried using the following permissions:
> 
>     rabbitmqctl set_permissions read-only-user '.*' '^$' '.*'
>     rabbitmqctl set_permissions read-write-user '.*' '.*' '.*'
> 
> which would, in my view, prevent the read-only-user from writing to
> any topic.
> 
> Yes. But it also prevents them from writing to any *queue*. Try:
> 
> rabbitmqctl set_permissions read-only-user '.*' '^amq.gen.*$' '.*'
> 
> to allow them to write to (i.e. bind) the queue they created.
> 
> or
> 
> rabbitmqctl set_permissions read-only-user '^amq.gen.*$' '^amq.gen.*$' '.*'
> 
> to restrict what they can create, as well.
> 
> However, it seems that write permission is required to bind
> to an exchange (http://www.rabbitmq.com/access-control.html),
> 
> Write permission is required to bind to an exchange as a *destination*, when using exchange-to-exchange bindings. The idea is that read permission means "bind so that I can read messages from" and write means "bind so that I can write messages to".
> 
> Cheers, Simon
> 
> 
> so when
> the read-only-user tries to SUBSCRIBE to the topic, we get:
> 
>     ACCESS_REFUSED - access to queue 'amq.gen-JUCwAsef2r336/
> uzsYwAmA==' in vhost '/' refused for user 'read-only-user'
> 
> How can I grant read-only access to the topic?
> 
> Thanks,
> 
> Clay
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> 
> 
> 
> -- 
> Clay McClure
> Management & Booking
> Effective Entertainment LLC
> 404-314-1351
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Fri May 18 10:56:52 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 18 May 2012 10:56:52 +0100
Subject: [rabbitmq-discuss] Disk space monitoring watermark issue on
	2.8.2
In-Reply-To: <7c13bc88-6999-4f0d-8f35-c5f616aed5dd@googlegroups.com>
References: <b2672528-4ac4-4cad-8a45-909d74ad8236@googlegroups.com>
	<7c13bc88-6999-4f0d-8f35-c5f616aed5dd@googlegroups.com>
Message-ID: <4FB61CE4.7050003@rabbitmq.com>

Hi,

On 18/05/12 02:00, Roshan Pradeep wrote:
> In addition to the same issue, when I publishing high rate of messages,
> the yelllow box is on for the connection side and it says "Publishing
> rate recently restricted by server".

This means that your publishers are sending messages too fast for the
queues to keep up. More details can be found here:

http://www.rabbitmq.com/memory.html#per-connection

>     Today I upgrade our local development RabbitMQ cluster to it's 2.8.2
>     new version. After checking cluster through monitoring tool I
>     noticed some red boxes for diskspace watermark. I found this feature
>     in the RabbitMQ documentation and could someone please explain me
>     how this feature really works/importance in production environment.
>     Because on my production it is 2.7.1 installed.

Disk free space monitoring is a new feature in v2.8.2. By default this
will block producers if you have less free disk space (in the partition
RabbitMQ is using) than RAM. See here for details:

http://www.rabbitmq.com/memory.html#diskfreesup


-Emile


From bino at indoakses-online.com  Fri May 18 11:05:23 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Fri, 18 May 2012 17:05:23 +0700
Subject: [rabbitmq-discuss] question,
 Shovel : different queue name between source and destination
In-Reply-To: <CAHZsVQbpkZB_dF+qoaHWmK77Q7MZ0WF4V06rQyBj=wh1VOTFCQ@mail.gmail.com>
References: <4FB604B0.8090300@indoakses-online.com>
	<CAHZsVQbpkZB_dF+qoaHWmK77Q7MZ0WF4V06rQyBj=wh1VOTFCQ@mail.gmail.com>
Message-ID: <4FB61EE3.80702@indoakses-online.com>

Dear Brendan
I really appreciate your help
On 05/18/2012 03:37 PM, Brendan Hay wrote:
> Bino,
> ...
> I've tried to outline the above in a (untested) configuration snippet here:
> https://gist.github.com/2723964
>

I try to adopt your configuration.
Here is my config file at http://pastebin.com/b6Z2UNqJ

When I try to post msg to source broker .. got no error
But ... some how the msg is looks like going no where

I check the management GUI :
1. Source broker .... no ready msg in all queue
2. Destination broker .... no ready msg in all queue in all vhost

Sincerely
-bino-


From steve at rabbitmq.com  Fri May 18 11:20:26 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 18 May 2012 11:20:26 +0100
Subject: [rabbitmq-discuss] Read-only access to STOMP topic
In-Reply-To: <00DA04FD-B32C-4EE3-9CC0-95BA755EBED9@rabbitmq.com>
References: <0fa11742-8cbb-4125-94ee-a92c485c6734@d33g2000yqa.googlegroups.com>
	<4FB4D235.7000502@rabbitmq.com>
	<CA+_KaB0=XUniHX1=PaoAEAV4cOS19r5Yk8gv89UXVk+RgRk_cA@mail.gmail.com>
	<00DA04FD-B32C-4EE3-9CC0-95BA755EBED9@rabbitmq.com>
Message-ID: <CC2550D7-115F-4700-BEB3-D208BF0308A6@rabbitmq.com>

Clay,

Please can you tell us what version of RabbitMQ+ STOMP you are using?

My colleague (Matthias) pointed out that a receipt on an explicit
DISCONNECT in the publishers would be as effective, and rather cleaner
code. Please let us know if this helps.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 18 May 2012, at 10:53, Steve Powell wrote:

> Clay,
> 
> This looks like a bug (two people appear to have spotted this!), but
> while we investigate, you could try making the publishers ask for a
> receipt for the SEND. It is possible that terminating abruptly may
> interfere with the propagation of the last message.
> 
> Steve Powell
> steve at rabbitmq.com
> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
> 
> On 17 May 2012, at 16:28, Clay McClure wrote:
> 
>> Thanks Simon, that did the trick.
>> 
>> Now I'm trying to sort out why I'm seeing intermittent message loss. My subscribers are long-running processes that CONNECT and SUBSCRIBE once at start-up, so I don't think it's the same problem I've seen on the mailing list re: receipt headers. My publishers, however, are short-lived, ephemeral processes that CONNECT, SEND, and terminate. About 10% of the time these messages aren't making it to the subscribers. Does this sound like a known issue?
>> 
>> Thanks,
>> 
>> Clay
>> 
>> 
>> On Thu, May 17, 2012 at 6:25 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
>> On 16/05/12 22:50, Clay McClure wrote:
>> Howdy,
>> 
>> Hi!
>> 
>> I would like to grant a user read-only access to a STOMP topic, while
>> granting another user read-write access to that same topic. In this
>> way, I can be assured that topic subscribers cannot also post messages
>> to the topic. I've tried using the following permissions:
>> 
>>    rabbitmqctl set_permissions read-only-user '.*' '^$' '.*'
>>    rabbitmqctl set_permissions read-write-user '.*' '.*' '.*'
>> 
>> which would, in my view, prevent the read-only-user from writing to
>> any topic.
>> 
>> Yes. But it also prevents them from writing to any *queue*. Try:
>> 
>> rabbitmqctl set_permissions read-only-user '.*' '^amq.gen.*$' '.*'
>> 
>> to allow them to write to (i.e. bind) the queue they created.
>> 
>> or
>> 
>> rabbitmqctl set_permissions read-only-user '^amq.gen.*$' '^amq.gen.*$' '.*'
>> 
>> to restrict what they can create, as well.
>> 
>> However, it seems that write permission is required to bind
>> to an exchange (http://www.rabbitmq.com/access-control.html),
>> 
>> Write permission is required to bind to an exchange as a *destination*, when using exchange-to-exchange bindings. The idea is that read permission means "bind so that I can read messages from" and write means "bind so that I can write messages to".
>> 
>> Cheers, Simon
>> 
>> 
>> so when
>> the read-only-user tries to SUBSCRIBE to the topic, we get:
>> 
>>    ACCESS_REFUSED - access to queue 'amq.gen-JUCwAsef2r336/
>> uzsYwAmA==' in vhost '/' refused for user 'read-only-user'
>> 
>> How can I grant read-only access to the topic?
>> 
>> Thanks,
>> 
>> Clay
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> -- 
>> Simon MacMullen
>> RabbitMQ, VMware
>> 
>> 
>> 
>> -- 
>> Clay McClure
>> Management & Booking
>> Effective Entertainment LLC
>> 404-314-1351
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Fri May 18 11:20:58 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 18 May 2012 11:20:58 +0100
Subject: [rabbitmq-discuss] Read-only access to STOMP topic
In-Reply-To: <00DA04FD-B32C-4EE3-9CC0-95BA755EBED9@rabbitmq.com>
References: <0fa11742-8cbb-4125-94ee-a92c485c6734@d33g2000yqa.googlegroups.com>	<4FB4D235.7000502@rabbitmq.com>	<CA+_KaB0=XUniHX1=PaoAEAV4cOS19r5Yk8gv89UXVk+RgRk_cA@mail.gmail.com>
	<00DA04FD-B32C-4EE3-9CC0-95BA755EBED9@rabbitmq.com>
Message-ID: <4FB6228A.3050605@rabbitmq.com>

Clay,

On 18/05/12 10:53, Steve Powell wrote:
> This looks like a bug (two people appear to have spotted this!), but
> while we investigate, you could try making the publishers ask for a
> receipt for the SEND. It is possible that terminating abruptly may
> interfere with the propagation of the last message.

I would have thought that just ensuring that the client has flushed its 
various buffers before terminating is sufficient.

Clay, what version of rabbit are you running? Some bugs in this area 
were fixed in recent releases.

Regards,

Matthias.

From steve at rabbitmq.com  Fri May 18 11:28:38 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 18 May 2012 11:28:38 +0100
Subject: [rabbitmq-discuss] Fwd: STOMP adapter lose the last message of a
	burst
References: <D2958F5F-B942-471A-A890-B43A0255D1B3@rabbitmq.com>
Message-ID: <8FDFF1DF-442E-4E58-86F3-22849632433A@rabbitmq.com>

Sent to google-groups by mistake.
Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

Begin forwarded message:

> From: Steve Powell <steve at rabbitmq.com>
> Date: 18 May 2012 11:22:37 GMT+01:00
> To: Jos? Mic? <jose.mico at gmail.com>
> Cc: rabbitmq-discuss at googlegroups.com
> Subject: Re: [rabbitmq-discuss] STOMP adapter lose the last message of a burst
> 
> Hi Jos?,
> 
> This may very well be a bug, but could also be something about flushing
> in the Perl script you are using.
> 
> Please can you tell us which version of RabbitMQ and STOMP you are
> using?
> 
> Steve Powell
> steve at rabbitmq.com
> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
> 
> On 18 May 2012, at 06:18, Jos? Mic? wrote:
> 
>> I think I've found a somewhat serious bug in the STOMP adapter: after a burst of incoming messages, the last one remains buffered somewhere indefinitely and is not added to the queue until another message is received from the same connection (same with topics). This cause and excessive delay to deliver the message to consumers, if it is ever delivered. Besides that, that last message is lost if the connection is not properly closed.
>> 
>> I've attached a simple script which replicates the bug. It sends burst of 100 small messages to a queue every 10 seconds. Using the management console, we can inspect the count of Ready messages. The expected progression is 100 ... 200 ... 300 ... 400 ... 500, but very frequently (not always) we get 99 ... 199 ... 299 ... 399 ... 499, as the last message is not queued.
>> 
>> Could be that the STOMP parser gets confused after an incomplete frame was read from tcp buffer? Any ideas?
>> 
>> Regards,
>> Jos?
>> <stomp_bug.pl>_______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120518/10f0ce43/attachment.htm>

From emile at rabbitmq.com  Fri May 18 11:31:00 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 18 May 2012 11:31:00 +0100
Subject: [rabbitmq-discuss] What happens to messages delivered just
 before canceling consume?
In-Reply-To: <4FB619FC.8020304@rabbitmq.com>
References: <CAO-4Wf5QjFYf0VXqMiOJSXWMPRy=RUOrhLs-vyn27C_9+i9+ew@mail.gmail.com>
	<4FB619E0.2020700@rabbitmq.com> <4FB619FC.8020304@rabbitmq.com>
Message-ID: <4FB624E4.9000606@rabbitmq.com>

Hi,

>> Another option is to turn off prefetching (prefetch = 0).
> 
> Um, doesn't that just mean you get a deluge of messages instead?

Apologies, yes please ignore my incorrect advice. Using prefetch = 0
will turn of prefetch limiting and not help at all. The simplest
solution here is to use prefetch = 1 and cancel the subscription before
acknowledging the final message.

-Emile



From matthew at rabbitmq.com  Fri May 18 11:41:25 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 18 May 2012 11:41:25 +0100
Subject: [rabbitmq-discuss] What happens to messages delivered just
 before canceling consume?
In-Reply-To: <4FB624E4.9000606@rabbitmq.com>
References: <CAO-4Wf5QjFYf0VXqMiOJSXWMPRy=RUOrhLs-vyn27C_9+i9+ew@mail.gmail.com>
	<4FB619E0.2020700@rabbitmq.com> <4FB619FC.8020304@rabbitmq.com>
	<4FB624E4.9000606@rabbitmq.com>
Message-ID: <20120518104125.GB24978@wellquite.org>

On Fri, May 18, 2012 at 11:31:00AM +0100, Emile Joubert wrote:
> >> Another option is to turn off prefetching (prefetch = 0).
> > 
> > Um, doesn't that just mean you get a deluge of messages instead?
> 
> Apologies, yes please ignore my incorrect advice. Using prefetch = 0
> will turn of prefetch limiting and not help at all. The simplest
> solution here is to use prefetch = 1 and cancel the subscription before
> acknowledging the final message.

However, unless you are on a network with 0 latency, a prefetch of 1
will guarantee your client sits around idle for at least some of the
time. If you follow the maths through on my recent blog post,
http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/
then you should be able to calculate a sensible prefetch figure (without
resorting to more exotic solutions like CoDel).

Then, after cancelling the consumer, keep hold of the cancelled consumer
tag (ctag) and if you see any deliveries appearing with that ctag, just
nack+requeue them immediately. There should not be more of them than
your prefetch setting.

Matthew

From brendan at soundcloud.com  Fri May 18 13:00:55 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Fri, 18 May 2012 14:00:55 +0200
Subject: [rabbitmq-discuss] question,
 Shovel : different queue name between source and destination
In-Reply-To: <4FB61EE3.80702@indoakses-online.com>
References: <4FB604B0.8090300@indoakses-online.com>
	<CAHZsVQbpkZB_dF+qoaHWmK77Q7MZ0WF4V06rQyBj=wh1VOTFCQ@mail.gmail.com>
	<4FB61EE3.80702@indoakses-online.com>
Message-ID: <CAHZsVQab+RVJ0Jt_62AckwE0f0Q=VLA-g=8yeW7EmMkKu3QfiQ@mail.gmail.com>

In fairness, I probably over complicated things by trying to be as explicit
as possible with the config.
But here is my updated gist containing a 'publish_fields' addition to
ensure the messages go to the destination exchange:
https://gist.github.com/2723964

With that adjustment, you should be able to publish a message to
'source_exchange' without a routing key, and have it turn up in
'destination_queue'.

Here are also a couple of things you can do to assist in debugging shovel
problems:

Firstly tailing the logs under /var/log/rabbitmq will show any specific
authentication/vhost errors the shovel has while starting up.

The shovel management plugin can be enabled via: rabbitmq-plugins enable
rabbitmq_shovel_management
This will let you see the status of the shovel via a tab in the management
ui.

PS. If you are running the shovel plugin as either the source or
destination for the configuration then you can specify the amqp uri as just
"amqp://".
The shovel plugin will then use guest on vhost '/' via the amqp direct
connection - this is a good. You can read more about the direct connection
here: http://www.rabbitmq.com/erlang-client-user-guide.html#model


On Fri, May 18, 2012 at 12:05 PM, bino oetomo <bino at indoakses-online.com>wrote:

> Dear Brendan
> I really appreciate your help
> On 05/18/2012 03:37 PM, Brendan Hay wrote:
>
>> Bino,
>> ...
>>
>> I've tried to outline the above in a (untested) configuration snippet
>> here:
>> https://gist.github.com/**2723964 <https://gist.github.com/2723964>
>>
>>
> I try to adopt your configuration.
> Here is my config file at http://pastebin.com/b6Z2UNqJ
>
> When I try to post msg to source broker .. got no error
> But ... some how the msg is looks like going no where
>
> I check the management GUI :
> 1. Source broker .... no ready msg in all queue
> 2. Destination broker .... no ready msg in all queue in all vhost
>
>
> Sincerely
> -bino-
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120518/ced0e528/attachment.htm>

From sameek at arosys.com  Fri May 18 13:30:18 2012
From: sameek at arosys.com (sameekmishra)
Date: Fri, 18 May 2012 05:30:18 -0700 (PDT)
Subject: [rabbitmq-discuss]  HAProxy does not work with Rabbitmq?
Message-ID: <33869976.post@talk.nabble.com>


Hi 

I have configured HA proxy and keepalived for rabbbitmq server.
i have install  Debian squeeze 6.04 operating system with rabbbitmq 2.5.0
and enlarge 14.b.2.1,with cluster and mirror queue.
i have check cluster status both end it got:

rabbitmqctl cluster_status
Cluster status of node rabbit at server03 ...
[{nodes,[{disc,[rabbit at server03,rabbit at server05]}]},
 {running_nodes,[rabbit at server05,rabbit at server03]}]
...done.

which means that cluster are correctly configured,also i have checked the
mirror with publish a message on other node and got from other node means
it's worked.i have read the following document for Setting Up A HAProxy
Failover
Cluster<http://www.zimbio.com/Linux/articles/YgBDA7b_kmR/Setting+Up+HAProxy+Failover+Cluster>
and also got haproxy configuration from this post
<http://www.joshdevins.net/2010/04/16/rabbitmq-ha-testing-with-haproxy/>.

including both document i have tried the failover with following
configuration:

node-1 server03 rabbit at server03  192.168.1.153
node-2 server05 rabbit at server05  192.168.1.155

assume virtul Ip: 192.168.1.199

/etc/haproxy/haproxy.conf
-------------------------
global
 log     127.0.0.1 alert
 log     127.0.0.1 alert debug

defaults
 log        global
 mode       http
 option     dontlognull
 option     redispatch
 retries    3
 contimeout 5000
 clitimeout 50000
 srvtimeout 50000

listen rabbitmq *:5672
 mode    tcp
 stats   enable
 balance roundrobin
 option  forwardfor
 option  tcpka
 server  server03 192.168.1.153:5672 check inter 5000 downinter 500    
 server  server05 192.168.1.155:5672 check inter 5000 backup

listen webfarm 192.168.1.199:80
       mode http
       stats enable
       stats auth someuser:sam
       balance roundrobin
       cookie JSESSIONID prefix
       option httpclose
       option forwardfor
       option httpchk HEAD /check.txt HTTP/1.0
       server server03 192.168.1.153:5672 cookie A check
       server server05 192.168.1.155:5672 cookie B check


	option	httpclose		# disable keep-alive
	option  checkcache		# block response if set-cookie & cacheable

	rspidel ^Set-cookie:\ IP=	# do not let this cookie tell our internal IP
address
	
	#errorloc	502	http://192.168.114.58/error502.html
	#errorfile	503	/etc/haproxy/errors/503.http
	errorfile	400	/etc/haproxy/errors/400.http
	errorfile	403	/etc/haproxy/errors/403.http
	errorfile	408	/etc/haproxy/errors/408.http
	errorfile	500	/etc/haproxy/errors/500.http
	errorfile	502	/etc/haproxy/errors/502.http
	errorfile	503	/etc/haproxy/errors/503.http
	errorfile	504	/etc/haproxy/errors/504.http

same haproxy configuration on node2 as well.

 /etc/keepalived/keepalived.conf
---------------------------------
vrrp_script chk_haproxy {           # Requires keepalived-1.1.13
        script "killall -0 haproxy"     # cheaper than pidof
        interval 2                      # check every 2 seconds
        weight 2                        # add 2 points of prio if OK
}

vrrp_instance VI_1 {
        interface eth0
        state MASTER
        virtual_router_id 51
        priority 101                    # 101 on master, 100 on backup
        virtual_ipaddress {
            192.168.1.199
        }
        track_script {
            chk_haproxy
        }
}

only on difference with node2 is priority 100 .after configuation i have
start haproxy and keepalived,start without any error.i have try to ping
virtual ip with other node it got successful result,also i have publish
message using 192.168.1.199 ,it publish and i consume message from other
node,but when i try to rabbitmqctl stop_app of node1(stop rabbitmq server
which is running on node1) then i try to publish with virtual IP i got
connetion refuesed exception,
means when failover not work for me it does not switch to other node2.
please help me,i can't trace the problem.

Thanks

  
-- 
View this message in context: http://old.nabble.com/HAProxy-does-not-work-with-Rabbitmq--tp33869976p33869976.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sameek at arosys.com  Fri May 18 13:42:28 2012
From: sameek at arosys.com (sameekmishra)
Date: Fri, 18 May 2012 05:42:28 -0700 (PDT)
Subject: [rabbitmq-discuss]  HAProxy does not work with Rabbitmq?
Message-ID: <33870045.post@talk.nabble.com>


Hi 

I have configured HA proxy and keepalived for rabbbitmq server.
i have install  Debian squeeze 6.04 operating system with rabbbitmq 2.5.0
and enlarge 14.b.2.1,with cluster and mirror queue.
i have check cluster status both end it got:

rabbitmqctl cluster_status
Cluster status of node rabbit at server03 ...
[{nodes,[{disc,[rabbit at server03,rabbit at server05]}]},
 {running_nodes,[rabbit at server05,rabbit at server03]}]
...done.

which means that cluster are correctly configured,also i have checked the
mirror with publish a message on other node and got from other node means
it's worked.i have read the following document for Setting Up A HAProxy
Failover
Cluster<http://www.zimbio.com/Linux/articles/YgBDA7b_kmR/Setting+Up+HAProxy+Failover+Cluster>
and also got haproxy configuration from this post
<http://www.joshdevins.net/2010/04/16/rabbitmq-ha-testing-with-haproxy/>.

including both document i have tried the failover with following
configuration:

node-1 server03 rabbit at server03  192.168.1.153
node-2 server05 rabbit at server05  192.168.1.155

assume virtul Ip: 192.168.1.199

/etc/haproxy/haproxy.conf
-------------------------
global
 log     127.0.0.1 alert
 log     127.0.0.1 alert debug

defaults
 log        global
 mode       http
 option     dontlognull
 option     redispatch
 retries    3
 contimeout 5000
 clitimeout 50000
 srvtimeout 50000

listen rabbitmq *:5672
 mode    tcp
 stats   enable
 balance roundrobin
 option  forwardfor
 option  tcpka
 server  server03 192.168.1.153:5672 check inter 5000 downinter 500    
 server  server05 192.168.1.155:5672 check inter 5000 backup

listen webfarm 192.168.1.199:80
       mode http
       stats enable
       stats auth someuser:sam
       balance roundrobin
       cookie JSESSIONID prefix
       option httpclose
       option forwardfor
       option httpchk HEAD /check.txt HTTP/1.0
       server server03 192.168.1.153:5672 cookie A check
       server server05 192.168.1.155:5672 cookie B check


	option	httpclose		# disable keep-alive
	option  checkcache		# block response if set-cookie & cacheable

	rspidel ^Set-cookie:\ IP=	# do not let this cookie tell our internal IP
address
	
	#errorloc	502	http://192.168.114.58/error502.html
	#errorfile	503	/etc/haproxy/errors/503.http
	errorfile	400	/etc/haproxy/errors/400.http
	errorfile	403	/etc/haproxy/errors/403.http
	errorfile	408	/etc/haproxy/errors/408.http
	errorfile	500	/etc/haproxy/errors/500.http
	errorfile	502	/etc/haproxy/errors/502.http
	errorfile	503	/etc/haproxy/errors/503.http
	errorfile	504	/etc/haproxy/errors/504.http

same haproxy configuration on node2 as well.

 /etc/keepalived/keepalived.conf
---------------------------------
vrrp_script chk_haproxy {           # Requires keepalived-1.1.13
        script "killall -0 haproxy"     # cheaper than pidof
        interval 2                      # check every 2 seconds
        weight 2                        # add 2 points of prio if OK
}

vrrp_instance VI_1 {
        interface eth0
        state MASTER
        virtual_router_id 51
        priority 101                    # 101 on master, 100 on backup
        virtual_ipaddress {
            192.168.1.199
        }
        track_script {
            chk_haproxy
        }
}

only on difference with node2 is priority 100 .after configuation i have
start haproxy and keepalived,start without any error.i have try to ping
virtual ip with other node it got successful result,also i have publish
message using 192.168.1.199 ,it publish and i consume message from other
node,but when i try to rabbitmqctl stop_app of node1(stop rabbitmq server
which is running on node1) then i try to publish with virtual IP i got
connetion refuesed exception,
means when failover not work for me it does not switch to other node2.
please help me,i can't trace the problem.

Thanks

  
-- 
View this message in context: http://old.nabble.com/HAProxy-does-not-work-with-Rabbitmq--tp33870045p33870045.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sameek at arosys.com  Fri May 18 13:42:33 2012
From: sameek at arosys.com (sameekmishra)
Date: Fri, 18 May 2012 05:42:33 -0700 (PDT)
Subject: [rabbitmq-discuss]  HAProxy does not work with Rabbitmq?
Message-ID: <33870046.post@talk.nabble.com>


Hi 

I have configured HA proxy and keepalived for rabbbitmq server.
i have install  Debian squeeze 6.04 operating system with rabbbitmq 2.5.0
and enlarge 14.b.2.1,with cluster and mirror queue.
i have check cluster status both end it got:

rabbitmqctl cluster_status
Cluster status of node rabbit at server03 ...
[{nodes,[{disc,[rabbit at server03,rabbit at server05]}]},
 {running_nodes,[rabbit at server05,rabbit at server03]}]
...done.

which means that cluster are correctly configured,also i have checked the
mirror with publish a message on other node and got from other node means
it's worked.i have read the following document for Setting Up A HAProxy
Failover
Cluster<http://www.zimbio.com/Linux/articles/YgBDA7b_kmR/Setting+Up+HAProxy+Failover+Cluster>
and also got haproxy configuration from this post
<http://www.joshdevins.net/2010/04/16/rabbitmq-ha-testing-with-haproxy/>.

including both document i have tried the failover with following
configuration:

node-1 server03 rabbit at server03  192.168.1.153
node-2 server05 rabbit at server05  192.168.1.155

assume virtul Ip: 192.168.1.199

/etc/haproxy/haproxy.conf
-------------------------
global
 log     127.0.0.1 alert
 log     127.0.0.1 alert debug

defaults
 log        global
 mode       http
 option     dontlognull
 option     redispatch
 retries    3
 contimeout 5000
 clitimeout 50000
 srvtimeout 50000

listen rabbitmq *:5672
 mode    tcp
 stats   enable
 balance roundrobin
 option  forwardfor
 option  tcpka
 server  server03 192.168.1.153:5672 check inter 5000 downinter 500    
 server  server05 192.168.1.155:5672 check inter 5000 backup

listen webfarm 192.168.1.199:80
       mode http
       stats enable
       stats auth someuser:sam
       balance roundrobin
       cookie JSESSIONID prefix
       option httpclose
       option forwardfor
       option httpchk HEAD /check.txt HTTP/1.0
       server server03 192.168.1.153:5672 cookie A check
       server server05 192.168.1.155:5672 cookie B check


	option	httpclose		# disable keep-alive
	option  checkcache		# block response if set-cookie & cacheable

	rspidel ^Set-cookie:\ IP=	# do not let this cookie tell our internal IP
address
	
	#errorloc	502	http://192.168.114.58/error502.html
	#errorfile	503	/etc/haproxy/errors/503.http
	errorfile	400	/etc/haproxy/errors/400.http
	errorfile	403	/etc/haproxy/errors/403.http
	errorfile	408	/etc/haproxy/errors/408.http
	errorfile	500	/etc/haproxy/errors/500.http
	errorfile	502	/etc/haproxy/errors/502.http
	errorfile	503	/etc/haproxy/errors/503.http
	errorfile	504	/etc/haproxy/errors/504.http

same haproxy configuration on node2 as well.

 /etc/keepalived/keepalived.conf
---------------------------------
vrrp_script chk_haproxy {           # Requires keepalived-1.1.13
        script "killall -0 haproxy"     # cheaper than pidof
        interval 2                      # check every 2 seconds
        weight 2                        # add 2 points of prio if OK
}

vrrp_instance VI_1 {
        interface eth0
        state MASTER
        virtual_router_id 51
        priority 101                    # 101 on master, 100 on backup
        virtual_ipaddress {
            192.168.1.199
        }
        track_script {
            chk_haproxy
        }
}

only on difference with node2 is priority 100 .after configuation i have
start haproxy and keepalived,start without any error.i have try to ping
virtual ip with other node it got successful result,also i have publish
message using 192.168.1.199 ,it publish and i consume message from other
node,but when i try to rabbitmqctl stop_app of node1(stop rabbitmq server
which is running on node1) then i try to publish with virtual IP i got
connetion refuesed exception,
means when failover not work for me it does not switch to other node2.
please help me,i can't trace the problem.

Thanks

  
-- 
View this message in context: http://old.nabble.com/HAProxy-does-not-work-with-Rabbitmq--tp33870046p33870046.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sameek at arosys.com  Fri May 18 13:53:02 2012
From: sameek at arosys.com (sameekmishra)
Date: Fri, 18 May 2012 05:53:02 -0700 (PDT)
Subject: [rabbitmq-discuss] HAProxy does not work with Rabbitmq?
In-Reply-To: <33869976.post@talk.nabble.com>
References: <33869976.post@talk.nabble.com>
Message-ID: <33870103.post@talk.nabble.com>



 also i got following error: Reloading haproxy: haproxycat:
/var/run/haproxy.pid: No such file or directory [WARNING] 138/181843 (14448)
: config : 'stats' statement ignored for proxy 'rabbitmq' as it requires
HTTP mode. [WARNING] 138/181843 (14448) : config : 'option forwardfor'
ignored for proxy 'rabbitmq' as it requires HTTP mode. [ALERT] 138/181843
(14448) : Starting proxy rabbitmq: cannot bind socket [ALERT] 138/181843
(14448) : Starting proxy webfarm: cannot bind socket failed!


sameekmishra wrote:
> 
> Hi 
> 
> I have configured HA proxy and keepalived for rabbbitmq server.
> i have install  Debian squeeze 6.04 operating system with rabbbitmq 2.5.0
> and enlarge 14.b.2.1,with cluster and mirror queue.
> i have check cluster status both end it got:
> 
> rabbitmqctl cluster_status
> Cluster status of node rabbit at server03 ...
> [{nodes,[{disc,[rabbit at server03,rabbit at server05]}]},
>  {running_nodes,[rabbit at server05,rabbit at server03]}]
> ...done.
> 
> which means that cluster are correctly configured,also i have checked the
> mirror with publish a message on other node and got from other node means
> it's worked.i have read the following document for Setting Up A HAProxy
> Failover
> Cluster<http://www.zimbio.com/Linux/articles/YgBDA7b_kmR/Setting+Up+HAProxy+Failover+Cluster>
> and also got haproxy configuration from this post
> <http://www.joshdevins.net/2010/04/16/rabbitmq-ha-testing-with-haproxy/>.
> 
> including both document i have tried the failover with following
> configuration:
> 
> node-1 server03 rabbit at server03  192.168.1.153
> node-2 server05 rabbit at server05  192.168.1.155
> 
> assume virtul Ip: 192.168.1.199
> 
> /etc/haproxy/haproxy.conf
> -------------------------
> global
>  log     127.0.0.1 alert
>  log     127.0.0.1 alert debug
> 
> defaults
>  log        global
>  mode       http
>  option     dontlognull
>  option     redispatch
>  retries    3
>  contimeout 5000
>  clitimeout 50000
>  srvtimeout 50000
> 
> listen rabbitmq *:5672
>  mode    tcp
>  stats   enable
>  balance roundrobin
>  option  forwardfor
>  option  tcpka
>  server  server03 192.168.1.153:5672 check inter 5000 downinter 500    
>  server  server05 192.168.1.155:5672 check inter 5000 backup
> 
> listen webfarm 192.168.1.199:80
>        mode http
>        stats enable
>        stats auth someuser:sam
>        balance roundrobin
>        cookie JSESSIONID prefix
>        option httpclose
>        option forwardfor
>        option httpchk HEAD /check.txt HTTP/1.0
>        server server03 192.168.1.153:5672 cookie A check
>        server server05 192.168.1.155:5672 cookie B check
> 
> 
> 	option	httpclose		# disable keep-alive
> 	option  checkcache		# block response if set-cookie & cacheable
> 
> 	rspidel ^Set-cookie:\ IP=	# do not let this cookie tell our internal IP
> address
> 	
> 	#errorloc	502	http://192.168.114.58/error502.html
> 	#errorfile	503	/etc/haproxy/errors/503.http
> 	errorfile	400	/etc/haproxy/errors/400.http
> 	errorfile	403	/etc/haproxy/errors/403.http
> 	errorfile	408	/etc/haproxy/errors/408.http
> 	errorfile	500	/etc/haproxy/errors/500.http
> 	errorfile	502	/etc/haproxy/errors/502.http
> 	errorfile	503	/etc/haproxy/errors/503.http
> 	errorfile	504	/etc/haproxy/errors/504.http
> 
> same haproxy configuration on node2 as well.
> 
>  /etc/keepalived/keepalived.conf
> ---------------------------------
> vrrp_script chk_haproxy {           # Requires keepalived-1.1.13
>         script "killall -0 haproxy"     # cheaper than pidof
>         interval 2                      # check every 2 seconds
>         weight 2                        # add 2 points of prio if OK
> }
> 
> vrrp_instance VI_1 {
>         interface eth0
>         state MASTER
>         virtual_router_id 51
>         priority 101                    # 101 on master, 100 on backup
>         virtual_ipaddress {
>             192.168.1.199
>         }
>         track_script {
>             chk_haproxy
>         }
> }
> 
> only on difference with node2 is priority 100 .after configuation i have
> start haproxy and keepalived,start without any error.i have try to ping
> virtual ip with other node it got successful result,also i have publish
> message using 192.168.1.199 ,it publish and i consume message from other
> node,but when i try to rabbitmqctl stop_app of node1(stop rabbitmq server
> which is running on node1) then i try to publish with virtual IP i got
> connetion refuesed exception,
> means when failover not work for me it does not switch to other node2.
> please help me,i can't trace the problem.
> 
> Thanks
> 
>   
> 

-- 
View this message in context: http://old.nabble.com/HAProxy-does-not-work-with-Rabbitmq--tp33869976p33870103.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From jose.mico at gmail.com  Fri May 18 15:56:36 2012
From: jose.mico at gmail.com (=?ISO-8859-1?Q?Jos=E9_Mic=F3?=)
Date: Fri, 18 May 2012 11:56:36 -0300
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of a
	burst
In-Reply-To: <D2958F5F-B942-471A-A890-B43A0255D1B3@rabbitmq.com>
References: <226517f0-2ad1-4583-8a63-4c65b4bb247d@googlegroups.com>
	<D2958F5F-B942-471A-A890-B43A0255D1B3@rabbitmq.com>
Message-ID: <4FB66324.7030400@gmail.com>

On 05/18/2012 07:22 AM, Steve Powell wrote:
> This may very well be a bug, but could also be something about flushing
> in the Perl script you are using.
That was my first thought also (a client side buffering issue). I'm 
implementing a messaging framework, and while stress testing it I found 
that it fails consistently to deliver timely the last message sent to a 
topic or queue. Some of my tests fails frequently when the number of 
messages sent doesn't match the number of messages received, or when RPC 
style calls timeout due to the call istself not being sent timely.

Finally I could trace the bug down to RabbitMQ, and to be sure I wrote 
the simplest possible script that replicates the problem. I've attached 
an updated version of it which uses syswrite() calls in order to bypass 
any IO buffering.

I want to clarify that the last message is not actually lost: it remains 
buffered by the adapter, but is not processed until new data arrives 
from the same client.
If I send 100 messages, the queue will get messages #1..#99 (the last 
one being buffered somewhere). Then send another 100 messages, and queue 
will get the message #100, followed by #101..#199. Again, message #200 
remains buffered. And so on.

>
> Please can you tell us which version of RabbitMQ and STOMP you are
> using?
I'm using RabbitMQ 2.8.2 on Erlang R15B with the bundled STOMP adapter.

> Steve Powell
> steve at rabbitmq.com
> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
>
> On 18 May 2012, at 06:18, Jos? Mic? wrote:
>
>> I think I've found a somewhat serious bug in the STOMP adapter: after a burst of incoming messages, the last one remains buffered somewhere indefinitely and is not added to the queue until another message is received from the same connection (same with topics). This cause and excessive delay to deliver the message to consumers, if it is ever delivered. Besides that, that last message is lost if the connection is not properly closed.
>>
>> I've attached a simple script which replicates the bug. It sends burst of 100 small messages to a queue every 10 seconds. Using the management console, we can inspect the count of Ready messages. The expected progression is 100 ... 200 ... 300 ... 400 ... 500, but very frequently (not always) we get 99 ... 199 ... 299 ... 399 ... 499, as the last message is not queued.
>>
>> Could be that the STOMP parser gets confused after an incomplete frame was read from tcp buffer? Any ideas?
>>
>> Regards,
>> Jos?
>> <stomp_bug.pl>_______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: stomp_bug_2.pl
Type: application/x-perl
Size: 1472 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120518/40e977b9/attachment.bin>

From clay at sseband.com  Fri May 18 15:43:32 2012
From: clay at sseband.com (Clay McClure)
Date: Fri, 18 May 2012 10:43:32 -0400
Subject: [rabbitmq-discuss] Read-only access to STOMP topic
In-Reply-To: <CC2550D7-115F-4700-BEB3-D208BF0308A6@rabbitmq.com>
References: <0fa11742-8cbb-4125-94ee-a92c485c6734@d33g2000yqa.googlegroups.com>
	<4FB4D235.7000502@rabbitmq.com>
	<CA+_KaB0=XUniHX1=PaoAEAV4cOS19r5Yk8gv89UXVk+RgRk_cA@mail.gmail.com>
	<00DA04FD-B32C-4EE3-9CC0-95BA755EBED9@rabbitmq.com>
	<CC2550D7-115F-4700-BEB3-D208BF0308A6@rabbitmq.com>
Message-ID: <CA+_KaB3J4W1n7Vp32vEa9GQ6h2T_R=BcCBr7g9WEK4DBP16FNg@mail.gmail.com>

On Fri, May 18, 2012 at 6:20 AM, Steve Powell <steve at rabbitmq.com> wrote:

Thanks for your reply, Steve.

Please can you tell us what version of RabbitMQ+ STOMP you are using?
>

On Ubuntu 11.10:

ii  rabbitmq-erlang-client           2.5.0+hg20110623-0ubuntu1
  Erlang client for RabbitMQ
ii  rabbitmq-plugins-common          0.0.1-0ubuntu4
 configuration file for rabbitmq-server
ii  rabbitmq-server                  2.5.0-1ubuntu2
 An AMQP server written in Erlang
ii  rabbitmq-stomp                   2.5.0+hg20110623-0ubuntu1
  A STOMP gateway for RabbitMQ

This appears to be quite old, but it has the benefit of starting correctly,
whereas I couldn't get 2.8.2 to start once the stomp plugin had been
activated, and googling for a solution proved fruitless. I may attempt that
again, though, in light of the message loss bug.

My colleague (Matthias) pointed out that a receipt on an explicit
> DISCONNECT in the publishers would be as effective, and rather cleaner
> code. Please let us know if this helps.


I'll give that a shot, too. I'm not sure my client library supports
receipts, but at the least I can issue a DISCONNECT in the publishers.

Cheers,

Clay
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120518/bea5034c/attachment.htm>

From prokop.bart at gmail.com  Fri May 18 15:47:25 2012
From: prokop.bart at gmail.com (=?UTF-8?Q?Bart=C5=82omiej_Prokop?=)
Date: Fri, 18 May 2012 07:47:25 -0700 (PDT)
Subject: [rabbitmq-discuss] JAVA client / non daemon threads / shutdown hook
Message-ID: <a0e1e01d-6e6a-4508-bcf1-933e2b03fabc@googlegroups.com>

Hi,

I'm using JAVA client for RabbitMQ (com.rabbitmq:amqp-client:2.8.1) to 
write a "jar component" capable of sending messages for some legacy system. 
The idea is to wrap all code that maintain the connection inside my 
component. This way, the client software deals only with very simple 
methods like "post" and is not aware of any connection handling. The 
connect/reconnect code is written and hidden from the legacy system.

The problem I have faced is that Java client creates "behind the scene" 
some threads to manage connection - like:
         lines 299-301 of AMQConnection class.
        // start the main loop going
        new MainLoop("AMQP Connection " + getHostAddress() + ":" + 
getPort()).start();
        // after this point clear-up of MainLoop is triggered by closing 
the frameHandler.

Unfortunatelly, those threads aren't "daemon" threads. So, when main 
application ends and appropriate connection closing not occurs, the VM 
won't terminate. My approach was to add some shutdown hook to close 
RabbitMQ connections if it is live inside my "jar component". But, due to 
those non-daemon threads, VM is not going ever to be terminated and 
shutdown hooks fired.

It is a question to RabbitMQ driver developers, if the internal threads 
could be fired as daemon threads, could it be done in future releases?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120518/7d82c019/attachment.htm>

From prokop.bart at gmail.com  Fri May 18 16:27:24 2012
From: prokop.bart at gmail.com (=?UTF-8?Q?Bart=C5=82omiej_Prokop?=)
Date: Fri, 18 May 2012 17:27:24 +0200
Subject: [rabbitmq-discuss] JAVA client / non daemon threads / shutdown hook
Message-ID: <CAOYfuETqOPXRtf_AT4rHHv4GyB_k7Wb7Hy44WjNv4fEGyNYEuA@mail.gmail.com>

Hi,

I'm using JAVA client for RabbitMQ (com.rabbitmq:amqp-client:2.8.1) to
write a "jar component" capable of sending messages for some legacy system.
The idea is to wrap all code that maintain the connection inside my
component. This way, the client software deals only with very simple
methods like "post" and is not aware of any connection handling. The
connect/reconnect code is written and hidden from the legacy system.

The problem I have faced is that Java client creates "behind the scene"
some threads to manage connection - like:
         lines 299-301 of AMQConnection class.
        // start the main loop going
        new MainLoop("AMQP Connection " + getHostAddress() + ":" +
getPort()).start();
        // after this point clear-up of MainLoop is triggered by closing
the frameHandler.

Unfortunatelly, those threads aren't "daemon" threads. So, when main
application ends and appropriate connection closing not occurs, the VM
won't terminate. My approach was to add some shutdown hook to close
RabbitMQ connections if it is live inside my "jar component". But, due to
those non-daemon threads, VM is not going ever to be terminated and
shutdown hooks fired.

It is a question to RabbitMQ driver developers, if the internal threads
could be fired as daemon threads, could it be done in future releases?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120518/7efce85e/attachment.htm>

From matthias at rabbitmq.com  Fri May 18 17:02:01 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 18 May 2012 17:02:01 +0100
Subject: [rabbitmq-discuss] Read-only access to STOMP topic
In-Reply-To: <CA+_KaB3J4W1n7Vp32vEa9GQ6h2T_R=BcCBr7g9WEK4DBP16FNg@mail.gmail.com>
References: <0fa11742-8cbb-4125-94ee-a92c485c6734@d33g2000yqa.googlegroups.com>
	<4FB4D235.7000502@rabbitmq.com>
	<CA+_KaB0=XUniHX1=PaoAEAV4cOS19r5Yk8gv89UXVk+RgRk_cA@mail.gmail.com>
	<00DA04FD-B32C-4EE3-9CC0-95BA755EBED9@rabbitmq.com>
	<CC2550D7-115F-4700-BEB3-D208BF0308A6@rabbitmq.com>
	<CA+_KaB3J4W1n7Vp32vEa9GQ6h2T_R=BcCBr7g9WEK4DBP16FNg@mail.gmail.com>
Message-ID: <4FB67279.7070607@rabbitmq.com>

Clay,

On 18/05/12 15:43, Clay McClure wrote:
> ii  rabbitmq-server                  2.5.0-1ubuntu2
>
> This appears to be quite old, but it has the benefit of starting
> correctly, whereas I couldn't get 2.8.2 to start once the stomp plugin
> had been activated, and googling for a solution proved fruitless. I may
> attempt that again, though, in light of the message loss bug.

Please do. There were definitely bugs in the stomp plug-in that may be 
relevant here and got fixed in releases after 2.5.0.

Matthias.

From john.doe44210 at gmail.com  Fri May 18 17:01:44 2012
From: john.doe44210 at gmail.com (john doe)
Date: Fri, 18 May 2012 18:01:44 +0200
Subject: [rabbitmq-discuss] amqp-client on java 4?
Message-ID: <CALbPevmMF2cvC-WmLREA3Jfu-RkFhgQ7NNOcS+Bm6cEFO2A28g@mail.gmail.com>

Hello,

My question is pretty straitforward: does the client library run on java 4?
Thanks,

John
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120518/4a0a86de/attachment.htm>

From francesco at rabbitmq.com  Fri May 18 17:14:05 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 18 May 2012 17:14:05 +0100
Subject: [rabbitmq-discuss] amqp-client on java 4?
In-Reply-To: <CALbPevmMF2cvC-WmLREA3Jfu-RkFhgQ7NNOcS+Bm6cEFO2A28g@mail.gmail.com>
References: <CALbPevmMF2cvC-WmLREA3Jfu-RkFhgQ7NNOcS+Bm6cEFO2A28g@mail.gmail.com>
Message-ID: <4FB6754D.4020106@rabbitmq.com>

Hi John,

We supported Java 4 up to version 2.2, you can find the client here: 
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.2.0/ . If 
you're not using RabbitMQ specific features that came after 2.2, you 
should be able to get things working with that.

Francesco.

On 18/05/12 17:01, john doe wrote:
> Hello,
> My question is pretty straitforward: does the client library run on java
> 4? Thanks,
> John
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From michael.justin at gmx.net  Fri May 18 17:27:08 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Fri, 18 May 2012 18:27:08 +0200
Subject: [rabbitmq-discuss] RabbitMQ 2.8.2 crash report
	"unsupported_platform" on Vista
Message-ID: <jp5t8t$emo$1@dough.gmane.org>

Hello,

this report is in the rabbit at server-sasl.log:


=CRASH REPORT==== 18-May-2012::18:17:28 ===
   crasher:
     initial call: rabbit_disk_monitor:init/1
     pid: <0.145.0>
     registered_name: []
     exception exit: unsupported_platform
       in function  gen_server:init_it/6 (gen_server.erl, line 320)
     ancestors: [rabbit_disk_monitor_sup,rabbit_sup,<0.104.0>]
     messages: []
     links: [<0.66.0>,<0.144.0>]
     dictionary: []
     trap_exit: false
     status: running
     heap_size: 4181
     stack_size: 24
     reductions: 4098
   neighbours:

=SUPERVISOR REPORT==== 18-May-2012::18:17:28 ===
      Supervisor: {local,rabbit_disk_monitor_sup}
      Context:    start_error
      Reason:     unsupported_platform
      Offender:   [{pid,undefined},
                   {name,rabbit_disk_monitor},
                   {mfargs,
 
{rabbit_disk_monitor,start_link,[{mem_relative,1.0}]}},
                   {restart_type,transient},
                   {shutdown,4294967295},
                   {child_type,worker}]


Configuration:

[
   {rabbitmq_stomp, [{tcp_listeners, [61613]},
                     {ssl_listeners, [61614]}]},
   {ssl_options, 
[{cacertfile,"C:/Users/mj/AppData/Roaming/RabbitMQ/ssl/testca/cacert.pem"},
 
{certfile,"C:/Users/mj/AppData/Roaming/RabbitMQ/ssl/server/cert.pem"},
 
{keyfile,"C:/Users/mj/AppData/Roaming/RabbitMQ/ssl/server/key.pem"},
                     {verify,verify_peer},
                     {fail_if_no_peer_cert,false}]}					
].


It seems to be caused by the absence of a rabbitmq configuration - if I 
add rabbit & ssl_listeners entries the crash report disappears.

So it is required to always have both rabbitmq and rabbitmq_stomp 
entries (with SSL), not only rabbitmq_stomp?

Regards
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/


From pgross at gmail.com  Fri May 18 18:36:15 2012
From: pgross at gmail.com (Paul Gross)
Date: Fri, 18 May 2012 12:36:15 -0500
Subject: [rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
In-Reply-To: <4FB34F38.2080507@rabbitmq.com>
References: <4FABE167.9080900@gmail.com> <4FABE7B9.5010509@rabbitmq.com>
	<4FB15399.9090504@gmail.com> <4FB34F38.2080507@rabbitmq.com>
Message-ID: <4FB6888F.6050904@gmail.com>


> That looks like a perfectly healthy rabbit.
>
> There are no user-defined exchanges, queues or bindings - is that 
> expected?
>
This server is running a build, which creates and deletes a couple of 
queues. It's possible that these creates/deletes are happening at the 
same time. Could this cause the observed behavior?

> In your original email you said that "all of a sudden [...] RabbitMQ 
> consumes all available CPU and memory", but in the report the memory 
> usage is shown as 90MB, which isn't very high.
>
> Are you sure that it is *rabbit* that is eating all the CPU & memory? 
> Please check the CPU/memory usage of the beam.smp process and include 
> that in your report next time the problem occurs.
>
The beam.smp process is definitely going nuts. Here's the output from ps 
aufx:

rabbitmq 26472  0.0  0.0   4144     0 ?        S    May14   0:00 /bin/sh 
/usr/sbin/rabbitmq-server
rabbitmq 26490  184 82.4 2367176 837356 ?      Sl   May14 9852:39  \_ 
/usr/lib/erlang/erts-5.9.1/bin/beam.smp -W w -K true -A30 -P 1048576 -- 
-root /usr/lib/erlang -progname erl -- -
rabbitmq 26605  0.0  0.0  10776     0 ?        Ss   May14   0:00      \_ 
inet_gethost 4
rabbitmq 26606  0.0  0.0  12876    36 ?        S    May14   
0:00          \_ inet_gethost 4

As you can see, beam.smp is using 184% CPU and 82.4% of memory on this 
server (4 cores, 1GB RAM).

Unfortunately, by the time I was able to ssh into the server to run 
rabbitmqctl report, it said nodedown.

Here's the output of report after I manually killed beam.smp and ran 
/etc/init.d/rabbitmq start:

Status of node 'rabbit at bt-ci-rabbitmq' ...
[{pid,18399},
  {running_applications,[{rabbit,"RabbitMQ","2.8.2"},
                         {os_mon,"CPO  CXC 138 46","2.2.9"},
                         {sasl,"SASL  CXC 138 11","2.2.1"},
                         {mnesia,"MNESIA  CXC 138 12","4.7"},
                         {stdlib,"ERTS  CXC 138 10","1.18.1"},
                         {kernel,"ERTS  CXC 138 10","2.15.1"}]},
  {os,{unix,linux}},
  {erlang_version,"Erlang R15B01 (erts-5.9.1) [source] [64-bit] 
[smp:4:4] [async-threads:30] [hipe] [kernel-poll:true]\n"},
  {memory,[{total,27528008},
           {processes,10447908},
           {processes_used,10447894},
           {system,17080100},
           {atom,504409},
           {atom_used,475802},
           {binary,806272},
           {code,11905478},
           {ets,823624}]},
  {vm_memory_high_watermark,0.19999999923056544},
  {vm_memory_limit,207944908},
  {disk_free_limit,1039724544},
  {disk_free,38120873984},
  {file_descriptors,[{total_limit,924},
                     {total_used,6},
                     {sockets_limit,829},
                     {sockets_used,1}]},
  {processes,[{limit,1048576},{used,130}]},
  {run_queue,0},
  {uptime,27}]

Cluster status of node 'rabbit at bt-ci-rabbitmq' ...
[{nodes,[{disc,['rabbit at bt-ci-rabbitmq']}]},
  {running_nodes,['rabbit at bt-ci-rabbitmq']}]

Application environment of node 'rabbit at bt-ci-rabbitmq' ...
[{auth_backends,[rabbit_auth_backend_internal]},
  {auth_mechanisms,['PLAIN','AMQPLAIN']},
  {backing_queue_module,rabbit_variable_queue},
  {cluster_nodes,[]},
  {collect_statistics,none},
  {collect_statistics_interval,5000},
  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
  {default_user,<<"guest">>},
  {default_user_tags,[administrator]},
  {default_vhost,<<"/">>},
  {delegate_count,16},
  {disk_free_limit,{mem_relative,1.0}},
  {error_logger,{file,"/var/log/rabbitmq/rabbit at bt-ci-rabbitmq.log"}},
  {frame_max,131072},
  {hipe_compile,false},
  {included_applications,[]},
  {log_levels,[{connection,info}]},
  {msg_store_file_size_limit,16777216},
  {msg_store_index_module,rabbit_msg_store_ets_index},
  {queue_index_max_journal_entries,262144},
  {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at bt-ci-rabbitmq-sasl.log"}},
  {server_properties,[]},
  {ssl_cert_login_from,distinguished_name},
  {ssl_listeners,[]},
  {ssl_options,[]},
  {tcp_listen_options,[binary,
                       {packet,raw},
                       {reuseaddr,true},
                       {backlog,128},
                       {nodelay,true},
                       {linger,{true,0}},
                       {exit_on_close,false}]},
  {tcp_listeners,[5672]},
  {trace_vhosts,[]},
  {vm_memory_high_watermark,0.2}]

Connections:

Channels:

Queues on /:
pid    name    durable    auto_delete    arguments    owner_pid    
slave_pids    synchronised_slave_pids    exclusive_consumer_pid    
exclusive_consumer_tag    messages_ready    messages_unacknowledged    
messages    consumers    memory    backing_queue_status
<'rabbit at bt-ci-rabbitmq'.2.186.0>    
webhook_worker_master-testing_notifications    true    false    
[{"x-ha-policy","all"}]        []    []            0    0    0    0    
34688    [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, 
{q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, 
{ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0}, 
{persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, 
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}, {mirror_seen,0}, 
{mirror_senders,0}]
<'rabbit at bt-ci-rabbitmq'.2.187.0>    gateway_master_test    true    
false    [{"x-ha-policy","all"}]        []    []            79    0    
79    0    88808    [{q1,0}, {q2,0}, 
{delta,{delta,undefined,0,undefined}}, {q3,79}, {q4,0}, {len,79}, 
{pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, 
{ram_ack_count,0}, {next_seq_id,16384}, {persistent_count,79}, 
{avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, 
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}, {mirror_seen,0}, 
{mirror_senders,0}]
<'rabbit at bt-ci-rabbitmq'.2.188.0>    gateway_release_test    true    
false    [{"x-ha-policy","all"}]        []    []            109    0    
109    0    142928    [{q1,0}, {q2,0}, 
{delta,{delta,undefined,0,undefined}}, {q3,109}, {q4,0}, {len,109}, 
{pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, 
{ram_ack_count,0}, {next_seq_id,16384}, {persistent_count,109}, 
{avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, 
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}, {mirror_seen,0}, 
{mirror_senders,0}]

Exchanges on /:
name    type    durable    auto_delete    internal    arguments
amq.direct    direct    true    false    false    []
amq.topic    topic    true    false    false    []
amq.rabbitmq.trace    topic    true    false    false    []
amq.rabbitmq.log    topic    true    false    false    []
amq.fanout    fanout    true    false    false    []
amq.headers    headers    true    false    false    []
     direct    true    false    false    []
amq.match    headers    true    false    false    []

Bindings on /:
source_name    source_kind    destination_name    destination_kind    
routing_key    arguments
     exchange    gateway_master_test    queue    gateway_master_test    []
     exchange    gateway_release_test    queue    gateway_release_test    []
     exchange    webhook_worker_master-testing_notifications    queue    
webhook_worker_master-testing_notifications    []

Consumers on /:

Permissions on /:
user    configure    write    read
guest    .*    .*    .*

End of server status report
...done.


From seitz at bsd-unix.net  Fri May 18 19:12:47 2012
From: seitz at bsd-unix.net (Bryan Seitz)
Date: Fri, 18 May 2012 14:12:47 -0400
Subject: [rabbitmq-discuss] Issues on RHEL 6.2 with RabbitMQ 1.8.2
Message-ID: <20120518181247.GA93863@bsd-unix.net>

RabbitMQers,

   I've tried 1.7.x and 1.8.x rpms with no success, it seems there is an issue with the init script.
Unfortunately under start_rabbitmq it does the following:

start_rabbitmq () {
    status_rabbitmq quiet
    if [ $RETVAL = 0 ] ; then
        echo RabbitMQ is currently running
    else

The problem is that even when it is not running, rabbitmqctl status throws an exit code 0 so it never gets started via the script.
Has anyone else run into this or am I doing something wrong?

(Server starts fine when I call it by hand, /usr/sbin/rabbitmq-server)

TIA,


-- 
             
Bryan G. Seitz

From seitz at bsd-unix.net  Fri May 18 19:17:33 2012
From: seitz at bsd-unix.net (Bryan Seitz)
Date: Fri, 18 May 2012 14:17:33 -0400
Subject: [rabbitmq-discuss] Issues on RHEL 6.2 with RabbitMQ 1.8.2
In-Reply-To: <20120518181247.GA93863@bsd-unix.net>
References: <20120518181247.GA93863@bsd-unix.net>
Message-ID: <20120518181733.GA94042@bsd-unix.net>

Sorry, to clarify I meant 2.x not 1.x ;)

On Fri, May 18, 2012 at 02:12:47PM -0400, Bryan Seitz wrote:
> RabbitMQers,
> 
>    I've tried 1.7.x and 1.8.x rpms with no success, it seems there is an issue with the init script.
> Unfortunately under start_rabbitmq it does the following:
> 
> start_rabbitmq () {
>     status_rabbitmq quiet
>     if [ $RETVAL = 0 ] ; then
>         echo RabbitMQ is currently running
>     else
> 
> The problem is that even when it is not running, rabbitmqctl status throws an exit code 0 so it never gets started via the script.
> Has anyone else run into this or am I doing something wrong?
> 
> (Server starts fine when I call it by hand, /usr/sbin/rabbitmq-server)
> 
> TIA,

From ctlajoie at gmail.com  Fri May 18 19:25:25 2012
From: ctlajoie at gmail.com (Chris)
Date: Fri, 18 May 2012 12:25:25 -0600
Subject: [rabbitmq-discuss] What happens to messages delivered just
 before canceling consume?
In-Reply-To: <20120518104125.GB24978@wellquite.org>
References: <CAO-4Wf5QjFYf0VXqMiOJSXWMPRy=RUOrhLs-vyn27C_9+i9+ew@mail.gmail.com>
	<4FB619E0.2020700@rabbitmq.com> <4FB619FC.8020304@rabbitmq.com>
	<4FB624E4.9000606@rabbitmq.com>
	<20120518104125.GB24978@wellquite.org>
Message-ID: <CAO-4Wf7vS_FjCxrqTJ5RBayhPCymsYUHPcsDrF_rnJhj7TMFpg@mail.gmail.com>

On Fri, May 18, 2012 at 4:41 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> However, unless you are on a network with 0 latency, a prefetch of 1
> will guarantee your client sits around idle for at least some of the
> time. If you follow the maths through on my recent blog post,
> http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/
> then you should be able to calculate a sensible prefetch figure (without
> resorting to more exotic solutions like CoDel).

Thank you for linking the blog post.. very informative. I had not
thought about the potential consequences of using a prefech of 1, but
you clearly explained the tradeoffs.

Obviously no one is on a network with 0 latency, but all nodes of my
application are on the same (small) LAN, and will have low latency.
Also the time it takes to process a single message received by one of
my consumers can vary wildly, from about 1 second to 15 seconds, and
it is important that they get processed ASAP, even though they can
take this amount of time. In this situation do you believe I am
justified in using a prefetch count of 1?

Chris

From ctlajoie at gmail.com  Fri May 18 19:31:46 2012
From: ctlajoie at gmail.com (Chris)
Date: Fri, 18 May 2012 12:31:46 -0600
Subject: [rabbitmq-discuss] What happens to messages delivered just
 before canceling consume?
In-Reply-To: <4FB619E0.2020700@rabbitmq.com>
References: <CAO-4Wf5QjFYf0VXqMiOJSXWMPRy=RUOrhLs-vyn27C_9+i9+ew@mail.gmail.com>
	<4FB619E0.2020700@rabbitmq.com>
Message-ID: <CAO-4Wf7NWeRgwnHNX+L+60DajdQyn9iG=74Z9Gu8-6tc9VrJBw@mail.gmail.com>

On Fri, May 18, 2012 at 3:44 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> Alternatively you could cancel the subscription before acknowledging
> the last message.

Brilliant! Thank you.
And no worries about the prefetch=0 advice. I happened to know that
using prefetch=0 means no limit.

Chris

From matthias at rabbitmq.com  Fri May 18 19:48:17 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 18 May 2012 19:48:17 +0100
Subject: [rabbitmq-discuss] Issues on RHEL 6.2 with RabbitMQ 2.8.2
In-Reply-To: <20120518181733.GA94042@bsd-unix.net>
References: <20120518181247.GA93863@bsd-unix.net>
	<20120518181733.GA94042@bsd-unix.net>
Message-ID: <4FB69971.5050409@rabbitmq.com>

Bryan,

On 18/05/12 19:17, Bryan Seitz wrote:
> Sorry, to clarify I meant 2.x not 1.x ;)

subject line corrected ;)

>> The problem is that even when it is not running, rabbitmqctl status
>> throws an exit code 0 so it never gets started via the script.

I get an exit status of 2 when I try that, but that's running 
rabbitmqctl directly, whereas iirc on RHEL there is a wrapper script in 
place that switches to the 'rabbitmq' user. So there could be something 
going wrong there. It would be great if you were to investigate this a 
bit further. Thanks.

Matthias.

From seitz at bsd-unix.net  Fri May 18 20:07:15 2012
From: seitz at bsd-unix.net (Bryan Seitz)
Date: Fri, 18 May 2012 15:07:15 -0400
Subject: [rabbitmq-discuss] Issues on RHEL 6.2 with RabbitMQ 2.8.2
In-Reply-To: <4FB69971.5050409@rabbitmq.com>
References: <20120518181247.GA93863@bsd-unix.net>
	<20120518181733.GA94042@bsd-unix.net>
	<4FB69971.5050409@rabbitmq.com>
Message-ID: <20120518190715.GA95440@bsd-unix.net>

Matthias,

Confirmed here as well, /usr/lib/rabbitmq/bin/rabbitmqctl status = 2.

What is the proper fix ? :(

On Fri, May 18, 2012 at 07:48:17PM +0100, Matthias Radestock wrote:
> Bryan,
> 
> On 18/05/12 19:17, Bryan Seitz wrote:
> > Sorry, to clarify I meant 2.x not 1.x ;)
> 
> subject line corrected ;)
> 
> >> The problem is that even when it is not running, rabbitmqctl status
> >> throws an exit code 0 so it never gets started via the script.
> 
> I get an exit status of 2 when I try that, but that's running 
> rabbitmqctl directly, whereas iirc on RHEL there is a wrapper script in 
> place that switches to the 'rabbitmq' user. So there could be something 
> going wrong there. It would be great if you were to investigate this a 
> bit further. Thanks.
> 
> Matthias.

-- 
             
Bryan G. Seitz

From matthias at rabbitmq.com  Fri May 18 20:54:47 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 18 May 2012 20:54:47 +0100
Subject: [rabbitmq-discuss] Issues on RHEL 6.2 with RabbitMQ 2.8.2
In-Reply-To: <20120518190715.GA95440@bsd-unix.net>
References: <20120518181247.GA93863@bsd-unix.net>
	<20120518181733.GA94042@bsd-unix.net>
	<4FB69971.5050409@rabbitmq.com>
	<20120518190715.GA95440@bsd-unix.net>
Message-ID: <4FB6A907.70502@rabbitmq.com>

Bryan,

On 18/05/12 20:07, Bryan Seitz wrote:
> Confirmed here as well, /usr/lib/rabbitmq/bin/rabbitmqctl status = 2.

Careful, here. We wrap the scripts for a reason. The above needs to be 
executed as the rabbitmq user.

What does 'sudo rabbitmqctl status' return?

If its 0, are you sure you haven't got a rabbit running? Check for any 
running 'beam.smp' processes.

Matthias.

From seitz at bsd-unix.net  Fri May 18 21:11:22 2012
From: seitz at bsd-unix.net (Bryan Seitz)
Date: Fri, 18 May 2012 16:11:22 -0400
Subject: [rabbitmq-discuss] Issues on RHEL 6.2 with RabbitMQ 2.8.2
In-Reply-To: <4FB6A907.70502@rabbitmq.com>
References: <20120518181247.GA93863@bsd-unix.net>
	<20120518181733.GA94042@bsd-unix.net>
	<4FB69971.5050409@rabbitmq.com>
	<20120518190715.GA95440@bsd-unix.net> <4FB6A907.70502@rabbitmq.com>
Message-ID: <20120518201122.GA97262@bsd-unix.net>

On Fri, May 18, 2012 at 08:54:47PM +0100, Matthias Radestock wrote:
> Bryan,
> 
> On 18/05/12 20:07, Bryan Seitz wrote:
> > Confirmed here as well, /usr/lib/rabbitmq/bin/rabbitmqctl status = 2.
> 
> Careful, here. We wrap the scripts for a reason. The above needs to be 
> executed as the rabbitmq user.
> 
> What does 'sudo rabbitmqctl status' return?
> 
> If its 0, are you sure you haven't got a rabbit running? Check for any 
> running 'beam.smp' processes.

Nothing is running.

[root at nzop-rmq-053001 ~]# /usr/sbin/rabbitmqctl status
Status of node 'rabbit at nzop-rmq-053001' ...
Error: unable to connect to node 'rabbit at nzop-rmq-053001': nodedown
diagnostics:
- nodes and their ports on nzop-rmq-053001: [{rabbitmqctl3639,46208}]
- current node: 'rabbitmqctl3639 at nzop-rmq-053001'
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: F3EZ0NiUJjry2mnh7p79EA==
[root at nzop-rmq-053001 ~]# echo $?
0

[root at nzop-rmq-053001 ~]# ps auxwww |grep -i erlang
root      3660  0.0  0.0 103232   844 pts/3    R+   16:09   0:00 grep -i erlang
rabbitmq 28599  0.0  0.0  10812   528 ?        S    15:11   0:00 /usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon

[root at nzop-rmq-053001 ~]# /usr/lib/rabbitmq/bin/rabbitmqctl status
Status of node 'rabbit at nzop-rmq-053001' ...
Error: unable to connect to node 'rabbit at nzop-rmq-053001': nodedown
diagnostics:
- nodes and their ports on nzop-rmq-053001: [{rabbitmqctl3662,33249}]
- current node: 'rabbitmqctl3662 at nzop-rmq-053001'
- current node home dir: /root
- current node cookie hash: 3vMvx1PDqk2zokESc/nyLg==
[root at nzop-rmq-053001 ~]# echo $?
2

Linux nzop-rmq-053001 2.6.32-220.13.1.el6.x86_64 #1 SMP Tue Apr 17 23:56:34 BST 2012 x86_64 x86_64 x86_64 GNU/Linux

Is anyone else running it on RHEL cause this is a pretty standard install and I don't think anything system wise would cause
this.



-- 
             
Bryan G. Seitz

From matthias at rabbitmq.com  Fri May 18 21:45:58 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 18 May 2012 21:45:58 +0100
Subject: [rabbitmq-discuss] Issues on RHEL 6.2 with RabbitMQ 2.8.2
In-Reply-To: <20120518201122.GA97262@bsd-unix.net>
References: <20120518181247.GA93863@bsd-unix.net>
	<20120518181733.GA94042@bsd-unix.net>
	<4FB69971.5050409@rabbitmq.com>
	<20120518190715.GA95440@bsd-unix.net> <4FB6A907.70502@rabbitmq.com>
	<20120518201122.GA97262@bsd-unix.net>
Message-ID: <4FB6B506.5050209@rabbitmq.com>

Bryan,

On 18/05/12 21:11, Bryan Seitz wrote:
> [root at nzop-rmq-053001 ~]# /usr/sbin/rabbitmqctl status
> Status of node 'rabbit at nzop-rmq-053001' ...
> Error: unable to connect to node 'rabbit at nzop-rmq-053001': nodedown
> diagnostics:
> - nodes and their ports on nzop-rmq-053001: [{rabbitmqctl3639,46208}]
> - current node: 'rabbitmqctl3639 at nzop-rmq-053001'
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: F3EZ0NiUJjry2mnh7p79EA==
> [root at nzop-rmq-053001 ~]# echo $?
> 0

Right. So it looks like the wrapper script is swallowing the exit code. 
AFAICT the wrapper code hasn't changed for ages, so I am perplexed why 
this problem hasn't surfaced before. I have filed a bug.

Matthias.

From matthias at rabbitmq.com  Fri May 18 22:07:01 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 18 May 2012 22:07:01 +0100
Subject: [rabbitmq-discuss] Issues on RHEL 6.2 with RabbitMQ 2.8.2
In-Reply-To: <4FB6B506.5050209@rabbitmq.com>
References: <20120518181247.GA93863@bsd-unix.net>	<20120518181733.GA94042@bsd-unix.net>	<4FB69971.5050409@rabbitmq.com>	<20120518190715.GA95440@bsd-unix.net>
	<4FB6A907.70502@rabbitmq.com>	<20120518201122.GA97262@bsd-unix.net>
	<4FB6B506.5050209@rabbitmq.com>
Message-ID: <4FB6B9F5.5020002@rabbitmq.com>

Bryan,

On 18/05/12 21:45, Matthias Radestock wrote:
> Right. So it looks like the wrapper script is swallowing the exit code.
> AFAICT the wrapper code hasn't changed for ages, so I am perplexed why
> this problem hasn't surfaced before. I have filed a bug.

Preliminary investigation suggests that this may be a bug that got 
introduced in 2.8.2. Perhaps you could give 2.8.1 a try to confirm that?

Matthias.

From seitz at bsd-unix.net  Fri May 18 22:14:40 2012
From: seitz at bsd-unix.net (Bryan Seitz)
Date: Fri, 18 May 2012 17:14:40 -0400
Subject: [rabbitmq-discuss] Issues on RHEL 6.2 with RabbitMQ 2.8.2
In-Reply-To: <4FB6B9F5.5020002@rabbitmq.com>
References: <20120518181247.GA93863@bsd-unix.net>
	<20120518181733.GA94042@bsd-unix.net>
	<4FB69971.5050409@rabbitmq.com>
	<20120518190715.GA95440@bsd-unix.net> <4FB6A907.70502@rabbitmq.com>
	<20120518201122.GA97262@bsd-unix.net>
	<4FB6B506.5050209@rabbitmq.com> <4FB6B9F5.5020002@rabbitmq.com>
Message-ID: <20120518211440.GA98817@bsd-unix.net>

I tried 2.8.1 and 2.7.9. I have actually found the bug to be the fact that I am running 'SSSD' which 
has hooks into pam.  I will work with the SSSD people to figure out why it is breaking SU exit codes.
Thanks for your time and patience.

On Fri, May 18, 2012 at 10:07:01PM +0100, Matthias Radestock wrote:
> Bryan,
> 
> On 18/05/12 21:45, Matthias Radestock wrote:
> > Right. So it looks like the wrapper script is swallowing the exit code.
> > AFAICT the wrapper code hasn't changed for ages, so I am perplexed why
> > this problem hasn't surfaced before. I have filed a bug.
> 
> Preliminary investigation suggests that this may be a bug that got 
> introduced in 2.8.2. Perhaps you could give 2.8.1 a try to confirm that?
> 
> Matthias.

-- 
             
Bryan G. Seitz

From bino at indoakses-online.com  Sat May 19 02:50:23 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Sat, 19 May 2012 08:50:23 +0700
Subject: [rabbitmq-discuss] question,
 Shovel : different queue name between source and destination
In-Reply-To: <CAHZsVQab+RVJ0Jt_62AckwE0f0Q=VLA-g=8yeW7EmMkKu3QfiQ@mail.gmail.com>
References: <4FB604B0.8090300@indoakses-online.com>	<CAHZsVQbpkZB_dF+qoaHWmK77Q7MZ0WF4V06rQyBj=wh1VOTFCQ@mail.gmail.com>	<4FB61EE3.80702@indoakses-online.com>
	<CAHZsVQab+RVJ0Jt_62AckwE0f0Q=VLA-g=8yeW7EmMkKu3QfiQ@mail.gmail.com>
Message-ID: <4FB6FC5F.5010009@indoakses-online.com>

Dear Brendan and All
I really appreciate your enlightment
On 05/18/2012 07:00 PM, Brendan Hay wrote:
> In fairness, I probably over complicated things by trying to be as explicit
> as possible with the config.
> But here is my updated gist containing a 'publish_fields' addition to
> ensure the messages go to the destination exchange:
> https://gist.github.com/2723964
>
It works !
blasting fast
> With that adjustment, you should be able to publish a message to
> 'source_exchange' without a routing key, and have it turn up in
> 'destination_queue'.
>
for those who just first-day-er (or in my case : Old crack brainer) with 
rabbitMQ, just adopt 
http://www.rabbitmq.com/tutorials/tutorial-three-python.html
just be carefull about all 'name'
> Here are also a couple of things you can do to assist in debugging shovel
> problems:
>
> Firstly tailing the logs under /var/log/rabbitmq will show any specific
> authentication/vhost errors the shovel has while starting up.
>
Yup .. I did
> The shovel management plugin can be enabled via: rabbitmq-plugins enable
> rabbitmq_shovel_management
> This will let you see the status of the shovel via a tab in the management
> ui.
>
I did
> PS. If you are running the shovel plugin as either the source or
> destination for the configuration then you can specify the amqp uri as just
> "amqp://".
> The shovel plugin will then use guest on vhost '/' via the amqp direct
> connection - this is a good. You can read more about the direct connection
> here: http://www.rabbitmq.com/erlang-client-user-guide.html#model
>
Noted.


Again, I really appreciate your enlightment

Sincerely
-bino-

From bino at indoakses-online.com  Sat May 19 07:35:34 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Sat, 19 May 2012 13:35:34 +0700
Subject: [rabbitmq-discuss] just a benchmark info
Message-ID: <4FB73F36.2060909@indoakses-online.com>

Dear All.

I really need to tell my appreciation to all RabbitMQ 
developer/contributor/tutor.

I just make a shovel communication test betwen 2 RabbitMQ server

1. Stop the remote rabbitmq service
2. Load a bunch of msg to my local rabbitmq (where shovel live)
The load is 8000 line of data with average 250 char per line
3. start the remote RabbitMQ

And in less than 2 minute ... all of the msg is sit on the remote

My remote engine spec is (from /proc/cpuinfo)
processor    : 0
vendor_id    : GenuineIntel
cpu family    : 6
model        : 15
model name    : Intel(R) Pentium(R) Dual  CPU  E2180  @ 2.00GHz
stepping    : 13
cpu MHz        : 1200.000
cache size    : 1024 KB

I'm not sure about internet connection capacity between my office and 
remote RabbitMQ

Sincerely
-bino-

From michael.justin at gmx.net  Sat May 19 09:33:57 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Sat, 19 May 2012 10:33:57 +0200
Subject: [rabbitmq-discuss] stomp+ssl message send works,
 receive hangs after around 200-300 messages
Message-ID: <jp7ltn$rn3$1@dough.gmane.org>

Hello,

Is STOMP+SSL known to be working with RabbitMQ (currently I am testing 
with 2.8.2)? Sending 1000 messages is fast, but receiving hangs after 
200 - 300 messages and the client needs to reconnect to receive more 
messages, but the connection always hangs after a short time.
I tried Stomp 1.0 and 1.1, and used a receive timeout of 1000 millieconds.
Are there easy to use stomp diagnostics tools (binaries) as 'reference 
implementations' for RabbitMQ which I could use to see if the problem 
appears only with my client?

Many thanks in advance
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/


From jose.mico at gmail.com  Sat May 19 10:04:55 2012
From: jose.mico at gmail.com (=?ISO-8859-1?Q?Jos=E9_Mic=F3?=)
Date: Sat, 19 May 2012 06:04:55 -0300
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of a burst
Message-ID: <4FB76237.7020901@gmail.com>

I've continued tracing the issue of STOMP adapter buffering the last 
message of a burst, and found that:

- The busier the CPU of the broker, the easier is to replicate the bug 
(this is a symptom of a race condition?)
- The size of messages doesn't seems to affect very much the outcome.
- The number of messages in the burst increments the possibility of a 
failure.
- I slowly sent carefully fragmented STOMP frames, there was no problem. 
The parser seems to cope with that fine.
- When the bug is triggered, the last message remains buffered at 
connection level. Other connections can publish to the queue perfectly.
- In my developement notebook I consistently get a failure ratio over 
30% for bursts of 100, 1000 or 10000 messages.

I've attached the flood script that I'm using for testing different 
combinations of message counts and sizes.
Maybe there is a problem within this script, but I doubt that as I get 
the same behavior with two different frameworks, and exactly one message 
is lost independently of message size.

This is causing me problems on the following cases:

- I want to notify 100 subscribers of a given event.
   Sometimes, first 99 are notified but the last one is not until the 
event is triggered again, but then it is too late.

- I want to send 100 RPC style requests and wait for the results.
   Sometimes, only 99 results are received because the last request was 
never sent.

- I want to notify 100 subscribers of a given event, and immediately 
send an RPC style request.
   Sometimes, subscribers are notified but the result of the RPC request 
is never received, as the last request was actually never sent.

As a workaround I could throttle the sending of messages, but that is 
really difficult as I don't have control on how the kernel flushes the 
tcp write buffer.
And, how much delay should be added to be safe? 50ms? That will make a 
client to take 50 seconds to send 1000 messages...

Is anybody getting STOMP message drops with 2.8.2? Can anyone replicate 
this bug?

Regards,
Jos?

-------------- next part --------------
A non-text attachment was scrubbed...
Name: stomp_bug_3.pl
Type: application/x-perl
Size: 2097 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120519/17ccca9b/attachment.bin>

From jose.mico at gmail.com  Sat May 19 22:37:06 2012
From: jose.mico at gmail.com (=?ISO-8859-1?Q?Jos=E9_Mic=F3?=)
Date: Sat, 19 May 2012 18:37:06 -0300
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of a
	burst
In-Reply-To: <4FB76237.7020901@gmail.com>
References: <4FB76237.7020901@gmail.com>
Message-ID: <4FB81282.2020006@gmail.com>

I've just confirmed this bug running my app against another broker 
(Apollo), on which the app worked perfectly.
Do you have any plan to fix this bug? I can test development versions of 
the plugin, if you want.

Regards,
Jos?

From gigi at roblox.com  Sun May 20 00:12:53 2012
From: gigi at roblox.com (Gigi)
Date: Sat, 19 May 2012 16:12:53 -0700
Subject: [rabbitmq-discuss] Starting a Rabbit node remotely using Fabric
 succeeds yet the node is down
Message-ID: <4FB828F5.3080403@roblox.com>

Hi,
I'm trying to start a stopped node running on a Linux box from a remote 
Windows 7 laptop. The command I send is:

sudo /sbin/service rabbitmq-server start

I get back the success message:

[10.10.3.31] sudo: /sbin/service rabbitmq-server start
[10.10.3.31] out: Starting rabbitmq-server: SUCCESS
[10.10.3.31] out: rabbitmq-server.


But, when I run the rabbitmqctl status command (either through Fabric or 
directly on the Linux box) I get nodedown error:

Status of node 'rabbit at P1-LApp16' ...
Error: unable to connect to node 'rabbit at P1-LApp16': nodedown

DIAGNOSTICS
===========

nodes in question: ['rabbit at P1-LApp16']

hosts, their running nodes and ports:
- P1-LApp16: [{rabbitmqctl16270,33443}]

current node details:
- node name: 'rabbitmqctl16270 at P1-LApp16'
- home dir: /var/lib/rabbitmq
- cookie hash: 95Vy6dqyADwcVrM/tntD6g==

If I start the node directly on the Linux box it works just fine. Once 
the node is started I can send it remote commands to rabbitmqctl via 
Fabric with no problem. I just can't start it remotely. Any idea what's 
going on and how to fix it?

Thanks, Gigi

Here is the output of rabbitmqctl status after I start the node directly 
on the Linuxbox:

Status of node 'rabbit at P1-LApp16' ...
[{pid,15761},
  {running_applications,
      [{rabbitmq_management,"RabbitMQ Management Console","2.8.2"},
       {xmerl,"XML parser","1.2.9"},
       {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.2"},
       {amqp_client,"RabbitMQ AMQP Client","2.8.2"},
       {rabbit,"RabbitMQ","2.8.2"},
       {os_mon,"CPO  CXC 138 46","2.2.6"},
       {sasl,"SASL  CXC 138 11","2.1.9.4"},
       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.2"},
       {webmachine,"webmachine","1.7.0-rmq2.8.2-hg"},
       {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.2-git"},
       {inets,"INETS  CXC 138 49","5.6"},
       {mnesia,"MNESIA  CXC 138 12","4.4.19"},
       {stdlib,"ERTS  CXC 138 10","1.17.4"},
       {kernel,"ERTS  CXC 138 10","2.14.4"}]},
  {os,{unix,linux}},
  {erlang_version,
      "Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:2:2] [rq:2] 
[async-threads:30] [kernel-poll:true]\n"},
  {memory,
      [{total,34496024},
       {processes,12425376},
       {processes_used,12416856},
       {system,22070648},
       {atom,1539953},
       {atom_used,1525035},
       {binary,199008},
       {code,17358734},
       {ets,1154200}]},
  {vm_memory_high_watermark,0.2},
  {vm_memory_limit,828162048},
  {disk_free_limit,4140810240},
  {disk_free,10354425856},
  {file_descriptors,
      
[{total_limit,924},{total_used,3},{sockets_limit,829},{sockets_used,1}]},
  {processes,[{limit,1048576},{used,172}]},
  {run_queue,0},
  {uptime,4}]
...done.












  


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120519/1d58e070/attachment.htm>

From gigi at roblox.com  Sun May 20 00:47:05 2012
From: gigi at roblox.com (Gigi)
Date: Sat, 19 May 2012 16:47:05 -0700
Subject: [rabbitmq-discuss] Can't cluster nodes on a single machine
In-Reply-To: <4FB828F5.3080403@roblox.com>
References: <4FB828F5.3080403@roblox.com>
Message-ID: <4FB830F9.40003@roblox.com>

I have two detached nodes called rabbit-1 and rabbit-2  running on port 
5672 and 5673. I follow the transcript for clustering and verified that 
rabbit-1 is running (via the status command) but when the cluster 
command fails complaining that rabbit-1 is not running. I tried to 
cluster both to rabbit-1 and rabbit-1 at GIGI (the host name). I even ran 
cluster_status on rabbit-1 and it says it's running just fine as a disc 
node (clustered to itself). Can anyone point out what am I doing wrong?

The setup is a Windows 7 laptop, Erlang 15B, RabbitMQ 2.8.2 with the 
management plugin. The start command sets the RABBITMQ_SERVER_START_ARGS 
so the management plugin for each node listens on a different port 
(55672 and 55673) .

Thanks, Gigi

Here is the session:

C:\Program Files (x86)\RabbitMQ 
Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.bat -n rabbit-2 stop_app
Stopping node 'rabbit-2 at Gigi' ...
...done.

C:\Program Files (x86)\RabbitMQ 
Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.ba
t -n rabbit-2 reset
Resetting node 'rabbit-2 at Gigi' ...
...done.

C:\Program Files (x86)\RabbitMQ 
Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.bat -n rabbit-1 status
Status of node 'rabbit-1 at Gigi' ...
[{pid,12988},
  {running_applications,
      [{rabbitmq_management,"RabbitMQ Management Console","2.8.2"},
       {xmerl,"XML parser","1.3"},
       {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.2"},
       {amqp_client,"RabbitMQ AMQP Client","2.8.2"},
       {rabbit,"RabbitMQ","2.8.2"},
       {os_mon,"CPO  CXC 138 46","2.2.8"},
       {sasl,"SASL  CXC 138 11","2.2"},
       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.2"},
       {webmachine,"webmachine","1.7.0-rmq2.8.2-hg"},
       {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.2-git"},
       {inets,"INETS  CXC 138 49","5.8"},
       {mnesia,"MNESIA  CXC 138 12","4.6"},
       {stdlib,"ERTS  CXC 138 10","1.18"},
       {kernel,"ERTS  CXC 138 10","2.15"}]},
  {os,{win32,nt}},
  {erlang_version,"Erlang R15B (erts-5.9) [smp:8:8] [async-threads:30]\n"},
  {memory,
      [{total,19502880},
       {processes,6062447},
       {processes_used,6062432},
       {system,13440433},
       {atom,495069},
       {atom_used,485111},
       {binary,82512},
       {code,9611946},
       {ets,625740}]},
  {vm_memory_high_watermark,0.10147532588839969},
  {vm_memory_limit,858993459},
  {disk_free_limit,8465047552},
  {disk_free,58608041984},
  {file_descriptors,
      
[{total_limit,924},{total_used,4},{sockets_limit,829},{sockets_used,2}]},
  {processes,[{limit,1048576},{used,181}]},
  {run_queue,0},
  {uptime,358}]
...done.

C:\Program Files (x86)\RabbitMQ 
Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.ba
t -n rabbit-2 cluster rabbit-1
Clustering node 'rabbit-2 at Gigi' with ['rabbit-1'] ...
Error: {no_running_cluster_nodes,['rabbit-1'],['rabbit-1']}

C:\Program Files (x86)\RabbitMQ 
Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.ba
t -n rabbit-2 cluster rabbit-1 at GIGI
Clustering node 'rabbit-2 at Gigi' with ['rabbit-1 at GIGI'] ...
Error: {no_running_cluster_nodes,['rabbit-1 at GIGI'],['rabbit-1 at GIGI']}

C:\Program Files (x86)\RabbitMQ 
Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.bat -n rabbit-1 cluster_status
Cluster status of node 'rabbit-1 at Gigi' ...
[{nodes,[{disc,['rabbit-1 at Gigi']}]},{running_nodes,['rabbit-1 at Gigi']}]
...done.







From ishwor.gurung at gmail.com  Sun May 20 01:39:33 2012
From: ishwor.gurung at gmail.com (Ishwor Gurung)
Date: Sun, 20 May 2012 10:39:33 +1000
Subject: [rabbitmq-discuss] Can't cluster nodes on a single machine
In-Reply-To: <4FB830F9.40003@roblox.com>
References: <4FB828F5.3080403@roblox.com>
	<4FB830F9.40003@roblox.com>
Message-ID: <CADU4sb_qBCMY6323=c=OYT6vT_NT4wfb_Oa25K0n668bs80Kzg@mail.gmail.com>

On 20 May 2012 09:47, Gigi <gigi at roblox.com> wrote:
> I have two detached nodes called rabbit-1 and rabbit-2 ?running on port 5672
> and 5673. I follow the transcript for clustering and verified that rabbit-1
> is running (via the status command) but when the cluster command fails
> complaining that rabbit-1 is not running. I tried to cluster both to
> rabbit-1 and rabbit-1 at GIGI (the host name). I even ran cluster_status on
> rabbit-1 and it says it's running just fine as a disc node (clustered to
> itself). Can anyone point out what am I doing wrong?
>
> The setup is a Windows 7 laptop, Erlang 15B, RabbitMQ 2.8.2 with the
> management plugin. The start command sets the RABBITMQ_SERVER_START_ARGS so
> the management plugin for each node listens on a different port (55672 and
> 55673) .

Try this fab https://github.com/ishwor/stuffs/blob/master/rabbitfab.py

> Thanks, Gigi
>
> Here is the session:
>
> C:\Program Files (x86)\RabbitMQ
> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.bat -n rabbit-2 stop_app
> Stopping node 'rabbit-2 at Gigi' ...
> ...done.
>
> C:\Program Files (x86)\RabbitMQ
> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.ba
> t -n rabbit-2 reset
> Resetting node 'rabbit-2 at Gigi' ...
> ...done.
>
> C:\Program Files (x86)\RabbitMQ
> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.bat -n rabbit-1 status
> Status of node 'rabbit-1 at Gigi' ...
> [{pid,12988},
> ?{running_applications,
> ? ? [{rabbitmq_management,"RabbitMQ Management Console","2.8.2"},
> ? ? ?{xmerl,"XML parser","1.3"},
> ? ? ?{rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.2"},
> ? ? ?{amqp_client,"RabbitMQ AMQP Client","2.8.2"},
> ? ? ?{rabbit,"RabbitMQ","2.8.2"},
> ? ? ?{os_mon,"CPO ?CXC 138 46","2.2.8"},
> ? ? ?{sasl,"SASL ?CXC 138 11","2.2"},
> ? ? ?{rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.2"},
> ? ? ?{webmachine,"webmachine","1.7.0-rmq2.8.2-hg"},
> ? ? ?{mochiweb,"MochiMedia Web Server","1.3-rmq2.8.2-git"},
> ? ? ?{inets,"INETS ?CXC 138 49","5.8"},
> ? ? ?{mnesia,"MNESIA ?CXC 138 12","4.6"},
> ? ? ?{stdlib,"ERTS ?CXC 138 10","1.18"},
> ? ? ?{kernel,"ERTS ?CXC 138 10","2.15"}]},
> ?{os,{win32,nt}},
> ?{erlang_version,"Erlang R15B (erts-5.9) [smp:8:8] [async-threads:30]\n"},
> ?{memory,
> ? ? [{total,19502880},
> ? ? ?{processes,6062447},
> ? ? ?{processes_used,6062432},
> ? ? ?{system,13440433},
> ? ? ?{atom,495069},
> ? ? ?{atom_used,485111},
> ? ? ?{binary,82512},
> ? ? ?{code,9611946},
> ? ? ?{ets,625740}]},
> ?{vm_memory_high_watermark,0.10147532588839969},
> ?{vm_memory_limit,858993459},
> ?{disk_free_limit,8465047552},
> ?{disk_free,58608041984},
> ?{file_descriptors,
>
> [{total_limit,924},{total_used,4},{sockets_limit,829},{sockets_used,2}]},
> ?{processes,[{limit,1048576},{used,181}]},
> ?{run_queue,0},
> ?{uptime,358}]
> ...done.
>
> C:\Program Files (x86)\RabbitMQ
> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.ba
> t -n rabbit-2 cluster rabbit-1
> Clustering node 'rabbit-2 at Gigi' with ['rabbit-1'] ...
> Error: {no_running_cluster_nodes,['rabbit-1'],['rabbit-1']}
>
> C:\Program Files (x86)\RabbitMQ
> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.ba
> t -n rabbit-2 cluster rabbit-1 at GIGI
> Clustering node 'rabbit-2 at Gigi' with ['rabbit-1 at GIGI'] ...
> Error: {no_running_cluster_nodes,['rabbit-1 at GIGI'],['rabbit-1 at GIGI']}
>
> C:\Program Files (x86)\RabbitMQ
> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.bat -n rabbit-1 cluster_status
> Cluster status of node 'rabbit-1 at Gigi' ...
> [{nodes,[{disc,['rabbit-1 at Gigi']}]},{running_nodes,['rabbit-1 at Gigi']}]
> ...done.
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
Best regards,
Ishwor

From gigi at roblox.com  Sun May 20 01:53:45 2012
From: gigi at roblox.com (Gigi)
Date: Sat, 19 May 2012 17:53:45 -0700
Subject: [rabbitmq-discuss] Can't cluster nodes on a single machine
In-Reply-To: <CADU4sb_qBCMY6323=c=OYT6vT_NT4wfb_Oa25K0n668bs80Kzg@mail.gmail.com>
References: <4FB828F5.3080403@roblox.com> <4FB830F9.40003@roblox.com>
	<CADU4sb_qBCMY6323=c=OYT6vT_NT4wfb_Oa25K0n668bs80Kzg@mail.gmail.com>
Message-ID: <4FB84099.5010900@roblox.com>

Ishwor, thanks for the quick response. The fab file you suggested helps 
setting up a cluster on different machines where each node is named 
"rabbit". My question is about a cluster running two RabbitMQ nodes on 
the same machine with custom node names. I'm following the same sequence 
of commands (stop_app, reset, cluster, start_app), but the cluster step 
fails to find the other node.

Gigi

On 5/19/2012 5:39 PM, Ishwor Gurung wrote:
> On 20 May 2012 09:47, Gigi<gigi at roblox.com>  wrote:
>> I have two detached nodes called rabbit-1 and rabbit-2  running on port 5672
>> and 5673. I follow the transcript for clustering and verified that rabbit-1
>> is running (via the status command) but when the cluster command fails
>> complaining that rabbit-1 is not running. I tried to cluster both to
>> rabbit-1 and rabbit-1 at GIGI (the host name). I even ran cluster_status on
>> rabbit-1 and it says it's running just fine as a disc node (clustered to
>> itself). Can anyone point out what am I doing wrong?
>>
>> The setup is a Windows 7 laptop, Erlang 15B, RabbitMQ 2.8.2 with the
>> management plugin. The start command sets the RABBITMQ_SERVER_START_ARGS so
>> the management plugin for each node listens on a different port (55672 and
>> 55673) .
> Try this fab https://github.com/ishwor/stuffs/blob/master/rabbitfab.py
>
>> Thanks, Gigi
>>
>> Here is the session:
>>
>> C:\Program Files (x86)\RabbitMQ
>> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.bat -n rabbit-2 stop_app
>> Stopping node 'rabbit-2 at Gigi' ...
>> ...done.
>>
>> C:\Program Files (x86)\RabbitMQ
>> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.ba
>> t -n rabbit-2 reset
>> Resetting node 'rabbit-2 at Gigi' ...
>> ...done.
>>
>> C:\Program Files (x86)\RabbitMQ
>> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.bat -n rabbit-1 status
>> Status of node 'rabbit-1 at Gigi' ...
>> [{pid,12988},
>>   {running_applications,
>>      [{rabbitmq_management,"RabbitMQ Management Console","2.8.2"},
>>       {xmerl,"XML parser","1.3"},
>>       {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.2"},
>>       {amqp_client,"RabbitMQ AMQP Client","2.8.2"},
>>       {rabbit,"RabbitMQ","2.8.2"},
>>       {os_mon,"CPO  CXC 138 46","2.2.8"},
>>       {sasl,"SASL  CXC 138 11","2.2"},
>>       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.2"},
>>       {webmachine,"webmachine","1.7.0-rmq2.8.2-hg"},
>>       {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.2-git"},
>>       {inets,"INETS  CXC 138 49","5.8"},
>>       {mnesia,"MNESIA  CXC 138 12","4.6"},
>>       {stdlib,"ERTS  CXC 138 10","1.18"},
>>       {kernel,"ERTS  CXC 138 10","2.15"}]},
>>   {os,{win32,nt}},
>>   {erlang_version,"Erlang R15B (erts-5.9) [smp:8:8] [async-threads:30]\n"},
>>   {memory,
>>      [{total,19502880},
>>       {processes,6062447},
>>       {processes_used,6062432},
>>       {system,13440433},
>>       {atom,495069},
>>       {atom_used,485111},
>>       {binary,82512},
>>       {code,9611946},
>>       {ets,625740}]},
>>   {vm_memory_high_watermark,0.10147532588839969},
>>   {vm_memory_limit,858993459},
>>   {disk_free_limit,8465047552},
>>   {disk_free,58608041984},
>>   {file_descriptors,
>>
>> [{total_limit,924},{total_used,4},{sockets_limit,829},{sockets_used,2}]},
>>   {processes,[{limit,1048576},{used,181}]},
>>   {run_queue,0},
>>   {uptime,358}]
>> ...done.
>>
>> C:\Program Files (x86)\RabbitMQ
>> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.ba
>> t -n rabbit-2 cluster rabbit-1
>> Clustering node 'rabbit-2 at Gigi' with ['rabbit-1'] ...
>> Error: {no_running_cluster_nodes,['rabbit-1'],['rabbit-1']}
>>
>> C:\Program Files (x86)\RabbitMQ
>> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.ba
>> t -n rabbit-2 cluster rabbit-1 at GIGI
>> Clustering node 'rabbit-2 at Gigi' with ['rabbit-1 at GIGI'] ...
>> Error: {no_running_cluster_nodes,['rabbit-1 at GIGI'],['rabbit-1 at GIGI']}
>>
>> C:\Program Files (x86)\RabbitMQ
>> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.bat -n rabbit-1 cluster_status
>> Cluster status of node 'rabbit-1 at Gigi' ...
>> [{nodes,[{disc,['rabbit-1 at Gigi']}]},{running_nodes,['rabbit-1 at Gigi']}]
>> ...done.
>>
>>
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


From ishwor.gurung at gmail.com  Sun May 20 02:44:33 2012
From: ishwor.gurung at gmail.com (Ishwor Gurung)
Date: Sun, 20 May 2012 11:44:33 +1000
Subject: [rabbitmq-discuss] Can't cluster nodes on a single machine
In-Reply-To: <4FB84099.5010900@roblox.com>
References: <4FB828F5.3080403@roblox.com> <4FB830F9.40003@roblox.com>
	<CADU4sb_qBCMY6323=c=OYT6vT_NT4wfb_Oa25K0n668bs80Kzg@mail.gmail.com>
	<4FB84099.5010900@roblox.com>
Message-ID: <CADU4sb-G=au=+hFJ72OoFKJAxojpJ+0UbRPX2rPAdH3oBpcXPw@mail.gmail.com>

On 20 May 2012 10:53, Gigi <gigi at roblox.com> wrote:
> Ishwor, thanks for the quick response. The fab file you suggested helps
> setting up a cluster on different machines where each node is named
> "rabbit". My question is about a cluster running two RabbitMQ nodes on the
> same machine with custom node names. I'm following the same sequence of
> commands (stop_app, reset, cluster, start_app), but the cluster step fails
> to find the other node.
Ahh I see. No worries.
This was discussed a while ago for a 3 node cluster setup -
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/019881.html

Cheers

> Gigi
>
>
> On 5/19/2012 5:39 PM, Ishwor Gurung wrote:
>>
>> On 20 May 2012 09:47, Gigi<gigi at roblox.com> ?wrote:
>>>
>>> I have two detached nodes called rabbit-1 and rabbit-2 ?running on port
>>> 5672
>>> and 5673. I follow the transcript for clustering and verified that
>>> rabbit-1
>>> is running (via the status command) but when the cluster command fails
>>> complaining that rabbit-1 is not running. I tried to cluster both to
>>> rabbit-1 and rabbit-1 at GIGI (the host name). I even ran cluster_status on
>>> rabbit-1 and it says it's running just fine as a disc node (clustered to
>>> itself). Can anyone point out what am I doing wrong?
>>>
>>> The setup is a Windows 7 laptop, Erlang 15B, RabbitMQ 2.8.2 with the
>>> management plugin. The start command sets the RABBITMQ_SERVER_START_ARGS
>>> so
>>> the management plugin for each node listens on a different port (55672
>>> and
>>> 55673) .
>>
>> Try this fab https://github.com/ishwor/stuffs/blob/master/rabbitfab.py
>>
>>> Thanks, Gigi
>>>
>>> Here is the session:
>>>
>>> C:\Program Files (x86)\RabbitMQ
>>> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.bat -n rabbit-2 stop_app
>>> Stopping node 'rabbit-2 at Gigi' ...
>>> ...done.
>>>
>>> C:\Program Files (x86)\RabbitMQ
>>> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.ba
>>> t -n rabbit-2 reset
>>> Resetting node 'rabbit-2 at Gigi' ...
>>> ...done.
>>>
>>> C:\Program Files (x86)\RabbitMQ
>>> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.bat -n rabbit-1 status
>>> Status of node 'rabbit-1 at Gigi' ...
>>> [{pid,12988},
>>> ?{running_applications,
>>> ? ? [{rabbitmq_management,"RabbitMQ Management Console","2.8.2"},
>>> ? ? ?{xmerl,"XML parser","1.3"},
>>> ? ? ?{rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.2"},
>>> ? ? ?{amqp_client,"RabbitMQ AMQP Client","2.8.2"},
>>> ? ? ?{rabbit,"RabbitMQ","2.8.2"},
>>> ? ? ?{os_mon,"CPO ?CXC 138 46","2.2.8"},
>>> ? ? ?{sasl,"SASL ?CXC 138 11","2.2"},
>>> ? ? ?{rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.2"},
>>> ? ? ?{webmachine,"webmachine","1.7.0-rmq2.8.2-hg"},
>>> ? ? ?{mochiweb,"MochiMedia Web Server","1.3-rmq2.8.2-git"},
>>> ? ? ?{inets,"INETS ?CXC 138 49","5.8"},
>>> ? ? ?{mnesia,"MNESIA ?CXC 138 12","4.6"},
>>> ? ? ?{stdlib,"ERTS ?CXC 138 10","1.18"},
>>> ? ? ?{kernel,"ERTS ?CXC 138 10","2.15"}]},
>>> ?{os,{win32,nt}},
>>> ?{erlang_version,"Erlang R15B (erts-5.9) [smp:8:8]
>>> [async-threads:30]\n"},
>>> ?{memory,
>>> ? ? [{total,19502880},
>>> ? ? ?{processes,6062447},
>>> ? ? ?{processes_used,6062432},
>>> ? ? ?{system,13440433},
>>> ? ? ?{atom,495069},
>>> ? ? ?{atom_used,485111},
>>> ? ? ?{binary,82512},
>>> ? ? ?{code,9611946},
>>> ? ? ?{ets,625740}]},
>>> ?{vm_memory_high_watermark,0.10147532588839969},
>>> ?{vm_memory_limit,858993459},
>>> ?{disk_free_limit,8465047552},
>>> ?{disk_free,58608041984},
>>> ?{file_descriptors,
>>>
>>> [{total_limit,924},{total_used,4},{sockets_limit,829},{sockets_used,2}]},
>>> ?{processes,[{limit,1048576},{used,181}]},
>>> ?{run_queue,0},
>>> ?{uptime,358}]
>>> ...done.
>>>
>>> C:\Program Files (x86)\RabbitMQ
>>> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.ba
>>> t -n rabbit-2 cluster rabbit-1
>>> Clustering node 'rabbit-2 at Gigi' with ['rabbit-1'] ...
>>> Error: {no_running_cluster_nodes,['rabbit-1'],['rabbit-1']}
>>>
>>> C:\Program Files (x86)\RabbitMQ
>>> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.ba
>>> t -n rabbit-2 cluster rabbit-1 at GIGI
>>> Clustering node 'rabbit-2 at Gigi' with ['rabbit-1 at GIGI'] ...
>>> Error: {no_running_cluster_nodes,['rabbit-1 at GIGI'],['rabbit-1 at GIGI']}
>>>
>>> C:\Program Files (x86)\RabbitMQ
>>> Server\rabbitmq_server-2.8.2\sbin>rabbitmqctl.bat -n rabbit-1
>>> cluster_status
>>> Cluster status of node 'rabbit-1 at Gigi' ...
>>> [{nodes,[{disc,['rabbit-1 at Gigi']}]},{running_nodes,['rabbit-1 at Gigi']}]
>>> ...done.
>>>
>>>
>>>
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
Best regards,
Ishwor

From markiyan.kushnir at gmail.com  Sun May 20 08:08:42 2012
From: markiyan.kushnir at gmail.com (Markiyan Kushnir)
Date: Sun, 20 May 2012 10:08:42 +0300
Subject: [rabbitmq-discuss] Cluster unresponsive after some stop/start of a
	node.
Message-ID: <4FB8987A.5060702@gmail.com>

Here is my setup:

   rabbit at qwe is at 10.0.0.1 (initially the master)
   rabbit at asd is at 10.0.0.2 (initially a slave)

asd has joined the cluster with qwe -- OK.

In my tests I need to stop/start a cluster node -- qwe, which is a
master for my test queues. I use /usr/sbin/rabbitmqctl {stop|start}_app
for it -- everything is OK.

In order to test slave promotion, I first stop the master (qwe), then
after some time I start it, so that it now becomes a slave.

At the end of the test I stop asd, then start it, so that qwe takes
queues mastership back over.

During my test, the cluster serves two clients: a message producer and
a message consumer, running some low rate communication through the 
slave node (asd).


Now after a couple of tests, when attempting to do start_app on asd, I
get (after some pause):

Starting node 'rabbit at asd' ...
Error: {cannot_start_application,rabbit,
            {bad_return,
                {{rabbit,start,[normal,[]]},
                 {'EXIT',{rabbit,failure_during_boot}}}}}



cluster_status on qwe says:

Cluster status of node 'rabbit at qwe' ...
[{nodes,[{disc,['rabbit at qwe']},{ram,['rabbit at asd']}]},
  {running_nodes,['rabbit at qwe']}]
...done.


And cluster_status on asd says:

Cluster status of node 'rabbit at asd' ...
[{nodes,[{unknown,['rabbit at asd']}]},{running_nodes,[]}]
...done.

Now I want to remove asd from the cluster... An attempt to run
stop_app/reset on asd gives (after some pause as well):

Resetting node 'rabbit at asd' ...
Error: {timeout_waiting_for_tables,[gm_group]}


In this situation I can only throw the entire cluster away and create
a new one...

How can I recover from this situation?


Thanks,
Markiyan.

From markiyan.kushnir at gmail.com  Sun May 20 08:15:11 2012
From: markiyan.kushnir at gmail.com (Markiyan Kushnir)
Date: Sun, 20 May 2012 10:15:11 +0300
Subject: [rabbitmq-discuss] Cluster unresponsive after some stop/start
	of a node.
In-Reply-To: <4FB8987A.5060702@gmail.com>
References: <4FB8987A.5060702@gmail.com>
Message-ID: <4FB899FF.8090706@gmail.com>

On 20.05.2012 10:08, Markiyan Kushnir wrote:
> Here is my setup:
>
> rabbit at qwe is at 10.0.0.1 (initially the master)
> rabbit at asd is at 10.0.0.2 (initially a slave)
>
> asd has joined the cluster with qwe -- OK.
>
> In my tests I need to stop/start a cluster node -- qwe, which is a
> master for my test queues. I use /usr/sbin/rabbitmqctl {stop|start}_app
> for it -- everything is OK.
>
> In order to test slave promotion, I first stop the master (qwe), then
> after some time I start it, so that it now becomes a slave.
>
> At the end of the test I stop asd, then start it, so that qwe takes
> queues mastership back over.
>
> During my test, the cluster serves two clients: a message producer and
> a message consumer, running some low rate communication through the
> slave node (asd).
>


Forgot to clarify: I use mirrored queues, and my "consuming" client 
supports the Consumer Cancellation Notifications extension.

--
Markiyan


>
> Now after a couple of tests, when attempting to do start_app on asd, I
> get (after some pause):
>
> Starting node 'rabbit at asd' ...
> Error: {cannot_start_application,rabbit,
> {bad_return,
> {{rabbit,start,[normal,[]]},
> {'EXIT',{rabbit,failure_during_boot}}}}}
>
>
>
> cluster_status on qwe says:
>
> Cluster status of node 'rabbit at qwe' ...
> [{nodes,[{disc,['rabbit at qwe']},{ram,['rabbit at asd']}]},
> {running_nodes,['rabbit at qwe']}]
> ...done.
>
>
> And cluster_status on asd says:
>
> Cluster status of node 'rabbit at asd' ...
> [{nodes,[{unknown,['rabbit at asd']}]},{running_nodes,[]}]
> ...done.
>
> Now I want to remove asd from the cluster... An attempt to run
> stop_app/reset on asd gives (after some pause as well):
>
> Resetting node 'rabbit at asd' ...
> Error: {timeout_waiting_for_tables,[gm_group]}
>
>
> In this situation I can only throw the entire cluster away and create
> a new one...
>
> How can I recover from this situation?
>
>
> Thanks,
> Markiyan.


From francesco at rabbitmq.com  Sun May 20 11:09:18 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Sun, 20 May 2012 11:09:18 +0100
Subject: [rabbitmq-discuss] Cluster unresponsive after some stop/start
 of a node.
In-Reply-To: <4FB8987A.5060702@gmail.com>
References: <4FB8987A.5060702@gmail.com>
Message-ID: <4FB8C2CE.3040109@rabbitmq.com>

Hi Markiyan,

It's hard to tell what happened without any logs, but I'm going to bet 
that you tried to start asd while qwe was down. Since asd is a RAM node, 
and we don't like standalone RAM nodes, the boot sequence failed.

If that's not the problem, please provide more precise instruction on 
how to reproduce the problem (if you can reproduce it).

Francesco.

On 20/05/12 08:08, Markiyan Kushnir wrote:
> Here is my setup:
>
> rabbit at qwe is at 10.0.0.1 (initially the master)
> rabbit at asd is at 10.0.0.2 (initially a slave)
>
> asd has joined the cluster with qwe -- OK.
>
> In my tests I need to stop/start a cluster node -- qwe, which is a
> master for my test queues. I use /usr/sbin/rabbitmqctl {stop|start}_app
> for it -- everything is OK.
>
> In order to test slave promotion, I first stop the master (qwe), then
> after some time I start it, so that it now becomes a slave.
>
> At the end of the test I stop asd, then start it, so that qwe takes
> queues mastership back over.
>
> During my test, the cluster serves two clients: a message producer and
> a message consumer, running some low rate communication through the
> slave node (asd).
>
>
> Now after a couple of tests, when attempting to do start_app on asd, I
> get (after some pause):
>
> Starting node 'rabbit at asd' ...
> Error: {cannot_start_application,rabbit,
> {bad_return,
> {{rabbit,start,[normal,[]]},
> {'EXIT',{rabbit,failure_during_boot}}}}}
>
>
>
> cluster_status on qwe says:
>
> Cluster status of node 'rabbit at qwe' ...
> [{nodes,[{disc,['rabbit at qwe']},{ram,['rabbit at asd']}]},
> {running_nodes,['rabbit at qwe']}]
> ...done.
>
>
> And cluster_status on asd says:
>
> Cluster status of node 'rabbit at asd' ...
> [{nodes,[{unknown,['rabbit at asd']}]},{running_nodes,[]}]
> ...done.
>
> Now I want to remove asd from the cluster... An attempt to run
> stop_app/reset on asd gives (after some pause as well):
>
> Resetting node 'rabbit at asd' ...
> Error: {timeout_waiting_for_tables,[gm_group]}
>
>
> In this situation I can only throw the entire cluster away and create
> a new one...
>
> How can I recover from this situation?
>
>
> Thanks,
> Markiyan.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From francesco at rabbitmq.com  Sun May 20 11:11:56 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Sun, 20 May 2012 11:11:56 +0100
Subject: [rabbitmq-discuss] Cluster unresponsive after some stop/start
 of a node.
In-Reply-To: <4FB8C2CE.3040109@rabbitmq.com>
References: <4FB8987A.5060702@gmail.com> <4FB8C2CE.3040109@rabbitmq.com>
Message-ID: <4FB8C36C.8010304@rabbitmq.com>

Oh, I forgot to give a solution to your problem (if you are actually 
trying to start a standalone RAM node): start the disc node first and 
then the RAM node.

Francesco.

On 20/05/12 11:09, Francesco Mazzoli wrote:
> Hi Markiyan,
>
> It's hard to tell what happened without any logs, but I'm going to bet
> that you tried to start asd while qwe was down. Since asd is a RAM node,
> and we don't like standalone RAM nodes, the boot sequence failed.
>
> If that's not the problem, please provide more precise instruction on
> how to reproduce the problem (if you can reproduce it).
>
> Francesco.
>
> On 20/05/12 08:08, Markiyan Kushnir wrote:
>> Here is my setup:
>>
>> rabbit at qwe is at 10.0.0.1 (initially the master)
>> rabbit at asd is at 10.0.0.2 (initially a slave)
>>
>> asd has joined the cluster with qwe -- OK.
>>
>> In my tests I need to stop/start a cluster node -- qwe, which is a
>> master for my test queues. I use /usr/sbin/rabbitmqctl {stop|start}_app
>> for it -- everything is OK.
>>
>> In order to test slave promotion, I first stop the master (qwe), then
>> after some time I start it, so that it now becomes a slave.
>>
>> At the end of the test I stop asd, then start it, so that qwe takes
>> queues mastership back over.
>>
>> During my test, the cluster serves two clients: a message producer and
>> a message consumer, running some low rate communication through the
>> slave node (asd).
>>
>>
>> Now after a couple of tests, when attempting to do start_app on asd, I
>> get (after some pause):
>>
>> Starting node 'rabbit at asd' ...
>> Error: {cannot_start_application,rabbit,
>> {bad_return,
>> {{rabbit,start,[normal,[]]},
>> {'EXIT',{rabbit,failure_during_boot}}}}}
>>
>>
>>
>> cluster_status on qwe says:
>>
>> Cluster status of node 'rabbit at qwe' ...
>> [{nodes,[{disc,['rabbit at qwe']},{ram,['rabbit at asd']}]},
>> {running_nodes,['rabbit at qwe']}]
>> ...done.
>>
>>
>> And cluster_status on asd says:
>>
>> Cluster status of node 'rabbit at asd' ...
>> [{nodes,[{unknown,['rabbit at asd']}]},{running_nodes,[]}]
>> ...done.
>>
>> Now I want to remove asd from the cluster... An attempt to run
>> stop_app/reset on asd gives (after some pause as well):
>>
>> Resetting node 'rabbit at asd' ...
>> Error: {timeout_waiting_for_tables,[gm_group]}
>>
>>
>> In this situation I can only throw the entire cluster away and create
>> a new one...
>>
>> How can I recover from this situation?
>>
>>
>> Thanks,
>> Markiyan.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From bino at indoakses-online.com  Mon May 21 04:20:49 2012
From: bino at indoakses-online.com (bino oetomo)
Date: Mon, 21 May 2012 10:20:49 +0700
Subject: [rabbitmq-discuss] is mine normal, fast, or lame ?
Message-ID: <4FB9B491.20308@indoakses-online.com>

Dear all.
I do a performance test.

1. engine1 :
RabbitMQ server with 5 shovel.
This 5 shovel have different name , but other config is identical.
2. engine2 :
Remote located RabbitMQ

Connection engine1<<====>>engine2 : 1mbps clear

The test :
1. I stop rabbitMQ at engine2
2. Load 800000 line of msg , average of 250 character per msg
3. When it done , I start RabbitMQ at engine2 .... and put my eyes at 
it's management web UI.

Result :
1. engine1 : 'Acknowledge' box best rate is only 47 msg/s
2. engine2: the 'Ready' box always said between 350-400 msg/s

Is that normal, fast, or lame ?

will that any effect on running multiple shovel with identical config ?

Sincerely
-bino-

From aluenkinglee at gmail.com  Mon May 21 08:25:00 2012
From: aluenkinglee at gmail.com (King Lee)
Date: Mon, 21 May 2012 15:25:00 +0800
Subject: [rabbitmq-discuss] Can rabbitMQ publish an object to the queue?
In-Reply-To: <4FB0E02B.2010507@rabbitmq.com>
References: <13083543.16.1336815841857.JavaMail.geo-discussion-forums@ynz24>
	<4FB0E02B.2010507@rabbitmq.com>
Message-ID: <CALHM7cqCyJkK_ye5gVb6uUeUZOVwy+13inA=A3CwhQPfx7tqmA@mail.gmail.com>

Thanks,I did it as you said and that goes well :)

Aluen

2012/5/14 Simon MacMullen <simon at rabbitmq.com>

> On 12/05/12 10:44, aluen wrote:
>
>> the underline words is what I want to ask,how to  deal with it , can I
>> put an object to the queue because I hope to do like this ,do you have
>> other method? Thanks!!
>>
>
> Hi Aluen. RabbitMQ treats message bodies as opaque binary data. If you
> want to send objects you'll need to serialise them - if you're only using
> Python you could pickle the objects. Otherwise you would need to write out
> JSON or XML or similar.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/0de31749/attachment.htm>

From markiyan.kushnir at gmail.com  Mon May 21 10:13:07 2012
From: markiyan.kushnir at gmail.com (Markiyan Kushnir)
Date: Mon, 21 May 2012 12:13:07 +0300
Subject: [rabbitmq-discuss] Cluster unresponsive after some stop/start
 of a node.
In-Reply-To: <4FB8C36C.8010304@rabbitmq.com>
References: <4FB8987A.5060702@gmail.com> <4FB8C2CE.3040109@rabbitmq.com>
	<4FB8C36C.8010304@rabbitmq.com>
Message-ID: <CACvtUJdX9yzY4qdVCVziBwrLhq+SMdKti46F0Cy=qcUSB0=sbw@mail.gmail.com>

2012/5/20 Francesco Mazzoli <francesco at rabbitmq.com>:
> Oh, I forgot to give a solution to your problem (if you are actually trying
> to start a standalone RAM node): start the disc node first and then the RAM
> node.
>
> Francesco.
>
>
> On 20/05/12 11:09, Francesco Mazzoli wrote:
>>
>> Hi Markiyan,
>>
>> It's hard to tell what happened without any logs, but I'm going to bet
>> that you tried to start asd while qwe was down. Since asd is a RAM node,
>> and we don't like standalone RAM nodes, the boot sequence failed.
>>
>> If that's not the problem, please provide more precise instruction on
>> how to reproduce the problem (if you can reproduce it).
>>
>> Francesco.
>>

Hello Francesco,

I'm attaching full logs from qwe (qwe.tgz) and asd (asd.tgz) of a
minimal test case.

Test.

1. Both qwe and asd are up and running, serving clients.
2. In the middle of qwe (master) accepting messages do stop_app on qwe.
3. Wait until asd is promoted, then start_app on qwe.
4. Do stop_app on asd.
5. Wait, do start_app on asd. qwe is now the master back.
6. Repeat 2,3,4,5 again. See "ERROR REPORT" (rabbit\@asd.log) on asd.

Clients.

Two of of my clients are based on rabbitmqadmin.txt to publish
"commands" and read "replies" (infrastuture). Another one is Python
based, which both consumes "commands" and publishes "replies" (target
app). The target app handles basic.cancel coming as a result of slave
promotion, and re-issues its basic.consume (support of consumer
cancellation notifications). When the connection to a node is lost due
to stop_app, the target app tries to re-connect to another node.



On your comment on standalone RAM nodes, to be presice, asd (which is
really a RAM node) may be left running standalone for some time while
qwe is doing stop_app/start_app cycle. In my test, both qwe and asd
are never down at the same time.

Please letme know if there is anything else that might help.

Thanks,
Markiyan.



>> On 20/05/12 08:08, Markiyan Kushnir wrote:
>>>
>>> Here is my setup:
>>>
>>> rabbit at qwe is at 10.0.0.1 (initially the master)
>>> rabbit at asd is at 10.0.0.2 (initially a slave)
>>>
>>> asd has joined the cluster with qwe -- OK.
>>>
>>> In my tests I need to stop/start a cluster node -- qwe, which is a
>>> master for my test queues. I use /usr/sbin/rabbitmqctl {stop|start}_app
>>> for it -- everything is OK.
>>>
>>> In order to test slave promotion, I first stop the master (qwe), then
>>> after some time I start it, so that it now becomes a slave.
>>>
>>> At the end of the test I stop asd, then start it, so that qwe takes
>>> queues mastership back over.
>>>
>>> During my test, the cluster serves two clients: a message producer and
>>> a message consumer, running some low rate communication through the
>>> slave node (asd).
>>>
>>>
>>> Now after a couple of tests, when attempting to do start_app on asd, I
>>> get (after some pause):
>>>
>>> Starting node 'rabbit at asd' ...
>>> Error: {cannot_start_application,rabbit,
>>> {bad_return,
>>> {{rabbit,start,[normal,[]]},
>>> {'EXIT',{rabbit,failure_during_boot}}}}}
>>>
>>>
>>>
>>> cluster_status on qwe says:
>>>
>>> Cluster status of node 'rabbit at qwe' ...
>>> [{nodes,[{disc,['rabbit at qwe']},{ram,['rabbit at asd']}]},
>>> {running_nodes,['rabbit at qwe']}]
>>> ...done.
>>>
>>>
>>> And cluster_status on asd says:
>>>
>>> Cluster status of node 'rabbit at asd' ...
>>> [{nodes,[{unknown,['rabbit at asd']}]},{running_nodes,[]}]
>>> ...done.
>>>
>>> Now I want to remove asd from the cluster... An attempt to run
>>> stop_app/reset on asd gives (after some pause as well):
>>>
>>> Resetting node 'rabbit at asd' ...
>>> Error: {timeout_waiting_for_tables,[gm_group]}
>>>
>>>
>>> In this situation I can only throw the entire cluster away and create
>>> a new one...
>>>
>>> How can I recover from this situation?
>>>
>>>
>>> Thanks,
>>> Markiyan.
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: asd.tgz
Type: application/x-gzip
Size: 3471 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/7049b83c/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: qwe.tgz
Type: application/x-gzip
Size: 2503 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/7049b83c/attachment-0001.bin>

From markiyan.kushnir at gmail.com  Mon May 21 10:20:36 2012
From: markiyan.kushnir at gmail.com (Markiyan Kushnir)
Date: Mon, 21 May 2012 12:20:36 +0300
Subject: [rabbitmq-discuss] Cluster unresponsive after some stop/start
 of a node.
In-Reply-To: <CACvtUJdX9yzY4qdVCVziBwrLhq+SMdKti46F0Cy=qcUSB0=sbw@mail.gmail.com>
References: <4FB8987A.5060702@gmail.com> <4FB8C2CE.3040109@rabbitmq.com>
	<4FB8C36C.8010304@rabbitmq.com>
	<CACvtUJdX9yzY4qdVCVziBwrLhq+SMdKti46F0Cy=qcUSB0=sbw@mail.gmail.com>
Message-ID: <CACvtUJcfVzOcnOE1joNbhhU=dK-2isy2uxDRwUf16Ba793M7Ow@mail.gmail.com>

2012/5/21 Markiyan Kushnir <markiyan.kushnir at gmail.com>:
> 2012/5/20 Francesco Mazzoli <francesco at rabbitmq.com>:
>> Oh, I forgot to give a solution to your problem (if you are actually trying
>> to start a standalone RAM node): start the disc node first and then the RAM
>> node.
>>
>> Francesco.
>>
>>
>> On 20/05/12 11:09, Francesco Mazzoli wrote:
>>>
>>> Hi Markiyan,
>>>
>>> It's hard to tell what happened without any logs, but I'm going to bet
>>> that you tried to start asd while qwe was down. Since asd is a RAM node,
>>> and we don't like standalone RAM nodes, the boot sequence failed.
>>>
>>> If that's not the problem, please provide more precise instruction on
>>> how to reproduce the problem (if you can reproduce it).
>>>
>>> Francesco.
>>>
>
> Hello Francesco,
>
> I'm attaching full logs from qwe (qwe.tgz) and asd (asd.tgz) of a
> minimal test case.
>
> Test.
>
> 1. Both qwe and asd are up and running, serving clients.
> 2. In the middle of qwe (master) accepting messages do stop_app on qwe.
> 3. Wait until asd is promoted, then start_app on qwe.
> 4. Do stop_app on asd.
> 5. Wait, do start_app on asd. qwe is now the master back.
> 6. Repeat 2,3,4,5 again. See "ERROR REPORT" (rabbit\@asd.log) on asd.
>
> Clients.
>
> Two of of my clients are based on rabbitmqadmin.txt to publish
> "commands" and read "replies" (infrastuture). Another one is Python
> based, which both consumes "commands" and publishes "replies" (target
> app). The target app handles basic.cancel coming as a result of slave
> promotion, and re-issues its basic.consume (support of consumer
> cancellation notifications). When the connection to a node is lost due
> to stop_app, the target app tries to re-connect to another node.
>
>
>
> On your comment on standalone RAM nodes, to be presice, asd (which is
> really a RAM node) may be left running standalone for some time while
> qwe is doing stop_app/start_app cycle. In my test, both qwe and asd
> are never down at the same time.
>
> Please letme know if there is anything else that might help.
>

Forgot to mention that qwe was actually listening on port 57524 all
the time (this might be relevant to the issue).


Markiyan.


> Thanks,
> Markiyan.
>
>
>
>>> On 20/05/12 08:08, Markiyan Kushnir wrote:
>>>>
>>>> Here is my setup:
>>>>
>>>> rabbit at qwe is at 10.0.0.1 (initially the master)
>>>> rabbit at asd is at 10.0.0.2 (initially a slave)
>>>>
>>>> asd has joined the cluster with qwe -- OK.
>>>>
>>>> In my tests I need to stop/start a cluster node -- qwe, which is a
>>>> master for my test queues. I use /usr/sbin/rabbitmqctl {stop|start}_app
>>>> for it -- everything is OK.
>>>>
>>>> In order to test slave promotion, I first stop the master (qwe), then
>>>> after some time I start it, so that it now becomes a slave.
>>>>
>>>> At the end of the test I stop asd, then start it, so that qwe takes
>>>> queues mastership back over.
>>>>
>>>> During my test, the cluster serves two clients: a message producer and
>>>> a message consumer, running some low rate communication through the
>>>> slave node (asd).
>>>>
>>>>
>>>> Now after a couple of tests, when attempting to do start_app on asd, I
>>>> get (after some pause):
>>>>
>>>> Starting node 'rabbit at asd' ...
>>>> Error: {cannot_start_application,rabbit,
>>>> {bad_return,
>>>> {{rabbit,start,[normal,[]]},
>>>> {'EXIT',{rabbit,failure_during_boot}}}}}
>>>>
>>>>
>>>>
>>>> cluster_status on qwe says:
>>>>
>>>> Cluster status of node 'rabbit at qwe' ...
>>>> [{nodes,[{disc,['rabbit at qwe']},{ram,['rabbit at asd']}]},
>>>> {running_nodes,['rabbit at qwe']}]
>>>> ...done.
>>>>
>>>>
>>>> And cluster_status on asd says:
>>>>
>>>> Cluster status of node 'rabbit at asd' ...
>>>> [{nodes,[{unknown,['rabbit at asd']}]},{running_nodes,[]}]
>>>> ...done.
>>>>
>>>> Now I want to remove asd from the cluster... An attempt to run
>>>> stop_app/reset on asd gives (after some pause as well):
>>>>
>>>> Resetting node 'rabbit at asd' ...
>>>> Error: {timeout_waiting_for_tables,[gm_group]}
>>>>
>>>>
>>>> In this situation I can only throw the entire cluster away and create
>>>> a new one...
>>>>
>>>> How can I recover from this situation?
>>>>
>>>>
>>>> Thanks,
>>>> Markiyan.
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>

From tim at rabbitmq.com  Mon May 21 10:37:25 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 21 May 2012 10:37:25 +0100
Subject: [rabbitmq-discuss] Error: Can't set short node name! Please
 check your configuration
In-Reply-To: <E1SUyJf-0005cv-Na.deil_87-mail-ru@f117.mail.ru>
References: <E1SUyJf-0005cv-Na.deil_87-mail-ru@f117.mail.ru>
Message-ID: <4FBA0CD5.9010705@rabbitmq.com>

On 17/05/2012 11:52, ?????? ?????????? wrote:
> "Let us know what you were trying to do, the error you received and relevant entries from the logfile and one of our engineers will help you get it fixed."
>
> OS: Windows 7
>
> I was trying next command:
>
>> rabbitmqctl status
>
> error:
> {error_logger,{{2012,5,17},{14,39,42}},"Can't set short node name!\nPlease check your configuration\n",[]}
> {error_logger,{{2012,5,17},{14,39,42}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.16.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,220}],[]]}
> {error_logger,{{2012,5,17},{14,39,42}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqctl15024,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2012,5,17},{14,39,42}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2012,5,17},{14,39,42}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>
>
> where I can set node name and how? How can I check my configuration? Thank us in advance!

Hi there. The node name is set by the scripts rabbitmq-server and 
rabbitmqctl.

Erlang has two kinds of node name, short names (passed as -sname <name> 
to the emulator) and long names (pass as -name <name>). Short names must 
not contain the full hostname, whereas long names do. For example here 
is one short and one long name:

$ erl -sname myserver
$ erl -name myserver.mydomain.com

By default, rabbit uses the 'shortnames' scheme. The actual name that a 
node uses is governed by the environment variable RABBITMQ_NODE_NAME, 
and by default this will be set to 'rabbit'.

Both the scripts need to use the same naming scheme. If you're using the 
default (short) naming scheme, then your node names must not contain the 
domain part, just the 'short' hostname as evidenced via `hostname -s` or 
equivalent.

HTH

>
>
> PS
>> rabbitmq-service start
> works fine. Output: Service RabbitMQ started.
>
> but when I'm trying to start rabbit as a server... then I get the same error:


From matthias at rabbitmq.com  Mon May 21 10:41:34 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 21 May 2012 10:41:34 +0100
Subject: [rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
In-Reply-To: <4FB6888F.6050904@gmail.com>
References: <4FABE167.9080900@gmail.com> <4FABE7B9.5010509@rabbitmq.com>
	<4FB15399.9090504@gmail.com> <4FB34F38.2080507@rabbitmq.com>
	<4FB6888F.6050904@gmail.com>
Message-ID: <4FBA0DCE.1080705@rabbitmq.com>

Paul,

On 18/05/12 18:36, Paul Gross wrote:
> This server is running a build, which creates and deletes a couple of
> queues. It's possible that these creates/deletes are happening at the
> same time. Could this cause the observed behavior?

No, that shouldn't be a problem.

> The beam.smp process is definitely going nuts. Here's the output from ps
> aufx:
>
> rabbitmq 26472 0.0 0.0 4144 0 ? S May14 0:00 /bin/sh
> /usr/sbin/rabbitmq-server
> rabbitmq 26490 184 82.4 2367176 837356 ? Sl May14 9852:39 \_
> /usr/lib/erlang/erts-5.9.1/bin/beam.smp -W w -K true -A30 -P 1048576 --
> -root /usr/lib/erlang -progname erl -- -
> rabbitmq 26605 0.0 0.0 10776 0 ? Ss May14 0:00 \_ inet_gethost 4
> rabbitmq 26606 0.0 0.0 12876 36 ? S May14 0:00 \_ inet_gethost 4
>
> As you can see, beam.smp is using 184% CPU and 82.4% of memory on this
> server (4 cores, 1GB RAM).
>
> Unfortunately, by the time I was able to ssh into the server to run
> rabbitmqctl report, it said nodedown.

That's a shame. Would be really good to catch it early enough to still 
get some useful output from rabbitmqctl.

> Cluster status of node 'rabbit at bt-ci-rabbitmq' ...
> [{nodes,[{disc,['rabbit at bt-ci-rabbitmq']}]},
> {running_nodes,['rabbit at bt-ci-rabbitmq']}]

> <'rabbit at bt-ci-rabbitmq'.2.186.0>
> webhook_worker_master-testing_notifications true false
> [{"x-ha-policy","all"}]

Hmm. You have HA queues but only a single node. Is that intentional? 
While that shouldn't cause any problems, a) it is far less efficient 
than using non-HA queues in that situation, and b) single-node HA queues 
are not as well tested as their multi-node cousins.

Regards,

Matthias.

From mrtnlstr at gmail.com  Sun May 20 19:07:26 2012
From: mrtnlstr at gmail.com (mrtn)
Date: Sun, 20 May 2012 11:07:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Why Celery?
Message-ID: <48885471-5a02-4125-9e93-894dbf0631e6@googlegroups.com>


I finished reading through the rabbitmq tutorials here<http://www.rabbitmq.com/getstarted.html>, 
and later found out people very often associate celery with rabbitmq.


From codevally.mail.list at gmail.com  Mon May 21 01:18:45 2012
From: codevally.mail.list at gmail.com (Roshan Pradeep)
Date: Sun, 20 May 2012 17:18:45 -0700 (PDT)
Subject: [rabbitmq-discuss] Disk space monitoring watermark issue on
 2.8.2
In-Reply-To: <CAHZsVQYcv_950eBmGif__izn59j7JZ3zROFnLwBpJjC_AeQTAA@mail.gmail.com>
References: <b2672528-4ac4-4cad-8a45-909d74ad8236@googlegroups.com>
	<7c13bc88-6999-4f0d-8f35-c5f616aed5dd@googlegroups.com>
	<CAHZsVQYcv_950eBmGif__izn59j7JZ3zROFnLwBpJjC_AeQTAA@mail.gmail.com>
Message-ID: <e3487fa7-08eb-48fb-ad38-64325eca2625@googlegroups.com>

Thanks Brenden for your explanations. But whats the reason behind to 
introduce this kind of RabbitMQ space notification.

Currently we use the RabbitMQ to push and get messages. With that flow, 
when someone push a message to a queue there is always an receiver setup to 
pick it. So we are not storing messages (but if the receiver is not 
functioning obvious we need to store the messages). All our queues 
are durable. 

Hope you can understand my question. 

Thnaks

/Roshan

On Friday, May 18, 2012 7:45:59 PM UTC+10, Brendan Hay wrote:
>
> Hi Roshan,
>
> Please read about disk based flow control and the 'disk_free_limit' here: 
> http://www.rabbitmq.com/memory.html#diskfreesup
> http://www.rabbitmq.com/configure.html#config-items
>
> By default it is set to a relative value to your RAM. You can also specify 
> in bytes.
>
> Regarding your 2nd email, If you have haven't overrun the low water mark 
> for disk space, or the high water mark for memory, then Rabbit will be 
> throttling you based on the new flow control mechanism in >= 2.8.1, of 
> which there is a small amount of information at the top of this page: 
> http://www.rabbitmq.com/memory.html
>
> Basically, it sounds like you are publishing faster than rabbit can route 
> messages for that connection. (I'm sure someone else could verify that via 
> the warning message.)
>
> - Brendan
>
> On Fri, May 18, 2012 at 3:00 AM, Roshan Pradeep <
> codevally.mail.list at gmail.com> wrote:
>
>> In addition to the same issue, when I publishing high rate of messages, 
>> the yelllow box is on for the connection side and it says "Publishing rate 
>> recently restricted by server". 
>>
>> Anyone know why is that?
>>
>> /Roshan
>>
>>
>> On Friday, May 18, 2012 10:25:44 AM UTC+10, Roshan Pradeep wrote:
>>>
>>> Hi 
>>>
>>> Today I upgrade our local development RabbitMQ cluster to it's 2.8.2 new 
>>> version. After checking cluster through monitoring tool I noticed some red 
>>> boxes for diskspace watermark. I found this feature in the RabbitMQ 
>>> documentation and could someone please explain me how this feature really 
>>> works/importance in production environment. Because on my production it is 
>>> 2.7.1 installed.
>>>
>>> Many Thanks
>>>
>>> /Roshan  
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120520/d294524d/attachment.htm>

From rader.net at gmail.com  Mon May 21 08:13:09 2012
From: rader.net at gmail.com (Rader Lei)
Date: Mon, 21 May 2012 00:13:09 -0700 (PDT)
Subject: [rabbitmq-discuss] unable to join cluster - mnesia func aborted
Message-ID: <f60e2565-3189-4ccc-b5b5-b4f0a4d58193@googlegroups.com>

i have a cluster of 3 rabbimtmq servers on windows 2008 and 2003. they 
works fine. Then I set up a rabbitmq server on Ubuntu 11. when i try to add 
the new rabbitmq node into the cluster, i get an error - "unable to join 
the cluster". The log file looks fine, no error message. I can access the 
cluster master node with command "rabbitmqctl -n rabbit at CNCDS131 status". I 
have no idea why this error happen:( 


Here is the error:

leid at yud-vm:~$ sudo rabbitmqctl cluster rabbit at CNCDS131
Clustering node 'rabbit at yud-vm' with [rabbit at CNCDS131] ...
Error: {unable_to_join_cluster,
           [rabbit at CNCDS131],
           {aborted,
               {function_clause,
                   [{mnesia_schema,cs2list,
                        [{cstruct,schema,set,
                             [rabbit at STARS110,rabbit at CNCDS108],
                             [rabbit at CNCDS131],
                             [],0,read_write,false,[],[],false,schema,
                             [table,cstruct],
                             [],[],[],
                             {{1336,728415,425002},rabbit at CNCDS131},
                             {{24,0},
                              {rabbit at CNCDS131,{1337,582820,591922}}}}]},
                    {mnesia_schema,do_merge_schema,0},
                    {mnesia_tm,apply_fun,3},
                    {mnesia_tm,execute_transaction,5},
                    {mnesia_schema,schema_coordinator,3}]}}}

Here is the log:

> =INFO REPORT==== 21-May-2012::15:08:16 ===
> Clustering with [rabbit at CNCDS131]
>
> =INFO REPORT==== 21-May-2012::15:08:16 ===
>     application: mnesia
>     exited: stopped
>     type: temporary
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/faad510b/attachment.htm>

From matthias at rabbitmq.com  Mon May 21 10:57:59 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 21 May 2012 10:57:59 +0100
Subject: [rabbitmq-discuss] unable to join cluster - mnesia func aborted
In-Reply-To: <f60e2565-3189-4ccc-b5b5-b4f0a4d58193@googlegroups.com>
References: <f60e2565-3189-4ccc-b5b5-b4f0a4d58193@googlegroups.com>
Message-ID: <4FBA11A7.2030103@rabbitmq.com>

On 21/05/12 08:13, Rader Lei wrote:
> i have a cluster of 3 rabbimtmq servers on windows 2008 and 2003. they
> works fine. Then I set up a rabbitmq server on Ubuntu 11. when i try to
> add the new rabbitmq node into the cluster, i get an error - "unable to
> join the cluster". The log file looks fine, no error message. I can
> access the cluster master node with command "rabbitmqctl -n
> rabbit at CNCDS131 status". I have no idea why this error happen:(
>
>
> Here is the error:
>
>     leid at yud-vm:~$ sudo rabbitmqctl cluster rabbit at CNCDS131
>     Clustering node 'rabbit at yud-vm' with [rabbit at CNCDS131] ...
>     Error: {unable_to_join_cluster,
>     [rabbit at CNCDS131],
>     {aborted,
>     {function_clause,
>     [{mnesia_schema,cs2list,

http://old.nabble.com/Unable-to-cluster..-ts33843099.html

Matthias.

From emile at rabbitmq.com  Mon May 21 11:18:01 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 21 May 2012 11:18:01 +0100
Subject: [rabbitmq-discuss] Rabbitmq 2.8.2 with heartbeat/DRBD fail
In-Reply-To: <33864333.post@talk.nabble.com>
References: <d5f7b883-4012-4354-a638-71145e1facf6@ki5g2000pbb.googlegroups.com>
	<4FB4D31B.9060500@rabbitmq.com> <33864333.post@talk.nabble.com>
Message-ID: <4FBA1659.4070407@rabbitmq.com>

Hi,

On 17/05/12 14:55, askgax wrote:
> fsck 1.39 (29-May-2006)
> /dev/drbd1: clean, 442/2621440 files, 127224/5242683 blocks
> Filesystem[2991]:       2012/05/17_21:42:13 INFO:  Success
> INFO:  Success

> fsck 1.39 (29-May-2006)
> /dev/drbd1: clean, 863/10485760 files, 380283/20970783 blocks (check in 4
> mounts)
> Filesystem[9569]:       2012/05/17_18:09:31 INFO:  Success
> INFO:  Success

Are you expecting the sizes for these partitions to be different?

> so i'm confuse in the same environment setting,why rabbitmq 2.8.2 can't
> start with heartbeat takeover?

I don't see the "/etc/init.d/rabbitmq-server  start" line in the v2.8.2
version. Can you confirm whether anything is written to the broker
logfile at the time when it should be starting? I assume you are able to
start the broker manually?


-Emile



From emile at rabbitmq.com  Mon May 21 11:29:19 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 21 May 2012 11:29:19 +0100
Subject: [rabbitmq-discuss] Disk space monitoring watermark issue on
	2.8.2
In-Reply-To: <e3487fa7-08eb-48fb-ad38-64325eca2625@googlegroups.com>
References: <b2672528-4ac4-4cad-8a45-909d74ad8236@googlegroups.com>
	<7c13bc88-6999-4f0d-8f35-c5f616aed5dd@googlegroups.com>
	<CAHZsVQYcv_950eBmGif__izn59j7JZ3zROFnLwBpJjC_AeQTAA@mail.gmail.com>
	<e3487fa7-08eb-48fb-ad38-64325eca2625@googlegroups.com>
Message-ID: <4FBA18FF.9080704@rabbitmq.com>

Hi,

On 21/05/12 01:18, Roshan Pradeep wrote:
> Thanks Brenden for your explanations. But whats the reason behind to
> introduce this kind of RabbitMQ space notification.

To prevent the broker from crashing when it runs out of disk space.

> Currently we use the RabbitMQ to push and get messages. With that flow,
> when someone push a message to a queue there is always an receiver setup
> to pick it. So we are not storing messages (but if the receiver is not
> functioning obvious we need to store the messages). All our queues
> are durable.

Even if messages are not published persistent they may still be flushed
to disk if the broker comes under memory pressure.  If the default
configuration is too conservative for you then set the required free
space to a small number (e.g. 0).

See 'disk_free_limit' here:
http://www.rabbitmq.com/configure.html#configuration-file
http://www.rabbitmq.com/memory.html#diskfreesup


-Emile



From rui.favas at barclays.com  Mon May 21 11:44:11 2012
From: rui.favas at barclays.com (rui.favas at barclays.com)
Date: Mon, 21 May 2012 11:44:11 +0100
Subject: [rabbitmq-discuss] Highly Available Cluster
Message-ID: <1308E5CFD51CA14DA7B024A689B8B1680254E43211@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>

Unable to start single node on a cluster with two servers. I'm getting the error below if I try to start server1 when server2 is down:

BOOT FAILED
===========

Timeout contacting cluster nodes: [bcfs_bunny at server1].

I have the following cluster with two servers:-

Name

File descriptors (?)(used / available)

Socket descriptors (?)(used / available)

Erlang processes (used / available)

Memory

Uptime

Version (RabbitMQ / Erlang)

Type

bcfs_bunny at server1<http://bim_bus_admin:55672/#/nodes/bcfs_bunny%40ldnpsm028784>

?<http://technet.microsoft.com/en-us/sysinternals/bb896655> / 65536

294 / 58890

3498 / 1048576

160.1MB
57.6GB high watermark

7h 57m

2.8.1 / R15B01

Disc Stats *

bcfs_bunny at servers<http://bim_bus_admin:55672/#/nodes/bcfs_bunny%40ldnpsm028785>

?<http://technet.microsoft.com/en-us/sysinternals/bb896655> / 65536

266 / 58890

3124 / 1048576

115.9MB
57.6GB high watermark

1h 3m

2.8.1 / R15B01

Disc


I'm using Auto-configuration using the config files below:

server1 Config file rabbitmq.config
----------------------------------------------------------------------------------------
[
                {rabbit,
                                [{tcp_listeners, [5672]},
                                {cluster_nodes, [bcfs_bunny at server1, bcfs_bunny at server2]},
                                {vm_memory_high_watermark, 0.4},
                                {default_user,<<"adminuser">>},
                                {default_vhost,<<"/bcfs">>}
]},
                {rabbitmq_management,
                                [ {http_log_dir, 'd:\\logs\\rabbit-mgmt'} ] },
                {rabbitmq_management_agent,
                                [ {force_fine_statistics, false} ] }
].
----------------------------------------------------------------------------------------

Server2 Config file rabbitmq.config

----------------------------------------------------------------------------------------
[
                {rabbit,
                                [{tcp_listeners, [5672]},
                                {cluster_nodes, [bcfs_bunny at server2, bcfs_bunny at server1]},
                                {vm_memory_high_watermark, 0.4},
                                {default_user,<<"adminuser">>},
                                {default_vhost,<<"/bcfs">>}
]},
                {rabbitmq_management,
                                [ {http_log_dir, 'd:\\logs\\rabbit-mgmt'} ] },
                {rabbitmq_management_agent,
                                [ {force_fine_statistics, false} ] }
].
----------------------------------------------------------------------------------------


_______________________________________________

This e-mail may contain information that is confidential, privileged or otherwise protected from 
disclosure. If you are not an intended recipient of this e-mail, do not duplicate or redistribute 
it by any means. Please delete it and any attachments and notify the sender that you have received 
it in error. Unless specifically indicated, this e-mail is not an offer to buy or sell or a 
solicitation to buy or sell any securities, investment products or other financial product or 
service, an official confirmation of any transaction, or an official statement of Barclays. Any 
views or opinions presented are solely those of the author and do not necessarily represent those 
of Barclays. This e-mail is subject to terms available at the following link: www.barcap.com/emaildisclaimer. 
By messaging with Barclays you consent to the foregoing.  Barclays offers premier investment banking 
products and services to its clients through Barclays Bank PLC, a company registered in England 
(number 1026167) with its registered office at 1 Churchill Place, London, E14 5HP.  This email may 
relate to or be sent from other members of the Barclays Group.

_______________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/2ffee7d9/attachment.htm>

From tim at rabbitmq.com  Mon May 21 11:49:09 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 21 May 2012 11:49:09 +0100
Subject: [rabbitmq-discuss] is mine normal, fast, or lame ?
In-Reply-To: <4FB9B491.20308@indoakses-online.com>
References: <4FB9B491.20308@indoakses-online.com>
Message-ID: <4FBA1DA5.1040406@rabbitmq.com>

On 21/05/2012 04:20, bino oetomo wrote:
> Dear all.
> I do a performance test.
>
> 1. engine1 :
> RabbitMQ server with 5 shovel.
> This 5 shovel have different name , but other config is identical.
> 2. engine2 :
> Remote located RabbitMQ
>
> Connection engine1<<====>>engine2 : 1mbps clear
>
> The test :
> 1. I stop rabbitMQ at engine2
> 2. Load 800000 line of msg , average of 250 character per msg
> 3. When it done , I start RabbitMQ at engine2 .... and put my eyes at
> it's management web UI.
>
> Result :
> 1. engine1 : 'Acknowledge' box best rate is only 47 msg/s
> 2. engine2: the 'Ready' box always said between 350-400 msg/s
>
> Is that normal, fast, or lame ?
>

So this all depends on your configuration. There are a few things you 
can look at - can you post the whole configuration you're using 
(scrubbed of any private data if that's applicable) so we can take a look?

> will that any effect on running multiple shovel with identical config ?
>
> Sincerely
> -bino-
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Mon May 21 12:04:57 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 21 May 2012 12:04:57 +0100
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of a
	burst
In-Reply-To: <4FB81282.2020006@gmail.com>
References: <4FB76237.7020901@gmail.com> <4FB81282.2020006@gmail.com>
Message-ID: <D3224EFC-D5D5-46F6-BB3F-A030792ABF02@rabbitmq.com>

Hi Jos?,

I can reproduce your bug locally with 100 messages, but with 50 messages
it doesn't seem to happen. Your testcase isn't clear about which of the
messages it is losing. I suspect it is one of the first set of 100.

So I installed Wireshark (are you familiar with this tool?) and looked
at the message traffic. As far as I can see the last buffer is NOT sent
to the broker from the perl app. Autoflush() appears to make no
difference, and autoflush(1) in the loop (after the 100 messages) also
doesn't cure the problem.

I modified your test a little to put in a rolling -123456789, rather
than all X's, to check what is in the end of the buffer, and I note that
the last data buffer sent was short.

If I include a DISCONNECT at the end, this doesn't improve. (Note that
after the test has run one message is missing.)

There appears to be some glitch in which a buffer/packet is not sent.

I'm accumulating a Wireshark trace of this; but it appears to me that
this is a Perl client problem.

My next questions are as follows: When you tested with Apollo, are you
using exactly the same perl? and libraries? and testcase? Have you tried
this test with a different client library (say, Python instead of Perl)?

At the moment I cannot see or detect any STOMP adapter problems which
might account for this problem.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 19 May 2012, at 22:37, Jos? Mic? wrote:

> I've just confirmed this bug running my app against another broker (Apollo), on which the app worked perfectly.
> Do you have any plan to fix this bug? I can test development versions of the plugin, if you want.
> 
> Regards,
> Jos?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From francesco at rabbitmq.com  Mon May 21 12:17:43 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 21 May 2012 12:17:43 +0100
Subject: [rabbitmq-discuss] Cluster unresponsive after some stop/start
 of a node.
In-Reply-To: <CACvtUJdX9yzY4qdVCVziBwrLhq+SMdKti46F0Cy=qcUSB0=sbw@mail.gmail.com>
References: <4FB8987A.5060702@gmail.com> <4FB8C2CE.3040109@rabbitmq.com>
	<4FB8C36C.8010304@rabbitmq.com>
	<CACvtUJdX9yzY4qdVCVziBwrLhq+SMdKti46F0Cy=qcUSB0=sbw@mail.gmail.com>
Message-ID: <4FBA2457.5030103@rabbitmq.com>

> Hello Francesco,
>
> I'm attaching full logs from qwe (qwe.tgz) and asd (asd.tgz) of a
> minimal test case.
>
> Test.
>
> 1. Both qwe and asd are up and running, serving clients.
> 2. In the middle of qwe (master) accepting messages do stop_app on qwe.
> 3. Wait until asd is promoted, then start_app on qwe.
> 4. Do stop_app on asd.
> 5. Wait, do start_app on asd. qwe is now the master back.
> 6. Repeat 2,3,4,5 again. See "ERROR REPORT" (rabbit\@asd.log) on asd.

I could not reproduce this on my local machine.

I don't think it has anything to do with HA queues, as the log indicates 
`asd' is having problems contacting `qwe' when started. I would expect 
seeing a timeout error like yours if `asd' was a disc node and `qwe' was 
down, but if `asd' is a RAM node I'd expect a different error. What 
version of RabbitMQ are you running? It might be that on earlier 
versions we had looser checks for standalone RAM nodes.

In any case, I would never expect that to happen if at least one node in 
the cluster is up at all times, which seems to be the case here. Can you 
make sure that the error shows up with those precise steps, making sure 
that the connection between the two nodes is not severed - and without 
bothering with HA queues and publishing/consuming.

> On your comment on standalone RAM nodes, to be presice, asd (which is
> really a RAM node) may be left running standalone for some time while
> qwe is doing stop_app/start_app cycle. In my test, both qwe and asd
> are never down at the same time.

Having a standalone RAM node is a very bad idea, and we actively try to 
prevent the user from creating that situation when we can. I would 
strongly advise you against doing that, unless you have good reasons to 
(but I doubt it).

Francesco.

From rui.favas at barclays.com  Mon May 21 12:21:03 2012
From: rui.favas at barclays.com (rui.favas at barclays.com)
Date: Mon, 21 May 2012 12:21:03 +0100
Subject: [rabbitmq-discuss] Highly Available Cluster
In-Reply-To: <1308E5CFD51CA14DA7B024A689B8B1680254E43211@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
References: <1308E5CFD51CA14DA7B024A689B8B1680254E43211@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
Message-ID: <1308E5CFD51CA14DA7B024A689B8B1680254E43215@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>

Its actually the other way around.... Starting server1 always appears to work even when server2 is down!! but I cannot start server2 without starting server1 first.

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Favas, Rui: Barclays Capital (LDN)
Sent: Monday, May 21, 2012 11:44 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Highly Available Cluster

Unable to start single node on a cluster with two servers. I'm getting the error below if I try to start server1 when server2 is down:

BOOT FAILED
===========

Timeout contacting cluster nodes: [bcfs_bunny at server1].

I have the following cluster with two servers:-

Name

File descriptors (?)(used / available)

Socket descriptors (?)(used / available)

Erlang processes (used / available)

Memory

Uptime

Version (RabbitMQ / Erlang)

Type

bcfs_bunny at server1<http://bim_bus_admin:55672/#/nodes/bcfs_bunny%40ldnpsm028784>

?<http://technet.microsoft.com/en-us/sysinternals/bb896655> / 65536

294 / 58890

3498 / 1048576

160.1MB
57.6GB high watermark

7h 57m

2.8.1 / R15B01

Disc Stats *

bcfs_bunny at servers<http://bim_bus_admin:55672/#/nodes/bcfs_bunny%40ldnpsm028785>

?<http://technet.microsoft.com/en-us/sysinternals/bb896655> / 65536

266 / 58890

3124 / 1048576

115.9MB
57.6GB high watermark

1h 3m

2.8.1 / R15B01

Disc


I'm using Auto-configuration using the config files below:

server1 Config file rabbitmq.config
----------------------------------------------------------------------------------------
[
                {rabbit,
                                [{tcp_listeners, [5672]},
                                {cluster_nodes, [bcfs_bunny at server1, bcfs_bunny at server2]},
                                {vm_memory_high_watermark, 0.4},
                                {default_user,<<"adminuser">>},
                                {default_vhost,<<"/bcfs">>}
]},
                {rabbitmq_management,
                                [ {http_log_dir, 'd:\\logs\\rabbit-mgmt'} ] },
                {rabbitmq_management_agent,
                                [ {force_fine_statistics, false} ] }
].
----------------------------------------------------------------------------------------

Server2 Config file rabbitmq.config

----------------------------------------------------------------------------------------
[
                {rabbit,
                                [{tcp_listeners, [5672]},
                                {cluster_nodes, [bcfs_bunny at server2, bcfs_bunny at server1]},
                                {vm_memory_high_watermark, 0.4},
                                {default_user,<<"adminuser">>},
                                {default_vhost,<<"/bcfs">>}
]},
                {rabbitmq_management,
                                [ {http_log_dir, 'd:\\logs\\rabbit-mgmt'} ] },
                {rabbitmq_management_agent,
                                [ {force_fine_statistics, false} ] }
].
----------------------------------------------------------------------------------------

_______________________________________________

This e-mail may contain information that is confidential, privileged or otherwise protected from disclosure. If you are not an intended recipient of this e-mail, do not duplicate or redistribute it by any means. Please delete it and any attachments and notify the sender that you have received it in error. Unless specifically indicated, this e-mail is not an offer to buy or sell or a solicitation to buy or sell any securities, investment products or other financial product or service, an official confirmation of any transaction, or an official statement of Barclays. Any views or opinions presented are solely those of the author and do not necessarily represent those of Barclays. This e-mail is subject to terms available at the following link: www.barcap.com/emaildisclaimer<http://www.barclays.com/emaildisclaimer>. By messaging with Barclays you consent to the foregoing.  Barclays offers premier investment banking products and services to its clients through Barclays Bank PLC, a company registered in England (number 1026167) with its registered office at 1 Churchill Place, London, E14 5HP.  This email may relate to or be sent from other members of the Barclays Group.
_______________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/ade15459/attachment.htm>

From simon at rabbitmq.com  Mon May 21 12:26:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 21 May 2012 12:26:44 +0100
Subject: [rabbitmq-discuss] Highly Available Cluster
In-Reply-To: <1308E5CFD51CA14DA7B024A689B8B1680254E43215@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
References: <1308E5CFD51CA14DA7B024A689B8B1680254E43211@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
	<1308E5CFD51CA14DA7B024A689B8B1680254E43215@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
Message-ID: <4FBA2674.1000506@rabbitmq.com>

On 21/05/12 12:21, rui.favas at barclays.com wrote:
> Its actually the other way around?. Starting server1 always appears to
> work even when server2 is down!! but I cannot start server2 without
> starting server1 first.

If you stop server2 then stop server1, then you will need to start 
server1 first. You always need to first start the last node to shut down.

Does that make sense?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From loic-rabbitmq at loicp.eu  Mon May 21 12:50:23 2012
From: loic-rabbitmq at loicp.eu (Loic Pefferkorn)
Date: Mon, 21 May 2012 13:50:23 +0200
Subject: [rabbitmq-discuss] Shovel and x-message-ttl
Message-ID: <10426d977714d5284a6cd200958268f6@mail.boring>

Hello,

In a Shovel setup, I would like to add the x-message-ttl argument to 
the declaration section,
to have a queue automatically created with such configuration.

Is it possible ?

If so, what is the correct syntax ? I already made several tries, 
without any success yet.

Environnement:
-RabbitMQ 2.8.2

Relevant part of rabbitmq.config:

----8<----
{declarations,
[
     {'queue.declare',
       [{queue, <<"prod_hits_sop">>},
       durable,
       [{<<"x-message-ttl">>, 1000}] (doesn't work)
]},
----8<----

Best regards,
Lo?c


From zmstone at gmail.com  Mon May 21 13:00:34 2012
From: zmstone at gmail.com (stone)
Date: Mon, 21 May 2012 14:00:34 +0200
Subject: [rabbitmq-discuss] Highly Available Cluster
In-Reply-To: <4FBA2674.1000506@rabbitmq.com>
References: <1308E5CFD51CA14DA7B024A689B8B1680254E43211@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
	<1308E5CFD51CA14DA7B024A689B8B1680254E43215@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
	<4FBA2674.1000506@rabbitmq.com>
Message-ID: <CAPNZrFUxDqxqW8LZ56OsR1bdoPbzrMy7vxN=8iDT1buiAA7qgQ@mail.gmail.com>

Hi Simon

Does it has to be exactly the reversed order to start all the nodes in case
more than two nodes in a cluster ?
And if all the nodes are stopped, how do I tell in which order should they
be started ? check the logs ?

Brs
/stone


On Mon, May 21, 2012 at 1:26 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 21/05/12 12:21, rui.favas at barclays.com wrote:
>
>> Its actually the other way around?. Starting server1 always appears to
>> work even when server2 is down!! but I cannot start server2 without
>> starting server1 first.
>>
>
> If you stop server2 then stop server1, then you will need to start server1
> first. You always need to first start the last node to shut down.
>
> Does that make sense?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/f84ba7e8/attachment.htm>

From ask at rabbitmq.com  Mon May 21 13:15:00 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Mon, 21 May 2012 13:15:00 +0100
Subject: [rabbitmq-discuss] Why Celery?
In-Reply-To: <48885471-5a02-4125-9e93-894dbf0631e6@googlegroups.com>
References: <48885471-5a02-4125-9e93-894dbf0631e6@googlegroups.com>
Message-ID: <E54B088D-9567-40A9-A1F1-78EA04F72704@rabbitmq.com>


On 20 May 2012, at 19:07, mrtn wrote:

> 
> I finished reading through the rabbitmq tutorials here, and later found out people very often associate celery with rabbitmq.
> 
> From the tutorials, it seems that we don't have to use celery to process the messages in the queues (i.e. emptying them). However, someone on SO says that: 'If you don't have a celeryd process running, you'll just be adding tasks to the queue, but never emptying it', which I doubt is true. In the tutorials, a consumer/worker program listens to the queue, and process messages as they arrive, without using celery.
> 
> So my questions: what's the added-value celery brings to rabbitmq, and what are the common use cases of it?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From ask at rabbitmq.com  Mon May 21 13:16:04 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Mon, 21 May 2012 13:16:04 +0100
Subject: [rabbitmq-discuss] Why Celery?
In-Reply-To: <48885471-5a02-4125-9e93-894dbf0631e6@googlegroups.com>
References: <48885471-5a02-4125-9e93-894dbf0631e6@googlegroups.com>
Message-ID: <4F59BF56-F27E-4321-B486-C170CE64127C@rabbitmq.com>

On 20 May 2012, at 19:07, mrtn wrote:

> 
> I finished reading through the rabbitmq tutorials here, and later found out people very often associate celery with rabbitmq.
> 
> From the tutorials, it seems that we don't have to use celery to process the messages in the queues (i.e. emptying them). However, someone on SO says that: 'If you don't have a celeryd process running, you'll just be adding tasks to the queue, but never emptying it',

That seems to be taken out of context, it's probably not an answer to the question
you're asking.

> which I doubt is true. In the tutorials, a consumer/worker program listens to the queue, and process messages as they arrive, without using celery.
> 
> So my questions: what's the added-value celery brings to rabbitmq, and what are the common use cases of it?

Celery is a system that responds to messages by calling Python functions,
it is heavily biased around the concept of tasks and workflows, and so may
not be suitable for all messaging scenarios.

Writing a consumer is not hard, writing one that keeps running is.
The celery worker is heavily used in production and supports many features:
http://docs.celeryproject.org/en/latest/userguide/workers.html

And then the system must also be maintained, and your sysadmin
will probably hug you for using something standard that is
documented and has a supporting community. 

The next version 2.6 will extend on the concept of subtasks, but
the documentation is only a rough draft:
http://ask.github.com/celery/getting-started/next-steps.html#subtasks

See the User Guide:
http://docs.celeryproject.org/en/latest/userguide/index.html

From francesco at rabbitmq.com  Mon May 21 13:26:52 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 21 May 2012 13:26:52 +0100
Subject: [rabbitmq-discuss] Highly Available Cluster
In-Reply-To: <CAPNZrFUxDqxqW8LZ56OsR1bdoPbzrMy7vxN=8iDT1buiAA7qgQ@mail.gmail.com>
References: <1308E5CFD51CA14DA7B024A689B8B1680254E43211@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
	<1308E5CFD51CA14DA7B024A689B8B1680254E43215@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
	<4FBA2674.1000506@rabbitmq.com>
	<CAPNZrFUxDqxqW8LZ56OsR1bdoPbzrMy7vxN=8iDT1buiAA7qgQ@mail.gmail.com>
Message-ID: <4FBA348C.7050001@rabbitmq.com>

On 21/05/12 13:00, stone wrote:
> Hi Simon
>
> Does it has to be exactly the reversed order to start all the nodes in
> case more than two nodes in a cluster ?
> And if all the nodes are stopped, how do I tell in which order should
> they be started ? check the logs ?

The important thing is that the last node to go down gets started first. 
This is imposed by mnesia for the simple reason that the last node will 
have the most recent data, and the others will be able to synchronize 
after him. It doesn't matter if the others are started in a different order.

The next question might be "what if for some reason I can't restart that 
node"? In that case right now the situation is pretty ugly and there 
isn't an easy way out. We're planning to solve this in the next release.

Francesco.

From simon at rabbitmq.com  Mon May 21 13:27:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 21 May 2012 13:27:55 +0100
Subject: [rabbitmq-discuss] Shovel and x-message-ttl
In-Reply-To: <10426d977714d5284a6cd200958268f6@mail.boring>
References: <10426d977714d5284a6cd200958268f6@mail.boring>
Message-ID: <4FBA34CB.40101@rabbitmq.com>

On 21/05/12 12:50, Loic Pefferkorn wrote:
> Hello,
>
> In a Shovel setup, I would like to add the x-message-ttl argument to the
> declaration section,
> to have a queue automatically created with such configuration.

{'queue.declare',
     [{queue, <<"prod_hits_sop">>},
      {durable, true},
      {arguments, [{<<"x-message-ttl">>, long, 1000}]}]},

Cheers, Simon

>
> Is it possible ?
>
> If so, what is the correct syntax ? I already made several tries,
> without any success yet.
>
> Environnement:
> -RabbitMQ 2.8.2
>
> Relevant part of rabbitmq.config:
>
> ----8<----
> {declarations,
> [
> {'queue.declare',
> [{queue, <<"prod_hits_sop">>},
> durable,
> [{<<"x-message-ttl">>, 1000}] (doesn't work)
> ]},
> ----8<----
>
> Best regards,
> Lo?c
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From sameek at arosys.com  Mon May 21 13:47:47 2012
From: sameek at arosys.com (sameekmishra)
Date: Mon, 21 May 2012 05:47:47 -0700 (PDT)
Subject: [rabbitmq-discuss]  unable to set .erlang.cookie file?
Message-ID: <33882490.post@talk.nabble.com>


Hi

I am using rabbitmq 2.5.0 with erlang 14.b.2. i am facing problem when i
setting the cookies on node-2. i .i am using following method to set cookie
on node-2:

1.first i stop the node-2 using service rabbitmq-server stop
2.copy the node-1 cookies to node-2 :
 echo -n EOKOWXQREETZSHFNTPEY > /var/lib/rabbitmq/.erlang.cookie
3. service rabbitmq-server start

when i try to start service,i got the exception.

FAILED-cheack /ar/log/rabbitmq/statup_{log,err}

on statup_err file

erlang has closed 
crash dump was written to :erl_cash.dump
kernel pid terminated.....
.......
......

please tell me where the problem.

Thanks



-- 
View this message in context: http://old.nabble.com/unable-to-set-.erlang.cookie-file--tp33882490p33882490.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Mon May 21 13:50:39 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 21 May 2012 13:50:39 +0100
Subject: [rabbitmq-discuss] unable to set .erlang.cookie file?
In-Reply-To: <33882490.post@talk.nabble.com>
References: <33882490.post@talk.nabble.com>
Message-ID: <4FBA3A1F.2090609@rabbitmq.com>

1) Does the startup_log file contain anything that looks like an error 
message?

2) I assume you installed from debs / RPMs? Is the file 
/var/lib/rabbitmq/.erlang.cookie readable by the rabbitmq user?

Cheers, Simon

On 21/05/12 13:47, sameekmishra wrote:
>
> Hi
>
> I am using rabbitmq 2.5.0 with erlang 14.b.2. i am facing problem when i
> setting the cookies on node-2. i .i am using following method to set cookie
> on node-2:
>
> 1.first i stop the node-2 using service rabbitmq-server stop
> 2.copy the node-1 cookies to node-2 :
>   echo -n EOKOWXQREETZSHFNTPEY>  /var/lib/rabbitmq/.erlang.cookie
> 3. service rabbitmq-server start
>
> when i try to start service,i got the exception.
>
> FAILED-cheack /ar/log/rabbitmq/statup_{log,err}
>
> on statup_err file
>
> erlang has closed
> crash dump was written to :erl_cash.dump
> kernel pid terminated.....
> .......
> ......
>
> please tell me where the problem.
>
> Thanks
>
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From Christian.Bick at zanox.com  Mon May 21 14:01:11 2012
From: Christian.Bick at zanox.com (Christian Bick)
Date: Mon, 21 May 2012 13:01:11 +0000
Subject: [rabbitmq-discuss] Complete cluster crash (2.7.1)
Message-ID: <D922474AF853FE49882FC6ADB6FE7B4810F0E81F@z-de-xmb02.zanox.com>

Hi,

we had a complete crash of our 3-Node 2.7.1 cluster some days ago. What I saw on the web, this issue might be related to http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-April/019765.html . As such it may have been fixed in 2.8.x which we are going to migrate to. Nevertheless, I would like to ask for clarification on that if possible.

Detailed description:

OS: Linux
Erlang Version: R14A
Rabbit Version: 2.7.1
Cluster Setup: 3 Nodes, all disc mode
Queues: HA mode ?all? and durable

The cluster used to be stable for some months with relatively low usage.

Some days before the crash we were doing some OS related maintenance on the server. So we shut down, updated and reset each node one by one before rejoining it to the cluster. After that, some queues were not in synch any more with all other nodes (some synched with one, some synched with both other nodes). We regarded this as none-critical state and ignored it with respect to our already planned migration to 2.8.2.

You can find the relevant logs and the crash dump of Node-1 in the attachments.

Thank you already in advance for your help.

Greetings,
Christian Bick
-------------------------------------------------------------------------------
xing: https://www.xing.com/profile/Christian_Bick2
-------------------------------------------------------------------------------
ZANOX.de AG | Stralauer Allee 2 | 10245 Berlin
www.zanox.com<http://www.zanox.com/> | blog.zanox.com

[disclaimer logo: ZANOX.de AG]

STRAIGHT TO PERFORMANCE
--------------------------------------------------------------------------------

ZANOX.de AG | Headquarters: Berlin AG Charlottenburg | HRB 75459 | VAT identification number: DE 209981705
Executive Board: Philipp Justus (CEO) | Daniel Keller (CTO) | Christian Kleinsorge (CSO) | Joachim Piroth (CFO)
Chairman of the Supervisory Board: Ralph B?chi

This e-mail and any attachments may contain confidential and/or privileged information.
If you are not the intended recipient (or have received this e-mail in error) please notify the sender immediately and delete this e-mail from your system.
Any other use, copying, disclosure or distribution is strictly forbidden.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/5d81eba8/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: node1.log
Type: application/octet-stream
Size: 109252 bytes
Desc: node1.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/5d81eba8/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: node2.log
Type: application/octet-stream
Size: 15437 bytes
Desc: node2.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/5d81eba8/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: node3.log
Type: application/octet-stream
Size: 11057 bytes
Desc: node3.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/5d81eba8/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.dump.gz
Type: application/x-gzip
Size: 173780 bytes
Desc: erl_crash.dump.gz
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/5d81eba8/attachment.bin>

From emile at rabbitmq.com  Mon May 21 14:25:28 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 21 May 2012 14:25:28 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.2 crash report
 "unsupported_platform" on Vista
In-Reply-To: <jp5t8t$emo$1@dough.gmane.org>
References: <jp5t8t$emo$1@dough.gmane.org>
Message-ID: <4FBA4248.9020403@rabbitmq.com>

Hi Michael,

I've not been able to reproduce this error. Was there a corresponding
error in rabbit at server.log ? That should have more information.

Also, what do these return:

rabbitmqctl eval 'rabbit_disk_monitor:get_disk_free().'
rabbitmqctl eval 'rabbit_disk_monitor:get_disk_free_limit().'

On 18/05/12 17:27, Michael Justin wrote:

> [
>    {rabbitmq_stomp, [{tcp_listeners, [61613]},
>                      {ssl_listeners, [61614]}]},
>    {ssl_options, 

The nesting of the ssl_options is not right in this example.
'ssl_options' must be nested under 'rabbit'. See the SSL page for an
example: http://www.rabbitmq.com/ssl.html



-Emile



From markiyan.kushnir at gmail.com  Mon May 21 14:37:16 2012
From: markiyan.kushnir at gmail.com (Markiyan Kushnir)
Date: Mon, 21 May 2012 16:37:16 +0300
Subject: [rabbitmq-discuss] Cluster unresponsive after some stop/start
 of a node.
In-Reply-To: <4FBA2457.5030103@rabbitmq.com>
References: <4FB8987A.5060702@gmail.com> <4FB8C2CE.3040109@rabbitmq.com>
	<4FB8C36C.8010304@rabbitmq.com>
	<CACvtUJdX9yzY4qdVCVziBwrLhq+SMdKti46F0Cy=qcUSB0=sbw@mail.gmail.com>
	<4FBA2457.5030103@rabbitmq.com>
Message-ID: <CACvtUJdo6dqDPOPxp_jGnhLi9JaUmgtYeerzOW4yAgnXTk6aeA@mail.gmail.com>

2012/5/21 Francesco Mazzoli <francesco at rabbitmq.com>:
>> Hello Francesco,
>>
>> I'm attaching full logs from qwe (qwe.tgz) and asd (asd.tgz) of a
>> minimal test case.
>>
>> Test.
>>
>> 1. Both qwe and asd are up and running, serving clients.
>> 2. In the middle of qwe (master) accepting messages do stop_app on qwe.
>> 3. Wait until asd is promoted, then start_app on qwe.
>> 4. Do stop_app on asd.
>> 5. Wait, do start_app on asd. qwe is now the master back.
>> 6. Repeat 2,3,4,5 again. See "ERROR REPORT" (rabbit\@asd.log) on asd.
>
>
> I could not reproduce this on my local machine.
>
> I don't think it has anything to do with HA queues, as the log indicates
> `asd' is having problems contacting `qwe' when started. I would expect
> seeing a timeout error like yours if `asd' was a disc node and `qwe' was
> down, but if `asd' is a RAM node I'd expect a different error. What version
> of RabbitMQ are you running? It might be that on earlier versions we had
> looser checks for standalone RAM nodes.
>
> In any case, I would never expect that to happen if at least one node in the
> cluster is up at all times, which seems to be the case here. Can you make
> sure that the error shows up with those precise steps, making sure that the
> connection between the two nodes is not severed - and without bothering with
> HA queues and publishing/consuming.
>
>
>> On your comment on standalone RAM nodes, to be presice, asd (which is
>> really a RAM node) may be left running standalone for some time while
>> qwe is doing stop_app/start_app cycle. In my test, both qwe and asd
>> are never down at the same time.
>
>
> Having a standalone RAM node is a very bad idea, and we actively try to
> prevent the user from creating that situation when we can. I would strongly
> advise you against doing that, unless you have good reasons to (but I doubt
> it).
>
> Francesco.

Re-run my test with two separate modifications:

  - modulo clients' activities -- the issue didn't show up. After some
dozen of test runs I could hit it.

  - asd changed from RAM to disk (and clients were busy with their
communication as in the original test) -- asd went unresponsive after
a couple test runs. One difference is that both start_app on asd adn
stop_app on qwe freeze, so that I have to CTRL-C them.

After the tests (start_app/stop_app commands halt), cluster_status
still shows info on both nodes:


13:12:~$ sudo /usr/sbin/rabbitmqctl cluster_status
Cluster status of node 'rabbit at qwe' ...
[{nodes,[{disc,['rabbit at asd','rabbit at qwe']}]},
 {running_nodes,['rabbit at asd','rabbit at qwe']}]
 ...done.

13:12:~$ sudo /usr/sbin/rabbitmqctl cluster_status
Cluster status of node 'rabbit at asd' ...
[{nodes,[{disc,['rabbit at asd','rabbit at qwe']}]},
 {running_nodes,['rabbit at qwe','rabbit at asd']}]
 ...done.


Here is the status output on both nodes:

13:18:~$ sudo /usr/sbin/rabbitmqctl status
Status of node 'rabbit at qwe' ...
[{pid,6018},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.8.2"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.2"},
      {rabbit,"RabbitMQ","2.8.2"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {xmerl,"XML parser","1.2.3"},
      {amqp_client,"RabbitMQ AMQP Client","2.8.2"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.2"},
      {webmachine,"webmachine","1.7.0-rmq2.8.2-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.2-git"},
      {inets,"INETS  CXC 138 49","5.2"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [rq:1]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,36949080},
      {processes,14130744},
      {processes_used,14117816},
      {system,22818336},
      {atom,1519633},
      {atom_used,1498588},
      {binary,274160},
      {code,18291044},
      {ets,1218344}]},
 {vm_memory_high_watermark,0.3999999994254929},
 {vm_memory_limit,417749401},
 {disk_free_limit,1044373504},
 {disk_free,76397264896},
 {file_descriptors,
     [{total_limit,924},{total_used,4},{sockets_limit,829},{sockets_used,1}]},
 {processes,[{limit,1048576},{used,227}]},
 {run_queue,0},
 {uptime,2334}]
...done.

13:27:~$ sudo /usr/sbin/rabbitmqctl status
Status of node 'rabbit at asd' ...
[{pid,9804},
 {running_applications,
     [{mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {xmerl,"XML parser","1.2.3"},
      {amqp_client,"RabbitMQ AMQP Client","2.8.2"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.2"},
      {webmachine,"webmachine","1.7.0-rmq2.8.2-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.2-git"},
      {inets,"INETS  CXC 138 49","5.2"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [rq:1]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,33949376},
      {processes,11465800},
      {processes_used,11346720},
      {system,22483576},
      {atom,1519633},
      {atom_used,1498775},
      {binary,94768},
      {code,18291044},
      {ets,1137896}]},
 {file_descriptors,
     [{total_limit,924},{total_used,0},{sockets_limit,829},{sockets_used,0}]},
 {processes,[{limit,1048576},{used,105}]},
 {run_queue,0},
 {uptime,2483}]



After another attempt to stop the node on qwe, status freeze on this
node as well.

In the case you need it -- attaching new set of logs on both qwe and asd.

--
Thanks,
Markiyan.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: asd-2.tgz
Type: application/x-gzip
Size: 3225 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/db00bd39/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: qwe-2.tgz
Type: application/x-gzip
Size: 3627 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/db00bd39/attachment-0001.bin>

From markiyan.kushnir at gmail.com  Mon May 21 14:41:27 2012
From: markiyan.kushnir at gmail.com (Markiyan Kushnir)
Date: Mon, 21 May 2012 16:41:27 +0300
Subject: [rabbitmq-discuss] Cluster unresponsive after some stop/start
 of a node.
In-Reply-To: <CACvtUJdo6dqDPOPxp_jGnhLi9JaUmgtYeerzOW4yAgnXTk6aeA@mail.gmail.com>
References: <4FB8987A.5060702@gmail.com> <4FB8C2CE.3040109@rabbitmq.com>
	<4FB8C36C.8010304@rabbitmq.com>
	<CACvtUJdX9yzY4qdVCVziBwrLhq+SMdKti46F0Cy=qcUSB0=sbw@mail.gmail.com>
	<4FBA2457.5030103@rabbitmq.com>
	<CACvtUJdo6dqDPOPxp_jGnhLi9JaUmgtYeerzOW4yAgnXTk6aeA@mail.gmail.com>
Message-ID: <CACvtUJfveo9Hg3TW5bQQygvziGqNRbwwH0Q0zPTqnQT-49w=4g@mail.gmail.com>

2012/5/21 Markiyan Kushnir <markiyan.kushnir at gmail.com>:
> 2012/5/21 Francesco Mazzoli <francesco at rabbitmq.com>:
>>> Hello Francesco,
>>>
>>> I'm attaching full logs from qwe (qwe.tgz) and asd (asd.tgz) of a
>>> minimal test case.
>>>
>>> Test.
>>>
>>> 1. Both qwe and asd are up and running, serving clients.
>>> 2. In the middle of qwe (master) accepting messages do stop_app on qwe.
>>> 3. Wait until asd is promoted, then start_app on qwe.
>>> 4. Do stop_app on asd.
>>> 5. Wait, do start_app on asd. qwe is now the master back.
>>> 6. Repeat 2,3,4,5 again. See "ERROR REPORT" (rabbit\@asd.log) on asd.
>>
>>
>> I could not reproduce this on my local machine.
>>
>> I don't think it has anything to do with HA queues, as the log indicates
>> `asd' is having problems contacting `qwe' when started. I would expect
>> seeing a timeout error like yours if `asd' was a disc node and `qwe' was
>> down, but if `asd' is a RAM node I'd expect a different error. What version
>> of RabbitMQ are you running? It might be that on earlier versions we had
>> looser checks for standalone RAM nodes.
>>
>> In any case, I would never expect that to happen if at least one node in the
>> cluster is up at all times, which seems to be the case here. Can you make
>> sure that the error shows up with those precise steps, making sure that the
>> connection between the two nodes is not severed - and without bothering with
>> HA queues and publishing/consuming.
>>
>>
>>> On your comment on standalone RAM nodes, to be presice, asd (which is
>>> really a RAM node) may be left running standalone for some time while
>>> qwe is doing stop_app/start_app cycle. In my test, both qwe and asd
>>> are never down at the same time.
>>
>>
>> Having a standalone RAM node is a very bad idea, and we actively try to
>> prevent the user from creating that situation when we can. I would strongly
>> advise you against doing that, unless you have good reasons to (but I doubt
>> it).
>>
>> Francesco.
>
> Re-run my test with two separate modifications:
>
> ?- modulo clients' activities -- the issue didn't show up. After some
> dozen of test runs I could hit it.
>

s/could hit it/couldn't hit it/

Sorry for the typo.


> ?- asd changed from RAM to disk (and clients were busy with their
> communication as in the original test) -- asd went unresponsive after
> a couple test runs. One difference is that both start_app on asd adn
> stop_app on qwe freeze, so that I have to CTRL-C them.
>
> After the tests (start_app/stop_app commands halt), cluster_status
> still shows info on both nodes:
>
>
> 13:12:~$ sudo /usr/sbin/rabbitmqctl cluster_status
> Cluster status of node 'rabbit at qwe' ...
> [{nodes,[{disc,['rabbit at asd','rabbit at qwe']}]},
> ?{running_nodes,['rabbit at asd','rabbit at qwe']}]
> ?...done.
>
> 13:12:~$ sudo /usr/sbin/rabbitmqctl cluster_status
> Cluster status of node 'rabbit at asd' ...
> [{nodes,[{disc,['rabbit at asd','rabbit at qwe']}]},
> ?{running_nodes,['rabbit at qwe','rabbit at asd']}]
> ?...done.
>
>
> Here is the status output on both nodes:
>
> 13:18:~$ sudo /usr/sbin/rabbitmqctl status
> Status of node 'rabbit at qwe' ...
> [{pid,6018},
> ?{running_applications,
> ? ? [{rabbitmq_management,"RabbitMQ Management Console","2.8.2"},
> ? ? ?{rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.2"},
> ? ? ?{rabbit,"RabbitMQ","2.8.2"},
> ? ? ?{mnesia,"MNESIA ?CXC 138 12","4.4.12"},
> ? ? ?{os_mon,"CPO ?CXC 138 46","2.2.4"},
> ? ? ?{xmerl,"XML parser","1.2.3"},
> ? ? ?{amqp_client,"RabbitMQ AMQP Client","2.8.2"},
> ? ? ?{sasl,"SASL ?CXC 138 11","2.1.8"},
> ? ? ?{rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.2"},
> ? ? ?{webmachine,"webmachine","1.7.0-rmq2.8.2-hg"},
> ? ? ?{mochiweb,"MochiMedia Web Server","1.3-rmq2.8.2-git"},
> ? ? ?{inets,"INETS ?CXC 138 49","5.2"},
> ? ? ?{stdlib,"ERTS ?CXC 138 10","1.16.4"},
> ? ? ?{kernel,"ERTS ?CXC 138 10","2.13.4"}]},
> ?{os,{unix,linux}},
> ?{erlang_version,
> ? ? "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [rq:1]
> [async-threads:30] [hipe] [kernel-poll:true]\n"},
> ?{memory,
> ? ? [{total,36949080},
> ? ? ?{processes,14130744},
> ? ? ?{processes_used,14117816},
> ? ? ?{system,22818336},
> ? ? ?{atom,1519633},
> ? ? ?{atom_used,1498588},
> ? ? ?{binary,274160},
> ? ? ?{code,18291044},
> ? ? ?{ets,1218344}]},
> ?{vm_memory_high_watermark,0.3999999994254929},
> ?{vm_memory_limit,417749401},
> ?{disk_free_limit,1044373504},
> ?{disk_free,76397264896},
> ?{file_descriptors,
> ? ? [{total_limit,924},{total_used,4},{sockets_limit,829},{sockets_used,1}]},
> ?{processes,[{limit,1048576},{used,227}]},
> ?{run_queue,0},
> ?{uptime,2334}]
> ...done.
>
> 13:27:~$ sudo /usr/sbin/rabbitmqctl status
> Status of node 'rabbit at asd' ...
> [{pid,9804},
> ?{running_applications,
> ? ? [{mnesia,"MNESIA ?CXC 138 12","4.4.12"},
> ? ? ?{os_mon,"CPO ?CXC 138 46","2.2.4"},
> ? ? ?{xmerl,"XML parser","1.2.3"},
> ? ? ?{amqp_client,"RabbitMQ AMQP Client","2.8.2"},
> ? ? ?{sasl,"SASL ?CXC 138 11","2.1.8"},
> ? ? ?{rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.2"},
> ? ? ?{webmachine,"webmachine","1.7.0-rmq2.8.2-hg"},
> ? ? ?{mochiweb,"MochiMedia Web Server","1.3-rmq2.8.2-git"},
> ? ? ?{inets,"INETS ?CXC 138 49","5.2"},
> ? ? ?{stdlib,"ERTS ?CXC 138 10","1.16.4"},
> ? ? ?{kernel,"ERTS ?CXC 138 10","2.13.4"}]},
> ?{os,{unix,linux}},
> ?{erlang_version,
> ? ? "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [rq:1]
> [async-threads:30] [hipe] [kernel-poll:true]\n"},
> ?{memory,
> ? ? [{total,33949376},
> ? ? ?{processes,11465800},
> ? ? ?{processes_used,11346720},
> ? ? ?{system,22483576},
> ? ? ?{atom,1519633},
> ? ? ?{atom_used,1498775},
> ? ? ?{binary,94768},
> ? ? ?{code,18291044},
> ? ? ?{ets,1137896}]},
> ?{file_descriptors,
> ? ? [{total_limit,924},{total_used,0},{sockets_limit,829},{sockets_used,0}]},
> ?{processes,[{limit,1048576},{used,105}]},
> ?{run_queue,0},
> ?{uptime,2483}]
>
>
>
> After another attempt to stop the node on qwe, status freeze on this
> node as well.
>
> In the case you need it -- attaching new set of logs on both qwe and asd.
>
> --
> Thanks,
> Markiyan.

From bino at indoakses-online.com  Mon May 21 14:58:37 2012
From: bino at indoakses-online.com (bino at indoakses-online.com)
Date: Mon, 21 May 2012 20:58:37 +0700
Subject: [rabbitmq-discuss] is mine normal, fast, or lame ?
In-Reply-To: <4FBA1DA5.1040406@rabbitmq.com>
References: <4FB9B491.20308@indoakses-online.com>
	<4FBA1DA5.1040406@rabbitmq.com>
Message-ID: <3586fc2802031b4b765eb40f77a5e3ed.squirrel@localhost>

Dear Tim and All

> (tim wrote)
> So this all depends on your configuration. There are a few things you
> can look at - can you post the whole configuration you\'re using
> (scrubbed of any private data if that\'s applicable) so we can take a look?
>

Thankyou for your response

Here I post the config at pastebin : http://pastebin.com/8pqJikF9

Note that there is fleet_shovel1 -- fleet_shovel5, different name but
identical configs

Sincerely
-bino-


From loic-rabbitmq at loicp.eu  Mon May 21 15:03:24 2012
From: loic-rabbitmq at loicp.eu (Loic Pefferkorn)
Date: Mon, 21 May 2012 16:03:24 +0200
Subject: [rabbitmq-discuss] Shovel and x-message-ttl
In-Reply-To: <4FBA34CB.40101@rabbitmq.com>
References: <10426d977714d5284a6cd200958268f6@mail.boring>
	<4FBA34CB.40101@rabbitmq.com>
Message-ID: <9c4bd94d15e17472b6f52e8d70994022@mail.boring>

Le 21.05.2012 14:27, Simon MacMullen a ?crit?:
> On 21/05/12 12:50, Loic Pefferkorn wrote:
>> Hello,
>>
>> In a Shovel setup, I would like to add the x-message-ttl argument to 
>> the
>> declaration section,
>> to have a queue automatically created with such configuration.
>
> {'queue.declare',
>     [{queue, <<"prod_hits_sop">>},
>      {durable, true},
>      {arguments, [{<<"x-message-ttl">>, long, 1000}]}]},
>
> Cheers, Simon

Works fine, thank you very much :)

Best regards,
Lo?c


From kbaltrinic at bericotechnologies.com  Mon May 21 15:13:11 2012
From: kbaltrinic at bericotechnologies.com (Ken Baltrinic)
Date: Mon, 21 May 2012 07:13:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Prior Version Documentation
Message-ID: <0bf227c5-b9cf-45c0-8ad3-0386e4915b2a@z19g2000vbe.googlegroups.com>

The online documentation at http://www.rabbitmq.com/documentation.html
appears to be updated regularly to reflect the information for the
most recent release.  This is generally wonderful and quite a feat.
Well done!

Unfortunately, we are using rabbit in a government environment where
upgrading to the latest release is a very controlled event.
Presently we are using rabbit 2.7.1 and need to supply as part of our
contractual deliverables, the documentation for the same.  Is there a
means to get access to the documentation aligned to a specific prior
release?

--Ken

From stevieplayland at gmail.com  Mon May 21 17:15:02 2012
From: stevieplayland at gmail.com (steve layland)
Date: Mon, 21 May 2012 09:15:02 -0700
Subject: [rabbitmq-discuss] Highly Available Cluster
In-Reply-To: <4FBA2674.1000506@rabbitmq.com>
References: <1308E5CFD51CA14DA7B024A689B8B1680254E43211@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
	<1308E5CFD51CA14DA7B024A689B8B1680254E43215@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
	<4FBA2674.1000506@rabbitmq.com>
Message-ID: <CACaSazZLQObQ7g-oX9jpCRvSyEg4PNkzdvBap-itpYmP9aq4RQ@mail.gmail.com>

Simon, just curious... has this always been the case for older versions of
rabbitmq? Thanks

-Steve
On May 21, 2012 4:27 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

> On 21/05/12 12:21, rui.favas at barclays.com wrote:
>
>> Its actually the other way around?. Starting server1 always appears to
>> work even when server2 is down!! but I cannot start server2 without
>> starting server1 first.
>>
>
> If you stop server2 then stop server1, then you will need to start server1
> first. You always need to first start the last node to shut down.
>
> Does that make sense?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/7859ec24/attachment.htm>

From francesco at rabbitmq.com  Mon May 21 17:18:10 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 21 May 2012 17:18:10 +0100
Subject: [rabbitmq-discuss] Highly Available Cluster
In-Reply-To: <CACaSazZLQObQ7g-oX9jpCRvSyEg4PNkzdvBap-itpYmP9aq4RQ@mail.gmail.com>
References: <1308E5CFD51CA14DA7B024A689B8B1680254E43211@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
	<1308E5CFD51CA14DA7B024A689B8B1680254E43215@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
	<4FBA2674.1000506@rabbitmq.com>
	<CACaSazZLQObQ7g-oX9jpCRvSyEg4PNkzdvBap-itpYmP9aq4RQ@mail.gmail.com>
Message-ID: <4FBA6AC2.20806@rabbitmq.com>

As I said in my other reply to this thread, this condition is imposed by 
mnesia, not by us, so it has always been the case.

Francesco.

On 21/05/12 17:15, steve layland wrote:
> Simon, just curious... has this always been the case for older versions
> of rabbitmq? Thanks
>
> -Steve
>
> On May 21, 2012 4:27 AM, "Simon MacMullen" <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 21/05/12 12:21, rui.favas at barclays.com
>     <mailto:rui.favas at barclays.com> wrote:
>
>         Its actually the other way around?. Starting server1 always
>         appears to
>         work even when server2 is down!! but I cannot start server2 without
>         starting server1 first.
>
>
>     If you stop server2 then stop server1, then you will need to start
>     server1 first. You always need to first start the last node to shut
>     down.
>
>     Does that make sense?
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>     _________________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.__rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From pgross at gmail.com  Mon May 21 18:42:26 2012
From: pgross at gmail.com (Paul Gross)
Date: Mon, 21 May 2012 12:42:26 -0500
Subject: [rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
In-Reply-To: <4FBA0DCE.1080705@rabbitmq.com>
References: <4FABE167.9080900@gmail.com> <4FABE7B9.5010509@rabbitmq.com>
	<4FB15399.9090504@gmail.com> <4FB34F38.2080507@rabbitmq.com>
	<4FB6888F.6050904@gmail.com> <4FBA0DCE.1080705@rabbitmq.com>
Message-ID: <4FBA7E82.1030002@gmail.com>


>>
>> Unfortunately, by the time I was able to ssh into the server to run
>> rabbitmqctl report, it said nodedown.
>
> That's a shame. Would be really good to catch it early enough to still 
> get some useful output from rabbitmqctl.
>
I will keep trying.
>
> Hmm. You have HA queues but only a single node. Is that intentional? 
> While that shouldn't cause any problems, a) it is far less efficient 
> than using non-HA queues in that situation, and b) single-node HA 
> queues are not as well tested as their multi-node cousins.
>
Yes. We use HA queues in production in a 3 node cluster. For our build 
server, we use the same code which sets up an HA queue, but we only have 
one node.

Thanks,
Paul

From jose.mico at gmail.com  Mon May 21 20:21:22 2012
From: jose.mico at gmail.com (=?ISO-8859-1?Q?Jos=E9_Mic=F3?=)
Date: Mon, 21 May 2012 16:21:22 -0300
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of a
	burst
In-Reply-To: <D3224EFC-D5D5-46F6-BB3F-A030792ABF02@rabbitmq.com>
References: <4FB76237.7020901@gmail.com> <4FB81282.2020006@gmail.com>
	<D3224EFC-D5D5-46F6-BB3F-A030792ABF02@rabbitmq.com>
Message-ID: <4FBA95B2.1000707@gmail.com>

On 05/21/2012 08:04 AM, Steve Powell wrote:
> I can reproduce your bug locally with 100 messages, but with 50 messages
> it doesn't seem to happen.
Thanks for reproducing the bug :-)

This does not happens with bursts of few messages. I can reproduce it 
with burst over 100, and almost always fail with bursts of 10000. As I 
stated in a previous mail, this is related to the CPU load of the 
broker: to trigger the bug, the broker must be busy. Is more probably to 
trigger it with 1000 mesages of 1 KB than with 10 messages of 100KB.
> Your testcase isn't clear about which of the
> messages it is losing. I suspect it is one of the first set of 100.
The test case does not show which message is missing. But in other tests 
that I have in my test suite I found that the lost message is always the 
last one, and only the last one.
> So I installed Wireshark (are you familiar with this tool?) and looked
> at the message traffic. As far as I can see the last buffer is NOT sent
> to the broker from the perl app.
I will look at Wireshark, but I am almost sure that the perl app sent 
the data to the kernel. I don't know what the kernel does then.
> Autoflush() appears to make no
> difference, and autoflush(1) in the loop (after the 100 messages) also
> doesn't cure the problem.
>
> I modified your test a little to put in a rolling -123456789, rather
> than all X's, to check what is in the end of the buffer, and I note that
> the last data buffer sent was short.
I've attached a python version of the test script, which shows the same 
symptoms than the perl one.
This time, the body of message contains the message number and and END 
mark to help sniffing.
> If I include a DISCONNECT at the end, this doesn't improve. (Note that
> after the test has run one message is missing.)
>
> There appears to be some glitch in which a buffer/packet is not sent.
>
> I'm accumulating a Wireshark trace of this; but it appears to me that
> this is a Perl client problem.
Python does the same. And if it is a perl problem, why my app works fine 
on Apollo?
> My next questions are as follows: When you tested with Apollo, are you
> using exactly the same perl? and libraries? and testcase?
I've used exactly the same enviroment, code and everything (the beauty 
of interoperability :), only with an instance of Apollo running instead 
of RabbitMQ.
I've just doubled checked it.
> Have you tried
> this test with a different client library (say, Python instead of Perl)?
I've attached a Python version of the test case. Same happens: It send 
1000 messages, sometimes only 999 are queued.
> At the moment I cannot see or detect any STOMP adapter problems which
> might account for this problem.
I don't know if this affects AMQP also. Just happens that I am using the 
STOMP adapter.


Thanks for your time,
Jos?

> Steve Powell  (a happy bunny)
> ----------some more definitions from the SPD----------
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> literacy (n.) A textually transmitted disease usually contracted in childhood.
>
> On 19 May 2012, at 22:37, Jos? Mic? wrote:
>
>> I've just confirmed this bug running my app against another broker (Apollo), on which the app worked perfectly.
>> Do you have any plan to fix this bug? I can test development versions of the plugin, if you want.
>>
>> Regards,
>> Jos?
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: stomp_bug.py
Type: text/x-python
Size: 1299 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/2c8e9a64/attachment.py>

From will at thumb.it  Mon May 21 20:22:34 2012
From: will at thumb.it (Will Koffel)
Date: Mon, 21 May 2012 15:22:34 -0400
Subject: [rabbitmq-discuss] Silent crash causes persistent durable message
	loss
Message-ID: <8FF985CF-C086-41BE-9A6B-7A2EAD256BF6@thumb.it>

How's that for a useless mysterious title?  A bit more on what we're seeing:

I'm running 2.8.1, and I have one queue in our setup with a long TTL ("expiring-queue", we'll call it), which then uses dead-letter-exchange to reroute to another queue ("action-queue").  The TTL for these expiring messages is 7 days.  So it looks like this:

[ec2-user at web03 current]$ sudo rabbitmqctl list_queues name messages arguments durable
expiring-queue	311443	[{"x-dead-letter-exchange","my-exchange"},{"x-message-ttl",604800000},{"x-dead-letter-routing-key","action-queue"}]	true
action-queue	0	[]	true

(BTW, What I'm doing is using the TTL as a way to keep track of an event that expires after one week.  Namely, we keep a count of a particular event for the last 7 days.  So each time the event happens we write to the action-queue which increments the value, and to the expiring queue. 7 days later, that message gets expired into the action-queue again, and we decrement the counter.  So we have a real-time, running 7 day counter.)

This for the most part is stable.  Except when it's not.  We've seen 3 or 4 crashes of this system since we set it up 3 weeks ago.  I can't find any information in the logs to tell me why Rabbit crashed, it just dies silently.  But more distributing is that when I bring it back up, all the messages (typically millions) in the expiring-queue are gone.  That's death for me, because that's the only record of when those things are supposed to expire.

Any leads on where to look for more crash reports or evidence of what's happening here?  And importantly, in what case would these messages be lost (seems like that should never happen!)  The queue is durable, and I'm using deliveryMode=2 for the messages.  I'm pretty sure that persistence works in general, because I can stop rabbit and restart it and all the messages are still there...they are only lost in the case of this odd silent crash.  I've also tried doing evil things like kill -9 various server processes, and haven't been able to reproduce the message loss in any controlled environment.

I'm LOVING that this could work in Rabbit with the 2.8 updates, hoping to not have to move to another queueing system where I have to build all the dead-letter-routing stuff myself, when this is so close to a clean solution.

Thanks in advance for any thoughts.

-Will




________________
Will Koffel
CTO, Thumb?
51 E 12th St., 4th Floor
New York, NY 10003
Office: (212) 673-8650
Mobile: (617) 575-WILL
@thumb
www.thumb.it






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/ef9e8e9d/attachment.htm>

From francesco at rabbitmq.com  Mon May 21 21:50:31 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 21 May 2012 21:50:31 +0100
Subject: [rabbitmq-discuss] Silent crash causes persistent durable
 message loss
In-Reply-To: <8FF985CF-C086-41BE-9A6B-7A2EAD256BF6@thumb.it>
References: <8FF985CF-C086-41BE-9A6B-7A2EAD256BF6@thumb.it>
Message-ID: <4FBAAA97.5030808@rabbitmq.com>

Hi Will,

I have trouble believing that it is actually dying silently silently 
with no information in the logs. Can you try to reproduce it and post 
the logs here?

In the meantime I'm going to do the obvious and suggest to upgrade to 
2.8.2. We fixed several ugly bugs related to DLX (one of which was 
particularly easy to get) and they might be related to your problem.

Francesco.

On 21/05/12 20:22, Will Koffel wrote:
> How's that for a useless mysterious title? A bit more on what we're seeing:
>
> I'm running 2.8.1, and I have one queue in our setup with a long TTL
> ("expiring-queue", we'll call it), which then uses dead-letter-exchange
> to reroute to another queue ("action-queue"). The TTL for these expiring
> messages is 7 days. So it looks like this:
>
> [ec2-user at web03 current]$ sudo rabbitmqctl list_queues name messages
> arguments durable
> expiring-queue311443[{"x-dead-letter-exchange","my-exchange"},{"x-message-ttl",604800000},{"x-dead-letter-routing-key","action-queue"}]true
> action-queue0[]true
>
> (BTW, What I'm doing is using the TTL as a way to keep track of an event
> that expires after one week. Namely, we keep a count of a particular
> event for the last 7 days. So each time the event happens we write to
> the action-queue which increments the value, and to the expiring queue.
> 7 days later, that message gets expired into the action-queue again, and
> we decrement the counter. So we have a real-time, running 7 day counter.)
>
> This for the most part is stable. Except when it's not. We've seen 3 or
> 4 crashes of this system since we set it up 3 weeks ago. I can't find
> any information in the logs to tell me why Rabbit crashed, it just dies
> silently. But more distributing is that when I bring it back up, all the
> messages (typically millions) in the expiring-queue are gone. That's
> death for me, because that's the only record of when those things are
> supposed to expire.
>
> Any leads on where to look for more crash reports or evidence of what's
> happening here? And importantly, in what case would these messages be
> lost (seems like that should never happen!) The queue is durable, and
> I'm using deliveryMode=2 for the messages. I'm pretty sure that
> persistence works in general, because I can stop rabbit and restart it
> and all the messages are still there...they are only lost in the case of
> this odd silent crash. I've also tried doing evil things like kill -9
> various server processes, and haven't been able to reproduce the message
> loss in any controlled environment.
>
> I'm LOVING that this could work in Rabbit with the 2.8 updates, hoping
> to not have to move to another queueing system where I have to build all
> the dead-letter-routing stuff myself, when this is so close to a clean
> solution.
>
> Thanks in advance for any thoughts.
>
> -Will
>
>
>
>
> ________________
> Will Koffel
> CTO, Thumb?
> 51 E 12th St., 4th Floor
> New York, NY 10003
> Office: (212) 673-8650
> Mobile: (617) 575-WILL
> @thumb
> www.thumb.it <http://www.thumb.it/>
>
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Mon May 21 22:02:15 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 21 May 2012 22:02:15 +0100
Subject: [rabbitmq-discuss] Silent crash causes persistent durable
 message loss
In-Reply-To: <4FBAAA97.5030808@rabbitmq.com>
References: <8FF985CF-C086-41BE-9A6B-7A2EAD256BF6@thumb.it>
	<4FBAAA97.5030808@rabbitmq.com>
Message-ID: <4FBAAD57.5090106@rabbitmq.com>

On 21/05/12 21:50, Francesco Mazzoli wrote:
> I have trouble believing that it is actually dying silently with no
> information in the logs.

iirc we've seen this in the past with things like 'oom killer'. It is
probably worth checking the system logs.

> In the meantime I'm going to do the obvious and suggest to upgrade to
>  2.8.2. We fixed several ugly bugs related to DLX (one of which was
> particularly easy to get) and they might be related to your problem.

I don't think any of the DLX bugs pre 2.8.2 would have brought down an
entire rabbit, just individual queues.

Matthias.

From tim at rabbitmq.com  Mon May 21 22:08:15 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 21 May 2012 22:08:15 +0100
Subject: [rabbitmq-discuss] Silent crash causes persistent durable
 message loss
In-Reply-To: <4FBAAD57.5090106@rabbitmq.com>
References: <8FF985CF-C086-41BE-9A6B-7A2EAD256BF6@thumb.it>
	<4FBAAA97.5030808@rabbitmq.com> <4FBAAD57.5090106@rabbitmq.com>
Message-ID: <4FBAAEBF.10000@rabbitmq.com>

On 21/05/2012 22:02, Matthias Radestock wrote:
> On 21/05/12 21:50, Francesco Mazzoli wrote:
>> I have trouble believing that it is actually dying silently with no
>> information in the logs.
>
> iirc we've seen this in the past with things like 'oom killer'. It is
> probably worth checking the system logs.
>

Even with an OOM failure, we should at least be able to see an 
erl_crash.dump file somewhere.

>> In the meantime I'm going to do the obvious and suggest to upgrade to
>> 2.8.2. We fixed several ugly bugs related to DLX (one of which was
>> particularly easy to get) and they might be related to your problem.
>
> I don't think any of the DLX bugs pre 2.8.2 would have brought down an
> entire rabbit, just individual queues.
>

From matthias at rabbitmq.com  Mon May 21 22:12:04 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 21 May 2012 22:12:04 +0100
Subject: [rabbitmq-discuss] Silent crash causes persistent durable
 message loss
In-Reply-To: <4FBAAEBF.10000@rabbitmq.com>
References: <8FF985CF-C086-41BE-9A6B-7A2EAD256BF6@thumb.it>
	<4FBAAA97.5030808@rabbitmq.com> <4FBAAD57.5090106@rabbitmq.com>
	<4FBAAEBF.10000@rabbitmq.com>
Message-ID: <4FBAAFA4.1040006@rabbitmq.com>

On 21/05/12 22:08, Tim Watson wrote:
> Even with an OOM failure, we should at least be able to see an
> erl_crash.dump file somewhere.

I said 'oom *killer*'. http://lwn.net/Articles/317814/

Matthias.

From tim at rabbitmq.com  Mon May 21 22:17:10 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 21 May 2012 22:17:10 +0100
Subject: [rabbitmq-discuss] Silent crash causes persistent durable
 message loss
In-Reply-To: <4FBAAFA4.1040006@rabbitmq.com>
References: <8FF985CF-C086-41BE-9A6B-7A2EAD256BF6@thumb.it>
	<4FBAAA97.5030808@rabbitmq.com> <4FBAAD57.5090106@rabbitmq.com>
	<4FBAAEBF.10000@rabbitmq.com> <4FBAAFA4.1040006@rabbitmq.com>
Message-ID: <4FBAB0D6.3050203@rabbitmq.com>

On 21/05/2012 22:12, Matthias Radestock wrote:
> On 21/05/12 22:08, Tim Watson wrote:
>> Even with an OOM failure, we should at least be able to see an
>> erl_crash.dump file somewhere.
>
> I said 'oom *killer*'. http://lwn.net/Articles/317814/
>
> Matthias.

Owch, that's gotta hurt. What SIGNAL does OOM killer use? Can it provoke 
a regular core dump?

From matthias at rabbitmq.com  Mon May 21 22:24:35 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 21 May 2012 22:24:35 +0100
Subject: [rabbitmq-discuss] Silent crash causes persistent durable
 message loss
In-Reply-To: <4FBAB0D6.3050203@rabbitmq.com>
References: <8FF985CF-C086-41BE-9A6B-7A2EAD256BF6@thumb.it>
	<4FBAAA97.5030808@rabbitmq.com> <4FBAAD57.5090106@rabbitmq.com>
	<4FBAAEBF.10000@rabbitmq.com> <4FBAAFA4.1040006@rabbitmq.com>
	<4FBAB0D6.3050203@rabbitmq.com>
Message-ID: <4FBAB293.8030601@rabbitmq.com>

On 21/05/12 22:17, Tim Watson wrote:
> On 21/05/2012 22:12, Matthias Radestock wrote:
>> I said 'oom *killer*'. http://lwn.net/Articles/317814/
>
> Owch, that's gotta hurt. What SIGNAL does OOM killer use?

Googling suggests 15 or 9. Anyway, let's not turn this into an 'OOM 
killer' discussion thread. If OOM killer or a similar app took out 
Will's rabbit then there should be a record of that in the system logs.

Matthias.

From tim at rabbitmq.com  Mon May 21 22:29:18 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 21 May 2012 22:29:18 +0100
Subject: [rabbitmq-discuss] Silent crash causes persistent durable
 message loss
In-Reply-To: <4FBAB293.8030601@rabbitmq.com>
References: <8FF985CF-C086-41BE-9A6B-7A2EAD256BF6@thumb.it>
	<4FBAAA97.5030808@rabbitmq.com> <4FBAAD57.5090106@rabbitmq.com>
	<4FBAAEBF.10000@rabbitmq.com> <4FBAAFA4.1040006@rabbitmq.com>
	<4FBAB0D6.3050203@rabbitmq.com> <4FBAB293.8030601@rabbitmq.com>
Message-ID: <4FBAB3AE.2070306@rabbitmq.com>

On 21/05/2012 22:24, Matthias Radestock wrote:
> On 21/05/12 22:17, Tim Watson wrote:
>> On 21/05/2012 22:12, Matthias Radestock wrote:
>>> I said 'oom *killer*'. http://lwn.net/Articles/317814/
>>
>> Owch, that's gotta hurt. What SIGNAL does OOM killer use?
>
> Googling suggests 15 or 9. Anyway, let's not turn this into an 'OOM
> killer' discussion thread. If OOM killer or a similar app took out
> Will's rabbit then there should be a record of that in the system logs.
>
> Matthias.

Yeah, sorry for digressing. :)

From jose.mico at gmail.com  Mon May 21 23:48:01 2012
From: jose.mico at gmail.com (=?ISO-8859-1?Q?Jos=E9_Mic=F3?=)
Date: Mon, 21 May 2012 19:48:01 -0300
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of a
	burst
In-Reply-To: <D3224EFC-D5D5-46F6-BB3F-A030792ABF02@rabbitmq.com>
References: <4FB76237.7020901@gmail.com> <4FB81282.2020006@gmail.com>
	<D3224EFC-D5D5-46F6-BB3F-A030792ABF02@rabbitmq.com>
Message-ID: <4FBAC621.2070501@gmail.com>

On 05/21/2012 08:04 AM, Steve Powell wrote:
> So I installed Wireshark (are you familiar with this tool?) and looked
> at the message traffic. As far as I can see the last buffer is NOT sent
> to the broker from the perl app.

I installed Wireshark and done some captures while running the Python 
script that I've sent before, for bursts of 100 and 1000 messages, both 
for cases of successes and failures (captures attached). Note that sent 
messages are numbered starting from 0, so the last message of the burst 
are #99 or #999.

I can see in all captures that the last packet sent ends correctly on 
"00099/END" or "00999/END" followed by NIL. So, the Python script is 
actually sending all messages to RabbitMQ.

So, I think that...

- The data is sent to Rabbit.

- Rabbit receives all packets, because the last packet contains several 
messages, not only the last one.

- Rabbit *always* process correctly messages 00098 and 00998, so the 
parser receives the data of the last packet.

- The last message remains buffered somewhere (is not actually lost) but 
is not sent timely to the queue. If more data is sent later on the same 
connection, then that message is added to the queue. If connection is 
closed, the message is lost.

I guess that this is caused by a race condition, because the bug is not 
always triggered and only happens when the broker is stressed.

My next step would be to add some debug statements to 
process_received_bytes() in rabbit_stomp_server.erl, but I really have 
not clue about Erlang :-(


Jos?

-------------- next part --------------
A non-text attachment was scrubbed...
Name: stomp_bug_captures.tar.gz
Type: application/x-gzip
Size: 27773 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/6a7f7485/attachment.bin>

From jose.mico at gmail.com  Tue May 22 01:23:36 2012
From: jose.mico at gmail.com (=?ISO-8859-1?Q?Jos=E9_Mic=F3?=)
Date: Mon, 21 May 2012 21:23:36 -0300
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of a
	burst
In-Reply-To: <D3224EFC-D5D5-46F6-BB3F-A030792ABF02@rabbitmq.com>
References: <4FB76237.7020901@gmail.com> <4FB81282.2020006@gmail.com>
	<D3224EFC-D5D5-46F6-BB3F-A030792ABF02@rabbitmq.com>
Message-ID: <4FBADC88.2060705@gmail.com>

Forget my suggestion about process_received_bytes(), I was looking at 
the wrong repository, ha.

Well, here is attached the best test case I got so far: a Python script 
that sends very quickly 1001 messages, the first 1000 ones to queue 
"stomp_bug" and the last one to another queue "stomp_bug_last".

Running it several times, can be found that sometimes the last message 
is lost (and only the last message).
I've executed it 20 times, and got only 10 messages into queue 
"stomp_bug_last".

I looked at the actual source code in mercurial, and I really cannot 
help with that...


Jos?
-------------- next part --------------
A non-text attachment was scrubbed...
Name: stomp_bug_2.py
Type: text/x-python
Size: 1555 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/812e4e74/attachment.py>

From will at thumb.it  Tue May 22 01:46:43 2012
From: will at thumb.it (Will Koffel)
Date: Mon, 21 May 2012 20:46:43 -0400
Subject: [rabbitmq-discuss] Silent crash causes persistent durable
	message loss
In-Reply-To: <4FBAAD57.5090106@rabbitmq.com>
References: <8FF985CF-C086-41BE-9A6B-7A2EAD256BF6@thumb.it>
	<4FBAAA97.5030808@rabbitmq.com> <4FBAAD57.5090106@rabbitmq.com>
Message-ID: <A43B64B9-2834-4912-8775-B41C122334DA@thumb.it>

Thanks for the feedback guys, sorry for the slow reply back.

I took a look on the machine.  It's running on an Amazon Linux instance on EC2 (based on CentOS loosely).  I don't see anything at all related to oom-killer in logs.  Nor anything about rabbit.  I looked in dmesg, and everything in /var/log.

Amazon doesn't do memory monitoring with AWS CloudWatch (major downside, blech), so I can't see if there was any memory contention, but we've never seen any issues on those machines.  There's no CPU or disk spikes during that time to indicate anything else traumatic happening on the machine in question.

One long-shot idea at the application layer:  The daemons we run to consume those queues call "declare" on the relevant exchanges and queues on startup.  This has always been a convenient way to ensure the queues are alive before we start writing/reading them.  In the case where RabbitMQ crashes on us, the daemons start the cycle (they die, their parent process restarts them, they die again, etc.). 

Is there any case in which WHILE rabbit was starting up, it might accept a connection, which would instruct it to create the "expiring-queue", and then when it went to restore the persistent messages from disk, it would give up since the queue already existed?  Any sort of race condition that could bite us if there are clients thrashing away during start?  Or will RabbitMQ fail to accept any connections until it's cleanly started up?

-Will


On May 21, 2012, at 5:02 PM, Matthias Radestock wrote:

> On 21/05/12 21:50, Francesco Mazzoli wrote:
>> I have trouble believing that it is actually dying silently with no
>> information in the logs.
> 
> iirc we've seen this in the past with things like 'oom killer'. It is
> probably worth checking the system logs.
> 
>> In the meantime I'm going to do the obvious and suggest to upgrade to
>> 2.8.2. We fixed several ugly bugs related to DLX (one of which was
>> particularly easy to get) and they might be related to your problem.
> 
> I don't think any of the DLX bugs pre 2.8.2 would have brought down an
> entire rabbit, just individual queues.
> 
> Matthias.

________________
Will Koffel
CTO, Thumb?
51 E 12th St., 4th Floor
New York, NY 10003
Office: (212) 673-8650
Mobile: (617) 575-WILL
@thumb
www.thumb.it






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120521/20a55f60/attachment.htm>

From askgax at pchome.com.tw  Tue May 22 02:27:26 2012
From: askgax at pchome.com.tw (askgax)
Date: Mon, 21 May 2012 18:27:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq 2.8.2 with heartbeat/DRBD fail
In-Reply-To: <4FBA1659.4070407@rabbitmq.com>
References: <d5f7b883-4012-4354-a638-71145e1facf6@ki5g2000pbb.googlegroups.com>
	<4FB4D31B.9060500@rabbitmq.com> <4FBA1659.4070407@rabbitmq.com>
Message-ID: <33886528.post@talk.nabble.com>


Hi,

thanks for reply,


Emile Joubert-2 wrote:
> 
> Hi,
> 
> On 17/05/12 14:55, askgax wrote:
>> fsck 1.39 (29-May-2006)
>> /dev/drbd1: clean, 442/2621440 files, 127224/5242683 blocks
>> Filesystem[2991]:       2012/05/17_21:42:13 INFO:  Success
>> INFO:  Success
> 
>> fsck 1.39 (29-May-2006)
>> /dev/drbd1: clean, 863/10485760 files, 380283/20970783 blocks (check in 4
>> mounts)
>> Filesystem[9569]:       2012/05/17_18:09:31 INFO:  Success
>> INFO:  Success
> 
> Are you expecting the sizes for these partitions to be different?
> 
> the partitions size was the same,no  different
> 
> 
>> so i'm confuse in the same environment setting,why rabbitmq 2.8.2 can't
>> start with heartbeat takeover?
> 
> I don't see the "/etc/init.d/rabbitmq-server  start" line in the v2.8.2
> version. Can you confirm whether anything is written to the broker
> logfile at the time when it should be starting? I assume you are able to
> start the broker manually?
> 
> i check the mq process at that time is stop,so you can't see
> "/etc/init.d/rabbitmq-server  start" in log,
> broker logfile no any log,because mq service not start,but if i manual
> start rabbitmq,it can work,
> only 2.8.2 in heartbeat takeover ,mq service can't start automaticlly,
> 
> 
> -Emile
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Rabbitmq-2.8.2-with-heartbeat-DRBD-fail-tp33863293p33886528.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From support at cloudwebdns.com  Tue May 22 03:00:41 2012
From: support at cloudwebdns.com (Cloud DNS)
Date: Tue, 22 May 2012 10:00:41 +0800
Subject: [rabbitmq-discuss] rabbitmq was shutdown unwanted
Message-ID: <4FBAF349.2090201@cloudwebdns.com>

Hi,

My rabbitmq is running on Ubuntu 9.10 server 64bit.
The memory on this host is 16GB, CPU is two of Xeon E5410.
Last night rabbitmq got shutdown unwanted, the error log is:

# cat startup_err
Erlang has closed

Crash dump was written to: erl_crash.dump
eheap_alloc: Cannot allocate 4454408120 bytes of memory (of type "heap").
Aborted


After startup by hand, the current memory usage is:

# free -m
              total       used       free     shared    buffers     cached
Mem:         16077      15712        364          0         13      11437
-/+ buffers/cache:       4262      11814
Swap:         3812          5       3806


So please help why it got down? how to avoid it later?
We have rabbitmq in important application. Thanks.




From david.tinker at gmail.com  Tue May 22 07:34:13 2012
From: david.tinker at gmail.com (David Tinker)
Date: Tue, 22 May 2012 08:34:13 +0200
Subject: [rabbitmq-discuss] RabbitMQ server closing connection every few
	minutes
Message-ID: <CA+O6_Ff1LO4V-voUkY5-JvL5g8j56dnSd4QMJ9qvteVdn3Oi7A@mail.gmail.com>

Hi

We have a Java application using RabbitMQ that keeps getting its
connection closed by the server every few minutes. On the client side
we see this:

2012-05-22 05:30:05,337 [AMQP Connection 127.0.0.1:5671] ERROR
pork.RabbitService ?- Connection to Rabbit Exchange shutting down:
com.rabbitmq.client.ShutdownSignalException: connection error; reason:
java.net.SocketException: Connection reset
Reason: java.net.SocketException: Connection reset

On the server side we get this:

=INFO REPORT==== 22-May-2012::05:25:20 ===
accepting AMQP connection <0.32660.612> (127.0.0.1:45458 -> 127.0.0.1:5671)

=ERROR REPORT==== 22-May-2012::05:30:05 ===
closing AMQP connection <0.32660.612> (127.0.0.1:45458 -> 127.0.0.1:5671):
{timeout,running}

It happens more frequently when the system is busy (500-1000
messages/s) than when it is cruising (50 messages/s). The application
and RabbitMQ are on the same box so I don't think its a
networking/firewall problem.

The application only uses one connection and one channel. Messages are
received using Connection.basicConsume(..) and acked or nacked
sometime later on different threads. It can sometimes be several
minutes before a message is acked or nacked. We are using
Connection.basicQos(10000) to limit the number of outstanding messages
but its not often that reaches 10000 and the error happens anytime.
There is defensive code to make sure messages are not acked/nacked
more than once.

Anyone have any ideas? Is there any way to get more information on the
server or client side regarding the error?

RabbitMQ 2.8.1 on Gentoo Linux 64bit
Erlang R15B (erts-5.9) [source] [64-bit]
amqp-client-2.8.2 (also tried amqp-client-2.7.1)
java version "1.6.0_31"
Java(TM) SE Runtime Environment (build 1.6.0_31-b04)
Java HotSpot(TM) 64-Bit Server VM (build 20.6-b01, mixed mode)

Thanks
David

From tim at rabbitmq.com  Tue May 22 08:26:54 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 22 May 2012 08:26:54 +0100
Subject: [rabbitmq-discuss] Silent crash causes persistent durable
 message loss
In-Reply-To: <A43B64B9-2834-4912-8775-B41C122334DA@thumb.it>
References: <8FF985CF-C086-41BE-9A6B-7A2EAD256BF6@thumb.it>
	<4FBAAA97.5030808@rabbitmq.com> <4FBAAD57.5090106@rabbitmq.com>
	<A43B64B9-2834-4912-8775-B41C122334DA@thumb.it>
Message-ID: <4FBB3FBE.5060204@rabbitmq.com>

On 22/05/2012 01:46, Will Koffel wrote:
> Thanks for the feedback guys, sorry for the slow reply back.
>
> I took a look on the machine. It's running on an Amazon Linux instance
> on EC2 (based on CentOS loosely). I don't see anything at all related to
> oom-killer in logs. Nor anything about rabbit. I looked in dmesg, and
> everything in /var/log.
>
> Amazon doesn't do memory monitoring with AWS CloudWatch (major downside,
> blech), so I can't see if there was any memory contention, but we've
> never seen any issues on those machines. There's no CPU or disk spikes
> during that time to indicate anything else traumatic happening on the
> machine in question.
>
> One long-shot idea at the application layer: The daemons we run to
> consume those queues call "declare" on the relevant exchanges and queues
> on startup. This has always been a convenient way to ensure the queues
> are alive before we start writing/reading them. In the case where
> RabbitMQ crashes on us, the daemons start the cycle (they die, their
> parent process restarts them, they die again, etc.).
>
> Is there any case in which WHILE rabbit was starting up, it might accept
> a connection, which would instruct it to create the "expiring-queue",
> and then when it went to restore the persistent messages from disk, it
> would give up since the queue already existed? Any sort of race
> condition that could bite us if there are clients thrashing away during
> start? Or will RabbitMQ fail to accept any connections until it's
> cleanly started up?
>

Hi Will. Rabbit's networking sub-system only comes online after 
everything else is ready, plus the boot sequence is entirely sequential, 
so I'd be very surprised if this was a race on startup. Having said 
that, I'll verify that none of the boot steps run out of band and 
confirm this morning.

> -Will
>
>
> On May 21, 2012, at 5:02 PM, Matthias Radestock wrote:
>
>> On 21/05/12 21:50, Francesco Mazzoli wrote:
>>> I have trouble believing that it is actually dying silently with no
>>> information in the logs.
>>
>> iirc we've seen this in the past with things like 'oom killer'. It is
>> probably worth checking the system logs.
>>
>>> In the meantime I'm going to do the obvious and suggest to upgrade to
>>> 2.8.2. We fixed several ugly bugs related to DLX (one of which was
>>> particularly easy to get) and they might be related to your problem.
>>
>> I don't think any of the DLX bugs pre 2.8.2 would have brought down an
>> entire rabbit, just individual queues.
>>
>> Matthias.
>
> ________________
> Will Koffel
> CTO, Thumb?
> 51 E 12th St., 4th Floor
> New York, NY 10003
> Office: (212) 673-8650
> Mobile: (617) 575-WILL
> @thumb
> www.thumb.it <http://www.thumb.it/>
>
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Tue May 22 08:30:27 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 22 May 2012 08:30:27 +0100
Subject: [rabbitmq-discuss] rabbitmq was shutdown unwanted
In-Reply-To: <4FBAF349.2090201@cloudwebdns.com>
References: <4FBAF349.2090201@cloudwebdns.com>
Message-ID: <4FBB4093.7080704@rabbitmq.com>

On 22/05/2012 03:00, Cloud DNS wrote:
> Hi,
>
> My rabbitmq is running on Ubuntu 9.10 server 64bit.
> The memory on this host is 16GB, CPU is two of Xeon E5410.
> Last night rabbitmq got shutdown unwanted, the error log is:
>
> # cat startup_err
> Erlang has closed
>
> Crash dump was written to: erl_crash.dump
> eheap_alloc: Cannot allocate 4454408120 bytes of memory (of type "heap").
> Aborted
>
>
> After startup by hand, the current memory usage is:
>
> # free -m
> total used free shared buffers cached
> Mem: 16077 15712 364 0 13 11437
> -/+ buffers/cache: 4262 11814
> Swap: 3812 5 3806
>
>
> So please help why it got down? how to avoid it later?
> We have rabbitmq in important application. Thanks.
>

Well your rabbit has 'run out of memory' - or to be more precise, the OS 
is unable to provide allocation so the Erlang runtime has shut down.

It's not clear from `free -m` what is really going on, but just checking 
after startup is probably insufficient to tell you anything. Perhaps 
running `ps` or `top` whilst rabbit is *busy* will tell you more. You 
can also use the management plugin or `rabbitmqctl status` on the 
command line to get more information about rabbit's memory usage.

I would also suggest reading through http://www.rabbitmq.com/memory.html 
to help get an idea of what kind of tuning facilities are available.

Cheers,
Tim

>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Tue May 22 08:48:19 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 22 May 2012 08:48:19 +0100
Subject: [rabbitmq-discuss] RabbitMQ server closing connection every few
 minutes
In-Reply-To: <CA+O6_Ff1LO4V-voUkY5-JvL5g8j56dnSd4QMJ9qvteVdn3Oi7A@mail.gmail.com>
References: <CA+O6_Ff1LO4V-voUkY5-JvL5g8j56dnSd4QMJ9qvteVdn3Oi7A@mail.gmail.com>
Message-ID: <4FBB44C3.9000106@rabbitmq.com>

On 22/05/2012 07:34, David Tinker wrote:
> Hi
>
> We have a Java application using RabbitMQ that keeps getting its
> connection closed by the server every few minutes. On the client side
> we see this:
>
> 2012-05-22 05:30:05,337 [AMQP Connection 127.0.0.1:5671] ERROR
> pork.RabbitService  - Connection to Rabbit Exchange shutting down:
> com.rabbitmq.client.ShutdownSignalException: connection error; reason:
> java.net.SocketException: Connection reset
> Reason: java.net.SocketException: Connection reset
>
> On the server side we get this:
>
> =INFO REPORT==== 22-May-2012::05:25:20 ===
> accepting AMQP connection<0.32660.612>  (127.0.0.1:45458 ->  127.0.0.1:5671)
>
> =ERROR REPORT==== 22-May-2012::05:30:05 ===
> closing AMQP connection<0.32660.612>  (127.0.0.1:45458 ->  127.0.0.1:5671):
> {timeout,running}
>

Hi David. The second error message will appear in the logs when there 
has been an un-handled exception in rabbit's 'reader process'. The 
'{timeout, running}' state occurs when receiving data from the network 
takes too long (which is where the 'timeout' tag originates) but the 
AMQP connection state is 'running' - the second tag. When this condition 
arises, the broker's reader process shuts down the connection.

So at first glance, it does look like a networking problem to me, 
although TBH I'm not sure about the nature of it just yet. I suspect it 
could have something to do with "... It can sometimes be several minutes 
before a message is acked or nacked ...".

> It happens more frequently when the system is busy (500-1000
> messages/s) than when it is cruising (50 messages/s). The application
> and RabbitMQ are on the same box so I don't think its a
> networking/firewall problem.
>
> The application only uses one connection and one channel. Messages are
> received using Connection.basicConsume(..) and acked or nacked
> sometime later on different threads. It can sometimes be several
> minutes before a message is acked or nacked. We are using
> Connection.basicQos(10000) to limit the number of outstanding messages
> but its not often that reaches 10000 and the error happens anytime.
> There is defensive code to make sure messages are not acked/nacked
> more than once.
>
> Anyone have any ideas? Is there any way to get more information on the
> server or client side regarding the error?
>

Well the server error seems pretty clear and just to be 100% sure, I can 
verify that the error message you're seeing is only generated in one 
place in the whole code base: 
https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_reader.erl#L241.

The code handling the timeout condition is 
https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_reader.erl#L321, 
the call site for which is 
https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_reader.erl#L284. 
The origin of this is 
https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_net.erl#L108 
in rabbit_net - what the code does is make the calling process wait for 
a message from the Erlang networking layer. So it is the underlying 
TCP/IP layer in Erlang which is noticing a timeout on the connection.

How this is mediated through the client's behaviour is another matter.

Hope this helps us get started figuring out what's wrong!

Cheers,
Tim

> RabbitMQ 2.8.1 on Gentoo Linux 64bit
> Erlang R15B (erts-5.9) [source] [64-bit]
> amqp-client-2.8.2 (also tried amqp-client-2.7.1)
> java version "1.6.0_31"
> Java(TM) SE Runtime Environment (build 1.6.0_31-b04)
> Java HotSpot(TM) 64-Bit Server VM (build 20.6-b01, mixed mode)
>
> Thanks
> David
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Tue May 22 09:00:49 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 22 May 2012 09:00:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ server closing connection every few
 minutes
In-Reply-To: <4FBB44C3.9000106@rabbitmq.com>
References: <CA+O6_Ff1LO4V-voUkY5-JvL5g8j56dnSd4QMJ9qvteVdn3Oi7A@mail.gmail.com>
	<4FBB44C3.9000106@rabbitmq.com>
Message-ID: <4FBB47B1.8060806@rabbitmq.com>

On 22/05/2012 08:48, Tim Watson wrote:
> On 22/05/2012 07:34, David Tinker wrote:
>> Hi
>>
>> We have a Java application using RabbitMQ that keeps getting its
>> connection closed by the server every few minutes. On the client side
>> we see this:
>>
>> 2012-05-22 05:30:05,337 [AMQP Connection 127.0.0.1:5671] ERROR
>> pork.RabbitService - Connection to Rabbit Exchange shutting down:
>> com.rabbitmq.client.ShutdownSignalException: connection error; reason:
>> java.net.SocketException: Connection reset
>> Reason: java.net.SocketException: Connection reset
>>
>> On the server side we get this:
>>
>> =INFO REPORT==== 22-May-2012::05:25:20 ===
>> accepting AMQP connection<0.32660.612> (127.0.0.1:45458 ->
>> 127.0.0.1:5671)
>>
>> =ERROR REPORT==== 22-May-2012::05:30:05 ===
>> closing AMQP connection<0.32660.612> (127.0.0.1:45458 -> 127.0.0.1:5671):
>> {timeout,running}
>>
>
> Hi David. The second error message will appear in the logs when there
> has been an un-handled exception in rabbit's 'reader process'. The
> '{timeout, running}' state occurs when receiving data from the network
> takes too long (which is where the 'timeout' tag originates) but the
> AMQP connection state is 'running' - the second tag. When this condition
> arises, the broker's reader process shuts down the connection.
>
> So at first glance, it does look like a networking problem to me,
> although TBH I'm not sure about the nature of it just yet. I suspect it
> could have something to do with "... It can sometimes be several minutes
> before a message is acked or nacked ...".
>
>> It happens more frequently when the system is busy (500-1000
>> messages/s) than when it is cruising (50 messages/s). The application
>> and RabbitMQ are on the same box so I don't think its a
>> networking/firewall problem.
>>
>> The application only uses one connection and one channel. Messages are
>> received using Connection.basicConsume(..) and acked or nacked
>> sometime later on different threads. It can sometimes be several
>> minutes before a message is acked or nacked. We are using
>> Connection.basicQos(10000) to limit the number of outstanding messages
>> but its not often that reaches 10000 and the error happens anytime.
>> There is defensive code to make sure messages are not acked/nacked
>> more than once.
>>
>> Anyone have any ideas? Is there any way to get more information on the
>> server or client side regarding the error?
>>
>
> Well the server error seems pretty clear and just to be 100% sure, I can
> verify that the error message you're seeing is only generated in one
> place in the whole code base:
> https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_reader.erl#L241.
>
>

Except that this isn't quite as clear as I suggested initially. The 
networking layer isn't going to send a timeout on a blocking receive 
like this - the 'timeout' message is being sent to the reader from some 
other process. I will investigate further! :)

> The code handling the timeout condition is
> https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_reader.erl#L321,
> the call site for which is
> https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_reader.erl#L284.
> The origin of this is
> https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_net.erl#L108
> in rabbit_net - what the code does is make the calling process wait for
> a message from the Erlang networking layer. So it is the underlying
> TCP/IP layer in Erlang which is noticing a timeout on the connection.
>
> How this is mediated through the client's behaviour is another matter.
>
> Hope this helps us get started figuring out what's wrong!
>
> Cheers,
> Tim
>
>> RabbitMQ 2.8.1 on Gentoo Linux 64bit
>> Erlang R15B (erts-5.9) [source] [64-bit]
>> amqp-client-2.8.2 (also tried amqp-client-2.7.1)
>> java version "1.6.0_31"
>> Java(TM) SE Runtime Environment (build 1.6.0_31-b04)
>> Java HotSpot(TM) 64-Bit Server VM (build 20.6-b01, mixed mode)
>>
>> Thanks
>> David
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Tue May 22 09:25:51 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 22 May 2012 09:25:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ server closing connection every few
 minutes
In-Reply-To: <4FBB47B1.8060806@rabbitmq.com>
References: <CA+O6_Ff1LO4V-voUkY5-JvL5g8j56dnSd4QMJ9qvteVdn3Oi7A@mail.gmail.com>
	<4FBB44C3.9000106@rabbitmq.com> <4FBB47B1.8060806@rabbitmq.com>
Message-ID: <4FBB4D8F.2030205@rabbitmq.com>

On 22/05/2012 09:00, Tim Watson wrote:
> On 22/05/2012 08:48, Tim Watson wrote:
>> On 22/05/2012 07:34, David Tinker wrote:
>>> Hi
>>>
>>> We have a Java application using RabbitMQ that keeps getting its
>>> connection closed by the server every few minutes. On the client side
>>> we see this:
>>>
>>> 2012-05-22 05:30:05,337 [AMQP Connection 127.0.0.1:5671] ERROR
>>> pork.RabbitService - Connection to Rabbit Exchange shutting down:
>>> com.rabbitmq.client.ShutdownSignalException: connection error; reason:
>>> java.net.SocketException: Connection reset
>>> Reason: java.net.SocketException: Connection reset
>>>
>>> On the server side we get this:
>>>
>>> =INFO REPORT==== 22-May-2012::05:25:20 ===
>>> accepting AMQP connection<0.32660.612> (127.0.0.1:45458 ->
>>> 127.0.0.1:5671)
>>>
>>> =ERROR REPORT==== 22-May-2012::05:30:05 ===
>>> closing AMQP connection<0.32660.612> (127.0.0.1:45458 ->
>>> 127.0.0.1:5671):
>>> {timeout,running}
>>>
>>
>> Hi David. The second error message will appear in the logs when there
>> has been an un-handled exception in rabbit's 'reader process'. The
>> '{timeout, running}' state occurs when receiving data from the network
>> takes too long (which is where the 'timeout' tag originates) but the
>> AMQP connection state is 'running' - the second tag. When this condition
>> arises, the broker's reader process shuts down the connection.
>>
>> So at first glance, it does look like a networking problem to me,
>> although TBH I'm not sure about the nature of it just yet. I suspect it
>> could have something to do with "... It can sometimes be several minutes
>> before a message is acked or nacked ...".
>>
>>> It happens more frequently when the system is busy (500-1000
>>> messages/s) than when it is cruising (50 messages/s). The application
>>> and RabbitMQ are on the same box so I don't think its a
>>> networking/firewall problem.
>>>
>>> The application only uses one connection and one channel. Messages are
>>> received using Connection.basicConsume(..) and acked or nacked
>>> sometime later on different threads. It can sometimes be several
>>> minutes before a message is acked or nacked. We are using
>>> Connection.basicQos(10000) to limit the number of outstanding messages
>>> but its not often that reaches 10000 and the error happens anytime.
>>> There is defensive code to make sure messages are not acked/nacked
>>> more than once.
>>>
>>> Anyone have any ideas? Is there any way to get more information on the
>>> server or client side regarding the error?
>>>
>>
>> Well the server error seems pretty clear and just to be 100% sure, I can
>> verify that the error message you're seeing is only generated in one
>> place in the whole code base:
>> https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_reader.erl#L241.
>>
>>
>>
>
> Except that this isn't quite as clear as I suggested initially. The
> networking layer isn't going to send a timeout on a blocking receive
> like this - the 'timeout' message is being sent to the reader from some
> other process. I will investigate further! :)
>

Ok so I think I've identified the source of this behaviour. The 
'timeout' message is sent to the reader process by the AMQP heartbeat - 
a separate out of band process that is monitoring for 'stale' 
connections using heartbeat frames (see 
http://www.rabbitmq.com/amqp-0-9-1-reference.html for details).

What I believe is happening is that as the server comes under load, the 
heartbeat for this connection is de-prioritised at the network layer and 
times out, causing the connection to be closed.

Set your heartbeat to 0 (turning it off) for now and see if it fixes the 
problem? That's a short term investigative step though, obviously.

I'll file a bug for improving the log messages when timeout occurs.

>> The code handling the timeout condition is
>> https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_reader.erl#L321,
>>
>> the call site for which is
>> https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_reader.erl#L284.
>>
>> The origin of this is
>> https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_net.erl#L108
>>
>> in rabbit_net - what the code does is make the calling process wait for
>> a message from the Erlang networking layer. So it is the underlying
>> TCP/IP layer in Erlang which is noticing a timeout on the connection.
>>
>> How this is mediated through the client's behaviour is another matter.
>>
>> Hope this helps us get started figuring out what's wrong!
>>
>> Cheers,
>> Tim
>>
>>> RabbitMQ 2.8.1 on Gentoo Linux 64bit
>>> Erlang R15B (erts-5.9) [source] [64-bit]
>>> amqp-client-2.8.2 (also tried amqp-client-2.7.1)
>>> java version "1.6.0_31"
>>> Java(TM) SE Runtime Environment (build 1.6.0_31-b04)
>>> Java HotSpot(TM) 64-Bit Server VM (build 20.6-b01, mixed mode)
>>>
>>> Thanks
>>> David
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Tue May 22 10:34:50 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 22 May 2012 10:34:50 +0100
Subject: [rabbitmq-discuss] Rabbitmq 2.8.2 with heartbeat/DRBD fail
In-Reply-To: <33886528.post@talk.nabble.com>
References: <d5f7b883-4012-4354-a638-71145e1facf6@ki5g2000pbb.googlegroups.com>
	<4FB4D31B.9060500@rabbitmq.com> <4FBA1659.4070407@rabbitmq.com>
	<33886528.post@talk.nabble.com>
Message-ID: <4FBB5DBA.6070203@rabbitmq.com>

Hi,

On 22/05/12 02:27, askgax wrote:
>> i check the mq process at that time is stop,so you can't see
>> "/etc/init.d/rabbitmq-server  start" in log,
>> broker logfile no any log,because mq service not start,but if i manual
>> start rabbitmq,it can work,
>> only 2.8.2 in heartbeat takeover ,mq service can't start automaticlly,

There were changes to the RabbitMQ startup scripts between the versions
you are comparing. This is a possible cause for the difference in
behaviour you are observing. If you needed to make adjustments to ensure
that the broker does not start automatically when the OS starts up then
you will have to repeat those adjustments for v2.8.2.


-Emile



From steve at rabbitmq.com  Tue May 22 10:38:08 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 22 May 2012 10:38:08 +0100
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of a
	burst
In-Reply-To: <4FBADC88.2060705@gmail.com>
References: <4FB76237.7020901@gmail.com> <4FB81282.2020006@gmail.com>
	<D3224EFC-D5D5-46F6-BB3F-A030792ABF02@rabbitmq.com>
	<4FBADC88.2060705@gmail.com>
Message-ID: <A2CF3269-B4F5-4D6A-BDD2-631BFEEC6206@rabbitmq.com>

Jos?,

Thank you for all the investigation you are doing. I have caught up and
yesterday convinced myself that it is indeed our bug. The Wireshark
traces confirm that all the messages are actually sent. I have produced
my own version of your testcase with numbered messages to test which
ones fail to get through. I've also ended the app with a DISCONNECT, but
still we lose one of the messages.

I'm going to look more closely at the STOMP stuff, and have raised a bug
(24957) to track this internally. I'll get back to you as soon as I find
out where this is getting lost.

Incidentally, it is apparently the last message in a packet that is not
being picked up, and it is not obvious why this should be so. Putting
the DISCONNECT on the end I thought would cure it, but it didn't; which
is very strange. Of course, I don't wait for a receipt on the
DISCONNECT; but closing too soon is not the problem.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 22 May 2012, at 01:23, Jos? Mic? wrote:

> Forget my suggestion about process_received_bytes(), I was looking at the wrong repository, ha.
> 
> Well, here is attached the best test case I got so far: a Python script that sends very quickly 1001 messages, the first 1000 ones to queue "stomp_bug" and the last one to another queue "stomp_bug_last".
> 
> Running it several times, can be found that sometimes the last message is lost (and only the last message).
> I've executed it 20 times, and got only 10 messages into queue "stomp_bug_last".
> 
> I looked at the actual source code in mercurial, and I really cannot help with that...
> 
> 
> Jos?
> <stomp_bug_2.py>


From support at cloudwebdns.com  Tue May 22 10:50:52 2012
From: support at cloudwebdns.com (Cloud DNS)
Date: Tue, 22 May 2012 17:50:52 +0800
Subject: [rabbitmq-discuss] rabbitmq was shutdown unwanted
In-Reply-To: <4FBB4093.7080704@rabbitmq.com>
References: <4FBAF349.2090201@cloudwebdns.com> <4FBB4093.7080704@rabbitmq.com>
Message-ID: <4FBB617C.3050107@cloudwebdns.com>

Hi,

My current memory usage with top:


   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND 

  1161 rabbitmq  20   0 6203m 5.4g 2360 S   25 34.4 213:07.12 beam.smp


The queues number:

# rabbitmqctl -p /somepath list_queues
Listing queues ...
queue_storm_actionlog   0
dev_queue_storm_actionlog       1607487


The status shows:

  {running_applications,[{rabbit,"RabbitMQ","2.7.0"},
                         {os_mon,"CPO  CXC 138 46","2.2.2"},
                         {sasl,"SASL  CXC 138 11","2.1.6"},
                         {mnesia,"MNESIA  CXC 138 12","4.4.10"},
                         {stdlib,"ERTS  CXC 138 10","1.16.2"},
                         {kernel,"ERTS  CXC 138 10","2.13.2"}]},
  {os,{unix,linux}},
  {erlang_version,"Erlang R13B01 (erts-5.7.2) [source] [64-bit] 
[smp:8:8] [rq:8] [async-threads:30] [kernel-poll:true]\n"},
  {memory,[{total,6124614216},
           {processes,4058585384},
           {processes_used,4058271696},
           {system,2066028832},
           {atom,1101009},
           {atom_used,1088876},
           {binary,1769349912},
           {code,11719137},
           {ets,281219504}]},
  {vm_memory_high_watermark,0.6},
  {vm_memory_limit,10114781184}]


Do you have any further suggestion? thanks.



> On 22/05/2012 03:00, Cloud DNS wrote:
>> Hi,
>>
>> My rabbitmq is running on Ubuntu 9.10 server 64bit.
>> The memory on this host is 16GB, CPU is two of Xeon E5410.
>> Last night rabbitmq got shutdown unwanted, the error log is:
>>
>> # cat startup_err
>> Erlang has closed
>>
>> Crash dump was written to: erl_crash.dump
>> eheap_alloc: Cannot allocate 4454408120 bytes of memory (of type "heap").
>> Aborted
>>
>>
>> After startup by hand, the current memory usage is:
>>
>> # free -m
>> total used free shared buffers cached
>> Mem: 16077 15712 364 0 13 11437
>> -/+ buffers/cache: 4262 11814
>> Swap: 3812 5 3806
>>
>>
>> So please help why it got down? how to avoid it later?
>> We have rabbitmq in important application. Thanks.
>>
>
> Well your rabbit has 'run out of memory' - or to be more precise, the OS
> is unable to provide allocation so the Erlang runtime has shut down.
>
> It's not clear from `free -m` what is really going on, but just checking
> after startup is probably insufficient to tell you anything. Perhaps
> running `ps` or `top` whilst rabbit is *busy* will tell you more. You
> can also use the management plugin or `rabbitmqctl status` on the
> command line to get more information about rabbit's memory usage.
>
> I would also suggest reading through http://www.rabbitmq.com/memory.html
> to help get an idea of what kind of tuning facilities are available.
>
> Cheers,
> Tim
>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From steve at rabbitmq.com  Tue May 22 10:49:59 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 22 May 2012 10:49:59 +0100
Subject: [rabbitmq-discuss] unable to join cluster - mnesia func aborted
In-Reply-To: <f60e2565-3189-4ccc-b5b5-b4f0a4d58193@googlegroups.com>
References: <f60e2565-3189-4ccc-b5b5-b4f0a4d58193@googlegroups.com>
Message-ID: <EF6FEB78-96FE-4754-8A1B-30491535B084@rabbitmq.com>

Rader Lei,

The most obvious problem that might cause this is a mismatch in the
versions of Erlang (or RabbitMQ).

Can you check that they are the same? It is likely that the Ubuntu
version of Erlang is older.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 21 May 2012, at 08:13, Rader Lei wrote:

> i have a cluster of 3 rabbimtmq servers on windows 2008 and 2003. they works fine. Then I set up a rabbitmq server on Ubuntu 11. when i try to add the new rabbitmq node into the cluster, i get an error - "unable to join the cluster". The log file looks fine, no error message. I can access the cluster master node with command "rabbitmqctl -n rabbit at CNCDS131 status". I have no idea why this error happen:( 
> 
> 
> Here is the error:
> leid at yud-vm:~$ sudo rabbitmqctl cluster rabbit at CNCDS131
> Clustering node 'rabbit at yud-vm' with [rabbit at CNCDS131] ...
> Error: {unable_to_join_cluster,
>            [rabbit at CNCDS131],
>            {aborted,
>                {function_clause,
>                    [{mnesia_schema,cs2list,
>                         [{cstruct,schema,set,
>                              [rabbit at STARS110,rabbit at CNCDS108],
>                              [rabbit at CNCDS131],
>                              [],0,read_write,false,[],[],false,schema,
>                              [table,cstruct],
>                              [],[],[],
>                              {{1336,728415,425002},rabbit at CNCDS131},
>                              {{24,0},
>                               {rabbit at CNCDS131,{1337,582820,591922}}}}]},
>                     {mnesia_schema,do_merge_schema,0},
>                     {mnesia_tm,apply_fun,3},
>                     {mnesia_tm,execute_transaction,5},
>                     {mnesia_schema,schema_coordinator,3}]}}}
> Here is the log:
> =INFO REPORT==== 21-May-2012::15:08:16 ===
> Clustering with [rabbit at CNCDS131]
> 
> =INFO REPORT==== 21-May-2012::15:08:16 ===
>     application: mnesia
>     exited: stopped
>     type: temporary
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From support at cloudwebdns.com  Tue May 22 10:53:36 2012
From: support at cloudwebdns.com (Cloud DNS)
Date: Tue, 22 May 2012 17:53:36 +0800
Subject: [rabbitmq-discuss] rabbitmq for HA
Message-ID: <4FBB6220.8070207@cloudwebdns.com>

Hi,

Is there a brief step-to-step document for setup the rabbitmq cluster 
and HA application?

Current I am running two of the rabbitmq with cluster, but the queues 
are not mirrored between them, that means when one shutdown, the queques 
within it will be not accessable.

Thanks.


From francesco at rabbitmq.com  Tue May 22 10:53:24 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 22 May 2012 10:53:24 +0100
Subject: [rabbitmq-discuss] rabbitmq for HA
In-Reply-To: <4FBB6220.8070207@cloudwebdns.com>
References: <4FBB6220.8070207@cloudwebdns.com>
Message-ID: <4FBB6214.6090906@rabbitmq.com>

http://www.rabbitmq.com/ha.html

Francesco.

On 22/05/12 10:53, Cloud DNS wrote:
> Hi,
>
> Is there a brief step-to-step document for setup the rabbitmq cluster
> and HA application?
>
> Current I am running two of the rabbitmq with cluster, but the queues
> are not mirrored between them, that means when one shutdown, the queques
> within it will be not accessable.
>
> Thanks.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From support at cloudwebdns.com  Tue May 22 11:09:23 2012
From: support at cloudwebdns.com (Cloud DNS)
Date: Tue, 22 May 2012 18:09:23 +0800
Subject: [rabbitmq-discuss] rabbitmq for HA
In-Reply-To: <4FBB6214.6090906@rabbitmq.com>
References: <4FBB6220.8070207@cloudwebdns.com> <4FBB6214.6090906@rabbitmq.com>
Message-ID: <4FBB65D3.4040900@cloudwebdns.com>

I have read it for three times, but don't understand for it...
so if there is a step-to-step document it would be better.
thanks.


> http://www.rabbitmq.com/ha.html
>
> Francesco.
>
> On 22/05/12 10:53, Cloud DNS wrote:
>> Hi,
>>
>> Is there a brief step-to-step document for setup the rabbitmq cluster
>> and HA application?
>>
>> Current I am running two of the rabbitmq with cluster, but the queues
>> are not mirrored between them, that means when one shutdown, the queques
>> within it will be not accessable.
>>
>> Thanks.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From francesco at rabbitmq.com  Tue May 22 11:16:00 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 22 May 2012 11:16:00 +0100
Subject: [rabbitmq-discuss] rabbitmq for HA
In-Reply-To: <4FBB65D3.4040900@cloudwebdns.com>
References: <4FBB6220.8070207@cloudwebdns.com> <4FBB6214.6090906@rabbitmq.com>
	<4FBB65D3.4040900@cloudwebdns.com>
Message-ID: <4FBB6760.3030906@rabbitmq.com>

If you have set up a cluster, the only thing you need to do to create an 
HA queue is to pass the arguments described here: 
http://www.rabbitmq.com/ha.html#genesis when declaring the queue. How 
exactly to do this will the depend on the AMQP client you are using, 
that paragraph includes an example using the Java client. Are you having 
any specific problems?

Francesco.

On 22/05/12 11:09, Cloud DNS wrote:
> I have read it for three times, but don't understand for it...
> so if there is a step-to-step document it would be better.
> thanks.
>
>
>> http://www.rabbitmq.com/ha.html
>>
>> Francesco.
>>
>> On 22/05/12 10:53, Cloud DNS wrote:
>>> Hi,
>>>
>>> Is there a brief step-to-step document for setup the rabbitmq cluster
>>> and HA application?
>>>
>>> Current I am running two of the rabbitmq with cluster, but the queues
>>> are not mirrored between them, that means when one shutdown, the queques
>>> within it will be not accessable.
>>>
>>> Thanks.
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>


From support at cloudwebdns.com  Tue May 22 11:22:12 2012
From: support at cloudwebdns.com (Cloud DNS)
Date: Tue, 22 May 2012 18:22:12 +0800
Subject: [rabbitmq-discuss] rabbitmq for HA
In-Reply-To: <4FBB6760.3030906@rabbitmq.com>
References: <4FBB6220.8070207@cloudwebdns.com> <4FBB6214.6090906@rabbitmq.com>
	<4FBB65D3.4040900@cloudwebdns.com> <4FBB6760.3030906@rabbitmq.com>
Message-ID: <4FBB68D4.1090301@cloudwebdns.com>


> If you have set up a cluster, the only thing you need to do to create an
> HA queue is to pass the arguments described here:
> http://www.rabbitmq.com/ha.html#genesis when declaring the queue. How
> exactly to do this will the depend on the AMQP client you are using,
> that paragraph includes an example using the Java client. Are you having
> any specific problems?


Thanks for the reply.
Yes we are using Java client for accessing to RabbitMQ.
If the queues have been created and exist there already, can I convert 
them to mirrored queues?

Thanks.


From matthew at rabbitmq.com  Tue May 22 11:24:52 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 22 May 2012 11:24:52 +0100
Subject: [rabbitmq-discuss] rabbitmq for HA
In-Reply-To: <4FBB68D4.1090301@cloudwebdns.com>
References: <4FBB6220.8070207@cloudwebdns.com> <4FBB6214.6090906@rabbitmq.com>
	<4FBB65D3.4040900@cloudwebdns.com> <4FBB6760.3030906@rabbitmq.com>
	<4FBB68D4.1090301@cloudwebdns.com>
Message-ID: <20120522102451.GA13238@rabbitmq.com>

On Tue, May 22, 2012 at 06:22:12PM +0800, Cloud DNS wrote:
> Yes we are using Java client for accessing to RabbitMQ.
> If the queues have been created and exist there already, can I
> convert them to mirrored queues?

Nope, sorry. Create new mirrored queues, then shuffle the contents of
existing queues over if you want - shovel can help with this. Depends
how much you care about your existing msgs.

Matthew

From david.tinker at gmail.com  Tue May 22 11:28:14 2012
From: david.tinker at gmail.com (David Tinker)
Date: Tue, 22 May 2012 12:28:14 +0200
Subject: [rabbitmq-discuss] RabbitMQ server closing connection every few
	minutes
In-Reply-To: <4FBB4D8F.2030205@rabbitmq.com>
References: <CA+O6_Ff1LO4V-voUkY5-JvL5g8j56dnSd4QMJ9qvteVdn3Oi7A@mail.gmail.com>
	<4FBB44C3.9000106@rabbitmq.com> <4FBB47B1.8060806@rabbitmq.com>
	<4FBB4D8F.2030205@rabbitmq.com>
Message-ID: <CA+O6_Fccoe--GaqCYJuqLWmSjoTiH72F85eFsk5CObmovh+x7g@mail.gmail.com>

Thanks a stack for the quick responses. I did find mentions of
heartbeat when Googling this problem but was under the impression that
we were not using it. It turns out we were and disabling it sorted out
our issues.

Thanks again
David

On Tue, May 22, 2012 at 10:25 AM, Tim Watson <tim at rabbitmq.com> wrote:
> On 22/05/2012 09:00, Tim Watson wrote:
>>
>> On 22/05/2012 08:48, Tim Watson wrote:
>>>
>>> On 22/05/2012 07:34, David Tinker wrote:
>>>>
>>>> Hi
>>>>
>>>> We have a Java application using RabbitMQ that keeps getting its
>>>> connection closed by the server every few minutes. On the client side
>>>> we see this:
>>>>
>>>> 2012-05-22 05:30:05,337 [AMQP Connection 127.0.0.1:5671] ERROR
>>>> pork.RabbitService - Connection to Rabbit Exchange shutting down:
>>>> com.rabbitmq.client.ShutdownSignalException: connection error; reason:
>>>> java.net.SocketException: Connection reset
>>>> Reason: java.net.SocketException: Connection reset
>>>>
>>>> On the server side we get this:
>>>>
>>>> =INFO REPORT==== 22-May-2012::05:25:20 ===
>>>> accepting AMQP connection<0.32660.612> (127.0.0.1:45458 ->
>>>> 127.0.0.1:5671)
>>>>
>>>> =ERROR REPORT==== 22-May-2012::05:30:05 ===
>>>> closing AMQP connection<0.32660.612> (127.0.0.1:45458 ->
>>>> 127.0.0.1:5671):
>>>> {timeout,running}
>>>>
>>>
>>> Hi David. The second error message will appear in the logs when there
>>> has been an un-handled exception in rabbit's 'reader process'. The
>>> '{timeout, running}' state occurs when receiving data from the network
>>> takes too long (which is where the 'timeout' tag originates) but the
>>> AMQP connection state is 'running' - the second tag. When this condition
>>> arises, the broker's reader process shuts down the connection.
>>>
>>> So at first glance, it does look like a networking problem to me,
>>> although TBH I'm not sure about the nature of it just yet. I suspect it
>>> could have something to do with "... It can sometimes be several minutes
>>> before a message is acked or nacked ...".
>>>
>>>> It happens more frequently when the system is busy (500-1000
>>>> messages/s) than when it is cruising (50 messages/s). The application
>>>> and RabbitMQ are on the same box so I don't think its a
>>>> networking/firewall problem.
>>>>
>>>> The application only uses one connection and one channel. Messages are
>>>> received using Connection.basicConsume(..) and acked or nacked
>>>> sometime later on different threads. It can sometimes be several
>>>> minutes before a message is acked or nacked. We are using
>>>> Connection.basicQos(10000) to limit the number of outstanding messages
>>>> but its not often that reaches 10000 and the error happens anytime.
>>>> There is defensive code to make sure messages are not acked/nacked
>>>> more than once.
>>>>
>>>> Anyone have any ideas? Is there any way to get more information on the
>>>> server or client side regarding the error?
>>>>
>>>
>>> Well the server error seems pretty clear and just to be 100% sure, I can
>>> verify that the error message you're seeing is only generated in one
>>> place in the whole code base:
>>>
>>> https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_reader.erl#L241.
>>>
>>>
>>>
>>
>> Except that this isn't quite as clear as I suggested initially. The
>> networking layer isn't going to send a timeout on a blocking receive
>> like this - the 'timeout' message is being sent to the reader from some
>> other process. I will investigate further! :)
>>
>
> Ok so I think I've identified the source of this behaviour. The 'timeout'
> message is sent to the reader process by the AMQP heartbeat - a separate out
> of band process that is monitoring for 'stale' connections using heartbeat
> frames (see http://www.rabbitmq.com/amqp-0-9-1-reference.html for details).
>
> What I believe is happening is that as the server comes under load, the
> heartbeat for this connection is de-prioritised at the network layer and
> times out, causing the connection to be closed.
>
> Set your heartbeat to 0 (turning it off) for now and see if it fixes the
> problem? That's a short term investigative step though, obviously.
>
> I'll file a bug for improving the log messages when timeout occurs.
>
>
>>> The code handling the timeout condition is
>>>
>>> https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_reader.erl#L321,
>>>
>>> the call site for which is
>>>
>>> https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_reader.erl#L284.
>>>
>>> The origin of this is
>>>
>>> https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_net.erl#L108
>>>
>>> in rabbit_net - what the code does is make the calling process wait for
>>> a message from the Erlang networking layer. So it is the underlying
>>> TCP/IP layer in Erlang which is noticing a timeout on the connection.
>>>
>>> How this is mediated through the client's behaviour is another matter.
>>>
>>> Hope this helps us get started figuring out what's wrong!
>>>
>>> Cheers,
>>> Tim
>>>
>>>> RabbitMQ 2.8.1 on Gentoo Linux 64bit
>>>> Erlang R15B (erts-5.9) [source] [64-bit]
>>>> amqp-client-2.8.2 (also tried amqp-client-2.7.1)
>>>> java version "1.6.0_31"
>>>> Java(TM) SE Runtime Environment (build 1.6.0_31-b04)
>>>> Java HotSpot(TM) 64-Bit Server VM (build 20.6-b01, mixed mode)
>>>>
>>>> Thanks
>>>> David
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
http://twoogleplus.com/ Online service to cross-post tweets to Google+
http://engage.calibreapps.com/ Engage - Web based goal setting and
performance management

From emile at rabbitmq.com  Tue May 22 11:44:51 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 22 May 2012 11:44:51 +0100
Subject: [rabbitmq-discuss] Complete cluster crash (2.7.1)
In-Reply-To: <D922474AF853FE49882FC6ADB6FE7B4810F0E81F@z-de-xmb02.zanox.com>
References: <D922474AF853FE49882FC6ADB6FE7B4810F0E81F@z-de-xmb02.zanox.com>
Message-ID: <4FBB6E23.3040602@rabbitmq.com>

Hi Christian,

On 21/05/12 14:01, Christian Bick wrote:
> we had a complete crash of our 3-Node 2.7.1 cluster some days ago. What
> I saw on the web, this issue might be related to
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-April/019765.html
> . As such it may have been fixed in 2.8.x which we are going to migrate
> to. Nevertheless, I would like to ask for clarification on that if possible.

The errors that you found do not appear identical to the ones reported
in that message from April. It is possible that you are experiencing a
consequence of a bug that has already been fixed in v2.8.2. It would
help if you could upgrade and repeat the procedure that triggered the
bug. We will be in a much better position to diagnose errors reported
against the latest version of the broker.

You should be aware that if you restart all nodes quicker than it takes
a message to move through the queue then you risk message loss. The
section on unsynchronised slaves has more information:

http://www.rabbitmq.com/ha.html#unsynchronised-slaves


-Emile




From tim at rabbitmq.com  Tue May 22 12:32:34 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 22 May 2012 12:32:34 +0100
Subject: [rabbitmq-discuss] rabbitmq was shutdown unwanted
In-Reply-To: <4FBB617C.3050107@cloudwebdns.com>
References: <4FBAF349.2090201@cloudwebdns.com> <4FBB4093.7080704@rabbitmq.com>
	<4FBB617C.3050107@cloudwebdns.com>
Message-ID: <4FBB7952.9060102@rabbitmq.com>

On 22/05/2012 10:50, Cloud DNS wrote:
> Hi,
>
> My current memory usage with top:
>
>
> PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND
> 1161 rabbitmq 20 0 6203m 5.4g 2360 S 25 34.4 213:07.12 beam.smp
>
>
> The queues number:
>
> # rabbitmqctl -p /somepath list_queues
> Listing queues ...
> queue_storm_actionlog 0
> dev_queue_storm_actionlog 1607487
>
>
> The status shows:
>
> {running_applications,[{rabbit,"RabbitMQ","2.7.0"},
> {os_mon,"CPO CXC 138 46","2.2.2"},
> {sasl,"SASL CXC 138 11","2.1.6"},
> {mnesia,"MNESIA CXC 138 12","4.4.10"},
> {stdlib,"ERTS CXC 138 10","1.16.2"},
> {kernel,"ERTS CXC 138 10","2.13.2"}]},
> {os,{unix,linux}},
> {erlang_version,"Erlang R13B01 (erts-5.7.2) [source] [64-bit] [smp:8:8]
> [rq:8] [async-threads:30] [kernel-poll:true]\n"},
> {memory,[{total,6124614216},
> {processes,4058585384},
> {processes_used,4058271696},
> {system,2066028832},
> {atom,1101009},
> {atom_used,1088876},
> {binary,1769349912},
> {code,11719137},
> {ets,281219504}]},
> {vm_memory_high_watermark,0.6},
> {vm_memory_limit,10114781184}]
>
>
> Do you have any further suggestion? thanks.
>

I'd suggest you start by upgrading to the latest 2.8.x version. There 
are ongoing improvements to memory handling and performance which are 
likely to help.

From tim at rabbitmq.com  Tue May 22 12:35:47 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 22 May 2012 12:35:47 +0100
Subject: [rabbitmq-discuss] rabbitmq was shutdown unwanted
In-Reply-To: <4FBB7952.9060102@rabbitmq.com>
References: <4FBAF349.2090201@cloudwebdns.com> <4FBB4093.7080704@rabbitmq.com>
	<4FBB617C.3050107@cloudwebdns.com> <4FBB7952.9060102@rabbitmq.com>
Message-ID: <4FBB7A13.900@rabbitmq.com>

On 22/05/2012 12:32, Tim Watson wrote:
>> {os,{unix,linux}},
>> {erlang_version,"Erlang R13B01 (erts-5.7.2) [source] [64-bit] [smp:8:8]
>> [rq:8] [async-threads:30] [kernel-poll:true]\n"},
>>
>>
>> Do you have any further suggestion? thanks.
>>
>
> I'd suggest you start by upgrading to the latest 2.8.x version. There
> are ongoing improvements to memory handling and performance which are
> likely to help.


You should also consider upgrading to the latest stable release of 
Erlang, as R13B01 is very old now. Current release is R15.

Cheers,
Tim

From simon at rabbitmq.com  Tue May 22 17:11:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 22 May 2012 17:11:06 +0100
Subject: [rabbitmq-discuss] Prior Version Documentation
In-Reply-To: <0bf227c5-b9cf-45c0-8ad3-0386e4915b2a@z19g2000vbe.googlegroups.com>
References: <0bf227c5-b9cf-45c0-8ad3-0386e4915b2a@z19g2000vbe.googlegroups.com>
Message-ID: <4FBBBA9A.4010007@rabbitmq.com>

Hi Ken.

At the moment we don't have any means to put old versions of 
documentation on the website. If you contact us at support at rabbitmq.com 
we may be able to help you out.

Cheers, Simon

On 21/05/12 15:13, Ken Baltrinic wrote:
> The online documentation at http://www.rabbitmq.com/documentation.html
> appears to be updated regularly to reflect the information for the
> most recent release.  This is generally wonderful and quite a feat.
> Well done!
>
> Unfortunately, we are using rabbit in a government environment where
> upgrading to the latest release is a very controlled event.
> Presently we are using rabbit 2.7.1 and need to supply as part of our
> contractual deliverables, the documentation for the same.  Is there a
> means to get access to the documentation aligned to a specific prior
> release?
>
> --Ken
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Tue May 22 17:10:56 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 22 May 2012 17:10:56 +0100
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of a
	burst
In-Reply-To: <A2CF3269-B4F5-4D6A-BDD2-631BFEEC6206@rabbitmq.com>
References: <4FB76237.7020901@gmail.com> <4FB81282.2020006@gmail.com>
	<D3224EFC-D5D5-46F6-BB3F-A030792ABF02@rabbitmq.com>
	<4FBADC88.2060705@gmail.com>
	<A2CF3269-B4F5-4D6A-BDD2-631BFEEC6206@rabbitmq.com>
Message-ID: <8A2E96DF-6DD7-4560-B6C5-FB8229DBB330@rabbitmq.com>

Jos?,

I have found what I think is the fix to this problem, and it will go
into the next release.

Thank you for reporting it.

Steve Powell  (a happy bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

On 22 May 2012, at 10:38, Steve Powell wrote:

> Jos?,
> 
> Thank you for all the investigation you are doing. I have caught up and
> yesterday convinced myself that it is indeed our bug. The Wireshark
> traces confirm that all the messages are actually sent. I have produced
> my own version of your testcase with numbered messages to test which
> ones fail to get through. I've also ended the app with a DISCONNECT, but
> still we lose one of the messages.
> 
> I'm going to look more closely at the STOMP stuff, and have raised a bug
> (24957) to track this internally. I'll get back to you as soon as I find
> out where this is getting lost.
> 
> Incidentally, it is apparently the last message in a packet that is not
> being picked up, and it is not obvious why this should be so. Putting
> the DISCONNECT on the end I thought would cure it, but it didn't; which
> is very strange. Of course, I don't wait for a receipt on the
> DISCONNECT; but closing too soon is not the problem.
> 
> Steve Powell  (a happy bunny)
> ----------some more definitions from the SPD----------
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> literacy (n.) A textually transmitted disease usually contracted in childhood.
> 
> On 22 May 2012, at 01:23, Jos? Mic? wrote:
> 
>> Forget my suggestion about process_received_bytes(), I was looking at the wrong repository, ha.
>> 
>> Well, here is attached the best test case I got so far: a Python script that sends very quickly 1001 messages, the first 1000 ones to queue "stomp_bug" and the last one to another queue "stomp_bug_last".
>> 
>> Running it several times, can be found that sometimes the last message is lost (and only the last message).
>> I've executed it 20 times, and got only 10 messages into queue "stomp_bug_last".
>> 
>> I looked at the actual source code in mercurial, and I really cannot help with that...
>> 
>> 
>> Jos?
>> <stomp_bug_2.py>
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From kbaltrinic at bericotechnologies.com  Tue May 22 18:09:43 2012
From: kbaltrinic at bericotechnologies.com (Kenneth Baltrinic)
Date: Tue, 22 May 2012 13:09:43 -0400
Subject: [rabbitmq-discuss] Prior Version Documentation
In-Reply-To: <4FBBBA9A.4010007@rabbitmq.com>
References: <0bf227c5-b9cf-45c0-8ad3-0386e4915b2a@z19g2000vbe.googlegroups.com>
	<4FBBBA9A.4010007@rabbitmq.com>
Message-ID: <CAH9i+BdSg6diWGeT8c87wWdjF6AJwoORo1fcq7w83N=hg+wahg@mail.gmail.com>

Dear Rabbit Support,

Per Simons recommendation below, I am writing to ask that you provide us
with copy of the documentation for the 2.7.1 version of Rabbit MQ.  I am
requesting this because we will be deploying this version as part of a
delivery to the government and must provide the administrative
documentation at the same time.  Specifically what we need is the server
documentation (the prior version of this
page<http://www.rabbitmq.com/admin-guide.html> and all its child
pages) and the documentation for the Management Plugin
(including the CLI) and the documentation on configuring web plugins.
 Ideally if this could all be compiled into a PDF, that would be great!

Please let me know if you have any question.

Sincerely,
Ken Baltrinic
Engineering Team Lead
Berico Technologies, LLC

On Tue, May 22, 2012 at 12:11 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> Hi Ken.
>
> At the moment we don't have any means to put old versions of documentation
> on the website. If you contact us at support at rabbitmq.com we may be able
> to help you out.
>
> Cheers, Simon
>
>
> On 21/05/12 15:13, Ken Baltrinic wrote:
>
>> The online documentation at http://www.rabbitmq.com/**documentation.html<http://www.rabbitmq.com/documentation.html>
>> appears to be updated regularly to reflect the information for the
>> most recent release.  This is generally wonderful and quite a feat.
>> Well done!
>>
>> Unfortunately, we are using rabbit in a government environment where
>> upgrading to the latest release is a very controlled event.
>> Presently we are using rabbit 2.7.1 and need to supply as part of our
>> contractual deliverables, the documentation for the same.  Is there a
>> means to get access to the documentation aligned to a specific prior
>> release?
>>
>> --Ken
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120522/47fa51f8/attachment.htm>

From askgax at pchome.com.tw  Wed May 23 02:38:18 2012
From: askgax at pchome.com.tw (askgax)
Date: Tue, 22 May 2012 18:38:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq 2.8.2 with heartbeat/DRBD fail
In-Reply-To: <4FBB5DBA.6070203@rabbitmq.com>
References: <d5f7b883-4012-4354-a638-71145e1facf6@ki5g2000pbb.googlegroups.com>
	<4FB4D31B.9060500@rabbitmq.com> <4FBA1659.4070407@rabbitmq.com>
	<33886528.post@talk.nabble.com> <4FBB5DBA.6070203@rabbitmq.com>
Message-ID: <33893113.post@talk.nabble.com>


Hi,

finally i still use 2.7.1,maybe next version will change something that i
can use (i hope so~~)

many thanks for your help!!=)



Emile Joubert-2 wrote:
> 
> Hi,
> 
> On 22/05/12 02:27, askgax wrote:
>>> i check the mq process at that time is stop,so you can't see
>>> "/etc/init.d/rabbitmq-server  start" in log,
>>> broker logfile no any log,because mq service not start,but if i manual
>>> start rabbitmq,it can work,
>>> only 2.8.2 in heartbeat takeover ,mq service can't start automaticlly,
> 
> There were changes to the RabbitMQ startup scripts between the versions
> you are comparing. This is a possible cause for the difference in
> behaviour you are observing. If you needed to make adjustments to ensure
> that the broker does not start automatically when the OS starts up then
> you will have to repeat those adjustments for v2.8.2.
> 
> 
> -Emile
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Rabbitmq-2.8.2-with-heartbeat-DRBD-fail-tp33863293p33893113.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From support at cloudwebdns.com  Wed May 23 02:46:03 2012
From: support at cloudwebdns.com (Cloud DNS)
Date: Wed, 23 May 2012 09:46:03 +0800
Subject: [rabbitmq-discuss] rabbitmq was shutdown unwanted
In-Reply-To: <4FBB7A13.900@rabbitmq.com>
References: <4FBAF349.2090201@cloudwebdns.com> <4FBB4093.7080704@rabbitmq.com>
	<4FBB617C.3050107@cloudwebdns.com>
	<4FBB7952.9060102@rabbitmq.com> <4FBB7A13.900@rabbitmq.com>
Message-ID: <4FBC415B.5060609@cloudwebdns.com>

Hi,

If I upgrade erlang and rabbitmq to the latest version, will they break 
the current queues? We have all queues in the disk.

thanks


? 2012-5-22 19:35, Tim Watson ??:
>
> You should also consider upgrading to the latest stable release of
> Erlang, as R13B01 is very old now. Current release is R15.



From emile at rabbitmq.com  Wed May 23 09:24:45 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 23 May 2012 09:24:45 +0100
Subject: [rabbitmq-discuss] Rabbitmq 2.8.2 with heartbeat/DRBD fail
In-Reply-To: <33893113.post@talk.nabble.com>
References: <d5f7b883-4012-4354-a638-71145e1facf6@ki5g2000pbb.googlegroups.com>
	<4FB4D31B.9060500@rabbitmq.com> <4FBA1659.4070407@rabbitmq.com>
	<33886528.post@talk.nabble.com> <4FBB5DBA.6070203@rabbitmq.com>
	<33893113.post@talk.nabble.com>
Message-ID: <4FBC9ECD.3000507@rabbitmq.com>

Hi,

On 23/05/12 02:38, askgax wrote:
> finally i still use 2.7.1,maybe next version will change something that i
> can use (i hope so~~)

This is unlikely to start working in a future version unless the cause
is identified and fixed. If you have any further relevant information
(OS syslog, RabbitMQ log and logs and configs of all the participating
components) then please send those to me off-list.

If anyone on the list is successfully using v2.8.2 with Pacemaker and
DRDB then please let us know.


-Emile






From mtlotfizad at gmail.com  Wed May 23 09:24:38 2012
From: mtlotfizad at gmail.com (Mohsen Lotfizad)
Date: Wed, 23 May 2012 12:54:38 +0430
Subject: [rabbitmq-discuss] sending zipped message
Message-ID: <CAJzgYrB2DiiNfc0dS_1kFZPrfB5z-xeAvb8UO9xZ8RPWqnA1OA@mail.gmail.com>

Hi,
I have a code like this:

                    byte[] rawBytes = serialize(trxEntities);
                    byte[] zipped = rawBytes;

                    if (shouldBeCompress) {
                        zipped = compressor.compress(rawBytes);
                    }

                    BasicProperties persistentBasic =
MessageProperties.PERSISTENT_BASIC;
                    channel.basicPublish("", queueName, persistentBasic,
zipped);

As you see some of my messages should be compress along witch some others
shouldn't.
Is there any way I could set any properties to tell the consumer that "hey!
this is a zipped message" ?

PS. does *"com.rabbitmq.client.AMQP<eclipse-javadoc:%E2%98%82=rabbitmq-java-client-src-2.8.2/lib%5C/rabbitmq-client.jar%3Ccom.rabbitmq.client%28AMQP.class%E2%98%83AMQP>
.BasicProperties<eclipse-javadoc:%E2%98%82=rabbitmq-java-client-src-2.8.2/lib%5C/rabbitmq-client.jar%3Ccom.rabbitmq.client%28AMQP$BasicProperties.class%E2%98%83BasicProperties>.BasicProperties(...,
Map<eclipse-javadoc:%E2%98%82=rabbitmq-java-client-src-2.8.2/lib%5C/rabbitmq-client.jar%3Ccom.rabbitmq.client%28AMQP$BasicProperties.class%E2%98%83BasicProperties%7EBasicProperties%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.util.Map%5C%3CLjava.lang.String;Ljava.lang.Object;%3E;%7ELjava.lang.Integer;%7ELjava.lang.Integer;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.util.Date;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.lang.String;%E2%98%82Map>
<String<eclipse-javadoc:%E2%98%82=rabbitmq-java-client-src-2.8.2/lib%5C/rabbitmq-client.jar%3Ccom.rabbitmq.client%28AMQP$BasicProperties.class%E2%98%83BasicProperties%7EBasicProperties%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.util.Map%5C%3CLjava.lang.String;Ljava.lang.Object;%3E;%7ELjava.lang.Integer;%7ELjava.lang.Integer;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.util.Date;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.lang.String;%E2%98%82String>,
Object<eclipse-javadoc:%E2%98%82=rabbitmq-java-client-src-2.8.2/lib%5C/rabbitmq-client.jar%3Ccom.rabbitmq.client%28AMQP$BasicProperties.class%E2%98%83BasicProperties%7EBasicProperties%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.util.Map%5C%3CLjava.lang.String;Ljava.lang.Object;%3E;%7ELjava.lang.Integer;%7ELjava.lang.Integer;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.util.Date;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.lang.String;%7ELjava.lang.String;%E2%98%82Object>>
headers, ...)"* help me? I mean could I set any parameter in
BasicProperties.header ?

-- 

Sincerely
ML
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120523/2496f9b9/attachment.htm>

From matthew at rabbitmq.com  Wed May 23 09:34:08 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 23 May 2012 09:34:08 +0100
Subject: [rabbitmq-discuss] sending zipped message
In-Reply-To: <CAJzgYrB2DiiNfc0dS_1kFZPrfB5z-xeAvb8UO9xZ8RPWqnA1OA@mail.gmail.com>
References: <CAJzgYrB2DiiNfc0dS_1kFZPrfB5z-xeAvb8UO9xZ8RPWqnA1OA@mail.gmail.com>
Message-ID: <20120523083408.GB18941@wellquite.org>

On Wed, May 23, 2012 at 12:54:38PM +0430, Mohsen Lotfizad wrote:
> headers, ...)"* help me? I mean could I set any parameter in
> BasicProperties.header ?

Correct. Yes, I would suggest you do that.

Matthew

From kuzcorp at gmail.com  Tue May 22 21:42:35 2012
From: kuzcorp at gmail.com (KuzCO)
Date: Tue, 22 May 2012 13:42:35 -0700 (PDT)
Subject: [rabbitmq-discuss] missing config file
Message-ID: <bde601b6-9e40-4ea5-add8-1c8e81bb906e@l5g2000vbo.googlegroups.com>

hi,
after installation could not start the rabbit, the only weird thing
see is that there is no configuration file, try doing a file with the
basic things and always get an error in the file,doing wrong.

thanks.

centos 6.2

my config file

[
    {auth_backends,[]},
    {auth_mechanisms,[]},
    {backing_queue_module,rabbit_variable_queue},
    {cluster_nodes,[]},
    {collect_statistics,fine},
    {collect_statistics_interval,5000},
    {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
    {default_user,<<"guest">>},
    {default_user_tags,[administrator]},
    {default_vhost,<<"/">>},
    {delegate_count,16},
    {error_logger,{file,"/var/log/rabbitmq/rabbit at host.log"}},
    {frame_max,131072},
    {hipe_compile,false},
    {included_applications,[]},
    {msg_store_file_size_limit,16777216},
    {msg_store_index_module,rabbit_msg_store_ets_index},
    {queue_index_max_journal_entries,262144},
    {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at host.log"}},
    {server_properties,[]},
    {ssl_listeners,[]},
    {ssl_options,[]},
    {tcp_listen_options,
        [binary,
            {packet,raw},
            {reuseaddr,true},
            {backlog,128},
            {nodelay,true},
            {exit_on_close,false}]},
    {tcp_listeners,[5672]},
    {trace_vhosts,[<<"/">>]},
    {vm_memory_high_watermark,0.4}
].

From gladed at gmail.com  Wed May 23 00:38:12 2012
From: gladed at gmail.com (Glade)
Date: Tue, 22 May 2012 16:38:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Clustered server doesn't permit local connections
Message-ID: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>

I have two clustered rabbitmq entities. But connections are rejected for no 
reason I can understand.

rabbitmqctl cluster_status returns:

[{nodes,[{disc,['rabbit at ip-10-70-82-246','rabbit at ip-10-12-183-2']}]},
 {running_nodes,['rabbit at ip-10-12-183-2','rabbit at ip-10-70-82-246']}]

And rabbitmqctl status returns:

[{pid,3502},
 {running_applications,[{rabbit,"RabbitMQ","2.8.2"},
                        {os_mon,"CPO  CXC 138 46","2.2.5"},
                        {sasl,"SASL  CXC 138 11","2.1.9.3"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.17"},
                        {stdlib,"ERTS  CXC 138 10","1.17.3"},
                        {kernel,"ERTS  CXC 138 10","2.14.3"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R14B02 (erts-5.8.3) [source] [64-bit] [rq:1] 
[async-threads:30] [kernel-poll:true]\n"},
 {memory,[{total,24960632},
          {processes,10147656},
          {processes_used,10142176},
          {system,14812976},
          {atom,1136665},
          {atom_used,1134545},
          {binary,151104},
          {code,11322346},
          {ets,877880}]},
 {vm_memory_high_watermark,0.39999999994925645},
 {vm_memory_limit,1576555315},
 {disk_free_limit,3941388288},
 {disk_free,3753910272},
 {file_descriptors,[{total_limit,924},
                    {total_used,6},
                    {sockets_limit,829},
                    {sockets_used,4}]},
 {processes,[{limit,1048576},{used,136}]},
 {run_queue,0},
 {uptime,368}]

But client connections are rejected. My log shows data like this:

=INFO REPORT==== 22-May-2012::23:31:29 ===
accepting AMQP connection <0.244.0> (127.0.0.1:58081 -> 127.0.0.1:5672)

=ERROR REPORT==== 22-May-2012::23:31:32 ===
closing AMQP connection <0.240.0> (127.0.0.1:58080 -> 127.0.0.1:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

What is wrong here?

Thanks for any help.

-Glade Diviney
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120522/c8bf4aa2/attachment.htm>

From esiroker at gmail.com  Wed May 23 09:09:06 2012
From: esiroker at gmail.com (Eric Siroker)
Date: Wed, 23 May 2012 01:09:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Clustered server doesn't permit local
	connections
In-Reply-To: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>
References: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>
Message-ID: <5ad8bff6-2f85-4bf1-86d1-385b8d63a995@googlegroups.com>

I've encountered the same issue.  I believe it's a regression in RabbitMQ 
2.8.2.  Neither 2.7.1 nor 2.8.1 exhibit this issue for me.

I'm including two test cases, one using amqplib and one using Pika.

Running a two node cluster with RabbitMQ 2.8.2, these test cases will 
succeed on one node, but fail on the other.

If you restart RabbitMQ on one of the nodes, it'll sometimes switch which 
node makes the test cases succeed.

Eric

====== amqplib test case
from amqplib import client_0_8 as amqp

connection = amqp.Connection(host='', username='', password='')

# Raises socket.error: [Errno 104] Connection reset by peer
connection.close()

====== Pika test case
import pika

credentials = pika.PlainCredentials(username='', password='')
connection_parameters = pika.ConnectionParameters(host='', 
credentials=credentials)
connection = pika.BlockingConnection(connection_parameters)
channel = connection.channel()

# Raises pika.exceptions.ChannelClosed
channel.exchange_declare(exchange='exchange')
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120523/408236df/attachment.htm>

From watson.timothy at gmail.com  Wed May 23 09:36:34 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 23 May 2012 09:36:34 +0100
Subject: [rabbitmq-discuss] Silent crash causes persistent durable
	message loss
In-Reply-To: <4FBB3FBE.5060204@rabbitmq.com>
References: <8FF985CF-C086-41BE-9A6B-7A2EAD256BF6@thumb.it>
	<4FBAAA97.5030808@rabbitmq.com> <4FBAAD57.5090106@rabbitmq.com>
	<A43B64B9-2834-4912-8775-B41C122334DA@thumb.it>
	<4FBB3FBE.5060204@rabbitmq.com>
Message-ID: <2715B757-667C-4974-8FBF-94B011888C16@rabbitmq.com>

On 22 May 2012, at 08:26, Tim Watson wrote:

> On 22/05/2012 01:46, Will Koffel wrote:
>> Thanks for the feedback guys, sorry for the slow reply back.
>> 
>> I took a look on the machine. It's running on an Amazon Linux instance
>> on EC2 (based on CentOS loosely). I don't see anything at all related to
>> oom-killer in logs. Nor anything about rabbit. I looked in dmesg, and
>> everything in /var/log.
>> 
>> Amazon doesn't do memory monitoring with AWS CloudWatch (major downside,
>> blech), so I can't see if there was any memory contention, but we've
>> never seen any issues on those machines. There's no CPU or disk spikes
>> during that time to indicate anything else traumatic happening on the
>> machine in question.
>> 
>> One long-shot idea at the application layer: The daemons we run to
>> consume those queues call "declare" on the relevant exchanges and queues
>> on startup. This has always been a convenient way to ensure the queues
>> are alive before we start writing/reading them. In the case where
>> RabbitMQ crashes on us, the daemons start the cycle (they die, their
>> parent process restarts them, they die again, etc.).
>> 
>> Is there any case in which WHILE rabbit was starting up, it might accept
>> a connection, which would instruct it to create the "expiring-queue",
>> and then when it went to restore the persistent messages from disk, it
>> would give up since the queue already existed? Any sort of race
>> condition that could bite us if there are clients thrashing away during
>> start? Or will RabbitMQ fail to accept any connections until it's
>> cleanly started up?
>> 
> 
> Hi Will. Rabbit's networking sub-system only comes online after everything else is ready, plus the boot sequence is entirely sequential, so I'd be very surprised if this was a race on startup. Having said that, I'll verify that none of the boot steps run out of band and confirm this morning.
> 

Hi Will. Rabbit does appear to be starting up synchronously in all aspects of its boot sequence, so I'm not sure about this idea of a race on startup. 

Quick question for you, just to confirm. When you put messages on the 'expiring queue', I'd like to make sure that all the following conditions are true (to ensure that they will be on disk)

1. the queue is durable (you've said this already)
2. the messages are marked as persistent (you've also said this already)
3. the publisher has received an ACK *or* you're using a transaction

If all 3 of these are in place, then the messages should certainly be on disk after (3).

>> -Will
>> 
>> 
>> On May 21, 2012, at 5:02 PM, Matthias Radestock wrote:
>> 
>>> On 21/05/12 21:50, Francesco Mazzoli wrote:
>>>> I have trouble believing that it is actually dying silently with no
>>>> information in the logs.
>>> 
>>> iirc we've seen this in the past with things like 'oom killer'. It is
>>> probably worth checking the system logs.
>>> 
>>>> In the meantime I'm going to do the obvious and suggest to upgrade to
>>>> 2.8.2. We fixed several ugly bugs related to DLX (one of which was
>>>> particularly easy to get) and they might be related to your problem.
>>> 
>>> I don't think any of the DLX bugs pre 2.8.2 would have brought down an
>>> entire rabbit, just individual queues.
>>> 
>>> Matthias.
>> 
>> ________________
>> Will Koffel
>> CTO, Thumb?
>> 51 E 12th St., 4th Floor
>> New York, NY 10003
>> Office: (212) 673-8650
>> Mobile: (617) 575-WILL
>> @thumb
>> www.thumb.it <http://www.thumb.it/>
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From support at cloudwebdns.com  Wed May 23 09:43:38 2012
From: support at cloudwebdns.com (Cloud DNS)
Date: Wed, 23 May 2012 16:43:38 +0800
Subject: [rabbitmq-discuss] rabbitmq was shutdown unwanted
In-Reply-To: <4FBB7A13.900@rabbitmq.com>
References: <4FBAF349.2090201@cloudwebdns.com> <4FBB4093.7080704@rabbitmq.com>
	<4FBB617C.3050107@cloudwebdns.com>
	<4FBB7952.9060102@rabbitmq.com> <4FBB7A13.900@rabbitmq.com>
Message-ID: <4FBCA33A.6080009@cloudwebdns.com>

? 2012-5-22 19:35, Tim Watson ??:
> You should also consider upgrading to the latest stable release of 
> Erlang, as R13B01 is very old now. Current release is R15. 

Thanks I have upgraded both erlang and rabbitmq successfully.
The queues are kept normally.
This is the new system info:

# rabbitmqctl status
Status of node 'testmq-master at ubuntu' ...
[{pid,28517},
{running_applications,[{rabbit,"RabbitMQ","2.8.2"},
{os_mon,"CPO CXC 138 46","2.2.9"},
{sasl,"SASL CXC 138 11","2.2.1"},
{mnesia,"MNESIA CXC 138 12","4.7"},
{stdlib,"ERTS CXC 138 10","1.18.1"},
{kernel,"ERTS CXC 138 10","2.15.1"}]},
{os,{unix,linux}},
{erlang_version,"Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:8:8] 
[async-threads:30] [kernel-poll:true]\n"},


Cheers!


From jose.mico at gmail.com  Wed May 23 09:42:45 2012
From: jose.mico at gmail.com (=?ISO-8859-1?Q?Jos=E9_Mic=F3?=)
Date: Wed, 23 May 2012 05:42:45 -0300
Subject: [rabbitmq-discuss] sending zipped message
In-Reply-To: <CAJzgYrB2DiiNfc0dS_1kFZPrfB5z-xeAvb8UO9xZ8RPWqnA1OA@mail.gmail.com>
References: <CAJzgYrB2DiiNfc0dS_1kFZPrfB5z-xeAvb8UO9xZ8RPWqnA1OA@mail.gmail.com>
Message-ID: <4FBCA305.5090303@gmail.com>

On 05/23/2012 05:24 AM, Mohsen Lotfizad wrote:
>
> As you see some of my messages should be compress along witch some 
> others shouldn't.
> Is there any way I could set any properties to tell the consumer that 
> "hey! this is a zipped message" ?
>

You should use the "content encoding" attribute.

See http://www.rabbitmq.com/api-guide.html ("Protocol class overview)
and http://www.rabbitmq.com/tutorials/amqp-concepts.html ("Message 
Attributes and Payload")


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120523/94067b57/attachment.htm>

From emile at rabbitmq.com  Wed May 23 09:56:29 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 23 May 2012 09:56:29 +0100
Subject: [rabbitmq-discuss] missing config file
In-Reply-To: <bde601b6-9e40-4ea5-add8-1c8e81bb906e@l5g2000vbo.googlegroups.com>
References: <bde601b6-9e40-4ea5-add8-1c8e81bb906e@l5g2000vbo.googlegroups.com>
Message-ID: <4FBCA63D.8040500@rabbitmq.com>

Hi,

On 22/05/12 21:42, KuzCO wrote:
> after installation could not start the rabbit, the only weird thing
> see is that there is no configuration file, try doing a file with the
> basic things and always get an error in the file,doing wrong.

There is no need for a config file unless you need to change any
settings. If you wish to change config settings for the broker then
these need to be nested under the name 'rabbit' as shown in the example
here:

http://www.rabbitmq.com/configure.html#configuration-file

If you are having difficulty starting the broker then check the
troubleshooting guide:

http://www.rabbitmq.com/troubleshooting.html

If that doesn't help then you can also search the mailing list to see
whether anyone else encountered a similar problem. A few archive
services are listed here:

http://www.rabbitmq.com/contact.html#mailing-list

or you can search the mailing list through the site search on

http://www.rabbitmq.com/search.html

If that doesn't help then please send us any error messages from the log
or the startup output.



-Emile



From matthew at rabbitmq.com  Wed May 23 09:59:39 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 23 May 2012 09:59:39 +0100
Subject: [rabbitmq-discuss] sending zipped message
In-Reply-To: <4FBCA305.5090303@gmail.com>
References: <CAJzgYrB2DiiNfc0dS_1kFZPrfB5z-xeAvb8UO9xZ8RPWqnA1OA@mail.gmail.com>
	<4FBCA305.5090303@gmail.com>
Message-ID: <20120523085938.GD18941@wellquite.org>

On Wed, May 23, 2012 at 05:42:45AM -0300, Jos? Mic? wrote:
> On 05/23/2012 05:24 AM, Mohsen Lotfizad wrote:
> >As you see some of my messages should be compress along witch some
> >others shouldn't.
> >Is there any way I could set any properties to tell the consumer
> >that "hey! this is a zipped message" ?
> 
> You should use the "content encoding" attribute.

Yeah, that would be fine too. But just to be clear, Rabbit never looks
at any of these headers - rabbit always treats the payload as entirely
opaque and just forwards it on to consumers as necessary. How you
arrange agreement between producers and consumers of the type of the
payload is entirely up to you.

Matthew

From support at cloudwebdns.com  Wed May 23 10:07:15 2012
From: support at cloudwebdns.com (Cloud DNS)
Date: Wed, 23 May 2012 17:07:15 +0800
Subject: [rabbitmq-discuss] a simple erlang question
Message-ID: <4FBCA8C3.8040402@cloudwebdns.com>

Hi,

Sorry I just don't want to subscribe to another list.
Since rabbitmq is developed with erlang, may I ask an erlang question here?

7> LI=[hello,"world"].
[hello,"world"]

For the statement above, hello is an atom, so what is the "world"?
The offical webpage says there is no string in erlang, so I don't know 
what does the quoted string mean.

Thanks.


From emile at rabbitmq.com  Wed May 23 10:10:58 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 23 May 2012 10:10:58 +0100
Subject: [rabbitmq-discuss] a simple erlang question
In-Reply-To: <4FBCA8C3.8040402@cloudwebdns.com>
References: <4FBCA8C3.8040402@cloudwebdns.com>
Message-ID: <4FBCA9A2.6050306@rabbitmq.com>

Hi,

On 23/05/12 10:07, Cloud DNS wrote:
> Sorry I just don't want to subscribe to another list.
> Since rabbitmq is developed with erlang, may I ask an erlang question here?
> 
> 7> LI=[hello,"world"].
> [hello,"world"]
> 
> For the statement above, hello is an atom, so what is the "world"?

It is a list of characters. I would suggest that erlang-questions is
more appropriate forum, your reluctance to subscribe notwithstanding.

-Emile



From matthew at rabbitmq.com  Wed May 23 10:09:04 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 23 May 2012 10:09:04 +0100
Subject: [rabbitmq-discuss] a simple erlang question
In-Reply-To: <4FBCA8C3.8040402@cloudwebdns.com>
References: <4FBCA8C3.8040402@cloudwebdns.com>
Message-ID: <20120523090903.GE18941@wellquite.org>

On Wed, May 23, 2012 at 05:07:15PM +0800, Cloud DNS wrote:
> Since rabbitmq is developed with erlang, may I ask an erlang question here?

Erm, this once, sure, but please use #erlang on freenode or the
erlang-questions mailing list. There are hundreds of people on this list
that are concerned more with Rabbit and less with Erlang.

> 7> LI=[hello,"world"].
> [hello,"world"]
> 
> For the statement above, hello is an atom, so what is the "world"?

List of characters. Or, list of bounded numbers, which when displayed
are understood by the io_lib functions to be characters so are displayed
as such.

1> [X + 1 || X <- "world"].
"xpsme"

Matthew

From matthew at rabbitmq.com  Wed May 23 10:39:54 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 23 May 2012 10:39:54 +0100
Subject: [rabbitmq-discuss] What happens to messages delivered just
 before canceling consume?
In-Reply-To: <CAO-4Wf7vS_FjCxrqTJ5RBayhPCymsYUHPcsDrF_rnJhj7TMFpg@mail.gmail.com>
References: <CAO-4Wf5QjFYf0VXqMiOJSXWMPRy=RUOrhLs-vyn27C_9+i9+ew@mail.gmail.com>
	<4FB619E0.2020700@rabbitmq.com> <4FB619FC.8020304@rabbitmq.com>
	<4FB624E4.9000606@rabbitmq.com>
	<20120518104125.GB24978@wellquite.org>
	<CAO-4Wf7vS_FjCxrqTJ5RBayhPCymsYUHPcsDrF_rnJhj7TMFpg@mail.gmail.com>
Message-ID: <20120523093953.GF18941@wellquite.org>

On Fri, May 18, 2012 at 12:25:25PM -0600, Chris wrote:
> Thank you for linking the blog post.. very informative. I had not
> thought about the potential consequences of using a prefech of 1, but
> you clearly explained the tradeoffs.

I'm glad it makes sense.

> Obviously no one is on a network with 0 latency, but all nodes of my
> application are on the same (small) LAN, and will have low latency.
> Also the time it takes to process a single message received by one of
> my consumers can vary wildly, from about 1 second to 15 seconds, and
> it is important that they get processed ASAP, even though they can
> take this amount of time. In this situation do you believe I am
> justified in using a prefetch count of 1?

Yes. If you have a prefetch of 2, and a message can take up to 15
seconds to process, then you could potentially have a message buffered in
the client for nearly 15 seconds. If that's unacceptable (i.e. doesn't
meet your definition of ASAP) then a prefetch of 1 will be better. Given
the relative ratios of processing time and network latency, it seems
likely to me a very low prefetch is the right thing to do there.

Matthew

From steve at rabbitmq.com  Wed May 23 11:04:31 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 23 May 2012 11:04:31 +0100
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of a
	burst
In-Reply-To: <4FBBD5C5.2060601@gmail.com>
References: <4FB76237.7020901@gmail.com> <4FB81282.2020006@gmail.com>
	<D3224EFC-D5D5-46F6-BB3F-A030792ABF02@rabbitmq.com>
	<4FBADC88.2060705@gmail.com>
	<A2CF3269-B4F5-4D6A-BDD2-631BFEEC6206@rabbitmq.com>
	<8A2E96DF-6DD7-4560-B6C5-FB8229DBB330@rabbitmq.com>
	<4FBBD5C5.2060601@gmail.com>
Message-ID: <96B991A3-CA8F-4DE5-8196-36E9AB952BE6@rabbitmq.com>

Jos?,

Typically, releases are weeks apart rather than months,
but I'm afraid I don't have an estimate for the next one.

Steve Powell  (a happy bunny)
----------definitions from the SPD (Addendum)----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.
---(words soon to be used in a major motion-picture)---

On 22 May 2012, at 19:07, Jos? Mic? wrote:

> On 05/22/2012 01:10 PM, Steve Powell wrote:
>> I have found what I think is the fix to this problem, and it will go
>> into the next release.
>> 
>> Thank you for reporting it.
> 
> I'm glad that you fixed it, thanks! :-)
> 
> Do you have a rough estimate of the next release date? weeks? months?
> 
> Jos?


From rader.net at gmail.com  Wed May 23 09:46:47 2012
From: rader.net at gmail.com (Rader Lei)
Date: Wed, 23 May 2012 01:46:47 -0700 (PDT)
Subject: [rabbitmq-discuss] unable to join cluster - mnesia func aborted
In-Reply-To: <f60e2565-3189-4ccc-b5b5-b4f0a4d58193@googlegroups.com>
References: <f60e2565-3189-4ccc-b5b5-b4f0a4d58193@googlegroups.com>
Message-ID: <e4a2aae4-4fa4-404b-bf9c-16f723d5f492@googlegroups.com>

Hi Matthias,

The node on Ubuntu is using an older version of erlang (13.b). After i 
upgrade the erlang to the latest version (15b.1), which is used by the 
nodes on windows, the node on ubuntu can be added to the cluster.

Great thanks for your help! 

On Monday, May 21, 2012 3:13:09 PM UTC+8, Rader Lei wrote:
>
> i have a cluster of 3 rabbimtmq servers on windows 2008 and 2003. they 
> works fine. Then I set up a rabbitmq server on Ubuntu 11. when i try to add 
> the new rabbitmq node into the cluster, i get an error - "unable to join 
> the cluster". The log file looks fine, no error message. I can access the 
> cluster master node with command "rabbitmqctl -n rabbit at CNCDS131 status". I 
> have no idea why this error happen:( 
>
>
> Here is the error:
>
> leid at yud-vm:~$ sudo rabbitmqctl cluster rabbit at CNCDS131
> Clustering node 'rabbit at yud-vm' with [rabbit at CNCDS131] ...
> Error: {unable_to_join_cluster,
>            [rabbit at CNCDS131],
>            {aborted,
>                {function_clause,
>                    [{mnesia_schema,cs2list,
>                         [{cstruct,schema,set,
>                              [rabbit at STARS110,rabbit at CNCDS108],
>                              [rabbit at CNCDS131],
>                              [],0,read_write,false,[],[],false,schema,
>                              [table,cstruct],
>                              [],[],[],
>                              {{1336,728415,425002},rabbit at CNCDS131},
>                              {{24,0},
>                               {rabbit at CNCDS131,{1337,582820,591922}}}}]},
>                     {mnesia_schema,do_merge_schema,0},
>                     {mnesia_tm,apply_fun,3},
>                     {mnesia_tm,execute_transaction,5},
>                     {mnesia_schema,schema_coordinator,3}]}}}
>
> Here is the log:
>
>> =INFO REPORT==== 21-May-2012::15:08:16 ===
>> Clustering with [rabbit at CNCDS131]
>>
>> =INFO REPORT==== 21-May-2012::15:08:16 ===
>>     application: mnesia
>>     exited: stopped
>>     type: temporary
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120523/e93e6bea/attachment.htm>

From rader.net at gmail.com  Wed May 23 10:04:37 2012
From: rader.net at gmail.com (Rader Lei)
Date: Wed, 23 May 2012 02:04:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrade 2.7.1 RabbitMQ cluster to 2.8.1
 version
In-Reply-To: <18863890.3713.1333558975674.JavaMail.geo-discussion-forums@vbbdy9>
References: <32143157.102.1333329241115.JavaMail.geo-discussion-forums@pbcr5>
	<5d9f08ec-40f4-4789-af03-df2d8656fd03@k14g2000vbe.googlegroups.com>
	<18863890.3713.1333558975674.JavaMail.geo-discussion-forums@vbbdy9>
Message-ID: <dc1d159e-4d3d-4f37-b722-d19e2107e9f6@googlegroups.com>

Hi Eslam,

I guess Brendan means:
1.set up a new cluster, maybe only one node, running new version of 
rabbitmq like 2.8.1
2.redirect some of your clients to the new cluster (you can't go too fast, 
the new cluster couldn't not handle too many clients)
3.upgrade one node in the old cluster to the new version of rabbitmq
4.add the node upgraded to the new cluster
5. redirect some of your clients to the new cluster
6.repeat step 3 to 5 until all nodes upgraded and all clients redirected to 
the new cluster

To create rabbitmq cluster, rabbitmqctl command is the only way to achieve 
as I know.

On Thursday, April 5, 2012 1:02:55 AM UTC+8, Eslam El Husseiny wrote:
>
> sorry but i didn't understand the procedure of adding new physical cluster 
> running 2.8.1
> do you mean using rabbitmqctl command to new physical machine to cluster , 
> OR ?
>
> Thanks in advance 
>
> On Monday, April 2, 2012 6:35:11 AM UTC+2, Brendan Hay wrote:
>>
>> Hi Roshan,
>>
>> I would suggest you provision a _new_ physical cluster running 2.8.1
>> side by side with your old cluster, and then incrementally move
>> producers/consumers over.
>>
>> Are you using some sort of load-balancer in front of your cluster,
>> such as HAProxy or LVS?
>> What sort of service discovery do the clients use to find Rabbit?
>> (Chef, ZooKeeper, hard-coded configs, etc.)
>>
>> Regards,
>> Brendan
>>
>> On Apr 2, 3:14 am, Codevally <codeva... at gmail.com> wrote:
>> > Hi All
>> >
>> > I need to upgrade our current production 2.7.1 RabbitMQ cluster to it's 
>> new
>> > 2.8.1 version.
>> >
>> > In our production cluster, we have 2 disc node and erlang R15B 
>> installed.
>> > According to the RabbitMQ cluster guilde:
>> >
>> > "All nodes in a cluster must be running the same versions of Erlang and
>> > RabbitMQ, although they may have different plugins installed. Therefore 
>> it
>> > is necessary to stop all nodes in the cluster, then start all nodes when
>> > performing an upgrade."
>> >
>> > In our case we cannot shutdown our existing cluster, because it is 
>> heavily
>> > used to send messages across regions.
>> >
>> > Could someone please let me know how to upgrade 2.7.1 cluster without
>> > shutdown the entire cluster.
>> >
>> > Many Thanks.
>> > /Roshan
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-disc... at lists.rabbitmq.comhttps://
>> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120523/c6914fcf/attachment.htm>

From rader.net at gmail.com  Wed May 23 10:10:56 2012
From: rader.net at gmail.com (Rader Lei)
Date: Wed, 23 May 2012 02:10:56 -0700 (PDT)
Subject: [rabbitmq-discuss] Help with persistence using RabbitMQ?
In-Reply-To: <CA+-WFvwBN0j0bQw3dM7F_oQtkmmqk0bNNSzaNaeyzBWKMQ1j0g@mail.gmail.com>
References: <CA+-WFvwBN0j0bQw3dM7F_oQtkmmqk0bNNSzaNaeyzBWKMQ1j0g@mail.gmail.com>
Message-ID: <cb7dda8e-9e5c-4e27-8dee-379a3eb3ab6f@googlegroups.com>

Hi James,

Both the queue and every single message should be durable if you want 
RabbitMQ to persist messages for you. For a queue, declare it as durable. 
For a message, set the "deliveryMode" to 2 (persistent), default is 1 
(non-persistent), when publish it.

On Tuesday, April 3, 2012 7:01:32 AM UTC+8, iceblaze wrote:
>
> Hello, 
>
> I seem to be having problems with persistence using RabbitMQ, and I was 
> wondering if someone would help point out what I'm missing?
>
> For example, http://pastebin.com/PRRHx5hF
>
> I run the "send" function 20 times to fill the queue with 20 messages, 
> then I run rabbitmqadmin list queues, and after /etc/init.d/rabbitmq-server 
> restart. Finally. I run rabbitmqadmin list queues again and as you can see 
> the queue and exchange persist, but the messages are lost. 
>
> I can provide any other information if necessary.
>
> Thanks!!
>
> -James
>
> -- 
> "Of course, the actual government of any computer is run by that fascist 
> dictator known as the operating system. But a wise dictator knows when to 
> let the people think they're capitalists--and when to let them think 
> they're communists." - Programming Perl third edition
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120523/c983f87c/attachment.htm>

From simon at rabbitmq.com  Wed May 23 11:22:59 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 23 May 2012 11:22:59 +0100
Subject: [rabbitmq-discuss] Clustered server doesn't permit local
	connections
In-Reply-To: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>
References: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>
Message-ID: <4FBCBA83.6050607@rabbitmq.com>

On 23/05/12 00:38, Glade wrote:
>                  {error,{badarg,{error,bad_module}},
>                         'connection.open',

Hmm. This looks like the Erlang VM is failing to load one of RabbitMQ's 
modules. This should really not happen.

Did you compile RabbitMQ yourself? How did you install RabbitMQ / Erlang?

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed May 23 11:35:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 23 May 2012 11:35:08 +0100
Subject: [rabbitmq-discuss] Clustered server doesn't permit
	local	connections
In-Reply-To: <4FBCBA83.6050607@rabbitmq.com>
References: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>
	<4FBCBA83.6050607@rabbitmq.com>
Message-ID: <4FBCBD5C.7090704@rabbitmq.com>

On 23/05/12 11:22, Simon MacMullen wrote:
> On 23/05/12 00:38, Glade wrote:
>> {error,{badarg,{error,bad_module}},
>> 'connection.open',
>
> Hmm. This looks like the Erlang VM is failing to load one of RabbitMQ's
> modules. This should really not happen.

Gah, no this isn't true at all. It's breaking trying to register with 
the alarm handler. Could you post the main and sasl logs somewhere?

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed May 23 11:37:02 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 23 May 2012 11:37:02 +0100
Subject: [rabbitmq-discuss] Clustered server doesn't permit
	local	connections
In-Reply-To: <5ad8bff6-2f85-4bf1-86d1-385b8d63a995@googlegroups.com>
References: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>
	<5ad8bff6-2f85-4bf1-86d1-385b8d63a995@googlegroups.com>
Message-ID: <4FBCBDCE.6050000@rabbitmq.com>

On 23/05/12 09:09, Eric Siroker wrote:
> I've encountered the same issue.  I believe it's a regression in
> RabbitMQ 2.8.2.  Neither 2.7.1 nor 2.8.1 exhibit this issue for me.

Unless you're seeing the same message in the RabbitMQ logs then I 
wouldn't expect it's the same thing - check your logs to see what is 
happening.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed May 23 13:12:09 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 23 May 2012 13:12:09 +0100
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of
	a	burst
In-Reply-To: <96B991A3-CA8F-4DE5-8196-36E9AB952BE6@rabbitmq.com>
References: <4FB76237.7020901@gmail.com>
	<4FB81282.2020006@gmail.com>	<D3224EFC-D5D5-46F6-BB3F-A030792ABF02@rabbitmq.com>	<4FBADC88.2060705@gmail.com>	<A2CF3269-B4F5-4D6A-BDD2-631BFEEC6206@rabbitmq.com>	<8A2E96DF-6DD7-4560-B6C5-FB8229DBB330@rabbitmq.com>	<4FBBD5C5.2060601@gmail.com>
	<96B991A3-CA8F-4DE5-8196-36E9AB952BE6@rabbitmq.com>
Message-ID: <4FBCD419.7050103@rabbitmq.com>

On 23/05/12 11:04, Steve Powell wrote:
> Typically, releases are weeks apart rather than months,
> but I'm afraid I don't have an estimate for the next one.

NB: if you are affected by this bug, you can work around it for the time 
being by not setting the "content-length" header.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Wed May 23 13:31:08 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 23 May 2012 13:31:08 +0100
Subject: [rabbitmq-discuss] is mine normal, fast, or lame ?
In-Reply-To: <3586fc2802031b4b765eb40f77a5e3ed.squirrel@localhost>
References: <4FB9B491.20308@indoakses-online.com>
	<4FBA1DA5.1040406@rabbitmq.com>
	<3586fc2802031b4b765eb40f77a5e3ed.squirrel@localhost>
Message-ID: <4FBCD88C.4060607@rabbitmq.com>

On 21/05/12 14:58, bino at indoakses-online.com wrote:
> Dear Tim and All
>
>> (tim wrote)
>> So this all depends on your configuration. There are a few things you
>> can look at - can you post the whole configuration you\'re using
>> (scrubbed of any private data if that\'s applicable) so we can take a look?
>>
> Thankyou for your response
>
> Here I post the config at pastebin : http://pastebin.com/8pqJikF9
>
> Note that there is fleet_shovel1 -- fleet_shovel5, different name but
> identical configs
Hi Bino. A couple of things stand out from this config as pretty odd. 
Firstly, why have 5 different shovels, instead of 1 shovel with 5 
sources and 1 destination? Also if all 5 sources are the same but 
configured in different shovels, then you're going to loose any ordering 
guarantees you might have expected to have - not sure if this is what 
you intended or not?

You should also consider setting a prefetch count, as the consumer could 
possibly be coming under strain without this.

I've also posted a question regarding your previous message.

Cheers,
Tim

>
> Sincerely
> -bino-
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Wed May 23 13:33:56 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 23 May 2012 13:33:56 +0100
Subject: [rabbitmq-discuss] is mine normal, fast, or lame ?
In-Reply-To: <4FBA1DA5.1040406@rabbitmq.com>
References: <4FB9B491.20308@indoakses-online.com>
	<4FBA1DA5.1040406@rabbitmq.com>
Message-ID: <4FBCD934.8080700@rabbitmq.com>

On 21/05/12 11:49, Tim Watson wrote:
> On 21/05/2012 04:20, bino oetomo wrote:
>> Dear all.
>> I do a performance test.
>>
>> 1. engine1 :
>> RabbitMQ server with 5 shovel.
>> This 5 shovel have different name , but other config is identical.
>> 2. engine2 :
>> Remote located RabbitMQ
>>
>> Connection engine1<<====>>engine2 : 1mbps clear
>>
>> The test :
>> 1. I stop rabbitMQ at engine2
>> 2. Load 800000 line of msg , average of 250 character per msg
>> 3. When it done , I start RabbitMQ at engine2 .... and put my eyes at
>> it's management web UI.
>>
>> Result :
>> 1. engine1 : 'Acknowledge' box best rate is only 47 msg/s
>> 2. engine2: the 'Ready' box always said between 350-400 msg/s
>>

Is the 'Acknowledge' box the broker with the 5 shovels? I'm not 100% 
clear on what you're trying to achieve here, but why have 5 shovels from 
1 broker to another?

>> Is that normal, fast, or lame ?
>>
>
> So this all depends on your configuration. There are a few things you 
> can look at - can you post the whole configuration you're using 
> (scrubbed of any private data if that's applicable) so we can take a 
> look?
>
>> will that any effect on running multiple shovel with identical config ?
>>
>> Sincerely
>> -bino-
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jose.mico at gmail.com  Wed May 23 14:19:51 2012
From: jose.mico at gmail.com (=?ISO-8859-1?Q?Jos=E9_Mic=F3?=)
Date: Wed, 23 May 2012 10:19:51 -0300
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of
	a	burst
In-Reply-To: <4FBCD419.7050103@rabbitmq.com>
References: <4FB76237.7020901@gmail.com>
	<4FB81282.2020006@gmail.com>	<D3224EFC-D5D5-46F6-BB3F-A030792ABF02@rabbitmq.com>	<4FBADC88.2060705@gmail.com>	<A2CF3269-B4F5-4D6A-BDD2-631BFEEC6206@rabbitmq.com>	<8A2E96DF-6DD7-4560-B6C5-FB8229DBB330@rabbitmq.com>	<4FBBD5C5.2060601@gmail.com>
	<96B991A3-CA8F-4DE5-8196-36E9AB952BE6@rabbitmq.com>
	<4FBCD419.7050103@rabbitmq.com>
Message-ID: <4FBCE3F7.2090309@gmail.com>

On 05/23/2012 09:12 AM, Simon MacMullen wrote:
>
> NB: if you are affected by this bug, you can work around it for the 
> time being by not setting the "content-length" header.
>

Thanks for the tip. I just removed the header and turned off compression 
(as payload cannot contain \x00 anymore) and got no losses anymore.

Jos?

From Barnea at 3i-mind.com  Wed May 23 15:37:41 2012
From: Barnea at 3i-mind.com (Lior Barnea)
Date: Wed, 23 May 2012 16:37:41 +0200
Subject: [rabbitmq-discuss] Windows service recovery
Message-ID: <C3A760638FE7B343972DD905011226E3058AF1472D@GZSMSCCR03.sms1.local>

Hi all,

I am trying to set a recovery policy for rabbitMQ windows service.

Installing rabbitMQ as a windows service sets erlsrv.exe as the internal executable.
I set the OnFail option of Erlang emulator to restart.
I set windows policy for erlsvr.exe to restart on fail.
Starting the service will start the erlsvr.exe process which then spawns erl.exe which is the actual process running rabbitMQ.

Killing erl.exe invokes the OnFail (does not alerts windows cause the windows recovery policy is on erlsvr.exe) and restarts rabbitMQ, which is great.

Killing erlsvr.exe does not stop erl.exe (meaning rabbitMQ still running) but does alert windows that then tries to restart erlsvr.exe
When erlsvr.exe is started again, it tries to spawn erl.exe again and fails because it is already running, failing erlsvr.exe completely, recovery failed.

Help please :)




Lior Barnea

Developer





3i-MIND

T. 074-719-2884

???

M.054-816-7341

www.3i-mind.com

barnea at 3i-mind.com



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120523/2a89d632/attachment.htm>

From steve at rabbitmq.com  Wed May 23 16:18:42 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 23 May 2012 16:18:42 +0100
Subject: [rabbitmq-discuss] JAVA client / non daemon threads / shutdown
	hook
In-Reply-To: <CAOYfuETqOPXRtf_AT4rHHv4GyB_k7Wb7Hy44WjNv4fEGyNYEuA@mail.gmail.com>
References: <CAOYfuETqOPXRtf_AT4rHHv4GyB_k7Wb7Hy44WjNv4fEGyNYEuA@mail.gmail.com>
Message-ID: <BE13C04D-A443-4E53-AA72-C3AAA0F778BF@rabbitmq.com>

Bart?omiej,

What a very good point. It is clear that the MainLoop thread ought to be
a daemon thread in your circumstances, thank you for pointing this out.
The only affect of this will be to allow the JVM to terminate if only
daemon threads are available.

However, we have considered this problem before (internal bug 21110) and
user apps that create a connection and register some consumers (which do
all the work) ought to be able to terminate without accidentally killing
the connection processing.

This means that there are circumstances in which the threads we create
are required to be non-daemon, and circumstances where you would like
them to be daemon.

The hook you implemented ought to work correctly even when the MainLoop
is not a daemon, because closing the connection ought to make the
MainLoop thread terminate normally. If it doesn't, there is a bug. Where
at all possible you should attempt to close an open connection as a part
of your termination processing as there are system resources that could
be left high-and-dry if you do not.

There are other threads in the Java Client -- the executor worker
threads used for Consumer callbacks. These are non-daemon, too. The hook
should still work because shutting down the connection ought to shutdown
the consumer work service, and in turn the executor (and its worker
threads).

However, I could make them daemon threads as well, in case the main app
terminates abruptly and expects to be able to terminate uncleanly as you
describe.

Thank you for reporting this. I'll report back here on progress.

Steve Powell  (a happy bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

On 18 May 2012, at 16:27, Bart?omiej Prokop wrote:

> Hi,
> 
> I'm using JAVA client for RabbitMQ (com.rabbitmq:amqp-client:2.8.1) to write a "jar component" capable of sending messages for some legacy system. The idea is to wrap all code that maintain the connection inside my component. This way, the client software deals only with very simple methods like "post" and is not aware of any connection handling. The connect/reconnect code is written and hidden from the legacy system.
> 
> The problem I have faced is that Java client creates "behind the scene" some threads to manage connection - like:
>          lines 299-301 of AMQConnection class.
>         // start the main loop going
>         new MainLoop("AMQP Connection " + getHostAddress() + ":" + getPort()).start();
>         // after this point clear-up of MainLoop is triggered by closing the frameHandler.
> 
> Unfortunatelly, those threads aren't "daemon" threads. So, when main application ends and appropriate connection closing not occurs, the VM won't terminate. My approach was to add some shutdown hook to close RabbitMQ connections if it is live inside my "jar component". But, due to those non-daemon threads, VM is not going ever to be terminated and shutdown hooks fired.
> 
> It is a question to RabbitMQ driver developers, if the internal threads could be fired as daemon threads, could it be done in future releases?
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From gladed at gmail.com  Wed May 23 16:24:24 2012
From: gladed at gmail.com (Glade Diviney)
Date: Wed, 23 May 2012 08:24:24 -0700
Subject: [rabbitmq-discuss] Clustered server doesn't permit local
	connections
In-Reply-To: <4FBCBD5C.7090704@rabbitmq.com>
References: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>
	<4FBCBA83.6050607@rabbitmq.com> <4FBCBD5C.7090704@rabbitmq.com>
Message-ID: <CAODk++ep=_6RRHEQsEE29UsvT5pj0yPKkb1gxgY=MLJ1MDjAMg@mail.gmail.com>

Hi Simon,

Your instinct may be right on alarms. I did service rabbitmq stop, cleared
the logs, the service rabbitmq start and saw this in rabbit.log:

=INFO REPORT==== 23-May-2012::15:20:15 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 23-May-2012::15:20:15 ===
Memory limit set to 1503MB of 3758MB total.

=INFO REPORT==== 23-May-2012::15:20:15 ===
Disk free limit set to 3758MB

=INFO REPORT==== 23-May-2012::15:20:15 ===
Disk free space limit now exceeded. Free bytes:3678556160 Limit:3941388288

=INFO REPORT==== 23-May-2012::15:20:15 ===
    alarm_handler: {set,{{resource_limit,disk,'rabbit at ip-10-70-82-246'},[]}}

=INFO REPORT==== 23-May-2012::15:20:15 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 23-May-2012::15:20:15 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 23-May-2012::15:20:15 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 23-May-2012::15:20:15 ===
rabbit on node 'rabbit at ip-10-12-183-2' up

=ERROR REPORT==== 23-May-2012::15:20:15 ===
** gen_event handler rabbit_alarm crashed.
** Was installed in alarm_handler
** Last event was: {register,<2894.58.0>,
                             {rabbit_alarm,remote_conserve_resources,[]}}
** When handler state == {alarms,
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             {dict,1,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},
                                 {{[],[],[],[],[],[],
                                   [['rabbit at ip-10-70-82-246',disk]],
                                   [],[],[],[],[],[],[],[],[]}}}}
** Reason == {'function not exported',

 [{rabbit_alarm,remote_conserve_resources,[<2894.58.0>,true]},
                  {rabbit_alarm,internal_register,3},
                  {rabbit_alarm,handle_event,2},
                  {gen_event,server_update,4},
                  {gen_event,server_notify,4},
                  {gen_event,handle_msg,5},
                  {proc_lib,init_p_do_apply,3}]}

What's the prognosis, doc?

Thanks,
-Glade

On Wed, May 23, 2012 at 3:35 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 23/05/12 11:22, Simon MacMullen wrote:
>
>> On 23/05/12 00:38, Glade wrote:
>>
>>> {error,{badarg,{error,bad_**module}},
>>> 'connection.open',
>>>
>>
>> Hmm. This looks like the Erlang VM is failing to load one of RabbitMQ's
>> modules. This should really not happen.
>>
>
> Gah, no this isn't true at all. It's breaking trying to register with the
> alarm handler. Could you post the main and sasl logs somewhere?
>
>
> Cheers, Simon
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120523/15053546/attachment.htm>

From simon at rabbitmq.com  Wed May 23 16:37:49 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 23 May 2012 16:37:49 +0100
Subject: [rabbitmq-discuss] Clustered server doesn't permit local
	connections
In-Reply-To: <CAODk++ep=_6RRHEQsEE29UsvT5pj0yPKkb1gxgY=MLJ1MDjAMg@mail.gmail.com>
References: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>
	<4FBCBA83.6050607@rabbitmq.com> <4FBCBD5C.7090704@rabbitmq.com>
	<CAODk++ep=_6RRHEQsEE29UsvT5pj0yPKkb1gxgY=MLJ1MDjAMg@mail.gmail.com>
Message-ID: <4FBD044D.9070902@rabbitmq.com>

On 23/05/12 16:24, Glade Diviney wrote:
> Hi Simon,
>
> Your instinct may be right on alarms. I did service rabbitmq stop,
> cleared the logs, the service rabbitmq start and saw this in rabbit.log:

<snip>

> ** Reason == {'function not exported',
>
>   [{rabbit_alarm,remote_conserve_resources,[<2894.58.0>,true]},
>                    {rabbit_alarm,internal_register,3},
>                    {rabbit_alarm,handle_event,2},
>                    {gen_event,server_update,4},
>                    {gen_event,server_notify,4},
>                    {gen_event,handle_msg,5},
>                    {proc_lib,init_p_do_apply,3}]}
>
> What's the prognosis, doc?

Aha!

That function was renamed in 2.8.2. Are you by any chance running a 
cluster with mixed RabbitMQ versions?

That is very likely to lead to random breakage - like this.

Future versions of RabbitMQ will probably refuse to start instead.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Wed May 23 16:52:13 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 23 May 2012 16:52:13 +0100
Subject: [rabbitmq-discuss] stomp+ssl message send works,
	receive hangs after around 200-300 messages
In-Reply-To: <4FBBD704.7060305@gmx.net>
References: <jp7ltn$rn3$1@dough.gmane.org>
	<86B07026-4324-4BB2-B008-DBC605C03E33@rabbitmq.com>
	<4FBBD704.7060305@gmx.net>
Message-ID: <BE7A82AB-B2F9-4E0B-80BC-F7651BD5F30B@rabbitmq.com>

Michael,

Thanks for the update. Can you be a little more specific about the
set-up that fails?

In particular I would like to know:

-  the version of Erlang you are using, and the (v)hardware you are
   running RabbitMQ on (a copy of the startup log would be nice);

-  if the problem is noticed on a non-ssl connection (if you can try
   this) -- we haven't seen this particular problem on our tests;

-  are there any messages in the rabbitmq log around the time the
   message delivery stops?

-  can you provide more details about the topic subscription --
   is this a durable subscription, for example;

-  and do the acknowledgements actually get through (you can tell this
   if messages you think you have consumed are redelivered on
   reconnect)?

We have recently discovered (and fixed) a bug in the STOMP client that
will stop the broker seeing the last message sent (under load). It is
possible that, if pre-fetch is set to 1, this is causing you to jam
up -- the STOMP code may not be detecting your last acknowledgement. To
confirm this, please try this with a pre-fetch count of zero (or 2 or
more) and see if you still get the lock-up.

I hope we can get to the bottom of this.
Steve Powell  (a happy bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

On 22 May 2012, at 19:12, Michael Justin wrote:

> Am 21.05.2012 16:08, Steve Powell wrote:
>> Michael,
>> 
>> Yes STOMP+SSL ought to work fine.
>> 
>> Can you describe some more about the failure in this case? What sort of
>> subscription are you using? When the client reconnects (and presumably
>> re-subscribes) do any messages get lost when this happens? Are there any
>> messages in the rabbitmq when things grind to a halt?
>> 
>> What client software are you using?
>> 
>> It would be great if you could supply a small program that demonstrates
>> your problem. Thank you.
> 
> 
> Hi Steve,
> 
> The problem seems to be OS specific - today I received confirmation that RabbitMQ with stomp+ssl works on a Linux box in the Amazon EC2 cloud with my client library, which is written in Delphi.
> 
> To confirm this, I will run a test with RabbitMQ 2.8.2 running on a Ubuntu 11.10 system in the next days.
> 
> The test tool uses a topic destination. There has not been any message loss, only a stop of message delivery after two to three seconds.
> 
> The tool also uses client ack mode, so the client not only listens but also sends data over the SSL socket for every message, so I assume that the reason for stopped message delivery is not 'missing traffic' on the wire.
> 
> If you like to test it, could upload the test tool to my web space - it is a self-contained executable which only needs the OpenSSL libraries in the system path to run.
> 
> Regards
> -- 
> Michael Justin
> habarisoft - Enterprise Messaging Software for Delphi
> http://www.habarisoft.com/


From gladed at gmail.com  Wed May 23 17:05:44 2012
From: gladed at gmail.com (Glade Diviney)
Date: Wed, 23 May 2012 09:05:44 -0700
Subject: [rabbitmq-discuss] Clustered server doesn't permit local
	connections
In-Reply-To: <4FBD044D.9070902@rabbitmq.com>
References: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>
	<4FBCBA83.6050607@rabbitmq.com> <4FBCBD5C.7090704@rabbitmq.com>
	<CAODk++ep=_6RRHEQsEE29UsvT5pj0yPKkb1gxgY=MLJ1MDjAMg@mail.gmail.com>
	<4FBD044D.9070902@rabbitmq.com>
Message-ID: <CAODk++crcAKGM-8-fnp=2jY4JEjzEo8WC4mRLSbTG2QJapskOw@mail.gmail.com>

I'm running 2.8.2 on both machines. Version lines in "rabbitmqctl status"
match on both.

I installed from .deb, from the "testing" repo as instructed by
http://www.rabbitmq.com/install-debian.html.

I tried disabling the cluster, and was able to bring up the singleton
rabbitmq instance and use it successfully. As soon as I brought up the
other instance, everything fails again.

Thanks for the troubleshooting you've done so far...any other advise?

-Glade

On Wed, May 23, 2012 at 8:37 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 23/05/12 16:24, Glade Diviney wrote:
>
>> Hi Simon,
>>
>> Your instinct may be right on alarms. I did service rabbitmq stop,
>> cleared the logs, the service rabbitmq start and saw this in rabbit.log:
>>
>
> <snip>
>
>
>  ** Reason == {'function not exported',
>>
>>  [{rabbit_alarm,remote_**conserve_resources,[<2894.58.**0>,true]},
>>                   {rabbit_alarm,internal_**register,3},
>>                   {rabbit_alarm,handle_event,2},
>>                   {gen_event,server_update,4},
>>                   {gen_event,server_notify,4},
>>                   {gen_event,handle_msg,5},
>>                   {proc_lib,init_p_do_apply,3}]}
>>
>> What's the prognosis, doc?
>>
>
> Aha!
>
> That function was renamed in 2.8.2. Are you by any chance running a
> cluster with mixed RabbitMQ versions?
>
> That is very likely to lead to random breakage - like this.
>
> Future versions of RabbitMQ will probably refuse to start instead.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120523/94d67d35/attachment.htm>

From gladed at gmail.com  Wed May 23 17:31:40 2012
From: gladed at gmail.com (Glade Diviney)
Date: Wed, 23 May 2012 09:31:40 -0700
Subject: [rabbitmq-discuss] Clustered server doesn't permit local
	connections
In-Reply-To: <CAODk++crcAKGM-8-fnp=2jY4JEjzEo8WC4mRLSbTG2QJapskOw@mail.gmail.com>
References: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>
	<4FBCBA83.6050607@rabbitmq.com> <4FBCBD5C.7090704@rabbitmq.com>
	<CAODk++ep=_6RRHEQsEE29UsvT5pj0yPKkb1gxgY=MLJ1MDjAMg@mail.gmail.com>
	<4FBD044D.9070902@rabbitmq.com>
	<CAODk++crcAKGM-8-fnp=2jY4JEjzEo8WC4mRLSbTG2QJapskOw@mail.gmail.com>
Message-ID: <CAODk++f18gYn2VP5KhNSXA+h+Nr2jg8e_QR421Q0RWVKFQPa1g@mail.gmail.com>

Also note: I rebooted both machines and the problem does not happen. From
experience, I expect it to occur again though.

On Wed, May 23, 2012 at 9:05 AM, Glade Diviney <gladed at gmail.com> wrote:

> I'm running 2.8.2 on both machines. Version lines in "rabbitmqctl status"
> match on both.
>
> I installed from .deb, from the "testing" repo as instructed by
> http://www.rabbitmq.com/install-debian.html.
>
> I tried disabling the cluster, and was able to bring up the singleton
> rabbitmq instance and use it successfully. As soon as I brought up the
> other instance, everything fails again.
>
> Thanks for the troubleshooting you've done so far...any other advise?
>
> -Glade
>
>
> On Wed, May 23, 2012 at 8:37 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 23/05/12 16:24, Glade Diviney wrote:
>>
>>> Hi Simon,
>>>
>>> Your instinct may be right on alarms. I did service rabbitmq stop,
>>> cleared the logs, the service rabbitmq start and saw this in rabbit.log:
>>>
>>
>> <snip>
>>
>>
>>  ** Reason == {'function not exported',
>>>
>>>  [{rabbit_alarm,remote_**conserve_resources,[<2894.58.**0>,true]},
>>>                   {rabbit_alarm,internal_**register,3},
>>>                   {rabbit_alarm,handle_event,2},
>>>                   {gen_event,server_update,4},
>>>                   {gen_event,server_notify,4},
>>>                   {gen_event,handle_msg,5},
>>>                   {proc_lib,init_p_do_apply,3}]}
>>>
>>> What's the prognosis, doc?
>>>
>>
>> Aha!
>>
>> That function was renamed in 2.8.2. Are you by any chance running a
>> cluster with mixed RabbitMQ versions?
>>
>> That is very likely to lead to random breakage - like this.
>>
>> Future versions of RabbitMQ will probably refuse to start instead.
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120523/d27feceb/attachment.htm>

From esiroker at gmail.com  Wed May 23 17:42:07 2012
From: esiroker at gmail.com (Eric Siroker)
Date: Wed, 23 May 2012 09:42:07 -0700
Subject: [rabbitmq-discuss] Clustered server doesn't permit local
	connections
In-Reply-To: <4FBCBA83.6050607@rabbitmq.com>
References: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>
	<4FBCBA83.6050607@rabbitmq.com>
Message-ID: <CAN5y6seWPaZ6k_xUkrA1q2DArmHJAz-hR4zeWs4T=z2bQi0ZYw@mail.gmail.com>

On Wed, May 23, 2012 at 3:22 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> Did you compile RabbitMQ yourself? How did you install RabbitMQ / Erlang?

I compiled both RabbitMQ and Erlang manually myself.  Used Erlang R15B01.

On Wed, May 23, 2012 at 3:37 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> Unless you're seeing the same message in the RabbitMQ logs then I wouldn't
> expect it's the same thing - check your logs to see what is happening.

Sorry, I should have been more explicit.  When I said I encountered
the same issue, I meant I also was seeing the same thing in my logs.

To be clear, that's:

{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

On Wed, May 23, 2012 at 8:37 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> That function was renamed in 2.8.2. Are you by any chance running a cluster
> with mixed RabbitMQ versions?

Both nodes run 2.8.2.  Perhaps I need to restart epmd when updating?

Eric

From simon at rabbitmq.com  Wed May 23 17:50:38 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 23 May 2012 17:50:38 +0100
Subject: [rabbitmq-discuss] Clustered server doesn't permit local
	connections
In-Reply-To: <CAODk++crcAKGM-8-fnp=2jY4JEjzEo8WC4mRLSbTG2QJapskOw@mail.gmail.com>
References: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>
	<4FBCBA83.6050607@rabbitmq.com> <4FBCBD5C.7090704@rabbitmq.com>
	<CAODk++ep=_6RRHEQsEE29UsvT5pj0yPKkb1gxgY=MLJ1MDjAMg@mail.gmail.com>
	<4FBD044D.9070902@rabbitmq.com>
	<CAODk++crcAKGM-8-fnp=2jY4JEjzEo8WC4mRLSbTG2QJapskOw@mail.gmail.com>
Message-ID: <4FBD155E.6030701@rabbitmq.com>

Damn, this is a bug :( I've replicated it.

It occurs when you bring up a new node in an existing cluster, and that 
node is sufficiently short of memory or disc space that the memory or 
disc space alarm goes off immediately. It does not occur when an alarm 
goes off after the node has started.

I believe it should only manifest on the new node. Certainly that's what 
I'm seeing. But the node never recovers. And a running node should not 
be able to get into this state.

The workaround is to ensure your nodes have enough memory and disc space 
when they start.

Needless to say, we will fix this in a new release soon.

Cheers, Simon

On 23/05/12 17:05, Glade Diviney wrote:
> I'm running 2.8.2 on both machines. Version lines in "rabbitmqctl
> status" match on both.
>
> I installed from .deb, from the "testing" repo as instructed by
> http://www.rabbitmq.com/install-debian.html.
>
> I tried disabling the cluster, and was able to bring up the singleton
> rabbitmq instance and use it successfully. As soon as I brought up the
> other instance, everything fails again.
>
> Thanks for the troubleshooting you've done so far...any other advise?
>
> -Glade
>
> On Wed, May 23, 2012 at 8:37 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 23/05/12 16:24, Glade Diviney wrote:
>
>         Hi Simon,
>
>         Your instinct may be right on alarms. I did service rabbitmq stop,
>         cleared the logs, the service rabbitmq start and saw this in
>         rabbit.log:
>
>
>     <snip>
>
>
>         ** Reason == {'function not exported',
>
>           [{rabbit_alarm,remote___conserve_resources,[<2894.58.__0>,true]},
>                            {rabbit_alarm,internal___register,3},
>                            {rabbit_alarm,handle_event,2},
>                            {gen_event,server_update,4},
>                            {gen_event,server_notify,4},
>                            {gen_event,handle_msg,5},
>                            {proc_lib,init_p_do_apply,3}]}
>
>         What's the prognosis, doc?
>
>
>     Aha!
>
>     That function was renamed in 2.8.2. Are you by any chance running a
>     cluster with mixed RabbitMQ versions?
>
>     That is very likely to lead to random breakage - like this.
>
>     Future versions of RabbitMQ will probably refuse to start instead.
>
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed May 23 17:51:46 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 23 May 2012 17:51:46 +0100
Subject: [rabbitmq-discuss] Clustered server doesn't permit
	local	connections
In-Reply-To: <CAN5y6seWPaZ6k_xUkrA1q2DArmHJAz-hR4zeWs4T=z2bQi0ZYw@mail.gmail.com>
References: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>	<4FBCBA83.6050607@rabbitmq.com>
	<CAN5y6seWPaZ6k_xUkrA1q2DArmHJAz-hR4zeWs4T=z2bQi0ZYw@mail.gmail.com>
Message-ID: <4FBD15A2.8080100@rabbitmq.com>

On 23/05/12 17:42, Eric Siroker wrote:
> Sorry, I should have been more explicit.  When I said I encountered
> the same issue, I meant I also was seeing the same thing in my logs.

Ah, my apologies. In that case, see my explanation upthread:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/020290.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From gladed at gmail.com  Wed May 23 18:41:49 2012
From: gladed at gmail.com (Glade)
Date: Wed, 23 May 2012 10:41:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Clustered server doesn't permit local
	connections
In-Reply-To: <5ad8bff6-2f85-4bf1-86d1-385b8d63a995@googlegroups.com>
References: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>
	<5ad8bff6-2f85-4bf1-86d1-385b8d63a995@googlegroups.com>
Message-ID: <47308955-20ad-4ec0-88b4-038d6638cc93@googlegroups.com>

I've heard this is a bug in 2.8.2. It's caused by an alarm related to disk 
space or RAM space going off at startup. Unfortunately the node never 
recovers from this condition. The workaround is to ensure that sufficient 
disk/RAM is available when the node powers up.

-Glade

On Wednesday, May 23, 2012 1:09:06 AM UTC-7, Eric Siroker wrote:
>
> I've encountered the same issue.  I believe it's a regression in RabbitMQ 
> 2.8.2.  Neither 2.7.1 nor 2.8.1 exhibit this issue for me.
>
> I'm including two test cases, one using amqplib and one using Pika.
>
> Running a two node cluster with RabbitMQ 2.8.2, these test cases will 
> succeed on one node, but fail on the other.
>
> If you restart RabbitMQ on one of the nodes, it'll sometimes switch which 
> node makes the test cases succeed.
>
> Eric
>
> ====== amqplib test case
> from amqplib import client_0_8 as amqp
>
> connection = amqp.Connection(host='', username='', password='')
>
> # Raises socket.error: [Errno 104] Connection reset by peer
> connection.close()
>
> ====== Pika test case
> import pika
>
> credentials = pika.PlainCredentials(username='', password='')
> connection_parameters = pika.ConnectionParameters(host='', 
> credentials=credentials)
> connection = pika.BlockingConnection(connection_parameters)
> channel = connection.channel()
>
> # Raises pika.exceptions.ChannelClosed
> channel.exchange_declare(exchange='exchange')
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120523/edcc5f04/attachment.htm>

From esiroker at gmail.com  Wed May 23 19:14:04 2012
From: esiroker at gmail.com (Eric Siroker)
Date: Wed, 23 May 2012 11:14:04 -0700
Subject: [rabbitmq-discuss] Clustered server doesn't permit local
	connections
In-Reply-To: <4FBD155E.6030701@rabbitmq.com>
References: <0d089884-afbe-442b-9065-f69268c274f8@googlegroups.com>
	<4FBCBA83.6050607@rabbitmq.com> <4FBCBD5C.7090704@rabbitmq.com>
	<CAODk++ep=_6RRHEQsEE29UsvT5pj0yPKkb1gxgY=MLJ1MDjAMg@mail.gmail.com>
	<4FBD044D.9070902@rabbitmq.com>
	<CAODk++crcAKGM-8-fnp=2jY4JEjzEo8WC4mRLSbTG2QJapskOw@mail.gmail.com>
	<4FBD155E.6030701@rabbitmq.com>
Message-ID: <CAN5y6sfFG0adBaDunqdfW8WdHC-LVEvxKqzRB4Y0yaTRPw_hSA@mail.gmail.com>

On Wed, May 23, 2012 at 9:50 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> It occurs when you bring up a new node in an existing cluster, and that node
> is sufficiently short of memory or disc space that the memory or disc space
> alarm goes off immediately.

I believe you're correct.  I increased the disk space available to
RabbitMQ so that it's above the low watermark and it's operating
correctly now.

Thanks for identifying the issue, Simon.

Eric

From pablomolnar at gmail.com  Wed May 23 20:32:12 2012
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Wed, 23 May 2012 16:32:12 -0300
Subject: [rabbitmq-discuss] Connections in state "flow"
Message-ID: <CANVSfpLfpzot8cjnJ1dSSfF71cU1Zz6Jc6agc8sUNCRzswepQg@mail.gmail.com>

Hi,

I've recently upgrade to RabbitMQ 2.8.2 and experiencing problems with the
connections. Every so all my consumers stop working and the connections
state is "flow" in the RabbitMQ mgmt plugin.
This is a block issue for me and if I cannot resolve this today I have to
rollback the whole cluster to 2.7.1 back.

Any ideas?

Pablo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120523/2e77653e/attachment.htm>

From pablomolnar at gmail.com  Wed May 23 20:43:12 2012
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Wed, 23 May 2012 16:43:12 -0300
Subject: [rabbitmq-discuss] Connections in state "flow"
In-Reply-To: <CANVSfpLfpzot8cjnJ1dSSfF71cU1Zz6Jc6agc8sUNCRzswepQg@mail.gmail.com>
References: <CANVSfpLfpzot8cjnJ1dSSfF71cU1Zz6Jc6agc8sUNCRzswepQg@mail.gmail.com>
Message-ID: <CANVSfpLwOp5Gu56cMAf3UeAzZXzNUnUJ51D-28Pzg7YTAEEWPQ@mail.gmail.com>

I'm attaching more info about the cluster. All the memory and disk
watermark levels are green: http://i.imgur.com/pXCcK.png

On Wed, May 23, 2012 at 4:32 PM, Pablo Molnar <pablomolnar at gmail.com> wrote:
> Hi,
>
> I've recently upgrade to RabbitMQ 2.8.2 and experiencing problems with the
> connections. Every so all my consumers stop working and the connections
> state is "flow" in the RabbitMQ mgmt plugin.
> This is a block issue for me and if I cannot resolve this today I have to
> rollback the whole cluster to 2.7.1 back.
>
> Any ideas?
>
> Pablo

From jason at cornsyrup.org  Thu May 24 08:46:24 2012
From: jason at cornsyrup.org (Jason Toffaletti)
Date: Thu, 24 May 2012 00:46:24 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq java client socket io performance (3
 sendto syscalls per basicPublish)
Message-ID: <33c23ae5-5d6c-4215-8744-73fcaa95d2ac@googlegroups.com>

I couldn't find a bug tracker, so I'm reporting this here.

I was stracing a java process that uses the 2.8.2 java amqp client and I 
noticed that every basicPublish is resulting in 3 sendto syscalls:

3026  00:06:51.269104 sendto(27, 
"\1\0\1\0\0\0\17\0<\0(\0\0\6hose04\0\0\316", 23, 0, NULL, 0 <unfinished ...>
3027  00:06:51.269127 <... futex resumed> ) = 0 <0.000030>
3026  00:06:51.269142 <... sendto resumed> ) = 23 <0.000019>
3025  00:06:51.269160 sendto(24, 
"\1\0\1\0\0\0\17\0<\0(\0\0\6hose03\0\0\316", 23, 0, NULL, 0 <unfinished ...>
3027  00:06:51.269189 futex(0x7f8e5c442b54, FUTEX_WAIT_PRIVATE, 10202495, 
NULL <unfinished ...>
3026  00:06:51.269211 sendto(27, "\2\0\1\0\0\0 
\0<\0\0\0\0\0\0\0\0\7\302\220\0\20application/json\1\316", 40, 0, NULL, 0 
<unfinished ...>
3025  00:06:51.269237 <... sendto resumed> ) = 23 <0.000058>
3026  00:06:51.269258 <... sendto resumed> ) = 40 <0.000024>
3025  00:06:51.269279 sendto(24, "\2\0\1\0\0\0 
\0<\0\0\0\0\0\0\0\0\10\206\220\0\20application/json\1\316", 40, 0, NULL, 0 
<unfinished ...>
3026  00:06:51.269314 sendto(27, "\3\0\1\0\0\7\302"..., 1994, 0, NULL, 0 
<unfinished ...>
3025  00:06:51.269444 <... sendto resumed> ) = 40 <0.000138>
3026  00:06:51.269463 <... sendto resumed> ) = 1994 <0.000025>

I believe these 3 sendto syscalls per basicPublish is a performance 
bottleneck and I went looking for a way to make it a single sendto call 
with all 3 frames included.

I'm fairly new to Java and AMQP, so bare with me.

The client is using BufferedOutputStream to wrap socket io in:

http://hg.rabbitmq.com/rabbitmq-java-client/file/b643c5c8ec23/src/com/rabbitmq/client/impl/SocketFrameHandler.java

BufferedOutputStream has a default buffer size of 512 bytes which suggests 
to me that flush() must be called in order to produce these small 23 and 40 
byte sendto calls.

AMQPCommand::transmit seems to be where the real action happens, and I see 
a connection.flush() at the end of that function:

http://hg.rabbitmq.com/rabbitmq-java-client/file/b643c5c8ec23/src/com/rabbitmq/client/impl/AMQCommand.java

However I'm still a bit confused because I think a basicPublish should only 
result in one transmit() and thus one flush() and one sendto(). This is 
where I'm stuck.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120524/50006d56/attachment.htm>

From matthias at rabbitmq.com  Thu May 24 09:22:57 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 24 May 2012 09:22:57 +0100
Subject: [rabbitmq-discuss] rabbitmq java client socket io performance
 (3 sendto syscalls per basicPublish)
In-Reply-To: <33c23ae5-5d6c-4215-8744-73fcaa95d2ac@googlegroups.com>
References: <33c23ae5-5d6c-4215-8744-73fcaa95d2ac@googlegroups.com>
Message-ID: <4FBDEFE1.9050904@rabbitmq.com>

On 24/05/12 08:46, Jason Toffaletti wrote:
> I was stracing a java process that uses the 2.8.2 java amqp client and I
> noticed that every basicPublish is resulting in 3 sendto syscalls:
> [...]

https://github.com/rabbitmq/rabbitmq-java-client/commit/41c67bf0502d4a13d08c4f42dc47721c5048779f 
changes that and will be in the next release.

The change actually makes very little difference to performance unless 
its an SSL connection.

Matthias.

From jason at cornsyrup.org  Thu May 24 09:39:38 2012
From: jason at cornsyrup.org (Jason Toffaletti)
Date: Thu, 24 May 2012 01:39:38 -0700
Subject: [rabbitmq-discuss] rabbitmq java client socket io performance
	(3 sendto syscalls per basicPublish)
In-Reply-To: <4FBDEFE1.9050904@rabbitmq.com>
References: <33c23ae5-5d6c-4215-8744-73fcaa95d2ac@googlegroups.com>
	<4FBDEFE1.9050904@rabbitmq.com>
Message-ID: <35692F62-CB31-4EB4-A262-700CFDD5E936@cornsyrup.org>

I was looking at the code in hg that includes this patch. Now it makes sense why I couldnt reconcile the behavior with the code. I'll look forward to the next release and test again then.

Thanks

On May 24, 2012, at 1:22 AM, Matthias Radestock <matthias at rabbitmq.com> wrote:

> On 24/05/12 08:46, Jason Toffaletti wrote:
>> I was stracing a java process that uses the 2.8.2 java amqp client and I
>> noticed that every basicPublish is resulting in 3 sendto syscalls:
>> [...]
> 
> https://github.com/rabbitmq/rabbitmq-java-client/commit/41c67bf0502d4a13d08c4f42dc47721c5048779f changes that and will be in the next release.
> 
> The change actually makes very little difference to performance unless its an SSL connection.
> 
> Matthias.

From brendan at soundcloud.com  Thu May 24 09:47:01 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Thu, 24 May 2012 10:47:01 +0200
Subject: [rabbitmq-discuss] RabbitMQ Roadmap
Message-ID: <CAHZsVQavvRv8Em4uUXR_tM0k0Eyn=iZBR5NdE-UFefOBDmxCLg@mail.gmail.com>

Yo!

There's been a few hints dropped here towards future changes in Federation,
Mirrored Queues, and making things a bit more transparent to clients
regarding physical topology layout.

Do you dudes have some sort of non-committal timeline/roadmap to share?
(Off the record is fine, we won't hold you to anything.)

I'm personally interested in things such as dynamic upstream_sets, a better
mechanism for specifying x-ha-policy to a subset, moving master/declared
queues around inside a cluster and things related to making RabbitMQ more
manageable in higher throughput scenarios.


Cheers,
Brendan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120524/6ae363a1/attachment.htm>

From prokop.bart at gmail.com  Thu May 24 10:41:55 2012
From: prokop.bart at gmail.com (=?UTF-8?Q?Bart=C5=82omiej_Prokop?=)
Date: Thu, 24 May 2012 11:41:55 +0200
Subject: [rabbitmq-discuss] JAVA client / non daemon threads / shutdown
	hook
In-Reply-To: <BE13C04D-A443-4E53-AA72-C3AAA0F778BF@rabbitmq.com>
References: <CAOYfuETqOPXRtf_AT4rHHv4GyB_k7Wb7Hy44WjNv4fEGyNYEuA@mail.gmail.com>
	<BE13C04D-A443-4E53-AA72-C3AAA0F778BF@rabbitmq.com>
Message-ID: <CAOYfuERMpLxZXn6BXq35pC4DADzM2Tqr_09hSoySxAB1AOKcPg@mail.gmail.com>

Hi Steve,

Many thanks for your prompt response. I have two proposals about improving
it, while keeping all parties happy. Here they are:

1. Add a boolean property "daemonBackgroundThreads" in ConnectionFactory.
Based on that property the threads created by client library would be
either daemon or not. The default would be false, what wouldn't occur any
changes in behavior of existing applications.

2. Alternatively the library could be rafactored that way
that connection/publishing stuff be daemon threads, while listener stuff
are non daemon. But as I explain further it is not best solution.

I see this problem in a bit other way, from perspective of developer, who
not always can design clean solutions. Sometimes I have to wire and patch
legacy systems ;). I think it is very common task to rabbitMQ users, who
have to wire it into existing ecosystem. My case here is to allow
some proprietary web server to send some messages during request
processing. So basically I'm restricted to expose a single Java method to
be called from the web script. I can create my own threads, connections,
bookkeeping, connection failover, reconnect etc... but this all is hidden
from the interface (single method "post") exposed to web scripting. The
most ugly thing is that I have no other way of detecting that WebServer is
going to die than adding shutdown hook to VM. And shutdown hook is fired,
when all normal threads are about to die (along with daemon threads). This
scenario is probably quite common for live integration of RabbitMQ into
existing systems.

In general when dealing with messages we can have 3 basic scenarios:
1. Publisher.
2. Synchronous consumer.
3. Asynchronous consumer (listener on messages).

The idea of writing RabbitMQ clients (implied by costly and limited TCP/IP
sockets) is to share a connection "per application" and write code that
can reconnect in case of RabbitMQ node fail. So as soon as I get
the connection, I keep it globally (shared). Usually it is my
responsibility to clean on shutdown, but there are cases when I'm unable to
do this. The shutdown hooks are handy in those scenarios.

Only the 3rd scenario (asynchronous consumer) may require non daemon
threads. But it is from my experience not a live scenario. You usually do
not write application, relaying on created behind the scene "main loop".
Why? Because even if all what you do is to listen to messages, you still
have to control the application state. You must start and stop that
application as well as allow user/OS to close it. I personally for such
micro-applications use Apache Daemons and run them as Windows services. On
Linux you have jsvc to control such application. Surely "main loop" hidden
in implementation is bad idea.

On Wed, May 23, 2012 at 5:18 PM, Steve Powell <steve at rabbitmq.com> wrote:

> Bart?omiej,
>
> What a very good point. It is clear that the MainLoop thread ought to be
> a daemon thread in your circumstances, thank you for pointing this out.
> The only affect of this will be to allow the JVM to terminate if only
> daemon threads are available.
>
> However, we have considered this problem before (internal bug 21110) and
> user apps that create a connection and register some consumers (which do
> all the work) ought to be able to terminate without accidentally killing
> the connection processing.
>
> This means that there are circumstances in which the threads we create
> are required to be non-daemon, and circumstances where you would like
> them to be daemon.
>
> The hook you implemented ought to work correctly even when the MainLoop
> is not a daemon, because closing the connection ought to make the
> MainLoop thread terminate normally. If it doesn't, there is a bug. Where
> at all possible you should attempt to close an open connection as a part
> of your termination processing as there are system resources that could
> be left high-and-dry if you do not.
>
> There are other threads in the Java Client -- the executor worker
> threads used for Consumer callbacks. These are non-daemon, too. The hook
> should still work because shutting down the connection ought to shutdown
> the consumer work service, and in turn the executor (and its worker
> threads).
>
> However, I could make them daemon threads as well, in case the main app
> terminates abruptly and expects to be able to terminate uncleanly as you
> describe.
>
> Thank you for reporting this. I'll report back here on progress.
>
> Steve Powell  (a happy bunny)
> ----------yet more definitions from the SPD----------
> corrugate (n.) T.V. soap scandal.
> olympic (n.) A camp road-digger.
> jamboree (n.) A conserve made from French cheese.
>
> On 18 May 2012, at 16:27, Bart?omiej Prokop wrote:
>
> > Hi,
> >
> > I'm using JAVA client for RabbitMQ (com.rabbitmq:amqp-client:2.8.1) to
> write a "jar component" capable of sending messages for some legacy system.
> The idea is to wrap all code that maintain the connection inside my
> component. This way, the client software deals only with very simple
> methods like "post" and is not aware of any connection handling. The
> connect/reconnect code is written and hidden from the legacy system.
> >
> > The problem I have faced is that Java client creates "behind the scene"
> some threads to manage connection - like:
> >          lines 299-301 of AMQConnection class.
> >         // start the main loop going
> >         new MainLoop("AMQP Connection " + getHostAddress() + ":" +
> getPort()).start();
> >         // after this point clear-up of MainLoop is triggered by closing
> the frameHandler.
> >
> > Unfortunatelly, those threads aren't "daemon" threads. So, when main
> application ends and appropriate connection closing not occurs, the VM
> won't terminate. My approach was to add some shutdown hook to close
> RabbitMQ connections if it is live inside my "jar component". But, due to
> those non-daemon threads, VM is not going ever to be terminated and
> shutdown hooks fired.
> >
> > It is a question to RabbitMQ driver developers, if the internal threads
> could be fired as daemon threads, could it be done in future releases?
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Bart Prokop
tel. +48 509 258 502

This e-mail is intended solely for the addressee(s) and contains
confidential information. Unauthorized distribution, modification or
disclosure of its contents is unlawful. If you have received this e-mail in
error, please notify the sender immediately by return e-mail. Please then
delete the e-mail from your system and do not copy it or disclose its
contents to any person. Email transmission cannot be guaranteed to be
secure or error free as information could be intercepted, corrupted, lost,
destroyed, arrive late or incomplete, or contain viruses. The sender
therefore does not accept liability for any errors or omissions in the
contents of this message which arise as a result of email transmission.
Information, opinions or conclusions contained in this message that do not
relate to the official business of the senders employer or principal will
be understood as neither given nor endorsed by it.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120524/ae8c30e5/attachment.htm>

From simon at rabbitmq.com  Thu May 24 11:02:52 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 24 May 2012 11:02:52 +0100
Subject: [rabbitmq-discuss] RabbitMQ Roadmap
In-Reply-To: <CAHZsVQavvRv8Em4uUXR_tM0k0Eyn=iZBR5NdE-UFefOBDmxCLg@mail.gmail.com>
References: <CAHZsVQavvRv8Em4uUXR_tM0k0Eyn=iZBR5NdE-UFefOBDmxCLg@mail.gmail.com>
Message-ID: <4FBE074C.5070203@rabbitmq.com>

On 24/05/12 09:47, Brendan Hay wrote:
> Yo!
>
> There's been a few hints dropped here towards future changes in
> Federation, Mirrored Queues, and making things a bit more transparent to
> clients regarding physical topology layout.
>
> Do you dudes have some sort of non-committal timeline/roadmap to share?
> (Off the record is fine, we won't hold you to anything.)

Matthias always hates it when I make any sort of forward looking 
prediction. But I'm in an uncooperative mood today, so here we go. All 
remarks here are extremely tentative and should not be taken as any sort 
of guarantee of anything happening.

There will probably be a 2.8.3 release soon, with bug fixes only.

2.9.0 should happen at some point in the summer (for a broad definition 
of summer). Some of the more major new things we're hoping to do include:

* Take federation configuration out of the config file and make it 
dynamically changeable with rabbitmqctl / mgmt

* Stop federation from being an exchange type, make regular exchanges 
federated through dynamically changeable policy managed by the sysadmin

* Similarly, make HA status of queues manageable dynamically by the 
sysadmin, not statically by the application programmer

* Rework clustering commands to make clustering clearer and less error prone

Although obviously I can't guarantee that all of these will be in 2.9.0 
(or will ever happen; plans are constantly shifting). But those are the 
big things I want to see (along with lots of smaller features and bug 
fixes I'm sure).

By the way, what do you mean by "making things a bit more transparent to 
clients regarding physical topology layout"?

> I'm personally interested in things such as dynamic upstream_sets, a
> better mechanism for specifying x-ha-policy to a subset, moving
> master/declared queues around inside a cluster and things related to
> making RabbitMQ more manageable in higher throughput scenarios.

Hopefully you should get many of these.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu May 24 11:16:43 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 24 May 2012 11:16:43 +0100
Subject: [rabbitmq-discuss] Connections in state "flow"
In-Reply-To: <CANVSfpLwOp5Gu56cMAf3UeAzZXzNUnUJ51D-28Pzg7YTAEEWPQ@mail.gmail.com>
References: <CANVSfpLfpzot8cjnJ1dSSfF71cU1Zz6Jc6agc8sUNCRzswepQg@mail.gmail.com>
	<CANVSfpLwOp5Gu56cMAf3UeAzZXzNUnUJ51D-28Pzg7YTAEEWPQ@mail.gmail.com>
Message-ID: <4FBE0A8B.40401@rabbitmq.com>

Hi Pablo.

This is the per-connection flow control kicking in. This is designed to 
rate limit publishers which are publishing faster than messages can be 
queued, since otherwise these messages end up ballooning memory use 
waiting to get into queues, which rarely ends well.

See http://www.rabbitmq.com/memory.html

Note that when flow control happens the affected connections cannot send 
data to RabbitMQ. This includes message acks, so it's a good idea to use 
different connections for publishing and consuming. Could this explain 
why you say all your consumers stop working?

But note that the screen capture you sent shows messages being consumed.

Cheers, Simon

On 23/05/12 20:43, Pablo Molnar wrote:
> I'm attaching more info about the cluster. All the memory and disk
> watermark levels are green: http://i.imgur.com/pXCcK.png
>
> On Wed, May 23, 2012 at 4:32 PM, Pablo Molnar<pablomolnar at gmail.com>  wrote:
>> Hi,
>>
>> I've recently upgrade to RabbitMQ 2.8.2 and experiencing problems with the
>> connections. Every so all my consumers stop working and the connections
>> state is "flow" in the RabbitMQ mgmt plugin.
>> This is a block issue for me and if I cannot resolve this today I have to
>> rollback the whole cluster to 2.7.1 back.
>>
>> Any ideas?
>>
>> Pablo
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From brendan at soundcloud.com  Thu May 24 11:33:31 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Thu, 24 May 2012 12:33:31 +0200
Subject: [rabbitmq-discuss] RabbitMQ Roadmap
In-Reply-To: <4FBE074C.5070203@rabbitmq.com>
References: <CAHZsVQavvRv8Em4uUXR_tM0k0Eyn=iZBR5NdE-UFefOBDmxCLg@mail.gmail.com>
	<4FBE074C.5070203@rabbitmq.com>
Message-ID: <CAHZsVQZ7saU5LduxGdu0kmhWDezSgpA+b0tgkP-ekGxMe-r3eg@mail.gmail.com>

Good stuff!

The physical layout comment is regarding having to specify -sname/-name in
the x-ha-policy .. ie having clients aware of the nodes that compose a
cluster.
In the imaginary places in my head it would be nicer to set something along
the lines of 'one slave', 'two slaves', ..., or '50% of the cluster has
slaves' etc.

Migrating/moving a queue around inside a cluster is another nice to have
- scenario would be whatever you're using to do load-balancing
throws a nana and causes too many queues to be declared on a single machine
vs a more desired even spread. Basically fine tuning your queue
distribution, on the fly.

Thanks,
Brendan

On Thu, May 24, 2012 at 12:02 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 24/05/12 09:47, Brendan Hay wrote:
>
>> Yo!
>>
>> There's been a few hints dropped here towards future changes in
>> Federation, Mirrored Queues, and making things a bit more transparent to
>> clients regarding physical topology layout.
>>
>> Do you dudes have some sort of non-committal timeline/roadmap to share?
>> (Off the record is fine, we won't hold you to anything.)
>>
>
> Matthias always hates it when I make any sort of forward looking
> prediction. But I'm in an uncooperative mood today, so here we go. All
> remarks here are extremely tentative and should not be taken as any sort of
> guarantee of anything happening.
>
> There will probably be a 2.8.3 release soon, with bug fixes only.
>
> 2.9.0 should happen at some point in the summer (for a broad definition of
> summer). Some of the more major new things we're hoping to do include:
>
> * Take federation configuration out of the config file and make it
> dynamically changeable with rabbitmqctl / mgmt
>
> * Stop federation from being an exchange type, make regular exchanges
> federated through dynamically changeable policy managed by the sysadmin
>
> * Similarly, make HA status of queues manageable dynamically by the
> sysadmin, not statically by the application programmer
>
> * Rework clustering commands to make clustering clearer and less error
> prone
>
> Although obviously I can't guarantee that all of these will be in 2.9.0
> (or will ever happen; plans are constantly shifting). But those are the big
> things I want to see (along with lots of smaller features and bug fixes I'm
> sure).
>
> By the way, what do you mean by "making things a bit more transparent to
> clients regarding physical topology layout"?
>
>
>  I'm personally interested in things such as dynamic upstream_sets, a
>> better mechanism for specifying x-ha-policy to a subset, moving
>> master/declared queues around inside a cluster and things related to
>> making RabbitMQ more manageable in higher throughput scenarios.
>>
>
> Hopefully you should get many of these.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120524/ac633cd8/attachment.htm>

From simon at rabbitmq.com  Thu May 24 11:37:38 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 24 May 2012 11:37:38 +0100
Subject: [rabbitmq-discuss] RabbitMQ Roadmap
In-Reply-To: <CAHZsVQZ7saU5LduxGdu0kmhWDezSgpA+b0tgkP-ekGxMe-r3eg@mail.gmail.com>
References: <CAHZsVQavvRv8Em4uUXR_tM0k0Eyn=iZBR5NdE-UFefOBDmxCLg@mail.gmail.com>	<4FBE074C.5070203@rabbitmq.com>
	<CAHZsVQZ7saU5LduxGdu0kmhWDezSgpA+b0tgkP-ekGxMe-r3eg@mail.gmail.com>
Message-ID: <4FBE0F72.8070607@rabbitmq.com>

On 24/05/12 11:33, Brendan Hay wrote:
> Good stuff!
>
> The physical layout comment is regarding having to specify -sname/-name
> in the x-ha-policy .. ie having clients aware of the nodes that compose
> a cluster.
> In the imaginary places in my head it would be nicer to set something
> along the lines of 'one slave', 'two slaves', ..., or '50% of the
> cluster has slaves' etc.

Oh, of course. Yes, I want that to happen too. Basically clients should 
not have to know anything about how the server / cluster is configured.

> Migrating/moving a queue around inside a cluster is another nice to have
> - scenario would be whatever you're using to do load-balancing
> throws a nana and causes too many queues to be declared on a single
> machine vs a more desired even spread. Basically fine tuning your queue
> distribution, on the fly.

For mirrored queues that's conceptually quite easy; add some mirrors, 
wait for them to catch up, remove the old ones and you're done.

For non-mirrored queues this would be fairly horrible... unless you're 
happy for the queue to pause while data is migrated.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From michael.justin at gmx.net  Thu May 24 13:10:35 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 24 May 2012 14:10:35 +0200
Subject: [rabbitmq-discuss] stomp+ssl message send works,
 receive hangs after around 200-300 messages
In-Reply-To: <BE7A82AB-B2F9-4E0B-80BC-F7651BD5F30B@rabbitmq.com>
References: <jp7ltn$rn3$1@dough.gmane.org>
	<86B07026-4324-4BB2-B008-DBC605C03E33@rabbitmq.com>
	<4FBBD704.7060305@gmx.net>
	<BE7A82AB-B2F9-4E0B-80BC-F7651BD5F30B@rabbitmq.com>
Message-ID: <4FBE253B.3020009@gmx.net>

Am 23.05.2012 17:52, Steve Powell wrote:
> Michael,
>
> Thanks for the update. Can you be a little more specific about the
> set-up that fails?

Many thanks for your answer and your suggestion, it is working now - 
with prefetch-count=2.

Maybe it is helpful, here is some information from my tests and answers 
to your questions:


> In particular I would like to know:
>
> -  the version of Erlang you are using, and the (v)hardware you are
>     running RabbitMQ on (a copy of the startup log would be nice);

The startup log is at the end, Erlang version is 5.9.1, machine is a 
Compaq 6820s Laptop (Intel Core 2 Duo T8100 2.1 GHz)

> -  if the problem is noticed on a non-ssl connection (if you can try
>     this) -- we haven't seen this particular problem on our tests;

Non-SSL connections pass the same tests without problems

> -  are there any messages in the rabbitmq log around the time the
>     message delivery stops?

The log is very small, see attached file (after running > 10 tests)

> -  can you provide more details about the topic subscription --
>     is this a durable subscription, for example;

It is a normal queue destination, using persistent messages

> -  and do the acknowledgements actually get through (you can tell this
>     if messages you think you have consumed are redelivered on
>     reconnect)?

I can see after retrieving around 240 messages (when the client does not 
longer receive more messages) that about 120 messages are still on the 
broker, so the acknowledgement of 120 messages did not reach the broker.

Further debugging showed that the client hangs when sending the 
acknowledgement frame. Example:

received:
MESSAGE
content-type:text/plain
subscription:{00AC21DB-D5A3-40C9-97C4-00FCB902634B}
destination:/queue/ExampleQueue
message-id:T_{00AC21DB-D5A3-40C9-97C4-00FCB902634B}@@session-ArgQuHJyTPiO2ge46jB
4eD@@245
content-length:255


Received: Message: 244 sent at: 24.05.2012 13:52:01         ...
send:
ACK
message-id:T_{00AC21DB-D5A3-40C9-97C4-00FCB902634B}@@session-ArgQuHJyTPiO2ge46jB
4eD@@245
subscription:{00AC21DB-D5A3-40C9-97C4-00FCB902634B}

<-- client frame sent but the socket write operation hangs

> We have recently discovered (and fixed) a bug in the STOMP client that
> will stop the broker seeing the last message sent (under load). It is
> possible that, if pre-fetch is set to 1, this is causing you to jam
> up -- the STOMP code may not be detecting your last acknowledgement. To
> confirm this, please try this with a pre-fetch count of zero (or 2 or
> more) and see if you still get the lock-up.
>

Setting prefetch-count=2 fixed it, many thanks ! Could this also affect 
transactions, where a commit is sent instead of ack frames?

Regards

Michael Justin

---

Startup log

Activating RabbitMQ plugins ...
7 plugins activated:
* amqp_client-2.8.2
* mochiweb-1.3-rmq2.8.2-git
* rabbitmq_management-2.8.2
* rabbitmq_management_agent-2.8.2
* rabbitmq_mochiweb-2.8.2
* rabbitmq_stomp-2.8.2
* webmachine-1.7.0-rmq2.8.2-hg


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.8.2  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2012 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at MJ-PC
app descriptor : c:/Java/rabbitmq_server-2.8.2/sbin/../ebin/rabbit.app
home dir       : C:\Users\mj
config file(s) : c:/Users/mj/AppData/Roaming/RabbitMQ/rabbitmq.config
cookie hash    : WjOr7YEHHESuUkR1mMuR+g==
log            : C:/Users/mj/AppData/Roaming/RabbitMQ/log/rabbit at MJ-PC.log
sasl log       : 
C:/Users/mj/AppData/Roaming/RabbitMQ/log/rabbit at MJ-PC-sasl.log
database dir   : c:/Users/mj/AppData/Roaming/RabbitMQ/db/rabbit at MJ-PC-mnesia
erlang version : 5.9.1

-- rabbit boot start
starting file handle cache server 
...done
starting worker pool 
...done
starting database 
...done
starting database sync 
...done
starting codec correctness check 
...done
-- external infrastructure ready
starting plugin registry 
...done
starting auth mechanism cr-demo 
...done
starting auth mechanism amqplain 
...done
starting auth mechanism plain 
...done
starting statistics event manager 
...done
starting logging server 
...done
starting exchange type direct 
...done
starting exchange type fanout 
...done
starting exchange type headers 
...done
starting exchange type topic 
...done
-- kernel ready
starting alarm handler 
...done
starting node monitor 
...done
starting cluster delegate 
...done
starting guid generator 
...done
starting memory monitor 
...done
-- core initialized
starting management agent 
...done
starting exchange, queue and binding recovery 
...done
starting configured definitions 
...done
starting empty DB check 
...done
starting mirror queue slave sup 
...done
starting adding mirrors to queues 
...done
-- message delivery logic ready
starting error log relay 
...done
starting networking 
...done
starting direct client 
...done
starting notify cluster nodes 
...done

broker running
** Found 0 name clashes in code paths


-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/
-------------- next part --------------

=INFO REPORT==== 24-May-2012::12:42:51 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 24-May-2012::12:42:51 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 24-May-2012::12:42:51 ===
Memory limit set to 818MB of 2046MB total.

=INFO REPORT==== 24-May-2012::12:42:51 ===
Disabling disk free space monitoring on unsupported platform: {{'EXIT',
                                                                {{badmatch,
                                                                  ["2",
                                                                   "Verzeichnis(se),",
                                                                   "66637672448",
                                                                   "Bytes",
                                                                   "frei"]},
                                                                 [{rabbit_disk_monitor,
                                                                   parse_free_win32,
                                                                   1,[]},
                                                                  {rabbit_disk_monitor,
                                                                   init,1,[]},
                                                                  {gen_server,
                                                                   init_it,6,
                                                                   [{file,
                                                                     "gen_server.erl"},
                                                                    {line,
                                                                     304}]},
                                                                  {proc_lib,
                                                                   init_p_do_apply,
                                                                   3,
                                                                   [{file,
                                                                     "proc_lib.erl"},
                                                                    {line,
                                                                     227}]}]}},
                                                               2145935360}

=INFO REPORT==== 24-May-2012::12:42:51 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 24-May-2012::12:42:51 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 24-May-2012::12:42:51 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 24-May-2012::12:42:51 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 24-May-2012::12:42:51 ===
Adding vhost '/'

=INFO REPORT==== 24-May-2012::12:42:51 ===
Creating user 'guest'

=INFO REPORT==== 24-May-2012::12:42:51 ===
Setting user tags for user 'guest' to [administrator]

=INFO REPORT==== 24-May-2012::12:42:51 ===
Setting permissions for 'guest' in '/' to '.*', '.*', '.*'

=INFO REPORT==== 24-May-2012::12:42:51 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 24-May-2012::12:42:51 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 24-May-2012::12:42:51 ===
rabbit_stomp: default user 'guest' enabled

=INFO REPORT==== 24-May-2012::12:42:51 ===
started STOMP TCP Listener on [::]:61613

=INFO REPORT==== 24-May-2012::12:42:51 ===
started STOMP TCP Listener on 0.0.0.0:61613

=INFO REPORT==== 24-May-2012::12:42:51 ===
started STOMP SSL Listener on [::]:61614

=INFO REPORT==== 24-May-2012::12:42:51 ===
started STOMP SSL Listener on 0.0.0.0:61614

=INFO REPORT==== 24-May-2012::12:42:51 ===
Management agent started.

=INFO REPORT==== 24-May-2012::12:42:52 ===
Management plugin started. Port: 55672, path: /

=INFO REPORT==== 24-May-2012::12:42:52 ===
Statistics database started.

=INFO REPORT==== 24-May-2012::12:43:52 ===
accepting STOMP connection <0.862.0> (127.0.0.1:49739 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:43:52 ===
accepting STOMP connection <0.865.0> (127.0.0.1:49740 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:44:01 ===
closing STOMP connection <0.865.0> (127.0.0.1:49740 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:45:26 ===
accepting STOMP connection <0.7918.1> (127.0.0.1:49742 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:45:26 ===
accepting STOMP connection <0.7916.1> (127.0.0.1:49741 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:46:41 ===
closing STOMP connection <0.7918.1> (127.0.0.1:49742 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:47:50 ===
accepting STOMP connection <0.7650.9> (127.0.0.1:49743 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:47:51 ===
accepting STOMP connection <0.7653.9> (127.0.0.1:49744 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:48:13 ===
closing STOMP connection <0.7653.9> (127.0.0.1:49744 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:48:37 ===
accepting STOMP connection <0.10779.12> (127.0.0.1:49746 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:48:37 ===
accepting STOMP connection <0.10776.12> (127.0.0.1:49745 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:48:50 ===
closing STOMP connection <0.10776.12> (127.0.0.1:49745 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:49:54 ===
accepting STOMP connection <0.10000.14> (127.0.0.1:49747 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:49:54 ===
accepting STOMP connection <0.10003.14> (127.0.0.1:49748 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:50:04 ===
closing STOMP connection <0.10003.14> (127.0.0.1:49748 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:51:14 ===
accepting STOMP connection <0.25110.15> (127.0.0.1:49749 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:51:14 ===
accepting STOMP connection <0.25113.15> (127.0.0.1:49750 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:51:22 ===
closing STOMP connection <0.25110.15> (127.0.0.1:49749 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:52:10 ===
accepting STOMP connection <0.31323.16> (127.0.0.1:49751 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:52:11 ===
accepting STOMP connection <0.31320.16> (127.0.0.1:49752 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:52:47 ===
accepting STOMP connection <0.4631.17> (127.0.0.1:49758 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:52:47 ===
accepting STOMP connection <0.4634.17> (127.0.0.1:49759 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::12:56:49 ===
accepting STOMP connection <0.26271.19> (127.0.0.1:49763 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::13:01:22 ===
accepting STOMP connection <0.28567.19> (127.0.0.1:49764 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:01:22 ===
closing STOMP connection <0.28567.19> (127.0.0.1:49764 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:01:44 ===
accepting STOMP connection <0.28780.19> (127.0.0.1:49765 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:01:45 ===
closing STOMP connection <0.28780.19> (127.0.0.1:49765 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:02:56 ===
accepting STOMP connection <0.29464.19> (127.0.0.1:49766 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:02:59 ===
closing STOMP connection <0.29464.19> (127.0.0.1:49766 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:04:08 ===
accepting STOMP connection <0.30122.19> (127.0.0.1:49769 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:04:09 ===
closing STOMP connection <0.30122.19> (127.0.0.1:49769 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:05:14 ===
accepting STOMP connection <0.30762.19> (127.0.0.1:49770 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:05:19 ===
closing STOMP connection <0.30762.19> (127.0.0.1:49770 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:06:27 ===
accepting STOMP connection <0.31440.19> (127.0.0.1:49771 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:06:55 ===
closing STOMP connection <0.31440.19> (127.0.0.1:49771 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:07:57 ===
accepting STOMP connection <0.32344.19> (127.0.0.1:49773 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::13:08:12 ===
accepting STOMP connection <0.32478.19> (127.0.0.1:49774 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:08:34 ===
closing STOMP connection <0.32478.19> (127.0.0.1:49774 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:09:35 ===
accepting STOMP connection <0.534.20> (127.0.0.1:49775 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::13:09:35 ===
closing STOMP connection <0.534.20> (127.0.0.1:49775 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::13:09:59 ===
accepting STOMP connection <0.747.20> (127.0.0.1:49776 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::13:09:59 ===
closing STOMP connection <0.747.20> (127.0.0.1:49776 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::13:10:33 ===
accepting STOMP connection <0.1045.20> (127.0.0.1:49777 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::13:10:47 ===
accepting STOMP connection <0.1184.20> (127.0.0.1:49778 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::13:12:01 ===
accepting STOMP connection <0.1815.20> (127.0.0.1:49781 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:12:26 ===
closing STOMP connection <0.1815.20> (127.0.0.1:49781 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:15:18 ===
accepting STOMP connection <0.3580.20> (127.0.0.1:49801 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:15:23 ===
closing STOMP connection <0.3580.20> (127.0.0.1:49801 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:15:48 ===
accepting STOMP connection <0.4024.20> (127.0.0.1:49802 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:16:11 ===
closing STOMP connection <0.4024.20> (127.0.0.1:49802 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:16:36 ===
accepting STOMP connection <0.4554.20> (127.0.0.1:49803 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:16:48 ===
closing STOMP connection <0.4554.20> (127.0.0.1:49803 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:17:02 ===
accepting STOMP connection <0.4902.20> (127.0.0.1:49804 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:17:08 ===
closing STOMP connection <0.4902.20> (127.0.0.1:49804 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:17:20 ===
accepting STOMP connection <0.5175.20> (127.0.0.1:49805 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:17:30 ===
closing STOMP connection <0.5175.20> (127.0.0.1:49805 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:17:48 ===
accepting STOMP connection <0.5519.20> (127.0.0.1:49806 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:17:54 ===
closing STOMP connection <0.5519.20> (127.0.0.1:49806 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:18:32 ===
accepting STOMP connection <0.6010.20> (127.0.0.1:49807 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:18:32 ===
closing STOMP connection <0.6010.20> (127.0.0.1:49807 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:19:05 ===
accepting STOMP connection <0.6317.20> (127.0.0.1:49813 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::13:19:29 ===
accepting STOMP connection <0.6529.20> (127.0.0.1:49814 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:19:29 ===
closing STOMP connection <0.6529.20> (127.0.0.1:49814 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:21:20 ===
accepting STOMP connection <0.7473.20> (127.0.0.1:49815 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::13:22:12 ===
accepting STOMP connection <0.7932.20> (127.0.0.1:49816 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::13:24:25 ===
accepting STOMP connection <0.9060.20> (127.0.0.1:49819 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::13:24:41 ===
accepting STOMP connection <0.9194.20> (127.0.0.1:49820 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:25:15 ===
closing STOMP connection <0.9194.20> (127.0.0.1:49820 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:37:15 ===
accepting STOMP connection <0.15654.20> (127.0.0.1:49829 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:38:58 ===
closing STOMP connection <0.15654.20> (127.0.0.1:49829 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:39:25 ===
accepting STOMP connection <0.16903.20> (127.0.0.1:49830 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:40:20 ===
closing STOMP connection <0.16903.20> (127.0.0.1:49830 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:40:44 ===
accepting STOMP connection <0.17677.20> (127.0.0.1:49831 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:41:11 ===
closing STOMP connection <0.17677.20> (127.0.0.1:49831 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:43:41 ===
accepting STOMP connection <0.19269.20> (127.0.0.1:49835 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:44:07 ===
closing STOMP connection <0.19269.20> (127.0.0.1:49835 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:47:55 ===
accepting STOMP connection <0.21536.20> (127.0.0.1:49876 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:48:12 ===
closing STOMP connection <0.21536.20> (127.0.0.1:49876 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:49:38 ===
accepting STOMP connection <0.22503.20> (127.0.0.1:49877 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:50:02 ===
closing STOMP connection <0.22503.20> (127.0.0.1:49877 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:51:35 ===
accepting STOMP connection <0.23604.20> (127.0.0.1:49878 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:51:44 ===
closing STOMP connection <0.23604.20> (127.0.0.1:49878 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:52:00 ===
accepting STOMP connection <0.24062.20> (127.0.0.1:49879 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::13:52:10 ===
accepting STOMP connection <0.24161.20> (127.0.0.1:49880 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:53:49 ===
closing STOMP connection <0.24161.20> (127.0.0.1:49880 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:57:22 ===
accepting STOMP connection <0.26904.20> (127.0.0.1:49902 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:57:34 ===
closing STOMP connection <0.26904.20> (127.0.0.1:49902 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:57:59 ===
accepting STOMP connection <0.27339.20> (127.0.0.1:49903 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:58:28 ===
closing STOMP connection <0.27339.20> (127.0.0.1:49903 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:59:27 ===
accepting STOMP connection <0.28102.20> (127.0.0.1:49904 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::13:59:42 ===
closing STOMP connection <0.28102.20> (127.0.0.1:49904 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::14:00:23 ===
accepting STOMP connection <0.29381.20> (127.0.0.1:49905 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::14:01:00 ===
accepting STOMP connection <0.29700.20> (127.0.0.1:49906 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::14:03:09 ===
accepting STOMP connection <0.31803.20> (127.0.0.1:49907 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::14:03:21 ===
closing STOMP connection <0.31803.20> (127.0.0.1:49907 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::14:03:37 ===
accepting STOMP connection <0.32056.20> (127.0.0.1:49908 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::14:03:46 ===
closing STOMP connection <0.32056.20> (127.0.0.1:49908 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::14:04:03 ===
accepting STOMP connection <0.32292.20> (127.0.0.1:49909 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::14:04:23 ===
closing STOMP connection <0.32292.20> (127.0.0.1:49909 -> 127.0.0.1:61614)

=INFO REPORT==== 24-May-2012::14:04:29 ===
accepting STOMP connection <0.32538.20> (127.0.0.1:49910 -> 127.0.0.1:61613)

=INFO REPORT==== 24-May-2012::14:04:39 ===
accepting STOMP connection <0.32636.20> (127.0.0.1:49911 -> 127.0.0.1:61614)

From steve at rabbitmq.com  Thu May 24 14:25:13 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 24 May 2012 14:25:13 +0100
Subject: [rabbitmq-discuss] JAVA client / non daemon threads / shutdown
	hook
In-Reply-To: <CAOYfuERMpLxZXn6BXq35pC4DADzM2Tqr_09hSoySxAB1AOKcPg@mail.gmail.com>
References: <CAOYfuETqOPXRtf_AT4rHHv4GyB_k7Wb7Hy44WjNv4fEGyNYEuA@mail.gmail.com>
	<BE13C04D-A443-4E53-AA72-C3AAA0F778BF@rabbitmq.com>
	<CAOYfuERMpLxZXn6BXq35pC4DADzM2Tqr_09hSoySxAB1AOKcPg@mail.gmail.com>
Message-ID: <356ED28B-2062-4ED0-AA53-C1B0B9864C8C@rabbitmq.com>

Bart?omiej,

Thank you for your thoughts. Your solution 1. is what is being currently
proposed, with the (still undecided) feature that it may not apply to
the Consumer callback threads. However, I dislike options and
parameters, principally because we have to explain everything to users,
and it confuses people if there are a lot of obscure parameters -- even
if most people don't set them.

Therefore, I'm considering proposal number 2. This would be a change in
behaviour to make the MainLoop thread (this is the connection management
thread, which receives all the channels' communications) a daemon
thread, and to leave the Consumer callback threads as non-daemon.

What this means is that the users that never register any Consumers
(synchronous consumers use basic.get) will not get any Consumer threads
allocated (unless they do a clean shutdown, in which case there is a
trivial one which is short-lived). So when they exit (without a clean
shutdown) everything will disappear when the Jvm terminates.

Users that want to have things remain will register Consumers, which
means that threads will get allocated, and these will keep everything
alive, even if the main thread terminates, until shutdown, which can be
driven off of the Consumer callback or will be precipitated if the
connection closes. Cleanup will then happen and if the Jvm is waiting to
terminate it will do so then.

This appears to me to fit the bill for both parties, without anyone
having to set any options.

In a complex environment, the way to allow these threads to finish
explicitly is to break the connection. The close mechanisms will then
get a chance to run, hopefully designed to shut other resources down if
the Consumers are managing them.

Publishers wouldn't register Consumers, either, and presumably would
handle receiving of confirms, and so on, in the main thread, so would
not stop everything until ready to do so. Again, no Consumers: no
non-daemon threads.

So, it would seem to me that making MainLoop a daemon thread is the best
of all possible worlds.

Btw, historically the callbacks were executed on the MainLoop thread, so
making it a daemon was not an option. Recently the threading model
changed and so we haven't spotted that now the MainLoop thread can be a
daemon.

Would this meet your requirements?

Steve Powell  (a happy bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

On 24 May 2012, at 10:41, Bart Prokop wrote:

> Hi Steve,
> 
> Many thanks for your prompt response. I have two proposals about improving it, while keeping all parties happy. Here they are:
> 
> 1. Add a boolean property "daemonBackgroundThreads" in ConnectionFactory. Based on that property the threads created by client library would be either daemon or not. The default would be false, what wouldn't occur any changes in behavior of existing applications.
> 
> 2. Alternatively the library could be rafactored that way that connection/publishing stuff be daemon threads, while listener stuff are non daemon. But as I explain further it is not best solution.
> 
> I see this problem in a bit other way, from perspective of developer, who not always can design clean solutions. Sometimes I have to wire and patch legacy systems ;). I think it is very common task to rabbitMQ users, who have to wire it into existing ecosystem. My case here is to allow some proprietary web server to send some messages during request processing. So basically I'm restricted to expose a single Java method to be called from the web script. I can create my own threads, connections, bookkeeping, connection failover, reconnect etc... but this all is hidden from the interface (single method "post") exposed to web scripting. The most ugly thing is that I have no other way of detecting that WebServer is going to die than adding shutdown hook to VM. And shutdown hook is fired, when all normal threads are about to die (along with daemon threads). This scenario is probably quite common for live integration of RabbitMQ into existing systems.
> 
> In general when dealing with messages we can have 3 basic scenarios:
> 1. Publisher.
> 2. Synchronous consumer.
> 3. Asynchronous consumer (listener on messages).
> 
> The idea of writing RabbitMQ clients (implied by costly and limited TCP/IP sockets) is to share a connection "per application" and write code that can reconnect in case of RabbitMQ node fail. So as soon as I get the connection, I keep it globally (shared). Usually it is my responsibility to clean on shutdown, but there are cases when I'm unable to do this. The shutdown hooks are handy in those scenarios.
> 
> Only the 3rd scenario (asynchronous consumer) may require non daemon threads. But it is from my experience not a live scenario. You usually do not write application, relaying on created behind the scene "main loop". Why? Because even if all what you do is to listen to messages, you still have to control the application state. You must start and stop that application as well as allow user/OS to close it. I personally for such micro-applications use Apache Daemons and run them as Windows services. On Linux you have jsvc to control such application. Surely "main loop" hidden in implementation is bad idea.
> 
> On Wed, May 23, 2012 at 5:18 PM, Steve Powell <steve at rabbitmq.com> wrote:
> Bart?omiej,
> 
> What a very good point. It is clear that the MainLoop thread ought to be
> a daemon thread in your circumstances, thank you for pointing this out.
> The only affect of this will be to allow the JVM to terminate if only
> daemon threads are available.
> 
> However, we have considered this problem before (internal bug 21110) and
> user apps that create a connection and register some consumers (which do
> all the work) ought to be able to terminate without accidentally killing
> the connection processing.
> 
> This means that there are circumstances in which the threads we create
> are required to be non-daemon, and circumstances where you would like
> them to be daemon.
> 
> The hook you implemented ought to work correctly even when the MainLoop
> is not a daemon, because closing the connection ought to make the
> MainLoop thread terminate normally. If it doesn't, there is a bug. Where
> at all possible you should attempt to close an open connection as a part
> of your termination processing as there are system resources that could
> be left high-and-dry if you do not.
> 
> There are other threads in the Java Client -- the executor worker
> threads used for Consumer callbacks. These are non-daemon, too. The hook
> should still work because shutting down the connection ought to shutdown
> the consumer work service, and in turn the executor (and its worker
> threads).
> 
> However, I could make them daemon threads as well, in case the main app
> terminates abruptly and expects to be able to terminate uncleanly as you
> describe.
> 
> Thank you for reporting this. I'll report back here on progress.
> 
> Steve Powell  (a happy bunny)
> ----------yet more definitions from the SPD----------
> corrugate (n.) T.V. soap scandal.
> olympic (n.) A camp road-digger.
> jamboree (n.) A conserve made from French cheese.
> 
> On 18 May 2012, at 16:27, Bart?omiej Prokop wrote:
> 
> > Hi,
> >
> > I'm using JAVA client for RabbitMQ (com.rabbitmq:amqp-client:2.8.1) to write a "jar component" capable of sending messages for some legacy system. The idea is to wrap all code that maintain the connection inside my component. This way, the client software deals only with very simple methods like "post" and is not aware of any connection handling. The connect/reconnect code is written and hidden from the legacy system.
> >
> > The problem I have faced is that Java client creates "behind the scene" some threads to manage connection - like:
> >          lines 299-301 of AMQConnection class.
> >         // start the main loop going
> >         new MainLoop("AMQP Connection " + getHostAddress() + ":" + getPort()).start();
> >         // after this point clear-up of MainLoop is triggered by closing the frameHandler.
> >
> > Unfortunatelly, those threads aren't "daemon" threads. So, when main application ends and appropriate connection closing not occurs, the VM won't terminate. My approach was to add some shutdown hook to close RabbitMQ connections if it is live inside my "jar component". But, due to those non-daemon threads, VM is not going ever to be terminated and shutdown hooks fired.
> >
> > It is a question to RabbitMQ driver developers, if the internal threads could be fired as daemon threads, could it be done in future releases?
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> -- 
> Bart Prokop
> tel. +48 509 258 502
> 
> This e-mail is intended solely for the addressee(s) and contains confidential information. Unauthorized distribution, modification or disclosure of its contents is unlawful. If you have received this e-mail in error, please notify the sender immediately by return e-mail. Please then delete the e-mail from your system and do not copy it or disclose its contents to any person. Email transmission cannot be guaranteed to be secure or error free as information could be intercepted, corrupted, lost, destroyed, arrive late or incomplete, or contain viruses. The sender therefore does not accept liability for any errors or omissions in the contents of this message which arise as a result of email transmission. Information, opinions or conclusions contained in this message that do not relate to the official business of the senders employer or principal will be understood as neither given nor endorsed by it.


From xtrm2008 at live.com  Thu May 24 14:36:28 2012
From: xtrm2008 at live.com (xtrm)
Date: Thu, 24 May 2012 06:36:28 -0700 (PDT)
Subject: [rabbitmq-discuss]  Perl SSL support for Net::RabbitMQ
Message-ID: <33901964.post@talk.nabble.com>


Hello all,

New to RabbitMQ and hoping someone on the forum has been through this
before. I am trying to implement SSL client authentication to use with on
all our clients.  I am unable to find any documentation on how to go about
doing this.  I was able to find two examples in .NET and Java on the
rabbitMQ SSL support website, but no mention on how to implement using Perl. 
Has anyone gotten this working?  If so how did you guys go about
implementing SSL support?  

I currently have my clients publishing successfully using the non SSL port
using Net::RabbitMQ module.

Thanks for the help in advance.

-- 
View this message in context: http://old.nabble.com/Perl-SSL-support-for-Net%3A%3ARabbitMQ-tp33901964p33901964.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alan.antonuk at gmail.com  Thu May 24 15:16:17 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 24 May 2012 10:16:17 -0400
Subject: [rabbitmq-discuss] Perl SSL support for Net::RabbitMQ
In-Reply-To: <33901964.post@talk.nabble.com>
References: <33901964.post@talk.nabble.com>
Message-ID: <CAAt2poJ0xcuJLRewH8vBtWN7n5tgVDEijJA1Gd_fxtboLVqduA@mail.gmail.com>

I believe (someone correct me if I'm wrong) Net::RabbitMQ is just a wrapper
around the rabbitmq-c library, which does not support SSL as of yet, so
Net::RabbitMQ probably doesn't support SSL yet.

There is currently an effort underway to add SSL support to rabbitmq-c, but
it is not complete yet.

-Alan

On Thu, May 24, 2012 at 9:36 AM, xtrm <xtrm2008 at live.com> wrote:

>
> Hello all,
>
> New to RabbitMQ and hoping someone on the forum has been through this
> before. I am trying to implement SSL client authentication to use with on
> all our clients.  I am unable to find any documentation on how to go about
> doing this.  I was able to find two examples in .NET and Java on the
> rabbitMQ SSL support website, but no mention on how to implement using
> Perl.
> Has anyone gotten this working?  If so how did you guys go about
> implementing SSL support?
>
> I currently have my clients publishing successfully using the non SSL port
> using Net::RabbitMQ module.
>
> Thanks for the help in advance.
>
> --
> View this message in context:
> http://old.nabble.com/Perl-SSL-support-for-Net%3A%3ARabbitMQ-tp33901964p33901964.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120524/e962468f/attachment.htm>

From steve at rabbitmq.com  Thu May 24 16:06:47 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 24 May 2012 16:06:47 +0100
Subject: [rabbitmq-discuss] JAVA client / non daemon threads / shutdown
	hook
In-Reply-To: <356ED28B-2062-4ED0-AA53-C1B0B9864C8C@rabbitmq.com>
References: <CAOYfuETqOPXRtf_AT4rHHv4GyB_k7Wb7Hy44WjNv4fEGyNYEuA@mail.gmail.com>
	<BE13C04D-A443-4E53-AA72-C3AAA0F778BF@rabbitmq.com>
	<CAOYfuERMpLxZXn6BXq35pC4DADzM2Tqr_09hSoySxAB1AOKcPg@mail.gmail.com>
	<356ED28B-2062-4ED0-AA53-C1B0B9864C8C@rabbitmq.com>
Message-ID: <62356D2D-A44C-45D9-88F1-5B87986EA71B@rabbitmq.com>

Bart?omiej,

Shutdown hooks are, as I think you know, only executed when an orderly
shutdown is decided by the Jvm. In turn, this only happens when the last
non-daemon thread terminates, so the shutdown hooks you installed will
not be called, because the MainLoop thread is non-daemon.

With the proviso that the Consumer threads (if any) need some way to
shutdown first, the hook would work if the MainLoop thread is daemon.

It is possible to supply your own ExecutorService to run the Consumers,
and for you to supply one that uses daemon threads (instead of
non-daemon ones).

This is not a lot of effort, since the Executors classes in the standard
Java libraries allow you to supply a ThreadFactory when constructing a
standard ExecutorService. Therefore, by controlling this you can have
the Consumer callbacks running in daemon threads also. This means that
you can guarantee your hook will be called before the daemon threads are
killed during orderly shutdown.

Just be sure that you shutdown your executor service in your orderly
shutdown hook, since this will not be done on a connection close for a
user-supplied ExecutorService.

Steve Powell  (a happy bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

On 24 May 2012, at 14:25, Steve Powell wrote:
> (elided)---------------------
> Would this meet your requirements?
> 
> Steve Powell  (a happy bunny)
> ----------yet more definitions from the SPD----------
> corrugate (n.) T.V. soap scandal.
> olympic (n.) A camp road-digger.
> jamboree (n.) A conserve made from French cheese.
> 
> On 24 May 2012, at 10:41, Bart Prokop wrote:
> 
>> (elided)-------------------------
>> 
>> On Wed, May 23, 2012 at 5:18 PM, Steve Powell <steve at rabbitmq.com> wrote:
>> (elided)---------------
>> On 18 May 2012, at 16:27, Bart?omiej Prokop wrote:
>> (elided)---------------------------

From steve at rabbitmq.com  Thu May 24 17:08:09 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 24 May 2012 17:08:09 +0100
Subject: [rabbitmq-discuss] stomp+ssl message send works,
	receive hangs after around 200-300 messages
In-Reply-To: <4FBE253B.3020009@gmx.net>
References: <jp7ltn$rn3$1@dough.gmane.org>
	<86B07026-4324-4BB2-B008-DBC605C03E33@rabbitmq.com>
	<4FBBD704.7060305@gmx.net>
	<BE7A82AB-B2F9-4E0B-80BC-F7651BD5F30B@rabbitmq.com>
	<4FBE253B.3020009@gmx.net>
Message-ID: <F8689F9E-EC1C-403F-8296-5D4D6F15C8ED@rabbitmq.com>

Michael,

Thank you for the further information, this has got us a bit puzzled.

It was a long shot, and my colleagues don't think that ACKs ought to
have been blocked, but I'm glad you at least have a work-around. Are the
SUBSCRIBER STOMP clients SENDing anything (or writing other things) on
the same connection, by any chance? If they are this could explain it,
and the problem ought to be fixed in the next release. The
hanging/jamming problem occurs (apparently) only when sending STOMP
frames that have content and an explicit length header (and other
'high-load' things happen at the same time). But I asked you to try it
anyway.

> Non-SSL connections pass the same tests without problems.

This may be because an SSL connection has a higher 'loading' on
resources, but I'm not sure why this should be.

> Setting prefetch-count=2 fixed it, many thanks ! Could this also affect
> transactions, where a commit is sent instead of ack frames?

If it is the problem I think it is, then yes, but your question makes me
wonder if you remember that ACKs are transactional, not the consuming of
the messages, so you should not think of commit as doing an implicit
ACK: it doesn't. In particular, rollback does not re-queue un-acked
messages. Rollback will 'undo' any acknowledgements made in this
transaction (and, in RabbitMQ, any rejects, too). I'm sure you know
this, but your use of the word 'instead' got me worried. :-)

The bug that I know we've fixed is likely to 'hang' a STOMP frame that
occurs at the end of a buffer, after a particular 'throttling' effect
occurs. This ought not to be frame-specific, so whether we are
transactional or not shouldn't be relevant.

However, I know I'm not speaking for all of us, here, and it still may
not be this bug you are experiencing.

Steve Powell  (a happy bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

On 24 May 2012, at 13:10, Michael Justin wrote:

> Am 23.05.2012 17:52, Steve Powell wrote:
>> Michael,
>> 
>> Thanks for the update. Can you be a little more specific about the
>> set-up that fails?
> 
> Many thanks for your answer and your suggestion, it is working now - with prefetch-count=2.
> 
> Maybe it is helpful, here is some information from my tests and answers to your questions:
> 
> 
>> In particular I would like to know:
>> 
>> -  the version of Erlang you are using, and the (v)hardware you are
>>    running RabbitMQ on (a copy of the startup log would be nice);
> 
> The startup log is at the end, Erlang version is 5.9.1, machine is a Compaq 6820s Laptop (Intel Core 2 Duo T8100 2.1 GHz)
> 
>> -  if the problem is noticed on a non-ssl connection (if you can try
>>    this) -- we haven't seen this particular problem on our tests;
> 
> Non-SSL connections pass the same tests without problems
> 
>> -  are there any messages in the rabbitmq log around the time the
>>    message delivery stops?
> 
> The log is very small, see attached file (after running > 10 tests)
> 
>> -  can you provide more details about the topic subscription --
>>    is this a durable subscription, for example;
> 
> It is a normal queue destination, using persistent messages
> 
>> -  and do the acknowledgements actually get through (you can tell this
>>    if messages you think you have consumed are redelivered on
>>    reconnect)?
> 
> I can see after retrieving around 240 messages (when the client does not longer receive more messages) that about 120 messages are still on the broker, so the acknowledgement of 120 messages did not reach the broker.
> 
> Further debugging showed that the client hangs when sending the acknowledgement frame. Example:
> 
> received:
> MESSAGE
> content-type:text/plain
> subscription:{00AC21DB-D5A3-40C9-97C4-00FCB902634B}
> destination:/queue/ExampleQueue
> message-id:T_{00AC21DB-D5A3-40C9-97C4-00FCB902634B}@@session-ArgQuHJyTPiO2ge46jB
> 4eD@@245
> content-length:255
> 
> 
> Received: Message: 244 sent at: 24.05.2012 13:52:01         ...
> send:
> ACK
> message-id:T_{00AC21DB-D5A3-40C9-97C4-00FCB902634B}@@session-ArgQuHJyTPiO2ge46jB
> 4eD@@245
> subscription:{00AC21DB-D5A3-40C9-97C4-00FCB902634B}
> 
> <-- client frame sent but the socket write operation hangs
> 
>> We have recently discovered (and fixed) a bug in the STOMP client that
>> will stop the broker seeing the last message sent (under load). It is
>> possible that, if pre-fetch is set to 1, this is causing you to jam
>> up -- the STOMP code may not be detecting your last acknowledgement. To
>> confirm this, please try this with a pre-fetch count of zero (or 2 or
>> more) and see if you still get the lock-up.
>> 
> 
> Setting prefetch-count=2 fixed it, many thanks ! Could this also affect transactions, where a commit is sent instead of ack frames?
> 
> Regards
> 
> Michael Justin
> 
> ---
> 
> Startup log
> 
> Activating RabbitMQ plugins ...
> 7 plugins activated:
> * amqp_client-2.8.2
> * mochiweb-1.3-rmq2.8.2-git
> * rabbitmq_management-2.8.2
> * rabbitmq_management_agent-2.8.2
> * rabbitmq_mochiweb-2.8.2
> * rabbitmq_stomp-2.8.2
> * webmachine-1.7.0-rmq2.8.2-hg
> 
> 
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v2.8.2  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2012 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
> 
> node           : rabbit at MJ-PC
> app descriptor : c:/Java/rabbitmq_server-2.8.2/sbin/../ebin/rabbit.app
> home dir       : C:\Users\mj
> config file(s) : c:/Users/mj/AppData/Roaming/RabbitMQ/rabbitmq.config
> cookie hash    : WjOr7YEHHESuUkR1mMuR+g==
> log            : C:/Users/mj/AppData/Roaming/RabbitMQ/log/rabbit at MJ-PC.log
> sasl log       : C:/Users/mj/AppData/Roaming/RabbitMQ/log/rabbit at MJ-PC-sasl.log
> database dir   : c:/Users/mj/AppData/Roaming/RabbitMQ/db/rabbit at MJ-PC-mnesia
> erlang version : 5.9.1
> 
> -- rabbit boot start
> starting file handle cache server ...done
> starting worker pool ...done
> starting database ...done
> starting database sync ...done
> starting codec correctness check ...done
> -- external infrastructure ready
> starting plugin registry ...done
> starting auth mechanism cr-demo ...done
> starting auth mechanism amqplain ...done
> starting auth mechanism plain ...done
> starting statistics event manager ...done
> starting logging server ...done
> starting exchange type direct ...done
> starting exchange type fanout ...done
> starting exchange type headers ...done
> starting exchange type topic ...done
> -- kernel ready
> starting alarm handler ...done
> starting node monitor ...done
> starting cluster delegate ...done
> starting guid generator ...done
> starting memory monitor ...done
> -- core initialized
> starting management agent ...done
> starting exchange, queue and binding recovery ...done
> starting configured definitions ...done
> starting empty DB check ...done
> starting mirror queue slave sup ...done
> starting adding mirrors to queues ...done
> -- message delivery logic ready
> starting error log relay ...done
> starting networking ...done
> starting direct client ...done
> starting notify cluster nodes ...done
> 
> broker running
> ** Found 0 name clashes in code paths
> 
> 
> -- 
> Michael Justin
> habarisoft - Enterprise Messaging Software for Delphi
> http://www.habarisoft.com/
> <rabbit at MJ-PC.log>


From mjseger at gmail.com  Thu May 24 21:31:03 2012
From: mjseger at gmail.com (Mark Seger)
Date: Thu, 24 May 2012 16:31:03 -0400
Subject: [rabbitmq-discuss] some basic management questions
Message-ID: <CAC2B=ZG5eyUJmKpKgmCPovEbNCEkaHXgco4rqiFjnisq_RRwnw@mail.gmail.com>

I'm brand new to rabbit and have started looking at the management options
with an eye towards developing a collectl plugin (that's collectl with an L
nor a D): http://collectl.sourceforge.net/

Anyhow I finally figured out how to get into the web interface and am
currently looking at a display that shows:
Ready: 6 Unacknowledged: 29 Total: 35 and 4 msgs delivered/sec and 4
acknowledged per sec.  So far so good.

Now I want to try to display those same values using the cli, rabbitmqadmin
and try as I may, I can't get anything remotely that looks like those
numbers.  I tried all the list commands and in fact most, other than users,
nodes and bindings produced any real output other than 'connections' and
'channels' which both listed a ton of output.  Am I doing something wrong?

Then I discovered a collectd plugin which from the source I can see uses
rabbitmgctl, so I tried that.  Not much more luck there but when I tried
the 'report' command it went on forever.  ;)  The collectd plugin looks
like it does a command using list_queues so how come I'm not getting output
either here or with the rabbitmqadmin command?

As I said, I'm a newbie so I'm sure I'm getting something wrong that's very
basic...

-mark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120524/0c96ff90/attachment.htm>

From jerryk at rbcon.com  Thu May 24 23:48:51 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Thu, 24 May 2012 15:48:51 -0700
Subject: [rabbitmq-discuss] some basic management questions
In-Reply-To: <CAC2B=ZG5eyUJmKpKgmCPovEbNCEkaHXgco4rqiFjnisq_RRwnw@mail.gmail.com>
References: <CAC2B=ZG5eyUJmKpKgmCPovEbNCEkaHXgco4rqiFjnisq_RRwnw@mail.gmail.com>
Message-ID: <CAE0Sz=xQBeccCUC1KupVBbp-jVvCYFifbyVS7DVY7zDgRBv5kQ@mail.gmail.com>

Apologies if I'm misunderstanding you because I'm gooned on cold medicine.

Have you tried specifying what queueinfoitem values you want, i.e.
something like:

[jerryk at CoachZ ~]$ sudo rabbitmqctl list_queues name messages_ready
messages_unacknowledged messages consumers
Listing queues ...
queuebar    0    0    0    0
queuefoo    0    0    0    0
queuebaz    0    0    0    0

If you look at the output of `rabbitmqctl help` you'll see the various
fields you can ask for when listing queues, exchanges, bindings, etc.

Also the HTTP management API is a rich source of such data if you're
writing monitoring or analysis kit.  It requires you only to make web
service-ish requests of it, and be able to crack the relatively readable
JSON it gives back...

Best regards,
Jerry



On Thu, May 24, 2012 at 1:31 PM, Mark Seger <mjseger at gmail.com> wrote:

> I'm brand new to rabbit and have started looking at the management options
> with an eye towards developing a collectl plugin (that's collectl with an L
> nor a D): http://collectl.sourceforge.net/
>
> Anyhow I finally figured out how to get into the web interface and am
> currently looking at a display that shows:
> Ready: 6 Unacknowledged: 29 Total: 35 and 4 msgs delivered/sec and 4
> acknowledged per sec.  So far so good.
>
> Now I want to try to display those same values using the cli,
> rabbitmqadmin and try as I may, I can't get anything remotely that looks
> like those numbers.  I tried all the list commands and in fact most, other
> than users, nodes and bindings produced any real output other than
> 'connections' and 'channels' which both listed a ton of output.  Am I doing
> something wrong?
>
> Then I discovered a collectd plugin which from the source I can see uses
> rabbitmgctl, so I tried that.  Not much more luck there but when I tried
> the 'report' command it went on forever.  ;)  The collectd plugin looks
> like it does a command using list_queues so how come I'm not getting output
> either here or with the rabbitmqadmin command?
>
> As I said, I'm a newbie so I'm sure I'm getting something wrong that's
> very basic...
>
> -mark
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120524/9e589101/attachment.htm>

From rev.chip at gmail.com  Fri May 25 03:16:44 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Thu, 24 May 2012 19:16:44 -0700 (PDT)
Subject: [rabbitmq-discuss] in 2.8.2, when bringing 500 subscribers on line,
 all publishing blocks until queues empty
Message-ID: <5509deeb-f69d-4e56-8047-aafb08d069a7@oy3g2000pbc.googlegroups.com>

Good day, good sirs.  I have a four-machine cluster, with one queue on
each.  I start publishing to all four queues, all seems well, and the
queues build up a backlog.  I then launch 500 instances of the
consuming application.  The consumers subscribe to all four queues and
set prefetch-count = 2 on all subscriptions.  The workers get their
messages fine....

BUT: At the moment all the workers come on line, all attempts to
publish to the queues block.  And they don't unblock until the queues
have emptied out.

Is there something about having lots of workers make lots of
subscriptions with prefetch that somehow ties up the queue so it won't
accept messages?  Help, please!

From simonthorogood at hotmail.com  Fri May 25 08:19:32 2012
From: simonthorogood at hotmail.com (SimonT)
Date: Fri, 25 May 2012 00:19:32 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET DefaultBasicConsumer / BasicQueuingConsumer
 and 'noack' scenarios
Message-ID: <9a93ad39-8ce7-45de-aba8-816136b8a9ce@googlegroups.com>

In a consumer scenario where messages are ack'd, we are using a 
BasicQueuingConsumer and a Qos(0, x, false) operation to ensure that only a 
specific no. (x) of unack'd messages are dequeued at any time. This seems 
to work well.

If however, I try setting noack = true and switch off the Qos call (lets 
say we favour throughput over guaranteed delivery), I get an exception from 
RabbitMQ:

RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP 
operation was
 interrupted: AMQP close-reason, initiated by Peer, code=406, 
text="PRECONDITION
_FAILED - unknown delivery tag 1", classId=60, methodId=80, cause=
   at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply()
   at RabbitMQ.Client.Impl.ModelBase.BasicConsume(String queue, Boolean 
noAck, S
tring consumerTag, Boolean noLocal, Boolean exclusive, IDictionary 
arguments, IB
asicConsumer consumer)

Am I right in thinking then that BasicQueuingConsumer only plays well with 
noack=false scenarios - e.g.

var queueingConsumer = new QueueingBasicConsumer(_channel);
_channel.BasicConsume(queueName, false, queueingConsumer);

if so, then for noack=true, is the correct/recommended approach to use a 
DefaultBasicConsumer instead. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120525/6858c1b7/attachment.htm>

From rev.chip at gmail.com  Fri May 25 09:07:17 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Fri, 25 May 2012 01:07:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Per-Connection Flow Control -- The Case Against
Message-ID: <a6010e5e-a207-41e3-a45b-d9ab658a9292@h10g2000pbi.googlegroups.com>

The fundamental paradox of per-connection flow control is that it
holds up the stop sign just when progress becomes possible.  It is
backwards.  Consider:

1. A client is publishing 1.5K/sec to each of four exchanges, each of
which has a queue.
2. There are no consumers.  Therefore the queue is growing.
3. RMQ does not stop this.
4. The consumers appear to begin to tear down the backlog.
5. RMQ per-connection flow control suddenly decides that now there are
some consumers, now it has a reason to throttle the sender.

Therefore, it is only when the backlog can go DOWN that the broker
decides to throttle the sender.  Not when the backlog was GROWING, but
when it could be SHRINKING, that's when RMQ decides to stop accepting.

This is not acceptable.

From brendan at soundcloud.com  Fri May 25 10:24:36 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Fri, 25 May 2012 11:24:36 +0200
Subject: [rabbitmq-discuss] RabbitMQ Roadmap
In-Reply-To: <4FBE0F72.8070607@rabbitmq.com>
References: <CAHZsVQavvRv8Em4uUXR_tM0k0Eyn=iZBR5NdE-UFefOBDmxCLg@mail.gmail.com>
	<4FBE074C.5070203@rabbitmq.com>
	<CAHZsVQZ7saU5LduxGdu0kmhWDezSgpA+b0tgkP-ekGxMe-r3eg@mail.gmail.com>
	<4FBE0F72.8070607@rabbitmq.com>
Message-ID: <CAHZsVQbhnrRz3Yf5YABPye81R5atmUxRExmajyzP1eGd=jAZPQ@mail.gmail.com>

I think pausing would be acceptable, possibly something that could be
prototyped/investigated via a plugin?

On Thu, May 24, 2012 at 12:37 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 24/05/12 11:33, Brendan Hay wrote:
>
>> Good stuff!
>>
>> The physical layout comment is regarding having to specify -sname/-name
>> in the x-ha-policy .. ie having clients aware of the nodes that compose
>> a cluster.
>> In the imaginary places in my head it would be nicer to set something
>> along the lines of 'one slave', 'two slaves', ..., or '50% of the
>> cluster has slaves' etc.
>>
>
> Oh, of course. Yes, I want that to happen too. Basically clients should
> not have to know anything about how the server / cluster is configured.
>
>
>  Migrating/moving a queue around inside a cluster is another nice to have
>> - scenario would be whatever you're using to do load-balancing
>> throws a nana and causes too many queues to be declared on a single
>> machine vs a more desired even spread. Basically fine tuning your queue
>> distribution, on the fly.
>>
>
> For mirrored queues that's conceptually quite easy; add some mirrors, wait
> for them to catch up, remove the old ones and you're done.
>
> For non-mirrored queues this would be fairly horrible... unless you're
> happy for the queue to pause while data is migrated.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120525/3b21be39/attachment.htm>

From simon at rabbitmq.com  Fri May 25 10:29:09 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 25 May 2012 10:29:09 +0100
Subject: [rabbitmq-discuss] some basic management questions
In-Reply-To: <CAC2B=ZG5eyUJmKpKgmCPovEbNCEkaHXgco4rqiFjnisq_RRwnw@mail.gmail.com>
References: <CAC2B=ZG5eyUJmKpKgmCPovEbNCEkaHXgco4rqiFjnisq_RRwnw@mail.gmail.com>
Message-ID: <4FBF50E5.1060700@rabbitmq.com>

On 24/05/12 21:31, Mark Seger wrote:
>
> Anyhow I finally figured out how to get into the web interface and am
> currently looking at a display that shows:
> Ready: 6 Unacknowledged: 29 Total: 35 and 4 msgs delivered/sec and 4
> acknowledged per sec.  So far so good.
>
> Now I want to try to display those same values using the cli,
> rabbitmqadmin and try as I may, I can't get anything remotely that looks
> like those numbers.  I tried all the list commands and in fact most,
> other than users, nodes and bindings produced any real output other than
> 'connections' and 'channels' which both listed a ton of output.  Am I
> doing something wrong?

That's the "overview", see rabbitmqadmin show overview, or GET 
/api/overview. See the full HTTP API documentation at:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_8_2/priv/www/api/index.html

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From xtrm2008 at live.com  Fri May 25 03:15:55 2012
From: xtrm2008 at live.com (xtrm)
Date: Thu, 24 May 2012 19:15:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Perl SSL support for Net::RabbitMQ
In-Reply-To: <CAAt2poJ0xcuJLRewH8vBtWN7n5tgVDEijJA1Gd_fxtboLVqduA@mail.gmail.com>
References: <33901964.post@talk.nabble.com>
	<CAAt2poJ0xcuJLRewH8vBtWN7n5tgVDEijJA1Gd_fxtboLVqduA@mail.gmail.com>
Message-ID: <33905637.post@talk.nabble.com>


So what is everyone doing in regards to SSL support?  Is everyone using
either .NET or Java for their implementations?  

Thanks again for the help



Alan Antonuk wrote:
> 
> I believe (someone correct me if I'm wrong) Net::RabbitMQ is just a
> wrapper
> around the rabbitmq-c library, which does not support SSL as of yet, so
> Net::RabbitMQ probably doesn't support SSL yet.
> 
> There is currently an effort underway to add SSL support to rabbitmq-c,
> but
> it is not complete yet.
> 
> -Alan
> 
> On Thu, May 24, 2012 at 9:36 AM, xtrm <xtrm2008 at live.com> wrote:
> 
>>
>> Hello all,
>>
>> New to RabbitMQ and hoping someone on the forum has been through this
>> before. I am trying to implement SSL client authentication to use with on
>> all our clients.  I am unable to find any documentation on how to go
>> about
>> doing this.  I was able to find two examples in .NET and Java on the
>> rabbitMQ SSL support website, but no mention on how to implement using
>> Perl.
>> Has anyone gotten this working?  If so how did you guys go about
>> implementing SSL support?
>>
>> I currently have my clients publishing successfully using the non SSL
>> port
>> using Net::RabbitMQ module.
>>
>> Thanks for the help in advance.
>>
>> --
>> View this message in context:
>> http://old.nabble.com/Perl-SSL-support-for-Net%3A%3ARabbitMQ-tp33901964p33901964.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Perl-SSL-support-for-Net%3A%3ARabbitMQ-tp33901964p33905637.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From kevin.nuckolls at gmail.com  Fri May 25 05:29:49 2012
From: kevin.nuckolls at gmail.com (Kevin Nuckolls)
Date: Thu, 24 May 2012 21:29:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster Disk Node failure and cluster membership
Message-ID: <31aa1f35-0ffb-4d6e-be9c-56d8a7fd4260@googlegroups.com>

I'm hoping to automate the clustering steps with Chef and I have one 
pivotal question: If I have a cluster with three disc nodes in the cloud 
and one of them goes down and is gone forever, will the other nodes 
eventually give up on treating it as a disc node?

In that scenario, cluster_status would look something like this after 
kevin-rabbit1 terminated forever:

Cluster status of node 'rabbit at kevin-rabbit2' ...
[{nodes,[{disc,['rabbit at kevin-rabbit3','rabbit at kevin-rabbit2',
                'rabbit at kevin-rabbit1']}]},
 {running_nodes,['rabbit at kevin-rabbit3','rabbit at kevin-rabbit2']}]
...done.

The cluster just thinks that kevin-rabbit1 is "off" and that it might come 
back someday, right? Is there any way for me to tell the cluster "sorry 
guys, that node is dead _forever_. Just forget about it and move on with 
your lives."

I saw this language in the cluster docs which makes me concerned about 
making sure that the cluster_status is clean and up to date with what nodes 
are alive and dead.

There are some important caveats:

   - All disk nodes must be running for certain operations, most notably 
   leaving a cluster, to succeed.
   - At least one disk node should be running at all times.
   - When all nodes in a cluster have been shut down, restarting any node 
   will suspend for up to 30 seconds and then fail if the last disk node that 
   was shut down has not been restarted yet. Since the nodes do not know what 
   happened to that last node, they have to assume that it holds a more 
   up-to-date version of the broker state. Hence, in order to preserve data 
   integrity, they cannot resume operation until that node is restarted.


That's why I want to make sure that the other nodes know that the lost disc 
node is never, ever coming back. 

Anyway thanks. Any insight will help :)

Kevin Nuckolls
Senior Software Engineer
Mosaik Solutions

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120524/77b696de/attachment.htm>

From steve.barlow at argondesign.com  Fri May 25 12:00:40 2012
From: steve.barlow at argondesign.com (Steve Barlow)
Date: Fri, 25 May 2012 04:00:40 -0700 (PDT)
Subject: [rabbitmq-discuss]  Example of FIX over AMQP
Message-ID: <33907233.post@talk.nabble.com>


I am working on identifying FIX traffic over networks. So I am looking for
examples (i.e. Wireshark traces) of different types of FIX traffic and FIX
over different transports. Does anyone have a small example of FIX over AMQP
that they could let me have?

-- 
View this message in context: http://old.nabble.com/Example-of-FIX-over-AMQP-tp33907233p33907233.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From francesco at rabbitmq.com  Fri May 25 12:33:50 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 25 May 2012 12:33:50 +0100
Subject: [rabbitmq-discuss] Fwd: Re: Cluster Disk Node failure and cluster
 membership
In-Reply-To: <4FBF6DDA.7050603@rabbitmq.com>
References: <4FBF6DDA.7050603@rabbitmq.com>
Message-ID: <4FBF6E1E.5040505@rabbitmq.com>

Forwarding to the list, didn't notice it was coming from google groups.

-------- Original Message --------
Subject: Re: [rabbitmq-discuss] Cluster Disk Node failure and cluster 
membership
Date: Fri, 25 May 2012 12:32:42 +0100
From: Francesco Mazzoli <francesco at rabbitmq.com>
To: Kevin Nuckolls <kevin.nuckolls at gmail.com>
CC: rabbitmq-discuss at googlegroups.com

Hi Kevin,

On 25/05/12 05:29, Kevin Nuckolls wrote:
> I'm hoping to automate the clustering steps with Chef and I have one
> pivotal question: If I have a cluster with three disc nodes in the cloud
> and one of them goes down and is gone forever, will the other nodes
> eventually give up on treating it as a disc node?

Not automatically. Right now only the node itself can leave the cluster
(reseting it will do). If the node is gone forever as you say, you can
bring up an "impostor" node that looks like the old one (that is, has
the same node name in distributed erlang), `force_cluster' it with the
remaining nodes, and then reseting it. I know, it's ugly, we're working
to make the whole system nicer.

Francesco.

From mjseger at gmail.com  Fri May 25 13:01:37 2012
From: mjseger at gmail.com (Mark Seger)
Date: Fri, 25 May 2012 08:01:37 -0400
Subject: [rabbitmq-discuss] some basic management questions
In-Reply-To: <4FBF50E5.1060700@rabbitmq.com>
References: <CAC2B=ZG5eyUJmKpKgmCPovEbNCEkaHXgco4rqiFjnisq_RRwnw@mail.gmail.com>
	<4FBF50E5.1060700@rabbitmq.com>
Message-ID: <CAC2B=ZGHDkPkWJsHjRoUOm9tf38nYq2ZnELVwK4Hxe_3DsqA9Q@mail.gmail.com>

excellent, thanks.
-mark

On Fri, May 25, 2012 at 5:29 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 24/05/12 21:31, Mark Seger wrote:
>
>>
>> Anyhow I finally figured out how to get into the web interface and am
>> currently looking at a display that shows:
>> Ready: 6 Unacknowledged: 29 Total: 35 and 4 msgs delivered/sec and 4
>> acknowledged per sec.  So far so good.
>>
>> Now I want to try to display those same values using the cli,
>> rabbitmqadmin and try as I may, I can't get anything remotely that looks
>> like those numbers.  I tried all the list commands and in fact most,
>> other than users, nodes and bindings produced any real output other than
>> 'connections' and 'channels' which both listed a ton of output.  Am I
>> doing something wrong?
>>
>
> That's the "overview", see rabbitmqadmin show overview, or GET
> /api/overview. See the full HTTP API documentation at:
>
> http://hg.rabbitmq.com/**rabbitmq-management/raw-file/**
> rabbitmq_v2_8_2/priv/www/api/**index.html<http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_8_2/priv/www/api/index.html>
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120525/e3a55cda/attachment.htm>

From simon at rabbitmq.com  Fri May 25 13:12:15 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 25 May 2012 13:12:15 +0100
Subject: [rabbitmq-discuss] Per-Connection Flow Control -- The Case
	Against
In-Reply-To: <a6010e5e-a207-41e3-a45b-d9ab658a9292@h10g2000pbi.googlegroups.com>
References: <a6010e5e-a207-41e3-a45b-d9ab658a9292@h10g2000pbi.googlegroups.com>
Message-ID: <4FBF771F.5090009@rabbitmq.com>

(Please take this as a reply to your other mail too.)

There's a couple of things going on here. The key point is that a few 
years ago, in the 1.7.0(!) timeframe, the decision was taken to make 
queues prioritise delivering messages over accepting messages. The idea 
was - of course - that all else being equal it's better for messages to 
go out than come in.

The trouble is that it's possible for a queue to get into a state where 
it is spending 100% of its time sending messages to consumers and 
handling acks. With the current prioritisation scheme, this means that 
no publishes are processed at all.

It's considerably easier to get into this state with lots of consumers 
and low prefetch count, since the queue has to do a bunch of accounting 
as it constantly blocks and unblocks consumers.

Before 2.8.0, this condition still existed, but since there was no flow 
control, published messages would just back up in the channel and reader 
processes. This is not good, since memory use balloons and when the 
queue is finally able to start accepting publishes again it has a huge 
backlog to get through - that clients thought were published some time 
in the past.

So I don't think that flow control is the problem. But it is making the 
problem rather more visible.

I am strongly tempted to just remove this prioritisation from the queue. 
It would be easier to get into a state where queue lengths are growing 
rather than shrinking, but behaviour would be more predictable, and I 
think that's important.

Would you be interested in testing this for your use case?

In the mean time, I wonder whether 500 consumers and prefetch-count of 2 
is what you really want. Normally I would expect a configuration like 
that when you expect to take some time to process each message, but it 
sounds like you're going fast enough that either 500 consumers are not 
needed, or prefetch-count > 2 might lead to better performance.

Cheers, Simon

On 25/05/12 09:07, Chip Salzenberg wrote:
> The fundamental paradox of per-connection flow control is that it
> holds up the stop sign just when progress becomes possible.  It is
> backwards.  Consider:
>
> 1. A client is publishing 1.5K/sec to each of four exchanges, each of
> which has a queue.
> 2. There are no consumers.  Therefore the queue is growing.
> 3. RMQ does not stop this.
> 4. The consumers appear to begin to tear down the backlog.
> 5. RMQ per-connection flow control suddenly decides that now there are
> some consumers, now it has a reason to throttle the sender.
>
> Therefore, it is only when the backlog can go DOWN that the broker
> decides to throttle the sender.  Not when the backlog was GROWING, but
> when it could be SHRINKING, that's when RMQ decides to stop accepting.
>
> This is not acceptable.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From alan.antonuk at gmail.com  Fri May 25 14:27:51 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 25 May 2012 09:27:51 -0400
Subject: [rabbitmq-discuss] Perl SSL support for Net::RabbitMQ
In-Reply-To: <CABJpC5R02_K2vLHE-LJ=MQqTm_hibXScEqO+V3HtEmG+1VMrZA@mail.gmail.com>
References: <33901964.post@talk.nabble.com>
	<CAAt2poJ0xcuJLRewH8vBtWN7n5tgVDEijJA1Gd_fxtboLVqduA@mail.gmail.com>
	<CABJpC5R02_K2vLHE-LJ=MQqTm_hibXScEqO+V3HtEmG+1VMrZA@mail.gmail.com>
Message-ID: <CAAt2po+HFrakw_JcsGA6pAog+Q5Om1hG2DQbUF2H_m3HV-t31w@mail.gmail.com>

Should have gone to the list:

On Thu, May 24, 2012 at 9:31 PM, lenz <norbu09 at googlemail.com> wrote:

> We user Rabbit from perl a lot and use Net::RabbitMQ for it. It is a
> XS module built on rabbitmq-c and from all our testing so far the only
> lib that works in a high performance environment. Unfortunately SSL is
> not in there yet (as posted below, work is under way). We use SSH
> tunnels for pretty much everything and don't expose any rabbit ports
> publicly.
>
> cheers
> lenz
>
> On Fri, May 25, 2012 at 2:16 AM, Alan Antonuk <alan.antonuk at gmail.com>
> wrote:
> > I believe (someone correct me if I'm wrong) Net::RabbitMQ is just a
> wrapper
> > around the rabbitmq-c library, which does not support SSL as of yet, so
> > Net::RabbitMQ probably doesn't support SSL yet.
> >
> > There is currently an effort underway to add SSL support to rabbitmq-c,
> but
> > it is not complete yet.
> >
> > -Alan
> >
> >
> > On Thu, May 24, 2012 at 9:36 AM, xtrm <xtrm2008 at live.com> wrote:
> >>
> >>
> >> Hello all,
> >>
> >> New to RabbitMQ and hoping someone on the forum has been through this
> >> before. I am trying to implement SSL client authentication to use with
> on
> >> all our clients.  I am unable to find any documentation on how to go
> about
> >> doing this.  I was able to find two examples in .NET and Java on the
> >> rabbitMQ SSL support website, but no mention on how to implement using
> >> Perl.
> >> Has anyone gotten this working?  If so how did you guys go about
> >> implementing SSL support?
> >>
> >> I currently have my clients publishing successfully using the non SSL
> port
> >> using Net::RabbitMQ module.
> >>
> >> Thanks for the help in advance.
> >>
> >> --
> >> View this message in context:
> >>
> http://old.nabble.com/Perl-SSL-support-for-Net%3A%3ARabbitMQ-tp33901964p33901964.html
> >> Sent from the RabbitMQ mailing list archive at Nabble.com.
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
>
>
> --
> twitter: @norbu09
> current project: iWantMyName.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120525/b6dc9ca5/attachment.htm>

From emile at rabbitmq.com  Fri May 25 15:58:56 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 25 May 2012 15:58:56 +0100
Subject: [rabbitmq-discuss] Windows service recovery
In-Reply-To: <C3A760638FE7B343972DD905011226E3058AF1472D@GZSMSCCR03.sms1.local>
References: <C3A760638FE7B343972DD905011226E3058AF1472D@GZSMSCCR03.sms1.local>
Message-ID: <4FBF9E30.9040209@rabbitmq.com>

Hi Lior,

On 23/05/12 15:37, Lior Barnea wrote:
> Killing erlsvr.exe does not stop erl.exe (meaning rabbitMQ still
> running) but does alert windows that then tries to restart erlsvr.exe
> 
> When erlsvr.exe is started again, it tries to spawn erl.exe again and
> fails because it is already running, failing erlsvr.exe completely,
> recovery failed.

I can confirm that your description is accurate. erlsrv acts as an
interface between the Windows service management and the Erlang process.
It can communicate failures of the broker to Windows but it does not
cope if erlsrv itself fails. The design is presumably based on the
estimate that the broker is far more likely to fail.

Are you exploring a hypothetical concern or is this a real issue that is
preventing you from deploying and using the broker?


-Emile



From stammailbox at gmail.com  Fri May 25 16:01:09 2012
From: stammailbox at gmail.com (Mysurf Mail)
Date: Fri, 25 May 2012 16:01:09 +0100
Subject: [rabbitmq-discuss] What is the best practice to restart a rabbit
 server automatticaly after it was installed as a server?
Message-ID: <CAJ2-VrkSxFyV-j13eyec7pFfBom7m_zcNg5KOtz_+kpU2v4ToA@mail.gmail.com>

Hi,
What is the best practice to restart a rabbit server automatticaly after it
was installed as a server?
scheduled task ? command ?
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120525/dd14b103/attachment.htm>

From support at cloudwebdns.com  Fri May 25 16:53:35 2012
From: support at cloudwebdns.com (Cloud DNS)
Date: Fri, 25 May 2012 23:53:35 +0800
Subject: [rabbitmq-discuss] What is the best practice to restart a
 rabbit server automatticaly after it was installed as a server?
In-Reply-To: <CAJ2-VrkSxFyV-j13eyec7pFfBom7m_zcNg5KOtz_+kpU2v4ToA@mail.gmail.com>
References: <CAJ2-VrkSxFyV-j13eyec7pFfBom7m_zcNg5KOtz_+kpU2v4ToA@mail.gmail.com>
Message-ID: <4FBFAAFF.7000906@cloudwebdns.com>

$ /etc/init.d/rabbitmq-server
Usage: /etc/init.d/rabbitmq-server 
{start|stop|status|rotate-logs|restart|condrestart|try-restart|reload|force-reload}

If you are using a unix like system, the script which is automatically 
installed in /etc/init.d is helpful to you.


? 2012-5-25 23:01, Mysurf Mail ??:
> Hi,
> What is the best practice to restart a rabbit server automatticaly after
> it was installed as a server?
> scheduled task ? command ?
> Thanks.
>
>


From tim at rabbitmq.com  Fri May 25 16:57:51 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 25 May 2012 16:57:51 +0100
Subject: [rabbitmq-discuss] .NET DefaultBasicConsumer /
 BasicQueuingConsumer and 'noack' scenarios
In-Reply-To: <COL116-W381487BDAA00A802BE5228D4010@phx.gbl>
References: <9a93ad39-8ce7-45de-aba8-816136b8a9ce@googlegroups.com>,
	<4FBF8D5F.7050409@rabbitmq.com>
	<COL116-W381487BDAA00A802BE5228D4010@phx.gbl>
Message-ID: <4FBFABFF.8040308@rabbitmq.com>

On 25/05/12 16:42, Simon Thorogood wrote:
> Thanks Tim - had missed the BasicAck.
>
> It looks like when I remove basicQos and BasicAck calls that the 
> QueueingBasicConsumer works fine but keeps reading from the Rabbit 
> queue into the internal buffer queue indefinitely (I have set up a 
> test case where the consumer struggles to keep up with the loader).
>
> Would you recommend using DefaultBasicConsumer in this case? or 
> createing a custom Queueing consumer?
>
> Basically, I am keen to use BasicQos  when we can, but would also like 
> to limit de-queuing of unprocessed messages in non 'ack'' scenarios.
>

In this case, it sounds like a custom consumer would serve you better, 
as you'd have more fine grained control. Perhaps one of the developers 
more experienced with the client(s) will chime in here and confirm 
whether or not this is something that can be 'twiddled' with the 
DefaultBasicConsumer however.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120525/3c81bf32/attachment.htm>

From alexis at rabbitmq.com  Fri May 25 17:02:28 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 25 May 2012 17:02:28 +0100
Subject: [rabbitmq-discuss] Example of FIX over AMQP
In-Reply-To: <33907233.post@talk.nabble.com>
References: <33907233.post@talk.nabble.com>
Message-ID: <CACOPnveuVMBkEipjJf=RawNLw_jXSq6x49Y3zxx7WgSdMjvD2Q@mail.gmail.com>

Steve

I have bcc'd some folks who might be able to help...

alexis


On Fri, May 25, 2012 at 12:00 PM, Steve Barlow
<steve.barlow at argondesign.com> wrote:
>
> I am working on identifying FIX traffic over networks. So I am looking for
> examples (i.e. Wireshark traces) of different types of FIX traffic and FIX
> over different transports. Does anyone have a small example of FIX over AMQP
> that they could let me have?
>
> --
> View this message in context: http://old.nabble.com/Example-of-FIX-over-AMQP-tp33907233p33907233.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Fri May 25 17:11:04 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 25 May 2012 17:11:04 +0100
Subject: [rabbitmq-discuss] .NET DefaultBasicConsumer /
 BasicQueuingConsumer and 'noack' scenarios
In-Reply-To: <4FBFABFF.8040308@rabbitmq.com>
References: <9a93ad39-8ce7-45de-aba8-816136b8a9ce@googlegroups.com>,
	<4FBF8D5F.7050409@rabbitmq.com>
	<COL116-W381487BDAA00A802BE5228D4010@phx.gbl>
	<4FBFABFF.8040308@rabbitmq.com>
Message-ID: <4FBFAF18.5050303@rabbitmq.com>

On 25/05/12 16:57, Tim Watson wrote:
> On 25/05/12 16:42, Simon Thorogood wrote:
>> Basically, I am keen to use BasicQos when we can, but would also like
>> to limit de-queuing of unprocessed messages in non 'ack'' scenarios.

"limiting the dequeuing of unprocessed messages" requires the use of 
ack-mode. The client needs some way of telling the server when it has 
done with processing messages, so that the server can send it more. And 
the way to convey that information is 'ack'.

Matthias.

From john.davies at Incept5.com  Fri May 25 17:22:02 2012
From: john.davies at Incept5.com (John T Davies)
Date: Fri, 25 May 2012 17:22:02 +0100
Subject: [rabbitmq-discuss] Example of FIX over AMQP
In-Reply-To: <CACOPnveuVMBkEipjJf=RawNLw_jXSq6x49Y3zxx7WgSdMjvD2Q@mail.gmail.com>
References: <33907233.post@talk.nabble.com>
	<CACOPnveuVMBkEipjJf=RawNLw_jXSq6x49Y3zxx7WgSdMjvD2Q@mail.gmail.com>
Message-ID: <85BA1888-9C41-4A92-B717-D6CC6BE977A8@Incept5.com>

Steve,
   We have plenty of FIX messages in tank-files and examples we use in unit tests, I assume if it's FIX over AMQP then it's FIX 5, are you looking for low-level pcap dumps of just raw FIX messages?
John Davies | CTO
Incept5
M:	+44 7770 697272
E:	John.Davies at Incept5.com
W:	www.Incept5.com
T:	@jtdavies

On 25 May 2012, at 17:02, Alexis Richardson wrote:

> Steve
> 
> I have bcc'd some folks who might be able to help...
> 
> alexis
> 
> 
> On Fri, May 25, 2012 at 12:00 PM, Steve Barlow
> <steve.barlow at argondesign.com> wrote:
>> 
>> I am working on identifying FIX traffic over networks. So I am looking for
>> examples (i.e. Wireshark traces) of different types of FIX traffic and FIX
>> over different transports. Does anyone have a small example of FIX over AMQP
>> that they could let me have?
>> 
>> --
>> View this message in context: http://old.nabble.com/Example-of-FIX-over-AMQP-tp33907233p33907233.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120525/6da67a46/attachment.htm>

From emile at rabbitmq.com  Fri May 25 17:32:01 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 25 May 2012 17:32:01 +0100
Subject: [rabbitmq-discuss] What is the best practice to restart a
 rabbit server automatticaly after it was installed as a server?
In-Reply-To: <CAJ2-VrkSxFyV-j13eyec7pFfBom7m_zcNg5KOtz_+kpU2v4ToA@mail.gmail.com>
References: <CAJ2-VrkSxFyV-j13eyec7pFfBom7m_zcNg5KOtz_+kpU2v4ToA@mail.gmail.com>
Message-ID: <4FBFB401.9040403@rabbitmq.com>

Hi,

On 25/05/12 16:01, Mysurf Mail wrote:
> What is the best practice to restart a rabbit server automatticaly after
> it was installed as a server?

If you installed RabbitMQ as an application then you must can
rabbitmq-server.bat and rabbitmqctl.bat .

If you installed as a service then you can use the rabbitmq-service
command or any tools that manage Windows services, e.g. services.msc or SC.

For more information see www.rabbitmq.com/install-windows-manual.html


-Emile


From alexis at rabbitmq.com  Fri May 25 18:15:46 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 25 May 2012 18:15:46 +0100
Subject: [rabbitmq-discuss] Example of FIX over AMQP
In-Reply-To: <CACOPnveuVMBkEipjJf=RawNLw_jXSq6x49Y3zxx7WgSdMjvD2Q@mail.gmail.com>
References: <33907233.post@talk.nabble.com>
	<CACOPnveuVMBkEipjJf=RawNLw_jXSq6x49Y3zxx7WgSdMjvD2Q@mail.gmail.com>
Message-ID: <CACOPnvcmjiEEZOCVdaXR+EXObitufX6DgNc+cej5ZRpW45_mDw@mail.gmail.com>

Cross/re-posting at John's request:


Steve,

   We have plenty of FIX messages in tank-files and examples we use in
unit tests, I assume if it's FIX over AMQP then it's FIX 5, are you
looking for low-level pcap dumps of just raw FIX messages?

John Davies | CTO
Incept5
M:	+44 7770 697272
E:	John.Davies at Incept5.com
W:	www.Incept5.com
T:	@jtdavies


On Fri, May 25, 2012 at 5:02 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Steve
>
> I have bcc'd some folks who might be able to help...
>
> alexis
>
>
> On Fri, May 25, 2012 at 12:00 PM, Steve Barlow
> <steve.barlow at argondesign.com> wrote:
>>
>> I am working on identifying FIX traffic over networks. So I am looking for
>> examples (i.e. Wireshark traces) of different types of FIX traffic and FIX
>> over different transports. Does anyone have a small example of FIX over AMQP
>> that they could let me have?
>>
>> --
>> View this message in context: http://old.nabble.com/Example-of-FIX-over-AMQP-tp33907233p33907233.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rev.chip at gmail.com  Fri May 25 18:55:37 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Fri, 25 May 2012 10:55:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Why am I being censored?
Message-ID: <248f08cc-fc4b-4a89-827e-8e74e7cf5b38@googlegroups.com>

I've posted twice and both posts have failed to show up.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120525/54a9629a/attachment.htm>

From rev.chip at gmail.com  Fri May 25 18:57:41 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Fri, 25 May 2012 10:57:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Per-Connection Flow Control -- The Case Against
	(Try #2)
Message-ID: <2af00047-238a-49dc-95da-982dcc32f6a6@googlegroups.com>

The fundamental paradox of per-connection flow control is that it holds up 
the stop sign just when progress becomes possible.  It is backwards and 
unhelpful.  Consider:

1. A client is publishing 1.5K/sec to each of four exchanges, each of which 
has a queue.
2. There are no consumers.  Therefore the queue is growing.
3. RMQ does not stop this.  "Flow control" does not trigger.
4. The consumers appear to begin to tear down the backlog.
5. RMQ per-connection flow control suddenly decides that now there are some 
consumers, now it has a reason to throttle the sender.
6. If the consumers had not shown up, the producer would not have been 
blocked.

Therefore, it is only when the backlog can go DOWN that the broker decides 
to throttle the sender.  Not when the backlog was GROWING, but when it 
could be SHRINKING, that's when RMQ decides to stop accepting.

This is not acceptable.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120525/23703a6a/attachment.htm>

From rev.chip at gmail.com  Fri May 25 18:58:24 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Fri, 25 May 2012 10:58:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Why am I being censored?
In-Reply-To: <248f08cc-fc4b-4a89-827e-8e74e7cf5b38@googlegroups.com>
References: <248f08cc-fc4b-4a89-827e-8e74e7cf5b38@googlegroups.com>
Message-ID: <2661f065-aaef-45e2-85d0-f9e887064da6@googlegroups.com>

On Friday, May 25, 2012 10:55:37 AM UTC-7, Chip Salzenberg wrote:
>
> I've posted twice and both posts have failed to show up.


And, now it shows up.  Perhaps it's because I hadn't switched to the new 
Groups skin. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120525/64cf08b1/attachment.htm>

From videlalvaro at gmail.com  Fri May 25 18:59:31 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 25 May 2012 19:59:31 +0200
Subject: [rabbitmq-discuss] Why am I being censored?
In-Reply-To: <248f08cc-fc4b-4a89-827e-8e74e7cf5b38@googlegroups.com>
References: <248f08cc-fc4b-4a89-827e-8e74e7cf5b38@googlegroups.com>
Message-ID: <14753BD49AE74FD591C1E2571CC93944@gmail.com>

Have you sent your emails to this list? 

https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

I see you are using google groups instead. 

-- 
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)


On Friday, May 25, 2012 at 7:55 PM, Chip Salzenberg wrote:

> I've posted twice and both posts have failed to show up.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120525/385b4383/attachment.htm>

From steve.barlow at argondesign.com  Fri May 25 18:39:26 2012
From: steve.barlow at argondesign.com (Steve Barlow)
Date: Fri, 25 May 2012 17:39:26 +0000
Subject: [rabbitmq-discuss] Example of FIX over AMQP
In-Reply-To: <CACOPnvcmjiEEZOCVdaXR+EXObitufX6DgNc+cej5ZRpW45_mDw@mail.gmail.com>
References: <33907233.post@talk.nabble.com>
	<CACOPnveuVMBkEipjJf=RawNLw_jXSq6x49Y3zxx7WgSdMjvD2Q@mail.gmail.com>
	<CACOPnvcmjiEEZOCVdaXR+EXObitufX6DgNc+cej5ZRpW45_mDw@mail.gmail.com>
Message-ID: <33651E52D940544DA37D686B181ABB1F8B39AD@THHSLE14MBX2.hslive.net>

Dear John,

I'm looking for what you would see on the wire if you used FIX application messages transported over AMQP. That way I can test recognition of FIX in a full situation with all the layers.

As I understand it people would now mainly do this with FIX 5.0 or FIXML but might also send earlier versions of FIX which include session information that would be ignored or just used as a check. My preference is for an example with FIX 5.0.

I also understood that AMQP is transported over TCP and can use SSL. To see what is going on I need an example without SSL.

So the ideal would be a .pcap file of a FIX 5.0 session over AMQP over TCP without SSL.

Kind regards,

Steve Barlow.

-----Original Message-----
From: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com] On Behalf Of Alexis Richardson
Sent: 25 May 2012 18:16
To: Steve Barlow
Cc: rabbitmq-discuss at lists.rabbitmq.com; John Davies
Subject: Re: [rabbitmq-discuss] Example of FIX over AMQP

Cross/re-posting at John's request:

Steve,

   We have plenty of FIX messages in tank-files and examples we use in unit tests, I assume if it's FIX over AMQP then it's FIX 5, are you looking for low-level pcap dumps of just raw FIX messages?

John Davies | CTO
Incept5
M:	+44 7770 697272
E:	John.Davies at Incept5.com
W:	www.Incept5.com
T:	@jtdavies


On Fri, May 25, 2012 at 5:02 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Steve
>
> I have bcc'd some folks who might be able to help...
>
> alexis
>
>
> On Fri, May 25, 2012 at 12:00 PM, Steve Barlow 
> <steve.barlow at argondesign.com> wrote:
>>
>> I am working on identifying FIX traffic over networks. So I am 
>> looking for examples (i.e. Wireshark traces) of different types of 
>> FIX traffic and FIX over different transports. Does anyone have a 
>> small example of FIX over AMQP that they could let me have?
>>
>> --
>> View this message in context: 
>> http://old.nabble.com/Example-of-FIX-over-AMQP-tp33907233p33907233.ht
>> ml Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From john.davies at Incept5.com  Fri May 25 18:56:43 2012
From: john.davies at Incept5.com (John T Davies)
Date: Fri, 25 May 2012 18:56:43 +0100
Subject: [rabbitmq-discuss] Example of FIX over AMQP
In-Reply-To: <33651E52D940544DA37D686B181ABB1F8B39AD@THHSLE14MBX2.hslive.net>
References: <33907233.post@talk.nabble.com>
	<CACOPnveuVMBkEipjJf=RawNLw_jXSq6x49Y3zxx7WgSdMjvD2Q@mail.gmail.com>
	<CACOPnvcmjiEEZOCVdaXR+EXObitufX6DgNc+cej5ZRpW45_mDw@mail.gmail.com>
	<33651E52D940544DA37D686B181ABB1F8B39AD@THHSLE14MBX2.hslive.net>
Message-ID: <70365F3F-AE45-4352-B8D2-1A3B2B6DDF11@Incept5.com>

Well we have several dozen clients using Fix but none of them currently use AMQP. We currently supply the Fix engines so we're pretty flexible on what we can provide you but none of it is currently over AMQP. I'd be happy to work with you though.

-John- (on the road or in the air)
Tel. : +44 7770697272
Twitter: @jtdavies
Skype: john-davies

On 25 May 2012, at 18:39, Steve Barlow <steve.barlow at argondesign.com> wrote:

> Dear John,
> 
> I'm looking for what you would see on the wire if you used FIX application messages transported over AMQP. That way I can test recognition of FIX in a full situation with all the layers.
> 
> As I understand it people would now mainly do this with FIX 5.0 or FIXML but might also send earlier versions of FIX which include session information that would be ignored or just used as a check. My preference is for an example with FIX 5.0.
> 
> I also understood that AMQP is transported over TCP and can use SSL. To see what is going on I need an example without SSL.
> 
> So the ideal would be a .pcap file of a FIX 5.0 session over AMQP over TCP without SSL.
> 
> Kind regards,
> 
> Steve Barlow.
> 
> -----Original Message-----
> From: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com] On Behalf Of Alexis Richardson
> Sent: 25 May 2012 18:16
> To: Steve Barlow
> Cc: rabbitmq-discuss at lists.rabbitmq.com; John Davies
> Subject: Re: [rabbitmq-discuss] Example of FIX over AMQP
> 
> Cross/re-posting at John's request:
> 
> Steve,
> 
>   We have plenty of FIX messages in tank-files and examples we use in unit tests, I assume if it's FIX over AMQP then it's FIX 5, are you looking for low-level pcap dumps of just raw FIX messages?
> 
> John Davies | CTO
> Incept5
> M:    +44 7770 697272
> E:    John.Davies at Incept5.com
> W:    www.Incept5.com
> T:    @jtdavies
> 
> 
> On Fri, May 25, 2012 at 5:02 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> Steve
>> 
>> I have bcc'd some folks who might be able to help...
>> 
>> alexis
>> 
>> 
>> On Fri, May 25, 2012 at 12:00 PM, Steve Barlow 
>> <steve.barlow at argondesign.com> wrote:
>>> 
>>> I am working on identifying FIX traffic over networks. So I am 
>>> looking for examples (i.e. Wireshark traces) of different types of 
>>> FIX traffic and FIX over different transports. Does anyone have a 
>>> small example of FIX over AMQP that they could let me have?
>>> 
>>> --
>>> View this message in context: 
>>> http://old.nabble.com/Example-of-FIX-over-AMQP-tp33907233p33907233.ht
>>> ml Sent from the RabbitMQ mailing list archive at Nabble.com.
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rev.chip at gmail.com  Sat May 26 00:24:31 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Fri, 25 May 2012 16:24:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Per-Connection Flow Control -- The Case
 Against (Try #2)
In-Reply-To: <CANVSfp+B6tBwq_4HTtnmkaGxgaFtho64e94rNGcTY4EfKur=kQ@mail.gmail.com>
References: <2af00047-238a-49dc-95da-982dcc32f6a6@googlegroups.com>
	<CANVSfp+B6tBwq_4HTtnmkaGxgaFtho64e94rNGcTY4EfKur=kQ@mail.gmail.com>
Message-ID: <2e8400cc-4ae0-420f-b2ec-f90b92522d1f@googlegroups.com>

An untested patch to disable it:

diff --git a/src/rabbit_reader.erl b/src/rabbit_reader.erl
index 5acf6ac..8b65821 100644
--- a/src/rabbit_reader.erl
+++ b/src/rabbit_reader.erl
@@ -368,7 +368,7 @@ terminate(_Explanation, State) ->

 control_throttle(State = #v1{connection_state   = CS,
                              conserve_resources = Mem}) ->
-    case {CS, Mem orelse credit_flow:blocked()} of
+    case {CS, Mem} of
         {running,   true} -> State#v1{connection_state = blocking};
         {blocking, false} -> State#v1{connection_state = running};
         {blocked,  false} -> ok = rabbit_heartbeat:resume_monitor(


On Friday, May 25, 2012 3:42:36 PM UTC-7, Pablo Molnar wrote:
>
> I'm also experiencing the flow control to be unhelpful using spring-amqp 
> libraries. Is there a way to just turn it off?
>
> Thanks,
> Pablo
>
> On  Fri, May 25, 2012 at 2:57 PM, Chip Salzenberg <rev.chip at gmail.com>wrote:
>
>> The fundamental paradox of per-connection flow control is that it holds 
>> up the stop sign just when progress becomes possible.  It is backwards and 
>> unhelpful.  Consider:
>>
>> 1. A client is publishing 1.5K/sec to each of four exchanges, each of 
>> which has a queue.
>> 2. There are no consumers.  Therefore the queue is growing.
>> 3. RMQ does not stop this.  "Flow control" does not trigger.
>> 4. The consumers appear to begin to tear down the backlog.
>> 5. RMQ per-connection flow control suddenly decides that now there are 
>> some consumers, now it has a reason to throttle the sender.
>> 6. If the consumers had not shown up, the producer would not have been 
>> blocked.
>>
>> Therefore, it is only when the backlog can go DOWN that the broker 
>> decides to throttle the sender.  Not when the backlog was GROWING, but when 
>> it could be SHRINKING, that's when RMQ decides to stop accepting.
>>
>> This is not acceptable.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120525/75fbbfbe/attachment.htm>

From will at thumb.it  Sat May 26 05:00:05 2012
From: will at thumb.it (Will Koffel)
Date: Sat, 26 May 2012 00:00:05 -0400
Subject: [rabbitmq-discuss] Regular supervisor shutdown errors?
Message-ID: <5A1722C0-DD44-490C-9203-343E9F3E7368@thumb.it>

I'm seeing somewhat regular (but not in a tight loop) occurrences of these notices in my rabbit@<host>-sasl.log.

Sometimes the reason is listed as "noproc", other times as "shutdown".  Are these normal?  If not, how can I debug?


> =SUPERVISOR REPORT==== 26-May-2012::02:09:34 ===
>      Supervisor: {<0.549.2188>,
>                                            rabbit_channel_sup_sup}
>      Context:    shutdown_error
>      Reason:     noproc
>      Offender:   [{pid,<0.551.2188>},
>                   {name,channel_sup},
>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>                   {restart_type,temporary},
>                   {shutdown,infinity},
>                   {child_type,supervisor}]
> 
> 
> =SUPERVISOR REPORT==== 26-May-2012::02:15:52 ===
>      Supervisor: {<0.31254.2188>,
>                                            rabbit_channel_sup_sup}
>      Context:    shutdown_error
>      Reason:     noproc
>      Offender:   [{pid,<0.31256.2188>},
>                   {name,channel_sup},
>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>                   {restart_type,temporary},
>                   {shutdown,infinity},
>                   {child_type,supervisor}]
> 
> 
> =SUPERVISOR REPORT==== 26-May-2012::02:18:20 ===
>      Supervisor: {<0.15873.2189>,
>                                            rabbit_channel_sup_sup}
>      Context:    shutdown_error
>      Reason:     shutdown
>      Offender:   [{pid,<0.15875.2189>},
>                   {name,channel_sup},
>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>                   {restart_type,temporary},
>                   {shutdown,infinity},
>                   {child_type,supervisor}]
> 
> 
> =SUPERVISOR REPORT==== 26-May-2012::03:52:54 ===
>      Supervisor: {<0.23330.3>,rabbit_channel_sup_sup}
>      Context:    shutdown_error
>      Reason:     shutdown
>      Offender:   [{pid,<0.23340.3>},
>                   {name,channel_sup},
>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>                   {restart_type,temporary},
>                   {shutdown,infinity},
>                   {child_type,supervisor}]
> 
> 
> =SUPERVISOR REPORT==== 26-May-2012::03:53:48 ===
>      Supervisor: {<0.27559.3>,rabbit_channel_sup_sup}
>      Context:    shutdown_error
>      Reason:     shutdown
>      Offender:   [{pid,<0.27561.3>},
>                   {name,channel_sup},
>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>                   {restart_type,temporary},
>                   {shutdown,infinity},
>                   {child_type,supervisor}]
> 
> 
> =SUPERVISOR REPORT==== 26-May-2012::03:54:22 ===
>      Supervisor: {<0.30115.3>,rabbit_channel_sup_sup}
>      Context:    shutdown_error
>      Reason:     shutdown
>      Offender:   [{pid,<0.30117.3>},
>                   {name,channel_sup},
>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>                   {restart_type,temporary},
>                   {shutdown,infinity},
>                   {child_type,supervisor}]


I've also seen 3 of my instances of rabbitmq crash this evening. Haven't changed anything about the configuration or versions or anything in weeks, but clearly something is going on.  One one of the crashed instances, the startup_err log shows me:


> Crash dump was written to: erl_crash.dump
> eheap_alloc: Cannot allocate 2850821240 bytes of memory (of type "old_heap").
> /usr/sbin/rabbitmq-server: line 42: 31512 Aborted                 /usr/lib/rabbitmq/bin/${SCRIPT} "$@"


I can't find the erl_crash.dump file, however.  Where should that live?

Rabbit seems to startup okay, except that when this happens, I lose all my persistent messages in a queue (issue I mentioned on the list last week, never figured it out, I'm moving away from rabbit for my persistent message needs, this is just too scary an issue for my production data at the moment). Not sure if these warnings in the logs are related to the crashes that I've seen, or the lost messages.

-Will


________________
Will Koffel
CTO, Thumb?
51 E 12th St., 4th Floor
New York, NY 10003
Office: (212) 673-8650
Mobile: (617) 575-WILL
@thumb
www.thumb.it






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120526/1625d593/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Sat May 26 09:09:43 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Sat, 26 May 2012 09:09:43 +0100
Subject: [rabbitmq-discuss] Fwd: Per-Connection Flow Control -- The Case
 Against (Try #2)
In-Reply-To: <CAM8fPiQKDUe0L3NpkLCRyxW51gvWN-Z2uKLMZ+H6Vsk5MeL_2Q@mail.gmail.com>
References: <2af00047-238a-49dc-95da-982dcc32f6a6@googlegroups.com>
	<CAM8fPiQKDUe0L3NpkLCRyxW51gvWN-Z2uKLMZ+H6Vsk5MeL_2Q@mail.gmail.com>
Message-ID: <CAM8fPiTgNurvyrBT2UnsOGVfEQcj+0MtVLvcTeKz6VS1qB-Thg@mail.gmail.com>

Aha, after this bounced, I'm now forwarding to the proper list address
rather than the possibly-bogus google-groups alias.

---------- Forwarded message ----------
From: Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com>
Date: 26 May 2012 09:08
Subject: Re: [rabbitmq-discuss] Per-Connection Flow Control -- The Case
Against (Try #2)
To: Chip Salzenberg <rev.chip at gmail.com>
Cc: rabbitmq-discuss at googlegroups.com


On 25 May 2012 18:57, Chip Salzenberg <rev.chip at gmail.com> wrote:

> This is not acceptable.
>

Why not? I'd be interested to learn what problems this is causing for you.


From will at thumb.it  Sat May 26 16:51:22 2012
From: will at thumb.it (Will Koffel)
Date: Sat, 26 May 2012 11:51:22 -0400
Subject: [rabbitmq-discuss] Regular supervisor shutdown errors?
In-Reply-To: <5A1722C0-DD44-490C-9203-343E9F3E7368@thumb.it>
References: <5A1722C0-DD44-490C-9203-343E9F3E7368@thumb.it>
Message-ID: <A92A97C4-0512-44ED-8AC5-51FCC84E79F1@thumb.it>

I'm wondering these could be running out of memory.  I do see them taking very different amounts of RAM on different machines across my stack.  It's almost as if the large queues that I have (ones in which messages sit for a while before expiring via their TTL) are getting saved in RAM instead of persistent.  But if that were the case, then restarting RabbitMQ would flush them, I presume.  And I can definitely restart with the messages still there, which is what made my confident they were durable and persistent.

For people familiar with the erl_crash.dump, is my example below a simple "out of memory" error that caused the crash?  This is running on EC2, which has no swap space by default, maybe there's a hard crash case here?

-Will

On May 26, 2012, at 12:00 AM, Will Koffel wrote:

> I'm seeing somewhat regular (but not in a tight loop) occurrences of these notices in my rabbit@<host>-sasl.log.
> 
> Sometimes the reason is listed as "noproc", other times as "shutdown".  Are these normal?  If not, how can I debug?
> 
> 
>> =SUPERVISOR REPORT==== 26-May-2012::02:09:34 ===
>>      Supervisor: {<0.549.2188>,
>>                                            rabbit_channel_sup_sup}
>>      Context:    shutdown_error
>>      Reason:     noproc
>>      Offender:   [{pid,<0.551.2188>},
>>                   {name,channel_sup},
>>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>>                   {restart_type,temporary},
>>                   {shutdown,infinity},
>>                   {child_type,supervisor}]
>> 
>> 
>> =SUPERVISOR REPORT==== 26-May-2012::02:15:52 ===
>>      Supervisor: {<0.31254.2188>,
>>                                            rabbit_channel_sup_sup}
>>      Context:    shutdown_error
>>      Reason:     noproc
>>      Offender:   [{pid,<0.31256.2188>},
>>                   {name,channel_sup},
>>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>>                   {restart_type,temporary},
>>                   {shutdown,infinity},
>>                   {child_type,supervisor}]
>> 
>> 
>> =SUPERVISOR REPORT==== 26-May-2012::02:18:20 ===
>>      Supervisor: {<0.15873.2189>,
>>                                            rabbit_channel_sup_sup}
>>      Context:    shutdown_error
>>      Reason:     shutdown
>>      Offender:   [{pid,<0.15875.2189>},
>>                   {name,channel_sup},
>>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>>                   {restart_type,temporary},
>>                   {shutdown,infinity},
>>                   {child_type,supervisor}]
>> 
>> 
>> =SUPERVISOR REPORT==== 26-May-2012::03:52:54 ===
>>      Supervisor: {<0.23330.3>,rabbit_channel_sup_sup}
>>      Context:    shutdown_error
>>      Reason:     shutdown
>>      Offender:   [{pid,<0.23340.3>},
>>                   {name,channel_sup},
>>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>>                   {restart_type,temporary},
>>                   {shutdown,infinity},
>>                   {child_type,supervisor}]
>> 
>> 
>> =SUPERVISOR REPORT==== 26-May-2012::03:53:48 ===
>>      Supervisor: {<0.27559.3>,rabbit_channel_sup_sup}
>>      Context:    shutdown_error
>>      Reason:     shutdown
>>      Offender:   [{pid,<0.27561.3>},
>>                   {name,channel_sup},
>>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>>                   {restart_type,temporary},
>>                   {shutdown,infinity},
>>                   {child_type,supervisor}]
>> 
>> 
>> =SUPERVISOR REPORT==== 26-May-2012::03:54:22 ===
>>      Supervisor: {<0.30115.3>,rabbit_channel_sup_sup}
>>      Context:    shutdown_error
>>      Reason:     shutdown
>>      Offender:   [{pid,<0.30117.3>},
>>                   {name,channel_sup},
>>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>>                   {restart_type,temporary},
>>                   {shutdown,infinity},
>>                   {child_type,supervisor}]
> 
> 
> I've also seen 3 of my instances of rabbitmq crash this evening. Haven't changed anything about the configuration or versions or anything in weeks, but clearly something is going on.  One one of the crashed instances, the startup_err log shows me:
> 
> 
>> Crash dump was written to: erl_crash.dump
>> eheap_alloc: Cannot allocate 2850821240 bytes of memory (of type "old_heap").
>> /usr/sbin/rabbitmq-server: line 42: 31512 Aborted                 /usr/lib/rabbitmq/bin/${SCRIPT} "$@"
> 
> 
> I can't find the erl_crash.dump file, however.  Where should that live?
> 
> Rabbit seems to startup okay, except that when this happens, I lose all my persistent messages in a queue (issue I mentioned on the list last week, never figured it out, I'm moving away from rabbit for my persistent message needs, this is just too scary an issue for my production data at the moment). Not sure if these warnings in the logs are related to the crashes that I've seen, or the lost messages.
> 
> -Will
> 
> 
> ________________
> Will Koffel
> CTO, Thumb?
> 51 E 12th St., 4th Floor
> New York, NY 10003
> Office: (212) 673-8650
> Mobile: (617) 575-WILL
> @thumb
> www.thumb.it
> 
> 
> 
> 
> 
> 

________________
Will Koffel
CTO, Thumb?
51 E 12th St., 4th Floor
New York, NY 10003
Office: (212) 673-8650
Mobile: (617) 575-WILL
@thumb
www.thumb.it






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120526/9914e949/attachment.htm>

From matthias at rabbitmq.com  Sat May 26 18:14:14 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 26 May 2012 18:14:14 +0100
Subject: [rabbitmq-discuss] Regular supervisor shutdown errors?
In-Reply-To: <A92A97C4-0512-44ED-8AC5-51FCC84E79F1@thumb.it>
References: <5A1722C0-DD44-490C-9203-343E9F3E7368@thumb.it>
	<A92A97C4-0512-44ED-8AC5-51FCC84E79F1@thumb.it>
Message-ID: <4FC10F66.402@rabbitmq.com>

Will,

On 26/05/12 16:51, Will Koffel wrote:
> I'm wondering these could be running out of memory.

Indeed. Have you upgraded to 2.8.2 yet? There were several memory leaks 
in 2.8.1 (and earlier) that we fixed in 2.8.2.

As for the rabbit_channel_sup_sup errors in the sasl log, these are 
harmless and can occur when connections are terminated abruptly rather 
than via the proper AMQP closing handshake.

Regards,

Matthias.

From videlalvaro at gmail.com  Sun May 27 12:32:38 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 27 May 2012 13:32:38 +0200
Subject: [rabbitmq-discuss] RabbitMQ running on a Beaglebone
Message-ID: <6E76F6802AD141EB8B83749A90526ACB@gmail.com>

Hi, 

I wanted to share this blogpost I found about a guy running RabbitMQ 2.8.2 on a Beaglebone:

http://toddbot.blogspot.jp/2012/05/beaglebone-and-rabbitmq-and.html

Cheers,

Alvaro 

-- 
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120527/adda0060/attachment.htm>

From jamesdear at gmail.com  Sun May 27 21:27:34 2012
From: jamesdear at gmail.com (James Dear)
Date: Sun, 27 May 2012 21:27:34 +0100
Subject: [rabbitmq-discuss] Pika write buffer problem
Message-ID: <CAEo4zpeFWtvw-FPGU+CM_ZBFHxUBMHx-yk--KCpAk9XL_vYEdg@mail.gmail.com>

Hi,

I'm having trouble getting simple examples of basic_publish to work due to
the write buffer being exceeded. If I use the demo_send code from
here<http://pika.github.com/examples.html>,
I only manage to send 5 messages before getting write buffer exceeded
problems. Here's my output:

[INFO     2012-05-27 20:30:16,863  #5451] Connecting fd 3 to 127.0.0.1:5672
[INFO     2012-05-27 20:30:17,869  #5451] demo_send: Connected to RabbitMQ
[INFO     2012-05-27 20:30:17,872  #5451] demo_send: Received our Channel
[INFO     2012-05-27 20:30:17,882  #5451] demo_send: Queue Declared
[INFO     2012-05-27 20:30:17,883  #5451] Sending: Hello World #0:
1338147017.88308692
[INFO     2012-05-27 20:30:17,883  #5451] Sending: Hello World #1:
1338147017.88367391
[INFO     2012-05-27 20:30:17,884  #5451] Sending: Hello World #2:
1338147017.88425899
[INFO     2012-05-27 20:30:17,884  #5451] Sending: Hello World #3:
1338147017.88472700
[INFO     2012-05-27 20:30:17,885  #5451] Sending: Hello World #4:
1338147017.88527107
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded
warning threshold at 413 bytes and an estimated 10 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded
warning threshold at 447 bytes and an estimated 11 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded
warning threshold at 490 bytes and an estimated 12 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
[INFO     2012-05-27 20:30:17,887  #5451] Sending: Hello World #5:
1338147017.88733912
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded
warning threshold at 511 bytes and an estimated 13 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded
warning threshold at 545 bytes and an estimated 14 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded
warning threshold at 588 bytes and an estimated 15 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))

etc etc

On the other hand, everything works fine with pika twisted and the msgs do
end up on RabbitMQ with pika twisted, so it doesn't seem to be a
restriction to do with RabbitMQ per se.

I've created gists <https://gist.github.com/2815757> for the pika native
code which doesn't work and the pika twisted code that does work.

If anyone could help, I would greatly appreciate it.

James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120527/ca5a7c9f/attachment.htm>

From gmr at myyearbook.com  Sun May 27 22:01:27 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sun, 27 May 2012 17:01:27 -0400
Subject: [rabbitmq-discuss] Pika write buffer problem
In-Reply-To: <CAEo4zpeFWtvw-FPGU+CM_ZBFHxUBMHx-yk--KCpAk9XL_vYEdg@mail.gmail.com>
References: <CAEo4zpeFWtvw-FPGU+CM_ZBFHxUBMHx-yk--KCpAk9XL_vYEdg@mail.gmail.com>
Message-ID: <E2B2F7CC643E46D29CCC94D443C3B84A@myyearbook.com>

The warnings are just warnings, letting you know that the writes to rabbitMQ are not happening as quickly as you'd like them to do. Are you saying they are not actually getting into RabbitMQ? 


On Sunday, May 27, 2012 at 4:27 PM, James Dear wrote:

> Hi,
> 
> I'm having trouble getting simple examples of basic_publish to work due to the write buffer being exceeded. If I use the demo_send code from here (http://pika.github.com/examples.html), I only manage to send 5 messages before getting write buffer exceeded problems. Here's my output: 
> 
> [INFO     2012-05-27 20:30:16,863  #5451] Connecting fd 3 to 127.0.0.1:5672 (http://127.0.0.1:5672)
> [INFO     2012-05-27 20:30:17,869  #5451] demo_send: Connected to RabbitMQ
> [INFO     2012-05-27 20:30:17,872  #5451] demo_send: Received our Channel
> [INFO     2012-05-27 20:30:17,882  #5451] demo_send: Queue Declared
> [INFO     2012-05-27 20:30:17,883  #5451] Sending: Hello World #0: 1338147017.88308692
> [INFO     2012-05-27 20:30:17,883  #5451] Sending: Hello World #1: 1338147017.88367391
> [INFO     2012-05-27 20:30:17,884  #5451] Sending: Hello World #2: 1338147017.88425899
> [INFO     2012-05-27 20:30:17,884  #5451] Sending: Hello World #3: 1338147017.88472700
> [INFO     2012-05-27 20:30:17,885  #5451] Sending: Hello World #4: 1338147017.88527107
> /..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 413 bytes and an estimated 10 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> /..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 447 bytes and an estimated 11 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> /..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 490 bytes and an estimated 12 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> [INFO     2012-05-27 20:30:17,887  #5451] Sending: Hello World #5: 1338147017.88733912
> /..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 511 bytes and an estimated 13 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> /..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 545 bytes and an estimated 14 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> /..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 588 bytes and an estimated 15 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> 
> 
> etc etc
> 
> On the other hand, everything works fine with pika twisted and the msgs do end up on RabbitMQ with pika twisted, so it doesn't seem to be a restriction to do with RabbitMQ per se. 
> 
> I've created gists (https://gist.github.com/2815757) for the pika native code which doesn't work and the pika twisted code that does work.
> 
> If anyone could help, I would greatly appreciate it. 
> 
> James 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120527/04270548/attachment.htm>

From rgilland1966 at gmail.com  Sun May 27 23:53:37 2012
From: rgilland1966 at gmail.com (Robert Gilland)
Date: Sun, 27 May 2012 15:53:37 -0700 (PDT)
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of a
	burst
In-Reply-To: <226517f0-2ad1-4583-8a63-4c65b4bb247d@googlegroups.com>
References: <226517f0-2ad1-4583-8a63-4c65b4bb247d@googlegroups.com>
Message-ID: <6c24cdeb-2f03-4fb5-b631-d355f663cd02@oo8g2000pbc.googlegroups.com>

This would explain what I am seeing at my sites.
Nothing went through until I sent another message in.
This seems to be a new bug in 2.8.1 we did not have the problem in
2.61.

Kind Regards,

Robert.

From matthias at rabbitmq.com  Mon May 28 00:58:23 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 May 2012 00:58:23 +0100
Subject: [rabbitmq-discuss] STOMP adapter lose the last message of a
	burst
In-Reply-To: <6c24cdeb-2f03-4fb5-b631-d355f663cd02@oo8g2000pbc.googlegroups.com>
References: <226517f0-2ad1-4583-8a63-4c65b4bb247d@googlegroups.com>
	<6c24cdeb-2f03-4fb5-b631-d355f663cd02@oo8g2000pbc.googlegroups.com>
Message-ID: <4FC2BF9F.2060001@rabbitmq.com>

Robert,

On 27/05/12 23:53, Robert Gilland wrote:
> This would explain what I am seeing at my sites.
> Nothing went through until I sent another message in.
> This seems to be a new bug in 2.8.1 we did not have the problem in
> 2.61.

The bug has been around since 2.4.0 but was only triggered by memory 
alarms, which in most rabbit installation are infrequent / absent. The 
introduction of credit-based flow control in 2.8.0 opened up a new and 
much more common vector for triggering the bug, so that's why we are 
seeing reports only now.

Regards,

Matthias

From Barnea at 3i-mind.com  Mon May 28 08:09:23 2012
From: Barnea at 3i-mind.com (Lior Barnea)
Date: Mon, 28 May 2012 00:09:23 -0700
Subject: [rabbitmq-discuss] Windows service recovery
In-Reply-To: <4FBF9E30.9040209@rabbitmq.com>
References: <C3A760638FE7B343972DD905011226E3058AF1472D@GZSMSCCR03.sms1.local>
	<4FBF9E30.9040209@rabbitmq.com>
Message-ID: <C3A760638FE7B343972DD905011226E3058AF14B21@GZSMSCCR03.sms1.local>

Hi Emile,

This is part of the recovery testing we are conducting, this is not a real issue that we encountered but one produced on purpose...

Still, I would have expected that erlsrv could detected that erl.exe is already up when windows restarts it and re-attach to it instead of failing...

Best regards,
Lior.

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: Friday, May 25, 2012 17:59
To: Lior Barnea
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows service recovery

Hi Lior,

On 23/05/12 15:37, Lior Barnea wrote:
> Killing erlsvr.exe does not stop erl.exe (meaning rabbitMQ still
> running) but does alert windows that then tries to restart erlsvr.exe
> 
> When erlsvr.exe is started again, it tries to spawn erl.exe again and 
> fails because it is already running, failing erlsvr.exe completely, 
> recovery failed.

I can confirm that your description is accurate. erlsrv acts as an interface between the Windows service management and the Erlang process.
It can communicate failures of the broker to Windows but it does not cope if erlsrv itself fails. The design is presumably based on the estimate that the broker is far more likely to fail.

Are you exploring a hypothetical concern or is this a real issue that is preventing you from deploying and using the broker?


-Emile





From tim at rabbitmq.com  Mon May 28 08:13:36 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 28 May 2012 08:13:36 +0100
Subject: [rabbitmq-discuss] Windows service recovery
In-Reply-To: <C3A760638FE7B343972DD905011226E3058AF14B21@GZSMSCCR03.sms1.local>
References: <C3A760638FE7B343972DD905011226E3058AF1472D@GZSMSCCR03.sms1.local>
	<4FBF9E30.9040209@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14B21@GZSMSCCR03.sms1.local>
Message-ID: <4FC325A0.4080309@rabbitmq.com>

On 28/05/12 08:09, Lior Barnea wrote:
> Hi Emile,
>
> This is part of the recovery testing we are conducting, this is not a real issue that we encountered but one produced on purpose...
>
> Still, I would have expected that erlsrv could detected that erl.exe is already up when windows restarts it and re-attach to it instead of failing...

Well, the rabbit windows service script does check to see whether a node 
with the same name is already up and running. If this is the case, it 
exits/fails. I'm not really sure what 're-attach' would look like in 
practice - what would we expect erlsrv to do in this case exactly?

Cheers,
Tim

From support at cloudwebdns.com  Mon May 28 08:48:27 2012
From: support at cloudwebdns.com (Cloud DNS)
Date: Mon, 28 May 2012 15:48:27 +0800
Subject: [rabbitmq-discuss] is the default administrator account too weak?
Message-ID: <4FC32DCB.1090605@cloudwebdns.com>

Hello,

Both the default administrator account and password is guest.
Is it too weak?
If people scan that I have been run Rabbitmq, could he connect and 
access me with that account?

Thanks.


From Barnea at 3i-mind.com  Mon May 28 09:02:33 2012
From: Barnea at 3i-mind.com (Lior Barnea)
Date: Mon, 28 May 2012 01:02:33 -0700
Subject: [rabbitmq-discuss] Windows service recovery
In-Reply-To: <4FC325A0.4080309@rabbitmq.com>
References: <C3A760638FE7B343972DD905011226E3058AF1472D@GZSMSCCR03.sms1.local>
	<4FBF9E30.9040209@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14B21@GZSMSCCR03.sms1.local>
	<4FC325A0.4080309@rabbitmq.com>
Message-ID: <C3A760638FE7B343972DD905011226E3058AF14B5F@GZSMSCCR03.sms1.local>

I want it to start successfully and monitor the existing rabbitMQ process, exiting/failing means no watchdog for the "next real" rabbitMQ failure.

- Lior

-----Original Message-----
From: Tim Watson [mailto:tim at rabbitmq.com] 
Sent: Monday, May 28, 2012 10:14
To: Lior Barnea
Cc: Emile Joubert; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows service recovery

On 28/05/12 08:09, Lior Barnea wrote:
> Hi Emile,
>
> This is part of the recovery testing we are conducting, this is not a real issue that we encountered but one produced on purpose...
>
> Still, I would have expected that erlsrv could detected that erl.exe is already up when windows restarts it and re-attach to it instead of failing...

Well, the rabbit windows service script does check to see whether a node with the same name is already up and running. If this is the case, it exits/fails. I'm not really sure what 're-attach' would look like in practice - what would we expect erlsrv to do in this case exactly?

Cheers,
Tim



From simon at rabbitmq.com  Mon May 28 10:32:11 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 28 May 2012 10:32:11 +0100
Subject: [rabbitmq-discuss] is the default administrator account too
	weak?
In-Reply-To: <4FC32DCB.1090605@cloudwebdns.com>
References: <4FC32DCB.1090605@cloudwebdns.com>
Message-ID: <4FC3461B.7080709@rabbitmq.com>

On 28/05/12 08:48, Cloud DNS wrote:
> Both the default administrator account and password is guest.
> Is it too weak?

Well, if you are going to have a public-facing server, definitely! 
guest/guest is just intended to get you started, if you are going to 
deploy anywhere that is not 100% trusted you should change it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From support at cloudwebdns.com  Mon May 28 10:37:52 2012
From: support at cloudwebdns.com (Cloud DNS)
Date: Mon, 28 May 2012 17:37:52 +0800
Subject: [rabbitmq-discuss] is the default administrator account too
	weak?
In-Reply-To: <4FC3461B.7080709@rabbitmq.com>
References: <4FC32DCB.1090605@cloudwebdns.com> <4FC3461B.7080709@rabbitmq.com>
Message-ID: <4FC34770.6030805@cloudwebdns.com>

What I think is, may you consider to setup the account stuff like mysql?
With mysql, the root account can login only from localhost by default.

Thanks.


? 2012-5-28 17:32, Simon MacMullen ??:
> On 28/05/12 08:48, Cloud DNS wrote:
>> Both the default administrator account and password is guest.
>> Is it too weak?
>
> Well, if you are going to have a public-facing server, definitely! 
> guest/guest is just intended to get you started, if you are going to 
> deploy anywhere that is not 100% trusted you should change it. 



From simon at rabbitmq.com  Mon May 28 11:09:34 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 28 May 2012 11:09:34 +0100
Subject: [rabbitmq-discuss] Why am I being censored?
In-Reply-To: <14753BD49AE74FD591C1E2571CC93944@gmail.com>
References: <248f08cc-fc4b-4a89-827e-8e74e7cf5b38@googlegroups.com>
	<14753BD49AE74FD591C1E2571CC93944@gmail.com>
Message-ID: <4FC34EDE.6090005@rabbitmq.com>

On 25/05/12 18:59, Alvaro Videla wrote:
> Have you sent your emails to this list?
>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> I see you are using google groups instead.

This, absolutely. We much prefer people use the RabbitMQ mailing list; 
although the google group is supposed to mirror it it sometimes seems flaky.

Also, have you seen my response here?

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/020323.html

Summary: flow control is unmasking another problem. Flow control is not 
the enemy.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Mon May 28 11:55:37 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 28 May 2012 11:55:37 +0100
Subject: [rabbitmq-discuss] stomp+ssl message send works,
	receive hangs after around 200-300 messages
In-Reply-To: <4FC31D94.5060600@gmx.net>
References: <jp7ltn$rn3$1@dough.gmane.org>
	<86B07026-4324-4BB2-B008-DBC605C03E33@rabbitmq.com>
	<4FBBD704.7060305@gmx.net>
	<BE7A82AB-B2F9-4E0B-80BC-F7651BD5F30B@rabbitmq.com>
	<4FBE253B.3020009@gmx.net>
	<F8689F9E-EC1C-403F-8296-5D4D6F15C8ED@rabbitmq.com>
	<4FC31D94.5060600@gmx.net>
Message-ID: <4672B76A-FB65-492D-8E45-BF3D4C021036@rabbitmq.com>

(Posting on Rabbit-Discuss for tracking.)

On 28 May 2012, at 07:39, Michael Justin wrote: 
> Thank you for this important information, as I have accidentally found a
> problem in one users code where messages are not ACKed where they should
> have been. (The code uses transacted sessions).

Aha!  Serendipitous.

Could you try reverting to prefetch=1 with this user's code fixed? If it
works, it would confirm our understanding of your symptoms, and it would
> not< be related to our own discovered bug.

Thanks,
Steve Powell  (a happy bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

On 28 May 2012, at 07:39, Michael Justin wrote:

> Am 24.05.2012 18:08, Steve Powell wrote:
>> Michael,
>> 
>> Thank you for the further information, this has got us a bit puzzled.
>> 
>> It was a long shot, and my colleagues don't think that ACKs ought to
>> have been blocked, but I'm glad you at least have a work-around. Are the
>> SUBSCRIBER STOMP clients SENDing anything (or writing other things) on
>> the same connection, by any chance?
> 
> In my local tests there was one connection for sending messages and a separate connection for receiving them, the receiver used client side acknowledgment so there was the ACK frame per messages sent, no other SEND frames on this connection.
> 
> 
>>> Setting prefetch-count=2 fixed it, many thanks ! Could this also affect
>>> transactions, where a commit is sent instead of ack frames?
>> 
>> If it is the problem I think it is, then yes, but your question makes me
>> wonder if you remember that ACKs are transactional, not the consuming of
>> the messages, so you should not think of commit as doing an implicit
>> ACK: it doesn't. In particular, rollback does not re-queue un-acked
>> messages. Rollback will 'undo' any acknowledgements made in this
>> transaction (and, in RabbitMQ, any rejects, too). I'm sure you know
>> this, but your use of the word 'instead' got me worried. :-)
> 
> Thank you for this important information, as I have accidentally found a problem in one users code where messages are not ACKed where they should have been. (The code uses transacted sessions).
> 
> Regards
> -- 
> Michael Justin
> habarisoft - Enterprise Messaging Software for Delphi
> http://www.habarisoft.com/


From tim at rabbitmq.com  Mon May 28 13:14:23 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 28 May 2012 13:14:23 +0100
Subject: [rabbitmq-discuss] Windows service recovery
In-Reply-To: <C3A760638FE7B343972DD905011226E3058AF14B5F@GZSMSCCR03.sms1.local>
References: <C3A760638FE7B343972DD905011226E3058AF1472D@GZSMSCCR03.sms1.local>
	<4FBF9E30.9040209@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14B21@GZSMSCCR03.sms1.local>
	<4FC325A0.4080309@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14B5F@GZSMSCCR03.sms1.local>
Message-ID: <4FC36C1F.8080800@rabbitmq.com>

On 28/05/12 09:02, Lior Barnea wrote:
> I want it to start successfully and monitor the existing rabbitMQ process, exiting/failing means no watchdog for the "next real" rabbitMQ failure.

Perhaps I'm wrong, but my reading of erlsrv is that it *is* the service 
instance, so I'm not sure how you're going to get around this. The 
question I've got is, in what scenario do you foresee the erlsrv process 
exiting without taking the erl.exe process down with it, apart from one 
in which you're explicitly killing erlsrv.exe yourself?


From josh at gebaschtel.ch  Mon May 28 13:30:11 2012
From: josh at gebaschtel.ch (Josh Geisser)
Date: Mon, 28 May 2012 12:30:11 +0000
Subject: [rabbitmq-discuss] Pika write buffer problem
In-Reply-To: <E2B2F7CC643E46D29CCC94D443C3B84A@myyearbook.com>
References: <CAEo4zpeFWtvw-FPGU+CM_ZBFHxUBMHx-yk--KCpAk9XL_vYEdg@mail.gmail.com>
	<E2B2F7CC643E46D29CCC94D443C3B84A@myyearbook.com>
Message-ID: <B8B68C3D41791846910BA4C7AF61D25B0822D7@ganymede.gebaschtel.bnet>

I had the same issue, depending on the meg size and network layout it can publish like 1?000msg, and then pika crashes with publishing the like 10?000th message. It will continue to publish messages (no matter whether actually sent to the broker or not) until it hits the end of the buffer.

In order to avoid this either do not publish too fast, implement the TCP_Backpressure CB to let the buffer drain, or use transactional channels which seems to avoid this issue at all.

Cheers
josh

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gavin M. Roy
Sent: Sonntag, 27. Mai 2012 23:01
To: James Dear
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Pika write buffer problem

The warnings are just warnings, letting you know that the writes to rabbitMQ are not happening as quickly as you'd like them to do. Are you saying they are not actually getting into RabbitMQ?

On Sunday, May 27, 2012 at 4:27 PM, James Dear wrote:
Hi,

I'm having trouble getting simple examples of basic_publish to work due to the write buffer being exceeded. If I use the demo_send code from here<http://pika.github.com/examples.html>, I only manage to send 5 messages before getting write buffer exceeded problems. Here's my output:

[INFO     2012-05-27 20:30:16,863  #5451] Connecting fd 3 to 127.0.0.1:5672<http://127.0.0.1:5672>
[INFO     2012-05-27 20:30:17,869  #5451] demo_send: Connected to RabbitMQ
[INFO     2012-05-27 20:30:17,872  #5451] demo_send: Received our Channel
[INFO     2012-05-27 20:30:17,882  #5451] demo_send: Queue Declared
[INFO     2012-05-27 20:30:17,883  #5451] Sending: Hello World #0: 1338147017.88308692
[INFO     2012-05-27 20:30:17,883  #5451] Sending: Hello World #1: 1338147017.88367391
[INFO     2012-05-27 20:30:17,884  #5451] Sending: Hello World #2: 1338147017.88425899
[INFO     2012-05-27 20:30:17,884  #5451] Sending: Hello World #3: 1338147017.88472700
[INFO     2012-05-27 20:30:17,885  #5451] Sending: Hello World #4: 1338147017.88527107
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 413 bytes and an estimated 10 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 447 bytes and an estimated 11 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 490 bytes and an estimated 12 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
[INFO     2012-05-27 20:30:17,887  #5451] Sending: Hello World #5: 1338147017.88733912
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 511 bytes and an estimated 13 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 545 bytes and an estimated 14 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
/..snip../pika/connection.py:766: UserWarning: Pika: Write buffer exceeded warning threshold at 588 bytes and an estimated 15 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))

etc etc

On the other hand, everything works fine with pika twisted and the msgs do end up on RabbitMQ with pika twisted, so it doesn't seem to be a restriction to do with RabbitMQ per se.

I've created gists<https://gist.github.com/2815757> for the pika native code which doesn't work and the pika twisted code that does work.

If anyone could help, I would greatly appreciate it.

James
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




--

----

ASG at hnet
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120528/ff352cf8/attachment.htm>

From Barnea at 3i-mind.com  Mon May 28 13:38:58 2012
From: Barnea at 3i-mind.com (Lior Barnea)
Date: Mon, 28 May 2012 05:38:58 -0700
Subject: [rabbitmq-discuss] Windows service recovery
In-Reply-To: <4FC36C1F.8080800@rabbitmq.com>
References: <C3A760638FE7B343972DD905011226E3058AF1472D@GZSMSCCR03.sms1.local>
	<4FBF9E30.9040209@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14B21@GZSMSCCR03.sms1.local>
	<4FC325A0.4080309@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14B5F@GZSMSCCR03.sms1.local>
	<4FC36C1F.8080800@rabbitmq.com>
Message-ID: <C3A760638FE7B343972DD905011226E3058AF14C77@GZSMSCCR03.sms1.local>

Erlsrv is the service instance, acting as a watchdog (spawning it on startup) for erl.exe which runs rabbitMQ.

As I said before, the scenario in which erlsvr is going down without erl.exe is currently hypothetic but its behavior after its restarting because I killed it is wrong.

For my QA team: "Its unlikely that it will happens" equals "It can happen" :)

- Lior

-----Original Message-----
From: Tim Watson [mailto:tim at rabbitmq.com] 
Sent: Monday, May 28, 2012 15:14
To: Lior Barnea
Cc: Emile Joubert; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows service recovery

On 28/05/12 09:02, Lior Barnea wrote:
> I want it to start successfully and monitor the existing rabbitMQ process, exiting/failing means no watchdog for the "next real" rabbitMQ failure.

Perhaps I'm wrong, but my reading of erlsrv is that it *is* the service instance, so I'm not sure how you're going to get around this. The question I've got is, in what scenario do you foresee the erlsrv process exiting without taking the erl.exe process down with it, apart from one in which you're explicitly killing erlsrv.exe yourself?




From tim at rabbitmq.com  Mon May 28 13:39:05 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 28 May 2012 13:39:05 +0100
Subject: [rabbitmq-discuss] Windows service recovery
In-Reply-To: <C3A760638FE7B343972DD905011226E3058AF14C77@GZSMSCCR03.sms1.local>
References: <C3A760638FE7B343972DD905011226E3058AF1472D@GZSMSCCR03.sms1.local>
	<4FBF9E30.9040209@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14B21@GZSMSCCR03.sms1.local>
	<4FC325A0.4080309@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14B5F@GZSMSCCR03.sms1.local>
	<4FC36C1F.8080800@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14C77@GZSMSCCR03.sms1.local>
Message-ID: <4FC371E9.708@rabbitmq.com>

On 28/05/12 13:38, Lior Barnea wrote:
> Erlsrv is the service instance, acting as a watchdog (spawning it on startup) for erl.exe which runs rabbitMQ.
>
> As I said before, the scenario in which erlsvr is going down without erl.exe is currently hypothetic but its behavior after its restarting because I killed it is wrong.
>
> For my QA team: "Its unlikely that it will happens" equals "It can happen" :)

Yeah, you're right on both counts. The behaviour is wrong and 'it can 
happen' in theory. This question now needs to move over to the 
erlang-questions mailing list and get raised with the OTP team, as 
they're responsible for erlsrv and should be able to get it fixed.

 From a brief glance at the (erlsrv) code, my reading of it is that 
there is no link between erlsrv and erl.exe other than the use of the 
fifo pipes provided by to_erl, used to handle interactions (such as shut 
down). Based on this reading, it ought to be 'possible' to verify that 
an instance is still up, but I'm a little unclear on how you would 
confirm that the said program was the one that erlsrv 'ought' to be 
monitoring.

From gregrice at gmail.com  Mon May 28 14:28:49 2012
From: gregrice at gmail.com (Greg Rice)
Date: Mon, 28 May 2012 06:28:49 -0700
Subject: [rabbitmq-discuss] Throttling messages sent out upon reconnect
Message-ID: <CAFuUQDt96+fiUWyZ6wFfQLzX=V1xZeWdoyfDu-3vCxAHptM2tA@mail.gmail.com>

Hey folks,

I'm using the Bunny AMQP library to publish messages to a queue
cluster. If the cluster goes down, or the network drops out, messages
spool up on the publisher side. When network connectivity is restored,
those spooled messages all go out at once, hiking up CPU load on the
publisher's end.

I'd like to throttle publishing so that even on reconnect, publishing
doesn't exceed a certain rate of messages per second. Either that, or,
less ideally, I'd like to limit the amount of messages spooled so that
no more than, say, 100 messages can back up while the network is down.

Where should I be looking for a solution to this problem?

Thanks,
Greg Rice
Systems Engineer, MobiTV

From Barnea at 3i-mind.com  Mon May 28 14:46:24 2012
From: Barnea at 3i-mind.com (Lior Barnea)
Date: Mon, 28 May 2012 15:46:24 +0200
Subject: [rabbitmq-discuss] Windows service recovery
In-Reply-To: <4FC371E9.708@rabbitmq.com>
References: <C3A760638FE7B343972DD905011226E3058AF1472D@GZSMSCCR03.sms1.local>
	<4FBF9E30.9040209@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14B21@GZSMSCCR03.sms1.local>
	<4FC325A0.4080309@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14B5F@GZSMSCCR03.sms1.local>
	<4FC36C1F.8080800@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14C77@GZSMSCCR03.sms1.local>
	<4FC371E9.708@rabbitmq.com>
Message-ID: <C3A760638FE7B343972DD905011226E3058AF14CB4@GZSMSCCR03.sms1.local>

"Based on this reading, it ought to be 'possible' to verify that an instance is still up, but I'm a little unclear on how you would confirm that the said program was the one that erlsrv 'ought' to be monitoring. "

This is even worse, cause if I run some other erl process and both erlsrv process and rabbitMQ's erl process goes down it is possible that erlsrv will fail to spawn rabbitMQ for no reason...

A possible solution - erlsrv will save (On disk for example) the PID the erl.exe it needs to monitor and on startup, if there is an erl.exe with the same PID, it is the one.

-----Original Message-----
From: Tim Watson [mailto:tim at rabbitmq.com] 
Sent: Monday, May 28, 2012 15:39
To: Lior Barnea
Cc: Emile Joubert; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Windows service recovery

On 28/05/12 13:38, Lior Barnea wrote:
> Erlsrv is the service instance, acting as a watchdog (spawning it on startup) for erl.exe which runs rabbitMQ.
>
> As I said before, the scenario in which erlsvr is going down without erl.exe is currently hypothetic but its behavior after its restarting because I killed it is wrong.
>
> For my QA team: "Its unlikely that it will happens" equals "It can 
> happen" :)

Yeah, you're right on both counts. The behaviour is wrong and 'it can happen' in theory. This question now needs to move over to the erlang-questions mailing list and get raised with the OTP team, as they're responsible for erlsrv and should be able to get it fixed.

 From a brief glance at the (erlsrv) code, my reading of it is that there is no link between erlsrv and erl.exe other than the use of the fifo pipes provided by to_erl, used to handle interactions (such as shut down). Based on this reading, it ought to be 'possible' to verify that an instance is still up, but I'm a little unclear on how you would confirm that the said program was the one that erlsrv 'ought' to be monitoring.



From watson.timothy at gmail.com  Mon May 28 14:51:54 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 28 May 2012 14:51:54 +0100
Subject: [rabbitmq-discuss] Windows service recovery
In-Reply-To: <C3A760638FE7B343972DD905011226E3058AF14CB4@GZSMSCCR03.sms1.local>
References: <C3A760638FE7B343972DD905011226E3058AF1472D@GZSMSCCR03.sms1.local>
	<4FBF9E30.9040209@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14B21@GZSMSCCR03.sms1.local>
	<4FC325A0.4080309@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14B5F@GZSMSCCR03.sms1.local>
	<4FC36C1F.8080800@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14C77@GZSMSCCR03.sms1.local>
	<4FC371E9.708@rabbitmq.com>
	<C3A760638FE7B343972DD905011226E3058AF14CB4@GZSMSCCR03.sms1.local>
Message-ID: <96EE5EF0-DDD0-4CD1-B368-675D9A13D619@rabbitmq.com>


On 28 May 2012, at 14:46, Lior Barnea wrote:

> "Based on this reading, it ought to be 'possible' to verify that an instance is still up, but I'm a little unclear on how you would confirm that the said program was the one that erlsrv 'ought' to be monitoring. "
> 
> This is even worse, cause if I run some other erl process and both erlsrv process and rabbitMQ's erl process goes down it is possible that erlsrv will fail to spawn rabbitMQ for no reason...
> 

Yes well that's just my reading of the erlsrv code. Today, erlsrv simply won't start, which is a different problem altogether.

> A possible solution - erlsrv will save (On disk for example) the PID the erl.exe it needs to monitor and on startup, if there is an erl.exe with the same PID, it is the one.

That's pretty much what standalone rabbit (rabbit-server) does now on unix, although the pid is actually created by the wrapper script which in turn runs `exec erl <....etc>`. This doesn't happen in the windows batch files, not am I aware of a mechanism for doing so in such scripts, so the behaviour you're describing for windows services clearly belongs in erlsrv.

Needless to say, you're going to need to have some conversations on the erlang-questions mailing list about this one, as we're not responsible for developing or maintaining erlsrv at all.

Cheers,
Tim

> 
> -----Original Message-----
> From: Tim Watson [mailto:tim at rabbitmq.com] 
> Sent: Monday, May 28, 2012 15:39
> To: Lior Barnea
> Cc: Emile Joubert; rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Windows service recovery
> 
> On 28/05/12 13:38, Lior Barnea wrote:
>> Erlsrv is the service instance, acting as a watchdog (spawning it on startup) for erl.exe which runs rabbitMQ.
>> 
>> As I said before, the scenario in which erlsvr is going down without erl.exe is currently hypothetic but its behavior after its restarting because I killed it is wrong.
>> 
>> For my QA team: "Its unlikely that it will happens" equals "It can 
>> happen" :)
> 
> Yeah, you're right on both counts. The behaviour is wrong and 'it can happen' in theory. This question now needs to move over to the erlang-questions mailing list and get raised with the OTP team, as they're responsible for erlsrv and should be able to get it fixed.
> 
> From a brief glance at the (erlsrv) code, my reading of it is that there is no link between erlsrv and erl.exe other than the use of the fifo pipes provided by to_erl, used to handle interactions (such as shut down). Based on this reading, it ought to be 'possible' to verify that an instance is still up, but I'm a little unclear on how you would confirm that the said program was the one that erlsrv 'ought' to be monitoring.
> 
> 


From michael.justin at gmx.net  Mon May 28 19:50:40 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Mon, 28 May 2012 20:50:40 +0200
Subject: [rabbitmq-discuss] How to set fast expiration for messages or
	destinations (STOMP 1.0)?
Message-ID: <jq0he5$ium$1@dough.gmane.org>

For a simple replacement of the STOMP 1.1 heartbeat feature, I would 
like to use fast-expiring messages or destinations which do not keep 
messages for a long time. Is this possible with the RabbitMQ 
configuration file, so that it will also have an effect on STOMP messages?

Many thanks in advance
Michael Justin


From simon at rabbitmq.com  Mon May 28 21:52:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 28 May 2012 21:52:55 +0100
Subject: [rabbitmq-discuss] How to set fast expiration for messages or
 destinations (STOMP 1.0)?
In-Reply-To: <jq0he5$ium$1@dough.gmane.org>
References: <jq0he5$ium$1@dough.gmane.org>
Message-ID: <4FC3E5A7.108@rabbitmq.com>

On 28/05/2012 7:50PM, Michael Justin wrote:
> For a simple replacement of the STOMP 1.1 heartbeat feature, I would
> like to use fast-expiring messages or destinations which do not keep
> messages for a long time. Is this possible with the RabbitMQ
> configuration file, so that it will also have an effect on STOMP messages?

You can publish to a pre-declared queue with /amq/queue/<name>, having 
declared the queue with a low message ttl previously over AMQP or via 
the management interface.

But if you're going to do that, you could declare an exchange that is 
not being used for anything else, and publish to that: then your 
messages will be never even hit a queue. If you don't want to have to 
declare an exchange in advance, you could use one of the built-in ones:

/exchange/amq.fanout
/exchange/amq.direct
/exchange/amq.headers

(assuming you're not using these for anything else, which you're 
presumably not)

You should probably avoid using amq.topic since that's used for 
/topic/<name> destinations in STOMP.

Cheers, Simon

From videlalvaro at gmail.com  Tue May 29 11:55:47 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 29 May 2012 12:55:47 +0200
Subject: [rabbitmq-discuss] RabbitMQ in Action is here
Message-ID: <CAMcAHLUXHB7Spmh4344F0Dcjwt-ftRFWuo14_Xq6kohXWDCnkg@mail.gmail.com>

Hi list,

Sorry for the shameless plug but I think is time to officially announce the
availability of our book.

The book was released in print around a month ago. You can read more about
it in the official RabbitMQ blog, and yes we have a discount code for you
there in case you haven't bought the book yet:

http://www.rabbitmq.com/blog/2012/05/29/jason-and-alvaros-excellent-rabbit-book/

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120529/ba61b561/attachment.htm>

From simon at klunky.co.uk  Tue May 29 12:37:15 2012
From: simon at klunky.co.uk (Simon Loewenthal)
Date: Tue, 29 May 2012 13:37:15 +0200
Subject: [rabbitmq-discuss] RabbixMQ on RHEL on top of VmWare ESX
Message-ID: <4FC4B4EB.3030608@klunky.co.uk>

Hi there,

	I have to set up two nodes running RabbitMQ on two servers each running
RHEL 6 and these are both on top of Vmware ESX.

How should the VMware servers be configured for running RabbitMX to
ensure good response.

e.g discs on same vmware datastore, specific tuning for RHEL, specific
configuration on Vmware or specific RabbixMQ settings.

Cheers,

S

From oyvind at tjervaag.com  Tue May 29 13:01:48 2012
From: oyvind at tjervaag.com (=?iso-8859-1?Q?=D8yvind_Tjervaag?=)
Date: Tue, 29 May 2012 14:01:48 +0200
Subject: [rabbitmq-discuss] RabbitMQ stopping when trying to delete locked
	mnesia files?
Message-ID: <220C32D4-3EB5-4032-A898-2FC2E0551260@tjervaag.com>

Hi!

I've had this problem a couple of times now where it seems, if I'm deciphering the logs correctly, the RabbitMQ crashed when it tries to delete mnesia files that are locked by backup or virus-scanning. I thought I had seen something about this on this list a while back, but I can't seem to find it now.

Sorry about the long logs, but I've snipped what I thought was irrelevant:


=ERROR REPORT==== 24-May-2012::01:20:54 ===
** Generic server <0.195.0> terminating
** Last message in was {'$gen_cast',{delete,8611}}
** When Server state == {state,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            [],
                            {gc_state,
                                "e:/Mnesia/rabbit at machinename-mnesia/msg_store_persistent",
                                rabbit_msg_store_ets_index,
                                {state,213063,
                                    "e:/Mnesia/rabbit at machinename-mnesia/msg_store_persistent"},
                                208966,217160,<0.192.0>}}
** Reason for termination == 
** {{badmatch,{error,eacces}},
    [{rabbit_msg_store,safe_file_delete,3,[]},
     {rabbit_msg_store_gc,'-attempt_action/3-fun-0-',1,[]},
     {lists,'-filter/2-lc$^0/1-0-',2,[{file,"lists.erl"},{line,1220}]},
     {rabbit_msg_store_gc,attempt_action,3,[]},
     {rabbit_msg_store_gc,handle_cast,2,[]},
     {gen_server2,handle_msg,2,[]},
     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}

=ERROR REPORT==== 24-May-2012::01:20:54 ===
** Generic server msg_store_persistent terminating
** Last message in was {'EXIT',<0.195.0>,
                           {{badmatch,{error,eacces}},
                            [{rabbit_msg_store,safe_file_delete,3,[]},
                             {rabbit_msg_store_gc,'-attempt_action/3-fun-0-',
                                 1,[]},
                             {lists,'-filter/2-lc$^0/1-0-',2,
                                 [{file,"lists.erl"},{line,1220}]},
                             {rabbit_msg_store_gc,attempt_action,3,[]},
                             {rabbit_msg_store_gc,handle_cast,2,[]},
                             {gen_server2,handle_msg,2,[]},
                             {proc_lib,wake_up,3,
                                 [{file,"proc_lib.erl"},{line,237}]}]}}
** When Server state == {msstate,
                            "e:/Mnesia/rabbit at machinename-mnesia/msg_store_persistent",
                            rabbit_msg_store_ets_index,
                            {state,213063,
                                "e:/Mnesia/rabbit at machinename-mnesia/msg_store_persistent"},
                            8612,#Ref<0.0.100.15376>,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            undefined,6556,6556,[],<0.195.0>,217160,208966,
                            221257,225354,
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,3,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],
                                  [[<<242,131,46,148,249,165,117,168,89,192,
                                      116,172,97,9,69,105>>|
                                    {<0.201.0>,
                                     #Fun<rabbit_variable_queue.1.12380193>,
                                     #Fun<rabbit_variable_queue.13.91199175>}]],
                                  [],
                                  [[<<93,218,27,224,115,59,29,211,84,246,239,
                                      132,234,163,75,58>>|
                                    {<0.200.0>,
                                     #Fun<rabbit_variable_queue.1.12380193>,
                                     #Fun<rabbit_variable_queue.13.91199175>}]],
                                  [[<<11,218,33,254,192,34,57,180,178,129,31,
                                      72,69,118,184,70>>|
                                    {<0.199.0>,
                                     #Fun<rabbit_variable_queue.1.12380193>,
                                     #Fun<rabbit_variable_queue.13.91199175>}]],
                                  [],[],[],[],[],[],[],[],[],[],[]}}},
                            false,16777216,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}}}
** Reason for termination == 
** {noproc,{gen_server2,call,[<0.195.0>,stop,infinity]}}
** In 'terminate' callback with reason ==
** {{badmatch,{error,eacces}},
    [{rabbit_msg_store,safe_file_delete,3,[]},
     {rabbit_msg_store_gc,'-attempt_action/3-fun-0-',1,[]},
     {lists,'-filter/2-lc$^0/1-0-',2,[{file,"lists.erl"},{line,1220}]},
     {rabbit_msg_store_gc,attempt_action,3,[]},
     {rabbit_msg_store_gc,handle_cast,2,[]},
     {gen_server2,handle_msg,2,[]},
     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}

=INFO REPORT==== 24-May-2012::01:20:54 ===
stopped TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 24-May-2012::01:20:54 ===
stopped TCP Listener on [::]:5672

=ERROR REPORT==== 24-May-2012::01:21:01 ===
** Generic server <0.200.0> terminating
** Last message in was {'EXIT',<0.198.0>,shutdown}
** When Server state == {q,
                         {amqqueue,
                          {resource,<<"/">>,queue,<<"QUEUENAME">>},
                          true,false,none,[],<0.200.0>,[],undefined},
                         none,true,rabbit_variable_queue,
                         {vqstate,
                          {0,{[],[]}},
                          {0,{[],[]}},
                          {delta,undefined,0,undefined},
                          {0,{[],[]}},
                          {0,{[],[]}},
                          793942,
                          {0,nil},
                          undefined,
                          {0,nil},
                          {qistate,
                           "e:/Mnesia/rabbit at machinename-mnesia/queues/CDBIXPAYNE7Z1MBHQJSYJB9T9",
                           {{dict,4,16,16,8,80,48,
                             {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],
                               [[44|
                                 {segment,44,
                                  "e:/Mnesia/rabbit at machinename-mnesia/queues/CDBIXPAYNE7Z1MBHQJSYJB9T9/44.idx",
                                  {array,16384,0,undefined,
                                   {{{{{{{<<177,189,215,156,204,89,5,250,132,
                                            27,178,87,129,157,90,185>>,
                                          {message_properties,undefined,true},
                                          true},
                                         del,ack},
                                        {{<<219,139,40,233,147,201,159,68,150,
                                            79,119,170,23,210,45,19>>,
                                          {message_properties,undefined,true},
                                          true},
                                         del,ack},
<---------- BIG SNIP ------------------>
                            {state,192578,
                             "e:/Mnesia/rabbit at machinename-mnesia/msg_store_transient"},
                            rabbit_msg_store_ets_index,
                            "e:/Mnesia/rabbit at machinename-mnesia/msg_store_transient",
                            <0.190.0>,196675,188474,200772,204869}},
                          true,0,#Fun<rabbit_amqqueue_process.5.17325602>,2,2,
                          infinity,2,0,0,0,2,
                          {rates,
                           {{1337,815248,910691},10},
                           {{1337,815248,910691},10},
                           1.4544749345486279,1.4544749345486279,
                           {1337,815253,957691}},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          0,0,
                          {rates,
                           {{1337,815248,910691},10},
                           {{1337,815248,910691},10},
                           1.4544749345486279,1.4544749345486279,
                           {1337,815253,957691}}},
                         {[],[]},
                         undefined,undefined,#Ref<0.0.100.15371>,undefined,
                         {state,fine,5000,#Ref<0.0.100.15372>},
                         {0,nil},
                         undefined,undefined,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         1,
                         {{0,nil},{0,nil}},
                         undefined,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         undefined,undefined}
** Reason for termination == 
** {noproc,
       {gen_server2,call,
           [msg_store_persistent,
            {client_terminate,
                <<242,131,46,148,249,165,117,168,89,192,116,172,97,9,69,105>>},
            infinity]}}
** In 'terminate' callback with reason ==
** shutdown

=INFO REPORT==== 24-May-2012::01:21:43 ===
    application: rabbit
    exited: shutdown
    type: permanent


I'm running RabbitMQ version 2.8.2 and Erlang R15B01 on Windows 2008 R2 (64 bit). Now, I've told the IT-ops-people to stop locking any files in the mnesia folder, but I think RabbitMQ should not fail this badly when it tries deleting a locked file? 

Or am I doing something else wrong here?

thanks,
?yvind

From alexis at rabbitmq.com  Tue May 29 16:41:46 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 29 May 2012 16:41:46 +0100
Subject: [rabbitmq-discuss] RabbitMQ in Action is here
In-Reply-To: <CAMcAHLUXHB7Spmh4344F0Dcjwt-ftRFWuo14_Xq6kohXWDCnkg@mail.gmail.com>
References: <CAMcAHLUXHB7Spmh4344F0Dcjwt-ftRFWuo14_Xq6kohXWDCnkg@mail.gmail.com>
Message-ID: <CACOPnvcSBHXvXAVXEgOASqcn74zXA10zUiX-U_6GqujjRQOZmw@mail.gmail.com>

Thanks Alvaro.

All plugs should be shameless ;-)

alexis



On Tue, May 29, 2012 at 11:55 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi list,
>
> Sorry for the shameless plug but I think is time to officially announce the
> availability of our book.
>
> The book was released in print around a month ago. You can read more about
> it in the official?RabbitMQ?blog, and yes we have a discount code for you
> there in case you haven't bought the book yet:
>
> http://www.rabbitmq.com/blog/2012/05/29/jason-and-alvaros-excellent-rabbit-book/
>
> Regards,
>
> Alvaro
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From james.poole at rsa.com  Tue May 29 16:52:12 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Tue, 29 May 2012 11:52:12 -0400
Subject: [rabbitmq-discuss] SSL Enhancement for .NET Client
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D708094E2FF2@MX36A.corp.emc.com>

Is there a way I can help get an enhancement for the .NET C# RabbitMQ client
into the source?

 

We have modified the SslOption class to expose 2 properties with the
following types:

-          RemoteCertificateValidationCallback

-          LocalCertificateSelectionCallback

 

If these are set, then the SslHelper class will use these instead of the
default callbacks in the TcpUpgrade() function when setting up the
SslStream.

 

This enhancement would allow clients to handle their own certificate
selection/validation.  Without this change, clients are stuck with "ignore
errors" or "use the windows cert store".  Our code would like to inspect the
server certificates and only trust specific ones, without having to install
them into the machine's certificate store.

 

Thanks,

James

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120529/0ac0a0ea/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7449 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120529/0ac0a0ea/attachment.bin>

From emile at rabbitmq.com  Tue May 29 17:11:45 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 29 May 2012 17:11:45 +0100
Subject: [rabbitmq-discuss] SSL Enhancement for .NET Client
In-Reply-To: <FC3463BECF39B74996BF6ADDCB9BE7D708094E2FF2@MX36A.corp.emc.com>
References: <FC3463BECF39B74996BF6ADDCB9BE7D708094E2FF2@MX36A.corp.emc.com>
Message-ID: <4FC4F541.9020401@rabbitmq.com>


Hi James,

On 29/05/12 16:52, james.poole at rsa.com wrote:
> Is there a way I can help get an enhancement for the .NET C# RabbitMQ
> client into the source?

You are invited to fork the relevant github repository:
https://github.com/rabbitmq/rabbitmq-dotnet-client

In that way other users of the library can benefit from your
improvements during the merge. You may also send your patch directly me
if you prefer not to use github.

In either case we will need you to sign a contributor agreement in order
to accept the changes.



Emile

From julio at hawaii.edu  Tue May 29 22:21:47 2012
From: julio at hawaii.edu (Julio Polo)
Date: Tue, 29 May 2012 11:21:47 -1000
Subject: [rabbitmq-discuss] Perl SSL support for Net::RabbitMQ
In-Reply-To: <33905637.post@talk.nabble.com>
References: <33901964.post@talk.nabble.com>
	<CAAt2poJ0xcuJLRewH8vBtWN7n5tgVDEijJA1Gd_fxtboLVqduA@mail.gmail.com>
	<33905637.post@talk.nabble.com>
Message-ID: <CA+0gB9mx=NjjaC0E2b87_VuwM4yn4j+mDR2n8NXRfRgBxyF3Vg@mail.gmail.com>

If you are willing to use AnyEvent::RabbitMQ (chosen because it
required the least amount of additional software), I have a simple
patch to version 1.05 to make it work with SSL:

/usr/local/lib/site_perl/5.8.x/AnyEvent# diff RabbitMQ.pm.bak RabbitMQ.pm
95c95
<             $self->{_handle} = AnyEvent::Handle->new(
---
>             my %handle_args = (
113a114,117
>             if ($args{tls}) {
>                 $handle_args{tls} = 'connect';
>             }
>             $self->{_handle} = AnyEvent::Handle->new(%handle_args);

and you would simply add tls => 1 to the connection settings.
Hopefully this snippet of code is self-explanatory:

    my %basic_settings =
    (
        host       => $conf->{$CONF_host},
        port       => $conf->{$CONF_port},
        user       => $conf->{$CONF_user},
        pass       => $conf->{$CONF_pass},
        vhost      => $conf->{$CONF_vhost},
        timeout    => $conf->{$CONF_timeout},
    );

    # the tls option requires this patch to AnyEvent::RabbitMQ
=pod
95c95
<             $self->{_handle} = AnyEvent::Handle->new(
---
>             my %handle_args = (
113a114,117
>             if ($args{tls}) {
>                 $handle_args{tls} = 'connect';
>             }
>             $self->{_handle} = AnyEvent::Handle->new(%handle_args);
=cut
    if ($conf->{$CONF_secure})
    {
        $basic_settings{'tls'} = 1;  # this gets translated to connect
by above patch
    }

    my $cv = AnyEvent->condvar;

    my $ar;
    $ar = AnyEvent::RabbitMQ->new->load_xml_spec()->connect
    (
        %basic_settings,

        on_success => sub
        {
            $ar->open_channel
            (
                on_success => sub
                {
                    log_this( join(' ', 'RabbitMQ
open_channel->on_success: ', Dumper(@_)) ) if $debug;
                    shift->declare_exchange
                    (
                        exchange   => $exchange_name,
                        type       => 'topic',
                        passive    => $exchange_passive,
                        durable     => 1,
                        auto_delete => 0,
#                       internal    => 0,
                        on_success => sub
                        {
                            $cv->send("Declared exchange $exchange_name");
                        },
                        on_failure => $cv,
                    );
                },

                on_failure => $cv,

                on_close   => sub
                {
                    croak join(' ', 'RabbitMQ open_channel->on_close:
', Dumper(@_));
                }

            ); # open_channel

        }, # on_success

        on_failure      => $cv,

        on_read_failure => sub
        {
            croak join(' ', 'RabbitMQ connect->on_read_failure: ', Dumper(@_));
        },

        on_close        => sub
        {
            croak join(' ', 'RabbitMQ connect->on_close: ', Dumper(@_));
        },
    );

    $cv->recv;

    # return the channel for this connection
    my $channel = $ar->channels->{1}
        or croak "No channel in _connect\n";

We were planning to publish some of this code.  I can make it
available sooner if anyone is interested.

Julio Polo
Identity and Access Management
Information Technology Services
University of Hawaii


On Thu, May 24, 2012 at 4:15 PM, xtrm <xtrm2008 at live.com> wrote:
>
> So what is everyone doing in regards to SSL support? ?Is everyone using
> either .NET or Java for their implementations?
>
> Thanks again for the help
>
>
>
> Alan Antonuk wrote:
>>
>> I believe (someone correct me if I'm wrong) Net::RabbitMQ is just a
>> wrapper
>> around the rabbitmq-c library, which does not support SSL as of yet, so
>> Net::RabbitMQ probably doesn't support SSL yet.
>>
>> There is currently an effort underway to add SSL support to rabbitmq-c,
>> but
>> it is not complete yet.
>>
>> -Alan
>>
>> On Thu, May 24, 2012 at 9:36 AM, xtrm <xtrm2008 at live.com> wrote:
>>
>>>
>>> Hello all,
>>>
>>> New to RabbitMQ and hoping someone on the forum has been through this
>>> before. I am trying to implement SSL client authentication to use with on
>>> all our clients. ?I am unable to find any documentation on how to go
>>> about
>>> doing this. ?I was able to find two examples in .NET and Java on the
>>> rabbitMQ SSL support website, but no mention on how to implement using
>>> Perl.
>>> Has anyone gotten this working? ?If so how did you guys go about
>>> implementing SSL support?
>>>
>>> I currently have my clients publishing successfully using the non SSL
>>> port
>>> using Net::RabbitMQ module.
>>>
>>> Thanks for the help in advance.
>>>
>>> --
>>> View this message in context:
>>> http://old.nabble.com/Perl-SSL-support-for-Net%3A%3ARabbitMQ-tp33901964p33901964.html
>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> --
> View this message in context: http://old.nabble.com/Perl-SSL-support-for-Net%3A%3ARabbitMQ-tp33901964p33905637.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From support at cloudwebdns.com  Wed May 30 03:16:44 2012
From: support at cloudwebdns.com (Cloud DNS)
Date: Wed, 30 May 2012 10:16:44 +0800
Subject: [rabbitmq-discuss] RabbitMQ in Action is here
In-Reply-To: <CAMcAHLUXHB7Spmh4344F0Dcjwt-ftRFWuo14_Xq6kohXWDCnkg@mail.gmail.com>
References: <CAMcAHLUXHB7Spmh4344F0Dcjwt-ftRFWuo14_Xq6kohXWDCnkg@mail.gmail.com>
Message-ID: <4FC5830C.8000400@cloudwebdns.com>

? 2012-5-29 18:55, Alvaro Videla ??:
> Sorry for the shameless plug but I think is time to officially 
> announce the availability of our book.
>
> The book was released in print around a month ago. You can read more 
> about it in the official RabbitMQ blog, and yes we have a discount 
> code for you there in case you haven't bought the book yet:
>
> http://www.rabbitmq.com/blog/2012/05/29/jason-and-alvaros-excellent-rabbit-book/


looks great.
If you'd like, I can help translate it to Chinese.
I have the experience of translation for tech books.


From rev.chip at gmail.com  Wed May 30 06:41:23 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Tue, 29 May 2012 22:41:23 -0700
Subject: [rabbitmq-discuss] Per-Connection Flow Control -- The Case Against
 (Try #2)
In-Reply-To: <4FC551AE.5000802@gmail.com>
References: <2af00047-238a-49dc-95da-982dcc32f6a6@googlegroups.com>
	<CAM8fPiQKDUe0L3NpkLCRyxW51gvWN-Z2uKLMZ+H6Vsk5MeL_2Q@mail.gmail.com>
	<4FC3C020.6060009@gmail.com>
	<CAM8fPiTpPJVxSVvGy-QkM0JFfEA1QLf3j4FgBmAF_f4pp5gn0A@mail.gmail.com>
	<4FC551AE.5000802@gmail.com>
Message-ID: <CANSL5VGhM-ppNWwKVZdWkEU9ZdNgqSi4Sc7ooRyK-FQpU-Bqqg@mail.gmail.com>

It would appear Google Groups ate my reply; thus, this resend.  Sorry if
this is a dup for anyone.
--------------------

 On 5/29/2012 6:21 AM, Tony Garnock-Jones wrote:

On 28 May 2012 19:12, Reverend Chip <rev.chip at gmail.com> wrote:

> That's very funny.
>  If you're serious, then I can't take you seriously.
>

 I suspect you're just being rude....


I explained a scenario, as produced by the current flow control code, that
is ridiculous on its face: That growing queues are fine, until consumers
appear, at which point growing queues are not fine.  That's a paradoxical
result that at the very least should prompt reevaluation of the flow
control algorithm.  To ask what the practical bad results are in my
specific case is ridiculous misdirection.

Either growing queues (up to disk and memory limits) are acceptable -- my
position, and the position of RMQ without consumers -- or growing queues
are not acceptable -- the position of RMQ with consumers.  This paradox is
quite simple to write and to read.  The behavior of the current code is
absurd, as anyone can see if they were to choose to look.

So no, I was not being rude, specifically.  But I did ridicule your
comment, which well deserved it.  Per Thomas Jefferson: "Ridicule is the
only weapon which can be used against unintelligible propositions. Ideas
must be distinct before reason can act upon them."

PS: You may not have thought about the further wrinkle that the queues do
not accept new messages until they are EMPTY.  Which is doubly ridiculous.



 , but since it's also possible that the message you're replying to didn't
get through to you in its entirety (because of broken "From" quoting at
some stage in the mail delivery pipeline), I'll reproduce the rest of what
I wrote here in case it helps advance the discussion:

 >From one point of view, any time consumers exist but are not keeping up
with offered traffic is a good time to throttle the producers. Perhaps call
this the "steady state" point of view - I'm unsure if it has a better name
already.

 >From another point of view - call this the "bursty" point of view,
perhaps - the growth of queues is perfectly acceptable, whether consumers
exist at the time or not.

 ISTM Rabbit makes a guess about whether the application is "steady state"
or "bursty", choosing "steady state" all the time. Rabbit team, is this the
case? Is there a way of configuring the flow control to permit unbounded
queue growth to support the "bursty" case? Or do I have the wrong end of
the stick entirely?


> 1. A client is publishing 1.5K/sec to each of four exchanges, each of
> which has a queue.
> 2. There are no consumers.  Therefore the queue is growing.
> 3. RMQ does not stop this.  "Flow control" does not trigger.
> 4. The consumers appear to begin to tear down the backlog.
>  5. RMQ per-connection flow control suddenly decides that now there are
> some consumers, now it has a reason to throttle the sender.
> 6. If the consumers had not shown up, the producer would not have been
> blocked.
>

 7. The consumers drain some of the messages from the queues.
8. The producers are unblocked.
9. Profit!!!

 Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120529/3cc5908b/attachment.htm>

From rev.chip at gmail.com  Wed May 30 06:44:43 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Tue, 29 May 2012 22:44:43 -0700
Subject: [rabbitmq-discuss] Why am I being censored?
In-Reply-To: <4FC34EDE.6090005@rabbitmq.com>
References: <248f08cc-fc4b-4a89-827e-8e74e7cf5b38@googlegroups.com>
	<14753BD49AE74FD591C1E2571CC93944@gmail.com>
	<4FC34EDE.6090005@rabbitmq.com>
Message-ID: <CANSL5VFhtGhZ1+aMb_OZR8PZHHT_dED0um0AT_QCx61SvG3EfA@mail.gmail.com>

On Mon, May 28, 2012 at 3:09 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Also, have you seen my response here?
>
> http://lists.rabbitmq.com/**pipermail/rabbitmq-discuss/**
> 2012-May/020323.html<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/020323.html>
>
> Summary: flow control is unmasking another problem. Flow control is not
> the enemy.
>

That analysis is entirely plausible.  I would be pleased to test the
described patch.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120529/4f6f87b2/attachment.htm>

From asinghal79 at gmail.com  Wed May 30 06:48:16 2012
From: asinghal79 at gmail.com (Aishwarya Singhal)
Date: Wed, 30 May 2012 11:18:16 +0530
Subject: [rabbitmq-discuss] Urgent issue with rabbitmq
Message-ID: <CAJHaMpYhS9r3vD7_4JWzQM0aU82MXH+qxC=B9CaK1NgshYOqUA@mail.gmail.com>

hi

I installed RabbitMQ on AWS Amazon AMI (uname Linux xxxx
3.2.12-3.2.4.amzn1.x86_64 #1 SMP Thu Mar 22 08:00:08 UTC 2012 x86_64 x86_64
x86_64 GNU/Linux). I followed the installation steps at
http://www.rabbitmq.com/install-rpm.html and started the services. The
services run fine and when I run 'rabbitmqctl status', I get a 'proper'
response.

I am now trying to run the java client test from
http://www.rabbitmq.com/ec2.html. I do get "starting consumer #0
starting producer #0" but nothing afterwards. There are no logs as well.
What am I doing wrong?

Best regards
Aishwarya
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120530/ec7118c2/attachment.htm>

From asinghal79 at gmail.com  Wed May 30 06:48:37 2012
From: asinghal79 at gmail.com (Aishwarya Singhal)
Date: Tue, 29 May 2012 22:48:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Urgent - issue on AWS
Message-ID: <b329701b-908b-417d-a596-5ea696db7c3b@l5g2000vbo.googlegroups.com>

hi

I installed RabbitMQ on AWS Amazon AMI (uname Linux xxxx
3.2.12-3.2.4.amzn1.x86_64 #1 SMP Thu Mar 22 08:00:08 UTC 2012 x86_64
x86_64 x86_64 GNU/Linux). I followed the installation steps at
http://www.rabbitmq.com/install-rpm.html and started the services. The
services run fine and when I run 'rabbitmqctl status', I get a
'proper' response.

I am now trying to run the java client test from http://www.rabbitmq.com/ec2.html.
I do get "starting consumer #0
starting producer #0" but nothing afterwards. There are no logs as
well. What am I doing wrong?

Best regards
Aishwarya

From rev.chip at gmail.com  Wed May 30 06:52:54 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Tue, 29 May 2012 22:52:54 -0700
Subject: [rabbitmq-discuss] Per-Connection Flow Control -- The Case
	Against
In-Reply-To: <4FBF771F.5090009@rabbitmq.com>
References: <a6010e5e-a207-41e3-a45b-d9ab658a9292@h10g2000pbi.googlegroups.com>
	<4FBF771F.5090009@rabbitmq.com>
Message-ID: <CANSL5VE0W_unc0fTsOaYsSqYD0fHDv7NnB5m_qOa3R=-gGv+Uw@mail.gmail.com>

On Fri, May 25, 2012 at 5:12 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> In the mean time, I wonder whether 500 consumers and prefetch-count of 2
> is what you really want. Normally I would expect a configuration like that
> when you expect to take some time to process each message, but it sounds
> like you're going fast enough that either 500 consumers are not needed, or
> prefetch-count > 2 might lead to better performance.
>

I didn't know that a larger prefetch count could reduce broker workload.
 Per-message processing in this system is sometimes high (up to 20s), but
it averages very low.  It's likely that 500 is overkill, but probably only
by 2x or so.

Assuming a constant throughput of about 6K/sec and at least 250 workers,
what prefetch seems more helpful, IYO?  10?  20?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120529/76f94c72/attachment.htm>

From emile at rabbitmq.com  Wed May 30 07:47:54 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 30 May 2012 07:47:54 +0100
Subject: [rabbitmq-discuss] Urgent issue with rabbitmq
In-Reply-To: <CAJHaMpYhS9r3vD7_4JWzQM0aU82MXH+qxC=B9CaK1NgshYOqUA@mail.gmail.com>
References: <CAJHaMpYhS9r3vD7_4JWzQM0aU82MXH+qxC=B9CaK1NgshYOqUA@mail.gmail.com>
Message-ID: <4FC5C29A.4050408@rabbitmq.com>

Hi,

On 30/05/12 06:48, Aishwarya Singhal wrote:
> I am now trying to run the java client test
> from http://www.rabbitmq.com/ec2.html. I do get "starting consumer #0
> starting producer #0" but nothing afterwards. There are no logs as well.
> What am I doing wrong?

The most likely cause is that disk free space monitoring is blocking the
publisher. The broker log file will confirm this. See this page for more
details:

http://www.rabbitmq.com/memory.html#diskfreesup


-Emile


From asinghal79 at gmail.com  Wed May 30 09:01:05 2012
From: asinghal79 at gmail.com (Aishwarya Singhal)
Date: Wed, 30 May 2012 13:31:05 +0530
Subject: [rabbitmq-discuss] Urgent issue with rabbitmq
In-Reply-To: <4FC5C29A.4050408@rabbitmq.com>
References: <CAJHaMpYhS9r3vD7_4JWzQM0aU82MXH+qxC=B9CaK1NgshYOqUA@mail.gmail.com>
	<4FC5C29A.4050408@rabbitmq.com>
Message-ID: <CAJHaMpY438nyCTwjzG9UkvB5BRK+y=9_ns-qgmeRvm-q6J5Ciw@mail.gmail.com>

hi Emile

from the logs this morning:

=INFO REPORT==== 30-May-2012::05:05:37 ===
Limiting to approx 349900 file handles (314908 sockets)

=INFO REPORT==== 30-May-2012::05:05:37 ===
Memory limit set to 238MB of 595MB total.

=INFO REPORT==== 30-May-2012::05:05:37 ===
vm_memory_high_watermark set. Memory used:305654848 allowed:249715097

=INFO REPORT==== 30-May-2012::05:05:37 ===
    alarm_handler: {set,{{resource_limit,memory,'rabbit at xxxx'},
                         []}}

=INFO REPORT==== 30-May-2012::05:05:38 ===
Disk free limit set to 595MB


I see that there was one message of disk free. There's nothing else
indicating a block. It is strange that there are no meaningful logs
anywhere either. How do I get around the issue? For now now I have removed
RabbitMQ from my code to let the app work without it, but I would like to
get it running.

Best regards

On Wed, May 30, 2012 at 12:17 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 30/05/12 06:48, Aishwarya Singhal wrote:
> > I am now trying to run the java client test
> > from http://www.rabbitmq.com/ec2.html. I do get "starting consumer #0
> > starting producer #0" but nothing afterwards. There are no logs as well.
> > What am I doing wrong?
>
> The most likely cause is that disk free space monitoring is blocking the
> publisher. The broker log file will confirm this. See this page for more
> details:
>
> http://www.rabbitmq.com/memory.html#diskfreesup
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120530/167c7767/attachment.htm>

From matthias at rabbitmq.com  Wed May 30 09:22:15 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 30 May 2012 09:22:15 +0100
Subject: [rabbitmq-discuss] Urgent issue with rabbitmq
In-Reply-To: <CAJHaMpY438nyCTwjzG9UkvB5BRK+y=9_ns-qgmeRvm-q6J5Ciw@mail.gmail.com>
References: <CAJHaMpYhS9r3vD7_4JWzQM0aU82MXH+qxC=B9CaK1NgshYOqUA@mail.gmail.com>
	<4FC5C29A.4050408@rabbitmq.com>
	<CAJHaMpY438nyCTwjzG9UkvB5BRK+y=9_ns-qgmeRvm-q6J5Ciw@mail.gmail.com>
Message-ID: <4FC5D8B7.2010101@rabbitmq.com>

Aishwarya,

On 30/05/12 09:01, Aishwarya Singhal wrote:
> =INFO REPORT==== 30-May-2012::05:05:37 ===
> Memory limit set to 238MB of 595MB total.
>
> =INFO REPORT==== 30-May-2012::05:05:37 ===
> vm_memory_high_watermark set. Memory used:305654848 allowed:249715097
>
> =INFO REPORT==== 30-May-2012::05:05:37 ===
>      alarm_handler: {set,{{resource_limit,memory,'rabbit at xxxx'},
>                           []}}

Ah, so it's the memory rather than the disk limit that has been exceeded.

Rabbit shouldn't be using anywhere near the 300M indicated above unless 
you have thousands of resources (exchanges, queues, bindings), thousands 
of connections, or millions of messages.

I suggest you inspect the state of your rabbit with the various 
"rabbitmqctl list_*" commands or using the management UI.

Also, what version of rabbit are you running? If it's not the latest 
(2.8.2) then please upgrade.

Regards,

Matthias.

From dstolyarov at dataminr.com  Tue May 29 19:21:14 2012
From: dstolyarov at dataminr.com (Dmitriy Stolyarov)
Date: Tue, 29 May 2012 11:21:14 -0700 (PDT)
Subject: [rabbitmq-discuss] default queue parameters
Message-ID: <ccfa23e8-a106-4d33-a2a8-6130c0ff134b@googlegroups.com>

Is it possible to specify on the server the default queue parameters for 
any new clients? For example by default to set any queue to expire or to 
set ttl of a message?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120529/7b0f64b4/attachment.htm>

From asinghal79 at gmail.com  Wed May 30 09:53:20 2012
From: asinghal79 at gmail.com (Aishwarya Singhal)
Date: Wed, 30 May 2012 14:23:20 +0530
Subject: [rabbitmq-discuss] Urgent issue with rabbitmq
In-Reply-To: <4FC5D8B7.2010101@rabbitmq.com>
References: <CAJHaMpYhS9r3vD7_4JWzQM0aU82MXH+qxC=B9CaK1NgshYOqUA@mail.gmail.com>
	<4FC5C29A.4050408@rabbitmq.com>
	<CAJHaMpY438nyCTwjzG9UkvB5BRK+y=9_ns-qgmeRvm-q6J5Ciw@mail.gmail.com>
	<4FC5D8B7.2010101@rabbitmq.com>
Message-ID: <CAJHaMpbtvUA8VYi-9FfPZ+pfRAvug2DSA5VQCGeRNXr_eDCjfg@mail.gmail.com>

Hi Matthias

That does seem to be the issue! I am using 2.8.2 (
http://www.rabbitmq.com/releases/rabbitmq-server/v2.8.2/rabbitmq-server-generic-unix-2.8.2.tar.gz
).

Sorry I am a newbie and have used it on my production set up :-( I can see
that memory shows up in red on the console but I don't know how to fix it.
The load on the server is very low so it is probably something wrong with
the set up. Where do I look and how do I fix it?

Best regards

On Wed, May 30, 2012 at 1:52 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Aishwarya,
>
>
> On 30/05/12 09:01, Aishwarya Singhal wrote:
>
>> =INFO REPORT==== 30-May-2012::05:05:37 ===
>> Memory limit set to 238MB of 595MB total.
>>
>> =INFO REPORT==== 30-May-2012::05:05:37 ===
>> vm_memory_high_watermark set. Memory used:305654848 allowed:249715097
>>
>> =INFO REPORT==== 30-May-2012::05:05:37 ===
>>     alarm_handler: {set,{{resource_limit,memory,'**rabbit at xxxx'},
>>                          []}}
>>
>
> Ah, so it's the memory rather than the disk limit that has been exceeded.
>
> Rabbit shouldn't be using anywhere near the 300M indicated above unless
> you have thousands of resources (exchanges, queues, bindings), thousands of
> connections, or millions of messages.
>
> I suggest you inspect the state of your rabbit with the various
> "rabbitmqctl list_*" commands or using the management UI.
>
> Also, what version of rabbit are you running? If it's not the latest
> (2.8.2) then please upgrade.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120530/43d35a8d/attachment.htm>

From matthias at rabbitmq.com  Wed May 30 10:08:25 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 30 May 2012 10:08:25 +0100
Subject: [rabbitmq-discuss] Urgent issue with rabbitmq
In-Reply-To: <CAJHaMpbtvUA8VYi-9FfPZ+pfRAvug2DSA5VQCGeRNXr_eDCjfg@mail.gmail.com>
References: <CAJHaMpYhS9r3vD7_4JWzQM0aU82MXH+qxC=B9CaK1NgshYOqUA@mail.gmail.com>
	<4FC5C29A.4050408@rabbitmq.com>
	<CAJHaMpY438nyCTwjzG9UkvB5BRK+y=9_ns-qgmeRvm-q6J5Ciw@mail.gmail.com>
	<4FC5D8B7.2010101@rabbitmq.com>
	<CAJHaMpbtvUA8VYi-9FfPZ+pfRAvug2DSA5VQCGeRNXr_eDCjfg@mail.gmail.com>
Message-ID: <4FC5E389.3030505@rabbitmq.com>

Aishwarya,

On 30/05/12 09:53, Aishwarya Singhal wrote:
> I can see that memory shows up in red on the console but I don't know
> how to fix it. The load on the server is very low so it is probably
> something wrong with the set up. Where do I look and how do I fix
> it?

As I said in my earlier response...

>     Rabbit shouldn't be using anywhere near the 300M indicated above
>     unless you have thousands of resources (exchanges, queues,
>     bindings), thousands of connections, or millions of messages.
>
>     I suggest you inspect the state of your rabbit with the various
>     "rabbitmqctl list_*" commands or using the management UI.

...i.e. look for excessive numbers of exchanges, queues, bindings, 
connections, and messages.

Matthias.

From asinghal79 at gmail.com  Wed May 30 10:14:27 2012
From: asinghal79 at gmail.com (Aishwarya Singhal)
Date: Wed, 30 May 2012 14:44:27 +0530
Subject: [rabbitmq-discuss] Urgent issue with rabbitmq
In-Reply-To: <4FC5E389.3030505@rabbitmq.com>
References: <CAJHaMpYhS9r3vD7_4JWzQM0aU82MXH+qxC=B9CaK1NgshYOqUA@mail.gmail.com>
	<4FC5C29A.4050408@rabbitmq.com>
	<CAJHaMpY438nyCTwjzG9UkvB5BRK+y=9_ns-qgmeRvm-q6J5Ciw@mail.gmail.com>
	<4FC5D8B7.2010101@rabbitmq.com>
	<CAJHaMpbtvUA8VYi-9FfPZ+pfRAvug2DSA5VQCGeRNXr_eDCjfg@mail.gmail.com>
	<4FC5E389.3030505@rabbitmq.com>
Message-ID: <CAJHaMpbnujaFUAfxyfeXEV3fT1XbpA62KzguVgD1UVgUw8PO3Q@mail.gmail.com>

Hi Matthias

right, and like I said, its a fresh set up with almost no load :-) I
restarted the server just to see and the memory still hovers around the
300M mark, even when there are no connections, no queues, no channels and
default exchanges and users with zero message rate. I have disconnected it
from my application now so there's no chance of any messages coming in
right now.

I am absolutely clueless and hence seeking your guidance.

Best


On Wed, May 30, 2012 at 2:38 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Aishwarya,
>
>
> On 30/05/12 09:53, Aishwarya Singhal wrote:
>
>> I can see that memory shows up in red on the console but I don't know
>> how to fix it. The load on the server is very low so it is probably
>> something wrong with the set up. Where do I look and how do I fix
>> it?
>>
>
> As I said in my earlier response...
>
>
>     Rabbit shouldn't be using anywhere near the 300M indicated above
>>    unless you have thousands of resources (exchanges, queues,
>>    bindings), thousands of connections, or millions of messages.
>>
>>    I suggest you inspect the state of your rabbit with the various
>>    "rabbitmqctl list_*" commands or using the management UI.
>>
>
> ...i.e. look for excessive numbers of exchanges, queues, bindings,
> connections, and messages.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120530/d99c1223/attachment.htm>

From simon at rabbitmq.com  Wed May 30 10:24:39 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 30 May 2012 10:24:39 +0100
Subject: [rabbitmq-discuss] Why am I being censored?
In-Reply-To: <CANSL5VFhtGhZ1+aMb_OZR8PZHHT_dED0um0AT_QCx61SvG3EfA@mail.gmail.com>
References: <248f08cc-fc4b-4a89-827e-8e74e7cf5b38@googlegroups.com>
	<14753BD49AE74FD591C1E2571CC93944@gmail.com>
	<4FC34EDE.6090005@rabbitmq.com>
	<CANSL5VFhtGhZ1+aMb_OZR8PZHHT_dED0um0AT_QCx61SvG3EfA@mail.gmail.com>
Message-ID: <4FC5E757.7050009@rabbitmq.com>

On 30/05/12 06:44, Chip Salzenberg wrote:
> On Mon, May 28, 2012 at 3:09 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Also, have you seen my response here?
>
>     http://lists.rabbitmq.com/__pipermail/rabbitmq-discuss/__2012-May/020323.html
>     <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/020323.html>
>
>     Summary: flow control is unmasking another problem. Flow control is
>     not the enemy.
>
>
> That analysis is entirely plausible.  I would be pleased to test the
> described patch.

 From a previous message I suspect you're happy compiling RabbitMQ from 
source - if so please apply the patch:

http://hg.rabbitmq.com/rabbitmq-server/raw-rev/b313c8003aab

If not then let me know which installation method you're using and I'll 
cook up a binary.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Wed May 30 10:28:33 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 30 May 2012 10:28:33 +0100
Subject: [rabbitmq-discuss] Urgent issue with rabbitmq
In-Reply-To: <CAJHaMpbnujaFUAfxyfeXEV3fT1XbpA62KzguVgD1UVgUw8PO3Q@mail.gmail.com>
References: <CAJHaMpYhS9r3vD7_4JWzQM0aU82MXH+qxC=B9CaK1NgshYOqUA@mail.gmail.com>
	<4FC5C29A.4050408@rabbitmq.com>
	<CAJHaMpY438nyCTwjzG9UkvB5BRK+y=9_ns-qgmeRvm-q6J5Ciw@mail.gmail.com>
	<4FC5D8B7.2010101@rabbitmq.com>
	<CAJHaMpbtvUA8VYi-9FfPZ+pfRAvug2DSA5VQCGeRNXr_eDCjfg@mail.gmail.com>
	<4FC5E389.3030505@rabbitmq.com>
	<CAJHaMpbnujaFUAfxyfeXEV3fT1XbpA62KzguVgD1UVgUw8PO3Q@mail.gmail.com>
Message-ID: <4FC5E841.30806@rabbitmq.com>

Aishwarya,

On 30/05/12 10:14, Aishwarya Singhal wrote:
> its a fresh set up with almost no load :-) I
> restarted the server just to see and the memory still hovers around the
> 300M mark, even when there are no connections, no queues, no channels
> and default exchanges and users with zero message rate.

I see. Please post the output of 'rabbitmqctl report'.

Matthias.

From asinghal79 at gmail.com  Wed May 30 10:33:35 2012
From: asinghal79 at gmail.com (Aishwarya Singhal)
Date: Wed, 30 May 2012 15:03:35 +0530
Subject: [rabbitmq-discuss] Urgent issue with rabbitmq
In-Reply-To: <4FC5E841.30806@rabbitmq.com>
References: <CAJHaMpYhS9r3vD7_4JWzQM0aU82MXH+qxC=B9CaK1NgshYOqUA@mail.gmail.com>
	<4FC5C29A.4050408@rabbitmq.com>
	<CAJHaMpY438nyCTwjzG9UkvB5BRK+y=9_ns-qgmeRvm-q6J5Ciw@mail.gmail.com>
	<4FC5D8B7.2010101@rabbitmq.com>
	<CAJHaMpbtvUA8VYi-9FfPZ+pfRAvug2DSA5VQCGeRNXr_eDCjfg@mail.gmail.com>
	<4FC5E389.3030505@rabbitmq.com>
	<CAJHaMpbnujaFUAfxyfeXEV3fT1XbpA62KzguVgD1UVgUw8PO3Q@mail.gmail.com>
	<4FC5E841.30806@rabbitmq.com>
Message-ID: <CAJHaMpbZH_hdSH51VvsBGvDLSikSM2vaB3gmdd7drrjVwD5Xcg@mail.gmail.com>

Hi Matthias

Sent you the report privately. It has IP address so avoided cc-ing the list.

Best regards

On Wed, May 30, 2012 at 2:58 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Aishwarya,
>
>
> On 30/05/12 10:14, Aishwarya Singhal wrote:
>
>> its a fresh set up with almost no load :-) I
>> restarted the server just to see and the memory still hovers around the
>> 300M mark, even when there are no connections, no queues, no channels
>> and default exchanges and users with zero message rate.
>>
>
> I see. Please post the output of 'rabbitmqctl report'.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120530/391b89e4/attachment.htm>

From matthias at rabbitmq.com  Wed May 30 10:52:56 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 30 May 2012 10:52:56 +0100
Subject: [rabbitmq-discuss] Urgent issue with rabbitmq
In-Reply-To: <CAJHaMpbZH_hdSH51VvsBGvDLSikSM2vaB3gmdd7drrjVwD5Xcg@mail.gmail.com>
References: <CAJHaMpYhS9r3vD7_4JWzQM0aU82MXH+qxC=B9CaK1NgshYOqUA@mail.gmail.com>
	<4FC5C29A.4050408@rabbitmq.com>
	<CAJHaMpY438nyCTwjzG9UkvB5BRK+y=9_ns-qgmeRvm-q6J5Ciw@mail.gmail.com>
	<4FC5D8B7.2010101@rabbitmq.com>
	<CAJHaMpbtvUA8VYi-9FfPZ+pfRAvug2DSA5VQCGeRNXr_eDCjfg@mail.gmail.com>
	<4FC5E389.3030505@rabbitmq.com>
	<CAJHaMpbnujaFUAfxyfeXEV3fT1XbpA62KzguVgD1UVgUw8PO3Q@mail.gmail.com>
	<4FC5E841.30806@rabbitmq.com>
	<CAJHaMpbZH_hdSH51VvsBGvDLSikSM2vaB3gmdd7drrjVwD5Xcg@mail.gmail.com>
Message-ID: <4FC5EDF8.9030807@rabbitmq.com>

Aishwarya,

On 30/05/12 10:33, Aishwarya Singhal wrote:
> Sent you the report privately.

Cheers. So this really looks like a completely empty and idle rabbit, 
except...

  {erlang_version,
      "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1] 
[async-threads:30] [kernel-poll:true]\n"},
  {memory,
      [{total,306408648},
       {processes,12476936},
       {processes_used,12469184},
       {system,293931712},
       {atom,1541561},
       {atom_used,1527197},
       {binary,178280},
       {code,17373488},
       {ets,1130368}]},

...for some unknown reason there are 293M of system memory allocated.

A few things are worth trying:

1) disable the management plug-in

2) upgrade Erlang to R15B01


Regards,

Matthias.

From simon at rabbitmq.com  Wed May 30 11:25:15 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 30 May 2012 11:25:15 +0100
Subject: [rabbitmq-discuss] default queue parameters
In-Reply-To: <ccfa23e8-a106-4d33-a2a8-6130c0ff134b@googlegroups.com>
References: <ccfa23e8-a106-4d33-a2a8-6130c0ff134b@googlegroups.com>
Message-ID: <4FC5F58B.4020105@rabbitmq.com>

On 29/05/12 19:21, Dmitriy Stolyarov wrote:
> Is it possible to specify on the server the default queue parameters for
> any new clients? For example by default to set any queue to expire or to
> set ttl of a message?

No, not at the moment - what are you trying to do?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed May 30 11:49:54 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 30 May 2012 11:49:54 +0100
Subject: [rabbitmq-discuss] RabbitMQ stopping when trying to delete
 locked mnesia files?
In-Reply-To: <220C32D4-3EB5-4032-A898-2FC2E0551260@tjervaag.com>
References: <220C32D4-3EB5-4032-A898-2FC2E0551260@tjervaag.com>
Message-ID: <4FC5FB52.1090404@rabbitmq.com>

On 29/05/12 13:01, ?yvind Tjervaag wrote:
> Hi!

Hi.

> I've had this problem a couple of times now where it seems, if I'm
> deciphering the logs correctly, the RabbitMQ crashed when it tries to
> delete mnesia files that are locked by backup or virus-scanning. I
> thought I had seen something about this on this list a while back,
> but I can't seem to find it now.

That's a correct decipherment.

> I'm running RabbitMQ version 2.8.2 and Erlang R15B01 on Windows 2008
> R2 (64 bit). Now, I've told the IT-ops-people to stop locking any
> files in the mnesia folder, but I think RabbitMQ should not fail this
> badly when it tries deleting a locked file?

Hmm. We do in general assume that file operations on files owned by 
Rabbit will succeed; it's hard to know in the general case what else to do.

In the crash that you're seeing, Rabbit was not able to delete an old 
file from the message store. That's a *comparatively* benign event, but 
the question of what Rabbit should do in this case is still not obvious. 
Should it ignore the fact that the delete failed (and thus leak that 
file)? Should it maintain records of which deletions have failed with 
the intent of retrying them later? (And does that get persisted?) Should 
the message store hang until the file can be deleted? (That could be a 
long time, and you won't accept any new persistent messages until then.)

But it's worse than that - while Rabbit in general tries to open files 
and keep them open, it will close and reopen files when it is running 
low on file descriptors. If reopening (for example) a queue index file 
fails, it's *really* not obvious what our plan B could be.

Rabbit really needs to know that its files are under its control.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed May 30 11:56:35 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 30 May 2012 11:56:35 +0100
Subject: [rabbitmq-discuss] Per-Connection Flow Control -- The Case
	Against
In-Reply-To: <CANSL5VE0W_unc0fTsOaYsSqYD0fHDv7NnB5m_qOa3R=-gGv+Uw@mail.gmail.com>
References: <a6010e5e-a207-41e3-a45b-d9ab658a9292@h10g2000pbi.googlegroups.com>
	<4FBF771F.5090009@rabbitmq.com>
	<CANSL5VE0W_unc0fTsOaYsSqYD0fHDv7NnB5m_qOa3R=-gGv+Uw@mail.gmail.com>
Message-ID: <4FC5FCE3.9080102@rabbitmq.com>

On 30/05/12 06:52, Chip Salzenberg wrote:
> On Fri, May 25, 2012 at 5:12 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     In the mean time, I wonder whether 500 consumers and prefetch-count
>     of 2 is what you really want. Normally I would expect a
>     configuration like that when you expect to take some time to process
>     each message, but it sounds like you're going fast enough that
>     either 500 consumers are not needed, or prefetch-count > 2 might
>     lead to better performance.
>
>
> I didn't know that a larger prefetch count could reduce broker workload.
>   Per-message processing in this system is sometimes high (up to 20s),
> but it averages very low.  It's likely that 500 is overkill, but
> probably only by 2x or so.
>
> Assuming a constant throughput of about 6K/sec and at least 250 workers,
> what prefetch seems more helpful, IYO?  10?  20?

Well, there are two different things here that I somewhat conflated:

* Number of consumers using prefetch count
   - The higher this number, the more bookkeeping work the queue has
     to do.

* Size of prefetch count
   - The lower this number, the more likely that any given consumer will
     stall, and thus the slower consuming goes.

The "ideal" prefetch count is (network latency / average time to process 
each message). Lower than that and consumers will process all their 
messages, ack them, and then have to wait for more messages to arrive 
over the network.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jgunda at csc.com  Wed May 30 11:56:13 2012
From: jgunda at csc.com (Jagadeeshwar Gunda)
Date: Wed, 30 May 2012 16:26:13 +0530
Subject: [rabbitmq-discuss] Rabbit MQ memory is continuously  growing  up
Message-ID: <OFE0618C23.709A64AE-ON65257A0E.003BB7B6-65257A0E.003C1864@csc.com>

Hi,

I am using RabbitMQ ,
when ever i am posting messages and consuming messages the memory is 
increasing continuously growing up and it is not releasing memory.

After posting 1000 of messages my application is crashing, i am not able 
to move forward.

please help me to solve this issue.


Thanks & Regards,
Jagadeeshwar

CSC ? This is a PRIVATE message. If you are not the intended recipient, 
please delete without copying and kindly advise us by e-mail of the 
mistake in delivery.  NOTE: Regardless of content, this e-mail shall not 
operate to bind CSC to any order or other contract unless pursuant to 
explicit written agreement or government initiative expressly permitting 
the use of e-mail for such purpose ? Computer Sciences Corporation India 
Pvt Ltd ? 7th, Floor, Block 1B, DLF IT Park, Sivaji Garden, Nandambakkam 
Post, Ramapuram, Chennai-600 089.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120530/644ec692/attachment.htm>

From videlalvaro at gmail.com  Wed May 30 11:59:28 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 30 May 2012 12:59:28 +0200
Subject: [rabbitmq-discuss] Rabbit MQ memory is continuously growing up
In-Reply-To: <OFE0618C23.709A64AE-ON65257A0E.003BB7B6-65257A0E.003C1864@csc.com>
References: <OFE0618C23.709A64AE-ON65257A0E.003BB7B6-65257A0E.003C1864@csc.com>
Message-ID: <CAMcAHLWg7=6TUG9eACj0r-Q+7xdMuAZ=Z5bVP0s3sW33tbi5rw@mail.gmail.com>

Don't forget to post the Erlang Version, RabbitMQ Version, operating
system, client library, etc.

On Wed, May 30, 2012 at 12:56 PM, Jagadeeshwar Gunda <jgunda at csc.com> wrote:

> Hi,
>
> I am using RabbitMQ ,
> when ever i am posting messages and consuming messages the memory is
> increasing continuously growing up and it is not releasing memory.
>
> After posting 1000 of messages my application is crashing, i am not able
> to move forward.
>
> please help me to solve this issue.
>
>
> Thanks & Regards,
> Jagadeeshwar
>
> CSC ? This is a PRIVATE message. If you are not the intended recipient,
> please delete without copying and kindly advise us by e-mail of the mistake
> in delivery.  NOTE: Regardless of content, this e-mail shall not operate to
> bind CSC to any order or other contract unless pursuant to explicit written
> agreement or government initiative expressly permitting the use of e-mail
> for such purpose ? Computer Sciences Corporation India Pvt Ltd ? 7th,
> Floor, Block 1B, DLF IT Park, Sivaji Garden, Nandambakkam Post, Ramapuram,
> Chennai-600 089.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120530/8891b3a4/attachment.htm>

From simon at rabbitmq.com  Wed May 30 11:59:35 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 30 May 2012 11:59:35 +0100
Subject: [rabbitmq-discuss] Rabbit MQ memory is continuously growing up
In-Reply-To: <OFE0618C23.709A64AE-ON65257A0E.003BB7B6-65257A0E.003C1864@csc.com>
References: <OFE0618C23.709A64AE-ON65257A0E.003BB7B6-65257A0E.003C1864@csc.com>
Message-ID: <4FC5FD97.5000906@rabbitmq.com>

On 30/05/12 11:56, Jagadeeshwar Gunda wrote:
> when ever i am posting messages and consuming messages the memory is
> increasing continuously growing up and it is not releasing memory.
>
> After posting 1000 of messages my application is crashing, i am not able
> to move forward.

On the client or the server? If your application is crashing, presumably 
the client? Which client library / language are you using? Can you post 
sample code?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed May 30 12:01:56 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 30 May 2012 12:01:56 +0100
Subject: [rabbitmq-discuss] is the default administrator account
	too	weak?
In-Reply-To: <4FC34770.6030805@cloudwebdns.com>
References: <4FC32DCB.1090605@cloudwebdns.com> <4FC3461B.7080709@rabbitmq.com>
	<4FC34770.6030805@cloudwebdns.com>
Message-ID: <4FC5FE24.6080306@rabbitmq.com>

On 28/05/12 10:37, Cloud DNS wrote:
> What I think is, may you consider to setup the account stuff like mysql?
> With mysql, the root account can login only from localhost by default.

At the moment we don't have a way to connect logins and IP addresses. 
That might make a useful future enhancement.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jgunda at csc.com  Wed May 30 12:06:34 2012
From: jgunda at csc.com (Jagadeeshwar Gunda)
Date: Wed, 30 May 2012 16:36:34 +0530
Subject: [rabbitmq-discuss] Rabbit MQ memory is continuously growing up
In-Reply-To: <CAMcAHLWg7=6TUG9eACj0r-Q+7xdMuAZ=Z5bVP0s3sW33tbi5rw@mail.gmail.com>
References: <OFE0618C23.709A64AE-ON65257A0E.003BB7B6-65257A0E.003C1864@csc.com>
	<CAMcAHLWg7=6TUG9eACj0r-Q+7xdMuAZ=Z5bVP0s3sW33tbi5rw@mail.gmail.com>
Message-ID: <OFCE00A684.7848D522-ON65257A0E.003C813B-65257A0E.003D0B51@csc.com>

Hi 

I am using erl5.9 and rabbitmq_server-2.7.1 verstions with Spring 
AMQP(java client)


Below i am attaching my configuration and producer and consumer handler 
classes



Thanks & Regards,
Jagadeeshwar

CSC ? This is a PRIVATE message. If you are not the intended recipient, 
please delete without copying and kindly advise us by e-mail of the 
mistake in delivery.  NOTE: Regardless of content, this e-mail shall not 
operate to bind CSC to any order or other contract unless pursuant to 
explicit written agreement or government initiative expressly permitting 
the use of e-mail for such purpose ? Computer Sciences Corporation India 
Pvt Ltd ? 7th, Floor, Block 1B, DLF IT Park, Sivaji Garden, Nandambakkam 
Post, Ramapuram, Chennai-600 089.



From:   Alvaro Videla <videlalvaro at gmail.com>
To:     Jagadeeshwar Gunda/IND/CSC at CSC
Cc:     rabbitmq-discuss at lists.rabbitmq.com
Date:   05/30/2012 04:29 PM
Subject:        Re: [rabbitmq-discuss] Rabbit MQ memory is continuously 
growing up



Don't forget to post the Erlang Version, RabbitMQ Version, operating 
system, client library, etc.

On Wed, May 30, 2012 at 12:56 PM, Jagadeeshwar Gunda <jgunda at csc.com> 
wrote:
Hi, 

I am using RabbitMQ , 
when ever i am posting messages and consuming messages the memory is 
increasing continuously growing up and it is not releasing memory. 

After posting 1000 of messages my application is crashing, i am not able 
to move forward. 

please help me to solve this issue. 


Thanks & Regards,
Jagadeeshwar

CSC ? This is a PRIVATE message. If you are not the intended recipient, 
please delete without copying and kindly advise us by e-mail of the 
mistake in delivery.  NOTE: Regardless of content, this e-mail shall not 
operate to bind CSC to any order or other contract unless pursuant to 
explicit written agreement or government initiative expressly permitting 
the use of e-mail for such purpose ? Computer Sciences Corporation India 
Pvt Ltd ? 7th, Floor, Block 1B, DLF IT Park, Sivaji Garden, Nandambakkam 
Post, Ramapuram, Chennai-600 089. 
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120530/3279ad74/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitConfiguration.xml
Type: application/octet-stream
Size: 3466 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120530/3279ad74/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: MessageProducer.java
Type: application/octet-stream
Size: 1085 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120530/3279ad74/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: BatchLogHandler.java
Type: application/octet-stream
Size: 983 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120530/3279ad74/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ProducerConfiguration.java
Type: application/octet-stream
Size: 2795 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120530/3279ad74/attachment-0003.obj>

From matthias at rabbitmq.com  Wed May 30 12:09:12 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 30 May 2012 12:09:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ on RHEL on top of VMware ESX
In-Reply-To: <4FC4B4EB.3030608@klunky.co.uk>
References: <4FC4B4EB.3030608@klunky.co.uk>
Message-ID: <4FC5FFD8.2040204@rabbitmq.com>

Simon,

On 29/05/12 12:37, Simon Loewenthal wrote:
> How should the VMware servers be configured for running RabbitMQ to
> ensure good response.

I have asked my VMware colleagues to contact you.

Regards,

Matthias.

From oyvind at tjervaag.com  Wed May 30 13:33:32 2012
From: oyvind at tjervaag.com (=?iso-8859-1?Q?=D8yvind_Tjervaag?=)
Date: Wed, 30 May 2012 14:33:32 +0200
Subject: [rabbitmq-discuss] RabbitMQ stopping when trying to delete
	locked mnesia files?
In-Reply-To: <4FC5FB52.1090404@rabbitmq.com>
References: <220C32D4-3EB5-4032-A898-2FC2E0551260@tjervaag.com>
	<4FC5FB52.1090404@rabbitmq.com>
Message-ID: <A27BFD19-9FAF-4BC5-9BEC-AACBE6DD10CD@tjervaag.com>


On May 30, 2012, at 12:49 PM, Simon MacMullen wrote:

> On 29/05/12 13:01, ?yvind Tjervaag wrote:
> 
>> I'm running RabbitMQ version 2.8.2 and Erlang R15B01 on Windows 2008
>> R2 (64 bit). Now, I've told the IT-ops-people to stop locking any
>> files in the mnesia folder, but I think RabbitMQ should not fail this
>> badly when it tries deleting a locked file?
> 
> Hmm. We do in general assume that file operations on files owned by Rabbit will succeed; it's hard to know in the general case what else to do.

Agreed.

> In the crash that you're seeing, Rabbit was not able to delete an old file from the message store. That's a *comparatively* benign event, but the question of what Rabbit should do in this case is still not obvious. Should it ignore the fact that the delete failed (and thus leak that file)? Should it maintain records of which deletions have failed with the intent of retrying them later? (And does that get persisted?) Should the message store hang until the file can be deleted? (That could be a long time, and you won't accept any new persistent messages until then.)
> 
> But it's worse than that - while Rabbit in general tries to open files and keep them open, it will close and reopen files when it is running low on file descriptors. If reopening (for example) a queue index file fails, it's *really* not obvious what our plan B could be.

I definitely see that the issue is bigger than I first though it was, I just thought it should crash as seldom as possible ;).

> Rabbit really needs to know that its files are under its control.

Now that I know I'll be more careful letting the people in charge of backups and virus-scans know not to touch the files! 

Thanks,
?yvind

From pgross at gmail.com  Wed May 30 16:00:47 2012
From: pgross at gmail.com (Paul Gross)
Date: Wed, 30 May 2012 10:00:47 -0500
Subject: [rabbitmq-discuss] RabbmitMQ consuming CPU and Memory
In-Reply-To: <4FBA7E82.1030002@gmail.com>
References: <4FABE167.9080900@gmail.com> <4FABE7B9.5010509@rabbitmq.com>
	<4FB15399.9090504@gmail.com> <4FB34F38.2080507@rabbitmq.com>
	<4FB6888F.6050904@gmail.com> <4FBA0DCE.1080705@rabbitmq.com>
	<4FBA7E82.1030002@gmail.com>
Message-ID: <4FC6361F.50402@gmail.com>


>>>
>>> Unfortunately, by the time I was able to ssh into the server to run
>>> rabbitmqctl report, it said nodedown.
>>
>> That's a shame. Would be really good to catch it early enough to 
>> still get some useful output from rabbitmqctl.
>>
>
We set up a cron job to run "rabbitmqctl report" every 5 minutes. Here 
is the last report before CPU and memory spiked:

Status of node 'rabbit at bt-ci-rabbitmq' ...
[{pid,9152},
  {running_applications,[{rabbit,"RabbitMQ","2.8.2"},
                         {os_mon,"CPO  CXC 138 46","2.2.9"},
                         {sasl,"SASL  CXC 138 11","2.2.1"},
                         {mnesia,"MNESIA  CXC 138 12","4.7"},
                         {stdlib,"ERTS  CXC 138 10","1.18.1"},
                         {kernel,"ERTS  CXC 138 10","2.15.1"}]},
  {os,{unix,linux}},
  {erlang_version,"Erlang R15B01 (erts-5.9.1) [source] [64-bit] 
[smp:4:4] [async-threads:30] [hipe] [kernel-poll:true]\n"},
  {memory,[{total,1913089696},
           {processes,1890368996},
           {processes_used,1890265582},
           {system,22720700},
           {atom,586345},
           {atom_used,566016},
           {binary,5413240},
           {code,11905478},
           {ets,1274712}]},
  {vm_memory_high_watermark,0.19999999923056544},
  {vm_memory_limit,207944908},
  {disk_free_limit,1039724544},
  {disk_free,38008365056},
  {file_descriptors,[{total_limit,924},
                     {total_used,10},
                     {sockets_limit,829},
                     {sockets_used,6}]},
  {processes,[{limit,1048576},{used,787}]},
  {run_queue,261},
  {uptime,370840}]

Cluster status of node 'rabbit at bt-ci-rabbitmq' ...
[{nodes,[{disc,['rabbit at bt-ci-rabbitmq']}]},
  {running_nodes,['rabbit at bt-ci-rabbitmq']}]

Application environment of node 'rabbit at bt-ci-rabbitmq' ...
[{auth_backends,[rabbit_auth_backend_internal]},
  {auth_mechanisms,['PLAIN','AMQPLAIN']},
  {backing_queue_module,rabbit_variable_queue},
  {cluster_nodes,[]},
  {collect_statistics,none},
  {collect_statistics_interval,5000},
  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
  {default_user,<<"guest">>},
  {default_user_tags,[administrator]},
  {default_vhost,<<"/">>},
  {delegate_count,16},
{disk_free_limit,{mem_relative,1.0}},
  {error_logger,{file,"/var/log/rabbitmq/rabbit at bt-ci-rabbitmq.log"}},
  {frame_max,131072},
  {hipe_compile,false},
  {included_applications,[]},
  {log_levels,[{connection,info}]},
  {msg_store_file_size_limit,16777216},
  {msg_store_index_module,rabbit_msg_store_ets_index},
  {queue_index_max_journal_entries,262144},
  {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at bt-ci-rabbitmq-sasl.log"}},
  {server_properties,[]},
  {ssl_cert_login_from,distinguished_name},
  {ssl_listeners,[]},
  {ssl_options,[]},
  {tcp_listen_options,[binary,
                       {packet,raw},
                       {reuseaddr,true},
                       {backlog,128},
                       {nodelay,true},
                       {linger,{true,0}},
                       {exit_on_close,false}]},
  {tcp_listeners,[5672]},
  {trace_vhosts,[]},
  {vm_memory_high_watermark,0.2}]

Connections:
pid     name    address port    peer_address    peer_port       ssl     
peer_cert_subject       peer_cert_issuer        peer_cert_validity      
auth_mechanism  ssl_protocol    ssl_key_exchange        ssl_cipher      
ssl_hash        protocol        user    vhost   timeout frame_max       
client_properties       recv_oct        recv_cnt        send_oct        
send_cnt        send_pend       state   last_blocked_by 
last_blocked_age        channels
<'rabbit at bt-ci-rabbitmq'.3.28408.1>     173.230.134.179:50847 -> 
50.116.38.166:5672     50.116.38.166   5672    173.230.134.179 50847   
false                           AMQPLAIN
                 {0,8,0} guest   /       0       131072  
[{"version","0.7.9"},{"platform","Ruby"},{"product","Bunny"},{"information","http://github.com/ruby-amqp/bunny"}]       
3805    7       346     6
        0       blocked resource        77.960635       1
<'rabbit at bt-ci-rabbitmq'.3.28432.1>     173.230.134.179:50962 -> 
50.116.38.166:5672     50.116.38.166   5672    173.230.134.179 50962   
false                           AMQPLAIN
                 {0,8,0} guest   /       0       131072  
[{"version","0.7.9"},{"platform","Ruby"},{"product","Bunny"},{"information","http://github.com/ruby-amqp/bunny"}]       
345     7       346     6
        0       blocked resource        63.68709        1
<'rabbit at bt-ci-rabbitmq'.3.28416.1>     173.230.134.179:50945 -> 
50.116.38.166:5672     50.116.38.166   5672    173.230.134.179 50945   
false                           AMQPLAIN
                 {0,8,0} guest   /       0       131072  
[{"version","0.7.9"},{"platform","Ruby"},{"product","Bunny"},{"information","http://github.com/ruby-amqp/bunny"}]       
345     7       346     6
        0       blocked resource        65.714869       1
<'rabbit at bt-ci-rabbitmq'.3.28400.1>     173.230.134.179:50817 -> 
50.116.38.166:5672     50.116.38.166   5672    173.230.134.179 50817   
false                           AMQPLAIN
                 {0,8,0} guest   /       0       131072  
[{"version","0.7.9"},{"platform","Ruby"},{"product","Bunny"},{"information","http://github.com/ruby-amqp/bunny"}]       
3805    7       346     6
        0       blocked resource        79.666493       1
<'rabbit at bt-ci-rabbitmq'.3.28424.1>     173.230.134.179:50949 -> 
50.116.38.166:5672     50.116.38.166   5672    173.230.134.179 50949   
false                           AMQPLAIN
                 {0,8,0} guest   /       0       131072  
[{"version","0.7.9"},{"platform","Ruby"},{"product","Bunny"},{"information","http://github.com/ruby-amqp/bunny"}]       
345     7       346     6
        0       blocked resource        64.824581       1

Channels:
pid     name    connection      number  user    vhost   transactional   
confirm consumer_count  messages_unacknowledged messages_unconfirmed    
messages_uncommitted    acks_uncommitted        prefetch_count  
client_flow_blocked
<'rabbit at bt-ci-rabbitmq'.3.28404.1>     173.230.134.179:50817 -> 
50.116.38.166:5672 (1) <'rabbit at bt-ci-rabbitmq'.3.28400.1>     1       
guest   /       false   false   0       0       0       0       0
        0       false
<'rabbit at bt-ci-rabbitmq'.3.28412.1>     173.230.134.179:50847 -> 
50.116.38.166:5672 (1) <'rabbit at bt-ci-rabbitmq'.3.28408.1>     1       
guest   /       false   false   0       0       0       0       0
        0       false
<'rabbit at bt-ci-rabbitmq'.3.28420.1>     173.230.134.179:50945 -> 
50.116.38.166:5672 (1) <'rabbit at bt-ci-rabbitmq'.3.28416.1>     1       
guest   /       false   false   0       0       0       0       0
        0       false
<'rabbit at bt-ci-rabbitmq'.3.28428.1>     173.230.134.179:50949 -> 
50.116.38.166:5672 (1) <'rabbit at bt-ci-rabbitmq'.3.28424.1>     1       
guest   /       false   false   0       0       0       0       0
        0       false
<'rabbit at bt-ci-rabbitmq'.3.28436.1>     173.230.134.179:50962 -> 
50.116.38.166:5672 (1) <'rabbit at bt-ci-rabbitmq'.3.28432.1>     1       
guest   /       false   false   0       0       0       0       0
        0       false

Queues on /:
pid     name    durable auto_delete     arguments       owner_pid       
slave_pids      synchronised_slave_pids exclusive_consumer_pid  
exclusive_consumer_tag  messages_ready  messages_unacknowledged 
messages        consumers       memory  backing_queue_status
<'rabbit at bt-ci-rabbitmq'.3.26809.1>     gateway_master_test     true    
false   [{"x-ha-policy","all"}]         []      []                      
131     0       131     0       143008  [{q1,0}, {q2,0}, 
{delta,{delta,undefined,0,undefined}}, {q3,131}, {q4,0}, {len,131}, 
{pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, 
{ram_ack_count,0}, {next_seq_id,131}, {persistent_count,131}, 
{avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, 
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}, {mirror_seen,0}, 
{mirror_senders,0}]
<'rabbit at bt-ci-rabbitmq'.3.19773.1>     gateway_release_test    true    
false   [{"x-ha-policy","all"}]         []      []                      
59      0       59      0       88888   [{q1,0}, {q2,0}, 
{delta,{delta,undefined,0,undefined}}, {q3,59}, {q4,0}, {len,59}, 
{pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, 
{ram_ack_count,0}, {next_seq_id,59}, {persistent_count,59}, 
{avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, 
{avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}, {mirror_seen,0}, 
{mirror_senders,0}]

Exchanges on /:
name    type    durable auto_delete     internal        arguments
amq.direct      direct  true    false   false   []
amq.topic       topic   true    false   false   []
amq.rabbitmq.trace      topic   true    false   false   []
amq.rabbitmq.log        topic   true    false   false   []
amq.fanout      fanout  true    false   false   []
amq.headers     headers true    false   false   []
         direct  true    false   false   []
amq.match       headers true    false   false   []

Bindings on /:
source_name     source_kind     destination_name        
destination_kind        routing_key     arguments
         exchange        gateway_master_test     queue   
gateway_master_test     []
         exchange        gateway_release_test    queue   
gateway_release_test    []

Consumers on /:

Permissions on /:
user    configure       write   read
guest   .*      .*      .*

End of server status report
...done.


From rev.chip at gmail.com  Wed May 30 17:45:36 2012
From: rev.chip at gmail.com (Reverend Chip)
Date: Wed, 30 May 2012 09:45:36 -0700
Subject: [rabbitmq-discuss] Per-Connection Flow Control -- The Case
	Against
In-Reply-To: <4FC5FCE3.9080102@rabbitmq.com>
References: <a6010e5e-a207-41e3-a45b-d9ab658a9292@h10g2000pbi.googlegroups.com>
	<4FBF771F.5090009@rabbitmq.com>
	<CANSL5VE0W_unc0fTsOaYsSqYD0fHDv7NnB5m_qOa3R=-gGv+Uw@mail.gmail.com>
	<4FC5FCE3.9080102@rabbitmq.com>
Message-ID: <4FC64EB0.7070304@gmail.com>

On 5/30/2012 3:56 AM, Simon MacMullen wrote:
> On 30/05/12 06:52, Chip Salzenberg wrote:
>> On Fri, May 25, 2012 at 5:12 AM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     In the mean time, I wonder whether 500 consumers and prefetch-count
>>     of 2 is what you really want. Normally I would expect a
>>     configuration like that when you expect to take some time to process
>>     each message, but it sounds like you're going fast enough that
>>     either 500 consumers are not needed, or prefetch-count > 2 might
>>     lead to better performance.
>>
>>
>> I didn't know that a larger prefetch count could reduce broker workload.
>>   Per-message processing in this system is sometimes high (up to 20s),
>> but it averages very low.  It's likely that 500 is overkill, but
>> probably only by 2x or so.
>>
>> Assuming a constant throughput of about 6K/sec and at least 250 workers,
>> what prefetch seems more helpful, IYO?  10?  20?
>
> Well, there are two different things here that I somewhat conflated:
>
> * Number of consumers using prefetch count
>   - The higher this number, the more bookkeeping work the queue has
>     to do.
>
> * Size of prefetch count
>   - The lower this number, the more likely that any given consumer will
>     stall, and thus the slower consuming goes.

Ah.  Well, throughput is not our problem, flow control on publish is. 
So the latter issue is off the table.  The former issue should be
negligible; what modern software has trouble tracking 500 queue depths?

Meanwhile, consider this.  In our system, when stalls happened so
uselessly, actually had 2 queues bound to the exchange.  And it was
definitely the flow control kicking in and not the queue becoming
overwhelmed because a) it said "flow" in the ui. b) both queues were
blocked, not just the one that had tons of consumers starting on it. The
flow control is failing worse than I had already described because if
prevents other queues bound to the same exchange from getting any
messages even if they are empty.


From iceblaze at gmail.com  Wed May 30 20:46:27 2012
From: iceblaze at gmail.com (iceblaze)
Date: Wed, 30 May 2012 12:46:27 -0700
Subject: [rabbitmq-discuss] Net::RabbitMQ::get() fails with unexpected
	header?
Message-ID: <CA+-WFvzYbGh6FY7+aKxPnxpfnHUTV=V-tr3iFnj1_ak9Rj6nPA@mail.gmail.com>

Hello,

I am attempting to run the function as follows:


                try {
                        $successful = 1;
                        $msg = $self->{_rabbit}->get($self->{_channel},
$self->{_queue});
                } catch {
                        $successful = 0;
                        $self->error_handler("get - $_");
                };

which should work, and this does work when i use recv(), but when I try to
use get()


        F::Rabbit::__ANON__('Unexpected header 1! at F/Rabbit.pm line...')
called at /usr/lib/perl5/site_perl/5.8.8/Try/Tiny.pm line 100

Does anyone know what the unexpected header could be, or how I can go about
troubleshooting this?

Thanks!

-James

-- 
"Of course, the actual government of any computer is run by that fascist
dictator known as the operating system. But a wise dictator knows when to
let the people think they're capitalists--and when to let them think
they're communists." - Programming Perl third edition
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120530/c9061db9/attachment.htm>

From asinghal79 at gmail.com  Wed May 30 22:32:28 2012
From: asinghal79 at gmail.com (Aishwarya Singhal)
Date: Thu, 31 May 2012 03:02:28 +0530
Subject: [rabbitmq-discuss] Urgent issue with rabbitmq
In-Reply-To: <4FC5EDF8.9030807@rabbitmq.com>
References: <CAJHaMpYhS9r3vD7_4JWzQM0aU82MXH+qxC=B9CaK1NgshYOqUA@mail.gmail.com>
	<4FC5C29A.4050408@rabbitmq.com>
	<CAJHaMpY438nyCTwjzG9UkvB5BRK+y=9_ns-qgmeRvm-q6J5Ciw@mail.gmail.com>
	<4FC5D8B7.2010101@rabbitmq.com>
	<CAJHaMpbtvUA8VYi-9FfPZ+pfRAvug2DSA5VQCGeRNXr_eDCjfg@mail.gmail.com>
	<4FC5E389.3030505@rabbitmq.com>
	<CAJHaMpbnujaFUAfxyfeXEV3fT1XbpA62KzguVgD1UVgUw8PO3Q@mail.gmail.com>
	<4FC5E841.30806@rabbitmq.com>
	<CAJHaMpbZH_hdSH51VvsBGvDLSikSM2vaB3gmdd7drrjVwD5Xcg@mail.gmail.com>
	<4FC5EDF8.9030807@rabbitmq.com>
Message-ID: <CAJHaMpb_2i9JCweuSHuq+Q4t6akbcOzibcyb+MXiHZ-tSUisMg@mail.gmail.com>

Thanks. I tried to compile the latest erlang (been running for the past 6
hrs), it brought down my production instance as it ate up all CPU, and have
now given up. I guess I'll wait for somebody to upload a AWS 64 bit image
for v15 before I could use Rabbit.

its sad, because there's an image available for my mac on brew and it works
fine on my local. just doesn't work where it should :-)

Thanks for your help anyways.

Best

On Wed, May 30, 2012 at 3:22 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Aishwarya,
>
>
> On 30/05/12 10:33, Aishwarya Singhal wrote:
>
>> Sent you the report privately.
>>
>
> Cheers. So this really looks like a completely empty and idle rabbit,
> except...
>
>
>  {erlang_version,
>     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1]
> [async-threads:30] [kernel-poll:true]\n"},
>  {memory,
>     [{total,306408648},
>      {processes,12476936},
>      {processes_used,12469184},
>      {system,293931712},
>      {atom,1541561},
>      {atom_used,1527197},
>      {binary,178280},
>      {code,17373488},
>      {ets,1130368}]},
>
> ...for some unknown reason there are 293M of system memory allocated.
>
> A few things are worth trying:
>
> 1) disable the management plug-in
>
> 2) upgrade Erlang to R15B01
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120531/15daed8c/attachment.htm>

From sujandutta at gmail.com  Thu May 31 07:34:08 2012
From: sujandutta at gmail.com (Sujan Dutta)
Date: Thu, 31 May 2012 12:04:08 +0530
Subject: [rabbitmq-discuss] custom exchange
Message-ID: <CABUC-UD+YM7foqcgOa=+Pjr8dqGC8K6j=qG4EwjSbEXFDcSDMw@mail.gmail.com>

We have a custom exchange, which work great.

Now my requirement is that - Add a custom header to the every messages
which is delivered through the custom exchange.

Anybody can help me ?

-- 
Sujan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120531/92a1d9f2/attachment.htm>

From ws_dev2001 at yahoo.com  Wed May 30 20:44:29 2012
From: ws_dev2001 at yahoo.com (ws_dev2001)
Date: Wed, 30 May 2012 12:44:29 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq admin - read message as text/string
 etc..
Message-ID: <33934314.post@talk.nabble.com>


Hi,
I am trying to read the message contents/payload of published messages from
my queue. however, as per the script, encoding other than auto/base64 is not
supported. Can someone help on this ?
BTW, Line 90 on said script (rabbitmqadmin) does not have 'encoding' listed
as a parameter (mandatory/optional). Local fix followed but I can't see the
text of the message in the queue using the rabbitmqadmin cli.

TIA,
R2D2,
-- 
View this message in context: http://old.nabble.com/Rabbitmq-admin---read-message-as-text-string-etc..-tp33934314p33934314.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Thu May 31 10:56:31 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 31 May 2012 10:56:31 +0100
Subject: [rabbitmq-discuss] custom exchange
In-Reply-To: <CABUC-UD+YM7foqcgOa=+Pjr8dqGC8K6j=qG4EwjSbEXFDcSDMw@mail.gmail.com>
References: <CABUC-UD+YM7foqcgOa=+Pjr8dqGC8K6j=qG4EwjSbEXFDcSDMw@mail.gmail.com>
Message-ID: <4FC7404F.1090205@rabbitmq.com>

On 31/05/12 07:34, Sujan Dutta wrote:
> Now my requirement is that - Add a custom header to the every messages
> which is delivered through the custom exchange.

I'm afraid there isn't a general API for that.

The problem is that exchanges are just for routing - in a complex 
exchange-to-exchange scenario where a message gets routed like:

  /--> X2 --\
  |          v
  X1         X4 --> Q
  |          ^
  \--> X3 --/

only one copy of the message ends up in Q - so did it pass through X2 or 
X3? Which one has the right to modify it?

Having said that, if you know that you *won't* be using such complex 
routing, you could do this by:

route(X, Delivery) ->
     case custom_header_exists(Delivery) of
         true  -> route_as_normal(Delivery);
         false -> rabbit_basic:publish(X, add_custom_header(Delivery)),
                  []
     end.

i.e. if the header needs to be added, don't route it at all, but instead 
republish it to yourself with the header added.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu May 31 11:24:53 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 31 May 2012 11:24:53 +0100
Subject: [rabbitmq-discuss] Rabbitmq admin - read message as text/string
 etc..
In-Reply-To: <33934314.post@talk.nabble.com>
References: <33934314.post@talk.nabble.com>
Message-ID: <4FC746F5.5040308@rabbitmq.com>

On 30/05/12 20:44, ws_dev2001 wrote:
> BTW, Line 90 on said script (rabbitmqadmin) does not have 'encoding' listed
> as a parameter (mandatory/optional). Local fix followed but I can't see the
> text of the message in the queue using the rabbitmqadmin cli.

This was fixed in 2.8.0; "rabbitmqadmin get" was just broken before that 
I'm afraid. If you don't want to upgrade your server you can just grab 
the latest released rabbitmqadmin from:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_8_2/bin/rabbitmqadmin

Since in general the HTTP API does not change much it should be compatible.

> I am trying to read the message contents/payload of published messages from
> my queue. however, as per the script, encoding other than auto/base64 is not
> supported. Can someone help on this ?

However, it's worth noting that auto and base64 are the only encodings 
supported by the HTTP API - we can't force a message body to be a string 
if it isn't.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mike.giardinelli at gmail.com  Thu May 31 14:54:16 2012
From: mike.giardinelli at gmail.com (Scarpacci)
Date: Thu, 31 May 2012 06:54:16 -0700 (PDT)
Subject: [rabbitmq-discuss]  What do you need to have for RabbitMQ client?
Message-ID: <33938448.post@talk.nabble.com>


Hi All,

In order to send / receive messages to RabbitMQ server is all that you need
to have is one of the RabbitMQ clients (Java, .Net, Python, etc)? Once you
have those then the exchange is available? 

All of the prototypes I have played with had RabbitMQ server installed on
the same machine. Just trying to understand that piece.

Obviously still very ignorant with RabbitMQ.

Thanks,

S
-- 
View this message in context: http://old.nabble.com/What-do-you-need-to-have-for-RabbitMQ-client--tp33938448p33938448.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


