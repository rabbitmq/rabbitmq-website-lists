<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Behaviour of Federated Queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Behaviour%20of%20Federated%20Queues&In-Reply-To=%3C52E25A9F.2090802%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033294.html">
   <LINK REL="Next"  HREF="033320.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Behaviour of Federated Queues</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Behaviour%20of%20Federated%20Queues&In-Reply-To=%3C52E25A9F.2090802%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Behaviour of Federated Queues">simon at rabbitmq.com
       </A><BR>
    <I>Fri Jan 24 12:20:47 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033294.html">[rabbitmq-discuss] Behaviour of Federated Queues
</A></li>
        <LI>Next message: <A HREF="033320.html">[rabbitmq-discuss] Behaviour of Federated Queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33317">[ date ]</a>
              <a href="thread.html#33317">[ thread ]</a>
              <a href="subject.html#33317">[ subject ]</a>
              <a href="author.html#33317">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 23/01/2014 16:16, Josh West wrote:
&gt;<i> I have a question regarding the behaviour of federated queues...
</I>
&lt;snip&gt;

&gt;<i> I have noticed that if I create a queue on broker1 with name
</I>&gt;<i> &quot;broker1.foo.bar&quot; (for example), the queue is automatically created on
</I>&gt;<i> broker2 and broker3.  Should this occur?  Or should federation only
</I>&gt;<i> create the queue on upstream brokers when needed (ad-hoc)?
</I>
It should occur. I'm not sure when 'needed' would be; when you publish 
to it?

If your aim is to make sure that you can publish anywhere and have the 
publishing application determine which node the message ends up on, you 
might find that exchange federation works better for you; have a single 
federated exchange and bind (unfederated) queues to it with routing keys 
like broker1.*.

Not that federated queues are necessarily bad in this scenario, but yes, 
you'll have a lot of queues around.

&gt;<i> I ask for two reasons:
</I>&gt;<i>
</I>&gt;<i> 1. This could be a waste of resources if one has lots of queues matching
</I>&gt;<i> federation patterns or if one has say 200+ brokers federated with each
</I>&gt;<i> other.
</I>
200 queues is not actually a huge number. Plenty of people have many 
thousands of queues.

&gt;<i> 2. When queues are created with the Auto Delete parameter, that
</I>&gt;<i> parameter is of course properly propagated.  But say a client puts a
</I>&gt;<i> message into the queue &quot;broker1.foo.bar&quot; on broker2 and say a client
</I>&gt;<i> retrieves the message from that same queue on broker1.  The Auto Delete
</I>&gt;<i> parameter behaviour would be triggered and the queue is then deleted
</I>&gt;<i> from broker1 and broker2 (upon client disconnection). But... Since
</I>&gt;<i> nobody has ever put any messages into the queue &quot;broker1.foo.bar&quot;
</I>&gt;<i> residing on broker3, the queue will remain defined possibly indefinitely.
</I>
That's not how autodelete works - queues autodelete when their last 
consumer goes away, regardless of whether messages have been published 
to them.

So I see this working correctly - when a consumer consumes from 
broker1.foo.bar on broker1, that consumer gets propagated to 
broker1.foo.bar on broker3. When the consumer is cancelled, cancel is 
also propagated and both queues delete.

However, I think there is the opposite problem around auto-delete and 
queue federation - since the federation mechanism controls message flow 
by consuming and cancelling from the upstream, it could cause federated 
autodelete queues to delete themselves too early.

I'm not sure what, if anything, can be done about that. It might be that 
autodelete and queue federation just don't work well together.

Cheers, Simon
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033294.html">[rabbitmq-discuss] Behaviour of Federated Queues
</A></li>
	<LI>Next message: <A HREF="033320.html">[rabbitmq-discuss] Behaviour of Federated Queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33317">[ date ]</a>
              <a href="thread.html#33317">[ thread ]</a>
              <a href="subject.html#33317">[ subject ]</a>
              <a href="author.html#33317">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
