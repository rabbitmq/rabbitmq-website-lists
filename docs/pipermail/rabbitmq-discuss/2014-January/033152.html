<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Dead-Lettering Queue Contents On Queue	Expiration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Dead-Lettering%20Queue%20Contents%20On%20Queue%0A%09Expiration&In-Reply-To=%3CCABWF3X1Jq_%2B9aN-tFO7_hgoYHr0iyz6mC40dnA%2BAkR%3DtZjsNSg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033101.html">
   <LINK REL="Next"  HREF="033354.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Dead-Lettering Queue Contents On Queue	Expiration</H1>
    <B>Alex Robson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Dead-Lettering%20Queue%20Contents%20On%20Queue%0A%09Expiration&In-Reply-To=%3CCABWF3X1Jq_%2B9aN-tFO7_hgoYHr0iyz6mC40dnA%2BAkR%3DtZjsNSg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Dead-Lettering Queue Contents On Queue	Expiration">asrobson at gmail.com
       </A><BR>
    <I>Fri Jan 17 22:08:15 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033101.html">[rabbitmq-discuss] Dead-Lettering Queue Contents On Queue	Expiration
</A></li>
        <LI>Next message: <A HREF="033354.html">[rabbitmq-discuss] Dead-Lettering Queue Contents On Queue	Expiration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33152">[ date ]</a>
              <a href="thread.html#33152">[ thread ]</a>
              <a href="subject.html#33152">[ subject ]</a>
              <a href="author.html#33152">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have updated the pull request. I jumped the gun a bit in thinking that I
had solved this with the initial pull. I still may not have resolved it in
a way that would make sense to devs who know the code base better than I
do. I wasn't sure if there were a better way to remove bindings from an
expiring queue and its DLX, so I'm removing them first from the destination
using rabbit_binding:remove_for_destination and then calling the exchanges
remove_bindings. The latter call is necessary because with out it, a
consistent hash exchange will retain invalid routes and continue to try and
route messages to the expired queue.

Let me know what you think. If there are things I can do to improve it well
enough for consideration, I am happy to do them. I also don't expect I'd
have any problems signing a CLA if you're interested in the PR. I
understand there could be performance implications if one allows a queue to
grow to a massive number of messages and then expires the queue, however,
as I mention in the PR, I can recreate a similar scenario with DLXs and
message TTLs. I think with this kind of system, there's some caveat emptor
in how one manages things like queue depth. In our scenario, the only real
reason for a queue's depth to get large is when a consumer bites the dust.
Having a short TTL on a queue would actually allow us to expire the queue
quickly to prevent an explosion of messages that suddenly have no consumer
(and may never have again).

If the performance considerations make this too rubbishy for inclusion, let
me know. Willing to help out any way I can but also just as willing to step
back and let the pros handle it.

Thanks,
Alex


On Thu, Jan 16, 2014 at 5:25 AM, Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mklishin at gopivotal.com</A>&gt;wrote:

&gt;<i>
</I>&gt;<i> On 16 Jan 2014, at 14:56, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; If you want to send us a PR then that's great, but please be aware that
</I>&gt;<i> a) you'd need to sign a contributor agreement and b) it might be harder
</I>&gt;<i> than you think. But c) it might not :-)
</I>&gt;<i>
</I>&gt;<i> FTR:
</I>&gt;<i> <A HREF="https://github.com/rabbitmq/rabbitmq-server/pull/29/files">https://github.com/rabbitmq/rabbitmq-server/pull/29/files</A>
</I>&gt;<i>
</I>&gt;<i> MK
</I>&gt;<i>
</I>&gt;<i> Software Engineer, Pivotal/RabbitMQ
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140117/fc95f475/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140117/fc95f475/attachment.html</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033101.html">[rabbitmq-discuss] Dead-Lettering Queue Contents On Queue	Expiration
</A></li>
	<LI>Next message: <A HREF="033354.html">[rabbitmq-discuss] Dead-Lettering Queue Contents On Queue	Expiration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33152">[ date ]</a>
              <a href="thread.html#33152">[ thread ]</a>
              <a href="subject.html#33152">[ subject ]</a>
              <a href="author.html#33152">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
