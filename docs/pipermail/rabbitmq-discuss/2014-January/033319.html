<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20hangs%2C%20does%20not%20accept%20connections&In-Reply-To=%3CCANTUpDAnX7OGpu0HTNUje7uGaA_G8r6yVFDj3Riba1qtDhXaYw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033254.html">
   <LINK REL="Next"  HREF="033396.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ hangs, does not accept connections</H1>
    <B>Dimitri Minaev</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20hangs%2C%20does%20not%20accept%20connections&In-Reply-To=%3CCANTUpDAnX7OGpu0HTNUje7uGaA_G8r6yVFDj3Riba1qtDhXaYw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ hangs, does not accept connections">minaev at gmail.com
       </A><BR>
    <I>Fri Jan 24 13:06:40 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033254.html">[rabbitmq-discuss] RabbitMQ hangs, does not accept connections
</A></li>
        <LI>Next message: <A HREF="033396.html">[rabbitmq-discuss] RabbitMQ hangs, does not accept connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33319">[ date ]</a>
              <a href="thread.html#33319">[ thread ]</a>
              <a href="subject.html#33319">[ subject ]</a>
              <a href="author.html#33319">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, Maulik,

I believe, your problem is a different one, because the bug was gone since
we had upgraded to 2.8.7. The final message from the support service was:

&gt;<i> The Erlang/OTP team believe that the problem was due to a bug in their
</I>code. A small change introduced in RabbitMQ 2.8.7 had the coincidental
fortunate effect of bypassing the bug, so the problem should not occur in
2.8.7 or later versions of RabbitMQ.

Good luck!



On 22 January 2014 17:29, maulik thaker &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">maulik.mihir at gmail.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> Hi Dmitri Minaev,
</I>&gt;<i>
</I>&gt;<i>         I am facing same problem with rabbitmq 3.2.2 ( I have gone through
</I>&gt;<i> this thread and already checked memory and number of file-descriptors are
</I>&gt;<i> not causing the problem). If you have solved that problem then please share
</I>&gt;<i> the solution.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Maulik
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Monday, 26 March 2012 11:15:45 UTC+5:30, Dmitri Minaev wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 9 March 2012 16:37, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">si... at rabbitmq.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt; On 09/03/12 07:57, Dmitri Minaev wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt;&gt; If I understand correctly, the number of file descriptors used by
</I>&gt;&gt;<i> &gt;&gt; RabbitMQ in normal situation is roughly equal to the number of
</I>&gt;&gt;<i> &gt;&gt; `rabbitmqctl list_connections` + some constant (~30)? In case of that
</I>&gt;&gt;<i> &gt;&gt; hanging server, the number of AMQP connections never was close to the
</I>&gt;&gt;<i> &gt;&gt; FD limit (ulimit -n is 1024, fs.file-max = 1605698). The graph
</I>&gt;&gt;<i> &gt;&gt; reflecting  the number of open AMQP connections is attached to this
</I>&gt;&gt;<i> &gt;&gt; message.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; It's not really a constant, but to a first approximation, yes.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Ultimately, the error I saw being passed up from the OS was ENFILE -
</I>&gt;&gt;<i> that's
</I>&gt;&gt;<i> &gt; pretty unambiguous :)
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; It's possible that if you're churning connections then &quot;closed&quot;
</I>&gt;&gt;<i> connections
</I>&gt;&gt;<i> &gt; in FIN_WAIT2 could account for the majority of the used FDs. In 2.8.0
</I>&gt;&gt;<i> we'll
</I>&gt;&gt;<i> &gt; set SO_LINGER to 0 to prevent this.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am still not sure about the role of the file descriptors in this
</I>&gt;&gt;<i> event. Last Friday, our Rabbit died again. Until the very last moment
</I>&gt;&gt;<i> the number of open file descriptors as reported by the management
</I>&gt;&gt;<i> plugin was 143 out of the total available number of 32765. It was
</I>&gt;&gt;<i> RabbitMQ v.2.7.0. On that same day I have upgraded to 2.8.1. Will
</I>&gt;&gt;<i> report on its behaviour later.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> With best regards,
</I>&gt;&gt;<i> Dmitri Minaev
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq... at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>

-- 
With best regards,
Dimitri Minaev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140124/d65236f1/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140124/d65236f1/attachment.html</A>&gt;
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033254.html">[rabbitmq-discuss] RabbitMQ hangs, does not accept connections
</A></li>
	<LI>Next message: <A HREF="033396.html">[rabbitmq-discuss] RabbitMQ hangs, does not accept connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33319">[ date ]</a>
              <a href="thread.html#33319">[ thread ]</a>
              <a href="subject.html#33319">[ subject ]</a>
              <a href="author.html#33319">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
