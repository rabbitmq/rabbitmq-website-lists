<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Scaling single queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Scaling%20single%20queues&In-Reply-To=%3Cc2fb26130afc4857b002485f347013cd%40CO1PR07MB331.namprd07.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032881.html">
   <LINK REL="Next"  HREF="032872.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Scaling single queues</H1>
    <B>Michael Giagnocavo</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Scaling%20single%20queues&In-Reply-To=%3Cc2fb26130afc4857b002485f347013cd%40CO1PR07MB331.namprd07.prod.outlook.com%3E"
       TITLE="[rabbitmq-discuss] Scaling single queues">mgg at giagnocavo.net
       </A><BR>
    <I>Mon Jan  6 20:13:14 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="032881.html">[rabbitmq-discuss] Scaling single queues
</A></li>
        <LI>Next message: <A HREF="032872.html">[rabbitmq-discuss] Scaling rabbitmq on ec2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32883">[ date ]</a>
              <a href="thread.html#32883">[ thread ]</a>
              <a href="subject.html#32883">[ subject ]</a>
              <a href="author.html#32883">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;<i> The messages are under 300 bytes, and billing records, so we use 
</I>&gt;&gt;<i> persistence, durability, and transactions.
</I>&gt;<i>How big are the transactions? Are you sure you need transactions? Have you tried without transactions, or increasing the transaction size?
</I>
We really want the assurance of transactions so we haven't tried without it. The size of the transaction is our &quot;batch&quot; size. I've tried with as low as 50, and as high as 500. No difference in overall throughput.

&gt;<i>What is the largest number of unacknowledged messages that you have at any time? Have you tried to raise that number?
</I>
Usually it's about 0. I set prefetch as high as 25,000 and it didn't seem to help. Almost all the time in the consumer is spent waiting for messages.

&gt;<i>Are you supplying any non-standard parameters to the Erlang VM? Can you show the output of &quot;rabbitmqctl status&quot; ?
</I>
Not that I know of. We considered HiPE, but heard so many bad things we figured it wasn't worth the potential data loss if things segfault at the wrong place.

Status at the bottom. The other thing I just thought of is that maybe the messages are being paged to disk when I've got tens of millions backlogged. I think I would have seen that in iotop, but it's a possibility. &quot;Unfortunately&quot;, today our consumers have kept up and there's no backlog so I can't tell.

I'll run that perf test tonight when the machine is mostly idle. 

Thank you,
-Michael

connection_procs,4677680},
      {queue_procs,3531416},
      {plugins,1414832},
      {other_proc,17968600},
      {mnesia,109816},
      {mgmt_db,1530208},
      {msg_index,2770832},
      {other_ets,14576224},
      {binary,12647320},
      {code,19818213},
      {atom,1361121},
      {other_system,6527882}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,8381177856},
 {disk_free_limit,50000000},
 {disk_free,44984172544},
 {file_descriptors,
     [{total_limit,924},
      {total_used,41},
      {sockets_limit,829},
      {sockets_used,29}]},
 {processes,[{limit,1048576},{used,866}]},
 {run_queue,2},
 {uptime,184269}]
...done.
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032881.html">[rabbitmq-discuss] Scaling single queues
</A></li>
	<LI>Next message: <A HREF="032872.html">[rabbitmq-discuss] Scaling rabbitmq on ec2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32883">[ date ]</a>
              <a href="thread.html#32883">[ thread ]</a>
              <a href="subject.html#32883">[ subject ]</a>
              <a href="author.html#32883">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
