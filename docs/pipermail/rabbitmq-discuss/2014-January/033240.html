<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Not able to get ssl working with rabbitMQ server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Not%20able%20to%20get%20ssl%20working%20with%20rabbitMQ%20server&In-Reply-To=%3C1390373029.32279.YahooMailNeo%40web141402.mail.bf1.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033239.html">
   <LINK REL="Next"  HREF="033241.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Not able to get ssl working with rabbitMQ server</H1>
    <B>Kausik Chattopadhyay</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Not%20able%20to%20get%20ssl%20working%20with%20rabbitMQ%20server&In-Reply-To=%3C1390373029.32279.YahooMailNeo%40web141402.mail.bf1.yahoo.com%3E"
       TITLE="[rabbitmq-discuss] Not able to get ssl working with rabbitMQ server">connect_kausik at yahoo.com
       </A><BR>
    <I>Wed Jan 22 06:43:49 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033239.html">[rabbitmq-discuss] RabbitMQ server fail to start
</A></li>
        <LI>Next message: <A HREF="033241.html">[rabbitmq-discuss] Not able to get ssl working with rabbitMQ	server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33240">[ date ]</a>
              <a href="thread.html#33240">[ thread ]</a>
              <a href="subject.html#33240">[ subject ]</a>
              <a href="author.html#33240">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi ,
I am trying to configure rabbitMQ server with SSL. However it is not working. I was just trying t make sure if my server configuration is fine and I used the openssl s_client &#160;as per&#160;<A HREF="http://www.rabbitmq.com/troubleshooting-ssl.html">http://www.rabbitmq.com/troubleshooting-ssl.html</A>
Could you please help me out finding the problem with my setup.
Thanks
Kausik


CLIENT SIDE LOG:


<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at master1</A>:~# openssl s_client -connect localhost:5671 -cert client/cert.pem -key client/key.pem -CAfile testca/cacert.pem
CONNECTED(00000003)
write:errno=104
---
no peer certificate available
---
No client certificate CA names sent
---
SSL handshake has read 0 bytes and written 226 bytes
---
New, (NONE), Cipher is (NONE)
Secure Renegotiation IS NOT supported
Compression: NONE
Expansion: NONE
---


SERVER SIDE LOG:

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at master1</A>:~/client# service rabbitmq-server restart
&#160;* Restarting message broker rabbitmq-server &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;[ OK ]&#160;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at master1</A>:~/client# tail -f /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at master1.log</A>
Statistics database started.

=INFO REPORT==== 21-Jan-2014::14:09:13 ===
Server startup complete; 6 plugins started.
&#160;* amqp_client
&#160;* mochiweb
&#160;* rabbitmq_management
&#160;* rabbitmq_management_agent
&#160;* rabbitmq_web_dispatch
&#160;* webmachine



=INFO REPORT==== 21-Jan-2014::14:10:44 ===
accepting AMQP connection &lt;0.320.0&gt; (127.0.0.1:34076 -&gt; 127.0.0.1:5671)

=ERROR REPORT==== 21-Jan-2014::14:10:44 ===
SSL: 1089: error:{error,{badmatch,{error,eacces}}} /root/testca/cacert.pem
&#160; [{ssl_connection,init_certificates,2,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;[{file,&quot;ssl_connection.erl&quot;},{line,1086}]},
&#160; &#160;{ssl_connection,ssl_init,2,[{file,&quot;ssl_connection.erl&quot;},{line,1062}]},
&#160; &#160;{ssl_connection,init,1,[{file,&quot;ssl_connection.erl&quot;},{line,316}]},
&#160; &#160;{gen_fsm,init_it,6,[{file,&quot;gen_fsm.erl&quot;},{line,361}]},
&#160; &#160;{proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}]


=ERROR REPORT==== 21-Jan-2014::14:10:49 ===
error on AMQP connection &lt;0.320.0&gt;: {ssl_upgrade_error,ecacertfile} (unknown POSIX error)



----------------------------------------------


My serverside configuration is as follows

have provided root priviledges to user &quot;rabbitmq&quot;

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at master1</A>:~/client# rabbitmqctl environment
Application environment of node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at master1</A> ...
[{auth_backends,[rabbit_auth_backend_internal]},
&#160;{auth_mechanisms,['PLAIN','AMQPLAIN','EXTERNAL']},
&#160;{backing_queue_module,rabbit_variable_queue},
&#160;{cluster_nodes,{[],disc}},
&#160;{cluster_partition_handling,ignore},
&#160;{collect_statistics,fine},
&#160;{collect_statistics_interval,5000},
&#160;{default_permissions,[&lt;&lt;&quot;.*&quot;&gt;&gt;,&lt;&lt;&quot;.*&quot;&gt;&gt;,&lt;&lt;&quot;.*&quot;&gt;&gt;]},
&#160;{default_user,&lt;&lt;&quot;guest&quot;&gt;&gt;},
&#160;{default_user_tags,[administrator]},
&#160;{default_vhost,&lt;&lt;&quot;/&quot;&gt;&gt;},
&#160;{delegate_count,16},
&#160;{disk_free_limit,50000000},
&#160;{enabled_plugins_file,&quot;/etc/rabbitmq/enabled_plugins&quot;},
&#160;{error_logger,{file,&quot;/var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at master1.log</A>&quot;}},
&#160;{frame_max,131072},
&#160;{halt_on_upgrade_failure,true},
&#160;{heartbeat,580},
&#160;{hipe_compile,false},
&#160;{hipe_modules,[rabbit_reader,rabbit_channel,gen_server2,rabbit_exchange,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; rabbit_command_assembler,rabbit_framing_amqp_0_9_1,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; rabbit_basic,rabbit_event,lists,queue,priority_queue,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; rabbit_router,rabbit_trace,rabbit_misc,rabbit_binary_parser,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; rabbit_exchange_type_direct,rabbit_guid,rabbit_net,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; rabbit_amqqueue_process,rabbit_variable_queue,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; rabbit_binary_generator,rabbit_writer,delegate,gb_sets,lqueue,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; sets,orddict,rabbit_amqqueue,rabbit_limiter,gb_trees,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; rabbit_queue_index,rabbit_exchange_decorator,gen,dict,ordsets,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; file_handle_cache,rabbit_msg_store,array,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; rabbit_msg_store_ets_index,rabbit_msg_file,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; rabbit_exchange_type_fanout,rabbit_exchange_type_topic,mnesia,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; mnesia_lib,rpc,mnesia_tm,qlc,sofs,proplists,credit_flow,pmon,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ssl_connection,tls_connection,ssl_record,tls_record,gen_fsm,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ssl]},
&#160;{included_applications,[]},
&#160;{log_levels,[{connection,info}]},
&#160;{msg_store_file_size_limit,16777216},
&#160;{msg_store_index_module,rabbit_msg_store_ets_index},
&#160;{plugins_dir,&quot;/usr/lib/rabbitmq/lib/rabbitmq_server-3.2.2/sbin/../plugins&quot;},
&#160;{plugins_expand_dir,&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at master1-plugins-expand</A>&quot;},
&#160;{queue_index_max_journal_entries,65536},
&#160;{reverse_dns_lookups,false},
&#160;{sasl_error_logger,{file,&quot;/var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at master1-sasl.log</A>&quot;}},
&#160;{server_properties,[]},
&#160;{ssl_apps,[asn1,crypto,public_key,ssl]},
&#160;{ssl_cert_login_from,common_name},
&#160;{ssl_listeners,[5671]},
&#160;{ssl_options,[{cacertfile,&quot;/root/testca/cacert.pem&quot;},
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;{certfile,&quot;/root/server/cert.pem&quot;},
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;{keyfile,&quot;/root/server/key.pem&quot;},
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;{verify,verify_peer},
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;{fail_if_no_peer_cert,false}]},
&#160;{tcp_listen_options,[binary,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; {packet,raw},
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; {reuseaddr,true},
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; {backlog,128},
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; {nodelay,true},
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; {linger,{true,0}},
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; {exit_on_close,false}]},
&#160;{tcp_listeners,[5672]},
&#160;{trace_vhosts,[]},
&#160;{vm_memory_high_watermark,0.4},
&#160;{vm_memory_high_watermark_paging_ratio,0.5}]
...done.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140121/acb73775/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140121/acb73775/attachment.html</A>&gt;
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033239.html">[rabbitmq-discuss] RabbitMQ server fail to start
</A></li>
	<LI>Next message: <A HREF="033241.html">[rabbitmq-discuss] Not able to get ssl working with rabbitMQ	server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33240">[ date ]</a>
              <a href="thread.html#33240">[ thread ]</a>
              <a href="subject.html#33240">[ subject ]</a>
              <a href="author.html#33240">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
