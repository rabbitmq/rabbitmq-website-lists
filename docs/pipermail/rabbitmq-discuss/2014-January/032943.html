<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Latest revision of NYTimes site is supported by RabbitMQ - launched 8 January 2014
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Latest%20revision%20of%20NYTimes%20site%20is%20supported%0A%20by%20RabbitMQ%20-%20launched%208%20January%202014&In-Reply-To=%3CCAKgmDnHB_NRvxPjLoVs%3DX7zd0WrNb%3D_p%2BMswhXPYdDdx_SpDEg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032924.html">
   <LINK REL="Next"  HREF="032925.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Latest revision of NYTimes site is supported by RabbitMQ - launched 8 January 2014</H1>
    <B>Laing, Michael</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Latest%20revision%20of%20NYTimes%20site%20is%20supported%0A%20by%20RabbitMQ%20-%20launched%208%20January%202014&In-Reply-To=%3CCAKgmDnHB_NRvxPjLoVs%3DX7zd0WrNb%3D_p%2BMswhXPYdDdx_SpDEg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Latest revision of NYTimes site is supported by RabbitMQ - launched 8 January 2014">michael.laing at nytimes.com
       </A><BR>
    <I>Thu Jan  9 18:30:16 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="032924.html">[rabbitmq-discuss] Latest revision of NYTimes site is supported by RabbitMQ - launched 8 January 2014
</A></li>
        <LI>Next message: <A HREF="032925.html">[rabbitmq-discuss] Latest revision of NYTimes site is supported by RabbitMQ - launched 8 January 2014
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32943">[ date ]</a>
              <a href="thread.html#32943">[ thread ]</a>
              <a href="subject.html#32943">[ subject ]</a>
              <a href="author.html#32943">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We are using: a single Amazon Linux AMI, RabbitMQ, Cassandra 2, python 2

We use pika with tornado and libev for the nyt&#10765;a&#1073;rik wholesale and retail
pieces; our internal clients use Java and PHP.

We use shovels - lots of shovels - to interconnect.

In production we have a RabbitMQ client 3-cluster and a core 3-cluster in
each region on c1-xlarges. A proxy cluster of c1-mediums in Virginia connects
clients to the client clusters. All services are parallelized so we can add
more cores and clients.

The retail layer autoscales and use c1-mediums with a single rabbit
shovel-connected to one of the core rabbits. Each python websocket/sockjs
gateway supports up to 100K clients.

We autodeploy into subnets within Virtual Private Clouds in AWS. Clients
are routed via least latency to the fastest healthy region.

Of the technical components, the gateway is the most complex. We will be
moving it into open source in pieces and the first piece is likely to be
the python websocket/sockjs libraries which, frankly, beat the crap out of
most other stuff out there and fully conform with the relevant standards.
It can be loosely thought of as a C co-process managed by python, and as
such, may be possible to reuse in other languages/environments.

We have a 12-node Cassandra cluster across the 2 regions / 6 zones. It is
used for persistence of messages and as cache. We do not use persistence in
RabbitMQ. Our services are idempotent and important messages may be
replicated multiple times creating intentional race conditions in which the
fastest wins.

Although it may seem complex, nyt&#10765;a&#1073;rik has simple components and is mostly
principles and plumbing. The key point to grasp is that there is no head,
no master, no single point of failure. As I write this I can see components
failing (not RabbitMQ), and we are fixing them so they are more reliable.
But the system doesn't fail, users can connect, and messages are delivered,
regardless - all within design parameters.

Michael



On Wed, Jan 8, 2014 at 2:58 PM, Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mklishin at gopivotal.com</A>&gt;wrote:

&gt;<i> On 8 Jan 2014, at 23:26, Laing, Michael &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">michael.laing at nytimes.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Our premier online offering www.nytimes.com has a new look and new
</I>&gt;<i> underpinnings, now including a messaging architecture implemented using
</I>&gt;<i> RabbitMQ.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This architecture - nyt&#10765;a&#1073;rik - has dozens of RabbitMQ instances spread
</I>&gt;<i> across 6 AWS zones in Oregon and Dublin. The instances are organized into
</I>&gt;<i> &quot;wholesale&quot; and &quot;retail&quot; layers. Connection to clients is via
</I>&gt;<i> websockets/sockjs.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Upon launch today, the system autoscaled to ~500,000 users. Connection
</I>&gt;<i> times remained flat at ~200ms.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; nyt&#10765;a&#1073;rik provides subscription services for breaking news, video feeds,
</I>&gt;<i> etc. and will add more event based services. It also supports individual
</I>&gt;<i> messaging related to subscription status for registered users.
</I>&gt;<i>
</I>&gt;<i> Michael,
</I>&gt;<i>
</I>&gt;<i> Congrats on the launch!
</I>&gt;<i>
</I>&gt;<i> I&#8217;m curious what technologies and RabbitMQ clients do you use and plan on
</I>&gt;<i> adding
</I>&gt;<i> in the future?
</I>&gt;<i>
</I>&gt;<i> MK
</I>&gt;<i>
</I>&gt;<i> Software Engineer, Pivotal/RabbitMQ
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140109/9831923b/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140109/9831923b/attachment.html</A>&gt;
</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032924.html">[rabbitmq-discuss] Latest revision of NYTimes site is supported by RabbitMQ - launched 8 January 2014
</A></li>
	<LI>Next message: <A HREF="032925.html">[rabbitmq-discuss] Latest revision of NYTimes site is supported by RabbitMQ - launched 8 January 2014
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32943">[ date ]</a>
              <a href="thread.html#32943">[ thread ]</a>
              <a href="subject.html#32943">[ subject ]</a>
              <a href="author.html#32943">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
