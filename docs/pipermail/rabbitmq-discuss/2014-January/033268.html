<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbitmq crashing every 90 minutes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20crashing%20every%2090%20minutes&In-Reply-To=%3C1390425211324-32798.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033299.html">
   <LINK REL="Next"  HREF="033270.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbitmq crashing every 90 minutes</H1>
    <B>Dan_b</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20crashing%20every%2090%20minutes&In-Reply-To=%3C1390425211324-32798.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] Rabbitmq crashing every 90 minutes">daniel.bason at telogis.com
       </A><BR>
    <I>Wed Jan 22 21:13:31 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033299.html">[rabbitmq-discuss] Low performance when there are many messages in ready or unacked state
</A></li>
        <LI>Next message: <A HREF="033270.html">[rabbitmq-discuss] Rabbitmq crashing every 90 minutes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33268">[ date ]</a>
              <a href="thread.html#33268">[ thread ]</a>
              <a href="subject.html#33268">[ subject ]</a>
              <a href="author.html#33268">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

For the last 6 hours one of our rabbitmq instances has been crashing every
90 minutes with the ram usage spiking up after the crash.  Restarting rabbit
fixes the issue but then it is another 90 minutes and it crashes again.  I
have tried resetting the rabbit instance completely (renaming the
/var/lib/rabbitmq/mnesia database and letting it be recreated) and am
waiting to see if this has resolved the issue.  It would be nice if we would
work out what caused this though.

Rabbitmq status is as follows:
 {running_applications,[{rabbit,&quot;RabbitMQ&quot;,&quot;3.1.5&quot;},
                        {ssl,&quot;Erlang/OTP SSL application&quot;,&quot;4.1.6&quot;},
                        {public_key,&quot;Public key infrastructure&quot;,&quot;0.13&quot;},
                        {crypto,&quot;CRYPTO version 2&quot;,&quot;2.0.4&quot;},
                        {asn1,&quot;The Erlang ASN1 compiler version 1.6.18&quot;,
                              &quot;1.6.18&quot;},
                        {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.5&quot;},
                        {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.7&quot;},
                        {xmerl,&quot;XML parser&quot;,&quot;1.2.10&quot;},
                        {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.1.10&quot;},
                        {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.17.5&quot;},
                        {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.14.5&quot;}]},
 {os,{unix,linux}},
 {erlang_version,&quot;Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4]
[rq:4] [async-threads:30] [kernel-poll:true]\n&quot;},
 {memory,[{total,57151960},
          {connection_procs,4273224},
          {queue_procs,5370024},
          {plugins,0},
          {other_proc,9627768},
          {mnesia,182848},
          {mgmt_db,0},
          {msg_index,836424},
          {other_ets,1219792},
          {binary,17570544},
          {code,14611134},
          {atom,1362545},
          {other_system,2097657}]},
 {vm_memory_high_watermark,0.8},
 {vm_memory_limit,6871947673},
 {disk_free_limit,1000000000},
 {disk_free,10916909056},
 {file_descriptors,[{total_limit,924},
                    {total_used,66},
                    {sockets_limit,829},
                    {sockets_used,46}]},
 {processes,[{limit,1048576},{used,654}]},
 {run_queue,0},
 {uptime,2820}]
...done.

Output from the sasl log is:
=CRASH REPORT==== 22-Jan-2014::19:37:28 ===
  crasher:
    initial call: tcp_acceptor:init/1
    pid: &lt;0.232.0&gt;
    registered_name: []
    exception exit: {accept_failed,enfile}
      in function  gen_server:terminate/6
    ancestors: ['tcp_acceptor_sup_:::5672',&lt;0.229.0&gt;,rabbit_sup,&lt;0.98.0&gt;]
    messages: []
    links: [&lt;0.230.0&gt;]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 610
    stack_size: 24
    reductions: 1442919
  neighbours:

=SUPERVISOR REPORT==== 22-Jan-2014::19:37:28 ===
     Supervisor: {local,'tcp_acceptor_sup_:::5672'}
     Context:    child_terminated
     Reason:     {accept_failed,enfile}
     Offender:   [{pid,&lt;0.232.0&gt;},
                  {name,tcp_acceptor},
                  {mfargs,
                      {tcp_acceptor,start_link,
                          [{rabbit_networking,start_client,[]},
                           #Port&lt;0.4998&gt;]}},
                  {restart_type,transient},
                  {shutdown,brutal_kill},
                  {child_type,worker}]


=CRASH REPORT==== 22-Jan-2014::19:37:30 ===
  crasher:
    initial call: tcp_acceptor:init/1
    pid: &lt;0.10514.3&gt;
    registered_name: []
    exception exit: {accept_failed,enfile}
      in function  gen_server:terminate/6
    ancestors: ['tcp_acceptor_sup_:::5672',&lt;0.229.0&gt;,rabbit_sup,&lt;0.98.0&gt;]
    messages: []
    links: [&lt;0.230.0&gt;]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 233
    stack_size: 24
    reductions: 148
  neighbours:

=SUPERVISOR REPORT==== 22-Jan-2014::19:37:30 ===
     Supervisor: {local,'tcp_acceptor_sup_:::5672'}
     Context:    child_terminated
     Reason:     {accept_failed,enfile}
     Offender:   [{pid,&lt;0.10514.3&gt;},
                  {name,tcp_acceptor},
                  {mfargs,
                      {tcp_acceptor,start_link,
                          [{rabbit_networking,start_client,[]},
                           #Port&lt;0.4998&gt;]}},
                  {restart_type,transient},
                  {shutdown,brutal_kill},
                  {child_type,worker}]


=CRASH REPORT==== 22-Jan-2014::19:37:31 ===
  crasher:
    initial call: tcp_acceptor:init/1
    pid: &lt;0.10522.3&gt;
    registered_name: []
    exception exit: {accept_failed,enfile}
      in function  gen_server:terminate/6
    ancestors: ['tcp_acceptor_sup_:::5672',&lt;0.229.0&gt;,rabbit_sup,&lt;0.98.0&gt;]
    messages: []
    links: [&lt;0.230.0&gt;]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 233
    stack_size: 24
    reductions: 148
  neighbours:

=SUPERVISOR REPORT==== 22-Jan-2014::19:37:31 ===
     Supervisor: {local,'tcp_acceptor_sup_:::5672'}
     Context:    child_terminated
     Reason:     {accept_failed,enfile}
     Offender:   [{pid,&lt;0.10522.3&gt;},
                  {name,tcp_acceptor},
                  {mfargs,
                      {tcp_acceptor,start_link,
                          [{rabbit_networking,start_client,[]},
                           #Port&lt;0.4998&gt;]}},
                  {restart_type,transient},
                  {shutdown,brutal_kill},
                  {child_type,worker}]


=CRASH REPORT==== 22-Jan-2014::19:37:32 ===
  crasher:
    initial call: tcp_acceptor:init/1
    pid: &lt;0.10523.3&gt;
    registered_name: []
    exception exit: {accept_failed,enfile}
      in function  gen_server:terminate/6
    ancestors: ['tcp_acceptor_sup_:::5672',&lt;0.229.0&gt;,rabbit_sup,&lt;0.98.0&gt;]
    messages: []
    links: [&lt;0.230.0&gt;]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 233
                 
=CRASH REPORT==== 22-Jan-2014::19:37:37 ===
  crasher:
    initial call: rabbit_disk_monitor:init/1
    pid: &lt;0.156.0&gt;
    registered_name: rabbit_disk_monitor
    exception exit: {system_limit,
                        [{erlang,open_port,
                             [{spawn,&quot;/bin/sh -s unix:cmd 2&gt;&amp;1&quot;},[stream]]},
                         {os,start_port_srv_handle,1},
                         {os,start_port_srv_loop,0}]}
      in function  gen_server:terminate/6
    ancestors: [rabbit_disk_monitor_sup,rabbit_sup,&lt;0.98.0&gt;]
    messages: []
    links: [&lt;0.79.0&gt;,&lt;0.155.0&gt;]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 964775
  neighbours:

=SUPERVISOR REPORT==== 22-Jan-2014::19:37:37 ===
     Supervisor: {local,rabbit_disk_monitor_sup}
     Context:    child_terminated
     Reason:     {system_limit,
                     [{erlang,open_port,
                          [{spawn,&quot;/bin/sh -s unix:cmd 2&gt;&amp;1&quot;},[stream]]},
                      {os,start_port_srv_handle,1},
                      {os,start_port_srv_loop,0}]}
     Offender:   [{pid,&lt;0.156.0&gt;},
                  {name,rabbit_disk_monitor},
                  {mfargs,{rabbit_disk_monitor,start_link,[1000000000]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=CRASH REPORT==== 22-Jan-2014::19:37:37 ===
  crasher:
    initial call: rabbit_disk_monitor:init/1
    pid: &lt;0.10529.3&gt;
    registered_name: []
    exception exit: {{badmatch,{error,system_limit}},
                     [{vm_memory_monitor,read_proc_file,1},
                      {vm_memory_monitor,get_total_memory,1},
                      {rabbit_disk_monitor,init,1},
                      {gen_server,init_it,6},
                      {proc_lib,init_p_do_apply,3}]}
      in function  gen_server:init_it/6
    ancestors: [rabbit_disk_monitor_sup,rabbit_sup,&lt;0.98.0&gt;]
    messages: []
    links: [&lt;0.155.0&gt;,&lt;0.79.0&gt;]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 987
    stack_size: 24
    reductions: 482
  neighbours:

And so on.

I can compress and send the actual logs to someone if this will help.  We
also have the erlang crashdump from the issue.



--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Rabbitmq-crashing-every-90-minutes-tp32798.html">http://rabbitmq.1065348.n5.nabble.com/Rabbitmq-crashing-every-90-minutes-tp32798.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>



































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033299.html">[rabbitmq-discuss] Low performance when there are many messages in ready or unacked state
</A></li>
	<LI>Next message: <A HREF="033270.html">[rabbitmq-discuss] Rabbitmq crashing every 90 minutes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33268">[ date ]</a>
              <a href="thread.html#33268">[ thread ]</a>
              <a href="subject.html#33268">[ subject ]</a>
              <a href="author.html#33268">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
