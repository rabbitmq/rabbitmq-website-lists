<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Http Management Plugin: statistics_db_node	not_running
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Http%20Management%20Plugin%3A%20statistics_db_node%0A%09not_running&In-Reply-To=%3C7EF99EFD88F4A94CB5378840A8A5B8AC500615AB%40EXCHMBOXA01.pc.factset.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033298.html">
   <LINK REL="Next"  HREF="033284.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Http Management Plugin: statistics_db_node	not_running</H1>
    <B>Ben J. Heiskell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Http%20Management%20Plugin%3A%20statistics_db_node%0A%09not_running&In-Reply-To=%3C7EF99EFD88F4A94CB5378840A8A5B8AC500615AB%40EXCHMBOXA01.pc.factset.com%3E"
       TITLE="[rabbitmq-discuss] Http Management Plugin: statistics_db_node	not_running">bheiskell at factset.com
       </A><BR>
    <I>Wed Jan 22 17:02:24 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033298.html">[rabbitmq-discuss] Best practices for starting/managing consumer processes, PHP/Linux
</A></li>
        <LI>Next message: <A HREF="033284.html">[rabbitmq-discuss] Http Management Plugin: statistics_db_node not_running
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33263">[ date ]</a>
              <a href="thread.html#33263">[ thread ]</a>
              <a href="subject.html#33263">[ subject ]</a>
              <a href="author.html#33263">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I've experienced an issue that is very similar to the following two threads:

<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-July/028437.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-July/028437.html</A> 
<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-January/010859.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-January/010859.html</A>

I'm posting here partially looking for an explanation and partially to document how I &quot;fixed&quot; it. On Saturday, one of my boxes crashed due to a disk failure. The failed node rebooted and rejoined the cluster without any manual intervention. Before the node came back online, a script which gathers statistics from the HTTP API began to error, and it continued to error after the node rejoined. The formatted JSON from the /api/overview resource can be found here: <A HREF="https://gist.github.com/anonymous/fe81ff0e890d26b220e6">https://gist.github.com/anonymous/fe81ff0e890d26b220e6</A>

I believe the point of interest is &quot;statistics_db_node&quot;:&quot;not_running&quot;. I resolved the problem by issuing stop_app / start_app for four out of the five nodes, checking the api after each restart.

I'm guessing that through sheer bad luck, the node which crashed was the active statistics_db_node. What I don't understand is why I had to manually intervene to get the statistics db back online. Is this a bug? What is the expected behavior here?

Thanks!
Ben

Additional notes:

- When visiting the management plugin from a browser, the overview tab displays the error message: &quot;TypeError: Cannot read property 'connections' of undefined&quot;. Additionally, the connections and channels tabs are both empty. Exchanges and Queues are populated as expected, but the statistics related columns (rates and counts) are all empty. Clicking on an exchange results errors with &quot;ReferenceError: exchange is not defined&quot;. Clicking on a queue errors with &quot;TypeError: Cannot read property 'ram_msg_count' of undefined&quot;.

- Everything aside from the management API appears to have continued to work correctly.

- I'm running a five node cluster on version 3.2.2 in pause_minority mode.

- I have experienced the same web-client issue on 3.1.1 under different circumstances.

- I found the following message in the crashed host's logs, which repeated once for every host in the cluster:

=ERROR REPORT==== 18-Jan-2014::17:59:26 ===
Mnesia(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbitmq04</A>): ** ERROR ** mnesia_event got {inconsistent_database, starting_partitioned_network, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbitmq05</A>}
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033298.html">[rabbitmq-discuss] Best practices for starting/managing consumer processes, PHP/Linux
</A></li>
	<LI>Next message: <A HREF="033284.html">[rabbitmq-discuss] Http Management Plugin: statistics_db_node not_running
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33263">[ date ]</a>
              <a href="thread.html#33263">[ thread ]</a>
              <a href="subject.html#33263">[ subject ]</a>
              <a href="author.html#33263">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
