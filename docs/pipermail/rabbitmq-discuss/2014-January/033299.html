<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Low performance when there are many messages in ready or unacked state
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Low%20performance%20when%20there%20are%20many%20messages%0A%20in%20ready%20or%20unacked%20state&In-Reply-To=%3CCAK24ZruwxPrko7B8fAgS5Xiedc4uub%3DrqJ3HykadiXeqjqKemA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033275.html">
   <LINK REL="Next"  HREF="033268.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Low performance when there are many messages in ready or unacked state</H1>
    <B>Anahi</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Low%20performance%20when%20there%20are%20many%20messages%0A%20in%20ready%20or%20unacked%20state&In-Reply-To=%3CCAK24ZruwxPrko7B8fAgS5Xiedc4uub%3DrqJ3HykadiXeqjqKemA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Low performance when there are many messages in ready or unacked state">anahi.hojnadel at gmail.com
       </A><BR>
    <I>Thu Jan 23 18:04:07 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033275.html">[rabbitmq-discuss] Low performance when there are many messages in ready or unacked state
</A></li>
        <LI>Next message: <A HREF="033268.html">[rabbitmq-discuss] Rabbitmq crashing every 90 minutes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33299">[ date ]</a>
              <a href="thread.html#33299">[ thread ]</a>
              <a href="subject.html#33299">[ subject ]</a>
              <a href="author.html#33299">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the info! I read the article, but we can't use that
implementation since it seems to be kind of experimental and we need to
mantain the app as stable as possible,

Regarding the prefetch count, I'm not really sure about how it works in the
.net version. I've tried with this code _channel.BasicQos(0, 50, false) and
the only difference I see is that unacked messages ratio keep constant. But
there's no performance improvement.

We're using: RabbitMQ 3.2.2, Erlang R16B03

*Setting prefetch count before consuming data:*
Deliver 24/s
Ack 20~24/s
Published 1600/s


*Without prefetch count:*
Deliver 10~30/s
Ack 20~30/s
Published 1600/s

When we decreased the publish ratio (by adding sleep after sending each
message) we could increase the deliver ratio up to 90/s, but when the
number of messages within ready state start growing, the deliver ratio
decreases to 20/s again.


Thanks!!!

Anni..


2014/1/22 Alvaro Videla &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">videlalvaro at gmail.com</A>&gt;

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> Have you considered the approaches explained here:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/">http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/</A>
</I>&gt;<i>
</I>&gt;<i> Also I think people could help you a bit more if you shared some
</I>&gt;<i> numbers about number of messages, consumers, RabbitMQ and Erlang
</I>&gt;<i> versions, and so on.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Alvaro
</I>&gt;<i>
</I>&gt;<i> On Wed, Jan 22, 2014 at 9:51 PM, Anahi Hojnadel
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">anahi.hojnadel at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; Hi guys!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; We have an application that has a publisher which sends messages to a
</I>&gt;<i> &gt; consumer which process those messages and then stores them in the DB.
</I>&gt;<i> &gt; Everything is working fine up to now, but the number of messages we're
</I>&gt;<i> &gt; receiving is getting bigger and performance is quite bad. We started to
</I>&gt;<i> &gt; analize where the bottleneck was and it seems to be in rabbit queues.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've been reading many posts in Rabbit's blog about optimization but I
</I>&gt;<i> &gt; couldn't find how to solve the problem.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The main problem is that we're publishing messages faster than we can
</I>&gt;<i> &gt; consume them. When the number of messages in ready state (or in unacked
</I>&gt;<i> &gt; state) increases, the deliver ratio decrease considerably.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've tried adding more consumers, sending messages more slowly (with time
</I>&gt;<i> &gt; sleep)... without luck.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've seen that sending an ack for each message make things slower but we
</I>&gt;<i> &gt; actually need to ensure they're delivered. Our current ack ratio is too
</I>&gt;<i> low,
</I>&gt;<i> &gt; so every time the number of unacked messages increases, the deliver ratio
</I>&gt;<i> &gt; decreases.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Do you have any ideas of what could I try to improve our process
</I>&gt;<i> &gt; performance? Or should I just make sure not to send more messages than my
</I>&gt;<i> &gt; current ack ratio? Is stacking acks and sending them in batches a safe
</I>&gt;<i> &gt; strategy to try out?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Adding more queues is not an option since it will add too much
</I>&gt;<i> complexity to
</I>&gt;<i> &gt; our app.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks!!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> You received this message because you are subscribed to a topic in the
</I>&gt;<i> Google Groups &quot;rabbitmq-discuss&quot; group.
</I>&gt;<i> To unsubscribe from this topic, visit
</I>&gt;<i> <A HREF="https://groups.google.com/d/topic/rabbitmq-discuss/BW62Tn9sQkE/unsubscribe">https://groups.google.com/d/topic/rabbitmq-discuss/BW62Tn9sQkE/unsubscribe</A>
</I>&gt;<i> .
</I>&gt;<i> To unsubscribe from this group and all its topics, send an email to
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss+unsubscribe at googlegroups.com.</A>
</I>&gt;<i> To post to this group, send email to <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at googlegroups.com.</A>
</I>&gt;<i> Visit this group at <A HREF="http://groups.google.com/group/rabbitmq-discuss.">http://groups.google.com/group/rabbitmq-discuss.</A>
</I>&gt;<i> For more options, visit <A HREF="https://groups.google.com/groups/opt_out.">https://groups.google.com/groups/opt_out.</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140123/d43e75c8/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140123/d43e75c8/attachment.html</A>&gt;
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033275.html">[rabbitmq-discuss] Low performance when there are many messages in ready or unacked state
</A></li>
	<LI>Next message: <A HREF="033268.html">[rabbitmq-discuss] Rabbitmq crashing every 90 minutes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33299">[ date ]</a>
              <a href="thread.html#33299">[ thread ]</a>
              <a href="subject.html#33299">[ subject ]</a>
              <a href="author.html#33299">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
