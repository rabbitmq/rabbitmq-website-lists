<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ HA
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20HA&In-Reply-To=%3Cbab968a1-bf32-4d08-a7cd-4cc85b532317%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033128.html">
   <LINK REL="Next"  HREF="033141.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ HA</H1>
    <B>Anup Katariya</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20HA&In-Reply-To=%3Cbab968a1-bf32-4d08-a7cd-4cc85b532317%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ HA">anup.katariya at integral.com
       </A><BR>
    <I>Fri Jan 17 05:04:59 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033128.html">[rabbitmq-discuss] [Rabbitmq-c] die_on_amqp_error documentation
</A></li>
        <LI>Next message: <A HREF="033141.html">[rabbitmq-discuss] create new binding [Web-based version]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33135">[ date ]</a>
              <a href="thread.html#33135">[ thread ]</a>
              <a href="subject.html#33135">[ subject ]</a>
              <a href="author.html#33135">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi jrob,

Curious to know whether you pushed this setup in production and how has it 
been? Any surprises? We are also testing this in perf lab and plan to push 
to production in couple of weeks.

Anup

On Wednesday, January 18, 2012 9:16:22 AM UTC-8, jrob wrote:
&gt;<i>
</I>&gt;<i> Yup, that was it exactly.  I just had the diff up, so here are the two 
</I>&gt;<i> major changes I had to make:
</I>&gt;<i>
</I>&gt;<i> -    channel.queue( @queue, :durable =&gt; true ).subscribe(:ack=&gt;true) do 
</I>&gt;<i> |header,message|
</I>&gt;<i> +    channel.queue( @queue, :durable =&gt; true, :arguments =&gt; {'x-ha-policy' 
</I>&gt;<i> =&gt; 'all'} ).subscribe(:ack=&gt;true) do |header,message|
</I>&gt;<i>
</I>&gt;<i>    def self.get_channel(host)
</I>&gt;<i>      connection = AMQP.connect( :host=&gt;host )
</I>&gt;<i> +    connection.on_connection_interruption do |conn, settings|
</I>&gt;<i> +      conn.reconnect(false,1)
</I>&gt;<i> +    end
</I>&gt;<i> +
</I>&gt;<i>      channel    = AMQP::Channel.new( connection )
</I>&gt;<i> +    channel.auto_recovery = true
</I>&gt;<i> +
</I>&gt;<i> +    channel
</I>&gt;<i>    end
</I>&gt;<i>
</I>&gt;<i> As I said, this hasn't gone into production yet, but it seems to be doing 
</I>&gt;<i> well in our staging environment.  I don't think our message rate is high 
</I>&gt;<i> enough to really exercise this setup in staging, so I can't really comment 
</I>&gt;<i> on performance yet.  (We're holding off moving this into production as we 
</I>&gt;<i> are trying to provide high availability for our applications and services 
</I>&gt;<i> across the board, which in some cases means we will be using one VM for 
</I>&gt;<i> multiple services.  Since the other services aren't ready to go yet, we 
</I>&gt;<i> haven't pushed this up.)
</I>&gt;<i>
</I>&gt;<i> - jrob
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140116/f6e5ef62/attachment-0001.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140116/f6e5ef62/attachment-0001.html</A>&gt;
</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033128.html">[rabbitmq-discuss] [Rabbitmq-c] die_on_amqp_error documentation
</A></li>
	<LI>Next message: <A HREF="033141.html">[rabbitmq-discuss] create new binding [Web-based version]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33135">[ date ]</a>
              <a href="thread.html#33135">[ thread ]</a>
              <a href="subject.html#33135">[ subject ]</a>
              <a href="author.html#33135">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
