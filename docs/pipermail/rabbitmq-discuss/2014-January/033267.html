<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] a lot of unacked messages &quot;in the flight&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20a%20lot%20of%20unacked%20messages%20%22in%20the%20flight%22&In-Reply-To=%3CCANOx8N%3DP27AW4bqEr3zMFKt4FeeMQ%2BvVG_V48%3DYa48i8G9DBfw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033233.html">
   <LINK REL="Next"  HREF="033228.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] a lot of unacked messages &quot;in the flight&quot;</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20a%20lot%20of%20unacked%20messages%20%22in%20the%20flight%22&In-Reply-To=%3CCANOx8N%3DP27AW4bqEr3zMFKt4FeeMQ%2BvVG_V48%3DYa48i8G9DBfw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] a lot of unacked messages &quot;in the flight&quot;">jkuch at gopivotal.com
       </A><BR>
    <I>Wed Jan 22 19:59:08 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033233.html">[rabbitmq-discuss] a lot of unacked messages &quot;in the flight&quot;
</A></li>
        <LI>Next message: <A HREF="033228.html">[rabbitmq-discuss] Federation Upstream Set Policy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33267">[ date ]</a>
              <a href="thread.html#33267">[ thread ]</a>
              <a href="subject.html#33267">[ subject ]</a>
              <a href="author.html#33267">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Jan 21, 2014 at 1:06 PM, Kane Kim &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">kane.isturm at gmail.com</A>&gt; wrote:

&gt;<i> Is it ok to have many unacked messages in rabbitmq (millions)?
</I>&gt;<i>
</I>
The real answer is &quot;it depends&quot; but be mindful and understand what it means
and what it depends on.

 A message in the unacked state has been delivered to a consumer, but the
broker is still maintaining knowledge of it.  That way, if the consumer
crashes, and its channel closes, without having sent an ACK, the broker
knows to re-queue the message for another delivery attempt.  It does this,
because, in the absence of the consumer's ACK, it has no way of knowing the
consumer got any useful work done with the consumed message before it
perished.

Messages languishing on the broker in the 'unacked' state consume
resources.  At the very least memory.  If they were published with
persistence requested, or if the broker has paged them to disk under memory
pressure, they will also consume disk space.  Finally, there's some small
in memory indexing overhead associated with each message as well.

If you let messages build up too long you can get into trouble as your
broker runs low on memory or disk resources.  The broker will try to pause
publishers to avoid being swamped, but you're still best managing your
application in a way that such conditions don't exist for long periods.

If you have *millions* of un-acked messages in queues, I would start to
wonder if perhaps your consumers are getting their work done and failing to
ACK.  Or perhaps they're working properly and obeying proper ACK
discipline, but incoming work is arriving at a rate that outpaces them.  In
that case you'd be wise to add more consumers....

A good general mantra:  &quot;A Happy Rabbit is an Empty&quot; rabbit.  Message
brokers will hold messages to buffer against transient spikes in traffic,
but they're not intended to be long term stores of persistent data, and
shouldn't be treated as such.  If you have a lot of messages piling up in
the broker, look at your producer arrival and consumer exit situations to
understand what's happening.  It's often a sign that either the ambient
conditions of your system have changed (e.g. a flood of new demand due to a
surge in work) or something has crashed or backed up...

Knowing the expected and usual queue sizes and whatnot, learned by
experience and observation of your system, is a good practice in
operationalizing this sort of stuff.

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140122/0b8f0174/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140122/0b8f0174/attachment.html</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033233.html">[rabbitmq-discuss] a lot of unacked messages &quot;in the flight&quot;
</A></li>
	<LI>Next message: <A HREF="033228.html">[rabbitmq-discuss] Federation Upstream Set Policy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33267">[ date ]</a>
              <a href="thread.html#33267">[ thread ]</a>
              <a href="subject.html#33267">[ subject ]</a>
              <a href="author.html#33267">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
