<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Publisher confirms always wait for consumer	ack/nack
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publisher%20confirms%20always%20wait%20for%20consumer%0A%09ack/nack&In-Reply-To=%3CCA%2B6GtrDtS6jLj7y778TuLEHSbb6_WKW4%2B57Wctmfg-%3DO3v75Lg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033284.html">
   <LINK REL="Next"  HREF="033269.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Publisher confirms always wait for consumer	ack/nack</H1>
    <B>Bertrand LEMASLE</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publisher%20confirms%20always%20wait%20for%20consumer%0A%09ack/nack&In-Reply-To=%3CCA%2B6GtrDtS6jLj7y778TuLEHSbb6_WKW4%2B57Wctmfg-%3DO3v75Lg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Publisher confirms always wait for consumer	ack/nack">blemasle at allocine.fr
       </A><BR>
    <I>Wed Jan 22 17:07:56 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033284.html">[rabbitmq-discuss] Http Management Plugin: statistics_db_node not_running
</A></li>
        <LI>Next message: <A HREF="033269.html">[rabbitmq-discuss] Publisher confirms always wait for consumer	ack/nack
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33264">[ date ]</a>
              <a href="thread.html#33264">[ thread ]</a>
              <a href="subject.html#33264">[ subject ]</a>
              <a href="author.html#33264">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

After reading many docs and mails on this subject (
<A HREF="http://www.rabbitmq.com/confirms.html">http://www.rabbitmq.com/confirms.html</A> included which explains when a
message will be confirmed), I still haven't found an answer to my question.
When using publisher confirm (by using confirmSelect on the channel),
messages aren't ack until they are either ack or nack by at least one
consumer.

I've created a rather simple consumer that wait for 10 seconds then ack the
message and noticed that the publisher ack arrives only once the consumer
acked the message. By the meantime, shouldn't the message be persisted to
the disk and so, the publisher ack be sent back ?

Using :
 * RabbitMQ 3.2.2 on Erlang R16B
 * .Net client 3.2.1

Here is the basic code I'm using to publish my message :

IBasicProperties properties = Channel.CreateBasicProperties();
properties.MessageId = Guid.NewGuid().ToString();
properties.DeliveryMode = 2; //persistent

Channel.BasicPublish(Exchange, routingKey, true, properties, message);
published = Channel.WaitForConfirms(TimeSpan.FromSeconds(timeout), out
timedout) &amp;&amp; !timedout;

For those who aren't familiar with the .Net client, the &quot;true&quot; argument on
BasicPublish set the mandatory flag.

With my 10 seconds waiting consumer, published is always false as long as
the timeout is less than those 10 seconds...

What am I doing wrong ? Any help would be deeply appreciated !

Cheers
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140122/a7aa4e91/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140122/a7aa4e91/attachment.html</A>&gt;
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033284.html">[rabbitmq-discuss] Http Management Plugin: statistics_db_node not_running
</A></li>
	<LI>Next message: <A HREF="033269.html">[rabbitmq-discuss] Publisher confirms always wait for consumer	ack/nack
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33264">[ date ]</a>
              <a href="thread.html#33264">[ thread ]</a>
              <a href="subject.html#33264">[ subject ]</a>
              <a href="author.html#33264">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
