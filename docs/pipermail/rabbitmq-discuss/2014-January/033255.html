<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ couldn't recover after the free disk space went below the default threshold limit
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20couldn%27t%20recover%20after%20the%20free%20disk%0A%20space%20went%20below%20the%20default%20threshold%20limit&In-Reply-To=%3CDB14E94115BBC84E8960C12C176D06760178F80EDA%40MX25A.corp.emc.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033335.html">
   <LINK REL="Next"  HREF="033257.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ couldn't recover after the free disk space went below the default threshold limit</H1>
    <B>Jain, Punit</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20couldn%27t%20recover%20after%20the%20free%20disk%0A%20space%20went%20below%20the%20default%20threshold%20limit&In-Reply-To=%3CDB14E94115BBC84E8960C12C176D06760178F80EDA%40MX25A.corp.emc.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ couldn't recover after the free disk space went below the default threshold limit">Punit.Jain at emc.com
       </A><BR>
    <I>Wed Jan 22 15:13:52 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033335.html">[rabbitmq-discuss] &#31572;&#22797;:  Odd performance testing result
</A></li>
        <LI>Next message: <A HREF="033257.html">[rabbitmq-discuss] RabbitMQ couldn't recover after the free disk space went below the default threshold limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33255">[ date ]</a>
              <a href="thread.html#33255">[ thread ]</a>
              <a href="subject.html#33255">[ subject ]</a>
              <a href="author.html#33255">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,
We are using RabbitMQ 3.1.3. It was running fine, but recently it couldn't recover itself after the free disk space went below the threshold limit. We didn't modify the default threshold. I have appended few excerpts from the logs, which I thought are relevant; let me know if you need any other information or logs.

Thanks in Advance!
Punit

=INFO REPORT==== 18-Jan-2014::11:29:38 ===
accepting AMQP connection &lt;0.6291.2&gt; (127.0.0.1:8198 -&gt; 127.0.0.1:5672)

=INFO REPORT==== 18-Jan-2014::11:29:52 ===
Disk free space insufficient. Free bytes:994299904 Limit:1000000000

=WARNING REPORT==== 18-Jan-2014::11:29:52 ===
disk resource limit alarm set on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost.</A>

**********************************************************
*** Publishers will be blocked until this alarm clears ***
**********************************************************

=WARNING REPORT==== 18-Jan-2014::11:30:10 ===
closing AMQP connection &lt;0.6280.2&gt; (127.0.0.1:8181 -&gt; 127.0.0.1:5672):
connection_closed_abruptly

=ERROR REPORT==== 18-Jan-2014::14:38:54 ===
** Generic server mnesia_sync terminating
** Last message in was timeout
** When Server state == {state,[{&lt;0.1100.2&gt;,#Ref&lt;0.0.16.193586&gt;}],true}
** Reason for termination ==
** {{badmatch,{error,{file_error,&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>/LATEST.LOG&quot;,
                                 enospc}}},
    [{mnesia_sync,handle_info,2,[]},
     {gen_server,handle_msg,5,[{file,&quot;gen_server.erl&quot;},{line,607}]},
     {proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}]}

=ERROR REPORT==== 18-Jan-2014::14:38:54 ===
webmachine error: path=&quot;/api/parameters/federation-upstream/%2f/LocalDir_Upstream&quot;
{error,
    {exit,
        {{{badmatch,
              {error,
                  {file_error,
                      &quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>/LATEST.LOG&quot;,
                      enospc}}},
          [{mnesia_sync,handle_info,2,[]},
           {gen_server,handle_msg,5,[{file,&quot;gen_server.erl&quot;},{line,607}]},
           {proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}]},
         {gen_server,call,[mnesia_sync,sync,infinity]}},
        [{gen_server,call,3,[{file,&quot;gen_server.erl&quot;},{line,188}]},
         {rabbit_misc,execute_mnesia_transaction,1,[]},
         {rabbit_runtime_parameters,set_any0,4,[]},
         {rabbit_runtime_parameters,set_any,4,[]},
         {rabbit_mgmt_wm_parameter,'-accept_content/2-fun-0-',5,[]},
         {rabbit_mgmt_util,with_decode,5,[]},
         {webmachine_resource,resource_call,3,[]},
         {webmachine_resource,do,3,[]}]}}
=WARNING REPORT==== 18-Jan-2014::14:38:54 ===
Connection (&lt;0.7261.2&gt;) closing: internal error in channel (&lt;0.7268.2&gt;): shutdown

=WARNING REPORT==== 18-Jan-2014::14:38:54 ===
Connection (&lt;0.7318.2&gt;) closing: internal error in channel (&lt;0.7344.2&gt;): shutdown

=WARNING REPORT==== 18-Jan-2014::14:38:54 ===
Connection (&lt;0.7310.2&gt;) closing: internal error in channel (&lt;0.7335.2&gt;): shutdown

=WARNING REPORT==== 18-Jan-2014::14:38:54 ===
Connection (&lt;0.7328.2&gt;) closing: internal error in channel (&lt;0.7353.2&gt;): shutdown

=INFO REPORT==== 18-Jan-2014::14:38:54 ===
stopped TCP Listener on [::]:5672

=WARNING REPORT==== 18-Jan-2014::14:38:54 ===
Connection (&lt;0.7305.2&gt;) closing: internal error in channel (&lt;0.7323.2&gt;): shutdown

=ERROR REPORT==== 18-Jan-2014::14:38:54 ===
AMQP connection &lt;0.20548.1&gt; (blocking), channel 1 - error:
shutdown

=WARNING REPORT==== 18-Jan-2014::14:38:54 ===
Non-AMQP exit reason 'shutdown'

=ERROR REPORT==== 18-Jan-2014::14:38:54 ===
AMQP connection &lt;0.11369.2&gt; (blocked), channel 3 - error:
shutdown

=WARNING REPORT==== 18-Jan-2014::14:38:54 ===
Non-AMQP exit reason 'shutdown'

=ERROR REPORT==== 18-Jan-2014::14:38:54 ===
AMQP connection &lt;0.6437.2&gt; (blocked), channel 3 - error:
shutdown

=WARNING REPORT==== 18-Jan-2014::14:38:54 ===
Non-AMQP exit reason 'shutdown'

=ERROR REPORT==== 18-Jan-2014::14:38:54 ===
closing AMQP connection &lt;0.6437.2&gt; (127.0.0.1:8950 -&gt; 127.0.0.1:5672):
{inet_error,enotconn}

=ERROR REPORT==== 18-Jan-2014::14:38:54 ===
** Generic server msg_store_persistent terminating
** Last message in was {'EXIT',&lt;0.166.0&gt;,shutdown}
** When Server state == {msstate,
                            &quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>/msg_store_persistent&quot;,
                            rabbit_msg_store_ets_index,
                            {state,241739,
                                &quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>/msg_store_persistent&quot;},
                            0,#Ref&lt;0.0.0.1083&gt;,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            undefined,657,7536,[],&lt;0.229.0&gt;,245836,237642,
                            249933,254030,
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,4,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],
                                  [[&lt;&lt;47,239,116,176,238,253,171,103,27,228,
                                      101,97,202,108,131,196&gt;&gt;|
                                    {&lt;0.233.0&gt;,
                                     #Fun&lt;rabbit_variable_queue.1.98519756&gt;,
                                     #Fun&lt;rabbit_variable_queue.13.110761503&gt;}]],
                                  [],
                                  [[&lt;&lt;245,14,237,152,23,39,217,67,22,170,155,
                                      57,40,30,29,108&gt;&gt;|
                                    {&lt;0.234.0&gt;,
                                     #Fun&lt;rabbit_variable_queue.1.98519756&gt;,
                                     #Fun&lt;rabbit_variable_queue.13.110761503&gt;}]],
                                  [[&lt;&lt;3,56,140,195,127,215,175,32,168,21,13,
                                      192,178,56,76,211&gt;&gt;|
                                    {&lt;0.4047.0&gt;,
                                     #Fun&lt;rabbit_variable_queue.1.98519756&gt;,
                                     #Fun&lt;rabbit_variable_queue.13.110761503&gt;}]],
                                 [[&lt;&lt;71,36,220,167,246,169,123,248,249,183,
                                      209,118,140,198,38,8&gt;&gt;|
                                    {&lt;0.4010.0&gt;,
                                     #Fun&lt;rabbit_variable_queue.1.98519756&gt;,
                                     #Fun&lt;rabbit_variable_queue.13.110761503&gt;}]],
                                  [],[],[],[]}}},
                            false,16777216,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}}}
** Reason for termination ==
** {{badmatch,{error,{file_error,&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>/msg_store_persistent/file_summary.ets&quot;,
                                 enospc}}},
    [{rabbit_msg_store,store_file_summary,2,[]},
     {rabbit_msg_store,terminate,2,[]},
     {gen_server2,terminate,3,[]},
     {proc_lib,wake_up,3,[{file,&quot;proc_lib.erl&quot;},{line,237}]}]}
** In 'terminate' callback with reason ==
** shutdown
=ERROR REPORT==== 18-Jan-2014::14:38:58 ===
** Generic server rabbit_mgmt_external_stats terminating
** Last message in was emit_update
** When Server state == {state,1024}
** Reason for termination ==
** {noproc,{gen_server,call,[rabbit_node_monitor,partitions,infinity]}}

=ERROR REPORT==== 18-Jan-2014::14:38:59 ===
webmachine error: path=&quot;/api/parameters/federation-upstream/%2f/LocalDir_Upstream&quot;
{error,{error,badarg,
              [{ets,lookup,
                    [rabbit_registry,
                     {runtime_parameter,'federation-upstream'}],
                    []},
               {rabbit_registry,lookup_module,2,[]},
               {rabbit_runtime_parameters,lookup_component,1,[]},
               {rabbit_runtime_parameters,set_any0,4,[]},
               {rabbit_runtime_parameters,set_any,4,[]},
               {rabbit_mgmt_wm_parameter,'-accept_content/2-fun-0-',5,[]},
               {rabbit_mgmt_util,with_decode,5,[]},
               {webmachine_resource,resource_call,3,[]}]}}

=INFO REPORT==== 18-Jan-2014::15:20:52 ===
Error description:
   {error,{could_not_write_file,&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>/cluster_nodes.config&quot;,
                                enospc}}

Log files (may contain more information):
   /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost.log</A>
   /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost-sasl.log</A>

Stack trace:
   [{rabbit_node_monitor,write_cluster_status,1,[]},
    {rabbit_node_monitor,prepare_cluster_status_files,0,[]},
    {rabbit,'-boot/0-fun-1-',0,[]},
    {rabbit,start_it,1,[]},
    {init,start_it,1,[]},
    {init,start_em,1,[]}]


=INFO REPORT==== 18-Jan-2014::15:32:08 ===
Error description:
   {error,corrupt_cluster_status_files,[]}

Log files (may contain more information):
   /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost.log</A>
   /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost-sasl.log</A>

Stack trace:
   [{rabbit_node_monitor,'-prepare_cluster_status_files/0-fun-0-',1,[]},
    {rabbit_node_monitor,prepare_cluster_status_files,0,[]},
    {rabbit,'-boot/0-fun-1-',0,[]},
    {rabbit,start_it,1,[]},
    {init,start_it,1,[]},
    {init,start_em,1,[]}]




-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140122/217d2ecb/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140122/217d2ecb/attachment.html</A>&gt;
</PRE>































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033335.html">[rabbitmq-discuss] &#31572;&#22797;:  Odd performance testing result
</A></li>
	<LI>Next message: <A HREF="033257.html">[rabbitmq-discuss] RabbitMQ couldn't recover after the free disk space went below the default threshold limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33255">[ date ]</a>
              <a href="thread.html#33255">[ thread ]</a>
              <a href="subject.html#33255">[ subject ]</a>
              <a href="author.html#33255">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
