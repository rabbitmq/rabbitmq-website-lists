From pablomolnar at gmail.com  Wed Feb  1 00:27:04 2012
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Tue, 31 Jan 2012 21:27:04 -0300
Subject: [rabbitmq-discuss] Lost messages in HA tests in a cluster
In-Reply-To: <CAOn7oW9D9XEfrDxWyLnWc=tPB4xb2Wqy8To_R3odbHCOD4ZW1A@mail.gmail.com>
References: <CANVSfpLnE=0+51PvMz7vB2L+3UEv-CSoNndEsC4edwy96PGOnA@mail.gmail.com>
	<CAOn7oW9D9XEfrDxWyLnWc=tPB4xb2Wqy8To_R3odbHCOD4ZW1A@mail.gmail.com>
Message-ID: <CANVSfp+Jbyp1=QF5KBXuQw2Nov2ibt26CxWDSzG4yM7vb3p6RA@mail.gmail.com>

Ok...so I'm maybe confused. Basically I follow this example:

http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/examples/ConfirmDontLoseMessages.java

Using the sentences ch.confirmSelect(); and ch.waitForConfirmsOrDie();  all
in a durable queue.

This example doesn't cover republishing nacks? Do you have an example? I
have to implement a ConfirmListener?

Thanks for helping Simone!

On Tue, Jan 31, 2012 at 8:43 PM, Simone Busoli <simone.busoli at gmail.com>wrote:

> Hi Pablo, looking at your code I can't see where you are republishing
> messages which have not been confirmed by the broker. If you want to make
> sure that publishes will eventually be delivered you have to keep track of
> them and re-issue them in case an ack doesn't arrive from the broker, which
> usually happens when the broker dies.
> On Jan 31, 2012 11:52 PM, "Pablo Molnar" <pablomolnar at gmail.com> wrote:
>
>> Hi all!
>>
>> I'm doing some HA tests stressing my cluster and I'm experimenting lost
>> messages ONLY when the publisher lost the connection due a kill -9.
>>
>> *Test OK*: Kill node while consuming:
>> 1 - Setup a clean 3 node's cluster
>> 2 - Execute producer with 10.000 messages connected to node A
>> 3 - Wait producer to finish
>> 4 - Execute consumer connected to node A
>> 5 - While consumer is running kill node A
>>
>> Result: The consumer reconnects to another node and consume the rest of
>> messages ok. All 10.000 messages were consumed ok.
>>
>> *Test FAILED*: Kill node while producing:
>> 1 - Setup a clean 3 node's cluster
>> 2 - Execute consumer to start listening connected node A
>> 3 - Execute producer with 10.000 messages connected to node A
>> 4 - While producer is running kill node A
>>
>> Result: The producer reconnects fine (the consumer too) and keep
>> publishing but some of the messages* already published* to node A are
>> lost.
>>
>>
>> These are my settings:
>>
>> rabbitmqctl status
>> Status of node 'rabbit at i-00000007-asm' ...
>> [{pid,11339},
>>  {running_applications,
>>      [{rabbitmq_management,"RabbitMQ Management Console","2.7.1"},
>>       {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
>>       {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
>>       {rabbit,"RabbitMQ","2.7.1"},
>>       {os_mon,"CPO  CXC 138 46","2.2.4"},
>>       {sasl,"SASL  CXC 138 11","2.1.8"},
>>       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
>>       {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
>>       {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
>>       {inets,"INETS  CXC 138 49","5.2"},
>>       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>>       {stdlib,"ERTS  CXC 138 10","1.16.4"},
>>       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>>  {os,{unix,linux}},
>>  {erlang_version,
>>      "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:2:2] [rq:2]
>> [async-threads:0] [hipe] [kernel-poll:false]\n"},
>>  {memory,
>>      [{total,92565608},
>>       {processes,4004968},
>>       {processes_used,3996224},
>>       {system,88560640},
>>       {atom,1322033},
>>       {atom_used,1291462},
>>       {binary,32496},
>>       {code,15264387},
>>       {ets,1174192}]},
>>  {vm_memory_high_watermark,0.3999999999362281},
>>  {vm_memory_limit,2508940902}]
>> ...done.
>>
>>
>>
>> rabbitmqctl cluster_status
>> Cluster status of node 'rabbit at i-00000007-asm' ...
>> [{nodes,[{disc,['rabbit at i-0000001a-zsm','rabbit at i-00000007-asm']},
>>          {ram,['rabbit at i-00000009-asm']}]},
>>  {running_nodes,['rabbit at i-0000001a-zsm','rabbit at i-00000007-asm']}]
>> ...done.
>>
>>
>> *
>> Java amqp-client 2.7.1*
>>
>>
>> - Producer.groovy (java amqp-client 2.7.1)
>>
>> import com.rabbitmq.client.*
>> try{
>>
>> // Get rabbitmq config
>> def config = new ConfigSlurper().parse(new
>> File('../rabbitmq.properties').toURL())
>>
>> def rabbit = new RabbitHA(config)
>> rabbit.init = { channel ->
>>   channel.exchangeDeclare('myExchange', "direct", true) // Durable
>> exchange
>>   channel.queueDeclare('myQueue', true, false, false, ["x-ha-policy":
>> "all"]) // Durable exchange and HA policy
>>   channel.queueBind('myQueue', 'myExchange', '')
>>   channel.confirmSelect()
>> }
>>
>> 10000.times { idx ->
>>   rabbit.publish { channel ->
>>     def properties = new
>> AMQP.BasicProperties.Builder().deliveryMode(2).build() // Delivery mode 2:
>> persistent
>>     def msg = "Message $idx"
>>     channel.basicPublish('myExchange', '', properties, msg.getBytes())
>>     println msg
>>   }
>> }
>>
>> rabbit.close()
>>
>> } catch(e){e.printStackTrace()}
>>
>>
>> - Consumer.groovy
>>
>> import com.rabbitmq.client.*
>>
>> try{
>>
>>   // Get rabbitmq config
>>   def config = new ConfigSlurper().parse(new
>> File('../rabbitmq.properties').toURL())
>>
>>   // Connect
>>   def rabbit = new RabbitHA(config)
>>   rabbit.onDelivery('myQueue'){ delivery, channel ->
>>   def msg = new String(delivery.body)
>>   println msg
>>
>>   // Manual ack
>>   channel.basicAck(delivery.envelope.deliveryTag, false)
>>
>> } catch(e){e.printStackTrace()}
>>
>>
>> - RabbitHA.groovy
>>
>> import com.rabbitmq.client.*
>>
>> /**
>>  *
>>  * RabbitMQ highly available proxy.
>>  * Basic implementation of a basic suscriber/publisher with reconnect
>> logic.
>>  *
>>  */
>> class RabbitHA {
>>     ConnectionFactory connectionFactory
>>     Address[] addresses
>>     Closure init
>>
>>     Connection connection
>>     Channel channel
>>     QueueingConsumer consumer
>>
>>     public RabbitHA(Map config) {
>>         this(config, null)
>>     }
>>
>>     public RabbitHA(Map config, Closure init){
>>         this.connectionFactory = new ConnectionFactory([username:
>> config.username, password: config.password, virtualHost:
>> config.virtualHost])
>>         this.addresses = Address.parseAddresses(config.addresses)
>>         this.init = init
>>         connectChannel()
>>     }
>>
>>     void onDelivery(String queueName, Closure closure) {
>>         basicConsume(queueName)
>>         int i = 0
>>
>>         while(true) {
>>             try {
>>                 QueueingConsumer.Delivery delivery =
>> consumer.nextDelivery()
>>                 closure(delivery, channel)
>>                 i = 0
>>             } catch(e) {
>>                 // Only handle exceptions
>>                 if(!(e in ShutdownSignalException || e in IOException ||
>> e in AlreadyClosedException)) throw e
>>
>>                 i++
>>                 e.printStackTrace()
>>                 println "ShutdownSignalException recieved! Reconnection
>> attempt #$i"
>>                 connectChannel()
>>                 basicConsume(queueName)
>>             }
>>         }
>>     }
>>
>>     void publish(Closure closure) {
>>         int i = 0
>>         boolean retry = true
>>         while(retry) {
>>             try {
>>                 closure(channel)
>>                 i = 0
>>                 retry = false
>>             } catch(e) {
>>                 // Only handle exceptions
>>                 if(!(e in ShutdownSignalException || e in IOException ||
>> e in AlreadyClosedException)) throw e
>>
>>                 i++
>>                 retry = true
>>                 e.printStackTrace()
>>                 println "ShutdownSignalException recieved! Reconnection
>> attempt #$i"
>>                 connectChannel()
>>             }
>>         }
>>     }
>>
>>
>>     void connectChannel() {
>>         connection = connectionFactory.newConnection(addresses)
>>         channel = connection.createChannel()
>>
>>         println "Succesfully connected to $connection.address"
>>
>>         if(init) {
>>             init(channel)
>>         }
>>     }
>>
>>     void basicConsume(queueName) {
>>         consumer = new QueueingConsumer(channel)
>>         channel.basicConsume(queueName, false, consumer)
>>     }
>>
>>     void close() {
>>         channel.waitForConfirmsOrDie()
>>         channel.close()
>>         connection.close()
>>     }
>> }
>>
>>
>>
>> Output:
>>
>> cat consumer-output.txt |grep Message | wc
>>    9957   19914  128330
>>
>> cat producer-output.txt | grep Message | wc
>>   10000   20000  128890
>>
>> *Note that consumer lost 43 messages*
>>
>> Output from producer :
>> ...
>> Message 1466
>> Message 1467
>> Message 1468
>> Message 1469
>> Message 1470
>> ShutdownSignalException recieved! Reconnection attempt #1
>> Succesfully connected to i-0000001a-zsm/172.16.158.46
>> Message 1471
>> Message 1472
>> Message 1473
>> Message 1474
>> Message 1475
>> Message 1476
>> ...
>>
>> *
>> Note messages [1471..1476] were consumed ok, but [1466..1470] are missing
>> in consumer output.*
>>
>> The complete outputs are in
>> https://github.com/pablomolnar/rabbitmq_samples/tree/master/out. There
>> you can see reconnection log of both parts.
>> I've a strong feeling the publisher confirms is not well configured.
>>
>> Please anyone could shed some light on the issue?
>>
>> Cheers,
>> Pablo Molnar
>>
>> PD: Also I take the opportunity to share a lot of groovy examples I've
>> been working in the last days:
>> https://github.com/pablomolnar/rabbitmq_samples
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/c142b975/attachment.htm>

From santiagomonttco at gmail.com  Wed Feb  1 02:47:34 2012
From: santiagomonttco at gmail.com (CURSO CERRADO)
Date: Tue, 31 Jan 2012 23:47:34 -0300
Subject: [rabbitmq-discuss] =?windows-1252?q?ACCIDENTES_DEL_TRABAJO_=22RES?=
	=?windows-1252?q?PONSABILIDAD_CIVIL_Y_PENAL=22_Consulte_precio_esp?=
	=?windows-1252?q?ecial_por_el_mes_de_Febrero?=
Message-ID: <a9e0d7743be5076a1a76b82f001f2b11@gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120131/da1f52c5/attachment.htm>

From marcus_rubeus at hotmail.com  Wed Feb  1 02:55:52 2012
From: marcus_rubeus at hotmail.com (MarcusR)
Date: Tue, 31 Jan 2012 18:55:52 -0800 (PST)
Subject: [rabbitmq-discuss] Keeping track of exchanges -- Any Advice
In-Reply-To: <4F26821A.4040001@rabbitmq.com>
References: <ab66f90c-2e4e-49ff-987e-425a493e4b68@t8g2000yqg.googlegroups.com>
	<4F16A110.6000205@rabbitmq.com>
	<94a5f80b-b18a-4a7e-aa6f-de7a74cd2f22@m5g2000yqk.googlegroups.com>
	<4F26821A.4040001@rabbitmq.com>
Message-ID: <e0c10d8e-ba13-475d-b079-fdefac680b11@i18g2000yqf.googlegroups.com>

Direct routing would be great since all my code is already written for
direct routing. The problem with direct routing is rabbitmq (based on
the amqp spec) keeps throwing a channel exception if a message is sent
to an exchange that does not exist. Is there an extension within
rabbitmq that says "Pretend messages that get sent to a non-existant
exchange are sent and just discard the messages?"

If not, then I have to keep track of a LOT of exchanges that are
created and destroyed in an unpredictable matter. The only advantage
to the topic exchange routing is to work around the amqp throwing
channel exceptions as I can guarantee xxx topic exchanges can exist.

From codevally at gmail.com  Wed Feb  1 03:44:27 2012
From: codevally at gmail.com (Roshan Pradeep)
Date: Wed, 1 Feb 2012 14:44:27 +1100
Subject: [rabbitmq-discuss] RabbitMQ log files rotation daily
Message-ID: <CAH+_+m7cBWux=DenOPXxgr_ndZjxgBOrfz9WN--EPFB0-A8iBA@mail.gmail.com>

Hi All

I want to rotate the RabbitMQ log files in daily basis like support in
log4j. The only log rotate support I found is rabbitmqctl rotate_logs
<suffix>.

Could some one please explain how to achieve the daily log file rotation.
Also I am not sure what kind of suffix expect from rabbitmqctl rotate_logs.

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120201/2b62123f/attachment.htm>

From simone.busoli at gmail.com  Wed Feb  1 06:13:18 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 1 Feb 2012 07:13:18 +0100
Subject: [rabbitmq-discuss] Lost messages in HA tests in a cluster
In-Reply-To: <CANVSfp+Jbyp1=QF5KBXuQw2Nov2ibt26CxWDSzG4yM7vb3p6RA@mail.gmail.com>
References: <CANVSfpLnE=0+51PvMz7vB2L+3UEv-CSoNndEsC4edwy96PGOnA@mail.gmail.com>
	<CAOn7oW9D9XEfrDxWyLnWc=tPB4xb2Wqy8To_R3odbHCOD4ZW1A@mail.gmail.com>
	<CANVSfp+Jbyp1=QF5KBXuQw2Nov2ibt26CxWDSzG4yM7vb3p6RA@mail.gmail.com>
Message-ID: <CAOn7oW8aYqaz-U25GmnUwjh+gOFe3ivxdbetNu0hCsLgBWqOdg@mail.gmail.com>

The name of the example is probably a little misleading, in that it simply
allows you to know if messages may have been lost, but does nothing to cope
with eventually lost messages.
You indeed have to implement a confirm listener and set up republishing
yourself. Also, by definition republishing unconfirmed messages may lead to
duplicate messages.
On Feb 1, 2012 1:27 AM, "Pablo Molnar" <pablomolnar at gmail.com> wrote:

> Ok...so I'm maybe confused. Basically I follow this example:
>
>
> http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/examples/ConfirmDontLoseMessages.java
>
> Using the sentences ch.confirmSelect(); and ch.waitForConfirmsOrDie();  all
> in a durable queue.
>
> This example doesn't cover republishing nacks? Do you have an example? I
> have to implement a ConfirmListener?
>
> Thanks for helping Simone!
>
> On Tue, Jan 31, 2012 at 8:43 PM, Simone Busoli <simone.busoli at gmail.com>wrote:
>
>> Hi Pablo, looking at your code I can't see where you are republishing
>> messages which have not been confirmed by the broker. If you want to make
>> sure that publishes will eventually be delivered you have to keep track of
>> them and re-issue them in case an ack doesn't arrive from the broker, which
>> usually happens when the broker dies.
>> On Jan 31, 2012 11:52 PM, "Pablo Molnar" <pablomolnar at gmail.com> wrote:
>>
>>> Hi all!
>>>
>>> I'm doing some HA tests stressing my cluster and I'm experimenting lost
>>> messages ONLY when the publisher lost the connection due a kill -9.
>>>
>>> *Test OK*: Kill node while consuming:
>>> 1 - Setup a clean 3 node's cluster
>>> 2 - Execute producer with 10.000 messages connected to node A
>>> 3 - Wait producer to finish
>>> 4 - Execute consumer connected to node A
>>> 5 - While consumer is running kill node A
>>>
>>> Result: The consumer reconnects to another node and consume the rest of
>>> messages ok. All 10.000 messages were consumed ok.
>>>
>>> *Test FAILED*: Kill node while producing:
>>> 1 - Setup a clean 3 node's cluster
>>> 2 - Execute consumer to start listening connected node A
>>> 3 - Execute producer with 10.000 messages connected to node A
>>> 4 - While producer is running kill node A
>>>
>>> Result: The producer reconnects fine (the consumer too) and keep
>>> publishing but some of the messages* already published* to node A are
>>> lost.
>>>
>>>
>>> These are my settings:
>>>
>>> rabbitmqctl status
>>> Status of node 'rabbit at i-00000007-asm' ...
>>> [{pid,11339},
>>>  {running_applications,
>>>      [{rabbitmq_management,"RabbitMQ Management Console","2.7.1"},
>>>       {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
>>>       {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
>>>       {rabbit,"RabbitMQ","2.7.1"},
>>>       {os_mon,"CPO  CXC 138 46","2.2.4"},
>>>       {sasl,"SASL  CXC 138 11","2.1.8"},
>>>       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
>>>       {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
>>>       {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
>>>       {inets,"INETS  CXC 138 49","5.2"},
>>>       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>>>       {stdlib,"ERTS  CXC 138 10","1.16.4"},
>>>       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>>>  {os,{unix,linux}},
>>>  {erlang_version,
>>>      "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:2:2] [rq:2]
>>> [async-threads:0] [hipe] [kernel-poll:false]\n"},
>>>  {memory,
>>>      [{total,92565608},
>>>       {processes,4004968},
>>>       {processes_used,3996224},
>>>       {system,88560640},
>>>       {atom,1322033},
>>>       {atom_used,1291462},
>>>       {binary,32496},
>>>       {code,15264387},
>>>       {ets,1174192}]},
>>>  {vm_memory_high_watermark,0.3999999999362281},
>>>  {vm_memory_limit,2508940902}]
>>> ...done.
>>>
>>>
>>>
>>> rabbitmqctl cluster_status
>>> Cluster status of node 'rabbit at i-00000007-asm' ...
>>> [{nodes,[{disc,['rabbit at i-0000001a-zsm','rabbit at i-00000007-asm']},
>>>          {ram,['rabbit at i-00000009-asm']}]},
>>>  {running_nodes,['rabbit at i-0000001a-zsm','rabbit at i-00000007-asm']}]
>>> ...done.
>>>
>>>
>>> *
>>> Java amqp-client 2.7.1*
>>>
>>>
>>> - Producer.groovy (java amqp-client 2.7.1)
>>>
>>> import com.rabbitmq.client.*
>>> try{
>>>
>>> // Get rabbitmq config
>>> def config = new ConfigSlurper().parse(new
>>> File('../rabbitmq.properties').toURL())
>>>
>>> def rabbit = new RabbitHA(config)
>>> rabbit.init = { channel ->
>>>   channel.exchangeDeclare('myExchange', "direct", true) // Durable
>>> exchange
>>>   channel.queueDeclare('myQueue', true, false, false, ["x-ha-policy":
>>> "all"]) // Durable exchange and HA policy
>>>   channel.queueBind('myQueue', 'myExchange', '')
>>>   channel.confirmSelect()
>>> }
>>>
>>> 10000.times { idx ->
>>>   rabbit.publish { channel ->
>>>     def properties = new
>>> AMQP.BasicProperties.Builder().deliveryMode(2).build() // Delivery mode 2:
>>> persistent
>>>     def msg = "Message $idx"
>>>     channel.basicPublish('myExchange', '', properties, msg.getBytes())
>>>     println msg
>>>   }
>>> }
>>>
>>> rabbit.close()
>>>
>>> } catch(e){e.printStackTrace()}
>>>
>>>
>>> - Consumer.groovy
>>>
>>> import com.rabbitmq.client.*
>>>
>>> try{
>>>
>>>   // Get rabbitmq config
>>>   def config = new ConfigSlurper().parse(new
>>> File('../rabbitmq.properties').toURL())
>>>
>>>   // Connect
>>>   def rabbit = new RabbitHA(config)
>>>   rabbit.onDelivery('myQueue'){ delivery, channel ->
>>>   def msg = new String(delivery.body)
>>>   println msg
>>>
>>>   // Manual ack
>>>   channel.basicAck(delivery.envelope.deliveryTag, false)
>>>
>>> } catch(e){e.printStackTrace()}
>>>
>>>
>>> - RabbitHA.groovy
>>>
>>> import com.rabbitmq.client.*
>>>
>>> /**
>>>  *
>>>  * RabbitMQ highly available proxy.
>>>  * Basic implementation of a basic suscriber/publisher with reconnect
>>> logic.
>>>  *
>>>  */
>>> class RabbitHA {
>>>     ConnectionFactory connectionFactory
>>>     Address[] addresses
>>>     Closure init
>>>
>>>     Connection connection
>>>     Channel channel
>>>     QueueingConsumer consumer
>>>
>>>     public RabbitHA(Map config) {
>>>         this(config, null)
>>>     }
>>>
>>>     public RabbitHA(Map config, Closure init){
>>>         this.connectionFactory = new ConnectionFactory([username:
>>> config.username, password: config.password, virtualHost:
>>> config.virtualHost])
>>>         this.addresses = Address.parseAddresses(config.addresses)
>>>         this.init = init
>>>         connectChannel()
>>>     }
>>>
>>>     void onDelivery(String queueName, Closure closure) {
>>>         basicConsume(queueName)
>>>         int i = 0
>>>
>>>         while(true) {
>>>             try {
>>>                 QueueingConsumer.Delivery delivery =
>>> consumer.nextDelivery()
>>>                 closure(delivery, channel)
>>>                 i = 0
>>>             } catch(e) {
>>>                 // Only handle exceptions
>>>                 if(!(e in ShutdownSignalException || e in IOException
>>> || e in AlreadyClosedException)) throw e
>>>
>>>                 i++
>>>                 e.printStackTrace()
>>>                 println "ShutdownSignalException recieved! Reconnection
>>> attempt #$i"
>>>                 connectChannel()
>>>                 basicConsume(queueName)
>>>             }
>>>         }
>>>     }
>>>
>>>     void publish(Closure closure) {
>>>         int i = 0
>>>         boolean retry = true
>>>         while(retry) {
>>>             try {
>>>                 closure(channel)
>>>                 i = 0
>>>                 retry = false
>>>             } catch(e) {
>>>                 // Only handle exceptions
>>>                 if(!(e in ShutdownSignalException || e in IOException
>>> || e in AlreadyClosedException)) throw e
>>>
>>>                 i++
>>>                 retry = true
>>>                 e.printStackTrace()
>>>                 println "ShutdownSignalException recieved! Reconnection
>>> attempt #$i"
>>>                 connectChannel()
>>>             }
>>>         }
>>>     }
>>>
>>>
>>>     void connectChannel() {
>>>         connection = connectionFactory.newConnection(addresses)
>>>         channel = connection.createChannel()
>>>
>>>         println "Succesfully connected to $connection.address"
>>>
>>>         if(init) {
>>>             init(channel)
>>>         }
>>>     }
>>>
>>>     void basicConsume(queueName) {
>>>         consumer = new QueueingConsumer(channel)
>>>         channel.basicConsume(queueName, false, consumer)
>>>     }
>>>
>>>     void close() {
>>>         channel.waitForConfirmsOrDie()
>>>         channel.close()
>>>         connection.close()
>>>     }
>>> }
>>>
>>>
>>>
>>> Output:
>>>
>>> cat consumer-output.txt |grep Message | wc
>>>    9957   19914  128330
>>>
>>> cat producer-output.txt | grep Message | wc
>>>   10000   20000  128890
>>>
>>> *Note that consumer lost 43 messages*
>>>
>>> Output from producer :
>>> ...
>>> Message 1466
>>> Message 1467
>>> Message 1468
>>> Message 1469
>>> Message 1470
>>> ShutdownSignalException recieved! Reconnection attempt #1
>>> Succesfully connected to i-0000001a-zsm/172.16.158.46
>>> Message 1471
>>> Message 1472
>>> Message 1473
>>> Message 1474
>>> Message 1475
>>> Message 1476
>>> ...
>>>
>>> *
>>> Note messages [1471..1476] were consumed ok, but [1466..1470] are
>>> missing in consumer output.*
>>>
>>> The complete outputs are in
>>> https://github.com/pablomolnar/rabbitmq_samples/tree/master/out. There
>>> you can see reconnection log of both parts.
>>> I've a strong feeling the publisher confirms is not well configured.
>>>
>>> Please anyone could shed some light on the issue?
>>>
>>> Cheers,
>>> Pablo Molnar
>>>
>>> PD: Also I take the opportunity to share a lot of groovy examples I've
>>> been working in the last days:
>>> https://github.com/pablomolnar/rabbitmq_samples
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120201/5cda261b/attachment.htm>

From steve at rabbitmq.com  Wed Feb  1 10:35:30 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 1 Feb 2012 10:35:30 +0000
Subject: [rabbitmq-discuss] ShutdownSignalException second 'channel.open'
In-Reply-To: <137381af-f9d8-4871-90d3-d60f478aa39b@x6g2000pbk.googlegroups.com>
References: <5fe26671-e654-48e6-80a6-05a181a8f814@kg1g2000pbb.googlegroups.com>
	<32E33686-2FCA-4800-BF2B-7B5953786B63@rabbitmq.com>
	<137381af-f9d8-4871-90d3-d60f478aa39b@x6g2000pbk.googlegroups.com>
Message-ID: <A00A77EA-EB93-45F3-9148-BCDA8C5F3C06@rabbitmq.com>

Yogesh,

Thanks for your explanation of your application structure, and the version you
are running.

I do not know how the second channel.open AMQP command (for the same channel)
was sent to the broker; can you send some more diagnostics of this failure (log,
full stack trace) so I can raise a bug. If possible, a demonstrating small
program. Thanks.

I see your difficulty. I would hope that creating 20000 queues (which are empty
almost all of the time) would not take up too much room, so I think you should
consider not deleting them at all. This would solve most of your problem.

The x-expires attribute for queues, really ought to have a 'only-if-empty'
option. I'll raise a bug (24722) for this, and see how difficult it would be.

I do not understand what the _Return queues are for. They look as though you are
using them as a private persistent store for each App. It would be better if you
put this information somewhere else, but heigh-ho -- you can safely delete these
queues since this app is in complete control of them, and the events are
processed serially.

One of the reasons, I don't do basicConsume on queues is, I am going to have
thousands of queues. I rather thought it would be easier to have a thread pool,
each consuming just one message from a queue in round-robin fashion.

Just because you have thousands of queues doesn't mean you need to have
thousands of Consumer instances -- it is quite ok to use the same Consumer on
several basicConsume calls. The consumerTag is passed to every Consumer callback
so the Consumer code can distinguish for which basicConsume it is called.

By default, the Java client will allocate a pool of 5 threads for each
connection, and dispatch Consumer callbacks onto one of those threads for you.
So your thread pool might be unnecessary if you used basicConsume(). I'd
consider doing that since basicGet() can be slow, and you'd have to get from
each potential queue just to tell if there is a message for it!

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 31 Jan 2012, at 13:56, Yogesh Ketkar wrote:

> I am using RabbitMQ server version 2.7.1.
> Java Client Jar used is
> rabbitmq-java-client-bin-2.7.1/rabbitmq-client.jar
> 
>> The Shutdown seems to be being called because the channel is being opened twice.
>> The broker complains about this and closes the connection. Are you creating
>> channels on different threads simultaneously?
> Yes indeed, I am creating channels on different threads.
> 
>> I don't think the basicPublish will fail if the queue doesn't exist. Why would
>> you create a new channel in this case?
> Yes, you are right. I will basically lose the message in this case.
> 
> Now about overall problem statement.
> My application has a main queue which looks like
> MainQueue
>  - App1-Event1
>  - App2-Event1
>  - App1-Event2
>  - App1-Event3
>  - App3-Event1
>  - App3-Event2
>  - App2-Event2
> 
> Basically there are going to be events from different Apps (there can
> be thousands of apps) and events belonging to an App must
> be processed sequentially. Events across different apps can and should
> be be processed in parallel.
> So I have only one consumer on MainQueue (using basicConsume) which
> reads events from MainQueue and just moves it to appropriate declared/
> redeclared queue.
> So this is how new queue structure would look like.
> 
> App1
>  - App1-Event1
>  - App1-Event2
>  - App1-Event3
> 
> App2
>  - App2-Event1
>  - App2-Event2
> 
> App3
>  - App3-Event1
>  - App3-Event2
> 
> 
> Now again when Event1 is processed from Queue App1, Event2 of App1
> can't be processed unless processing of Event1 is complete.
> Processing of event involves asynchronous communication with external
> systems, so once Event1 is fetched (and acknowledged) from queue
> App1,
> I create another queue like
> App1_Return
>  - App1-Event1-TaskId
> 
> I need to query external system using TaskId after certain time
> interval, to check status of event processing of Event1. Once I get
> the status (either sucess or failure)
> I discard App1-Event1-TaskId and ready to process App1-Event2. So all
> _Return queues will only have one event at any point of time.
> 
> An event on an app might even occur once a day. So I don't want to
> keep so many queues (potentially 20000 if there are 10000 apps)
> hanging around.
> Both auto_delete and x-expires are not very useful as in both the
> schemes, queues get deleted even when they have messages.
> Ideally whenever last message from any Queue (except MainQueue) is
> consumed, I want to delete that queue. Of course, one has to make sure
> while a queue is getting deleted, there might be an event destined for
> that. So if one guy is doing
> queueDelete('somequeue', true, true) and other guy is doing
> queueDeclare, queueBind, basicPublish. If queueDelete gets executed
> after
> queueBind, message will be lost.
> 
> One of the reasons, I don't do basicConsume on queues is, I am going
> to have thousands of queues. I rather thought it would be easier to
> have a thread pool, each consuming just one message from a queue in
> round-robin fashion.
> 
> As was mentioned in some other response, I will certainly not create a
> new channel in every thread, but would rather try and reuse them.
> 
> 
> Thanks for all the help.
> Regards, Yogesh
> 
> 
> 
> On Jan 31, 5:19 pm, Steve Powell <st... at rabbitmq.com> wrote:
>> Yogesh,
>> 
>> Please can you provide some information about your environment? And your
>> application? What version of RabbitMQ (and client) are you using?
>> 
>> In your stack trace the ShutdownListener you registered is apparently being
>> called, because the Connection is being shut down. It is not clear why this
>> exception (and its associated stack trace) appears, it seems to come from your
>> Listener code, but perhaps that does nothing.
>> 
>> The Shutdown seems to be being called because the channel is being opened twice.
>> The broker complains about this and closes the connection. Are you creating
>> channels on different threads simultaneously? (Looking at your app 'design' you
>> might be.) Depending upon the version of RabbitMQ this might cause a problem.
>> 
>> I'm afraid your application design is unclear:
>> 
>>> This is how I handle doing basicPublish and basicGet on potentially
>>> non-existent queues
>>> - publish involves 3 steps
>>>  queueDeclare
>>>  queueBind
>>>  basicPublish
>>>  If some other thread deletes the queue after either queueDeclare or
>>> queueBind, basicPublish fails and I again create a new
>>>  channel and do these operations
>> 
>> I don't think the basicPublish will fail if the queue doesn't exist. Why would
>> you create a new channel in this case?
>> 
>> Please explain why you expect the queue might be deleted by some other thread.
>> 
>>> - if basicGet fails, I simply ignore it
>> 
>> What do you mean by ignoring it? Do you poll the queue periodically? Why aren't
>> you using basicConsume and a Consumer to get messages (which will be notified if
>> the queue is deleted)?
>> 
>> Steve Powell  (a loopy bunny)
>> ----------some more definitions from the SPD----------
>> vermin (v.) Treating the dachshund for roundworm.
>> chinchilla (n.) Cooling device for the lower jaw.
>> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>> 
>> On 30 Jan 2012, at 04:33, Yogesh Ketkar wrote:
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>>> Only operations I ever do with com.rabbitmq.client.Connection in the
>>> code are
>>>    c.addShutdownListener
>>>    c.createChannel
>> 
>>> What does this error signify?
>> 
>>> 2012-01-30 09:44:45,158 ERROR  [ConnectionShutdownHandler]
>>> ShutdownListener
>>> com.rabbitmq.client.ShutdownSignalException: connection error; reason:
>>> {#method<connection.close>(reply-code=503, reply-text=COMMAND_INVALID
>>> - second 'channel.open' seen, class-id=20, method-id=10), null,
>>> "[B at 105691e"}
>>>    at com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:
>>> 641)
>>>    at
>>> com.rabbitmq.client.impl.AMQConnection.handleConnectionClose(AMQConnection. java:
>>> 599)
>>>    at
>>> com.rabbitmq.client.impl.AMQConnection.processControlCommand(AMQConnection. java:
>>> 571)
>>>    at com.rabbitmq.client.impl.AMQConnection
>>> $1.processAsync(AMQConnection.java:88)
>>>    at
>>> com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel .java:
>>> 144)
>>>    at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:
>>> 91)
>>>    at com.rabbitmq.client.impl.AMQConnection
>>> $MainLoop.run(AMQConnection.java:500)
>> 
>>> Some additional info.
>>> I create and close thousands of channels in the code. But at any point
>>> of time there are not more than 20/21 channels open.
>>> This is how I handle doing basicPublish and basicGet on potentially
>>> non-existent queues
>>> - publish involves 3 steps
>>>  queueDeclare
>>>  queueBind
>>>  basicPublish
>>>  If some other thread deletes the queue after either queueDeclare or
>>> queueBind, basicPublish fails and I again create a new
>>>  channel and do these operations
>>> - if basicGet fails, I simply ignore it
>> 
>>> regards, Yogesh
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Wed Feb  1 10:42:23 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 1 Feb 2012 10:42:23 +0000
Subject: [rabbitmq-discuss] Problem with RabbitMQ Java Client (Memory
	leak)
In-Reply-To: <fd4945fc-14a3-4efb-9016-c78a9cae8043@vh10g2000pbc.googlegroups.com>
References: <fd4945fc-14a3-4efb-9016-c78a9cae8043@vh10g2000pbc.googlegroups.com>
Message-ID: <4C8B808C-80D4-40BB-9C99-98609675EB9C@rabbitmq.com>

Yogesh,

Thank you for this problem report. First point: each connection defines a
(hidden) channel zero, so that explains why there are 20001 of some objects and
20000 of others.

As to why these are not garbage collected, we must be holding a reference
somewhere (probably in the Connection).

We will investigate. I have raised a bug (24723).

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 31 Jan 2012, at 17:49, Yogesh Ketkar wrote:

> I am using rabbitmq-java-client-bin-2.7.1/rabbitmq-client.jar with
> RabbitMQ 2.7.1 Server.
> 
> Just run this code
> 
> public static void main(String[] argv) throws IOException {
>    ConnectionFactory f = new ConnectionFactory();
>    Connection c = f.newConnection();
>    for(int i = 0; i < 20000; ++i) {
>        Channel ch = c.createChannel();
>        ch.close();
>    }
>    System.gc();
>    while(true) {}
> }
> 
> While program is running, observe the memory usage, it keeps on
> increasing
> Get process id and do following
> jmap -dump:format=b,file=yo.bin  <pid>
> jhat jhat -J-mx768m -stack false yo.bin
> Once jhat brings up http server, go here
> http://localhost:7000/showInstanceCounts/
> 
> 20001 instances of class com.rabbitmq.client.impl.AMQCommand
> 20001 instances of class com.rabbitmq.client.impl.CommandAssembler
> 20000 instances of class com.rabbitmq.client.ShutdownSignalException
> 20000 instances of class com.rabbitmq.client.impl.AMQImpl$Channel
> $Close
> 20000 instances of class com.rabbitmq.client.impl.ChannelN
> 20000 instances of class com.rabbitmq.client.impl.ConsumerDispatcher
> 
> In-spite of closing all the channels, not only channels but associated
> objects (ShutdownSignalException, ChannelClose) continue to consume
> memory.
> For sure, knowing this now, I will use channelCreate call sparingly.
> 
> Is there a way to remedy this situation?
> What is also worrying is instances of AMQCommand, so would this be the
> case for each and every call of client library?
> 
> regards, Yogesh
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexis at rabbitmq.com  Wed Feb  1 10:46:16 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 1 Feb 2012 10:46:16 +0000
Subject: [rabbitmq-discuss] [announce] New maintainer for the rabbitmq-c
	library
In-Reply-To: <CAAt2poL=pO8eCZ7Yze-+8avbjwCKMU7W_5eLBmm-e9rAqrCuqQ@mail.gmail.com>
References: <CAAt2poL=pO8eCZ7Yze-+8avbjwCKMU7W_5eLBmm-e9rAqrCuqQ@mail.gmail.com>
Message-ID: <CACOPnve6MJhEhGfRYYJq8vgo-i1dESCKSoqVr6DijQa1SzGRLw@mail.gmail.com>

Congratulations Alan and thank-you very much for taking this on!

alexis


On Tue, Jan 31, 2012 at 8:28 PM, Alan Antonuk <alan.antonuk at gmail.com> wrote:
> Hi;
>
> I am happy to announce that with the blessing of the RabbitMQ team, I have
> taken the lead on further development of the C RabbitMQ client library, also
> known as rabbitmq-c.
>
> The new home for the code is now on github:
> https://github.com/alanxz/rabbitmq-c
>
> My long term goal with the library is to have simple, stable, and scalable
> library that has feature-parity of that of the Java and .NET clients.
>
> Some near term goals I have for the library include:
> - Documenting the APIs presented by the library
> - Merging in channel-oriented memory
> management?https://github.com/alanxz/rabbitmq-c/pull/5
> - Providing some patterns for consuming messages to reduce the amount of
> boiler plate code users have to write.
>
>
> I want to encourage users of the library to get involved in the development
> of the library. Good ways to get involved include:
> ?- Forking the library on github and submitting a pull request
> ?- Submitting any bugs, or feature requests to the issue tracker on
> github?https://github.com/alanxz/rabbitmq-c/issues
> ?- Sparking up a discussion or simply asking questions on usage on the
> rabbitmq-discuss listserv
>
> -Alan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From yogimogi at gmail.com  Wed Feb  1 11:21:40 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Wed, 1 Feb 2012 03:21:40 -0800 (PST)
Subject: [rabbitmq-discuss] Problem with RabbitMQ Java Client (Memory
	leak)
In-Reply-To: <4C8B808C-80D4-40BB-9C99-98609675EB9C@rabbitmq.com>
References: <fd4945fc-14a3-4efb-9016-c78a9cae8043@vh10g2000pbc.googlegroups.com>
	<4C8B808C-80D4-40BB-9C99-98609675EB9C@rabbitmq.com>
Message-ID: <9da89044-0ea4-4086-b338-ade4d68aa1d9@n7g2000pbd.googlegroups.com>

Thanks Steve.
Can you give me some idea about date of next Java Client release (with
this bug-fix)?

regards, Yogesh

On Feb 1, 3:42?pm, Steve Powell <st... at rabbitmq.com> wrote:
> Yogesh,
>
> Thank you for this problem report. First point: each connection defines a
> (hidden) channel zero, so that explains why there are 20001 of some objects and
> 20000 of others.
>
> As to why these are not garbage collected, we must be holding a reference
> somewhere (probably in the Connection).
>
> We will investigate. I have raised a bug (24723).
>
> Steve Powell ?(a happy bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>
> On 31 Jan 2012, at 17:49, Yogesh Ketkar wrote:
>
>
>
>
>
>
>
>
>
> > I am using rabbitmq-java-client-bin-2.7.1/rabbitmq-client.jar with
> > RabbitMQ 2.7.1 Server.
>
> > Just run this code
>
> > public static void main(String[] argv) throws IOException {
> > ? ?ConnectionFactory f = new ConnectionFactory();
> > ? ?Connection c = f.newConnection();
> > ? ?for(int i = 0; i < 20000; ++i) {
> > ? ? ? ?Channel ch = c.createChannel();
> > ? ? ? ?ch.close();
> > ? ?}
> > ? ?System.gc();
> > ? ?while(true) {}
> > }
>
> > While program is running, observe the memory usage, it keeps on
> > increasing
> > Get process id and do following
> > jmap -dump:format=b,file=yo.bin ?<pid>
> > jhat jhat -J-mx768m -stack false yo.bin
> > Once jhat brings up http server, go here
> >http://localhost:7000/showInstanceCounts/
>
> > 20001 instances of class com.rabbitmq.client.impl.AMQCommand
> > 20001 instances of class com.rabbitmq.client.impl.CommandAssembler
> > 20000 instances of class com.rabbitmq.client.ShutdownSignalException
> > 20000 instances of class com.rabbitmq.client.impl.AMQImpl$Channel
> > $Close
> > 20000 instances of class com.rabbitmq.client.impl.ChannelN
> > 20000 instances of class com.rabbitmq.client.impl.ConsumerDispatcher
>
> > In-spite of closing all the channels, not only channels but associated
> > objects (ShutdownSignalException, ChannelClose) continue to consume
> > memory.
> > For sure, knowing this now, I will use channelCreate call sparingly.
>
> > Is there a way to remedy this situation?
> > What is also worrying is instances of AMQCommand, so would this be the
> > case for each and every call of client library?
>
> > regards, Yogesh
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From liuzhuofu at huawei.com  Wed Feb  1 12:00:42 2012
From: liuzhuofu at huawei.com (Liuzhuofu)
Date: Wed, 01 Feb 2012 12:00:42 +0000
Subject: [rabbitmq-discuss] How can I get the event that one connected mq
	client have exited ?
Message-ID: <D027DE656EBD4F4C8EE57361B5EF438E39914DE6@szxeml524-mbs.china.huawei.com>

Hi all:

In my system, many client will connect to the rabbit server, and they send msg to eachother.

My problem is: when one client coredown (lost the connection with rabbit server), I must catch this event quickly, and broad this event to all the other clients as soon as I can. What's is the best way to get the event (one client coredown)?

Do I need to develop a plugin and add it to rabbit server?

thanks
David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120201/bb5e419d/attachment.htm>

From simon at rabbitmq.com  Wed Feb  1 12:04:15 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 01 Feb 2012 12:04:15 +0000
Subject: [rabbitmq-discuss] How can I get the event that one connected
 mq	client have exited ?
In-Reply-To: <D027DE656EBD4F4C8EE57361B5EF438E39914DE6@szxeml524-mbs.china.huawei.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39914DE6@szxeml524-mbs.china.huawei.com>
Message-ID: <4F292A3F.8080502@rabbitmq.com>

Please see where I answered your question already:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017795.html

Cheers, Simon

On 01/02/12 12:00, Liuzhuofu wrote:
> Hi all:
> 
> In my system, many client will connect to the rabbit server, and they 
> send msg to eachother.
> 
> My problem is: when one client coredown (lost the connection with rabbit 
> server), I must catch this event quickly, and broad this event to all 
> the other clients as soon as I can. What's is the best way to get the 
> event (one client coredown)?
> 
> Do I need to develop a plugin and add it to rabbit server?
> 
> thanks
> David
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Feb  1 13:10:43 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 01 Feb 2012 13:10:43 +0000
Subject: [rabbitmq-discuss] plugins not loading.
In-Reply-To: <ea17b4bf-c409-4ab6-95a8-0d97324c375a@b10g2000pbd.googlegroups.com>
References: <cfc89fda-3fe1-465e-881a-a658b57c7899@lr19g2000pbb.googlegroups.com>
	<4F27C98B.70502@rabbitmq.com>
	<ea17b4bf-c409-4ab6-95a8-0d97324c375a@b10g2000pbd.googlegroups.com>
Message-ID: <4F2939D3.7090507@rabbitmq.com>

Hi,

On 31/01/12 21:18, dksayers wrote:
> Thanks for the hints. I checked /usr/local/etc/rc.d/rabbitmq for
> anything unusual but nothing
> was to be found. I did add the line:
> ENABLED_PLUGINS_FILE="/etc/rabbitmq/enabled_plugins"
> but this also failed with the same '0 plugins activated:'

The maintainer for this package has submitted a fix which should arrive
in the ports tree shortly. In the meantime you can edit
/usr/local/sbin/rabbitmq-plugins and define
ENABLED_PLUGINS_FILE=/usr/local/etc/rabbitmq/enabled_plugins


-Emile

From ask at rabbitmq.com  Wed Feb  1 14:23:37 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Wed, 1 Feb 2012 14:23:37 +0000
Subject: [rabbitmq-discuss] RabbitMQ log files rotation daily
In-Reply-To: <CAH+_+m7cBWux=DenOPXxgr_ndZjxgBOrfz9WN--EPFB0-A8iBA@mail.gmail.com>
References: <CAH+_+m7cBWux=DenOPXxgr_ndZjxgBOrfz9WN--EPFB0-A8iBA@mail.gmail.com>
Message-ID: <230E30B9-CCD4-4EE2-B413-59E1ECB51113@rabbitmq.com>


On 1 Feb 2012, at 03:44, Roshan Pradeep wrote:

> Hi All
> 
> I want to rotate the RabbitMQ log files in daily basis like support in log4j. The only log rotate support I found is rabbitmqctl rotate_logs <suffix>. 

From http://manpages.ubuntu.com/manpages/jaunty/man1/rabbitmqctl.1.html:

  rotate_logs [suffix]
      instruct the RabbitMQ node to rotate the log files. The RabbitMQ
      broker will attempt to append the current contents of the log file
      to the file with the name composed of the original name and the
      suffix. It will create a new file if such a file does not already
      exist. When no  suffix is specified, the empty log file is
      simply created at the original location; no rotation takes place.
      When an error occurs while appending the contents of the old log
      file, the operation behaves in the same way as if no suffix was
      specified. This command might be helpful when you are e.g. writing
      your own logrotate script and you do not want to restart the
      RabbitMQ node.

> 
> Could some one please explain how to achieve the daily log file rotation. Also I am not sure what kind of suffix expect from rabbitmqctl rotate_logs.
> 

Have you tried adding rotate_logs to the daily cron script?

From steve at rabbitmq.com  Wed Feb  1 17:37:47 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 1 Feb 2012 17:37:47 +0000
Subject: [rabbitmq-discuss] Problem with RabbitMQ Java Client (Memory
	leak)
In-Reply-To: <9da89044-0ea4-4086-b338-ade4d68aa1d9@n7g2000pbd.googlegroups.com>
References: <fd4945fc-14a3-4efb-9016-c78a9cae8043@vh10g2000pbc.googlegroups.com>
	<4C8B808C-80D4-40BB-9C99-98609675EB9C@rabbitmq.com>
	<9da89044-0ea4-4086-b338-ade4d68aa1d9@n7g2000pbd.googlegroups.com>
Message-ID: <44BE06C1-A16E-4A9C-9F66-BEBEF00CB099@rabbitmq.com>

The fix (which we have coded) will be in the next release,
but I don't know precisely when that will be.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 1 Feb 2012, at 11:21, Yogesh Ketkar wrote:

> Thanks Steve.
> Can you give me some idea about date of next Java Client release (with
> this bug-fix)?
> 
> regards, Yogesh
> 
> On Feb 1, 3:42 pm, Steve Powell <st... at rabbitmq.com> wrote:
>> Yogesh,
>> 
>> Thank you for this problem report. First point: each connection defines a
>> (hidden) channel zero, so that explains why there are 20001 of some objects and
>> 20000 of others.
>> 
>> As to why these are not garbage collected, we must be holding a reference
>> somewhere (probably in the Connection).
>> 
>> We will investigate. I have raised a bug (24723).
>> 
>> Steve Powell  (a happy bunny)
>> ----------some more definitions from the SPD----------
>> vermin (v.) Treating the dachshund for roundworm.
>> chinchilla (n.) Cooling device for the lower jaw.
>> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>> 
>> On 31 Jan 2012, at 17:49, Yogesh Ketkar wrote:
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>>> I am using rabbitmq-java-client-bin-2.7.1/rabbitmq-client.jar with
>>> RabbitMQ 2.7.1 Server.
>> 
>>> Just run this code
>> 
>>> public static void main(String[] argv) throws IOException {
>>>    ConnectionFactory f = new ConnectionFactory();
>>>    Connection c = f.newConnection();
>>>    for(int i = 0; i < 20000; ++i) {
>>>        Channel ch = c.createChannel();
>>>        ch.close();
>>>    }
>>>    System.gc();
>>>    while(true) {}
>>> }
>> 
>>> While program is running, observe the memory usage, it keeps on
>>> increasing
>>> Get process id and do following
>>> jmap -dump:format=b,file=yo.bin  <pid>
>>> jhat jhat -J-mx768m -stack false yo.bin
>>> Once jhat brings up http server, go here
>>> http://localhost:7000/showInstanceCounts/
>> 
>>> 20001 instances of class com.rabbitmq.client.impl.AMQCommand
>>> 20001 instances of class com.rabbitmq.client.impl.CommandAssembler
>>> 20000 instances of class com.rabbitmq.client.ShutdownSignalException
>>> 20000 instances of class com.rabbitmq.client.impl.AMQImpl$Channel
>>> $Close
>>> 20000 instances of class com.rabbitmq.client.impl.ChannelN
>>> 20000 instances of class com.rabbitmq.client.impl.ConsumerDispatcher
>> 
>>> In-spite of closing all the channels, not only channels but associated
>>> objects (ShutdownSignalException, ChannelClose) continue to consume
>>> memory.
>>> For sure, knowing this now, I will use channelCreate call sparingly.
>> 
>>> Is there a way to remedy this situation?
>>> What is also worrying is instances of AMQCommand, so would this be the
>>> case for each and every call of client library?
>> 
>>> regards, Yogesh
>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From salim.khn86 at gmail.com  Wed Feb  1 19:13:43 2012
From: salim.khn86 at gmail.com (salim khan)
Date: Wed, 1 Feb 2012 14:13:43 -0500
Subject: [rabbitmq-discuss] RabbitMQ server start problem
Message-ID: <CADVRX3-C7L9k-p=MG7zfp3FmZFbFRW_pcGWMc73CQ=Ciy-v_LA@mail.gmail.com>

Hi,

I just insallted rabbitmq  on *window 7 64 bit platform*, but when I try to
start server from rabbit console by using *rabbitmq-server start* command
then it gives me error that *MSVCR100.dll* is missing.

I'll really appreciate your help to resolve this problem


Thanks!!
Salim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120201/e9a4ba3f/attachment.htm>

From jerryk at vmware.com  Wed Feb  1 19:18:18 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 1 Feb 2012 11:18:18 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ server start problem
In-Reply-To: <CADVRX3-C7L9k-p=MG7zfp3FmZFbFRW_pcGWMc73CQ=Ciy-v_LA@mail.gmail.com>
References: <CADVRX3-C7L9k-p=MG7zfp3FmZFbFRW_pcGWMc73CQ=Ciy-v_LA@mail.gmail.com>
Message-ID: <BE28A251-D7B1-4606-93C1-4BBE7728AF62@vmware.com>

You're missing one of the MS Visual C rumtime's shared libraries. I don't think Rabbit or Erlang redistribute it, although I may be wrong...

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On Feb 1, 2012, at 11:15 AM, salim khan <salim.khn86 at gmail.com> wrote:

> Hi,
>  
> I just insallted rabbitmq  on window 7 64 bit platform, but when I try to start server from rabbit console by using rabbitmq-server start command then it gives me error that MSVCR100.dll is missing.
>  
> I'll really appreciate your help to resolve this problem
>  
>  
> Thanks!!
> Salim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simone.busoli at gmail.com  Wed Feb  1 19:19:34 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 1 Feb 2012 20:19:34 +0100
Subject: [rabbitmq-discuss] RabbitMQ server start problem
In-Reply-To: <CADVRX3-C7L9k-p=MG7zfp3FmZFbFRW_pcGWMc73CQ=Ciy-v_LA@mail.gmail.com>
References: <CADVRX3-C7L9k-p=MG7zfp3FmZFbFRW_pcGWMc73CQ=Ciy-v_LA@mail.gmail.com>
Message-ID: <CAOn7oW_xsfhLdz86A2efGZs+Yaapy-m1Eo9rs=Dzk8qmuX=vPg@mail.gmail.com>

Have you installed Erlang? Did you check the Microsoft dependencies option
during installation?
On Feb 1, 2012 8:15 PM, "salim khan" <salim.khn86 at gmail.com> wrote:

> Hi,
>
> I just insallted rabbitmq  on *window 7 64 bit platform*, but when I try
> to start server from rabbit console by using *rabbitmq-server start*command then it gives me error that
> *MSVCR100.dll* is missing.
>
> I'll really appreciate your help to resolve this problem
>
>
> Thanks!!
> Salim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120201/b12667de/attachment.htm>

From pbell at syncsort.com  Wed Feb  1 19:57:55 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Wed, 1 Feb 2012 14:57:55 -0500
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <4F27C521.3030703@rabbitmq.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>
	<20120128171156.GD3692@southbank.Home>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>
	<20120129202348.GI3692@southbank.Home>
	<5F389C517756284F80239F55BCA5DDDD36923A6D@G9W0721.americas.hpqcorp.net>
	<20120130101227.GK3692@southbank.Home>
	<D4925C82-5E7D-451E-834C-D51F57A5958C@syncsort.com><20120130233656.GB3968@southbank.Home>
	<4F27C521.3030703@rabbitmq.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044789C@MAILCCR.us.syncsort.com>

Thanks again, Simon.

Some idle replies, and one more question, in-line...

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: Tuesday, January 31, 2012 5:41 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Securing RabbitMQ

On 30/01/12 23:36, Alexandru Scvortov wrote:
> (posting again to the m/l)
>
>> Quick q: does RabbitMQ allow presenting a hashed password?
>
> No.  The authentication system is pluggable, though, so you could
> easily write your own mechanism (see the src/rabbit_auth_mechanism_
> files in the broker source tree for examples).

>More specifically I didn't think it worth doing this since it would tie
>authentication to the current password hashing scheme, and if you want
>to avoid sending passwords in plaintext you probably want to avoid
>sending anything in plaintext - so you should use SSL.

Agreed. But I am pretty sure that this is what NetApp implemented. So they're stuck with MD5.

>Actually, you don't want to just "present a hashed password" since that
>implies you are storing the hashed password at the client, which implies
>that it's not really hashed any more...

I suppose you mean that the client must be able to present it as clear text to the filer's MD5 algorithm.

My question: is it possible to adjust the "concurrency" of a consumer in real time? That is, when I create a consumer with

     Consumer consumer = new Consumer("q1", "q1", 3);

I get a single consumer that runs 3 threads. Can I adjust this "3" dynamically?

Thanks again.

-Paul



>At one point I tried to invent a challenge response protocol that would
>work with salted hashes, but then I came to my senses and realised I
>should leave crypto protocol design to people who know what they're doing.

>Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From taylste at gmail.com  Wed Feb  1 20:02:20 2012
From: taylste at gmail.com (Steven Taylor)
Date: Wed, 1 Feb 2012 20:02:20 +0000
Subject: [rabbitmq-discuss] alternate-exchanges
Message-ID: <CA+zYriRpOPdW0QXD4QXWe4tNdNiJh1gRSAsUu0gmpsxco4NtzQ@mail.gmail.com>

http://www.rabbitmq.com/extensions.html#alternate-exchange

Must the alternate-exchange contain the same queue details?  Is it possible
to have a catch-all queue (might be useful during development).

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120201/4bd449b0/attachment.htm>

From jerryk at vmware.com  Wed Feb  1 20:39:15 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 1 Feb 2012 12:39:15 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ server start problem
In-Reply-To: <CADVRX39JR78kWyXdOfQLt5hbpg+jLUahcgdC4B+aktg+X-QrwA@mail.gmail.com>
Message-ID: <d7f6385f-2479-4c77-a7d2-4e0db78b53b0@CoachZ.local>

Hi, Salim:

If the error message is printing a DLL file name that doesn't precisely
match what you find on your machine, it's definitely looking for something else.
As we (Rabbit) don't install MS redistributables, you might try doing a 
reinstall of your Erlang and checking the "install MS goodies" (or similarly
named) option that Simon mentioned.  I'd forgotten that existed in 
Ericsson's installer when I originally answered...

Best regards,
Jerry

----- Original Message -----
From: "salim khan" <salim.khn86 at gmail.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Sent: Wednesday, February 1, 2012 11:26:46 AM
Subject: Re: [rabbitmq-discuss] RabbitMQ server start problem


Hi jerry, 

I have msvcr100_clr0400.dll under System32 folder is that one which is required. 


On Wed, Feb 1, 2012 at 2:18 PM, Jerry Kuch < jerryk at vmware.com > wrote: 


You're missing one of the MS Visual C rumtime's shared libraries. I don't think Rabbit or Erlang redistribute it, although I may be wrong... 

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy). 




On Feb 1, 2012, at 11:15 AM, salim khan < salim.khn86 at gmail.com > wrote: 

> Hi, 
> 
> I just insallted rabbitmq on window 7 64 bit platform, but when I try to start server from rabbit console by using rabbitmq-server start command then it gives me error that MSVCR100.dll is missing. 
> 
> I'll really appreciate your help to resolve this problem 
> 
> 
> Thanks!! 
> Salim 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> rabbitmq-discuss at lists.rabbitmq.com 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 


From dksayers at gmail.com  Wed Feb  1 21:12:11 2012
From: dksayers at gmail.com (dksayers)
Date: Wed, 1 Feb 2012 13:12:11 -0800 (PST)
Subject: [rabbitmq-discuss] plugins not loading.
In-Reply-To: <4F2939D3.7090507@rabbitmq.com>
References: <cfc89fda-3fe1-465e-881a-a658b57c7899@lr19g2000pbb.googlegroups.com>
	<4F27C98B.70502@rabbitmq.com>
	<ea17b4bf-c409-4ab6-95a8-0d97324c375a@b10g2000pbd.googlegroups.com>
	<4F2939D3.7090507@rabbitmq.com>
Message-ID: <142b9d65-f786-49c8-945f-b874df49b40e@iu7g2000pbc.googlegroups.com>

Sounds of wondrous applause. This did the trick.  Thanks very much to
all that contributed.

On Feb 2, 12:10?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> On 31/01/12 21:18, dksayers wrote:
>
> > Thanks for the hints. I checked /usr/local/etc/rc.d/rabbitmq for
> > anything unusual but nothing
> > was to be found. I did add the line:
> > ENABLED_PLUGINS_FILE="/etc/rabbitmq/enabled_plugins"
> > but this also failed with the same '0pluginsactivated:'
>
> The maintainer for this package has submitted a fix which should arrive
> in the ports tree shortly. In the meantime you can edit
> /usr/local/sbin/rabbitmq-pluginsand define
> ENABLED_PLUGINS_FILE=/usr/local/etc/rabbitmq/enabled_plugins
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From toby.corkindale at strategicdata.com.au  Thu Feb  2 01:20:59 2012
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Thu, 02 Feb 2012 12:20:59 +1100
Subject: [rabbitmq-discuss] State-of-the-art Perl client?
In-Reply-To: <r422Ps-1068i-9A551F2ACC2343F5A5A6A6707A3C0181@thelonious.lan>
References: <r422Ps-1068i-9A551F2ACC2343F5A5A6A6707A3C0181@thelonious.lan>
Message-ID: <4F29E4FB.3090906@strategicdata.com.au>

On 31/01/12 21:25, Alessandro Ranellucci wrote:
> On 25-01-2012 at 6:30, Toby Corkindale wrote:
>
>  >>I've done some searching and haven't found a consensus answer: What's
>  >>the state-of-the-art Perl client for RabbitMQ?
>  >
>  >The only decent one I've found is Net::STOMP::Client.
>  >The author is active on this list and responds to bug reports.
>  >I filed bugs against the others on CPAN ages ago and have been ignored
>  >by their authors.
>
> I published this module one year ago and I'm still using it:
>
> https://metacpan.org/module/Net::RabbitMQ::Java
>
> It exposes the *full* RabbitMQ API as available through the official
> Java client. While some may dislike to run a Java library in a Perl
> environment, it has proven to be fairly reliable without a single issue.

I'm sure you can understand that it's not really desirable for many 
people to do this, though, due to:
  * Massively higher memory usage.
  * Longer start-up times.
  * Sysadmins' unfamiliarity with JVM deployment, tuning, failure modes, 
etc.
  * JVM incompatibility with OpenVZ containers.
  * The general nervousness you get when playing around with somewhat 
esoteric magic inter-language bindings like Inline::Java.


To be fair, you can tune the JVM memory use with some environment 
variables - but by default with Net::RabbitMQ::Java, the jvm portion 
grabs 1906M (virtual), which you have to admit is rather excessive. (You 
can enable memory over-commit on your Linux system, but by default it's 
still only going to let you run a couple of those jvms up before it 
starts complaining)


I admit, it's a interesting endeavour that you have here. I didn't 
realise you were actually using it seriously in the field though.

By the way - why do you require the user to call ->init manually? Why 
not put that into the import() subroutine which is called automatically?

Cheers,
Toby

From rev.chip at gmail.com  Thu Feb  2 02:46:29 2012
From: rev.chip at gmail.com (Reverend Chip)
Date: Wed, 01 Feb 2012 18:46:29 -0800
Subject: [rabbitmq-discuss] State-of-the-art Perl client?
In-Reply-To: <4F1F5119.9020407@cloudmark.com>
References: <4F1F5119.9020407@cloudmark.com>
Message-ID: <4F29F905.4080508@gmail.com>

On 1/24/2012 4:47 PM, Mike Acar wrote:
> I've done some searching and haven't found a consensus answer: What's
> the state-of-the-art Perl client for RabbitMQ?

Hi, Mike!  I'm using AnyEvent::RabbitMQ and Net::RabbitFoot.  They're
built on Net::AMQP, which I submitted a patch for recently and it was
accepted (sending arrays so I can configure replication).  It's is stuck
at AMQP 0.8, but so far that hasn't stopped me.


From codevally at gmail.com  Thu Feb  2 04:41:20 2012
From: codevally at gmail.com (Codevally)
Date: Wed, 1 Feb 2012 20:41:20 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ log files rotation daily
In-Reply-To: <230E30B9-CCD4-4EE2-B413-59E1ECB51113@rabbitmq.com>
References: <CAH+_+m7cBWux=DenOPXxgr_ndZjxgBOrfz9WN--EPFB0-A8iBA@mail.gmail.com>
	<230E30B9-CCD4-4EE2-B413-59E1ECB51113@rabbitmq.com>
Message-ID: <5aa990c9-1bd3-4f0c-bde4-e66d70ee8863@iu7g2000pbc.googlegroups.com>

Thanks for the comments. I achieved this task using linux logrotate.

On Feb 2, 1:23?am, Ask Solem <a... at rabbitmq.com> wrote:
> On 1 Feb 2012, at 03:44, Roshan Pradeep wrote:
>
> > Hi All
>
> > I want to rotate the RabbitMQ log files in daily basis like support in log4j. The only log rotate support I found is rabbitmqctl rotate_logs <suffix>.
>
> Fromhttp://manpages.ubuntu.com/manpages/jaunty/man1/rabbitmqctl.1.html:
>
> ? rotate_logs [suffix]
> ? ? ? instruct the RabbitMQ node to rotate the log files. The RabbitMQ
> ? ? ? broker will attempt to append the current contents of the log file
> ? ? ? to the file with the name composed of the original name and the
> ? ? ? suffix. It will create a new file if such a file does not already
> ? ? ? exist. When no ?suffix is specified, the empty log file is
> ? ? ? simply created at the original location; no rotation takes place.
> ? ? ? When an error occurs while appending the contents of the old log
> ? ? ? file, the operation behaves in the same way as if no suffix was
> ? ? ? specified. This command might be helpful when you are e.g. writing
> ? ? ? your own logrotate script and you do not want to restart the
> ? ? ? RabbitMQ node.
>
>
>
> > Could some one please explain how to achieve the daily log file rotation. Also I am not sure what kind of suffix expect from rabbitmqctl rotate_logs.
>
> Have you tried adding rotate_logs to the daily cron script?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From syst3m.w0rm at gmail.com  Thu Feb  2 04:53:56 2012
From: syst3m.w0rm at gmail.com (Aamir Khan)
Date: Thu, 2 Feb 2012 10:23:56 +0530
Subject: [rabbitmq-discuss] help required: bind function
In-Reply-To: <1328048627.2699.YahooMailNeo@web29706.mail.ird.yahoo.com>
References: <1328047585.29815.YahooMailNeo@web29701.mail.ird.yahoo.com>
	<a21cf204-83cd-482a-87f0-c142eea7186a@strongmad.batnest.org>
	<1328048627.2699.YahooMailNeo@web29706.mail.ird.yahoo.com>
Message-ID: <CAOb12VViOCTraiTmtWAmuXuO53hDGOqZiPmsU3sirXveC7ryyw@mail.gmail.com>

Hi Saima,

I guess to understand the working of AMQP, you are trying to write client
for it in C++ language. Is that your intention ? Writing client will be
much tedious task compared to using a existing clients.

You can checkout : http://www.rabbitmq.com/getstarted.html for writing
simple applications using existing clients for rabbitMQ, if you plan to do
so.

You may also find https://github.com/rabbitmq/rabbitmq-c useful . And, I
guess there is no C++ client library for rabbitMQ at the moment. Correct me
if i am wrong.

On Wed, Feb 1, 2012 at 3:53 AM, Saima Asif <abdullahsaima at yahoo.com> wrote:

> Hi Jerry,
>
> I am student , and my supervisor and I have chosen to implement and study
> it at very simpler level. my classes are not refined. There is one class
> "message" which has a routing key.
> I need your help how can I write Bind() function for this. How can
> exchanges and queues are already have relation, before sending messages by
> publisher. My program wants to send messgae to exchange and then exchanges
> routes to queues, But how can I do this in C++. means I am not
> understanding logic. you all are experts and having a good conversation
> while I am at very initial level of understanding. if you can help me in
> writing my code.
>
> Thanks
>
> Saima
>   ------------------------------
> *From:* Jerry Kuch <jerryk at vmware.com>
> *To:* Saima Asif <abdullahsaima at yahoo.com>
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *Sent:* Tuesday, 31 January 2012, 22:12
> *Subject:* Re: [rabbitmq-discuss] help required: bind function
>
> Hi, Saima.
>
> To address some of your questions.
>
> A producer publishes *to* an exchange.  It's a decision a producer makes
> when publishing, much as you might decide which mailbox you plant to drop
> you post card in while you're on vacation.
>
> A queue is *bound* to an exchange.  Depending on the type of the exchange,
> certain rules, and the properties of the message, determine whether or not
> a given message follows that binding into a particular destination queue.
> Think of the action is being like that of the postal worker, who pulls your
> postcard from the mailbox, looks at it, and determines where to take it.
> How a routing key is interpreted depends on the exchange type in this
> context.
>
> I'm not sure what you mean by having implemented classes for exchanges,
> and queues.
> Are you writing an AMQP client that you intend to use with someone else's
> broker?
> Or are you wrapping these entities up in some way that is convenient for
> the needs
> of your C++ application?  Or are you implementing an actual AMQP broker,
> perhaps
> for teaching purposes?
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "Saima Asif" <abdullahsaima at yahoo.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Tuesday, January 31, 2012 2:06:25 PM
> Subject: [rabbitmq-discuss] help required: bind function
>
>
>
>
> Hi All,
>
>
> I am going to understand AMQP version 0-9 at simpler level, The binding
> function definition is problem for me. First issue isHow I can randomly
> define the messages, if I did that How a message knows to go to which
> exchange, so that exchange can move to particular queue. I have defined
> queue and exchange as a class. I have defined routing key as well. I have
> implemented the queues that store such messages. But I need your help in
> defining bind() and How to route message to exchanges.
>
> I am using visual C++, can send the code if required but its not in its
> refined form.
> Thanks
> Any help would be highly appreciated. Sorry if I am not following your
> format of writing emails. I am new to this.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Aamir Khan | 3rd Year  | Computer Science & Engineering | IIT Roorkee
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120202/6c0316d3/attachment.htm>

From liuzhuofu at huawei.com  Thu Feb  2 06:40:08 2012
From: liuzhuofu at huawei.com (Liuzhuofu)
Date: Thu, 02 Feb 2012 06:40:08 +0000
Subject: [rabbitmq-discuss] =?gb2312?b?ILTwuLQ6ICBIb3cgY2FuIEkgZ2V0IHRo?=
 =?gb2312?b?ZSBldmVudCB0aGF0IG9uZSBjb25uZWN0ZWQgbXEJY2xpZW50IGhhdmUgZXhp?=
 =?gb2312?b?dGVkID8=?=
In-Reply-To: <4F292A3F.8080502@rabbitmq.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39914DE6@szxeml524-mbs.china.huawei.com>
	<4F292A3F.8080502@rabbitmq.com>
Message-ID: <D027DE656EBD4F4C8EE57361B5EF438E39915649@szxeml524-mbs.china.huawei.com>

Hi, Simon:
    Thank you very much, the "presence-exchange" plugin seams can do the job for me, and I will try to use it later.
    And I suggest that the plugins like this can be list at the www.RabbitMQ.com, so the use will easy to  find the plugin they want. Otherwise, the user can only ask to the emallist, and I think it is not a quickly way.

Regards

David
________________________________________
???: Simon MacMullen [simon at rabbitmq.com]
????: 2012?2?1? 20:04
?: rabbitmq-discuss at lists.rabbitmq.com
Cc: Liuzhuofu
??: Re: [rabbitmq-discuss] How can I get the event that one connected mq        client have exited ?

Please see where I answered your question already:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017795.html

Cheers, Simon

On 01/02/12 12:00, Liuzhuofu wrote:
> Hi all:
>
> In my system, many client will connect to the rabbit server, and they
> send msg to eachother.
>
> My problem is: when one client coredown (lost the connection with rabbit
> server), I must catch this event quickly, and broad this event to all
> the other clients as soon as I can. What's is the best way to get the
> event (one client coredown)?
>
> Do I need to develop a plugin and add it to rabbit server?
>
> thanks
> David
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


--
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Feb  2 09:51:20 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 02 Feb 2012 09:51:20 +0000
Subject: [rabbitmq-discuss] help required: bind function
In-Reply-To: <1328048627.2699.YahooMailNeo@web29706.mail.ird.yahoo.com>
References: <1328047585.29815.YahooMailNeo@web29701.mail.ird.yahoo.com>
	<a21cf204-83cd-482a-87f0-c142eea7186a@strongmad.batnest.org>
	<1328048627.2699.YahooMailNeo@web29706.mail.ird.yahoo.com>
Message-ID: <4F2A5C98.70809@rabbitmq.com>

Hi Saima,

On 31/01/12 22:23, Saima Asif wrote:
> I am student , and my supervisor and I have chosen to implement and
> study it at very simpler level. my classes are not refined. There is one
> class "message" which has a routing key.
> I need your help how can I write Bind() function for this.

Keep in mind that binding is an operation on a queue, not a message. See
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.queue for queue
operations.

Have you taken a look at the tutorials at
http://www.rabbitmq.com/getstarted.html ?
They introduce AMQP concepts (including binding) in a way that should be
of help. Unfortunately no C or C++ translation exists, but if you feel
brave you could contribute this.

-Emile

From emile at rabbitmq.com  Thu Feb  2 09:58:58 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 02 Feb 2012 09:58:58 +0000
Subject: [rabbitmq-discuss] alternate-exchanges
In-Reply-To: <CA+zYriRpOPdW0QXD4QXWe4tNdNiJh1gRSAsUu0gmpsxco4NtzQ@mail.gmail.com>
References: <CA+zYriRpOPdW0QXD4QXWe4tNdNiJh1gRSAsUu0gmpsxco4NtzQ@mail.gmail.com>
Message-ID: <4F2A5E62.30904@rabbitmq.com>

Hi Steven,

On 01/02/12 20:02, Steven Taylor wrote:
> http://www.rabbitmq.com/extensions.html#alternate-exchange
>  
> Must the alternate-exchange contain the same queue details?  Is it
> possible to have a catch-all queue (might be useful during development).

The alternative-exchange argument is used to specify an exchange, not a
queue. It is permitted for many exchanges to share the same alternative
exchange (thus acting as a catch-all).


-Emile

From jon.hill at comshen.com  Thu Feb  2 10:58:57 2012
From: jon.hill at comshen.com (Jon Hill)
Date: Thu, 2 Feb 2012 02:58:57 -0800 (PST)
Subject: [rabbitmq-discuss] Flash Client and RabbitMQ
Message-ID: <0209044a-002d-43c2-b7d3-a51836fa6419@z31g2000vbt.googlegroups.com>

Hi

I am involved in the development of an online game using Flash as the
client. We are considering communicating directly with a RabbitMQ
broker from Flash but are wondering if this is the best approach.
Should we be considering using WebSockets (and therefore tunneling
through http with a gateway such as Kaazing in place) because of the
potential of raw AMQP traffic getting blocked by firewalls?

Regards

Jon

From abdullahsaima at yahoo.com  Thu Feb  2 12:09:52 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Thu, 2 Feb 2012 12:09:52 +0000 (GMT)
Subject: [rabbitmq-discuss] help required: bind function
In-Reply-To: <4F2A5C98.70809@rabbitmq.com>
References: <1328047585.29815.YahooMailNeo@web29701.mail.ird.yahoo.com>
	<a21cf204-83cd-482a-87f0-c142eea7186a@strongmad.batnest.org>
	<1328048627.2699.YahooMailNeo@web29706.mail.ird.yahoo.com>
	<4F2A5C98.70809@rabbitmq.com>
Message-ID: <1328184592.31745.YahooMailNeo@web29702.mail.ird.yahoo.com>

Thank you very much Emile and Aamir for your kind replies.
?
Infact I know the basic concept of binding, if a queue is bounded to exchange then that queue wants to receive the message from that particular exchange. But I am so sorry I dont know how to interpret this relationship into programming langauge i.e. C++. How can I specify the queue that now this queue will recieve messages from this exchange. I have consulted all the material, But the problem is writing and interpreting. I am so sorry I think it would be a big ask. 
?
Any help would be highly appreiated.

Saima 

________________________________
From: Emile Joubert <emile at rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com; abdullahsaima at yahoo.com 
Sent: Thursday, 2 February 2012, 9:51
Subject: Re: [rabbitmq-discuss] help required: bind function

Hi Saima,

On 31/01/12 22:23, Saima Asif wrote:
> I am student , and my supervisor and I have chosen to implement and
> study it at very simpler level. my classes are not refined. There is one
> class "message" which has a routing key.
> I need your help how can I write Bind() function for this.

Keep in mind that binding is an operation on a queue, not a message. See
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.queue for queue
operations.

Have you taken a look at the tutorials at
http://www.rabbitmq.com/getstarted.html ?
They introduce AMQP concepts (including binding) in a way that should be
of help. Unfortunately no C or C++ translation exists, but if you feel
brave you could contribute this.

-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120202/56069b98/attachment.htm>

From majek04 at gmail.com  Thu Feb  2 12:13:13 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 2 Feb 2012 12:13:13 +0000
Subject: [rabbitmq-discuss] Flash Client and RabbitMQ
In-Reply-To: <0209044a-002d-43c2-b7d3-a51836fa6419@z31g2000vbt.googlegroups.com>
References: <0209044a-002d-43c2-b7d3-a51836fa6419@z31g2000vbt.googlegroups.com>
Message-ID: <CABzX+qxMXXbEFhpvyXO7_=Bw5MvcXH6+j2s0SEWKQCAAi-9s+g@mail.gmail.com>

On Thu, Feb 2, 2012 at 10:58, Jon Hill <jon.hill at comshen.com> wrote:
> I am involved in the development of an online game using Flash as the
> client. We are considering communicating directly with a RabbitMQ
> broker from Flash but are wondering if this is the best approach.
> Should we be considering using WebSockets (and therefore tunneling
> through http with a gateway such as Kaazing in place) because of the
> potential of raw AMQP traffic getting blocked by firewalls?

Hi,

Using Kaazing is definitely one option.

The alternative is to build a simple server that would forward
WebSockets to AMQP. Things like in Node.js or Python/Tornado
should do.

If you want to use the stream from javascript in browser,
you can take a look at SockJS: http://sockjs.org , which
not only serves native WebSockets but also uses convenient
fallbacks if browser doesn't support websockets or if browser
is behind a corporate proxy.

At the moment we're experimenting with the RabbitMQ to
SockJS bridge as a RabbitMQ plugin. But it's hard to
predict when this will be done.

Cheers,
  Marek

From majek04 at gmail.com  Thu Feb  2 12:16:39 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 2 Feb 2012 12:16:39 +0000
Subject: [rabbitmq-discuss] Flash Client and RabbitMQ
In-Reply-To: <CABzX+qxMXXbEFhpvyXO7_=Bw5MvcXH6+j2s0SEWKQCAAi-9s+g@mail.gmail.com>
References: <0209044a-002d-43c2-b7d3-a51836fa6419@z31g2000vbt.googlegroups.com>
	<CABzX+qxMXXbEFhpvyXO7_=Bw5MvcXH6+j2s0SEWKQCAAi-9s+g@mail.gmail.com>
Message-ID: <CABzX+qzwuCfdoLw--CdhXESBGUuSWXtOOj6S36scbr3_nCSO6w@mail.gmail.com>

For completeness, there is an AS3 AMQP client:
   https://github.com/0x6e6562/as3-amqp

On Thu, Feb 2, 2012 at 12:13, Marek Majkowski <majek04 at gmail.com> wrote:
> On Thu, Feb 2, 2012 at 10:58, Jon Hill <jon.hill at comshen.com> wrote:
>> I am involved in the development of an online game using Flash as the
>> client. We are considering communicating directly with a RabbitMQ
>> broker from Flash but are wondering if this is the best approach.
>> Should we be considering using WebSockets (and therefore tunneling
>> through http with a gateway such as Kaazing in place) because of the
>> potential of raw AMQP traffic getting blocked by firewalls?
>
> Hi,
>
> Using Kaazing is definitely one option.
>
> The alternative is to build a simple server that would forward
> WebSockets to AMQP. Things like in Node.js or Python/Tornado
> should do.
>
> If you want to use the stream from javascript in browser,
> you can take a look at SockJS: http://sockjs.org , which
> not only serves native WebSockets but also uses convenient
> fallbacks if browser doesn't support websockets or if browser
> is behind a corporate proxy.
>
> At the moment we're experimenting with the RabbitMQ to
> SockJS bridge as a RabbitMQ plugin. But it's hard to
> predict when this will be done.
>
> Cheers,
> ?Marek

From mikeb at rabbitmq.com  Thu Feb  2 13:26:53 2012
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 02 Feb 2012 13:26:53 +0000
Subject: [rabbitmq-discuss] Flash Client and RabbitMQ
In-Reply-To: <CABzX+qxMXXbEFhpvyXO7_=Bw5MvcXH6+j2s0SEWKQCAAi-9s+g@mail.gmail.com>
References: <0209044a-002d-43c2-b7d3-a51836fa6419@z31g2000vbt.googlegroups.com>
	<CABzX+qxMXXbEFhpvyXO7_=Bw5MvcXH6+j2s0SEWKQCAAi-9s+g@mail.gmail.com>
Message-ID: <4F2A8F1D.6020502@rabbitmq.com>

On 02/02/2012 12:13 PM, Marek Majkowski wrote:
> On Thu, Feb 2, 2012 at 10:58, Jon Hill<jon.hill at comshen.com>  wrote:
>> I am involved in the development of an online game using Flash as the
>> client. We are considering communicating directly with a RabbitMQ
>> broker from Flash but are wondering if this is the best approach.
>> Should we be considering using WebSockets (and therefore tunneling
>> through http with a gateway such as Kaazing in place) because of the
>> potential of raw AMQP traffic getting blocked by firewalls?

I am interested to know if you really need to extend AMQP to the clients 
-- could something simpler work? AMQP is quite complicated and gives 
over a lot of control to clients. If you just need to send and receive 
messages at clients it's a lot of trouble to go to.

> Using Kaazing is definitely one option.
>
> The alternative is to build a simple server that would forward
> WebSockets to AMQP. Things like in Node.js or Python/Tornado
> should do.
>
> If you want to use the stream from javascript in browser,
> you can take a look at SockJS: http://sockjs.org , which
> not only serves native WebSockets but also uses convenient
> fallbacks if browser doesn't support websockets or if browser
> is behind a corporate proxy.
>
> At the moment we're experimenting with the RabbitMQ to
> SockJS bridge as a RabbitMQ plugin. But it's hard to
> predict when this will be done.

It's pretty easy to write an adapter of your own, if you are prepared to 
run it somewhere. Just pick an AMQP client and a websocket library -- 
SockJS is a fine choice even if you don't need the fallback transports 
right now.

Or (here comes the plug) use rabbit.js, which makes it dead simple, at 
the cost of papering over AMQP "features": 
https://github.com/squaremo/rabbit.js


-Michael

From mvbaffa at gmail.com  Thu Feb  2 13:31:07 2012
From: mvbaffa at gmail.com (mvbaffa)
Date: Thu, 2 Feb 2012 05:31:07 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMq and Public Hosting
Message-ID: <7948460c-0c7a-49a9-a467-6b6d93809b23@vh10g2000pbc.googlegroups.com>

Hi all,

Is there a hosting company that offers public RabbitMq hosting ???

Thanks in advance

From aar at cpan.org  Thu Feb  2 14:48:32 2012
From: aar at cpan.org (Alessandro Ranellucci)
Date: Thu,  2 Feb 2012 15:48:32 +0100
Subject: [rabbitmq-discuss] State-of-the-art Perl client?
Message-ID: <r422Ps-1068i-2D55891A7C9848E3900F3B691FC2A217@thelonious.lan>

On 2-02-2012 at 2:20, Toby Corkindale wrote:

  >>While some may dislike to run a Java library in a Perl
  >>environment, it has proven to be fairly reliable without a single
  >>issue.
  >
  >I'm sure you can understand that it's not really desirable 
for many
  >people to do this, though, due to:
  >[...]

Not only I can understand that, but I even wrote it in my 
original message if you look above.  :)

Implementing bindings for the official Java library was the 
quickest solution I could come up with, given the 
unresponsiveness of other modules' authors, the uncertain status 
of the C library, the incompleteness of STOMP modules with 
regards to the RabbitMQ feature set.

The recent announcement of a new maintainer for the C library is 
good news for us Perl users, of course. In the mean time, the 
Java library has been supporting my production servers with no issues.

  >By the way - why do you require the user to call ->init 
manually? Why
  >not put that into the import() subroutine which is called automatically?

init() does a bit too much for it to be safely called 
automatically. Suppose you have a forking daemon: you probably 
want to load the Java part only after forking and after a number 
of other startup things. Having the user call it manually also 
allows to fine-tune it using runtime settings rather than 
hard-coded ones.

Cheers,

- Alessandro


From michael.justin at gmx.net  Thu Feb  2 14:54:41 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 02 Feb 2012 15:54:41 +0100
Subject: [rabbitmq-discuss] STOMP and persistent messages to a queue
	destination
Message-ID: <jge83i$3e6$1@dough.gmane.org>

Hello,

with RabbitMQ 2.7.1 I tested persistent messages based on the STOMP 
description which says "Setting the persistent header to true has the 
effect of making the message persistent."

So the frame which sends a message to a queue has this header:

SEND
destination:/queue/TOOL.DEFAULT
persistent:true
content-type:text/plain

Do I also have to do something with the queue to make it persistent? 
This is not clear from the documentation - and I found that the messages 
so not survive a broker restart

Many thanks in advance
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/


From alex at primafila.net  Thu Feb  2 14:35:40 2012
From: alex at primafila.net (Alessandro Ranellucci)
Date: Thu,  2 Feb 2012 15:35:40 +0100
Subject: [rabbitmq-discuss] State-of-the-art Perl client?
In-Reply-To: <4F29E4FB.3090906@strategicdata.com.au>
Message-ID: <r422Ps-1068i-7A30CD9E361E4471BCBF01BD94B329E7@thelonious.lan>

On 2-02-2012 at 2:20, Toby Corkindale wrote:

  >>While some may dislike to run a Java library in a Perl
  >>environment, it has proven to be fairly reliable without a single
  >>issue.
  >
  >I'm sure you can understand that it's not really desirable 
for many
  >people to do this, though, due to:
  >[...]

Not only I can understand that, but I even wrote it in my 
original message if you look above.  :)

Implementing bindings for the official Java library was the 
quickest solution I could come up with, given the 
unresponsiveness of other modules' authors, the uncertain status 
of the C library, the incompleteness of STOMP modules with 
regards to the RabbitMQ feature set.

The recent announcement of a new maintainer for the C library is 
good news for us Perl users, of course. In the mean time, the 
Java library has been supporting my production servers with no issues.

  >By the way - why do you require the user to call ->init 
manually? Why
  >not put that into the import() subroutine which is called automatically?

init() does a bit too much for it to be safely called 
automatically. Suppose you have a forking daemon: you probably 
want to load the Java part only after forking and after a number 
of other startup things. Having the user call it manually also 
allows to fine-tune it using runtime settings rather than 
hard-coded ones.

Cheers,

- Alessandro


From simon at rabbitmq.com  Thu Feb  2 16:07:00 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 02 Feb 2012 16:07:00 +0000
Subject: [rabbitmq-discuss] [announce] New maintainer for the rabbitmq-c
 library
In-Reply-To: <CAAt2poL=pO8eCZ7Yze-+8avbjwCKMU7W_5eLBmm-e9rAqrCuqQ@mail.gmail.com>
References: <CAAt2poL=pO8eCZ7Yze-+8avbjwCKMU7W_5eLBmm-e9rAqrCuqQ@mail.gmail.com>
Message-ID: <4F2AB4A4.6000206@rabbitmq.com>

I just wanted to say thank you for taking this on. rabbitmq-c hasn't had 
the love it deserves for quite some time, and I am excited to see where 
you take it.

(And yes, everyone else, please get involved! ;-)

Cheers, Simon

On 31/01/12 20:28, Alan Antonuk wrote:
> Hi;
>
> I am happy to announce that with the blessing of the RabbitMQ team, I
> have taken the lead on further development of the C RabbitMQ client
> library, also known as rabbitmq-c.
>
> The new home for the code is now on github:
> https://github.com/alanxz/rabbitmq-c
>
> My long term goal with the library is to have simple, stable, and
> scalable library that has feature-parity of that of the Java and .NET
> clients.
>
> Some near term goals I have for the library include:
> - Documenting the APIs presented by the library
> - Merging in channel-oriented memory management
> https://github.com/alanxz/rabbitmq-c/pull/5
> - Providing some patterns for consuming messages to reduce the amount of
> boiler plate code users have to write.
>
>
> I want to encourage users of the library to get involved in the
> development of the library. Good ways to get involved include:
>   - Forking <https://github.com/alanxz/rabbitmq-c/fork> the library on
> github and submitting a pull request
>   - Submitting any bugs, or feature requests to the issue tracker on
> github https://github.com/alanxz/rabbitmq-c/issues
>   - Sparking up a discussion or simply asking questions on usage on the
> rabbitmq-discuss listserv
>
> -Alan
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From stephen.t.young at gmail.com  Thu Feb  2 16:36:36 2012
From: stephen.t.young at gmail.com (Stephen Young)
Date: Thu, 2 Feb 2012 08:36:36 -0800 (PST)
Subject: [rabbitmq-discuss] Binding to multiple queues in a round-robin
	style using the PIKA library
Message-ID: <e299d891-da35-468d-9270-89c66212290b@eb6g2000vbb.googlegroups.com>

Hi there,

I'm working on a system that receives a variety of different message
types from different source queues, like the following:

client binds to Q1, Q2, Q3
server posts to Q2
client reads request and updates database. If something goes awry, the
client sends a basic_reject to requeue the request

however, this seems to cause some problems in that the client will see
a message in Q2, but need to have parsed a message in another queue
first. However the clients seem to keep polling the same queue until
success. Is there any better way to implement this system? Currently
I'm defeating the deadlock by having enough clients + some dedicated
clients on the bottleneck queues, but would prefer if each client
could run autonomously and read from queues in a pattern / priority of
some sort.

Cheers,
Stephen

From jerryk at vmware.com  Thu Feb  2 16:44:39 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 2 Feb 2012 08:44:39 -0800 (PST)
Subject: [rabbitmq-discuss] STOMP and persistent messages to a
	queue	destination
In-Reply-To: <jge83i$3e6$1@dough.gmane.org>
Message-ID: <802370d1-f958-4fd6-93f6-420af6d0c56d@strongmad.batnest.org>

Hi, Michael:

You'll also want to publish to an exchange that is durable, 
and have the message arrive in a queue that is durable, so
that the persisted message survives the reboot.

Best regards,
Jerry

----- Original Message -----
From: "Michael Justin" <michael.justin at gmx.net>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, February 2, 2012 6:54:41 AM
Subject: [rabbitmq-discuss] STOMP and persistent messages to a queue	destination

Hello,

with RabbitMQ 2.7.1 I tested persistent messages based on the STOMP 
description which says "Setting the persistent header to true has the 
effect of making the message persistent."

So the frame which sends a message to a queue has this header:

SEND
destination:/queue/TOOL.DEFAULT
persistent:true
content-type:text/plain

Do I also have to do something with the queue to make it persistent? 
This is not clear from the documentation - and I found that the messages 
so not survive a broker restart

Many thanks in advance
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Thu Feb  2 16:46:49 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 2 Feb 2012 08:46:49 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMq and Public Hosting
In-Reply-To: <7948460c-0c7a-49a9-a467-6b6d93809b23@vh10g2000pbc.googlegroups.com>
Message-ID: <e260f78e-47c2-4cfa-b648-194e46145087@strongmad.batnest.org>

Hi:

It depends what you want hosted.  Heroku has RabbitMQ available as a Heroku add-on,
currently in beta.  There's also a RabbitMQ service as part of VMware's Cloud Foundry
offering.  Those services were originally developed by the RabbitMQ team itself.

Beyond that, there are a couple of other cloud hosting outfits that offer messaging
services of various sorts, some using Rabbit, but you'll have to do some research
for the details...

Best regards,
Jerry


----- Original Message -----
From: "mvbaffa" <mvbaffa at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, February 2, 2012 5:31:07 AM
Subject: [rabbitmq-discuss] RabbitMq and Public Hosting

Hi all,

Is there a hosting company that offers public RabbitMq hosting ???

Thanks in advance
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Thu Feb  2 16:53:34 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 2 Feb 2012 08:53:34 -0800 (PST)
Subject: [rabbitmq-discuss] help required: bind function
In-Reply-To: <1328184592.31745.YahooMailNeo@web29702.mail.ird.yahoo.com>
Message-ID: <07af12f2-a652-402d-a8ed-3b63d19b72a9@strongmad.batnest.org>

Hi, Saima.

If you're trying to to implement some aspect of the actual AMQP
message transport, for learning purposes, you might consider following
RabbitMQ's structure.

In Rabbit, a binding of an exchange to a queue is essentially a record
in a table somewhere saying this exchange is bound to this queue, with
this associated routing key.

The actual work of getting a message published to that exchange into
an appropriate bound queue, is actually done by the process associated
with the communications channel used by the message's sender.  Essentially
it looks up the particulars of the exchange, determines what routing logic
is appropriate to use for that exchange type, looks at the message's routing
key if appropriate, and tries to match it to a binding.  If match(es) are
found, the message is forwarded to a process representing the queue, which is
responsible for its contents.  Almost symmetrically on the consumer side, 
a consumer's channel talks to the queue it's consuming from to ask it to 
disgorge its messages.

Apologies if this isn't quite what you're asking... I confess I may not fully 
grasp the ultimate intent of your investigations...

Best regards,
Jerry

----- Original Message -----
From: "Saima Asif" <abdullahsaima at yahoo.com>
To: "Emile Joubert" <emile at rabbitmq.com>, rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, February 2, 2012 4:09:52 AM
Subject: Re: [rabbitmq-discuss] help required: bind function




Thank you very much Emile and Aamir for your kind replies. 

Infact I know the basic concept of binding, if a queue is bounded to exchange then that queue wants to receive the message from that particular exchange. But I am so sorry I dont know how to interpret this relationship into programming langauge i.e. C++. How can I specify the queue that now this queue will recieve messages from this exch ange. I have consulted all the material, But the problem is writing and interpreting. I am so sorry I think it would be a big ask. 

Any help would be highly appreiated. 


Saima 



From: Emile Joubert <emile at rabbitmq.com> 
To: rabbitmq-discuss at lists.rabbitmq.com; abdullahsaima at yahoo.com 
Sent: Thursday, 2 February 2012, 9:51 
Subject: Re: [rabbitmq-discuss] help required: bind function 

Hi Saima, 

On 31/01/12 22:23, Saima Asif wrote: 
> I am student , and my supervisor and I have chosen to implement and 
> study it at very simpler level. my classes are not refined. There is one 
> class "message" which has a routing key. 
> I need your help how can I write Bind() function for this. 

Keep in mind that binding is an operation on a queue, not a message. See 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.queue for queue 
operations. 

Have you taken a look at the tutorials at 
http://www.rabbitmq.com/getstarted.html ? 
They introduce AMQP concepts (including binding) in a way that should be 
of help. Unfortunately no C or C++ translation exists, but if you feel 
brave you could contribute this. 

-Emile 



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From steve at rabbitmq.com  Thu Feb  2 16:57:46 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 2 Feb 2012 16:57:46 +0000
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044789C@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>
	<20120128171156.GD3692@southbank.Home>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>
	<20120129202348.GI3692@southbank.Home>
	<5F389C517756284F80239F55BCA5DDDD36923A6D@G9W0721.americas.hpqcorp.net>
	<20120130101227.GK3692@southbank.Home>
	<D4925C82-5E7D-451E-834C-D51F57A5958C@syncsort.com><20120130233656.GB3968@southbank.Home>
	<4F27C521.3030703@rabbitmq.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044789C@MAILCCR.us.syncsort.com>
Message-ID: <EA522C4A-26D1-4882-8920-60907ABDEEFD@rabbitmq.com>

Paul,

Sorry, Paul, but I don't understand the question.

To what Consumer are you referring? It is not possible
to instantiate a java interface class (which Consumer is).

Perhaps you are using another client?

The Java Client's threading policy for Consumer callbacks
changed in 2.7.0. You might like to read the blog entry(1) and
the notes in the Java Client API pages(2).

Cheers,
Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]
(1) http://www.rabbitmq.com/blog/2011/12/20/rabbitmq-2-7-0-and-2-7-1-are-released/
(2) http://www.rabbitmq.com/api-guide.html ('Channel thread-safety' and 'Advanced connection options')

On 1 Feb 2012, at 19:57, Bell, Paul M. wrote:

> My question: is it possible to adjust the "concurrency" of a consumer in real time? That is, when I create a consumer with
> 
>     Consumer consumer = new Consumer("q1", "q1", 3);
> 
> I get a single consumer that runs 3 threads. Can I adjust this "3" dynamically?
> 
> Thanks again.
> 
> -Paul


From jerryk at vmware.com  Thu Feb  2 17:22:55 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 2 Feb 2012 09:22:55 -0800 (PST)
Subject: [rabbitmq-discuss] STOMP and persistent messages to a
	queue	destination
In-Reply-To: <jge83i$3e6$1@dough.gmane.org>
Message-ID: <118c54c3-9e1d-4924-b07c-528502c18a0a@strongmad.batnest.org>

Hi, Michael...

Apologies.  When I responded somewhat glibly earlier I missed the key bit
of context that you're talking about STOMP, about which I know relatively little.

The plugin creates its "/queue" queues as durable automatically, so that part
of my admonition is taken care of, and it works through the default exchange,
which is always there, so that won't be the problem...

Your messages do indeed appear to be published with persistence requested.
Are you losing some or a lot?  When is the broker restart happening?  Could it
be that the broker is bouncing before it's been able to accept responsibility 
for your message and get it safely on disk?

Looking at the STOMP adapter's web page, I see we've got what appears to be
an inert non-link where we promise to tell you about the actual semantics of
this operation:

http://www.rabbitmq.com/stomp.html

Rabbit's publisher confirm extension, for ensuring that the broker has really
taken responsibility for a message you've published is documented here:

http://www.rabbitmq.com/extensions.html#confirms

Are you asking for receipts when you publish?

Best regards,
Jerry

----- Original Message -----
From: "Michael Justin" <michael.justin at gmx.net>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, February 2, 2012 6:54:41 AM
Subject: [rabbitmq-discuss] STOMP and persistent messages to a queue	destination

Hello,

with RabbitMQ 2.7.1 I tested persistent messages based on the STOMP 
description which says "Setting the persistent header to true has the 
effect of making the message persistent."

So the frame which sends a message to a queue has this header:

SEND
destination:/queue/TOOL.DEFAULT
persistent:true
content-type:text/plain

Do I also have to do something with the queue to make it persistent? 
This is not clear from the documentation - and I found that the messages 
so not survive a broker restart

Many thanks in advance
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From yogimogi at gmail.com  Thu Feb  2 17:32:42 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Thu, 2 Feb 2012 09:32:42 -0800 (PST)
Subject: [rabbitmq-discuss] Problem with RabbitMQ Java Client (Memory
	leak)
In-Reply-To: <44BE06C1-A16E-4A9C-9F66-BEBEF00CB099@rabbitmq.com>
References: <fd4945fc-14a3-4efb-9016-c78a9cae8043@vh10g2000pbc.googlegroups.com>
	<4C8B808C-80D4-40BB-9C99-98609675EB9C@rabbitmq.com>
	<9da89044-0ea4-4086-b338-ade4d68aa1d9@n7g2000pbd.googlegroups.com>
	<44BE06C1-A16E-4A9C-9F66-BEBEF00CB099@rabbitmq.com>
Message-ID: <1b453046-9e07-4fa9-b883-ed64575f9b46@lr19g2000pbb.googlegroups.com>

Hi Steve,

Now that I am reusing the channels, memory problem with channels is
not an issue, but there seems to be some more problem with memory
leak.
I had a program which pumped 100000 messages on a queue.

Then this program kicked in and created certain queues on the fly and
distributed these messages across them and
eventually all the messages got consumed.

Now when all queues in the system are empty, here is the object dump
and I again see a lot of memory used by
these objects.

96449 instances of class com.rabbitmq.client.AMQP$BasicProperties
96428 instances of class com.rabbitmq.client.Envelope
96399 instances of class com.rabbitmq.client.impl.ConsumerDispatcher
$4

I created BasicProperties object like this, while routing the messages
to appropriate queue.
    BasicProperties bp = new BasicProperties();
    bp.setTimestamp(Calendar.getInstance().getTime());
    bp.setType(MessageProperties.PERSISTENT_TEXT_PLAIN.toString());
This was then used in basicPublish method.

regards, Yogesh

On Feb 1, 10:37?pm, Steve Powell <st... at rabbitmq.com> wrote:
> The fix (which we have coded) will be in the next release,
> but I don't know precisely when that will be.
>
> Steve Powell ?(a happy bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>
> On 1 Feb 2012, at 11:21, Yogesh Ketkar wrote:
>
>
>
>
>
>
>
>
>
> > Thanks Steve.
> > Can you give me some idea about date of next Java Client release (with
> > this bug-fix)?
>
> > regards, Yogesh
>
> > On Feb 1, 3:42 pm, Steve Powell <st... at rabbitmq.com> wrote:
> >> Yogesh,
>
> >> Thank you for this problem report. First point: each connection defines a
> >> (hidden) channel zero, so that explains why there are 20001 of some objects and
> >> 20000 of others.
>
> >> As to why these are not garbage collected, we must be holding a reference
> >> somewhere (probably in the Connection).
>
> >> We will investigate. I have raised a bug (24723).
>
> >> Steve Powell ?(a happy bunny)
> >> ----------some more definitions from the SPD----------
> >> vermin (v.) Treating the dachshund for roundworm.
> >> chinchilla (n.) Cooling device for the lower jaw.
> >> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>
> >> On 31 Jan 2012, at 17:49, Yogesh Ketkar wrote:
>
> >>> I am using rabbitmq-java-client-bin-2.7.1/rabbitmq-client.jar with
> >>> RabbitMQ 2.7.1 Server.
>
> >>> Just run this code
>
> >>> public static void main(String[] argv) throws IOException {
> >>> ? ?ConnectionFactory f = new ConnectionFactory();
> >>> ? ?Connection c = f.newConnection();
> >>> ? ?for(int i = 0; i < 20000; ++i) {
> >>> ? ? ? ?Channel ch = c.createChannel();
> >>> ? ? ? ?ch.close();
> >>> ? ?}
> >>> ? ?System.gc();
> >>> ? ?while(true) {}
> >>> }
>
> >>> While program is running, observe the memory usage, it keeps on
> >>> increasing
> >>> Get process id and do following
> >>> jmap -dump:format=b,file=yo.bin ?<pid>
> >>> jhat jhat -J-mx768m -stack false yo.bin
> >>> Once jhat brings up http server, go here
> >>>http://localhost:7000/showInstanceCounts/
>
> >>> 20001 instances of class com.rabbitmq.client.impl.AMQCommand
> >>> 20001 instances of class com.rabbitmq.client.impl.CommandAssembler
> >>> 20000 instances of class com.rabbitmq.client.ShutdownSignalException
> >>> 20000 instances of class com.rabbitmq.client.impl.AMQImpl$Channel
> >>> $Close
> >>> 20000 instances of class com.rabbitmq.client.impl.ChannelN
> >>> 20000 instances of class com.rabbitmq.client.impl.ConsumerDispatcher
>
> >>> In-spite of closing all the channels, not only channels but associated
> >>> objects (ShutdownSignalException, ChannelClose) continue to consume
> >>> memory.
> >>> For sure, knowing this now, I will use channelCreate call sparingly.
>
> >>> Is there a way to remedy this situation?
> >>> What is also worrying is instances of AMQCommand, so would this be the
> >>> case for each and every call of client library?
>
> >>> regards, Yogesh
>
> >>> _______________________________________________
> >>> rabbitmq-discuss mailing list
> >>> rabbitmq-disc... at lists.rabbitmq.com
> >>>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mvbaffa at gmail.com  Thu Feb  2 17:42:21 2012
From: mvbaffa at gmail.com (mvbaffa)
Date: Thu, 2 Feb 2012 09:42:21 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMq and Public Hosting
In-Reply-To: <e260f78e-47c2-4cfa-b648-194e46145087@strongmad.batnest.org>
References: <e260f78e-47c2-4cfa-b648-194e46145087@strongmad.batnest.org>
Message-ID: <8f311a48-a821-4caf-8cfc-3000e8e8768b@s7g2000vby.googlegroups.com>

I will check VMWare Cloud Foundry.

Another more affordable option could be a VPS hosting.

Thank you very much

On Feb 2, 2:46?pm, Jerry Kuch <jer... at vmware.com> wrote:
> Hi:
>
> It depends what you want hosted. ?Heroku has RabbitMQ available as a Heroku add-on,
> currently in beta. ?There's also a RabbitMQ service as part of VMware's Cloud Foundry
> offering. ?Those services were originally developed by the RabbitMQ team itself.
>
> Beyond that, there are a couple of other cloud hosting outfits that offer messaging
> services of various sorts, some using Rabbit, but you'll have to do some research
> for the details...
>
> Best regards,
> Jerry
>
>
>
> ----- Original Message -----
> From: "mvbaffa" <mvba... at gmail.com>
> To: rabbitmq-disc... at lists.rabbitmq.com
> Sent: Thursday, February 2, 2012 5:31:07 AM
> Subject: [rabbitmq-discuss] RabbitMq and Public Hosting
>
> Hi all,
>
> Is there a hosting company that offers public RabbitMq hosting ???
>
> Thanks in advance
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss- Hide quoted text -
>
> - Show quoted text -

From pbell at syncsort.com  Thu Feb  2 18:19:13 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Thu, 2 Feb 2012 13:19:13 -0500
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <EA522C4A-26D1-4882-8920-60907ABDEEFD@rabbitmq.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>
	<20120128171156.GD3692@southbank.Home>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>
	<20120129202348.GI3692@southbank.Home>
	<5F389C517756284F80239F55BCA5DDDD36923A6D@G9W0721.americas.hpqcorp.net>
	<20120130101227.GK3692@southbank.Home>
	<D4925C82-5E7D-451E-834C-D51F57A5958C@syncsort.com><20120130233656.GB3968@southbank.Home>
	<4F27C521.3030703@rabbitmq.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044789C@MAILCCR.us.syncsort.com>
	<EA522C4A-26D1-4882-8920-60907ABDEEFD@rabbitmq.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B404479A4@MAILCCR.us.syncsort.com>

Sorry, Steve - my error. The "Consumer" class I referenced is mine. Its constructor takes the aforementioned "3" and presents it to a setConcurrentConsumers call, something like the following:

             SimpleMessageListenerContainer container = new SimpleMessageListenerContainer();
                container.setConcurrentConsumers(numConsumerThreads);

So I guess I am asking about dynamically adjusting the number of these threads.

Thanks.

-Paul

-----Original Message-----
From: Steve Powell [mailto:steve at rabbitmq.com]
Sent: Thursday, February 02, 2012 11:58 AM
To: Bell, Paul M.
Cc: RabbitMQ List
Subject: Re: [rabbitmq-discuss] Securing RabbitMQ

Paul,

Sorry, Paul, but I don't understand the question.

To what Consumer are you referring? It is not possible
to instantiate a java interface class (which Consumer is).

Perhaps you are using another client?

The Java Client's threading policy for Consumer callbacks
changed in 2.7.0. You might like to read the blog entry(1) and
the notes in the Java Client API pages(2).

Cheers,
Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]
(1) http://www.rabbitmq.com/blog/2011/12/20/rabbitmq-2-7-0-and-2-7-1-are-released/
(2) http://www.rabbitmq.com/api-guide.html ('Channel thread-safety' and 'Advanced connection options')

On 1 Feb 2012, at 19:57, Bell, Paul M. wrote:

> My question: is it possible to adjust the "concurrency" of a consumer in real time? That is, when I create a consumer with
>
>     Consumer consumer = new Consumer("q1", "q1", 3);
>
> I get a single consumer that runs 3 threads. Can I adjust this "3" dynamically?
>
> Thanks again.
>
> -Paul




ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From fearsome.lucidity at gmail.com  Thu Feb  2 18:59:43 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Thu, 2 Feb 2012 13:59:43 -0500
Subject: [rabbitmq-discuss] RabbitMQ and Erlang --enable-native-libs
Message-ID: <CAFDmHdM1skF=+k=NXG_SWcwR-iid0vFD3-7d=vVRZPvE5eoGRg@mail.gmail.com>

FYI for any others that may be thinking of trying this, RabbitMQ will not
start up if you compile Erlang R15B with the --enable-native-libs option.
 It exits with the error:

The code server called the unloaded module `alarm_handler'

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120202/dc98ea30/attachment.htm>

From fearsome.lucidity at gmail.com  Thu Feb  2 21:14:07 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Thu, 2 Feb 2012 16:14:07 -0500
Subject: [rabbitmq-discuss] Problems declaring x-random exchanges
Message-ID: <CAFDmHdMQxUWtVuDNZr36+4Bo4iatgKe_1MrPPySX2VOJ-0w-xw@mail.gmail.com>

Anyone successfully using the x-random exchange in 2.7.1?  Upgraded and
installed the random exchange from Github, but when I try to declare such
an exchange via the management UI I get:

** Generic server <0.16679.0> terminating
** Last message in was {'$gen_cast',
                           {method,
                               {'exchange.declare',0,<<"test">>,

 <<"x-random">>,false,true,false,true,false,
                                   []},
                               none}}
** Reason for termination ==
** {{error,{undef,[{rabbit_exchange_type_random,serialise_events,[]},
                   {rabbit_exchange,store,1},
                   {rabbit_exchange,'-declare/6-fun-0-',3},
                   {rabbit_misc,'-execute_mnesia_transaction/2-fun-0-',2},
                   {mnesia_tm,apply_fun,3},
                   {mnesia_tm,execute_transaction,5},
                   {worker_pool_worker,handle_call,3},
                   {gen_server2,handle_msg,2}]}},
    [{rabbit_misc,execute_mnesia_transaction,1},
     {rabbit_misc,execute_mnesia_transaction,2},
     {rabbit_channel,handle_method,3},
     {rabbit_channel,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,init_p_do_apply,3}]}

The startup_log shows the plugin is active:

Activating RabbitMQ plugins ...
12 plugins activated:
...
* random_exchange-0.1.0
...
starting exchange type random
...done
...


I noticed that the current code in Github pulls rabbitmq_commons from
2.7.0, not 2.7.1.  Possible cause?

Node has hipe_compile set to true, FYI.

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120202/3b762704/attachment.htm>

From fearsome.lucidity at gmail.com  Thu Feb  2 21:33:49 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Thu, 2 Feb 2012 16:33:49 -0500
Subject: [rabbitmq-discuss] Problems declaring x-random exchanges
In-Reply-To: <CAFDmHdMQxUWtVuDNZr36+4Bo4iatgKe_1MrPPySX2VOJ-0w-xw@mail.gmail.com>
References: <CAFDmHdMQxUWtVuDNZr36+4Bo4iatgKe_1MrPPySX2VOJ-0w-xw@mail.gmail.com>
Message-ID: <CAFDmHdOE1a31DX+ttK-HuDs=y3Ev7WA=pX1Ttyz4ypNG9RrLgw@mail.gmail.com>

On Thu, Feb 2, 2012 at 4:14 PM, Elias Levy <fearsome.lucidity at gmail.com>wrote:

> ** Reason for termination ==
> ** {{error,{undef,[{rabbit_exchange_type_random,serialise_events,[]},
>

Figured the serialize_events function was missing from the exchange module.
Since the function is as simple as it gets and its the same on all of the
official exchanges, adding it to the random exchange got it working.

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120202/7be0948e/attachment.htm>

From codevally at gmail.com  Fri Feb  3 00:24:19 2012
From: codevally at gmail.com (Roshan Pradeep)
Date: Fri, 3 Feb 2012 11:24:19 +1100
Subject: [rabbitmq-discuss] RabbitMQ memory usage in two node cluster
Message-ID: <CAH+_+m7itg0QbkzQQeQQWnT6-ERMH6ZNqsNMuGUSmunWpyoQjg@mail.gmail.com>

Hi Experts

I have 2 node RabbitMQ cluster and one node consume double amount of memory
than the other. Please check the attached image for more information.

Could you please help me to identify this. Any help is appreciated.

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/665689a7/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit.png
Type: image/png
Size: 15847 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/665689a7/attachment.png>

From codevally at gmail.com  Fri Feb  3 03:08:27 2012
From: codevally at gmail.com (Roshan Pradeep)
Date: Fri, 3 Feb 2012 14:08:27 +1100
Subject: [rabbitmq-discuss] Change the password for guest account or remove
	guest account from RabbitMQ
Message-ID: <CAH+_+m4X0z5gJvPqM7QCq3ytKKGqKpioDSj0PnPSK4XBF8+cgg@mail.gmail.com>

Hi All

What are the impacts for changing the password for "guest" user account or
remove the "guest" account entirely. I can create my own account and assign
it to vhost currently I am using.

Is the guest/guest is use inside RabbitMQ code for any purpose?

Any helps are appreciate.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/c24d645b/attachment.htm>

From codevally at gmail.com  Fri Feb  3 03:17:04 2012
From: codevally at gmail.com (Codevally)
Date: Thu, 2 Feb 2012 19:17:04 -0800 (PST)
Subject: [rabbitmq-discuss] Change the password for guest account or
 remove guest account from RabbitMQ
In-Reply-To: <CAH+_+m4X0z5gJvPqM7QCq3ytKKGqKpioDSj0PnPSK4XBF8+cgg@mail.gmail.com>
References: <CAH+_+m4X0z5gJvPqM7QCq3ytKKGqKpioDSj0PnPSK4XBF8+cgg@mail.gmail.com>
Message-ID: <03351626-1805-4eb5-8e96-c177026e91e4@og8g2000pbb.googlegroups.com>

I think I found the solution.

http://www.rabbitmq.com/access-control.html

On Feb 3, 2:08?pm, Roshan Pradeep <codeva... at gmail.com> wrote:
> Hi All
>
> What are the impacts for changing the password for "guest" user account or
> remove the "guest" account entirely. I can create my own account and assign
> it to vhost currently I am using.
>
> Is the guest/guest is use inside RabbitMQ code for any purpose?
>
> Any helps are appreciate.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From yogimogi at gmail.com  Fri Feb  3 03:45:59 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Thu, 2 Feb 2012 19:45:59 -0800 (PST)
Subject: [rabbitmq-discuss] ShutdownSignalException second 'channel.open'
In-Reply-To: <A00A77EA-EB93-45F3-9148-BCDA8C5F3C06@rabbitmq.com>
References: <5fe26671-e654-48e6-80a6-05a181a8f814@kg1g2000pbb.googlegroups.com>
	<32E33686-2FCA-4800-BF2B-7B5953786B63@rabbitmq.com>
	<137381af-f9d8-4871-90d3-d60f478aa39b@x6g2000pbk.googlegroups.com>
	<A00A77EA-EB93-45F3-9148-BCDA8C5F3C06@rabbitmq.com>
Message-ID: <60407ca0-7e3c-4d9a-a24f-3c278583b73a@i10g2000pbl.googlegroups.com>

Hi Steve,

Couple of things

1. Purpose of _Return queues
   Say App1 Queues has 10 messages and first one is processed by
calling an external system. This system
   operates in asynchronous manner and just returns task-id. I put it
on App1_Return queue and keep on
   polling this queue, get task-id and query external system for
status. If task is still going on, I
   re-queue the message to App1_Return queue.
   To process any message on App1 queue, I check if there is any
message on App1_Return queue. If there
   is none, only then can I process message from App1 queue as
otherwise, it indicates that previous
   operation is on App1 is still not complete.
   App1_Return queue at any point of time will only have at most one
message.
   This probably can be done using an external db, but why introduce
another system.

2.
> Just because you have thousands of queues doesn't mean you need to have
> thousands of Consumer instances -- it is quite ok to use the same Consumer on
> several basicConsume calls. The consumerTag is passed to every Consumer callback
> so the Consumer code can distinguish for which basicConsume it is called.
Can you give me an elegant pattern for
- Process message from Main Queue
- Declare/Redeclare appropriate Queue
- Attach a consume on this queue doing ch.basicConsume(...) only
  if there are no consumers already on this queue
- When cleaning method kicks in
  - do ch.basicCancel on all queues, wait till you get
    handleCancelOk on all consumers
  - check message count of all queues
  - delete all queues which are empty and have 0 consumers
    btw, I use http://localhost:55672/api/queues/%2f?columns=name,messages,consumers
    to get queues, consumers and messages and then fire
    foreach(queue)
    if(messages == 0 && consumers == 0)
        ch.queueDelete(queue, true, true)
    Is this call http://localhost:55672/api/queues/%2f?columns=name,messages,consumers
    reliable?

regards, Yogesh

On Feb 1, 3:35?pm, Steve Powell <st... at rabbitmq.com> wrote:
> Yogesh,
>
> Thanks for your explanation of your application structure, and the version you
> are running.
>
> I do not know how the second channel.open AMQP command (for the same channel)
> was sent to the broker; can you send some more diagnostics of this failure (log,
> full stack trace) so I can raise a bug. If possible, a demonstrating small
> program. Thanks.
>
> I see your difficulty. I would hope that creating 20000 queues (which are empty
> almost all of the time) would not take up too much room, so I think you should
> consider not deleting them at all. This would solve most of your problem.
>
> The x-expires attribute for queues, really ought to have a 'only-if-empty'
> option. I'll raise a bug (24722) for this, and see how difficult it would be.
>
> I do not understand what the _Return queues are for. They look as though you are
> using them as a private persistent store for each App. It would be better if you
> put this information somewhere else, but heigh-ho -- you can safely delete these
> queues since this app is in complete control of them, and the events are
> processed serially.
>
> One of the reasons, I don't do basicConsume on queues is, I am going to have
> thousands of queues. I rather thought it would be easier to have a thread pool,
> each consuming just one message from a queue in round-robin fashion.
>
> Just because you have thousands of queues doesn't mean you need to have
> thousands of Consumer instances -- it is quite ok to use the same Consumer on
> several basicConsume calls. The consumerTag is passed to every Consumer callback
> so the Consumer code can distinguish for which basicConsume it is called.
>
> By default, the Java client will allocate a pool of 5 threads for each
> connection, and dispatch Consumer callbacks onto one of those threads for you.
> So your thread pool might be unnecessary if you used basicConsume(). I'd
> consider doing that since basicGet() can be slow, and you'd have to get from
> each potential queue just to tell if there is a message for it!
>
> Steve Powell ?(a happy bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>
> On 31 Jan 2012, at 13:56, Yogesh Ketkar wrote:
>
>
>
>
>
>
>
>
>
> > I am using RabbitMQ server version 2.7.1.
> > Java Client Jar used is
> > rabbitmq-java-client-bin-2.7.1/rabbitmq-client.jar
>
> >> The Shutdown seems to be being called because the channel is being opened twice.
> >> The broker complains about this and closes the connection. Are you creating
> >> channels on different threads simultaneously?
> > Yes indeed, I am creating channels on different threads.
>
> >> I don't think the basicPublish will fail if the queue doesn't exist. Why would
> >> you create a new channel in this case?
> > Yes, you are right. I will basically lose the message in this case.
>
> > Now about overall problem statement.
> > My application has a main queue which looks like
> > MainQueue
> > ?- App1-Event1
> > ?- App2-Event1
> > ?- App1-Event2
> > ?- App1-Event3
> > ?- App3-Event1
> > ?- App3-Event2
> > ?- App2-Event2
>
> > Basically there are going to be events from different Apps (there can
> > be thousands of apps) and events belonging to an App must
> > be processed sequentially. Events across different apps can and should
> > be be processed in parallel.
> > So I have only one consumer on MainQueue (using basicConsume) which
> > reads events from MainQueue and just moves it to appropriate declared/
> > redeclared queue.
> > So this is how new queue structure would look like.
>
> > App1
> > ?- App1-Event1
> > ?- App1-Event2
> > ?- App1-Event3
>
> > App2
> > ?- App2-Event1
> > ?- App2-Event2
>
> > App3
> > ?- App3-Event1
> > ?- App3-Event2
>
> > Now again when Event1 is processed from Queue App1, Event2 of App1
> > can't be processed unless processing of Event1 is complete.
> > Processing of event involves asynchronous communication with external
> > systems, so once Event1 is fetched (and acknowledged) from queue
> > App1,
> > I create another queue like
> > App1_Return
> > ?- App1-Event1-TaskId
>
> > I need to query external system using TaskId after certain time
> > interval, to check status of event processing of Event1. Once I get
> > the status (either sucess or failure)
> > I discard App1-Event1-TaskId and ready to process App1-Event2. So all
> > _Return queues will only have one event at any point of time.
>
> > An event on an app might even occur once a day. So I don't want to
> > keep so many queues (potentially 20000 if there are 10000 apps)
> > hanging around.
> > Both auto_delete and x-expires are not very useful as in both the
> > schemes, queues get deleted even when they have messages.
> > Ideally whenever last message from any Queue (except MainQueue) is
> > consumed, I want to delete that queue. Of course, one has to make sure
> > while a queue is getting deleted, there might be an event destined for
> > that. So if one guy is doing
> > queueDelete('somequeue', true, true) and other guy is doing
> > queueDeclare, queueBind, basicPublish. If queueDelete gets executed
> > after
> > queueBind, message will be lost.
>
> > One of the reasons, I don't do basicConsume on queues is, I am going
> > to have thousands of queues. I rather thought it would be easier to
> > have a thread pool, each consuming just one message from a queue in
> > round-robin fashion.
>
> > As was mentioned in some other response, I will certainly not create a
> > new channel in every thread, but would rather try and reuse them.
>
> > Thanks for all the help.
> > Regards, Yogesh
>
> > On Jan 31, 5:19 pm, Steve Powell <st... at rabbitmq.com> wrote:
> >> Yogesh,
>
> >> Please can you provide some information about your environment? And your
> >> application? What version of RabbitMQ (and client) are you using?
>
> >> In your stack trace the ShutdownListener you registered is apparently being
> >> called, because the Connection is being shut down. It is not clear why this
> >> exception (and its associated stack trace) appears, it seems to come from your
> >> Listener code, but perhaps that does nothing.
>
> >> The Shutdown seems to be being called because the channel is being opened twice.
> >> The broker complains about this and closes the connection. Are you creating
> >> channels on different threads simultaneously? (Looking at your app 'design' you
> >> might be.) Depending upon the version of RabbitMQ this might cause a problem.
>
> >> I'm afraid your application design is unclear:
>
> >>> This is how I handle doing basicPublish and basicGet on potentially
> >>> non-existent queues
> >>> - publish involves 3 steps
> >>> ?queueDeclare
> >>> ?queueBind
> >>> ?basicPublish
> >>> ?If some other thread deletes the queue after either queueDeclare or
> >>> queueBind, basicPublish fails and I again create a new
> >>> ?channel and do these operations
>
> >> I don't think the basicPublish will fail if the queue doesn't exist. Why would
> >> you create a new channel in this case?
>
> >> Please explain why you expect the queue might be deleted by some other thread.
>
> >>> - if basicGet fails, I simply ignore it
>
> >> What do you mean by ignoring it? Do you poll the queue periodically? Why aren't
> >> you using basicConsume and a Consumer to get messages (which will be notified if
> >> the queue is deleted)?
>
> >> Steve Powell ?(a loopy bunny)
> >> ----------some more definitions from the SPD----------
> >> vermin (v.) Treating the dachshund for roundworm.
> >> chinchilla (n.) Cooling device for the lower jaw.
> >> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>
> >> On 30 Jan 2012, at 04:33, Yogesh Ketkar wrote:
>
> >>> Only operations I ever do with com.rabbitmq.client.Connection in the
> >>> code are
> >>> ? ?c.addShutdownListener
> >>> ? ?c.createChannel
>
> >>> What does this error signify?
>
> >>> 2012-01-30 09:44:45,158 ERROR ?[ConnectionShutdownHandler]
> >>> ShutdownListener
> >>> com.rabbitmq.client.ShutdownSignalException: connection error; reason:
> >>> {#method<connection.close>(reply-code=503, reply-text=COMMAND_INVALID
> >>> - second 'channel.open' seen, class-id=20, method-id=10), null,
> >>> "[B at 105691e"}
> >>> ? ?at com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:
> >>> 641)
> >>> ? ?at
> >>> com.rabbitmq.client.impl.AMQConnection.handleConnectionClose(AMQConnection. java:
> >>> 599)
> >>> ? ?at
> >>> com.rabbitmq.client.impl.AMQConnection.processControlCommand(AMQConnection. java:
> >>> 571)
> >>> ? ?at com.rabbitmq.client.impl.AMQConnection
> >>> $1.processAsync(AMQConnection.java:88)
> >>> ? ?at
> >>> com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel .java:
> >>> 144)
> >>> ? ?at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:
> >>> 91)
> >>> ? ?at com.rabbitmq.client.impl.AMQConnection
> >>> $MainLoop.run(AMQConnection.java:500)
>
> >>> Some additional info.
> >>> I create and close thousands of channels in the code. But at any point
> >>> of time there are not more than 20/21 channels open.
> >>> This is how I handle doing basicPublish and basicGet on potentially
> >>> non-existent queues
> >>> - publish involves 3 steps
> >>> ?queueDeclare
> >>> ?queueBind
> >>> ?basicPublish
> >>> ?If some other thread deletes the queue after either queueDeclare or
> >>> queueBind, basicPublish fails and I again create a new
> >>> ?channel and do these operations
> >>> - if basicGet fails, I simply ignore it
>
> >>> regards, Yogesh
> >>> _______________________________________________
> >>> rabbitmq-discuss mailing list
> >>> rabbitmq-disc... at lists.rabbitmq.com
> >>>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing...
>
> read more ?

From codevally at gmail.com  Fri Feb  3 05:47:56 2012
From: codevally at gmail.com (Codevally)
Date: Thu, 2 Feb 2012 21:47:56 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ communication ports
Message-ID: <abb9f62f-006b-4833-8099-bd03a014d8a4@rk3g2000pbb.googlegroups.com>

Hi All

Other than the 5672 tcp port, what are the other ports RabbitMQ using
to communicate. We need to identify the ports before implementing the
firewall. Many thanks.

From liuzhuofu at huawei.com  Fri Feb  3 06:06:08 2012
From: liuzhuofu at huawei.com (Liuzhuofu)
Date: Fri, 03 Feb 2012 06:06:08 +0000
Subject: [rabbitmq-discuss] Plugin compile problem
Message-ID: <D027DE656EBD4F4C8EE57361B5EF438E399156F8@szxeml524-mbs.china.huawei.com>

Hi all:
    I found a plugin complie problem.
    I downloaded a lastest version of rabbitmq-server-2.7.1.tar.gz from http://hg.rabbitmq.com/. And I build the RabbitMQ Server first, then, I enter the ../plugins-src/rabbitmq-stomp directory, and "make", at this time, it makes failed like this:
../do-package.mk:162: ../coverage/package.mk: No such file or directory
make: *** No rule to make target `../coverage/package.mk'.  Stop.
    And I found in the "../plugins-src/coverage", there is only a "build" directory, so I download a "rabbitmq-public-umbrella" plugins, copy the "coverage" directory's files to "../rabbitmq-server-2.7.1/plugins-src/coverage", then I can make the plugin successful.
    Why the "coverage" in rabbitmq-server-2.7.1 lost the files, and it can't compile the plugins after build the server, is this a problem?

Regard
David.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/6cc0255c/attachment.htm>

From liuzhuofu at huawei.com  Fri Feb  3 09:35:32 2012
From: liuzhuofu at huawei.com (Liuzhuofu)
Date: Fri, 03 Feb 2012 09:35:32 +0000
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
	Plugin
Message-ID: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>

Hi:
    I am working in china, and I am a beginner of RabbitMQ.

    I want to use the "Presence Exchange" plugin in my system in order to monitor all the client connected to the RabbitMQ server, when one of the client exit or coredump, it will disconnect with RabbitMQ Server, and I want to get this event.

    Simon suggest me to use "Presence Exchange" plugin, and after my test, I have some question about the plugin.

1. What's the behavier of "x-presence" like? direct, fanout or topic?

2. One "x-presence" exchange can only get the event that the binding changes on this exchanges, other bindings on other exchanges, it can not monitor, am I right?

3. If I want to develop a plugin, how can I known what api interface of RabbitMQ Server can I invoke? The RabbitMQ website tell us how to build and deploy, active a plugin, but not tell us how to write a plugin.

Regard
David


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/45546ea3/attachment.htm>

From emile at rabbitmq.com  Fri Feb  3 10:10:49 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 Feb 2012 10:10:49 +0000
Subject: [rabbitmq-discuss] RabbitMQ communication ports
In-Reply-To: <abb9f62f-006b-4833-8099-bd03a014d8a4@rk3g2000pbb.googlegroups.com>
References: <abb9f62f-006b-4833-8099-bd03a014d8a4@rk3g2000pbb.googlegroups.com>
Message-ID: <4F2BB2A9.2060608@rabbitmq.com>

Hi,

On 03/02/12 05:47, Codevally wrote:
> Other than the 5672 tcp port, what are the other ports RabbitMQ using
> to communicate. We need to identify the ports before implementing the
> firewall. Many thanks.

If you only require (non-SSL) AMQP connections then TCP 5672 is
sufficient. It is typical to run the SSL variant on a different port
(normally 5671). If you use the STOMP adapter or the management console
then you will need ports for those. If you wish to query the broker
across the firewall with the rabbitmqctl tool then you will also need
the ports described here:
http://www.rabbitmq.com/clustering.html#firewall
If you wish to use LDAP authentication then the relevant outgoing port
must be open.

-Emile


From emile at rabbitmq.com  Fri Feb  3 10:30:11 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 Feb 2012 10:30:11 +0000
Subject: [rabbitmq-discuss] Plugin compile problem
In-Reply-To: <D027DE656EBD4F4C8EE57361B5EF438E399156F8@szxeml524-mbs.china.huawei.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E399156F8@szxeml524-mbs.china.huawei.com>
Message-ID: <4F2BB733.60601@rabbitmq.com>

Hi,

On 03/02/12 06:06, Liuzhuofu wrote:
> Hi all:
>     I found a plugin complie problem. 
>     I downloaded a lastest version of rabbitmq-server-2.7.1.tar.gz
> from http://hg.rabbitmq.com/. And I build the RabbitMQ Server first,
> then, I enter the ../plugins-src/rabbitmq-stomp directory, and "make",
> at this time, it makes failed like this:

I suggest running the relevant make target in the top-level plugins-src
directory, instead of in the individual plugin source directories. The
top-level Makefile will build all the plugins, including rabbitmq-stomp.

If you need finer-grained dependency resolution then look at the public
umbrella repository, as indicated in the plugins-src/README file.


-Emile

From emile at rabbitmq.com  Fri Feb  3 10:42:35 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 Feb 2012 10:42:35 +0000
Subject: [rabbitmq-discuss] RabbitMQ memory usage in two node cluster
In-Reply-To: <CAH+_+m7itg0QbkzQQeQQWnT6-ERMH6ZNqsNMuGUSmunWpyoQjg@mail.gmail.com>
References: <CAH+_+m7itg0QbkzQQeQQWnT6-ERMH6ZNqsNMuGUSmunWpyoQjg@mail.gmail.com>
Message-ID: <4F2BBA1B.3070809@rabbitmq.com>

Hi Roshan,

On 03/02/12 00:24, Roshan Pradeep wrote:
> I have 2 node RabbitMQ cluster and one node consume double amount of
> memory than the other. Please check the attached image for more information.
> 
> Could you please help me to identify this. Any help is appreciated.

The difference between 1% and 2% of allowed memory is not a problem and
could easily happen if one broker has marginally more work to do than
the other.

If the difference was much greater then I would be a bit more concerned
and investigate ways of spreading the load more evenly such as making
sure all the queues aren't all declared on one node.


-Emile

From emile at rabbitmq.com  Fri Feb  3 10:52:48 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 Feb 2012 10:52:48 +0000
Subject: [rabbitmq-discuss] Change the password for guest account or
 remove guest account from RabbitMQ
In-Reply-To: <CAH+_+m4X0z5gJvPqM7QCq3ytKKGqKpioDSj0PnPSK4XBF8+cgg@mail.gmail.com>
References: <CAH+_+m4X0z5gJvPqM7QCq3ytKKGqKpioDSj0PnPSK4XBF8+cgg@mail.gmail.com>
Message-ID: <4F2BBC80.6060200@rabbitmq.com>

Hi Roshan,

On 03/02/12 03:08, Roshan Pradeep wrote:
> What are the impacts for changing the password for "guest" user account
> or remove the "guest" account entirely. I can create my own account and
> assign it to vhost currently I am using.

You are free to use any name and password, and we recommend that you use
a stronger password in an environment where you don't control network
access to the broker.

Also look at http://www.rabbitmq.com/authentication.html for alternative
authentication mechanisms.

> Is the guest/guest is use inside RabbitMQ code for any purpose?

No, you are not required to have a user configured with username "guest"
and password "guest".



-Emile

From emile at rabbitmq.com  Fri Feb  3 11:09:50 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 Feb 2012 11:09:50 +0000
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
 Plugin
In-Reply-To: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
Message-ID: <4F2BC07E.8050900@rabbitmq.com>

Hi,

On 03/02/12 09:35, Liuzhuofu wrote:
> 1. What's the behavier of "x-presence" like? direct, fanout or topic?

None of those: the presence exchange is a different kind of exchange
that drops messages that are published to it. Instead it generates
messages when queues bind and unbind.

> 2. One "x-presence" exchange can only get the event that the binding
> changes on this exchanges, other bindings on other exchanges, it can not
> monitor, am I right?

It only produces notifications of binding on the local exchange, not
other exchanges.

> 3. If I want to develop a plugin, how can I known what api interface of
> RabbitMQ Server can I invoke? The RabbitMQ website tell us how to build
> and deploy, active a plugin, but not tell us how to write a plugin.

This page has information to help you get started:
http://www.rabbitmq.com/plugin-development.html



-Emile

From abdullahsaima at yahoo.com  Fri Feb  3 11:19:23 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Fri, 3 Feb 2012 11:19:23 +0000 (GMT)
Subject: [rabbitmq-discuss] help required: bind function
In-Reply-To: <07af12f2-a652-402d-a8ed-3b63d19b72a9@strongmad.batnest.org>
References: <1328184592.31745.YahooMailNeo@web29702.mail.ird.yahoo.com>
	<07af12f2-a652-402d-a8ed-3b63d19b72a9@strongmad.batnest.org>
Message-ID: <1328267963.21593.YahooMailNeo@web29706.mail.ird.yahoo.com>

Hi Jerry,
?
That was quite nice answer, I appreciate. 
Now I am thinking to manage record of table?to represents the binding. Hope it would serve what?I intended to do. 
Actually I am not very good at progamming I find the idea interesting but find difficulty in implemeting. As I am so much confused about this binding. 
?
However Thanks for your support thats he only forum where I hope to get something.
?
Best Regards,?
Saima

________________________________
From: Jerry Kuch <jerryk at vmware.com>
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: Emile Joubert <emile at rabbitmq.com>; rabbitmq-discuss at lists.rabbitmq.com 
Sent: Thursday, 2 February 2012, 16:53
Subject: Re: [rabbitmq-discuss] help required: bind function

Hi, Saima.

If you're trying to to implement some aspect of the actual AMQP
message transport, for learning purposes, you might consider following
RabbitMQ's structure.

In Rabbit, a binding of an exchange to a queue is essentially a record
in a table somewhere saying this exchange is bound to this queue, with
this associated routing key.

The actual work of getting a message published to that exchange into
an appropriate bound queue, is actually done by the process associated
with the communications channel used by the message's sender.? Essentially
it looks up the particulars of the exchange, determines what routing logic
is appropriate to use for that exchange type, looks at the message's routing
key if appropriate, and tries to match it to a binding.? If match(es) are
found, the message is forwarded to a process representing the queue, which is
responsible for its contents.? Almost symmetrically on the consumer side, 
a consumer's channel talks to the queue it's consuming from to ask it to 
disgorge its messages.

Apologies if this isn't quite what you're asking... I confess I may not fully 
grasp the ultimate intent of your investigations...

Best regards,
Jerry

----- Original Message -----
From: "Saima Asif" <abdullahsaima at yahoo.com>
To: "Emile Joubert" <emile at rabbitmq.com>, rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, February 2, 2012 4:09:52 AM
Subject: Re: [rabbitmq-discuss] help required: bind function




Thank you very much Emile and Aamir for your kind replies. 

Infact I know the basic concept of binding, if a queue is bounded to exchange then that queue wants to receive the message from that particular exchange. But I am so sorry I dont know how to interpret this relationship into programming langauge i.e. C++. How can I specify the queue that now this queue will recieve messages from this exch ange. I have consulted all the material, But the problem is writing and interpreting. I am so sorry I think it would be a big ask. 

Any help would be highly appreiated. 


Saima 



From: Emile Joubert <emile at rabbitmq.com> 
To: rabbitmq-discuss at lists.rabbitmq.com; abdullahsaima at yahoo.com 
Sent: Thursday, 2 February 2012, 9:51 
Subject: Re: [rabbitmq-discuss] help required: bind function 

Hi Saima, 

On 31/01/12 22:23, Saima Asif wrote: 
> I am student , and my supervisor and I have chosen to implement and 
> study it at very simpler level. my classes are not refined. There is one 
> class "message" which has a routing key. 
> I need your help how can I write Bind() function for this. 

Keep in mind that binding is an operation on a queue, not a message. See 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.queue for queue 
operations. 

Have you taken a look at the tutorials at 
http://www.rabbitmq.com/getstarted.html ? 
They introduce AMQP concepts (including binding) in a way that should be 
of help. Unfortunately no C or C++ translation exists, but if you feel 
brave you could contribute this. 

-Emile 



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/b191a6ac/attachment.htm>

From emile at rabbitmq.com  Fri Feb  3 12:10:34 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 Feb 2012 12:10:34 +0000
Subject: [rabbitmq-discuss] Binding to multiple queues in a round-robin
 style using the PIKA library
In-Reply-To: <e299d891-da35-468d-9270-89c66212290b@eb6g2000vbb.googlegroups.com>
References: <e299d891-da35-468d-9270-89c66212290b@eb6g2000vbb.googlegroups.com>
Message-ID: <4F2BCEBA.5000601@rabbitmq.com>

Hi Stephen,

On 02/02/12 16:36, Stephen Young wrote:
> I'm working on a system that receives a variety of different message
> types from different source queues, like the following:
> 
> client binds to Q1, Q2, Q3
> server posts to Q2
> client reads request and updates database. If something goes awry, the
> client sends a basic_reject to requeue the request
> 
> however, this seems to cause some problems in that the client will see
> a message in Q2, but need to have parsed a message in another queue
> first. However the clients seem to keep polling the same queue until
> success. Is there any better way to implement this system? Currently
> I'm defeating the deadlock by having enough clients + some dedicated
> clients on the bottleneck queues, but would prefer if each client
> could run autonomously and read from queues in a pattern / priority of
> some sort.

I'm reading your question as: How can I organise a workload with
multiple clients where some messages have dependencies on each other?

If possible publish all the information required to complete a task as a
single message.

Priorities can be emulated by using different queues, and consuming from
the queues designated as higher priority more often.

It's hard to give any further advice without more information about how
messages are intended to match up and how the parsing dependency works.
Perhaps you could offer more details.


-Emile

From tonygarnockjones+rabbitmq at gmail.com  Fri Feb  3 13:12:14 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Fri, 3 Feb 2012 08:12:14 -0500
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
	Plugin
In-Reply-To: <4F2BC07E.8050900@rabbitmq.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
Message-ID: <CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>

On 3 February 2012 06:09, Emile Joubert <emile at rabbitmq.com> wrote:

> On 03/02/12 09:35, Liuzhuofu wrote:
> > 1. What's the behavier of "x-presence" like? direct, fanout or topic?
> None of those: the presence exchange is a different kind of exchange
> that drops messages that are published to it. Instead it generates
> messages when queues bind and unbind.
>

There's also more detailed discussion of this in the README,
https://github.com/tonyg/presence-exchange#readme.


> > 2. One "x-presence" exchange can only get the event that the binding
> > changes on this exchanges, other bindings on other exchanges, it can not
> > monitor, am I right?
> It only produces notifications of binding on the local exchange, not
> other exchanges.
>

For the avoidance of doubt, this should get you to where you need to be:
clients, when they connect, should bind a temporary (autodelete) queue to a
distinguished presence exchange for your application. If they crash, suffer
heartbeat failure, or otherwise disconnect, the temporary queue will be
deleted, and as a consequence the binding to the presence exchange will be
removed, the fact of which will then be broadcast to the presence listeners
attached to that exchange.

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/2e246b36/attachment.htm>

From dan at canddi.com  Fri Feb  3 14:12:14 2012
From: dan at canddi.com (Dan Dart)
Date: Fri, 3 Feb 2012 14:12:14 +0000
Subject: [rabbitmq-discuss] Turning off connection logging
Message-ID: <CAECZ8516nL7yFgam7KDD=9s-GsJ9vzie8d3Q076a5CCgsdoz-Q@mail.gmail.com>

Hi all,

Is there an option to just turn off the logging of connections like:

=INFO REPORT==== 3-Feb-2012::14:09:59 ===
accepted TCP connection on [::]:5672 from 1.2.3.4:59642

=INFO REPORT==== 3-Feb-2012::14:09:59 ===
starting TCP connection <0.20803.4> from 1.2.3.4:59642

=INFO REPORT==== 3-Feb-2012::14:09:59 ===
closing TCP connection <0.20803.4> from 1.2.3.4:59642

I still want the rest - just not these.

Cheers
Dan

From p_jean at ateliers-numeriques.net  Fri Feb  3 14:44:41 2012
From: p_jean at ateliers-numeriques.net (Philippe Jean)
Date: Fri, 03 Feb 2012 09:44:41 -0500
Subject: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG
	files....
Message-ID: <4F2BF2D9.4000503@ateliers-numeriques.net>

hi,

I'm considering to use rabbitMQ in a commercial application.  I would need
to run it both on the client and on some remote server.

can I avoid to install the full fledged
(110MB) erlang on the client machine? what is the minimal set of files from
erlang required by rabbitMQ and how can I configure my install to use them?
  I tried to copy the bin directory from the erlang build and modified the
rabbitmq-server script to use the erl in that bin directory but I get the
following error:

> ERROR: generation of boot script file
> ../mnesia/rabbit at WQP12453-2-plugins-expand/rabbit.script failed:
> {'EXIT',{{badmatch,{erl_prim_loader,error}},
>          [{xref_utils,find_beam,1,[{file,"xref_utils.erl"},{line,458}]},
>           {xref_base,'-make_libs/5-fun-0-',2,
>                      [{file,"xref_base.erl"},{line,1441}]},
>           {lists,foldl,3,[{file,"lists.erl"},{line,1197}]},
>           {xref_base,make_libs,5,[{file,"xref_base.erl"},{line,1446}]},
>           {xref_base,do_set_up,1,[{file,"xref_base.erl"},{line,1304}]},
>           {xref_base,do_set_up,2,[{file,"xref_base.erl"},{line,1160}]},
>           {xref_base,q,3,[{file,"xref_base.erl"},{line,283}]},
>           {xref,handle_call,3,[{file,"xref.erl"},{line,494}]}]}}
should I copy more files? libs? I'm not familiar with erlang or the erlang
tools...

philippe


From Massimo.Paladin at cern.ch  Fri Feb  3 15:03:09 2012
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Fri, 3 Feb 2012 16:03:09 +0100
Subject: [rabbitmq-discuss] web interface on two ports and different
	settings: ssl and non ssl
Message-ID: <CAMOXM2_GFf+4o3-_1UmXPdogPcYao6NmuxE2-QHM7k4hJYbTzQ@mail.gmail.com>

Hello,

I am trying to configure rabbitmq web interface on two ports and with
different settings:
- one port without ssl
- one port with ssl and ssl_opts

Is this possible? I tried some configurations with no results, it listens
only at one port.

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/929a8e51/attachment.htm>

From stephen.t.young at gmail.com  Fri Feb  3 15:49:59 2012
From: stephen.t.young at gmail.com (Stephen Young)
Date: Fri, 3 Feb 2012 07:49:59 -0800 (PST)
Subject: [rabbitmq-discuss] Binding to multiple queues in a round-robin
	style using the PIKA library
In-Reply-To: <4F2BCEBA.5000601@rabbitmq.com>
References: <e299d891-da35-468d-9270-89c66212290b@eb6g2000vbb.googlegroups.com>
	<4F2BCEBA.5000601@rabbitmq.com>
Message-ID: <fe044deb-e0b6-4650-a132-c35ab5212927@db5g2000vbb.googlegroups.com>

Hey Emile,

The approach is currently set up like the following:

Q1...Qn are the queues I have created
Each consumer binds to all queues, and has the capability of parsing
and using data from each queue.

A request is pushed through a broker and generates a set of queue
entries, E1...En
Ej must be processed for Ej+1...En to be processed, the rest are
independent of the result of Ej.
Bundling requests together causes the system to be significantly
slower, as it doesn't capitalize on the heavy parallelism of running
E1..Ej simultaneously, and once Ej is processed, Ej+1...En
simultaneously.

As long as there are dedicated consumers monitoring Ej only, there is
no deadlock as the Ej entries are parsed faster
However, this tends to be a waste of resources, as Ej is not a
particularly heavy process, so those consumers are idle for most of
the time.

When I don't have these consumers, or have a single consumer managing
the whole system, what seems to be happening is that the consumer will
stop on one of the queues Qj+m, and read a request, determine that it
cant complete, send basic_reject, and then read again from the same
queue. This is not problematic all the time, but occasionally
generates a loop on that queue by the consumer. What i'd like to do is
have the consumer act like:

read queue Qi
determine blockage, send basic_reject
read queue Qk
process, send basic_ack

Instead it seems to get stuck in a loop reading Qi.

Let me know if you need any more clarification!


On Feb 3, 7:10?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Stephen,
>
> On 02/02/12 16:36, Stephen Young wrote:
>
>
>
>
>
>
>
>
>
> > I'm working on a system that receives a variety of different message
> > types from different source queues, like the following:
>
> > client binds to Q1, Q2, Q3
> > server posts to Q2
> > client reads request and updates database. If something goes awry, the
> > client sends a basic_reject to requeue the request
>
> > however, this seems to cause some problems in that the client will see
> > a message in Q2, but need to have parsed a message in another queue
> > first. However the clients seem to keep polling the same queue until
> > success. Is there any better way to implement this system? Currently
> > I'm defeating the deadlock by having enough clients + some dedicated
> > clients on the bottleneck queues, but would prefer if each client
> > could run autonomously and read from queues in a pattern / priority of
> > some sort.
>
> I'm reading your question as: How can I organise a workload with
> multiple clients where some messages have dependencies on each other?
>
> If possible publish all the information required to complete a task as a
> single message.
>
> Priorities can be emulated by using different queues, and consuming from
> the queues designated as higher priority more often.
>
> It's hard to give any further advice without more information about how
> messages are intended to match up and how the parsing dependency works.
> Perhaps you could offer more details.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From colin.anderson333 at gmail.com  Fri Feb  3 15:50:46 2012
From: colin.anderson333 at gmail.com (cocowalla)
Date: Fri, 3 Feb 2012 07:50:46 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG
 files....
In-Reply-To: <4F2BF2D9.4000503@ateliers-numeriques.net>
References: <4F2BF2D9.4000503@ateliers-numeriques.net>
Message-ID: <3387464.1983.1328284246948.JavaMail.geo-discussion-forums@yqlw12>

I'm considering using it as part of a commercial solution too, and would be 
most interested in some kind of minimal installation package.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/f5a98f3a/attachment.htm>

From jerryk at vmware.com  Fri Feb  3 16:13:32 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 3 Feb 2012 08:13:32 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ communication ports
In-Reply-To: <4F2BB2A9.2060608@rabbitmq.com>
Message-ID: <d87967f3-8547-4102-b9c3-2f9f48593f58@strongmad.batnest.org>

And, although it might have been mentioned earlier in the thread and I
missed it, the Erlang port mapper daemon's port should be open so that
cluster nodes can communicate with one another and rabbitmqctl and
anything based on Erlang distribution can work.

EPMD listens on port 4369 by default.

----- Original Message -----
From: "Emile Joubert" <emile at rabbitmq.com>
To: "Codevally" <codevally at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, February 3, 2012 2:10:49 AM
Subject: Re: [rabbitmq-discuss] RabbitMQ communication ports

Hi,

On 03/02/12 05:47, Codevally wrote:
> Other than the 5672 tcp port, what are the other ports RabbitMQ using
> to communicate. We need to identify the ports before implementing the
> firewall. Many thanks.

If you only require (non-SSL) AMQP connections then TCP 5672 is
sufficient. It is typical to run the SSL variant on a different port
(normally 5671). If you use the STOMP adapter or the management console
then you will need ports for those. If you wish to query the broker
across the firewall with the rabbitmqctl tool then you will also need
the ports described here:
http://www.rabbitmq.com/clustering.html#firewall
If you wish to use LDAP authentication then the relevant outgoing port
must be open.

-Emile

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Fri Feb  3 16:29:18 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 Feb 2012 16:29:18 +0000
Subject: [rabbitmq-discuss] Binding to multiple queues in a round-robin
 style using the PIKA library
In-Reply-To: <fe044deb-e0b6-4650-a132-c35ab5212927@db5g2000vbb.googlegroups.com>
References: <e299d891-da35-468d-9270-89c66212290b@eb6g2000vbb.googlegroups.com>
	<4F2BCEBA.5000601@rabbitmq.com>
	<fe044deb-e0b6-4650-a132-c35ab5212927@db5g2000vbb.googlegroups.com>
Message-ID: <4F2C0B5E.5040108@rabbitmq.com>

Hi Stephen,

On 03/02/12 15:49, Stephen Young wrote:
> Q1...Qn are the queues I have created
> Each consumer binds to all queues, and has the capability of parsing
> and using data from each queue.
> 
> A request is pushed through a broker and generates a set of queue
> entries, E1...En
> Ej must be processed for Ej+1...En to be processed, the rest are
> independent of the result of Ej.
> Bundling requests together causes the system to be significantly
> slower, as it doesn't capitalize on the heavy parallelism of running
> E1..Ej simultaneously, and once Ej is processed, Ej+1...En
> simultaneously.

This is just a suggestion and might not be possible, but why not treat
Ej completely separately from other entries on the publishing side?
Process Ej perhaps using an RPC call and include the result in all
messages Ej+1..En. Or make the result of Ej available to consumers in
some other way if it is large. You should obtain good parallelism that way.

> When I don't have these consumers, or have a single consumer managing
> the whole system, what seems to be happening is that the consumer will
> stop on one of the queues Qj+m, and read a request, determine that it
> cant complete, send basic_reject, and then read again from the same
> queue. This is not problematic all the time, but occasionally
> generates a loop on that queue by the consumer. What i'd like to do is
> have the consumer act like:
> 
> read queue Qi
> determine blockage, send basic_reject
> read queue Qk
> process, send basic_ack

I'm not familiar with Pika, but can you unsubscribe from Qi before the
basic_reject?


-Emile

From fearsome.lucidity at gmail.com  Fri Feb  3 16:30:38 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Fri, 3 Feb 2012 11:30:38 -0500
Subject: [rabbitmq-discuss] Shovel config example with declare.queue with a
	x-ha-policy argument?
Message-ID: <CAFDmHdNB=zFYWM+xxLhz3SG90ff4Yki2mOT=V=ZPdUnNNWxvhg@mail.gmail.com>

Does anyone have an example of a declare.queue statement in a Shovel config
that passes arguments, like x-ha-policy?

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/35967e3a/attachment.htm>

From emile at rabbitmq.com  Fri Feb  3 16:34:57 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 Feb 2012 16:34:57 +0000
Subject: [rabbitmq-discuss] Turning off connection logging
In-Reply-To: <CAECZ8516nL7yFgam7KDD=9s-GsJ9vzie8d3Q076a5CCgsdoz-Q@mail.gmail.com>
References: <CAECZ8516nL7yFgam7KDD=9s-GsJ9vzie8d3Q076a5CCgsdoz-Q@mail.gmail.com>
Message-ID: <4F2C0CB1.8060308@rabbitmq.com>

Hi Dan,

On 03/02/12 14:12, Dan Dart wrote:
> Is there an option to just turn off the logging of connections like:

The next version of RabbitMQ will allow you to do this. Unfortunately
this is not possible with versions 2.7.1 and below.


-Emile

From michael.justin at gmx.net  Fri Feb  3 16:52:28 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Fri, 03 Feb 2012 17:52:28 +0100
Subject: [rabbitmq-discuss] STOMP and persistent messages to a queue
	destination
In-Reply-To: <118c54c3-9e1d-4924-b07c-528502c18a0a@strongmad.batnest.org>
References: <jge83i$3e6$1@dough.gmane.org>
	<118c54c3-9e1d-4924-b07c-528502c18a0a@strongmad.batnest.org>
Message-ID: <jgh3ce$4mn$1@dough.gmane.org>

Am 02.02.2012 18:22, Jerry Kuch wrote:

> Are you asking for receipts when you publish?

Hi Jerry,
This was the missing piece - now it works fine, many thanks for your 
detailed help!

Regards
-- 
Michael Justin


From jcoismain at yahoo.com  Fri Feb  3 17:11:13 2012
From: jcoismain at yahoo.com (Jeff C)
Date: Fri, 3 Feb 2012 09:11:13 -0800 (PST)
Subject: [rabbitmq-discuss] questions about rabbitmq
Message-ID: <1328289073.93984.YahooMailNeo@web111704.mail.gq1.yahoo.com>

Hello all,

I recently began reading up on rabbitmq and the amqp paradigm, via rabbitmq's site documentation and miscellaneous tutorials around the web, as I plan to use rabbit as the core for a real-time forum component that will be part of a site I am working on, where new posts will be forwarded out to client machines from a long-polling/websocket server sitting between the users and rabbitmq.(I'm new to message passing systems) I've been reading some posts and even a talk from Alexis Richardson, and I decided to join the mailing list to ask some specific questions; I have three:


1. I've read that basic_consume is the most efficient way to receive messages from rabbitmq. Is it possible for one consumer (my websock/lp server) to register to multiple queues(conceivably several thousand) and have messages continually sent to it?

2. Also, what routing topology/architecture would you recommend for this use case? I was thinking about either one queue per user or, one queue per topic (which would only be created once someone actually visits said topic) where users reading the same topic would be subscribed to the same queue. Either way, all these queues would be forwarding messages to the websocket/comet server which would then push them out to clients. There would also be a work queue, pushing out tasks for crud operations in the database to worker machines.


3. I'm planning on using a non-blocking server (NIO, or maybe twisted) for pushing the messages, however, I'm not sure how I should go about the writes once a message is sent from rabbitmq. Iterating throught the set of ready connections to find the connection to send it through doesn't sound like the best way, and what if the connection is busy and isn't in the ready set of connections? What should be done with the message? 


Again I'm new to working with message passing systems as stated above, and a bit of help here would be much appreciated. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/44bac04b/attachment.htm>

From jerryk at vmware.com  Fri Feb  3 18:35:34 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 3 Feb 2012 10:35:34 -0800 (PST)
Subject: [rabbitmq-discuss] STOMP and persistent messages to a
	queue	destination
In-Reply-To: <jgh3ce$4mn$1@dough.gmane.org>
Message-ID: <fd5f34e0-ffb5-4735-9373-90e1dbb0ba4d@strongmad.batnest.org>

Hi, Michael:

No problem!  Happy to help, and again, my apologies for initially
reading your message in such a cursory answer that I gave you a
crummy first answer...

Best regards,
Jerry

----- Original Message -----
From: "Michael Justin" <michael.justin at gmx.net>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, February 3, 2012 8:52:28 AM
Subject: Re: [rabbitmq-discuss] STOMP and persistent messages to a queue	destination

Am 02.02.2012 18:22, Jerry Kuch wrote:

> Are you asking for receipts when you publish?

Hi Jerry,
This was the missing piece - now it works fine, many thanks for your 
detailed help!

Regards
-- 
Michael Justin

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Fri Feb  3 18:45:39 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 3 Feb 2012 10:45:39 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG
	files....
In-Reply-To: <3387464.1983.1328284246948.JavaMail.geo-discussion-forums@yqlw12>
Message-ID: <4943deb1-f290-43e0-95f8-b34837b565f4@strongmad.batnest.org>

Hi, guys...

I'd be fairly careful about trying to pare down the Erlang/OTP
distribution very much...  it's easy to lose things that are
critical, and not all of them are going to manifest "nicely"
as a VM/BEAM start time failure, waiting instead until later
before they go off the rails...

What sort of constraints does your environment pose to motivate
the paring down?  It sounds pretty demanding...

Best regards,
Jerry

----- Original Message -----
From: "cocowalla" <colin.anderson333 at gmail.com>
To: rabbitmq-discuss at googlegroups.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, February 3, 2012 7:50:46 AM
Subject: Re: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG files....


I'm considering using it as part of a commercial solution too, and would be most interested in some kind of minimal installation package. 

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tonygarnockjones+rabbitmq at gmail.com  Fri Feb  3 18:48:59 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Fri, 3 Feb 2012 13:48:59 -0500
Subject: [rabbitmq-discuss] Presence Exchange Related Question
In-Reply-To: <CADCLBRhhP9Jwwb5z0npPq0uSExmUswM4c8bNSP=GNobkRSgBTQ@mail.gmail.com>
References: <CADCLBRhhP9Jwwb5z0npPq0uSExmUswM4c8bNSP=GNobkRSgBTQ@mail.gmail.com>
Message-ID: <CAM8fPiRDA_66s-gRDWKPxg7gmWNxbHSUD5d73VLPxGi8pFkb-w@mail.gmail.com>

On 3 February 2012 10:25, Randall Richard <randall at trellisapp.com> wrote:

> Hello Tony, in addition to being notified of binds and unbinds, is there
> something equivalent in RabbitMQ that can notify about broker wide activity
> such as a connection close?


Sort of, indirectly: there's an exchange called amq.rabbitmq.log that
receives all events that go out to Erlang's SASL logging system. You can
bind to that to receive all the info, warning, error messages etc. You'll
likely then have to do crude text parsing to recover some structure from
each log message, but it ought to be straightforward to get connection
opens and closes.

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/771bce60/attachment.htm>

From mpietrek at skytap.com  Fri Feb  3 18:57:10 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 03 Feb 2012 10:57:10 -0800
Subject: [rabbitmq-discuss] Strange message loss behavior with mirrored
	queues
Message-ID: <CB516E06.2B8AB%mpietrek@skytap.com>

I'm writing some basic throughput tests to verify that RabbitMQ will scale
to our needs in HA environments. In one scenario I'm finding substantial
message loss. It may be Pika clientlib behavior, but even if so, it's very
odd what I'm seeing.

My environment:
* Ubuntu 10.04 with RabbitMQ 2.71.
* Broker instances are all disk nodes.
* Queues are declared as durable and x-ha-policy:all
* Clients are written in Python using Pika 0.9.5.
* For this test, no transactions or publisher-confirms are used.
The test code is extremely simple. It simply reads or writes messages (up to
100,000) as quickly as it can, and shows the throughput rate at 1000 message
intervals.

If I run my "write" test against a single broker instance, I rapidly write
all the messages and after the app exits, I see 100,000 messages in the
queue, as expected.

However, if I add two more brokers to the cluster (such that the queue is
now mirrored), the identical write test yields only ~25K messages in the
queue. (They are the first 25K messages written, FWIW.)

My app calls channel.disconnect() after doing all the writes, so I'd expect
that it would flush its internal buffers before exiting.

I can supply my entire app (about 150 lines of Python) if desired, but for
now, here are the relevant pieces:

def do_write(clientlib):
    for i in range(100000):
        clientlib.write_message(QUEUENAME, "abc_%s" % (i))
    clientlib.disconnect()


class Clientlib(object):
    def connect(self, hostname, use_transactions):
        self.connection = pika.BlockingConnection(
            pika.ConnectionParameters(host=hostname, port=5672))
        self.channel = self.connection.channel()
        self.use_transactions = use_transactions  # This is False for this
test

    def write_message(self, queue_name, json_string):
        self.channel.basic_publish(exchange='',
            routing_key=queue_name,
            body=json_string,
            properties=pika.BasicProperties(delivery_mode=2))

    def disconnect(self):
        self.connection.close()





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/6fc368d8/attachment.htm>

From p_jean at ateliers-numeriques.net  Fri Feb  3 19:08:44 2012
From: p_jean at ateliers-numeriques.net (Philippe Jean)
Date: Fri, 03 Feb 2012 14:08:44 -0500
Subject: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG
 files....
In-Reply-To: <4943deb1-f290-43e0-95f8-b34837b565f4@strongmad.batnest.org>
References: <4943deb1-f290-43e0-95f8-b34837b565f4@strongmad.batnest.org>
Message-ID: <4F2C30BC.2060907@ateliers-numeriques.net>

on my part, 2 things are required:

- being able to have a self containing directory where all the required 
files for rabbit mq resides without having to install stuff elswere on 
the machine (/usr/local/lib or other)
- have a reasonable size for the redist. files.  less than 20MB would be 
good

philippe

On 12-02-03 1:45 PM, Jerry Kuch wrote:
> Hi, guys...
>
> I'd be fairly careful about trying to pare down the Erlang/OTP
> distribution very much...  it's easy to lose things that are
> critical, and not all of them are going to manifest "nicely"
> as a VM/BEAM start time failure, waiting instead until later
> before they go off the rails...
>
> What sort of constraints does your environment pose to motivate
> the paring down?  It sounds pretty demanding...
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "cocowalla"<colin.anderson333 at gmail.com>
> To: rabbitmq-discuss at googlegroups.com
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Friday, February 3, 2012 7:50:46 AM
> Subject: Re: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG files....
>
>
> I'm considering using it as part of a commercial solution too, and would be most interested in some kind of minimal installation package.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
-----------------------------------------------------------------------------
Philippe Jean

Les Ateliers Num?riques inc.
57 Chemin de la Vieille ?glise
Lotbini?re, Qc, Canada, G0S 1S0
tel: 514.276.7130 - atelier: 418.796.3069
email: p_jean at ateliers-numeriques.net
http://www.ateliers-numeriques.net


-----------------------------------------------------------------------------
This email and any attachments are confidential and may be privileged
or otherwise protected from disclosure. If you are not the intended
recipient you must not copy this message or any attachment or disclose
the contents to any other person. If you have received this message in
error please contact us at the phone number above or by email at
info at ateliers-numeriques.net
-----------------------------------------------------------------------------
Le contenu du pr?sent courriel est confidentiel et peut ?tre
privil?gi? ou soumis ? des droits d'auteur. Si vous n'?tes pas le
destinataire anticip?, toute copie de ce message ou de tout document
qui peut y ?tre attach? est interdit, de m?me que la divulgation ?
quiconque du contenu de ce message.
Si vous avez re?u ce message par erreur, nous vous prions de  nous
contacter au t?l?phone ci-haut, ou par courriel ? info at ateliers-numeriques.net
-----------------------------------------------------------------------------


From stephen.t.young at gmail.com  Fri Feb  3 19:14:06 2012
From: stephen.t.young at gmail.com (Stephen Young)
Date: Fri, 3 Feb 2012 11:14:06 -0800 (PST)
Subject: [rabbitmq-discuss] Binding to multiple queues in a round-robin
	style using the PIKA library
In-Reply-To: <4F2C0B5E.5040108@rabbitmq.com>
References: <e299d891-da35-468d-9270-89c66212290b@eb6g2000vbb.googlegroups.com>
	<4F2BCEBA.5000601@rabbitmq.com>
	<fe044deb-e0b6-4650-a132-c35ab5212927@db5g2000vbb.googlegroups.com>
	<4F2C0B5E.5040108@rabbitmq.com>
Message-ID: <ab35c680-7727-4a8a-bf68-a1674e2d06b0@db5g2000vbb.googlegroups.com>

Hey Emile,

I've updated to disconnect and reconnect from queues when encountering
deadlock, that has solved the problem. Thanks a lot for your help!

Cheers,
Stephen

On Feb 3, 11:29?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Stephen,
>
> On 03/02/12 15:49, Stephen Young wrote:
>
> > Q1...Qn are the queues I have created
> > Each consumer binds to all queues, and has the capability of parsing
> > and using data from each queue.
>
> > A request is pushed through a broker and generates a set of queue
> > entries, E1...En
> > Ej must be processed for Ej+1...En to be processed, the rest are
> > independent of the result of Ej.
> > Bundling requests together causes the system to be significantly
> > slower, as it doesn't capitalize on the heavy parallelism of running
> > E1..Ej simultaneously, and once Ej is processed, Ej+1...En
> > simultaneously.
>
> This is just a suggestion and might not be possible, but why not treat
> Ej completely separately from other entries on the publishing side?
> Process Ej perhaps using an RPC call and include the result in all
> messages Ej+1..En. Or make the result of Ej available to consumers in
> some other way if it is large. You should obtain good parallelism that way.
>
> > When I don't have these consumers, or have a single consumer managing
> > the whole system, what seems to be happening is that the consumer will
> > stop on one of the queues Qj+m, and read a request, determine that it
> > cant complete, send basic_reject, and then read again from the same
> > queue. This is not problematic all the time, but occasionally
> > generates a loop on that queue by the consumer. What i'd like to do is
> > have the consumer act like:
>
> > read queue Qi
> > determine blockage, send basic_reject
> > read queue Qk
> > process, send basic_ack
>
> I'm not familiar with Pika, but can you unsubscribe from Qi before the
> basic_reject?
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From navid at navid.ca  Fri Feb  3 19:21:14 2012
From: navid at navid.ca (Navid Mohaghegh)
Date: Fri, 3 Feb 2012 14:21:14 -0500
Subject: [rabbitmq-discuss] RabbitMQ sizing
Message-ID: <580C6A9F-1C0A-469C-A904-3FABD03A14CC@navid.ca>

Hello, 

I trying to size a solution that has concurrency of 10,000 subscriber and they all may concurrently receive messages of size up to 5KB.

The server has two processors and total of 8 cores running at 2.1 GHz (AMD). Memory size is 16 GB. 

Is this configuration possible? is there any guides in terms of a sizing of RarbbitMQ  solution?

Thanks,
Navid

From jerryk at vmware.com  Fri Feb  3 19:37:00 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 3 Feb 2012 11:37:00 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG
	files....
In-Reply-To: <4F2C30BC.2060907@ateliers-numeriques.net>
Message-ID: <61eea259-e65b-41e0-9672-502a571729e3@strongmad.batnest.org>

A quick hack you might try:

If you are willing to build Erlang/OTP from source (it's not too daunting
on most Linuxes), you could likely get away with doing a 'make install' of 
it to some common place near where you want your Rabbit to live.  You might
then imagine tarballing the whole enchilada up and using that as your redist
unit.

That won't get the disk space down to where you want it to be, probably, but
at least you'll get the self containment you're after...

Just a thought.

Best regards,
Jerry

----- Original Message -----
From: "Philippe Jean" <p_jean at ateliers-numeriques.net>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, February 3, 2012 11:08:44 AM
Subject: Re: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG files....

on my part, 2 things are required:

- being able to have a self containing directory where all the required
files for rabbit mq resides without having to install stuff elswere on
the machine (/usr/local/lib or other)
- have a reasonable size for the redist. files.  less than 20MB would be
good

philippe

On 12-02-03 1:45 PM, Jerry Kuch wrote:
> Hi, guys...
>
> I'd be fairly careful about trying to pare down the Erlang/OTP
> distribution very much...  it's easy to lose things that are
> critical, and not all of them are going to manifest "nicely"
> as a VM/BEAM start time failure, waiting instead until later
> before they go off the rails...
>
> What sort of constraints does your environment pose to motivate
> the paring down?  It sounds pretty demanding...
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "cocowalla"<colin.anderson333 at gmail.com>
> To: rabbitmq-discuss at googlegroups.com
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Friday, February 3, 2012 7:50:46 AM
> Subject: Re: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG files....
>
>
> I'm considering using it as part of a commercial solution too, and would be most interested in some kind of minimal installation package.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
-----------------------------------------------------------------------------
Philippe Jean

Les Ateliers Num?riques inc.
57 Chemin de la Vieille ?glise
Lotbini?re, Qc, Canada, G0S 1S0
tel: 514.276.7130 - atelier: 418.796.3069
email: p_jean at ateliers-numeriques.net
http://www.ateliers-numeriques.net


-----------------------------------------------------------------------------
This email and any attachments are confidential and may be privileged
or otherwise protected from disclosure. If you are not the intended
recipient you must not copy this message or any attachment or disclose
the contents to any other person. If you have received this message in
error please contact us at the phone number above or by email at
info at ateliers-numeriques.net
-----------------------------------------------------------------------------
Le contenu du pr?sent courriel est confidentiel et peut ?tre
privil?gi? ou soumis ? des droits d'auteur. Si vous n'?tes pas le
destinataire anticip?, toute copie de ce message ou de tout document
qui peut y ?tre attach? est interdit, de m?me que la divulgation ?
quiconque du contenu de ce message.
Si vous avez re?u ce message par erreur, nous vous prions de  nous
contacter au t?l?phone ci-haut, ou par courriel ? info at ateliers-numeriques.net
-----------------------------------------------------------------------------

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Fri Feb  3 19:42:05 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 3 Feb 2012 11:42:05 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ sizing
In-Reply-To: <580C6A9F-1C0A-469C-A904-3FABD03A14CC@navid.ca>
Message-ID: <e636e322-b704-47e0-b4fd-67db0c8c4353@strongmad.batnest.org>

Hi, Navid:

We don't have a comprehensive sizing guide, but we recognize such a thing
would be useful and may take steps in that direction eventually.

Your machine sounds reasonably beefy, and your message sizes modest.  The
thing that will likely most affect sizing in this case is whether your
consumers do a good job of keeping up at the messages flow being pushed
through.  Also, the nature of the message flow also has an impact.  For 
example if a given message is routed to multiple consumers' queues, as it 
would be through a fanout exchange or under some conditions a topic exchange, 
the message itself is only stored once on the Rabbit server.

As a first step I'd suggest you experiment with load comparable to what you're
expecting, with a messaging/routing framework like or nearly like that of your
planned application.  Give that a shot, and then come on back and we can discuss
tuning and optimization as needed...

Best regards,
Jerry

----- Original Message -----
From: "Navid Mohaghegh" <navid at navid.ca>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, February 3, 2012 11:21:14 AM
Subject: [rabbitmq-discuss] RabbitMQ sizing

Hello, 

I trying to size a solution that has concurrency of 10,000 subscriber and they all may concurrently receive messages of size up to 5KB.

The server has two processors and total of 8 cores running at 2.1 GHz (AMD). Memory size is 16 GB. 

Is this configuration possible? is there any guides in terms of a sizing of RarbbitMQ  solution?

Thanks,
Navid
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From sunil at armor5.com  Fri Feb  3 20:01:57 2012
From: sunil at armor5.com (Sunil Agrawal)
Date: Fri, 3 Feb 2012 12:01:57 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ, STOMP and redeliver flag
Message-ID: <1d7b8898-a6eb-450d-8a95-0ca7d61d50e4@x6g2000pbk.googlegroups.com>

Hi,
I just started using STOMP protocol for communicating with RabbitMQ.
Everything works well. However wondering if RabbitMQ tells STOMP
clients if a message is redelivered. Didn't see any information. If
this is not supported, any plans of supporting it in near future?

Thanks in advance,
Sunil

From p_jean at ateliers-numeriques.net  Fri Feb  3 20:28:53 2012
From: p_jean at ateliers-numeriques.net (Philippe Jean)
Date: Fri, 03 Feb 2012 15:28:53 -0500
Subject: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG
 files....
In-Reply-To: <61eea259-e65b-41e0-9672-502a571729e3@strongmad.batnest.org>
References: <61eea259-e65b-41e0-9672-502a571729e3@strongmad.batnest.org>
Message-ID: <4F2C4385.9020909@ateliers-numeriques.net>

hello jerry,

I did recompile Erlang/OTP without too much pain.  what should I keep as 
redistributable?  would the /bootstrap be enough for rabbitMQ or do I 
need /bin and the complete /lib (seems to contain a lot of stuff, among 
which source and intermediate files....)

philippe

On 12-02-03 2:37 PM, Jerry Kuch wrote:
> A quick hack you might try:
>
> If you are willing to build Erlang/OTP from source (it's not too daunting
> on most Linuxes), you could likely get away with doing a 'make install' of
> it to some common place near where you want your Rabbit to live.  You might
> then imagine tarballing the whole enchilada up and using that as your redist
> unit.
>
> That won't get the disk space down to where you want it to be, probably, but
> at least you'll get the self containment you're after...
>
> Just a thought.
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "Philippe Jean"<p_jean at ateliers-numeriques.net>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Friday, February 3, 2012 11:08:44 AM
> Subject: Re: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG files....
>
> on my part, 2 things are required:
>
> - being able to have a self containing directory where all the required
> files for rabbit mq resides without having to install stuff elswere on
> the machine (/usr/local/lib or other)
> - have a reasonable size for the redist. files.  less than 20MB would be
> good
>
> philippe
>
> On 12-02-03 1:45 PM, Jerry Kuch wrote:
>> Hi, guys...
>>
>> I'd be fairly careful about trying to pare down the Erlang/OTP
>> distribution very much...  it's easy to lose things that are
>> critical, and not all of them are going to manifest "nicely"
>> as a VM/BEAM start time failure, waiting instead until later
>> before they go off the rails...
>>
>> What sort of constraints does your environment pose to motivate
>> the paring down?  It sounds pretty demanding...
>>
>> Best regards,
>> Jerry
>>
>> ----- Original Message -----
>> From: "cocowalla"<colin.anderson333 at gmail.com>
>> To: rabbitmq-discuss at googlegroups.com
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Sent: Friday, February 3, 2012 7:50:46 AM
>> Subject: Re: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG files....
>>
>>
>> I'm considering using it as part of a commercial solution too, and would be most interested in some kind of minimal installation package.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> --
> -----------------------------------------------------------------------------
> Philippe Jean
>
> Les Ateliers Num?riques inc.
> 57 Chemin de la Vieille ?glise
> Lotbini?re, Qc, Canada, G0S 1S0
> tel: 514.276.7130 - atelier: 418.796.3069
> email: p_jean at ateliers-numeriques.net
> http://www.ateliers-numeriques.net
>
>
> -----------------------------------------------------------------------------
> This email and any attachments are confidential and may be privileged
> or otherwise protected from disclosure. If you are not the intended
> recipient you must not copy this message or any attachment or disclose
> the contents to any other person. If you have received this message in
> error please contact us at the phone number above or by email at
> info at ateliers-numeriques.net
> -----------------------------------------------------------------------------
> Le contenu du pr?sent courriel est confidentiel et peut ?tre
> privil?gi? ou soumis ? des droits d'auteur. Si vous n'?tes pas le
> destinataire anticip?, toute copie de ce message ou de tout document
> qui peut y ?tre attach? est interdit, de m?me que la divulgation ?
> quiconque du contenu de ce message.
> Si vous avez re?u ce message par erreur, nous vous prions de  nous
> contacter au t?l?phone ci-haut, ou par courriel ? info at ateliers-numeriques.net
> -----------------------------------------------------------------------------
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
-----------------------------------------------------------------------------
Philippe Jean

Les Ateliers Num?riques inc.
57 Chemin de la Vieille ?glise
Lotbini?re, Qc, Canada, G0S 1S0
tel: 514.276.7130 - atelier: 418.796.3069
email: p_jean at ateliers-numeriques.net
http://www.ateliers-numeriques.net


-----------------------------------------------------------------------------
This email and any attachments are confidential and may be privileged
or otherwise protected from disclosure. If you are not the intended
recipient you must not copy this message or any attachment or disclose
the contents to any other person. If you have received this message in
error please contact us at the phone number above or by email at
info at ateliers-numeriques.net
-----------------------------------------------------------------------------
Le contenu du pr?sent courriel est confidentiel et peut ?tre
privil?gi? ou soumis ? des droits d'auteur. Si vous n'?tes pas le
destinataire anticip?, toute copie de ce message ou de tout document
qui peut y ?tre attach? est interdit, de m?me que la divulgation ?
quiconque du contenu de ce message.
Si vous avez re?u ce message par erreur, nous vous prions de  nous
contacter au t?l?phone ci-haut, ou par courriel ? info at ateliers-numeriques.net
-----------------------------------------------------------------------------


From jerryk at vmware.com  Fri Feb  3 20:33:45 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 3 Feb 2012 12:33:45 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG
	files....
In-Reply-To: <4F2C4385.9020909@ateliers-numeriques.net>
Message-ID: <11b85e05-5854-4a10-b3b0-11fe2a3f2dec@strongmad.batnest.org>

Hi, Philippe:

I'd be reluctant to try to cut too much out of the Erlang lib directory,
and anything out of the bin directory.  The environment can be pretty lazy
about when it loads things and you don't want your apps to be discovering
well into their runtime that some critical module is missing...

Best regards,
Jerry

----- Original Message -----
From: "Philippe Jean" <p_jean at ateliers-numeriques.net>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, February 3, 2012 12:28:53 PM
Subject: Re: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG files....

hello jerry,

I did recompile Erlang/OTP without too much pain.  what should I keep as
redistributable?  would the /bootstrap be enough for rabbitMQ or do I
need /bin and the complete /lib (seems to contain a lot of stuff, among
which source and intermediate files....)

philippe

On 12-02-03 2:37 PM, Jerry Kuch wrote:
> A quick hack you might try:
>
> If you are willing to build Erlang/OTP from source (it's not too daunting
> on most Linuxes), you could likely get away with doing a 'make install' of
> it to some common place near where you want your Rabbit to live.  You might
> then imagine tarballing the whole enchilada up and using that as your redist
> unit.
>
> That won't get the disk space down to where you want it to be, probably, but
> at least you'll get the self containment you're after...
>
> Just a thought.
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "Philippe Jean"<p_jean at ateliers-numeriques.net>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Friday, February 3, 2012 11:08:44 AM
> Subject: Re: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG files....
>
> on my part, 2 things are required:
>
> - being able to have a self containing directory where all the required
> files for rabbit mq resides without having to install stuff elswere on
> the machine (/usr/local/lib or other)
> - have a reasonable size for the redist. files.  less than 20MB would be
> good
>
> philippe
>
> On 12-02-03 1:45 PM, Jerry Kuch wrote:
>> Hi, guys...
>>
>> I'd be fairly careful about trying to pare down the Erlang/OTP
>> distribution very much...  it's easy to lose things that are
>> critical, and not all of them are going to manifest "nicely"
>> as a VM/BEAM start time failure, waiting instead until later
>> before they go off the rails...
>>
>> What sort of constraints does your environment pose to motivate
>> the paring down?  It sounds pretty demanding...
>>
>> Best regards,
>> Jerry
>>
>> ----- Original Message -----
>> From: "cocowalla"<colin.anderson333 at gmail.com>
>> To: rabbitmq-discuss at googlegroups.com
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Sent: Friday, February 3, 2012 7:50:46 AM
>> Subject: Re: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG files....
>>
>>
>> I'm considering using it as part of a commercial solution too, and would be most interested in some kind of minimal installation package.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> --
> -----------------------------------------------------------------------------
> Philippe Jean
>
> Les Ateliers Num?riques inc.
> 57 Chemin de la Vieille ?glise
> Lotbini?re, Qc, Canada, G0S 1S0
> tel: 514.276.7130 - atelier: 418.796.3069
> email: p_jean at ateliers-numeriques.net
> http://www.ateliers-numeriques.net
>
>
> -----------------------------------------------------------------------------
> This email and any attachments are confidential and may be privileged
> or otherwise protected from disclosure. If you are not the intended
> recipient you must not copy this message or any attachment or disclose
> the contents to any other person. If you have received this message in
> error please contact us at the phone number above or by email at
> info at ateliers-numeriques.net
> -----------------------------------------------------------------------------
> Le contenu du pr?sent courriel est confidentiel et peut ?tre
> privil?gi? ou soumis ? des droits d'auteur. Si vous n'?tes pas le
> destinataire anticip?, toute copie de ce message ou de tout document
> qui peut y ?tre attach? est interdit, de m?me que la divulgation ?
> quiconque du contenu de ce message.
> Si vous avez re?u ce message par erreur, nous vous prions de  nous
> contacter au t?l?phone ci-haut, ou par courriel ? info at ateliers-numeriques.net
> -----------------------------------------------------------------------------
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
-----------------------------------------------------------------------------
Philippe Jean

Les Ateliers Num?riques inc.
57 Chemin de la Vieille ?glise
Lotbini?re, Qc, Canada, G0S 1S0
tel: 514.276.7130 - atelier: 418.796.3069
email: p_jean at ateliers-numeriques.net
http://www.ateliers-numeriques.net


-----------------------------------------------------------------------------
This email and any attachments are confidential and may be privileged
or otherwise protected from disclosure. If you are not the intended
recipient you must not copy this message or any attachment or disclose
the contents to any other person. If you have received this message in
error please contact us at the phone number above or by email at
info at ateliers-numeriques.net
-----------------------------------------------------------------------------
Le contenu du pr?sent courriel est confidentiel et peut ?tre
privil?gi? ou soumis ? des droits d'auteur. Si vous n'?tes pas le
destinataire anticip?, toute copie de ce message ou de tout document
qui peut y ?tre attach? est interdit, de m?me que la divulgation ?
quiconque du contenu de ce message.
Si vous avez re?u ce message par erreur, nous vous prions de  nous
contacter au t?l?phone ci-haut, ou par courriel ? info at ateliers-numeriques.net
-----------------------------------------------------------------------------


From tonygarnockjones+rabbitmq at gmail.com  Fri Feb  3 21:28:02 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Fri, 3 Feb 2012 16:28:02 -0500
Subject: [rabbitmq-discuss] Presence Exchange Related Question
In-Reply-To: <CADCLBRjidfhs0Uzh5NiLZMrNVFwxoDa0pjKwAuOonP7b4mxa8Q@mail.gmail.com>
References: <CADCLBRhhP9Jwwb5z0npPq0uSExmUswM4c8bNSP=GNobkRSgBTQ@mail.gmail.com>
	<CAM8fPiRDA_66s-gRDWKPxg7gmWNxbHSUD5d73VLPxGi8pFkb-w@mail.gmail.com>
	<CADCLBRjidfhs0Uzh5NiLZMrNVFwxoDa0pjKwAuOonP7b4mxa8Q@mail.gmail.com>
Message-ID: <CAM8fPiRdvC-k0GxbUWw+Gpexc+6jcibBJx3X7k41rSTD2AKcEQ@mail.gmail.com>

On 3 February 2012 14:42, Randall Richard <randall at trellisapp.com> wrote:

> More specifically, for an application that provides a "presence" status, a
> disconnect is something you want to capture and propagate accordingly.  Is
> one approach to do what you describe below (e.g. I could create a
> consumer/service that keeps track of connects and disconnects and associate
> that with a corresponding application context)?  Is there something more
> obvious on how this might be done with RabbitMQ?
>

Yes, you could do that (though you might have trouble correlating the log
messages with application-level entities). I don't think there's anything
much cleaner you could do using the built-in features, though. Stepping
away from built-ins, the presence exchange would probably simplify things
in terms of the code you'd need to write, but at the cost of running a
third-party plugin.

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/c8a9c6a8/attachment.htm>

From hcoyote at ghostar.org  Fri Feb  3 21:39:59 2012
From: hcoyote at ghostar.org (Travis)
Date: Fri, 3 Feb 2012 15:39:59 -0600
Subject: [rabbitmq-discuss] Reviewing server statistics from multiple
	rabbitmq-servers
Message-ID: <CAChq9g26=7_4MdHPFRXwLShp7zcsEFp1NHUrq+ouPr7ktb=M-Q@mail.gmail.com>

Is it possible to have one rabbitmq instance running the management
webapp and have multiple other rabbitmq instances feed their
statistics data to that for the purposes of human review?  Right now,
we have about 40-ish instances of rabbitmq, each doing different
things in different datacenters, and I'd like to be able to have one
place to view their current messaging rates, utilization, and so on.

It wasn't clear from the documentation that this can be done in
anything other than a clustered configuration.

Thanks,
Travis

-- 
Travis Campbell
travis at ghostar.org

From mpietrek at skytap.com  Fri Feb  3 21:48:37 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 03 Feb 2012 13:48:37 -0800
Subject: [rabbitmq-discuss] High volume message consumption slows down
 consistently over time when using Pika and transactions
Message-ID: <CB519634.2B958%mpietrek@skytap.com>

I'm writing some basic throughput tests to verify that RabbitMQ will scale
to our needs in HA environments. In one scenario I'm finding that consuming
messages as quickly as possible slows down consistently over time.

My environment:
* Ubuntu 10.04 with RabbitMQ 2.71.
* Erlang R13B03
* Broker instances are all disk nodes on a dedicated VM running nothing
else.
* Queues are declared as durable and x-ha-policy:all
* Clients are written in Python using Pika 0.9.5.
* For this test a single broker is used, but I have the same effect with
mirrored queues.
The test code is extremely simple. It simply reads or writes messages (up to
100,000) as quickly as it can, and shows the throughput rate at 1000 message
intervals.

I've noticed that when I use transactions with basic_ack, e.g.

        channel.tx_select()
        channel.basic_ack(delivery_tag=tag)
        channel.tx_commit()

that the rate I can consume messages drops steadily. Each time I restart my
reading app with a full queue, I see a consistent slowdown in my rate as
measured every 1000 messages:

(Rate for last 1000 messages | Average rate for all messages since app
start)
Read 597.502915814 messages/sec | Average: 597.502915814
Read 431.665048642 messages/sec | Average: 501.222607245
Read 447.932745586 messages/sec | Average: 482.104211325
Read 377.776468153 messages/sec | Average: 450.969014032
Read 394.784579872 messages/sec | Average: 438.488176956
Read 346.943823897 messages/sec | Average: 420.01726691
Read 301.813628274 messages/sec | Average: 397.762754973
Read 313.625720320 messages/sec | Average: 384.856956366
Read 266.972510375 messages/sec | Average: 366.858074188
Read 254.247975169 messages/sec | Average: 351.298554027
Read 251.812483302 messages/sec | Average: 339.118646053
Read 246.701903922 messages/sec | Average: 328.85271509
Read 222.953957109 messages/sec | Average: 317.260966009

If I simply remove the tx_select()/tx_commit, the rate stays reasonably
stable:

(Rate for last 1000 messages | Average rate for all messages since app start
Read 1228.77445722 messages/sec | Average: 1343.23656881
Read 1063.88750879 messages/sec | Average: 1235.13209738
Read 1368.73427666 messages/sec | Average: 1266.02631056
Read 1423.23835115 messages/sec | Average: 1294.62742565
Read 1438.56741702 messages/sec | Average: 1316.58317701
Read 1393.69714404 messages/sec | Average: 1327.07283563
Read 991.831277598 messages/sec | Average: 1273.27648897
Read 1097.96119586 messages/sec | Average: 1251.08044697
Read 1174.27676294 messages/sec | Average: 1242.95091463
Read 1307.42368241 messages/sec | Average: 1248.54813715
Read 1491.50216641 messages/sec | Average: 1265.7295908

One thing I have noticed is that in my client app machine, the CPU
percentage generally climbs over time, with the occasional brief drop back
to a prior %. This might point to a Pika issue in the transaction related
code, but it's not obvious to me from inspection of the code if so.

Here's the relevant snippets of my code:

def do_read(clientlib):
    for i in range(100000):
        _, ack_info = clientlib.read_message(QUEUENAME)
        if ack_info == None:
            print "No messages to read - Exiting"
            return
        clientlib.acknowledge_message(ack_info)


class Clientlib
    def connect(self, hostname, use_transactions):
        self.connection =
pika.BlockingConnection(pika.ConnectionParameters(host=hostname, port=5672))
        self.channel = self.connection.channel()
        self.use_transactions = use_transactions

    def read_message(self, queue_name):
        method_frame, _, body = self.channel.basic_get(queue=queue_name)
        return body, (self.channel, method_frame.delivery_tag)

    def acknowledge_message(self, acknowledge_info):
        channel = acknowledge_info[0]
        tag = acknowledge_info[1]

        if self.use_transactions:
            channel.tx_select()

        channel.basic_ack(delivery_tag=tag)

        if self.use_transactions:
            channel.tx_commit()

Any ideas what the issue might be, or what I could be doing wrong?

Thanks,

Matt


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/7e0c4525/attachment.htm>

From mpietrek at skytap.com  Fri Feb  3 23:49:04 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 03 Feb 2012 15:49:04 -0800
Subject: [rabbitmq-discuss] Using Pika Python client library with
 BlockingConnections and publisher-confirms - Does it work?
Message-ID: <CB51B270.2B979%mpietrek@skytap.com>

Just trying to figure out if this should work so that I can stop beating my
head against the wall.  And apologies for posting here, but I couldn?t find
a forum dedicated to Pika to post to.

Our app is such that the asynchronous processing model doesn't work for us.
We want to reliably pull one message at a time off the queue, process it,
acknowledge it, and be done with it.

Towards this end, we're using a very simple setup using BlockingConnection,
basic_publish, basic_get and basic_ack. We're also using tx_select and
tx_confirm to guarantee messages are safely in the broker. However, given
what I've been reading, it seems like the RabbitMQ folks are strongly trying
to get folks off of transactions and on to publisher-confirms.

While I have strong concerns about message loss because of client crashes,
I'm nonetheless trying to experiment with publisher-confirms to see if they
work at all in our scenario.

And this is where I hit the wall. I can't get publisher-confirm callbacks to
work. The callback is never called. Is this expected to work?

Given a working example (without publisher-confirms), I've modified it as
follows:

        self.channel = self.connection.channel()
        self.channel.confirm_delivery(publisher_confirm,)

...
    def write_message(self, queue_name, json_string):
        self.channel.basic_publish(exchange='',
            routing_key=queue_name,
            body=json_string,
            properties=pika.BasicProperties(delivery_mode=2))

    def publisher_confirm(frame):
        print "Got the message!"

My publisher_confirm() method is never called. And by putting breakpoints at
strategic points inside the Pika client library, I don't ever see any data
coming back from the server that would result in callbacks, despite my
writing 1000s messages/sec.

Thanks for any insight folks have,

Matt


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/aa32de7d/attachment.htm>

From simone.busoli at gmail.com  Fri Feb  3 23:54:54 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sat, 4 Feb 2012 00:54:54 +0100
Subject: [rabbitmq-discuss] .NET client connection shutdown codes
Message-ID: <CAOn7oW8-mgm3CvhTKFYZ-0Q+qzXYgYmw3k1a+qcjPpczXxE2XA@mail.gmail.com>

Hi, I'm trying to figure out what values the ShutdownEventArgs.ReplyCode
property can be assigned by the .NET client.
I started investigating while trying to solve a reconnection problem
whereby the connection was shutdown by the AppDomain unload event handler
and exited with code 0x21d, but noticed there's at least another case in
the code where the ReplyCode is assigned the same value, and it's in the
MainLoop method, in the last chance catch block.
Using same codes for different shutdown reasons makes it difficult to
distinguish different shutdown scenarios, and I would like to avoid relying
on the ReplyText property to discriminate it.
So I'm wondering what is the criteria used by the API to set this value
and, bumping one thread from some time ago, it would be very nice to have
some guidance about how the .NET API behaves when anything goes wrong.
Currently I have to say that it's quite difficult to cope with failure
scenarios because the behavior of the API is difficult to predict, and I am
under the impression that it is somewhat inconsistent in terms of which
exceptions you have to expect to bubble up in different circumstances.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120204/8b254831/attachment.htm>

From jerryk at vmware.com  Fri Feb  3 23:55:38 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 3 Feb 2012 15:55:38 -0800 (PST)
Subject: [rabbitmq-discuss] Reviewing server statistics from
	multiple	rabbitmq-servers
In-Reply-To: <CAChq9g26=7_4MdHPFRXwLShp7zcsEFp1NHUrq+ouPr7ktb=M-Q@mail.gmail.com>
Message-ID: <71503369-db58-4b1a-badc-851494985b67@strongmad.batnest.org>

Hi, Travis:

I don't think we currently support this (I'm sure someone will correct me
if I'm wrong), but it's an interesting idea.  You could of course use the
management API to pull information from your many Rabbit instances and
feed it into the monitoring/alerting/dashboard system of your choice, but
that of course isn't quite the same as being able to view all of it in the
standard RabbitMQ web management UI...

Best regards,
Jerry

----- Original Message -----
From: "Travis" <hcoyote at ghostar.org>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, February 3, 2012 1:39:59 PM
Subject: [rabbitmq-discuss] Reviewing server statistics from multiple	rabbitmq-servers

Is it possible to have one rabbitmq instance running the management
webapp and have multiple other rabbitmq instances feed their
statistics data to that for the purposes of human review?  Right now,
we have about 40-ish instances of rabbitmq, each doing different
things in different datacenters, and I'd like to be able to have one
place to view their current messaging rates, utilization, and so on.

It wasn't clear from the documentation that this can be done in
anything other than a clustered configuration.

Thanks,
Travis

-- 
Travis Campbell
travis at ghostar.org
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From hcoyote at ghostar.org  Sat Feb  4 00:05:48 2012
From: hcoyote at ghostar.org (Travis)
Date: Fri, 3 Feb 2012 18:05:48 -0600
Subject: [rabbitmq-discuss] Reviewing server statistics from multiple
	rabbitmq-servers
In-Reply-To: <71503369-db58-4b1a-badc-851494985b67@strongmad.batnest.org>
References: <CAChq9g26=7_4MdHPFRXwLShp7zcsEFp1NHUrq+ouPr7ktb=M-Q@mail.gmail.com>
	<71503369-db58-4b1a-badc-851494985b67@strongmad.batnest.org>
Message-ID: <CAChq9g25i48uZFr71t-BQaZLCt8vNWb1uKiQKAyyPeJ+-Mrwwg@mail.gmail.com>

On Fri, Feb 3, 2012 at 5:55 PM, Jerry Kuch <jerryk at vmware.com> wrote:
> Hi, Travis:
>
> I don't think we currently support this (I'm sure someone will correct me
> if I'm wrong), but it's an interesting idea. ?You could of course use the
> management API to pull information from your many Rabbit instances and
> feed it into the monitoring/alerting/dashboard system of your choice, but
> that of course isn't quite the same as being able to view all of it in the
> standard RabbitMQ web management UI...
>

Thanks Jerry!

We already use the nagios-plugins-rabbitmq stuff on github to gather
data periodically from each of our rabbitmq instances.  Nagios just
doesn't make it easy to view this stuff in a consolidated way.

I guess I'll just suffer through it. :-)


-- 
Travis Campbell
travis at ghostar.org

From marcus_rubeus at hotmail.com  Sat Feb  4 00:49:34 2012
From: marcus_rubeus at hotmail.com (MarcusR)
Date: Fri, 3 Feb 2012 16:49:34 -0800 (PST)
Subject: [rabbitmq-discuss] Keeping track of exchanges -- Any Advice
In-Reply-To: <4F26821A.4040001@rabbitmq.com>
References: <ab66f90c-2e4e-49ff-987e-425a493e4b68@t8g2000yqg.googlegroups.com>
	<4F16A110.6000205@rabbitmq.com>
	<94a5f80b-b18a-4a7e-aa6f-de7a74cd2f22@m5g2000yqk.googlegroups.com>
	<4F26821A.4040001@rabbitmq.com>
Message-ID: <d22bfa37-3355-4f1e-b9cc-6ec81bdbf044@15g2000vbq.googlegroups.com>

Okay, I feel like a real idiot. For some reason I was thinking that
direct exchanges required a 1:1 relationship to exchanges / queues.
Pretty silly of me considering I implemented the client/protocol for
our AMQP client.

That vastly simplifies the problem. Direct exchanges will work
marvellously. My question is, if there are going to be 50,000 queues,
is there any performance advantage to dividing these queues across
multiple exchanges on the same box? I do not know what kind of
algorithmns rabbit uses for exchange lookup and queue matching for the
direct exchange. So, is it better for 1 exchange to have 50,000 queues
on the same machine or 100 exchanges to have 500 queues on the same
machine?

On Jan 30, 6:42?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 30/01/12 06:31, MarcusR wrote:
>
> > Hello Simon, thanks for the response.
>
> > I am not really sure to be honest. I am not very familiar with message
> > brokers and their performance characteristics. I suppose I could have
> > a topicexchangeand then bind queues to various topics... Such as
> > have a queue for user1.queu1, user2.queue1, user3.queue1, etc
>
> Unless you need wildcards you may not even need a topicexchange. *If*
> routing turns out to be an expensive thing for you then a directexchangecan give a notable performance boost.
>
> > My question is how expensive is routing?
>
> Depends :) If you're sending lots of small non-persistent messages fast
> then it can become a somewhat significant factor, just because RabbitMQ
> isn't doing mush *else* per message.
>
> Usually making routing simpler will make it faster.
>
> > Also, regarding the routing,
> > is it more performant to have one master topicexchangefor all the
> > users or to distribute users across multiple topic exchanges or does
> > it not matter?
>
> It doesn't matter.
>
> > I assume rabbitmq first looks up theexchangeand then goes through
> > each queue to see if there is a match for routing. If this is the
> > case, I imagine it would be more performant to create a thousand such
> > topic exchanges and divide all the users across them as opposed to one
> > topicexchangefor all users.
>
> No, it's not quite like that - topic routing is O(log(n)). But I think
> the n there is the total number of topic bindings, not perexchange.
>
> > In the end, I plan to run several rabbitmq nodes with a bucket of
> > users assigned to each rabbit node. Assigning each user to a node
> > based on a hash. Is this best practice for scaling rabbitmq for this
> > type of scenerio? Currently rabbitmq is the bottle neck in my
> > application benchmarks so this was my plan to scale it. Please correct
> > me if there is a better practice.
>
> This sort of sharding is probably the most scalable solution if it's
> practical. If it's not practical then clustering or federation would be
> alternative routes...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Sat Feb  4 01:02:09 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 3 Feb 2012 17:02:09 -0800 (PST)
Subject: [rabbitmq-discuss] Keeping track of exchanges -- Any Advice
In-Reply-To: <d22bfa37-3355-4f1e-b9cc-6ec81bdbf044@15g2000vbq.googlegroups.com>
Message-ID: <2941208d-c88d-4774-abf4-9bf2ef10d3f9@strongmad.batnest.org>

Hi, Marcus:

The actual work of doing the routing through an exchange is actually
done by the Rabbit Erlang process associated with the *channel* you're
publishing on... in other words there's no "exchange process."

The work that your channel process does varies depending on the type of
exchange.  In the case of topic exchanges there's a nice and well tuned
trie-based matching algorithm that Matthew has blogged about on the
Rabbit website in the past.  Fan out and direct exchanges work about as
you'd expect.

Unlike exchanges, queues *do* have an Erlang process associated with them,
that receives messages that have been routed through the appropriate
exchange, by the channel process, which passes the AMQP message to the
queue process using Erlang messaging.

As always, it pays to perform an experiment that lines up with the scenario
you're expecting to face in your production system.  But the above
observations should get you started on how to set your expectations...

Best regards,
Jerry

----- Original Message -----
From: "MarcusR" <marcus_rubeus at hotmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, February 3, 2012 4:49:34 PM
Subject: Re: [rabbitmq-discuss] Keeping track of exchanges -- Any Advice

Okay, I feel like a real idiot. For some reason I was thinking that
direct exchanges required a 1:1 relationship to exchanges / queues.
Pretty silly of me considering I implemented the client/protocol for
our AMQP client.

That vastly simplifies the problem. Direct exchanges will work
marvellously. My question is, if there are going to be 50,000 queues,
is there any performance advantage to dividing these queues across
multiple exchanges on the same box? I do not know what kind of
algorithmns rabbit uses for exchange lookup and queue matching for the
direct exchange. So, is it better for 1 exchange to have 50,000 queues
on the same machine or 100 exchanges to have 500 queues on the same
machine?

On Jan 30, 6:42?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 30/01/12 06:31, MarcusR wrote:
>
> > Hello Simon, thanks for the response.
>
> > I am not really sure to be honest. I am not very familiar with message
> > brokers and their performance characteristics. I suppose I could have
> > a topicexchangeand then bind queues to various topics... Such as
> > have a queue for user1.queu1, user2.queue1, user3.queue1, etc
>
> Unless you need wildcards you may not even need a topicexchange. *If*
> routing turns out to be an expensive thing for you then a directexchangecan give a notable performance boost.
>
> > My question is how expensive is routing?
>
> Depends :) If you're sending lots of small non-persistent messages fast
> then it can become a somewhat significant factor, just because RabbitMQ
> isn't doing mush *else* per message.
>
> Usually making routing simpler will make it faster.
>
> > Also, regarding the routing,
> > is it more performant to have one master topicexchangefor all the
> > users or to distribute users across multiple topic exchanges or does
> > it not matter?
>
> It doesn't matter.
>
> > I assume rabbitmq first looks up theexchangeand then goes through
> > each queue to see if there is a match for routing. If this is the
> > case, I imagine it would be more performant to create a thousand such
> > topic exchanges and divide all the users across them as opposed to one
> > topicexchangefor all users.
>
> No, it's not quite like that - topic routing is O(log(n)). But I think
> the n there is the total number of topic bindings, not perexchange.
>
> > In the end, I plan to run several rabbitmq nodes with a bucket of
> > users assigned to each rabbit node. Assigning each user to a node
> > based on a hash. Is this best practice for scaling rabbitmq for this
> > type of scenerio? Currently rabbitmq is the bottle neck in my
> > application benchmarks so this was my plan to scale it. Please correct
> > me if there is a better practice.
>
> This sort of sharding is probably the most scalable solution if it's
> practical. If it's not practical then clustering or federation would be
> alternative routes...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From markwvh at gmail.com  Sat Feb  4 06:11:50 2012
From: markwvh at gmail.com (Mark Wong-VanHaren)
Date: Fri, 3 Feb 2012 22:11:50 -0800 (PST)
Subject: [rabbitmq-discuss] Python example on event-driving consumer?
In-Reply-To: <CAHiEoM5vBiCWucx_6SFXYpi6wToBX0pL_Z4P9Cxoc6Bby=NUNg@mail.gmail.com>
References: <d152e2e3-7ca4-4765-8314-5162aee37504@q7g2000yqn.googlegroups.com>
	<CAHiEoM5vBiCWucx_6SFXYpi6wToBX0pL_Z4P9Cxoc6Bby=NUNg@mail.gmail.com>
Message-ID: <4239019.1183.1328335910206.JavaMail.geo-discussion-forums@prdh15>

Hi, Aaron-

Haigha looks really cool, and I'm interested to use it *with gevent*. 
 Perhaps you could offer and example of how one does that?

In your stress_test:
    https://github.com/agoragames/haigha/blob/master/scripts/stress_test

I see that you're continually calling connection.read_frames(), and I see a 
comment in the implementation of that method saying:

  #  ....in the case of gevent, this is how a blocking call to 
  # read from the socket is kicked off.

But I'm afraid I don't grok that or know what that means in terms of how 
one should use Haigha with gevent.

Any help would be greatly appreciated.  Thanks!
-Mark

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120203/cda61c07/attachment.htm>

From ask at rabbitmq.com  Sat Feb  4 11:56:53 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Sat, 4 Feb 2012 11:56:53 +0000
Subject: [rabbitmq-discuss] Using Pika Python client library with
	BlockingConnections and publisher-confirms - Does it work?
In-Reply-To: <CB51B270.2B979%mpietrek@skytap.com>
References: <CB51B270.2B979%mpietrek@skytap.com>
Message-ID: <784D91D7-0D61-493E-8293-3CB827ABCBD7@rabbitmq.com>


On 3 Feb 2012, at 23:49, Matt Pietrek wrote:

> 
> Our app is such that the asynchronous processing model doesn't work for us. We want to reliably pull one message at a time off the queue, process it, acknowledge it, and be done with it.
> 
[...]
> And this is where I hit the wall. I can't get publisher-confirm callbacks to work. The callback is never called. Is this expected to work?


AFAIK for publisher confirms to work you would need to drain events from
the connection.  Currently you are just writing data to the socket, and never
reading the replies back, so the callback won't be triggered.

Now, actually draining events while publishing messages is tricky in a blocking
application, you would have to find some smart way of alternating between reading
and writing to the socket.  Maybe there are mechanisms in pika for this, but I don't know.

From yogimogi at gmail.com  Sun Feb  5 06:48:33 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Sat, 4 Feb 2012 22:48:33 -0800 (PST)
Subject: [rabbitmq-discuss] Acknowledgement bug with Tx
Message-ID: <0304b27a-eb4e-490e-a266-da6160990f97@g4g2000pbi.googlegroups.com>

There are 2 queues q1 and q2.

       | Ready  | Unacked  |  Total   |
q1   |    100   |            0  |     100  |
q2   |       0   |            0  |        0   |


Now this code runs
GetResponse r = ch.basicGet(q1, false);
if(r != null) {
    // read message body and change it slightly
    ch.queueBind(q2, exchange, q2);
    ch.txSelect();
    ch.basicPublish(exchange, q2, props, changed_body);
    ch.txCommit();
    ch.basicAck(r.getEnvelope().getDeliveryTag(), false);
}

In-spite of doing backAck in the status, Unacked message count is 1.

       | Ready  | Unacked  |  Total   |
q1   |       99  |            1  |     100  |
q2   |       1   |            0  |        1   |

And now if I pause the program, this state remains forever and if I
kill the program, it looks like

       |    Ready  | Unacked  |  Total   |
q1   |       100  |            0  |     100  |
q2   |         1   |            0  |        1   |

Strangely, it happens only the first time, i.e. If I keep on running
this code, in the end status looks like.
I have acknowledged all 100 messages, but broker gets only 99
acknowledgments.

       |    Ready  | Unacked  |  Total   |
q1   |          0    |            1   |     1      |
q2   |         0     |            0  |        0    |

Can anyone explain what is going on here?

regards, Yogesh

From codevally at gmail.com  Mon Feb  6 00:55:36 2012
From: codevally at gmail.com (Codevally)
Date: Sun, 5 Feb 2012 16:55:36 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ communication ports
In-Reply-To: <d87967f3-8547-4102-b9c3-2f9f48593f58@strongmad.batnest.org>
References: <d87967f3-8547-4102-b9c3-2f9f48593f58@strongmad.batnest.org>
Message-ID: <53113b6d-8962-48f1-a429-2c904b73bd21@pk8g2000pbb.googlegroups.com>

Thanks for the comments.

On Feb 4, 3:13?am, Jerry Kuch <jer... at vmware.com> wrote:
> And, although it might have been mentioned earlier in the thread and I
> missed it, the Erlang port mapper daemon's port should be open so that
> cluster nodes can communicate with one another and rabbitmqctl and
> anything based on Erlang distribution can work.
>
> EPMD listens on port 4369 by default.
>
>
>
>
>
>
>
> ----- Original Message -----
> From: "Emile Joubert" <em... at rabbitmq.com>
> To: "Codevally" <codeva... at gmail.com>
>
> Cc: rabbitmq-disc... at lists.rabbitmq.com
> Sent: Friday, February 3, 2012 2:10:49 AM
> Subject: Re: [rabbitmq-discuss] RabbitMQ communication ports
>
> Hi,
>
> On 03/02/12 05:47, Codevally wrote:
> > Other than the 5672 tcp port, what are the other ports RabbitMQ using
> > to communicate. We need to identify the ports before implementing the
> > firewall. Many thanks.
>
> If you only require (non-SSL) AMQP connections then TCP 5672 is
> sufficient. It is typical to run the SSL variant on a different port
> (normally 5671). If you use the STOMP adapter or the management console
> then you will need ports for those. If you wish to query the broker
> across the firewall with the rabbitmqctl tool then you will also need
> the ports described here:http://www.rabbitmq.com/clustering.html#firewall
> If you wish to use LDAP authentication then the relevant outgoing port
> must be open.
>
> -Emile
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From codevally at gmail.com  Mon Feb  6 00:56:30 2012
From: codevally at gmail.com (Codevally)
Date: Sun, 5 Feb 2012 16:56:30 -0800 (PST)
Subject: [rabbitmq-discuss] Change the password for guest account or
 remove guest account from RabbitMQ
In-Reply-To: <4F2BBC80.6060200@rabbitmq.com>
References: <CAH+_+m4X0z5gJvPqM7QCq3ytKKGqKpioDSj0PnPSK4XBF8+cgg@mail.gmail.com>
	<4F2BBC80.6060200@rabbitmq.com>
Message-ID: <112b3596-d871-4d23-be43-27fff7df7d9b@4g2000pbz.googlegroups.com>

Thanks for the excellent explanation.

On Feb 3, 9:52?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Roshan,
>
> On 03/02/12 03:08, Roshan Pradeep wrote:
>
> > What are the impacts for changing the password for "guest" user account
> > or remove the "guest" account entirely. I can create my own account and
> > assign it to vhost currently I am using.
>
> You are free to use any name and password, and we recommend that you use
> a stronger password in an environment where you don't control network
> access to the broker.
>
> Also look athttp://www.rabbitmq.com/authentication.htmlfor alternative
> authentication mechanisms.
>
> > Is the guest/guest is use inside RabbitMQ code for any purpose?
>
> No, you are not required to have a user configured with username "guest"
> and password "guest".
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From codevally at gmail.com  Mon Feb  6 00:57:45 2012
From: codevally at gmail.com (Codevally)
Date: Sun, 5 Feb 2012 16:57:45 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ memory usage in two node cluster
In-Reply-To: <4F2BBA1B.3070809@rabbitmq.com>
References: <CAH+_+m7itg0QbkzQQeQQWnT6-ERMH6ZNqsNMuGUSmunWpyoQjg@mail.gmail.com>
	<4F2BBA1B.3070809@rabbitmq.com>
Message-ID: <c19b48ce-352b-43fb-b98e-ce21eff80751@pq6g2000pbc.googlegroups.com>

Thanks for the explanation and will post if this happen in future.

On Feb 3, 9:42?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Roshan,
>
> On 03/02/12 00:24, Roshan Pradeep wrote:
>
> > I have 2 node RabbitMQ cluster and one node consume double amount of
> > memory than the other. Please check the attached image for more information.
>
> > Could you please help me to identify this. Any help is appreciated.
>
> The difference between 1% and 2% of allowed memory is not a problem and
> could easily happen if one broker has marginally more work to do than
> the other.
>
> If the difference was much greater then I would be a bit more concerned
> and investigate ways of spreading the load more evenly such as making
> sure all the queues aren't all declared on one node.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From adelpreore at gmail.com  Sun Feb  5 23:29:34 2012
From: adelpreore at gmail.com (Andrew Del Preore)
Date: Sun, 5 Feb 2012 15:29:34 -0800 (PST)
Subject: [rabbitmq-discuss] Ubuntu 11.10 does not shutdown
In-Reply-To: <CAL8b_0dORe_EO88mp5R_aSUOZYJ7ujnbNScG6ai60An+0fKK2A@mail.gmail.com>
References: <CAL8b_0dORe_EO88mp5R_aSUOZYJ7ujnbNScG6ai60An+0fKK2A@mail.gmail.com>
Message-ID: <32052927.1398.1328484574945.JavaMail.geo-discussion-forums@yqtt30>

The version Rabbit MQ Available through Ubuntu (Synaptic) is 2.5.0-1 for 
11.10.

After investigating my shutdown issues (and trying various acpi options) I 
stumbled across this thread.
After uninstalling RabbitMQ and force-booting again -> I can restart or 
shutdown as normal. (I've had this for a little awhile)

I don't know if this helps - but x64 Ubuntu 11.10 Desktop (kernel 3.0.0.16) 
(ASUS laptop G73J)

My WAG (Wild A.. Guess) on this would be shutdown signal misinterpreted as 
process-kill which causes a rabbit restart? (hang for us).

Not currently using rabbitmq in this environment so I'm it leaving 
uninstalled for now (also assuming what Sampo is saying about 2.6.1/2.7.0 
is true). 

I'll be watching this thread for any updates...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120205/177762ac/attachment.htm>

From emile at rabbitmq.com  Mon Feb  6 10:27:25 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 06 Feb 2012 10:27:25 +0000
Subject: [rabbitmq-discuss] .NET client connection shutdown codes
In-Reply-To: <CAOn7oW8-mgm3CvhTKFYZ-0Q+qzXYgYmw3k1a+qcjPpczXxE2XA@mail.gmail.com>
References: <CAOn7oW8-mgm3CvhTKFYZ-0Q+qzXYgYmw3k1a+qcjPpczXxE2XA@mail.gmail.com>
Message-ID: <4F2FAB0D.30100@rabbitmq.com>

Hi Simone,

On 03/02/12 23:54, Simone Busoli wrote:
> Hi, I'm trying to figure out what values the ShutdownEventArgs.ReplyCode
> property can be assigned by the .NET client. 

Thanks for your feedback. There is a relative scarcity of error codes.
The AMQP specification only defines only a small number, which means
that some codes have to be re-used. "Precondition failed" (406) is a
good example of a code that is widely used, so the code alone does not
identify a unique problem.

The code in your example is "Internal error" (541). This code should be
read as an error class and you need to inspect the error message for
more detail.


-Emile

From sampo.savolainen at spatineo.com  Mon Feb  6 10:41:54 2012
From: sampo.savolainen at spatineo.com (Sampo Savolainen)
Date: Mon, 6 Feb 2012 12:41:54 +0200
Subject: [rabbitmq-discuss] Ubuntu 11.10 does not shutdown
In-Reply-To: <32052927.1398.1328484574945.JavaMail.geo-discussion-forums@yqtt30>
References: <CAL8b_0dORe_EO88mp5R_aSUOZYJ7ujnbNScG6ai60An+0fKK2A@mail.gmail.com>
	<32052927.1398.1328484574945.JavaMail.geo-discussion-forums@yqtt30>
Message-ID: <CAL8b_0cqoC_1Dh4tpG-1FPsKPkaEtC3gihxcgw1NzJc_ffPTUA@mail.gmail.com>

Hi,

The problem is simple: consolekit thinks rabbitmq is a real user using the
computer. Then the login manager (lightdm) does not allow the user to shut
down the computer.

I've fixed this on my computers by changing /usr/sbin/rabbitmq-server to
start rabbitmq with start-stop-daemon instead of su:


.. snip
if [ `id -u` = `id -u rabbitmq` -o "$SCRIPT" = "rabbitmq-plugins" ] ; then
    /usr/lib/rabbitmq/bin/${SCRIPT} "$@"
elif [ `id -u` = 0 ] ; then
    # don't use su, use start-stop-daemon instead
    #su rabbitmq -s /bin/sh -c "/usr/lib/rabbitmq/bin/${SCRIPT} ${CMDLINE}"
    start-stop-daemon \
        --chuid rabbitmq \
        --start \
        --pidfile $RABBITMQ_PID_FILE \
        --exec /bin/sh \
        -- /usr/lib/rabbitmq/bin/${SCRIPT} ${CMDLINE}
else
.. snap

I'm however not 100% sure this fix is globally acceptable. Any thoughts
Simon?


 Sampo


On Mon, Feb 6, 2012 at 1:29 AM, Andrew Del Preore <adelpreore at gmail.com>wrote:

> The version Rabbit MQ Available through Ubuntu (Synaptic) is 2.5.0-1 for
> 11.10.
>
> After investigating my shutdown issues (and trying various acpi options) I
> stumbled across this thread.
> After uninstalling RabbitMQ and force-booting again -> I can restart or
> shutdown as normal. (I've had this for a little awhile)
>
> I don't know if this helps - but x64 Ubuntu 11.10 Desktop (kernel
> 3.0.0.16) (ASUS laptop G73J)
>
> My WAG (Wild A.. Guess) on this would be shutdown signal misinterpreted as
> process-kill which causes a rabbit restart? (hang for us).
>
> Not currently using rabbitmq in this environment so I'm it leaving
> uninstalled for now (also assuming what Sampo is saying about 2.6.1/2.7.0
> is true).
>
> I'll be watching this thread for any updates...
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Sampo Savolainen
Head of R&D, Spatineo Oy
sampo.savolainen at spatineo.com
+358-407555649
Hiilikatu 3, fi-00180 Helsinki, Finland
www.spatineo.com, twitter.com/#!/spatineo
www.linkedin.com/company/spatineo-inc
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120206/1a70d5ed/attachment.htm>

From emile at rabbitmq.com  Mon Feb  6 10:43:19 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 06 Feb 2012 10:43:19 +0000
Subject: [rabbitmq-discuss] Strange message loss behavior with mirrored
 queues
In-Reply-To: <CB516E06.2B8AB%mpietrek@skytap.com>
References: <CB516E06.2B8AB%mpietrek@skytap.com>
Message-ID: <4F2FAEC7.9010808@rabbitmq.com>

Hi Matt,

On 03/02/12 18:57, Matt Pietrek wrote:
> I'm writing some basic throughput tests to verify that RabbitMQ will
> scale to our needs in HA environments. In one scenario I'm finding
> substantial message loss.

I wouldn't describe what you're seeing as message loss, rather a
demonstration that publishing in a HA environment with more nodes is
slower. Publishing is slower because it takes longer to send the
messages to a greater number of nodes in the cluster.

You should make use of publisher confirms
(http://www.rabbitmq.com/extensions.html#publishing)
to make sure that published messages have been safely received by the
broker.


-Emile

From taylste at gmail.com  Mon Feb  6 11:54:26 2012
From: taylste at gmail.com (Steven Taylor)
Date: Mon, 6 Feb 2012 11:54:26 +0000
Subject: [rabbitmq-discuss] .BasicReject(tag, false) & BasicAck
Message-ID: <CA+zYriRKep8AerXiAUVXYfzEzynuZXzf20epy89+oVJ9YXG-Ew@mail.gmail.com>

BasicReject(deliveryTag, false) seems to be requing the message (probably
due to having acknowledgements set).  So, should I also acknowledge a
message I'm about to reject?

Does BasicReject send an asynchronous message back to sender when
mandatory=true?

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120206/89c5ddc1/attachment.htm>

From majek04 at gmail.com  Mon Feb  6 11:59:52 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 6 Feb 2012 11:59:52 +0000
Subject: [rabbitmq-discuss] Using Pika Python client library with
 BlockingConnections and publisher-confirms - Does it work?
In-Reply-To: <784D91D7-0D61-493E-8293-3CB827ABCBD7@rabbitmq.com>
References: <CB51B270.2B979%mpietrek@skytap.com>
	<784D91D7-0D61-493E-8293-3CB827ABCBD7@rabbitmq.com>
Message-ID: <CABzX+qzkkh-XjpX=t3K8dVta76pYBakH+9Y0spGvhh=Rafhaeg@mail.gmail.com>

<shameless plug>
It's rather simple using Puka:

    client = puka.Client("amqp://localhost/")

    promise = client.connect()
    client.wait(promise)

    promise = client.basic_publish(exchange='', routing_key='test',
body="Hello world!")
    client.wait(promise)

https://github.com/majek/puka/blob/master/examples/send.py
</shameless plug>

On Sat, Feb 4, 2012 at 11:56, Ask Solem <ask at rabbitmq.com> wrote:
>
> On 3 Feb 2012, at 23:49, Matt Pietrek wrote:
>
>>
>> Our app is such that the asynchronous processing model doesn't work for us. We want to reliably pull one message at a time off the queue, process it, acknowledge it, and be done with it.
>>
> [...]
>> And this is where I hit the wall. I can't get publisher-confirm callbacks to work. The callback is never called. Is this expected to work?
>
>
> AFAIK for publisher confirms to work you would need to drain events from
> the connection. ?Currently you are just writing data to the socket, and never
> reading the replies back, so the callback won't be triggered.
>
> Now, actually draining events while publishing messages is tricky in a blocking
> application, you would have to find some smart way of alternating between reading
> and writing to the socket. ?Maybe there are mechanisms in pika for this, but I don't know.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From pbell at syncsort.com  Mon Feb  6 12:37:48 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Mon, 6 Feb 2012 07:37:48 -0500
Subject: [rabbitmq-discuss] Queue Look-ahead, et alia
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1EC@MAILCCR.us.syncsort.com>

Hello All,

A few miscellaneous questions about RabbitMQ.....

1. Is it possible for a consumer to consume specific messages from a queue, e.g., one that contains a specific value (like a unique "request ID" that is part of each message)?

2. Is it possible for a consumer to "run a queue," e.g., visit each message in the queue without removing it?

3. Perhaps related to (1): does Rabbit support a kind of queue "peek" logic in the manner of Queue objects in C# and elsewhere? Peek allows one to obtain the queue head but leave it in place. (I know from previous threads on this list that message will remain in Q until expressly ack-ed, so maybe that's the answer.....)

Behind my questions is something I learned re Microsoft's Azure design. Its message queues can be manipulated via RESTful URIs. Consequently, the contents of an Azure queue can be queried, just as one might query data in the persistence layer.

I am not sure if we can do this via RabbitMQ. But I would like it if the queues could be "first-class citizens" in this regard. After all, they do contain and reflect useful state about the application. Suppose I have a message sitting in the queue that is waiting to be "dispatched" by a consumer. Now user wants to suspend the message (actually, suspend the task that will be dispatched in response to this message) so that it is no longer eligible for dispatch. How might I approach this with RabbitMQ? (I recall from an earlier thread that, because you can't modify a message in place, you'd have to read the message, update it (set "suspend") and then reinsert it into queue).

As always, thanks for your help.

-Paul



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From ask at rabbitmq.com  Mon Feb  6 12:40:10 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Mon, 6 Feb 2012 12:40:10 +0000
Subject: [rabbitmq-discuss] Using Pika Python client library with
	BlockingConnections and publisher-confirms - Does it work?
In-Reply-To: <CABzX+qzkkh-XjpX=t3K8dVta76pYBakH+9Y0spGvhh=Rafhaeg@mail.gmail.com>
References: <CB51B270.2B979%mpietrek@skytap.com>
	<784D91D7-0D61-493E-8293-3CB827ABCBD7@rabbitmq.com>
	<CABzX+qzkkh-XjpX=t3K8dVta76pYBakH+9Y0spGvhh=Rafhaeg@mail.gmail.com>
Message-ID: <A86C589E-9E61-4A39-A289-13A77975A8F5@rabbitmq.com>


On 6 Feb 2012, at 11:59, Marek Majkowski wrote:

> <shameless plug>
> It's rather simple using Puka:
> 
>   client = puka.Client("amqp://localhost/")
> 
>   promise = client.connect()
>   client.wait(promise)
> 
>   promise = client.basic_publish(exchange='', routing_key='test',
> body="Hello world!")
>   client.wait(promise)
> 
> https://github.com/majek/puka/blob/master/examples/send.py
> </shameless plug>


But that doesn't use publisher confirms?


It may take a long time for a confirmation to arrive, so blocking while
waiting for a publisher confirm is likely to be very inefficient.  But if that
is sufferable then this would also be possible using kombu/pika.

From emile at rabbitmq.com  Mon Feb  6 12:42:43 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 06 Feb 2012 12:42:43 +0000
Subject: [rabbitmq-discuss] Strange message loss behavior with mirrored
 queues
In-Reply-To: <4F2FAEC7.9010808@rabbitmq.com>
References: <CB516E06.2B8AB%mpietrek@skytap.com>
	<4F2FAEC7.9010808@rabbitmq.com>
Message-ID: <4F2FCAC3.6080601@rabbitmq.com>

Hi Matt,

On 06/02/12 10:43, Emile Joubert wrote:
> On 03/02/12 18:57, Matt Pietrek wrote:
>> I'm writing some basic throughput tests to verify that RabbitMQ will
>> scale to our needs in HA environments. In one scenario I'm finding
>> substantial message loss.

Just in case there is a bug lurking in this vicinity, can you supply me
with all the code that reproduces the problem? I'm not able to trigger
behaviour that matches your description from what you've supplied. Also
let me know what version of Pika you're using and whether anything
appears in the logfile. Feel free to send this off-list.


-Emile

From majek04 at gmail.com  Mon Feb  6 13:13:35 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 6 Feb 2012 13:13:35 +0000
Subject: [rabbitmq-discuss] Using Pika Python client library with
 BlockingConnections and publisher-confirms - Does it work?
In-Reply-To: <A86C589E-9E61-4A39-A289-13A77975A8F5@rabbitmq.com>
References: <CB51B270.2B979%mpietrek@skytap.com>
	<784D91D7-0D61-493E-8293-3CB827ABCBD7@rabbitmq.com>
	<CABzX+qzkkh-XjpX=t3K8dVta76pYBakH+9Y0spGvhh=Rafhaeg@mail.gmail.com>
	<A86C589E-9E61-4A39-A289-13A77975A8F5@rabbitmq.com>
Message-ID: <CABzX+qx5DFgSmv3qgnF=0Qm_45WJCoh-sQGYhFQkPdnce3aFLQ@mail.gmail.com>

On Mon, Feb 6, 2012 at 12:40, Ask Solem <ask at rabbitmq.com> wrote:
> On 6 Feb 2012, at 11:59, Marek Majkowski wrote:
>
>> <shameless plug>
>> It's rather simple using Puka:
>>
>> ? client = puka.Client("amqp://localhost/")
>>
>> ? promise = client.connect()
>> ? client.wait(promise)
>>
>> ? promise = client.basic_publish(exchange='', routing_key='test',
>> body="Hello world!")
>> ? client.wait(promise)
>>
>> https://github.com/majek/puka/blob/master/examples/send.py
>> </shameless plug>
>
>
> But that doesn't use publisher confirms?

Internally it does. `client.wait` will block until pub-ack or an
error comes back.

> It may take a long time for a confirmation to arrive, so blocking while
> waiting for a publisher confirm is likely to be very inefficient. ?But if that
> is sufferable then this would also be possible using kombu/pika.

You can do other things in the meantime, for example create queue
or publish another message, just need to synchronize at some point
(we're talking about  sync programming style here).

    promise1 = client.basic_publish(exchange='', routing_key='test',
body="Hello world!")

    promise2 = client.queue_declare(queue='test')
    client.wait(promise2)

    promise3 = client.basic_publish(exchange='', routing_key='test2',
body="Hello world!")
    client.wait(promise3)

    client.wait(promise1)

Of course you may wait for any of the three promises and so on.

(Alternatively you can use callbacks and async programming if
you want to know about the pub-ack when-it-happens, but
that's another story)

Marek

From emile at rabbitmq.com  Mon Feb  6 13:21:24 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 06 Feb 2012 13:21:24 +0000
Subject: [rabbitmq-discuss] .BasicReject(tag, false) & BasicAck
In-Reply-To: <CA+zYriRKep8AerXiAUVXYfzEzynuZXzf20epy89+oVJ9YXG-Ew@mail.gmail.com>
References: <CA+zYriRKep8AerXiAUVXYfzEzynuZXzf20epy89+oVJ9YXG-Ew@mail.gmail.com>
Message-ID: <4F2FD3D4.2030603@rabbitmq.com>

Hi Steven,

On 06/02/12 11:54, Steven Taylor wrote:
> BasicReject(deliveryTag, false) seems to be requing the
> message (probably due to having acknowledgements set). 

I'm not able to reproduce this. Rejecting without requeue drops the message.

> So, should I
> also acknowledge a message I'm about to reject? 

No, you cannot reject a message after acknowledging it.

> Does BasicReject send an asynchronous message back to sender when
> mandatory=true?

No, the "mandatory" parameter relates only to routing, i.e. whether the
message was routed to a queue. Subsequent actions by consumers cannot
cause return messages to be sent to publishers. Also see
http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.return


-Emile

From ask at rabbitmq.com  Mon Feb  6 13:34:05 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Mon, 6 Feb 2012 13:34:05 +0000
Subject: [rabbitmq-discuss] Using Pika Python client library with
	BlockingConnections and publisher-confirms - Does it work?
In-Reply-To: <CABzX+qx5DFgSmv3qgnF=0Qm_45WJCoh-sQGYhFQkPdnce3aFLQ@mail.gmail.com>
References: <CB51B270.2B979%mpietrek@skytap.com>
	<784D91D7-0D61-493E-8293-3CB827ABCBD7@rabbitmq.com>
	<CABzX+qzkkh-XjpX=t3K8dVta76pYBakH+9Y0spGvhh=Rafhaeg@mail.gmail.com>
	<A86C589E-9E61-4A39-A289-13A77975A8F5@rabbitmq.com>
	<CABzX+qx5DFgSmv3qgnF=0Qm_45WJCoh-sQGYhFQkPdnce3aFLQ@mail.gmail.com>
Message-ID: <8E89CC37-978A-4650-A604-D22FEB5F6868@rabbitmq.com>


On 6 Feb 2012, at 13:13, Marek Majkowski wrote:

> On Mon, Feb 6, 2012 at 12:40, Ask Solem <ask at rabbitmq.com> wrote:
>> On 6 Feb 2012, at 11:59, Marek Majkowski wrote:
>> 
>>> <shameless plug>
>>> It's rather simple using Puka:
>>> 
>>>   client = puka.Client("amqp://localhost/")
>>> 
>>>   promise = client.connect()
>>>   client.wait(promise)
>>> 
>>>   promise = client.basic_publish(exchange='', routing_key='test',
>>> body="Hello world!")
>>>   client.wait(promise)
>>> 
>>> https://github.com/majek/puka/blob/master/examples/send.py
>>> </shameless plug>
>> 
>> 
>> But that doesn't use publisher confirms?
> 
> Internally it does. `client.wait` will block until pub-ack or an
> error comes back.

Right, in pika/kombu you would use drain_events(), but that doesn't change
the points I presented.  Though, kombu/pika donsn't have a simple solution to wait
for a specific event like pika does (afaik).

If I had to do it synchronously, I would not do it on an event by event basis,
but instead limit the active number of publishes, something like:

class Confirming(object):
    active = 0
    limit = 10
    timeout = 180

    def __init__(self, channel, limit=None, timeout=None):
        self.channel = channel
        self.limit = limit if limit is not None else self.limit
        self.timeout = timeout or self.timeout

    def confirm_callback(self):
        self.active -= 1

    def publish(self, body, **options):
        self.active += 1
        while self.active >= self.limit:
            self.connection.drain_events(timeout=self.max_timeout)
        self.channel.basic_publish(message, **options)
        self.connection.drain_events(timeout=0.0001)

From emile at rabbitmq.com  Mon Feb  6 13:46:06 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 06 Feb 2012 13:46:06 +0000
Subject: [rabbitmq-discuss] Queue Look-ahead, et alia
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1EC@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1EC@MAILCCR.us.syncsort.com>
Message-ID: <4F2FD99E.2000501@rabbitmq.com>

Hi Paul,

On 06/02/12 12:37, Bell, Paul M. wrote:
> 1. Is it possible for a consumer to consume specific messages from a
> queue, e.g., one that contains a specific value (like a unique
> "request ID" that is part of each message)?

No, but if you are trying to match up requests with replies then
consider making use of a dedicated reply queue, in the way RPC does. The
6th tutorial explains in greater detail:
http://www.rabbitmq.com/tutorials/tutorial-six-java.html

> 2. Is it possible for a consumer to "run a queue," e.g., visit each
> message in the queue without removing it?

In theory a consumer could fetch many messages without acknowledgement,
acknowledge only those that match a filter and requeue the remainder.
Treating a queue like this strongly discouraged. The specification says
of basic.reject:

"The client MUST NOT use this method as a means of selecting messages to
process. "

If you require random access to messages then consider using a database,
or redesigning the message flow in such a way that consumers are able to
process all messages at the head of a queue.

> 3. Perhaps related to (1): does Rabbit support a kind of queue "peek"
> logic in the manner of Queue objects in C# and elsewhere? Peek allows
> one to obtain the queue head but leave it in place. (I know from
> previous threads on this list that message will remain in Q until
> expressly ack-ed, so maybe that's the answer.....)

A consumer can fetch and requeue a message from a queue, but (unless
there are other consumers consuming from the same queue) it will not
make any progress this way. The reason is that the consumer will see the
same message over and over.

> Behind my questions is something I learned re Microsoft's Azure
> design. Its message queues can be manipulated via RESTful URIs.
> Consequently, the contents of an Azure queue can be queried, just as
> one might query data in the persistence layer.

Data structures that can be browsed and manipulated in this way are not
strictly speaking queues. For performance reasons the internal data
structures in RabbitMQ have queues that do not permit random data access
patterns.




-Emile

From emile at rabbitmq.com  Mon Feb  6 13:54:34 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 06 Feb 2012 13:54:34 +0000
Subject: [rabbitmq-discuss] Acknowledgement bug with Tx
In-Reply-To: <0304b27a-eb4e-490e-a266-da6160990f97@g4g2000pbi.googlegroups.com>
References: <0304b27a-eb4e-490e-a266-da6160990f97@g4g2000pbi.googlegroups.com>
Message-ID: <4F2FDB9A.3030309@rabbitmq.com>

Hi,

On 05/02/12 06:48, Yogesh Ketkar wrote:
>     ch.basicAck(r.getEnvelope().getDeliveryTag(), false);

This acknowledgement will not take effect until the transaction is
committed. These pages contain more information:

http://www.rabbitmq.com/semantics.html
http://www.rabbitmq.com/amqp-0-9-1-quickref.html#class.tx

> And now if I pause the program, this state remains forever and if I
> kill the program, it looks like

That would be similar to rolling back the transaction.

> Strangely, it happens only the first time, i.e. If I keep on running
> this code, in the end status looks like.

Looping around will commit all but the last acknowledgement.


-Emile

From aaron at agoragames.com  Mon Feb  6 14:27:56 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 6 Feb 2012 09:27:56 -0500
Subject: [rabbitmq-discuss] Python example on event-driving consumer?
In-Reply-To: <4239019.1183.1328335910206.JavaMail.geo-discussion-forums@prdh15>
References: <d152e2e3-7ca4-4765-8314-5162aee37504@q7g2000yqn.googlegroups.com>
	<CAHiEoM5vBiCWucx_6SFXYpi6wToBX0pL_Z4P9Cxoc6Bby=NUNg@mail.gmail.com>
	<4239019.1183.1328335910206.JavaMail.geo-discussion-forums@prdh15>
Message-ID: <CAHiEoM5vFAm7mrVKdJZfjBVPW0knUJ6dA3C_1JHBonnNWzCi9g@mail.gmail.com>

I hope improved documentation is coming soon but the gist here is that
a greenlet should loop over read_frames() and that will drive events.
The IO is blocking to let gevent do all the work of scheduling socket
operations. In most cases, I recommend spawning a new greenlet in a
consumer callback but YMMV.

-Aaron


On Sat, Feb 4, 2012 at 1:11 AM, Mark Wong-VanHaren <markwvh at gmail.com> wrote:
> Hi, Aaron-
>
> Haigha looks really cool, and I'm interested to use it with gevent. ?Perhaps
> you could offer and example of how one does that?
>
> In your stress_test:
> ? ??https://github.com/agoragames/haigha/blob/master/scripts/stress_test
>
> I see that you're continually calling?connection.read_frames(), and I see a
> comment in the implementation of that method saying:
>
> ? # ?....in the case of gevent, this is how a blocking call to
> ? # read from the socket is kicked off.
>
> But I'm afraid I don't grok that or know what that means in terms of how one
> should use Haigha with gevent.
>
> Any help would be greatly appreciated. ?Thanks!
> -Mark
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From kyleo at 0b10.mx  Mon Feb  6 15:48:49 2012
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Mon, 06 Feb 2012 10:48:49 -0500 (EST)
Subject: [rabbitmq-discuss] rabbitmq stopped working after removing a static
	route
In-Reply-To: <76ba642d-6e16-44a2-8061-9706dc037dc3@mx1.0b10.mx>
Message-ID: <afb52ce5-07fc-4026-917d-634abffac3ae@mx1.0b10.mx>

Has anyone experienced this before?

I added a static route to 2 of the 5 servers in my rabbitmq cluster to facilitate a network change.  No rabbit issues after the route was added.  A few days later we were done with the network change and I removed the static routes...

Almost immediately the 2 rabbit nodes with the added/removed static route were no longer able to maintain a connection to the cluster.  

*note* the static route was on a different subnet than the rabbitmq network and rabbi

Here are the logs (treehorn=localhost):

=ERROR REPORT==== 4-Feb-2012::17:17:10 ===
** Node rabbit at biglebowski not responding **
** Removing (timedout) connection **

=ERROR REPORT==== 4-Feb-2012::17:17:10 ===
** Node rabbit at thedude not responding **
** Removing (timedout) connection **

=ERROR REPORT==== 4-Feb-2012::17:17:10 ===
** Node rabbit at bunny not responding **
** Removing (timedout) connection **

=INFO REPORT==== 4-Feb-2012::17:17:10 ===
node rabbit at biglebowski lost 'rabbit'

=ERROR REPORT==== 4-Feb-2012::17:17:25 ===
** Node rabbit at donny not responding **
** Removing (timedout) connection **

=INFO REPORT==== 4-Feb-2012::17:17:42 ===
node rabbit at thedude lost 'rabbit'

=INFO REPORT==== 4-Feb-2012::17:17:42 ===
node rabbit at bunny lost 'rabbit'

=INFO REPORT==== 4-Feb-2012::17:17:42 ===
node rabbit at donny lost 'rabbit'

=ERROR REPORT==== 4-Feb-2012::17:18:54 ===
Mnesia(rabbit at treehorn): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, rabbit at thedude}

=ERROR REPORT==== 4-Feb-2012::17:18:54 ===
Mnesia(rabbit at treehorn): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, rabbit at bunny}

=ERROR REPORT==== 4-Feb-2012::17:18:54 ===
Mnesia(rabbit at treehorn): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, rabbit at biglebowski}

=ERROR REPORT==== 4-Feb-2012::17:18:54 ===
Mnesia(rabbit at treehorn): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, rabbit at donny}

I had to stop/start rabbit on the 2 nodes in order for them to rejoin the cluster.

I can't imagine this is expected behavior, but is it a bug?

Thanks,
Kyle

From emile at rabbitmq.com  Mon Feb  6 16:02:25 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 06 Feb 2012 16:02:25 +0000
Subject: [rabbitmq-discuss] rabbitmq stopped working after removing a
 static route
In-Reply-To: <afb52ce5-07fc-4026-917d-634abffac3ae@mx1.0b10.mx>
References: <afb52ce5-07fc-4026-917d-634abffac3ae@mx1.0b10.mx>
Message-ID: <4F2FF991.1030007@rabbitmq.com>

Hi Kyle,

On 06/02/12 15:48, Kyle O'Donnell wrote:
> I can't imagine this is expected behavior, but is it a bug?

No, this is expected. RabbitMQ clusters do not tolerate network
partitions well, so it should not be used over unreliable links. The
shovel or federation plugins are better solutions in that case.


-Emile


From kyleo at 0b10.mx  Mon Feb  6 16:05:51 2012
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Mon, 06 Feb 2012 11:05:51 -0500 (EST)
Subject: [rabbitmq-discuss] rabbitmq stopped working after removing a
	static route
In-Reply-To: <4F2FF991.1030007@rabbitmq.com>
Message-ID: <86c98389-d255-46d3-90ec-115125c82e33@mx1.0b10.mx>

The network was not unreliable.  It did not go down at all.  The network change was an internet change.  The rabbit servers are all talking over a local network though.

----- Original Message -----
From: "Emile Joubert" <emile at rabbitmq.com>
To: "Kyle O'Donnell" <kyleo at 0b10.mx>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, February 6, 2012 11:02:25 AM
Subject: Re: [rabbitmq-discuss] rabbitmq stopped working after removing a static route

Hi Kyle,

On 06/02/12 15:48, Kyle O'Donnell wrote:
> I can't imagine this is expected behavior, but is it a bug?

No, this is expected. RabbitMQ clusters do not tolerate network
partitions well, so it should not be used over unreliable links. The
shovel or federation plugins are better solutions in that case.


-Emile


From emile at rabbitmq.com  Mon Feb  6 16:30:25 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 06 Feb 2012 16:30:25 +0000
Subject: [rabbitmq-discuss] rabbitmq stopped working after removing a
 static route
In-Reply-To: <86c98389-d255-46d3-90ec-115125c82e33@mx1.0b10.mx>
References: <86c98389-d255-46d3-90ec-115125c82e33@mx1.0b10.mx>
Message-ID: <4F300021.50001@rabbitmq.com>

Hi Kyle,

On 06/02/12 16:05, Kyle O'Donnell wrote:
> The network was not unreliable.  It did not go down at all.  The
> network change was an internet change.  The rabbit servers are all
> talking over a local network though.

The logfile you quoted is consistent with a network outage of some kind.
If that is a regular occurrence then clustering is not appropriate in
your environment.


-Emile

From Massimo.Paladin at cern.ch  Mon Feb  6 16:35:37 2012
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Mon, 6 Feb 2012 17:35:37 +0100
Subject: [rabbitmq-discuss] web interface on two ports and different
	settings: ssl and non ssl
In-Reply-To: <CAMOXM2_GFf+4o3-_1UmXPdogPcYao6NmuxE2-QHM7k4hJYbTzQ@mail.gmail.com>
References: <CAMOXM2_GFf+4o3-_1UmXPdogPcYao6NmuxE2-QHM7k4hJYbTzQ@mail.gmail.com>
Message-ID: <CAMOXM28X8V+TE8ZEswc37L6Yy3Kxy_S9YitzKUWaoaYyxAwg5w@mail.gmail.com>

Hello,

no one has an idea if this is possible?

It would be nice to have such configuration for different reasons:
- one port without ssl for monitoring access (lightweight, frequent access)
- one port enforced with ssl for admin access (more secure, data could be
more sensible)

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Fri, Feb 3, 2012 at 4:03 PM, Massimo Paladin <Massimo.Paladin at cern.ch>wrote:

> Hello,
>
> I am trying to configure rabbitmq web interface on two ports and with
> different settings:
> - one port without ssl
> - one port with ssl and ssl_opts
>
> Is this possible? I tried some configurations with no results, it listens
> only at one port.
>
> Cheers,
> ---
> Massimo Paladin
>
> email: massimo.paladin at gmail.com
> website: http://www.mpaladin.com
> flickr's page: http://flickr.com/photos/massimop
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120206/f78b0e14/attachment.htm>

From yogimogi at gmail.com  Mon Feb  6 17:04:54 2012
From: yogimogi at gmail.com (Yogesh Ketkar)
Date: Mon, 6 Feb 2012 09:04:54 -0800 (PST)
Subject: [rabbitmq-discuss] Acknowledgement bug with Tx
In-Reply-To: <4F2FDB9A.3030309@rabbitmq.com>
References: <0304b27a-eb4e-490e-a266-da6160990f97@g4g2000pbi.googlegroups.com>
	<4F2FDB9A.3030309@rabbitmq.com>
Message-ID: <2a6a5fe3-3b32-4bd2-a7d7-456bc654893d@s8g2000pbj.googlegroups.com>

Thanks Emile.

On Feb 6, 6:54?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> On 05/02/12 06:48, Yogesh Ketkar wrote:
>
> > ? ? ch.basicAck(r.getEnvelope().getDeliveryTag(), false);
>
> This acknowledgement will not take effect until the transaction is
> committed. These pages contain more information:
>
> http://www.rabbitmq.com/semantics.htmlhttp://www.rabbitmq.com/amqp-0-9-1-quickref.html#class.tx
>
> > And now if I pause the program, this state remains forever and if I
> > kill the program, it looks like
>
> That would be similar to rolling back the transaction.
>
> > Strangely, it happens only the first time, i.e. If I keep on running
> > this code, in the end status looks like.
>
> Looping around will commit all but the last acknowledgement.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Massimo.Paladin at cern.ch  Mon Feb  6 17:09:45 2012
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Mon, 6 Feb 2012 18:09:45 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin and ability to read configuration
	files
Message-ID: <CAMOXM2-yT_ZSX4_FkJpnh=GFX4_QT8pLKt+j8pnnZF6QHp1BmA@mail.gmail.com>

Hello,

with the intention of using rabbitmqadmin to automate rabbitmq configuration
we had to improve rabbitmqadmin to be able to read configuration files.

Such requirement was needed for different reasons:
- security: it is not very nice to launch commands with passwords in the
command line
- code duplication: previous point would have required to hard-code
username and password
  in rabbitmqadmin which is something we would like to avoid
- it is nice to have a single configuration file containing configuration
for multiple hosts
  and be able to recall that host from the command line

For such reasons I made some small changes to rabbitmqadmin to make it work
with configuration files.
The script doesn't brake backward compatibility.

The modified script:
https://github.com/mpaladin/rabbitmq-custom/blob/master/rabbitmqadmin/rabbitmqadmin

An example of configuration file:
https://github.com/mpaladin/rabbitmq-custom/blob/master/rabbitmqadmin/rabbitmqadmin.conf.example

To profit from the configuration file just run:
# rabbitmqadmin -c rabbitmqadmin.conf.example -N host_normal ...

Hopefully someone will benefit from this change and it would be nice to see
it in the next release.

The changes reflect this behavior:
- there are hard-coded default values (like before)
- eventual configuration file setting override the defaults
- command line override the result of the previous steps

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120206/951c60b6/attachment.htm>

From mpietrek at skytap.com  Mon Feb  6 17:43:34 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 06 Feb 2012 09:43:34 -0800
Subject: [rabbitmq-discuss] Strange message loss behavior with mirrored
 queues
In-Reply-To: <4F2FAEC7.9010808@rabbitmq.com>
Message-ID: <CB554E16.2BA39%mpietrek@skytap.com>

Hi Emile,

Thanks much for the reply. I certainly understand that in a mirrored
setup, message publishing will be slower. However, I still think there
some sort of issue here.

I could understand that I'd lose messages if I rapidly published 100,000
messages to the broker and then abruptly killed the broker. However,
that's not what happening. My app is writing the messages and then cleanly
existing without any errors, and nothing "bad" is happening to the broker.

While I would expect it might longer for the broker to catch up and
eventually process all 100,000 messages, it doesn't. Instead, it reports
that the queue has about 25,000 message (varies from run to run). I've
waited for 10 minutes and never seen any more messages appear in the queue.

Conversely, if I run the identical scenario without mirroring, all 100,000
message appear in the queue within seconds of my app exiting.

Also, I understand that with publisher-confirms I can wait till I see
100,000 messages written, but I wouldn't expect that *not* using them, and
simply exiting from my client process would cause messages to be lost. As
far as I can tell, all messages were sent on the wire to the broker, and
barring an error state in the broker, should eventually appear in the
queue.

I'll follow up offline with my exact code and config.

Thanks,

Matt

On 2/6/12 2:43 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:

>Hi Matt,
>
>On 03/02/12 18:57, Matt Pietrek wrote:
>> I'm writing some basic throughput tests to verify that RabbitMQ will
>> scale to our needs in HA environments. In one scenario I'm finding
>> substantial message loss.
>
>I wouldn't describe what you're seeing as message loss, rather a
>demonstration that publishing in a HA environment with more nodes is
>slower. Publishing is slower because it takes longer to send the
>messages to a greater number of nodes in the cluster.
>
>You should make use of publisher confirms
>(http://www.rabbitmq.com/extensions.html#publishing)
>to make sure that published messages have been safely received by the
>broker.
>
>
>-Emile



From mpietrek at skytap.com  Mon Feb  6 18:29:59 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 6 Feb 2012 10:29:59 -0800
Subject: [rabbitmq-discuss] Using Pika Python client library with
 BlockingConnections and publisher-confirms - Does it work?
In-Reply-To: <8E89CC37-978A-4650-A604-D22FEB5F6868@rabbitmq.com>
References: <CB51B270.2B979%mpietrek@skytap.com>
	<784D91D7-0D61-493E-8293-3CB827ABCBD7@rabbitmq.com>
	<CABzX+qzkkh-XjpX=t3K8dVta76pYBakH+9Y0spGvhh=Rafhaeg@mail.gmail.com>
	<A86C589E-9E61-4A39-A289-13A77975A8F5@rabbitmq.com>
	<CABzX+qx5DFgSmv3qgnF=0Qm_45WJCoh-sQGYhFQkPdnce3aFLQ@mail.gmail.com>
	<8E89CC37-978A-4650-A604-D22FEB5F6868@rabbitmq.com>
Message-ID: <CACLE7iwT6e9Vqh4301fH3gj5hM-MJRHPW1aROTqwsXnZL5UdyQ@mail.gmail.com>

Thanks Ask and Marek for your replies.

Let me circle back to the original issue. Our system just needs a reliable
way of knowing that once we've published a message, that it's safely in the
broker. The exact mechanics aren't particularly important.

Obviously transactions will work, but they slow things down to the point
where we're doubting the system performance will meet our needs. I'm happy
to experiment with publisher-confirms, but it seems that given our simple,
synchronous pattern, aren't easy to incorporate without contorting the
code. Perhaps I'm wrong, and if so, feel free to correct me.

What's your take here? What's the best path forward?

In a related question, can either of you offer some insights on the planned
futures of Pika / Puka / Kombu in terms of being client libraries we should
rely on for commercial app development?

Obviously if there were an official RabbitMQ Python client library, we'd
choose that. In the absence of that, we're trying to evaluate the viability
of Pika/Puka/Kombu, and whatever else is out there. However, it's hard to
get a sense for what is "the future" and what may not be a good choice 3
years from now.

Thanks again,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120206/158b4eaf/attachment.htm>

From gmr at myyearbook.com  Mon Feb  6 18:47:14 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 6 Feb 2012 13:47:14 -0500
Subject: [rabbitmq-discuss] Using Pika Python client library with
 BlockingConnections and publisher-confirms - Does it work?
In-Reply-To: <CACLE7iwT6e9Vqh4301fH3gj5hM-MJRHPW1aROTqwsXnZL5UdyQ@mail.gmail.com>
References: <CB51B270.2B979%mpietrek@skytap.com>
	<784D91D7-0D61-493E-8293-3CB827ABCBD7@rabbitmq.com>
	<CABzX+qzkkh-XjpX=t3K8dVta76pYBakH+9Y0spGvhh=Rafhaeg@mail.gmail.com>
	<A86C589E-9E61-4A39-A289-13A77975A8F5@rabbitmq.com>
	<CABzX+qx5DFgSmv3qgnF=0Qm_45WJCoh-sQGYhFQkPdnce3aFLQ@mail.gmail.com>
	<8E89CC37-978A-4650-A604-D22FEB5F6868@rabbitmq.com>
	<CACLE7iwT6e9Vqh4301fH3gj5hM-MJRHPW1aROTqwsXnZL5UdyQ@mail.gmail.com>
Message-ID: <EC33259C71DB461EA0F4BE4D2FE04F2C@myyearbook.com>

There are multiple ways, the best from my perspective is Publisher confirms: http://www.rabbitmq.com/extensions.html#confirms

Using Pika, you'll have to grab the master branch at github as 0.9.5 does not support them and 0.9.6 is not released yet (though I am making progress in adding the test coverage I'd like to have there prior to releasing it)

Here's the method to enable it:

https://github.com/pika/pika/blob/master/pika/channel.py#L527

In short:

channel.confirm_delivery(delivery_confirmation_callback)

When a message is delivered, you'll now get a callback frame/message to the delivery_confirmation_callback method (whatever you replace that with).

In doing this you'll need to keep track of what you published, sequence wise on the channel to use to validate the delivery tag in the Basic.Ack frame.

Hope this helps,

Gavin


On Monday, February 6, 2012 at 1:29 PM, Matt Pietrek wrote:

> Thanks Ask and Marek for your replies.
> 
> Let me circle back to the original issue. Our system just needs a reliable way of knowing that once we've published a message, that it's safely in the broker. The exact mechanics aren't particularly important.
> 
> Obviously transactions will work, but they slow things down to the point where we're doubting the system performance will meet our needs. I'm happy to experiment with publisher-confirms, but it seems that given our simple, synchronous pattern, aren't easy to incorporate without contorting the code. Perhaps I'm wrong, and if so, feel free to correct me.
> 
> What's your take here? What's the best path forward?
> 
> In a related question, can either of you offer some insights on the planned futures of Pika / Puka / Kombu in terms of being client libraries we should rely on for commercial app development?
> 
> Obviously if there were an official RabbitMQ Python client library, we'd choose that. In the absence of that, we're trying to evaluate the viability of Pika/Puka/Kombu, and whatever else is out there. However, it's hard to get a sense for what is "the future" and what may not be a good choice 3 years from now.
> 
> Thanks again,
> 
> Matt
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120206/4c08c90a/attachment.htm>

From mpietrek at skytap.com  Mon Feb  6 19:27:41 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 06 Feb 2012 11:27:41 -0800
Subject: [rabbitmq-discuss] Looking for some clarification on mirrored queue
	implementation
Message-ID: <CB5569AD.2BAC7%mpietrek@skytap.com>

Here at work, we've been having a spirited debate about the RabbitMQ
descriptions on how HA/mirrored durable queues work. I apologize in advance
if this seems like I'm splitting hairs below, but our team have some very
specific questions regarding the exact wording. While nobody doubts the  end
result of mirroring, the mechanics of *exactly* how this happen are the
subject of debate here. As the designated point person for RabbitMQ in our
company, I'm responsible for driving these questions to closure.

First, I'll mention that we've read and re-read "Highly Available Queues"
and "High Availability in RabbitMQ: solving part of the puzzle" multiple
times.

http://www.rabbitmq.com/ha.html
http://www.rabbitmq.com/blog/2011/10/25/high-availability-in-rabbitmq-solvin
g-part-of-the-puzzle/

The crux of the questions come down to these quotes:

--
"The slaves apply the operations that occur to the master in exactly the
same order as the master and thus maintain the same state. All actions other
than publishes go only to the master, and the master then broadcasts the
effect of the actions to the slaves. Thus clients consuming from a mirrored
queue are in fact consuming from the master."

and

"messages published to a mirrored-queue are always published directly to the
master and all slaves."
--

One interpretation of the 2nd quote above ("published directly to...") is
that clients are responsible for writing their messages to the master *as
well as* to all slaves. Perhaps there's some mechanism where at connect
time, the master sends a list of servers to the connecting client, and the
client writes to all instances in the list.

Other people have a different interpretation of how this works, which is
that publishes to *any* broker instances are forwarded by the receiving
slave to the master instance, which in turn pushes the publish requests to
all slaves. (Of course, if the master received the message initially,
there's no need for forwarding.)

Simple question: Which of the above interpretations is correct?

Follow up question: What is the exact flow for a publish that goes to a
slave? Does the slave do anything other than push the message to the master,
which in turn handles the message as if it came to the master in the first
place? Perhaps it writes the message to the local store first, then pushes
it to the master? (Like I said, spirited debate.)

Thanks much for your help,

Matt



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120206/3e6e9dd3/attachment.htm>

From mpietrek at skytap.com  Mon Feb  6 20:11:13 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 6 Feb 2012 12:11:13 -0800
Subject: [rabbitmq-discuss] Using Pika Python client library with
 BlockingConnections and publisher-confirms - Does it work?
In-Reply-To: <EC33259C71DB461EA0F4BE4D2FE04F2C@myyearbook.com>
References: <CB51B270.2B979%mpietrek@skytap.com>
	<784D91D7-0D61-493E-8293-3CB827ABCBD7@rabbitmq.com>
	<CABzX+qzkkh-XjpX=t3K8dVta76pYBakH+9Y0spGvhh=Rafhaeg@mail.gmail.com>
	<A86C589E-9E61-4A39-A289-13A77975A8F5@rabbitmq.com>
	<CABzX+qx5DFgSmv3qgnF=0Qm_45WJCoh-sQGYhFQkPdnce3aFLQ@mail.gmail.com>
	<8E89CC37-978A-4650-A604-D22FEB5F6868@rabbitmq.com>
	<CACLE7iwT6e9Vqh4301fH3gj5hM-MJRHPW1aROTqwsXnZL5UdyQ@mail.gmail.com>
	<EC33259C71DB461EA0F4BE4D2FE04F2C@myyearbook.com>
Message-ID: <CACLE7izUyjdwKTeAQMiRWNwMSzVBS4W7zv7n_JHTCby8P=7=rg@mail.gmail.com>

Hi Gavin,

I've grabbed the latest master, and when I my test app, I get:

("'CallbackManager' object has no attribute 'sanitize'",)

Grepping through the code, I don't see an implementation for Sanitize
anywhere. Callstack looks like this:

_on_rpc_complete [blocking_connection.py:230]
process [callback.py:161]
_on_data_available [connection.py:701]
_handle_read [base_connection.py:315]
process_data_events [blocking_connection.py:95]
send_method [blocking_connection.py:254]
open [channel.py:236]
__init__ [blocking_connection.py:274]
channel [blocking_connection.py:129]
connect [throughput_confirms.py:19]
<module> [throughput_confirms.py:108]


    def _on_rpc_complete(self, frame):
>>>        key = self.callbacks.sanitize(frame)

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120206/34c0cd48/attachment.htm>

From dawgtool at aol.com  Mon Feb  6 23:15:54 2012
From: dawgtool at aol.com (DawgTool)
Date: Mon, 06 Feb 2012 18:15:54 -0500
Subject: [rabbitmq-discuss] Random Disconnects (bad_payload) - 2012-02-06
Message-ID: <4F305F2A.7020502@aol.com>

Howdy,  Looks like I'm running into an issue with a bad payload.  Not 
sure what is going on here, couldn't find a lot of information about 
this on the threads. Any ideas?
Thanks


=ERROR REPORT==== 6-Feb-2012::18:09:28 ===
exception on TCP connection <0.14549.1> from 192.168.0.95:37453
{bad_payload,3,1,444,
<<0,60,0,0,0,0,0,0,0,0,1,188,208,0,24,97,112,112,108,105,99,97,
                116,105,111,110,47,111,99,116,101,116,45,115,116,114,101,97,
                109,11,101,110,95,85,83,46,85,84,70,45,56,2,206,3,0,5,0,0,1,
                
216,3,35,233,7,0,0,0,0,128,210,108,176,58,0,0,0,240,34,233,7,0,
                
0,0,0,208,33,233,7,0,0,0,0,216,1,0,0,0,0,0,0,208,33,233,7,0,0,
                
0,0,248,255,1,0,0,0,0,0,49,117,99,0,0,0,0,0,240,34,233,7,0,0,0,
                
0,7,0,0,0,0,0,0,0,208,61,91,64,0,0,0,0,216,1,0,0,0,0,0,0,95,62,
                
91,64,0,0,0,0,1,0,0,0,0,0,0,0,236,255,1,0,0,0,0,0,3,35,233,7,0,
                
0,0,0,128,63,91,64,0,0,0,0,79,83,52,52,78,83,52,206,77,84,81,
                
117,77,84,81,119,216,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,199,131,99,
                
0,0,0,0,0,73,81,65,102,89,50,5,0,208,61,91,64,0,0,0,0,0,0,0,0,
                
0,0,0,0,164,72,111,0,0,0,0,0,14,0,0,0,0,0,0,0,192,32,233,7,0,0,
                
0,0,65,66,103,65,67,110,78,108,99,51,78,112,98,50,53,102,97,87,
                
81,65,65,103,65,73,65,65,89,120,77,122,65,48,77,122,81,65,65,
                
81,65,113,65,65,112,108,100,109,86,117,100,70,57,48,97,87,49,
                108,65,65,73,65,71,103,65,89,77,106,65,120,77,105,48,119,77,
                
105,48,119,78,108,81,121,77,122,111,119,79,84,111,121,79,67,52,
                
49,79,84,86,97,65,65,69,65,68,65,65,68,89,109,108,107,65,65,73,
                
65,65,119,65,66,77,81,65,66,65,67,65,65,67,50,82,112,99,50,78,
                
102,99,109,86,104,99,50,57,117,65,65,73,65,68,119,65,78,81,50,
                120,112,90,87,53,48,73,69,120,118,90>>}

=INFO REPORT==== 6-Feb-2012::18:09:28 ===
closing TCP connection <0.14549.1> from 192.168.0.95:37453

=ERROR REPORT==== 6-Feb-2012::18:10:50 ===
exception on TCP connection <0.18459.1> from 192.168.0.117:50564
{bad_payload,3,4,432,
<<248,255,1,0,0,0,0,0,236,255,1,0,0,0,0,0,179,80,227,20,0,0,0,0,
                
208,206,12,178,56,0,0,0,160,80,227,20,0,0,0,0,128,79,227,20,0,
                
0,0,0,220,1,0,0,0,0,0,0,128,79,227,20,0,0,0,0,248,255,1,0,0,0,
                
0,0,49,117,99,0,0,0,0,0,160,80,227,20,0,0,0,0,7,0,0,0,0,0,0,0,
                
192,109,82,64,0,0,0,0,220,1,0,0,0,0,0,0,95,110,82,64,0,0,0,0,1,
                0,0,0,0,0,0,0,236,255,1,0,0,0,0,0,179,80,227,20,0,0,0,0,128,
                
111,82,64,0,0,0,0,65,65,69,65,77,65,65,206,98,87,70,112,98,70,
                
57,111,220,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,199,131,99,0,0,0,0,0,
                
77,68,86,106,76,110,3,0,192,109,82,64,0,0,0,0,0,0,0,0,0,0,0,0,
                
164,72,111,0,0,0,0,0,14,0,0,0,0,0,0,0,112,78,227,20,0,0,0,0,97,
                
87,81,65,65,103,65,75,65,65,103,120,77,68,85,121,79,68,89,53,
                
78,81,65,66,65,67,111,65,67,109,86,50,90,87,53,48,88,51,82,112,
                
98,87,85,65,65,103,65,97,65,66,103,121,77,68,69,121,76,84,65,
                121,76,84,65,50,86,68,73,122,79,106,69,119,79,106,85,119,76,
                
106,89,48,78,108,111,65,65,81,65,77,65,65,78,105,97,87,81,65,
                65,103,65,68,65,65,69,121,65,65,69,65,73,65,65,76,90,71,108,
                
122,89,49,57,121,90,87,70,122,98,50,52,65,65,103,65,80,65,65,
                
49,68,98,71,108,108,98,110,81,103,84,71,57,110,98,51,86,48,65,
                
65,69,65,69,81,65,71,89,110,74,104,98,109,82,112,65,65,73,65,
                
66,81,65,68,77,84,65,119,65,65,69,65,73,103,65,74,89,87,78,106,
                100>>}

=INFO REPORT==== 6-Feb-2012::18:10:50 ===
closing TCP connection <0.18459.1> from 192.168.0.117:50564


From alexandru at rabbitmq.com  Mon Feb  6 23:28:14 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 6 Feb 2012 23:28:14 +0000
Subject: [rabbitmq-discuss] Random Disconnects (bad_payload) - 2012-02-06
In-Reply-To: <4F305F2A.7020502@aol.com>
References: <4F305F2A.7020502@aol.com>
Message-ID: <20120206232814.GD3593@southbank.Home>

Hi,

That means a client sent a malformed AMQP frame to RabbitMQ, so the
broker terminated the connection.

What client are you using?

Cheers,
Alex

On Mon, Feb 06, 2012 at 06:15:54PM -0500, DawgTool wrote:
> Howdy,  Looks like I'm running into an issue with a bad payload.  Not 
> sure what is going on here, couldn't find a lot of information about 
> this on the threads. Any ideas?
> Thanks
> 
> 
> =ERROR REPORT==== 6-Feb-2012::18:09:28 ===
> exception on TCP connection <0.14549.1> from 192.168.0.95:37453
> {bad_payload,3,1,444,
> <<0,60,0,0,0,0,0,0,0,0,1,188,208,0,24,97,112,112,108,105,99,97,
>                 116,105,111,110,47,111,99,116,101,116,45,115,116,114,101,97,
>                 109,11,101,110,95,85,83,46,85,84,70,45,56,2,206,3,0,5,0,0,1,
>                 
> 216,3,35,233,7,0,0,0,0,128,210,108,176,58,0,0,0,240,34,233,7,0,
>                 
> 0,0,0,208,33,233,7,0,0,0,0,216,1,0,0,0,0,0,0,208,33,233,7,0,0,
>                 
> 0,0,248,255,1,0,0,0,0,0,49,117,99,0,0,0,0,0,240,34,233,7,0,0,0,
>                 
> 0,7,0,0,0,0,0,0,0,208,61,91,64,0,0,0,0,216,1,0,0,0,0,0,0,95,62,
>                 
> 91,64,0,0,0,0,1,0,0,0,0,0,0,0,236,255,1,0,0,0,0,0,3,35,233,7,0,
>                 
> 0,0,0,128,63,91,64,0,0,0,0,79,83,52,52,78,83,52,206,77,84,81,
>                 
> 117,77,84,81,119,216,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,199,131,99,
>                 
> 0,0,0,0,0,73,81,65,102,89,50,5,0,208,61,91,64,0,0,0,0,0,0,0,0,
>                 
> 0,0,0,0,164,72,111,0,0,0,0,0,14,0,0,0,0,0,0,0,192,32,233,7,0,0,
>                 
> 0,0,65,66,103,65,67,110,78,108,99,51,78,112,98,50,53,102,97,87,
>                 
> 81,65,65,103,65,73,65,65,89,120,77,122,65,48,77,122,81,65,65,
>                 
> 81,65,113,65,65,112,108,100,109,86,117,100,70,57,48,97,87,49,
>                 108,65,65,73,65,71,103,65,89,77,106,65,120,77,105,48,119,77,
>                 
> 105,48,119,78,108,81,121,77,122,111,119,79,84,111,121,79,67,52,
>                 
> 49,79,84,86,97,65,65,69,65,68,65,65,68,89,109,108,107,65,65,73,
>                 
> 65,65,119,65,66,77,81,65,66,65,67,65,65,67,50,82,112,99,50,78,
>                 
> 102,99,109,86,104,99,50,57,117,65,65,73,65,68,119,65,78,81,50,
>                 120,112,90,87,53,48,73,69,120,118,90>>}
> 
> =INFO REPORT==== 6-Feb-2012::18:09:28 ===
> closing TCP connection <0.14549.1> from 192.168.0.95:37453
> 
> =ERROR REPORT==== 6-Feb-2012::18:10:50 ===
> exception on TCP connection <0.18459.1> from 192.168.0.117:50564
> {bad_payload,3,4,432,
> <<248,255,1,0,0,0,0,0,236,255,1,0,0,0,0,0,179,80,227,20,0,0,0,0,
>                 
> 208,206,12,178,56,0,0,0,160,80,227,20,0,0,0,0,128,79,227,20,0,
>                 
> 0,0,0,220,1,0,0,0,0,0,0,128,79,227,20,0,0,0,0,248,255,1,0,0,0,
>                 
> 0,0,49,117,99,0,0,0,0,0,160,80,227,20,0,0,0,0,7,0,0,0,0,0,0,0,
>                 
> 192,109,82,64,0,0,0,0,220,1,0,0,0,0,0,0,95,110,82,64,0,0,0,0,1,
>                 0,0,0,0,0,0,0,236,255,1,0,0,0,0,0,179,80,227,20,0,0,0,0,128,
>                 
> 111,82,64,0,0,0,0,65,65,69,65,77,65,65,206,98,87,70,112,98,70,
>                 
> 57,111,220,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,199,131,99,0,0,0,0,0,
>                 
> 77,68,86,106,76,110,3,0,192,109,82,64,0,0,0,0,0,0,0,0,0,0,0,0,
>                 
> 164,72,111,0,0,0,0,0,14,0,0,0,0,0,0,0,112,78,227,20,0,0,0,0,97,
>                 
> 87,81,65,65,103,65,75,65,65,103,120,77,68,85,121,79,68,89,53,
>                 
> 78,81,65,66,65,67,111,65,67,109,86,50,90,87,53,48,88,51,82,112,
>                 
> 98,87,85,65,65,103,65,97,65,66,103,121,77,68,69,121,76,84,65,
>                 121,76,84,65,50,86,68,73,122,79,106,69,119,79,106,85,119,76,
>                 
> 106,89,48,78,108,111,65,65,81,65,77,65,65,78,105,97,87,81,65,
>                 65,103,65,68,65,65,69,121,65,65,69,65,73,65,65,76,90,71,108,
>                 
> 122,89,49,57,121,90,87,70,122,98,50,52,65,65,103,65,80,65,65,
>                 
> 49,68,98,71,108,108,98,110,81,103,84,71,57,110,98,51,86,48,65,
>                 
> 65,69,65,69,81,65,71,89,110,74,104,98,109,82,112,65,65,73,65,
>                 
> 66,81,65,68,77,84,65,119,65,65,69,65,73,103,65,74,89,87,78,106,
>                 100>>}
> 
> =INFO REPORT==== 6-Feb-2012::18:10:50 ===
> closing TCP connection <0.18459.1> from 192.168.0.117:50564
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From wangxf at hundsun.com  Tue Feb  7 02:10:43 2012
From: wangxf at hundsun.com (=?gb2312?B?zfXRp7fJ?=)
Date: Tue, 7 Feb 2012 02:10:43 +0000
Subject: [rabbitmq-discuss] blocked during stopping MQ
Message-ID: <BCDA1FDAD4F49A42B7A93C11B4C46FB50932DF@HSMAILBOX02.hs.handsome.com.cn>

Hi, all

Generally, it takes only seconds to stop MQ by using ?service rabbitmq-server stop?. But, some time, the stopping process would be clocked or returned after several minutes. Could anybody tell me the possible reasons to cause this problem? I appreciate it a lot.

Thanks,

Wright

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/95ecd3d8/attachment.htm>

From samc at catalyst.net.nz  Tue Feb  7 02:45:43 2012
From: samc at catalyst.net.nz (Sam Crawley)
Date: Tue, 07 Feb 2012 15:45:43 +1300
Subject: [rabbitmq-discuss] Possibly latency issues
Message-ID: <1328582743.2123.28.camel@samc-pc.wgtn.cat-it.co.nz>

Hi,

I've been trying to track down some performance issues in our
application since switching to RabbitMQ (previously used Spread), and it
seems latency for a single round trip message is an issue.

In a simple(ish) benchmark I've created, I have a daemon that blocks,
waiting for a message. When it receives one, it sends a message back to
the original sender. I then have a script that runs on another machine
(on the same LAN), which sends messages of about 5k in size, and records
the time for the round trip.

In these tests, I get an average of about 0.1s for the round trip. Does
this seem unreasonably slow? In an identical test using Spread, I get
times of around 0.01s (the application performance issue we're seeing is
showing RabbitMQ about 3-4 times slower than Spread).

I realise it's quite likely the problem is something odd I'm doing, but
I just want to rule out anything obvious at this stage. Could it be OS,
Erlang version, etc?

I'm running on Debian Lenny, with RabbitMQ 2.7.1, and Erlang 12b3 (from
the standard Lenny package). Are there any known issues with this
configuration, or any other factors I might be missing?

The client is written in Perl, using a home-grown client (but based on
Net::AMQP), as there wasn't really much suitable to our purposes on
CPAN. I hope to have this client on CPAN sometime soon, and will likely
ask for a review for people who might have comments. It's possible
(likely?) it's not as efficient as it could be, and would be nice to
rule that out somehow.

Would appreciate any help.. apologies if I haven't given all the
relevant information.

Thanks,
Sam Crawley.


From mihirm at omc-international.com.au  Tue Feb  7 03:48:30 2012
From: mihirm at omc-international.com.au (Mihir Mone)
Date: Tue, 07 Feb 2012 14:48:30 +1100
Subject: [rabbitmq-discuss] RabbitMQ shovel adding random underscore '_'
 characters in message payload
Message-ID: <4F309F0E.7030208@omc-international.com.au>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/03177055/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: remote-site.png
Type: image/png
Size: 71581 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/03177055/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: local-site.png
Type: image/png
Size: 62325 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/03177055/attachment-0001.png>

From chrisch at ecollege.com  Tue Feb  7 04:50:00 2012
From: chrisch at ecollege.com (Chris Chew)
Date: Tue, 7 Feb 2012 04:50:00 +0000
Subject: [rabbitmq-discuss] Possibly latency issues
In-Reply-To: <1328582743.2123.28.camel@samc-pc.wgtn.cat-it.co.nz>
References: <1328582743.2123.28.camel@samc-pc.wgtn.cat-it.co.nz>
Message-ID: <69CA5A89-1A5E-4EEB-9255-059264DB254E@ecollege.com>

Hi Sam.

It's definitely worth trying a new version of Erlang.  Something in the 14B range or newer should perform noticeably better.

Also, are you doing a basicGet or basicConsume when listening for the messages?

Cheers,

Chris

On Feb 6, 2012, at 19:46, "Sam Crawley" <samc at catalyst.net.nz> wrote:

> Hi,
> 
> I've been trying to track down some performance issues in our
> application since switching to RabbitMQ (previously used Spread), and it
> seems latency for a single round trip message is an issue.
> 
> In a simple(ish) benchmark I've created, I have a daemon that blocks,
> waiting for a message. When it receives one, it sends a message back to
> the original sender. I then have a script that runs on another machine
> (on the same LAN), which sends messages of about 5k in size, and records
> the time for the round trip.
> 
> In these tests, I get an average of about 0.1s for the round trip. Does
> this seem unreasonably slow? In an identical test using Spread, I get
> times of around 0.01s (the application performance issue we're seeing is
> showing RabbitMQ about 3-4 times slower than Spread).
> 
> I realise it's quite likely the problem is something odd I'm doing, but
> I just want to rule out anything obvious at this stage. Could it be OS,
> Erlang version, etc?
> 
> I'm running on Debian Lenny, with RabbitMQ 2.7.1, and Erlang 12b3 (from
> the standard Lenny package). Are there any known issues with this
> configuration, or any other factors I might be missing?
> 
> The client is written in Perl, using a home-grown client (but based on
> Net::AMQP), as there wasn't really much suitable to our purposes on
> CPAN. I hope to have this client on CPAN sometime soon, and will likely
> ask for a review for people who might have comments. It's possible
> (likely?) it's not as efficient as it could be, and would be nice to
> rule that out somehow.
> 
> Would appreciate any help.. apologies if I haven't given all the
> relevant information.
> 
> Thanks,
> Sam Crawley.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From taylste at gmail.com  Tue Feb  7 05:10:45 2012
From: taylste at gmail.com (Steven Taylor)
Date: Tue, 7 Feb 2012 05:10:45 +0000
Subject: [rabbitmq-discuss] .NET client connection shutdown codes
In-Reply-To: <4F2FAB0D.30100@rabbitmq.com>
References: <CAOn7oW8-mgm3CvhTKFYZ-0Q+qzXYgYmw3k1a+qcjPpczXxE2XA@mail.gmail.com>
	<4F2FAB0D.30100@rabbitmq.com>
Message-ID: <CA+zYriS+pZzvqKFW1UDuroc=Uhq7X4+jVbR-yF5WYJuQFBt-zA@mail.gmail.com>

If you wanted to, the RabbitMQ team could subclass the AQMP error codes.
i.e. treat the AQMP number as the category, and then have a unique cause
numbers underneath these.

Is there any guidance on the site / in PDF on getting subscribers to
reconnect + reponding to these events in a fault tolerant way?  I mean, I /
we can evolve an approach, but if there was a starting point / code
example, that would be really helpful.

btw: recently in debugging, I appreciated that using the same DeliveryTag
twice generated an exception, but I'm not sure that the channel should have
automatically disconnected. Just thought I'd mention it.

thanks,
-Steven

On 6 February 2012 10:27, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Simone,
>
> On 03/02/12 23:54, Simone Busoli wrote:
> > Hi, I'm trying to figure out what values the ShutdownEventArgs.ReplyCode
> > property can be assigned by the .NET client.
>
> Thanks for your feedback. There is a relative scarcity of error codes.
> The AMQP specification only defines only a small number, which means
> that some codes have to be re-used. "Precondition failed" (406) is a
> good example of a code that is widely used, so the code alone does not
> identify a unique problem.
>
> The code in your example is "Internal error" (541). This code should be
> read as an error class and you need to inspect the error message for
> more detail.
>
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/8582571d/attachment.htm>

From absorbb at gmail.com  Tue Feb  7 06:02:13 2012
From: absorbb at gmail.com (=?KOI8-R?B?6czYxMHSIO7V0snTzMHNz9c=?=)
Date: Tue, 7 Feb 2012 09:02:13 +0300
Subject: [rabbitmq-discuss] Bug: Java ConnectionFactory can hangs forever in
	network packet loss cases
Message-ID: <CACYRexfFE2Es7FK-MzeOtWZ3WB77=7QRtY9fxnNXYHQeohZGpQ@mail.gmail.com>

Hello.

We have rabbitMQ 2.7.1 java clients remotely connected to the server.
We started experience short-term bad network scenarios and serious problem
occurred:
1. factory.setRequestedHeartbeat set to 30s
2. factory.setConnectionTimeout set to 30000ms
client properly closes connection after missing 30 seconds of heartbeats.
But sometimes it hangs completely when tries to open a new connection.

I tried to analyze java client code and what is result:

AMQConnection.java:286 :
          _frameHandler.setTimeout(HANDSHAKE_TIMEOUT); - socket.soTimeout
is set to 10s here
then it starts the MainLoop at line 294
and blocks till get a reply for a handshake at line 300:
     connStart =
                (AMQP.Connection.Start)
connStartBlocker.getReply().getMethod();

problem is that it's possible that it'll never get a reply. Because
MainLoop relies on heartbeats functional to handle such situation which is
not enabled yet. It happens only at line 368:
            setHeartbeat(heartbeat);
MainLoop endlessly runs at 492:
    Frame frame = _frameHandler.readFrame();
which returns null every 10s (this is how SocketTimeoutException handled in
Frame.readFrom..)
and handleSocketTimeout() do nothing because _heartbeat is not set yet.

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/2459d7d6/attachment.htm>

From preetisp_83 at yahoo.com  Tue Feb  7 08:32:49 2012
From: preetisp_83 at yahoo.com (preeti sp)
Date: Tue, 7 Feb 2012 00:32:49 -0800 (PST)
Subject: [rabbitmq-discuss] Regd: Publish Many Scenarios
In-Reply-To: <1327936779.39363.YahooMailClassic@web39302.mail.mud.yahoo.com>
Message-ID: <1328603569.14561.YahooMailClassic@web39305.mail.mud.yahoo.com>

Hi

Is there any way we could handle the scenario of Multiple Producers and Multiple Consumers bound to the same Queue using RabbitMQ ? Description below!

(1) Bind Multiple consumers to one Queue based on some binding keys
(2) Multiple publishers publish some messages to the above Queue
(3) And, Ensure each of the consumers get a copy of each message published on above Queue. Meaning, If there are 5 Producers and each Producer is publishing one message each, there would be total 5 Message. Now, Assume there are 5 Consumers. I want to ensure each Consumer gets a copy of each Message from RabbitMQ!

Thanks,
Preeti
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/fe95ab2d/attachment.htm>

From emile at rabbitmq.com  Tue Feb  7 09:50:35 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 07 Feb 2012 09:50:35 +0000
Subject: [rabbitmq-discuss] Regd: Publish Many Scenarios
In-Reply-To: <1328603569.14561.YahooMailClassic@web39305.mail.mud.yahoo.com>
References: <1328603569.14561.YahooMailClassic@web39305.mail.mud.yahoo.com>
Message-ID: <4F30F3EB.2040805@rabbitmq.com>

Hi,

On 07/02/12 08:32, preeti sp wrote:
> Is there any way we could handle the scenario of Multiple Producers and
> Multiple Consumers bound to the same Queue using RabbitMQ ? Description
> below!
> 
> (1) Bind Multiple consumers to one Queue based on some binding keys

Yes, it is possible for multiple consumers to subscribe to the same
queue, but each message will only be delivered to one consumer. If you
want each consumer to receive each message then you will need to declare
a queue for each consumer and bind the queues to an exchange. Compare
the second and third tutorials for an illustration:
http://www.rabbitmq.com/getstarted.html

> (2) Multiple publishers publish some messages to the above Queue

Yes, but bear in mind that publishers publish to an exchange, not to a
queue directly.

> (3) And, Ensure each of the consumers get a copy of each message

No, see the answer to (1) above.



-Emile

From alexandru at rabbitmq.com  Tue Feb  7 10:02:43 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 7 Feb 2012 10:02:43 +0000
Subject: [rabbitmq-discuss] blocked during stopping MQ
In-Reply-To: <BCDA1FDAD4F49A42B7A93C11B4C46FB50932DF@HSMAILBOX02.hs.handsome.com.cn>
References: <BCDA1FDAD4F49A42B7A93C11B4C46FB50932DF@HSMAILBOX02.hs.handsome.com.cn>
Message-ID: <20120207100243.GF3593@southbank.Home>

Hi Wright,

RabbitMQ usually takes a long time to shutdown if it has a lot of
durable queues and a lot of persistent messages.

If you haven't already, you should upgrade to 2.7.1.  The changes in
2.7.0 make file operations faster and RabbitMQ shuts down a lot faster.

Other than upgrading and using fewer durable queues, there's not much
you can do about the slow shutdown.

Cheers,
Alex

On Tue, Feb 07, 2012 at 02:10:43AM +0000, ??? wrote:
> Hi, all
> 
> Generally, it takes only seconds to stop MQ by using ?service rabbitmq-server stop?. But, some time, the stopping process would be clocked or returned after several minutes. Could anybody tell me the possible reasons to cause this problem? I appreciate it a lot.
> 
> Thanks,
> 
> Wright
> 

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From preetisp_83 at yahoo.com  Tue Feb  7 10:11:17 2012
From: preetisp_83 at yahoo.com (preeti sp)
Date: Tue, 7 Feb 2012 02:11:17 -0800 (PST)
Subject: [rabbitmq-discuss] Regd: Publish Many Scenarios
In-Reply-To: <4F30F3EB.2040805@rabbitmq.com>
Message-ID: <1328609477.83860.YahooMailClassic@web39302.mail.mud.yahoo.com>

Hi Emile,

I am clear with below approach. I have gone through RabbitMQ site.

My Main concern is:
(A) We need to handle multiple publishers and multiple consumers for same topic. And, If we create one queue each for every consumer, given the size of consumer base we have, our queue size might really hit high.

Is there any limit you would suggest to number of Queues that RabbitMQ could handle efficiently?

Our application is more of broadcast/multicast type. Meaning, If some one person does something, the same needs to be broadcasted to other folks on that thread! So, If we maintain one Queue each for each consumer, it is essentially duplicating the same Information 'n' number of times! So, I was wondering If there is any way to maintain only one Queue copy and publish it to how many required instead of duplicating so many queue copies in the memory?

Thanks,
Preeti

--- On Tue, 2/7/12, Emile Joubert <emile at rabbitmq.com> wrote:

From: Emile Joubert <emile at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Regd: Publish Many Scenarios
To: "preeti sp" <preetisp_83 at yahoo.com>
Cc: "RabbitMQ Discuss" <rabbitmq-discuss at lists.rabbitmq.com>
Date: Tuesday, February 7, 2012, 1:50 AM

Hi,

On 07/02/12 08:32, preeti sp wrote:
> Is there any way we could handle the scenario of Multiple Producers and
> Multiple Consumers bound to the same Queue using RabbitMQ ? Description
> below!
> 
> (1) Bind Multiple consumers to one Queue based on some binding keys

Yes, it is possible for multiple consumers to subscribe to the same
queue, but each message will only be delivered to one consumer. If you
want each consumer to receive each message then you will need to declare
a queue for each consumer and bind the queues to an exchange. Compare
the second and third tutorials for an illustration:
http://www.rabbitmq.com/getstarted.html

> (2) Multiple publishers publish some messages to the above Queue

Yes, but bear in mind that publishers publish to an exchange, not to a
queue directly.

> (3) And, Ensure each of the consumers get a copy of each message

No, see the answer to (1) above.



-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/deb33959/attachment.htm>

From preetisp_83 at yahoo.com  Tue Feb  7 10:25:05 2012
From: preetisp_83 at yahoo.com (preeti sp)
Date: Tue, 7 Feb 2012 02:25:05 -0800 (PST)
Subject: [rabbitmq-discuss] Regd: Connection,
	Channel Optimization configurations!
In-Reply-To: <4F30F3EB.2040805@rabbitmq.com>
Message-ID: <1328610305.50813.YahooMailClassic@web39304.mail.mud.yahoo.com>

Hi



Few Queries on RabbitMQ Connection and Channel Creation concepts:



Is RabbitMQ Connection creation a costly operation? If we have a user 
base of 100000 users, is it suggested to maintain sizable connection 
pools in advance to be used as and when required for better performance?



If we have a user based of 100000 users, would it be okay If we just 
maintain one connection and creation channels with in them?



What sort of Connection and channel configuration would be optimal to handle above scenarios when it comes to RabbitMQ?



Thanks,

Preeti
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/6a6b17c1/attachment.htm>

From emile at rabbitmq.com  Tue Feb  7 10:36:54 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 07 Feb 2012 10:36:54 +0000
Subject: [rabbitmq-discuss] Regd: Publish Many Scenarios
In-Reply-To: <1328609477.83860.YahooMailClassic@web39302.mail.mud.yahoo.com>
References: <1328609477.83860.YahooMailClassic@web39302.mail.mud.yahoo.com>
Message-ID: <4F30FEC6.8090703@rabbitmq.com>

Hi,

On 07/02/12 10:11, preeti sp wrote:
> Is there any limit you would suggest to number of Queues that RabbitMQ
> could handle efficiently?

It depends on a large number of factors (such as hardware, usage
pattern, queue lengths, message size, persistence, etc.). You should
perform tests with realistic workloads to find the limit. RabbitMQ does
not impose any limit on number of queues, but you will probably need to
spread the load with clustering if you need more than tens or hundreds
of thousands of queues, depending on how busy they are.

> Our application is more of broadcast/multicast type. Meaning, If some
> one person does something, the same needs to be broadcasted to other
> folks on that thread! So, If we maintain one Queue each for each
> consumer, it is essentially duplicating the same Information 'n' number
> of times! So, I was wondering If there is any way to maintain only one
> Queue copy and publish it to how many required instead of duplicating so
> many queue copies in the memory?

RabbitMQ already performs internal storage optimisations for messages
that are routed to multiple queues.


-Emile

From michael.s.klishin at gmail.com  Tue Feb  7 10:48:21 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 7 Feb 2012 14:48:21 +0400
Subject: [rabbitmq-discuss] [announcement] Hot Bunnies 1.3.5 is released
Message-ID: <66E5D789-3DF2-4C8A-8809-E4905CD00520@gmail.com>

Hot Bunnies 1.3.5 is released to rubygems.org [1].

This release backports a few new options added to HotBunnies.connect in master:

:uri for using connection URIs
:connection_timeout for specifying initial connection timeout
:requested_heartbeat for specifying connection heartbeat interval

There are no other changes. Have a good day.

1. https://rubygems.org/gems/hot_bunnies/versions/1.3.5-java

MK


From michael.s.klishin at gmail.com  Tue Feb  7 11:09:01 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 7 Feb 2012 15:09:01 +0400
Subject: [rabbitmq-discuss] [announcement] bunny 0.7.9 is released
Message-ID: <8B60EA91-9F1A-4C20-8C4D-1628016F325D@gmail.com>

Bunny 0.7.9 is released to rubygems.org [1].

New in this release:

* Support array values in attribute tables. This makes it possible to use bunny-based applications with the RabbitMQ federation plugin.

1. https://rubygems.org/gems/bunny/versions/0.7.9

MK


From emile at rabbitmq.com  Tue Feb  7 12:26:57 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 07 Feb 2012 12:26:57 +0000
Subject: [rabbitmq-discuss] .NET client connection shutdown codes
In-Reply-To: <CA+zYriS+pZzvqKFW1UDuroc=Uhq7X4+jVbR-yF5WYJuQFBt-zA@mail.gmail.com>
References: <CAOn7oW8-mgm3CvhTKFYZ-0Q+qzXYgYmw3k1a+qcjPpczXxE2XA@mail.gmail.com>
	<4F2FAB0D.30100@rabbitmq.com>
	<CA+zYriS+pZzvqKFW1UDuroc=Uhq7X4+jVbR-yF5WYJuQFBt-zA@mail.gmail.com>
Message-ID: <4F311891.9000500@rabbitmq.com>

Hi Steven,

On 07/02/12 05:10, Steven Taylor wrote:
> btw: recently in debugging, I appreciated that using the same
> DeliveryTag twice generated an exception, but I'm not sure that the
> channel should have automatically disconnected. Just thought I'd mention it.

Using an invalid delivery tag will lead to a channel exception, so what
you describe is expected behaviour.


-Emile

From ramquick at gmail.com  Tue Feb  7 12:57:50 2012
From: ramquick at gmail.com (Ram Chander)
Date: Tue, 7 Feb 2012 18:27:50 +0530
Subject: [rabbitmq-discuss] Rabbitmq Stomp error
Message-ID: <CAMRGQbPOLn8hhYVcxLyz9vGJjDR98=yuqSDtA56F4xdDKVQuzQ@mail.gmail.com>

Hi,

 I have configured rabbitmq+mcollective on a host with stomp. I see below
error when tried to mc-ping.  Any idea on what could be the issue ? Or is
there a better way to setup mcollective with rabbitmq.

# mc-ping
/usr/sbin/mc-ping failed to run: incompatible marshal file format (can't be
read)
    format version 4.8 required; 89.111 given (TypeError)

# less /var/log/rabbitmq/rabbit at ops-build-1.log

=ERROR REPORT==== 7-Feb-2012::18:21:54 ===
STOMP error frame sent:
Message: "Processing error"
Detail: "Processing error\n"
Server private detail: {undef,
                           [{re,split,["1.0",",",[{return,list}]]},
                            {rabbit_stomp_processor,negotiate_version,1},
                            {rabbit_stomp_processor,
                                '-process_connect/3-fun-0-',6},
                            {rabbit_stomp_processor,process_request,3},
                            {gen_server2,handle_msg,2},
                            {proc_lib,init_p,5}]}


# rabbitmqctl status

Status of node 'rabbit at ops-build-1' ...
[{pid,29332},
 {running_applications,
     [{rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.4.3"},
      {os_mon,"CPO  CXC 138 46","2.1.6"},
      {sasl,"SASL  CXC 138 11","2.1.5.3"},
      {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
      {stdlib,"ERTS  CXC 138 10","1.15.3"},
      {kernel,"ERTS  CXC 138 10","2.12.3"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang (BEAM) emulator version 5.6.3 [source] [64-bit] [smp:8]
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,32028218},
      {processes,10076904},
      {processes_used,10070256},
      {system,21951314},
      {atom,1068057},
      {atom_used,1054149},
      {binary,64614},
      {code,11843405},
      {ets,742608}]},
 {vm_memory_high_watermark,0.39999999995230406},
 {vm_memory_limit,3354584678}]
...done.

# dpkg -l |grep stomp
ii  libstomp-ruby                        1.0.4-3~bpo50+1            Ruby
bindings for the stomp messaging protoc
ii  libstomp-ruby1.8                     1.0.4-3~bpo50+1            Ruby
1.8 bindings for the stomp messaging pr
ii  libstomp-ruby1.9.1                   1.0.4-3~bpo50+1            Ruby
1.9.1 bindings for the stomp messaging


Regards,
Ram
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/9b325ecf/attachment.htm>

From simone.busoli at gmail.com  Tue Feb  7 13:14:31 2012
From: simone.busoli at gmail.com (simone.busoli at gmail.com)
Date: Tue, 07 Feb 2012 05:14:31 -0800 (PST)
Subject: [rabbitmq-discuss] Cannot build .NET client on Windows
In-Reply-To: <008e01cce58f$c0f15ff0$42d41fd0$@com>
Message-ID: <4f3123b7.c3d0e00a.45ef.1a55@mx.google.com>


	Perhaps due to .NET System.XML 4.0 assembly having the &quot;xml&quot; part uppercase, I couldn&#39;t build the .NET client until I made the reference in the ApiGen project have the &quot;xml&quot; string uppercase.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/e7aea2bb/attachment.htm>

From simone.busoli at gmail.com  Tue Feb  7 13:23:51 2012
From: simone.busoli at gmail.com (simone.busoli)
Date: Tue, 07 Feb 2012 05:23:51 -0800 (PST)
Subject: [rabbitmq-discuss] .NET client Heartbeat setting
In-Reply-To: <MAIL01gTEP08uHeM6rX00008718@mail01.feedblitz.com>
Message-ID: <4f3125e7.88cbe00a.5e2a.1c4d@mx.google.com>


	Hi, I noticed that the .NET client ConnectionFactory class ignores the Heartbeat setting passed on the querystring when setting the uri property. I think it should instead, currently the workaround is to set the RequestedHeartbeat property.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/4202d30f/attachment.htm>

From raphael.degiusti at guardis.com  Tue Feb  7 13:42:37 2012
From: raphael.degiusti at guardis.com (=?ISO-8859-1?Q?Rapha=EBl_De_GIUSTI?=)
Date: Tue, 7 Feb 2012 14:42:37 +0100
Subject: [rabbitmq-discuss] Pika - Catch amqp error - Cannot redeclare
	exchange with different type
Message-ID: <CAFw-di=mVP+S-ARa9TnHT1r3rnHvjmRHiJ6iPOac3JHHTga7yQ@mail.gmail.com>

Hi,

I'm using Pika 0.9.5 with python 2.7 successfully, but I'm running into
some issues when it comes to handle errors from the RabbitMQ broker.
I would like to deal programmatically with errors of this kind :

=ERROR REPORT==== 7-Feb-2012::14:13:40 ===
connection <0.25027.3>, channel 1 - error:
{amqp_error,precondition_failed,
            "cannot redeclare exchange 'status' in vhost '/' with different
type, durable, internal or autodelete value",
            'exchange.declare'}

This log is from the rabbitmq log.

I'm using the Pika SelectConnection, and my app is hanging somewhere after
calling channel.exchange_declare and never gets into my callback.

    def on_channel_open(channel):
        channel.exchange_declare(
                    exchange="status",
                    callback=on_exchange_declared)

What would be the way, in this case (and more generally) to "catch" errors
like this one in my code ?


Rapha?l
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/94434234/attachment.htm>

From emile at rabbitmq.com  Tue Feb  7 14:25:43 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 07 Feb 2012 14:25:43 +0000
Subject: [rabbitmq-discuss] Strange message loss behavior with mirrored
 queues
In-Reply-To: <CB554E16.2BA39%mpietrek@skytap.com>
References: <CB554E16.2BA39%mpietrek@skytap.com>
Message-ID: <4F313467.1070508@rabbitmq.com>

Hi Matt,

On 06/02/12 17:43, Matt Pietrek wrote:
> Thanks much for the reply. I certainly understand that in a mirrored
> setup, message publishing will be slower. However, I still think there
> some sort of issue here.

Yes, there is. Thanks for following up. I've now been able to reproduce
the problem without HA. The most likely cause is a connection or channel
shutdown sequence problem. I've reported this to the Pika author and
await his feedback.

In the meantime you can work around the issue by performing a dummy
synchronous operation (such as queue declare) before closing the channel.



-Emile

From emile at rabbitmq.com  Tue Feb  7 14:51:29 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 07 Feb 2012 14:51:29 +0000
Subject: [rabbitmq-discuss] .NET client Heartbeat setting
In-Reply-To: <4f3125e7.88cbe00a.5e2a.1c4d@mx.google.com>
References: <4f3125e7.88cbe00a.5e2a.1c4d@mx.google.com>
Message-ID: <4F313A71.3030805@rabbitmq.com>

Hi Simone,

On 07/02/12 13:23, simone.busoli wrote:
> Hi, I noticed that the .NET client ConnectionFactory class ignores the
> Heartbeat setting passed on the querystring when setting the uri
> property. I think it should instead, currently the workaround is to set
> the RequestedHeartbeat property.

You should be able to rely on all the features described here:
http://www.rabbitmq.com/uri-spec.html
Is your expectation of more options based on documentation?


-Emile


From emile at rabbitmq.com  Tue Feb  7 14:53:42 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 07 Feb 2012 14:53:42 +0000
Subject: [rabbitmq-discuss] Cannot build .NET client on Windows
In-Reply-To: <4f3123b7.c3d0e00a.45ef.1a55@mx.google.com>
References: <4f3123b7.c3d0e00a.45ef.1a55@mx.google.com>
Message-ID: <4F313AF6.1020908@rabbitmq.com>

Hi Simone,

On 07/02/12 13:14, simone.busoli at gmail.com wrote:
> Perhaps due to .NET System.XML 4.0 assembly having the "xml" part
> uppercase, I couldn't build the .NET client until I made the reference
> in the ApiGen project have the "xml" string uppercase.

Thanks for pointing this out. I've not run into this problem myself, but
if you let me know what you changed exactly then I can update the project.


-Emile

From simone.busoli at gmail.com  Tue Feb  7 15:00:18 2012
From: simone.busoli at gmail.com (simone.busoli)
Date: Tue, 07 Feb 2012 07:00:18 -0800 (PST)
Subject: [rabbitmq-discuss] .NET client Heartbeat setting
In-Reply-To: <4F313A71.3030805@rabbitmq.com>
Message-ID: <4f313c82.5309e00a.17d7.6fe0@mx.google.com>


	That&#39;s what I was trying to say, the hearbeat setting is not picked up when passed on the querystring as &quot;?heartbeat=&quot; if you pass the entire Uri to the uri property, it is not parsed by the client library.

-----Original Message-----



			Re: [rabbitmq-discuss] .NET client Heartbeat setting
From: Emile Joubert &lt;emile at rabbitmq.com&gt;
		To: &quot;simone.busoli&quot; &lt;simone.busoli at gmail.com&gt;
		Cc: rabbitmq-discuss at lists.rabbitmq.com

		Tuesday, February 07, 2012 at 2:51PM



			Hi Simone,

			On 07/02/12 13:23, simone.busoli wrote:
			&gt; Hi, I noticed that the .NET client ConnectionFactory class ignores the
			&gt; Heartbeat setting passed on the querystring when setting the uri
			&gt; property. I think it should instead, currently the workaround is to set
			&gt; the RequestedHeartbeat property.

			You should be able to rely on all the features described here:
			http://www.rabbitmq.com/uri-spec.html
			Is your expectation of more options based on documentation?


			-Emile


		&nbsp;


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/039dcd41/attachment.htm>

From davidib2001 at yahoo.com  Tue Feb  7 15:02:04 2012
From: davidib2001 at yahoo.com (davidib)
Date: Tue, 7 Feb 2012 07:02:04 -0800 (PST)
Subject: [rabbitmq-discuss] Mnesia connection error in a clustered node on a
	multi NIC PC
Message-ID: <139a51c7-a8c3-4d47-b0d4-ea5f5b2a67bb@t15g2000yqi.googlegroups.com>

Hi,


After getting a small test cluster to run successfully, I am now
getting an unexpected Mnesia error on one of the nodes.  Here is a
snippet of the messages in my RabbitMQ log for the node rabbit at LAKE-
HP165:

Mnesia('rabbit at LAKE-HP165'): ** ERROR ** Mnesia on 'rabbit at LAKE-HP165'
could not connect to node(s) ['rabbit at LAKE-DS140']

This message is apparently being generated about every 30 seconds!


The cluster seemed to work initially, i.e. I could send out a message
from any node to a pub/sub exchange, and each queue/node properly
received the message.  But after that initial test the RabbitMQ
install on the rabbit at LAKE-HP165 does not seem to work, none of the
other nodes can see it if I do a rabbitmqctl -n ... status, the queue
that I created for this node does not show up in the management
console, when I do a rabbitmqctl status on the problem node, none of
the plugins show up, yet they did show up when I initially instaleld
Rabbit, etc.


Two of the nodes in the cluster are dual NIC machines, i.e. the PCs
sit on two different networks (i.e. one NIC is mapped to 172.x.x.x,
other NIC is mapped to 10.x.x.x).  The node/PC that seems to have
failed has two NICs, but one is permanent (i.e. a true NIC card mapped
to 172.x.x.x) and one (mapped to 10.x.x.x) is via a VPN connection
that I connect/disconnect to as needed.

So, quick questions:
1) Is the dual NIC setup of the nodes the cause of the problem (I
realize that a cluster is not designed to work over a partitioned
network)

2) I know that RabbitMQ/erlang can be 'pinned' to a specific IP
address.port.  Would this be a solution if the dual NICS are the
problem?

OR

Is it just not safe to use a cluster on a dual NIC node (i.e. do I
have to use a federation?)

Well, thanks in advance for any help

Regards
David



I've got a small test cluster of three nodes.  Each node is is Windows
XP machine.  Each node has two NICs, one NIC is mapped to our
development environment network, the other NIC is mapped to our
production network.



From emile at rabbitmq.com  Tue Feb  7 15:23:26 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 07 Feb 2012 15:23:26 +0000
Subject: [rabbitmq-discuss] Possibly latency issues
In-Reply-To: <1328582743.2123.28.camel@samc-pc.wgtn.cat-it.co.nz>
References: <1328582743.2123.28.camel@samc-pc.wgtn.cat-it.co.nz>
Message-ID: <4F3141EE.8060000@rabbitmq.com>

Hi Sam,

On 07/02/12 02:45, Sam Crawley wrote:
> In these tests, I get an average of about 0.1s for the round trip. Does
> this seem unreasonably slow? In an identical test using Spread, I get
> times of around 0.01s (the application performance issue we're seeing is
> showing RabbitMQ about 3-4 times slower than Spread).

There are a few factors that will influence the latency on the broker.
Auto-acknowledgement and asynchronous delivery should be used.
Persistence, transactions, long queues and synchronous message delivery
should be avoided. Reducing the maximum frame size may help latency.

Make sure the difference you are measuring is due to the broker only and
not a change in network conditions. A quick unscientific test shows that
latencies of 0.001s are typical on my own workstation for messages of
5kb when using localhost (so very little network delay) and when queues
are short.

That said, RabbitMQ is not specifically aimed at the ultra low-latency
market. There are more suitable products available if latency is your
overriding concern.


-Emile

From emile at rabbitmq.com  Tue Feb  7 15:37:19 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 07 Feb 2012 15:37:19 +0000
Subject: [rabbitmq-discuss] RabbitMQ shovel adding random underscore '_'
 characters in message payload
In-Reply-To: <4F309F0E.7030208@omc-international.com.au>
References: <4F309F0E.7030208@omc-international.com.au>
Message-ID: <4F31452F.6090105@rabbitmq.com>

Hi,

On 07/02/12 03:48, Mihir Mone wrote:
> The really baffling fact is that only configuration 1 has this issue,
> configuration 2 works fine. The only difference is a different OS at the
> remote end of things in configuration 2.

Can you reproduce this problem with a smaller message, or without using
shovel?

Does it also happen when you receive the message with any other AMQP
client, or with the "rabbitmqadmin get" command?

Have you confirmed that the original message sent to the broker does not
already contain the defect?


-Emile

From rasadoll at gmail.com  Tue Feb  7 16:11:33 2012
From: rasadoll at gmail.com (rasadoll)
Date: Tue, 7 Feb 2012 08:11:33 -0800 (PST)
Subject: [rabbitmq-discuss] Message wait time in a queue
Message-ID: <f9390172-19d5-4987-8d74-46c15be4a224@j15g2000yqb.googlegroups.com>

Hi,

How can we measure how long a message has been in a queue before it is
delivered to a consumer? If the message was in a queue for more than a
certain amount of time we would like to ignore it for example. Our
message publisher and consumers are on different machines and we
cannot synchronize their clocks, so the publish time cannot be set by
the publisher and checked by the consumer. Is there any way to get
this information from RabbitMQ?

Thanks,

From jerryk at vmware.com  Tue Feb  7 16:28:15 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 7 Feb 2012 08:28:15 -0800 (PST)
Subject: [rabbitmq-discuss] Message wait time in a queue
In-Reply-To: <f9390172-19d5-4987-8d74-46c15be4a224@j15g2000yqb.googlegroups.com>
Message-ID: <eda37f0b-b246-4702-b85a-f91fa67d8f82@strongmad.batnest.org>

Hi, Rasadoll...

Do you really want to measure the time spent in a queue by the
message and do something with that information or do you just want 
messages to vanish after they get appropriately stale?  If the
latter, check out:

http://www.rabbitmq.com/extensions.html

And check out the "Per-Queue Message TTL" session.  It describes
a RabbitMQ extension to AMQP that lets you declare a queue with
a new argument, x-message-ttl, that controls how long a message
published to that queue can live before the broker discards it.
Messages that have exceeded the TTL set for their queue are
considered dead, won't be delivered to consumers, and will
be expunged periodically.

Note that you specify the TTL in *milliseconds*... :-)

Best regards,
Jerry

----- Original Message -----
From: "rasadoll" <rasadoll at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, February 7, 2012 8:11:33 AM
Subject: [rabbitmq-discuss] Message wait time in a queue

Hi,

How can we measure how long a message has been in a queue before it is
delivered to a consumer? If the message was in a queue for more than a
certain amount of time we would like to ignore it for example. Our
message publisher and consumers are on different machines and we
cannot synchronize their clocks, so the publish time cannot be set by
the publisher and checked by the consumer. Is there any way to get
this information from RabbitMQ?

Thanks,
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From pbell at syncsort.com  Tue Feb  7 16:28:35 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Tue, 7 Feb 2012 11:28:35 -0500
Subject: [rabbitmq-discuss] Queue Look-ahead, et alia
In-Reply-To: <4F2FD99E.2000501@rabbitmq.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1EC@MAILCCR.us.syncsort.com>
	<4F2FD99E.2000501@rabbitmq.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40447B6D@MAILCCR.us.syncsort.com>

Merci beaucoup, Emile, for another very helpful reply. I appreciate it.

It seems that I may have a "square peg, round hole" problem in the way I am trying to use RabbitMQ. Perhaps it's not the right tool for the job. That said, I think it has much to offer and I am championing its use in-house.

Your mention of database in the context of "random access" to a queue leads me to the following questions (and here I am in way over my head): I recall that Rabbit supports different types of queue backing storage by means of "extensions." Would it be possible via such an extension to back the queue with, say, SQL storage? And might this allow, through standard SQL access patterns, random access to the queue?

Thanks again.

-Paul

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: Monday, February 06, 2012 8:46 AM
To: Bell, Paul M.
Cc: RabbitMQ List
Subject: Re: [rabbitmq-discuss] Queue Look-ahead, et alia

Hi Paul,

On 06/02/12 12:37, Bell, Paul M. wrote:
> 1. Is it possible for a consumer to consume specific messages from a
> queue, e.g., one that contains a specific value (like a unique
> "request ID" that is part of each message)?

No, but if you are trying to match up requests with replies then
consider making use of a dedicated reply queue, in the way RPC does. The
6th tutorial explains in greater detail:
http://www.rabbitmq.com/tutorials/tutorial-six-java.html

> 2. Is it possible for a consumer to "run a queue," e.g., visit each
> message in the queue without removing it?

In theory a consumer could fetch many messages without acknowledgement,
acknowledge only those that match a filter and requeue the remainder.
Treating a queue like this strongly discouraged. The specification says
of basic.reject:

"The client MUST NOT use this method as a means of selecting messages to
process. "

If you require random access to messages then consider using a database,
or redesigning the message flow in such a way that consumers are able to
process all messages at the head of a queue.

> 3. Perhaps related to (1): does Rabbit support a kind of queue "peek"
> logic in the manner of Queue objects in C# and elsewhere? Peek allows
> one to obtain the queue head but leave it in place. (I know from
> previous threads on this list that message will remain in Q until
> expressly ack-ed, so maybe that's the answer.....)

A consumer can fetch and requeue a message from a queue, but (unless
there are other consumers consuming from the same queue) it will not
make any progress this way. The reason is that the consumer will see the
same message over and over.

> Behind my questions is something I learned re Microsoft's Azure
> design. Its message queues can be manipulated via RESTful URIs.
> Consequently, the contents of an Azure queue can be queried, just as
> one might query data in the persistence layer.

Data structures that can be browsed and manipulated in this way are not
strictly speaking queues. For performance reasons the internal data
structures in RabbitMQ have queues that do not permit random data access
patterns.




-Emile



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From jerryk at vmware.com  Tue Feb  7 16:34:27 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 7 Feb 2012 08:34:27 -0800 (PST)
Subject: [rabbitmq-discuss] Pika - Catch amqp error - Cannot
	redeclare	exchange with different type
In-Reply-To: <CAFw-di=mVP+S-ARa9TnHT1r3rnHvjmRHiJ6iPOac3JHHTga7yQ@mail.gmail.com>
Message-ID: <8452277c-a6d0-4ed4-b90f-1eebb1ca4920@strongmad.batnest.org>

Hi, Raphael:

This is actually a behavior defined in the AMQP specification.
AMQP allows applications quite a free hand (within the bounds
of permissions) to declare elements of their messaging fabric
such as queues, exchanges and the bindings between them.

A common idiom in AMQP programs is to defensively declare a
resource you're about to use prior to its use.  If the resource
already exists, and its properties entirely agree with what
you're asking for, the operation succeeds idempotently and life
goes on.  If, however, there was already an entity with the
given name, but different properties, it's not safe to toss the
old one and create you a new one (who else might be using it?)
so you end up with 404/not-found.

If you really want a new entity with new properties, you'll have
to delete the old one and create anew...

Best regards,
Jerry

----- Original Message -----
From: "Rapha?l De GIUSTI" <raphael.degiusti at guardis.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, February 7, 2012 5:42:37 AM
Subject: [rabbitmq-discuss] Pika - Catch amqp error - Cannot redeclare	exchange with different type


Hi,


I'm using Pika 0.9.5 with python 2.7 successfully, but I'm running into some issues when it comes to handle errors from the RabbitMQ broker.
I would like to deal programmatically with errors of this kind :



=ERROR REPORT==== 7-Feb-2012::14:13:40 ===
connection <0.25027.3>, channel 1 - error:
{amqp_error,precondition_failed,
"cannot redeclare exchange 'status' in vhost '/' with different type, durable, internal or autodelete value",
'exchange.declare'}


This log is from the rabbitmq log.


I'm using the Pika SelectConnection, and my app is hanging somewhere after calling channel.exchange_declare and never gets into my callback.



def on_channel_open(channel):
channel.exchange_declare(
exchange="status",
callback=on_exchange_declared)


What would be the way, in this case (and more generally) to "catch" errors like this one in my code ?




Rapha?l
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Tue Feb  7 16:37:37 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 7 Feb 2012 08:37:37 -0800 (PST)
Subject: [rabbitmq-discuss] Queue Look-ahead, et alia
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40447B6D@MAILCCR.us.syncsort.com>
Message-ID: <b92fd134-a36b-4e63-a527-2b4fe5f95b0f@strongmad.batnest.org>

Hi, Paul.

It is in fact possible to write alternate storage backends
for queue contents, but it's a non-trivial amount of work
and may ultimately give you something you don't want.

The current persister used by Rabbit is explicitly quite
tuned to messaging use cases; other data stores may cater
to quite different workloads and give you performance, or
perhaps even correctness, situations you won't enjoy.

A discussion of some of the issues can be found here:

http://www.rabbitmq.com/blog/2011/01/20/rabbitmq-backing-stores-databases-and-disks/

Best regards,
Jerry

----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: "Emile Joubert" <emile at rabbitmq.com>
Cc: "RabbitMQ List" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Tuesday, February 7, 2012 8:28:35 AM
Subject: Re: [rabbitmq-discuss] Queue Look-ahead, et alia

Merci beaucoup, Emile, for another very helpful reply. I appreciate it.

It seems that I may have a "square peg, round hole" problem in the way I am trying to use RabbitMQ. Perhaps it's not the right tool for the job. That said, I think it has much to offer and I am championing its use in-house.

Your mention of database in the context of "random access" to a queue leads me to the following questions (and here I am in way over my head): I recall that Rabbit supports different types of queue backing storage by means of "extensions." Would it be possible via such an extension to back the queue with, say, SQL storage? And might this allow, through standard SQL access patterns, random access to the queue?

Thanks again.

-Paul

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: Monday, February 06, 2012 8:46 AM
To: Bell, Paul M.
Cc: RabbitMQ List
Subject: Re: [rabbitmq-discuss] Queue Look-ahead, et alia

Hi Paul,

On 06/02/12 12:37, Bell, Paul M. wrote:
> 1. Is it possible for a consumer to consume specific messages from a
> queue, e.g., one that contains a specific value (like a unique
> "request ID" that is part of each message)?

No, but if you are trying to match up requests with replies then
consider making use of a dedicated reply queue, in the way RPC does. The
6th tutorial explains in greater detail:
http://www.rabbitmq.com/tutorials/tutorial-six-java.html

> 2. Is it possible for a consumer to "run a queue," e.g., visit each
> message in the queue without removing it?

In theory a consumer could fetch many messages without acknowledgement,
acknowledge only those that match a filter and requeue the remainder.
Treating a queue like this strongly discouraged. The specification says
of basic.reject:

"The client MUST NOT use this method as a means of selecting messages to
process. "

If you require random access to messages then consider using a database,
or redesigning the message flow in such a way that consumers are able to
process all messages at the head of a queue.

> 3. Perhaps related to (1): does Rabbit support a kind of queue "peek"
> logic in the manner of Queue objects in C# and elsewhere? Peek allows
> one to obtain the queue head but leave it in place. (I know from
> previous threads on this list that message will remain in Q until
> expressly ack-ed, so maybe that's the answer.....)

A consumer can fetch and requeue a message from a queue, but (unless
there are other consumers consuming from the same queue) it will not
make any progress this way. The reason is that the consumer will see the
same message over and over.

> Behind my questions is something I learned re Microsoft's Azure
> design. Its message queues can be manipulated via RESTful URIs.
> Consequently, the contents of an Azure queue can be queried, just as
> one might query data in the persistence layer.

Data structures that can be browsed and manipulated in this way are not
strictly speaking queues. For performance reasons the internal data
structures in RabbitMQ have queues that do not permit random data access
patterns.




-Emile



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mpietrek at skytap.com  Tue Feb  7 17:03:59 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 07 Feb 2012 09:03:59 -0800
Subject: [rabbitmq-discuss] Strange message loss behavior with mirrored
 queues
In-Reply-To: <4F313467.1070508@rabbitmq.com>
Message-ID: <CB569960.2BB2D%mpietrek@skytap.com>

Excellent. It's good to know I'm not crazy, and I'm glad I stuck with this.

Thanks for the confirmation,

Matt

On 2/7/12 6:25 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:

>Hi Matt,
>
>On 06/02/12 17:43, Matt Pietrek wrote:
>> Thanks much for the reply. I certainly understand that in a mirrored
>> setup, message publishing will be slower. However, I still think there
>> some sort of issue here.
>
>Yes, there is. Thanks for following up. I've now been able to reproduce
>the problem without HA. The most likely cause is a connection or channel
>shutdown sequence problem. I've reported this to the Pika author and
>await his feedback.
>
>In the meantime you can work around the issue by performing a dummy
>synchronous operation (such as queue declare) before closing the channel.
>
>
>
>-Emile



From rasadoll at gmail.com  Tue Feb  7 17:05:50 2012
From: rasadoll at gmail.com (rasadoll)
Date: Tue, 7 Feb 2012 09:05:50 -0800 (PST)
Subject: [rabbitmq-discuss] Message wait time in a queue
In-Reply-To: <eda37f0b-b246-4702-b85a-f91fa67d8f82@strongmad.batnest.org>
References: <eda37f0b-b246-4702-b85a-f91fa67d8f82@strongmad.batnest.org>
Message-ID: <a5eb81af-bec9-463e-b23d-62aa46ab8373@h6g2000yqk.googlegroups.com>

Thanks Jerry,
Your direction would help us to partially address our problem, but we
are still interested about the wait time to further optimize our
system. We know the time to process and ack a message but we don't
know how long it took to start its processing.

Thanks,

On Feb 7, 11:28?am, Jerry Kuch <jer... at vmware.com> wrote:
> Hi, Rasadoll...
>
> Do you really want to measure the time spent in a queue by the
> message and do something with that information or do you just want
> messages to vanish after they get appropriately stale? ?If the
> latter, check out:
>
> http://www.rabbitmq.com/extensions.html
>
> And check out the "Per-Queue Message TTL" session. ?It describes
> a RabbitMQ extension to AMQP that lets you declare a queue with
> a new argument, x-message-ttl, that controls how long a message
> published to that queue can live before the broker discards it.
> Messages that have exceeded the TTL set for their queue are
> considered dead, won't be delivered to consumers, and will
> be expunged periodically.
>
> Note that you specify the TTL in *milliseconds*... :-)
>
> Best regards,
> Jerry
>
>
>
>
>
>
>
> ----- Original Message -----
> From: "rasadoll" <rasad... at gmail.com>
> To: rabbitmq-disc... at lists.rabbitmq.com
> Sent: Tuesday, February 7, 2012 8:11:33 AM
> Subject: [rabbitmq-discuss] Message wait time in a queue
>
> Hi,
>
> How can we measure how long a message has been in a queue before it is
> delivered to a consumer? If the message was in a queue for more than a
> certain amount of time we would like to ignore it for example. Our
> message publisher and consumers are on different machines and we
> cannot synchronize their clocks, so the publish time cannot be set by
> the publisher and checked by the consumer. Is there any way to get
> this information from RabbitMQ?
>
> Thanks,
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ask at rabbitmq.com  Tue Feb  7 17:16:04 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Tue, 7 Feb 2012 17:16:04 +0000
Subject: [rabbitmq-discuss] Message wait time in a queue
In-Reply-To: <a5eb81af-bec9-463e-b23d-62aa46ab8373@h6g2000yqk.googlegroups.com>
References: <eda37f0b-b246-4702-b85a-f91fa67d8f82@strongmad.batnest.org>
	<a5eb81af-bec9-463e-b23d-62aa46ab8373@h6g2000yqk.googlegroups.com>
Message-ID: <5DC9D2DD-1AC1-4327-9B2D-54CB59EDB53B@rabbitmq.com>


On 7 Feb 2012, at 17:05, rasadoll wrote:

> Thanks Jerry,
> Your direction would help us to partially address our problem, but we
> are still interested about the wait time to further optimize our
> system. We know the time to process and ack a message but we don't
> know how long it took to start its processing.
> 

You could add a timestamp to the message headers when you publish the message,
the subtract that when you consume it.
Of course then the time will include the time it took to send the message, but
that is probably not an issue?


From simon at rabbitmq.com  Tue Feb  7 17:17:25 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 Feb 2012 17:17:25 +0000
Subject: [rabbitmq-discuss] Ubuntu 11.10 does not shutdown
In-Reply-To: <CAL8b_0cqoC_1Dh4tpG-1FPsKPkaEtC3gihxcgw1NzJc_ffPTUA@mail.gmail.com>
References: <CAL8b_0dORe_EO88mp5R_aSUOZYJ7ujnbNScG6ai60An+0fKK2A@mail.gmail.com>	<32052927.1398.1328484574945.JavaMail.geo-discussion-forums@yqtt30>
	<CAL8b_0cqoC_1Dh4tpG-1FPsKPkaEtC3gihxcgw1NzJc_ffPTUA@mail.gmail.com>
Message-ID: <4F315CA5.4030606@rabbitmq.com>

On 06/02/12 10:41, Sampo Savolainen wrote:
> I'm however not 100% sure this fix is globally acceptable. Any thoughts
> Simon?

Yes, we're planning on making a very similar fix in the next release - 
su is just completely the wrong thing here (which it took a loooong time 
to realise).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue Feb  7 17:18:54 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 07 Feb 2012 17:18:54 +0000
Subject: [rabbitmq-discuss] Looking for some clarification on mirrored
 queue implementation
In-Reply-To: <CB5569AD.2BAC7%mpietrek@skytap.com>
References: <CB5569AD.2BAC7%mpietrek@skytap.com>
Message-ID: <4F315CFE.5010004@rabbitmq.com>

Hi Matt,

On 06/02/12 19:27, Matt Pietrek wrote:
> "The slaves apply the operations that occur to the master in exactly the
> same order as the master and thus maintain the same state. All actions
> other than publishes go only to the master, and the master then
> broadcasts the effect of the actions to the slaves. Thus clients
> consuming from a mirrored queue are in fact consuming from the master."
> 
> and
> 
> "messages published to a mirrored-queue are always published directly to
> the master and all slaves."
> --
> 
> One interpretation of the 2nd quote above ("published directly to...")
> is that clients are responsible for writing their messages to the master
> *as well as* to all slaves. Perhaps there's some mechanism where at
> connect time, the master sends a list of servers to the connecting
> client, and the client writes to all instances in the list.

No, that won't work because the number of slaves can change over the
lifetime of the queue. Publishing clients are not required to alter
their behaviour if their messages are routed to mirrored queues.

> Other people have a different interpretation of how this works, which is
> that publishes to *any* broker instances are forwarded by the receiving
> slave to the master instance, which in turn pushes the publish requests
> to all slaves. (Of course, if the master received the message initially,
> there's no need for forwarding.)
> 
> Simple question: Which of the above interpretations is correct?

Neither. RabbitMQ uses a separate Erlang process per channel and this
channel process is responsible for sending publish messages to each
slave as well as the master. The slaves and master make use of a
separate fault-tolerant framework (Guaranteed Multicast) to communicate.
The master uses GM to communicate all messages (including publish
messages) to slaves. Slaves therefore receive publish messages from the
channel as well as GM, and all other messages from GM only.

> Follow up question: What is the exact flow for a publish that goes to a
> slave? Does the slave do anything other than push the message to the
> master, which in turn handles the message as if it came to the master in
> the first place? Perhaps it writes the message to the local store first,
> then pushes it to the master? (Like I said, spirited debate.)

Slaves do not push messages to the master. Slaves simply mimic the
actions of the master in order to have an identical copy of the queue.
The messages from the master over GM impose a consistent ordering across
all the queues.


The sources contain some further detail which may be of interest:
http://hg.rabbitmq.com/rabbitmq-server/file/default/src/rabbit_mirror_queue_coordinator.erl
http://hg.rabbitmq.com/rabbitmq-server/file/default/src/gm.erl



-Emile

From rasadoll at gmail.com  Tue Feb  7 17:22:06 2012
From: rasadoll at gmail.com (rasadoll)
Date: Tue, 7 Feb 2012 09:22:06 -0800 (PST)
Subject: [rabbitmq-discuss] Message wait time in a queue
In-Reply-To: <5DC9D2DD-1AC1-4327-9B2D-54CB59EDB53B@rabbitmq.com>
References: <eda37f0b-b246-4702-b85a-f91fa67d8f82@strongmad.batnest.org>
	<a5eb81af-bec9-463e-b23d-62aa46ab8373@h6g2000yqk.googlegroups.com>
	<5DC9D2DD-1AC1-4327-9B2D-54CB59EDB53B@rabbitmq.com>
Message-ID: <bae49991-3036-4f9b-830c-f6b5156ac011@g27g2000yqa.googlegroups.com>

If the publisher and consumer are on different machines, this approach
will not work correctly as their clocks are not synchronized.


On Feb 7, 12:16?pm, Ask Solem <a... at rabbitmq.com> wrote:
> On 7 Feb 2012, at 17:05, rasadoll wrote:
>
> > Thanks Jerry,
> > Your direction would help us to partially address our problem, but we
> > are still interested about the wait time to further optimize our
> > system. We know the time to process and ack a message but we don't
> > know how long it took to start its processing.
>
> You could add a timestamp to the message headers when you publish the message,
> the subtract that when you consume it.
> Of course then the time will include the time it took to send the message, but
> that is probably not an issue?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From lherron at gmail.com  Tue Feb  7 17:04:30 2012
From: lherron at gmail.com (Lance Herron)
Date: Tue, 7 Feb 2012 09:04:30 -0800 (PST)
Subject: [rabbitmq-discuss] Shovel config example with declare.queue
 with a x-ha-policy argument?
In-Reply-To: <CAFDmHdNB=zFYWM+xxLhz3SG90ff4Yki2mOT=V=ZPdUnNNWxvhg@mail.gmail.com>
References: <CAFDmHdNB=zFYWM+xxLhz3SG90ff4Yki2mOT=V=ZPdUnNNWxvhg@mail.gmail.com>
Message-ID: <25810258.2337.1328634270592.JavaMail.geo-discussion-forums@yqkz3>

Hello all, I'm also looking for an example of Shovel with x-ha-policy. 
 Looks like I'm getting access_refused errors connecting to the destination 
queue because I'm missing this parameter.  Is this a supported 
configuration?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120207/e03eac8e/attachment.htm>

From matthew at rabbitmq.com  Tue Feb  7 17:41:14 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 7 Feb 2012 17:41:14 +0000
Subject: [rabbitmq-discuss] Looking for some clarification on mirrored
 queue implementation
In-Reply-To: <4F315CFE.5010004@rabbitmq.com>
References: <CB5569AD.2BAC7%mpietrek@skytap.com>
	<4F315CFE.5010004@rabbitmq.com>
Message-ID: <20120207174114.GB5185@rabbitmq.com>

Hi Matt,

On Tue, Feb 07, 2012 at 05:18:54PM +0000, Emile Joubert wrote:
> Neither. RabbitMQ uses a separate Erlang process per channel and this
> channel process is responsible for sending publish messages to each
> slave as well as the master.

Indeed. It's actually no different from a message being published to an
exchange which then routes the message to several different queues - the
channel process on the broker is responsible for finding out which
queues the message is destined for and forwarding the message to all
those queues. In the case of a mirrored queue, the expansion step to go
from "queue name" to "queue process ID" returns several process IDs.

> The slaves and master make use of a
> separate fault-tolerant framework (Guaranteed Multicast) to communicate.
> The master uses GM to communicate all messages (including publish
> messages) to slaves. Slaves therefore receive publish messages from the
> channel as well as GM, and all other messages from GM only.

...and the purpose of this is as follows.

Because you can have multiple channels publishing messages to the same
mirrored queue at the same time, there is the possibility that different
members of the mirrored queue see the publishes in different orders when
they receive the publishes directly from the channel processes. This
will not do - the messages *must* be in the same order in all members of
the mirrored queue. This is why publishes *also* go via GM - the master
pushes each publish onto GM and the slaves received that and use it to
derive the correct order.

But, if you *only* had publishes being sent to the master and then the
master pushes them via GM to all the slaves, then, in the event of the
death of the master, there's a window of time before any of the slaves
notice the death of the master during which there could be in-flight
publishes going from the channels to the old master which will be lost -
the master is dead so will not be able to process those publishes and
push them onto GM.

So as a result, publishes go via both routes - directly to all the
members of the mirrored queue to ensure that no publishes ever get lost,
and secondly via GM, pushed by the master, so that the slaves can
actually enqueue the messages in the right order.

> The sources contain some further detail which may be of interest:
> http://hg.rabbitmq.com/rabbitmq-server/file/default/src/rabbit_mirror_queue_coordinator.erl
> http://hg.rabbitmq.com/rabbitmq-server/file/default/src/gm.erl

Indeed. In general, it's much more complex than you can imagine. For
example, a publishing client that's using publisher confirms could be
publishing to a mirrored queue. Each confirm will only be issued once
all members of the mirrored queue have received *and* correctly
enqueued the message. And even if the master and any-but-not-all slaves
fail, the code will ensure that not only are no messages lost, but all
the confirms will still be correctly issued, assuming both the node to
which the client is connected survives and at least one member of the
mirrored queue survives.

Most if not all of the complexity arises from a) we do almost everything
regarding publishing asynchronously to take advantage of parallelism and
ensure performance, but this means some nodes could fall a long way
behind others; and b) failures and births can occur at any time and we
try pretty hard to cope transparently with almost everything. And some
of it we even get right...

Matthew

From pbell at syncsort.com  Tue Feb  7 18:23:59 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Tue, 7 Feb 2012 13:23:59 -0500
Subject: [rabbitmq-discuss] Queue Look-ahead, et alia
In-Reply-To: <b92fd134-a36b-4e63-a527-2b4fe5f95b0f@strongmad.batnest.org>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40447B6D@MAILCCR.us.syncsort.com>
	<b92fd134-a36b-4e63-a527-2b4fe5f95b0f@strongmad.batnest.org>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40447B8C@MAILCCR.us.syncsort.com>

Hi Jerry,

Thank you for the reply.

I hear you. I had a feeling that this might be a lot of work, but hadn't considered the performance/correctness possibilities you touch on. Non-enjoyment is non-good!

I will check out the link.

-Paul

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com] 
Sent: Tuesday, February 07, 2012 11:38 AM
To: Bell, Paul M.
Cc: RabbitMQ List; Emile Joubert
Subject: Re: [rabbitmq-discuss] Queue Look-ahead, et alia

Hi, Paul.

It is in fact possible to write alternate storage backends
for queue contents, but it's a non-trivial amount of work
and may ultimately give you something you don't want.

The current persister used by Rabbit is explicitly quite
tuned to messaging use cases; other data stores may cater
to quite different workloads and give you performance, or
perhaps even correctness, situations you won't enjoy.

A discussion of some of the issues can be found here:

http://www.rabbitmq.com/blog/2011/01/20/rabbitmq-backing-stores-databases-and-disks/

Best regards,
Jerry

----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: "Emile Joubert" <emile at rabbitmq.com>
Cc: "RabbitMQ List" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Tuesday, February 7, 2012 8:28:35 AM
Subject: Re: [rabbitmq-discuss] Queue Look-ahead, et alia

Merci beaucoup, Emile, for another very helpful reply. I appreciate it.

It seems that I may have a "square peg, round hole" problem in the way I am trying to use RabbitMQ. Perhaps it's not the right tool for the job. That said, I think it has much to offer and I am championing its use in-house.

Your mention of database in the context of "random access" to a queue leads me to the following questions (and here I am in way over my head): I recall that Rabbit supports different types of queue backing storage by means of "extensions." Would it be possible via such an extension to back the queue with, say, SQL storage? And might this allow, through standard SQL access patterns, random access to the queue?

Thanks again.

-Paul

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: Monday, February 06, 2012 8:46 AM
To: Bell, Paul M.
Cc: RabbitMQ List
Subject: Re: [rabbitmq-discuss] Queue Look-ahead, et alia

Hi Paul,

On 06/02/12 12:37, Bell, Paul M. wrote:
> 1. Is it possible for a consumer to consume specific messages from a
> queue, e.g., one that contains a specific value (like a unique
> "request ID" that is part of each message)?

No, but if you are trying to match up requests with replies then
consider making use of a dedicated reply queue, in the way RPC does. The
6th tutorial explains in greater detail:
http://www.rabbitmq.com/tutorials/tutorial-six-java.html

> 2. Is it possible for a consumer to "run a queue," e.g., visit each
> message in the queue without removing it?

In theory a consumer could fetch many messages without acknowledgement,
acknowledge only those that match a filter and requeue the remainder.
Treating a queue like this strongly discouraged. The specification says
of basic.reject:

"The client MUST NOT use this method as a means of selecting messages to
process. "

If you require random access to messages then consider using a database,
or redesigning the message flow in such a way that consumers are able to
process all messages at the head of a queue.

> 3. Perhaps related to (1): does Rabbit support a kind of queue "peek"
> logic in the manner of Queue objects in C# and elsewhere? Peek allows
> one to obtain the queue head but leave it in place. (I know from
> previous threads on this list that message will remain in Q until
> expressly ack-ed, so maybe that's the answer.....)

A consumer can fetch and requeue a message from a queue, but (unless
there are other consumers consuming from the same queue) it will not
make any progress this way. The reason is that the consumer will see the
same message over and over.

> Behind my questions is something I learned re Microsoft's Azure
> design. Its message queues can be manipulated via RESTful URIs.
> Consequently, the contents of an Azure queue can be queried, just as
> one might query data in the persistence layer.

Data structures that can be browsed and manipulated in this way are not
strictly speaking queues. For performance reasons the internal data
structures in RabbitMQ have queues that do not permit random data access
patterns.




-Emile



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Tue Feb  7 18:25:18 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 7 Feb 2012 10:25:18 -0800 (PST)
Subject: [rabbitmq-discuss] Queue Look-ahead, et alia
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40447B8C@MAILCCR.us.syncsort.com>
Message-ID: <199ce806-5a7d-406c-ab19-b0d2ce505dd7@strongmad.batnest.org>

Hi, Paul:

Definitely do, and then we can talk more on the list about
your actual needs.  Sometimes a hybrid solution, with Rabbit
doing the things its good at, and something else integrated
sensibly alongside in your application, is the best way to go...

Best regards,
Jerry

----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: "RabbitMQ List" <rabbitmq-discuss at lists.rabbitmq.com>, "Emile Joubert" <emile at rabbitmq.com>
Sent: Tuesday, February 7, 2012 10:23:59 AM
Subject: RE: [rabbitmq-discuss] Queue Look-ahead, et alia

Hi Jerry,

Thank you for the reply.

I hear you. I had a feeling that this might be a lot of work, but hadn't considered the performance/correctness possibilities you touch on. Non-enjoyment is non-good!

I will check out the link.

-Paul

-----Original Message-----
From: Jerry Kuch [mailto:jerryk at vmware.com] 
Sent: Tuesday, February 07, 2012 11:38 AM
To: Bell, Paul M.
Cc: RabbitMQ List; Emile Joubert
Subject: Re: [rabbitmq-discuss] Queue Look-ahead, et alia

Hi, Paul.

It is in fact possible to write alternate storage backends
for queue contents, but it's a non-trivial amount of work
and may ultimately give you something you don't want.

The current persister used by Rabbit is explicitly quite
tuned to messaging use cases; other data stores may cater
to quite different workloads and give you performance, or
perhaps even correctness, situations you won't enjoy.

A discussion of some of the issues can be found here:

http://www.rabbitmq.com/blog/2011/01/20/rabbitmq-backing-stores-databases-and-disks/

Best regards,
Jerry

----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: "Emile Joubert" <emile at rabbitmq.com>
Cc: "RabbitMQ List" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Tuesday, February 7, 2012 8:28:35 AM
Subject: Re: [rabbitmq-discuss] Queue Look-ahead, et alia

Merci beaucoup, Emile, for another very helpful reply. I appreciate it.

It seems that I may have a "square peg, round hole" problem in the way I am trying to use RabbitMQ. Perhaps it's not the right tool for the job. That said, I think it has much to offer and I am championing its use in-house.

Your mention of database in the context of "random access" to a queue leads me to the following questions (and here I am in way over my head): I recall that Rabbit supports different types of queue backing storage by means of "extensions." Would it be possible via such an extension to back the queue with, say, SQL storage? And might this allow, through standard SQL access patterns, random access to the queue?

Thanks again.

-Paul

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: Monday, February 06, 2012 8:46 AM
To: Bell, Paul M.
Cc: RabbitMQ List
Subject: Re: [rabbitmq-discuss] Queue Look-ahead, et alia

Hi Paul,

On 06/02/12 12:37, Bell, Paul M. wrote:
> 1. Is it possible for a consumer to consume specific messages from a
> queue, e.g., one that contains a specific value (like a unique
> "request ID" that is part of each message)?

No, but if you are trying to match up requests with replies then
consider making use of a dedicated reply queue, in the way RPC does. The
6th tutorial explains in greater detail:
http://www.rabbitmq.com/tutorials/tutorial-six-java.html

> 2. Is it possible for a consumer to "run a queue," e.g., visit each
> message in the queue without removing it?

In theory a consumer could fetch many messages without acknowledgement,
acknowledge only those that match a filter and requeue the remainder.
Treating a queue like this strongly discouraged. The specification says
of basic.reject:

"The client MUST NOT use this method as a means of selecting messages to
process. "

If you require random access to messages then consider using a database,
or redesigning the message flow in such a way that consumers are able to
process all messages at the head of a queue.

> 3. Perhaps related to (1): does Rabbit support a kind of queue "peek"
> logic in the manner of Queue objects in C# and elsewhere? Peek allows
> one to obtain the queue head but leave it in place. (I know from
> previous threads on this list that message will remain in Q until
> expressly ack-ed, so maybe that's the answer.....)

A consumer can fetch and requeue a message from a queue, but (unless
there are other consumers consuming from the same queue) it will not
make any progress this way. The reason is that the consumer will see the
same message over and over.

> Behind my questions is something I learned re Microsoft's Azure
> design. Its message queues can be manipulated via RESTful URIs.
> Consequently, the contents of an Azure queue can be queried, just as
> one might query data in the persistence layer.

Data structures that can be browsed and manipulated in this way are not
strictly speaking queues. For performance reasons the internal data
structures in RabbitMQ have queues that do not permit random data access
patterns.




-Emile



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ask at rabbitmq.com  Tue Feb  7 18:48:33 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Tue, 7 Feb 2012 18:48:33 +0000
Subject: [rabbitmq-discuss] Message wait time in a queue
In-Reply-To: <bae49991-3036-4f9b-830c-f6b5156ac011@g27g2000yqa.googlegroups.com>
References: <eda37f0b-b246-4702-b85a-f91fa67d8f82@strongmad.batnest.org>
	<a5eb81af-bec9-463e-b23d-62aa46ab8373@h6g2000yqk.googlegroups.com>
	<5DC9D2DD-1AC1-4327-9B2D-54CB59EDB53B@rabbitmq.com>
	<bae49991-3036-4f9b-830c-f6b5156ac011@g27g2000yqa.googlegroups.com>
Message-ID: <9F82DE49-09EC-4953-AA69-F6992D465ACC@rabbitmq.com>



On Feb 7, 2012, at 5:22 PM, rasadoll <rasadoll at gmail.com> wrote:

> If the publisher and consumer are on different machines, this approach
> will not work correctly as their clocks are not synchronized.
> 
> 

Well, with network synchronized clocks it should be good enough for most use cases, but you didn't tell us yours.


> On Feb 7, 12:16 pm, Ask Solem <a... at rabbitmq.com> wrote:
>> On 7 Feb 2012, at 17:05, rasadoll wrote:
>> 
>>> Thanks Jerry,
>>> Your direction would help us to partially address our problem, but we
>>> are still interested about the wait time to further optimize our
>>> system. We know the time to process and ack a message but we don't
>>> know how long it took to start its processing.
>> 
>> You could add a timestamp to the message headers when you publish the message,
>> the subtract that when you consume it.
>> Of course then the time will include the time it took to send the message, but
>> that is probably not an issue?
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mihirm at omc-international.com.au  Tue Feb  7 22:35:08 2012
From: mihirm at omc-international.com.au (Mihir Mone)
Date: Wed, 08 Feb 2012 09:35:08 +1100
Subject: [rabbitmq-discuss] RabbitMQ shovel adding random underscore '_'
 characters in message payload
In-Reply-To: <4F31452F.6090105@rabbitmq.com>
References: <4F309F0E.7030208@omc-international.com.au>
	<4F31452F.6090105@rabbitmq.com>
Message-ID: <4F31A71C.1090300@omc-international.com.au>

Hi Emile,

No this problem does not occur if the message is small. The payload is 
basically database table rows that are being synched between two sites. 
When the number of rows per payload is under 10 this error does not 
occur. But once it starts getting past 15 or so I am seeing this error. 
The configuration 1 which has this error is configured for 500 rows, 
which configuration 2 is configured for 3000 rows. And configuration 2 
works fine !!

Yes the error is present even when you receive a message through 
"rabbitmqadmin get" command.

Yes, I have confirmed that the original message sent to the broker at 
the remote end is OK. If you see the screenshots I have sent in the 
original email, one of them is named remote-site and the other is named 
local-site. They are nothing but dumps taken from the 
rabbitmq_management web UI.

- Mihir

On 8/02/2012 2:37 AM, Emile Joubert wrote:
> Hi,
>
> On 07/02/12 03:48, Mihir Mone wrote:
>> The really baffling fact is that only configuration 1 has this issue,
>> configuration 2 works fine. The only difference is a different OS at the
>> remote end of things in configuration 2.
> Can you reproduce this problem with a smaller message, or without using
> shovel?
>
> Does it also happen when you receive the message with any other AMQP
> client, or with the "rabbitmqadmin get" command?
>
> Have you confirmed that the original message sent to the broker does not
> already contain the defect?
>
>
> -Emile

From derekrw at gmail.com  Tue Feb  7 22:20:10 2012
From: derekrw at gmail.com (methodin)
Date: Tue, 7 Feb 2012 14:20:10 -0800 (PST)
Subject: [rabbitmq-discuss] Groking the point of queues in topic exchanges
Message-ID: <232a3fb6-92cc-4ea2-b302-ff06290b4d7b@e27g2000vbu.googlegroups.com>

So when I was originally mapping out how to design an implementation
of RabbitMQ I assumed that an exchange could route messages to queues
and workers could consume solely off one of the queues. When I added
two queues in I found out that the message will get sent to both
queues and those both workers.

So I implemented a topic exchange and route to queues based on routing
keys. I am now, however, at a loss in figuring out the point of the
queues in this system as I could just as easily map 4 different keys
to the same queue vs. routing each one to their own queue. Is there a
large difference here? Should I be aiming for one approach vs the
other?

From kot.begemot at gmail.com  Tue Feb  7 23:53:01 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Tue, 7 Feb 2012 15:53:01 -0800
Subject: [rabbitmq-discuss] Too many connections in active-active cluster
Message-ID: <CAFWGgNG52jWNocf6VEe9z3sW_3o7T1UsrGnnz=QrOznPobA+qw@mail.gmail.com>

Hi all,

I'm using 3 rabbit boxes in active-active configuration and sometimes I
experience "strange" behavior, ranging from abnormally high CPU usage, to
service crash.
I noticed that Connections count went to >800. Channels count is ~1600.
There were around 30 connections I expected from my app servers and
everything else looked like this:

{"name":"<'rabbit at rabbitmq-stg-1'.2.10055.0>","node":"rabbit at rabbitmq-stg-1","protocol":"Direct
0-9-1","user":"xxx","vhost":"/","client_properties":{},"type":"direct"}
{"name":"<'rabbit at rabbitmq-stg-1'.2.10072.0>","node":"rabbit at rabbitmq-stg-1","protocol":"Direct
0-9-1","user":"xxx","vhost":"/","client_properties":{},"type":"direct"}
...

Note that "rabbitmq-stg-1" node is connected to itself hundreds of times
via "Direct 0-9-1" protocol .
I'm not sure either those enormous amount of connections are the cause of
trouble, but seems suspicious.
Anybody knows where to look at?

Vadim.

-- 

From liuzhuofu at huawei.com  Wed Feb  8 09:03:25 2012
From: liuzhuofu at huawei.com (Liuzhuofu)
Date: Wed, 08 Feb 2012 09:03:25 +0000
Subject: [rabbitmq-discuss] A question about RabbitMQ "Presence Exchange"
	Plugin
Message-ID: <D027DE656EBD4F4C8EE57361B5EF438E39916239@szxeml524-mbs.china.huawei.com>

Hi :

    When I use RabbitMQ "Presence Exchange" Plugin, I found when a client (name:"Client_1") bind to the x-presence exchange, the queue (name:"monitor_queue") with "" route key can get a "bind" msg, but if I didn't subscribe the queue("Client_1") with a process, when the "client_1" coredown, the "monitor_queue" can not get a "unbind" msg. If I subcribe the queue("client_1"), when "client_1" coredown or exit, the monitor_queue can got a "unbind" msg.

    My question is: I have bind the queue("client_1") to the exchange("monitor"), why can not got the "unbind" msg when queue("client_1") not be subscribed, but can got the "unbind" msg when queue("client_1") be subscribed.



Regards,
  David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120208/b26f5c46/attachment.htm>

From simon at rabbitmq.com  Wed Feb  8 10:34:37 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Feb 2012 10:34:37 +0000
Subject: [rabbitmq-discuss] Too many connections in active-active cluster
In-Reply-To: <CAFWGgNG52jWNocf6VEe9z3sW_3o7T1UsrGnnz=QrOznPobA+qw@mail.gmail.com>
References: <CAFWGgNG52jWNocf6VEe9z3sW_3o7T1UsrGnnz=QrOznPobA+qw@mail.gmail.com>
Message-ID: <4F324FBD.4050803@rabbitmq.com>

On 07/02/12 23:53, Vadim Chekan wrote:
> Note that "rabbitmq-stg-1" node is connected to itself hundreds of times
> via "Direct 0-9-1" protocol .
> I'm not sure either those enormous amount of connections are the cause
> of trouble, but seems suspicious.
> Anybody knows where to look at?

So these are connections made with the Erlang client in direct mode. HA 
doesn't do that. Assuming you are not using the direct Erlang client in 
your own apps, it must be a plugin. The mgmt plugin uses short lived 
direct connections, and shovel and federation use long lived ones - are 
you using either of these?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Feb  8 10:57:31 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Feb 2012 10:57:31 +0000
Subject: [rabbitmq-discuss] Groking the point of queues in topic
	exchanges
In-Reply-To: <232a3fb6-92cc-4ea2-b302-ff06290b4d7b@e27g2000vbu.googlegroups.com>
References: <232a3fb6-92cc-4ea2-b302-ff06290b4d7b@e27g2000vbu.googlegroups.com>
Message-ID: <4F32551B.6060100@rabbitmq.com>

On 07/02/12 22:20, methodin wrote:
> So when I was originally mapping out how to design an implementation
> of RabbitMQ I assumed that an exchange could route messages to queues
> and workers could consume solely off one of the queues. When I added
> two queues in I found out that the message will get sent to both
> queues and those both workers.
>
> So I implemented a topic exchange and route to queues based on routing
> keys. I am now, however, at a loss in figuring out the point of the
> queues in this system as I could just as easily map 4 different keys
> to the same queue vs. routing each one to their own queue. Is there a
> large difference here? Should I be aiming for one approach vs the
> other?

So we're comparing one topic exchange with multiple routing keys all 
feeding into one queue, versus one topic exchange with multiple routing 
keys each feeding into a separate queue?

There are a couple of differences which may or may not matter to you:

1) If more than one of your routing keys match a given message, that 
message would get duplicated to each queue in the multiple queue case.

2) By pushing all the messages into one queue you impose a total 
ordering on your messages, which you may want. But by splitting out the 
messages into multiple queues you may get better performance (if the 
performance of the queue is a limiting factor...)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Feb  8 11:05:50 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Feb 2012 11:05:50 +0000
Subject: [rabbitmq-discuss] web interface on two ports and
 different	settings: ssl and non ssl
In-Reply-To: <CAMOXM28X8V+TE8ZEswc37L6Yy3Kxy_S9YitzKUWaoaYyxAwg5w@mail.gmail.com>
References: <CAMOXM2_GFf+4o3-_1UmXPdogPcYao6NmuxE2-QHM7k4hJYbTzQ@mail.gmail.com>
	<CAMOXM28X8V+TE8ZEswc37L6Yy3Kxy_S9YitzKUWaoaYyxAwg5w@mail.gmail.com>
Message-ID: <4F32570E.9070004@rabbitmq.com>

On 06/02/12 16:35, Massimo Paladin wrote:
> Hello,
>
> no one has an idea if this is possible?

No, it's not at the moment.

> It would be nice to have such configuration for different reasons:
> - one port without ssl for monitoring access (lightweight, frequent access)
> - one port enforced with ssl for admin access (more secure, data could
> be more sensible)

Hmm. We could add this without too much hassle. Unless you would want to 
ban certain classes of users from connecting without SSL - config for 
that would get messy quickly.

But are you actually finding that the SSL overhead is a big deal? I 
would expect (admittedly without measuring it) that whatever work mgmt 
does to respond to your query would overwhelm the effort involved in 
establishing an SSL connection.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Feb  8 11:10:23 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Feb 2012 11:10:23 +0000
Subject: [rabbitmq-discuss] Presence Exchange Related Question
In-Reply-To: <CAM8fPiRdvC-k0GxbUWw+Gpexc+6jcibBJx3X7k41rSTD2AKcEQ@mail.gmail.com>
References: <CADCLBRhhP9Jwwb5z0npPq0uSExmUswM4c8bNSP=GNobkRSgBTQ@mail.gmail.com>	<CAM8fPiRDA_66s-gRDWKPxg7gmWNxbHSUD5d73VLPxGi8pFkb-w@mail.gmail.com>	<CADCLBRjidfhs0Uzh5NiLZMrNVFwxoDa0pjKwAuOonP7b4mxa8Q@mail.gmail.com>
	<CAM8fPiRdvC-k0GxbUWw+Gpexc+6jcibBJx3X7k41rSTD2AKcEQ@mail.gmail.com>
Message-ID: <4F32581F.3090401@rabbitmq.com>

On 03/02/12 21:28, Tony Garnock-Jones wrote:
> Yes, you could do that (though you might have trouble correlating the
> log messages with application-level entities). I don't think there's
> anything much cleaner you could do using the built-in features, though.
> Stepping away from built-ins, the presence exchange would probably
> simplify things in terms of the code you'd need to write, but at the
> cost of running a third-party plugin.

There's also an internal event stream which the management plugin hooks 
into which broadcasts {queue|connection|channel} {created|deleted} events.

I have sometimes wondered about writing a plugin which just hooks this 
up to an exchange, but I'm not sure how useful such a raw-ish stream 
would be. Anyone?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Feb  8 11:14:14 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Feb 2012 11:14:14 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Erlang --enable-native-libs
In-Reply-To: <CAFDmHdM1skF=+k=NXG_SWcwR-iid0vFD3-7d=vVRZPvE5eoGRg@mail.gmail.com>
References: <CAFDmHdM1skF=+k=NXG_SWcwR-iid0vFD3-7d=vVRZPvE5eoGRg@mail.gmail.com>
Message-ID: <4F325906.8090103@rabbitmq.com>

On 02/02/12 18:59, Elias Levy wrote:
> FYI for any others that may be thinking of trying this, RabbitMQ will
> not start up if you compile Erlang R15B with the --enable-native-libs
> option.  It exits with the error:
>
> The code server called the unloaded module `alarm_handler'

Thanks for the heads up. I'll poke at this some time.

Note that if you enable HiPE compilation for RabbitMQ we will HiPE 
compile some bits of kernel / stdlib that we have determined to make a 
difference.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Feb  8 11:33:24 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Feb 2012 11:33:24 +0000
Subject: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG
 files....
In-Reply-To: <11b85e05-5854-4a10-b3b0-11fe2a3f2dec@strongmad.batnest.org>
References: <11b85e05-5854-4a10-b3b0-11fe2a3f2dec@strongmad.batnest.org>
Message-ID: <4F325D84.9030706@rabbitmq.com>

You will probably be able to trim stuff from lib/. I wouldn't touch 
anything else.

Disclaimer: this is from memory and may be incomplete. Do your own 
testing. If you break it you get to keep both pieces.

You will need *at least*:

stdlib
kernel
sasl
erts
mnesia
os_mon
tools

and also

public_key
ssl

if you want SSL.

That's to run, you'll need more to compile. Many plugins require more 
but I assume you won't be using plugins if you're trying to be minimal. 
Rabbit will spit out complaints to stdout at startup if it can't resolve 
symbols - this can give you further hints. But some may be harmless - 
e.g. ssl-related stuff if you're not using ssl.

Cheers, Simon

On 03/02/12 20:33, Jerry Kuch wrote:
> Hi, Philippe:
>
> I'd be reluctant to try to cut too much out of the Erlang lib directory,
> and anything out of the bin directory.  The environment can be pretty lazy
> about when it loads things and you don't want your apps to be discovering
> well into their runtime that some critical module is missing...
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "Philippe Jean"<p_jean at ateliers-numeriques.net>
> To: "Jerry Kuch"<jerryk at vmware.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Friday, February 3, 2012 12:28:53 PM
> Subject: Re: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG files....
>
> hello jerry,
>
> I did recompile Erlang/OTP without too much pain.  what should I keep as
> redistributable?  would the /bootstrap be enough for rabbitMQ or do I
> need /bin and the complete /lib (seems to contain a lot of stuff, among
> which source and intermediate files....)
>
> philippe
>
> On 12-02-03 2:37 PM, Jerry Kuch wrote:
>> A quick hack you might try:
>>
>> If you are willing to build Erlang/OTP from source (it's not too daunting
>> on most Linuxes), you could likely get away with doing a 'make install' of
>> it to some common place near where you want your Rabbit to live.  You might
>> then imagine tarballing the whole enchilada up and using that as your redist
>> unit.
>>
>> That won't get the disk space down to where you want it to be, probably, but
>> at least you'll get the self containment you're after...
>>
>> Just a thought.
>>
>> Best regards,
>> Jerry
>>
>> ----- Original Message -----
>> From: "Philippe Jean"<p_jean at ateliers-numeriques.net>
>> To: rabbitmq-discuss at lists.rabbitmq.com
>> Sent: Friday, February 3, 2012 11:08:44 AM
>> Subject: Re: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG files....
>>
>> on my part, 2 things are required:
>>
>> - being able to have a self containing directory where all the required
>> files for rabbit mq resides without having to install stuff elswere on
>> the machine (/usr/local/lib or other)
>> - have a reasonable size for the redist. files.  less than 20MB would be
>> good
>>
>> philippe
>>
>> On 12-02-03 1:45 PM, Jerry Kuch wrote:
>>> Hi, guys...
>>>
>>> I'd be fairly careful about trying to pare down the Erlang/OTP
>>> distribution very much...  it's easy to lose things that are
>>> critical, and not all of them are going to manifest "nicely"
>>> as a VM/BEAM start time failure, waiting instead until later
>>> before they go off the rails...
>>>
>>> What sort of constraints does your environment pose to motivate
>>> the paring down?  It sounds pretty demanding...
>>>
>>> Best regards,
>>> Jerry
>>>
>>> ----- Original Message -----
>>> From: "cocowalla"<colin.anderson333 at gmail.com>
>>> To: rabbitmq-discuss at googlegroups.com
>>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>>> Sent: Friday, February 3, 2012 7:50:46 AM
>>> Subject: Re: [rabbitmq-discuss] rabbitMQ redistribution with minimal ERLANG files....
>>>
>>>
>>> I'm considering using it as part of a commercial solution too, and would be most interested in some kind of minimal installation package.
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>> --
>> -----------------------------------------------------------------------------
>> Philippe Jean
>>
>> Les Ateliers Num?riques inc.
>> 57 Chemin de la Vieille ?glise
>> Lotbini?re, Qc, Canada, G0S 1S0
>> tel: 514.276.7130 - atelier: 418.796.3069
>> email: p_jean at ateliers-numeriques.net
>> http://www.ateliers-numeriques.net
>>
>>
>> -----------------------------------------------------------------------------
>> This email and any attachments are confidential and may be privileged
>> or otherwise protected from disclosure. If you are not the intended
>> recipient you must not copy this message or any attachment or disclose
>> the contents to any other person. If you have received this message in
>> error please contact us at the phone number above or by email at
>> info at ateliers-numeriques.net
>> -----------------------------------------------------------------------------
>> Le contenu du pr?sent courriel est confidentiel et peut ?tre
>> privil?gi? ou soumis ? des droits d'auteur. Si vous n'?tes pas le
>> destinataire anticip?, toute copie de ce message ou de tout document
>> qui peut y ?tre attach? est interdit, de m?me que la divulgation ?
>> quiconque du contenu de ce message.
>> Si vous avez re?u ce message par erreur, nous vous prions de  nous
>> contacter au t?l?phone ci-haut, ou par courriel ? info at ateliers-numeriques.net
>> -----------------------------------------------------------------------------
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> --
> -----------------------------------------------------------------------------
> Philippe Jean
>
> Les Ateliers Num?riques inc.
> 57 Chemin de la Vieille ?glise
> Lotbini?re, Qc, Canada, G0S 1S0
> tel: 514.276.7130 - atelier: 418.796.3069
> email: p_jean at ateliers-numeriques.net
> http://www.ateliers-numeriques.net
>
>
> -----------------------------------------------------------------------------
> This email and any attachments are confidential and may be privileged
> or otherwise protected from disclosure. If you are not the intended
> recipient you must not copy this message or any attachment or disclose
> the contents to any other person. If you have received this message in
> error please contact us at the phone number above or by email at
> info at ateliers-numeriques.net
> -----------------------------------------------------------------------------
> Le contenu du pr?sent courriel est confidentiel et peut ?tre
> privil?gi? ou soumis ? des droits d'auteur. Si vous n'?tes pas le
> destinataire anticip?, toute copie de ce message ou de tout document
> qui peut y ?tre attach? est interdit, de m?me que la divulgation ?
> quiconque du contenu de ce message.
> Si vous avez re?u ce message par erreur, nous vous prions de  nous
> contacter au t?l?phone ci-haut, ou par courriel ? info at ateliers-numeriques.net
> -----------------------------------------------------------------------------
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From abdullahsaima at yahoo.com  Wed Feb  8 12:11:46 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Wed, 8 Feb 2012 12:11:46 +0000 (GMT)
Subject: [rabbitmq-discuss] help required: bind function
In-Reply-To: <1328267963.21593.YahooMailNeo@web29706.mail.ird.yahoo.com>
References: <1328184592.31745.YahooMailNeo@web29702.mail.ird.yahoo.com>
	<07af12f2-a652-402d-a8ed-3b63d19b72a9@strongmad.batnest.org>
	<1328267963.21593.YahooMailNeo@web29706.mail.ird.yahoo.com>
Message-ID: <1328703106.80049.YahooMailNeo@web29706.mail.ird.yahoo.com>

Hi There,
?
To solve bind function, I am thinking to desgin a table for storing records of (routingkey, exchange?, Queue)?in it. But how binding key would be created? I am confused should I store the binding key with this record as well. Here in this simple table can I make routing key as primary key?
?
I am sorry for lot of question. But I hope I 'll get a positive response for all of these.
?
Best Regards
Saima
?
?
?
?
Saima Asif


________________________________
From: Saima Asif <abdullahsaima at yahoo.com>
To: Jerry Kuch <jerryk at vmware.com> 
Cc: Emile Joubert <emile at rabbitmq.com>; "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Friday, 3 February 2012, 11:19
Subject: Re: [rabbitmq-discuss] help required: bind function


Hi Jerry,
?
That was quite nice answer, I appreciate. 
Now I am thinking to manage record of table?to represents the binding. Hope it would serve what?I intended to do. 
Actually I am not very good at progamming I find the idea interesting but find difficulty in implemeting. As I am so much confused about this binding. 
?
However Thanks for your support thats he only forum where I hope to get something.
?
Best Regards,?
Saima

________________________________
From: Jerry Kuch <jerryk at vmware.com>
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: Emile Joubert <emile at rabbitmq.com>; rabbitmq-discuss at lists.rabbitmq.com 
Sent: Thursday, 2 February 2012, 16:53
Subject: Re: [rabbitmq-discuss] help required: bind function

Hi, Saima.

If you're trying to to implement some aspect of the actual AMQP
message transport, for learning purposes, you might consider following
RabbitMQ's structure.

In Rabbit, a binding of an exchange to a queue is essentially a record
in a table somewhere saying this exchange is bound to this queue, with
this associated routing key.

The actual work of getting a message published to that exchange into
an appropriate bound queue, is actually done by the process associated
with the communications channel used by the message's sender.? Essentially
it looks up the particulars of the exchange, determines what routing logic
is appropriate to use for that exchange type, looks at the message's routing
key if appropriate, and tries to match it to a binding.? If match(es) are
found, the message is forwarded to a process representing the queue, which is
responsible for its contents.? Almost symmetrically on the consumer side, 
a consumer's channel talks to the queue it's consuming from to ask it to 
disgorge its messages.

Apologies if this isn't quite what you're asking... I confess I may not fully 
grasp the ultimate intent of your investigations...

Best regards,
Jerry

----- Original Message -----
From: "Saima Asif" <abdullahsaima at yahoo.com>
To: "Emile Joubert" <emile at rabbitmq.com>, rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, February 2, 2012 4:09:52 AM
Subject: Re: [rabbitmq-discuss] help required: bind function




Thank you very much Emile and Aamir for your kind replies. 

Infact I know the basic concept of binding, if a queue is bounded to exchange then that queue wants to receive the message from that particular exchange. But I am so sorry I dont know how to interpret this relationship into programming langauge i.e. C++. How can I specify the queue that now this queue will recieve messages from this exch ange. I have consulted all the material, But the problem is writing and interpreting. I am so sorry I think it would be a big ask. 

Any help would be highly appreiated. 


Saima 



From: Emile Joubert <emile at rabbitmq.com> 
To: rabbitmq-discuss at lists.rabbitmq.com; abdullahsaima at yahoo.com 
Sent: Thursday, 2 February 2012, 9:51 
Subject: Re: [rabbitmq-discuss] help required: bind function 

Hi Saima, 

On 31/01/12 22:23, Saima Asif wrote: 
> I am student , and my supervisor and I have chosen to implement and 
> study it at very simpler level. my classes are not refined. There is one 
> class "message" which has a routing key. 
> I need your help how can I write Bind() function for this. 

Keep in mind that binding is an operation on a queue, not a message. See 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.queue for queue 
operations. 

Have you taken a look at the tutorials at 
http://www.rabbitmq.com/getstarted.html ? 
They introduce AMQP concepts (including binding) in a way that should be 
of help. Unfortunately no C or C++ translation exists, but if you feel 
brave you could contribute this. 

-Emile 



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120208/19b4ac9f/attachment.htm>

From majek04 at gmail.com  Wed Feb  8 12:17:05 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 8 Feb 2012 12:17:05 +0000
Subject: [rabbitmq-discuss] A question about RabbitMQ "Presence
	Exchange" Plugin
In-Reply-To: <D027DE656EBD4F4C8EE57361B5EF438E39916239@szxeml524-mbs.china.huawei.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39916239@szxeml524-mbs.china.huawei.com>
Message-ID: <CABzX+qwetNjoExi8eQPojGTcWFvFq5PVEQassQZGkrdOX32Wpg@mail.gmail.com>

2012/2/8 Liuzhuofu <liuzhuofu at huawei.com>:
> ????When I use RabbitMQ "Presence Exchange" Plugin, I found?when a client
> (name:"Client_1") bind to the x-presence exchange, the queue
> (name:"monitor_queue") with "" route key can get a "bind" msg, but if?I
> didn't subscribe the queue("Client_1") with a process, when the "client_1"
> coredown, the "monitor_queue" can not get a "unbind" msg. If I subcribe the
> queue("client_1"), when "client_1" coredown or exit, the monitor_queue can
> got a "unbind" msg.
>
> ??? My question is: I have bind the queue("client_1") to the
> exchange("monitor"), why can not got the "unbind" msg when queue("client_1")
> not be subscribed, but can got the "unbind" msg when queue("client_1") be
> subscribed.

Take a look at the readme:
https://github.com/tonyg/presence-exchange#readme

"bindings made with the empty string "" as their binding
key, which receive presence messages, but do not
produce them; and bindings made with any other binding key,
which produce presence messages but do not receive them."

Marek

From tonygarnockjones+rabbitmq at gmail.com  Wed Feb  8 12:44:54 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Wed, 8 Feb 2012 07:44:54 -0500
Subject: [rabbitmq-discuss] A question about RabbitMQ "Presence
	Exchange" Plugin
In-Reply-To: <CABzX+qwetNjoExi8eQPojGTcWFvFq5PVEQassQZGkrdOX32Wpg@mail.gmail.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39916239@szxeml524-mbs.china.huawei.com>
	<CABzX+qwetNjoExi8eQPojGTcWFvFq5PVEQassQZGkrdOX32Wpg@mail.gmail.com>
Message-ID: <CAM8fPiTsavfLDTHpofAQWMRXwM_rL4WmpNNSuViiyGXfkJ5N-A@mail.gmail.com>

On 8 February 2012 07:17, Marek Majkowski <majek04 at gmail.com> wrote:

> Take a look at the readme:
> https://github.com/tonyg/presence-exchange#readme
>
> "bindings made with the empty string "" as their binding
> key, which receive presence messages, but do not
> produce them; and bindings made with any other binding key,
> which produce presence messages but do not receive them."
>

Also, remember that queues can bind to the same exchange more than once! So
it's perfectly acceptable for some queue to bind twice to a
presence-exchange, once with key "" (in order to *receive* presence
messages) and again with key "myname" (in order to *issue* a presence
message).

The reason it is the way it is is so that asymmetrical situations can be
cooked up on demand. Binding twice is one easy way of producing a
symmetrical situation.

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120208/ad9526d1/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Wed Feb  8 12:46:16 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Wed, 8 Feb 2012 07:46:16 -0500
Subject: [rabbitmq-discuss] Presence Exchange Related Question
In-Reply-To: <4F32581F.3090401@rabbitmq.com>
References: <CADCLBRhhP9Jwwb5z0npPq0uSExmUswM4c8bNSP=GNobkRSgBTQ@mail.gmail.com>
	<CAM8fPiRDA_66s-gRDWKPxg7gmWNxbHSUD5d73VLPxGi8pFkb-w@mail.gmail.com>
	<CADCLBRjidfhs0Uzh5NiLZMrNVFwxoDa0pjKwAuOonP7b4mxa8Q@mail.gmail.com>
	<CAM8fPiRdvC-k0GxbUWw+Gpexc+6jcibBJx3X7k41rSTD2AKcEQ@mail.gmail.com>
	<4F32581F.3090401@rabbitmq.com>
Message-ID: <CAM8fPiQY+z1xuaS8tyBSOGxP4URg=t35JF94wQ15b8tWrnmc+g@mail.gmail.com>

On 8 February 2012 06:10, Simon MacMullen <simon at rabbitmq.com> wrote:

> I have sometimes wondered about writing a plugin which just hooks this up
> to an exchange, but I'm not sure how useful such a raw-ish stream would be.
> Anyone?
>

Better than parsing the Erlang event log, for sure! I wouldn't even make it
a plugin, I'd make it a core feature, and hook up the monitoring using the
exchange per se.

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120208/ab913d3b/attachment.htm>

From liuzhuofu at huawei.com  Wed Feb  8 12:47:28 2012
From: liuzhuofu at huawei.com (Liuzhuofu)
Date: Wed, 08 Feb 2012 12:47:28 +0000
Subject: [rabbitmq-discuss] =?gb2312?b?ILTwuLQ6ICBBIHF1ZXN0aW9uIGFib3V0?=
 =?gb2312?b?IFJhYmJpdE1RICJQcmVzZW5jZSBFeGNoYW5nZSIgUGx1Z2lu?=
In-Reply-To: <CABzX+qwetNjoExi8eQPojGTcWFvFq5PVEQassQZGkrdOX32Wpg@mail.gmail.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39916239@szxeml524-mbs.china.huawei.com>
	<CABzX+qwetNjoExi8eQPojGTcWFvFq5PVEQassQZGkrdOX32Wpg@mail.gmail.com>
Message-ID: <D027DE656EBD4F4C8EE57361B5EF438E39916296@szxeml524-mbs.china.huawei.com>

Hi, Marek:
I think you didn't catch my point.
My question is : If a queue bind to a 'x-presence' exchange with a "not_empty" key and it hasn't bean subscribe by a process, when the vm of queue exit , the exchange can not receive a "unbind" message for the queue.
But if the queue bind to 'x-presence' exchange with a "not_empty" key and it has subscribe by a process, when the vm of queue exit, the exchange can receive a "unbind" message for the queue.

Regards,
  David


________________________________________
???: Marek Majkowski [majek04 at gmail.com]
????: 2012?2?8? 20:17
?: Liuzhuofu
Cc: tonyg at ccs.neu.edu; rabbitmq-discuss at lists.rabbitmq.com
??: Re: [rabbitmq-discuss] A question about RabbitMQ "Presence Exchange" Plugin

2012/2/8 Liuzhuofu <liuzhuofu at huawei.com>:
> When I use RabbitMQ "Presence Exchange" Plugin, I found when a client
> (name:"Client_1") bind to the x-presence exchange, the queue
> (name:"monitor_queue") with "" route key can get a "bind" msg, but if I
> didn't subscribe the queue("Client_1") with a process, when the "client_1"
> coredown, the "monitor_queue" can not get a "unbind" msg. If I subcribe the
> queue("client_1"), when "client_1" coredown or exit, the monitor_queue can
> got a "unbind" msg.
>
> My question is: I have bind the queue("client_1") to the
> exchange("monitor"), why can not got the "unbind" msg when queue("client_1")
> not be subscribed, but can got the "unbind" msg when queue("client_1") be
> subscribed.

Take a look at the readme:
https://github.com/tonyg/presence-exchange#readme

"bindings made with the empty string "" as their binding
key, which receive presence messages, but do not
produce them; and bindings made with any other binding key,
which produce presence messages but do not receive them."

Marek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120208/14ce1519/attachment.htm>

From randall at trellisapp.com  Wed Feb  8 13:50:22 2012
From: randall at trellisapp.com (Randall Richard)
Date: Wed, 8 Feb 2012 08:50:22 -0500
Subject: [rabbitmq-discuss] Presence Exchange Related Question
In-Reply-To: <CAM8fPiQY+z1xuaS8tyBSOGxP4URg=t35JF94wQ15b8tWrnmc+g@mail.gmail.com>
References: <CADCLBRhhP9Jwwb5z0npPq0uSExmUswM4c8bNSP=GNobkRSgBTQ@mail.gmail.com>
	<CAM8fPiRDA_66s-gRDWKPxg7gmWNxbHSUD5d73VLPxGi8pFkb-w@mail.gmail.com>
	<CADCLBRjidfhs0Uzh5NiLZMrNVFwxoDa0pjKwAuOonP7b4mxa8Q@mail.gmail.com>
	<CAM8fPiRdvC-k0GxbUWw+Gpexc+6jcibBJx3X7k41rSTD2AKcEQ@mail.gmail.com>
	<4F32581F.3090401@rabbitmq.com>
	<CAM8fPiQY+z1xuaS8tyBSOGxP4URg=t35JF94wQ15b8tWrnmc+g@mail.gmail.com>
Message-ID: <CADCLBRju+ROCAg1fiBc_SboBJBMRxqSRZPEwFu4bbXyXOq6OLg@mail.gmail.com>

Having a way for an application/consumer to subscribe to events stemming
from queue and connection drops would be very useful.

The management web UI shows this activity, but presumably it's polling the
http api and updating the screen data (i.e. I'm assuming it's polling
something because there's a select box "Update: every 5 seconds").

-Randall

On Wed, Feb 8, 2012 at 7:46 AM, Tony Garnock-Jones <
tonygarnockjones+rabbitmq at gmail.com> wrote:

> On 8 February 2012 06:10, Simon MacMullen <simon at rabbitmq.com> wrote:
>
>> I have sometimes wondered about writing a plugin which just hooks this up
>> to an exchange, but I'm not sure how useful such a raw-ish stream would be.
>> Anyone?
>>
>
> Better than parsing the Erlang event log, for sure! I wouldn't even make
> it a plugin, I'd make it a core feature, and hook up the monitoring using
> the exchange per se.
>
> Regards,
>   Tony
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120208/50a50969/attachment.htm>

From simon at rabbitmq.com  Wed Feb  8 13:54:42 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Feb 2012 13:54:42 +0000
Subject: [rabbitmq-discuss] Presence Exchange Related Question
In-Reply-To: <CADCLBRju+ROCAg1fiBc_SboBJBMRxqSRZPEwFu4bbXyXOq6OLg@mail.gmail.com>
References: <CADCLBRhhP9Jwwb5z0npPq0uSExmUswM4c8bNSP=GNobkRSgBTQ@mail.gmail.com>	<CAM8fPiRDA_66s-gRDWKPxg7gmWNxbHSUD5d73VLPxGi8pFkb-w@mail.gmail.com>	<CADCLBRjidfhs0Uzh5NiLZMrNVFwxoDa0pjKwAuOonP7b4mxa8Q@mail.gmail.com>	<CAM8fPiRdvC-k0GxbUWw+Gpexc+6jcibBJx3X7k41rSTD2AKcEQ@mail.gmail.com>	<4F32581F.3090401@rabbitmq.com>	<CAM8fPiQY+z1xuaS8tyBSOGxP4URg=t35JF94wQ15b8tWrnmc+g@mail.gmail.com>
	<CADCLBRju+ROCAg1fiBc_SboBJBMRxqSRZPEwFu4bbXyXOq6OLg@mail.gmail.com>
Message-ID: <4F327EA2.4000000@rabbitmq.com>

On 08/02/12 13:50, Randall Richard wrote:
> Having a way for an application/consumer to subscribe to events stemming
> from queue and connection drops would be very useful.
>
> The management web UI shows this activity, but presumably it's polling
> the http api and updating the screen data (i.e. I'm assuming it's
> polling something because there's a select box "Update: every 5 seconds").

Yes, the HTTP API is pure HTTP, no websockets or long polling or whatever.

I'll see about cooking up such a plugin (sorry Tony, but it would be 
rather experimental at first and I think it's nice to put things in 
plugins where possible). But it's one of a million other things to do...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Wed Feb  8 14:04:04 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 8 Feb 2012 14:04:04 +0000
Subject: [rabbitmq-discuss]
	=?utf-8?b?562U5aSNOiAgQSBxdWVzdGlvbiBhYm91dCBS?=
	=?utf-8?q?abbitMQ_=22Presence_Exchange=22_Plugin?=
In-Reply-To: <D027DE656EBD4F4C8EE57361B5EF438E39916296@szxeml524-mbs.china.huawei.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39916239@szxeml524-mbs.china.huawei.com>
	<CABzX+qwetNjoExi8eQPojGTcWFvFq5PVEQassQZGkrdOX32Wpg@mail.gmail.com>
	<D027DE656EBD4F4C8EE57361B5EF438E39916296@szxeml524-mbs.china.huawei.com>
Message-ID: <CABzX+qw_7SV9-nbm5s_wNmEGOOG05PnzYBvmK4AVRwCyAp22Xw@mail.gmail.com>

2012/2/8 Liuzhuofu <liuzhuofu at huawei.com>:
> Hi, Marek:
> I think you didn't catch my point.
> My question is : If a queue bind to a 'x-presence' exchange with a
> "not_empty" key and it hasn't bean subscribe by a process, when the vm of
> queue exit , the exchange can not receive a "unbind" message for the queue.
> But if the queue bind to 'x-presence' exchange with a?"not_empty" key and it
> has subscribe by a process, when the vm of queue exit, the exchange can
> receive a "unbind" message for the queue.

What kind of queue do you have in mind? durable or exclusive or auto_delete?

You should see an 'unbind' message on a presence exchange,
when a queue gets unbind from this exchange

A queue can get 'unbind' during one of the following events:
 - you manually call 'unbind'
 - a queue gets deleted

The latter case, a queue getting deleted can happen in following cases:
 - you manually call queue_delete
 - a queue is 'exclusive' and a connection that created it gets closed
 - a queue is 'auto-delete' and all the consumers stopped consuming (for example
   last consumer connection got closed)

Please review the AMQP spec for details:
  http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare


Cheers,
   Marek

From derekrw at gmail.com  Wed Feb  8 14:56:40 2012
From: derekrw at gmail.com (methodin)
Date: Wed, 8 Feb 2012 06:56:40 -0800 (PST)
Subject: [rabbitmq-discuss] Groking the point of queues in topic
	exchanges
In-Reply-To: <4F32551B.6060100@rabbitmq.com>
References: <232a3fb6-92cc-4ea2-b302-ff06290b4d7b@e27g2000vbu.googlegroups.com>
	<4F32551B.6060100@rabbitmq.com>
Message-ID: <77f7fc4a-f264-47bd-aeba-9ead07f626c4@bs8g2000vbb.googlegroups.com>

Thanks for the explanation! I gather then that it is really an issue
of semantics as to how you want your queue to behave and not an issue
of doing it a correct way. This helps a lot!

On Feb 8, 5:57?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 07/02/12 22:20, methodin wrote:
>
> > So when I was originally mapping out how to design an implementation
> > of RabbitMQ I assumed that an exchange could route messages to queues
> > and workers could consume solely off one of the queues. When I added
> > two queues in I found out that the message will get sent to both
> > queues and those both workers.
>
> > So I implemented a topic exchange and route to queues based on routing
> > keys. I am now, however, at a loss in figuring out the point of the
> > queues in this system as I could just as easily map 4 different keys
> > to the same queue vs. routing each one to their own queue. Is there a
> > large difference here? Should I be aiming for one approach vs the
> > other?
>
> So we're comparing one topic exchange with multiple routing keys all
> feeding into one queue, versus one topic exchange with multiple routing
> keys each feeding into a separate queue?
>
> There are a couple of differences which may or may not matter to you:
>
> 1) If more than one of your routing keys match a given message, that
> message would get duplicated to each queue in the multiple queue case.
>
> 2) By pushing all the messages into one queue you impose a total
> ordering on your messages, which you may want. But by splitting out the
> messages into multiple queues you may get better performance (if the
> performance of the queue is a limiting factor...)
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From kot.begemot at gmail.com  Wed Feb  8 17:22:20 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Wed, 8 Feb 2012 09:22:20 -0800
Subject: [rabbitmq-discuss] Too many connections in active-active cluster
In-Reply-To: <4F324FBD.4050803@rabbitmq.com>
References: <CAFWGgNG52jWNocf6VEe9z3sW_3o7T1UsrGnnz=QrOznPobA+qw@mail.gmail.com>
	<4F324FBD.4050803@rabbitmq.com>
Message-ID: <CAFWGgNHDMEdEiuC7Z4j5LOD5sWN9g8=uG+5ZEdLxk1wg9odxsA@mail.gmail.com>

Hi Simon,
Thanks for your reply. I think you are right about plugin. It started when
we added "ping" to load balancer. We use http's "/api/" interface to test
for aliveness. Is it a kosher approach?
Meanwhile we will turn aliveness test off and will try to reproduce the
problem with a script.

Vadim.

On Wed, Feb 8, 2012 at 2:34 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 07/02/12 23:53, Vadim Chekan wrote:
>
>> Note that "rabbitmq-stg-1" node is connected to itself hundreds of times
>> via "Direct 0-9-1" protocol .
>> I'm not sure either those enormous amount of connections are the cause
>> of trouble, but seems suspicious.
>> Anybody knows where to look at?
>>
>
> So these are connections made with the Erlang client in direct mode. HA
> doesn't do that. Assuming you are not using the direct Erlang client in
> your own apps, it must be a plugin. The mgmt plugin uses short lived direct
> connections, and shovel and federation use long lived ones - are you using
> either of these?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 

From davidib2001 at yahoo.com  Wed Feb  8 17:25:35 2012
From: davidib2001 at yahoo.com (davidib)
Date: Wed, 8 Feb 2012 09:25:35 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmqctl -n ..... status fails one way but
	not the other
Message-ID: <98246079-1a87-4ab6-b136-a8a7ce9a65e3@d11g2000yqg.googlegroups.com>

Hello,

I've got a sick rabbit cluster which is acting unusual and things have
gone from bad to worse.  Initially, the cluster, consisting of three
nodes/PCs worked ok, i.e. was able to setup a pub/sub test exchange
and worked as expected. Now, not only is the cluster not working (one
machine's rabbitmq log reports Mnesia cannot connect a node on another
machine) but the status command is only working one way!

Basically, I can "rabbitmqctl -n rabbit at A status" while on node B (and
properly see rabbitmq node on A), but "rabbitmqctl -n rabbit at B status"
while on machine A reports the node on B is not running.

I can ping all the machines (nodes A,B,C), all the firewalls have the
proper ports open.  All erlang cookies are the same, etc. I've tried
reinstalling from scratch erlang/Rabbitmq on one of the nodes, still
get the same results.



ACTUAL RESULTS:NODE B (rabbit at LAKE-DS140) CAN SEE NODE A (rabbit at LAKE-
HP166)
C:\Documents and Settings\lst>rabbitmqctl -n rabbit at LAKE-HP166 status
Status of node 'rabbit at LAKE-HP166' ...
[{pid,672},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.7.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {os_mon,"CPO  CXC 138 46","2.2.8"},
      {mnesia,"MNESIA  CXC 138 12","4.6"},
      {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
      {sasl,"SASL  CXC 138 11","2.2"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
      {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
      {inets,"INETS  CXC 138 49","5.8"},
      {stdlib,"ERTS  CXC 138 10","1.18"},
      {kernel,"ERTS  CXC 138 10","2.15"}]},
 {os,{win32,nt}},
 {erlang_version,"Erlang R15B (erts-5.9) [smp:2:2] [async-threads:
30]\n"},
 {memory,
     [{total,18332328},
      {processes,6829982},
      {processes_used,6823567},
      {system,11502346},
      {atom,428361},
      {atom_used,409004},
      {binary,216704},
      {code,8085351},
      {ets,654612}]},
 {vm_memory_high_watermark,0.2287319764753309},
 {vm_memory_limit,858993459}]
...done.


BUT NODE A (rabbit at LAKE-HP166) CANNOT SEE NODE B (rabbit at LAKE-DS140)
F:\Program Files\erl5.9\erts-5.9\bin>rabbitmqctl -n rabbit at LAKE-DS140
status
Status of node 'rabbit at LAKE-DS140' ...
Error: unable to connect to node 'rabbit at LAKE-DS140': nodedown
diagnostics:
- nodes and their ports on LAKE-DS140: [{rabbit,1052}]
- current node: 'rabbitmqctl4211 at lake-hp166'
- current node home dir: F:\Documents and Settings\prm
- current node cookie hash: OkIu/5IPQIZ171ZMFGQ8nQ==

any help very much appreciated

Thanks
David

From simon at rabbitmq.com  Wed Feb  8 17:35:02 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Feb 2012 17:35:02 +0000
Subject: [rabbitmq-discuss] Too many connections in active-active cluster
In-Reply-To: <CAFWGgNHDMEdEiuC7Z4j5LOD5sWN9g8=uG+5ZEdLxk1wg9odxsA@mail.gmail.com>
References: <CAFWGgNG52jWNocf6VEe9z3sW_3o7T1UsrGnnz=QrOznPobA+qw@mail.gmail.com>	<4F324FBD.4050803@rabbitmq.com>
	<CAFWGgNHDMEdEiuC7Z4j5LOD5sWN9g8=uG+5ZEdLxk1wg9odxsA@mail.gmail.com>
Message-ID: <4F32B246.5040000@rabbitmq.com>

On 08/02/12 17:22, Vadim Chekan wrote:
> We use http's "/api/" interface to test for aliveness. Is it a kosher
> approach?

It certainly should be. I recall there was a bug in the aliveness test 
in some old version - what are you using?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From kot.begemot at gmail.com  Wed Feb  8 20:50:30 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Wed, 8 Feb 2012 12:50:30 -0800
Subject: [rabbitmq-discuss] Too many connections in active-active cluster
In-Reply-To: <4F32B246.5040000@rabbitmq.com>
References: <CAFWGgNG52jWNocf6VEe9z3sW_3o7T1UsrGnnz=QrOznPobA+qw@mail.gmail.com>
	<4F324FBD.4050803@rabbitmq.com>
	<CAFWGgNHDMEdEiuC7Z4j5LOD5sWN9g8=uG+5ZEdLxk1wg9odxsA@mail.gmail.com>
	<4F32B246.5040000@rabbitmq.com>
Message-ID: <CAFWGgNFHK4a+pRHPdtaxKK7s184B7Q=GaHEAJ7T=7Z0K3J6W_A@mail.gmail.com>

Rabbit: 2.7.1, erlang: R14B03, CentOS, 64bits.
We've just ran a test with 5 threads querying the API and rabbit is rock
solid. So we are looking suspiciously at our load balancer right now. Will
report the findings...

Thanks for your help Simon,
Vadim.

On Wed, Feb 8, 2012 at 9:35 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 08/02/12 17:22, Vadim Chekan wrote:
>
>> We use http's "/api/" interface to test for aliveness. Is it a kosher
>> approach?
>>
>
> It certainly should be. I recall there was a bug in the aliveness test in
> some old version - what are you using?
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 

From uday.subbarayan at yahoo.com  Wed Feb  8 22:05:39 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Wed, 8 Feb 2012 14:05:39 -0800 (PST)
Subject: [rabbitmq-discuss] Max Consumers?
Message-ID: <1328738739.42356.YahooMailNeo@web44904.mail.sp1.yahoo.com>

Hi All,
? ? ?I am looking at "Fair Dispatch" in the Work Queues to scale a compute intensive engine:
http://www.rabbitmq.com/tutorials/tutorial-two-python.html?


We are potentially looking at from 10's to 100's of compute engines. I know this is bit general question and still would like to check the community-

How many consumers that we can attach to a "work queue" in Rabbit MQ with "fair dispatch"? We are going to run Rabbit MQ (HA mode) in AWS EC2 instances. (we haven't decided the EC2 type yet)

Thanks,
-Uday.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120208/1917608d/attachment.htm>

From kot.begemot at gmail.com  Thu Feb  9 02:42:56 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Wed, 8 Feb 2012 18:42:56 -0800
Subject: [rabbitmq-discuss] Active/Active: shutdown of one service brings
	down the cluster
Message-ID: <CAFWGgNHb9bjDPiW5uR9upBug-eaR2k8nYxhi8TN-vZwA419e1A@mail.gmail.com>

Hi all,

Given: 3 servers in active/active configuration, rabbit: 2.7.1, erlang
R14B03, CentOS, 64bits.
We experienced at least 2 occasions of the following situation: we observe
abnormal high CPU utilization on one of rabbit servers (40% when <10% is a
norm) without any obvious reason. We did nice restart rabbit service and
the whole cluster went down (restarted).
Another effect is that cluster seems to enters some (inconsistent?) state
and queues can not be registered/deleted, list of queues can not be viewed
through management UI, etc.

Here is a log which contains errors when cluster in broken state:
http://pastebin.com/6rweU3MD

Questions:
  Are those errors critical?
  If we experience a high CPU situation again, what can we do, any
additional logging, profiling, process snapshots, etc?

Vadim.

-- 

From kot.begemot at gmail.com  Thu Feb  9 02:44:50 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Wed, 8 Feb 2012 18:44:50 -0800
Subject: [rabbitmq-discuss] Too many connections in active-active cluster
In-Reply-To: <CAFWGgNFHK4a+pRHPdtaxKK7s184B7Q=GaHEAJ7T=7Z0K3J6W_A@mail.gmail.com>
References: <CAFWGgNG52jWNocf6VEe9z3sW_3o7T1UsrGnnz=QrOznPobA+qw@mail.gmail.com>
	<4F324FBD.4050803@rabbitmq.com>
	<CAFWGgNHDMEdEiuC7Z4j5LOD5sWN9g8=uG+5ZEdLxk1wg9odxsA@mail.gmail.com>
	<4F32B246.5040000@rabbitmq.com>
	<CAFWGgNFHK4a+pRHPdtaxKK7s184B7Q=GaHEAJ7T=7Z0K3J6W_A@mail.gmail.com>
Message-ID: <CAFWGgNFCS3vFcO5GNxK63akL-osERMHNqn7PP+FfPP0SpCQwJA@mail.gmail.com>

Hmm, we hit it very hard with scripts which simulate aliveness probe, but
no result. I hope it is related to another problem I've described in
another mail.

Vadim.

On Wed, Feb 8, 2012 at 12:50 PM, Vadim Chekan <kot.begemot at gmail.com> wrote:

> Rabbit: 2.7.1, erlang: R14B03, CentOS, 64bits.
> We've just ran a test with 5 threads querying the API and rabbit is rock
> solid. So we are looking suspiciously at our load balancer right now. Will
> report the findings...
>
> Thanks for your help Simon,
> Vadim.
>
>
> On Wed, Feb 8, 2012 at 9:35 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 08/02/12 17:22, Vadim Chekan wrote:
>>
>>> We use http's "/api/" interface to test for aliveness. Is it a kosher
>>> approach?
>>>
>>
>> It certainly should be. I recall there was a bug in the aliveness test in
>> some old version - what are you using?
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
>
>
> --
> From RFC 2631: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT is
> explicitly specified
>



-- 

From michael.s.klishin at gmail.com  Thu Feb  9 04:42:02 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 9 Feb 2012 08:42:02 +0400
Subject: [rabbitmq-discuss] [announcement] amqp gem 0.9.3 is released
Message-ID: <AA2BF87D-7E77-47A4-B675-3442CBF9F218@gmail.com>

Ruby amqp gem 0.9.3 is released to rubygems.org [1].

This is a bug fix release:

* Channel id allocator now releases channel ids after we receive channel.close-ok
   from RabbitMQ, not immediately after AMQP::Channel#close is invoked. This fixes a race condition
   for applications that actively close and reuse channel instances.

Continuous integration status:

http://travis-ci.org/#!/ruby-amqp/amqp
http://travis-ci.org/#!/ruby-amqp/amq-client

Have a good day.


1. https://rubygems.org/gems/amqp/versions/0.9.3

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From jon.hill at comshen.com  Thu Feb  9 09:51:15 2012
From: jon.hill at comshen.com (Jon Hill)
Date: Thu, 9 Feb 2012 01:51:15 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ as backbone to a multi-player online
	game .
Message-ID: <057a8051-3858-43fc-8b46-460c6d5dc208@dq9g2000vbb.googlegroups.com>

Hi

Is there anyone on the list who has experience of using RabbitMQ for
online social-gaming who would like to share experiences? Our client
application is in Flash and we are communicating with Game Servers via
RabbitMQ. We need to support 100K concurrent users so will either need
a big central cluster to handle all messaging or we might look at some
kind of sharding and use multiple RabbitMQ clusters. I would be happy
to hear if anyone could offer any professional (paid for) support to
us too.

All the best.

Jon

From sdaswani at gmail.com  Wed Feb  8 21:48:54 2012
From: sdaswani at gmail.com (Susheel Daswani)
Date: Wed, 8 Feb 2012 13:48:54 -0800 (PST)
Subject: [rabbitmq-discuss] SimpleConsumer EOFException
Message-ID: <f56426a5-56ed-4d73-8cac-591593d69726@vd8g2000pbc.googlegroups.com>

Hey there!

I am using the RabbitMQ SimpleConsumer example to subscribe to a
message queue, but I am frequently seeing the following exception (I
have redacted the machine and queue information):

-------------
bash-3.2$ ./build/dist/runjava.sh com.rabbitmq.examples.SimpleConsumer
'amqp://****:****@****/****' '****'


Main thread caught exception:
com.rabbitmq.client.ShutdownSignalException: connection error; reason:
java.io.EOFException
com.rabbitmq.client.ShutdownSignalException: connection error; reason:
java.io.EOFException
	at com.rabbitmq.client.QueueingConsumer.handle(QueueingConsumer.java:
198)
	at
com.rabbitmq.client.QueueingConsumer.nextDelivery(QueueingConsumer.java:
214)
	at com.rabbitmq.examples.SimpleConsumer.main(SimpleConsumer.java:41)
Caused by: java.io.EOFException
	at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:273)
	at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:95)
	at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:
131)
	at com.rabbitmq.client.impl.AMQConnection
$MainLoop.run(AMQConnection.java:492)

-------------

Any ideas why this is occurring? Is this likely a problem with
SimpleConsumer or with the RabbitMQ?

Thanks!
Susheel

From emile at rabbitmq.com  Thu Feb  9 10:49:24 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 09 Feb 2012 10:49:24 +0000
Subject: [rabbitmq-discuss] SimpleConsumer EOFException
In-Reply-To: <f56426a5-56ed-4d73-8cac-591593d69726@vd8g2000pbc.googlegroups.com>
References: <f56426a5-56ed-4d73-8cac-591593d69726@vd8g2000pbc.googlegroups.com>
Message-ID: <4F33A4B4.5060201@rabbitmq.com>

Hi Susheel,

On 08/02/12 21:48, Susheel Daswani wrote:
> java.io.EOFException
> 	at com.rabbitmq.client.QueueingConsumer.handle(QueueingConsumer.java:

An EOF exception on a socket points to a network problem. You could try
to eliminate the network by running the test over localhost, or enable
AMQP heartbeats.


-Emile

From emile at rabbitmq.com  Thu Feb  9 11:06:38 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 09 Feb 2012 11:06:38 +0000
Subject: [rabbitmq-discuss] rabbitmqctl -n ..... status fails one way
 but not the other
In-Reply-To: <98246079-1a87-4ab6-b136-a8a7ce9a65e3@d11g2000yqg.googlegroups.com>
References: <98246079-1a87-4ab6-b136-a8a7ce9a65e3@d11g2000yqg.googlegroups.com>
Message-ID: <4F33A8BE.8030609@rabbitmq.com>

Hi,

On 08/02/12 17:25, davidib wrote:
> Basically, I can "rabbitmqctl -n rabbit at A status" while on node B (and
> properly see rabbitmq node on A), but "rabbitmqctl -n rabbit at B status"
> while on machine A reports the node on B is not running.

This might be a firewall issue. Check whether you can establish a TCP
connection to port 1052 on node B from node A. Running a cluster across
firewalls (outside a datacentre) or over unreliable network links is not
recommended. For more information see:
http://www.rabbitmq.com/clustering.html#firewall


-Emile

From simon at rabbitmq.com  Thu Feb  9 12:21:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 09 Feb 2012 12:21:06 +0000
Subject: [rabbitmq-discuss] Active/Active: shutdown of one service
 brings down the cluster
In-Reply-To: <CAFWGgNHb9bjDPiW5uR9upBug-eaR2k8nYxhi8TN-vZwA419e1A@mail.gmail.com>
References: <CAFWGgNHb9bjDPiW5uR9upBug-eaR2k8nYxhi8TN-vZwA419e1A@mail.gmail.com>
Message-ID: <4F33BA32.100@rabbitmq.com>

Hi. Thanks for the error report. There seem to be a lot of strange 
things happening here - can you provide more complete logs from such an 
incident?

Cheers, Simon

On 09/02/12 02:42, Vadim Chekan wrote:
> Hi all,
>
> Given: 3 servers in active/active configuration, rabbit: 2.7.1, erlang
> R14B03, CentOS, 64bits.
> We experienced at least 2 occasions of the following situation: we
> observe abnormal high CPU utilization on one of rabbit servers (40% when
> <10% is a norm) without any obvious reason. We did nice restart rabbit
> service and the whole cluster went down (restarted).
> Another effect is that cluster seems to enters some (inconsistent?)
> state and queues can not be registered/deleted, list of queues can not
> be viewed through management UI, etc.
>
> Here is a log which contains errors when cluster in broken state:
> http://pastebin.com/6rweU3MD
>
> Questions:
>    Are those errors critical?
>    If we experience a high CPU situation again, what can we do, any
> additional logging, profiling, process snapshots, etc?
>
> Vadim.
>
> --
>  From RFC 2631: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT
> is explicitly specified
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Feb  9 12:26:04 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 09 Feb 2012 12:26:04 +0000
Subject: [rabbitmq-discuss] Max Consumers?
In-Reply-To: <1328738739.42356.YahooMailNeo@web44904.mail.sp1.yahoo.com>
References: <1328738739.42356.YahooMailNeo@web44904.mail.sp1.yahoo.com>
Message-ID: <4F33BB5C.4030209@rabbitmq.com>

Hi Uday,

On 08/02/12 22:05, Uday Subbarayan wrote:
> We are potentially looking at from 10's to 100's of compute engines. I
> know this is bit general question and still would like to check the
> community-
> 
> How many consumers that we can attach to a "work queue" in Rabbit MQ
> with "fair dispatch"? We are going to run Rabbit MQ (HA mode) in AWS EC2
> instances. (we haven't decided the EC2 type yet)

RabbitMQ does not impose any limit on the number of consumers to a
queue. The range you have in mind should work fine, assuming all
channels use a small QoS value.

Bear in mind that the broker allocates an Erlang process for each queue.
If you have fewer queues than CPU cores then this might be a bottleneck.



-Emile

From Massimo.Paladin at cern.ch  Thu Feb  9 13:47:39 2012
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Thu, 9 Feb 2012 14:47:39 +0100
Subject: [rabbitmq-discuss] web interface on two ports and different
 settings: ssl and non ssl
In-Reply-To: <4F32570E.9070004@rabbitmq.com>
References: <CAMOXM2_GFf+4o3-_1UmXPdogPcYao6NmuxE2-QHM7k4hJYbTzQ@mail.gmail.com>
	<CAMOXM28X8V+TE8ZEswc37L6Yy3Kxy_S9YitzKUWaoaYyxAwg5w@mail.gmail.com>
	<4F32570E.9070004@rabbitmq.com>
Message-ID: <CAMOXM28U89J0k0h=rBRL5Cp0hEyYS0USdGHWVf6+o236vgtHBw@mail.gmail.com>

On Wed, Feb 8, 2012 at 12:05 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 06/02/12 16:35, Massimo Paladin wrote:
>
>> Hello,
>>
>> no one has an idea if this is possible?
>>
>
> No, it's not at the moment.
>
>
>  It would be nice to have such configuration for different reasons:
>> - one port without ssl for monitoring access (lightweight, frequent
>> access)
>> - one port enforced with ssl for admin access (more secure, data could
>> be more sensible)
>>
>
> Hmm. We could add this without too much hassle. Unless you would want to
> ban certain classes of users from connecting without SSL - config for that
> would get messy quickly.
>

The simple solution would be fine.


> But are you actually finding that the SSL overhead is a big deal? I would
> expect (admittedly without measuring it) that whatever work mgmt does to
> respond to your query would overwhelm the effort involved in establishing
> an SSL connection.
>

The overhead we consider is not only on the rabbitmq side but on
the monitoring side too.


> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>

It would be great if it could be in the next release.

Cheers,
-
Massimo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120209/b50a9c3f/attachment.htm>

From davidib2001 at yahoo.com  Thu Feb  9 14:07:13 2012
From: davidib2001 at yahoo.com (davidib)
Date: Thu, 9 Feb 2012 06:07:13 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmqctl -n ..... status fails one way
	but not the other
In-Reply-To: <4F33A8BE.8030609@rabbitmq.com>
References: <98246079-1a87-4ab6-b136-a8a7ce9a65e3@d11g2000yqg.googlegroups.com>
	<4F33A8BE.8030609@rabbitmq.com>
Message-ID: <9bcbe74c-197f-48fd-8404-9b9058bf1357@jn12g2000pbb.googlegroups.com>

Emile,

Thanks so much for the feedback.  I've explicitly opened ports
2098,4369 and 5672 on all three hosts in the cluster.  None of them
have 1052 currently open, not sure why A can status B and B cannot
status A but  I'll open posts 1052 and try it.  Are there any other
ports that I should make sure are open?

BTW I can't find any documentation regarding Rabbitmq/erlang using
port 1052.  Did I miss something/is this documented anywhere?

Thanks again
David



On Feb 9, 5:06?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> On 08/02/12 17:25, davidib wrote:
>
> > Basically, I can "rabbitmqctl -n rabbit at A status" while on node B (and
> > properly see rabbitmq node on A), but "rabbitmqctl -n rabbit at B status"
> > while on machine A reports the node on B is not running.
>
> This might be a firewall issue. Check whether you can establish a TCP
> connection to port 1052 on node B from node A. Running a cluster across
> firewalls (outside a datacentre) or over unreliable network links is not
> recommended. For more information see:http://www.rabbitmq.com/clustering.html#firewall
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Feb  9 14:22:47 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 09 Feb 2012 14:22:47 +0000
Subject: [rabbitmq-discuss] web interface on two ports and different
 settings: ssl and non ssl
In-Reply-To: <CAMOXM28U89J0k0h=rBRL5Cp0hEyYS0USdGHWVf6+o236vgtHBw@mail.gmail.com>
References: <CAMOXM2_GFf+4o3-_1UmXPdogPcYao6NmuxE2-QHM7k4hJYbTzQ@mail.gmail.com>
	<CAMOXM28X8V+TE8ZEswc37L6Yy3Kxy_S9YitzKUWaoaYyxAwg5w@mail.gmail.com>
	<4F32570E.9070004@rabbitmq.com>
	<CAMOXM28U89J0k0h=rBRL5Cp0hEyYS0USdGHWVf6+o236vgtHBw@mail.gmail.com>
Message-ID: <4F33D6B7.8010806@rabbitmq.com>

On 09/02/12 13:47, Massimo Paladin wrote:
> The overhead we consider is not only on the rabbitmq side but on
> the monitoring side too.

Hmm, OK. Well, I'll take your word for it :)

I'll file a bug.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Feb  9 14:25:38 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 09 Feb 2012 14:25:38 +0000
Subject: [rabbitmq-discuss] rabbitmqctl -n ..... status fails one way
 but not the other
In-Reply-To: <9bcbe74c-197f-48fd-8404-9b9058bf1357@jn12g2000pbb.googlegroups.com>
References: <98246079-1a87-4ab6-b136-a8a7ce9a65e3@d11g2000yqg.googlegroups.com>
	<4F33A8BE.8030609@rabbitmq.com>
	<9bcbe74c-197f-48fd-8404-9b9058bf1357@jn12g2000pbb.googlegroups.com>
Message-ID: <4F33D762.1020805@rabbitmq.com>

David,

On 09/02/12 14:07, davidib wrote:
> BTW I can't find any documentation regarding Rabbitmq/erlang using
> port 1052.  Did I miss something/is this documented anywhere?

Firewall setup to allow clustering is documented here:
http://www.rabbitmq.com/clustering.html#firewall

The cases where it makes sense to run a cluster over a firewall is
limited and you should carefully consider whether yours qualifies. It is
more common to use Federation and the Shovel plugins over firewalled
links. See http://www.rabbitmq.com/distributed.html


-Emile

From simon at rabbitmq.com  Thu Feb  9 15:01:29 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 09 Feb 2012 15:01:29 +0000
Subject: [rabbitmq-discuss] rabbitmqadmin and ability to read
 configuration files
In-Reply-To: <CAMOXM2-yT_ZSX4_FkJpnh=GFX4_QT8pLKt+j8pnnZF6QHp1BmA@mail.gmail.com>
References: <CAMOXM2-yT_ZSX4_FkJpnh=GFX4_QT8pLKt+j8pnnZF6QHp1BmA@mail.gmail.com>
Message-ID: <4F33DFC9.60903@rabbitmq.com>

On 06/02/12 17:09, Massimo Paladin wrote:
> it would be nice to see it in the next release.

OK, in that case you're lucky enough to get some code review notes :-)

* Defaults seem to be broken if the configuration file is not used

* It would probably make sense to look for the config file in a standard 
location if "-c" is not specified, e.g. ~/.rabbitmqadmin.conf

* For extra credit: make the bash completion script complete "-N" from 
the config file...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From drobins at FreedomScientific.com  Thu Feb  9 15:13:51 2012
From: drobins at FreedomScientific.com (David Robins)
Date: Thu, 9 Feb 2012 15:13:51 +0000
Subject: [rabbitmq-discuss] Pika error - ack/reject throws exception
Message-ID: <BD8C81D12631F64B8D09A485AA3B023201189C@hermes.FSI.local>

I'm using Pika and Python (3.2.2) to access RabbitMQ (2.6.1) queues, on Linux (kernel 3.0.6); specifically, I have some code that creates a blocking connection, binds a channel to a couple of queues, calls
basic_consume on the channel for each queue with no_ack=False, and then start_consuming.

It drains a (random - in recent runs I saw 14, 4, then 9) number of messages already in the queue under basic_consume, but then throws the following exception:

        Traceback (most recent call last):
                File "./ep_test", line 62, in <module>
                        et.track(args.drain)
                File "./ep_test", line 41, in track
                        self.q2.consume(callback, auto_ack=False)
                File "/home/dbrobins/code/utils/tq/broker.py", line 45, in consume
                        self.brk.chan.basic_consume(thunk, queue=self.qname, no_ack=auto_ack)
                File "/usr/lib64/python3.2/site-packages/pika-0.9.5-py3.2.egg/pika/channel.py", line 368, in basic_consume
                        [spec.Basic.ConsumeOk])
                File "/usr/lib64/python3.2/site-packages/pika-0.9.5-py3.2.egg/pika/adapters/blocking_connection.py", line 224, in rpc
                        frame = self._frames[reply]
        KeyError: 'Basic.ConsumeOk'

Am I doing something wrong in thinking I can ack a message in this state? It doesn't throw an exception with no_ack=True. If so, what? Or is it a bug in the pika module or a problem with RabbitMQ?

I've done a little debugging and it's possible I'm getting two Basic.ConsumeOk frames - if so, would that be a bug in RabbitMQ or does the client need to expect this? Is there a way to get verbose debug
output from RabbitMQ? - searches indicate no, except perhaps to watch it with an independent network tracing tool? Thanks for any help.

...

This is likely an instance of issue #70 on GitHub (https://github.com/pika/pika/issues/70) which says "Pending Fix" - does that mean that a fix is available but unreleased, or that there is no fix yet?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120209/6db8d0a2/attachment.htm>

From jerryk at vmware.com  Thu Feb  9 15:34:41 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 9 Feb 2012 07:34:41 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ as backbone to a multi-player
	online	game .
In-Reply-To: <057a8051-3858-43fc-8b46-460c6d5dc208@dq9g2000vbb.googlegroups.com>
Message-ID: <46375f53-9db2-438e-b6e1-aef6f67cbe12@strongmad.batnest.org>

Hi, Jon:

There are some RabbitMQ users who work in commercial online gaming,
but comparing your application to theirs would require knowing more
about both than I do... :-)

Clustering RabbitMQ, and perhaps using shovel or federation to link
clusters, can be sensible directions to take for scaling.  Which
directions you need to take, and how much work you need to do, really
depend on the complexity of your application's messaging fabric and
the actual runtime load distributions it experiences.  There are some
things you can guesstimate back of the envelope, but the best approach
is often to proof of concept something roughly the shape of what you
want to build, and then test it under real or simulated load, and then
iterate from there.  Sharing your experiences, and poking this mailing
list for ideas can often be helpful.

RabbitMQ, although open source, is owned by VMware, through whom
commercial support and consulting are provided.  If you'd like to
pursue that route, we can probably connect you with the correct folks...

Best regards,
Jerry

----- Original Message -----
From: "Jon Hill" <jon.hill at comshen.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, February 9, 2012 1:51:15 AM
Subject: [rabbitmq-discuss] RabbitMQ as backbone to a multi-player online	game .

Hi

Is there anyone on the list who has experience of using RabbitMQ for
online social-gaming who would like to share experiences? Our client
application is in Flash and we are communicating with Game Servers via
RabbitMQ. We need to support 100K concurrent users so will either need
a big central cluster to handle all messaging or we might look at some
kind of sharding and use multiple RabbitMQ clusters. I would be happy
to hear if anyone could offer any professional (paid for) support to
us too.

All the best.

Jon
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ask at rabbitmq.com  Thu Feb  9 16:51:00 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Thu, 9 Feb 2012 16:51:00 +0000
Subject: [rabbitmq-discuss] Pika error - ack/reject throws exception
In-Reply-To: <BD8C81D12631F64B8D09A485AA3B023201189C@hermes.FSI.local>
References: <BD8C81D12631F64B8D09A485AA3B023201189C@hermes.FSI.local>
Message-ID: <EC57F290-EDE8-46AE-98BA-F338BCBD0A78@rabbitmq.com>


On 9 Feb 2012, at 15:13, David Robins wrote:

> 
> This is likely an instance of issue #70 on GitHub (https://github.com/pika/pika/issues/70) which says ?Pending Fix? ? does that mean that a fix is available but unreleased, or that there is no fix yet?

It does look like a lot like your issue, maybe you should comment
on the issue to get the maintainers attention?

I'm not sure, but I would guess "Pending fix" to mean
that there is no fix yet.  If there was a fix committed, then usually the issue is also closed.  They also have a "Resolved for next version" label, as seen here:
https://github.com/pika/pika/issues/63.


From gmr at myyearbook.com  Thu Feb  9 17:25:31 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 9 Feb 2012 12:25:31 -0500
Subject: [rabbitmq-discuss] Pika error - ack/reject throws exception
In-Reply-To: <BD8C81D12631F64B8D09A485AA3B023201189C@hermes.FSI.local>
References: <BD8C81D12631F64B8D09A485AA3B023201189C@hermes.FSI.local>
Message-ID: <B3F93CAE34C34232BD18ABD35399C42E@myyearbook.com>

I have not had time to put in the fix yet, but I am aware of the problem and hope to be able to get to it this weekend.  

Gavin  


On Thursday, February 9, 2012 at 10:13 AM, David Robins wrote:

>  
> I'm using Pika and Python (3.2.2) to access RabbitMQ (2.6.1) queues, on Linux (kernel 3.0.6); specifically, I have some code that creates a blocking connection, binds a channel to a couple of queues, calls
>  
>  
> basic_consume on the channel for each queue with no_ack=False, and then start_consuming.
>  
>  
>   
>  
>  
> It drains a (random - in recent runs I saw 14, 4, then 9) number of messages already in the queue under basic_consume, but then throws the following exception:
>  
>  
>   
>  
>  
>         Traceback (most recent call last):
>  
>  
>                 File "./ep_test", line 62, in <module>
>  
>  
>                         et.track(args.drain)
>  
>  
>                 File "./ep_test", line 41, in track
>  
>  
>                         self.q2.consume(callback, auto_ack=False)
>  
>  
>                 File "/home/dbrobins/code/utils/tq/broker.py", line 45, in consume
>  
>  
>                         self.brk.chan.basic_consume(thunk, queue=self.qname, no_ack=auto_ack)
>  
>  
>                 File "/usr/lib64/python3.2/site-packages/pika-0.9.5-py3.2.egg/pika/channel.py", line 368, in basic_consume
>  
>  
>                         [spec.Basic.ConsumeOk])
>  
>  
>                 File "/usr/lib64/python3.2/site-packages/pika-0.9.5-py3.2.egg/pika/adapters/blocking_connection.py", line 224, in rpc
>  
>  
>                         frame = self._frames[reply]
>  
>  
>         KeyError: 'Basic.ConsumeOk'
>  
>  
>   
>  
>  
> Am I doing something wrong in thinking I can ack a message in this state? It doesn't throw an exception with no_ack=True. If so, what? Or is it a bug in the pika module or a problem with RabbitMQ?
>  
>  
>   
>  
>  
> I've done a little debugging and it's possible I'm getting two Basic.ConsumeOk frames - if so, would that be a bug in RabbitMQ or does the client need to expect this? Is there a way to get verbose debug
>  
>  
> output from RabbitMQ? - searches indicate no, except perhaps to watch it with an independent network tracing tool? Thanks for any help.
>  
>  
>   
>  
>  
> ?
>  
>  
>   
>  
>  
> This is likely an instance of issue #70 on GitHub (https://github.com/pika/pika/issues/70) which says ?Pending Fix? ? does that mean that a fix is available but unreleased, or that there is no fix yet?
>  
>  
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  
>  


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120209/088ff6ba/attachment.htm>

From sdaswani at gmail.com  Thu Feb  9 18:12:49 2012
From: sdaswani at gmail.com (Susheel Daswani)
Date: Thu, 9 Feb 2012 10:12:49 -0800 (PST)
Subject: [rabbitmq-discuss] SimpleConsumer EOFException
In-Reply-To: <4F33A4B4.5060201@rabbitmq.com>
References: <f56426a5-56ed-4d73-8cac-591593d69726@vd8g2000pbc.googlegroups.com>
	<4F33A4B4.5060201@rabbitmq.com>
Message-ID: <6199b13c-e77d-4452-b1af-48747838d7ef@ub4g2000pbc.googlegroups.com>

Thanks Emile - I will look into AMQP heartbeats.

Another issue I've run into is my Queuing Consumer isn't connecting
reliably. I will start up a Queuing Consumer and it may or may not
connect, depending on how it is feeling ;) . When it doesn't connect,
I usually won't see any exception, though it will sometimes error out
with the EOFException I previously wrote about. FYI I am sure there
are messages to be consumed as I can see them from our web admin
interface.

Here is my code, which I pretty created from following the examples
online (e.g., http://www.rabbitmq.com/tutorials/tutorial-one-java.html):

package com.atti.ratingstrends.rabbitreceiver;

import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.QueueingConsumer;

public class Receiver {

    private String _uri;
    private String _queueName;
    private Connection _connection;
    private Channel _channel;
    private QueueingConsumer _consumer;

    // Used during construction and attempts to re-establish
    private void initConsumer()
        throws java.net.URISyntaxException, java.io.IOException,
               java.security.NoSuchAlgorithmException,
               java.security.KeyManagementException {

        // cleanup
        if (_connection != null)
            _connection.close();
        if (_channel != null)
            _channel.close();

        ConnectionFactory factory = new ConnectionFactory();
        factory.setUri(_uri);
        _connection = factory.newConnection();

        _channel = _connection.createChannel();
        _channel.queueDeclare(_queueName, false, false, false, null);

        _consumer = new QueueingConsumer(_channel);
        _channel.basicConsume(_queueName, true, _consumer);
    }

    /**
       @param uri The full amqp uri for the RabbitMQ you want to
access.
       @param queueName The name of the queue you want to access.
     */
    // Not opting for a static factory method. May want to subclass
and
    // not many variations of this class expected.
    public Receiver(String uri, String queueName)
        throws java.net.URISyntaxException, java.io.IOException,
               java.security.NoSuchAlgorithmException,
               java.security.KeyManagementException {

        if (queueName == null || queueName.equals(""))
            throw new java.io.IOException("Queue name must not be null
or empty.");
        _queueName = queueName;
        _uri = uri;

        initConsumer();
    }

    /** Will block.
     */
    public String getNextMessageBody() throws
java.lang.InterruptedException {
        try {
            QueueingConsumer.Delivery delivery =
_consumer.nextDelivery();
            return new String(delivery.getBody());
        }
        // Catching Runtime Exceptions are bad, but here, I don't
understand
        // why we are seeing EOF exceptions, since the RabbitMQ should
never
        // EOF. So attempt to restart the connection ONCE.
        catch (com.rabbitmq.client.ShutdownSignalException io) {
            if (io.getReason() instanceof java.io.EOFException) {
                System.out.println("Receiver.getNextMessageBody(): The
RabbitMQ threw an EOF - attempting to re-start connection:" + io);
                try {
                    initConsumer();
                    QueueingConsumer.Delivery delivery =
_consumer.nextDelivery();
                    return new String(delivery.getBody());
                }
                catch (Exception e) {
                    System.out.println("Receiver.getNextMessageBody():
The RabbitMQ threw an EOF - restart attempt failed!");
                    throw io;
                }
            }
            throw io;
        }
    }

    /** Caution - will empty all old messages.
     * @returns The number of messages purge.
     * @throws java.io.IOException - if an error is encountered.
     */
    public int purge() throws java.io.IOException {
        return _channel.queuePurge(_queueName).getMessageCount();
    }
}

Does it look like I am doing anything wrong that would cause the
connection issue?

Thanks!
Susheel

On Feb 9, 2:49?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Susheel,
>
> On 08/02/12 21:48, Susheel Daswani wrote:
>
> > java.io.EOFException
> > ? ?at com.rabbitmq.client.QueueingConsumer.handle(QueueingConsumer.java:
>
> An EOF exception on a socket points to a network problem. You could try
> to eliminate the network by running the test over localhost, or enable
> AMQP heartbeats.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ci6236485 at gmail.com  Thu Feb  9 18:52:17 2012
From: ci6236485 at gmail.com (Vic)
Date: Thu, 9 Feb 2012 10:52:17 -0800 (PST)
Subject: [rabbitmq-discuss] Installing rabbitmq server in silent mode
Message-ID: <1bd24ca4-1196-4f57-ac08-a2ec1957d682@q12g2000yqg.googlegroups.com>

Hello,
Is there a way to install rabbitmq-server-2.7.1.exe in silent mode?

Thanks

From lockonoko at gmail.com  Thu Feb  9 19:12:29 2012
From: lockonoko at gmail.com (Loc Ngo)
Date: Thu, 9 Feb 2012 11:12:29 -0800 (PST)
Subject: [rabbitmq-discuss] Pika cannot handle tcpkill command. 'NoneType'
 is not catched in Pika library - particularly in File
 "/usr/local/lib/python2.7/dist-packages/pika-0.9.5-py2.7.egg/pika/adapters/base_connection.py",
 in function "def _handle_error(self, error):"
Message-ID: <19725729.167.1328814749937.JavaMail.geo-discussion-forums@pbqv10>

I used tcpkill -i eth0 port **** to release the socket on client machine. 
The TCP connection from client to Rabbitmq server is killed. But inside 
calling function connection.ioloop.start() happens error. The lowest error 
tracking level is in def _handle_error(self, error) function of file 
"base_connection.py" in pika library. It cannot handle NULL value of 
variable error. So the program crashed unexpectedly.

I try to intervene the Pika library code by add some exceptions. Now it can 
handle the NULL exception and my program can create new socket to connect 
to RabbitMq server.

Because that solution requires changing library source code, I just want to 
know another solution without changing library source code to ensure the 
encapsulation.
Any suggestion about writing the rabbitmq connection on client to handle 
the tcpkill command.

I really appreciate your answers.
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120209/d78cdbe2/attachment.htm>

From uday.subbarayan at yahoo.com  Thu Feb  9 22:55:06 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Thu, 9 Feb 2012 14:55:06 -0800 (PST)
Subject: [rabbitmq-discuss] Max Consumers?
In-Reply-To: <4F33BB5C.4030209@rabbitmq.com>
References: <1328738739.42356.YahooMailNeo@web44904.mail.sp1.yahoo.com>
	<4F33BB5C.4030209@rabbitmq.com>
Message-ID: <1328828106.72534.YahooMailNeo@web44909.mail.sp1.yahoo.com>

Thanks Emile.
"If you have fewer queues than CPU cores then this might be a bottleneck."

I thought this should be other way around- if we have fewer CPU cores than queues, then it might be a bottleneck. Am I correct?

Best,
-Uday.


________________________________
 From: Emile Joubert <emile at rabbitmq.com>
To: Uday Subbarayan <uday.subbarayan at yahoo.com> 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Thursday, February 9, 2012 4:26 AM
Subject: Re: [rabbitmq-discuss] Max Consumers?
 
Hi Uday,

On 08/02/12 22:05, Uday Subbarayan wrote:
> We are potentially looking at from 10's to 100's of compute engines. I
> know this is bit general question and still would like to check the
> community-
> 
> How many consumers that we can attach to a "work queue" in Rabbit MQ
> with "fair dispatch"? We are going to run Rabbit MQ (HA mode) in AWS EC2
> instances. (we haven't decided the EC2 type yet)

RabbitMQ does not impose any limit on the number of consumers to a
queue. The range you have in mind should work fine, assuming all
channels use a small QoS value.

Bear in mind that the broker allocates an Erlang process for each queue.
If you have fewer queues than CPU cores then this might be a bottleneck.



-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120209/4e5d8ba2/attachment.htm>

From uday.subbarayan at yahoo.com  Thu Feb  9 23:32:27 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Thu, 9 Feb 2012 15:32:27 -0800 (PST)
Subject: [rabbitmq-discuss] HA Documentation Error?
Message-ID: <1328830347.88766.YahooMailNeo@web44913.mail.sp1.yahoo.com>

Hi Rabbit MQ Team,
? ? I am reading your HA documentation-
http://www.rabbitmq.com/ha.html?


The following statement under "Mirrored Queue?Behavior" seems to have typo.

"All actions other than publishes go only to the master, and the master then broadcasts the effect of the actions to the slaves. Thus clients consuming from a mirrored queue are in fact consuming from the master."

The first?statement?should be-
All actions other than publishes go only to the?SLAVE, ... (instead of master)


Am i correct?

Side Note: Pl correct the spelling for "Behavior" in the title.

Thanks,
-Uday.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120209/cc4e4bae/attachment.htm>

From shammi at arosys.com  Fri Feb 10 07:43:43 2012
From: shammi at arosys.com (cheepu)
Date: Thu, 9 Feb 2012 23:43:43 -0800 (PST)
Subject: [rabbitmq-discuss]  Problem in installing in bebian
Message-ID: <33298595.post@talk.nabble.com>


Hi
I downloaded the rabbitmq-server-generic-unix-2.7.1.tar and extracted it in
the /usr/local/rabbitmq directory. When I started the server
bin/rabbitmq-server Its not started with given error erl not found.
             Now to install Erlang, I have downloaded otp_src_R15B.tar.gz
I run the following command to extracted  it  using command
tar zxf otp_src_R15B.tar.gz
in the directory /usr/local/erlang directory
then ./configure
and after that make command
but make command is not working because it is not able to find the
otp_deb.mk file and it doesnot exists in the specified directory.
What else i can use to install the erl in debian.

Thanks
-- 
View this message in context: http://old.nabble.com/Problem-in-installing-in-bebian-tp33298595p33298595.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From liuzhuofu at huawei.com  Fri Feb 10 08:22:10 2012
From: liuzhuofu at huawei.com (Liuzhuofu)
Date: Fri, 10 Feb 2012 08:22:10 +0000
Subject: [rabbitmq-discuss] Can't process_flag(trap_exit, true) in process
Message-ID: <D027DE656EBD4F4C8EE57361B5EF438E399163FB@szxeml524-mbs.china.huawei.com>

Hi all:
I found a strange thing:
I create a connection and channel in process 1, and subscribe a queue with process 2, which created by "spawn_link" in process 1, if I run "process_flag(trap_exit, true)" in process 1, the process 2 will receive a 'basic.cancel' message for the subscribe queue. If I don't run "process_flag(trap_exit, true)" in process 1,  the process 2 will never receive that.
Why ?

Regards,
  David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120210/90857a0c/attachment.htm>

From alexandru at rabbitmq.com  Fri Feb 10 09:38:04 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 10 Feb 2012 09:38:04 +0000
Subject: [rabbitmq-discuss] Can't process_flag(trap_exit,
	true) in process
In-Reply-To: <D027DE656EBD4F4C8EE57361B5EF438E399163FB@szxeml524-mbs.china.huawei.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E399163FB@szxeml524-mbs.china.huawei.com>
Message-ID: <20120210093804.GA3845@southbank.Home>

Hi David,

> I create a connection and channel in process 1, and subscribe a queue with process 2, which created by "spawn_link" in process 1, if I run "process_flag(trap_exit, true)" in process 1, the process 2 will receive a 'basic.cancel' message for the subscribe queue. If I don't run "process_flag(trap_exit, true)" in process 1,  the process 2 will never receive that.

I don't follow.  Are you saying that running "process_flag(trap_exit,
true)" in process 1, the queue will get deleted immediately (and hence
process 2 will receive a basic.cancel)?

Could you post your code please?

Cheers,
Alex

On Fri, Feb 10, 2012 at 08:22:10AM +0000, Liuzhuofu wrote:
> Hi all:
> I found a strange thing:
> I create a connection and channel in process 1, and subscribe a queue with process 2, which created by "spawn_link" in process 1, if I run "process_flag(trap_exit, true)" in process 1, the process 2 will receive a 'basic.cancel' message for the subscribe queue. If I don't run "process_flag(trap_exit, true)" in process 1,  the process 2 will never receive that.
> Why ?
> 
> Regards,
>   David

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexandru at rabbitmq.com  Fri Feb 10 09:43:13 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 10 Feb 2012 09:43:13 +0000
Subject: [rabbitmq-discuss] Problem in installing in bebian
In-Reply-To: <33298595.post@talk.nabble.com>
References: <33298595.post@talk.nabble.com>
Message-ID: <20120210094313.GB3845@southbank.Home>

Hi,

The website describes the steps to install RabbitMQ on Debian:
  http://www.rabbitmq.com/install-debian.html

Basically, you have to add this line to /etc/apt/sources.list
  deb http://www.rabbitmq.com/debian/ testing main

And then run:
  sudo apt-get update
  sudo apt-get install rabbitmq-server

That will install the latest RabbitMQ server and take care of
dependencies.

Is there a reason why you don't use the package manager?

Cheers,
Alex

On Thu, Feb 09, 2012 at 11:43:43PM -0800, cheepu wrote:
> 
> Hi
> I downloaded the rabbitmq-server-generic-unix-2.7.1.tar and extracted it in
> the /usr/local/rabbitmq directory. When I started the server
> bin/rabbitmq-server Its not started with given error erl not found.
>              Now to install Erlang, I have downloaded otp_src_R15B.tar.gz
> I run the following command to extracted  it  using command
> tar zxf otp_src_R15B.tar.gz
> in the directory /usr/local/erlang directory
> then ./configure
> and after that make command
> but make command is not working because it is not able to find the
> otp_deb.mk file and it doesnot exists in the specified directory.
> What else i can use to install the erl in debian.
> 
> Thanks
> -- 
> View this message in context: http://old.nabble.com/Problem-in-installing-in-bebian-tp33298595p33298595.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From liuzhuofu at huawei.com  Fri Feb 10 09:59:23 2012
From: liuzhuofu at huawei.com (Liuzhuofu)
Date: Fri, 10 Feb 2012 09:59:23 +0000
Subject: [rabbitmq-discuss] =?utf-8?b?IOetlOWkjTogIENhbid0IHByb2Nlc3NfZmxh?=
 =?utf-8?q?g=28trap=5Fexit=2C_true=29_in_process?=
In-Reply-To: <20120210093804.GA3845@southbank.Home>
References: <D027DE656EBD4F4C8EE57361B5EF438E399163FB@szxeml524-mbs.china.huawei.com>
	<20120210093804.GA3845@southbank.Home>
Message-ID: <D027DE656EBD4F4C8EE57361B5EF438E39916453@szxeml524-mbs.china.huawei.com>

Hi Alex:

the process 1 follow:
process_flag(trap_exit, true),
....
...
{ok, Tag, Pid} = tcloud_mq_amqp_func:tc_subdesc_queue(ReadChannel, Que, MFA),   %% subscribe the queue with process 2 start with MFA
%% and after this code, the process 1 do nothing but wait for call/cast   process 1 is a gen_server.
%% process 1 never do unbind/delete opertion to the queue or any other thing


the process 2 follow:
loop() ->     %% loop/0 is the F of MFA that start the process 2
receive
Msg ->
io:format("Msg:~p~n", [Msg]),
loop()
end

Regard
David


________________________________________
???: Alexandru Scvor?ov [scvalex at gmail.com] ?? Alexandru Scvor?ov [alexandru at rabbitmq.com]
????: 2012?2?10? 17:38
?: Liuzhuofu
Cc: rabbitmq-discuss at lists.rabbitmq.com
??: Re: [rabbitmq-discuss] Can't process_flag(trap_exit, true) in process

Hi David,

> I create a connection and channel in process 1, and subscribe a queue with process 2, which created by "spawn_link" in process 1, if I run "process_flag(trap_exit, true)" in process 1, the process 2 will receive a 'basic.cancel' message for the subscribe queue. If I don't run "process_flag(trap_exit, true)" in process 1, the process 2 will never receive that.

I don't follow. Are you saying that running "process_flag(trap_exit,
true)" in process 1, the queue will get deleted immediately (and hence
process 2 will receive a basic.cancel)?

Could you post your code please?

Cheers,
Alex

On Fri, Feb 10, 2012 at 08:22:10AM +0000, Liuzhuofu wrote:
> Hi all:
> I found a strange thing:
> I create a connection and channel in process 1, and subscribe a queue with process 2, which created by "spawn_link" in process 1, if I run "process_flag(trap_exit, true)" in process 1, the process 2 will receive a 'basic.cancel' message for the subscribe queue. If I don't run "process_flag(trap_exit, true)" in process 1, the process 2 will never receive that.
> Why ?
>
> Regards,
> David

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120210/3e76fa01/attachment.htm>

From emile at rabbitmq.com  Fri Feb 10 10:04:06 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 10 Feb 2012 10:04:06 +0000
Subject: [rabbitmq-discuss] HA Documentation Error?
In-Reply-To: <1328830347.88766.YahooMailNeo@web44913.mail.sp1.yahoo.com>
References: <1328830347.88766.YahooMailNeo@web44913.mail.sp1.yahoo.com>
Message-ID: <4F34EB96.6090203@rabbitmq.com>

Hi Uday,

On 09/02/12 23:32, Uday Subbarayan wrote:
> The first statement should be-
> All actions other than publishes go only to the SLAVE, ... (instead of
> master)

No, the statement as it stands is correct. This thread has some more detail:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/017957.html

> Side Note: Pl correct the spelling for "Behavior" in the title.

Both are correct. The RabbitMQ team tend towards British spelling.



-Emile

From emile at rabbitmq.com  Fri Feb 10 10:11:17 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 10 Feb 2012 10:11:17 +0000
Subject: [rabbitmq-discuss] Max Consumers?
In-Reply-To: <1328828106.72534.YahooMailNeo@web44909.mail.sp1.yahoo.com>
References: <1328738739.42356.YahooMailNeo@web44904.mail.sp1.yahoo.com>
	<4F33BB5C.4030209@rabbitmq.com>
	<1328828106.72534.YahooMailNeo@web44909.mail.sp1.yahoo.com>
Message-ID: <4F34ED45.4070105@rabbitmq.com>

Hi Uday,

On 09/02/12 22:55, Uday Subbarayan wrote:
> Thanks Emile.
> "If you have fewer queues than CPU cores then this might be a bottleneck."
> 
> I thought this should be other way around- if we have fewer CPU cores
> than queues, then it might be a bottleneck. Am I correct?

You might have a bottleneck with a small number of queues in either
case, but if you have a small number of queues in the presence of idle
CPU cores then you have an avoidable bottleneck. Using more queues in
that case will improve throughput.


-Emile


From emile at rabbitmq.com  Fri Feb 10 10:24:43 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 10 Feb 2012 10:24:43 +0000
Subject: [rabbitmq-discuss] .NET client Heartbeat setting
In-Reply-To: <4f313c82.5309e00a.17d7.6fe0@mx.google.com>
References: <4f313c82.5309e00a.17d7.6fe0@mx.google.com>
Message-ID: <4F34F06B.5040708@rabbitmq.com>

Hi Simone,

On 07/02/12 15:00, simone.busoli wrote:
> That's what I was trying to say, the hearbeat setting is not picked up
> when passed on the querystring as "?heartbeat=" if you pass the entire
> Uri to the uri property, it is not parsed by the client library.

What I meant was, is you expectation of URI parsing options beyond those
described in the spec (http://www.rabbitmq.com/uri-spec.html) based on
documentation? If so then that documentation needs to be corrected.

Only the RabbitMQ Erlang client offers this ability. As your original
email points out, the correct way to set heartbeats on other clients is
via the connection factory. I will file a bug to improve the consistency
of our clients in this regard.


-Emile

From simone.busoli at gmail.com  Fri Feb 10 10:27:25 2012
From: simone.busoli at gmail.com (simone.busoli)
Date: Fri, 10 Feb 2012 02:27:25 -0800 (PST)
Subject: [rabbitmq-discuss] .NET client Heartbeat setting
In-Reply-To: <4F34F06B.5040708@rabbitmq.com>
Message-ID: <4f34f10d.45c3e00a.482c.4501@mx.google.com>


	Hi Emile, yes, I would have expected the client to parse it, although now I see what you mean, the heartbeat setting is not in the spec and that&#39;s probably the reason why it&#39;s not implemented in the client. It would be nice to have it nonetheless.

	Simone

-----Original Message-----



			Re: [rabbitmq-discuss] .NET client Heartbeat setting
From: Emile Joubert &lt;emile at rabbitmq.com&gt;
		To: &quot;simone.busoli&quot; &lt;simone.busoli at gmail.com&gt;
		Cc: rabbitmq-discuss at lists.rabbitmq.com

		Friday, February 10, 2012 at 10:24AM



			Hi Simone,

			On 07/02/12 15:00, simone.busoli wrote:
			&gt; That&#39;s what I was trying to say, the hearbeat setting is not picked up
			&gt; when passed on the querystring as &quot;?heartbeat=&quot; if you pass the entire
			&gt; Uri to the uri property, it is not parsed by the client library.

			What I meant was, is you expectation of URI parsing options beyond those
			described in the spec (http://www.rabbitmq.com/uri-spec.html) based on
			documentation? If so then that documentation needs to be corrected.

			Only the RabbitMQ Erlang client offers this ability. As your original
			email points out, the correct way to set heartbeats on other clients is
			via the connection factory. I will file a bug to improve the consistency
			of our clients in this regard.


			-Emile


		&nbsp;


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120210/f669c2da/attachment.htm>

From alexandru at rabbitmq.com  Fri Feb 10 10:36:47 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 10 Feb 2012 10:36:47 +0000
Subject: [rabbitmq-discuss]
 =?utf-8?b?562U5aSNOiAgIENhbid0IHByb2Nlc3NfZmxh?=
 =?utf-8?q?g=28trap=5Fexit=2C_true=29_in_process?=
In-Reply-To: <D027DE656EBD4F4C8EE57361B5EF438E39916453@szxeml524-mbs.china.huawei.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E399163FB@szxeml524-mbs.china.huawei.com>
	<20120210093804.GA3845@southbank.Home>
	<D027DE656EBD4F4C8EE57361B5EF438E39916453@szxeml524-mbs.china.huawei.com>
Message-ID: <20120210103647.GC3845@southbank.Home>

Hi David,

> the process 1 follow:
...
> the process 2 follow:
...

Ok.  That code looks fine.  So, when you run that, process 2 receives a
basic.cancel?  And if you remove the process_flag(...) in process 1, it
doesn't?  That sounds very strange and shouldn't happen.

When you say "receives a basic.cancel", do you mean that process 2 exits
with an non-normal message?  Could you post the exact message if so?

Is there anything like an error in the RabbitMQ or SASL logs?

Also, what version of the server and client are you using?

Cheers,
Alex


On Fri, Feb 10, 2012 at 09:59:23AM +0000, Liuzhuofu wrote:
> Hi Alex:
> 
> the process 1 follow:
> process_flag(trap_exit, true),
> ....
> ...
> {ok, Tag, Pid} = tcloud_mq_amqp_func:tc_subdesc_queue(ReadChannel, Que, MFA),   %% subscribe the queue with process 2 start with MFA
> %% and after this code, the process 1 do nothing but wait for call/cast   process 1 is a gen_server.
> %% process 1 never do unbind/delete opertion to the queue or any other thing
> 
> 
> the process 2 follow:
> loop() ->     %% loop/0 is the F of MFA that start the process 2
> receive
> Msg ->
> io:format("Msg:~p~n", [Msg]),
> loop()
> end
> 
> Regard
> David
> 
> 
> ________________________________________
> ???: Alexandru Scvor?ov [scvalex at gmail.com] ?? Alexandru Scvor?ov [alexandru at rabbitmq.com]
> ????: 2012?2?10? 17:38
> ?: Liuzhuofu
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> ??: Re: [rabbitmq-discuss] Can't process_flag(trap_exit, true) in process
> 
> Hi David,
> 
> > I create a connection and channel in process 1, and subscribe a queue with process 2, which created by "spawn_link" in process 1, if I run "process_flag(trap_exit, true)" in process 1, the process 2 will receive a 'basic.cancel' message for the subscribe queue. If I don't run "process_flag(trap_exit, true)" in process 1, the process 2 will never receive that.
> 
> I don't follow. Are you saying that running "process_flag(trap_exit,
> true)" in process 1, the queue will get deleted immediately (and hence
> process 2 will receive a basic.cancel)?
> 
> Could you post your code please?
> 
> Cheers,
> Alex
> 
> On Fri, Feb 10, 2012 at 08:22:10AM +0000, Liuzhuofu wrote:
> > Hi all:
> > I found a strange thing:
> > I create a connection and channel in process 1, and subscribe a queue with process 2, which created by "spawn_link" in process 1, if I run "process_flag(trap_exit, true)" in process 1, the process 2 will receive a 'basic.cancel' message for the subscribe queue. If I don't run "process_flag(trap_exit, true)" in process 1, the process 2 will never receive that.
> > Why ?
> >
> > Regards,
> > David
> 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

From shammi at arosys.com  Fri Feb 10 10:45:39 2012
From: shammi at arosys.com (cheepu)
Date: Fri, 10 Feb 2012 02:45:39 -0800 (PST)
Subject: [rabbitmq-discuss] Problem in installing in bebian
In-Reply-To: <20120210094313.GB3845@southbank.Home>
References: <33298595.post@talk.nabble.com>
	<20120210094313.GB3845@southbank.Home>
Message-ID: <33299402.post@talk.nabble.com>


Thanks for the reply.
Before the installation of rabbitmq i need to install erl, how can i install
this.
Even the installation steps for rabbitmq produces error that rabbitmq-server
depends on erlang-nox 
please guide me to install erl in the debian.

Thanks



Alexandru Scvor?ov wrote:
> 
> Hi,
> 
> The website describes the steps to install RabbitMQ on Debian:
>   http://www.rabbitmq.com/install-debian.html
> 
> Basically, you have to add this line to /etc/apt/sources.list
>   deb http://www.rabbitmq.com/debian/ testing main
> 
> And then run:
>   sudo apt-get update
>   sudo apt-get install rabbitmq-server
> 
> That will install the latest RabbitMQ server and take care of
> dependencies.
> 
> Is there a reason why you don't use the package manager?
> 
> Cheers,
> Alex
> 
> On Thu, Feb 09, 2012 at 11:43:43PM -0800, cheepu wrote:
>> 
>> Hi
>> I downloaded the rabbitmq-server-generic-unix-2.7.1.tar and extracted it
>> in
>> the /usr/local/rabbitmq directory. When I started the server
>> bin/rabbitmq-server Its not started with given error erl not found.
>>              Now to install Erlang, I have downloaded otp_src_R15B.tar.gz
>> I run the following command to extracted  it  using command
>> tar zxf otp_src_R15B.tar.gz
>> in the directory /usr/local/erlang directory
>> then ./configure
>> and after that make command
>> but make command is not working because it is not able to find the
>> otp_deb.mk file and it doesnot exists in the specified directory.
>> What else i can use to install the erl in debian.
>> 
>> Thanks
>> -- 
>> View this message in context:
>> http://old.nabble.com/Problem-in-installing-in-bebian-tp33298595p33298595.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Problem-in-installing-in-bebian-tp33298595p33299402.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Fri Feb 10 10:48:52 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 10 Feb 2012 10:48:52 +0000
Subject: [rabbitmq-discuss] Problem in installing in bebian
In-Reply-To: <33299402.post@talk.nabble.com>
References: <33298595.post@talk.nabble.com>	<20120210094313.GB3845@southbank.Home>
	<33299402.post@talk.nabble.com>
Message-ID: <4F34F614.9000408@rabbitmq.com>

Are you perhaps trying to install the RabbitMQ deb with dpkg? That won't 
automatically resolve dependencies, so you can either "sudo apt-get 
install erlang-nox" or use apt for the whole thing as described by 
Alexandru below.

But Erlang is in Debian, it's a completely normal install.

Cheers, Simon

On 10/02/12 10:45, cheepu wrote:
>
> Thanks for the reply.
> Before the installation of rabbitmq i need to install erl, how can i install
> this.
> Even the installation steps for rabbitmq produces error that rabbitmq-server
> depends on erlang-nox
> please guide me to install erl in the debian.
>
> Thanks
>
>
>
> Alexandru Scvor?ov wrote:
>>
>> Hi,
>>
>> The website describes the steps to install RabbitMQ on Debian:
>>    http://www.rabbitmq.com/install-debian.html
>>
>> Basically, you have to add this line to /etc/apt/sources.list
>>    deb http://www.rabbitmq.com/debian/ testing main
>>
>> And then run:
>>    sudo apt-get update
>>    sudo apt-get install rabbitmq-server
>>
>> That will install the latest RabbitMQ server and take care of
>> dependencies.
>>
>> Is there a reason why you don't use the package manager?
>>
>> Cheers,
>> Alex
>>
>> On Thu, Feb 09, 2012 at 11:43:43PM -0800, cheepu wrote:
>>>
>>> Hi
>>> I downloaded the rabbitmq-server-generic-unix-2.7.1.tar and extracted it
>>> in
>>> the /usr/local/rabbitmq directory. When I started the server
>>> bin/rabbitmq-server Its not started with given error erl not found.
>>>               Now to install Erlang, I have downloaded otp_src_R15B.tar.gz
>>> I run the following command to extracted  it  using command
>>> tar zxf otp_src_R15B.tar.gz
>>> in the directory /usr/local/erlang directory
>>> then ./configure
>>> and after that make command
>>> but make command is not working because it is not able to find the
>>> otp_deb.mk file and it doesnot exists in the specified directory.
>>> What else i can use to install the erl in debian.
>>>
>>> Thanks
>>> --
>>> View this message in context:
>>> http://old.nabble.com/Problem-in-installing-in-bebian-tp33298595p33298595.html
>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Feb 10 10:53:21 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 10 Feb 2012 10:53:21 +0000
Subject: [rabbitmq-discuss] Installing rabbitmq server in silent mode
In-Reply-To: <1bd24ca4-1196-4f57-ac08-a2ec1957d682@q12g2000yqg.googlegroups.com>
References: <1bd24ca4-1196-4f57-ac08-a2ec1957d682@q12g2000yqg.googlegroups.com>
Message-ID: <4F34F721.2070601@rabbitmq.com>

On 09/02/12 18:52, Vic wrote:
> Hello,
> Is there a way to install rabbitmq-server-2.7.1.exe in silent mode?

It looks like there is. The RabbitMQ Windows installer is a standard 
NSIS installer and as such understands the "/S" flag (note that's case 
sensitive!)

C:\> rabbitmq-server-2.7.1.exe /S

I just tried this and it seems to work. But note that I built the 
installer and I didn't know about this feature until just now, so there 
are no guarantees...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Fri Feb 10 13:33:56 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 10 Feb 2012 13:33:56 +0000
Subject: [rabbitmq-discuss] High volume message consumption slows down
 consistently over time when using Pika and transactions
In-Reply-To: <CB519634.2B958%mpietrek@skytap.com>
References: <CB519634.2B958%mpietrek@skytap.com>
Message-ID: <4F351CC4.9080302@rabbitmq.com>


Hi Matt,

Thanks for reporting this. I've been able to reproduce the problem with
a non-mirrorred queue on a single node, using Pika. However I can't
reproduce the problem using the Java client, so this looks like a
possible resource leak in the Pika client. I'll report this to the Pika
maintainer.


-Emile


On 03/02/12 21:48, Matt Pietrek wrote:
> I'm writing some basic throughput tests to verify that RabbitMQ will
> scale to our needs in HA environments. In one scenario I'm finding that
> consuming messages as quickly as possible slows down consistently over time.
> 
> My environment:
> 
>   * Ubuntu 10.04 with RabbitMQ 2.71.
>   * Erlang R13B03
>   * Broker instances are all disk nodes on a dedicated VM running
>     nothing else.
>   * Queues are declared as durable and x-ha-policy:all
>   * Clients are written in Python using Pika 0.9.5.
>   * For this test a single broker is used, but I have the same effect
>     with mirrored queues.
> 
> The test code is extremely simple. It simply reads or writes messages
> (up to 100,000) as quickly as it can, and shows the throughput rate at
> 1000 message intervals.
> 
> I've noticed that when I use transactions with basic_ack, e.g.
> 
>         channel.tx_select()
>         channel.basic_ack(delivery_tag=tag)
>         channel.tx_commit()
> 
> that the rate I can consume messages drops steadily. Each time I restart
> my reading app with a full queue, I see a consistent slowdown in my rate
> as measured every 1000 messages:
> 
> (Rate for last 1000 messages | Average rate for all messages since app
> start)
> Read 597.502915814 messages/sec | Average: 597.502915814
> Read 431.665048642 messages/sec | Average: 501.222607245
> Read 447.932745586 messages/sec | Average: 482.104211325
> Read 377.776468153 messages/sec | Average: 450.969014032
> Read 394.784579872 messages/sec | Average: 438.488176956
> Read 346.943823897 messages/sec | Average: 420.01726691
> Read 301.813628274 messages/sec | Average: 397.762754973
> Read 313.625720320 messages/sec | Average: 384.856956366
> Read 266.972510375 messages/sec | Average: 366.858074188
> Read 254.247975169 messages/sec | Average: 351.298554027
> Read 251.812483302 messages/sec | Average: 339.118646053
> Read 246.701903922 messages/sec | Average: 328.85271509
> Read 222.953957109 messages/sec | Average: 317.260966009
> 
> If I simply remove the tx_select()/tx_commit, the rate stays reasonably
> stable:
> 
> (Rate for last 1000 messages | Average rate for all messages since app start
> Read 1228.77445722 messages/sec | Average: 1343.23656881
> Read 1063.88750879 messages/sec | Average: 1235.13209738
> Read 1368.73427666 messages/sec | Average: 1266.02631056
> Read 1423.23835115 messages/sec | Average: 1294.62742565
> Read 1438.56741702 messages/sec | Average: 1316.58317701
> Read 1393.69714404 messages/sec | Average: 1327.07283563
> Read 991.831277598 messages/sec | Average: 1273.27648897
> Read 1097.96119586 messages/sec | Average: 1251.08044697
> Read 1174.27676294 messages/sec | Average: 1242.95091463
> Read 1307.42368241 messages/sec | Average: 1248.54813715
> Read 1491.50216641 messages/sec | Average: 1265.7295908
> 
> One thing I have noticed is that in my client app machine, the CPU
> percentage generally climbs over time, with the occasional brief drop
> back to a prior %. This might point to a Pika issue in the transaction
> related code, but it's not obvious to me from inspection of the code if so.
> 
> Here's the relevant snippets of my code:
> 
> def do_read(clientlib):
>     for i in range(100000):
>         _, ack_info = clientlib.read_message(QUEUENAME)
>         if ack_info == None:
>             print "No messages to read - Exiting"
>             return
>         clientlib.acknowledge_message(ack_info)
> 
> 
> class Clientlib
>     def connect(self, hostname, use_transactions):
>         self.connection =
> pika.BlockingConnection(pika.ConnectionParameters(host=hostname, port=5672))
>         self.channel = self.connection.channel()
>         self.use_transactions = use_transactions
> 
>     def read_message(self, queue_name):
>         method_frame, _, body = self.channel.basic_get(queue=queue_name)
>         return body, (self.channel, method_frame.delivery_tag)
> 
>     def acknowledge_message(self, acknowledge_info):
>         channel = acknowledge_info[0]
>         tag = acknowledge_info[1]
> 
>         if self.use_transactions:
>             channel.tx_select()
> 
>         channel.basic_ack(delivery_tag=tag)
> 
>         if self.use_transactions:
>             channel.tx_commit()

From emile at rabbitmq.com  Fri Feb 10 14:33:45 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 10 Feb 2012 14:33:45 +0000
Subject: [rabbitmq-discuss] Mnesia connection error in a clustered node
 on a multi NIC PC
In-Reply-To: <139a51c7-a8c3-4d47-b0d4-ea5f5b2a67bb@t15g2000yqi.googlegroups.com>
References: <139a51c7-a8c3-4d47-b0d4-ea5f5b2a67bb@t15g2000yqi.googlegroups.com>
Message-ID: <4F352AC9.6060605@rabbitmq.com>

Hi,

On 07/02/12 15:02, davidib wrote:
> Mnesia('rabbit at LAKE-HP165'): ** ERROR ** Mnesia on 'rabbit at LAKE-HP165'
> could not connect to node(s) ['rabbit at LAKE-DS140']

In the other message thread with a similar subject ("rabbitmqctl -n
..... status fails one way but not the other") you expressed your
intention to set up firewalls correctly to allow clustering. When you do
that can you confirm that this problem is also solved? It seems likely
that they both share the same root cause.



-Emile

From davidib2001 at yahoo.com  Fri Feb 10 14:54:59 2012
From: davidib2001 at yahoo.com (davidib)
Date: Fri, 10 Feb 2012 06:54:59 -0800 (PST)
Subject: [rabbitmq-discuss] Mnesia connection error in a clustered node
	on a multi NIC PC
In-Reply-To: <4F352AC9.6060605@rabbitmq.com>
References: <139a51c7-a8c3-4d47-b0d4-ea5f5b2a67bb@t15g2000yqi.googlegroups.com>
	<4F352AC9.6060605@rabbitmq.com>
Message-ID: <285921a9-ccb5-46d2-ba43-93621a59138a@h3g2000yqe.googlegroups.com>

Hi Emile,

Yes, I'll let you know if tweaking the firewall works okay.

1.) I'm a bit concerned regarding the solution, again I can't find any
documenation regarding port 1052.  I very very much appreciate your
help, a bit concerned regarding the amount of time it's taking to
'research/discover' the nuances/gotchas.  I realize that this comes
with the territory, however we do have a project that has has to be
completed by Aug 2012 that is currently based on RabbitMQ.  My
allocated time to get RabbitMQ up and running in a reasonably robust
way is 4-6 weeks.  As a rabbitmq newbie, do you think this timeframe
is doable?

2.)Just to make sure, regarding the firewall issue, all the hosts I
plan to run rabbitmq on are all on the same physical switch, all share
the same 10.8.xxx subnet, etc.  The firewall (windows firewall) is up
as a matter of standard configuration/practice.  I don't know anyone
who isn't running a firewall on a production server.  If clustering
really doesn't work well over the firewall, doesn't that imply it's
usage is limited to a very tiny population of production
infrastructures?

3.)I'm following up on using a shovel approach vs a cluster, so
possibly the cluster issues I've been having are moot for me.  But in
the spirit of community I'll followup with your request and let you
know.

Again Emile I really appreciate your help/feedback.  Thanks again

David





On Feb 10, 8:33?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> On 07/02/12 15:02, davidib wrote:
>
> > Mnesia('rabbit at LAKE-HP165'): ** ERROR ** Mnesia on 'rabbit at LAKE-HP165'
> > could not connect to node(s) ['rabbit at LAKE-DS140']
>
> In the other message thread with a similar subject ("rabbitmqctl -n
> ..... status fails one way but not the other") you expressed your
> intention to set up firewalls correctly to allow clustering. When you do
> that can you confirm that this problem is also solved? It seems likely
> that they both share the same root cause.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Fri Feb 10 15:28:00 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 10 Feb 2012 15:28:00 +0000
Subject: [rabbitmq-discuss] Mnesia connection error in a clustered node
 on a multi NIC PC
In-Reply-To: <285921a9-ccb5-46d2-ba43-93621a59138a@h3g2000yqe.googlegroups.com>
References: <139a51c7-a8c3-4d47-b0d4-ea5f5b2a67bb@t15g2000yqi.googlegroups.com>
	<4F352AC9.6060605@rabbitmq.com>
	<285921a9-ccb5-46d2-ba43-93621a59138a@h3g2000yqe.googlegroups.com>
Message-ID: <4F353780.90107@rabbitmq.com>


Hi David,

On 10/02/12 14:54, davidib wrote:
> 1.) I'm a bit concerned regarding the solution, again I can't find any
> documenation regarding port 1052.  I very very much appreciate your

You won't find any documentation on that port number, because it was
randomly assigned when your Erlang VM started up. If you reboot then it
will change. At the time when this diagnostic information was produced
the value was correct:

Error: unable to connect to node 'rabbit at LAKE-DS140': nodedown
diagnostics:
- nodes and their ports on LAKE-DS140: [{rabbit,1052}]

You can find the current set of ports by running "epmd -names". You will
find epmd in the erts/bin folder of your Erlang installation.

> allocated time to get RabbitMQ up and running in a reasonably robust
> way is 4-6 weeks.  As a rabbitmq newbie, do you think this timeframe
> is doable?

Our aim is that you should have a single-node broker running in a few
minutes after downloading. It should not be a complicated affair to set
up. Clustering takes a bit more time to set up, so you should allow for
that. I'm in no position to validate estimates though! Please let us
have your suggestions for improvements to RabbitMQ that will help you
reach your goal.

> who isn't running a firewall on a production server.  If clustering
> really doesn't work well over the firewall, doesn't that imply it's
> usage is limited to a very tiny population of production
> infrastructures?

Clustering works fine through a firewall, provided that the instructions
here are followed:
http://www.rabbitmq.com/clustering.html#firewall
If you have followed these instructions and run into difficulties then
please let us know.


-Emile

From davidib2001 at yahoo.com  Fri Feb 10 15:43:08 2012
From: davidib2001 at yahoo.com (davidib)
Date: Fri, 10 Feb 2012 07:43:08 -0800 (PST)
Subject: [rabbitmq-discuss] Mnesia connection error in a clustered node
	on a multi NIC PC
In-Reply-To: <4F353780.90107@rabbitmq.com>
References: <139a51c7-a8c3-4d47-b0d4-ea5f5b2a67bb@t15g2000yqi.googlegroups.com>
	<4F352AC9.6060605@rabbitmq.com>
	<285921a9-ccb5-46d2-ba43-93621a59138a@h3g2000yqe.googlegroups.com>
	<4F353780.90107@rabbitmq.com>
Message-ID: <5f8bed58-315f-440e-a6fa-85b31b8e203e@i18g2000yqf.googlegroups.com>

Hey Emile,

Now it makes ALOT more sense!  I thought I had taken care of this
issue via explicitly opening port 4369.  Didn't realize that the epmd
port was randomly assigned.  Looks like I can avoid the dynamic nature
of the port assignment by using the ERL_EPMD_PORT environment
variable!

Thanks again
David

On Feb 10, 9:28?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi David,
>
> On 10/02/12 14:54, davidib wrote:
>
> > 1.) I'm a bit concerned regarding the solution, again I can't find any
> > documenation regarding port 1052. ?I very very much appreciate your
>
> You won't find any documentation on that port number, because it was
> randomly assigned when your Erlang VM started up. If you reboot then it
> will change. At the time when this diagnostic information was produced
> the value was correct:
>
> Error: unable to connect to node 'rabbit at LAKE-DS140': nodedown
> diagnostics:
> - nodes and their ports on LAKE-DS140: [{rabbit,1052}]
>
> You can find the current set of ports by running "epmd -names". You will
> find epmd in the erts/bin folder of your Erlang installation.
>
> > allocated time to get RabbitMQ up and running in a reasonably robust
> > way is 4-6 weeks. ?As a rabbitmq newbie, do you think this timeframe
> > is doable?
>
> Our aim is that you should have a single-node broker running in a few
> minutes after downloading. It should not be a complicated affair to set
> up. Clustering takes a bit more time to set up, so you should allow for
> that. I'm in no position to validate estimates though! Please let us
> have your suggestions for improvements to RabbitMQ that will help you
> reach your goal.
>
> > who isn't running a firewall on a production server. ?If clustering
> > really doesn't work well over the firewall, doesn't that imply it's
> > usage is limited to a very tiny population of production
> > infrastructures?
>
> Clustering works fine through a firewall, provided that the instructions
> here are followed:http://www.rabbitmq.com/clustering.html#firewall
> If you have followed these instructions and run into difficulties then
> please let us know.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tonygarnockjones+rabbitmq at gmail.com  Fri Feb 10 15:56:33 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Fri, 10 Feb 2012 10:56:33 -0500
Subject: [rabbitmq-discuss] STOMP doesn't include the routing-key on MESSAGE
	frames
Message-ID: <CAM8fPiQe4nZGdwPvmYae=YtA6ruN96TedYNLOHpQBcxo9niQOg@mail.gmail.com>

Hi all,

Attempting to use the STOMP adapter the other day I discovered an
oversight in the new design: the AMQP routing key is no longer
propagated into outgoing MESSAGE frames. This stopped my application
from working.

Here's a patch (obviously crude, e.g. doesn't define a
?HEADER_ROUTING_KEY macro or anything) that causes the routing_key to
be sent along:

diff -r 3be0091c6401 src/rabbit_stomp_util.erl
--- a/src/rabbit_stomp_util.erl Wed Feb 08 15:53:59 2012 +0000
+++ b/src/rabbit_stomp_util.erl Fri Feb 10 10:53:21 2012 -0500
@@ -78,9 +78,11 @@

 message_headers(Destination, SessionId,
                 #'basic.deliver'{consumer_tag = ConsumerTag,
-                                 delivery_tag = DeliveryTag},
+                                 delivery_tag = DeliveryTag,
+                                 routing_key = RoutingKey},
                 Props = #'P_basic'{headers       = Headers}) ->
     Basic = [{?HEADER_DESTINATION, Destination},
+             {"amqp-routing-key", binary_to_list(RoutingKey)},
              {?HEADER_MESSAGE_ID,
               create_message_id(ConsumerTag, SessionId, DeliveryTag)}],


I'd be very happy to see this included into the master branch of the
STOMP adapter.

Regards,
  Tony
--
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/

From emile at rabbitmq.com  Fri Feb 10 15:57:41 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 10 Feb 2012 15:57:41 +0000
Subject: [rabbitmq-discuss] Mnesia connection error in a clustered node
 on a multi NIC PC
In-Reply-To: <5f8bed58-315f-440e-a6fa-85b31b8e203e@i18g2000yqf.googlegroups.com>
References: <139a51c7-a8c3-4d47-b0d4-ea5f5b2a67bb@t15g2000yqi.googlegroups.com>
	<4F352AC9.6060605@rabbitmq.com>
	<285921a9-ccb5-46d2-ba43-93621a59138a@h3g2000yqe.googlegroups.com>
	<4F353780.90107@rabbitmq.com>
	<5f8bed58-315f-440e-a6fa-85b31b8e203e@i18g2000yqf.googlegroups.com>
Message-ID: <4F353E75.9010700@rabbitmq.com>

Hi,

On 10/02/12 15:43, davidib wrote:
> Now it makes ALOT more sense!  I thought I had taken care of this
> issue via explicitly opening port 4369.  Didn't realize that the epmd
> port was randomly assigned.  Looks like I can avoid the dynamic nature
> of the port assignment by using the ERL_EPMD_PORT environment
> variable!

That's not the problem. You need to allow connections to the port mapper
daemon as well as to the Erlang nodes. The former is fixed (defaults to
4369) but can be changed via ERL_EPMD_PORT. The latter is random and can
be controlled via the inet_dist_listen_min and inet_dist_listen_max
Erlang parameters.


-Emile

From davidib2001 at yahoo.com  Fri Feb 10 16:05:55 2012
From: davidib2001 at yahoo.com (davidib)
Date: Fri, 10 Feb 2012 08:05:55 -0800 (PST)
Subject: [rabbitmq-discuss] Mnesia connection error in a clustered node
	on a multi NIC PC
In-Reply-To: <4F353E75.9010700@rabbitmq.com>
References: <139a51c7-a8c3-4d47-b0d4-ea5f5b2a67bb@t15g2000yqi.googlegroups.com>
	<4F352AC9.6060605@rabbitmq.com>
	<285921a9-ccb5-46d2-ba43-93621a59138a@h3g2000yqe.googlegroups.com>
	<4F353780.90107@rabbitmq.com>
	<5f8bed58-315f-440e-a6fa-85b31b8e203e@i18g2000yqf.googlegroups.com>
	<4F353E75.9010700@rabbitmq.com>
Message-ID: <24c252c1-6e53-4c57-9bf2-74949c82e788@p12g2000yqe.googlegroups.com>

Hi Emile,

ok, got it!  It's starting to come together... it's starting to make
alot of sense...

Thanks again
David

On Feb 10, 9:57?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> On 10/02/12 15:43, davidib wrote:
>
> > Now it makes ALOT more sense! ?I thought I had taken care of this
> > issue via explicitly opening port 4369. ?Didn't realize that the epmd
> > port was randomly assigned. ?Looks like I can avoid the dynamic nature
> > of the port assignment by using the ERL_EPMD_PORT environment
> > variable!
>
> That's not the problem. You need to allow connections to the port mapper
> daemon as well as to the Erlang nodes. The former is fixed (defaults to
> 4369) but can be changed via ERL_EPMD_PORT. The latter is random and can
> be controlled via the inet_dist_listen_min and inet_dist_listen_max
> Erlang parameters.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From majek04 at gmail.com  Fri Feb 10 16:10:38 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 10 Feb 2012 16:10:38 +0000
Subject: [rabbitmq-discuss] RabbitMQ shovel adding random underscore '_'
 characters in message payload
In-Reply-To: <4F31A71C.1090300@omc-international.com.au>
References: <4F309F0E.7030208@omc-international.com.au>
	<4F31452F.6090105@rabbitmq.com>
	<4F31A71C.1090300@omc-international.com.au>
Message-ID: <CABzX+qwBjib62S8hZorK=gdyQ_V1OEKeWuK_wkdJ-ho=k8apdQ@mail.gmail.com>

On Tue, Feb 7, 2012 at 22:35, Mihir Mone
<mihirm at omc-international.com.au> wrote:
> No this problem does not occur if the message is small. The payload is
> basically database table rows that are being synched between two sites. When
> the number of rows per payload is under 10 this error does not occur. But
> once it starts getting past 15 or so I am seeing this error. The
> configuration 1 which has this error is configured for 500 rows, which
> configuration 2 is configured for 3000 rows. And configuration 2 works fine
> !!
>
> Yes the error is present even when you receive a message through
> "rabbitmqadmin get" command.
>
> Yes, I have confirmed that the original message sent to the broker at the
> remote end is OK. If you see the screenshots I have sent in the original
> email, one of them is named remote-site and the other is named local-site.
> They are nothing but dumps taken from the rabbitmq_management web UI.

Hi,

It is quite unlikely that this kind of bug is within RabbitMQ broker.
It's much more probable a fault within your app or a client library.

If you think this is a problem on RabbitMQ side, please prepare
a (hopefully simplistic) test that reproduces the issue.

Only then we would be able to run the test on our machines
and confirm the problem.

Cheers,
  Marek

From Massimo.Paladin at cern.ch  Fri Feb 10 19:06:20 2012
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Fri, 10 Feb 2012 20:06:20 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin and ability to read
 configuration files
In-Reply-To: <4F33DFC9.60903@rabbitmq.com>
References: <CAMOXM2-yT_ZSX4_FkJpnh=GFX4_QT8pLKt+j8pnnZF6QHp1BmA@mail.gmail.com>
	<4F33DFC9.60903@rabbitmq.com>
Message-ID: <CAMOXM28oeg5E=7x1+dLrPdkt_r21_G1j=Nh8hX+X8i5yq60ZJA@mail.gmail.com>

Thanks, first two points should be done.

Now it tries to read from ~/.rabbitmqadmin.conf if node is specified and
the config file is not passed.

I am going to look at bash completion soon.

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Thu, Feb 9, 2012 at 4:01 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 06/02/12 17:09, Massimo Paladin wrote:
>
>> it would be nice to see it in the next release.
>>
>
> OK, in that case you're lucky enough to get some code review notes :-)
>
> * Defaults seem to be broken if the configuration file is not used
>
> * It would probably make sense to look for the config file in a standard
> location if "-c" is not specified, e.g. ~/.rabbitmqadmin.conf
>
> * For extra credit: make the bash completion script complete "-N" from the
> config file...
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120210/146f320c/attachment.htm>

From uday.subbarayan at yahoo.com  Fri Feb 10 19:50:10 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Fri, 10 Feb 2012 11:50:10 -0800 (PST)
Subject: [rabbitmq-discuss] HA Documentation Error?
In-Reply-To: <4F34EB96.6090203@rabbitmq.com>
References: <1328830347.88766.YahooMailNeo@web44913.mail.sp1.yahoo.com>
	<4F34EB96.6090203@rabbitmq.com>
Message-ID: <1328903410.78762.YahooMailNeo@web44915.mail.sp1.yahoo.com>

Hi Emile,
? ? ?I read all the documentation + mailing list and can understand from past experience that HA in MQ is not a simple task. Here is my understanding to setup HA in Rabbit MQ and pl correct me if i am wrong

Step -0: Setup 2 nodes.

Node -1 : Master
Node -2: Slave

Step -1: Configure Mirrored Queues

Step-2: Publish Message to Master
"This is why publishes *also* go via GM - the master?pushes each publish onto GM and the slaves received that and use it to?derive the correct order" -?Matthew Sackman@ Rabbit MQ

Step -3:Let?Guaranteed Multicast(GM) to replicate messages to slaves

Step-4: Consume messages from slaves

Note: There is a risk in the above strategy if the master node goes down. If you want to avoid, then publish to all slaves? Here on wards, i am not clear. I also read about putting HA Proxy in front of the Rabbit MQ cluster and don't know whether it can lead to better or worse in this complex mix :-)

It looks to me that my steps can get basic level of HA in Rabbit MQ! Pl correct if i am wrong.

Best,
-Uday.


________________________________
 From: Emile Joubert <emile at rabbitmq.com>
To: Uday Subbarayan <uday.subbarayan at yahoo.com> 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Friday, February 10, 2012 2:04 AM
Subject: Re: [rabbitmq-discuss] HA Documentation Error?
 
Hi Uday,

On 09/02/12 23:32, Uday Subbarayan wrote:
> The first statement should be-
> All actions other than publishes go only to the SLAVE, ... (instead of
> master)

No, the statement as it stands is correct. This thread has some more detail:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/017957.html

> Side Note: Pl correct the spelling for "Behavior" in the title.

Both are correct. The RabbitMQ team tend towards British spelling.



-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120210/2dd09fbb/attachment.htm>

From visionofarun at gmail.com  Fri Feb 10 19:00:31 2012
From: visionofarun at gmail.com (Arun Chandrasekaran)
Date: Fri, 10 Feb 2012 11:00:31 -0800 (PST)
Subject: [rabbitmq-discuss] Multithreading and rabbitmq-c
Message-ID: <22742700.314.1328900431948.JavaMail.geo-discussion-forums@pbcsx4>

Hi all,

With rabbitmq-c, it is possible to bind on different channels from 
different threads?

Basically, I'm not sharing any of these between the threads: 
amqp_connection_state_t, socket, channel.

Here is the "examples/amqp_consumer.c" sample code modified for 2 threads: 
http://codepad.org/zPa91lbr. I have also attached the code for your 
reference.

I get this error from the second thread : 

"Declaring queue: server connection error 504, message: CHANNEL_ERROR - 
expected 'channel.open'"

The README clearly states that it is valid to have different connections, 
sockets and channels per thread (last section): 
http://hg.rabbitmq.com/rabbitmq-c/file/fb6fca832fd2/README

Can someone give me an insight into where I am going wrong or if it is a 
limitation with rabbitmq-c?

Cheers,
Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120210/ba8a09b8/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqp_consumer.c
Type: text/x-csrc
Size: 5880 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120210/ba8a09b8/attachment.c>

From alan.antonuk at gmail.com  Fri Feb 10 20:58:30 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 10 Feb 2012 15:58:30 -0500
Subject: [rabbitmq-discuss] Multithreading and rabbitmq-c
In-Reply-To: <CAAt2poKcW=TyzcuFyoYfGYgBDC=ZpdqWhot=UsJGXkzuYjHLgg@mail.gmail.com>
References: <22742700.314.1328900431948.JavaMail.geo-discussion-forums@pbcsx4>
	<CAAt2poKcW=TyzcuFyoYfGYgBDC=ZpdqWhot=UsJGXkzuYjHLgg@mail.gmail.com>
Message-ID: <CAAt2po+MWN_1sEc71AQYqw+2x0yyxwrwihoC3vKESSFQtFat1w@mail.gmail.com>

Responses inlined below:

-Alan

On Fri, Feb 10, 2012 at 2:00 PM, Arun Chandrasekaran <visionofarun at gmail.com
> wrote:

> Hi all,
>
> With rabbitmq-c, it is possible to bind on different channels from
> different threads?
>
> Basically, I'm not sharing any of these between the threads:
> amqp_connection_state_t, socket, channel.
>

You have interpreted the documentation correctly:

amqp_connection_state_t, its socket, and all associated amqp_channel_t's
must not be shared between threads.  Its ok to have separate instances of
these objects used in different threads.


> Here is the "examples/amqp_consumer.c" sample code modified for 2 threads:
> http://codepad.org/zPa91lbr. I have also attached the code for your
> reference.
>
> I get this error from the second thread :
>
> "Declaring queue: server connection error 504, message: CHANNEL_ERROR -
> expected 'channel.open'"
>
Your problem is on line 156:
amqp_channel_open(conn, 1); /* opens channel 1 */

You then try to use channel stored in the variable chan on line 160:
... = amqp_queue_declare(conn, chan /* may not be channel 1 */ ...);

Try changing 156 to open channel stored in chan.

Also note that channels are on a per-connection basis, so it is ok to have
two different connections with the same channel identifiers.


> The README clearly states that it is valid to have different connections,
> sockets and channels per thread (last section):
> http://hg.rabbitmq.com/rabbitmq-c/file/fb6fca832fd2/README
>

Just an FYI: the canonical sources for the rabbitmq-c library have moved to
a new location:
https://github.com/alanxz/rabbitmq-c


>
> Can someone give me an insight into where I am going wrong or if it is a
> limitation with rabbitmq-c?
>
> Cheers,
> Arun
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120210/c6711c10/attachment.htm>

From pbell at syncsort.com  Fri Feb 10 23:36:47 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Fri, 10 Feb 2012 18:36:47 -0500
Subject: [rabbitmq-discuss] Naive Question
In-Reply-To: <199ce806-5a7d-406c-ab19-b0d2ce505dd7@strongmad.batnest.org>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40447B8C@MAILCCR.us.syncsort.com>
	<199ce806-5a7d-406c-ab19-b0d2ce505dd7@strongmad.batnest.org>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40447DD7@MAILCCR.us.syncsort.com>

All,

Hi again.

Only after trying to think through a real world scenario did I realize that my grasp of certain fundamental AMQP concepts is tenuous.

Specifically, given a producer and a consumer, is the normative behavior for only *one* of them to declare (create?) the queue over which they communicate? As I look over the examples that I've "written" ("copied" would be more accurate), I see my producer doing this:


RabbitAdmin admin = new RabbitAdmin(rabbitTemplate.getConnectionFactory());
Exchange ex = new FanoutExchange(routingKey, true, false);
admin.declareExchange(ex);
admin.declareQueue(new Queue(this.queueName));


And I see my consumer doing this:


ConsumerSimpleMessageListenerContainer container = new ConsumerSimpleMessageListenerContainer();
container.setConnectionFactory(connectionFactory());
container.setQueueNames(this.queueName);
container.setConcurrentConsumers(this.onOfConsumer);
container.setMessageListener(new MessageListenerAdapter(new ConsumerHandler(), new SimpleMessageConverter()));
container.startConsumers();


What would happen if each declared a queue of the same name and type - would that give rise to two distinct queues, leaving the producer and consumer unable to communicate?

If it's normative for only one party to create the queue and the other to bind to it, what will happen if, when I try to bind to the queue, it doesn't yet exist?

Here's what I am trying to get to (I assume it requires a topic exchange):

a. a queue that holds two different message types, call them "MGMT" and "HB."
b. a producer writes MGMT messages to this queue
c. something called a "monitor" writes HB messages to this queue
d. consumer reads HB messages from this queue
e. monitor reads MGMT messages from this queue

Schematically I think it looks like this:

Producer(MGMT) -> monitor
Monitor(HB)    -> consumer

How would I define these relationships via RabbitMQ? Who does what to whom?! I suspect it's simple, but after two solid weeks of 10 hour days, I am fried.

Thank you for your help.

-Paul

PS: What follows is not an attempt to curry favor - but this is a really fine list; folks are friendly, knowledgeable, and eager to help. I really appreciate it.





ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From jerryk at vmware.com  Sat Feb 11 01:15:50 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 10 Feb 2012 17:15:50 -0800 (PST)
Subject: [rabbitmq-discuss] Naive Question
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40447DD7@MAILCCR.us.syncsort.com>
Message-ID: <6e3318f9-cf2e-424d-a1bb-53239fd0da45@strongmad.batnest.org>

Hi, Paul:

Nope:  Redeclarations of a queue with the same name and properties, within a
vhost, are idempotent.  Redeclaring the thing before you start using it is
a fairly common idiom.  If the resource didn't exist, then it's created;
otherwise you've verified its existence.

Redeclaring a queue with a given name with different properties fails, so you
can't accidentally vandalize some existing piece of messaging fabric that
somebody else might be using.

On point b:  producers publish messages to *exchanges*, not to queues.
Which queues, if any, the messages end up in depends on how queues
are bound to the exchange in question, and the properties of the message.

With regard to your specific scenario with MGMT and HB messages, are you
sure you want them in the same queue?  It's not really possible in any
graceful way for a consumer to selectively read some but not other messages
from a queue unless one does something obnoxious like basic.get-ing and then
rejecting the messages you weren't interested in so that they're requeued.


From pbell at syncsort.com  Sat Feb 11 01:53:44 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Fri, 10 Feb 2012 20:53:44 -0500
Subject: [rabbitmq-discuss] Naive Question
In-Reply-To: <6e3318f9-cf2e-424d-a1bb-53239fd0da45@strongmad.batnest.org>
References: <6e3318f9-cf2e-424d-a1bb-53239fd0da45@strongmad.batnest.org>
Message-ID: <100E71DD-A40C-4477-8360-B378F32966C3@syncsort.com>

Hi Jerry,

Yeah, I think that makes sense.

Could your two queue be characterized like this:

1. Monitor creates the HB queue. With binding key "HB," consumer binds this queue to the exchange. Monitor writes to exchange with routing-key "HB."

2. Producer creates the MGMT queue. With binding key "MGMT," monitor binds this queue to exchange. Producer writes to exchange with routing-key "MGMT."

As always, thank you.

-Paul

On Feb 10, 2012, at 8:15 PM, "Jerry Kuch" <jerryk at vmware.com> wrote:

> Hi, Paul:
> 
> Nope:  Redeclarations of a queue with the same name and properties, within a
> vhost, are idempotent.  Redeclaring the thing before you start using it is
> a fairly common idiom.  If the resource didn't exist, then it's created;
> otherwise you've verified its existence.
> 
> Redeclaring a queue with a given name with different properties fails, so you
> can't accidentally vandalize some existing piece of messaging fabric that
> somebody else might be using.
> 
> On point b:  producers publish messages to *exchanges*, not to queues.
> Which queues, if any, the messages end up in depends on how queues
> are bound to the exchange in question, and the properties of the message.
> 
> With regard to your specific scenario with MGMT and HB messages, are you
> sure you want them in the same queue?  It's not really possible in any
> graceful way for a consumer to selectively read some but not other messages
> from a queue unless one does something obnoxious like basic.get-ing and then
> rejecting the messages you weren't interested in so that they're requeued.
> 
> From what I understand of the design you're sketching, you may want two
> queues, one from which the monitor reads MGMT messages and one from which 
> something else reads HB messages.  You could imagine binding both of those
> queues to a topic exchange and have your producer use routing keys to land
> your messages in the desired place.
> 
> Make sense?
> 
> Best regards,
> Jerry
> 
> ----- Original Message -----
> From: "Paul M. Bell" <pbell at syncsort.com>
> To: "RabbitMQ List" <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Friday, February 10, 2012 3:36:47 PM
> Subject: [rabbitmq-discuss] Naive Question
> 
> All,
> 
> Hi again.
> 
> Only after trying to think through a real world scenario did I realize that my grasp of certain fundamental AMQP concepts is tenuous.
> 
> Specifically, given a producer and a consumer, is the normative behavior for only *one* of them to declare (create?) the queue over which they communicate? As I look over the examples that I've "written" ("copied" would be more accurate), I see my producer doing this:
> 
> 
> RabbitAdmin admin = new RabbitAdmin(rabbitTemplate.getConnectionFactory());
> Exchange ex = new FanoutExchange(routingKey, true, false);
> admin.declareExchange(ex);
> admin.declareQueue(new Queue(this.queueName));
> 
> 
> And I see my consumer doing this:
> 
> 
> ConsumerSimpleMessageListenerContainer container = new ConsumerSimpleMessageListenerContainer();
> container.setConnectionFactory(connectionFactory());
> container.setQueueNames(this.queueName);
> container.setConcurrentConsumers(this.onOfConsumer);
> container.setMessageListener(new MessageListenerAdapter(new ConsumerHandler(), new SimpleMessageConverter()));
> container.startConsumers();
> 
> 
> What would happen if each declared a queue of the same name and type - would that give rise to two distinct queues, leaving the producer and consumer unable to communicate?
> 
> If it's normative for only one party to create the queue and the other to bind to it, what will happen if, when I try to bind to the queue, it doesn't yet exist?
> 
> Here's what I am trying to get to (I assume it requires a topic exchange):
> 
> a. a queue that holds two different message types, call them "MGMT" and "HB."
> b. a producer writes MGMT messages to this queue
> c. something called a "monitor" writes HB messages to this queue
> d. consumer reads HB messages from this queue
> e. monitor reads MGMT messages from this queue
> 
> Schematically I think it looks like this:
> 
> Producer(MGMT) -> monitor
> Monitor(HB)    -> consumer
> 
> How would I define these relationships via RabbitMQ? Who does what to whom?! I suspect it's simple, but after two solid weeks of 10 hour days, I am fried.
> 
> Thank you for your help.
> 
> -Paul
> 
> PS: What follows is not an attempt to curry favor - but this is a really fine list; folks are friendly, knowledgeable, and eager to help. I really appreciate it.
> 
> 
> 
> 
> 
> ATTENTION: -----
> 
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Sat Feb 11 02:28:02 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 10 Feb 2012 18:28:02 -0800 (PST)
Subject: [rabbitmq-discuss] Naive Question
In-Reply-To: <100E71DD-A40C-4477-8360-B378F32966C3@syncsort.com>
Message-ID: <8c8017ee-d886-424d-b5b8-19daff638284@strongmad.batnest.org>

Hi, Paul.


From pbell at syncsort.com  Sat Feb 11 02:48:35 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Fri, 10 Feb 2012 21:48:35 -0500
Subject: [rabbitmq-discuss] Naive Question
In-Reply-To: <8c8017ee-d886-424d-b5b8-19daff638284@strongmad.batnest.org>
References: <8c8017ee-d886-424d-b5b8-19daff638284@strongmad.batnest.org>
Message-ID: <EA40E90E-3FB2-4C28-B812-6BFEA3417550@syncsort.com>

Most kind of you, Jerry. I will check it out tomorrow on home desktop (writing now from phone).

Thanks.

-Paul

On Feb 10, 2012, at 9:28 PM, "Jerry Kuch" <jerryk at vmware.com> wrote:

> Hi, Paul.
> 
> From what I understand of your application this sounds like the right idea.
> Also, a shortcut that may be suitable for you, if you don't want fancy topic routing,
> might be to use the AMQP "default exchange" which will exist by default in any
> vhost.
> 
> The default exchange's name is just the empty string, "".  It's automatically
> bound to any queue you create, with a binding key equal to the name of the queue.
> 
> If you activate the rabbitmq visualiser plugin and browse around you can get a
> nice, interactive view of your queues and exchanges and the bindings between them.
> 
> On my own broker I just created queues called "HB" and "MGMT", and no exchanges, 
> and no bindings.  The attached screenshot shows those queues as the labeled
> rectangles, the bindings as the arrows (if you mouse over one, the routing 
> key will be displayed), and the default exchange as the unlabeled circle at
> the base of the binding arrows (recall it's name is ""; had it a non-empty name,
> you'd see that).
> 
> To publish to the queues I would just publish to an exchange called "", with 
> routing key set to either "MGMT" or "HB".
> 
> For a scenario like yours this might make a nice short cut.
> 
> Best regards,
> Jerry
> 
> ----- Original Message -----
> From: "Paul M. Bell" <pbell at syncsort.com>
> To: "Jerry Kuch" <jerryk at vmware.com>
> Cc: "RabbitMQ List" <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Friday, February 10, 2012 5:53:44 PM
> Subject: Re: [rabbitmq-discuss] Naive Question
> 
> Hi Jerry,
> 
> Yeah, I think that makes sense.
> 
> Could your two queue be characterized like this:
> 
> 1. Monitor creates the HB queue. With binding key "HB," consumer binds this queue to the exchange. Monitor writes to exchange with routing-key "HB."
> 
> 2. Producer creates the MGMT queue. With binding key "MGMT," monitor binds this queue to exchange. Producer writes to exchange with routing-key "MGMT."
> 
> As always, thank you.
> 
> -Paul
> 
> On Feb 10, 2012, at 8:15 PM, "Jerry Kuch" <jerryk at vmware.com> wrote:
> 
>> Hi, Paul:
>> 
>> Nope:  Redeclarations of a queue with the same name and properties, within a
>> vhost, are idempotent.  Redeclaring the thing before you start using it is
>> a fairly common idiom.  If the resource didn't exist, then it's created;
>> otherwise you've verified its existence.
>> 
>> Redeclaring a queue with a given name with different properties fails, so you
>> can't accidentally vandalize some existing piece of messaging fabric that
>> somebody else might be using.
>> 
>> On point b:  producers publish messages to *exchanges*, not to queues.
>> Which queues, if any, the messages end up in depends on how queues
>> are bound to the exchange in question, and the properties of the message.
>> 
>> With regard to your specific scenario with MGMT and HB messages, are you
>> sure you want them in the same queue?  It's not really possible in any
>> graceful way for a consumer to selectively read some but not other messages
>> from a queue unless one does something obnoxious like basic.get-ing and then
>> rejecting the messages you weren't interested in so that they're requeued.
>> 
>> From what I understand of the design you're sketching, you may want two
>> queues, one from which the monitor reads MGMT messages and one from which 
>> something else reads HB messages.  You could imagine binding both of those
>> queues to a topic exchange and have your producer use routing keys to land
>> your messages in the desired place.
>> 
>> Make sense?
>> 
>> Best regards,
>> Jerry
>> 
>> ----- Original Message -----
>> From: "Paul M. Bell" <pbell at syncsort.com>
>> To: "RabbitMQ List" <rabbitmq-discuss at lists.rabbitmq.com>
>> Sent: Friday, February 10, 2012 3:36:47 PM
>> Subject: [rabbitmq-discuss] Naive Question
>> 
>> All,
>> 
>> Hi again.
>> 
>> Only after trying to think through a real world scenario did I realize that my grasp of certain fundamental AMQP concepts is tenuous.
>> 
>> Specifically, given a producer and a consumer, is the normative behavior for only *one* of them to declare (create?) the queue over which they communicate? As I look over the examples that I've "written" ("copied" would be more accurate), I see my producer doing this:
>> 
>> 
>> RabbitAdmin admin = new RabbitAdmin(rabbitTemplate.getConnectionFactory());
>> Exchange ex = new FanoutExchange(routingKey, true, false);
>> admin.declareExchange(ex);
>> admin.declareQueue(new Queue(this.queueName));
>> 
>> 
>> And I see my consumer doing this:
>> 
>> 
>> ConsumerSimpleMessageListenerContainer container = new ConsumerSimpleMessageListenerContainer();
>> container.setConnectionFactory(connectionFactory());
>> container.setQueueNames(this.queueName);
>> container.setConcurrentConsumers(this.onOfConsumer);
>> container.setMessageListener(new MessageListenerAdapter(new ConsumerHandler(), new SimpleMessageConverter()));
>> container.startConsumers();
>> 
>> 
>> What would happen if each declared a queue of the same name and type - would that give rise to two distinct queues, leaving the producer and consumer unable to communicate?
>> 
>> If it's normative for only one party to create the queue and the other to bind to it, what will happen if, when I try to bind to the queue, it doesn't yet exist?
>> 
>> Here's what I am trying to get to (I assume it requires a topic exchange):
>> 
>> a. a queue that holds two different message types, call them "MGMT" and "HB."
>> b. a producer writes MGMT messages to this queue
>> c. something called a "monitor" writes HB messages to this queue
>> d. consumer reads HB messages from this queue
>> e. monitor reads MGMT messages from this queue
>> 
>> Schematically I think it looks like this:
>> 
>> Producer(MGMT) -> monitor
>> Monitor(HB)    -> consumer
>> 
>> How would I define these relationships via RabbitMQ? Who does what to whom?! I suspect it's simple, but after two solid weeks of 10 hour days, I am fried.
>> 
>> Thank you for your help.
>> 
>> -Paul
>> 
>> PS: What follows is not an attempt to curry favor - but this is a really fine list; folks are friendly, knowledgeable, and eager to help. I really appreciate it.
>> 
>> 
>> 
>> 
>> 
>> ATTENTION: -----
>> 
>> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> <Screen Shot 2012-02-10 at 6.16.55 PM.png>

From visionofarun at gmail.com  Sat Feb 11 04:50:10 2012
From: visionofarun at gmail.com (Arun Chandrasekaran)
Date: Fri, 10 Feb 2012 20:50:10 -0800 (PST)
Subject: [rabbitmq-discuss] Multithreading and rabbitmq-c
In-Reply-To: <CAAt2po+MWN_1sEc71AQYqw+2x0yyxwrwihoC3vKESSFQtFat1w@mail.gmail.com>
References: <22742700.314.1328900431948.JavaMail.geo-discussion-forums@pbcsx4>
	<CAAt2poKcW=TyzcuFyoYfGYgBDC=ZpdqWhot=UsJGXkzuYjHLgg@mail.gmail.com>
	<CAAt2po+MWN_1sEc71AQYqw+2x0yyxwrwihoC3vKESSFQtFat1w@mail.gmail.com>
Message-ID: <31231703.404.1328935810043.JavaMail.geo-discussion-forums@pbla5>

Thanks for the reply Alan. That solved the problem.

Will the new github repo (https://github.com/alanxz/rabbitmq-c) be the 
primary repo that we should use from now on for rabbitmq-c instead of the 
mercurial repo on rabbit's site (http://hg.rabbitmq.com/rabbitmq-c/)?

- Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120210/6aed9901/attachment.htm>

From alan.antonuk at gmail.com  Sat Feb 11 05:19:37 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sat, 11 Feb 2012 00:19:37 -0500
Subject: [rabbitmq-discuss] Multithreading and rabbitmq-c
In-Reply-To: <31231703.404.1328935810043.JavaMail.geo-discussion-forums@pbla5>
References: <22742700.314.1328900431948.JavaMail.geo-discussion-forums@pbcsx4>
	<CAAt2poKcW=TyzcuFyoYfGYgBDC=ZpdqWhot=UsJGXkzuYjHLgg@mail.gmail.com>
	<CAAt2po+MWN_1sEc71AQYqw+2x0yyxwrwihoC3vKESSFQtFat1w@mail.gmail.com>
	<31231703.404.1328935810043.JavaMail.geo-discussion-forums@pbla5>
Message-ID: <CAAt2poLY9ggj6S4Zyo6hzxf+7_78d4XXKhpXsG8bhLJDQKE_UA@mail.gmail.com>

That is correct.

On Fri, Feb 10, 2012 at 11:50 PM, Arun Chandrasekaran <
visionofarun at gmail.com> wrote:

> Thanks for the reply Alan. That solved the problem.
>
> Will the new github repo (https://github.com/alanxz/**rabbitmq-c<https://github.com/alanxz/rabbitmq-c>) be
> the primary repo that we should use from now on for rabbitmq-c instead of
> the mercurial repo on rabbit's site (http://hg.rabbitmq.com/rabbitmq-c/)?
>
> - Arun
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120211/18b51886/attachment.htm>

From pbell at syncsort.com  Sat Feb 11 13:35:52 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Sat, 11 Feb 2012 08:35:52 -0500
Subject: [rabbitmq-discuss] Consequences of not ACK-ing
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1F6@MAILCCR.us.syncsort.com>

All,

In putting together a system architecture that tries to leverage Rabbit, I decided that I'd best not wait until end of March to get Alvaro and Jason's book. So I yesterday got the MEAP version and last night began reading it.

I came across something that is, at first blush, a fly in the ointment. Specifically, I read that if a consumer doesn't ACK (and assuming no auto-ack), then the broker will NOT deliver another message to that consumer, until it does ACK the previous message.

My consumers quickly hand-off the work task represented by the message. That is, they quickly dispatch a message to other threads which can carry on asynchronously. And then they are ready to receive another message. I had assumed and hoped that Rabbit would simply keep delivering messages despite this lack of ACK. This would allow me to maintain a high level of paraellism from the consumer "downwards." But it would also give me a means by which, should a work task fail, its message could be redelivered and the task retried.

A few questions:

a. can this behavior on the part of the broker be circumvented?

b. any ideas on ways of achieving my intent?

In re (b): I am beginning to think that my only choice (assuming answer to (a) is "no") will be to ACK the message as soon as I can. And, in my architecture, this would mean that I would need to create in the persistence layer some kind of task "status record" that records task state (e.g., "in-flight", "failed" "succeeded"), AND that the retry mechanism would have to depend on visiting the persistence layer to obtain the status record and take the appropriate action based on the last recorded task status. It seems to me it would be much easier if the message were still in a queue and could be redelivered from "above."

Thanks for your help.

-Paul



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From ask at rabbitmq.com  Sat Feb 11 13:59:56 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Sat, 11 Feb 2012 13:59:56 +0000
Subject: [rabbitmq-discuss] Consequences of not ACK-ing
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1F6@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1F6@MAILCCR.us.syncsort.com>
Message-ID: <7E7543DD-216F-46E7-98D1-C22015F54B81@rabbitmq.com>




On Feb 11, 2012, at 1:35 PM, "Bell, Paul M." <pbell at syncsort.com> wrote:

> Specifically, I read that if a consumer doesn't ACK (and assuming no auto-ack), then the broker will NOT deliver another message to that consumer, until it does ACK the previous message

This would have been true if you had a QoS with a prefetch count of 1, but by default it will deliver as many messages as it can while you read from the socket   . If you have a prefetch count of 4 it will deliver 4 unacked msgs at a time and so on.

> .

From tonygarnockjones+rabbitmq at gmail.com  Sat Feb 11 14:00:24 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Sat, 11 Feb 2012 09:00:24 -0500
Subject: [rabbitmq-discuss] Consequences of not ACK-ing
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1F6@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1F6@MAILCCR.us.syncsort.com>
Message-ID: <CAM8fPiTStCTmuY3sKvAoSU6+qWTJx2TwoWfHQyrvoheqN1ENKg@mail.gmail.com>

Hi Paul,

On 11 February 2012 08:35, Bell, Paul M. <pbell at syncsort.com> wrote:
> I came across something that is, at first blush, a fly in the ointment. Specifically, I read that if a consumer doesn't ACK (and assuming no auto-ack), then the broker will NOT deliver another message to that consumer, until it does ACK the previous message.

This is only true if you've used Basic.Qos to limit the number of
outstanding messages the broker is willing to offer. For instance,
setting the prefetch count to 1 will give the behaviour you describe.
If, on the other hand, you don't issue a Basic.Qos command at all, the
prefetch count will be unlimited, and the broker will stream messages
to connected consumers until the TCP buffers at the sending side fill
up, without regard for ACKs, delayed or otherwise.

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/

From pbell at syncsort.com  Sat Feb 11 15:00:59 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Sat, 11 Feb 2012 10:00:59 -0500
Subject: [rabbitmq-discuss] Consequences of not ACK-ing
In-Reply-To: <CAM8fPiTStCTmuY3sKvAoSU6+qWTJx2TwoWfHQyrvoheqN1ENKg@mail.gmail.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1F6@MAILCCR.us.syncsort.com>,
	<CAM8fPiTStCTmuY3sKvAoSU6+qWTJx2TwoWfHQyrvoheqN1ENKg@mail.gmail.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1F8@MAILCCR.us.syncsort.com>

Thank you, both.

That's quite a relief!

-Paul

________________________________________
From: tonygarnockjones at gmail.com [tonygarnockjones at gmail.com] On Behalf Of Tony Garnock-Jones [tonygarnockjones+rabbitmq at gmail.com]
Sent: Saturday, February 11, 2012 9:00 AM
To: Bell, Paul M.
Cc: RabbitMQ List
Subject: Re: [rabbitmq-discuss] Consequences of not ACK-ing

Hi Paul,

On 11 February 2012 08:35, Bell, Paul M. <pbell at syncsort.com> wrote:
> I came across something that is, at first blush, a fly in the ointment. Specifically, I read that if a consumer doesn't ACK (and assuming no auto-ack), then the broker will NOT deliver another message to that consumer, until it does ACK the previous message.

This is only true if you've used Basic.Qos to limit the number of
outstanding messages the broker is willing to offer. For instance,
setting the prefetch count to 1 will give the behaviour you describe.
If, on the other hand, you don't issue a Basic.Qos command at all, the
prefetch count will be unlimited, and the broker will stream messages
to connected consumers until the TCP buffers at the sending side fill
up, without regard for ACKs, delayed or otherwise.

Regards,
  Tony
--
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From pbell at syncsort.com  Sat Feb 11 18:50:15 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Sat, 11 Feb 2012 13:50:15 -0500
Subject: [rabbitmq-discuss] Naive Question
In-Reply-To: <100E71DD-A40C-4477-8360-B378F32966C3@syncsort.com>
References: <6e3318f9-cf2e-424d-a1bb-53239fd0da45@strongmad.batnest.org>
	<100E71DD-A40C-4477-8360-B378F32966C3@syncsort.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40447DED@MAILCCR.us.syncsort.com>

Hi Jerry,

OK, I think I understand now.

I think I will have my consumer create the two queues on the fly. These queues ("heartbeat" and "management") need live only for the duration of the long running task. The consumer is the first to know that the task has been accepted for processing, so consumer is a natural place to create the queues.

Again, the scenario is:

1. monitor sends heartbeat messages to the heartbeat queue; consumer receives them. 
2. a producer (in a higher layer) sends management messages to the management queue; monitor receives them.

Given what you said about queue creation idempotency, I trust it can't hurt if the other endpoint also declares the queue. E.g., in case (1) monitor declares the queue; in case (2) both producer and monitor declare the queue (in case (2) the queue was created by an entity that is not involved in the communication, i.e., consumer created it, but it is used by producer and monitor).

But I am uncertain about the "bind" operation. The sense I have is that only a receiver need bind (with a specific binding key) the queue to the exchange. Is that right?

Thanks for your help.

Cordially,

Paul

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Bell, Paul M.
Sent: Friday, February 10, 2012 8:54 PM
To: Jerry Kuch
Cc: RabbitMQ List
Subject: Re: [rabbitmq-discuss] Naive Question

Hi Jerry,

Yeah, I think that makes sense.

Could your two queue be characterized like this:

1. Monitor creates the HB queue. With binding key "HB," consumer binds this queue to the exchange. Monitor writes to exchange with routing-key "HB."

2. Producer creates the MGMT queue. With binding key "MGMT," monitor binds this queue to exchange. Producer writes to exchange with routing-key "MGMT."

As always, thank you.

-Paul

On Feb 10, 2012, at 8:15 PM, "Jerry Kuch" <jerryk at vmware.com> wrote:

> Hi, Paul:
> 
> Nope:  Redeclarations of a queue with the same name and properties, within a
> vhost, are idempotent.  Redeclaring the thing before you start using it is
> a fairly common idiom.  If the resource didn't exist, then it's created;
> otherwise you've verified its existence.
> 
> Redeclaring a queue with a given name with different properties fails, so you
> can't accidentally vandalize some existing piece of messaging fabric that
> somebody else might be using.
> 
> On point b:  producers publish messages to *exchanges*, not to queues.
> Which queues, if any, the messages end up in depends on how queues
> are bound to the exchange in question, and the properties of the message.
> 
> With regard to your specific scenario with MGMT and HB messages, are you
> sure you want them in the same queue?  It's not really possible in any
> graceful way for a consumer to selectively read some but not other messages
> from a queue unless one does something obnoxious like basic.get-ing and then
> rejecting the messages you weren't interested in so that they're requeued.
> 
> From what I understand of the design you're sketching, you may want two
> queues, one from which the monitor reads MGMT messages and one from which 
> something else reads HB messages.  You could imagine binding both of those
> queues to a topic exchange and have your producer use routing keys to land
> your messages in the desired place.
> 
> Make sense?
> 
> Best regards,
> Jerry
> 
> ----- Original Message -----
> From: "Paul M. Bell" <pbell at syncsort.com>
> To: "RabbitMQ List" <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Friday, February 10, 2012 3:36:47 PM
> Subject: [rabbitmq-discuss] Naive Question
> 
> All,
> 
> Hi again.
> 
> Only after trying to think through a real world scenario did I realize that my grasp of certain fundamental AMQP concepts is tenuous.
> 
> Specifically, given a producer and a consumer, is the normative behavior for only *one* of them to declare (create?) the queue over which they communicate? As I look over the examples that I've "written" ("copied" would be more accurate), I see my producer doing this:
> 
> 
> RabbitAdmin admin = new RabbitAdmin(rabbitTemplate.getConnectionFactory());
> Exchange ex = new FanoutExchange(routingKey, true, false);
> admin.declareExchange(ex);
> admin.declareQueue(new Queue(this.queueName));
> 
> 
> And I see my consumer doing this:
> 
> 
> ConsumerSimpleMessageListenerContainer container = new ConsumerSimpleMessageListenerContainer();
> container.setConnectionFactory(connectionFactory());
> container.setQueueNames(this.queueName);
> container.setConcurrentConsumers(this.onOfConsumer);
> container.setMessageListener(new MessageListenerAdapter(new ConsumerHandler(), new SimpleMessageConverter()));
> container.startConsumers();
> 
> 
> What would happen if each declared a queue of the same name and type - would that give rise to two distinct queues, leaving the producer and consumer unable to communicate?
> 
> If it's normative for only one party to create the queue and the other to bind to it, what will happen if, when I try to bind to the queue, it doesn't yet exist?
> 
> Here's what I am trying to get to (I assume it requires a topic exchange):
> 
> a. a queue that holds two different message types, call them "MGMT" and "HB."
> b. a producer writes MGMT messages to this queue
> c. something called a "monitor" writes HB messages to this queue
> d. consumer reads HB messages from this queue
> e. monitor reads MGMT messages from this queue
> 
> Schematically I think it looks like this:
> 
> Producer(MGMT) -> monitor
> Monitor(HB)    -> consumer
> 
> How would I define these relationships via RabbitMQ? Who does what to whom?! I suspect it's simple, but after two solid weeks of 10 hour days, I am fried.
> 
> Thank you for your help.
> 
> -Paul
> 
> PS: What follows is not an attempt to curry favor - but this is a really fine list; folks are friendly, knowledgeable, and eager to help. I really appreciate it.
> 
> 
> 
> 
> 
> ATTENTION: -----
> 
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Sun Feb 12 05:28:27 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Sat, 11 Feb 2012 21:28:27 -0800 (PST)
Subject: [rabbitmq-discuss] Naive Question
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40447DED@MAILCCR.us.syncsort.com>
Message-ID: <f7b465d5-42d0-4161-bab0-eacc90581288@strongmad.batnest.org>

Hi, Paul:

Your understanding of idempotency in this case is correct.  Anybody
trying to declare a queue or exchange of a given name that collides
with an existing one, succeeds trivially as long as they've not asked
for any properties different from those of the existing one.

Not that if you're publishing to an exchange that's not bound to any
queues, there's nowhere for the messages to actually go.  You may
want to review the "mandatory" and "immediate" flags that you can use
when publishing messages.  The mandatory flag tells the server that if
it wasn't able to place the message in any queues (e.g. none were bound
suitably), it should let the publisher know rather than silently dropping
the message, its default behavior.  Think of it along the lines of "Put
this message in at least one queue, and if you can't sent it back to me."
With the immediate flag, you are essentially asking the message to be
delievered to a consumer immediately if one is connected and able to take
delivery of the message, otherwise don't bother requeuing it for later
delivery.

You may want to keep those flags in mind if you're working in cases
where consumers' queues may not be ready yet.

Regarding bindings... A queue must be bound to an exchange in order to 
receive any messages.  Recall that producers publish *to an exchange*, 
and the message so published then finds its way into queues based on 
1) its properties and 2) what bindings, if any, exist between the 
exchange and queues.  Its those connections, from exchanges to queues,
that you create (unless you're freeloading on the trivial connections
that automatically existing between the default exchange and any 
queue, at the moment of that queue's birth).

Best regards,
Jerry

----- Original Message -----
From: "Paul M. Bell" <pbell at syncsort.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: "RabbitMQ List" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Saturday, February 11, 2012 10:50:15 AM
Subject: RE: [rabbitmq-discuss] Naive Question

Hi Jerry,

OK, I think I understand now.

I think I will have my consumer create the two queues on the fly. These queues ("heartbeat" and "management") need live only for the duration of the long running task. The consumer is the first to know that the task has been accepted for processing, so consumer is a natural place to create the queues.

Again, the scenario is:

1. monitor sends heartbeat messages to the heartbeat queue; consumer receives them. 
2. a producer (in a higher layer) sends management messages to the management queue; monitor receives them.

Given what you said about queue creation idempotency, I trust it can't hurt if the other endpoint also declares the queue. E.g., in case (1) monitor declares the queue; in case (2) both producer and monitor declare the queue (in case (2) the queue was created by an entity that is not involved in the communication, i.e., consumer created it, but it is used by producer and monitor).

But I am uncertain about the "bind" operation. The sense I have is that only a receiver need bind (with a specific binding key) the queue to the exchange. Is that right?

Thanks for your help.

Cordially,

Paul

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Bell, Paul M.
Sent: Friday, February 10, 2012 8:54 PM
To: Jerry Kuch
Cc: RabbitMQ List
Subject: Re: [rabbitmq-discuss] Naive Question

Hi Jerry,

Yeah, I think that makes sense.

Could your two queue be characterized like this:

1. Monitor creates the HB queue. With binding key "HB," consumer binds this queue to the exchange. Monitor writes to exchange with routing-key "HB."

2. Producer creates the MGMT queue. With binding key "MGMT," monitor binds this queue to exchange. Producer writes to exchange with routing-key "MGMT."

As always, thank you.

-Paul

On Feb 10, 2012, at 8:15 PM, "Jerry Kuch" <jerryk at vmware.com> wrote:

> Hi, Paul:
> 
> Nope:  Redeclarations of a queue with the same name and properties, within a
> vhost, are idempotent.  Redeclaring the thing before you start using it is
> a fairly common idiom.  If the resource didn't exist, then it's created;
> otherwise you've verified its existence.
> 
> Redeclaring a queue with a given name with different properties fails, so you
> can't accidentally vandalize some existing piece of messaging fabric that
> somebody else might be using.
> 
> On point b:  producers publish messages to *exchanges*, not to queues.
> Which queues, if any, the messages end up in depends on how queues
> are bound to the exchange in question, and the properties of the message.
> 
> With regard to your specific scenario with MGMT and HB messages, are you
> sure you want them in the same queue?  It's not really possible in any
> graceful way for a consumer to selectively read some but not other messages
> from a queue unless one does something obnoxious like basic.get-ing and then
> rejecting the messages you weren't interested in so that they're requeued.
> 
> From what I understand of the design you're sketching, you may want two
> queues, one from which the monitor reads MGMT messages and one from which 
> something else reads HB messages.  You could imagine binding both of those
> queues to a topic exchange and have your producer use routing keys to land
> your messages in the desired place.
> 
> Make sense?
> 
> Best regards,
> Jerry
> 
> ----- Original Message -----
> From: "Paul M. Bell" <pbell at syncsort.com>
> To: "RabbitMQ List" <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Friday, February 10, 2012 3:36:47 PM
> Subject: [rabbitmq-discuss] Naive Question
> 
> All,
> 
> Hi again.
> 
> Only after trying to think through a real world scenario did I realize that my grasp of certain fundamental AMQP concepts is tenuous.
> 
> Specifically, given a producer and a consumer, is the normative behavior for only *one* of them to declare (create?) the queue over which they communicate? As I look over the examples that I've "written" ("copied" would be more accurate), I see my producer doing this:
> 
> 
> RabbitAdmin admin = new RabbitAdmin(rabbitTemplate.getConnectionFactory());
> Exchange ex = new FanoutExchange(routingKey, true, false);
> admin.declareExchange(ex);
> admin.declareQueue(new Queue(this.queueName));
> 
> 
> And I see my consumer doing this:
> 
> 
> ConsumerSimpleMessageListenerContainer container = new ConsumerSimpleMessageListenerContainer();
> container.setConnectionFactory(connectionFactory());
> container.setQueueNames(this.queueName);
> container.setConcurrentConsumers(this.onOfConsumer);
> container.setMessageListener(new MessageListenerAdapter(new ConsumerHandler(), new SimpleMessageConverter()));
> container.startConsumers();
> 
> 
> What would happen if each declared a queue of the same name and type - would that give rise to two distinct queues, leaving the producer and consumer unable to communicate?
> 
> If it's normative for only one party to create the queue and the other to bind to it, what will happen if, when I try to bind to the queue, it doesn't yet exist?
> 
> Here's what I am trying to get to (I assume it requires a topic exchange):
> 
> a. a queue that holds two different message types, call them "MGMT" and "HB."
> b. a producer writes MGMT messages to this queue
> c. something called a "monitor" writes HB messages to this queue
> d. consumer reads HB messages from this queue
> e. monitor reads MGMT messages from this queue
> 
> Schematically I think it looks like this:
> 
> Producer(MGMT) -> monitor
> Monitor(HB)    -> consumer
> 
> How would I define these relationships via RabbitMQ? Who does what to whom?! I suspect it's simple, but after two solid weeks of 10 hour days, I am fried.
> 
> Thank you for your help.
> 
> -Paul
> 
> PS: What follows is not an attempt to curry favor - but this is a really fine list; folks are friendly, knowledgeable, and eager to help. I really appreciate it.
> 
> 
> 
> 
> 
> ATTENTION: -----
> 
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From toby.corkindale at strategicdata.com.au  Mon Feb 13 02:17:36 2012
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Mon, 13 Feb 2012 13:17:36 +1100
Subject: [rabbitmq-discuss] Bug? STOMP adaptor created queues with invalid
	UTF-8 characters
Message-ID: <4F3872C0.9000202@strategicdata.com.au>

Hi,
I *think* I've found symptoms of a bug in the RabbitMQ STOMP adaptor.

We're using /topic/ subscriptions in our applications, and the STOMP 
adaptor creates some temporary queues in RabbitMQ.
If you subscribe to /topic/foo.bar.123 it'll create a queue of the 
pattern stomp.dsub.foo.bar.123.XXXXXXXXXXXXXXXX
where the Xs are random characters.

It recently managed to create some with invalid UTF8 in the random 
section of the queue name. This broke the web management interface and 
the JSON REST API.

=ERROR REPORT==== 13-Feb-2012::13:05:44 ===
webmachine error: path="/api/queues//"
{error,{exit,{ucs,{bad_utf8_character_code}},
              [{xmerl_ucs,from_utf8,1},
               {mochijson2,json_encode_string,2},
               {mochijson2,'-json_encode_proplist/2-fun-0-',3},
               {lists,foldl,3},
               {mochijson2,json_encode_proplist,2},
               {mochijson2,'-json_encode_array/2-fun-0-',3},
               {lists,foldl,3},
               {mochijson2,json_encode_array,2}]}}



 From the command line, I see:
# rabbitmqctl list_queues -p test
Listing queues ...
stomp.dsub.websurvey.commander.686.???+[FY\003*\177y????	0
stomp.dsub.websurvey.commander.610.d?+^Ua\005sI?D?\031\031?	0
...done.


Is this intended behaviour? We've never seen this happen before.

Cheers,
Toby

From toby.corkindale at strategicdata.com.au  Mon Feb 13 02:37:48 2012
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Mon, 13 Feb 2012 13:37:48 +1100
Subject: [rabbitmq-discuss] Bug? STOMP adaptor created queues with
	invalid UTF-8 characters
In-Reply-To: <4F3872C0.9000202@strategicdata.com.au>
References: <4F3872C0.9000202@strategicdata.com.au>
Message-ID: <4F38777C.20705@strategicdata.com.au>

On 13/02/12 13:17, Toby Corkindale wrote:
> Hi,
> I *think* I've found symptoms of a bug in the RabbitMQ STOMP adaptor.
>
> We're using /topic/ subscriptions in our applications, and the STOMP
> adaptor creates some temporary queues in RabbitMQ.
> If you subscribe to /topic/foo.bar.123 it'll create a queue of the
> pattern stomp.dsub.foo.bar.123.XXXXXXXXXXXXXXXX
> where the Xs are random characters.

PS. Forgot to mention, these were persistent topic subscriptions.

> It recently managed to create some with invalid UTF8 in the random
> section of the queue name. This broke the web management interface and
> the JSON REST API.
>
> =ERROR REPORT==== 13-Feb-2012::13:05:44 ===
> webmachine error: path="/api/queues//"
> {error,{exit,{ucs,{bad_utf8_character_code}},
> [{xmerl_ucs,from_utf8,1},
> {mochijson2,json_encode_string,2},
> {mochijson2,'-json_encode_proplist/2-fun-0-',3},
> {lists,foldl,3},
> {mochijson2,json_encode_proplist,2},
> {mochijson2,'-json_encode_array/2-fun-0-',3},
> {lists,foldl,3},
> {mochijson2,json_encode_array,2}]}}
>
>
>
>  From the command line, I see:
> # rabbitmqctl list_queues -p test
> Listing queues ...
> stomp.dsub.websurvey.commander.686.???+[FY\003*\177y???? 0
> stomp.dsub.websurvey.commander.610.d?+^Ua\005sI?D?\031\031? 0
> ...done.
>
>
> Is this intended behaviour? We've never seen this happen before.
>
> Cheers,
> Toby


-- 
.signature

From majek04 at gmail.com  Mon Feb 13 09:23:13 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 13 Feb 2012 09:23:13 +0000
Subject: [rabbitmq-discuss] Bug? STOMP adaptor created queues with
 invalid UTF-8 characters
In-Reply-To: <4F3872C0.9000202@strategicdata.com.au>
References: <4F3872C0.9000202@strategicdata.com.au>
Message-ID: <CABzX+qyqPaYJ041hD0j1WwKZKD0gT-tYuzC_Opb-HLFkCGh06w@mail.gmail.com>

On Mon, Feb 13, 2012 at 02:17, Toby Corkindale
<toby.corkindale at strategicdata.com.au> wrote:
> I *think* I've found symptoms of a bug in the RabbitMQ STOMP adaptor.
>
> We're using /topic/ subscriptions in our applications, and the STOMP adaptor
> creates some temporary queues in RabbitMQ.
> If you subscribe to /topic/foo.bar.123 it'll create a queue of the pattern
> stomp.dsub.foo.bar.123.XXXXXXXXXXXXXXXX
> where the Xs are random characters.
>
> It recently managed to create some with invalid UTF8 in the random section
> of the queue name. This broke the web management interface and the JSON REST
> API.
>
> =ERROR REPORT==== 13-Feb-2012::13:05:44 ===
> webmachine error: path="/api/queues//"
> {error,{exit,{ucs,{bad_utf8_character_code}},
> ? ? ? ? ? ? [{xmerl_ucs,from_utf8,1},
> ? ? ? ? ? ? ?{mochijson2,json_encode_string,2},
> ? ? ? ? ? ? ?{mochijson2,'-json_encode_proplist/2-fun-0-',3},
> ? ? ? ? ? ? ?{lists,foldl,3},
> ? ? ? ? ? ? ?{mochijson2,json_encode_proplist,2},
> ? ? ? ? ? ? ?{mochijson2,'-json_encode_array/2-fun-0-',3},
> ? ? ? ? ? ? ?{lists,foldl,3},
> ? ? ? ? ? ? ?{mochijson2,json_encode_array,2}]}}
>

When I think about it, it's actually quite likely to happen.

There are certain codepoints that mochiweb/mochijson refuses
to encode. (And mochijson is used by the mgmt plugin).

But under the hood RabbitMQ doesn't do any specific parsing for Unicode,
for Rabbit every string is a valid one.

I know about two character groups which are invalid:
 - D800?DFFF see:
    http://en.wikipedia.org/wiki/Mapping_of_Unicode_characters#Surrogates
 - and FFFE and FFFF, which mochijson just refuses to encode
    http://en.wikibooks.org/wiki/Unicode/Character_reference/F000-FFFF

I'm not aware of other invalid codepoints.
Do you know if in your case you used one of these?

> Is this intended behaviour? We've never seen this happen before.

Of course not, but it can be controversial to decide what actually
is an intended behaviour.

In the meantime please avoid using invalid Unicode codepoints :)

Cheers,
   Marek

From absorbb at gmail.com  Mon Feb 13 09:28:39 2012
From: absorbb at gmail.com (=?KOI8-R?B?6czYxMHSIO7V0snTzMHNz9c=?=)
Date: Mon, 13 Feb 2012 12:28:39 +0300
Subject: [rabbitmq-discuss] Bug: Java ConnectionFactory can hangs
 forever in network packet loss cases
In-Reply-To: <CACYRexfFE2Es7FK-MzeOtWZ3WB77=7QRtY9fxnNXYHQeohZGpQ@mail.gmail.com>
References: <CACYRexfFE2Es7FK-MzeOtWZ3WB77=7QRtY9fxnNXYHQeohZGpQ@mail.gmail.com>
Message-ID: <CACYRexdEtppn4DxYAKRbRZw+SBRhohnwN88P_xXh68kvNJ3jrw@mail.gmail.com>

Can anybody help with this problem or prove that i'm wrong?

2012/2/7 ?????? ?????????? <absorbb at gmail.com>

> Hello.
>
> We have rabbitMQ 2.7.1 java clients remotely connected to the server.
> We started experience short-term bad network scenarios and serious problem
> occurred:
> 1. factory.setRequestedHeartbeat set to 30s
> 2. factory.setConnectionTimeout set to 30000ms
> client properly closes connection after missing 30 seconds of heartbeats.
> But sometimes it hangs completely when tries to open a new connection.
>
> I tried to analyze java client code and what is result:
>
> AMQConnection.java:286 :
>           _frameHandler.setTimeout(HANDSHAKE_TIMEOUT); - socket.soTimeout
> is set to 10s here
> then it starts the MainLoop at line 294
> and blocks till get a reply for a handshake at line 300:
>      connStart =
>                 (AMQP.Connection.Start)
> connStartBlocker.getReply().getMethod();
>
> problem is that it's possible that it'll never get a reply. Because
> MainLoop relies on heartbeats functional to handle such situation which is
> not enabled yet. It happens only at line 368:
>             setHeartbeat(heartbeat);
> MainLoop endlessly runs at 492:
>     Frame frame = _frameHandler.readFrame();
> which returns null every 10s (this is how SocketTimeoutException handled
> in Frame.readFrom..)
> and handleSocketTimeout() do nothing because _heartbeat is not set yet.
>
> Thanks.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120213/bd1519e0/attachment.htm>

From emile at rabbitmq.com  Mon Feb 13 10:15:16 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 13 Feb 2012 10:15:16 +0000
Subject: [rabbitmq-discuss] HA Documentation Error?
In-Reply-To: <1328903410.78762.YahooMailNeo@web44915.mail.sp1.yahoo.com>
References: <1328830347.88766.YahooMailNeo@web44913.mail.sp1.yahoo.com>
	<4F34EB96.6090203@rabbitmq.com>
	<1328903410.78762.YahooMailNeo@web44915.mail.sp1.yahoo.com>
Message-ID: <4F38E2B4.7010508@rabbitmq.com>

Hi Uday,

On 10/02/12 19:50, Uday Subbarayan wrote:
> Note: There is a risk in the above strategy if the master node goes
> down. If you want to avoid, then publish to all slaves? Here on wards, i

If the master becomes unavailable then a slave is promoted to take its
place. Message replication between slaves and the master happens
internally and automatically. As long as the queue is declared as
mirrored, the publisher is not required to take any action to republish
messages to slaves.

> am not clear. I also read about putting HA Proxy in front of the Rabbit
> MQ cluster and don't know whether it can lead to better or worse in this
> complex mix :-)

Active-active mirrored queues are recommended instead of the
active-passive approach, because it does not require additional software
and the failover process is quicker.


-Emile

From aloroi18 at gmail.com  Sun Feb 12 13:32:36 2012
From: aloroi18 at gmail.com (Bamboula)
Date: Sun, 12 Feb 2012 05:32:36 -0800 (PST)
Subject: [rabbitmq-discuss] Why is the queue created on the consumer's side?
Message-ID: <33309859.post@talk.nabble.com>


Hello all,

I've understood from the tutorials that the producer doesn't send any
message directly to a queue, and that quite often doesn't even know if a
message will be delivered to a queue.

In the third tutorial (Publisher/Subscriber), the queue is declared on the
consumer's side. I think that's for simplicity reasons in this particular
example (since the number of consumers is equal to the number of queues). 
Does queue declaration means queue creation? If yes, I think that it is
quite strange to create a queue on the consumer's side in real
applications.If no, where is the created?

I would appreciate if someone could give me some information.

Thanks a lot,

Bamboula 
-- 
View this message in context: http://old.nabble.com/Why-is-the-queue-created-on-the-consumer%27s-side--tp33309859p33309859.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alexandru at rabbitmq.com  Mon Feb 13 10:43:11 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 13 Feb 2012 10:43:11 +0000
Subject: [rabbitmq-discuss] Why is the queue created on the consumer's
 side?
In-Reply-To: <33309859.post@talk.nabble.com>
References: <33309859.post@talk.nabble.com>
Message-ID: <20120213104311.GC3782@southbank.Home>

Hi,

> I've understood from the tutorials that the producer doesn't send any
> message directly to a queue, and that quite often doesn't even know if a
> message will be delivered to a queue.

Correct.  It can use mandatory and immediate delivery modes to check if
the message has reached any queues, though.

> Does queue declaration means queue creation? If yes, I think that it is
> quite strange to create a queue on the consumer's side in real
> applications.If no, where is the created?

Queue declaration is an idempotent queue-creation.  It's more like an
assertion that the queue exists (after the queue.declare, you *know* the
queue exists).  So, you can declare a queue multiple times, but it will
only be created once.

Who should declare the queue depends from application to application.
For instance, in a work-queue scenario (where a producer enqueues tasks
for workers to execute), the producer should declare the queue (so that
tasks are queued even if there aren't any active workers).  In many
pub-sub scenarios, where consumers subscribe to events from a producer
(and old events are not interesting), the consumers would declare queues
(probably, one each).  In many other cases, both the consumer and the
producer would declare the queue (the producer to ensure that messages
aren't lost, and the consumer so that it can start consuming from the
queue even if the producer hasn't come online to declare the queue yet).

Hope this helps.

Cheers,
Alex

On Sun, Feb 12, 2012 at 05:32:36AM -0800, Bamboula wrote:
> 
> Hello all,
> 
> I've understood from the tutorials that the producer doesn't send any
> message directly to a queue, and that quite often doesn't even know if a
> message will be delivered to a queue.
> 
> In the third tutorial (Publisher/Subscriber), the queue is declared on the
> consumer's side. I think that's for simplicity reasons in this particular
> example (since the number of consumers is equal to the number of queues). 
> Does queue declaration means queue creation? If yes, I think that it is
> quite strange to create a queue on the consumer's side in real
> applications.If no, where is the created?
> 
> I would appreciate if someone could give me some information.
> 
> Thanks a lot,
> 
> Bamboula 
> -- 
> View this message in context: http://old.nabble.com/Why-is-the-queue-created-on-the-consumer%27s-side--tp33309859p33309859.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From kot.begemot at gmail.com  Fri Feb 10 00:20:53 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Thu, 9 Feb 2012 16:20:53 -0800
Subject: [rabbitmq-discuss] Active/Active: shutdown of one service
 brings down the cluster
In-Reply-To: <4F33BA32.100@rabbitmq.com>
References: <CAFWGgNHb9bjDPiW5uR9upBug-eaR2k8nYxhi8TN-vZwA419e1A@mail.gmail.com>
	<4F33BA32.100@rabbitmq.com>
Message-ID: <CAFWGgNHcqkpE72WTVw8yxsQssgvs+ETNcNx-dby2NbkuqKv8Kg@mail.gmail.com>

Hi Simon,

I think we nailed down a problem. We had a channel leak in our application.
With ~50 connections we had >90 channels per connection and growing. This
definitely correlates to high CPU usage.

What I still do not understand either it triggered rabbit into unstable
state or it was something else. Maybe increasing latencies in message
handling triggered cluster members into flipping neighbor aliveness status
back and force? Just speculating here: could timeouts because of high load
cause network fragmentation, when every node temporally does not see
neighbors, becomes a master, than see a neighbor, freak out, etc?

I've attached logs from all 3 cluster members. They are polluted with load
balancer "ping".

Vadim.

On Thu, Feb 9, 2012 at 4:21 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi. Thanks for the error report. There seem to be a lot of strange things
> happening here - can you provide more complete logs from such an incident?
>
> Cheers, Simon
>
>
> On 09/02/12 02:42, Vadim Chekan wrote:
>
>> Hi all,
>>
>> Given: 3 servers in active/active configuration, rabbit: 2.7.1, erlang
>> R14B03, CentOS, 64bits.
>> We experienced at least 2 occasions of the following situation: we
>> observe abnormal high CPU utilization on one of rabbit servers (40% when
>> <10% is a norm) without any obvious reason. We did nice restart rabbit
>> service and the whole cluster went down (restarted).
>> Another effect is that cluster seems to enters some (inconsistent?)
>> state and queues can not be registered/deleted, list of queues can not
>> be viewed through management UI, etc.
>>
>> Here is a log which contains errors when cluster in broken state:
>> http://pastebin.com/6rweU3MD
>>
>> Questions:
>>   Are those errors critical?
>>   If we experience a high CPU situation again, what can we do, any
>> additional logging, profiling, process snapshots, etc?
>>
>> Vadim.
>>
>> --
>>  From RFC 2631: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT
>> is explicitly specified
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 

From aloroi18 at gmail.com  Mon Feb 13 11:09:33 2012
From: aloroi18 at gmail.com (Bamboula)
Date: Mon, 13 Feb 2012 03:09:33 -0800 (PST)
Subject: [rabbitmq-discuss] Why is the queue created on the consumer's
 side?
In-Reply-To: <20120213104311.GC3782@southbank.Home>
References: <33309859.post@talk.nabble.com>
	<20120213104311.GC3782@southbank.Home>
Message-ID: <33314080.post@talk.nabble.com>


thanks a lot Alexandru, you did help me!

Alexandru Scvor?ov wrote:
> 
> Hi,
> 
>> I've understood from the tutorials that the producer doesn't send any
>> message directly to a queue, and that quite often doesn't even know if a
>> message will be delivered to a queue.
> 
> Correct.  It can use mandatory and immediate delivery modes to check if
> the message has reached any queues, though.
> 
>> Does queue declaration means queue creation? If yes, I think that it is
>> quite strange to create a queue on the consumer's side in real
>> applications.If no, where is the created?
> 
> Queue declaration is an idempotent queue-creation.  It's more like an
> assertion that the queue exists (after the queue.declare, you *know* the
> queue exists).  So, you can declare a queue multiple times, but it will
> only be created once.
> 
> Who should declare the queue depends from application to application.
> For instance, in a work-queue scenario (where a producer enqueues tasks
> for workers to execute), the producer should declare the queue (so that
> tasks are queued even if there aren't any active workers).  In many
> pub-sub scenarios, where consumers subscribe to events from a producer
> (and old events are not interesting), the consumers would declare queues
> (probably, one each).  In many other cases, both the consumer and the
> producer would declare the queue (the producer to ensure that messages
> aren't lost, and the consumer so that it can start consuming from the
> queue even if the producer hasn't come online to declare the queue yet).
> 
> Hope this helps.
> 
> Cheers,
> Alex
> 
> On Sun, Feb 12, 2012 at 05:32:36AM -0800, Bamboula wrote:
>> 
>> Hello all,
>> 
>> I've understood from the tutorials that the producer doesn't send any
>> message directly to a queue, and that quite often doesn't even know if a
>> message will be delivered to a queue.
>> 
>> In the third tutorial (Publisher/Subscriber), the queue is declared on
>> the
>> consumer's side. I think that's for simplicity reasons in this particular
>> example (since the number of consumers is equal to the number of queues). 
>> Does queue declaration means queue creation? If yes, I think that it is
>> quite strange to create a queue on the consumer's side in real
>> applications.If no, where is the created?
>> 
>> I would appreciate if someone could give me some information.
>> 
>> Thanks a lot,
>> 
>> Bamboula 
>> -- 
>> View this message in context:
>> http://old.nabble.com/Why-is-the-queue-created-on-the-consumer%27s-side--tp33309859p33309859.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Why-is-the-queue-created-on-the-consumer%27s-side--tp33309859p33314080.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Mon Feb 13 12:35:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 Feb 2012 12:35:57 +0000
Subject: [rabbitmq-discuss] Bug? STOMP adaptor created queues with
 invalid UTF-8 characters
In-Reply-To: <4F3872C0.9000202@strategicdata.com.au>
References: <4F3872C0.9000202@strategicdata.com.au>
Message-ID: <4F3903AD.8000007@rabbitmq.com>

On 13/02/12 02:17, Toby Corkindale wrote:
> It recently managed to create some with invalid UTF8 in the random
> section of the queue name. This broke the web management interface and
> the JSON REST API.

Ah, thanks for the bug report. We'll fix in the next release.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ruby.cutter at gmail.com  Mon Feb 13 14:02:18 2012
From: ruby.cutter at gmail.com (Ruby Cut)
Date: Mon, 13 Feb 2012 15:02:18 +0100
Subject: [rabbitmq-discuss] access for writing to exchange
Message-ID: <CAE5BdFeZ5oSd-BKqDmd+CxgBRSVVyjb1M-1NMkpA8o9uLxwDPw@mail.gmail.com>

Hi,

Wouldn't it be enough to have only write permission to write to exchange,
provided I do passive mode,

Here is example ruby script I expected to work but it doesn't.

prep with
gem install bunny
gem install rspec

run with

rspec test.rb


test.rb:
--------------------------------------------------------------
require 'bunny'
system "sudo rabbitmqctl add_vhost /x"
system "sudo rabbitmqctl add_user writer 123"
# with this it works
# system "sudo rabbitmqctl set_permissions -p /x writer '.*' '.*'  'foo'"
# with this it doesn't
system "sudo rabbitmqctl set_permissions -p /x writer 'foo' '.*'  'foo'"
system "sudo rabbitmqctl add_user admin 321"
system "sudo rabbitmqctl set_permissions -p /x admin '.*' '.*'  '.*'"

describe "wonderful bunny permission tests" do
  it "should only push" do


    @admin = Bunny.new(:host => 'localhost',:vhost=> "/x", :port =>
5672,:user=>"admin",:pass=> "321" )
    @admin.start

    # create/get queue
    q = @admin.queue('myqueue')

    # create/get exchange
    exchange = @admin.exchange("myexchange",:type => :topic,:durable =>
true)

    # bind queue to exchange
    q.bind(exchange,:key => "#")

    ##############################
    @writer =  Bunny.new(:host => 'localhost',:vhost=> "/x", :port =>
5672,:user=>"writer",:pass=> "123",:logging=>true )
    @writer.start
    e = @writer.exchange("myexchange", :passive => true)
    e.publish "yo"

    q.pop[:payload].should == "yo"
  end

end

And reply is:
I, [2012-02-13 14:50:54#16707]  INFO -- send:
#<Qrack::Transport::Method:0x7fd6f3cee0d8
@payload=#<Qrack::Protocol::Exchange::Declare:0x7fd6f3cee5d8
@auto_delete=nil, @durable=nil, @passive=true, @nowait=nil, @type=:direct,
@exchange="myexchange", @arguments=nil, @internal=nil, @ticket=1>,
@channel=1>
I, [2012-02-13 14:50:54#16707]  INFO -- received:
#<Qrack::Transport::Method:0x7fd6f3ceb540
@payload=#<Qrack::Protocol::Channel::Close:0x7fd6f3ceb400 @method_id=10,
@class_id=40, @reply_text="ACCESS_REFUSED - access to exchange 'myexchange'
in vhost '/x' refused for user 'writer'", @reply_code=403>, @channel=1>


Why do I still need config permission, although I opened exchange with
passive option.

Rubycut
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120213/e0fe5682/attachment.htm>

From simon at rabbitmq.com  Mon Feb 13 14:05:07 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 Feb 2012 14:05:07 +0000
Subject: [rabbitmq-discuss] access for writing to exchange
In-Reply-To: <CAE5BdFeZ5oSd-BKqDmd+CxgBRSVVyjb1M-1NMkpA8o9uLxwDPw@mail.gmail.com>
References: <CAE5BdFeZ5oSd-BKqDmd+CxgBRSVVyjb1M-1NMkpA8o9uLxwDPw@mail.gmail.com>
Message-ID: <4F391893.5050107@rabbitmq.com>

On 13/02/12 14:02, Ruby Cut wrote:
> Why do I still need config permission, although I opened exchange with
> passive option.

Are you using an old version? This was changed in 2.6.0 (passive 
declaration now requires no permission).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Feb 13 14:41:15 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 Feb 2012 14:41:15 +0000
Subject: [rabbitmq-discuss] access for writing to exchange
In-Reply-To: <CAE5BdFdK3Uh_UVFYYTzOApcxq9pg4fsbQDke+-L3T0c8oaiNWQ@mail.gmail.com>
References: <CAE5BdFeZ5oSd-BKqDmd+CxgBRSVVyjb1M-1NMkpA8o9uLxwDPw@mail.gmail.com>	<4F391893.5050107@rabbitmq.com>
	<CAE5BdFdK3Uh_UVFYYTzOApcxq9pg4fsbQDke+-L3T0c8oaiNWQ@mail.gmail.com>
Message-ID: <4F39210B.80001@rabbitmq.com>

This is mentioned in the 2.6.0 release notes, but maybe that's a bit 
*too* detailed...

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110831/36015373/attachment.txt

Cheers, Simon

On 13/02/12 14:38, Ruby Cut wrote:
> Yes, I am using 2.5.1, it looks like am I upgrame mess.
>
> Thanks very much.
>
> I tried to find detailed changelog to check that up, but could find
> anything.
>
> http://www.rabbitmq.com/changelog.html  this doesn't seem detailed
> enough for this case.
>
> On Mon, Feb 13, 2012 at 3:05 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 13/02/12 14:02, Ruby Cut wrote:
>
>         Why do I still need config permission, although I opened
>         exchange with
>         passive option.
>
>
>     Are you using an old version? This was changed in 2.6.0 (passive
>     declaration now requires no permission).
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>     _________________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.__rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Feb 13 14:47:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 Feb 2012 14:47:58 +0000
Subject: [rabbitmq-discuss] access for writing to exchange
In-Reply-To: <CAE5BdFcpwvMZ_L-p=LUb-S3Qq5fLJPNne27vugZCgjSfCTXtyw@mail.gmail.com>
References: <CAE5BdFeZ5oSd-BKqDmd+CxgBRSVVyjb1M-1NMkpA8o9uLxwDPw@mail.gmail.com>	<4F391893.5050107@rabbitmq.com>	<CAE5BdFdK3Uh_UVFYYTzOApcxq9pg4fsbQDke+-L3T0c8oaiNWQ@mail.gmail.com>	<4F39210B.80001@rabbitmq.com>
	<CAE5BdFcpwvMZ_L-p=LUb-S3Qq5fLJPNne27vugZCgjSfCTXtyw@mail.gmail.com>
Message-ID: <4F39229E.7050602@rabbitmq.com>

No, 2.7.1 will work fine with R14A. It's just that previous versions of 
RabbitMQ had some incompatibility with R15B.

Cheers, Simon

On 13/02/12 14:45, Ruby Cut wrote:
> What is this in 2.7.1?
> Compatibility with Erlang R15B
>
> Can I install 2.7.1 directly or I have to upgrade erlang?
>
> I currently run  Erlang R14A (erts-5.8) [source] [64-bit]
>
>
>
> On Mon, Feb 13, 2012 at 3:41 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     This is mentioned in the 2.6.0 release notes, but maybe that's a bit
>     *too* detailed...
>
>     http://lists.rabbitmq.com/__pipermail/rabbitmq-discuss/__attachments/20110831/36015373/__attachment.txt
>     <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110831/36015373/attachment.txt>
>
>     Cheers, Simon
>
>
>     On 13/02/12 14:38, Ruby Cut wrote:
>
>         Yes, I am using 2.5.1, it looks like am I upgrame mess.
>
>         Thanks very much.
>
>         I tried to find detailed changelog to check that up, but could find
>         anything.
>
>         http://www.rabbitmq.com/__changelog.html
>         <http://www.rabbitmq.com/changelog.html>  this doesn't seem detailed
>         enough for this case.
>
>         On Mon, Feb 13, 2012 at 3:05 PM, Simon MacMullen
>         <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>
>             On 13/02/12 14:02, Ruby Cut wrote:
>
>                 Why do I still need config permission, although I opened
>                 exchange with
>                 passive option.
>
>
>             Are you using an old version? This was changed in 2.6.0 (passive
>             declaration now requires no permission).
>
>             Cheers, Simon
>
>             --
>             Simon MacMullen
>             RabbitMQ, VMware
>             ___________________________________________________
>             rabbitmq-discuss mailing list
>             rabbitmq-discuss at lists.__rabbi__tmq.com <http://rabbitmq.com>
>         <mailto:rabbitmq-discuss at __lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>         https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>>
>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From ruby.cutter at gmail.com  Mon Feb 13 14:54:49 2012
From: ruby.cutter at gmail.com (Ruby Cut)
Date: Mon, 13 Feb 2012 15:54:49 +0100
Subject: [rabbitmq-discuss] access for writing to exchange
In-Reply-To: <4F39229E.7050602@rabbitmq.com>
References: <CAE5BdFeZ5oSd-BKqDmd+CxgBRSVVyjb1M-1NMkpA8o9uLxwDPw@mail.gmail.com>
	<4F391893.5050107@rabbitmq.com>
	<CAE5BdFdK3Uh_UVFYYTzOApcxq9pg4fsbQDke+-L3T0c8oaiNWQ@mail.gmail.com>
	<4F39210B.80001@rabbitmq.com>
	<CAE5BdFcpwvMZ_L-p=LUb-S3Qq5fLJPNne27vugZCgjSfCTXtyw@mail.gmail.com>
	<4F39229E.7050602@rabbitmq.com>
Message-ID: <CAE5BdFdpW-WRU_ko7FVZh2e1PmJYRKWm-mNsUtdipYu_=1pkLw@mail.gmail.com>

Thanks very much.

On Mon, Feb 13, 2012 at 3:47 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> No, 2.7.1 will work fine with R14A. It's just that previous versions of
> RabbitMQ had some incompatibility with R15B.
>
> Cheers, Simon
>
>
> On 13/02/12 14:45, Ruby Cut wrote:
>
>> What is this in 2.7.1?
>> Compatibility with Erlang R15B
>>
>> Can I install 2.7.1 directly or I have to upgrade erlang?
>>
>> I currently run  Erlang R14A (erts-5.8) [source] [64-bit]
>>
>>
>>
>> On Mon, Feb 13, 2012 at 3:41 PM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>    This is mentioned in the 2.6.0 release notes, but maybe that's a bit
>>    *too* detailed...
>>
>>    http://lists.rabbitmq.com/__**pipermail/rabbitmq-discuss/__**
>> attachments/20110831/36015373/**__attachment.txt<http://lists.rabbitmq.com/__pipermail/rabbitmq-discuss/__attachments/20110831/36015373/__attachment.txt>
>>
>>    <http://lists.rabbitmq.com/**pipermail/rabbitmq-discuss/**
>> attachments/20110831/36015373/**attachment.txt<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110831/36015373/attachment.txt>
>> >
>>
>>    Cheers, Simon
>>
>>
>>    On 13/02/12 14:38, Ruby Cut wrote:
>>
>>        Yes, I am using 2.5.1, it looks like am I upgrame mess.
>>
>>        Thanks very much.
>>
>>        I tried to find detailed changelog to check that up, but could find
>>        anything.
>>
>>        http://www.rabbitmq.com/__**changelog.html<http://www.rabbitmq.com/__changelog.html>
>>
>>        <http://www.rabbitmq.com/**changelog.html<http://www.rabbitmq.com/changelog.html>>
>>  this doesn't seem detailed
>>        enough for this case.
>>
>>        On Mon, Feb 13, 2012 at 3:05 PM, Simon MacMullen
>>        <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>>        <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>>
>>            On 13/02/12 14:02, Ruby Cut wrote:
>>
>>                Why do I still need config permission, although I opened
>>                exchange with
>>                passive option.
>>
>>
>>            Are you using an old version? This was changed in 2.6.0
>> (passive
>>            declaration now requires no permission).
>>
>>            Cheers, Simon
>>
>>            --
>>            Simon MacMullen
>>            RabbitMQ, VMware
>>            ______________________________**_____________________
>>            rabbitmq-discuss mailing list
>>            rabbitmq-discuss at lists.__rabbi**__tmq.com<http://rabbi__tmq.com><
>> http://rabbitmq.com>
>>        <mailto:rabbitmq-discuss at __lis**ts.rabbitmq.com<http://lists.rabbitmq.com>
>>        <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >>
>>        https://lists.rabbitmq.com/___**_cgi-bin/mailman/listinfo/____**
>> rabbitmq-discuss<https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss>
>>        <https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>> >
>>
>>        <https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>        <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >>
>>
>>
>>
>>
>>    --
>>    Simon MacMullen
>>    RabbitMQ, VMware
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120213/273e0aa3/attachment.htm>

From steve at rabbitmq.com  Mon Feb 13 15:47:07 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 13 Feb 2012 15:47:07 +0000
Subject: [rabbitmq-discuss] Problem with RabbitMQ Java Client (Memory
	leak)
In-Reply-To: <1b453046-9e07-4fa9-b883-ed64575f9b46@lr19g2000pbb.googlegroups.com>
References: <fd4945fc-14a3-4efb-9016-c78a9cae8043@vh10g2000pbc.googlegroups.com>
	<4C8B808C-80D4-40BB-9C99-98609675EB9C@rabbitmq.com>
	<9da89044-0ea4-4086-b338-ade4d68aa1d9@n7g2000pbd.googlegroups.com>
	<44BE06C1-A16E-4A9C-9F66-BEBEF00CB099@rabbitmq.com>
	<1b453046-9e07-4fa9-b883-ed64575f9b46@lr19g2000pbb.googlegroups.com>
Message-ID: <0BBFDCEB-83D5-4652-909B-D7518F033F70@rabbitmq.com>

Yogesh,
Sorry not to get back to you sooner.

I'm not at all sure what is causing your leak this time.

Are you using QueueingConsumer? How are your messages being consumed?

From the list of objects I am particularly interested in the ConsumerDispatcher
objects.

These ought to be created one per Channel, and can only be created when calling
the createChannel() method on the Connection interface. So please can you check
that you are not creating lots of channels.

If it is possible, can you construct a small program to demonstrate the leak,
like last time?

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 2 Feb 2012, at 17:32, Yogesh Ketkar wrote:

> Hi Steve,
> 
> Now that I am reusing the channels, memory problem with channels is
> not an issue, but there seems to be some more problem with memory
> leak.
> I had a program which pumped 100000 messages on a queue.
> 
> Then this program kicked in and created certain queues on the fly and
> distributed these messages across them and
> eventually all the messages got consumed.
> 
> Now when all queues in the system are empty, here is the object dump
> and I again see a lot of memory used by
> these objects.
> 
> 96449 instances of class com.rabbitmq.client.AMQP$BasicProperties
> 96428 instances of class com.rabbitmq.client.Envelope
> 96399 instances of class com.rabbitmq.client.impl.ConsumerDispatcher
> $4
> 
> I created BasicProperties object like this, while routing the messages
> to appropriate queue.
>    BasicProperties bp = new BasicProperties();
>    bp.setTimestamp(Calendar.getInstance().getTime());
>    bp.setType(MessageProperties.PERSISTENT_TEXT_PLAIN.toString());
> This was then used in basicPublish method.
> 
> regards, Yogesh
> 
> On Feb 1, 10:37 pm, Steve Powell <st... at rabbitmq.com> wrote:
>> The fix (which we have coded) will be in the next release,
>> but I don't know precisely when that will be.
>> 
>> Steve Powell  (a happy bunny)
>> ----------some more definitions from the SPD----------
>> vermin (v.) Treating the dachshund for roundworm.
>> chinchilla (n.) Cooling device for the lower jaw.
>> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>> 
>> On 1 Feb 2012, at 11:21, Yogesh Ketkar wrote:
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>>> Thanks Steve.
>>> Can you give me some idea about date of next Java Client release (with
>>> this bug-fix)?
>> 
>>> regards, Yogesh
>> 
>>> On Feb 1, 3:42 pm, Steve Powell <st... at rabbitmq.com> wrote:
>>>> Yogesh,
>> 
>>>> Thank you for this problem report. First point: each connection defines a
>>>> (hidden) channel zero, so that explains why there are 20001 of some objects and
>>>> 20000 of others.
>> 
>>>> As to why these are not garbage collected, we must be holding a reference
>>>> somewhere (probably in the Connection).
>> 
>>>> We will investigate. I have raised a bug (24723).
>> 
>>>> Steve Powell  (a happy bunny)
>>>> ----------some more definitions from the SPD----------
>>>> vermin (v.) Treating the dachshund for roundworm.
>>>> chinchilla (n.) Cooling device for the lower jaw.
>>>> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>> 
>>>> On 31 Jan 2012, at 17:49, Yogesh Ketkar wrote:
>> 
>>>>> I am using rabbitmq-java-client-bin-2.7.1/rabbitmq-client.jar with
>>>>> RabbitMQ 2.7.1 Server.
>> 
>>>>> Just run this code
>> 
>>>>> public static void main(String[] argv) throws IOException {
>>>>>    ConnectionFactory f = new ConnectionFactory();
>>>>>    Connection c = f.newConnection();
>>>>>    for(int i = 0; i < 20000; ++i) {
>>>>>        Channel ch = c.createChannel();
>>>>>        ch.close();
>>>>>    }
>>>>>    System.gc();
>>>>>    while(true) {}
>>>>> }
>> 
>>>>> While program is running, observe the memory usage, it keeps on
>>>>> increasing
>>>>> Get process id and do following
>>>>> jmap -dump:format=b,file=yo.bin  <pid>
>>>>> jhat jhat -J-mx768m -stack false yo.bin
>>>>> Once jhat brings up http server, go here
>>>>> http://localhost:7000/showInstanceCounts/
>> 
>>>>> 20001 instances of class com.rabbitmq.client.impl.AMQCommand
>>>>> 20001 instances of class com.rabbitmq.client.impl.CommandAssembler
>>>>> 20000 instances of class com.rabbitmq.client.ShutdownSignalException
>>>>> 20000 instances of class com.rabbitmq.client.impl.AMQImpl$Channel
>>>>> $Close
>>>>> 20000 instances of class com.rabbitmq.client.impl.ChannelN
>>>>> 20000 instances of class com.rabbitmq.client.impl.ConsumerDispatcher
>> 
>>>>> In-spite of closing all the channels, not only channels but associated
>>>>> objects (ShutdownSignalException, ChannelClose) continue to consume
>>>>> memory.
>>>>> For sure, knowing this now, I will use channelCreate call sparingly.
>> 
>>>>> Is there a way to remedy this situation?
>>>>> What is also worrying is instances of AMQCommand, so would this be the
>>>>> case for each and every call of client library?
>> 
>>>>> regards, Yogesh
>> 
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-disc... at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jerryk at vmware.com  Mon Feb 13 15:47:08 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 13 Feb 2012 07:47:08 -0800 (PST)
Subject: [rabbitmq-discuss] Problems with rabbit and hoping I can get
	some help
In-Reply-To: <CA+22WDSMG8N+2FHs_YtK8Up7OZzJj2JGOSofU_KYWV7C56-K4A@mail.gmail.com>
Message-ID: <fcd55558-0200-4e6b-b91f-5c26eef45fd8@strongmad.batnest.org>

Hi, Dathan:

If you're not seeing the attendant memory alarms in your Rabbit logs,
then the state you're describing isn't the TCP back-pressure we
speculated about earlier.

When you get into one of the states where you say Rabbit is "blocked," 
what happens if you:

1. Try to create a new connection (perhaps using another client other
then the Python one you're using)

2. Just trying telnetting to port 5672 on the broker, and banging out
some junk.  Does the broker answer the incoming telnet connection?
Does it puke an AMQP error promptly to your console?

3. Does the broker respond when you use rabbitmqctl to ask it 
questions about it's state?

4. Are you running the management plugin?  If so, is the broker
healthy enough to bring up the management web UI and let you poke
around?

Depending on the answer to these, I might wonder if we've got a
client-side problem, either in the library you're using, or perhaps
a quirk in how it's being used...

Best regards,
Jerry

----- Original Message -----
From: "Dathan Pattishall" <dathan at schoolfeed.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, January 31, 2012 1:19:29 PM
Subject: Re: [rabbitmq-discuss] Problems with rabbit and hoping I can get some help

CPU is rather Idle, 
6% CPU system on average 
8% CPU User on average 


No CPU wait IO 




so plenty of CPU / plenty of Memory 




On Tue, Jan 31, 2012 at 1:13 PM, Jerry Kuch < jerryk at vmware.com > wrote: 


Hi, Dathan... 

For dropping messages, you might consider setting message TTLs, but that 
may not give you quite what you want in all cases. 

What does the CPU consumption of your Rabbit node look like when you're 
seeing these pauses? If you wait, do they relent, with things getting 
moving again? 


Best regards, 
Jerry 

----- Original Message ----- 
From: "Dathan Pattishall" < dathan at schoolfeed.com > 


To: "Jerry Kuch" < jerryk at vmware.com > 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Tuesday, January 31, 2012 1:05:39 PM 
Subject: Re: [rabbitmq-discuss] Problems with rabbit and hoping I can get some help 

Hi Jerry, 


I neglected to mentioned that I am not hitting the memory-based flow control according to my memory alarm stat from 
rabbitmqadmin.py list nodes 


What threshold would the TCP back pressure logic hit? I assume when the memory limit is reached rabbit pushes back on the publishers? Rabbit did not use more then 2G of RAM out of the 5G allowed for it, if that is the case. 


Also is there a way to tell rabbit drop the messages instead of block? 



On Tue, Jan 31, 2012 at 12:56 PM, Jerry Kuch < jerryk at vmware.com > wrote: 


Hi, Dathan... 

What are your consumers doing with the published messages? If you use rabbitmqctl or 
the management plugin to look at what's going on in your queues, do you see messages 
accumulating but not being delivered? Or delivered but not ACKed? If messages are 
building up (either undelivered or unACKed) faster than consumers are draining them, 
you might be hitting memory-based flow control, which will use TCP back pressure to 
stop the publishers. 

See here for more information: 

http://www.rabbitmq.com/memory.html 

To get an idea whether this is happening to you, check out your queue contents as 
suggested above, and see if memory alarms are being set in your rabbit logs.../ 

Best regards, 
Jerry 


----- Original Message ----- 
From: "Dathan Pattishall" < dathan at schoolfeed.com > 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Tuesday, January 31, 2012 12:52:55 PM 
Subject: [rabbitmq-discuss] Problems with rabbit and hoping I can get some help 




Let me first describe my setup. 

root at webnode1]# rabbitmqadmin.py show overview 
+--------------------+-----------------+--------------------+------------------+ 
| management_version | node | statistics_db_node | statistics_level | 
+--------------------+-----------------+--------------------+------------------+ 
| 2.7.1 | rabbit at webnode1 | rabbit at webnode1 | fine | 
+--------------------+-----------------+--------------------+------------------+ 



Rabbit MQ's producers comes from PHP 5.3.8 http://www.php.net/manual/en/book.amqp.php . Each apache process could produce a rabbit message, I am producing around 1000 messages a second on c1.xtralarge instance at ec2. 



My erlang version is 


/usr/local/bin/erl -v 
Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8] [async-threads:0] [hipe] [kernel-poll:false] 




The PROBLEM: 


After about 40 mins of rabbit accepting messages all connections block causing a rather bad error on the front ends killing traffic. Turning rabbit off and restarting the web servers forces a recovery. 


Stats from Rabbit: 


Roughly 5000 queues are made 
Roughly 3600 exchanges are made 
Each exchange can have at most 1200 queues bound to it. 
Each Queue is setup for autodelete and so is the exchanges with delivery type 1. 
All data passed is JSON 


The consumer is NODE and its keeping up with the consumption 


RabbitMQ memlimit is around 5.3G 
RabbitMQ mem used hits around 1.9G when it freezes produces 
RabbitMQ proc used hits around 220K 
RabbitMQ fd_total is 50K 
RabbitMQ socks_total is around 45K and Socks used is 4K 
mem_ets hists 100M // not sure what this is 


Any idea what is going on? What limit am I hitting? Why does RabbitMQ block? How can I detect that I am about to hit a block state? Any suggestions or request of additional data would be great. 






_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 



From simon at rabbitmq.com  Mon Feb 13 15:54:33 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 Feb 2012 15:54:33 +0000
Subject: [rabbitmq-discuss] rabbitmqadmin and ability to read
 configuration files
In-Reply-To: <CAMOXM28oeg5E=7x1+dLrPdkt_r21_G1j=Nh8hX+X8i5yq60ZJA@mail.gmail.com>
References: <CAMOXM2-yT_ZSX4_FkJpnh=GFX4_QT8pLKt+j8pnnZF6QHp1BmA@mail.gmail.com>
	<4F33DFC9.60903@rabbitmq.com>
	<CAMOXM28oeg5E=7x1+dLrPdkt_r21_G1j=Nh8hX+X8i5yq60ZJA@mail.gmail.com>
Message-ID: <4F393239.5000707@rabbitmq.com>

On 10/02/12 19:06, Massimo Paladin wrote:
> Now it tries to read from ~/.rabbitmqadmin.conf if node is specified and
> the config file is not passed.

Thanks. I've merged your changes (+ some more tweaks).

> I am going to look at bash completion soon.

Of course that's a nice-to-have :-) I don't know if anyone apart from me 
uses rabbitmqadmin bash completion...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Mon Feb 13 15:57:49 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 13 Feb 2012 15:57:49 +0000
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B404479A4@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>
	<20120128171156.GD3692@southbank.Home>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>
	<20120129202348.GI3692@southbank.Home>
	<5F389C517756284F80239F55BCA5DDDD36923A6D@G9W0721.americas.hpqcorp.net>
	<20120130101227.GK3692@southbank.Home>
	<D4925C82-5E7D-451E-834C-D51F57A5958C@syncsort.com><20120130233656.GB3968@southbank.Home>
	<4F27C521.3030703@rabbitmq.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044789C@MAILCCR.us.syncsort.com>
	<EA522C4A-26D1-4882-8920-60907ABDEEFD@rabbitmq.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B404479A4@MAILCCR.us.syncsort.com>
Message-ID: <17C56C91-9B76-4B0B-8FBF-44AB608C279F@rabbitmq.com>

Paul,
Sorry not to get back to you sooner.

Ok, so these threads are used by *your* Consumers. In which case they probably
have no relation to the threads which we manage (to allow multiple channels to
use a pool of threads to execute consumer callbacks).

We create our pool of threads using ExecutorServices (in
java.util.concurrent.ExecutorService) with the call
Executors.newFixedThreadPool(NUM_THREADS). This produces an ExecutorService with
a fixed number of threads.

If you create a connection with newConnection(executorService), you can pass in
your own ExecutorService (of which there are many in java.util.concurrent -- or
you can roll your own) and some of these may have a dynamically varying number
of threads -- I don't know. However, it is entirely up to you.

Be careful, though, this is a notoriously difficult area of design -- better to
use a pre-designed one than try to implement one of your own.

Does this answer your question? I'm not at all sure what pool of threads you
want to 'dynamically vary'.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 2 Feb 2012, at 18:19, Bell, Paul M. wrote:

> Sorry, Steve - my error. The "Consumer" class I referenced is mine. Its constructor takes the aforementioned "3" and presents it to a setConcurrentConsumers call, something like the following:
> 
>             SimpleMessageListenerContainer container = new SimpleMessageListenerContainer();
>                container.setConcurrentConsumers(numConsumerThreads);
> 
> So I guess I am asking about dynamically adjusting the number of these threads.
> 
> Thanks.
> 
> -Paul
> 
> -----Original Message-----
> From: Steve Powell [mailto:steve at rabbitmq.com]
> Sent: Thursday, February 02, 2012 11:58 AM
> To: Bell, Paul M.
> Cc: RabbitMQ List
> Subject: Re: [rabbitmq-discuss] Securing RabbitMQ
> 
> Paul,
> 
> Sorry, Paul, but I don't understand the question.
> 
> To what Consumer are you referring? It is not possible
> to instantiate a java interface class (which Consumer is).
> 
> Perhaps you are using another client?
> 
> The Java Client's threading policy for Consumer callbacks
> changed in 2.7.0. You might like to read the blog entry(1) and
> the notes in the Java Client API pages(2).
> 
> Cheers,
> Steve Powell
> steve at rabbitmq.com
> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
> (1) http://www.rabbitmq.com/blog/2011/12/20/rabbitmq-2-7-0-and-2-7-1-are-released/
> (2) http://www.rabbitmq.com/api-guide.html ('Channel thread-safety' and 'Advanced connection options')
> 
> On 1 Feb 2012, at 19:57, Bell, Paul M. wrote:
> 
>> My question: is it possible to adjust the "concurrency" of a consumer in real time? That is, when I create a consumer with
>> 
>>    Consumer consumer = new Consumer("q1", "q1", 3);
>> 
>> I get a single consumer that runs 3 threads. Can I adjust this "3" dynamically?
>> 
>> Thanks again.
>> 
>> -Paul
> 
> 
> 
> 
> ATTENTION: -----
> 
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.


From steve at rabbitmq.com  Mon Feb 13 16:27:46 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 13 Feb 2012 16:27:46 +0000
Subject: [rabbitmq-discuss] questions about rabbitmq
In-Reply-To: <1328289073.93984.YahooMailNeo@web111704.mail.gq1.yahoo.com>
References: <1328289073.93984.YahooMailNeo@web111704.mail.gq1.yahoo.com>
Message-ID: <5CCE3F46-DA6E-4808-ABA1-A6A60708C8C6@rabbitmq.com>

Hi Jeff,

Apparently, everyone is non-plussed by your questions; I'll attempt to answer
one of them.

> 1. I've read that basic_consume is the most efficient way to receive messages
> from rabbitmq.
> 
Correct -- there are two basic ways to get messages from a RabbitMQ queue, PULL
and PUSH.

To PULL you (the client application) issue a basicGet() call against a queue,
and if there is a message waiting you get it. This is inefficient, because it
requires a round trip to the server (protocol messages flowing both ways), and
the application needs to poll the queue in some way if it wants to respond to
messages in a timely manner -- so there is an overhead in two ways.

PUSH access is where you, just once, register a Consumer class (or similar set
of callbacks) with RabbitMQ, nominating a particular queue. Thereafter, whenever
a message appears on the queue, RabbitMQ will deliver it to you (by calling a
callback method you registered) without you having to ask for it. No polling is
required by the client application, and no round trip to the server is needed.
This is highly efficient.

Furthermore, the Consumer has more than just message delivery callbacks -- the
server can notify your application about other changes -- for example if the
queue is deleted, or if the channel to which the Consumer is attached closes for
some reason. In the PULL case, the application would have to seek that
information at some point -- making the polling more costly (and more
interesting to implement).

>                Is it possible for one consumer (my websock/lp server) to
> register to multiple queues(conceivably several thousand) and have messages
> continually sent to it?
> 
Certainly it is. When registering a Consumer you (either nominate, or) get a
(server-generated) consumer *tag*, essentially an identifier for the Consumer.
You only have to keep a map of tags so that the Consumer can known (when it is
called) for which registration this callback is being made.

If you have a single channel connection to RabbitMQ, then the Consumers (each
registration looks like a Consumer to the server) get called serially, so there
is no concurrency. If you have many channels you can register for different
queues on different channels and the distinct channels' callbacks can run
concurrently.

This is easiest for me to describe in the Java Client. I recommend you start by
looking at the Java tutorials (http://www.rabbitmq.com/getstarted.html) and then
go on to read the Java API Guide, especially the part about Consumers and the
threading model.

It ought to be fairly inexpensive to to basicConsume() on multiple queues, with
the number of channels determining what sort of concurrency you want to have.

Steve Powell  (a starter bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 3 Feb 2012, at 17:11, Jeff C wrote:
> Hello all,
> 
> I recently began reading up on rabbitmq and the amqp paradigm, via rabbitmq's
> site documentation and miscellaneous tutorials around the web, as I plan to use
> rabbit as the core for a real-time forum component that will be part of a site I
> am working on, where new posts will be forwarded out to client machines from a
> long-polling/websocket server sitting between the users and rabbitmq.(I'm new to
> message passing systems) I've been reading some posts and even a talk from
> Alexis Richardson, and I decided to join the mailing list to ask some specific
> questions; I have three:
> ...


From steve at rabbitmq.com  Mon Feb 13 16:45:11 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 13 Feb 2012 16:45:11 +0000
Subject: [rabbitmq-discuss] RabbitMQ, STOMP and redeliver flag
In-Reply-To: <1d7b8898-a6eb-450d-8a95-0ca7d61d50e4@x6g2000pbk.googlegroups.com>
References: <1d7b8898-a6eb-450d-8a95-0ca7d61d50e4@x6g2000pbk.googlegroups.com>
Message-ID: <7CC7157B-E12D-4BF4-ABAE-60A8FFABFF35@rabbitmq.com>

Sunil,

As far as I can see, redelivery information is never sent to a STOMP client,
though this is available in the STOMP adapter, so we might be able to put it in
a message header.

I've raised a requirement.

Steve Powell  (a delirious kitten)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 3 Feb 2012, at 20:01, Sunil Agrawal wrote:

> Hi,
> I just started using STOMP protocol for communicating with RabbitMQ.
> Everything works well. However wondering if RabbitMQ tells STOMP
> clients if a message is redelivered. Didn't see any information. If
> this is not supported, any plans of supporting it in near future?
> 
> Thanks in advance,
> Sunil
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Mon Feb 13 16:46:41 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 13 Feb 2012 16:46:41 +0000
Subject: [rabbitmq-discuss] RabbitMQ, STOMP and redeliver flag
In-Reply-To: <1d7b8898-a6eb-450d-8a95-0ca7d61d50e4@x6g2000pbk.googlegroups.com>
References: <1d7b8898-a6eb-450d-8a95-0ca7d61d50e4@x6g2000pbk.googlegroups.com>
Message-ID: <6F9D5695-9D92-44E1-99C4-6A5C4DF82E3F@rabbitmq.com>

(bug 24741)

Steve Powell  (a picky bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 3 Feb 2012, at 20:01, Sunil Agrawal wrote:

> Hi,
> I just started using STOMP protocol for communicating with RabbitMQ.
> Everything works well. However wondering if RabbitMQ tells STOMP
> clients if a message is redelivered. Didn't see any information. If
> this is not supported, any plans of supporting it in near future?
> 
> Thanks in advance,
> Sunil
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Mon Feb 13 18:09:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 Feb 2012 18:09:44 +0000
Subject: [rabbitmq-discuss] Active/Active: shutdown of one service
 brings down the cluster
In-Reply-To: <CAFWGgNHcqkpE72WTVw8yxsQssgvs+ETNcNx-dby2NbkuqKv8Kg@mail.gmail.com>
References: <CAFWGgNHb9bjDPiW5uR9upBug-eaR2k8nYxhi8TN-vZwA419e1A@mail.gmail.com>	<4F33BA32.100@rabbitmq.com>
	<CAFWGgNHcqkpE72WTVw8yxsQssgvs+ETNcNx-dby2NbkuqKv8Kg@mail.gmail.com>
Message-ID: <4F3951E8.5090305@rabbitmq.com>

On 10/02/12 00:20, Vadim Chekan wrote:
> I think we nailed down a problem. We had a channel leak in our
> application. With ~50 connections we had >90 channels per connection and
> growing. This definitely correlates to high CPU usage.
>
> What I still do not understand either it triggered rabbit into unstable
> state or it was something else. Maybe increasing latencies in message
> handling triggered cluster members into flipping neighbor aliveness
> status back and force? Just speculating here: could timeouts because of
> high load cause network fragmentation, when every node temporally does
> not see neighbors, becomes a master, than see a neighbor, freak out, etc?

That's plausible, but I don't think that's what's happening (there's 
nothing about network partitioning in the logs).

> I've attached logs from all 3 cluster members. They are polluted with
> load balancer "ping".

Thanks. I've had a poke at this but nothing is leaping out at me yet. 
I'll keep at it though.

One thing that's a bit odd: you seem to be creating HA / transient / 
autodelete / exclusive queues. So although they're "HA", they will 
vanish if any of the following happens:

* The entire cluster goes down (transient) or
* All consumers for a queue cancel (autodelete) or
* The connection that created them closes (exclusive)

Is this intentional? It seems like an odd use of HA.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From sunil at armor5.com  Mon Feb 13 18:49:58 2012
From: sunil at armor5.com (Sunil Agrawal)
Date: Mon, 13 Feb 2012 10:49:58 -0800
Subject: [rabbitmq-discuss] RabbitMQ, STOMP and redeliver flag
In-Reply-To: <7CC7157B-E12D-4BF4-ABAE-60A8FFABFF35@rabbitmq.com>
References: <1d7b8898-a6eb-450d-8a95-0ca7d61d50e4@x6g2000pbk.googlegroups.com>
	<7CC7157B-E12D-4BF4-ABAE-60A8FFABFF35@rabbitmq.com>
Message-ID: <CANjOKxEdeuAkVaMuGZTit3-q4nt6dhG6PEAaHaR8-c_M6RRDAw@mail.gmail.com>

Thanks Steve,
Please keep the mailing list updated once the functionality goes in a
release. Meanwhile, is it possible for you to just give me a patch that I
can apply locally?

Thanks, Sunil

On Mon, Feb 13, 2012 at 8:45 AM, Steve Powell <steve at rabbitmq.com> wrote:

> Sunil,
>
> As far as I can see, redelivery information is never sent to a STOMP
> client,
> though this is available in the STOMP adapter, so we might be able to put
> it in
> a message header.
>
> I've raised a requirement.
>
> Steve Powell  (a delirious kitten)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>
> On 3 Feb 2012, at 20:01, Sunil Agrawal wrote:
>
> > Hi,
> > I just started using STOMP protocol for communicating with RabbitMQ.
> > Everything works well. However wondering if RabbitMQ tells STOMP
> > clients if a message is redelivered. Didn't see any information. If
> > this is not supported, any plans of supporting it in near future?
> >
> > Thanks in advance,
> > Sunil
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120213/de376980/attachment.htm>

From santiagomonttco at gmail.com  Mon Feb 13 22:41:03 2012
From: santiagomonttco at gmail.com (CONFERENCIA)
Date: Mon, 13 Feb 2012 19:41:03 -0300
Subject: [rabbitmq-discuss] |Spam| ACCIDENTES DEL TRABAJO RESPONSABILIDAD
	CIVIL Y PENAL
Message-ID: <bb67bda4c1c8659b32ffee3f0012b8b9@gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120213/163faed9/attachment.htm>

From rev.chip at gmail.com  Mon Feb 13 23:05:32 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Mon, 13 Feb 2012 15:05:32 -0800 (PST)
Subject: [rabbitmq-discuss] Does Rabbit store fanout messages once,
	or N times?
Message-ID: <3df4e011-f193-4cfd-b75a-5628f1ab6a19@vv9g2000pbc.googlegroups.com>

Given an exchange that fans out to N queues, and delivery-mode=2, how
many copies of messages to the given exchange are stored on disk and/
or memory -- one, or N?

From rev.chip at gmail.com  Mon Feb 13 23:06:33 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Mon, 13 Feb 2012 15:06:33 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmqadmin and ability to read
	configuration files
In-Reply-To: <4F393239.5000707@rabbitmq.com>
References: <CAMOXM2-yT_ZSX4_FkJpnh=GFX4_QT8pLKt+j8pnnZF6QHp1BmA@mail.gmail.com>
	<4F33DFC9.60903@rabbitmq.com>
	<CAMOXM28oeg5E=7x1+dLrPdkt_r21_G1j=Nh8hX+X8i5yq60ZJA@mail.gmail.com>
	<4F393239.5000707@rabbitmq.com>
Message-ID: <0ec76a55-1534-4fb7-8fbf-0359e637c480@sk8g2000pbc.googlegroups.com>

On Feb 13, 7:54?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 10/02/12 19:06, Massimo Paladin wrote:
> > I am going to look at bash completion soon.
>
> Of course that's a nice-to-have :-) I don't know if anyone apart from me
> uses rabbitmqadmin bash completion...

I guess nobody but me would use zsh completion.  Pity.

From videlalvaro at gmail.com  Mon Feb 13 23:08:17 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 14 Feb 2012 00:08:17 +0100
Subject: [rabbitmq-discuss] Does Rabbit store fanout messages once,
	or N times?
In-Reply-To: <3df4e011-f193-4cfd-b75a-5628f1ab6a19@vv9g2000pbc.googlegroups.com>
References: <3df4e011-f193-4cfd-b75a-5628f1ab6a19@vv9g2000pbc.googlegroups.com>
Message-ID: <839744B1-65C6-4CAB-A2AA-1EB338805746@gmail.com>

AFAIK the message is stored just once.

On Feb 14, 2012, at 12:05 AM, Chip Salzenberg wrote:

> Given an exchange that fans out to N queues, and delivery-mode=2, how
> many copies of messages to the given exchange are stored on disk and/
> or memory -- one, or N?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From alexandru at rabbitmq.com  Mon Feb 13 23:11:53 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 13 Feb 2012 23:11:53 +0000
Subject: [rabbitmq-discuss] Does Rabbit store fanout messages once,
 or N times?
In-Reply-To: <3df4e011-f193-4cfd-b75a-5628f1ab6a19@vv9g2000pbc.googlegroups.com>
References: <3df4e011-f193-4cfd-b75a-5628f1ab6a19@vv9g2000pbc.googlegroups.com>
Message-ID: <20120213231153.GA3318@southbank.Home>

One.

If the broker is not clustered, the message content is only stored once,
but some information about it (its id, its position in each queue) is
stored N times.

If the broker is clustered, the situation is the same as above and
the clustered brokers will exchange message content on-demand.

By the way, this is true for any exchange type, not just fanout.

Cheers,
Alex

On Mon, Feb 13, 2012 at 03:05:32PM -0800, Chip Salzenberg wrote:
> Given an exchange that fans out to N queues, and delivery-mode=2, how
> many copies of messages to the given exchange are stored on disk and/
> or memory -- one, or N?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From toby.corkindale at strategicdata.com.au  Mon Feb 13 23:40:25 2012
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Tue, 14 Feb 2012 10:40:25 +1100
Subject: [rabbitmq-discuss] Bug? STOMP adaptor created queues with
 invalid UTF-8 characters
In-Reply-To: <CABzX+qyqPaYJ041hD0j1WwKZKD0gT-tYuzC_Opb-HLFkCGh06w@mail.gmail.com>
References: <4F3872C0.9000202@strategicdata.com.au>
	<CABzX+qyqPaYJ041hD0j1WwKZKD0gT-tYuzC_Opb-HLFkCGh06w@mail.gmail.com>
Message-ID: <4F399F69.7050106@strategicdata.com.au>

On 13/02/12 20:23, Marek Majkowski wrote:
> On Mon, Feb 13, 2012 at 02:17, Toby Corkindale
> <toby.corkindale at strategicdata.com.au>  wrote:
>> I *think* I've found symptoms of a bug in the RabbitMQ STOMP adaptor.
>>
>> We're using /topic/ subscriptions in our applications, and the STOMP adaptor
>> creates some temporary queues in RabbitMQ.
>> If you subscribe to /topic/foo.bar.123 it'll create a queue of the pattern
>> stomp.dsub.foo.bar.123.XXXXXXXXXXXXXXXX
>> where the Xs are random characters.
>>
>> It recently managed to create some with invalid UTF8 in the random section
>> of the queue name. This broke the web management interface and the JSON REST
>> API.
>>
>> =ERROR REPORT==== 13-Feb-2012::13:05:44 ===
>> webmachine error: path="/api/queues//"
>> {error,{exit,{ucs,{bad_utf8_character_code}},
>>              [{xmerl_ucs,from_utf8,1},
>>               {mochijson2,json_encode_string,2},
>>               {mochijson2,'-json_encode_proplist/2-fun-0-',3},
>>               {lists,foldl,3},
>>               {mochijson2,json_encode_proplist,2},
>>               {mochijson2,'-json_encode_array/2-fun-0-',3},
>>               {lists,foldl,3},
>>               {mochijson2,json_encode_array,2}]}}
>>
>
> When I think about it, it's actually quite likely to happen.
>
> There are certain codepoints that mochiweb/mochijson refuses
> to encode. (And mochijson is used by the mgmt plugin).
>
> But under the hood RabbitMQ doesn't do any specific parsing for Unicode,
> for Rabbit every string is a valid one.
>
> I know about two character groups which are invalid:
>   - D800?DFFF see:
>      http://en.wikipedia.org/wiki/Mapping_of_Unicode_characters#Surrogates
>   - and FFFE and FFFF, which mochijson just refuses to encode
>      http://en.wikibooks.org/wiki/Unicode/Character_reference/F000-FFFF
>
> I'm not aware of other invalid codepoints.
> Do you know if in your case you used one of these?

We were using strictly ASCII names.
The invalid characters were turning up in the auto-generated part of the 
queue names, from the STOMP adaptor inside RabbitMQ.


>> Is this intended behaviour? We've never seen this happen before.
>
> Of course not, but it can be controversial to decide what actually
> is an intended behaviour.
>
> In the meantime please avoid using invalid Unicode codepoints :)

See above! :)

Thanks for looking into this,
Toby


-- 
.signature

From samc at catalyst.net.nz  Tue Feb 14 02:47:43 2012
From: samc at catalyst.net.nz (Sam Crawley)
Date: Tue, 14 Feb 2012 15:47:43 +1300
Subject: [rabbitmq-discuss] Possibly latency issues
In-Reply-To: <69CA5A89-1A5E-4EEB-9255-059264DB254E@ecollege.com>
References: <1328582743.2123.28.camel@samc-pc.wgtn.cat-it.co.nz>
	<69CA5A89-1A5E-4EEB-9255-059264DB254E@ecollege.com>
Message-ID: <1329187663.5536.10.camel@samc-pc.wgtn.cat-it.co.nz>

Hi,

Thanks for the feedback (and apologies for the delay in responding).

OK, I've reduced the variables even further and tested this on a single
machine, running Debian Squeeze. I've built Erlang version 15B. RabbitMQ
is installed from the RabbitMQ debian repo without any configuration.
rabbitmqctl status gives me:

Status of node 'rabbit at xxxx' ...
[{pid,22390},
 {running_applications,[{rabbit,"RabbitMQ","2.7.1"},
                        {os_mon,"CPO  CXC 138 46","2.2.8"},
                        {sasl,"SASL  CXC 138 11","2.2"},
                        {mnesia,"MNESIA  CXC 138 12","4.6"},
                        {stdlib,"ERTS  CXC 138 10","1.18"},
                        {kernel,"ERTS  CXC 138 10","2.15"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R15B (erts-5.9) [source] [64-bit]
[async-threads:30] [kernel-poll:true]\n"},
 {memory,[{total,25669112},
          {processes,10124080},
          {processes_used,10124066},
          {system,15545032},
          {atom,471633},
          {atom_used,470423},
          {binary,151688},
          {code,11797130},
          {ets,750032}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,844374016}]
...done.

I use the following Perl script to send an receive messages (no longer
using our own client for this test, instead using Net::RabbitMQ, a
wrapper around librabbitmq-c, available from CPAN... also reduced the
message size - it doesn't seem to be a factor):

---

use strict;
use warnings;

use v5.10;
use Time::HiRes qw(gettimeofday tv_interval);
use Net::RabbitMQ;
use Statistics::Basic qw(:all);
use List::Util qw(max min);

my $length = 5;
my $queue = 'my_queue';

my $mq = Net::RabbitMQ->new();
$mq->connect("localhost", { user => "guest", password => "guest" });
$mq->channel_open(1);
$mq->queue_declare(1, $queue);

my $payload = 'a' x $length;

my @times;

$mq->consume(1, $queue, {});

for (1..1000) {
    $mq->publish(1, $queue, $payload);

    my @start = gettimeofday();

    my $msg = $mq->recv();
    
    push @times, tv_interval( \@start ); 
}

$mq->disconnect();

my $longest = max @times;
my $shortest = min @times;

print "Longest request: $longest, Shortest Request: $shortest\n"; 
say "Mean Req time: " . mean(@times);

---

AFAIK, acks, durable queues, etc. are all turned off.

Running this, I always get an average time (and I'm obviously only
timing the reading of messages) of 0.04s. (FWIW, I get the same with our
home grown client). 

Does it seem like there's something wrong here?

Thanks,
Sam.

On Tue, 2012-02-07 at 04:50 +0000, Chris Chew wrote:
> Hi Sam.
> 
> It's definitely worth trying a new version of Erlang.  Something in the 14B range or newer should perform noticeably better.
> 
> Also, are you doing a basicGet or basicConsume when listening for the messages?
> 
> Cheers,
> 
> Chris
> 
> On Feb 6, 2012, at 19:46, "Sam Crawley" <samc at catalyst.net.nz> wrote:
> 
> > Hi,
> > 
> > I've been trying to track down some performance issues in our
> > application since switching to RabbitMQ (previously used Spread), and it
> > seems latency for a single round trip message is an issue.
> > 
> > In a simple(ish) benchmark I've created, I have a daemon that blocks,
> > waiting for a message. When it receives one, it sends a message back to
> > the original sender. I then have a script that runs on another machine
> > (on the same LAN), which sends messages of about 5k in size, and records
> > the time for the round trip.
> > 
> > In these tests, I get an average of about 0.1s for the round trip. Does
> > this seem unreasonably slow? In an identical test using Spread, I get
> > times of around 0.01s (the application performance issue we're seeing is
> > showing RabbitMQ about 3-4 times slower than Spread).
> > 
> > I realise it's quite likely the problem is something odd I'm doing, but
> > I just want to rule out anything obvious at this stage. Could it be OS,
> > Erlang version, etc?
> > 
> > I'm running on Debian Lenny, with RabbitMQ 2.7.1, and Erlang 12b3 (from
> > the standard Lenny package). Are there any known issues with this
> > configuration, or any other factors I might be missing?
> > 
> > The client is written in Perl, using a home-grown client (but based on
> > Net::AMQP), as there wasn't really much suitable to our purposes on
> > CPAN. I hope to have this client on CPAN sometime soon, and will likely
> > ask for a review for people who might have comments. It's possible
> > (likely?) it's not as efficient as it could be, and would be nice to
> > rule that out somehow.
> > 
> > Would appreciate any help.. apologies if I haven't given all the
> > relevant information.
> > 
> > Thanks,
> > Sam Crawley.
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 



From zubeir.goku at gmail.com  Tue Feb 14 09:22:29 2012
From: zubeir.goku at gmail.com (mohammed zubeir)
Date: Tue, 14 Feb 2012 14:52:29 +0530
Subject: [rabbitmq-discuss] Help Needed Urgently
Message-ID: <CADF0yp9RH9-_o9vfhe0mEX+g5acgXj50FUeAShc+OObBTD1ZjA@mail.gmail.com>

Hi,

  I am developing a python web crawler using RabbitMQ. The server sends
list of urls to be crawled to client and he will send the results after
crawling. My problem is that when client is processing the request and it
dies suddenly all the information abt the request is lost. i.e. rabbitmq
removes the message from queue when client takes a request. I want it to be
relaible. Even if the client dies message should be available in message
queue which can be allocated to some other client. Please reply asap.


Hoping for a positive response on this issue.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120214/11eb28f9/attachment.htm>

From joemonvarghese80 at gmail.com  Tue Feb 14 10:29:28 2012
From: joemonvarghese80 at gmail.com (Joemon Varghese)
Date: Tue, 14 Feb 2012 15:59:28 +0530
Subject: [rabbitmq-discuss] Rabbit Mq not workign in Windows 2007 server
	environment
Message-ID: <CALnUTWUS3VQAfQKuu5atsvMAWsf=CsUTS0J04johsuxd3wvX5A@mail.gmail.com>

Hi,
  I am developing a silverlight Application in which i am calling Rabbit mq
from WCF layer.I have upgraded my server from Windows 2003 to windows 2007.
and i have installed rabbit mq 2.7.1 version in my windows 2007 server.Now
the messages  are  not getting procesed .Its stuck up in the Queue.
do i need to configure something in Rabbit MQ or from Windows side. ?


Thanking in Advance for your help..

Regards,
Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120214/cf0e6a5d/attachment.htm>

From emile at rabbitmq.com  Tue Feb 14 10:35:47 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 14 Feb 2012 10:35:47 +0000
Subject: [rabbitmq-discuss] Help Needed Urgently
In-Reply-To: <CADF0yp9RH9-_o9vfhe0mEX+g5acgXj50FUeAShc+OObBTD1ZjA@mail.gmail.com>
References: <CADF0yp9RH9-_o9vfhe0mEX+g5acgXj50FUeAShc+OObBTD1ZjA@mail.gmail.com>
Message-ID: <4F3A3903.10701@rabbitmq.com>

Hi mohammed,

On 14/02/12 09:22, mohammed zubeir wrote:
>   I am developing a python web crawler using RabbitMQ. The server sends
> list of urls to be crawled to client and he will send the results after
> crawling. My problem is that when client is processing the request and
> it dies suddenly all the information abt the request is lost. i.e.
> rabbitmq removes the message from queue when client takes a request. I
> want it to be relaible. Even if the client dies message should be
> available in message queue which can be allocated to some other client.
> Please reply asap.

The solution in this case is not to auto-ack messages when consuming.
Your client should acknowledge the message only after all processing is
complete. If the client dies then all unacknowledged messages will be
returned to the queue, so that another client can receive them.

If you also need to guard against broker failure then you should publish
the messages as persistent, mark the queue as durable and make use of
publisher confirms.



-Emile

From emile at rabbitmq.com  Tue Feb 14 10:42:37 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 14 Feb 2012 10:42:37 +0000
Subject: [rabbitmq-discuss] Rabbit Mq not workign in Windows 2007 server
 environment
In-Reply-To: <CALnUTWUS3VQAfQKuu5atsvMAWsf=CsUTS0J04johsuxd3wvX5A@mail.gmail.com>
References: <CALnUTWUS3VQAfQKuu5atsvMAWsf=CsUTS0J04johsuxd3wvX5A@mail.gmail.com>
Message-ID: <4F3A3A9D.9090602@rabbitmq.com>

Hi Joemon,

On 14/02/12 10:29, Joemon Varghese wrote:
>   I am developing a silverlight Application in which i am calling Rabbit
> mq from WCF layer.I have upgraded my server from Windows 2003 to windows
> 2007.
> and i have installed rabbit mq 2.7.1 version in my windows 2007
> server.Now the messages  are  not getting procesed .Its stuck up in the
> Queue.
> do i need to configure something in Rabbit MQ or from Windows side. ?

Can you confirm that PerfTest.exe or any of the other example
applications bundled with the .net client work? Can you validate that
any other WCF applications work correctly? Are there any entries in the
broker logfile or the eventlog?


-Emile

From zubeir.goku at gmail.com  Tue Feb 14 11:03:04 2012
From: zubeir.goku at gmail.com (mohammed zubeir)
Date: Tue, 14 Feb 2012 16:33:04 +0530
Subject: [rabbitmq-discuss] Help on RPC and Asynchronous Communication
Message-ID: <CADF0yp86r7Mn7Z2J2_u6zjQTmuN03BabSrF74gRE6zYAcNjE7g@mail.gmail.com>

Hi,

I am developing a python web crawler using RabbitMQ. The server sends list
of urls to be crawled to client and he will send the results after
crawling. My problem is that when client is processing the request and it
dies suddenly all the information abt the request is lost. i.e. rabbitmq
removes the message from queue when client takes a request. I want it to be
relaible. Even if the client dies message should be available in message
queue which can be allocated to some other client. *


I am doing crawling using RPC. I am using pika.blockingConnection. I want
to do the communication asynchronously* instead of blocking connection. It
would be better if you provide an example of Asynchronous communication
using RPC on rabbitmq website.


Thanks for UR help.



Hoping for a positive response on this issue.


-- 
*
*
*
*
*
*
*---------------------------------------*
Mohammed Zubeir.A.
AkaTsuKi
*---------------------------------------*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120214/324529d3/attachment.htm>

From ask at rabbitmq.com  Tue Feb 14 11:12:12 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Tue, 14 Feb 2012 11:12:12 +0000
Subject: [rabbitmq-discuss] Help on RPC and Asynchronous Communication
In-Reply-To: <CADF0yp86r7Mn7Z2J2_u6zjQTmuN03BabSrF74gRE6zYAcNjE7g@mail.gmail.com>
References: <CADF0yp86r7Mn7Z2J2_u6zjQTmuN03BabSrF74gRE6zYAcNjE7g@mail.gmail.com>
Message-ID: <A96C7CA6-B1E6-47B7-9E8F-73154EB55C13@rabbitmq.com>


On 14 Feb 2012, at 11:03, mohammed zubeir wrote:

> Hi,
> 
> I am developing a python web crawler using RabbitMQ. The server sends list of urls to be crawled to client and he will send the results after crawling. My problem is that when client is processing the request and it dies suddenly all the information abt the request is lost. i.e. rabbitmq removes the message from queue when client takes a request. I want it to be relaible. Even if the client dies message should be available in message queue which can be allocated to some other client. 
> 
> 
> I am doing crawling using RPC. I am using pika.blockingConnection. I want to do the communication asynchronously instead of blocking connection. It would be better if you provide an example of Asynchronous communication using RPC on rabbitmq website.
> 
> 

Writing an asynchronous application means that you should choose an async framework first.
There are many of these to choose from: eventlet, gevent, twisted, tornado and others.
We don't want the tutorials to bless any of them, and writing manual async code is very cumbersome.

There are many examples in the Pika source code repository:
https://github.com/pika/pika/tree/master/examples


From simon at rabbitmq.com  Tue Feb 14 13:24:10 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 Feb 2012 13:24:10 +0000
Subject: [rabbitmq-discuss] Possibly latency issues
In-Reply-To: <1329187663.5536.10.camel@samc-pc.wgtn.cat-it.co.nz>
References: <1328582743.2123.28.camel@samc-pc.wgtn.cat-it.co.nz>	<69CA5A89-1A5E-4EEB-9255-059264DB254E@ecollege.com>
	<1329187663.5536.10.camel@samc-pc.wgtn.cat-it.co.nz>
Message-ID: <4F3A607A.7070207@rabbitmq.com>

On 14/02/12 02:47, Sam Crawley wrote:
> Running this, I always get an average time (and I'm obviously only
> timing the reading of messages) of 0.04s. (FWIW, I get the same with our
> home grown client).
>
> Does it seem like there's something wrong here?

Yes. Very much so. I replicated your problem.

The problem is that the old version of librabbitmq that is embedded in 
Net::RabbitMQ does not disable Nagle's algorithm. (I assume your 
homebrew client also does not.)

Looking in wireshark we see that almost all of the delay happens after 
the basic.publish, when the TCP stack waits 0.04s (on my machine) for 
more data before *actually* sending the publish. Everything else is very 
fast in comparison, giving an almost perfect 25 msg/s for me.

I hacked in a call to setsockopt() to set TCP_NODELAY in amqp_socket.c, 
and now I get:

Longest request: 0.000537, Shortest Request: 0.000146
Mean Req time: 0

Which I think is more the performance you might be looking for. 
(Presumably the "mean req time" suffered underflow.)

The current version of librabbitmq sets TCP_NODELAY, so maybe 
Net::RabbitMQ should be updated? (CCing maintainer...)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Tue Feb 14 16:06:04 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 14 Feb 2012 16:06:04 +0000
Subject: [rabbitmq-discuss] Rabbitmq Stomp error
In-Reply-To: <CAMRGQbPOLn8hhYVcxLyz9vGJjDR98=yuqSDtA56F4xdDKVQuzQ@mail.gmail.com>
References: <CAMRGQbPOLn8hhYVcxLyz9vGJjDR98=yuqSDtA56F4xdDKVQuzQ@mail.gmail.com>
Message-ID: <3004778F-5CC1-430F-ABF3-B43D67732CA2@rabbitmq.com>

Ram,

It looks as though the mc-ping is negotiating a STOMP connection, but
RabbitMQ's-STOMP adapter doesn't seem to cope with checking the version; the
re:split() function may not exist in your version.

I'm not sure why this blows up -- but what version of Erlang are you running on?
My version prints out this in status:

{erlang_version, "Erlang R15B (erts-5.9) [source] [64-bit] [smp:8:8]
      [async-threads:30] [hipe] [kernel-poll:true]\n"}

From your output I guess you are running R12B-3, and although we (just about)
support that for the server, the STOMP adapter needs the later re:split/2 function,
which is available in R12B-5 onwards (I think).

I'm not sure what distribution of Linux you are using, but take a look at our
page http://www.rabbitmq.com/which-erlang.html which has links to the
distribution pages and advice about which Erlang version you need. (It doesn't
mention the STOMP adapter, though, I notice.)

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 7 Feb 2012, at 12:57, Ram Chander wrote:

> Hi,
> 
>  I have configured rabbitmq+mcollective on a host with stomp. I see below error when tried to mc-ping.  Any idea on what could be the issue ? Or is there a better way to setup mcollective with rabbitmq.
> 
> # mc-ping 
> /usr/sbin/mc-ping failed to run: incompatible marshal file format (can't be read)
>     format version 4.8 required; 89.111 given (TypeError)
> 
> # less /var/log/rabbitmq/rabbit at ops-build-1.log 
> 
> =ERROR REPORT==== 7-Feb-2012::18:21:54 ===
> STOMP error frame sent:
> Message: "Processing error"
> Detail: "Processing error\n"
> Server private detail: {undef,
>                            [{re,split,["1.0",",",[{return,list}]]},
>                             {rabbit_stomp_processor,negotiate_version,1},
>                             {rabbit_stomp_processor,
>                                 '-process_connect/3-fun-0-',6},
>                             {rabbit_stomp_processor,process_request,3},
>                             {gen_server2,handle_msg,2},
>                             {proc_lib,init_p,5}]}
> 
> 
> # rabbitmqctl status
> 
> Status of node 'rabbit at ops-build-1' ...
> [{pid,29332},
>  {running_applications,
>      [{rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","2.7.1"},
>       {rabbit,"RabbitMQ","2.7.1"},
>       {mnesia,"MNESIA  CXC 138 12","4.4.3"},
>       {os_mon,"CPO  CXC 138 46","2.1.6"},
>       {sasl,"SASL  CXC 138 11","2.1.5.3"},
>       {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
>       {stdlib,"ERTS  CXC 138 10","1.15.3"},
>       {kernel,"ERTS  CXC 138 10","2.12.3"}]},
>  {os,{unix,linux}},
>  {erlang_version,
>      "Erlang (BEAM) emulator version 5.6.3 [source] [64-bit] [smp:8] [async-threads:30] [kernel-poll:true]\n"},
>  {memory,
>      [{total,32028218},
>       {processes,10076904},
>       {processes_used,10070256},
>       {system,21951314},
>       {atom,1068057},
>       {atom_used,1054149},
>       {binary,64614},
>       {code,11843405},
>       {ets,742608}]},
>  {vm_memory_high_watermark,0.39999999995230406},
>  {vm_memory_limit,3354584678}]
> ...done.
> 
> # dpkg -l |grep stomp
> ii  libstomp-ruby                        1.0.4-3~bpo50+1            Ruby bindings for the stomp messaging protoc
> ii  libstomp-ruby1.8                     1.0.4-3~bpo50+1            Ruby 1.8 bindings for the stomp messaging pr
> ii  libstomp-ruby1.9.1                   1.0.4-3~bpo50+1            Ruby 1.9.1 bindings for the stomp messaging 
> 
> 
> Regards,
> Ram
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tonygarnockjones+rabbitmq at gmail.com  Tue Feb 14 17:13:31 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 14 Feb 2012 12:13:31 -0500
Subject: [rabbitmq-discuss] STOMP doesn't include the routing-key on
	MESSAGE frames
In-Reply-To: <CAM8fPiQe4nZGdwPvmYae=YtA6ruN96TedYNLOHpQBcxo9niQOg@mail.gmail.com>
References: <CAM8fPiQe4nZGdwPvmYae=YtA6ruN96TedYNLOHpQBcxo9niQOg@mail.gmail.com>
Message-ID: <CAM8fPiRDo_i=qTQSMOfQGqTg1YBbAZQtNfBqXn1bhnY-_E7LYg@mail.gmail.com>

No comments on this?

On 10 February 2012 10:56, Tony Garnock-Jones
<tonygarnockjones+rabbitmq at gmail.com> wrote:
> Hi all,
>
> Attempting to use the STOMP adapter the other day I discovered an
> oversight in the new design: the AMQP routing key is no longer
> propagated into outgoing MESSAGE frames. This stopped my application
> from working.
>
> Here's a patch (obviously crude, e.g. doesn't define a
> ?HEADER_ROUTING_KEY macro or anything) that causes the routing_key to
> be sent along:
>
> diff -r 3be0091c6401 src/rabbit_stomp_util.erl
> --- a/src/rabbit_stomp_util.erl Wed Feb 08 15:53:59 2012 +0000
> +++ b/src/rabbit_stomp_util.erl Fri Feb 10 10:53:21 2012 -0500
> @@ -78,9 +78,11 @@
>
> ?message_headers(Destination, SessionId,
> ? ? ? ? ? ? ? ? #'basic.deliver'{consumer_tag = ConsumerTag,
> - ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? delivery_tag = DeliveryTag},
> + ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? delivery_tag = DeliveryTag,
> + ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? routing_key = RoutingKey},
> ? ? ? ? ? ? ? ? Props = #'P_basic'{headers ? ? ? = Headers}) ->
> ? ? Basic = [{?HEADER_DESTINATION, Destination},
> + ? ? ? ? ? ? {"amqp-routing-key", binary_to_list(RoutingKey)},
> ? ? ? ? ? ? ?{?HEADER_MESSAGE_ID,
> ? ? ? ? ? ? ? create_message_id(ConsumerTag, SessionId, DeliveryTag)}],
>
>
> I'd be very happy to see this included into the master branch of the
> STOMP adapter.
>
> Regards,
> ?Tony
> --
> Tony Garnock-Jones
> tonygarnockjones at gmail.com
> http://homepages.kcbbs.gen.nz/tonyg/



-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/

From Jim.Langston at compuware.com  Tue Feb 14 18:27:22 2012
From: Jim.Langston at compuware.com (Langston, Jim)
Date: Tue, 14 Feb 2012 18:27:22 +0000
Subject: [rabbitmq-discuss] rabbitMQ management tool not showing messages
	delivered
Message-ID: <CB60119E.113DB%jim.langston@compuware.com>

Hi all,

I'm scratching on this one ?

I have 4 queues, 8 RMQ server cluster, in the browser for management, I see for
the queues, all their names, status is active on all of them, they are showing
about 7K of incoming message rates. On three of the queues deliver/get is
displaying about 7K as well, that is, except for one queue, which is showing 0.
Yet, the messages are getting to the applications from that queue.

This is the same for all the RMQ server mgmt pages.

I'm not sure why I'm seeing 0 for that one queue even though the application
is not bothered as the queue is not building up and the messages are getting
through.

Jim




http://www.compuware.com/
The contents of this e-mail are intended for the named addressee only. It contains information that may be confidential. Unless you are the named addressee or an authorized designee, you may not copy or use it, or disclose it to anyone else. If you received it in error please notify us immediately and then destroy it.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120214/9f58ce80/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: CPWRsig_04_11-03-2010.jpg
Type: image/jpeg
Size: 9440 bytes
Desc: CPWRsig_04_11-03-2010.jpg
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120214/9f58ce80/attachment.jpg>

From kot.begemot at gmail.com  Tue Feb 14 20:40:05 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Tue, 14 Feb 2012 12:40:05 -0800
Subject: [rabbitmq-discuss] Active/Active: shutdown of one service
 brings down the cluster
In-Reply-To: <4F3951E8.5090305@rabbitmq.com>
References: <CAFWGgNHb9bjDPiW5uR9upBug-eaR2k8nYxhi8TN-vZwA419e1A@mail.gmail.com>
	<4F33BA32.100@rabbitmq.com>
	<CAFWGgNHcqkpE72WTVw8yxsQssgvs+ETNcNx-dby2NbkuqKv8Kg@mail.gmail.com>
	<4F3951E8.5090305@rabbitmq.com>
Message-ID: <CAFWGgNECgZECqXY9L2ysR=mkiU8tBwWN+TAFsGjC_sGWpixtUg@mail.gmail.com>

Hi Simon,

Thanks for looking into the logs. Since we fixed channel leak in our
application we do not experience any problems anymore.

Regarding transient queues in HA. I am just not sure how system would
behave when non-HA queue is declared in a cluster environment.
Documentation describes in great details what happen to mirrored queues but
I can't find anything about non-ha queue in HA cluster. Queue will be
created on a single server, and application should be ready to re-declare
queue in case of failover. So far so good. But how does it work with load
balancer? When request is made against a server which does not have a given
queue, will the cluster "know" where the queue is and proxy the request to
the proper server?

Thanks,
Vadim.

On Mon, Feb 13, 2012 at 10:09 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 10/02/12 00:20, Vadim Chekan wrote:
>
>> I think we nailed down a problem. We had a channel leak in our
>> application. With ~50 connections we had >90 channels per connection and
>> growing. This definitely correlates to high CPU usage.
>>
>> What I still do not understand either it triggered rabbit into unstable
>> state or it was something else. Maybe increasing latencies in message
>> handling triggered cluster members into flipping neighbor aliveness
>> status back and force? Just speculating here: could timeouts because of
>> high load cause network fragmentation, when every node temporally does
>> not see neighbors, becomes a master, than see a neighbor, freak out, etc?
>>
>
> That's plausible, but I don't think that's what's happening (there's
> nothing about network partitioning in the logs).
>
>
>  I've attached logs from all 3 cluster members. They are polluted with
>> load balancer "ping".
>>
>
> Thanks. I've had a poke at this but nothing is leaping out at me yet. I'll
> keep at it though.
>
> One thing that's a bit odd: you seem to be creating HA / transient /
> autodelete / exclusive queues. So although they're "HA", they will vanish
> if any of the following happens:
>
> * The entire cluster goes down (transient) or
> * All consumers for a queue cancel (autodelete) or
> * The connection that created them closes (exclusive)
>
> Is this intentional? It seems like an odd use of HA.
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 

From jerryk at vmware.com  Tue Feb 14 20:45:17 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 14 Feb 2012 12:45:17 -0800 (PST)
Subject: [rabbitmq-discuss] Active/Active: shutdown of one service
	brings down the cluster
In-Reply-To: <CAFWGgNECgZECqXY9L2ysR=mkiU8tBwWN+TAFsGjC_sGWpixtUg@mail.gmail.com>
Message-ID: <9bbc35d6-d480-4c64-a173-b73778fbc8f9@CoachZ.local>

Hi, Vadim:

A client doesn't need to be connected directly to the node on which
a queue and its attendant Erlang process reside.  If your load balancer
sends you to any live node in the cluster you can consume from the queue
of your choice, as long as it's still alive.

Note that you can't straightforwardly redeclare a queue that had been on
a node that's gone down.  The cluster's metadata will still know about it
and prevent you from redeclaring it.  This is intentional, to avoid the
confusion that would result if you succeeded at the redeclare, a new
queue of the same name and properties came into existence on another node,
and then the original, downed node came back up in the cluster...

Best regards,
Jerry

----- Original Message -----
From: "Vadim Chekan" <kot.begemot at gmail.com>
To: "Simon MacMullen" <simon at rabbitmq.com>, ghanna at verticalsearchworks.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, February 14, 2012 12:40:05 PM
Subject: Re: [rabbitmq-discuss] Active/Active: shutdown of one service brings down the cluster


Hi Simon, 

Thanks for looking into the logs. Since we fixed channel leak in our application we do not experience any problems anymore. 

Regarding transient queues in HA. I am just not sure how system would behave when non-HA queue is declared in a cluster environment. Documentation describes in great details what happen to mirrored queues but I can't find anything about non-ha queue in HA cluster. Queue will be created on a single server, and application should be ready to re-declare queue in case of failover. So far so good. But how does it work with load balancer? When request is made against a server which does not have a given queue, will the cluster "know" where the queue is and proxy the request to the proper server? 

Thanks, 
Vadim. 


On Mon, Feb 13, 2012 at 10:09 AM, Simon MacMullen < simon at rabbitmq.com > wrote: 



On 10/02/12 00:20, Vadim Chekan wrote: 


I think we nailed down a problem. We had a channel leak in our 
application. With ~50 connections we had >90 channels per connection and 
growing. This definitely correlates to high CPU usage. 

What I still do not understand either it triggered rabbit into unstable 
state or it was something else. Maybe increasing latencies in message 
handling triggered cluster members into flipping neighbor aliveness 
status back and force? Just speculating here: could timeouts because of 
high load cause network fragmentation, when every node temporally does 
not see neighbors, becomes a master, than see a neighbor, freak out, etc? 

That's plausible, but I don't think that's what's happening (there's nothing about network partitioning in the logs). 




I've attached logs from all 3 cluster members. They are polluted with 
load balancer "ping". 

Thanks. I've had a poke at this but nothing is leaping out at me yet. I'll keep at it though. 

One thing that's a bit odd: you seem to be creating HA / transient / autodelete / exclusive queues. So although they're "HA", they will vanish if any of the following happens: 

* The entire cluster goes down (transient) or 
* All consumers for a queue cancel (autodelete) or 
* The connection that created them closes (exclusive) 

Is this intentional? It seems like an odd use of HA. 

Cheers, Simon 



-- 
Simon MacMullen 
RabbitMQ, VMware 



-- 

From cshtreck at yahoo.com  Tue Feb 14 20:51:01 2012
From: cshtreck at yahoo.com (Charles)
Date: Tue, 14 Feb 2012 12:51:01 -0800 (PST)
Subject: [rabbitmq-discuss] SSL between cluster hosts supported ?
Message-ID: <1329252661.74648.YahooMailNeo@web36203.mail.mud.yahoo.com>

Hello,

I've got rabbitmq 2.7.1 w/ Erlang R15B and I'd like to know if encrypted/ssl ?sessions between rabbit hosts in a cluster is supported.
I'd appreciate a link to any docs on how to configure that.?
SSL from client to server is working btw.

Thanks,
CM

From samc at catalyst.net.nz  Tue Feb 14 22:39:05 2012
From: samc at catalyst.net.nz (Sam Crawley)
Date: Wed, 15 Feb 2012 11:39:05 +1300
Subject: [rabbitmq-discuss] Possibly latency issues
In-Reply-To: <4F3A607A.7070207@rabbitmq.com>
References: <1328582743.2123.28.camel@samc-pc.wgtn.cat-it.co.nz>
	<69CA5A89-1A5E-4EEB-9255-059264DB254E@ecollege.com>
	<1329187663.5536.10.camel@samc-pc.wgtn.cat-it.co.nz>
	<4F3A607A.7070207@rabbitmq.com>
Message-ID: <1329259145.6607.2.camel@samc-pc.wgtn.cat-it.co.nz>

Thanks, that certainly seems to have done the trick!

On Tue, 2012-02-14 at 13:24 +0000, Simon MacMullen wrote:
> On 14/02/12 02:47, Sam Crawley wrote:
> > Running this, I always get an average time (and I'm obviously only
> > timing the reading of messages) of 0.04s. (FWIW, I get the same with our
> > home grown client).
> >
> > Does it seem like there's something wrong here?
> 
> Yes. Very much so. I replicated your problem.
> 
> The problem is that the old version of librabbitmq that is embedded in 
> Net::RabbitMQ does not disable Nagle's algorithm. (I assume your 
> homebrew client also does not.)
> 
> Looking in wireshark we see that almost all of the delay happens after 
> the basic.publish, when the TCP stack waits 0.04s (on my machine) for 
> more data before *actually* sending the publish. Everything else is very 
> fast in comparison, giving an almost perfect 25 msg/s for me.
> 
> I hacked in a call to setsockopt() to set TCP_NODELAY in amqp_socket.c, 
> and now I get:
> 
> Longest request: 0.000537, Shortest Request: 0.000146
> Mean Req time: 0
> 
> Which I think is more the performance you might be looking for. 
> (Presumably the "mean req time" suffered underflow.)
> 
> The current version of librabbitmq sets TCP_NODELAY, so maybe 
> Net::RabbitMQ should be updated? (CCing maintainer...)
> 
> Cheers, Simon
> 



From jon at jbrisbin.com  Tue Feb 14 22:42:54 2012
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 14 Feb 2012 16:42:54 -0600 (CST)
Subject: [rabbitmq-discuss] Updated rebar-friendly port of rabbit_common
In-Reply-To: <446bcee5-4679-4fa4-9e8f-b5ec69908818@jbrisbin.local>
Message-ID: <716c948f-d6c5-4cc7-8f40-1e5792a1e4f7@jbrisbin.local>

I've updated to 2.7.1 the rebar-friendly port of rabbit_common, which is the main dependency needed by the rebar-friendly amqp_client and a number of plugins.

Thanks to a report from a user, I've also created a branch that makes slight tweaks to the source code to get it to compile cleanly under more strict rebar compile options.

The problem is basically that, for projects that have strict compile settings, the rabbit_common dependency was breaking their build because the unaltered rabbitmq-server code does not compile cleanly using rebar and the following options:

{erl_opts, [
  debug_info, 
  compressed, 
  report, 
  warn_export_all, 
  warn_export_vars, 
  warn_shadow_vars, 
  warn_unused_function, 
  warn_deprecated_function, 
  warn_obsolete_guard, 
  warn_unused_import, 
  warnings_as_errors
]}.

The "community" branch reflects the few tweaks necessary to get the unaltered source code to compile cleanly.

https://github.com/jbrisbin/rabbit_common


Thanks! 

Jon Brisbin 
http://about.me/jbrisbin 
http//jbrisbin.com 


From mpietrek at skytap.com  Tue Feb 14 23:07:16 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 14 Feb 2012 15:07:16 -0800
Subject: [rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03
	performance
Message-ID: <CB602924.2DF9C%mpietrek@skytap.com>

I'm looking to squeeze every last bit of message throughput out of our
mirrored queue setup. I max out at 36 messages/sec when writing. (Yes, we
use transactions, and we know it's not optimal, but we're valuing high
reliability over speed. Our clients and/or servers could go away at any
moment, so things like Publisher-acknowledge are nice, but take away from
the fundamental disaster hardness.)

Anyhow, we're running on Ubuntu 10.04 with 2.71 and the default Erlang
install. This gives us R13B03 as the Erlang version.

Question: Does anybody (and particularly the RabbitMQ folks) have any input
on what sort of perf improvements we might get by switching to a newer
Erlang Version?

Obviously every situation is different, but before going down this road, I'd
like an idea of the order of magnitude of message rate improvements that
people have seen. That is, are they closer to 5%, 50% or 500%? (500% is
obviously a fantasy, but you get the idea.)

Thanks,

Matt





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120214/dd7d0925/attachment.htm>

From mpietrek at skytap.com  Tue Feb 14 23:14:54 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 14 Feb 2012 15:14:54 -0800
Subject: [rabbitmq-discuss] High volume message consumption slows down
 consistently over time when using Pika and transactions
In-Reply-To: <4F351CC4.9080302@rabbitmq.com>
Message-ID: <CB602A32.2E024%mpietrek@skytap.com>

Gavin,

Just wanted to follow up on this thread and gently inquire if you've had
time to look at Emile's resource leak finding?


I understand you're probably busy with other more important things. I'm
just trying to get a sense of whether I need to keep digging into this
problem, or if you're already reasonably confident that it's something on
the Pika side of things.

Thanks much,

Matt


On 2/10/12 5:33 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:

>
>Hi Matt,
>
>Thanks for reporting this. I've been able to reproduce the problem with
>a non-mirrorred queue on a single node, using Pika. However I can't
>reproduce the problem using the Java client, so this looks like a
>possible resource leak in the Pika client. I'll report this to the Pika
>maintainer.
>
>
>-Emile
>
>
>On 03/02/12 21:48, Matt Pietrek wrote:
>> I'm writing some basic throughput tests to verify that RabbitMQ will
>> scale to our needs in HA environments. In one scenario I'm finding that
>> consuming messages as quickly as possible slows down consistently over
>>time.
>> 
>> My environment:
>> 
>>   * Ubuntu 10.04 with RabbitMQ 2.71.
>>   * Erlang R13B03
>>   * Broker instances are all disk nodes on a dedicated VM running
>>     nothing else.
>>   * Queues are declared as durable and x-ha-policy:all
>>   * Clients are written in Python using Pika 0.9.5.
>>   * For this test a single broker is used, but I have the same effect
>>     with mirrored queues.
>> 
>> The test code is extremely simple. It simply reads or writes messages
>> (up to 100,000) as quickly as it can, and shows the throughput rate at
>> 1000 message intervals.
>> 
>> I've noticed that when I use transactions with basic_ack, e.g.
>> 
>>         channel.tx_select()
>>         channel.basic_ack(delivery_tag=tag)
>>         channel.tx_commit()
>> 
>> that the rate I can consume messages drops steadily. Each time I restart
>> my reading app with a full queue, I see a consistent slowdown in my rate
>> as measured every 1000 messages:
>> 
>> (Rate for last 1000 messages | Average rate for all messages since app
>> start)
>> Read 597.502915814 messages/sec | Average: 597.502915814
>> Read 431.665048642 messages/sec | Average: 501.222607245
>> Read 447.932745586 messages/sec | Average: 482.104211325
>> Read 377.776468153 messages/sec | Average: 450.969014032
>> Read 394.784579872 messages/sec | Average: 438.488176956
>> Read 346.943823897 messages/sec | Average: 420.01726691
>> Read 301.813628274 messages/sec | Average: 397.762754973
>> Read 313.625720320 messages/sec | Average: 384.856956366
>> Read 266.972510375 messages/sec | Average: 366.858074188
>> Read 254.247975169 messages/sec | Average: 351.298554027
>> Read 251.812483302 messages/sec | Average: 339.118646053
>> Read 246.701903922 messages/sec | Average: 328.85271509
>> Read 222.953957109 messages/sec | Average: 317.260966009
>> 
>> If I simply remove the tx_select()/tx_commit, the rate stays reasonably
>> stable:
>> 
>> (Rate for last 1000 messages | Average rate for all messages since app
>>start
>> Read 1228.77445722 messages/sec | Average: 1343.23656881
>> Read 1063.88750879 messages/sec | Average: 1235.13209738
>> Read 1368.73427666 messages/sec | Average: 1266.02631056
>> Read 1423.23835115 messages/sec | Average: 1294.62742565
>> Read 1438.56741702 messages/sec | Average: 1316.58317701
>> Read 1393.69714404 messages/sec | Average: 1327.07283563
>> Read 991.831277598 messages/sec | Average: 1273.27648897
>> Read 1097.96119586 messages/sec | Average: 1251.08044697
>> Read 1174.27676294 messages/sec | Average: 1242.95091463
>> Read 1307.42368241 messages/sec | Average: 1248.54813715
>> Read 1491.50216641 messages/sec | Average: 1265.7295908
>> 
>> One thing I have noticed is that in my client app machine, the CPU
>> percentage generally climbs over time, with the occasional brief drop
>> back to a prior %. This might point to a Pika issue in the transaction
>> related code, but it's not obvious to me from inspection of the code if
>>so.
>> 
>> Here's the relevant snippets of my code:
>> 
>> def do_read(clientlib):
>>     for i in range(100000):
>>         _, ack_info = clientlib.read_message(QUEUENAME)
>>         if ack_info == None:
>>             print "No messages to read - Exiting"
>>             return
>>         clientlib.acknowledge_message(ack_info)
>> 
>> 
>> class Clientlib
>>     def connect(self, hostname, use_transactions):
>>         self.connection =
>> pika.BlockingConnection(pika.ConnectionParameters(host=hostname,
>>port=5672))
>>         self.channel = self.connection.channel()
>>         self.use_transactions = use_transactions
>> 
>>     def read_message(self, queue_name):
>>         method_frame, _, body = self.channel.basic_get(queue=queue_name)
>>         return body, (self.channel, method_frame.delivery_tag)
>> 
>>     def acknowledge_message(self, acknowledge_info):
>>         channel = acknowledge_info[0]
>>         tag = acknowledge_info[1]
>> 
>>         if self.use_transactions:
>>             channel.tx_select()
>> 
>>         channel.basic_ack(delivery_tag=tag)
>> 
>>         if self.use_transactions:
>>             channel.tx_commit()



From majek04 at gmail.com  Wed Feb 15 09:51:44 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 15 Feb 2012 09:51:44 +0000
Subject: [rabbitmq-discuss] SSL between cluster hosts supported ?
In-Reply-To: <1329252661.74648.YahooMailNeo@web36203.mail.mud.yahoo.com>
References: <1329252661.74648.YahooMailNeo@web36203.mail.mud.yahoo.com>
Message-ID: <CABzX+qz2gb9gCg9SJzy7JH-T-sKLs_RCrqKaXJx3tCuKznK5Kg@mail.gmail.com>

On Tue, Feb 14, 2012 at 20:51, Charles <cshtreck at yahoo.com> wrote:
> I've got rabbitmq 2.7.1 w/ Erlang R15B and I'd like to know if encrypted/ssl ?sessions between rabbit hosts in a cluster is supported.
> I'd appreciate a link to any docs on how to configure that.
> SSL from client to server is working btw.

RabbitMQ clustering uses built-in Erlang clustering mechanisms.

As far as I know, erlang clustering doesn't allow have any
encryption support. Google says:

    http://www.trapexit.org/Distributed_erlang_using_ssl_through_firewalls

and

  http://stackoverflow.com/a/891058/496285

So basically, you can hack erlang or do it on the IP layer. Both options
are nontrivial.

Marek

From majek04 at gmail.com  Wed Feb 15 09:57:16 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 15 Feb 2012 09:57:16 +0000
Subject: [rabbitmq-discuss] SSL between cluster hosts supported ?
In-Reply-To: <CABzX+qz2gb9gCg9SJzy7JH-T-sKLs_RCrqKaXJx3tCuKznK5Kg@mail.gmail.com>
References: <1329252661.74648.YahooMailNeo@web36203.mail.mud.yahoo.com>
	<CABzX+qz2gb9gCg9SJzy7JH-T-sKLs_RCrqKaXJx3tCuKznK5Kg@mail.gmail.com>
Message-ID: <CABzX+qw+bTthyDQad9vMpR8ju0yk21EdQ=zCjAUYFAwfEv=qFw@mail.gmail.com>

On Wed, Feb 15, 2012 at 09:51, Marek Majkowski <majek04 at gmail.com> wrote:
> On Tue, Feb 14, 2012 at 20:51, Charles <cshtreck at yahoo.com> wrote:
>> I've got rabbitmq 2.7.1 w/ Erlang R15B and I'd like to know if encrypted/ssl ?sessions between rabbit hosts in a cluster is supported.
>> I'd appreciate a link to any docs on how to configure that.
>> SSL from client to server is working btw.
>
> RabbitMQ clustering uses built-in Erlang clustering mechanisms.
>
> As far as I know, erlang clustering doesn't allow have any
> encryption support. Google says:
>
> ? ?http://www.trapexit.org/Distributed_erlang_using_ssl_through_firewalls
>
> and
>
> ?http://stackoverflow.com/a/891058/496285
>
> So basically, you can hack erlang or do it on the IP layer. Both options
> are nontrivial.

I'm wrong. There's a third, built-in, thing:

   http://www.erlang.org/doc/apps/ssl/ssl_distribution.html

But I'm afraid I don't have much expertise in that.

Marek

From simon at rabbitmq.com  Wed Feb 15 10:08:53 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 Feb 2012 10:08:53 +0000
Subject: [rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03
 performance
In-Reply-To: <CB602924.2DF9C%mpietrek@skytap.com>
References: <CB602924.2DF9C%mpietrek@skytap.com>
Message-ID: <4F3B8435.2040401@rabbitmq.com>

On 14/02/12 23:07, Matt Pietrek wrote:
> I'm looking to squeeze every last bit of message throughput out of our
> mirrored queue setup.

Hi Matt.

> I max out at 36 messages/sec when writing. (Yes,
> we use transactions, and we know it's not optimal, but we're valuing
> high reliability over speed. Our clients and/or servers could go away at
> any moment, so things like Publisher-acknowledge are nice, but take away
> from the fundamental disaster hardness.)
>
> Anyhow, we're running on Ubuntu 10.04 with 2.71 and the default Erlang
> install. This gives us R13B03 as the Erlang version.
>
> Question: Does anybody (and particularly the RabbitMQ folks) have any
> input on what sort of perf improvements we might get by switching to a
> newer Erlang Version?

Not much really. We haven't tested extensively but if you got 5% I think 
you would consider yourself lucky.

However, 36 msg/s is *really* slow.

Although mirrored queues are slower than normal ones I would still hope 
you could stick a couple of zeroes on the end of that figure. So I 
suspect you are not actually CPU bound at the server.

I assume when you say "using transactions" you mean publishing a single 
message per transaction? In that case you are incurring the cost of a 
network round trip and an fsync() on each publish, and I suspect that is 
what is killing your performance.

If I had to guess I would suspect the fsync is the worst of the problem. 
Assuming the 36 msg/s is from some test app, you might want to remove 
the tx.select and replace the tx.commit with some meaningless 
synchronous request (basic.qos is a favourite) and see what happens to 
your message rate. If it shoots up, the fsync is the problem. If it 
doesn't, the network round trip is.

When you have the answer to that, you know whether you're going to want 
to spend money on fancy networking hardware or SSDs...

Of course, *really* I would suggest you need to be publishing more 
messages per round-trip / fsync. So either batch multiple publishes into 
a transaction or start using confirms instead. I know you say that they 
"take away from the fundamental disaster hardness" but I'm not sure I 
understand what you mean by that. Both confirms and tx give you a way to 
know when a given message is definitely on disc. And in fact tx is 
implemented in terms of confirms these days.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Feb 15 10:13:54 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 Feb 2012 10:13:54 +0000
Subject: [rabbitmq-discuss] rabbitMQ management tool not showing
 messages delivered
In-Reply-To: <CB60119E.113DB%jim.langston@compuware.com>
References: <CB60119E.113DB%jim.langston@compuware.com>
Message-ID: <4F3B8562.8030502@rabbitmq.com>

On 14/02/12 18:27, Langston, Jim wrote:
> I'm scratching on this one ?
>
> I have 4 queues, 8 RMQ server cluster, in the browser for management, I
> see for
> the queues, all their names, status is active on all of them, they are
> showing
> about 7K of incoming message rates. On three of the queues deliver/get is
> displaying about 7K as well, that is, except for one queue, which is
> showing 0.
> Yet, the messages are getting to the applications from that queue.
>
> This is the same for all the RMQ server mgmt pages.
>
> I'm not sure why I'm seeing 0 for that one queue even though the application
> is not bothered as the queue is not building up and the messages are getting
> through.

Hi Jim. Two possibilities spring to mind:

1) Is the management agent running on all nodes in the cluster? If it's 
not installed on any node, any activity on that node will not be counted.

2) Is that queue consumed from by clients that open and close very short 
lived channels? There's a longstanding bug / lacking feature in mgmt 
that short-lived channels do not contribute to statistics.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From santosh at appfirst.com  Wed Feb 15 01:37:48 2012
From: santosh at appfirst.com (Santosh Thammana)
Date: Tue, 14 Feb 2012 20:37:48 -0500
Subject: [rabbitmq-discuss] rabbitmq restarted in bad state
Message-ID: <CAMu_-sFjWd7aHYxYJdCrkJaA9Vaxr6QfcNbWHWaySHjcweaQ8Q@mail.gmail.com>

Hello,

I had some issues with RabbitMQ, and had to restart it.  The issue was that
the queue sizes were remaining constant, despite there being producers and
consumers.  But after restarting, I am unable to create a few of my queues.

I am using Pika, and I get the error:
ChannelClosed: Channel.Close(class_id = 50, method_id = 10, reply_code =
404, reply_text = "NOT_FOUND - no queue 'collector.be2' in vhost '/'")

I get the same error if I then try to delete it.
We noticed that the queue is still bound to the default exchange.  So, it
seems like that's causing the strange behavior.  And I can't delete a
default binding.  Is there any way to solve this problem without restarting
RabbitMQ?  If I do have to restart RabbitMQ, can I expect it to be in a
proper state?  I noticed that at least one of the queues I had issues with
was declared as durable.  I'm not sure if that impacted this negatively.

Thank you!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120214/d171a651/attachment.htm>

From simon at rabbitmq.com  Wed Feb 15 10:19:12 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 Feb 2012 10:19:12 +0000
Subject: [rabbitmq-discuss] rabbitmq restarted in bad state
In-Reply-To: <CAMu_-sFjWd7aHYxYJdCrkJaA9Vaxr6QfcNbWHWaySHjcweaQ8Q@mail.gmail.com>
References: <CAMu_-sFjWd7aHYxYJdCrkJaA9Vaxr6QfcNbWHWaySHjcweaQ8Q@mail.gmail.com>
Message-ID: <4F3B86A0.90602@rabbitmq.com>

On 15/02/12 01:37, Santosh Thammana wrote:
> Hello,
>
> I had some issues with RabbitMQ, and had to restart it.  The issue was
> that the queue sizes were remaining constant, despite there being
> producers and consumers.  But after restarting, I am unable to create a
> few of my queues.
>
> I am using Pika, and I get the error:
> ChannelClosed: Channel.Close(class_id = 50, method_id = 10, reply_code =
> 404, reply_text = "NOT_FOUND - no queue 'collector.be2' in vhost '/'")

The only way to get a NOT_FOUND when declaring a queue is if the queue 
has previously been declared on a cluster node which is currently down. 
Does that describe your situation?

> I get the same error if I then try to delete it.
> We noticed that the queue is still bound to the default exchange.  So,
> it seems like that's causing the strange behavior.  And I can't delete a
> default binding.

The default binding should not prevent you from declaring the queue.

>  Is there any way to solve this problem without
> restarting RabbitMQ?  If I do have to restart RabbitMQ, can I expect it
> to be in a proper state?  I noticed that at least one of the queues I
> had issues with was declared as durable.  I'm not sure if that impacted
> this negatively.

I think they would all have to be durable.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Jim.Langston at compuware.com  Wed Feb 15 12:42:49 2012
From: Jim.Langston at compuware.com (Langston, Jim)
Date: Wed, 15 Feb 2012 12:42:49 +0000
Subject: [rabbitmq-discuss] rabbitMQ management tool not showing
 messages delivered
In-Reply-To: <4F3B8562.8030502@rabbitmq.com>
Message-ID: <CB611246.11508%jim.langston@compuware.com>

Thanks Simon, 

I will double check ..

Jim

On 2/15/12 5:13 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

>On 14/02/12 18:27, Langston, Jim wrote:
>> I'm scratching on this one ?
>>
>> I have 4 queues, 8 RMQ server cluster, in the browser for management, I
>> see for
>> the queues, all their names, status is active on all of them, they are
>> showing
>> about 7K of incoming message rates. On three of the queues deliver/get
>>is
>> displaying about 7K as well, that is, except for one queue, which is
>> showing 0.
>> Yet, the messages are getting to the applications from that queue.
>>
>> This is the same for all the RMQ server mgmt pages.
>>
>> I'm not sure why I'm seeing 0 for that one queue even though the
>>application
>> is not bothered as the queue is not building up and the messages are
>>getting
>> through.
>
>Hi Jim. Two possibilities spring to mind:
>
>1) Is the management agent running on all nodes in the cluster? If it's
>not installed on any node, any activity on that node will not be counted.
>
>2) Is that queue consumed from by clients that open and close very short
>lived channels? There's a longstanding bug / lacking feature in mgmt
>that short-lived channels do not contribute to statistics.
>
>Cheers, Simon
>
>-- 
>Simon MacMullen
>RabbitMQ, VMware
>
http://www.compuware.com/
The contents of this e-mail are intended for the named addressee only. It contains information that may be confidential. Unless you are the named addressee or an authorized designee, you may not copy or use it, or disclose it to anyone else. If you received it in error please notify us immediately and then destroy it.

>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From aloroi18 at gmail.com  Wed Feb 15 14:35:00 2012
From: aloroi18 at gmail.com (Bamboula)
Date: Wed, 15 Feb 2012 06:35:00 -0800 (PST)
Subject: [rabbitmq-discuss] Shuting down and reopening the consumer's side
Message-ID: <33329194.post@talk.nabble.com>


Hello all,

I'm working on a little project using RabbitMQ with .net C#.
I want to demonstrate that if I send a message to a queue and there is no
consumer, the message stays stocked in the queue.

In order to start with an easy example, I decided to demonstrate this with
an easy example as "Hello world" (in the RabbitMQ tutorials).

1)I build a Producer form, with a TextBox and a button to send the message
and also to open a consumer form:

using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using HelloWorldRabbitMQ;

namespace HelloWorldRabbitMQ2
{
    public partial class ProducerForm : Form
    {
        public int count = 0;
        public string HOST_NAME = "localhost";
        public string QUEUE_NAME = "helloWorld";

        private Producer producer;

        public ProducerForm()
        {
            InitializeComponent();
            //create the producer
            producer = new Producer(HOST_NAME, QUEUE_NAME);

        }

        //Send the message on click
        private void button1_Click(object sender, EventArgs e)
        {
            count++;
            if (count<2)
            {
                ConsumerForm cf = new ConsumerForm();
                cf.Show();
            }

           
producer.SendMessage(System.Text.Encoding.UTF8.GetBytes(textBox1.Text));
        }

    }
}

2)Here is the Producer class:

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using RabbitMQ.Client;

namespace HelloWorldRabbitMQ
{
    class Producer:IDisposable
    {
        protected IModel Model;  

        protected IConnection Connection;  

         protected string QueueName;  

    

         public Producer(string hostName, string queueName)  

         {  

             QueueName = queueName;  

             var connectionFactory = new ConnectionFactory();  

             connectionFactory.HostName = hostName;  

             Connection = connectionFactory.CreateConnection();  

             Model = Connection.CreateModel();  

             Model.QueueDeclare(QueueName, false, false, false, null);  

         }  

    

         public void SendMessage(byte[] message)  

         {  

             IBasicProperties basicProperties =
Model.CreateBasicProperties();  

             Model.BasicPublish("", QueueName, basicProperties , message);  

         }  

         public void Dispose()  

         {  

             if (Connection != null)  

                 Connection.Close();  

             if (Model != null)  

                 Model.Abort();  

         }  

    }
}
3)The consumer form has only a RichTextBox:

using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using HelloWorldRabbitMQ;

namespace HelloWorldRabbitMQ2
{
    public partial class ConsumerForm : Form
    {
        public string HOST_NAME = "localhost";
        public string QUEUE_NAME = "helloWorld";
        public bool ConsumerUp;
        public bool firstLoad;
        private Consumer consumer;

        public ConsumerForm()
        {
            InitializeComponent();
            //create the consumer
            consumer = new Consumer(HOST_NAME, QUEUE_NAME);
            consumer.onMessageReceived += handleMessage;

            //start consuming
            consumer.StartConsuming();
      

        }
        //delegate to post to UI thread
        private delegate void showMessageDelegate(string message);

        //Callback for message receive
        public void handleMessage(byte[] message)
        {
            showMessageDelegate s = new
showMessageDelegate(richTextBox1.AppendText);
            
            this.Invoke(s, System.Text.Encoding.UTF8.GetString(message) +
Environment.NewLine);
            
            
        }

    }
}
4)This is the Consumer class:

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using RabbitMQ.Client;
using RabbitMQ.Client.Exceptions;

namespace HelloWorldRabbitMQ
{
    class Consumer
    {
        protected IModel Model;
        protected IConnection Connection;
        protected string QueueName;

        protected bool isConsuming;

        // used to pass messages back to UI for processing
        public delegate void onReceiveMessage(byte[] message);
        public event onReceiveMessage onMessageReceived;

        public Consumer(string hostName, string queueName)
        {
            QueueName = queueName;
            ConnectionFactory connectionFactory = new ConnectionFactory();
            connectionFactory.HostName = hostName;
            Connection = connectionFactory.CreateConnection();
            Model = Connection.CreateModel();
            Model.QueueDeclare(QueueName, false, false, false, null);
        }

        //internal delegate to run the queue consumer on a seperate thread
        private delegate void ConsumeDelegate();

        public void StartConsuming()
        {
            isConsuming = true;
            ConsumeDelegate c = new ConsumeDelegate(Consume);
            c.BeginInvoke(null, null);
        }

        public void Consume()
        {
            QueueingBasicConsumer consumer = new
QueueingBasicConsumer(Model);
            String consumerTag = Model.BasicConsume(QueueName, false,
consumer);
            while (isConsuming)
            {
                try
                {
                    RabbitMQ.Client.Events.BasicDeliverEventArgs e =
(RabbitMQ.Client.Events.BasicDeliverEventArgs)consumer.Queue.Dequeue();
                    IBasicProperties props = e.BasicProperties;
                    byte[] body = e.Body;
                  
                    // ... process the message
                    onMessageReceived(body);
                    Model.BasicAck(e.DeliveryTag, false);

                }
                catch //(OperationInterruptedException ex)
                {
                    
                    // The consumer was removed, either through
                    // channel or connection closure, or through the
                    // action of IModel.BasicCancel().
                    break;
                }
            }
        }

        public void Dispose()
        {
            isConsuming = false;
            if (Connection != null)
                Connection.Close();
            if (Model != null)
                Model.Abort();
        }

    }
}
Using this program, I can send messages to a single consumer and seeing the
received messages on the consumer side.
Now, if I close my consumer form and go on sending messages, messages will
be stocked into the queue.
If I close all the program and restarts sending a new message, I will
receive on my consumer side all the non-consumed messages plus the currently
sent message. That's what I want to demonstrate but without closing all the
program.

My purpous is to show that if I close my connection to the queue (on the
consumer's side)and aterwars, I open a new consumer, I will receive all the
messages that were sent to the queue during the time there was no consumer.

Does anyone have an idea what I should append to my code?

-- 
View this message in context: http://old.nabble.com/Shuting-down-and-reopening-the-consumer%27s-side-tp33329194p33329194.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From denis.melique at morpho.com  Wed Feb 15 14:47:02 2012
From: denis.melique at morpho.com (MELIQUE Denis (MORPHO))
Date: Wed, 15 Feb 2012 15:47:02 +0100
Subject: [rabbitmq-discuss] How to configure
Message-ID: <C3481B5CE3E61E438EEF6143B51DC17F62DEBCA82B@Y000IIIV01.rd1.rf1>

Hi every body.

I'm quite new with RabbitMQ, so sorry if my question is stupid.

I'am currently setting a Shovel configuration to forward messages from one broker to another,
to have a two sites Active/Semi-Active configuration. Incoming messages must be processed by both sites.

I have set a very small testing configuration with 2 hosts.
'Active host' is running RabbitMQ 2.7.1 on Windows, as 'Semi-Active' is running RabbitMQ 2.6.1 on RedHat6.

The test configuration is as following:
- messages are posted by clients to a direct Exchange named 'public'
- consumers bind to transient queues to the 'public' exchange, with a specific key
   Each consumer  read a message and stores it on disk.
- obviously I don't want to lost any message

My Shovel configuration has: (see attached rabbitmq.config files)

1-      On the Active side:

- a persistent queue bound to 'public' exchange with all possible keys. So every incoming message is read by the Shovel plug-In (that's OK)

- a Shovel declaration to forward messages to the distant exchange declared for the

2-      On the Semi-Active side:
- a topic exchange to which Shovel forwards messages (that's also OK)
- a persistent queue bound to this topic exchange
- a Shovel declaration to forward messages into the local 'public' Exchange.

Everything is fine and messages are going from Active side to Semi-Active one.

Except when consumers are not running on the Semi-Active side.
In that case, messages are sent to 'public' Exchange and are lost because nobody is bound to.
despite the setting : ack_mode, on_confirm

Nb: if the 'Semi-Active side' is not started at all, it's OK messages are kept in the persistent queue
On the Active side.
I'am looking for a way of configuring Shovel plug-in to keep messages in persistent queue until
a consumer can process them.

I thing  I am probably wrong with my configuration, but I can't figure where ??

Thank's a lot.

Denis
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120215/54a95a58/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit.config.semiactive
Type: application/octet-stream
Size: 3877 bytes
Desc: rabbit.config.semiactive
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120215/54a95a58/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit.config.active
Type: application/octet-stream
Size: 3678 bytes
Desc: rabbit.config.active
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120215/54a95a58/attachment-0001.obj>

From ashjain2 at gmail.com  Wed Feb 15 14:51:26 2012
From: ashjain2 at gmail.com (Ashish Jain)
Date: Wed, 15 Feb 2012 20:21:26 +0530
Subject: [rabbitmq-discuss] Huge memory Consumption in RabbitMQ client
Message-ID: <CABGiY4CaoPt4aqrdiGm_nu7TxjeLfHA0evvr3vx50U=4MYCiTw@mail.gmail.com>

Dear All,

I am a newbie in rabbitmq and this is my first post in the rabbitmq
community.

I am seeing a weird issue which definitely does not make sense to me. Here
is the problem statement

We are running a rabbitmq server on IP1 and a simple client application on
IP2. We are observing an abrupt memory consumption on the *client *end
which goes on till all the messages are pumped in rabbitmq and after
that memory usage remains constant. This particular situation has already
led us to few OOM.

Each message pumped into RMQ is around 100 KB and there are 35000 of those.
We see heap usage going up at the client end up till all the 35k messages
are pumped at the server end. How can this be possible as I
am reading one message at a time? How can a load on server impact the
client. I did some test around this to confirm my observation.

Test1: I pumped 2000 messages Heap usage was limited to less than 1 GB at
the client side.
Test2: Over these 2000 messages I again started pumping few more thousand
messages. Side by side client is also consuming the messages the memory
usage keeps increasing at the client side till I pump messages. Once I stop
heap usage remains constant.. Once again if I pump I see heap going up
again and once I stop it remains constant at the current level.

Another observation here is that heap memory never comes down. Is JVM not
able to GC these objects? What could be the possibility?

Few points to note here I am using reusable channels, Queue Consumer. I
have used RabbitMQ client 2.5.1 as well as RMQ client 2.2 however there is
no change in behavior.

Any help or pointers on these issues would be really helpful.

Thanks
Ashish
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120215/6cad375e/attachment.htm>

From aaron at agoragames.com  Wed Feb 15 15:17:05 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Wed, 15 Feb 2012 10:17:05 -0500
Subject: [rabbitmq-discuss] connection and consumer counts all wrong
Message-ID: <CAHiEoM627_UYzt8pCcDPjV17VY4UE5SYp4--JW3jD7XtzV1LOQ@mail.gmail.com>

We're regularly able to break rabbits tracking of consumer counts on a
queue, such that it says "X consumers" whereas the reality is "X - N
consumers" where N>0. This seems to be triggered by disagreement as to
the state of sockets, likely caused by an unclean disconnect by a
client. This could be caused by any number of things, such as
rebooting on of our client VMs or maybe just a connection drop inside
our providers network (a common and unwelcome event).

We've seen this problem on 2.5.1 + R14B01, and are continuing to see
it on 2.7.1 + R15B.  I can try to provide additional details on
request.

My concerns on consumer counts are two-fold. First, we have no way to
validate that num_procs==num_consumers, an important metric when
validating that our platform is running correctly. Second, we don't
know if rabbit is pushing messages to these ghost consumers, and if
so, what's happening to them.

-Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From simon at rabbitmq.com  Wed Feb 15 15:22:38 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 Feb 2012 15:22:38 +0000
Subject: [rabbitmq-discuss] connection and consumer counts all wrong
In-Reply-To: <CAHiEoM627_UYzt8pCcDPjV17VY4UE5SYp4--JW3jD7XtzV1LOQ@mail.gmail.com>
References: <CAHiEoM627_UYzt8pCcDPjV17VY4UE5SYp4--JW3jD7XtzV1LOQ@mail.gmail.com>
Message-ID: <4F3BCDBE.5010806@rabbitmq.com>

Do you see these connections in rabbitmqctl / mgmt?

Have you enabled heartbeats?

Cheers, Simon

On 15/02/12 15:17, Aaron Westendorf wrote:
> We're regularly able to break rabbits tracking of consumer counts on a
> queue, such that it says "X consumers" whereas the reality is "X - N
> consumers" where N>0. This seems to be triggered by disagreement as to
> the state of sockets, likely caused by an unclean disconnect by a
> client. This could be caused by any number of things, such as
> rebooting on of our client VMs or maybe just a connection drop inside
> our providers network (a common and unwelcome event).
>
> We've seen this problem on 2.5.1 + R14B01, and are continuing to see
> it on 2.7.1 + R15B.  I can try to provide additional details on
> request.
>
> My concerns on consumer counts are two-fold. First, we have no way to
> validate that num_procs==num_consumers, an important metric when
> validating that our platform is running correctly. Second, we don't
> know if rabbit is pushing messages to these ghost consumers, and if
> so, what's happening to them.
>
> -Aaron
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From santosh at appfirst.com  Wed Feb 15 15:39:37 2012
From: santosh at appfirst.com (Santosh Thammana)
Date: Wed, 15 Feb 2012 10:39:37 -0500
Subject: [rabbitmq-discuss] rabbitmq restarted in bad state
In-Reply-To: <4F3B86A0.90602@rabbitmq.com>
References: <CAMu_-sFjWd7aHYxYJdCrkJaA9Vaxr6QfcNbWHWaySHjcweaQ8Q@mail.gmail.com>
	<4F3B86A0.90602@rabbitmq.com>
Message-ID: <CAMu_-sE9-2ZL3FPRgK=5DsM4Zv1xd5JeGJCkBCWpiLgxPV7E=g@mail.gmail.com>

Hi,

On Wed, Feb 15, 2012 at 5:19 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 15/02/12 01:37, Santosh Thammana wrote:
>
>> Hello,
>>
>> I had some issues with RabbitMQ, and had to restart it.  The issue was
>> that the queue sizes were remaining constant, despite there being
>> producers and consumers.  But after restarting, I am unable to create a
>> few of my queues.
>>
>> I am using Pika, and I get the error:
>> ChannelClosed: Channel.Close(class_id = 50, method_id = 10, reply_code =
>> 404, reply_text = "NOT_FOUND - no queue 'collector.be2' in vhost '/'")
>>
>
> The only way to get a NOT_FOUND when declaring a queue is if the queue has
> previously been declared on a cluster node which is currently down. Does
> that describe your situation?
>
>

>
>  I get the same error if I then try to delete it.
>> We noticed that the queue is still bound to the default exchange.  So,
>> it seems like that's causing the strange behavior.  And I can't delete a
>> default binding.
>>
>
> The default binding should not prevent you from declaring the queue.
>
>
>   Is there any way to solve this problem without
>> restarting RabbitMQ?  If I do have to restart RabbitMQ, can I expect it
>> to be in a proper state?  I noticed that at least one of the queues I
>> had issues with was declared as durable.  I'm not sure if that impacted
>> this negatively.
>>
>
> I think they would all have to be durable.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>

We were able to get this to work.  We don't have a cluster - there's just
one server.  It seems that after several hours, the queue server's state
was fixed.  We were able to create the desired queues.  Thanks for your
help!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120215/304932b0/attachment.htm>

From aaron at agoragames.com  Wed Feb 15 15:58:18 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Wed, 15 Feb 2012 10:58:18 -0500
Subject: [rabbitmq-discuss] connection and consumer counts all wrong
In-Reply-To: <4F3BCDBE.5010806@rabbitmq.com>
References: <CAHiEoM627_UYzt8pCcDPjV17VY4UE5SYp4--JW3jD7XtzV1LOQ@mail.gmail.com>
	<4F3BCDBE.5010806@rabbitmq.com>
Message-ID: <CAHiEoM5U-tPf5pbLpupe-vjVTpWtk=gBQM-Eyj_1s+YKLPx0AA@mail.gmail.com>

I need to run reports to figure out which ports are diff'd between
client and server, then mine rabbitmqctl to see what it thinks. That's
on deck for the day but may take awhile or get pushed off in favor of
other needs.

We haven't enabled heartbeats because until recently, we weren't
guaranteed that we could timely acknowledge a heartbeat while also
handling a message. If heartbeats will rid us of any question, I'll
gladly turn them back on.

-Aaron

On Wed, Feb 15, 2012 at 10:22 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> Do you see these connections in rabbitmqctl / mgmt?
>
> Have you enabled heartbeats?
>
> Cheers, Simon
>
>
> On 15/02/12 15:17, Aaron Westendorf wrote:
>>
>> We're regularly able to break rabbits tracking of consumer counts on a
>> queue, such that it says "X consumers" whereas the reality is "X - N
>> consumers" where N>0. This seems to be triggered by disagreement as to
>> the state of sockets, likely caused by an unclean disconnect by a
>> client. This could be caused by any number of things, such as
>> rebooting on of our client VMs or maybe just a connection drop inside
>> our providers network (a common and unwelcome event).
>>
>> We've seen this problem on 2.5.1 + R14B01, and are continuing to see
>> it on 2.7.1 + R15B. ?I can try to provide additional details on
>> request.
>>
>> My concerns on consumer counts are two-fold. First, we have no way to
>> validate that num_procs==num_consumers, an important metric when
>> validating that our platform is running correctly. Second, we don't
>> know if rabbit is pushing messages to these ghost consumers, and if
>> so, what's happening to them.
>>
>> -Aaron
>>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From simon at rabbitmq.com  Wed Feb 15 16:00:29 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 Feb 2012 16:00:29 +0000
Subject: [rabbitmq-discuss] connection and consumer counts all wrong
In-Reply-To: <CAHiEoM5U-tPf5pbLpupe-vjVTpWtk=gBQM-Eyj_1s+YKLPx0AA@mail.gmail.com>
References: <CAHiEoM627_UYzt8pCcDPjV17VY4UE5SYp4--JW3jD7XtzV1LOQ@mail.gmail.com>	<4F3BCDBE.5010806@rabbitmq.com>
	<CAHiEoM5U-tPf5pbLpupe-vjVTpWtk=gBQM-Eyj_1s+YKLPx0AA@mail.gmail.com>
Message-ID: <4F3BD69D.7080803@rabbitmq.com>

On 15/02/12 15:58, Aaron Westendorf wrote:
> We haven't enabled heartbeats because until recently, we weren't
> guaranteed that we could timely acknowledge a heartbeat while also
> handling a message. If heartbeats will rid us of any question, I'll
> gladly turn them back on.

Well, heartbeats will definitely detect connections that have died but 
where this has not been noticed by the underlying OS, which sounds like 
what you're seeing.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Jim.Langston at compuware.com  Wed Feb 15 15:48:36 2012
From: Jim.Langston at compuware.com (Langston, Jim)
Date: Wed, 15 Feb 2012 15:48:36 +0000
Subject: [rabbitmq-discuss] rabbitMQ management tool not showing
 messages delivered
In-Reply-To: <4F3B8562.8030502@rabbitmq.com>
Message-ID: <CB6139B9.1159C%jim.langston@compuware.com>

Hi Simon,

Double-checked bullet #1, all the RMQ servers have mgmt turned on

# rabbitmq-plugins list
[e] amqp_client                       2.7.0
[ ] eldap                             2.7.0-git
[ ] erlando                           2.7.0
[e] mochiweb                          1.3-rmq2.7.0-git
[ ] rabbitmq_auth_backend_ldap        2.7.0
[ ] rabbitmq_auth_mechanism_ssl       2.7.0
[ ] rabbitmq_consistent_hash_exchange 2.7.0
[ ] rabbitmq_federation               2.7.0
[ ] rabbitmq_jsonrpc                  2.7.0
[ ] rabbitmq_jsonrpc_channel          2.7.0
[ ] rabbitmq_jsonrpc_channel_examples 2.7.0
[E] rabbitmq_management               2.7.0
[e] rabbitmq_management_agent         2.7.0
[ ] rabbitmq_management_visualiser    2.7.0
[e] rabbitmq_mochiweb                 2.7.0
[ ] rabbitmq_shovel                   2.7.0
[ ] rabbitmq_shovel_management        2.7.0
[ ] rabbitmq_stomp                    2.7.0
[ ] rabbitmq_tracing                  2.7.0
[ ] rfc4627_jsonrpc                   2.7.0-git
[e] webmachine                        1.7.0-rmq2.7.0-hg



For #2 bullet, all the connections are long-lived ..


Jim


On 2/15/12 5:13 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

>On 14/02/12 18:27, Langston, Jim wrote:
>> I'm scratching on this one ?
>>
>> I have 4 queues, 8 RMQ server cluster, in the browser for management, I
>> see for
>> the queues, all their names, status is active on all of them, they are
>> showing
>> about 7K of incoming message rates. On three of the queues deliver/get
>>is
>> displaying about 7K as well, that is, except for one queue, which is
>> showing 0.
>> Yet, the messages are getting to the applications from that queue.
>>
>> This is the same for all the RMQ server mgmt pages.
>>
>> I'm not sure why I'm seeing 0 for that one queue even though the
>>application
>> is not bothered as the queue is not building up and the messages are
>>getting
>> through.
>
>Hi Jim. Two possibilities spring to mind:
>
>1) Is the management agent running on all nodes in the cluster? If it's
>not installed on any node, any activity on that node will not be counted.
>
>2) Is that queue consumed from by clients that open and close very short
>lived channels? There's a longstanding bug / lacking feature in mgmt
>that short-lived channels do not contribute to statistics.
>
>Cheers, Simon
>
>-- 
>Simon MacMullen
>RabbitMQ, VMware
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From aaron at agoragames.com  Wed Feb 15 16:13:17 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Wed, 15 Feb 2012 11:13:17 -0500
Subject: [rabbitmq-discuss] connection and consumer counts all wrong
In-Reply-To: <4F3BD69D.7080803@rabbitmq.com>
References: <CAHiEoM627_UYzt8pCcDPjV17VY4UE5SYp4--JW3jD7XtzV1LOQ@mail.gmail.com>
	<4F3BCDBE.5010806@rabbitmq.com>
	<CAHiEoM5U-tPf5pbLpupe-vjVTpWtk=gBQM-Eyj_1s+YKLPx0AA@mail.gmail.com>
	<4F3BD69D.7080803@rabbitmq.com>
Message-ID: <CAHiEoM5Z0JDnaPgjYPH15Xw6xNm3GiX0d8-p2jC3e=KoNP5p7A@mail.gmail.com>

That is sensible and we now have the capacity to do so. Thank you.

cheers,
Aaron



On Wed, Feb 15, 2012 at 11:00 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 15/02/12 15:58, Aaron Westendorf wrote:
>>
>> We haven't enabled heartbeats because until recently, we weren't
>> guaranteed that we could timely acknowledge a heartbeat while also
>> handling a message. If heartbeats will rid us of any question, I'll
>> gladly turn them back on.
>
>
> Well, heartbeats will definitely detect connections that have died but where
> this has not been noticed by the underlying OS, which sounds like what
> you're seeing.
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From mpietrek at skytap.com  Wed Feb 15 17:15:44 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 15 Feb 2012 09:15:44 -0800
Subject: [rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03
	performance
In-Reply-To: <4F3B8435.2040401@rabbitmq.com>
References: <CB602924.2DF9C%mpietrek@skytap.com>
	<4F3B8435.2040401@rabbitmq.com>
Message-ID: <CACLE7iwUVeao_ceQdUr-y43srcNVrk+R5R9OBOiZxGG8FZ4OnA@mail.gmail.com>

Thanks Simon. The 5% figure is useful for me.

Let me give you a more precise description of what I'm doing to get the 36
message/sec.


   - RabbitMQ 2.71 on a 3-node cluster with mirrored queues, durable on all
   nodes.
   - Client is Python 2.6/Pika 0.9.5.
   - Each message publish occurs in a transaction so that we can be sure
   it's safely in RabbitMQ.
   - All nodes are Ubuntu 10.04 VMs with 4GB RAM and 2 or 4 vCPUs.


At the heart of things, we're driving a highly complex state machine that
manages thousands of VMs and their associated state. Losing track of any
state is prohibitively expensive to clean up manually. As such, all state
is modeled in clustered databases and/or persistent messages in the message
queue. We have to assume that a given client app instance (our management
code) may be ungracefully terminated at any moment, so enough state must be
modeled to let a new instance pick up and recover. If our database record
indicates that a message has been sent, it better darn well be in the hands
of the RabbitMQ broker, and not sitting in some Pika client-side queue.

For this reasons, publisher-confirms are not particularly helpful - They
assume that the client app will be around to resend the message if the
message doesn't get confirmed. Similar story for batching messages. We have
to know they've been sent, and we can't stall our state machine waiting for
enough message to accumulate to publish multiple messages at once.

My goal in my latest round of experiments is to see what the maximum
throughput of a highly available system is in optimal circumstances. We're
perfectly willing to spend the money on high end SSDs and networking
equipment as necessary.

To prototype what this perf level is, I've configured RabbitMQ with the
MNESIA directory pointing to a ramdisk (/tmp). I've configured all the VMs
with VMXNET3 networking, am with 16K blocks, are seeing bandwidth of
130MB/sec between VMs in the cluster.

My test app simply writes 6 byte message, one at a time, as quickly as it
can. In monitoring the cluster nodes, I'm seeing very low CPU usage, very
few writes to the physical disk, and network operation rates of about
700/sec for the master node and 350/sec for the client node.

In short, there's a bottleneck somewhere and it's not obvious where. I'll
try your suggestion about replacing tx.commit. Any other insight or
guidance would of course be very much appreciated. :-)

Matt


On Wed, Feb 15, 2012 at 2:08 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 14/02/12 23:07, Matt Pietrek wrote:
>
>> I'm looking to squeeze every last bit of message throughput out of our
>> mirrored queue setup.
>>
>
> Hi Matt.
>
>
>  I max out at 36 messages/sec when writing. (Yes,
>> we use transactions, and we know it's not optimal, but we're valuing
>> high reliability over speed. Our clients and/or servers could go away at
>> any moment, so things like Publisher-acknowledge are nice, but take away
>> from the fundamental disaster hardness.)
>>
>> Anyhow, we're running on Ubuntu 10.04 with 2.71 and the default Erlang
>> install. This gives us R13B03 as the Erlang version.
>>
>> Question: Does anybody (and particularly the RabbitMQ folks) have any
>> input on what sort of perf improvements we might get by switching to a
>> newer Erlang Version?
>>
>
> Not much really. We haven't tested extensively but if you got 5% I think
> you would consider yourself lucky.
>
> However, 36 msg/s is *really* slow.
>
> Although mirrored queues are slower than normal ones I would still hope
> you could stick a couple of zeroes on the end of that figure. So I suspect
> you are not actually CPU bound at the server.
>
> I assume when you say "using transactions" you mean publishing a single
> message per transaction? In that case you are incurring the cost of a
> network round trip and an fsync() on each publish, and I suspect that is
> what is killing your performance.
>
> If I had to guess I would suspect the fsync is the worst of the problem.
> Assuming the 36 msg/s is from some test app, you might want to remove the
> tx.select and replace the tx.commit with some meaningless synchronous
> request (basic.qos is a favourite) and see what happens to your message
> rate. If it shoots up, the fsync is the problem. If it doesn't, the network
> round trip is.
>
> When you have the answer to that, you know whether you're going to want to
> spend money on fancy networking hardware or SSDs...
>
> Of course, *really* I would suggest you need to be publishing more
> messages per round-trip / fsync. So either batch multiple publishes into a
> transaction or start using confirms instead. I know you say that they "take
> away from the fundamental disaster hardness" but I'm not sure I understand
> what you mean by that. Both confirms and tx give you a way to know when a
> given message is definitely on disc. And in fact tx is implemented in terms
> of confirms these days.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120215/eeec5ae9/attachment.htm>

From simon at rabbitmq.com  Wed Feb 15 17:36:41 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 Feb 2012 17:36:41 +0000
Subject: [rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03
 performance
In-Reply-To: <CACLE7iwUVeao_ceQdUr-y43srcNVrk+R5R9OBOiZxGG8FZ4OnA@mail.gmail.com>
References: <CB602924.2DF9C%mpietrek@skytap.com>	<4F3B8435.2040401@rabbitmq.com>
	<CACLE7iwUVeao_ceQdUr-y43srcNVrk+R5R9OBOiZxGG8FZ4OnA@mail.gmail.com>
Message-ID: <4F3BED29.6050602@rabbitmq.com>

On 15/02/12 17:15, Matt Pietrek wrote:
> Thanks Simon. The 5% figure is useful for me.

Cheers. Bear in mind that's just my guess, and it's also dependent on 
your situation being CPU-bound - which it sounds like you aren't.

> Let me give you a more precise description of what I'm doing to get the
> 36 message/sec.
>
>     * RabbitMQ 2.71 on a 3-node cluster with mirrored queues, durable on
>       all nodes.
>     * Client is Python 2.6/Pika 0.9.5.
>     * Each message publish occurs in a transaction so that we can be
>       sure it's safely in RabbitMQ.
>     * All nodes are Ubuntu 10.04 VMs with 4GB RAM and 2 or 4 vCPUs.
>
>
> At the heart of things, we're driving a highly complex state machine
> that manages thousands of VMs and their associated state. Losing track
> of any state is prohibitively expensive to clean up manually. As such,
> all state is modeled in clustered databases and/or persistent messages
> in the message queue. We have to assume that a given client app instance
> (our management code) may be ungracefully terminated at any moment, so
> enough state must be modeled to let a new instance pick up and recover.
> If our database record indicates that a message has been sent, it better
> darn well be in the hands of the RabbitMQ broker, and not sitting in
> some Pika client-side queue.
>
> For this reasons, publisher-confirms are not particularly helpful - They
> assume that the client app will be around to resend the message if the
> message doesn't get confirmed. Similar story for batching messages. We
> have to know they've been sent, and

OK.

> we can't stall our state machine
> waiting for enough message to accumulate to publish multiple messages at
> once.

So I think this is really the key point. OK, I accept your use case :)

> My goal in my latest round of experiments is to see what the maximum
> throughput of a highly available system is in optimal circumstances.
> We're perfectly willing to spend the money on high end SSDs and
> networking equipment as necessary.
>
> To prototype what this perf level is, I've configured RabbitMQ with the
> MNESIA directory pointing to a ramdisk (/tmp).

I assume that this is not how you plan to go into production, you are 
just testing how fast you can go if disk speed is not an issue?

> I've configured all the
> VMs with VMXNET3 networking, am with 16K blocks, are seeing bandwidth of
> 130MB/sec between VMs in the cluster.

The real issue though is going to be latency from client to server. What 
does that look like?

> My test app simply writes 6 byte message, one at a time, as quickly as
> it can. In monitoring the cluster nodes, I'm seeing very low CPU usage,
> very few writes to the physical disk, and network operation rates of
> about 700/sec for the master node and 350/sec for the client node.
>
> In short, there's a bottleneck somewhere and it's not obvious where.
> I'll try your suggestion about replacing tx.commit. Any other insight or
> guidance would of course be very much appreciated. :-)

It sounds like you have already almost eliminated disk writes in 
practice, so my working assumption would be that it's client -> server 
latency that is your issue.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From visionofarun at gmail.com  Wed Feb 15 18:58:33 2012
From: visionofarun at gmail.com (Arun Chandrasekaran)
Date: Wed, 15 Feb 2012 10:58:33 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-c: Nonblocking recv
Message-ID: <3663841.2.1329332313215.JavaMail.geo-discussion-forums@vbnd9>

Hi all,

How do we make a non blocking recv from librabbitmq? amqp_simple_wait_frame 
blocks if the queue doesn't contain any message.

Should we call amqp_data_in_buffer() and based on the result call 
amqp_simple_wait_frame or implement a solution like this?

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/014868.html

Thanks in advance.

- Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120215/36f5d167/attachment.htm>

From mpietrek at skytap.com  Wed Feb 15 19:18:54 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 15 Feb 2012 11:18:54 -0800
Subject: [rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03
	performance
In-Reply-To: <4F3BED29.6050602@rabbitmq.com>
References: <CB602924.2DF9C%mpietrek@skytap.com>
	<4F3B8435.2040401@rabbitmq.com>
	<CACLE7iwUVeao_ceQdUr-y43srcNVrk+R5R9OBOiZxGG8FZ4OnA@mail.gmail.com>
	<4F3BED29.6050602@rabbitmq.com>
Message-ID: <CACLE7iyaxmc0pJZ+gzNXa93da13s1iiStApp-A58BYPmmHkejw@mail.gmail.com>

| So I think this is really the key point. OK, I accept your use case :)

Yeah, I figured I would have to go into some detail to get past the
(usually reasonable) "don't do that" round of responses. :-)

Regardless, thank you much for accepting the use case and plowing forward
with the perf question.


| I assume that this is not how you plan to go into production, you are
just testing how fast you can go if disk speed is not an issue?

Correct. :-)


| The real issue though is going to be latency from client to server. What
does that look like?

I'm still poking at this, trying to get a concrete answer from the maze of
available tools. All the VMs are using VMXNET3 and exhibit amazing perf
between each other using netperf.

HOWEVER... one data point tends to take client/broker latency out of the
question:

If I remove the clustering, so as to just hit a single broker, the rate
goes up to 900 message/sec. Thus, I'm directed back to looking for latency
between the master/slaves.

One other potentially interesting data point: With 2 slaves, the message
rate is only very slightly degraded from 1 slave, i.e. 37/second with 1
slave, and 36/sec with two. I assume the slave synchronization is done in
parallel, so this isn't totally surprising.

Matt


On Wed, Feb 15, 2012 at 9:36 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 15/02/12 17:15, Matt Pietrek wrote:
>
>> Thanks Simon. The 5% figure is useful for me.
>>
>
> Cheers. Bear in mind that's just my guess, and it's also dependent on your
> situation being CPU-bound - which it sounds like you aren't.
>
>  Let me give you a more precise description of what I'm doing to get the
>> 36 message/sec.
>>
>>    * RabbitMQ 2.71 on a 3-node cluster with mirrored queues, durable on
>>      all nodes.
>>    * Client is Python 2.6/Pika 0.9.5.
>>    * Each message publish occurs in a transaction so that we can be
>>
>>      sure it's safely in RabbitMQ.
>>    * All nodes are Ubuntu 10.04 VMs with 4GB RAM and 2 or 4 vCPUs.
>>
>>
>>
>> At the heart of things, we're driving a highly complex state machine
>> that manages thousands of VMs and their associated state. Losing track
>> of any state is prohibitively expensive to clean up manually. As such,
>> all state is modeled in clustered databases and/or persistent messages
>> in the message queue. We have to assume that a given client app instance
>> (our management code) may be ungracefully terminated at any moment, so
>> enough state must be modeled to let a new instance pick up and recover.
>> If our database record indicates that a message has been sent, it better
>> darn well be in the hands of the RabbitMQ broker, and not sitting in
>> some Pika client-side queue.
>>
>> For this reasons, publisher-confirms are not particularly helpful - They
>> assume that the client app will be around to resend the message if the
>> message doesn't get confirmed. Similar story for batching messages. We
>> have to know they've been sent, and
>>
>
> OK.
>
>
>  we can't stall our state machine
>> waiting for enough message to accumulate to publish multiple messages at
>> once.
>>
>
> So I think this is really the key point. OK, I accept your use case :)
>
>
>  My goal in my latest round of experiments is to see what the maximum
>> throughput of a highly available system is in optimal circumstances.
>> We're perfectly willing to spend the money on high end SSDs and
>> networking equipment as necessary.
>>
>> To prototype what this perf level is, I've configured RabbitMQ with the
>> MNESIA directory pointing to a ramdisk (/tmp).
>>
>
> I assume that this is not how you plan to go into production, you are just
> testing how fast you can go if disk speed is not an issue?
>
>
>  I've configured all the
>> VMs with VMXNET3 networking, am with 16K blocks, are seeing bandwidth of
>> 130MB/sec between VMs in the cluster.
>>
>
> The real issue though is going to be latency from client to server. What
> does that look like?
>
>
>  My test app simply writes 6 byte message, one at a time, as quickly as
>> it can. In monitoring the cluster nodes, I'm seeing very low CPU usage,
>> very few writes to the physical disk, and network operation rates of
>> about 700/sec for the master node and 350/sec for the client node.
>>
>> In short, there's a bottleneck somewhere and it's not obvious where.
>> I'll try your suggestion about replacing tx.commit. Any other insight or
>> guidance would of course be very much appreciated. :-)
>>
>
> It sounds like you have already almost eliminated disk writes in practice,
> so my working assumption would be that it's client -> server latency that
> is your issue.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120215/d72b7d74/attachment.htm>

From Jim.Langston at compuware.com  Wed Feb 15 20:01:16 2012
From: Jim.Langston at compuware.com (Langston, Jim)
Date: Wed, 15 Feb 2012 20:01:16 +0000
Subject: [rabbitmq-discuss] rabbitMQ management tool not showing
 messages delivered
In-Reply-To: <CB6139B9.1159C%jim.langston@compuware.com>
Message-ID: <CB6178B4.1165D%jim.langston@compuware.com>

Also, how is the value to be presented as deliver/get being calculated?
I've been looking at rabbitmqctl commands that would be let me do the same
independent of the mgmt interface. Is there a way to get those values?

Thanks,

Jim

On 2/15/12 10:48 AM, "Langston, Jim" <Jim.Langston at compuware.com> wrote:

>Hi Simon,
>
>Double-checked bullet #1, all the RMQ servers have mgmt turned on
>
># rabbitmq-plugins list
>[e] amqp_client                       2.7.0
>[ ] eldap                             2.7.0-git
>[ ] erlando                           2.7.0
>[e] mochiweb                          1.3-rmq2.7.0-git
>[ ] rabbitmq_auth_backend_ldap        2.7.0
>[ ] rabbitmq_auth_mechanism_ssl       2.7.0
>[ ] rabbitmq_consistent_hash_exchange 2.7.0
>[ ] rabbitmq_federation               2.7.0
>[ ] rabbitmq_jsonrpc                  2.7.0
>[ ] rabbitmq_jsonrpc_channel          2.7.0
>[ ] rabbitmq_jsonrpc_channel_examples 2.7.0
>[E] rabbitmq_management               2.7.0
>[e] rabbitmq_management_agent         2.7.0
>[ ] rabbitmq_management_visualiser    2.7.0
>[e] rabbitmq_mochiweb                 2.7.0
>[ ] rabbitmq_shovel                   2.7.0
>[ ] rabbitmq_shovel_management        2.7.0
>[ ] rabbitmq_stomp                    2.7.0
>[ ] rabbitmq_tracing                  2.7.0
>[ ] rfc4627_jsonrpc                   2.7.0-git
>[e] webmachine                        1.7.0-rmq2.7.0-hg
>
>
>
>For #2 bullet, all the connections are long-lived ..
>
>
>Jim
>
>
>On 2/15/12 5:13 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:
>
>>On 14/02/12 18:27, Langston, Jim wrote:
>>> I'm scratching on this one ?
>>>
>>> I have 4 queues, 8 RMQ server cluster, in the browser for management, I
>>> see for
>>> the queues, all their names, status is active on all of them, they are
>>> showing
>>> about 7K of incoming message rates. On three of the queues deliver/get
>>>is
>>> displaying about 7K as well, that is, except for one queue, which is
>>> showing 0.
>>> Yet, the messages are getting to the applications from that queue.
>>>
>>> This is the same for all the RMQ server mgmt pages.
>>>
>>> I'm not sure why I'm seeing 0 for that one queue even though the
>>>application
>>> is not bothered as the queue is not building up and the messages are
>>>getting
>>> through.
>>
>>Hi Jim. Two possibilities spring to mind:
>>
>>1) Is the management agent running on all nodes in the cluster? If it's
>>not installed on any node, any activity on that node will not be counted.
>>
>>2) Is that queue consumed from by clients that open and close very short
>>lived channels? There's a longstanding bug / lacking feature in mgmt
>>that short-lived channels do not contribute to statistics.
>>
>>Cheers, Simon
>>
>>-- 
>>Simon MacMullen
>>RabbitMQ, VMware
>>_______________________________________________
>>rabbitmq-discuss mailing list
>>rabbitmq-discuss at lists.rabbitmq.com
>>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From msteele at beringmedia.com  Wed Feb 15 20:06:47 2012
From: msteele at beringmedia.com (Mark Steele)
Date: Wed, 15 Feb 2012 15:06:47 -0500
Subject: [rabbitmq-discuss] SSL between cluster hosts supported ?
In-Reply-To: <CABzX+qw+bTthyDQad9vMpR8ju0yk21EdQ=zCjAUYFAwfEv=qFw@mail.gmail.com>
References: <1329252661.74648.YahooMailNeo@web36203.mail.mud.yahoo.com>
	<CABzX+qz2gb9gCg9SJzy7JH-T-sKLs_RCrqKaXJx3tCuKznK5Kg@mail.gmail.com>
	<CABzX+qw+bTthyDQad9vMpR8ju0yk21EdQ=zCjAUYFAwfEv=qFw@mail.gmail.com>
Message-ID: <CAH24rBOZ=M-1VNjnATnm3i1a04S6KP1=NrjaDNLEZnA8PD-oVQ@mail.gmail.com>

Would be awesome if someone were to put up an example on the rabbitmq
website with a how-to on getting that up and running, someone with both
rabbit and erlang experience.... :)

Mark Steele, CISSP, CSM

On Wed, Feb 15, 2012 at 4:57 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Wed, Feb 15, 2012 at 09:51, Marek Majkowski <majek04 at gmail.com> wrote:
> > On Tue, Feb 14, 2012 at 20:51, Charles <cshtreck at yahoo.com> wrote:
> >> I've got rabbitmq 2.7.1 w/ Erlang R15B and I'd like to know if
> encrypted/ssl  sessions between rabbit hosts in a cluster is supported.
> >> I'd appreciate a link to any docs on how to configure that.
> >> SSL from client to server is working btw.
> >
> > RabbitMQ clustering uses built-in Erlang clustering mechanisms.
> >
> > As far as I know, erlang clustering doesn't allow have any
> > encryption support. Google says:
> >
> >
> http://www.trapexit.org/Distributed_erlang_using_ssl_through_firewalls
> >
> > and
> >
> >  http://stackoverflow.com/a/891058/496285
> >
> > So basically, you can hack erlang or do it on the IP layer. Both options
> > are nontrivial.
>
> I'm wrong. There's a third, built-in, thing:
>
>   http://www.erlang.org/doc/apps/ssl/ssl_distribution.html
>
> But I'm afraid I don't have much expertise in that.
>
> Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120215/f15a7489/attachment.htm>

From kot.begemot at gmail.com  Wed Feb 15 20:11:45 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Wed, 15 Feb 2012 12:11:45 -0800
Subject: [rabbitmq-discuss] Active/Active: shutdown of one service
 brings down the cluster
In-Reply-To: <9bbc35d6-d480-4c64-a173-b73778fbc8f9@CoachZ.local>
References: <CAFWGgNECgZECqXY9L2ysR=mkiU8tBwWN+TAFsGjC_sGWpixtUg@mail.gmail.com>
	<9bbc35d6-d480-4c64-a173-b73778fbc8f9@CoachZ.local>
Message-ID: <CAFWGgNHN4Y4tT6Z4GT8E7-HQ1wOTdXMk+H4uWXpt6-9CLm57mA@mail.gmail.com>

Hi Jerry,

So is there a better way to declare transient queues then declaring them as
HA?
I can see only alternative by adding a random string to queue name. And
which way is preferred?

Vadim.

On Tue, Feb 14, 2012 at 12:45 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Vadim:
>
> A client doesn't need to be connected directly to the node on which
> a queue and its attendant Erlang process reside.  If your load balancer
> sends you to any live node in the cluster you can consume from the queue
> of your choice, as long as it's still alive.
>
> Note that you can't straightforwardly redeclare a queue that had been on
> a node that's gone down.  The cluster's metadata will still know about it
> and prevent you from redeclaring it.  This is intentional, to avoid the
> confusion that would result if you succeeded at the redeclare, a new
> queue of the same name and properties came into existence on another node,
> and then the original, downed node came back up in the cluster...
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "Vadim Chekan" <kot.begemot at gmail.com>
> To: "Simon MacMullen" <simon at rabbitmq.com>, ghanna at verticalsearchworks.com
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Tuesday, February 14, 2012 12:40:05 PM
> Subject: Re: [rabbitmq-discuss] Active/Active: shutdown of one service
> brings down the cluster
>
>
> Hi Simon,
>
> Thanks for looking into the logs. Since we fixed channel leak in our
> application we do not experience any problems anymore.
>
> Regarding transient queues in HA. I am just not sure how system would
> behave when non-HA queue is declared in a cluster environment.
> Documentation describes in great details what happen to mirrored queues but
> I can't find anything about non-ha queue in HA cluster. Queue will be
> created on a single server, and application should be ready to re-declare
> queue in case of failover. So far so good. But how does it work with load
> balancer? When request is made against a server which does not have a given
> queue, will the cluster "know" where the queue is and proxy the request to
> the proper server?
>
> Thanks,
> Vadim.
>
>
> On Mon, Feb 13, 2012 at 10:09 AM, Simon MacMullen < simon at rabbitmq.com >
> wrote:
>
>
>
> On 10/02/12 00:20, Vadim Chekan wrote:
>
>
> I think we nailed down a problem. We had a channel leak in our
> application. With ~50 connections we had >90 channels per connection and
> growing. This definitely correlates to high CPU usage.
>
> What I still do not understand either it triggered rabbit into unstable
> state or it was something else. Maybe increasing latencies in message
> handling triggered cluster members into flipping neighbor aliveness
> status back and force? Just speculating here: could timeouts because of
> high load cause network fragmentation, when every node temporally does
> not see neighbors, becomes a master, than see a neighbor, freak out, etc?
>
> That's plausible, but I don't think that's what's happening (there's
> nothing about network partitioning in the logs).
>
>
>
>
> I've attached logs from all 3 cluster members. They are polluted with
> load balancer "ping".
>
> Thanks. I've had a poke at this but nothing is leaping out at me yet. I'll
> keep at it though.
>
> One thing that's a bit odd: you seem to be creating HA / transient /
> autodelete / exclusive queues. So although they're "HA", they will vanish
> if any of the following happens:
>
> * The entire cluster goes down (transient) or
> * All consumers for a queue cancel (autodelete) or
> * The connection that created them closes (exclusive)
>
> Is this intentional? It seems like an odd use of HA.
>
> Cheers, Simon
>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
>
>
> --
> From RFC 2631: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT is
> explicitly specified
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 

From jtansavatdi at rubiconproject.com  Wed Feb 15 21:19:26 2012
From: jtansavatdi at rubiconproject.com (Jonathan Tansavatdi)
Date: Wed, 15 Feb 2012 15:19:26 -0600
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-1.0.0 (stable) Released.
In-Reply-To: <20120215210239.20326.qmail@pb12.pair.com>
Message-ID: <CB6160CA.43C38%jtansavatdi@rubiconproject.com>

Just wanted to let everyone know that AMQP (a PHP extension) has been
released to the public. This is the first stable release.

>The new PECL package amqp-1.0.0 (stable) has been released at
>http://pecl.php.net/.
>
>Release notes
>-------------
>1.0.0 Release:
>Changed/finalized API signature:
>    * Exposing AMQPChannel
>    * Exposing AMQPEnvelope
>    * Exposing more queue and exchange arguments and flags
>    * Exposing basic.qos
>Added persistent connections
>Cleaned up codebase
>Fixed memory leaks and segmentation faults
>     
>0.3.1 Release:
>Fixed bug:
>    * 24323: Cannot get the name for auto-named reply-to queues
>     
>0.3.0 Release:
>Fixed memory leaks in many functions (courtesy Jonathan Tansavatdi and
>Andy Wick)
>Fixed consume method to return proper values
>Cleaned up variable usage
>Fixed bugs:
>    * 22638: Unexpected exit code 1 with AMQPQueue::consume()
>    * 22698: AMQPQueue::consume
>
>0.2.2 Release:
>Made extension compatible with PHP lt 5.3 (courtesy John Skopis)
>Fixed wrong typing of message properties (courtesy John Skopis)
>
>0.2.1 Release:
>Fixed refcount decrementing bug causing segfaults.
>
>0.2.0 Release:
>Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
>Modified AMQPConnection object:
>    * Requires call to 'connect' method to connect (no longer connects on
>instantiation)
>    * Added support for disconnect and reconnect
>    * Added helper setters for port, host, vhost, login and password
>Improved consume method to block for MIN messages, and try to get MAX
>messages if available
>Fixed zval descoping bugs
>Fixed bugs:
>    * 17809: Couldn't compile pecl extension under PHP 5.3
>    * 17831: Segmentation fault when the exchange doesn't exists
>    * 19707: AMQPQueue::get() doesn't return the message
>    * 19840: Connection Exception
>
>Package Info
>-------------
>This extension can communicate with any AMQP spec 0-9-1 compatible
>server, such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to
>create and delete exchanges and queues, as well as publish to any
>exchange and consume from any queue.
>
>Related Links
>-------------
>Package home: http://pecl.php.net/package/amqp
>   Changelog: http://pecl.php.net/package-changelog.php?package=amqp
>    Download: http://pecl.php.net/get/amqp-1.0.0.tgz
>
>Authors
>-------------
>Pieter de Zwart (lead)


From videlalvaro at gmail.com  Wed Feb 15 21:27:50 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 15 Feb 2012 22:27:50 +0100
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-1.0.0 (stable) Released.
In-Reply-To: <CB6160CA.43C38%jtansavatdi@rubiconproject.com>
References: <CB6160CA.43C38%jtansavatdi@rubiconproject.com>
Message-ID: <09DC8D77-0A4B-4186-8FAA-8250F39CD3B2@gmail.com>

Hi,

Very good news, congratulations!

Are the installation instructions here: http://ch.php.net/manual/en/amqp.installation.php up to date?

Cheers,

Alvaro

On Feb 15, 2012, at 10:19 PM, Jonathan Tansavatdi wrote:

> Just wanted to let everyone know that AMQP (a PHP extension) has been
> released to the public. This is the first stable release.
> 
>> The new PECL package amqp-1.0.0 (stable) has been released at
>> http://pecl.php.net/.
>> 
>> Release notes
>> -------------
>> 1.0.0 Release:
>> Changed/finalized API signature:
>>   * Exposing AMQPChannel
>>   * Exposing AMQPEnvelope
>>   * Exposing more queue and exchange arguments and flags
>>   * Exposing basic.qos
>> Added persistent connections
>> Cleaned up codebase
>> Fixed memory leaks and segmentation faults
>> 
>> 0.3.1 Release:
>> Fixed bug:
>>   * 24323: Cannot get the name for auto-named reply-to queues
>> 
>> 0.3.0 Release:
>> Fixed memory leaks in many functions (courtesy Jonathan Tansavatdi and
>> Andy Wick)
>> Fixed consume method to return proper values
>> Cleaned up variable usage
>> Fixed bugs:
>>   * 22638: Unexpected exit code 1 with AMQPQueue::consume()
>>   * 22698: AMQPQueue::consume
>> 
>> 0.2.2 Release:
>> Made extension compatible with PHP lt 5.3 (courtesy John Skopis)
>> Fixed wrong typing of message properties (courtesy John Skopis)
>> 
>> 0.2.1 Release:
>> Fixed refcount decrementing bug causing segfaults.
>> 
>> 0.2.0 Release:
>> Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
>> Modified AMQPConnection object:
>>   * Requires call to 'connect' method to connect (no longer connects on
>> instantiation)
>>   * Added support for disconnect and reconnect
>>   * Added helper setters for port, host, vhost, login and password
>> Improved consume method to block for MIN messages, and try to get MAX
>> messages if available
>> Fixed zval descoping bugs
>> Fixed bugs:
>>   * 17809: Couldn't compile pecl extension under PHP 5.3
>>   * 17831: Segmentation fault when the exchange doesn't exists
>>   * 19707: AMQPQueue::get() doesn't return the message
>>   * 19840: Connection Exception
>> 
>> Package Info
>> -------------
>> This extension can communicate with any AMQP spec 0-9-1 compatible
>> server, such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to
>> create and delete exchanges and queues, as well as publish to any
>> exchange and consume from any queue.
>> 
>> Related Links
>> -------------
>> Package home: http://pecl.php.net/package/amqp
>>  Changelog: http://pecl.php.net/package-changelog.php?package=amqp
>>   Download: http://pecl.php.net/get/amqp-1.0.0.tgz
>> 
>> Authors
>> -------------
>> Pieter de Zwart (lead)
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From videlalvaro at gmail.com  Wed Feb 15 22:02:45 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 15 Feb 2012 23:02:45 +0100
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-1.0.0 (stable) Released.
In-Reply-To: <CB6160CA.43C38%jtansavatdi@rubiconproject.com>
References: <CB6160CA.43C38%jtansavatdi@rubiconproject.com>
Message-ID: <8A52E60F-457D-4D7B-9715-773EFA04A590@gmail.com>

Hi,

I started testing the library. I see a couple of bugs or unexpected behaviors. Also I think the API could be improved.

- Is not possible to publish messages using an empty routing key. I see that the code in amqp_exchange.c has this check:

	if (!key_len) {
		zend_throw_exception(amqp_exchange_exception_class_entry, "Could not publish to exchange. No routing key given.", 0 TSRMLS_CC);
		return;
	}

- Routing keys are not optional parameters when performing bindings. While not a bug I would expect that they will be set as an empty string by default.

Maybe the objects can implement a fluid interface? So I could write code like:

$ex->setType(AMQP_EX_TYPE_FANOUT)->setName('my_exchange')->declare();

Regards,

Alvaro

On Feb 15, 2012, at 10:19 PM, Jonathan Tansavatdi wrote:

> Just wanted to let everyone know that AMQP (a PHP extension) has been
> released to the public. This is the first stable release.
> 
>> The new PECL package amqp-1.0.0 (stable) has been released at
>> http://pecl.php.net/.
>> 
>> Release notes
>> -------------
>> 1.0.0 Release:
>> Changed/finalized API signature:
>>   * Exposing AMQPChannel
>>   * Exposing AMQPEnvelope
>>   * Exposing more queue and exchange arguments and flags
>>   * Exposing basic.qos
>> Added persistent connections
>> Cleaned up codebase
>> Fixed memory leaks and segmentation faults
>> 
>> 0.3.1 Release:
>> Fixed bug:
>>   * 24323: Cannot get the name for auto-named reply-to queues
>> 
>> 0.3.0 Release:
>> Fixed memory leaks in many functions (courtesy Jonathan Tansavatdi and
>> Andy Wick)
>> Fixed consume method to return proper values
>> Cleaned up variable usage
>> Fixed bugs:
>>   * 22638: Unexpected exit code 1 with AMQPQueue::consume()
>>   * 22698: AMQPQueue::consume
>> 
>> 0.2.2 Release:
>> Made extension compatible with PHP lt 5.3 (courtesy John Skopis)
>> Fixed wrong typing of message properties (courtesy John Skopis)
>> 
>> 0.2.1 Release:
>> Fixed refcount decrementing bug causing segfaults.
>> 
>> 0.2.0 Release:
>> Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
>> Modified AMQPConnection object:
>>   * Requires call to 'connect' method to connect (no longer connects on
>> instantiation)
>>   * Added support for disconnect and reconnect
>>   * Added helper setters for port, host, vhost, login and password
>> Improved consume method to block for MIN messages, and try to get MAX
>> messages if available
>> Fixed zval descoping bugs
>> Fixed bugs:
>>   * 17809: Couldn't compile pecl extension under PHP 5.3
>>   * 17831: Segmentation fault when the exchange doesn't exists
>>   * 19707: AMQPQueue::get() doesn't return the message
>>   * 19840: Connection Exception
>> 
>> Package Info
>> -------------
>> This extension can communicate with any AMQP spec 0-9-1 compatible
>> server, such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to
>> create and delete exchanges and queues, as well as publish to any
>> exchange and consume from any queue.
>> 
>> Related Links
>> -------------
>> Package home: http://pecl.php.net/package/amqp
>>  Changelog: http://pecl.php.net/package-changelog.php?package=amqp
>>   Download: http://pecl.php.net/get/amqp-1.0.0.tgz
>> 
>> Authors
>> -------------
>> Pieter de Zwart (lead)
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From jerryk at vmware.com  Wed Feb 15 22:09:30 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 15 Feb 2012 14:09:30 -0800 (PST)
Subject: [rabbitmq-discuss] Active/Active: shutdown of one service
	brings down the cluster
In-Reply-To: <CAFWGgNHN4Y4tT6Z4GT8E7-HQ1wOTdXMk+H4uWXpt6-9CLm57mA@mail.gmail.com>
Message-ID: <3af43f75-803a-4948-9145-95b8c4de6709@strongmad.batnest.org>

Hi, Vadim.

I apologize if I'm misunderstanding you...  I'm not entirely sure why you'd
want a *transient* queue to be HA.  Unless you've developed a mistaken 
understanding that reading from a queue when you're connected to a particular
cluster node, N, requires a mirror of that queue on the node N:  it, in fact
does not, and Rabbit will get messages from the queue internally and deliver
them to your consumer on whichever node it's connected to.

So if I'm reading you correctly and your scenario is that you want to declare 
transient queues and access them from any cluster node, then you don't have
any extra work to do.  Just declare that transient queue, period, and access
it freely.  You don't have to worry about where it is, and you'd use HA only
if you wanted the queue to remain available if the node it lived on went down.

Take a look at:  http://www.rabbitmq.com/clustering.html

It summarizes what data lives where in a cluster.  In particular, that 
"All data/state required for the operation of a RabbitMQ broker is replicated 
across all nodes, for reliability and scaling, with full ACID properties. 
An exception to this are message queues, which by default reside on the node 
that created them, though *they are visible and reachable from all nodes*."

Make sense?

Best regards,
Jerry



~~~~]
: 

----- Original Message -----
From: "Vadim Chekan" <kot.begemot at gmail.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, February 15, 2012 12:11:45 PM
Subject: Re: [rabbitmq-discuss] Active/Active: shutdown of one service brings down the cluster

Hi Jerry, 

So is there a better way to declare transient queues then declaring them as HA? 
I can see only alternative by adding a random string to queue name. And which way is preferred? 

Vadim. 


On Tue, Feb 14, 2012 at 12:45 PM, Jerry Kuch < jerryk at vmware.com > wrote: 


Hi, Vadim: 

A client doesn't need to be connected directly to the node on which 
a queue and its attendant Erlang process reside. If your load balancer 
sends you to any live node in the cluster you can consume from the queue 
of your choice, as long as it's still alive. 

Note that you can't straightforwardly redeclare a queue that had been on 
a node that's gone down. The cluster's metadata will still know about it 
and prevent you from redeclaring it. This is intentional, to avoid the 
confusion that would result if you succeeded at the redeclare, a new 
queue of the same name and properties came into existence on another node, 
and then the original, downed node came back up in the cluster... 

Best regards, 
Jerry 



----- Original Message ----- 
From: "Vadim Chekan" < kot.begemot at gmail.com > 
To: "Simon MacMullen" < simon at rabbitmq.com >, ghanna at verticalsearchworks.com 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Tuesday, February 14, 2012 12:40:05 PM 
Subject: Re: [rabbitmq-discuss] Active/Active: shutdown of one service brings down the cluster 


Hi Simon, 

Thanks for looking into the logs. Since we fixed channel leak in our application we do not experience any problems anymore. 

Regarding transient queues in HA. I am just not sure how system would behave when non-HA queue is declared in a cluster environment. Documentation describes in great details what happen to mirrored queues but I can't find anything about non-ha queue in HA cluster. Queue will be created on a single server, and application should be ready to re-declare queue in case of failover. So far so good. But how does it work with load balancer? When request is made against a server which does not have a given queue, will the cluster "know" where the queue is and proxy the request to the proper server? 

Thanks, 
Vadim. 


On Mon, Feb 13, 2012 at 10:09 AM, Simon MacMullen < simon at rabbitmq.com > wrote: 



On 10/02/12 00:20, Vadim Chekan wrote: 


I think we nailed down a problem. We had a channel leak in our 
application. With ~50 connections we had >90 channels per connection and 
growing. This definitely correlates to high CPU usage. 

What I still do not understand either it triggered rabbit into unstable 
state or it was something else. Maybe increasing latencies in message 
handling triggered cluster members into flipping neighbor aliveness 
status back and force? Just speculating here: could timeouts because of 
high load cause network fragmentation, when every node temporally does 
not see neighbors, becomes a master, than see a neighbor, freak out, etc? 

That's plausible, but I don't think that's what's happening (there's nothing about network partitioning in the logs). 




I've attached logs from all 3 cluster members. They are polluted with 
load balancer "ping". 

Thanks. I've had a poke at this but nothing is leaping out at me yet. I'll keep at it though. 

One thing that's a bit odd: you seem to be creating HA / transient / autodelete / exclusive queues. So although they're "HA", they will vanish if any of the following happens: 

* The entire cluster goes down (transient) or 
* All consumers for a queue cancel (autodelete) or 
* The connection that created them closes (exclusive) 

Is this intentional? It seems like an odd use of HA. 

Cheers, Simon 



-- 
Simon MacMullen 
RabbitMQ, VMware 



-- 

From pdezwart at rubiconproject.com  Wed Feb 15 22:48:53 2012
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Wed, 15 Feb 2012 16:48:53 -0600
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-1.0.0 (stable) Released.
In-Reply-To: <09DC8D77-0A4B-4186-8FAA-8250F39CD3B2@gmail.com>
Message-ID: <CB61763D.38560%pdezwart@rubiconproject.com>

Unfortunately, the documentation will be out of date until Friday, when
the entire PHP documentation is rebuilt. We have no control over that =(

Pieter





On 2/15/12 1:27 PM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:

>Hi,
>
>Very good news, congratulations!
>
>Are the installation instructions here:
>http://ch.php.net/manual/en/amqp.installation.php up to date?
>
>Cheers,
>
>Alvaro
>
>On Feb 15, 2012, at 10:19 PM, Jonathan Tansavatdi wrote:
>
>> Just wanted to let everyone know that AMQP (a PHP extension) has been
>> released to the public. This is the first stable release.
>> 
>>> The new PECL package amqp-1.0.0 (stable) has been released at
>>> http://pecl.php.net/.
>>> 
>>> Release notes
>>> -------------
>>> 1.0.0 Release:
>>> Changed/finalized API signature:
>>>   * Exposing AMQPChannel
>>>   * Exposing AMQPEnvelope
>>>   * Exposing more queue and exchange arguments and flags
>>>   * Exposing basic.qos
>>> Added persistent connections
>>> Cleaned up codebase
>>> Fixed memory leaks and segmentation faults
>>> 
>>> 0.3.1 Release:
>>> Fixed bug:
>>>   * 24323: Cannot get the name for auto-named reply-to queues
>>> 
>>> 0.3.0 Release:
>>> Fixed memory leaks in many functions (courtesy Jonathan Tansavatdi and
>>> Andy Wick)
>>> Fixed consume method to return proper values
>>> Cleaned up variable usage
>>> Fixed bugs:
>>>   * 22638: Unexpected exit code 1 with AMQPQueue::consume()
>>>   * 22698: AMQPQueue::consume
>>> 
>>> 0.2.2 Release:
>>> Made extension compatible with PHP lt 5.3 (courtesy John Skopis)
>>> Fixed wrong typing of message properties (courtesy John Skopis)
>>> 
>>> 0.2.1 Release:
>>> Fixed refcount decrementing bug causing segfaults.
>>> 
>>> 0.2.0 Release:
>>> Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
>>> Modified AMQPConnection object:
>>>   * Requires call to 'connect' method to connect (no longer connects on
>>> instantiation)
>>>   * Added support for disconnect and reconnect
>>>   * Added helper setters for port, host, vhost, login and password
>>> Improved consume method to block for MIN messages, and try to get MAX
>>> messages if available
>>> Fixed zval descoping bugs
>>> Fixed bugs:
>>>   * 17809: Couldn't compile pecl extension under PHP 5.3
>>>   * 17831: Segmentation fault when the exchange doesn't exists
>>>   * 19707: AMQPQueue::get() doesn't return the message
>>>   * 19840: Connection Exception
>>> 
>>> Package Info
>>> -------------
>>> This extension can communicate with any AMQP spec 0-9-1 compatible
>>> server, such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to
>>> create and delete exchanges and queues, as well as publish to any
>>> exchange and consume from any queue.
>>> 
>>> Related Links
>>> -------------
>>> Package home: http://pecl.php.net/package/amqp
>>>  Changelog: http://pecl.php.net/package-changelog.php?package=amqp
>>>   Download: http://pecl.php.net/get/amqp-1.0.0.tgz
>>> 
>>> Authors
>>> -------------
>>> Pieter de Zwart (lead)
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>Sent form my Nokia 1100
>
>
>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From pdezwart at rubiconproject.com  Wed Feb 15 22:50:27 2012
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Wed, 15 Feb 2012 16:50:27 -0600
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-1.0.0 (stable) Released.
In-Reply-To: <8A52E60F-457D-4D7B-9715-773EFA04A590@gmail.com>
Message-ID: <CB617672.38563%pdezwart@rubiconproject.com>

Hey Alvaro,

These are great points, and easy fixes. I had no idea empty routing keys
were permissible! As for the fluid interface, that too is a pretty easy
fix. We will put this on the roadmap for 1.1.

Thanks!
Pieter





On 2/15/12 2:02 PM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:

>Hi,
>
>I started testing the library. I see a couple of bugs or unexpected
>behaviors. Also I think the API could be improved.
>
>- Is not possible to publish messages using an empty routing key. I see
>that the code in amqp_exchange.c has this check:
>
>	if (!key_len) {
>		zend_throw_exception(amqp_exchange_exception_class_entry, "Could not
>publish to exchange. No routing key given.", 0 TSRMLS_CC);
>		return;
>	}
>
>- Routing keys are not optional parameters when performing bindings.
>While not a bug I would expect that they will be set as an empty string
>by default.
>
>Maybe the objects can implement a fluid interface? So I could write code
>like:
>
>$ex->setType(AMQP_EX_TYPE_FANOUT)->setName('my_exchange')->declare();
>
>Regards,
>
>Alvaro
>
>On Feb 15, 2012, at 10:19 PM, Jonathan Tansavatdi wrote:
>
>> Just wanted to let everyone know that AMQP (a PHP extension) has been
>> released to the public. This is the first stable release.
>> 
>>> The new PECL package amqp-1.0.0 (stable) has been released at
>>> http://pecl.php.net/.
>>> 
>>> Release notes
>>> -------------
>>> 1.0.0 Release:
>>> Changed/finalized API signature:
>>>   * Exposing AMQPChannel
>>>   * Exposing AMQPEnvelope
>>>   * Exposing more queue and exchange arguments and flags
>>>   * Exposing basic.qos
>>> Added persistent connections
>>> Cleaned up codebase
>>> Fixed memory leaks and segmentation faults
>>> 
>>> 0.3.1 Release:
>>> Fixed bug:
>>>   * 24323: Cannot get the name for auto-named reply-to queues
>>> 
>>> 0.3.0 Release:
>>> Fixed memory leaks in many functions (courtesy Jonathan Tansavatdi and
>>> Andy Wick)
>>> Fixed consume method to return proper values
>>> Cleaned up variable usage
>>> Fixed bugs:
>>>   * 22638: Unexpected exit code 1 with AMQPQueue::consume()
>>>   * 22698: AMQPQueue::consume
>>> 
>>> 0.2.2 Release:
>>> Made extension compatible with PHP lt 5.3 (courtesy John Skopis)
>>> Fixed wrong typing of message properties (courtesy John Skopis)
>>> 
>>> 0.2.1 Release:
>>> Fixed refcount decrementing bug causing segfaults.
>>> 
>>> 0.2.0 Release:
>>> Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
>>> Modified AMQPConnection object:
>>>   * Requires call to 'connect' method to connect (no longer connects on
>>> instantiation)
>>>   * Added support for disconnect and reconnect
>>>   * Added helper setters for port, host, vhost, login and password
>>> Improved consume method to block for MIN messages, and try to get MAX
>>> messages if available
>>> Fixed zval descoping bugs
>>> Fixed bugs:
>>>   * 17809: Couldn't compile pecl extension under PHP 5.3
>>>   * 17831: Segmentation fault when the exchange doesn't exists
>>>   * 19707: AMQPQueue::get() doesn't return the message
>>>   * 19840: Connection Exception
>>> 
>>> Package Info
>>> -------------
>>> This extension can communicate with any AMQP spec 0-9-1 compatible
>>> server, such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to
>>> create and delete exchanges and queues, as well as publish to any
>>> exchange and consume from any queue.
>>> 
>>> Related Links
>>> -------------
>>> Package home: http://pecl.php.net/package/amqp
>>>  Changelog: http://pecl.php.net/package-changelog.php?package=amqp
>>>   Download: http://pecl.php.net/get/amqp-1.0.0.tgz
>>> 
>>> Authors
>>> -------------
>>> Pieter de Zwart (lead)
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>Sent form my Nokia 1100
>
>
>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From videlalvaro at gmail.com  Wed Feb 15 22:58:05 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 15 Feb 2012 23:58:05 +0100
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-1.0.0 (stable) Released.
In-Reply-To: <CB617672.38563%pdezwart@rubiconproject.com>
References: <CB617672.38563%pdezwart@rubiconproject.com>
Message-ID: <A815FB9C-4FF0-451A-90D9-C09DF6860B99@gmail.com>

Hi Pieter.

Pretty cool.

I just ran some silly tests in my Mac so delivering 1kb messages with 3 consumers listening on the other end gives me around 8000 msgs/sec which is about 8 times faster than the plain PHP library. 

If I have time I will try to port or add an adapter to the Symfony Bundle for your library.

Cheers,

Alvaro

On Feb 15, 2012, at 11:50 PM, Pieter de Zwart wrote:

> Hey Alvaro,
> 
> These are great points, and easy fixes. I had no idea empty routing keys
> were permissible! As for the fluid interface, that too is a pretty easy
> fix. We will put this on the roadmap for 1.1.
> 
> Thanks!
> Pieter
> 
> 
> 
> 
> 
> On 2/15/12 2:02 PM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:
> 
>> Hi,
>> 
>> I started testing the library. I see a couple of bugs or unexpected
>> behaviors. Also I think the API could be improved.
>> 
>> - Is not possible to publish messages using an empty routing key. I see
>> that the code in amqp_exchange.c has this check:
>> 
>> 	if (!key_len) {
>> 		zend_throw_exception(amqp_exchange_exception_class_entry, "Could not
>> publish to exchange. No routing key given.", 0 TSRMLS_CC);
>> 		return;
>> 	}
>> 
>> - Routing keys are not optional parameters when performing bindings.
>> While not a bug I would expect that they will be set as an empty string
>> by default.
>> 
>> Maybe the objects can implement a fluid interface? So I could write code
>> like:
>> 
>> $ex->setType(AMQP_EX_TYPE_FANOUT)->setName('my_exchange')->declare();
>> 
>> Regards,
>> 
>> Alvaro
>> 
>> On Feb 15, 2012, at 10:19 PM, Jonathan Tansavatdi wrote:
>> 
>>> Just wanted to let everyone know that AMQP (a PHP extension) has been
>>> released to the public. This is the first stable release.
>>> 
>>>> The new PECL package amqp-1.0.0 (stable) has been released at
>>>> http://pecl.php.net/.
>>>> 
>>>> Release notes
>>>> -------------
>>>> 1.0.0 Release:
>>>> Changed/finalized API signature:
>>>>  * Exposing AMQPChannel
>>>>  * Exposing AMQPEnvelope
>>>>  * Exposing more queue and exchange arguments and flags
>>>>  * Exposing basic.qos
>>>> Added persistent connections
>>>> Cleaned up codebase
>>>> Fixed memory leaks and segmentation faults
>>>> 
>>>> 0.3.1 Release:
>>>> Fixed bug:
>>>>  * 24323: Cannot get the name for auto-named reply-to queues
>>>> 
>>>> 0.3.0 Release:
>>>> Fixed memory leaks in many functions (courtesy Jonathan Tansavatdi and
>>>> Andy Wick)
>>>> Fixed consume method to return proper values
>>>> Cleaned up variable usage
>>>> Fixed bugs:
>>>>  * 22638: Unexpected exit code 1 with AMQPQueue::consume()
>>>>  * 22698: AMQPQueue::consume
>>>> 
>>>> 0.2.2 Release:
>>>> Made extension compatible with PHP lt 5.3 (courtesy John Skopis)
>>>> Fixed wrong typing of message properties (courtesy John Skopis)
>>>> 
>>>> 0.2.1 Release:
>>>> Fixed refcount decrementing bug causing segfaults.
>>>> 
>>>> 0.2.0 Release:
>>>> Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
>>>> Modified AMQPConnection object:
>>>>  * Requires call to 'connect' method to connect (no longer connects on
>>>> instantiation)
>>>>  * Added support for disconnect and reconnect
>>>>  * Added helper setters for port, host, vhost, login and password
>>>> Improved consume method to block for MIN messages, and try to get MAX
>>>> messages if available
>>>> Fixed zval descoping bugs
>>>> Fixed bugs:
>>>>  * 17809: Couldn't compile pecl extension under PHP 5.3
>>>>  * 17831: Segmentation fault when the exchange doesn't exists
>>>>  * 19707: AMQPQueue::get() doesn't return the message
>>>>  * 19840: Connection Exception
>>>> 
>>>> Package Info
>>>> -------------
>>>> This extension can communicate with any AMQP spec 0-9-1 compatible
>>>> server, such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to
>>>> create and delete exchanges and queues, as well as publish to any
>>>> exchange and consume from any queue.
>>>> 
>>>> Related Links
>>>> -------------
>>>> Package home: http://pecl.php.net/package/amqp
>>>> Changelog: http://pecl.php.net/package-changelog.php?package=amqp
>>>>  Download: http://pecl.php.net/get/amqp-1.0.0.tgz
>>>> 
>>>> Authors
>>>> -------------
>>>> Pieter de Zwart (lead)
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> Sent form my Nokia 1100
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

Sent form my Nokia 1100




From michael.s.klishin at gmail.com  Thu Feb 16 00:02:13 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 16 Feb 2012 04:02:13 +0400
Subject: [rabbitmq-discuss] [announcement] Ruby amqp gem 0.9.4 is released
Message-ID: <E377D6B0-4457-4244-A9FA-C709230DC44F@gmail.com>

Ruby amqp gem 0.9.4 is released to rubygems.org [1]. This is a bug fix release:

* AMQP::Queue#initialize no longer fails with NoMethodError when :nowait is set to true

Kudos to Eran Levi for reporting the issue.


CI status
-----------------------------------------------------------

* http://travis-ci.org/#!/ruby-amqp/amqp
* http://travis-ci.org/#!/ruby-amqp/amq-client


Documentation site updates
-----------------------------------------------------------

In other news, we have fixed several minor styling and legibility issues on http://rubyamqp.info,
amqp gem's documentation guides site.


1. https://rubygems.org/gems/amqp/versions/0.9.4

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From james.mcmahon at TASC.COM  Thu Feb 16 00:45:49 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Thu, 16 Feb 2012 00:45:49 +0000
Subject: [rabbitmq-discuss] Persisting Messages on a Direct Exchange,
 Selectively Looking for Particular Messages
Message-ID: <C974010E949511448F6DC6F748F604D90FEB0A4E@TSEAMB01>


Good evening. I am a new user of rabbitMQ. I have worked through the rabbitMQ tutorials and implemented a very simple direct exchange queue.

How would one persist messages on the directed exchange? I want to do this so that a consumer in a while loop will see the messages right when they are posted, and other instances of consumers can pull a message selectively off the queue. This latter group may issue such a request after the original message has been posted.

My messages are directed to exchanges by a qmsgTarget field. My messages have a field in their structure called srcId. My messages also have a field in their structure called seqNum. Thus a consumer may wish to say "Please get me message 3 from srcid 666 from the qmsgtarget Server direct exchange". Another consumer may later issue the same request, so this third message in the sequence for srcid 666 must remain on the directed exchange.

I will be implementing a method deleteQmsg() that I intend to use to delete messages selectively.

Is it possible using rabbitMQ to implement this? Can anyone point me towards a similar example?

- nyg_fan

CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/e1ce97ac/attachment.htm>

From kot.begemot at gmail.com  Thu Feb 16 03:37:00 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Wed, 15 Feb 2012 19:37:00 -0800
Subject: [rabbitmq-discuss] Active/Active: shutdown of one service
 brings down the cluster
In-Reply-To: <3af43f75-803a-4948-9145-95b8c4de6709@strongmad.batnest.org>
References: <CAFWGgNHN4Y4tT6Z4GT8E7-HQ1wOTdXMk+H4uWXpt6-9CLm57mA@mail.gmail.com>
	<3af43f75-803a-4948-9145-95b8c4de6709@strongmad.batnest.org>
Message-ID: <CAFWGgNGQuJ3DnfX4xLnPu2LTF0=fPzeQQb1+ELLtyGK+TXkWoQ@mail.gmail.com>

Hi Jerry,

My use case is a typical pub/sub. There is a farm of applications which
broadcast their state to eachother periodically. Each app creates its own
queue and binds it to a well-known broadcast (fanout) exchange.
  It is typical for pub/sub to use transient queues.
Besides pub/sub broadcast, applications use messaging for critical use
cases, such as quick cache invalidation, that's why HA is configured.

> Note that you can't straightforwardly redeclare a queue that had been on
> a node that's gone down.  The cluster's metadata will still know about it
> and prevent you from redeclaring it.

The above is the only reason I still declare transient queue an HA. I
wouldn't like it when a failed node cause errors in applications.

Unless you mean that the above applies to a persistent queue only?
Otherwise I do not see how transient queue can be used in a cluster
environment. If a node goes down and there is no way to re-declare a queue
with the same name, it very likely breaks the application tier.

To summarize,
  critical use cases -> HA cluster (AKA active/active)
  pub/sub use case -> transient queues
  don't want failed node to cause lost queue -> forced to declare transient
HA queue?

Thanks,
Vadim.

On Wed, Feb 15, 2012 at 2:09 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Vadim.
>
> I apologize if I'm misunderstanding you...  I'm not entirely sure why you'd
> want a *transient* queue to be HA.  Unless you've developed a mistaken
> understanding that reading from a queue when you're connected to a
> particular
> cluster node, N, requires a mirror of that queue on the node N:  it, in
> fact
> does not, and Rabbit will get messages from the queue internally and
> deliver
> them to your consumer on whichever node it's connected to.
>
> So if I'm reading you correctly and your scenario is that you want to
> declare
> transient queues and access them from any cluster node, then you don't have
> any extra work to do.  Just declare that transient queue, period, and
> access
> it freely.  You don't have to worry about where it is, and you'd use HA
> only
> if you wanted the queue to remain available if the node it lived on went
> down.
>
> Take a look at:  http://www.rabbitmq.com/clustering.html
>
> It summarizes what data lives where in a cluster.  In particular, that
> "All data/state required for the operation of a RabbitMQ broker is
> replicated
> across all nodes, for reliability and scaling, with full ACID properties.
> An exception to this are message queues, which by default reside on the
> node
> that created them, though *they are visible and reachable from all nodes*."
>
> Make sense?
>
> Best regards,
> Jerry
>
>
>
> ~~~~]
> :
>
> ----- Original Message -----
> From: "Vadim Chekan" <kot.begemot at gmail.com>
> To: "Jerry Kuch" <jerryk at vmware.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Wednesday, February 15, 2012 12:11:45 PM
> Subject: Re: [rabbitmq-discuss] Active/Active: shutdown of one service
> brings down the cluster
>
> Hi Jerry,
>
> So is there a better way to declare transient queues then declaring them
> as HA?
> I can see only alternative by adding a random string to queue name. And
> which way is preferred?
>
> Vadim.
>
>
> On Tue, Feb 14, 2012 at 12:45 PM, Jerry Kuch < jerryk at vmware.com > wrote:
>
>
> Hi, Vadim:
>
> A client doesn't need to be connected directly to the node on which
> a queue and its attendant Erlang process reside. If your load balancer
> sends you to any live node in the cluster you can consume from the queue
> of your choice, as long as it's still alive.
>
> Note that you can't straightforwardly redeclare a queue that had been on
> a node that's gone down. The cluster's metadata will still know about it
> and prevent you from redeclaring it. This is intentional, to avoid the
> confusion that would result if you succeeded at the redeclare, a new
> queue of the same name and properties came into existence on another node,
> and then the original, downed node came back up in the cluster...
>
> Best regards,
> Jerry
>
>
>
> ----- Original Message -----
> From: "Vadim Chekan" < kot.begemot at gmail.com >
> To: "Simon MacMullen" < simon at rabbitmq.com >,
> ghanna at verticalsearchworks.com
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Tuesday, February 14, 2012 12:40:05 PM
> Subject: Re: [rabbitmq-discuss] Active/Active: shutdown of one service
> brings down the cluster
>
>
> Hi Simon,
>
> Thanks for looking into the logs. Since we fixed channel leak in our
> application we do not experience any problems anymore.
>
> Regarding transient queues in HA. I am just not sure how system would
> behave when non-HA queue is declared in a cluster environment.
> Documentation describes in great details what happen to mirrored queues but
> I can't find anything about non-ha queue in HA cluster. Queue will be
> created on a single server, and application should be ready to re-declare
> queue in case of failover. So far so good. But how does it work with load
> balancer? When request is made against a server which does not have a given
> queue, will the cluster "know" where the queue is and proxy the request to
> the proper server?
>
> Thanks,
> Vadim.
>
>
> On Mon, Feb 13, 2012 at 10:09 AM, Simon MacMullen < simon at rabbitmq.com >
> wrote:
>
>
>
> On 10/02/12 00:20, Vadim Chekan wrote:
>
>
> I think we nailed down a problem. We had a channel leak in our
> application. With ~50 connections we had >90 channels per connection and
> growing. This definitely correlates to high CPU usage.
>
> What I still do not understand either it triggered rabbit into unstable
> state or it was something else. Maybe increasing latencies in message
> handling triggered cluster members into flipping neighbor aliveness
> status back and force? Just speculating here: could timeouts because of
> high load cause network fragmentation, when every node temporally does
> not see neighbors, becomes a master, than see a neighbor, freak out, etc?
>
> That's plausible, but I don't think that's what's happening (there's
> nothing about network partitioning in the logs).
>
>
>
>
> I've attached logs from all 3 cluster members. They are polluted with
> load balancer "ping".
>
> Thanks. I've had a poke at this but nothing is leaping out at me yet. I'll
> keep at it though.
>
> One thing that's a bit odd: you seem to be creating HA / transient /
> autodelete / exclusive queues. So although they're "HA", they will vanish
> if any of the following happens:
>
> * The entire cluster goes down (transient) or
> * All consumers for a queue cancel (autodelete) or
> * The connection that created them closes (exclusive)
>
> Is this intentional? It seems like an odd use of HA.
>
> Cheers, Simon
>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
>
>
> --
> From RFC 2631: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT is
> explicitly specified
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> --
> From RFC 2631: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT is
> explicitly specified
>



-- 

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.0.1329363845.2884.rabbitmq-discuss@lists.rabbitmq.com>

explicitly specified

--e89a8ff253187c01a204b90c8af0
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi Jerry,<br><br>My use case is a typical pub/sub. There is a farm of appli=
cations which broadcast their state to eachother periodically. Each app cre=
ates its own queue and binds it to a well-known broadcast (fanout) exchange=
.<br>
=A0 It is typical for pub/sub to use transient queues.<br>Besides pub/sub b=
roadcast, applications use messaging for critical use cases, such as quick =
cache invalidation, that&#39;s why HA is configured.<br><br>&gt; Note that =
you can&#39;t straightforwardly redeclare a queue that had been on<br>
&gt; a node that&#39;s gone down. =A0The cluster&#39;s metadata will still =
know about it<br>&gt; and prevent you from redeclaring it.<br><br>The above=
 is the only reason I still declare transient queue an HA. I wouldn&#39;t l=
ike it when a failed node cause errors in applications.<br>
<br>Unless you mean that the above applies to a persistent queue only? Othe=
rwise I do not see how transient queue can be used in a cluster environment=
. If a node goes down and there is no way to re-declare a queue with the sa=
me name, it very likely breaks the application tier.<br>
<br>To summarize, <br>=A0 critical use cases -&gt; HA cluster (AKA active/a=
ctive)<br>=A0 pub/sub use case -&gt; transient queues<br>=A0 don&#39;t want=
 failed node to cause lost queue -&gt; forced to declare transient HA queue=
?<br>
<br>Thanks,<br>Vadim.<br><br><div class=3D"gmail_quote">On Wed, Feb 15, 201=
2 at 2:09 PM, Jerry Kuch <span dir=3D"ltr">&lt;<a href=3D"mailto:jerryk at vmw=
are.com">jerryk at vmware.com</a>&gt;</span> wrote:<br><blockquote class=3D"gm=
ail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-le=
ft:1ex">
Hi, Vadim.<br>
<br>
I apologize if I&#39;m misunderstanding you... =A0I&#39;m not entirely sure=
 why you&#39;d<br>
want a *transient* queue to be HA. =A0Unless you&#39;ve developed a mistake=
n<br>
understanding that reading from a queue when you&#39;re connected to a part=
icular<br>
cluster node, N, requires a mirror of that queue on the node N: =A0it, in f=
act<br>
does not, and Rabbit will get messages from the queue internally and delive=
r<br>
them to your consumer on whichever node it&#39;s connected to.<br>
<br>
So if I&#39;m reading you correctly and your scenario is that you want to d=
eclare<br>
transient queues and access them from any cluster node, then you don&#39;t =
have<br>
any extra work to do. =A0Just declare that transient queue, period, and acc=
ess<br>
it freely. =A0You don&#39;t have to worry about where it is, and you&#39;d =
use HA only<br>
if you wanted the queue to remain available if the node it lived on went do=
wn.<br>
<br>
Take a look at: =A0<a href=3D"http://www.rabbitmq.com/clustering.html" targ=
et=3D"_blank">http://www.rabbitmq.com/clustering.html</a><br>
<br>
It summarizes what data lives where in a cluster. =A0In particular, that<br=
>
&quot;All data/state required for the operation of a RabbitMQ broker is rep=
licated<br>
across all nodes, for reliability and scaling, with full ACID properties.<b=
r>
An exception to this are message queues, which by default reside on the nod=
e<br>
that created them, though *they are visible and reachable from all nodes*.&=
quot;<br>
<br>
Make sense?<br>
<br>
Best regards,<br>
Jerry<br>
<br>
<br>
<br>
~~~~]<br>
:<br>
<div class=3D"im HOEnZb"><br>
----- Original Message -----<br>
From: &quot;Vadim Chekan&quot; &lt;<a href=3D"mailto:kot.begemot at gmail.com"=
>kot.begemot at gmail.com</a>&gt;<br>
</div><div class=3D"HOEnZb"><div class=3D"h5">To: &quot;Jerry Kuch&quot; &l=
t;<a href=3D"mailto:jerryk at vmware.com">jerryk at vmware.com</a>&gt;<br>
Cc: <a href=3D"mailto:rabbitmq-discuss at lists.rabbitmq.com">rabbitmq-discuss=
@lists.rabbitmq.com</a><br>
Sent: Wednesday, February 15, 2012 12:11:45 PM<br>
Subject: Re: [rabbitmq-discuss] Active/Active: shutdown of one service brin=
gs down the cluster<br>
<br>
Hi Jerry,<br>
<br>
So is there a better way to declare transient queues then declaring them as=
 HA?<br>
I can see only alternative by adding a random string to queue name. And whi=
ch way is preferred?<br>
<br>
Vadim.<br>
<br>
<br>
On Tue, Feb 14, 2012 at 12:45 PM, Jerry Kuch &lt; <a href=3D"mailto:jerryk@=
vmware.com">jerryk at vmware.com</a> &gt; wrote:<br>
<br>
<br>
Hi, Vadim:<br>
<br>
A client doesn&#39;t need to be connected directly to the node on which<br>
a queue and its attendant Erlang process reside. If your load balancer<br>
sends you to any live node in the cluster you can consume from the queue<br=
>
of your choice, as long as it&#39;s still alive.<br>
<br>
Note that you can&#39;t straightforwardly redeclare a queue that had been o=
n<br>
a node that&#39;s gone down. The cluster&#39;s metadata will still know abo=
ut it<br>
and prevent you from redeclaring it. This is intentional, to avoid the<br>
confusion that would result if you succeeded at the redeclare, a new<br>
queue of the same name and properties came into existence on another node,<=
br>
and then the original, downed node came back up in the cluster...<br>
<br>
Best regards,<br>
Jerry<br>
<br>
<br>
<br>
----- Original Message -----<br>
From: &quot;Vadim Chekan&quot; &lt; <a href=3D"mailto:kot.begemot at gmail.com=
">kot.begemot at gmail.com</a> &gt;<br>
To: &quot;Simon MacMullen&quot; &lt; <a href=3D"mailto:simon at rabbitmq.com">=
simon at rabbitmq.com</a> &gt;, <a href=3D"mailto:ghanna at verticalsearchworks.c=
om">ghanna at verticalsearchworks.com</a><br>
Cc: <a href=3D"mailto:rabbitmq-discuss at lists.rabbitmq.com">rabbitmq-discuss=
@lists.rabbitmq.com</a><br>
Sent: Tuesday, February 14, 2012 12:40:05 PM<br>
Subject: Re: [rabbitmq-discuss] Active/Active: shutdown of one service brin=
gs down the cluster<br>
<br>
<br>
Hi Simon,<br>
<br>
Thanks for looking into the logs. Since we fixed channel leak in our applic=
ation we do not experience any problems anymore.<br>
<br>
Regarding transient queues in HA. I am just not sure how system would behav=
e when non-HA queue is declared in a cluster environment. Documentation des=
cribes in great details what happen to mirrored queues but I can&#39;t find=
 anything about non-ha queue in HA cluster. Queue will be created on a sing=
le server, and application should be ready to re-declare queue in case of f=
ailover. So far so good. But how does it work with load balancer? When requ=
est is made against a server which does not have a given queue, will the cl=
uster &quot;know&quot; where the queue is and proxy the request to the prop=
er server?<br>

<br>
Thanks,<br>
Vadim.<br>
<br>
<br>
On Mon, Feb 13, 2012 at 10:09 AM, Simon MacMullen &lt; <a href=3D"mailto:si=
mon at rabbitmq.com">simon at rabbitmq.com</a> &gt; wrote:<br>
<br>
<br>
<br>
On 10/02/12 00:20, Vadim Chekan wrote:<br>
<br>
<br>
I think we nailed down a problem. We had a channel leak in our<br>
application. With ~50 connections we had &gt;90 channels per connection and=
<br>
growing. This definitely correlates to high CPU usage.<br>
<br>
What I still do not understand either it triggered rabbit into unstable<br>
state or it was something else. Maybe increasing latencies in message<br>
handling triggered cluster members into flipping neighbor aliveness<br>
status back and force? Just speculating here: could timeouts because of<br>
high load cause network fragmentation, when every node temporally does<br>
not see neighbors, becomes a master, than see a neighbor, freak out, etc?<b=
r>
<br>
That&#39;s plausible, but I don&#39;t think that&#39;s what&#39;s happening=
 (there&#39;s nothing about network partitioning in the logs).<br>
<br>
<br>
<br>
<br>
I&#39;ve attached logs from all 3 cluster members. They are polluted with<b=
r>
load balancer &quot;ping&quot;.<br>
<br>
Thanks. I&#39;ve had a poke at this but nothing is leaping out at me yet. I=
&#39;ll keep at it though.<br>
<br>
One thing that&#39;s a bit odd: you seem to be creating HA / transient / au=
todelete / exclusive queues. So although they&#39;re &quot;HA&quot;, they w=
ill vanish if any of the following happens:<br>
<br>
* The entire cluster goes down (transient) or<br>
* All consumers for a queue cancel (autodelete) or<br>
* The connection that created them closes (exclusive)<br>
<br>
Is this intentional? It seems like an odd use of HA.<br>
<br>
Cheers, Simon<br>
<br>
<br>
<br>
--<br>
Simon MacMullen<br>
RabbitMQ, VMware<br>
<br>
<br>
<br>
--<br>

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.1.1329363845.2884.rabbitmq-discuss@lists.rabbitmq.com>

plicitly specified<br>
<br>
<br>
<br>
_______________________________________________<br>
rabbitmq-discuss mailing list<br>
<a href=3D"mailto:rabbitmq-discuss at lists.rabbitmq.com">rabbitmq-discuss at lis=
ts.rabbitmq.com</a><br>
<a href=3D"https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-dis=
cuss" target=3D"_blank">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo=
/rabbitmq-discuss</a><br>
<br>
<br>
<br>
--<br>

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.2.1329363845.2884.rabbitmq-discuss@lists.rabbitmq.com>

plicitly specified<br>
</div></div></blockquote></div><br><br clear=3D"all"><br>-- <br>From RFC 26=
31: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT is explicitly sp=
ecified<br>

--e89a8ff253187c01a204b90c8af0--

From alan.antonuk at gmail.com  Thu Feb 16 05:32:06 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 16 Feb 2012 00:32:06 -0500
Subject: [rabbitmq-discuss] rabbitmq-c: Nonblocking recv
In-Reply-To: <3663841.2.1329332313215.JavaMail.geo-discussion-forums@vbnd9>
References: <3663841.2.1329332313215.JavaMail.geo-discussion-forums@vbnd9>
Message-ID: <CAAt2poLm3rmD6SsBOoQ089+LSd6kKMrcxQhr=0C2Vz62T9gnrQ@mail.gmail.com>

Arun;

I agree with the method used in the gist linked in your email:

First check amqp_frames_enqueued(). If this returns true, there are decoded
frames ready, amqp_simple_wait_frame() will not block.

Second check amqp_data_in_buffer(). If this returns true, there is data
that has already been received (with recv()) but not decoded. It is likely
if you call amqp_simple_wait_frame() it will not block. However if the data
in the buffer doesn't complete a frame, recv() will be called and may block.

Third, call select() or poll() on the socket associated with the connection
(you can use amqp_get_sockfd() to get the socket descriptor). If this
system call shows that the socket can be read from amqp_simple_wait_frame()
will call recv() and likely won't block - assuming a full frame is received.

As you may notice the last two steps don't give you a "correct all the
time" answer to whether amqp_simple_wait_frame() will block or not. In
practice I've found the majority of the time the above works well enough
for RPC-style AMQP messaging for the following two reasons:
1. When the broker sends data - typically it sends it as an entire frame,
if your select() call returns that there is data in the buffer likely you
already have, or soon will have an entire frame ready to be read by recv()
2. AMQP is intended to be run on a low-latency, high-bandwidth LAN, so if
you do get a partial frame when recv is called, within a short time period
you will receive the rest of the frame, otherwise it is likely something
serious has happened and that will cause the whole connection to die at
some point in the near future (possibly time out - which I grant you can
possibly block for a lengthy amount of time).

There is definitely room for improvement in the rabbitmq-c library handles
non-blocking behavior.

HTH
-Alan

On Feb 15, 2012, at 2:28 PM, Brett Cameron wrote:

Arun,

I'd look at implementing something along the lines of what Alex describes
in the link using select() or poll(). Have cc'd Alan for his consideration
as to how this might best be done. The approach outlined by Alex in the
link is okay, but you could still potentially find yourself hanging on a
blocked read if something bad happened between the initial check for data
available and a read operation. An alternative might be to add a timeout
parameter to the wait_frame call or create a variant of this function that
includes a timeout...

Regards,
Brett

On Thu, Feb 16, 2012 at 7:58 AM, Arun Chandrasekaran <visionofarun at gmail.com
> wrote:

> Hi all,
>
> How do we make a non blocking recv from librabbitmq?
> amqp_simple_wait_frame blocks if the queue doesn't contain any message.
>
> Should we call amqp_data_in_buffer() and based on the result call
> amqp_simple_wait_frame or implement a solution like this?
>
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/014868.html
>
> Thanks in advance.
>
> - Arun
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/05ca4675/attachment.html>

From emile at rabbitmq.com  Thu Feb 16 10:34:33 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Feb 2012 10:34:33 +0000
Subject: [rabbitmq-discuss] rabbitMQ management tool not showing
 messages delivered
In-Reply-To: <CB6178B4.1165D%jim.langston@compuware.com>
References: <CB6178B4.1165D%jim.langston@compuware.com>
Message-ID: <4F3CDBB9.4000601@rabbitmq.com>

Hi Jim,

On 15/02/12 20:01, Langston, Jim wrote:
> Also, how is the value to be presented as deliver/get being calculated?

This statistic is the rate at which messages are delivered to consumers.
The value is calculated by dividing the number of deliveries by the time
period over which they were recorded.

> I've been looking at rabbitmqctl commands that would be let me do the same
> independent of the mgmt interface. Is there a way to get those values?

The rabbitmqctl tool does not report message rates, so that comparison
is not directly possible.


-Emile

From taylste at gmail.com  Thu Feb 16 10:38:36 2012
From: taylste at gmail.com (Steven Taylor)
Date: Thu, 16 Feb 2012 10:38:36 +0000
Subject: [rabbitmq-discuss] alternate exchange
Message-ID: <CA+zYriQQD1jnHfW3E-mhD9=OkabTEZOVe+K6A1p=Wg68v3oQ-A@mail.gmail.com>

Hi,

just looking at the example for alternate exchanges here
http://www.rabbitmq.com/extensions.html

In this example, is the routing key of "" -- in
channel.queueBind("unrouted", "my-ae", ""); like the default in a switch
statement

Will Rabbit try to first deliver an unrouted message to the same rout on
the alternate exchange.

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/a8ef1103/attachment.htm>

From Massimo.Paladin at cern.ch  Thu Feb 16 10:56:08 2012
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Thu, 16 Feb 2012 11:56:08 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin and ability to read
 configuration files
In-Reply-To: <4F393239.5000707@rabbitmq.com>
References: <CAMOXM2-yT_ZSX4_FkJpnh=GFX4_QT8pLKt+j8pnnZF6QHp1BmA@mail.gmail.com>
	<4F33DFC9.60903@rabbitmq.com>
	<CAMOXM28oeg5E=7x1+dLrPdkt_r21_G1j=Nh8hX+X8i5yq60ZJA@mail.gmail.com>
	<4F393239.5000707@rabbitmq.com>
Message-ID: <CAMOXM29HisUL=ERb6B1wgUv+6Hgh4jOuUL2a1b5gyHVrrrVeSw@mail.gmail.com>

Simon,

thanks for the changes.

We made other changes that would be good if they could be merged:
- if configuration file is specified and node is not specified it could
  allow strange behaviors, we thought it would be nice if it would look
  for a "default" node in the configuration file.
  Please note that this is done only if the configuration file is given,
  else it would always look for the default config file and node "default"
  if default config files would be present.
- the default vhost "/" (line 517 of your version) was not configurable.
  vhost is treated differently for list and declare, the current situation
  does not allow to define a vhost in the configuration file.
  Adding a default_vhost to the configuration file allow the possibility
  to configure every parameter from the configuration file independently
  from the sub command executed. (which is not the case in the current
version)
- die was printing messages without going to new line

Updated script is available at:
https://github.com/mpaladin/rabbitmq-custom/blob/master/rabbitmqadmin/rabbitmqadmin

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Mon, Feb 13, 2012 at 4:54 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 10/02/12 19:06, Massimo Paladin wrote:
>
>> Now it tries to read from ~/.rabbitmqadmin.conf if node is specified and
>> the config file is not passed.
>>
>
> Thanks. I've merged your changes (+ some more tweaks).
>
>
>  I am going to look at bash completion soon.
>>
>
> Of course that's a nice-to-have :-) I don't know if anyone apart from me
> uses rabbitmqadmin bash completion...
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/0af04715/attachment.htm>

From emile at rabbitmq.com  Thu Feb 16 11:01:09 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Feb 2012 11:01:09 +0000
Subject: [rabbitmq-discuss] Persisting Messages on a Direct Exchange,
 Selectively Looking for Particular Messages
In-Reply-To: <C974010E949511448F6DC6F748F604D90FEB0A4E@TSEAMB01>
References: <C974010E949511448F6DC6F748F604D90FEB0A4E@TSEAMB01>
Message-ID: <4F3CE1F5.6080302@rabbitmq.com>

Hi James,

On 16/02/12 00:45, McMahon, James S (TASC) wrote:
> How would one persist messages on the directed exchange? I want to do

You can guarantee that messages are persisted by declaring queues as
durable and setting the delivery-mode to 2. The exchange plays no part
in determining whether a message will be persisted.

> My messages are directed to exchanges by a qmsgTarget field. My messages
> have a field in their structure called srcId. My messages also have a
> field in their structure called seqNum. Thus a consumer may wish to say
> "Please get me message 3 from srcid 666 from the qmsgtarget Server
> direct exchange". Another consumer may later issue the same request, so
> this third message in the sequence for srcid 666 must remain on the
> directed exchange.

Messages are stored in queues, and exchanges maintain no state. If you
need multiple consumers to receive the same message then you should
route the message to multiple queues (tutorial 3). If you need to route
messages based on headers then you will find the headers exchange useful:
http://www.rabbitmq.com/tutorials/amqp-concepts.html#exchange-headers

> I will be implementing a method deleteQmsg() that I intend to use to
> delete messages selectively.

Queues are not well suited to selective manipulation of messages beyond
the head of the queue. If the problem cannot be expressed in terms of
messaging then a relational database is more suitable for your purposes
than a message broker.



-Emile

From emile at rabbitmq.com  Thu Feb 16 11:11:32 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Feb 2012 11:11:32 +0000
Subject: [rabbitmq-discuss] alternate exchange
In-Reply-To: <CA+zYriQQD1jnHfW3E-mhD9=OkabTEZOVe+K6A1p=Wg68v3oQ-A@mail.gmail.com>
References: <CA+zYriQQD1jnHfW3E-mhD9=OkabTEZOVe+K6A1p=Wg68v3oQ-A@mail.gmail.com>
Message-ID: <4F3CE464.1080101@rabbitmq.com>

Hi Steven,

On 16/02/12 10:38, Steven Taylor wrote:
> Will Rabbit try to first deliver an unrouted message to the same rout on
> the alternate exchange. 

The routing logic will only fall back to the alternative exchange if the
message could not be routed to any queue (or the message was marked as
immediate and it cannot be delivered to any consumer). The message
routing key(s) do not change during any of these routing attempts.

-Emile

From matthew at rabbitmq.com  Thu Feb 16 11:14:38 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 16 Feb 2012 11:14:38 +0000
Subject: [rabbitmq-discuss] HA Documentation Error?
In-Reply-To: <4F38E2B4.7010508@rabbitmq.com>
References: <1328830347.88766.YahooMailNeo@web44913.mail.sp1.yahoo.com>
	<4F34EB96.6090203@rabbitmq.com>
	<1328903410.78762.YahooMailNeo@web44915.mail.sp1.yahoo.com>
	<4F38E2B4.7010508@rabbitmq.com>
Message-ID: <20120216111437.GB32295@rabbitmq.com>

On Mon, Feb 13, 2012 at 10:15:16AM +0000, Emile Joubert wrote:
> On 10/02/12 19:50, Uday Subbarayan wrote:
> > Note: There is a risk in the above strategy if the master node goes
> > down. If you want to avoid, then publish to all slaves? Here on wards, i
> 
> If the master becomes unavailable then a slave is promoted to take its
> place. Message replication between slaves and the master happens
> internally and automatically. As long as the queue is declared as
> mirrored, the publisher is not required to take any action to republish
> messages to slaves.

Well, that's not necessarily true. If the node that failed was also the
node to which the client was connected, then the client needs to detect
the death of the connection, establish a new connection to a surviving
node and then republish all messages that it never got
publisher-confirms back for - assuming the client even turned
publisher-confirms on. That would be the only way to ensure
at-least-once delivery.

> Active-active mirrored queues are recommended instead of the
> active-passive approach, because it does not require additional software
> and the failover process is quicker.

However, throughput is lower, and it does not have any chance of
integration with other clustering/HA software elsewhere in the stack.

Matthew

From emile at rabbitmq.com  Thu Feb 16 11:26:54 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Feb 2012 11:26:54 +0000
Subject: [rabbitmq-discuss] Huge memory Consumption in RabbitMQ client
In-Reply-To: <CABGiY4CaoPt4aqrdiGm_nu7TxjeLfHA0evvr3vx50U=4MYCiTw@mail.gmail.com>
References: <CABGiY4CaoPt4aqrdiGm_nu7TxjeLfHA0evvr3vx50U=4MYCiTw@mail.gmail.com>
Message-ID: <4F3CE7FE.7090803@rabbitmq.com>

Hi Ashish,

On 15/02/12 14:51, Ashish Jain wrote:
> We are running a rabbitmq server on IP1 and a simple client application
> on IP2. We are observing an abrupt memory consumption on the *client
> *end which goes on till all the messages are pumped in rabbitmq and after
> that memory usage remains constant. This particular situation has
> already led us to few OOM.

Unless the channel QoS is set to non-zero value, the broker will send as
many messages to a consumer as it can. This can lead the consumer to run
out of memory.

If you rerun your tests with QoS set to a small value then you should
observe a different client memory consumption pattern, and the consumer
will have more control the delivery rate.

See the Channel.basicQos(int prefetchCount) method in the Java client.

Emile


From emile at rabbitmq.com  Thu Feb 16 11:49:48 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Feb 2012 11:49:48 +0000
Subject: [rabbitmq-discuss] Shuting down and reopening the consumer's
 side
In-Reply-To: <33329194.post@talk.nabble.com>
References: <33329194.post@talk.nabble.com>
Message-ID: <4F3CED5C.8060702@rabbitmq.com>

Hi,

On 15/02/12 14:35, Bamboula wrote:
> My purpous is to show that if I close my connection to the queue (on the
> consumer's side)and aterwars, I open a new consumer, I will receive all the
> messages that were sent to the queue during the time there was no consumer.

If you have a fixed set of consumers then the publisher can set up
queues and bindings for all of them before starting to publish. The
publisher and consumers will need to establish a convention for queue
naming beforehand. Each consumer can then subscribe to its own queue and
read the messages that were published during its absence.

Also take a look at this exchange plugin:
https://github.com/squaremo/rabbitmq-lvc-plugin



-Emile

From james.mcmahon at TASC.COM  Thu Feb 16 12:08:35 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Thu, 16 Feb 2012 12:08:35 +0000
Subject: [rabbitmq-discuss] Persisting Messages on a Direct Exchange,
 Selectively Looking for Particular Messages
In-Reply-To: <4F3CE1F5.6080302@rabbitmq.com>
References: <C974010E949511448F6DC6F748F604D90FEB0A4E@TSEAMB01>,
	<4F3CE1F5.6080302@rabbitmq.com>
Message-ID: <C974010E949511448F6DC6F748F604D90FEB0A95@TSEAMB01>

Thank you for taking the time to reply, Emile. This is very helpful. I understand now that my exchange is exclusively for routing. Can I ask you a few follow up questions?

Is there an example you can direct me towards that shows the Java implementation to guarantee that messages are persisted by declaring queues as durable and setting the delivery-mode to 2?

So assuming that I use my direct exchange to route messages to appropriate queues, and my queues are declared as durable with delivery-mode 2, then multiple consumers will see those messages on that queue regardless of whether they were connected at the time the message was published to that queue through the direct exchange?

Thank you again for your help. If I can see an example I will be off to the races this evening, refining my initial code.

-Jim


________________________________________
From: Emile Joubert [emile at rabbitmq.com]
Sent: Thursday, February 16, 2012 6:01 AM
To: McMahon, James S (TASC)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Persisting Messages on a Direct Exchange, Selectively Looking for Particular Messages

Hi James,

On 16/02/12 00:45, McMahon, James S (TASC) wrote:
> How would one persist messages on the directed exchange? I want to do

You can guarantee that messages are persisted by declaring queues as
durable and setting the delivery-mode to 2. The exchange plays no part
in determining whether a message will be persisted.

> My messages are directed to exchanges by a qmsgTarget field. My messages
> have a field in their structure called srcId. My messages also have a
> field in their structure called seqNum. Thus a consumer may wish to say
> "Please get me message 3 from srcid 666 from the qmsgtarget Server
> direct exchange". Another consumer may later issue the same request, so
> this third message in the sequence for srcid 666 must remain on the
> directed exchange.

Messages are stored in queues, and exchanges maintain no state. If you
need multiple consumers to receive the same message then you should
route the message to multiple queues (tutorial 3). If you need to route
messages based on headers then you will find the headers exchange useful:
http://www.rabbitmq.com/tutorials/amqp-concepts.html#exchange-headers

> I will be implementing a method deleteQmsg() that I intend to use to
> delete messages selectively.

Queues are not well suited to selective manipulation of messages beyond
the head of the queue. If the problem cannot be expressed in terms of
messaging then a relational database is more suitable for your purposes
than a message broker.



-Emile
CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.

From taylste at gmail.com  Thu Feb 16 12:13:58 2012
From: taylste at gmail.com (Steven Taylor)
Date: Thu, 16 Feb 2012 12:13:58 +0000
Subject: [rabbitmq-discuss] alternate exchange
In-Reply-To: <4F3CE464.1080101@rabbitmq.com>
References: <CA+zYriQQD1jnHfW3E-mhD9=OkabTEZOVe+K6A1p=Wg68v3oQ-A@mail.gmail.com>
	<4F3CE464.1080101@rabbitmq.com>
Message-ID: <CA+zYriRYQA0bQg6FkKqfnuUefF1q3ycjCkuQiRsgO-R-eF8N6A@mail.gmail.com>

so the routing key of "" in the example is a catch-all?

On 16 February 2012 11:11, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Steven,
>
> On 16/02/12 10:38, Steven Taylor wrote:
> > Will Rabbit try to first deliver an unrouted message to the same rout on
> > the alternate exchange.
>
> The routing logic will only fall back to the alternative exchange if the
> message could not be routed to any queue (or the message was marked as
> immediate and it cannot be delivered to any consumer). The message
> routing key(s) do not change during any of these routing attempts.
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/bc4c1984/attachment.htm>

From eric at holtmans.com  Thu Feb 16 12:13:53 2012
From: eric at holtmans.com (Eric J. Holtman)
Date: Thu, 16 Feb 2012 06:13:53 -0600
Subject: [rabbitmq-discuss] Multi-threading in c/c++
Message-ID: <4F3CF301.40700@holtmans.com>

I've been hoping to get rabbitmq integrated into some
of my applications.  I've read a few books and web
articles.  I've wrangled the source into compiling and
working under Windows.  The examples run fine.

I'm trying to figure out how to run under a multithreaded
environment.  As I understood it, the whole point of having
a multiplexed connection was so that I didn't have to
burn an actual TCP connection for every channel.

However, that doesn't seem to be how rabbitmq-c is
set up.

In fact, a recent question from the archives, answered
by Alan says:

> You have interpreted the documentation correctly:
> 
> amqp_connection_state_t, its socket, and all associated amqp_channel_t's
> must not be shared between threads.  Its ok to have separate instances of
> these objects used in different threads.

So, if I want to consume on 4 queues, and the natural
solution would be to have 4 threads doing a blocking
wait (like "run" in the amqp_consumer example), I have
to have a separate TCP connection for each one?

Also, I assume if I'm going to use a c++ wrapper like
amqpcpp or rabbitcpp I'm going to have the same issue,
since they're using rabbitmq-c as the lower layer?

Thanks,

Eric

From emile at rabbitmq.com  Thu Feb 16 12:48:15 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Feb 2012 12:48:15 +0000
Subject: [rabbitmq-discuss] alternate exchange
In-Reply-To: <CA+zYriRYQA0bQg6FkKqfnuUefF1q3ycjCkuQiRsgO-R-eF8N6A@mail.gmail.com>
References: <CA+zYriQQD1jnHfW3E-mhD9=OkabTEZOVe+K6A1p=Wg68v3oQ-A@mail.gmail.com>
	<4F3CE464.1080101@rabbitmq.com>
	<CA+zYriRYQA0bQg6FkKqfnuUefF1q3ycjCkuQiRsgO-R-eF8N6A@mail.gmail.com>
Message-ID: <4F3CFB0F.7080600@rabbitmq.com>

Hi Steve,

On 16/02/12 12:13, Steven Taylor wrote:
> so the routing key of "" in the example is a catch-all?

Sorry I misunderstood your question. The empty routing key has no
special significance in the context of alternative exchanges. Fanout
exchanges ignore the routing key so the it doesn't matter what value you
supply.

Messages that are sent to the "my-ae" exchange by whatever means
(directly from a publisher or in its capacity as alternative exchange of
"my-direct") will be routed to the "unrouted" queue, regardless of the
message routing keys.


-Emile

From emile at rabbitmq.com  Thu Feb 16 13:12:26 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Feb 2012 13:12:26 +0000
Subject: [rabbitmq-discuss] Persisting Messages on a Direct Exchange,
 Selectively Looking for Particular Messages
In-Reply-To: <C974010E949511448F6DC6F748F604D90FEB0A95@TSEAMB01>
References: <C974010E949511448F6DC6F748F604D90FEB0A4E@TSEAMB01>,
	<4F3CE1F5.6080302@rabbitmq.com>
	<C974010E949511448F6DC6F748F604D90FEB0A95@TSEAMB01>
Message-ID: <4F3D00BA.7070400@rabbitmq.com>

Hi Jim,

On 16/02/12 12:08, McMahon, James S (TASC) wrote:
> Is there an example you can direct me towards that shows the Java
> implementation to guarantee that messages are persisted by declaring
> queues as durable and setting the delivery-mode to 2?

The com.rabbitmq.examples.StressPersister example in the Java client
exercises persistence in the broker and illustrates the steps necessary
to guarantee that messages are persisted.

> So assuming that I use my direct exchange to route messages to
> appropriate queues, and my queues are declared as durable with
> delivery-mode 2, then multiple consumers will see those messages on
> that queue regardless of whether they were connected at the time the
> message was published to that queue through the direct exchange?

No, persistence in this context means that the message is on durable
storage on the broker and recoverable in case the broker crashes.

If you want consumers to be able to retrieve messages that were
published in their absence then you must arrange for queues to be
declared and bound before publishing starts. It will take some
coordination between the consumers and the party that performs this
preliminary setup to ensure that consumers know the name of their queue.


-Emile

From steve at rabbitmq.com  Thu Feb 16 13:27:15 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 16 Feb 2012 13:27:15 +0000
Subject: [rabbitmq-discuss] Bug: Java ConnectionFactory can hangs
	forever in network packet loss cases
In-Reply-To: <CACYRexdEtppn4DxYAKRbRZw+SBRhohnwN88P_xXh68kvNJ3jrw@mail.gmail.com>
References: <CACYRexfFE2Es7FK-MzeOtWZ3WB77=7QRtY9fxnNXYHQeohZGpQ@mail.gmail.com>
	<CACYRexdEtppn4DxYAKRbRZw+SBRhohnwN88P_xXh68kvNJ3jrw@mail.gmail.com>
Message-ID: <62A93B17-6DEA-4445-B523-CB4E747B4B29@rabbitmq.com>

Dear Ildar,

First, may I apologise for not getting back to you sooner. It seems that you
have clearly identified a bug, and have helped to narrow it down for us.

Thank you very much. I have raised a problem for us to fix and track this
(24747).

I have a few comments regarding your settings: it seems to me that a heartbeat
of 30s is not unreasonable, but you should be aware that anything up to a minute
may pass before noticing that a heartbeat is missed, so you must not rely on
this interval.

The ConnectionTimeout will only affect waiting for the socket connection so is
not involved in this. I think your interval here is again quite large, but not
unreasonable in unreliable networks. I would expect the herartbeat to be about
half of this (see note above).

We'll get on to this bug asap.
Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 13 Feb 2012, at 09:28, ?????? ?????????? wrote:

> Can anybody help with this problem or prove that i'm wrong?
> 
> 2012/2/7 ?????? ?????????? <absorbb at gmail.com>
> Hello.
> 
> We have rabbitMQ 2.7.1 java clients remotely connected to the server.
> We started experience short-term bad network scenarios and serious problem occurred:
> 1. factory.setRequestedHeartbeat set to 30s
> 2. factory.setConnectionTimeout set to 30000ms
> client properly closes connection after missing 30 seconds of heartbeats.
> But sometimes it hangs completely when tries to open a new connection.
> 
> I tried to analyze java client code and what is result:
> 
> AMQConnection.java:286 :
>           _frameHandler.setTimeout(HANDSHAKE_TIMEOUT); - socket.soTimeout is set to 10s here
> then it starts the MainLoop at line 294
> and blocks till get a reply for a handshake at line 300:
>      connStart =
>                 (AMQP.Connection.Start) connStartBlocker.getReply().getMethod();
> 
> problem is that it's possible that it'll never get a reply. Because MainLoop relies on heartbeats functional to handle such situation which is not enabled yet. It happens only at line 368:
>             setHeartbeat(heartbeat);
> MainLoop endlessly runs at 492:              
>     Frame frame = _frameHandler.readFrame();
> which returns null every 10s (this is how SocketTimeoutException handled in Frame.readFrom..)
> and handleSocketTimeout() do nothing because _heartbeat is not set yet.
> 
> Thanks.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From taylste at gmail.com  Thu Feb 16 13:36:18 2012
From: taylste at gmail.com (Steven Taylor)
Date: Thu, 16 Feb 2012 13:36:18 +0000
Subject: [rabbitmq-discuss] alternate exchange
In-Reply-To: <4F3CFB0F.7080600@rabbitmq.com>
References: <CA+zYriQQD1jnHfW3E-mhD9=OkabTEZOVe+K6A1p=Wg68v3oQ-A@mail.gmail.com>
	<4F3CE464.1080101@rabbitmq.com>
	<CA+zYriRYQA0bQg6FkKqfnuUefF1q3ycjCkuQiRsgO-R-eF8N6A@mail.gmail.com>
	<4F3CFB0F.7080600@rabbitmq.com>
Message-ID: <CA+zYriTov0tdexSANsLyWT2VG0u+nrYRNYg-Hxr+-60RGcPzcA@mail.gmail.com>

Hi Emile,

I always use topic or direct exchanges.  I was confused by that empty
string routing key.  thanks.

So that means if the exchange is declared topic or direct, that the normal
rules will apply.

So I suppose the catch-all could be the last fan-out in the alternate
exchange chain .

-Steven

On 16 February 2012 12:48, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Steve,
>
> On 16/02/12 12:13, Steven Taylor wrote:
> > so the routing key of "" in the example is a catch-all?
>
> Sorry I misunderstood your question. The empty routing key has no
> special significance in the context of alternative exchanges. Fanout
> exchanges ignore the routing key so the it doesn't matter what value you
> supply.
>
> Messages that are sent to the "my-ae" exchange by whatever means
> (directly from a publisher or in its capacity as alternative exchange of
> "my-direct") will be routed to the "unrouted" queue, regardless of the
> message routing keys.
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/9805be8a/attachment.htm>

From Jim.Langston at compuware.com  Thu Feb 16 13:41:19 2012
From: Jim.Langston at compuware.com (Langston, Jim)
Date: Thu, 16 Feb 2012 13:41:19 +0000
Subject: [rabbitmq-discuss] rabbitMQ management tool not showing
 messages delivered
In-Reply-To: <4F3CDBB9.4000601@rabbitmq.com>
Message-ID: <CB626889.1179D%jim.langston@compuware.com>

Thanks Emile, I'm driving the developers nuts, the developers using
the queue say they are getting messages just fine.

There are 4 queues configured, snapshot showing:

Queue	Status	R/U/Total	Incoming	delivery/get

Q1	Active	0/0/0		1510/s		1510/s
Q2	Active	0/0/0		1510/s		1510/s
Q3	Active	0/0/0		1510/s		1502/s
Q4	Active 	0/0/0		1510/s		0/s

The calculation method seem to indicate no deliveries are being made. As
the snapshot changes along with the incoming values changing, the
delivery/get values change, but the value of 0/s for Q4
never varies although the incoming values for Q4 do.

Jim

On 2/16/12 5:34 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:

>Hi Jim,
>
>On 15/02/12 20:01, Langston, Jim wrote:
>> Also, how is the value to be presented as deliver/get being calculated?
>
>This statistic is the rate at which messages are delivered to consumers.
>The value is calculated by dividing the number of deliveries by the time
>period over which they were recorded.
>
>> I've been looking at rabbitmqctl commands that would be let me do the
>>same
>> independent of the mgmt interface. Is there a way to get those values?
>
>The rabbitmqctl tool does not report message rates, so that comparison
>is not directly possible.
>
>
>-Emile


From emile at rabbitmq.com  Thu Feb 16 14:35:52 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Feb 2012 14:35:52 +0000
Subject: [rabbitmq-discuss] rabbitMQ management tool not showing
 messages delivered
In-Reply-To: <CB626889.1179D%jim.langston@compuware.com>
References: <CB626889.1179D%jim.langston@compuware.com>
Message-ID: <4F3D1448.5080908@rabbitmq.com>

Hi Jim,

On 16/02/12 13:41, Langston, Jim wrote:
> Queue	Status	R/U/Total	Incoming	delivery/get
> 
> Q1	Active	0/0/0		1510/s		1510/s
> Q2	Active	0/0/0		1510/s		1510/s
> Q3	Active	0/0/0		1510/s		1502/s
> Q4	Active 	0/0/0		1510/s		0/s
> 
> The calculation method seem to indicate no deliveries are being made. As
> the snapshot changes along with the incoming values changing, the
> delivery/get values change, but the value of 0/s for Q4
> never varies although the incoming values for Q4 do.

Is it possible that Q4 is defined with a very small TTL value and
therefore messages are expiring almost immediately from this queue? Is
it possible that a client is continuously purging Q4?



-Emile

From emile at rabbitmq.com  Thu Feb 16 15:41:27 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Feb 2012 15:41:27 +0000
Subject: [rabbitmq-discuss] SSL between cluster hosts supported ?
In-Reply-To: <CAH24rBOZ=M-1VNjnATnm3i1a04S6KP1=NrjaDNLEZnA8PD-oVQ@mail.gmail.com>
References: <1329252661.74648.YahooMailNeo@web36203.mail.mud.yahoo.com>
	<CABzX+qz2gb9gCg9SJzy7JH-T-sKLs_RCrqKaXJx3tCuKznK5Kg@mail.gmail.com>
	<CABzX+qw+bTthyDQad9vMpR8ju0yk21EdQ=zCjAUYFAwfEv=qFw@mail.gmail.com>
	<CAH24rBOZ=M-1VNjnATnm3i1a04S6KP1=NrjaDNLEZnA8PD-oVQ@mail.gmail.com>
Message-ID: <4F3D23A7.2050104@rabbitmq.com>

Hi Mark,

On 15/02/12 20:06, Mark Steele wrote:
> Would be awesome if someone were to put up an example on the rabbitmq
> website with a how-to on getting that up and running, someone with both
> rabbit and erlang experience.... :)

The newest version of Erlang has support for encrypted node
communication built in. For more information see
http://www.erlang.org/doc/apps/ssl/ssl_distribution.html

You will need to modify the startup scripts or supply SSL arguments in
the rabbitmq.config file. You will also need to add "ssl" to the list of
applications in ebin/rabbit_app.in .


-Emile

From Simone.Busoli at ferrari.com  Thu Feb 16 17:10:14 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Thu, 16 Feb 2012 17:10:14 +0000
Subject: [rabbitmq-discuss] Passive queue declaration and channel closure
Message-ID: <88E590DC4586974D825FC82AE798294E520F1E82@GSVCLU04.ges.ferlan.it>

Hi, I'm revamping this<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-February/011314.html> old thread because I'm trying to solve pretty much the same problem. I need to know whether a queue that I have declared still exists on the server or has for any reason been deleted.
Without relying on the management plugin I think the only way to do that is to declare the queue as passive. At least with the .NET client and apparently the Java client too, when the queue does not exist, besides throwing an exception, the channel is closed as well. From the spec:

If set, the server will reply with Declare-Ok if the queue already exists with the same name, and raise an error if not. The client can use this to check whether a queue exists without modifying the server state.

There is no mention of channel closure, while the last sentence implies that using the passive bit is indeed a way for a client to check queue existence, so closing the channel when it doesn't is a bit unexpected.
That said, it's not a big deal to recreate the channel in such cases, but I'd appreciate your opinion. Any chance this behavior can be changed in the client libraries?

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/ec501cfc/attachment.htm>

From visionofarun at gmail.com  Thu Feb 16 17:14:04 2012
From: visionofarun at gmail.com (Arun Chandrasekaran)
Date: Thu, 16 Feb 2012 22:44:04 +0530
Subject: [rabbitmq-discuss] rabbitmq-c: Nonblocking recv
In-Reply-To: <CAAt2poLm3rmD6SsBOoQ089+LSd6kKMrcxQhr=0C2Vz62T9gnrQ@mail.gmail.com>
References: <3663841.2.1329332313215.JavaMail.geo-discussion-forums@vbnd9>
	<CAAt2poLm3rmD6SsBOoQ089+LSd6kKMrcxQhr=0C2Vz62T9gnrQ@mail.gmail.com>
Message-ID: <CA+FLvt8wPA35fFKZc+13cvjgcpv2eKd0X_ninjSk7OD65Vfsfg@mail.gmail.com>

Thanks for reply Alan.

I modified the amqp_consumer.c sample code to simulate the non-blocking
behaviour as you mentioned.

    /* if (!amqp_frames_enqueued(conn) && !amqp_data_in_buffer(conn)) { */
    if (1) {
       int sock = amqp_get_sockfd(conn);
       printf("socket: %d\n", sock);

       /* Watch socket fd to see when it has input. */
       fd_set read_flags;
       FD_ZERO(&read_flags);
       FD_SET(sock), &read_flags);
       int ret = 0;
       do {
          struct timeval timeout;

          /* Wait upto a second. */
          timeout.tv_sec = 1;
          timeout.tv_usec = 0;

          ret = select(sock+1, &read_flags, NULL, NULL, &timeout);
          if (ret == -1)
             printf("select: %s\n", strerror(errno));
          else if (ret == 0)
             printf("select timedout\n");
          if (FD_ISSET(sock, &read_flags)) {
             printf("Flag is set\n");
          }
       } while (ret == 0);
    }

But this always results in a timeout. Any idea where I might be going
wrong? I have commented the first two checks that you mentioned just for
sake of clarity on select().

-Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/086d94ad/attachment.htm>

From mpietrek at skytap.com  Thu Feb 16 17:35:53 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 16 Feb 2012 09:35:53 -0800
Subject: [rabbitmq-discuss] Performance of "blocking publisher-confirms" vs.
	transactions
Message-ID: <CB627E79.2EBDC%mpietrek@skytap.com>

As I've detailed in other posts to this DL (http://bit.ly/zf6sKC), we have
situation where straightforward publisher-confirms aren't appropriate in our
scenario. We need to know the broker has received the message, and we have
to assume our client can die at any moment, so retransmitting messages is
not an option for us.

What I'd like to know is: Is there any benefit to creating our own "blocking
publisher-confirm publishing"? That is, we'd do the following:

Publish a single message
Block on an event 'X'
When the publisher confirm comes in, signal 'X'
Return from the publish call

In a mirrored queue scenario, is there any advantage to doing this vs. using
straight-up transactions?

Matt

p.s. I realize in the above pseudocode that multiple threads would be
necessary - One to block and the other to listen for the publisher-confirm.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/6060b93d/attachment.htm>

From brett.r.cameron at gmail.com  Thu Feb 16 18:08:08 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Fri, 17 Feb 2012 07:08:08 +1300
Subject: [rabbitmq-discuss] rabbitmq-c: Nonblocking recv
In-Reply-To: <CA+FLvt8wPA35fFKZc+13cvjgcpv2eKd0X_ninjSk7OD65Vfsfg@mail.gmail.com>
References: <3663841.2.1329332313215.JavaMail.geo-discussion-forums@vbnd9>
	<CAAt2poLm3rmD6SsBOoQ089+LSd6kKMrcxQhr=0C2Vz62T9gnrQ@mail.gmail.com>
	<CA+FLvt8wPA35fFKZc+13cvjgcpv2eKd0X_ninjSk7OD65Vfsfg@mail.gmail.com>
Message-ID: <CALPqkipRjHuURkKipbRjD4iXZaNaYPkxU6fKK+P_NjW7O+kF_A@mail.gmail.com>

Arun,

A couple of random early in the morning pre-caffeine thoughts: is sock set
to non-blocking? What's the errno value after the select() returns?

Brett


On Fri, Feb 17, 2012 at 6:14 AM, Arun Chandrasekaran <visionofarun at gmail.com
> wrote:

> Thanks for reply Alan.
>
> I modified the amqp_consumer.c sample code to simulate the non-blocking
> behaviour as you mentioned.
>
>     /* if (!amqp_frames_enqueued(conn) && !amqp_data_in_buffer(conn)) { */
>     if (1) {
>        int sock = amqp_get_sockfd(conn);
>        printf("socket: %d\n", sock);
>
>        /* Watch socket fd to see when it has input. */
>        fd_set read_flags;
>        FD_ZERO(&read_flags);
>        FD_SET(sock), &read_flags);
>        int ret = 0;
>        do {
>           struct timeval timeout;
>
>           /* Wait upto a second. */
>           timeout.tv_sec = 1;
>           timeout.tv_usec = 0;
>
>           ret = select(sock+1, &read_flags, NULL, NULL, &timeout);
>           if (ret == -1)
>              printf("select: %s\n", strerror(errno));
>           else if (ret == 0)
>              printf("select timedout\n");
>           if (FD_ISSET(sock, &read_flags)) {
>              printf("Flag is set\n");
>           }
>        } while (ret == 0);
>     }
>
> But this always results in a timeout. Any idea where I might be going
> wrong? I have commented the first two checks that you mentioned just for
> sake of clarity on select().
>
> -Arun
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/a024cdc1/attachment.htm>

From simone.busoli at gmail.com  Thu Feb 16 21:08:12 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 16 Feb 2012 22:08:12 +0100
Subject: [rabbitmq-discuss] Performance of "blocking publisher-confirms"
 vs. transactions
In-Reply-To: <CB627E79.2EBDC%mpietrek@skytap.com>
References: <CB627E79.2EBDC%mpietrek@skytap.com>
Message-ID: <CAOn7oW8C-u2oJ7eYvKHE0EDL5japasAB+ZL_sME88Hk7SWE45Q@mail.gmail.com>

Hi Matt, I've gone through the old thread very quickly so forgive me if I'm
missing something. Your first sentence leaves me with some doubts:

As I've detailed in other posts to this DL (http://bit.ly/zf6sKC), we have
> situation where straightforward publisher-confirms aren't appropriate in
> our scenario. We need to know the broker has received the message, and we
> have to assume our client can die at any moment, so retransmitting messages
> is not an option for us.
>

Publisher confirms guarantee that the broker has taken care of the message
and it has been either delivered to a queue or to a consumer. This is a
strong delivery guarantee, even if the client dies. Coupled with persistent
messages and durable exchange/queues, it guarantees at-least-once delivery.
Can you describe why you think publisher confirms are not appropriate in
your scenario?


> What I'd like to know is: Is there any benefit to creating our own
> "blocking publisher-confirm publishing"? That is, we'd do the following:
>
> Publish a single message
> Block on an event 'X'
> When the publisher confirm comes in, signal 'X'
> Return from the publish call
>

If you happen to be using the .NET API this is already implemented, the
WaitForConfirms and WaitForConfirmsOrDie on the IModel interface provide
this behavior.


> In a mirrored queue scenario, is there any advantage to doing this vs.
> using straight-up transactions?
>
> Matt
>
> p.s. I realize in the above pseudocode that multiple threads would be
> necessary - One to block and the other to listen for the publisher-confirm.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/6d6f4ed0/attachment.htm>

From mpietrek at skytap.com  Thu Feb 16 21:44:14 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 16 Feb 2012 13:44:14 -0800
Subject: [rabbitmq-discuss] Performance of "blocking publisher-confirms"
 vs. transactions
In-Reply-To: <CAOn7oW8C-u2oJ7eYvKHE0EDL5japasAB+ZL_sME88Hk7SWE45Q@mail.gmail.com>
References: <CB627E79.2EBDC%mpietrek@skytap.com>
	<CAOn7oW8C-u2oJ7eYvKHE0EDL5japasAB+ZL_sME88Hk7SWE45Q@mail.gmail.com>
Message-ID: <CACLE7ix7c7NakYoaKc1_+9zhiGMZXNUo4aDL=SevqZQk5TQHgw@mail.gmail.com>

Hi Simone,

| Can you describe why you think publisher confirms are not appropriate in
your scenario?

I think if you read the paragraph that starts with "At the heart of things"
it describes the scenario in enough detail. In a follow up, Simon MacMullen
appears to agree that publisher confirms aren't ideal for us.

In short, when we publish a message, we must know that the broker safely
has it. With transactions, OR a blocking publisher-confirm model, the
client is assured it has it.

HOWEVER, all the publisher-confirm descriptions/examples I've seen assume
an async model: Publish a message and some time later you'll be told that
the message is safely in the broker's hands. However, that window between
those two events is the crux of the problem in our environment.

Assume we went with the async publisher-confirm model as suggested. What if
our client dies and is not around to re-send the message? Or what if the
client dies, and milliseconds later the broker dies? No publisher confirm
would be forthcoming, and hence, lost messages.

Top level problem for us: Our state machine, which persists every critical
change of state to a database, will be incorrect. We will have recorded
"Yup, that message was sent", when in reality it might not have made it to
broker, or the broker died before the confirm could be sent.

By not recording that we've sent the message until AFTER a
transaction/publisher-confirm completes, we can guarantee the integrity of
our state-machine. However, as we've all seen, transactions impose a limit
on message throughput. I'm simply trying to understand if there's any
non-trivial message rate difference expected between using a transaction
vs. waiting in my publish routine for the confirm.


| If you happen to be using the .NET API this is already implemented, the
WaitForConfirms and WaitForConfirmsOrDie on the IModel interface provide
this behavior.

Unfortunately, I'm not on a .NET client. I'm using Python/Pika. I'd
consider going to the c-library (wrapped from Python) if there's some
non-trivial benefit to using a synchronous publisher-confirm.

Thanks,

Matt

On Thu, Feb 16, 2012 at 1:08 PM, Simone Busoli <simone.busoli at gmail.com>wrote:

> Hi Matt, I've gone through the old thread very quickly so forgive me if
> I'm missing something. Your first sentence leaves me with some doubts:
>
> As I've detailed in other posts to this DL (http://bit.ly/zf6sKC), we
>> have situation where straightforward publisher-confirms aren't appropriate
>> in our scenario. We need to know the broker has received the message, and
>> we have to assume our client can die at any moment, so retransmitting
>> messages is not an option for us.
>>
>
> Publisher confirms guarantee that the broker has taken care of the message
> and it has been either delivered to a queue or to a consumer. This is a
> strong delivery guarantee, even if the client dies. Coupled with persistent
> messages and durable exchange/queues, it guarantees at-least-once delivery.
> Can you describe why you think publisher confirms are not appropriate in
> your scenario?
>
>
>> What I'd like to know is: Is there any benefit to creating our own
>> "blocking publisher-confirm publishing"? That is, we'd do the following:
>>
>> Publish a single message
>> Block on an event 'X'
>> When the publisher confirm comes in, signal 'X'
>> Return from the publish call
>>
>
> If you happen to be using the .NET API this is already implemented, the
> WaitForConfirms and WaitForConfirmsOrDie on the IModel interface provide
> this behavior.
>
>
>> In a mirrored queue scenario, is there any advantage to doing this vs.
>> using straight-up transactions?
>>
>> Matt
>>
>> p.s. I realize in the above pseudocode that multiple threads would be
>> necessary - One to block and the other to listen for the publisher-confirm.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/9d241271/attachment.htm>

From cshtreck at yahoo.com  Thu Feb 16 22:03:14 2012
From: cshtreck at yahoo.com (Charles)
Date: Thu, 16 Feb 2012 14:03:14 -0800 (PST)
Subject: [rabbitmq-discuss] SSL between cluster hosts supported ?
In-Reply-To: <4F3D23A7.2050104@rabbitmq.com>
References: <1329252661.74648.YahooMailNeo@web36203.mail.mud.yahoo.com>
	<CABzX+qz2gb9gCg9SJzy7JH-T-sKLs_RCrqKaXJx3tCuKznK5Kg@mail.gmail.com>
	<CABzX+qw+bTthyDQad9vMpR8ju0yk21EdQ=zCjAUYFAwfEv=qFw@mail.gmail.com>
	<CAH24rBOZ=M-1VNjnATnm3i1a04S6KP1=NrjaDNLEZnA8PD-oVQ@mail.gmail.com>
	<4F3D23A7.2050104@rabbitmq.com>
Message-ID: <1329429794.88114.YahooMailNeo@web36206.mail.mud.yahoo.com>

Emile,

Thanks for the info. I see ssl now ...

rabbitmqctl report | grep ssl
...
{ssl,"Erlang/OTP SSL application","5.0"}

...

However, rabbit crashes on startup with a?

error_logger,{{2012,2,16},{16,55,24}},"Protocol: ~p: not supported~n",["inet_tls"]}


when I add?-proto_dist inet_tls to the erl command line options in the rabbitmq-server startup script .?

Thoughts ?




----- Original Message -----
From: Emile Joubert <emile at rabbitmq.com>
To: Mark Steele <msteele at beringmedia.com>
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Thursday, February 16, 2012 10:41 AM
Subject: Re: [rabbitmq-discuss] SSL between cluster hosts supported ?

Hi Mark,

On 15/02/12 20:06, Mark Steele wrote:
> Would be awesome if someone were to put up an example on the rabbitmq
> website with a how-to on getting that up and running, someone with both
> rabbit and erlang experience.... :)

The newest version of Erlang has support for encrypted node
communication built in. For more information see
http://www.erlang.org/doc/apps/ssl/ssl_distribution.html

You will need to modify the startup scripts or supply SSL arguments in
the rabbitmq.config file. You will also need to add "ssl" to the list of
applications in ebin/rabbit_app.in .


-Emile
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From cshtreck at yahoo.com  Thu Feb 16 22:17:29 2012
From: cshtreck at yahoo.com (Charles)
Date: Thu, 16 Feb 2012 14:17:29 -0800 (PST)
Subject: [rabbitmq-discuss] SSL between cluster hosts supported ?
In-Reply-To: <1329429794.88114.YahooMailNeo@web36206.mail.mud.yahoo.com>
References: <1329252661.74648.YahooMailNeo@web36203.mail.mud.yahoo.com>
	<CABzX+qz2gb9gCg9SJzy7JH-T-sKLs_RCrqKaXJx3tCuKznK5Kg@mail.gmail.com>
	<CABzX+qw+bTthyDQad9vMpR8ju0yk21EdQ=zCjAUYFAwfEv=qFw@mail.gmail.com>
	<CAH24rBOZ=M-1VNjnATnm3i1a04S6KP1=NrjaDNLEZnA8PD-oVQ@mail.gmail.com>
	<4F3D23A7.2050104@rabbitmq.com>
	<1329429794.88114.YahooMailNeo@web36206.mail.mud.yahoo.com>
Message-ID: <1329430649.14045.YahooMailNeo@web36207.mail.mud.yahoo.com>

Furthermore ,I was able to run through the example over here?http://www.erlang.org/doc/apps/ssl/ssl_distribution.html
and I was able to start a erl session without the ?Protocol: ~p: not supported~n",["inet_tls"]
error using :

erl -boot ./test_ssl ? -proto_dist inet_tls -sname test_ssl ?-ssl_dist_opt server_certfile "mycert.pem" ?-ssl_dist_opt server_secure_renegotiate true client_secure_renegotiate true


When I attempted to test using openssl ?via the below command I got the below error and crash reports?... what am I doing wrong ?

openssl s_client -connect localhost:portnumber?


=ERROR REPORT==== 16-Feb-2012::17:11:58 ===
SSL: 1093: error:[] mycert.pem
? [{ssl_connection,init_private_key,5,
? ? ? ? ? ? ? ? ? ?[{file,"ssl_connection.erl"},{line,1085}]},
? ?{ssl_connection,ssl_init,2,[{file,"ssl_connection.erl"},{line,1027}]},
? ?{ssl_connection,init,1,[{file,"ssl_connection.erl"},{line,305}]},
? ?{gen_fsm,init_it,6,[{file,"gen_fsm.erl"},{line,343}]},
? ?{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]


=CRASH REPORT==== 16-Feb-2012::17:11:58 ===
? crasher:
? ? initial call: ssl_connection:init/1
? ? pid: <0.68.0>
? ? registered_name: []
? ? exception exit: ekeyfile
? ? ? in function ?gen_fsm:init_it/6 (gen_fsm.erl, line 353)
? ? ancestors: [ssl_connection_sup_dist,ssl_dist_sup,net_sup,kernel_sup,
? ? ? ? ? ? ? ? ? <0.9.0>]
? ? messages: []
? ? links: [<0.20.0>]
? ? dictionary: [{ssl_manager,ssl_manager_dist}]
? ? trap_exit: false
? ? status: running
? ? heap_size: 2584
? ? stack_size: 24
? ? reductions: 1937
? neighbours:

=SUPERVISOR REPORT==== 16-Feb-2012::17:11:58 ===
? ? ?Supervisor: {local,ssl_connection_sup_dist}
? ? ?Context: ? ?child_terminated
? ? ?Reason: ? ? ekeyfile
? ? ?Offender: ? [{pid,<0.68.0>},
? ? ? ? ? ? ? ? ? {name,undefined},
? ? ? ? ? ? ? ? ? {mfargs,{ssl_connection,start_link,undefined}},
? ? ? ? ? ? ? ? ? {restart_type,temporary},
? ? ? ? ? ? ? ? ? {shutdown,4000},
? ? ? ? ? ? ? ? ? {child_type,worker}]


----- Original Message -----
From: Charles <cshtreck at yahoo.com>
To: 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Thursday, February 16, 2012 5:03 PM
Subject: Re: [rabbitmq-discuss] SSL between cluster hosts supported ?

Emile,

Thanks for the info. I see ssl now ...

rabbitmqctl report | grep ssl
...
{ssl,"Erlang/OTP SSL application","5.0"}

...

However, rabbit crashes on startup with a?

error_logger,{{2012,2,16},{16,55,24}},"Protocol: ~p: not supported~n",["inet_tls"]}


when I add?-proto_dist inet_tls to the erl command line options in the rabbitmq-server startup script .?

Thoughts ?




----- Original Message -----
From: Emile Joubert <emile at rabbitmq.com>
To: Mark Steele <msteele at beringmedia.com>
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Thursday, February 16, 2012 10:41 AM
Subject: Re: [rabbitmq-discuss] SSL between cluster hosts supported ?

Hi Mark,

On 15/02/12 20:06, Mark Steele wrote:
> Would be awesome if someone were to put up an example on the rabbitmq
> website with a how-to on getting that up and running, someone with both
> rabbit and erlang experience.... :)

The newest version of Erlang has support for encrypted node
communication built in. For more information see
http://www.erlang.org/doc/apps/ssl/ssl_distribution.html

You will need to modify the startup scripts or supply SSL arguments in
the rabbitmq.config file. You will also need to add "ssl" to the list of
applications in ebin/rabbit_app.in .


-Emile
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simone.busoli at gmail.com  Thu Feb 16 23:06:38 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Fri, 17 Feb 2012 00:06:38 +0100
Subject: [rabbitmq-discuss] Performance of "blocking publisher-confirms"
 vs. transactions
In-Reply-To: <CACLE7ix7c7NakYoaKc1_+9zhiGMZXNUo4aDL=SevqZQk5TQHgw@mail.gmail.com>
References: <CB627E79.2EBDC%mpietrek@skytap.com>
	<CAOn7oW8C-u2oJ7eYvKHE0EDL5japasAB+ZL_sME88Hk7SWE45Q@mail.gmail.com>
	<CACLE7ix7c7NakYoaKc1_+9zhiGMZXNUo4aDL=SevqZQk5TQHgw@mail.gmail.com>
Message-ID: <CAOn7oW85LewjFWCt049xxTDms9zE-ZXxekfo_uJ8Gue-E84O2w@mail.gmail.com>

Hello Matt, thanks for the explanation and sorry for not reading the
previous thread carefully, I did now.

I can't tell you what differences you should expect between using a
blocking publisher confirms model and transactions as I've never used
transactions before, but allow me to insist a bit more on why the first may
fit your scenario by describing mine. I'm using RabbitMQ in an environment
where high reliability, together with strict ordering of messages and
exactly-once quality of service are needed. We're using asynchronous
publisher confirms to achieve that.

You seem to be worried about a scenario in which you believe some messages
to be in the hands of the server while instead they aren't due to the
asynchronous nature of publisher confirms, and especially that the
publishers may not be there to republish them in case something goes wrong.
Without knowing much about your system I would suggest that you don't
consider the messages as "delivered" until you receive the asynchronous
confirm from the broker, and just pretend they were never published until
this happens. The problem you describe seems to arise because you consider
published messages as "delivered", which is not true until you receive a
confirm.
So what's worst case scenario difference between publisher confirms used in
this way compared to transactions? If a publisher dies, in the first case
you would consider as published only the messages that have been confirmed,
thus pretending the unconfirmed ones to have never existed, in the second
case an hypothetical ongoing transaction is rolled back. I think the
difference here lies only in the number of messages you have tried to
publish which may not have reached the broker. In the case of transactions
it is at most 1, with async publisher confirms it may be more than 1 (it
will be 1 with synchronous publisher confirms), but I don't think this
number changes the nature of the problem.

On Thu, Feb 16, 2012 at 22:44, Matt Pietrek <mpietrek at skytap.com> wrote:

> Hi Simone,
>
> | Can you describe why you think publisher confirms are not appropriate in
> your scenario?
>
> I think if you read the paragraph that starts with "At the heart of
> things" it describes the scenario in enough detail. In a follow up, Simon
> MacMullen appears to agree that publisher confirms aren't ideal for us.
>
> In short, when we publish a message, we must know that the broker safely
> has it. With transactions, OR a blocking publisher-confirm model, the
> client is assured it has it.
>
> HOWEVER, all the publisher-confirm descriptions/examples I've seen assume
> an async model: Publish a message and some time later you'll be told that
> the message is safely in the broker's hands. However, that window between
> those two events is the crux of the problem in our environment.
>
> Assume we went with the async publisher-confirm model as suggested. What
> if our client dies and is not around to re-send the message? Or what if the
> client dies, and milliseconds later the broker dies? No publisher confirm
> would be forthcoming, and hence, lost messages.
>
> Top level problem for us: Our state machine, which persists every critical
> change of state to a database, will be incorrect. We will have recorded
> "Yup, that message was sent", when in reality it might not have made it to
> broker, or the broker died before the confirm could be sent.
>
> By not recording that we've sent the message until AFTER a
> transaction/publisher-confirm completes, we can guarantee the integrity of
> our state-machine. However, as we've all seen, transactions impose a limit
> on message throughput. I'm simply trying to understand if there's any
> non-trivial message rate difference expected between using a transaction
> vs. waiting in my publish routine for the confirm.
>
>
> | If you happen to be using the .NET API this is already implemented, the
> WaitForConfirms and WaitForConfirmsOrDie on the IModel interface provide
> this behavior.
>
> Unfortunately, I'm not on a .NET client. I'm using Python/Pika. I'd
> consider going to the c-library (wrapped from Python) if there's some
> non-trivial benefit to using a synchronous publisher-confirm.
>
> Thanks,
>
> Matt
>
> On Thu, Feb 16, 2012 at 1:08 PM, Simone Busoli <simone.busoli at gmail.com>wrote:
>
>> Hi Matt, I've gone through the old thread very quickly so forgive me if
>> I'm missing something. Your first sentence leaves me with some doubts:
>>
>>  As I've detailed in other posts to this DL (http://bit.ly/zf6sKC), we
>>> have situation where straightforward publisher-confirms aren't appropriate
>>> in our scenario. We need to know the broker has received the message, and
>>> we have to assume our client can die at any moment, so retransmitting
>>> messages is not an option for us.
>>>
>>
>> Publisher confirms guarantee that the broker has taken care of the
>> message and it has been either delivered to a queue or to a consumer. This
>> is a strong delivery guarantee, even if the client dies. Coupled with
>> persistent messages and durable exchange/queues, it guarantees
>> at-least-once delivery. Can you describe why you think publisher confirms
>> are not appropriate in your scenario?
>>
>>
>>> What I'd like to know is: Is there any benefit to creating our own
>>> "blocking publisher-confirm publishing"? That is, we'd do the following:
>>>
>>> Publish a single message
>>> Block on an event 'X'
>>> When the publisher confirm comes in, signal 'X'
>>> Return from the publish call
>>>
>>
>> If you happen to be using the .NET API this is already implemented, the
>> WaitForConfirms and WaitForConfirmsOrDie on the IModel interface provide
>> this behavior.
>>
>>
>>> In a mirrored queue scenario, is there any advantage to doing this vs.
>>> using straight-up transactions?
>>>
>>> Matt
>>>
>>> p.s. I realize in the above pseudocode that multiple threads would be
>>> necessary - One to block and the other to listen for the publisher-confirm.
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/30f08d9a/attachment.htm>

From emile at rabbitmq.com  Thu Feb 16 23:43:24 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 16 Feb 2012 23:43:24 +0000
Subject: [rabbitmq-discuss] SSL between cluster hosts supported ?
In-Reply-To: <1329429794.88114.YahooMailNeo@web36206.mail.mud.yahoo.com>
References: <1329252661.74648.YahooMailNeo@web36203.mail.mud.yahoo.com>
	<CABzX+qz2gb9gCg9SJzy7JH-T-sKLs_RCrqKaXJx3tCuKznK5Kg@mail.gmail.com>
	<CABzX+qw+bTthyDQad9vMpR8ju0yk21EdQ=zCjAUYFAwfEv=qFw@mail.gmail.com>
	<CAH24rBOZ=M-1VNjnATnm3i1a04S6KP1=NrjaDNLEZnA8PD-oVQ@mail.gmail.com>
	<4F3D23A7.2050104@rabbitmq.com>
	<1329429794.88114.YahooMailNeo@web36206.mail.mud.yahoo.com>
Message-ID: <4F3D949C.4030001@rabbitmq.com>

Hi Charles,

Thanks for the feedback and thanks for trying this out. Unfortunately
encrypted inter-node communication is not yet a supported feature of
RabbitMQ. I would suggest that the erlang-questions mailing list is a
better forum for questions on the topic. If you do get this working then
please feel free to report back here.

On 16/02/12 22:03, Charles wrote:
> error_logger,{{2012,2,16},{16,55,24}},"Protocol: ~p: not supported~n",["inet_tls"]}

The most likely cause is that your version of Erlang is not recent enough.



-Emile

From alan.antonuk at gmail.com  Fri Feb 17 01:27:23 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 16 Feb 2012 20:27:23 -0500
Subject: [rabbitmq-discuss] Multi-threading in c/c++
In-Reply-To: <4F3CF301.40700@holtmans.com>
References: <4F3CF301.40700@holtmans.com>
Message-ID: <CAAt2poJ6y8ND9gGWpA-kJ6_W1VjKYE2iqxbsF5GaH8nzKNmp0Q@mail.gmail.com>

Response inlined:

-Alan

On Thu, Feb 16, 2012 at 7:13 AM, Eric J. Holtman <eric at holtmans.com> wrote:

> I've been hoping to get rabbitmq integrated into some
> of my applications.  I've read a few books and web
> articles.  I've wrangled the source into compiling and
> working under Windows.  The examples run fine.
>
> I'm trying to figure out how to run under a multithreaded
> environment.  As I understood it, the whole point of having
> a multiplexed connection was so that I didn't have to
> burn an actual TCP connection for every channel.
>
> However, that doesn't seem to be how rabbitmq-c is
> set up.
>
> In fact, a recent question from the archives, answered
> by Alan says:
>
> > You have interpreted the documentation correctly:
> >
> > amqp_connection_state_t, its socket, and all associated amqp_channel_t's
> > must not be shared between threads.  Its ok to have separate instances of
> > these objects used in different threads.
>
> So, if I want to consume on 4 queues, and the natural
> solution would be to have 4 threads doing a blocking
> wait (like "run" in the amqp_consumer example), I have
> to have a separate TCP connection for each one?
>

Thats one way to do it.  Another would be to a have a "connection thread"
that would own the non-thread-safe objects, and would dispatch the messages
to the worker threads.  It takes a bit more code to accomplish it but its
similar to how the Java and .NET clients work, which have a thread that
handles events on a connection level, then the Channel objects associated
with the Connection object can be on different threads.

>
> Also, I assume if I'm going to use a c++ wrapper like
> amqpcpp or rabbitcpp I'm going to have the same issue,
> since they're using rabbitmq-c as the lower layer?
>

Having not used either of those C++ wrappers I believe your assumption is
correct, unless the implement their own event-loop or thread that
dispatches consumed messages.

As a self-less plug, if you're looking for a C++ wrapper - I'd encourage
you to checkout SimpleAmqpClient https://github.com/alanxz/SimpleAmqpClient,
which is Yet Another rabbitmq-c wrapper.  It won't necessarily solve your
threading question though.

>
> Thanks,
>
> Eric
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/f7da9778/attachment.htm>

From alan.antonuk at gmail.com  Fri Feb 17 01:37:14 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 16 Feb 2012 20:37:14 -0500
Subject: [rabbitmq-discuss] rabbitmq-c: Nonblocking recv
In-Reply-To: <CALPqkipRjHuURkKipbRjD4iXZaNaYPkxU6fKK+P_NjW7O+kF_A@mail.gmail.com>
References: <3663841.2.1329332313215.JavaMail.geo-discussion-forums@vbnd9>
	<CAAt2poLm3rmD6SsBOoQ089+LSd6kKMrcxQhr=0C2Vz62T9gnrQ@mail.gmail.com>
	<CA+FLvt8wPA35fFKZc+13cvjgcpv2eKd0X_ninjSk7OD65Vfsfg@mail.gmail.com>
	<CALPqkipRjHuURkKipbRjD4iXZaNaYPkxU6fKK+P_NjW7O+kF_A@mail.gmail.com>
Message-ID: <CAAt2poJ6mVu-qLbxDfZJaLOYO5OkEfWe4k3H4dqaFGU_stAqQg@mail.gmail.com>

Brief glance at the code - it looks good to me, except for the FD_SET(...)
line which seems to have an extra ) after the sock variable.

I would uncomment the line you have commented. Its likely that if you run
this program after amqp_producer.c program, that a frame or two is cached
and that the result of amqp_frames_enqueued() is returning true

Also check with the management plugin see if there is a message in the
queue ready to be consumed.

-Alan

On Thu, Feb 16, 2012 at 1:08 PM, Brett Cameron <brett.r.cameron at gmail.com>wrote:

> Arun,
>
> A couple of random early in the morning pre-caffeine thoughts: is sock set
> to non-blocking? What's the errno value after the select() returns?
>
> Brett
>
>
> On Fri, Feb 17, 2012 at 6:14 AM, Arun Chandrasekaran <
> visionofarun at gmail.com> wrote:
>
>> Thanks for reply Alan.
>>
>> I modified the amqp_consumer.c sample code to simulate the non-blocking
>> behaviour as you mentioned.
>>
>>     /* if (!amqp_frames_enqueued(conn) && !amqp_data_in_buffer(conn)) { */
>>     if (1) {
>>        int sock = amqp_get_sockfd(conn);
>>        printf("socket: %d\n", sock);
>>
>>        /* Watch socket fd to see when it has input. */
>>        fd_set read_flags;
>>        FD_ZERO(&read_flags);
>>        FD_SET(sock), &read_flags);
>>        int ret = 0;
>>        do {
>>           struct timeval timeout;
>>
>>           /* Wait upto a second. */
>>           timeout.tv_sec = 1;
>>           timeout.tv_usec = 0;
>>
>>           ret = select(sock+1, &read_flags, NULL, NULL, &timeout);
>>           if (ret == -1)
>>              printf("select: %s\n", strerror(errno));
>>           else if (ret == 0)
>>              printf("select timedout\n");
>>           if (FD_ISSET(sock, &read_flags)) {
>>              printf("Flag is set\n");
>>           }
>>        } while (ret == 0);
>>     }
>>
>> But this always results in a timeout. Any idea where I might be going
>> wrong? I have commented the first two checks that you mentioned just for
>> sake of clarity on select().
>>
>> -Arun
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/f17b4030/attachment.htm>

From eric at holtmans.com  Fri Feb 17 02:41:47 2012
From: eric at holtmans.com (Eric J. Holtman)
Date: Thu, 16 Feb 2012 20:41:47 -0600
Subject: [rabbitmq-discuss] Multi-threading in c/c++
In-Reply-To: <CAAt2poJ6y8ND9gGWpA-kJ6_W1VjKYE2iqxbsF5GaH8nzKNmp0Q@mail.gmail.com>
References: <4F3CF301.40700@holtmans.com>
	<CAAt2poJ6y8ND9gGWpA-kJ6_W1VjKYE2iqxbsF5GaH8nzKNmp0Q@mail.gmail.com>
Message-ID: <4F3DBE6B.9090201@holtmans.com>

On 2/16/2012 7:27 PM, Alan Antonuk wrote:
> 
> Thats one way to do it.  Another would be to a have a "connection thread"
> that would own the non-thread-safe objects, and would dispatch the messages
> to the worker threads.  It takes a bit more code to accomplish it but its

....

> As a self-less plug, if you're looking for a C++ wrapper - I'd encourage
> you to checkout SimpleAmqpClient https://github.com/alanxz/SimpleAmqpClient,
> which is Yet Another rabbitmq-c wrapper.  It won't necessarily solve your
> threading question though.
> 

Thanks, Alan!

I guess after reading through a couple of books, I was assuming
that implementations of Rabbit (or AMQP) would make using multiple
channels across threads easier.

However, I spent today glancing over the actual protocol spec,
and now I understand why rabittmq-c doesn't do that:  there's
just way too much state in each object.

OK, I can live with it... I just wanted to be sure I wasn't
fundamentally misunderstanding something.



From alan.antonuk at gmail.com  Fri Feb 17 05:37:52 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 17 Feb 2012 00:37:52 -0500
Subject: [rabbitmq-discuss] Multi-threading in c/c++
In-Reply-To: <4F3DBE6B.9090201@holtmans.com>
References: <4F3CF301.40700@holtmans.com>
	<CAAt2poJ6y8ND9gGWpA-kJ6_W1VjKYE2iqxbsF5GaH8nzKNmp0Q@mail.gmail.com>
	<4F3DBE6B.9090201@holtmans.com>
Message-ID: <CAAt2poJbopKP7GDpXYo-qws5xH5FkK6BzBqwimx12yziCepVyA@mail.gmail.com>

AMQP as a spec, only really specifies how clients and brokers should talk
to each other, and the features that brokers should expose to clients.  It
leaves the programming API open to interpretation.  The rabbitmq-c library
exposes a pretty raw and low-level interface to AMQP.  It doesn't make any
effort to solve common messaging idioms (like RPC, or a multi-threaded
consumer), leaving that to the user of the library.

I hope to address this in a future version of the library, by making these
these a part of the API or providing a higher-level API that provides
solutions for these messaging patterns.

-Alan


On Thu, Feb 16, 2012 at 9:41 PM, Eric J. Holtman <eric at holtmans.com> wrote:

> On 2/16/2012 7:27 PM, Alan Antonuk wrote:
> >
> > Thats one way to do it.  Another would be to a have a "connection thread"
> > that would own the non-thread-safe objects, and would dispatch the
> messages
> > to the worker threads.  It takes a bit more code to accomplish it but its
>
> ....
>
> > As a self-less plug, if you're looking for a C++ wrapper - I'd encourage
> > you to checkout SimpleAmqpClient
> https://github.com/alanxz/SimpleAmqpClient,
> > which is Yet Another rabbitmq-c wrapper.  It won't necessarily solve your
> > threading question though.
> >
>
> Thanks, Alan!
>
> I guess after reading through a couple of books, I was assuming
> that implementations of Rabbit (or AMQP) would make using multiple
> channels across threads easier.
>
> However, I spent today glancing over the actual protocol spec,
> and now I understand why rabittmq-c doesn't do that:  there's
> just way too much state in each object.
>
> OK, I can live with it... I just wanted to be sure I wasn't
> fundamentally misunderstanding something.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/a565c54e/attachment.htm>

From visionofarun at gmail.com  Fri Feb 17 06:06:55 2012
From: visionofarun at gmail.com (Arun Chandrasekaran)
Date: Fri, 17 Feb 2012 11:36:55 +0530
Subject: [rabbitmq-discuss] rabbitmq-c: Nonblocking recv
In-Reply-To: <CAAt2poJ6mVu-qLbxDfZJaLOYO5OkEfWe4k3H4dqaFGU_stAqQg@mail.gmail.com>
References: <3663841.2.1329332313215.JavaMail.geo-discussion-forums@vbnd9>
	<CAAt2poLm3rmD6SsBOoQ089+LSd6kKMrcxQhr=0C2Vz62T9gnrQ@mail.gmail.com>
	<CA+FLvt8wPA35fFKZc+13cvjgcpv2eKd0X_ninjSk7OD65Vfsfg@mail.gmail.com>
	<CALPqkipRjHuURkKipbRjD4iXZaNaYPkxU6fKK+P_NjW7O+kF_A@mail.gmail.com>
	<CAAt2poJ6mVu-qLbxDfZJaLOYO5OkEfWe4k3H4dqaFGU_stAqQg@mail.gmail.com>
Message-ID: <CA+FLvt-OL1RenytuRyrvv=39dJn_GCVY4fAT7no6Jj-D5xADMw@mail.gmail.com>

Hi Alan,


> Brief glance at the code - it looks good to me, except for the FD_SET(...)
> line which seems to have an extra ) after the sock variable.
>
> I would uncomment the line you have commented. Its likely that if you run
> this program after amqp_producer.c program, that a frame or two is cached
> and that the result of amqp_frames_enqueued() is returning true
>
>
Thanks, I've done that. But I may be missing something here. So I've
attached the hg diff to make sure the changes are in the right place for
the non-blocking consumer.


> Also check with the management plugin see if there is a message in the
> queue ready to be consumed.
>

Currently I run on RHEL5. So I'll have to install the latest Erlang, I'll
do that today. Alternatively I have made sure that the message is ready to
be consumed by starting the consumer ahead of the producer. Will that
suffice?

Thanks,
Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/1d32ddec/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: non-block-consume.diff
Type: application/octet-stream
Size: 1795 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/1d32ddec/attachment.obj>

From liuzhuofu at huawei.com  Fri Feb 17 06:56:00 2012
From: liuzhuofu at huawei.com (Liuzhuofu)
Date: Fri, 17 Feb 2012 06:56:00 +0000
Subject: [rabbitmq-discuss] Question about using multi-channel
Message-ID: <D027DE656EBD4F4C8EE57361B5EF438E3991F7B8@szxeml524-mbs.china.huawei.com>

Hi all:
My application has 2 erlang processes, and runs ok now :
In process 1:
1. I connect to the mq-server and got the Connection.
2. open 2 channel by Connection at one time, I name they channel 1 and channel 2.
3. create exchange 1 by channel 2 (type : direct, durable : false)
4. create queue 1 by channel 2 (durable : false, passive : false, exclusive : false, auto_delete : true)
5. bind queue1 to exchange 1 by channel 2
6. create process 2, and subscribe queue 1 with process 2 by channel 1

In process 2:
1. when I receive a mq message, I send the basic.ack back by channel 1


My question is:
1. If in the process-1 step-6, I subscribe queue 1 with process by channel 2, when I send the basic.ack by channel 1 in process 2, it will cause the channel 1 closed. Why the channel closed if I change the subscribe channel? Must I send msg use the same channel as which I subscribe the the queue?

2. Because the two processes need to send/receive message parallelly, so I open two channels, and each process use one of the channels to send/receive message. Do I need to open two channels to let each process send/receive message by their own channel? Can I use only one channel in 2 or more erlang processes?

Regards,
David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/08f32e97/attachment.htm>

From vbernard42 at gmail.com  Fri Feb 17 09:07:19 2012
From: vbernard42 at gmail.com (Valentin BERNARD)
Date: Fri, 17 Feb 2012 01:07:19 -0800 (PST)
Subject: [rabbitmq-discuss] Multi-threading in c/c++
In-Reply-To: <CAAt2poJ6y8ND9gGWpA-kJ6_W1VjKYE2iqxbsF5GaH8nzKNmp0Q@mail.gmail.com>
References: <4F3CF301.40700@holtmans.com>
	<CAAt2poJ6y8ND9gGWpA-kJ6_W1VjKYE2iqxbsF5GaH8nzKNmp0Q@mail.gmail.com>
Message-ID: <8d935078-12f3-4130-8999-f5f27abaeb19@f5g2000yqm.googlegroups.com>

On 17 f?v, 02:27, Alan Antonuk <alan.anto... at gmail.com> wrote:
> As a self-less plug, if you're looking for a C++ wrapper - I'd encourage
> you to checkout SimpleAmqpClient https://github.com/alanxz/SimpleAmqpClient,
> which is Yet Another rabbitmq-c wrapper. ?It won't necessarily solve your
> threading question though.

That's really interesting. This wrapper should be advertised in the
official Clients & Developer Tools page. As a C++ RabbitMQ developer,
I reviewed a couple of C++ wrappers last year, then decided to make my
own. I'm not sure I'd have made the same choice if I had been aware of
this one.

Cheers.

From simon at rabbitmq.com  Fri Feb 17 09:58:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 17 Feb 2012 09:58:08 +0000
Subject: [rabbitmq-discuss] Performance of "blocking publisher-confirms"
 vs.	transactions
In-Reply-To: <CB627E79.2EBDC%mpietrek@skytap.com>
References: <CB627E79.2EBDC%mpietrek@skytap.com>
Message-ID: <4F3E24B0.7020704@rabbitmq.com>

On 16/02/12 17:35, Matt Pietrek wrote:
> What I'd like to know is: Is there any benefit to creating our own
> "blocking publisher-confirm publishing"? That is, we'd do the following:
>
> Publish a single message
> Block on an event 'X'
> When the publisher confirm comes in, signal 'X'
> Return from the publish call
>
> In a mirrored queue scenario, is there any advantage to doing this vs.
> using straight-up transactions?

Not really - that's more or less what's happening internally anyway.

You'd have very slightly less network traffic (but no fewer round-trips).

Later down the thread you say that "In a follow up, Simon MacMullen 
appears to agree that publisher confirms aren't ideal for us." - I'd 
clarify this as if you only allow one message in flight at a time, 
they'll be no better or worse than transactions.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Fri Feb 17 10:20:43 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 17 Feb 2012 10:20:43 +0000
Subject: [rabbitmq-discuss] RabbitMQ, STOMP and redeliver flag
In-Reply-To: <CANjOKxEdeuAkVaMuGZTit3-q4nt6dhG6PEAaHaR8-c_M6RRDAw@mail.gmail.com>
References: <1d7b8898-a6eb-450d-8a95-0ca7d61d50e4@x6g2000pbk.googlegroups.com>
	<7CC7157B-E12D-4BF4-ABAE-60A8FFABFF35@rabbitmq.com>
	<CANjOKxEdeuAkVaMuGZTit3-q4nt6dhG6PEAaHaR8-c_M6RRDAw@mail.gmail.com>
Message-ID: <5282F8A4-4268-4E60-8AA7-24DD5E09F043@rabbitmq.com>

Sunil,
Functional enhancements will appear in the announcement release notes in the
normal way, and be documented on the RabbitMQ STOMP plugin page.

If the requirement is accepted, there might be a possibility of getting you a
'patch', though it is easiest if you build your own adapter from our public
repos (which always contain the most up-to-date code).

See the pages [http://www.rabbitmq.com/stomp.html#caifs].

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 13 Feb 2012, at 18:49, Sunil Agrawal wrote:

> Thanks Steve,
> Please keep the mailing list updated once the functionality goes in a release. Meanwhile, is it possible for you to just give me a patch that I can apply locally?
> 
> Thanks, Sunil
> 
> On Mon, Feb 13, 2012 at 8:45 AM, Steve Powell <steve at rabbitmq.com> wrote:
> Sunil,
> 
> As far as I can see, redelivery information is never sent to a STOMP client,
> though this is available in the STOMP adapter, so we might be able to put it in
> a message header.
> 
> I've raised a requirement.
> 
> Steve Powell  (a delirious kitten)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> 
> On 3 Feb 2012, at 20:01, Sunil Agrawal wrote:
> 
> > Hi,
> > I just started using STOMP protocol for communicating with RabbitMQ.
> > Everything works well. However wondering if RabbitMQ tells STOMP
> > clients if a message is redelivered. Didn't see any information. If
> > this is not supported, any plans of supporting it in near future?
> >
> > Thanks in advance,
> > Sunil
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


From emile at rabbitmq.com  Fri Feb 17 10:26:38 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 17 Feb 2012 10:26:38 +0000
Subject: [rabbitmq-discuss] SSL between cluster hosts supported ?
In-Reply-To: <1329430649.14045.YahooMailNeo@web36207.mail.mud.yahoo.com>
References: <1329252661.74648.YahooMailNeo@web36203.mail.mud.yahoo.com>
	<CABzX+qz2gb9gCg9SJzy7JH-T-sKLs_RCrqKaXJx3tCuKznK5Kg@mail.gmail.com>
	<CABzX+qw+bTthyDQad9vMpR8ju0yk21EdQ=zCjAUYFAwfEv=qFw@mail.gmail.com>
	<CAH24rBOZ=M-1VNjnATnm3i1a04S6KP1=NrjaDNLEZnA8PD-oVQ@mail.gmail.com>
	<4F3D23A7.2050104@rabbitmq.com>
	<1329429794.88114.YahooMailNeo@web36206.mail.mud.yahoo.com>
	<1329430649.14045.YahooMailNeo@web36207.mail.mud.yahoo.com>
Message-ID: <4F3E2B5E.3020706@rabbitmq.com>

Hi Charles,

On 16/02/12 22:17, Charles wrote:
> erl -boot ./test_ssl   -proto_dist inet_tls -sname test_ssl  -ssl_dist_opt server_certfile "mycert.pem"  -ssl_dist_opt server_secure_renegotiate true client_secure_renegotiate true
>     exception exit: ekeyfile
>      Reason:     ekeyfile

It looks like your keyfile was not found. Try adding a server_keyfile
option.

I would also encourage you to look at the Erlang mailing lists for
Erlang-specific questions:

http://erlang.org/mailman/listinfo/erlang-questions
http://erlang.org/mailman/listinfo/erlang-bugs


-Emile

From simon at rabbitmq.com  Fri Feb 17 12:31:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 17 Feb 2012 12:31:36 +0000
Subject: [rabbitmq-discuss] Passive queue declaration and channel closure
In-Reply-To: <88E590DC4586974D825FC82AE798294E520F1E82@GSVCLU04.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E520F1E82@GSVCLU04.ges.ferlan.it>
Message-ID: <4F3E48A8.8010902@rabbitmq.com>

On 16/02/12 17:10, Busoli, Simone wrote:
> Hi, I?m revamping this
> <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-February/011314.html>
> old thread because I?m trying to solve pretty much the same problem. I
> need to know whether a queue that I have declared still exists on the
> server or has for any reason been deleted.
>
> Without relying on the management plugin I think the only way to do that
> is to declare the queue as passive.

Yes.

> At least with the .NET client and
> apparently the Java client too, when the queue does not exist, besides
> throwing an exception, the channel is closed as well.

It's the server closing the channel really. The channel closure causes 
the exception to be thrown, not the other way around.

> From the spec:
> If set, the server will reply with Declare-Ok if the queue already
> exists with the same name, and raise an error if not. The client can use
> this to check whether a queue exists without modifying the server state.
>
> There is no mention of channel closure, while the last sentence implies
> that using the passive bit is indeed a way for a client to check queue
> existence, so closing the channel when it doesn?t is a bit unexpected.

The key phrase is "raise an error". This is defined to always close the 
channel (and sometimes the connection too depending on the error code) 
in AMQP.

> That said, it?s not a big deal to recreate the channel in such cases,
> but I?d appreciate your opinion. Any chance this behavior can be changed
> in the client libraries?

It's probably slightly easier to open a new channel just to issue the 
queue.declare then close it anyway. That's what I'd do.

It's not really the client's purview, and currently the only way for the 
server to indicate an error is to close *something* anyway, so this 
isn't a trivial change...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Feb 17 12:39:42 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 17 Feb 2012 12:39:42 +0000
Subject: [rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03
 performance
In-Reply-To: <CACLE7iyaxmc0pJZ+gzNXa93da13s1iiStApp-A58BYPmmHkejw@mail.gmail.com>
References: <CB602924.2DF9C%mpietrek@skytap.com>	<4F3B8435.2040401@rabbitmq.com>	<CACLE7iwUVeao_ceQdUr-y43srcNVrk+R5R9OBOiZxGG8FZ4OnA@mail.gmail.com>	<4F3BED29.6050602@rabbitmq.com>
	<CACLE7iyaxmc0pJZ+gzNXa93da13s1iiStApp-A58BYPmmHkejw@mail.gmail.com>
Message-ID: <4F3E4A8E.8060807@rabbitmq.com>

On 15/02/12 19:18, Matt Pietrek wrote:
> If I remove the clustering, so as to just hit a single broker, the rate
> goes up to 900 message/sec. Thus, I'm directed back to looking for
> latency between the master/slaves.

I'll poke at this a bit more, but are you absolutely sure that the 
MNESIA_DIR is on a ramdisk on all the machines in the cluster? It's just 
that 36 msg/s is quite close to the performance I would expect with an 
HDD-fsync-per-commit. Just one machine could be slowing the cluster 
down, you won't see tx.commit-ok until the message is on disk on all the 
nodes...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Feb 17 12:58:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 17 Feb 2012 12:58:44 +0000
Subject: [rabbitmq-discuss] How to configure
In-Reply-To: <C3481B5CE3E61E438EEF6143B51DC17F62DEBCA82B@Y000IIIV01.rd1.rf1>
References: <C3481B5CE3E61E438EEF6143B51DC17F62DEBCA82B@Y000IIIV01.rd1.rf1>
Message-ID: <4F3E4F04.4040500@rabbitmq.com>

This is a slightly unusual thing to want to do I think.

I don't think this is a shovel question specifically, it's more of a 
routing question.

Normally if messages get sent to an arbitrary number of consumers, then 
if the number of consumers drops to zero then the messages just don't 
get routed - clearly no-one's interested. And if each message must go to 
exactly one consumer then you use a shared queue.

It sounds like you want each message to get sent to n consumers, except 
when n=0, when the messages should be buffered until someone is 
interested again.

The simplest way to do this is probably to use the alternate-exchange 
feature. Declare your "public" exchange with an alternate-exchange of 
(say) "alternate". Then declare "alternate" as a fanout exchange with 
and bind a durable queue to it. Then consumers can consume from this 
queue (to pick up any messages that were published while no-one was 
listening) and their own queue (to make sure that if there are multiple 
consumers they each get a copy of appropriate messages).

Does this make sense?

Cheers, Simon

On 15/02/12 14:47, MELIQUE Denis (MORPHO) wrote:
> Hi every body.
>
> I?m quite new with RabbitMQ, so sorry if my question is stupid.
>
> I?am currently setting a Shovel configuration to forward messages from
> one broker to another,
>
> to have a two sites Active/Semi-Active configuration. Incoming messages
> must be processed by both sites.
>
> I have set a very small testing configuration with 2 hosts.
>
> ?Active host? is running RabbitMQ 2.7.1 on Windows, as ?Semi-Active? is
> running RabbitMQ 2.6.1 on RedHat6.
>
> The test configuration is as following:
>
> - messages are posted by clients to a direct Exchange named ?public?
>
> - consumers bind to transient queues to the ?public? exchange, with a
> specific key
>
> Each consumer read a message and stores it on disk.
>
> - obviously I don?t want to lost any message
>
> My Shovel configuration has: (see attached rabbitmq.config files)
>
> 1-On the Active side:
>
> - a persistent queue bound to ?public? exchange with all possible keys.
> So every incoming message is read by the Shovel plug-In (that?s OK)
>
> - a Shovel declaration to forward messages to the distant exchange
> declared for the
>
> 2-On the Semi-Active side:
>
> - a topic exchange to which Shovel forwards messages (that?s also OK)
>
> - a persistent queue bound to this topic exchange
>
> - a Shovel declaration to forward messages into the local ?public? Exchange.
>
> Everything is fine and messages are going from Active side to
> Semi-Active one.
>
> Except when consumers are not running on the Semi-Active side.
>
> In that case, messages are sent to ?public? Exchange and are lost
> because nobody is bound to.
>
> despite the setting : ack_mode, on_confirm
>
> Nb: if the ?Semi-Active side? is not started at all, it?s OK messages
> are kept in the persistent queue
>
> On the Active side.
>
> I?am looking for a way of configuring Shovel plug-in to keep messages in
> persistent queue until
>
> a consumer can process them.
>
> I thing I am probably wrong with my configuration, but I can?t figure
> where ??
>
> Thank?s a lot.
>
> Denis
>
> #
> " Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
> ******
> " This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
> #
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From alexandru at rabbitmq.com  Fri Feb 17 13:11:46 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 17 Feb 2012 13:11:46 +0000
Subject: [rabbitmq-discuss] Question about using multi-channel
In-Reply-To: <D027DE656EBD4F4C8EE57361B5EF438E3991F7B8@szxeml524-mbs.china.huawei.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E3991F7B8@szxeml524-mbs.china.huawei.com>
Message-ID: <20120217131146.GB25862@southbank.eng.vmware.com>

Hi David,

> 1. If in the process-1 step-6, I subscribe queue 1 with process by channel 2, when I send the basic.ack by channel 1 in process 2, it will cause the channel 1 closed. Why the channel closed if I change the subscribe channel? Must I send msg use the same channel as which I subscribe the the queue?

Yes, acks are local to the channel the broker sent them on.  In other
words, you need to ack on the same channel you did the
basic.get/basic.consume.

> 2. Because the two processes need to send/receive message parallelly, so I open two channels, and each process use one of the channels to send/receive message. Do I need to open two channels to let each process send/receive message by their own channel? Can I use only one channel in 2 or more erlang processes?

It would be better if you didn't share channels between processes.  If
you do use a channel on multiple processes, it will probably not cause 
an error, but some things might not work as you expect them to.

Channels are very cheap, btw.  There's no harm in using a lot of them.

Cheers,
Alex

On Fri, Feb 17, 2012 at 06:56:00AM +0000, Liuzhuofu wrote:
> Hi all:
> My application has 2 erlang processes, and runs ok now :
> In process 1:
> 1. I connect to the mq-server and got the Connection.
> 2. open 2 channel by Connection at one time, I name they channel 1 and channel 2.
> 3. create exchange 1 by channel 2 (type : direct, durable : false)
> 4. create queue 1 by channel 2 (durable : false, passive : false, exclusive : false, auto_delete : true)
> 5. bind queue1 to exchange 1 by channel 2
> 6. create process 2, and subscribe queue 1 with process 2 by channel 1
> 
> In process 2:
> 1. when I receive a mq message, I send the basic.ack back by channel 1
> 
> 
> My question is:
> 1. If in the process-1 step-6, I subscribe queue 1 with process by channel 2, when I send the basic.ack by channel 1 in process 2, it will cause the channel 1 closed. Why the channel closed if I change the subscribe channel? Must I send msg use the same channel as which I subscribe the the queue?
> 
> 2. Because the two processes need to send/receive message parallelly, so I open two channels, and each process use one of the channels to send/receive message. Do I need to open two channels to let each process send/receive message by their own channel? Can I use only one channel in 2 or more erlang processes?
> 
> Regards,
> David

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From Simone.Busoli at ferrari.com  Fri Feb 17 13:15:40 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Fri, 17 Feb 2012 13:15:40 +0000
Subject: [rabbitmq-discuss] Passive queue declaration and channel closure
In-Reply-To: <4F3E48A8.8010902@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E520F1E82@GSVCLU04.ges.ferlan.it>
	<4F3E48A8.8010902@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E520F2237@GSVCLU04.ges.ferlan.it>

Thanks for the explanation Simon, I was missing that it was the server triggering the channel closure, while I assumed it was just the client behavior when responding to an error from the server. I concur that it's not an easy change for the client library then.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: venerd? 17 febbraio 2012 13:32
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Passive queue declaration and channel closure

On 16/02/12 17:10, Busoli, Simone wrote:
> Hi, I'm revamping this
> <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-February/01
> 1314.html> old thread because I'm trying to solve pretty much the same 
> problem. I need to know whether a queue that I have declared still 
> exists on the server or has for any reason been deleted.
>
> Without relying on the management plugin I think the only way to do 
> that is to declare the queue as passive.

Yes.

> At least with the .NET client and
> apparently the Java client too, when the queue does not exist, besides 
> throwing an exception, the channel is closed as well.

It's the server closing the channel really. The channel closure causes the exception to be thrown, not the other way around.

> From the spec:
> If set, the server will reply with Declare-Ok if the queue already 
> exists with the same name, and raise an error if not. The client can 
> use this to check whether a queue exists without modifying the server state.
>
> There is no mention of channel closure, while the last sentence 
> implies that using the passive bit is indeed a way for a client to 
> check queue existence, so closing the channel when it doesn't is a bit unexpected.

The key phrase is "raise an error". This is defined to always close the channel (and sometimes the connection too depending on the error code) in AMQP.

> That said, it's not a big deal to recreate the channel in such cases, 
> but I'd appreciate your opinion. Any chance this behavior can be 
> changed in the client libraries?

It's probably slightly easier to open a new channel just to issue the queue.declare then close it anyway. That's what I'd do.

It's not really the client's purview, and currently the only way for the server to indicate an error is to close *something* anyway, so this isn't a trivial change...

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From p.fitzsimons at g.teamaol.com  Wed Feb 15 15:29:27 2012
From: p.fitzsimons at g.teamaol.com (patrickf)
Date: Wed, 15 Feb 2012 07:29:27 -0800 (PST)
Subject: [rabbitmq-discuss] Federation and Stomp
Message-ID: <7406945.782.1329319767011.JavaMail.geo-discussion-forums@vbbdv1>

I am testing RabbitMQ for suitability in a pub/sub application over multi 
data centre network.

Existing clients are using stomp so we need to stay on stomp if at all 
possible.  I am trying to set up federation with stomp.  Federation seems 
to work fine, in that the log tells me it has federated links to the 2 
upstream exchanges that are set up in the .config file.  And using amqp I 
can send to the upstream exchange and have a consumer pick it up off the 
downstream exchange.

When using stomp with a perl client set, I connect to the upstream exchange 
with destination /exchange/<exchange name> and get an auto-delete queue.  I 
can configure a consumer client with the same destination and it pulls off 
the messages fine.   The problem is that the consumer must be connected or 
any messages sent by the producer are lost.

Is there a way to have a non-auto delete queue on the upstream exchange 
that I can connect to via stomp?

Thanks
Patrick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120215/5ad21df3/attachment.htm>

From Philipp.Gebauer at hootsuite.com  Thu Feb 16 19:16:57 2012
From: Philipp.Gebauer at hootsuite.com (Phil G)
Date: Thu, 16 Feb 2012 11:16:57 -0800 (PST)
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-1.0.0 (stable) Released.
In-Reply-To: <CB61763D.38560%pdezwart@rubiconproject.com>
References: <CB61763D.38560%pdezwart@rubiconproject.com>
Message-ID: <af283162-0edc-4968-b28d-3fa910635036@ub4g2000pbc.googlegroups.com>

Any chance to get access to updated documentation before tomorrow?
Thanks


On Feb 15, 2:48?pm, Pieter de Zwart <pdezw... at rubiconproject.com>
wrote:
> Unfortunately, the documentation will be out of date until Friday, when
> the entire PHP documentation is rebuilt. We have no control over that =(
>
> Pieter
>
> On 2/15/12 1:27 PM, "Alvaro Videla" <videlalv... at gmail.com> wrote:
>
>
>
>
>
>
>
>
>
> >Hi,
>
> >Very good news, congratulations!
>
> >Are the installation instructions here:
> >http://ch.php.net/manual/en/amqp.installation.phpup to date?
>
> >Cheers,
>
> >Alvaro
>
> >On Feb 15, 2012, at 10:19 PM, Jonathan Tansavatdi wrote:
>
> >> Just wanted to let everyone know that AMQP (a PHP extension) has been
> >> released to the public. This is the first stable release.
>
> >>> The new PECL package amqp-1.0.0 (stable) has been released at
> >>>http://pecl.php.net/.
>
> >>> Release notes
> >>> -------------
> >>> 1.0.0 Release:
> >>> Changed/finalized API signature:
> >>> ? * Exposing AMQPChannel
> >>> ? * Exposing AMQPEnvelope
> >>> ? * Exposing more queue and exchange arguments and flags
> >>> ? * Exposing basic.qos
> >>> Added persistent connections
> >>> Cleaned up codebase
> >>> Fixed memory leaks and segmentation faults
>
> >>> 0.3.1 Release:
> >>> Fixed bug:
> >>> ? * 24323: Cannot get the name for auto-named reply-to queues
>
> >>> 0.3.0 Release:
> >>> Fixed memory leaks in many functions (courtesy Jonathan Tansavatdi and
> >>> Andy Wick)
> >>> Fixed consume method to return proper values
> >>> Cleaned up variable usage
> >>> Fixed bugs:
> >>> ? * 22638: Unexpected exit code 1 with AMQPQueue::consume()
> >>> ? * 22698: AMQPQueue::consume
>
> >>> 0.2.2 Release:
> >>> Made extension compatible with PHP lt 5.3 (courtesy John Skopis)
> >>> Fixed wrong typing of message properties (courtesy John Skopis)
>
> >>> 0.2.1 Release:
> >>> Fixed refcount decrementing bug causing segfaults.
>
> >>> 0.2.0 Release:
> >>> Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
> >>> Modified AMQPConnection object:
> >>> ? * Requires call to 'connect' method to connect (no longer connects on
> >>> instantiation)
> >>> ? * Added support for disconnect and reconnect
> >>> ? * Added helper setters for port, host, vhost, login and password
> >>> Improved consume method to block for MIN messages, and try to get MAX
> >>> messages if available
> >>> Fixed zval descoping bugs
> >>> Fixed bugs:
> >>> ? * 17809: Couldn't compile pecl extension under PHP 5.3
> >>> ? * 17831: Segmentation fault when the exchange doesn't exists
> >>> ? * 19707: AMQPQueue::get() doesn't return the message
> >>> ? * 19840: Connection Exception
>
> >>> Package Info
> >>> -------------
> >>> This extension can communicate with any AMQP spec 0-9-1 compatible
> >>> server, such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to
> >>> create and delete exchanges and queues, as well as publish to any
> >>> exchange and consume from any queue.
>
> >>> Related Links
> >>> -------------
> >>> Package home:http://pecl.php.net/package/amqp
> >>> ?Changelog:http://pecl.php.net/package-changelog.php?package=amqp
> >>> ? Download:http://pecl.php.net/get/amqp-1.0.0.tgz
>
> >>> Authors
> >>> -------------
> >>> Pieter de Zwart (lead)
>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.com
> >>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> >Sent form my Nokia 1100
>
> >_______________________________________________
> >rabbitmq-discuss mailing list
> >rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From shane.hathaway at gmail.com  Thu Feb 16 20:09:34 2012
From: shane.hathaway at gmail.com (Shane Hathaway)
Date: Thu, 16 Feb 2012 12:09:34 -0800 (PST)
Subject: [rabbitmq-discuss] Patch: SSL client certificate authentication for
 the RabbitMQ STOMP plugin
Message-ID: <30741846.683.1329422974350.JavaMail.geo-discussion-forums@pbux2>

Hello,

I've been trying out RabbitMQ over the past month and I must say I'm 
impressed, especially with the management and STOMP plugins. Well done!

I decided that using SSL client certificates is important for the kind of 
deployment I'm working on, so I created a patch (attached to this email) 
that enables the STOMP plugin to authenticate clients using the CN field of 
SSL client certificates, similar to the rabbitmq_auth_mechanism_ssl plugin. 
The patch is based on the 2.7.1 release tag. I have tested it by hand and 
it seems to do the trick. I hope it can be integrated into the next release 
of RabbitMQ; please let me know if there are problems I ought to fix.

To use the new feature, add ssl_cert_login to the default_user options of 
the rabbitmq_stomp options in rabbitmq.config, then configure the STOMP 
client to omit the login and passcode headers from the CONNECT frame. Here 
is a sample rabbitmq.config:

[
    {rabbit, [
        {ssl_options, [
            {cacertfile, "mq/ca/ca.crt"},
            {certfile, "mq/server/rabbitmq-dev.crt"},
            {keyfile, "mq/server/rabbitmq-dev.key"},
            {verify, verify_peer},
            {fail_if_no_peer_cert, true}
        ]}
    ]},
    {rabbitmq_stomp, [
        {tcp_listeners, [61613]},
        {ssl_listeners, [61614]},
        {default_user, [ssl_cert_login]}
    ]}
].

Shane

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/5b1a4f80/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit_stomp_ssl_cert_login.patch
Type: text/x-diff
Size: 11095 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120216/5b1a4f80/attachment.patch>

From stransky.ja at seznam.cz  Thu Feb 16 21:21:15 2012
From: stransky.ja at seznam.cz (jaksky)
Date: Thu, 16 Feb 2012 13:21:15 -0800 (PST)
Subject: [rabbitmq-discuss]  ERROR: generation of boot script file
Message-ID: <33339060.post@talk.nabble.com>


Hi,

I am a rookie to RabbitMQ. When installing rabbitmq_management plugin on Win
XP I am getting following error:

Activating RabbitMQ plugins ...
ERROR: generation of boot script file C:/Documents and Settings/Jakub/Data
aplik
ac?/RabbitMQ/db/rabbit at JAKUB-HOME-plugins-expand/rabbit.script failed:
{error,xref_base,
       {invalid_filename,"c:/Documents and Settings/Jakub/Data
aplikac?/RabbitMQ
/db/rabbit at JAKUB-HOME-plugins-expand/amqp_client-2.7.1/ebin"}}

Anybody guess what's the problem?

Thanks
-- 
View this message in context: http://old.nabble.com/ERROR%3A-generation-of-boot-script-file-tp33339060p33339060.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From gmlexx at gmail.com  Fri Feb 17 10:22:05 2012
From: gmlexx at gmail.com (Alexey)
Date: Fri, 17 Feb 2012 02:22:05 -0800 (PST)
Subject: [rabbitmq-discuss] Consumers may hang after network instability
Message-ID: <6391f6db-070f-4848-9d1f-86b628598d14@k40g2000yqf.googlegroups.com>

Hello,

We are using 2.7.1 version of .NET client and 2.7.1 rabbitmq-server.
Several times we catched all consumers of rabbitmq server was hang
after network instability (lost and reestablished connection or server
with rabbitmq power cable unpluged)

Problem method is IModel.Close() or IConnection.Close() (sorry, I
don't remember which is)

Parts of our code responded for connection below:

public void Connect()
{
	var cf = new ConnectionFactory
	{
		HostName = replica.EndPoint.Address.ToString(),
		Port = replica.EndPoint.Port,
		UserName = mqUsername,
		Password = mqPassword,
	};
	connection = cf.CreateConnection();
	Model = connection.CreateModel();
	Model.DeclareQueue(queueName);
	Model.BasicConsume(queueName, false, thisConsumerTag, true, false,
null, this);
}

public void Disconnect(){
	if (Model != null && Model.IsOpen) Model.Close(200, "Close on client
initiative");
	if (connection != null && connection.IsOpen) connection.Close(200,
"Close on client initiative", disconnectTimeout);
}

Can anyone suggest a right way to close connection without chance to
hang?
Would appreciate for help.

From me at jigarshah.net  Fri Feb 17 13:19:47 2012
From: me at jigarshah.net (Jigar Shah)
Date: Fri, 17 Feb 2012 05:19:47 -0800 (PST)
Subject: [rabbitmq-discuss] Issue Enabling Plugins on OS X 10.7
In-Reply-To: <4F169B8E.8000001@rabbitmq.com>
References: <77f949f4-a32c-4b4f-b364-3df06e66ab8f@3g2000pbg.googlegroups.com>
	<4F169B8E.8000001@rabbitmq.com>
Message-ID: <3854628.1287.1329484787536.JavaMail.geo-discussion-forums@pbcqw3>

Did as you suggested...added []. and made directory writable...

Now i am getting

$ rabbitmq-plugins enable rabbitmq_management
Error: "The following plugins could not be found:\n  
rabbitmq_management\n\n"

Plugin directory has plugin
$ echo $RABBITMQ_PLUGINS_DIR 
/opt/rabbitmq_server-2.2.0/plugins

my 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/4f83359e/attachment.htm>

From Simone.Busoli at ferrari.com  Fri Feb 17 16:08:16 2012
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Fri, 17 Feb 2012 16:08:16 +0000
Subject: [rabbitmq-discuss] Consumers may hang after network instability
In-Reply-To: <6391f6db-070f-4848-9d1f-86b628598d14@k40g2000yqf.googlegroups.com>
References: <6391f6db-070f-4848-9d1f-86b628598d14@k40g2000yqf.googlegroups.com>
Message-ID: <88E590DC4586974D825FC82AE798294E520F237D@GSVCLU04.ges.ferlan.it>

Alexey, you need to enable heartbeats to make sure that you detect network issues. It's an option on the ConnectionFactory class.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Alexey
Sent: venerd? 17 febbraio 2012 11:22
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Consumers may hang after network instability

Hello,

We are using 2.7.1 version of .NET client and 2.7.1 rabbitmq-server.
Several times we catched all consumers of rabbitmq server was hang after network instability (lost and reestablished connection or server with rabbitmq power cable unpluged)

Problem method is IModel.Close() or IConnection.Close() (sorry, I don't remember which is)

Parts of our code responded for connection below:

public void Connect()
{
	var cf = new ConnectionFactory
	{
		HostName = replica.EndPoint.Address.ToString(),
		Port = replica.EndPoint.Port,
		UserName = mqUsername,
		Password = mqPassword,
	};
	connection = cf.CreateConnection();
	Model = connection.CreateModel();
	Model.DeclareQueue(queueName);
	Model.BasicConsume(queueName, false, thisConsumerTag, true, false, null, this); }

public void Disconnect(){
	if (Model != null && Model.IsOpen) Model.Close(200, "Close on client initiative");
	if (connection != null && connection.IsOpen) connection.Close(200, "Close on client initiative", disconnectTimeout); }

Can anyone suggest a right way to close connection without chance to hang?
Would appreciate for help.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From simon at rabbitmq.com  Fri Feb 17 16:08:46 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 17 Feb 2012 16:08:46 +0000
Subject: [rabbitmq-discuss] Issue Enabling Plugins on OS X 10.7
In-Reply-To: <3854628.1287.1329484787536.JavaMail.geo-discussion-forums@pbcqw3>
References: <77f949f4-a32c-4b4f-b364-3df06e66ab8f@3g2000pbg.googlegroups.com>	<4F169B8E.8000001@rabbitmq.com>
	<3854628.1287.1329484787536.JavaMail.geo-discussion-forums@pbcqw3>
Message-ID: <4F3E7B8E.20300@rabbitmq.com>

Are you using 2.2.0 or 2.7.1?

rabbitmq-plugins is not part of 2.2.0. With 2.2.0 you would need to 
download plugins manually from 
http://www.rabbitmq.com/releases/plugins/v2.2.0/. Or (much better) 
switch to 2.7.1.

Cheers, Simon

On 17/02/12 13:19, Jigar Shah wrote:
> Did as you suggested...added []. and made directory writable...
>
> Now i am getting
>
> $ rabbitmq-plugins enable rabbitmq_management
> Error: "The following plugins could not be found:\n rabbitmq_management\n\n"
>
> Plugin directory has plugin
> $ echo $RABBITMQ_PLUGINS_DIR
> /opt/rabbitmq_server-2.2.0/plugins
>
> my
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Fri Feb 17 16:16:22 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 17 Feb 2012 16:16:22 +0000
Subject: [rabbitmq-discuss] ERROR: generation of boot script file
In-Reply-To: <33339060.post@talk.nabble.com>
References: <33339060.post@talk.nabble.com>
Message-ID: <4F3E7D56.3010207@rabbitmq.com>

Hi,

On 16/02/12 21:21, jaksky wrote:
> I am a rookie to RabbitMQ. When installing rabbitmq_management plugin on Win
> XP I am getting following error:
> 
> Activating RabbitMQ plugins ...
> ERROR: generation of boot script file C:/Documents and Settings/Jakub/Data
> aplik
> ac?/RabbitMQ/db/rabbit at JAKUB-HOME-plugins-expand/rabbit.script failed:
> {error,xref_base,
>        {invalid_filename,"c:/Documents and Settings/Jakub/Data
> aplikac?/RabbitMQ
> /db/rabbit at JAKUB-HOME-plugins-expand/amqp_client-2.7.1/ebin"}}

Do you have any non-ASCII characters in your paths? This seems to cause
problems for Erlang on Windows.

A possible workaround is to use the "short" paths as returned by "dir
/x". In your case it should help if you set %RABBITMQ_BASE% to a folder
name that does not contain non-ASCII characters, either elsewhere on
your filesystem or by using "dir /x".



-Emile

From msteele at beringmedia.com  Fri Feb 17 16:27:51 2012
From: msteele at beringmedia.com (Mark Steele)
Date: Fri, 17 Feb 2012 11:27:51 -0500
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-1.0.0 (stable) Released.
In-Reply-To: <CB6160CA.43C38%jtansavatdi@rubiconproject.com>
References: <20120215210239.20326.qmail@pb12.pair.com>
	<CB6160CA.43C38%jtansavatdi@rubiconproject.com>
Message-ID: <CAH24rBMx1Y-EHzQYpiiWBEeUm7-nnM96Jh34OPrSN1AAEnJ2ew@mail.gmail.com>

SSL support by any chance?

On Wed, Feb 15, 2012 at 4:19 PM, Jonathan Tansavatdi <
jtansavatdi at rubiconproject.com> wrote:

> Just wanted to let everyone know that AMQP (a PHP extension) has been
> released to the public. This is the first stable release.
>
> >The new PECL package amqp-1.0.0 (stable) has been released at
> >http://pecl.php.net/.
> >
> >Release notes
> >-------------
> >1.0.0 Release:
> >Changed/finalized API signature:
> >    * Exposing AMQPChannel
> >    * Exposing AMQPEnvelope
> >    * Exposing more queue and exchange arguments and flags
> >    * Exposing basic.qos
> >Added persistent connections
> >Cleaned up codebase
> >Fixed memory leaks and segmentation faults
> >
> >0.3.1 Release:
> >Fixed bug:
> >    * 24323: Cannot get the name for auto-named reply-to queues
> >
> >0.3.0 Release:
> >Fixed memory leaks in many functions (courtesy Jonathan Tansavatdi and
> >Andy Wick)
> >Fixed consume method to return proper values
> >Cleaned up variable usage
> >Fixed bugs:
> >    * 22638: Unexpected exit code 1 with AMQPQueue::consume()
> >    * 22698: AMQPQueue::consume
> >
> >0.2.2 Release:
> >Made extension compatible with PHP lt 5.3 (courtesy John Skopis)
> >Fixed wrong typing of message properties (courtesy John Skopis)
> >
> >0.2.1 Release:
> >Fixed refcount decrementing bug causing segfaults.
> >
> >0.2.0 Release:
> >Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
> >Modified AMQPConnection object:
> >    * Requires call to 'connect' method to connect (no longer connects on
> >instantiation)
> >    * Added support for disconnect and reconnect
> >    * Added helper setters for port, host, vhost, login and password
> >Improved consume method to block for MIN messages, and try to get MAX
> >messages if available
> >Fixed zval descoping bugs
> >Fixed bugs:
> >    * 17809: Couldn't compile pecl extension under PHP 5.3
> >    * 17831: Segmentation fault when the exchange doesn't exists
> >    * 19707: AMQPQueue::get() doesn't return the message
> >    * 19840: Connection Exception
> >
> >Package Info
> >-------------
> >This extension can communicate with any AMQP spec 0-9-1 compatible
> >server, such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to
> >create and delete exchanges and queues, as well as publish to any
> >exchange and consume from any queue.
> >
> >Related Links
> >-------------
> >Package home: http://pecl.php.net/package/amqp
> >   Changelog: http://pecl.php.net/package-changelog.php?package=amqp
> >    Download: http://pecl.php.net/get/amqp-1.0.0.tgz
> >
> >Authors
> >-------------
> >Pieter de Zwart (lead)
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/73256280/attachment.htm>

From emile at rabbitmq.com  Fri Feb 17 17:32:14 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 17 Feb 2012 17:32:14 +0000
Subject: [rabbitmq-discuss] SimpleConsumer EOFException
In-Reply-To: <6199b13c-e77d-4452-b1af-48747838d7ef@ub4g2000pbc.googlegroups.com>
References: <f56426a5-56ed-4d73-8cac-591593d69726@vd8g2000pbc.googlegroups.com>
	<4F33A4B4.5060201@rabbitmq.com>
	<6199b13c-e77d-4452-b1af-48747838d7ef@ub4g2000pbc.googlegroups.com>
Message-ID: <4F3E8F1E.2020103@rabbitmq.com>

Hi Susheel,

On 09/02/12 18:12, Susheel Daswani wrote:
> Another issue I've run into is my Queuing Consumer isn't connecting
> reliably. I will start up a Queuing Consumer and it may or may not
> connect, depending on how it is feeling ;) . When it doesn't connect,
> I usually won't see any exception, though it will sometimes error out
> with the EOFException I previously wrote about. FYI I am sure there
> are messages to be consumed as I can see them from our web admin
> interface.

It sounds like you are still struggling with the symptoms of an
unreliable network. Can you reproduce any of these problems when using
the loopback interface to avoid the network?

There have been some fixes to problems in the AMQP connection
establishment logic recently. This probably wont fix your problem, but
it might be worth trying with the latest version of the Java client, or
waiting for the next release:
http://www.rabbitmq.com/build-java-client.html



-Emile



From mpietrek at skytap.com  Fri Feb 17 17:46:58 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 17 Feb 2012 09:46:58 -0800
Subject: [rabbitmq-discuss] Performance of "blocking publisher-confirms"
 vs. transactions
In-Reply-To: <CAOn7oW85LewjFWCt049xxTDms9zE-ZXxekfo_uJ8Gue-E84O2w@mail.gmail.com>
References: <CB627E79.2EBDC%mpietrek@skytap.com>
	<CAOn7oW8C-u2oJ7eYvKHE0EDL5japasAB+ZL_sME88Hk7SWE45Q@mail.gmail.com>
	<CACLE7ix7c7NakYoaKc1_+9zhiGMZXNUo4aDL=SevqZQk5TQHgw@mail.gmail.com>
	<CAOn7oW85LewjFWCt049xxTDms9zE-ZXxekfo_uJ8Gue-E84O2w@mail.gmail.com>
Message-ID: <CACLE7izmng-gMdkCGFFjS5UzW_Q9kCLtTOXLjM4C_Lao4k3fxQ@mail.gmail.com>

Simon,

What you're saying make sense from a purely technical standpoint. We could
just not consider the message sent until seeing the publisher confirm.

However, implementing this in our code would push a fair amount of
complexity back into our application layer. It's already a highly complex
state machine and adding another state, e.g. "the message *may* have been
sent", would make things far worse than they already are.

Also, I noticed that you have an exactly-once QOS requirement, whereas we
don't. We need to be tolerant of duplicate messages, but we absolutely must
get every message at least once to drive the state machine forward. Losing
a message in the "confirm window" could cause entire operations to stall.
And adding async callback into our state machine logic to change
operational state from "maybe sent" to "guaranteed sent" is a non-starter
with the other system architects.


On Thu, Feb 16, 2012 at 3:06 PM, Simone Busoli <simone.busoli at gmail.com>wrote:

> Hello Matt, thanks for the explanation and sorry for not reading the
> previous thread carefully, I did now.
>
> I can't tell you what differences you should expect between using a
> blocking publisher confirms model and transactions as I've never used
> transactions before, but allow me to insist a bit more on why the first may
> fit your scenario by describing mine. I'm using RabbitMQ in an environment
> where high reliability, together with strict ordering of messages and
> exactly-once quality of service are needed. We're using asynchronous
> publisher confirms to achieve that.
>
> You seem to be worried about a scenario in which you believe some messages
> to be in the hands of the server while instead they aren't due to the
> asynchronous nature of publisher confirms, and especially that the
> publishers may not be there to republish them in case something goes wrong.
> Without knowing much about your system I would suggest that you don't
> consider the messages as "delivered" until you receive the asynchronous
> confirm from the broker, and just pretend they were never published until
> this happens. The problem you describe seems to arise because you consider
> published messages as "delivered", which is not true until you receive a
> confirm.
> So what's worst case scenario difference between publisher confirms used
> in this way compared to transactions? If a publisher dies, in the first
> case you would consider as published only the messages that have been
> confirmed, thus pretending the unconfirmed ones to have never existed, in
> the second case an hypothetical ongoing transaction is rolled back. I think
> the difference here lies only in the number of messages you have tried to
> publish which may not have reached the broker. In the case of transactions
> it is at most 1, with async publisher confirms it may be more than 1 (it
> will be 1 with synchronous publisher confirms), but I don't think this
> number changes the nature of the problem.
>
> On Thu, Feb 16, 2012 at 22:44, Matt Pietrek <mpietrek at skytap.com> wrote:
>
>> Hi Simone,
>>
>> | Can you describe why you think publisher confirms are not appropriate
>> in your scenario?
>>
>> I think if you read the paragraph that starts with "At the heart of
>> things" it describes the scenario in enough detail. In a follow up, Simon
>> MacMullen appears to agree that publisher confirms aren't ideal for us.
>>
>> In short, when we publish a message, we must know that the broker safely
>> has it. With transactions, OR a blocking publisher-confirm model, the
>> client is assured it has it.
>>
>> HOWEVER, all the publisher-confirm descriptions/examples I've seen assume
>> an async model: Publish a message and some time later you'll be told that
>> the message is safely in the broker's hands. However, that window between
>> those two events is the crux of the problem in our environment.
>>
>> Assume we went with the async publisher-confirm model as suggested. What
>> if our client dies and is not around to re-send the message? Or what if the
>> client dies, and milliseconds later the broker dies? No publisher confirm
>> would be forthcoming, and hence, lost messages.
>>
>> Top level problem for us: Our state machine, which persists every
>> critical change of state to a database, will be incorrect. We will have
>> recorded "Yup, that message was sent", when in reality it might not have
>> made it to broker, or the broker died before the confirm could be sent.
>>
>> By not recording that we've sent the message until AFTER a
>> transaction/publisher-confirm completes, we can guarantee the integrity of
>> our state-machine. However, as we've all seen, transactions impose a limit
>> on message throughput. I'm simply trying to understand if there's any
>> non-trivial message rate difference expected between using a transaction
>> vs. waiting in my publish routine for the confirm.
>>
>>
>> | If you happen to be using the .NET API this is already implemented, the
>> WaitForConfirms and WaitForConfirmsOrDie on the IModel interface provide
>> this behavior.
>>
>> Unfortunately, I'm not on a .NET client. I'm using Python/Pika. I'd
>> consider going to the c-library (wrapped from Python) if there's some
>> non-trivial benefit to using a synchronous publisher-confirm.
>>
>> Thanks,
>>
>> Matt
>>
>> On Thu, Feb 16, 2012 at 1:08 PM, Simone Busoli <simone.busoli at gmail.com>wrote:
>>
>>> Hi Matt, I've gone through the old thread very quickly so forgive me if
>>> I'm missing something. Your first sentence leaves me with some doubts:
>>>
>>>  As I've detailed in other posts to this DL (http://bit.ly/zf6sKC), we
>>>> have situation where straightforward publisher-confirms aren't appropriate
>>>> in our scenario. We need to know the broker has received the message, and
>>>> we have to assume our client can die at any moment, so retransmitting
>>>> messages is not an option for us.
>>>>
>>>
>>> Publisher confirms guarantee that the broker has taken care of the
>>> message and it has been either delivered to a queue or to a consumer. This
>>> is a strong delivery guarantee, even if the client dies. Coupled with
>>> persistent messages and durable exchange/queues, it guarantees
>>> at-least-once delivery. Can you describe why you think publisher confirms
>>> are not appropriate in your scenario?
>>>
>>>
>>>> What I'd like to know is: Is there any benefit to creating our own
>>>> "blocking publisher-confirm publishing"? That is, we'd do the following:
>>>>
>>>> Publish a single message
>>>> Block on an event 'X'
>>>> When the publisher confirm comes in, signal 'X'
>>>> Return from the publish call
>>>>
>>>
>>> If you happen to be using the .NET API this is already implemented, the
>>> WaitForConfirms and WaitForConfirmsOrDie on the IModel interface provide
>>> this behavior.
>>>
>>>
>>>> In a mirrored queue scenario, is there any advantage to doing this vs.
>>>> using straight-up transactions?
>>>>
>>>> Matt
>>>>
>>>> p.s. I realize in the above pseudocode that multiple threads would be
>>>> necessary - One to block and the other to listen for the publisher-confirm.
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/8977dc21/attachment.htm>

From mpietrek at skytap.com  Fri Feb 17 17:49:06 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 17 Feb 2012 09:49:06 -0800
Subject: [rabbitmq-discuss] Performance of "blocking publisher-confirms"
 vs. transactions
In-Reply-To: <4F3E24B0.7020704@rabbitmq.com>
References: <CB627E79.2EBDC%mpietrek@skytap.com>
	<4F3E24B0.7020704@rabbitmq.com>
Message-ID: <CACLE7izExUX5W8cDRVrAHf2ZPV9y83qZT8bhvOqHdA6OeBv0KA@mail.gmail.com>

| Not really - that's more or less what's happening internally anyway.

Excellent. Well, not the part that there's no perf to be gained, but at
least I know what to expect.

| I'd clarify this as if you only allow one message in flight at a time,
they'll be no better or worse than transactions.

I assumed that, but thanks for explicitly clarifying this for future
readers of this thread.

On Fri, Feb 17, 2012 at 1:58 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 16/02/12 17:35, Matt Pietrek wrote:
>
>> What I'd like to know is: Is there any benefit to creating our own
>> "blocking publisher-confirm publishing"? That is, we'd do the following:
>>
>> Publish a single message
>> Block on an event 'X'
>> When the publisher confirm comes in, signal 'X'
>> Return from the publish call
>>
>> In a mirrored queue scenario, is there any advantage to doing this vs.
>> using straight-up transactions?
>>
>
> Not really - that's more or less what's happening internally anyway.
>
> You'd have very slightly less network traffic (but no fewer round-trips).
>
> Later down the thread you say that "In a follow up, Simon MacMullen
> appears to agree that publisher confirms aren't ideal for us." - I'd
> clarify this as if you only allow one message in flight at a time, they'll
> be no better or worse than transactions.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/15f7ea69/attachment.htm>

From pdezwart at rubiconproject.com  Fri Feb 17 18:09:15 2012
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Fri, 17 Feb 2012 12:09:15 -0600
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-1.0.0 (stable) Released.
In-Reply-To: <CAH24rBMx1Y-EHzQYpiiWBEeUm7-nnM96Jh34OPrSN1AAEnJ2ew@mail.gmail.com>
Message-ID: <CB63D7A4.38A31%pdezwart@rubiconproject.com>

I can only support SSL if the underlying C library supports it? So, does anyone know if librabbitmq-c supports SSL?

From: Mark Steele <msteele at beringmedia.com<mailto:msteele at beringmedia.com>>
Date: Fri, 17 Feb 2012 10:27:51 -0600
To: Jonathan Tansavatdi <jtansavatdi at rubiconproject.com<mailto:jtansavatdi at rubiconproject.com>>
Cc: RabbitMQ Mailing List <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-1.0.0 (stable) Released.

SSL support by any chance?

On Wed, Feb 15, 2012 at 4:19 PM, Jonathan Tansavatdi <jtansavatdi at rubiconproject.com<mailto:jtansavatdi at rubiconproject.com>> wrote:
Just wanted to let everyone know that AMQP (a PHP extension) has been
released to the public. This is the first stable release.

>The new PECL package amqp-1.0.0 (stable) has been released at
>http://pecl.php.net/.
>
>Release notes
>-------------
>1.0.0 Release:
>Changed/finalized API signature:
>    * Exposing AMQPChannel
>    * Exposing AMQPEnvelope
>    * Exposing more queue and exchange arguments and flags
>    * Exposing basic.qos
>Added persistent connections
>Cleaned up codebase
>Fixed memory leaks and segmentation faults
>
>0.3.1 Release:
>Fixed bug:
>    * 24323: Cannot get the name for auto-named reply-to queues
>
>0.3.0 Release:
>Fixed memory leaks in many functions (courtesy Jonathan Tansavatdi and
>Andy Wick)
>Fixed consume method to return proper values
>Cleaned up variable usage
>Fixed bugs:
>    * 22638: Unexpected exit code 1 with AMQPQueue::consume()
>    * 22698: AMQPQueue::consume
>
>0.2.2 Release:
>Made extension compatible with PHP lt 5.3 (courtesy John Skopis)
>Fixed wrong typing of message properties (courtesy John Skopis)
>
>0.2.1 Release:
>Fixed refcount decrementing bug causing segfaults.
>
>0.2.0 Release:
>Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
>Modified AMQPConnection object:
>    * Requires call to 'connect' method to connect (no longer connects on
>instantiation)
>    * Added support for disconnect and reconnect
>    * Added helper setters for port, host, vhost, login and password
>Improved consume method to block for MIN messages, and try to get MAX
>messages if available
>Fixed zval descoping bugs
>Fixed bugs:
>    * 17809: Couldn't compile pecl extension under PHP 5.3
>    * 17831: Segmentation fault when the exchange doesn't exists
>    * 19707: AMQPQueue::get() doesn't return the message
>    * 19840: Connection Exception
>
>Package Info
>-------------
>This extension can communicate with any AMQP spec 0-9-1 compatible
>server, such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to
>create and delete exchanges and queues, as well as publish to any
>exchange and consume from any queue.
>
>Related Links
>-------------
>Package home: http://pecl.php.net/package/amqp
>   Changelog: http://pecl.php.net/package-changelog.php?package=amqp
>    Download: http://pecl.php.net/get/amqp-1.0.0.tgz
>
>Authors
>-------------
>Pieter de Zwart (lead)

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/93a21c76/attachment.htm>

From mpietrek at skytap.com  Fri Feb 17 19:17:24 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 17 Feb 2012 11:17:24 -0800
Subject: [rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03
	performance
In-Reply-To: <4F3E4A8E.8060807@rabbitmq.com>
References: <CB602924.2DF9C%mpietrek@skytap.com>
	<4F3B8435.2040401@rabbitmq.com>
	<CACLE7iwUVeao_ceQdUr-y43srcNVrk+R5R9OBOiZxGG8FZ4OnA@mail.gmail.com>
	<4F3BED29.6050602@rabbitmq.com>
	<CACLE7iyaxmc0pJZ+gzNXa93da13s1iiStApp-A58BYPmmHkejw@mail.gmail.com>
	<4F3E4A8E.8060807@rabbitmq.com>
Message-ID: <CACLE7iw0zRurNgeNRO7aO3AesLrYDvkSr6vm1vGL8kdyKoL-mQ@mail.gmail.com>

I'm quite sure about them all being on ramdisks. It was the first thing I
verified. :-)

One interesting thing to note is that the 37/sec was up quite a bit from
the 25 or so that I was getting before switching to ramdisks.

Now, here's a big reveal...

The 37/sec rate were seeing is for a single client process using mirroring
with 3 queues, persistent messages, and transactions.

If I run multiple identical clients, all writing to the same queue, it
scales extremely well. With five clients, the incoming message rate is five
times as high. Pushing things up to an extreme, I capped out at about 1700
messages/sec to the same queue with 100 clients. The rate per individual
client was about half of the original 37, but that's still very reasonable
for 100 clients banging on the broker.

While I'm very happy with these results, I'm still puzzled. Given that all
clients are writing to the same queue, I'd expect resource
contention/blocking in the broker to slow things down much faster than they
do. Any comment on this? Am I overlooking anything critical to my
understanding?

Thanks,

Matt


On Fri, Feb 17, 2012 at 4:39 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 15/02/12 19:18, Matt Pietrek wrote:
>
>> If I remove the clustering, so as to just hit a single broker, the rate
>> goes up to 900 message/sec. Thus, I'm directed back to looking for
>> latency between the master/slaves.
>>
>
> I'll poke at this a bit more, but are you absolutely sure that the
> MNESIA_DIR is on a ramdisk on all the machines in the cluster? It's just
> that 36 msg/s is quite close to the performance I would expect with an
> HDD-fsync-per-commit. Just one machine could be slowing the cluster down,
> you won't see tx.commit-ok until the message is on disk on all the nodes...
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/0cffd8f7/attachment.htm>

From alan.antonuk at gmail.com  Sat Feb 18 00:44:11 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 17 Feb 2012 19:44:11 -0500
Subject: [rabbitmq-discuss] rabbitmq-c: Nonblocking recv
In-Reply-To: <CA+FLvt-OL1RenytuRyrvv=39dJn_GCVY4fAT7no6Jj-D5xADMw@mail.gmail.com>
References: <3663841.2.1329332313215.JavaMail.geo-discussion-forums@vbnd9>
	<CAAt2poLm3rmD6SsBOoQ089+LSd6kKMrcxQhr=0C2Vz62T9gnrQ@mail.gmail.com>
	<CA+FLvt8wPA35fFKZc+13cvjgcpv2eKd0X_ninjSk7OD65Vfsfg@mail.gmail.com>
	<CALPqkipRjHuURkKipbRjD4iXZaNaYPkxU6fKK+P_NjW7O+kF_A@mail.gmail.com>
	<CAAt2poJ6mVu-qLbxDfZJaLOYO5OkEfWe4k3H4dqaFGU_stAqQg@mail.gmail.com>
	<CA+FLvt-OL1RenytuRyrvv=39dJn_GCVY4fAT7no6Jj-D5xADMw@mail.gmail.com>
Message-ID: <CAAt2poJyZJ+c1dD5FSoCQ0Dfx7a_8YFUbD53t0fHPt=JkdmRkA@mail.gmail.com>

You need to have the FD_ZERO() and FD_SET() inside the do loop.  select()
clears the fd_set if nothing has been seen on a socket.

-Alan

On Fri, Feb 17, 2012 at 1:06 AM, Arun Chandrasekaran <visionofarun at gmail.com
> wrote:

> Hi Alan,
>
>
>> Brief glance at the code - it looks good to me, except for the
>> FD_SET(...) line which seems to have an extra ) after the sock variable.
>>
>> I would uncomment the line you have commented. Its likely that if you run
>> this program after amqp_producer.c program, that a frame or two is cached
>> and that the result of amqp_frames_enqueued() is returning true
>>
>>
> Thanks, I've done that. But I may be missing something here. So I've
> attached the hg diff to make sure the changes are in the right place for
> the non-blocking consumer.
>
>
>> Also check with the management plugin see if there is a message in the
>> queue ready to be consumed.
>>
>
> Currently I run on RHEL5. So I'll have to install the latest Erlang, I'll
> do that today. Alternatively I have made sure that the message is ready to
> be consumed by starting the consumer ahead of the producer. Will that
> suffice?
>
> Thanks,
> Arun
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120217/0953d233/attachment.htm>

From nareshpaturi at gmail.com  Sat Feb 18 20:30:29 2012
From: nareshpaturi at gmail.com (Naresh Kumar Paturi)
Date: Sun, 19 Feb 2012 02:00:29 +0530
Subject: [rabbitmq-discuss] RabbitMQ language support
Message-ID: <CA+Xpm25qY8-W41=9s_MN3xGzPYj2Jd_emXM+Au6S9eM_bdHWVA@mail.gmail.com>

Hi ,

I'm trying to evaluate RabbitMQ for my product . I have a basic/simple
question . Can we write a publisher in "c" language and subscriber in
"Python" ?  I'm thinking answer should be yes but just i want to make sure
.

-Naresh Kumar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120219/103027b3/attachment.htm>

From videlalvaro at gmail.com  Sat Feb 18 20:35:25 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 18 Feb 2012 21:35:25 +0100
Subject: [rabbitmq-discuss] RabbitMQ language support
In-Reply-To: <CA+Xpm25qY8-W41=9s_MN3xGzPYj2Jd_emXM+Au6S9eM_bdHWVA@mail.gmail.com>
References: <CA+Xpm25qY8-W41=9s_MN3xGzPYj2Jd_emXM+Au6S9eM_bdHWVA@mail.gmail.com>
Message-ID: <82D6BE1D-1B77-4E23-9F76-0626EBA5D4FB@gmail.com>

Hi,

Yes you can.

See here for more examples: http://www.rabbitmq.com/devtools.html

Cheers,

Alvaro

On Feb 18, 2012, at 9:30 PM, Naresh Kumar Paturi wrote:

> Hi ,
> 
> I'm trying to evaluate RabbitMQ for my product . I have a basic/simple question . Can we write a publisher in "c" language and subscriber in "Python" ?  I'm thinking answer should be yes but just i want to make sure . 
> 
> -Naresh Kumar
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From michael.s.klishin at gmail.com  Sat Feb 18 20:38:21 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 19 Feb 2012 00:38:21 +0400
Subject: [rabbitmq-discuss] RabbitMQ language support
In-Reply-To: <CA+Xpm25qY8-W41=9s_MN3xGzPYj2Jd_emXM+Au6S9eM_bdHWVA@mail.gmail.com>
References: <CA+Xpm25qY8-W41=9s_MN3xGzPYj2Jd_emXM+Au6S9eM_bdHWVA@mail.gmail.com>
Message-ID: <BC15099E-2070-47C0-B4CC-ECA604C0AA0B@gmail.com>

Naresh Kumar Paturi:

> I'm trying to evaluate RabbitMQ for my product . I have a basic/simple question . Can we write a publisher in "c" language and subscriber in "Python" ?  I'm thinking answer should be yes but just i want to make sure .

You can. Interoperability was one of the original goals of AMQP.

See http://bit.ly/amqp-model-explained, it serves as a good protocol overview.

MK


From xdaan.dll at gmail.com  Fri Feb 17 16:19:46 2012
From: xdaan.dll at gmail.com (xdnny)
Date: Fri, 17 Feb 2012 08:19:46 -0800 (PST)
Subject: [rabbitmq-discuss] First Python sample (send.py) gives error:
 AttributeError: 'ProtocolHeader' object has no attribute 'channel_number'
In-Reply-To: <BANLkTimuwJwDvdS_3xBQ8SpgyQZm=omQ5w@mail.gmail.com>
References: <6FAF49FAB4B44CED824F5CF6CB575181@gmail.com>
	<CA336841.817D%mpietrek@skytap.com>
	<BANLkTimuwJwDvdS_3xBQ8SpgyQZm=omQ5w@mail.gmail.com>
Message-ID: <086464d8-b6c3-4dba-9794-f6ad568edd31@q12g2000yqg.googlegroups.com>

Hello,

well, for me it doesn't work.

OS: Scientific Linux 6.2 - 2.6.32-220.4.1.el6.i686 (RHEL)
Python: 2.6.6
Pika: 0.9.5
RabbitMQ: rabbitmq-server-2.6.1 (also tried rabbitmq-server-2.7.1 from
rabbitmq.com)

After running an example "send.py" from https://www.rabbitmq.com/tutorials/tutorial-one-python.html,
here is the error:

AttributeError: 'ProtocolHeader' object has no attribute
'channel_number'

Full stack trace:

python send.py
Traceback (most recent call last):
  File "send.py", line 7, in <module>
    host='localhost'))
  File "/usr/lib/python2.6/site-packages/pika/adapters/
blocking_connection.py", line 32, in __init__
    BaseConnection.__init__(self, parameters, None,
reconnection_strategy)
  File "/usr/lib/python2.6/site-packages/pika/adapters/
base_connection.py", line 50, in __init__
    reconnection_strategy)
  File "/usr/lib/python2.6/site-packages/pika/connection.py", line
170, in __init__
    self._connect()
  File "/usr/lib/python2.6/site-packages/pika/connection.py", line
228, in _connect
    self.parameters.port or  spec.PORT)
  File "/usr/lib/python2.6/site-packages/pika/adapters/
blocking_connection.py", line 44, in _adapter_connect
    self._handle_read()
  File "/usr/lib/python2.6/site-packages/pika/adapters/
base_connection.py", line 162, in _handle_read
    self._on_data_available(data)
  File "/usr/lib/python2.6/site-packages/pika/connection.py", line
597, in _on_data_available
    elif frame.channel_number > 0:
AttributeError: 'ProtocolHeader' object has no attribute
'channel_number'

On Jul 1 2011, 9:02?pm, Marek Majkowski <maje... at gmail.com> wrote:
> On Fri, Jul 1, 2011 at 20:05, Matt Pietrek <mpiet... at skytap.com> wrote:
> > Indeed. Lesson learned for me.
>
> > With the newer version (2.5.1), the sample app works as expected.
>
> > Thanks much to both of your for your replies,
>
> Yeah, sorry for that. RabbitMQ moves a bit faster than linux distributions :)
>
> (although, that's a lesson for us - client packages should support
> "old" releases!)
>
> I'm glad you were able to get it working.
>
> Cheers,
> ? ?Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From abdullahsaima at yahoo.com  Sun Feb 19 14:03:36 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Sun, 19 Feb 2012 14:03:36 +0000 (GMT)
Subject: [rabbitmq-discuss] Some questions
In-Reply-To: <1328267963.21593.YahooMailNeo@web29706.mail.ird.yahoo.com>
References: <1328184592.31745.YahooMailNeo@web29702.mail.ird.yahoo.com>
	<07af12f2-a652-402d-a8ed-3b63d19b72a9@strongmad.batnest.org>
	<1328267963.21593.YahooMailNeo@web29706.mail.ird.yahoo.com>
Message-ID: <1329660216.3219.YahooMailNeo@web29706.mail.ird.yahoo.com>

Hello Everyone.

I need to ask some simple questions regarding AMQP 0-9-1. I am understanding simple concepts about it.?
1. How a producer in AMQP knows that this exchange would be used for its sent message.

2. Can anyone help me for wildcard programming in C++ as I want to understand the working of direct exchange by implementing it in C++.

Hoping best from your side.
?
Saima Asif


________________________________
 From: Saima Asif <abdullahsaima at yahoo.com>
To: Jerry Kuch <jerryk at vmware.com> 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Friday, 3 February 2012, 11:19
Subject: Re: [rabbitmq-discuss] help required: bind function
 

Hi Jerry,
?
That was quite nice answer, I appreciate. 
Now I am thinking to manage record of table?to represents the binding. Hope it would serve what?I intended to do. 
Actually I am not very good at progamming I find the idea interesting but find difficulty in implemeting. As I am so much confused about this binding. 
?
However Thanks for your support thats he only forum where I hope to get something.
?
Best Regards,?
Saima
From: Jerry Kuch <jerryk at vmware.com>
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: Emile Joubert <emile at rabbitmq.com>; rabbitmq-discuss at lists.rabbitmq.com 
Sent: Thursday, 2 February 2012, 16:53
Subject: Re: [rabbitmq-discuss] help required: bind function

Hi, Saima.

If you're trying to to implement some aspect of the actual AMQP
message transport, for
 learning purposes, you might consider following
RabbitMQ's structure.

In Rabbit, a binding of an exchange to a queue is essentially a record
in a table somewhere saying this exchange is bound to this queue, with
this associated routing key.

The actual work of getting a message published to that exchange into
an appropriate bound queue, is actually done by the process associated
with the communications channel used by the message's sender.? Essentially
it looks up the particulars of the exchange, determines what routing logic
is appropriate to use for that exchange type, looks at the message's routing
key if appropriate, and tries to match it to a binding.? If match(es) are
found, the message is forwarded to a process representing the queue, which is
responsible for its contents.? Almost symmetrically on the consumer side, 
a consumer's channel talks to the queue it's consuming from to ask it
 to 
disgorge its messages.

Apologies if this isn't quite what you're asking... I confess I may not fully 
grasp the ultimate intent of your investigations...

Best regards,
Jerry

----- Original Message -----
From: "Saima Asif" <abdullahsaima at yahoo.com>
To: "Emile Joubert" <emile at rabbitmq.com>, rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, February 2, 2012 4:09:52 AM
Subject: Re: [rabbitmq-discuss] help required: bind function




Thank you very much Emile and Aamir for your kind replies. 

Infact I know the basic concept of binding, if a queue is bounded to exchange then that queue wants to receive the
 message from that particular exchange. But I am so sorry I dont know how to interpret this relationship into programming langauge i.e. C++. How can I specify the queue that now this queue will recieve messages from this exch ange. I have consulted all the material, But the problem is writing and interpreting. I am so sorry I think it would be a big ask. 

Any help would be highly appreiated. 


Saima 



From: Emile Joubert <emile at rabbitmq.com> 
To: rabbitmq-discuss at lists.rabbitmq.com; abdullahsaima at yahoo.com 
Sent: Thursday, 2 February 2012, 9:51 
Subject: Re: [rabbitmq-discuss] help required: bind function 

Hi Saima, 

On 31/01/12
 22:23, Saima Asif wrote: 
> I am student , and my supervisor and I have chosen to implement and 
> study it at very simpler level. my classes are not refined. There is one 
> class "message" which has a routing key. 
> I need your help how can I write Bind() function for this. 

Keep in mind that binding is an operation on a queue, not a message. See 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.queue for queue 
operations. 

Have you taken a look at the tutorials at 
http://www.rabbitmq.com/getstarted.html ? 
They introduce AMQP concepts (including binding) in a way that should be 
of help. Unfortunately no C or C++ translation exists, but if you feel 
brave you could contribute this. 

-Emile 



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120219/06bcc985/attachment.htm>

From jon.hill at comshen.com  Sun Feb 19 18:01:38 2012
From: jon.hill at comshen.com (Jon Hill)
Date: Sun, 19 Feb 2012 10:01:38 -0800 (PST)
Subject: [rabbitmq-discuss] Consumers and exceptions
Message-ID: <136bb8b3-7484-4830-9e8d-4a0af5bb1df2@bs8g2000vbb.googlegroups.com>

Hi

I've just been reading this post:
http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/77bc5f0329fa61c4/bf0c15a0502555ae?lnk=gst&q=defaultconsumer#bf0c15a0502555ae

It tells me that if an Exception is thrown from a Consumer the
expected behaviour is to close the connection (my shutdown listener
doesn't kick in when this occurs either).

So, should I return immediately once the consumption has finished and
handle the application layer processing of the messages in a separate
thread?

Best,

Jon

From lionel.cons at cern.ch  Mon Feb 20 07:47:44 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 20 Feb 2012 08:47:44 +0100
Subject: [rabbitmq-discuss] Patch: SSL client certificate authentication
	for the RabbitMQ STOMP plugin
In-Reply-To: <30741846.683.1329422974350.JavaMail.geo-discussion-forums@pbux2>
	(Shane Hathaway's message of "Thu, 16 Feb 2012 12:09:34 -0800")
References: <30741846.683.1329422974350.JavaMail.geo-discussion-forums@pbux2>
Message-ID: <bw7fwe63pzz.fsf@mail.cern.ch>

Shane Hathaway <shane.hathaway at gmail.com> writes:
> I decided that using SSL client certificates is important for the kind of
> deployment I'm working on, so I created a patch (attached to this email)

Shane,

It's good to see others interested in good X.509 authentication in RabbitMQ.

IMHO, improvements in this area should follow what has already been discussed:
http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/3c490aa6ab2b6c11/fdf693d284916526
in particular: flexibility (CNs are not suitable in some envirnonments, DNs
look more versatile) and uniformity (same Erlang code for AMQP, STOMP &
management interfaces).

Cheers,

Lionel

From muhammad.kamrana at gmail.com  Mon Feb 20 00:41:29 2012
From: muhammad.kamrana at gmail.com (Kamran)
Date: Sun, 19 Feb 2012 16:41:29 -0800 (PST)
Subject: [rabbitmq-discuss] basicpublish Android to Java?
Message-ID: <4561153.5471.1329698489313.JavaMail.geo-discussion-forums@vbbgt10>

Hi,
I am new can you please help me out? Is there anyway I can send messages 
from android to java files via basicpublish, the other way around is 
possible.  
http://simonwdixon.wordpress.com/2011/06/03/getting-started-with-rabbitmq-on-android-part-1/ I 
have tried with handlers and with out it. Doesn't work.

Regards!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120219/24c8ee27/attachment.htm>

From emile at rabbitmq.com  Mon Feb 20 10:33:20 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Feb 2012 10:33:20 +0000
Subject: [rabbitmq-discuss] basicpublish Android to Java?
In-Reply-To: <4561153.5471.1329698489313.JavaMail.geo-discussion-forums@vbbgt10>
References: <4561153.5471.1329698489313.JavaMail.geo-discussion-forums@vbbgt10>
Message-ID: <4F422170.2030803@rabbitmq.com>

Hi,

On 20/02/12 00:41, Kamran wrote:
> I am new can you please help me out? Is there anyway I can send messages
> from android to java files via basicpublish, the other way around is
> possible. 
> http://simonwdixon.wordpress.com/2011/06/03/getting-started-with-rabbitmq-on-android-part-1/ I
> have tried with handlers and with out it. Doesn't work.

If I understand your question correctly you wish to send messages from
"java files" to "android". Can you please explain what you mean by "java
files"?

If you have the RabbitMQ Java client working on Android then you should
be able to publish and subscribe. Are you saying this is working only in
one direction?


-Emile

From emile at rabbitmq.com  Mon Feb 20 10:46:47 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Feb 2012 10:46:47 +0000
Subject: [rabbitmq-discuss] Some questions
In-Reply-To: <1329660216.3219.YahooMailNeo@web29706.mail.ird.yahoo.com>
References: <1328184592.31745.YahooMailNeo@web29702.mail.ird.yahoo.com>
	<07af12f2-a652-402d-a8ed-3b63d19b72a9@strongmad.batnest.org>
	<1328267963.21593.YahooMailNeo@web29706.mail.ird.yahoo.com>
	<1329660216.3219.YahooMailNeo@web29706.mail.ird.yahoo.com>
Message-ID: <4F422497.4000109@rabbitmq.com>

Hi Saima,

On 19/02/12 14:03, Saima Asif wrote:
> 1. How a producer in AMQP knows that this exchange would be used for its
> sent message.

A publisher selects a target exchange when publishing by supplying the
"exchange" parameter in the basic.publish method.

The only exhanges that are always guaranteed to exist are the defaults.
If the publisher requires any other exchanges then those need to be
declared before publishing starts.

> 2. Can anyone help me for wildcard programming in C++ as I want to
> understand the working of direct exchange by implementing it in C++.

The 5th tutorial has an explaination of wildcards and topic exchanges:
http://www.rabbitmq.com/tutorials/tutorial-five-python.html



-Emile

From matthew at rabbitmq.com  Mon Feb 20 11:28:04 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 20 Feb 2012 11:28:04 +0000
Subject: [rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03
 performance
In-Reply-To: <CACLE7iw0zRurNgeNRO7aO3AesLrYDvkSr6vm1vGL8kdyKoL-mQ@mail.gmail.com>
References: <CB602924.2DF9C%mpietrek@skytap.com>
	<4F3B8435.2040401@rabbitmq.com>
	<CACLE7iwUVeao_ceQdUr-y43srcNVrk+R5R9OBOiZxGG8FZ4OnA@mail.gmail.com>
	<4F3BED29.6050602@rabbitmq.com>
	<CACLE7iyaxmc0pJZ+gzNXa93da13s1iiStApp-A58BYPmmHkejw@mail.gmail.com>
	<4F3E4A8E.8060807@rabbitmq.com>
	<CACLE7iw0zRurNgeNRO7aO3AesLrYDvkSr6vm1vGL8kdyKoL-mQ@mail.gmail.com>
Message-ID: <20120220112803.GA5917@rabbitmq.com>

On Fri, Feb 17, 2012 at 11:17:24AM -0800, Matt Pietrek wrote:
> While I'm very happy with these results, I'm still puzzled. Given that all
> clients are writing to the same queue, I'd expect resource
> contention/blocking in the broker to slow things down much faster than they
> do. Any comment on this? Am I overlooking anything critical to my
> understanding?

There's a "window" of time during which no fsyncs will occur, and
txn-publishes will merely accumulate. Only when that window closes will
the fsync be performed. With a single publisher, each window can only
have a single publisher's msgs in it. But with many publishers, the
fsync is effectively amortized, and thus a higher rate is achieved - if
you monitor with strace or similar, you'll probably see the fsync rate
is not much different, regardless of the number of publishers you have
publishing to the same queue.

Matthew

From majek04 at gmail.com  Mon Feb 20 11:32:49 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 20 Feb 2012 11:32:49 +0000
Subject: [rabbitmq-discuss] First Python sample (send.py) gives error:
 AttributeError: 'ProtocolHeader' object has no attribute 'channel_number'
In-Reply-To: <086464d8-b6c3-4dba-9794-f6ad568edd31@q12g2000yqg.googlegroups.com>
References: <6FAF49FAB4B44CED824F5CF6CB575181@gmail.com>
	<CA336841.817D%mpietrek@skytap.com>
	<BANLkTimuwJwDvdS_3xBQ8SpgyQZm=omQ5w@mail.gmail.com>
	<086464d8-b6c3-4dba-9794-f6ad568edd31@q12g2000yqg.googlegroups.com>
Message-ID: <CABzX+qy7vvX03j6SRuOj7aTRTRAiTLW3NnE-SAx+TnOa-uxQYQ@mail.gmail.com>

On Fri, Feb 17, 2012 at 16:19, xdnny <xdaan.dll at gmail.com> wrote:
> Hello,
>
> well, for me it doesn't work.

You must be doing something wrong. Pika 0.9.5 works fine with
RabbitMQ 2.x.

Marek

> OS: Scientific Linux 6.2 - 2.6.32-220.4.1.el6.i686 (RHEL)
> Python: 2.6.6
> Pika: 0.9.5
> RabbitMQ: rabbitmq-server-2.6.1 (also tried rabbitmq-server-2.7.1 from
> rabbitmq.com)
>
> After running an example "send.py" from https://www.rabbitmq.com/tutorials/tutorial-one-python.html,
> here is the error:
>
> AttributeError: 'ProtocolHeader' object has no attribute
> 'channel_number'
>
> Full stack trace:
>
> python send.py
> Traceback (most recent call last):
> ?File "send.py", line 7, in <module>
> ? ?host='localhost'))
> ?File "/usr/lib/python2.6/site-packages/pika/adapters/
> blocking_connection.py", line 32, in __init__
> ? ?BaseConnection.__init__(self, parameters, None,
> reconnection_strategy)
> ?File "/usr/lib/python2.6/site-packages/pika/adapters/
> base_connection.py", line 50, in __init__
> ? ?reconnection_strategy)
> ?File "/usr/lib/python2.6/site-packages/pika/connection.py", line
> 170, in __init__
> ? ?self._connect()
> ?File "/usr/lib/python2.6/site-packages/pika/connection.py", line
> 228, in _connect
> ? ?self.parameters.port or ?spec.PORT)
> ?File "/usr/lib/python2.6/site-packages/pika/adapters/
> blocking_connection.py", line 44, in _adapter_connect
> ? ?self._handle_read()
> ?File "/usr/lib/python2.6/site-packages/pika/adapters/
> base_connection.py", line 162, in _handle_read
> ? ?self._on_data_available(data)
> ?File "/usr/lib/python2.6/site-packages/pika/connection.py", line
> 597, in _on_data_available
> ? ?elif frame.channel_number > 0:
> AttributeError: 'ProtocolHeader' object has no attribute
> 'channel_number'
>
> On Jul 1 2011, 9:02?pm, Marek Majkowski <maje... at gmail.com> wrote:
>> On Fri, Jul 1, 2011 at 20:05, Matt Pietrek <mpiet... at skytap.com> wrote:
>> > Indeed. Lesson learned for me.
>>
>> > With the newer version (2.5.1), the sample app works as expected.
>>
>> > Thanks much to both of your for your replies,
>>
>> Yeah, sorry for that. RabbitMQ moves a bit faster than linux distributions :)
>>
>> (although, that's a lesson for us - client packages should support
>> "old" releases!)
>>
>> I'm glad you were able to get it working.
>>
>> Cheers,
>> ? ?Marek
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Mon Feb 20 11:40:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 Feb 2012 11:40:06 +0000
Subject: [rabbitmq-discuss] Patch: SSL client certificate authentication
 for the RabbitMQ STOMP plugin
In-Reply-To: <bw7fwe63pzz.fsf@mail.cern.ch>
References: <30741846.683.1329422974350.JavaMail.geo-discussion-forums@pbux2>
	<bw7fwe63pzz.fsf@mail.cern.ch>
Message-ID: <4F423116.6000600@rabbitmq.com>

On 20/02/12 07:47, Lionel Cons wrote:
> Shane Hathaway<shane.hathaway at gmail.com>  writes:
>> I decided that using SSL client certificates is important for the kind of
>> deployment I'm working on, so I created a patch (attached to this email)
>
> Shane,
>
> It's good to see others interested in good X.509 authentication in RabbitMQ.
>
> IMHO, improvements in this area should follow what has already been discussed:
> http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/3c490aa6ab2b6c11/fdf693d284916526
> in particular: flexibility (CNs are not suitable in some envirnonments, DNs
> look more versatile) and uniformity (same Erlang code for AMQP, STOMP&
> management interfaces).

Aye, there's the rub.

So this is a problem with Shane's patch (sorry Shane). It was made 
against 2.7.1 and contains some code copied from 
rabbitmq-auth-mechanism-ssl. But:

* On default this code has changed to support DNs and somewhat support 
multiple CNs.

* This code really should be pulled into the broker and shared.

I'm not sure how fair it is to ask Shane to do this (it's rather more 
intrusive), so I'll have a look at doing it myself...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Feb 20 11:53:56 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 Feb 2012 11:53:56 +0000
Subject: [rabbitmq-discuss] rabbitmqadmin and ability to read
 configuration files
In-Reply-To: <CAMOXM29HisUL=ERb6B1wgUv+6Hgh4jOuUL2a1b5gyHVrrrVeSw@mail.gmail.com>
References: <CAMOXM2-yT_ZSX4_FkJpnh=GFX4_QT8pLKt+j8pnnZF6QHp1BmA@mail.gmail.com>
	<4F33DFC9.60903@rabbitmq.com>
	<CAMOXM28oeg5E=7x1+dLrPdkt_r21_G1j=Nh8hX+X8i5yq60ZJA@mail.gmail.com>
	<4F393239.5000707@rabbitmq.com>
	<CAMOXM29HisUL=ERb6B1wgUv+6Hgh4jOuUL2a1b5gyHVrrrVeSw@mail.gmail.com>
Message-ID: <4F423454.1040201@rabbitmq.com>

On 16/02/12 10:56, Massimo Paladin wrote:
> We made other changes that would be good if they could be merged:
> - if configuration file is specified and node is not specified it could
>    allow strange behaviors, we thought it would be nice if it would look
>    for a "default" node in the configuration file.
>    Please note that this is done only if the configuration file is given,
>    else it would always look for the default config file and node "default"
>    if default config files would be present.
> - the default vhost "/" (line 517 of your version) was not configurable.
>    vhost is treated differently for list and declare, the current situation
>    does not allow to define a vhost in the configuration file.
>    Adding a default_vhost to the configuration file allow the possibility
>    to configure every parameter from the configuration file independently
>    from the sub command executed. (which is not the case in the current
> version)
> - die was printing messages without going to new line

Cheers: I've merged the default node and the die newline change.

I don't understand the point of default_vhost. Without this change, I 
can specify a vhost in the config file and it becomes the default for 
both list and declare. With the change, I see the same thing (as long as 
vhost is defined in the config, default_vhost does nothing).

Can you explain more clearly what this is meant to do?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From muhammad.kamrana at gmail.com  Mon Feb 20 11:56:30 2012
From: muhammad.kamrana at gmail.com (Kamran)
Date: Mon, 20 Feb 2012 03:56:30 -0800 (PST)
Subject: [rabbitmq-discuss] basicpublish Android to Java?
In-Reply-To: <4F422170.2030803@rabbitmq.com>
References: <4561153.5471.1329698489313.JavaMail.geo-discussion-forums@vbbgt10>
	<4F422170.2030803@rabbitmq.com>
Message-ID: <57cba32a-7267-4c59-8b28-6e2465a0937e@p13g2000yqd.googlegroups.com>

Hi Emile,
            Yes when I have Java Client in Android. Then a publish via
"basicpublish" from Android should go to "basicconsume" in Java file
(the receive file in tutorial one). Unfortunately it is not working
for me. This would be the code for basic publish from Android to a
Receiver (in Java).
      ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("sethost");
        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();
        channel.queueDeclare(QUEUE_NAME, false, false, false, null);
        String message = "Kamran Android E";
        channel.basicPublish(EXCHANGE_NAME, QUEUE_NAME, null,
message.getBytes());

Regards,
Kamran


On Feb 20, 11:33?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> On 20/02/12 00:41, Kamran wrote:
>
> > I am new can you please help me out? Is there anyway I can send messages
> > from android to java files via basicpublish, the other way around is
> > possible.
> >http://simonwdixon.wordpress.com/2011/06/03/getting-started-with-rabb...I
> > have tried with handlers and with out it. Doesn't work.
>
> If I understand your question correctly you wish to send messages from
> "java files" to "android". Can you please explain what you mean by "java
> files"?
>
> If you have the RabbitMQ Java client working on Android then you should
> be able to publish and subscribe. Are you saying this is working only in
> one direction?
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Mon Feb 20 12:31:39 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Feb 2012 12:31:39 +0000
Subject: [rabbitmq-discuss] basicpublish Android to Java?
In-Reply-To: <57cba32a-7267-4c59-8b28-6e2465a0937e@p13g2000yqd.googlegroups.com>
References: <4561153.5471.1329698489313.JavaMail.geo-discussion-forums@vbbgt10>
	<4F422170.2030803@rabbitmq.com>
	<57cba32a-7267-4c59-8b28-6e2465a0937e@p13g2000yqd.googlegroups.com>
Message-ID: <4F423D2B.7080902@rabbitmq.com>

Hi,

On 20/02/12 11:56, Kamran wrote:
>             Yes when I have Java Client in Android. Then a publish via
> "basicpublish" from Android should go to "basicconsume" in Java file
> (the receive file in tutorial one). Unfortunately it is not working
> for me. 

When you say this is not working, can you explain what your expectation
is and how it fails to be met? Did you get any error messages? Does the
information reported by "rabbitmqctl list_queues" shed any light? Does
the client receive an exception? In that case how far does it get?


-Emile

From lionel.cons at cern.ch  Mon Feb 20 12:55:24 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 20 Feb 2012 13:55:24 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin and ability to read
	configuration files
In-Reply-To: <4F423454.1040201@rabbitmq.com> (Simon MacMullen's message of
	"Mon, 20 Feb 2012 11:53:56 +0000")
References: <CAMOXM2-yT_ZSX4_FkJpnh=GFX4_QT8pLKt+j8pnnZF6QHp1BmA@mail.gmail.com>
	<4F33DFC9.60903@rabbitmq.com>
	<CAMOXM28oeg5E=7x1+dLrPdkt_r21_G1j=Nh8hX+X8i5yq60ZJA@mail.gmail.com>
	<4F393239.5000707@rabbitmq.com>
	<CAMOXM29HisUL=ERb6B1wgUv+6Hgh4jOuUL2a1b5gyHVrrrVeSw@mail.gmail.com>
	<4F423454.1040201@rabbitmq.com>
Message-ID: <bw7aa4d4qbn.fsf@mail.cern.ch>

Simon MacMullen <simon at rabbitmq.com> writes:
> Cheers: I've merged the default node and the die newline change.

Thanks.

> I don't understand the point of default_vhost. Without this change, I
> can specify a vhost in the config file and it becomes the default for
> both list and declare. With the change, I see the same thing (as long
> as vhost is defined in the config, default_vhost does nothing).
>
> Can you explain more clearly what this is meant to do?

Sure.

We would like to use rabbitmqadmin to interact with the broker from
another script. The broker specific information (name, password, port,
virtual host...) should be in a config file so that, from the toplevel
script, we just use "rabbitmqadmin -c .../rabbitmqadmin.conf".

If we do put a vhost=foo in the rabbitmqadmin.conf, some commands fail.
For instance:

# rabbitmqadmin -c .../rabbitmqadmin.conf show overview
*** Not found: /overview/foo

If we don't put a vhost=foo in the rabbitmqadmin.conf, the toplevel
script must know which vhost to use for the declare commands.

With our patch, we can put default_vhost=foo in the conf file and both
list/show commands (ignoring it) and declare commands (using it) will work.

Cheers,

Lionel

From shane at hathawaymix.org  Mon Feb 20 13:05:52 2012
From: shane at hathawaymix.org (Shane Hathaway)
Date: Mon, 20 Feb 2012 06:05:52 -0700
Subject: [rabbitmq-discuss] Patch: SSL client certificate authentication
 for the RabbitMQ STOMP plugin
In-Reply-To: <4F423116.6000600@rabbitmq.com>
References: <30741846.683.1329422974350.JavaMail.geo-discussion-forums@pbux2>
	<bw7fwe63pzz.fsf@mail.cern.ch> <4F423116.6000600@rabbitmq.com>
Message-ID: <4F424530.8040106@hathawaymix.org>

[Switching to my preferred email address now that I've signed up 
properly for the mailing list.]

On 02/20/2012 04:40 AM, Simon MacMullen wrote:
> On 20/02/12 07:47, Lionel Cons wrote:
>> It's good to see others interested in good X.509 authentication in
>> RabbitMQ.
>>
>> IMHO, improvements in this area should follow what has already been
>> discussed:
>> http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/3c490aa6ab2b6c11/fdf693d284916526
>>
>> in particular: flexibility (CNs are not suitable in some
>> envirnonments, DNs
>> look more versatile) and uniformity (same Erlang code for AMQP, STOMP&
>> management interfaces).

Thanks for the review and the pointer to the email threads. I can see 
the value of using DNs.

> Aye, there's the rub.
>
> So this is a problem with Shane's patch (sorry Shane). It was made
> against 2.7.1 and contains some code copied from
> rabbitmq-auth-mechanism-ssl. But:
>
> * On default this code has changed to support DNs and somewhat support
> multiple CNs.
>
> * This code really should be pulled into the broker and shared.
>
> I'm not sure how fair it is to ask Shane to do this (it's rather more
> intrusive), so I'll have a look at doing it myself...

I'm glad to hear that. I can contribute if it would help get this into 
the next release; just give me specific instructions.

Shane

From gmlexx at gmail.com  Mon Feb 20 13:05:55 2012
From: gmlexx at gmail.com (Alexey)
Date: Mon, 20 Feb 2012 05:05:55 -0800 (PST)
Subject: [rabbitmq-discuss] Consumers may hang after network instability
In-Reply-To: <88E590DC4586974D825FC82AE798294E520F237D@GSVCLU04.ges.ferlan.it>
References: <6391f6db-070f-4848-9d1f-86b628598d14@k40g2000yqf.googlegroups.com>
	<88E590DC4586974D825FC82AE798294E520F237D@GSVCLU04.ges.ferlan.it>
Message-ID: <e87aa276-1791-44d0-a199-33308ae57bb1@k6g2000vbz.googlegroups.com>

Thanks, Simone.
I've tried this solution and stuck with bug 24650.
Hope it will be fixed in next release.

On 17 ???, 22:08, "Busoli, Simone" <Simone.Bus... at ferrari.com> wrote:
> Alexey, you need to enable heartbeats to make sure that you detect network issues. It's an option on the ConnectionFactory class.
>
>
>
>
>
>
>
> -----Original Message-----
> From: rabbitmq-discuss-boun... at lists.rabbitmq.com [mailto:rabbitmq-discuss-boun... at lists.rabbitmq.com] On Behalf Of Alexey
> Sent: venerd? 17 febbraio 2012 11:22
> To: rabbitmq-disc... at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] Consumers may hang after network instability
>
> Hello,
>
> We are using 2.7.1 version of .NET client and 2.7.1 rabbitmq-server.
> Several times we catched all consumers of rabbitmq server was hang after network instability (lost and reestablished connection or server with rabbitmq power cable unpluged)
>
> Problem method is IModel.Close() or IConnection.Close() (sorry, I don't remember which is)
>
> Parts of our code responded for connection below:
>
> public void Connect()
> {
> ? ? ? ? var cf = new ConnectionFactory
> ? ? ? ? {
> ? ? ? ? ? ? ? ? HostName = replica.EndPoint.Address.ToString(),
> ? ? ? ? ? ? ? ? Port = replica.EndPoint.Port,
> ? ? ? ? ? ? ? ? UserName = mqUsername,
> ? ? ? ? ? ? ? ? Password = mqPassword,
> ? ? ? ? };
> ? ? ? ? connection = cf.CreateConnection();
> ? ? ? ? Model = connection.CreateModel();
> ? ? ? ? Model.DeclareQueue(queueName);
> ? ? ? ? Model.BasicConsume(queueName, false, thisConsumerTag, true, false, null, this); }
>
> public void Disconnect(){
> ? ? ? ? if (Model != null && Model.IsOpen) Model.Close(200, "Close on client initiative");
> ? ? ? ? if (connection != null && connection.IsOpen) connection.Close(200, "Close on client initiative", disconnectTimeout); }
>
> Can anyone suggest a right way to close connection without chance to hang?
> Would appreciate for help.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> ___________________________________________________________________________ ______________________________________
> Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
> per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ?
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
> ___________________________________________________________________________ ______________________________________
> This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the
> message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly
> prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from
> your system.
> ___________________________________________________________________________ ______________________________________
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Mon Feb 20 13:08:04 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 Feb 2012 13:08:04 +0000
Subject: [rabbitmq-discuss] Consumers may hang after network instability
In-Reply-To: <e87aa276-1791-44d0-a199-33308ae57bb1@k6g2000vbz.googlegroups.com>
References: <6391f6db-070f-4848-9d1f-86b628598d14@k40g2000yqf.googlegroups.com>	<88E590DC4586974D825FC82AE798294E520F237D@GSVCLU04.ges.ferlan.it>
	<e87aa276-1791-44d0-a199-33308ae57bb1@k6g2000vbz.googlegroups.com>
Message-ID: <4F4245B4.70106@rabbitmq.com>

On 20/02/12 13:05, Alexey wrote:
> I've tried this solution and stuck with bug 24650.
> Hope it will be fixed in next release.

Yes, it will be in the next release.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From muhammad.kamrana at gmail.com  Mon Feb 20 13:30:31 2012
From: muhammad.kamrana at gmail.com (Kamran)
Date: Mon, 20 Feb 2012 05:30:31 -0800 (PST)
Subject: [rabbitmq-discuss] basicpublish Android to Java?
In-Reply-To: <4F423D2B.7080902@rabbitmq.com>
References: <4561153.5471.1329698489313.JavaMail.geo-discussion-forums@vbbgt10>
	<4F422170.2030803@rabbitmq.com>
	<57cba32a-7267-4c59-8b28-6e2465a0937e@p13g2000yqd.googlegroups.com>
	<4F423D2B.7080902@rabbitmq.com>
Message-ID: <ae47ffd7-af81-4b01-80ec-d7285635b90d@p21g2000yqm.googlegroups.com>

Sorry for my brief message, actually no error is shown. As in java
tutorial one, we get the message ""message" received" I don't receive
anything on the receiver side. "rabbitmqctl list_queues" don't show
any errors either and it shows the creation of queues. By the way I
have tried with different parameters in "exchangedeclare" and
"queuedeclare", but nothing is working for me. Thanks for the help!

The android code is:

public class ActivityHome extends Activity {
	private MessageConsumer mConsumer;
	private TextView mOutput;
? ? private final static String QUEUE_NAME = "hello";
? ? private final static String EXCHANGE_NAME = "logs";
? ? /** Called when the activity is first created. */
? ? @Override
? ? public void onCreate(Bundle savedInstanceState) {
? ? ? ? super.onCreate(savedInstanceState);
? ? ? ? setContentView(R.layout.main);
? ? ? ? //The output TextView we'll use to display messages
? ? ? ? mOutput = ?(TextView) findViewById(R.id.output);
? ? ? ?//Create the consumer
? ? ? ? mConsumer = new
MessageConsumer("192.168.2.3","logs","fanout");
? ? ? ? //Connect to broker
? ? ? ? mConsumer.connectToRabbitMQ();
? ? ? ? //register for messages
? ? ? ? mConsumer.setOnReceiveMessageHandler(new
OnReceiveMessageHandler(){
			public void onReceiveMessage(byte[] message) {
				String text = "";
				try {
					text = new String(message, "UTF8");
				} catch (UnsupportedEncodingException e) {
					e.printStackTrace();
				}
				mOutput.append("\n"+text);
			}
? ? ? ?});
? ? ? ? MessageSender Sender = new
MessageSender("192.168.2.3","logs","fanout");
? ? ? ? Sender.connectToRabbitMQ();
? ? ? ConnectionFactory factory = new ConnectionFactory();
? ? ? ? factory.setHost("sethost");
? ? ? ? try{
? ? ? ? Connection connection = factory.newConnection();
? ? ? ? Channel channel = connection.createChannel();
? ? ? ? channel.queueDeclare(QUEUE_NAME, false, false, false, null);
? ? ? ? String message = "Kamran Android E";
? ? ? ? channel.basicPublish(EXCHANGE_NAME, QUEUE_NAME, null,
message.getBytes());
? ? ? ? System.out.println(" [x] Sent '" + message + "'");

? ? ? ? }
? ? ? ? catch (Exception e) {
			// TODO: handle exception
		e.printStackTrace();
? ? ? ? }
? ? ? ?mOutput.append("\nSent");
? ? }
? ? @Override
	protected void onResume() {
		super.onPause();
		mConsumer.connectToRabbitMQ();
	}
	@Override
	protected void onPause() {
		super.onPause();
		mConsumer.dispose();
	}
}

This is the receiver code:

public class Recv {
? ? private final static String QUEUE_NAME = "hello";
? ? private final static String EXCHANGE_NAME = "logs";
? ? public static void main(String[] argv) throws Exception {
? ? ConnectionFactory factory = new ConnectionFactory();
? ? factory.setHost("localhost");
? ? Connection connection = factory.newConnection();
? ? Channel channel = connection.createChannel();
? ? channel.exchangeDeclare(EXCHANGE_NAME,"fanout", true);
? ? channel.queueDeclare(QUEUE_NAME, false, false, false, null);
? ? System.out.println(" [*] Waiting for messages. To exit press CTRL
+C");
? ? QueueingConsumer consumer = new QueueingConsumer(channel);
? ? channel.basicConsume(QUEUE_NAME, false, consumer);
? ? while (true) {
? ? ? QueueingConsumer.Delivery delivery = consumer.nextDelivery();
? ? ? String message = new String(delivery.getBody());
? ? ? System.out.println(" [x] Received '" + message + "'");
? ? }
? }

On Feb 20, 1:31?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> On 20/02/12 11:56, Kamran wrote:
>
> > ? ? ? ? ? ? Yes when I have Java Client in Android. Then a publish via
> > "basicpublish" from Android should go to "basicconsume" in Java file
> > (the receive file in tutorial one). Unfortunately it is not working
> > for me.
>
> When you say this is not working, can you explain what your expectation
> is and how it fails to be met? Did you get any error messages? Does the
> information reported by "rabbitmqctl list_queues" shed any light? Does
> the client receive an exception? In that case how far does it get?
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Mon Feb 20 13:49:57 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Feb 2012 13:49:57 +0000
Subject: [rabbitmq-discuss] basicpublish Android to Java?
In-Reply-To: <ae47ffd7-af81-4b01-80ec-d7285635b90d@p21g2000yqm.googlegroups.com>
References: <4561153.5471.1329698489313.JavaMail.geo-discussion-forums@vbbgt10>
	<4F422170.2030803@rabbitmq.com>
	<57cba32a-7267-4c59-8b28-6e2465a0937e@p13g2000yqd.googlegroups.com>
	<4F423D2B.7080902@rabbitmq.com>
	<ae47ffd7-af81-4b01-80ec-d7285635b90d@p21g2000yqm.googlegroups.com>
Message-ID: <4F424F85.7030001@rabbitmq.com>

Hi,

On 20/02/12 13:30, Kamran wrote:
>     private final static String QUEUE_NAME = "hello";
> MessageConsumer("192.168.2.3","logs","fanout");

How does your consumer know which queue to listen on?

You can confirm whether your message consumer is correctly registered by
running "rabbitmqctl list_consumers" or "rabbitmqctl list_queue
consumers". If your consumer is listed in the results then it should
receive messages. If it is not listed then the registration is faulty.



-Emile

From muhammad.kamrana at gmail.com  Mon Feb 20 14:08:17 2012
From: muhammad.kamrana at gmail.com (Kamran)
Date: Mon, 20 Feb 2012 06:08:17 -0800 (PST)
Subject: [rabbitmq-discuss] basicpublish Android to Java?
In-Reply-To: <4F424F85.7030001@rabbitmq.com>
References: <4561153.5471.1329698489313.JavaMail.geo-discussion-forums@vbbgt10>
	<4F422170.2030803@rabbitmq.com>
	<57cba32a-7267-4c59-8b28-6e2465a0937e@p13g2000yqd.googlegroups.com>
	<4F423D2B.7080902@rabbitmq.com>
	<ae47ffd7-af81-4b01-80ec-d7285635b90d@p21g2000yqm.googlegroups.com>
	<4F424F85.7030001@rabbitmq.com>
Message-ID: <59b2fe54-a2c3-4b19-833a-5687c0484634@f14g2000yqe.googlegroups.com>

Thanks,
           the consumer of android works fine
        	   mQueue = mModel.queueDeclare().getQueue();
        	   MySubscription = new QueueingConsumer(mModel);
        	   mModel.basicConsume(mQueue, false, MySubscription);"

and the list_consumers shows the declared queues.

The problem lies in the publisher/sender in Android, maybe I should re-
install the environment.


On Feb 20, 2:49?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> On 20/02/12 13:30, Kamran wrote:
>
> > ? ? private final static String QUEUE_NAME = "hello";
> > MessageConsumer("192.168.2.3","logs","fanout");
>
> How does your consumer know which queue to listen on?
>
> You can confirm whether your message consumer is correctly registered by
> running "rabbitmqctl list_consumers" or "rabbitmqctl list_queue
> consumers". If your consumer is listed in the results then it should
> receive messages. If it is not listed then the registration is faulty.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From pbell at syncsort.com  Mon Feb 20 14:31:51 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Mon, 20 Feb 2012 09:31:51 -0500
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <20120130233656.GB3968@southbank.Home>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com><20120128171156.GD3692@southbank.Home><AF4AD4ADFB
	23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com><20120129202348.GI3692@southbank.Home><5F389C517756284F80239F55BCA5DDD
	D36923A6D@G9W0721.americas.hpqcorp.net><20120130101227.GK3692@southbank.Home><D4925C82-5E7D-451E-834C-D51F57A5958C@syncsort.com
	> <20120130233656.GB3968@southbank.Home>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40694867@MAILCCR.us.syncsort.com>

Hello again,

By way of follow-up with Alexandru and the entire list, I've just been reading the piece at www.rabbitmq.com/ssl.html.

Do I rightly conclude that:

a. there is no requirement for mutual authentication, i.e., my clients need not carry their own certificates (I consider this an awkward deployment burden). 
b. We should be able to distribute our corporate X.509 certificate (and private key, required by SSL) for use by Rabbit when clients authenticate it.
c. I *must* also provide the root certificate (e.g., Verisign) for our corporate certificate?

??

Please advise, thanks.

-Paul

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Alexandru Scvortov
Sent: Monday, January 30, 2012 6:37 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Securing RabbitMQ

(posting again to the m/l)

> Quick q: does RabbitMQ allow presenting a hashed password?

No.  The authentication system is pluggable, though, so you could
easily write your own mechanism (see the src/rabbit_auth_mechanism_*
files in the broker source tree for examples).

Cheers,
Alex


On Mon, Jan 30, 2012 at 02:47:00PM -0500, Bell, Paul M. wrote:
> Thank you both.
> 
> Quick q: does RabbitMQ allow presenting a hashed password?
> 
> For example, you can configure a filer to accept MD5 hashed passwords. The principal that wants to authenticate with the filer hashes its password via MD5 and places the hashed password on the wire to the filer.
> 
> -paul
> 
> On Jan 30, 2012, at 5:13 AM, "Alexandru Scvor?ov" <alexandru at rabbitmq.com> wrote:
> 
> >> I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team.
> >> Is there some news about that?
> >
> > As of R15B (released a month ago), they still don't support CRLs.
> >
> > Cheers,
> > Alex
> >
> > On Mon, Jan 30, 2012 at 09:43:40AM +0000, Rosa, Andrea wrote:
> >> Hi
> >>
> >>> You could just not use passwords.  If you use SSL connections, RabbitMQ
> >>> can authenticate users by the certificate they provide.
> >>>
> >>> See the auth-mechanism-ssl plugin for details:
> >>> http://hg.rabbitmq.com/rabbitmq-auth-mechanism-ssl/file/default/README
> >>
> >> I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team.
> >> Is there some news about that?
> >>
> >> Cheers
> >> --
> >> Andrea Rosa
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> ATTENTION: -----
> 
> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From aloroi18 at gmail.com  Mon Feb 20 14:39:05 2012
From: aloroi18 at gmail.com (Bamboula)
Date: Mon, 20 Feb 2012 06:39:05 -0800 (PST)
Subject: [rabbitmq-discuss] Re trieving a message to the queue
Message-ID: <33357047.post@talk.nabble.com>


After using Dequeue() to my queue, I want to restore the retrieved message to
the queue. Is this possible?

-- 
View this message in context: http://old.nabble.com/Retrieving-a-message-to-the-queue-tp33357047p33357047.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alexandru at rabbitmq.com  Mon Feb 20 15:07:18 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 20 Feb 2012 15:07:18 +0000
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40694867@MAILCCR.us.syncsort.com>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>
	<20120128171156.GD3692@southbank.Home>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>
	<20120129202348.GI3692@southbank.Home>
	<5F389C517756284F80239F55BCA5DDDD36923A6D@G9W0721.americas.hpqcorp.net>
	<20120130101227.GK3692@southbank.Home>
	<D4925C82-5E7D-451E-834C-D51F57A5958C@syncsort.com>
	<20120130233656.GB3968@southbank.Home>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B40694867@MAILCCR.us.syncsort.com>
Message-ID: <20120220150718.GA4888@southbank>

Hi Paul,

> a. there is no requirement for mutual authentication, i.e., my clients need not carry their own certificates (I consider this an awkward deployment burden). 

Correct.  Authentication on both sides is optional.  The broker can be
configured with {verify_peer, none} and {fail_if_no_peer_cert, false} so
that it accepts connection from anyone.  Clients can be configured with
security managers (or whatever Java/.NET/Erlang calls them) to accept
connections to any broker.

So, you can have an un-authenticated, encrypted connection.

> b. We should be able to distribute our corporate X.509 certificate (and private key, required by SSL) for use by Rabbit when clients authenticate it.

Yes, the broker needs access to the certificate and private key it was
configured with.

> c. I *must* also provide the root certificate (e.g., Verisign) for our corporate certificate?

Assuming you want clients to authenticate the broker, yes.

Cheers,
Alex

On Mon, Feb 20, 2012 at 09:31:51AM -0500, Bell, Paul M. wrote:
> Hello again,
> 
> By way of follow-up with Alexandru and the entire list, I've just been reading the piece at www.rabbitmq.com/ssl.html.
> 
> Do I rightly conclude that:
> 
> a. there is no requirement for mutual authentication, i.e., my clients need not carry their own certificates (I consider this an awkward deployment burden). 
> b. We should be able to distribute our corporate X.509 certificate (and private key, required by SSL) for use by Rabbit when clients authenticate it.
> c. I *must* also provide the root certificate (e.g., Verisign) for our corporate certificate?
> 
> ??
> 
> Please advise, thanks.
> 
> -Paul
> 
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Alexandru Scvortov
> Sent: Monday, January 30, 2012 6:37 PM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Securing RabbitMQ
> 
> (posting again to the m/l)
> 
> > Quick q: does RabbitMQ allow presenting a hashed password?
> 
> No.  The authentication system is pluggable, though, so you could
> easily write your own mechanism (see the src/rabbit_auth_mechanism_*
> files in the broker source tree for examples).
> 
> Cheers,
> Alex
> 
> 
> On Mon, Jan 30, 2012 at 02:47:00PM -0500, Bell, Paul M. wrote:
> > Thank you both.
> > 
> > Quick q: does RabbitMQ allow presenting a hashed password?
> > 
> > For example, you can configure a filer to accept MD5 hashed passwords. The principal that wants to authenticate with the filer hashes its password via MD5 and places the hashed password on the wire to the filer.
> > 
> > -paul
> > 
> > On Jan 30, 2012, at 5:13 AM, "Alexandru Scvor?ov" <alexandru at rabbitmq.com> wrote:
> > 
> > >> I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team.
> > >> Is there some news about that?
> > >
> > > As of R15B (released a month ago), they still don't support CRLs.
> > >
> > > Cheers,
> > > Alex
> > >
> > > On Mon, Jan 30, 2012 at 09:43:40AM +0000, Rosa, Andrea wrote:
> > >> Hi
> > >>
> > >>> You could just not use passwords.  If you use SSL connections, RabbitMQ
> > >>> can authenticate users by the certificate they provide.
> > >>>
> > >>> See the auth-mechanism-ssl plugin for details:
> > >>> http://hg.rabbitmq.com/rabbitmq-auth-mechanism-ssl/file/default/README
> > >>
> > >> I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team.
> > >> Is there some news about that?
> > >>
> > >> Cheers
> > >> --
> > >> Andrea Rosa
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> > 
> > 
> > ATTENTION: -----
> > 
> > The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From pbell at syncsort.com  Mon Feb 20 15:15:34 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Mon, 20 Feb 2012 10:15:34 -0500
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <20120220150718.GA4888@southbank>
References: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1D8@MAILCCR.us.syncsort.com>
	<20120128171156.GD3692@southbank.Home> <AF4AD4ADFB
	23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>
	<20120129202348.GI3692@southbank.Home> <5F389C517756284F80239F55BCA5DDD
	D36923A6D@G9W0721.americas.hpqcorp.net>
	<20120130101227.GK3692@southbank.Home>
	<D4925C82-5E7D-451E-834C-D51F57A5958C@syncsort.com >
	<20120130233656.GB3968@southbank.Home>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B40694867@MAILCCR.us.syncsort.com>
	<20120220150718.GA4888@southbank>
Message-ID: <5BF4C316-A816-4083-AEF7-1E1125F5DC15@syncsort.com>

Most helpful, Alex, thank you.

I did not realize that there was no requirement to authenticate the server. Yet I must assume that, even in this case, server must be fitted with a certificate in order to accomplish encrypted symmetric key exchange with client and subsequent payload encryption.

True?

Thank again.

-Paul

On Feb 20, 2012, at 10:07 AM, "Alexandru Scvor?ov" <alexandru at rabbitmq.com> wrote:

> Hi Paul,
> 
>> a. there is no requirement for mutual authentication, i.e., my clients need not carry their own certificates (I consider this an awkward deployment burden). 
> 
> Correct.  Authentication on both sides is optional.  The broker can be
> configured with {verify_peer, none} and {fail_if_no_peer_cert, false} so
> that it accepts connection from anyone.  Clients can be configured with
> security managers (or whatever Java/.NET/Erlang calls them) to accept
> connections to any broker.
> 
> So, you can have an un-authenticated, encrypted connection.
> 
>> b. We should be able to distribute our corporate X.509 certificate (and private key, required by SSL) for use by Rabbit when clients authenticate it.
> 
> Yes, the broker needs access to the certificate and private key it was
> configured with.
> 
>> c. I *must* also provide the root certificate (e.g., Verisign) for our corporate certificate?
> 
> Assuming you want clients to authenticate the broker, yes.
> 
> Cheers,
> Alex
> 
> On Mon, Feb 20, 2012 at 09:31:51AM -0500, Bell, Paul M. wrote:
>> Hello again,
>> 
>> By way of follow-up with Alexandru and the entire list, I've just been reading the piece at www.rabbitmq.com/ssl.html.
>> 
>> Do I rightly conclude that:
>> 
>> a. there is no requirement for mutual authentication, i.e., my clients need not carry their own certificates (I consider this an awkward deployment burden). 
>> b. We should be able to distribute our corporate X.509 certificate (and private key, required by SSL) for use by Rabbit when clients authenticate it.
>> c. I *must* also provide the root certificate (e.g., Verisign) for our corporate certificate?
>> 
>> ??
>> 
>> Please advise, thanks.
>> 
>> -Paul
>> 
>> -----Original Message-----
>> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Alexandru Scvortov
>> Sent: Monday, January 30, 2012 6:37 PM
>> To: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] Securing RabbitMQ
>> 
>> (posting again to the m/l)
>> 
>>> Quick q: does RabbitMQ allow presenting a hashed password?
>> 
>> No.  The authentication system is pluggable, though, so you could
>> easily write your own mechanism (see the src/rabbit_auth_mechanism_*
>> files in the broker source tree for examples).
>> 
>> Cheers,
>> Alex
>> 
>> 
>> On Mon, Jan 30, 2012 at 02:47:00PM -0500, Bell, Paul M. wrote:
>>> Thank you both.
>>> 
>>> Quick q: does RabbitMQ allow presenting a hashed password?
>>> 
>>> For example, you can configure a filer to accept MD5 hashed passwords. The principal that wants to authenticate with the filer hashes its password via MD5 and places the hashed password on the wire to the filer.
>>> 
>>> -paul
>>> 
>>> On Jan 30, 2012, at 5:13 AM, "Alexandru Scvor?ov" <alexandru at rabbitmq.com> wrote:
>>> 
>>>>> I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team.
>>>>> Is there some news about that?
>>>> 
>>>> As of R15B (released a month ago), they still don't support CRLs.
>>>> 
>>>> Cheers,
>>>> Alex
>>>> 
>>>> On Mon, Jan 30, 2012 at 09:43:40AM +0000, Rosa, Andrea wrote:
>>>>> Hi
>>>>> 
>>>>>> You could just not use passwords.  If you use SSL connections, RabbitMQ
>>>>>> can authenticate users by the certificate they provide.
>>>>>> 
>>>>>> See the auth-mechanism-ssl plugin for details:
>>>>>> http://hg.rabbitmq.com/rabbitmq-auth-mechanism-ssl/file/default/README
>>>>> 
>>>>> I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team.
>>>>> Is there some news about that?
>>>>> 
>>>>> Cheers
>>>>> --
>>>>> Andrea Rosa
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> 
>>> 
>>> ATTENTION: -----
>>> 
>>> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ninkendo at gmail.com  Mon Feb 20 16:19:23 2012
From: ninkendo at gmail.com (Ken Simon)
Date: Mon, 20 Feb 2012 08:19:23 -0800
Subject: [rabbitmq-discuss] STOMP Plugin: Alternative exchange other than
	amq.topic?
Message-ID: <CADSpLP9gb9R2ZbEJ1OntxedX0VqMX1c_9-cGTBdyo+a8NbWmNQ@mail.gmail.com>

Greetings,

I'm trying to get federation working (via the rabbitmq_federation
plugin) in our environment of STOMP hosts, and to do so I have to
enable federation in the STOMP plugin's exchange: amq.topic.  This
unfortunately doesn't seem to work because amq.* exchanges are
reserved and cannot be re-declared.

My solution at this point has been to edit the source of the STOMP
plugin and point it at an exchange called "stomp_topic" (which I made
up, but could be anything) instead of the default amq.topic.  Then I
just configure the federation plugin to work with that exchange and it
works fine.

My question is, is there a better way of doing this?  I hate
maintaining my own downstream changes to plugins if I don't have to.
The docs say that the STOMP plugin routes all messages through
amq.topic, so it appears that's not configurable.  But wouldn't it
make sense to allow use of an exchange that's not reserved?  Or am I
missing something, and this is actually way easier?  I'm having
trouble finding any documented cases of people using both STOMP and
federation.

Thanks,

--
Ken

From muhammad.kamrana at gmail.com  Mon Feb 20 16:56:28 2012
From: muhammad.kamrana at gmail.com (Kamran)
Date: Mon, 20 Feb 2012 08:56:28 -0800 (PST)
Subject: [rabbitmq-discuss] Android: unable to open stack traces error
Message-ID: <57993ff8-0d08-4d2d-86c8-655cf4b8c11b@w19g2000vbe.googlegroups.com>

The following code gives "unable to open stack traces error" I am try
to send data from Java Client on Android to Java File (https://
github.com/rabbitmq/rabbitmq-tutorials/blob/master/java/Recv.java)

I have also included the permissions of "write_external_storage" and
"internet". If I disable the "handler.post(send)" then it doesn't
gives the error but the job is not done.

Android Code:

TextView mOutput;
    /** Called when the activity is first created. */
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
        mOutput =  (TextView) findViewById(R.id.output);

        Handler handler = new Handler();

        Runnable send = new Runnable(){
            public void run() {
                // TODO Auto-generated method stub
                send();
            }
            };
            mOutput.append("/nBefore");
            handler.post(send);
            mOutput.append("/nAfter");
    }

private void send(){
    Thread thread = new Thread(){
        @Override
        public void run(){
            ConnectionFactory factory = new ConnectionFactory();
            factory.setHost("sethost");
            Connection connection = null;
            try {
                connection = factory.newConnection();
                mOutput.append("/ninstance1");
            } catch (IOException e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            }
                Channel channel = null;
                try {
                    mOutput.append("/ninstance2");
                    channel = connection.createChannel();
                } catch (IOException e) {
                    // TODO Auto-generated catch block
                    e.printStackTrace();
                }

                try {
                    mOutput.append("/ninstance3");
                    channel.queueDeclare("hello", false, false, false,
null);
                } catch (IOException e) {
                    // TODO Auto-generated catch block
                    e.printStackTrace();
                }

                String message = "Kamran Android E";
                try {
                    mOutput.append("/ninstance4");
                    channel.basicPublish("logs","hello", null,
message.getBytes());
                } catch (IOException e) {
                    // TODO Auto-generated catch block
                    e.printStackTrace();
                }
        }
    };
    thread.start();
}
}

From alexandru at rabbitmq.com  Mon Feb 20 16:59:00 2012
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 20 Feb 2012 16:59:00 +0000
Subject: [rabbitmq-discuss] Securing RabbitMQ
In-Reply-To: <5BF4C316-A816-4083-AEF7-1E1125F5DC15@syncsort.com>
References: <20120128171156.GD3692@southbank.Home>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4044C1DB@MAILCCR.us.syncsort.com>
	<20120129202348.GI3692@southbank.Home>
	<5F389C517756284F80239F55BCA5DDDD36923A6D@G9W0721.americas.hpqcorp.net>
	<20120130101227.GK3692@southbank.Home>
	<D4925C82-5E7D-451E-834C-D51F57A5958C@syncsort.com>
	<20120130233656.GB3968@southbank.Home>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B40694867@MAILCCR.us.syncsort.com>
	<20120220150718.GA4888@southbank>
	<5BF4C316-A816-4083-AEF7-1E1125F5DC15@syncsort.com>
Message-ID: <20120220165900.GB4888@southbank>

True.

On Mon, Feb 20, 2012 at 10:15:34AM -0500, Bell, Paul M. wrote:
> Most helpful, Alex, thank you.
> 
> I did not realize that there was no requirement to authenticate the server. Yet I must assume that, even in this case, server must be fitted with a certificate in order to accomplish encrypted symmetric key exchange with client and subsequent payload encryption.
> 
> True?
> 
> Thank again.
> 
> -Paul
> 
> On Feb 20, 2012, at 10:07 AM, "Alexandru Scvor?ov" <alexandru at rabbitmq.com> wrote:
> 
> > Hi Paul,
> > 
> >> a. there is no requirement for mutual authentication, i.e., my clients need not carry their own certificates (I consider this an awkward deployment burden). 
> > 
> > Correct.  Authentication on both sides is optional.  The broker can be
> > configured with {verify_peer, none} and {fail_if_no_peer_cert, false} so
> > that it accepts connection from anyone.  Clients can be configured with
> > security managers (or whatever Java/.NET/Erlang calls them) to accept
> > connections to any broker.
> > 
> > So, you can have an un-authenticated, encrypted connection.
> > 
> >> b. We should be able to distribute our corporate X.509 certificate (and private key, required by SSL) for use by Rabbit when clients authenticate it.
> > 
> > Yes, the broker needs access to the certificate and private key it was
> > configured with.
> > 
> >> c. I *must* also provide the root certificate (e.g., Verisign) for our corporate certificate?
> > 
> > Assuming you want clients to authenticate the broker, yes.
> > 
> > Cheers,
> > Alex
> > 
> > On Mon, Feb 20, 2012 at 09:31:51AM -0500, Bell, Paul M. wrote:
> >> Hello again,
> >> 
> >> By way of follow-up with Alexandru and the entire list, I've just been reading the piece at www.rabbitmq.com/ssl.html.
> >> 
> >> Do I rightly conclude that:
> >> 
> >> a. there is no requirement for mutual authentication, i.e., my clients need not carry their own certificates (I consider this an awkward deployment burden). 
> >> b. We should be able to distribute our corporate X.509 certificate (and private key, required by SSL) for use by Rabbit when clients authenticate it.
> >> c. I *must* also provide the root certificate (e.g., Verisign) for our corporate certificate?
> >> 
> >> ??
> >> 
> >> Please advise, thanks.
> >> 
> >> -Paul
> >> 
> >> -----Original Message-----
> >> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Alexandru Scvortov
> >> Sent: Monday, January 30, 2012 6:37 PM
> >> To: rabbitmq-discuss at lists.rabbitmq.com
> >> Subject: Re: [rabbitmq-discuss] Securing RabbitMQ
> >> 
> >> (posting again to the m/l)
> >> 
> >>> Quick q: does RabbitMQ allow presenting a hashed password?
> >> 
> >> No.  The authentication system is pluggable, though, so you could
> >> easily write your own mechanism (see the src/rabbit_auth_mechanism_*
> >> files in the broker source tree for examples).
> >> 
> >> Cheers,
> >> Alex
> >> 
> >> 
> >> On Mon, Jan 30, 2012 at 02:47:00PM -0500, Bell, Paul M. wrote:
> >>> Thank you both.
> >>> 
> >>> Quick q: does RabbitMQ allow presenting a hashed password?
> >>> 
> >>> For example, you can configure a filer to accept MD5 hashed passwords. The principal that wants to authenticate with the filer hashes its password via MD5 and places the hashed password on the wire to the filer.
> >>> 
> >>> -paul
> >>> 
> >>> On Jan 30, 2012, at 5:13 AM, "Alexandru Scvor?ov" <alexandru at rabbitmq.com> wrote:
> >>> 
> >>>>> I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team.
> >>>>> Is there some news about that?
> >>>> 
> >>>> As of R15B (released a month ago), they still don't support CRLs.
> >>>> 
> >>>> Cheers,
> >>>> Alex
> >>>> 
> >>>> On Mon, Jan 30, 2012 at 09:43:40AM +0000, Rosa, Andrea wrote:
> >>>>> Hi
> >>>>> 
> >>>>>> You could just not use passwords.  If you use SSL connections, RabbitMQ
> >>>>>> can authenticate users by the certificate they provide.
> >>>>>> 
> >>>>>> See the auth-mechanism-ssl plugin for details:
> >>>>>> http://hg.rabbitmq.com/rabbitmq-auth-mechanism-ssl/file/default/README
> >>>>> 
> >>>>> I tested this plugin some months ago and I found it very useful, my only concern is that it didn't support the CRL feature. The problem was due to the OpensSSL library used by erlang which didn't implement the CRL check, but AFAIK there was a plan to release a new version of that module from erlang team.
> >>>>> Is there some news about that?
> >>>>> 
> >>>>> Cheers
> >>>>> --
> >>>>> Andrea Rosa
> >>>> _______________________________________________
> >>>> rabbitmq-discuss mailing list
> >>>> rabbitmq-discuss at lists.rabbitmq.com
> >>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>> 
> >>> 
> >>> 
> >>> ATTENTION: -----
> >>> 
> >>> The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james at 2600hz.com  Mon Feb 20 17:04:12 2012
From: james at 2600hz.com (James Aimonetti)
Date: Mon, 20 Feb 2012 09:04:12 -0800
Subject: [rabbitmq-discuss] Design Help?
Message-ID: <4F427D0C.10907@2600hz.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey list,

Curious for feedback, as this design idea I have would possibly extend
to several places in our application, and I'd love to make it generic
enough to do so.

The basic problem:

We have a queue of work to be done, represented as a named queue. For
redundancy, we have 2->many processes (in Erlang) that will read from
the queue and do the work. Easy so far.

However, we also have a list of resources needed to process the work
queue, which needs to be shared across all worker processes. When one
worker retrieves a job from the work queue, it must also get the list of
available resources, match resource to job, and return the list of
resources (with the used resource flagged as such) back to a globally
accessible place (hoping to avoid the DB, but it may be a good-enough
sync point).

So, for example, there are four jobs, two that require a paper shredder,
two that require a wood chipper. There is only one paper shredder and
one wood chipper. There are also 10 workers available to actually shred
stuff.

Worker one consumes the list of available equipment (one paper shredder,
one wood chipper), and then pulls the first job (paper to be shredded).
Worker one grabs the paper shredder, returns the list of resources
having flagged the paper shredder as in use, and ACKs the job. When
worker one finishes shredding paper, it will wait until the resources
list is available and update it with 1 more paper shredder available.

Once a job is actually started, I don't care if the worker crashes or
not; that will be handled later. And I'll have a supervising gen_server
pull the resource list, add the resource its using to its state, and
spawn the actual worker (catching exits to return the resource). I'm
sure other measures will be needed to ensure the resource is added back
eventually, but I'm trying to get the basic idea down.

So once worker one is done retrieving a resource, worker two can next
get the resources list and the next job. If the job is paper shredding,
worker two will nack the job (as there are no paper shredders at the
moment) and return the resource list. I will eventually want to support
being able to requeue the job to the back of the job queue, but for now,
work stalls until the first item in the queue can be processed successfully.

So while the resources list is out of queue, no workers will consume
jobs from the work queue. As soon as it reappears in queue, I want the
next worker in line to grab it and try to process the next job.


Some initial concerns:

No resources available for the job at the front of the queue means a lot
of fetching and nacking of jobs, and fetching/returning the resource list.

Losing the resources list: if whatever node (our Erlang VMs only
communicate via AMQP) goes down while handling the resources list, it
will obviously never be republished. We do usually have a timeout window
for the worker to get a resource for a job (sometimes the actual finding
of the resource takes a while), so if I could coordinate all workers
consuming from the resources_available queue, I could know after timeout
+ a small fudge factor, that someone else should have begun processing.
So maybe the resources_available queue is more a try_to_process_a_job
queue, and each worker process maintains an identical list of resources
available, with a worker that pairs a job to resource publishing the
resource's in-use status.

So perhaps the solution is:

Jobs queue round robins amongst all workers, but only one worker can
fetch/(n)ack. A worker can only fetch from the jobs queue by consuming a
"next" message from a shared coordination queue. All workers publish
updates to resources available to a routing key so all workers'
resources state is in sync. If a worker can't find a resource for a job,
it can (configurable) 1) nack the job and send a 'next' to the
coordination queue; 2) requeue the job at the end of the jobs queue and
send a 'next'; 3) sit on the job (meaning no other worker can fetch from
the jobs queue) until an appropriate resource comes available.

Concerns here:

Starting/recovering the 'next' token.

I'm sure others but am realizing this is getting long.

Sorry for the wall of text and stream of consciousness writing. We have
a lot of places where this pattern is showing up and would love to get a
module or library written to ease doing this kind of coordination. Any
ideas or directions towards appropriate messaging patterns warmly welcome :)

- -- 
James Aimonetti
Distributed Systems Engineer / DJ MC_

2600hz | http://2600hz.com
sip:james at 2600hz.com
tel: 415.886.7905
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJPQn0MAAoJENc77s1OYoGgh+gH/i/kW2M5EMfQ/xz3dU6soUd4
joGvWC46MdAX2CqlEKyIcP+EsmiTH4Ojjh64Y5MrVv68xV2Zasi8O7W5scFGK31Q
5r1Uc4lLrCANiEA7MYnaKM3J+s+bf4m3NlDwhE/QKCO+OhZoZl/zYfzlzSlsQ3QX
3dIKIxJnvnvmehat/oqbpZFFZO7NX4dKWGr3Ysp4OBjPhQLDGGkZ3Tbjbe3KfL0j
EfdZubwXQQLsTU7oqI7K3HoZc1uWx50VdR28JT1ZTaBdchpUpQ9PXdbq1b++KA++
SkHpwYB37PgTqK9A3gsmuRCsRMmYP8p3iGPrflnP53kuuESZIZwUFuhbthV5DM8=
=MDx7
-----END PGP SIGNATURE-----

From steve at rabbitmq.com  Mon Feb 20 17:04:33 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 20 Feb 2012 17:04:33 +0000
Subject: [rabbitmq-discuss] STOMP doesn't include the routing-key on
	MESSAGE frames
In-Reply-To: <CAM8fPiRDo_i=qTQSMOfQGqTg1YBbAZQtNfBqXn1bhnY-_E7LYg@mail.gmail.com>
References: <CAM8fPiQe4nZGdwPvmYae=YtA6ruN96TedYNLOHpQBcxo9niQOg@mail.gmail.com>
	<CAM8fPiRDo_i=qTQSMOfQGqTg1YBbAZQtNfBqXn1bhnY-_E7LYg@mail.gmail.com>
Message-ID: <E2D4D1E4-13BF-4D66-8F40-A9766BCEE0A5@rabbitmq.com>

Hi Tony,

Sorry I was so long in replying.

When you say 'no longer propagated', you imply that we used to do this. I guess
that was in the original implementation? :-) I don't think leaving this out was
an 'oversight' exactly, but more a desire to hide the implementation from the
pure STOMP user.

There is really no limit to the amount of information we could include in the
MESSAGE headers gleaned from the underlying implementation. We could easily
provide the AMQP exchange-name, consumer-tag and delivery-tag.

Of course, the more we include the more we reveal about the particular mapping
we have decided to use between the STOMP and AMQP protocols. This would inhibit
changes to that mapping, for future enhancements. For example, the routingKey you
extract in your patch might be a queue name generated by the server, a recast of
the destination information, or empty. The meaning and content of the header
value might change as we change our mapping.

So, I'm reluctant to include this information unless there is a compelling STOMP
reason for doing so. Is your application a pure STOMP one?
 
Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 14 Feb 2012, at 17:13, Tony Garnock-Jones wrote:

No comments on this?

On 10 February 2012 10:56, Tony Garnock-Jones
<tonygarnockjones+rabbitmq at gmail.com> wrote:
Hi all,

Attempting to use the STOMP adapter the other day I discovered an
oversight in the new design: the AMQP routing key is no longer
propagated into outgoing MESSAGE frames. This stopped my application
from working.

Here's a patch (obviously crude, e.g. doesn't define a
?HEADER_ROUTING_KEY macro or anything) that causes the routing_key to
be sent along:

diff -r 3be0091c6401 src/rabbit_stomp_util.erl
--- a/src/rabbit_stomp_util.erl Wed Feb 08 15:53:59 2012 +0000
+++ b/src/rabbit_stomp_util.erl Fri Feb 10 10:53:21 2012 -0500
@@ -78,9 +78,11 @@

 message_headers(Destination, SessionId,
                #'basic.deliver'{consumer_tag = ConsumerTag,
-                                 delivery_tag = DeliveryTag},
+                                 delivery_tag = DeliveryTag,
+                                 routing_key = RoutingKey},
                Props = #'P_basic'{headers       = Headers}) ->
    Basic = [{?HEADER_DESTINATION, Destination},
+             {"amqp-routing-key", binary_to_list(RoutingKey)},
             {?HEADER_MESSAGE_ID,
              create_message_id(ConsumerTag, SessionId, DeliveryTag)}],


I'd be very happy to see this included into the master branch of the
STOMP adapter.

Regards,
 Tony
--
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/



-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Mon Feb 20 17:14:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 Feb 2012 17:14:55 +0000
Subject: [rabbitmq-discuss] Patch: SSL client certificate authentication
 for the RabbitMQ STOMP plugin
In-Reply-To: <4F424530.8040106@hathawaymix.org>
References: <30741846.683.1329422974350.JavaMail.geo-discussion-forums@pbux2>
	<bw7fwe63pzz.fsf@mail.cern.ch> <4F423116.6000600@rabbitmq.com>
	<4F424530.8040106@hathawaymix.org>
Message-ID: <4F427F8F.6060304@rabbitmq.com>

On 20/02/12 13:05, Shane Hathaway wrote:
> I'm glad to hear that. I can contribute if it would help get this into
> the next release; just give me specific instructions.

Well, I've just hacked on this myself. If you want to test it that would 
be cool. You'll need branch bug24182 of the stomp plugin and the broker 
(and any other plugins will need to be from default, not 2.7.1).

The config is the same as yours was BUT:

* ssl_cert_login is moved "up" from inside default_user:

[
   {rabbitmq_stomp, [{ssl_cert_login, true}]}
].

(as is implicit_connect if you use that).

* It uses DNs by default, add

{rabbit, [{ssl_cert_login_from, common_name}]}

to use CNs.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Feb 20 17:28:17 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Feb 2012 17:28:17 +0000
Subject: [rabbitmq-discuss] Android: unable to open stack traces error
In-Reply-To: <57993ff8-0d08-4d2d-86c8-655cf4b8c11b@w19g2000vbe.googlegroups.com>
References: <57993ff8-0d08-4d2d-86c8-655cf4b8c11b@w19g2000vbe.googlegroups.com>
Message-ID: <4F4282B1.8080109@rabbitmq.com>

Hi,

On 20/02/12 16:56, Kamran wrote:
> The following code gives "unable to open stack traces error"

That sounds like a problem in your development environment. I don't know
how many Android experts are on this list but you might not get a reply
to that issue here.

If your error is associated with an entry in the broker logfile, or if
the error originates in the RabbitMQ client or broker then we'll be
better able to help you. You should narrow down the scope of the issue
until it is clearer where the problem lies.



-Emile

From mpietrek at skytap.com  Mon Feb 20 18:22:15 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 20 Feb 2012 10:22:15 -0800
Subject: [rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03
	performance
In-Reply-To: <20120220112803.GA5917@rabbitmq.com>
References: <CB602924.2DF9C%mpietrek@skytap.com>
	<4F3B8435.2040401@rabbitmq.com>
	<CACLE7iwUVeao_ceQdUr-y43srcNVrk+R5R9OBOiZxGG8FZ4OnA@mail.gmail.com>
	<4F3BED29.6050602@rabbitmq.com>
	<CACLE7iyaxmc0pJZ+gzNXa93da13s1iiStApp-A58BYPmmHkejw@mail.gmail.com>
	<4F3E4A8E.8060807@rabbitmq.com>
	<CACLE7iw0zRurNgeNRO7aO3AesLrYDvkSr6vm1vGL8kdyKoL-mQ@mail.gmail.com>
	<20120220112803.GA5917@rabbitmq.com>
Message-ID: <CACLE7izPH9h9wivEsKbJ3NK4_qXAkJuecZd0O7XCtByzy0BH6w@mail.gmail.com>

Ah, thanks so much for this reply Matthew. It's extremely enlightening and
seems to explain what we're seeing.

A follow up question just for my understanding: Are these "windows" dynamic
in nature (e.g., varying length, varying frequency, somehow tied to current
load)? Or are they more static (e.g. "Once every 20 milliseconds").

Thanks again,

Matt

On Mon, Feb 20, 2012 at 3:28 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Fri, Feb 17, 2012 at 11:17:24AM -0800, Matt Pietrek wrote:
> > While I'm very happy with these results, I'm still puzzled. Given that
> all
> > clients are writing to the same queue, I'd expect resource
> > contention/blocking in the broker to slow things down much faster than
> they
> > do. Any comment on this? Am I overlooking anything critical to my
> > understanding?
>
> There's a "window" of time during which no fsyncs will occur, and
> txn-publishes will merely accumulate. Only when that window closes will
> the fsync be performed. With a single publisher, each window can only
> have a single publisher's msgs in it. But with many publishers, the
> fsync is effectively amortized, and thus a higher rate is achieved - if
> you monitor with strace or similar, you'll probably see the fsync rate
> is not much different, regardless of the number of publishers you have
> publishing to the same queue.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120220/4006001c/attachment.htm>

From stransky.ja at seznam.cz  Mon Feb 20 19:41:41 2012
From: stransky.ja at seznam.cz (jaksky)
Date: Mon, 20 Feb 2012 11:41:41 -0800 (PST)
Subject: [rabbitmq-discuss] ERROR: generation of boot script file
In-Reply-To: <33339060.post@talk.nabble.com>
References: <33339060.post@talk.nabble.com>
Message-ID: <33358959.post@talk.nabble.com>


Hi, 

thanks for help. That solved the problem with Document and Settings in path.

J.

jaksky wrote:
> 
> Hi,
> 
> I am a rookie to RabbitMQ. When installing rabbitmq_management plugin on
> Win XP I am getting following error:
> 
> Activating RabbitMQ plugins ...
> ERROR: generation of boot script file C:/Documents and Settings/Jakub/Data
> aplik
> ac?/RabbitMQ/db/rabbit at JAKUB-HOME-plugins-expand/rabbit.script failed:
> {error,xref_base,
>        {invalid_filename,"c:/Documents and Settings/Jakub/Data
> aplikac?/RabbitMQ
> /db/rabbit at JAKUB-HOME-plugins-expand/amqp_client-2.7.1/ebin"}}
> 
> Anybody guess what's the problem?
> 
> Thanks
> 

-- 
View this message in context: http://old.nabble.com/ERROR%3A-generation-of-boot-script-file-tp33339060p33358959.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From muhammad.kamrana at gmail.com  Mon Feb 20 19:52:44 2012
From: muhammad.kamrana at gmail.com (Kamran)
Date: Mon, 20 Feb 2012 11:52:44 -0800 (PST)
Subject: [rabbitmq-discuss] Android: unable to open stack traces error
In-Reply-To: <4F4282B1.8080109@rabbitmq.com>
References: <57993ff8-0d08-4d2d-86c8-655cf4b8c11b@w19g2000vbe.googlegroups.com>
	<4F4282B1.8080109@rabbitmq.com>
Message-ID: <21fbf71a-d0b1-4a60-98e3-e277ff4f00c4@t15g2000yqi.googlegroups.com>

 I hope I am not bothering you too much. Actually the following code
also gives the same error, my question is there any sample code where
java client on android is publishing?

public class ActivityHome extends Activity {
	private MessageConsumer mConsumer;
	private TextView mOutput;
    private final static String QUEUE_NAME = "hello";
    private final static String EXCHANGE_NAME = "logs";

    /** Called when the activity is first created. */
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
        mOutput.append("Kamran");
      ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("sethost");
        try{
        	mOutput.append("Sending");
        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();
        channel.queueDeclare(QUEUE_NAME, false, false, false, null);
        String message = "Kamran Android E";
        channel.basicPublish(EXCHANGE_NAME, "", null,
message.getBytes());
        System.out.println(" [x] Sent '" + message + "'");
        }
        catch (Exception e) {
			// TODO: handle exception
		e.printStackTrace();
        }
       mOutput.append("\nSent");
    }

    @Override
	protected void onResume() {
		super.onPause();
		mConsumer.connectToRabbitMQ();
	}

	@Override
	protected void onPause() {
		super.onPause();
		mConsumer.dispose();
	}
}

On Feb 20, 6:28?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> On 20/02/12 16:56, Kamran wrote:
>
> > The following code gives "unable to open stack traces error"
>
> That sounds like a problem in your development environment. I don't know
> how many Android experts are on this list but you might not get a reply
> to that issue here.
>
> If your error is associated with an entry in the broker logfile, or if
> the error originates in the RabbitMQ client or broker then we'll be
> better able to help you. You should narrow down the scope of the issue
> until it is clearer where the problem lies.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tonygarnockjones+rabbitmq at gmail.com  Mon Feb 20 19:56:16 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 20 Feb 2012 14:56:16 -0500
Subject: [rabbitmq-discuss] STOMP doesn't include the routing-key on
 MESSAGE frames
In-Reply-To: <E2D4D1E4-13BF-4D66-8F40-A9766BCEE0A5@rabbitmq.com>
References: <CAM8fPiQe4nZGdwPvmYae=YtA6ruN96TedYNLOHpQBcxo9niQOg@mail.gmail.com>
	<CAM8fPiRDo_i=qTQSMOfQGqTg1YBbAZQtNfBqXn1bhnY-_E7LYg@mail.gmail.com>
	<E2D4D1E4-13BF-4D66-8F40-A9766BCEE0A5@rabbitmq.com>
Message-ID: <CAM8fPiTqRg8LtiMa21U-Vh7nFFc3YdBw9Gs8X_nASeVn8Oxiaw@mail.gmail.com>

Hi Steve,

On 20 February 2012 12:04, Steve Powell <steve at rabbitmq.com> wrote:
> Sorry I was so long in replying.

Thanks for getting back to me!

> When you say 'no longer propagated', you imply that we used to do this. I guess
> that was in the original implementation? :-)

It was, yep.

> There is really no limit to the amount of information we could include in the
> MESSAGE headers gleaned from the underlying implementation. We could easily
> provide the AMQP exchange-name, consumer-tag and delivery-tag.

You already do, or at least you give equivalents. The destination
perforce covers the exchange name; the consumer-tag is covered by the
"subscription" header in MESSAGE; and the delivery-tag is covered by
"message-id". What's missing is the small gap between the concrete
destination to which the message was sent and the abstract destination
(really, a destination pattern) used in the SUBSCRIBE. And that gap
is, in AMQP, covered exactly by the routing-key. Think of it as the
bindings from unification of the destination from subscribe with the
destination from publish (erm, if you imagine the
subscription-destination-pattern to be a regex, it's kind of the
capture groups).

Adding the routing_key puts the final small missing piece in place. A
perhaps more STOMPish way of giving it would be to have a "to" header
or similar carried in a MESSAGE, containing the full destination given
in the SEND. Oh wait! I've just checked, and actually that's what's
required by the 1.1 spec already. So the STOMP adapter isn't quite
spec-compliant, in that it's giving the destination from the
*subscribe* rather than the *send*.

(This makes sense, actually: the server needn't repeat the SUBSCRIBE's
destination header in each MESSAGE, as the client after all was the
one that specified it in the SUBSCRIBE! Carrying the SEND's
destination into the MESSAGE genuinely tells the consuming client
something they can't know in advance.)

> The meaning and content of the header
> value might change as we change our mapping.

I don't care about that: I just want the routing key, because I'm
using STOMP for simple interop with real AMQP clients.

> So, I'm reluctant to include this information unless there is a compelling STOMP
> reason for doing so. Is your application a pure STOMP one?

No: that's why the routing_key is important.

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/

From tonygarnockjones+rabbitmq at gmail.com  Mon Feb 20 20:36:02 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 20 Feb 2012 15:36:02 -0500
Subject: [rabbitmq-discuss] STOMP doesn't include the routing-key on
 MESSAGE frames
In-Reply-To: <CAM8fPiTqRg8LtiMa21U-Vh7nFFc3YdBw9Gs8X_nASeVn8Oxiaw@mail.gmail.com>
References: <CAM8fPiQe4nZGdwPvmYae=YtA6ruN96TedYNLOHpQBcxo9niQOg@mail.gmail.com>
	<CAM8fPiRDo_i=qTQSMOfQGqTg1YBbAZQtNfBqXn1bhnY-_E7LYg@mail.gmail.com>
	<E2D4D1E4-13BF-4D66-8F40-A9766BCEE0A5@rabbitmq.com>
	<CAM8fPiTqRg8LtiMa21U-Vh7nFFc3YdBw9Gs8X_nASeVn8Oxiaw@mail.gmail.com>
Message-ID: <CAM8fPiTXAB3g8jhTEukJJvbju=eJSbmWyspQOKpyx=mOAZYmHw@mail.gmail.com>

Hi Steve,

How about the attached patch? It attempts to bring the "destination"
header in MESSAGEs in to line with the STOMP 1.1 spec. I've paid
cursory attention to binary-and-slash-escaping issues but it could use
a second glance before being committed, I reckon.

Regards,
  Tony

On 20 February 2012 14:56, Tony Garnock-Jones
<tonygarnockjones+rabbitmq at gmail.com> wrote:
> Adding the routing_key puts the final small missing piece in place. A
> perhaps more STOMPish way of giving it would be to have a "to" header
> or similar carried in a MESSAGE, containing the full destination given
> in the SEND. Oh wait! I've just checked, and actually that's what's
> required by the 1.1 spec already. So the STOMP adapter isn't quite
> spec-compliant, in that it's giving the destination from the
> *subscribe* rather than the *send*.
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
A non-text attachment was scrubbed...
Name: better-destination-patch.patch
Type: application/octet-stream
Size: 3681 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120220/38e64056/attachment.obj>

From emile at rabbitmq.com  Mon Feb 20 20:52:46 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Feb 2012 20:52:46 +0000
Subject: [rabbitmq-discuss] Android: unable to open stack traces error
In-Reply-To: <21fbf71a-d0b1-4a60-98e3-e277ff4f00c4@t15g2000yqi.googlegroups.com>
References: <57993ff8-0d08-4d2d-86c8-655cf4b8c11b@w19g2000vbe.googlegroups.com>
	<4F4282B1.8080109@rabbitmq.com>
	<21fbf71a-d0b1-4a60-98e3-e277ff4f00c4@t15g2000yqi.googlegroups.com>
Message-ID: <4F42B29E.8060802@rabbitmq.com>

On 20/02/12 19:52, Kamran wrote:
> is there any sample code where
> java client on android is publishing?

Not that I know of, other than the blog post you quoted earlier.


-Emile





From abhishek at eng.knowlarity.com  Mon Feb 20 21:21:47 2012
From: abhishek at eng.knowlarity.com (Abhishek Singh Bailoo)
Date: Tue, 21 Feb 2012 02:51:47 +0530
Subject: [rabbitmq-discuss] Starting rabbitmq-server: FAILED
Message-ID: <CANL-a0KHtWid83S_obQbsW7Ft3Y6C2gFT4=C4NbD5oV+ccOT-Q@mail.gmail.com>

Greetings!

I am a newb to RabbitMQ and the whole Erlang thing :)

I compiled from source and installed RabbitMQ on my server (an Amazon EC2
instance). It was configured to run with CouchDB.

After that I tried to upgrade by using apt-get install. It did warn me that
it was upgrading from lesser than version 1.5.4 to version 1.6.0 and since
my database was different, it will take a backup but old settings will be
lost. I was fine with it.

Now rabbitmq-server does not start, complaining

Setting up rabbitmq-server (1.7.2-1ubuntu1) ...
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, _err
rabbitmq-server.
invoke-rc.d: initscript rabbitmq-server, action "start" failed.
dpkg: error processing rabbitmq-server (--configure):
 subprocess installed post-installation script returned error exit status 1
Errors were encountered while processing:
 rabbitmq-server
E: Sub-process /usr/bin/dpkg returned an error code (1)

I tried apt-get remove rabbitmq-server and manually deleted the directory
/var/lib/rabbitmq and then again tried to do apt-get install but it gives
the same error.

Any help will be much appreciated!

startup logs are ...

# cat /var/log/rabbitmq/startup_err
Error: {node_start_failed,normal}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})


# cat /var/log/rabbitmq/startup_log
Starting all nodes...
Starting node rabbit at ip-10-252-17-24...
{error_logger,{{2012,2,20},{21,12,19}},"Protocol: ~p: register error:
~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
{error_logger,{{2012,2,20},{21,12,19}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.107>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,484}],[]]}
{error_logger,{{2012,2,20},{21,12,19}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2012,2,20},{21,12,19}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2012,2,20},{21,12,19}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}




regards,
Abhishek Singh Bailoo,
Platform Team
Knowlus, FreeSWITCH.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120221/499e5cd4/attachment.htm>

From james at 2600hz.com  Mon Feb 20 21:28:35 2012
From: james at 2600hz.com (James Aimonetti)
Date: Mon, 20 Feb 2012 13:28:35 -0800
Subject: [rabbitmq-discuss] Starting rabbitmq-server: FAILED
In-Reply-To: <CANL-a0KHtWid83S_obQbsW7Ft3Y6C2gFT4=C4NbD5oV+ccOT-Q@mail.gmail.com>
References: <CANL-a0KHtWid83S_obQbsW7Ft3Y6C2gFT4=C4NbD5oV+ccOT-Q@mail.gmail.com>
Message-ID: <4F42BB03.9030403@2600hz.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Salient error: {error,duplicate_name}

Another rabbitmq is running. Check your process list. Perhaps you have a
monit/bluepill type watchdog restarting it?


On 02/20/2012 01:21 PM, Abhishek Singh Bailoo wrote:
> Greetings!
> 
> I am a newb to RabbitMQ and the whole Erlang thing :)
> 
> I compiled from source and installed RabbitMQ on my server (an Amazon EC2
> instance). It was configured to run with CouchDB.
> 
> After that I tried to upgrade by using apt-get install. It did warn me that
> it was upgrading from lesser than version 1.5.4 to version 1.6.0 and since
> my database was different, it will take a backup but old settings will be
> lost. I was fine with it.
> 
> Now rabbitmq-server does not start, complaining
> 
> Setting up rabbitmq-server (1.7.2-1ubuntu1) ...
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, _err
> rabbitmq-server.
> invoke-rc.d: initscript rabbitmq-server, action "start" failed.
> dpkg: error processing rabbitmq-server (--configure):
>  subprocess installed post-installation script returned error exit status 1
> Errors were encountered while processing:
>  rabbitmq-server
> E: Sub-process /usr/bin/dpkg returned an error code (1)
> 
> I tried apt-get remove rabbitmq-server and manually deleted the directory
> /var/lib/rabbitmq and then again tried to do apt-get install but it gives
> the same error.
> 
> Any help will be much appreciated!
> 
> startup logs are ...
> 
> # cat /var/log/rabbitmq/startup_err
> Error: {node_start_failed,normal}
> 
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> 
> 
> # cat /var/log/rabbitmq/startup_log
> Starting all nodes...
> Starting node rabbit at ip-10-252-17-24...
> {error_logger,{{2012,2,20},{21,12,19}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
> {error_logger,{{2012,2,20},{21,12,19}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.107>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,484}],[]]}
> {error_logger,{{2012,2,20},{21,12,19}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2012,2,20},{21,12,19}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2012,2,20},{21,12,19}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
> 
> 
> 
> 
> regards,
> Abhishek Singh Bailoo,
> Platform Team
> Knowlus, FreeSWITCH.
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


- -- 
James Aimonetti
Distributed Systems Engineer / DJ MC_

2600hz | http://2600hz.com
sip:james at 2600hz.com
tel: 415.886.7905
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJPQrsDAAoJENc77s1OYoGgl2UIAJ8jwWi9mLcr+RaNkvzDCV0r
4yyQLBbeU611QGNyRESW/V/5HBjt90gxaeIjp911iENNZK5ddsJsXFjXPEj3aYjc
DroQ5IzY5wvmlT2tBupHZ5bclmvb8OdhngMcSj7LtUj4a32Lg5dhbmZIXlFa6h1p
NzM8YGJ0sizPnOvD0zfGbHSxrn4MBs9Gk2cAOV3lA4YCEZSzBHACsYMIiF9u2Z8W
QtB9cRys9qs+C6da7BAJS9Sitt3L2V/2eLGpLh9TM4FRWwmc0I9tzP04VKgikDvx
X/7mazJ+ZoyH+pDKpVbVFRC9oWp8mJQzVwy3CsYCcSYtGkkLXeVDizlh/ty+Df4=
=+EM3
-----END PGP SIGNATURE-----

From pepmadon at gmail.com  Mon Feb 20 22:24:29 2012
From: pepmadon at gmail.com (PepMad)
Date: Mon, 20 Feb 2012 14:24:29 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ and MySQL
Message-ID: <0e103414-8038-4231-8c48-e3f6934718fa@f30g2000yqh.googlegroups.com>

http://stackoverflow.com/questions/1467369/invoking-a-php-script-from-a-mysql-trigger

I was reading this post on Stack Overflow and the last suggestion was
to use RabbitMQ. Is this possible? I read the documentation on
RabbitMQ, how can a single mysql update be sent to a producer? I have
seen the mysql log file but that encapsulates multiple updates.

Thanks Pep

From matthew at rabbitmq.com  Mon Feb 20 22:58:42 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 20 Feb 2012 22:58:42 +0000
Subject: [rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03
 performance
In-Reply-To: <CACLE7izPH9h9wivEsKbJ3NK4_qXAkJuecZd0O7XCtByzy0BH6w@mail.gmail.com>
References: <CB602924.2DF9C%mpietrek@skytap.com>
	<4F3B8435.2040401@rabbitmq.com>
	<CACLE7iwUVeao_ceQdUr-y43srcNVrk+R5R9OBOiZxGG8FZ4OnA@mail.gmail.com>
	<4F3BED29.6050602@rabbitmq.com>
	<CACLE7iyaxmc0pJZ+gzNXa93da13s1iiStApp-A58BYPmmHkejw@mail.gmail.com>
	<4F3E4A8E.8060807@rabbitmq.com>
	<CACLE7iw0zRurNgeNRO7aO3AesLrYDvkSr6vm1vGL8kdyKoL-mQ@mail.gmail.com>
	<20120220112803.GA5917@rabbitmq.com>
	<CACLE7izPH9h9wivEsKbJ3NK4_qXAkJuecZd0O7XCtByzy0BH6w@mail.gmail.com>
Message-ID: <20120220225841.GA6149@wellquite.org>

On Mon, Feb 20, 2012 at 10:22:15AM -0800, Matt Pietrek wrote:
> Ah, thanks so much for this reply Matthew. It's extremely enlightening and
> seems to explain what we're seeing.
> 
> A follow up question just for my understanding: Are these "windows" dynamic
> in nature (e.g., varying length, varying frequency, somehow tied to current
> load)? Or are they more static (e.g. "Once every 20 milliseconds").

25 ms is the timeout I think. If the queue goes "idle" before then (i.e.
has no more work to do) then it will issue the fsync immediately. Thus
this helps prevent latency go up too much for the single-publisher case.

Matthew

From mpietrek at skytap.com  Mon Feb 20 23:50:31 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 20 Feb 2012 15:50:31 -0800
Subject: [rabbitmq-discuss] Looking for guidance on R14B04 vs. R13B03
	performance
In-Reply-To: <20120220225841.GA6149@wellquite.org>
References: <CB602924.2DF9C%mpietrek@skytap.com>
	<4F3B8435.2040401@rabbitmq.com>
	<CACLE7iwUVeao_ceQdUr-y43srcNVrk+R5R9OBOiZxGG8FZ4OnA@mail.gmail.com>
	<4F3BED29.6050602@rabbitmq.com>
	<CACLE7iyaxmc0pJZ+gzNXa93da13s1iiStApp-A58BYPmmHkejw@mail.gmail.com>
	<4F3E4A8E.8060807@rabbitmq.com>
	<CACLE7iw0zRurNgeNRO7aO3AesLrYDvkSr6vm1vGL8kdyKoL-mQ@mail.gmail.com>
	<20120220112803.GA5917@rabbitmq.com>
	<CACLE7izPH9h9wivEsKbJ3NK4_qXAkJuecZd0O7XCtByzy0BH6w@mail.gmail.com>
	<20120220225841.GA6149@wellquite.org>
Message-ID: <CACLE7iywk5WhFsEyBLLns9JdckFv28L-KNHNu8KqO77M4O8sqg@mail.gmail.com>

| 25 ms is the timeout I think.

If so, this matches up very well with my experimental results, which was
showing that that a single publisher never went over ~37 message/sec. With
a 25 ms window, the max theoretical throughput would be 40/sec if I'm
understanding you correctly.


On Mon, Feb 20, 2012 at 2:58 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Mon, Feb 20, 2012 at 10:22:15AM -0800, Matt Pietrek wrote:
> > Ah, thanks so much for this reply Matthew. It's extremely enlightening
> and
> > seems to explain what we're seeing.
> >
> > A follow up question just for my understanding: Are these "windows"
> dynamic
> > in nature (e.g., varying length, varying frequency, somehow tied to
> current
> > load)? Or are they more static (e.g. "Once every 20 milliseconds").
>
> 25 ms is the timeout I think. If the queue goes "idle" before then (i.e.
> has no more work to do) then it will issue the fsync immediately. Thus
> this helps prevent latency go up too much for the single-publisher case.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120220/2172c33f/attachment.htm>

From aloroi18 at gmail.com  Tue Feb 21 09:29:09 2012
From: aloroi18 at gmail.com (Bamboula)
Date: Tue, 21 Feb 2012 01:29:09 -0800 (PST)
Subject: [rabbitmq-discuss] Re storing a message to the queue
Message-ID: <33362597.post@talk.nabble.com>


After using Dequeue() to my queue, I want to restore the retrieved message to
the queue. Is this possible? 


-- 
View this message in context: http://old.nabble.com/Restoring-a-message-to-the-queue-tp33362597p33362597.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From videlalvaro at gmail.com  Tue Feb 21 09:32:52 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 21 Feb 2012 10:32:52 +0100
Subject: [rabbitmq-discuss] Re storing a message to the queue
In-Reply-To: <33362597.post@talk.nabble.com>
References: <33362597.post@talk.nabble.com>
Message-ID: <CAMcAHLWwUzMxbpxHpObix8DmRzw4ReeMsTPzJk3ESEE2DHOBwg@mail.gmail.com>

Hi,

It all depends on why you want the message to be back in the queue. Also do
you want the exact message to be back in the queue or just the contents of
it?

If you want the exact message you can basic.reject it I guess. See the Spec
here: http://www.rabbitmq.com/amqp-0-9-1-quickref.html

If you just want the msg body back in the queue then you can republish the
message body.

Regards,

Alvaro

On Tue, Feb 21, 2012 at 10:29 AM, Bamboula <aloroi18 at gmail.com> wrote:

>
> After using Dequeue() to my queue, I want to restore the retrieved message
> to
> the queue. Is this possible?
>
>
> --
> View this message in context:
> http://old.nabble.com/Restoring-a-message-to-the-queue-tp33362597p33362597.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120221/0181f0ad/attachment.htm>

From lionel.cons at cern.ch  Tue Feb 21 09:47:37 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Tue, 21 Feb 2012 10:47:37 +0100
Subject: [rabbitmq-discuss] Bug in management plugin escaping
Message-ID: <20120221104100.ea62.abe10f7e5afbbb3a79ce619739541149@cern.ch>

I've found a bug in the way the RabbitMQ plugin handles escaping.

Here is how to reproduce it with RabbitMQ 2.7.1.

I use the web-based management interface to create a user.

I then set the permissions to be everything starting with "test.".
According to http://www.rabbitmq.com/access-control.html, I type in
the relevant field: test\..*

When I press "Set permission", the web interface reports:

Got response code 500 with body
Internal Server Error
The server encountered an error while processing this request:

{error,{error,undef,
              [{xmerl_ucs,from_utf8,[<<"test\\..*">>]},
               {mochijson2,json_encode_string,2},
               {mochijson2,'-json_encode_proplist/2-fun-0-',3},
               {lists,foldl,3},
               {mochijson2,json_encode_proplist,2},
               {mochijson2,'-json_encode_array/2-fun-0-',3},
               {lists,foldl,3},
               {mochijson2,json_encode_array,2}]}}

FWIW, I get the same problem using rabbitmqadmin.

Cheers,

Lionel

From simon at rabbitmq.com  Tue Feb 21 10:04:51 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 21 Feb 2012 10:04:51 +0000
Subject: [rabbitmq-discuss] Bug in management plugin escaping
In-Reply-To: <20120221104100.ea62.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20120221104100.ea62.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <4F436C43.4090106@rabbitmq.com>

On 21/02/12 09:47, Lionel Cons wrote:
> I've found a bug in the way the RabbitMQ plugin handles escaping.

There might be such, but this is not one.

> {error,{error,undef,
>                [{xmerl_ucs,from_utf8,[<<"test\\..*">>]},

You are missing xmerl. This is a part of Erlang, but some distro 
packaging (Debian especially) splits it out. I thought we had that fixed 
for all recent releases though. Which packaging and version are you using?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From lionel.cons at cern.ch  Tue Feb 21 10:39:07 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Tue, 21 Feb 2012 11:39:07 +0100
Subject: [rabbitmq-discuss] Bug in management plugin escaping
In-Reply-To: <4F436C43.4090106@rabbitmq.com>
References: <20120221104100.ea62.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4F436C43.4090106@rabbitmq.com>
Message-ID: <20291.29771.266220.535967@mail.cern.ch>

Simon MacMullen writes:
 > > {error,{error,undef,
 > >                [{xmerl_ucs,from_utf8,[<<"test\\..*">>]},
 > 
 > You are missing xmerl. This is a part of Erlang, but some distro 
 > packaging (Debian especially) splits it out. I thought we had that fixed 
 > for all recent releases though. Which packaging and version are you using?

I'm using Erlang rpms from EPEL6 and indeed erlang-xmerl was not installed.
Installing it fixed the problem.

This said, an error message like "xmerl is missing" would have been
easier to interpret...

Thanks,

Lionel

From simon at rabbitmq.com  Tue Feb 21 10:46:07 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 21 Feb 2012 10:46:07 +0000
Subject: [rabbitmq-discuss] Bug in management plugin escaping
In-Reply-To: <20291.29771.266220.535967@mail.cern.ch>
References: <20120221104100.ea62.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<4F436C43.4090106@rabbitmq.com>
	<20291.29771.266220.535967@mail.cern.ch>
Message-ID: <4F4375EF.8030202@rabbitmq.com>

On 21/02/12 10:39, Lionel Cons wrote:
> Simon MacMullen writes:
>   >  >  {error,{error,undef,
>   >  >                 [{xmerl_ucs,from_utf8,[<<"test\\..*">>]},
>   >
>   >  You are missing xmerl. This is a part of Erlang, but some distro
>   >  packaging (Debian especially) splits it out. I thought we had that fixed
>   >  for all recent releases though. Which packaging and version are you using?
>
> I'm using Erlang rpms from EPEL6 and indeed erlang-xmerl was not installed.
> Installing it fixed the problem.

Are you also using a Rabbit RPM?

> This said, an error message like "xmerl is missing" would have been
> easier to interpret...

Yeah, but then we have to wrap every call into any bit of the runtime 
that may be missing. There should already be a warning printed at startup?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Tue Feb 21 10:48:57 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 21 Feb 2012 11:48:57 +0100
Subject: [rabbitmq-discuss] Bug in management plugin escaping
In-Reply-To: <4F4375EF.8030202@rabbitmq.com>
References: <20120221104100.ea62.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4F436C43.4090106@rabbitmq.com>
	<20291.29771.266220.535967@mail.cern.ch>
	<4F4375EF.8030202@rabbitmq.com>
Message-ID: <CAMcAHLVCO3AoqnsJVVN1OhBk78f=hduoZqHng-pyDphM1TFVvA@mail.gmail.com>

Hi,

On Tue, Feb 21, 2012 at 11:46 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

 This said, an error message like "xmerl is missing" would have been
>> easier to interpret...
>>
>
> Yeah, but then we have to wrap every call into any bit of the runtime that
> may be missing. There should already be a warning printed at startup?


On that regard PHP frameworks like Symfony offer a check.php script that
basically tests if your PHP installation is OK for running the framework.
That is? it checks for required extensions, folder permissions as well as
some security settings.

Maybe RabbitMQ could provide such script?

Cheers,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120221/ee0d0a6a/attachment.htm>

From steve at rabbitmq.com  Tue Feb 21 10:50:35 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 21 Feb 2012 10:50:35 +0000
Subject: [rabbitmq-discuss] Bug: Java ConnectionFactory can hangs
	forever in network packet loss cases
In-Reply-To: <62A93B17-6DEA-4445-B523-CB4E747B4B29@rabbitmq.com>
References: <CACYRexfFE2Es7FK-MzeOtWZ3WB77=7QRtY9fxnNXYHQeohZGpQ@mail.gmail.com>
	<CACYRexdEtppn4DxYAKRbRZw+SBRhohnwN88P_xXh68kvNJ3jrw@mail.gmail.com>
	<62A93B17-6DEA-4445-B523-CB4E747B4B29@rabbitmq.com>
Message-ID: <3604F970-51BD-4443-AFB9-1A709619269C@rabbitmq.com>

Ildar,

Just a note to confirm that this bug is now fixed and will be in the next release.

Steve Powell  (a funny bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 16 Feb 2012, at 13:27, Steve Powell wrote:

> Dear Ildar,
> 
> First, may I apologise for not getting back to you sooner. It seems that you
> have clearly identified a bug, and have helped to narrow it down for us.
> 
> Thank you very much. I have raised a problem for us to fix and track this
> (24747).
> 
> I have a few comments regarding your settings: it seems to me that a heartbeat
> of 30s is not unreasonable, but you should be aware that anything up to a minute
> may pass before noticing that a heartbeat is missed, so you must not rely on
> this interval.
> 
> The ConnectionTimeout will only affect waiting for the socket connection so is
> not involved in this. I think your interval here is again quite large, but not
> unreasonable in unreliable networks. I would expect the herartbeat to be about
> half of this (see note above).
> 
> We'll get on to this bug asap.
> Steve Powell
> steve at rabbitmq.com
> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
> 
> On 13 Feb 2012, at 09:28, ?????? ?????????? wrote:
> 
>> Can anybody help with this problem or prove that i'm wrong?
>> 
>> 2012/2/7 ?????? ?????????? <absorbb at gmail.com>
>> Hello.
>> 
>> We have rabbitMQ 2.7.1 java clients remotely connected to the server.
>> We started experience short-term bad network scenarios and serious problem occurred:
>> 1. factory.setRequestedHeartbeat set to 30s
>> 2. factory.setConnectionTimeout set to 30000ms
>> client properly closes connection after missing 30 seconds of heartbeats.
>> But sometimes it hangs completely when tries to open a new connection.
>> 
>> I tried to analyze java client code and what is result:
>> 
>> AMQConnection.java:286 :
>>          _frameHandler.setTimeout(HANDSHAKE_TIMEOUT); - socket.soTimeout is set to 10s here
>> then it starts the MainLoop at line 294
>> and blocks till get a reply for a handshake at line 300:
>>     connStart =
>>                (AMQP.Connection.Start) connStartBlocker.getReply().getMethod();
>> 
>> problem is that it's possible that it'll never get a reply. Because MainLoop relies on heartbeats functional to handle such situation which is not enabled yet. It happens only at line 368:
>>            setHeartbeat(heartbeat);
>> MainLoop endlessly runs at 492:              
>>    Frame frame = _frameHandler.readFrame();
>> which returns null every 10s (this is how SocketTimeoutException handled in Frame.readFrom..)
>> and handleSocketTimeout() do nothing because _heartbeat is not set yet.
>> 
>> Thanks.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From lionel.cons at cern.ch  Tue Feb 21 11:05:59 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Tue, 21 Feb 2012 12:05:59 +0100
Subject: [rabbitmq-discuss] Bug in management plugin escaping
In-Reply-To: <4F4375EF.8030202@rabbitmq.com>
References: <20120221104100.ea62.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4F436C43.4090106@rabbitmq.com>
	<20291.29771.266220.535967@mail.cern.ch>
	<4F4375EF.8030202@rabbitmq.com>
Message-ID: <20291.31383.799166.74556@mail.cern.ch>

Simon MacMullen writes:
 > Are you also using a Rabbit RPM?

Yes, a home-built one that does not require erlang (the meta rpm) to
avoid installing tens of erlang-* rpms that we do not need.

 > There should already be a warning printed at startup?

Indeed. startup_log contained:

 *WARNING* Undefined function xmerl_ucs:from_utf8/1

However, since the init script succeeded, we assumed that RabbitMQ was
happy. Why isn't this (a required package missing) a fatal error?

Cheers,

Lionel

From simon at rabbitmq.com  Tue Feb 21 11:11:01 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 21 Feb 2012 11:11:01 +0000
Subject: [rabbitmq-discuss] Bug in management plugin escaping
In-Reply-To: <CAMcAHLVCO3AoqnsJVVN1OhBk78f=hduoZqHng-pyDphM1TFVvA@mail.gmail.com>
References: <20120221104100.ea62.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<4F436C43.4090106@rabbitmq.com>	<20291.29771.266220.535967@mail.cern.ch>	<4F4375EF.8030202@rabbitmq.com>
	<CAMcAHLVCO3AoqnsJVVN1OhBk78f=hduoZqHng-pyDphM1TFVvA@mail.gmail.com>
Message-ID: <4F437BC5.5060402@rabbitmq.com>

On 21/02/12 10:48, Alvaro Videla wrote:
> On that regard PHP frameworks like Symfony offer a check.php script that
> basically tests if your PHP installation is OK for running the
> framework. That is? it checks for required extensions, folder
> permissions as well as some security settings.
>
> Maybe RabbitMQ could provide such script?

As mentioned elsethread, something like this runs at startup, but the 
warnings are non-fatal.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Feb 21 11:13:50 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 21 Feb 2012 11:13:50 +0000
Subject: [rabbitmq-discuss] Bug in management plugin escaping
In-Reply-To: <20291.31383.799166.74556@mail.cern.ch>
References: <20120221104100.ea62.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<4F436C43.4090106@rabbitmq.com>	<20291.29771.266220.535967@mail.cern.ch>	<4F4375EF.8030202@rabbitmq.com>
	<20291.31383.799166.74556@mail.cern.ch>
Message-ID: <4F437C6E.4070802@rabbitmq.com>

On 21/02/12 11:05, Lionel Cons wrote:
> However, since the init script succeeded, we assumed that RabbitMQ was
> happy. Why isn't this (a required package missing) a fatal error?

*Tries to remember*.

There is at least one situation where you do want to ignore the errors: 
if you use an old version of Erlang (such as R12B-3 on Debian Lenny) you 
will get a bunch of missing references to SSL code. As long as you don't 
actually *use* SSL you will be fine however.

One day we will abandon such elderly Erlang versions, at which point we 
probably should make these errors fatal.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthew at rabbitmq.com  Tue Feb 21 11:13:49 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 21 Feb 2012 11:13:49 +0000
Subject: [rabbitmq-discuss] Bug in management plugin escaping
In-Reply-To: <20291.31383.799166.74556@mail.cern.ch>
References: <20120221104100.ea62.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4F436C43.4090106@rabbitmq.com>
	<20291.29771.266220.535967@mail.cern.ch>
	<4F4375EF.8030202@rabbitmq.com>
	<20291.31383.799166.74556@mail.cern.ch>
Message-ID: <20120221111349.GA23283@rabbitmq.com>

On Tue, Feb 21, 2012 at 12:05:59PM +0100, Lionel Cons wrote:
>  > There should already be a warning printed at startup?
> 
> Indeed. startup_log contained:
> 
>  *WARNING* Undefined function xmerl_ucs:from_utf8/1
> 
> However, since the init script succeeded, we assumed that RabbitMQ was
> happy. Why isn't this (a required package missing) a fatal error?

Ahh, Lionel, I argued long and hard for that. If the code is reachable
and missing, surely that should be a fatal error. However, that, for
example, would stop people using Rabbit at all if they didn't have the
SSL libraries installed, and lots of people have no desire or need to
use SSL connections to Rabbit.

What should and shouldn't be a "fatal" error in this regard depends upon
the user and what they will be using Rabbit for. Alas, Rabbit's
clairvoyance is poor.

Matthew

From mikeb at rabbitmq.com  Tue Feb 21 11:21:44 2012
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 21 Feb 2012 11:21:44 +0000
Subject: [rabbitmq-discuss] Bug in management plugin escaping
In-Reply-To: <4F437C6E.4070802@rabbitmq.com>
References: <20120221104100.ea62.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<4F436C43.4090106@rabbitmq.com>	<20291.29771.266220.535967@mail.cern.ch>	<4F4375EF.8030202@rabbitmq.com>	<20291.31383.799166.74556@mail.cern.ch>
	<4F437C6E.4070802@rabbitmq.com>
Message-ID: <4F437E48.2070909@rabbitmq.com>

On 02/21/2012 11:13 AM, Simon MacMullen wrote:
> On 21/02/12 11:05, Lionel Cons wrote:
>> However, since the init script succeeded, we assumed that RabbitMQ was
>> happy. Why isn't this (a required package missing) a fatal error?
>
> *Tries to remember*.
>
> There is at least one situation where you do want to ignore the errors:
> if you use an old version of Erlang (such as R12B-3 on Debian Lenny) you
> will get a bunch of missing references to SSL code. As long as you don't
> actually *use* SSL you will be fine however.

There's other situations in which apps will have code referencing 
modules that aren't present; for example, SockJS-Erlang can work with 
both misultin and cowboy and has code for both, but usually only one of 
those would be in use in a given deployment.

-Michael

From abhishek at eng.knowlarity.com  Tue Feb 21 12:24:57 2012
From: abhishek at eng.knowlarity.com (Abhishek Singh Bailoo)
Date: Tue, 21 Feb 2012 17:54:57 +0530
Subject: [rabbitmq-discuss] Starting rabbitmq-server: FAILED
Message-ID: <CANL-a0Jf-4L3quRaG41vPX+Y_+aEGXAOpcUTBuPhtxf7593QOw@mail.gmail.com>

Thanks James! My old rabbitmq-server was still running!

I stopped it, removed everything and apt-get install works just fine. Along
the way, I picked up some commands using rabbitmqctl :)

Cheers!

regards,
Abhishek Singh Bailoo,
Platform Team
Knowlus, FreeSWITCH.Message: 27

Date: Mon, 20 Feb 2012 13:28:35 -0800
> From: James Aimonetti <james at 2600hz.com>
> Subject: Re: [rabbitmq-discuss] Starting rabbitmq-server: FAILED
> To: <rabbitmq-discuss at lists.rabbitmq.com>
> Message-ID: <4F42BB03.9030403 at 2600hz.com>
> Content-Type: text/plain; charset="ISO-8859-1"
>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Salient error: {error,duplicate_name}
>
> Another rabbitmq is running. Check your process list. Perhaps you have a
> monit/bluepill type watchdog restarting it?
>
>
> On 02/20/2012 01:21 PM, Abhishek Singh Bailoo wrote:
> > Greetings!
> >
> > I am a newb to RabbitMQ and the whole Erlang thing :)
> >
> > I compiled from source and installed RabbitMQ on my server (an Amazon EC2
> > instance). It was configured to run with CouchDB.
> >
> > After that I tried to upgrade by using apt-get install. It did warn me
> that
> > it was upgrading from lesser than version 1.5.4 to version 1.6.0 and
> since
> > my database was different, it will take a backup but old settings will be
> > lost. I was fine with it.
> >
> > Now rabbitmq-server does not start, complaining
> >
> > Setting up rabbitmq-server (1.7.2-1ubuntu1) ...
> > Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log,
> _err
> > rabbitmq-server.
> > invoke-rc.d: initscript rabbitmq-server, action "start" failed.
> > dpkg: error processing rabbitmq-server (--configure):
> >  subprocess installed post-installation script returned error exit
> status 1
> > Errors were encountered while processing:
> >  rabbitmq-server
> > E: Sub-process /usr/bin/dpkg returned an error code (1)
> >
> > I tried apt-get remove rabbitmq-server and manually deleted the directory
> > /var/lib/rabbitmq and then again tried to do apt-get install but it gives
> > the same error.
> >
> > Any help will be much appreciated!
> >
> > startup logs are ...
> >
> > # cat /var/log/rabbitmq/startup_err
> > Error: {node_start_failed,normal}
> >
> > Crash dump was written to: erl_crash.dump
> > Kernel pid terminated (application_controller)
> >
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> >
> >
> > # cat /var/log/rabbitmq/startup_log
> > Starting all nodes...
> > Starting node rabbit at ip-10-252-17-24...
> > {error_logger,{{2012,2,20},{21,12,19}},"Protocol: ~p: register error:
> >
> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
> >
> {error_logger,{{2012,2,20},{21,12,19}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.107>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,484}],[]]}
> >
> {error_logger,{{2012,2,20},{21,12,19}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> >
> {error_logger,{{2012,2,20},{21,12,19}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> >
> {error_logger,{{2012,2,20},{21,12,19}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> > {"Kernel pid
> >
> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
> >
> >
> >
> >
> > regards,
> > Abhishek Singh Bailoo,
> > Platform Team
> > Knowlus, FreeSWITCH.
> >
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120221/f581062d/attachment.htm>

From alexis at rabbitmq.com  Tue Feb 21 13:04:24 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 21 Feb 2012 13:04:24 +0000
Subject: [rabbitmq-discuss] Via [Openstack] Announcing StackTach ...
Message-ID: <CACOPnvfQyiMkwCKFm4K0EPZkgC2Fb7+BTTuf1hYNr2f=-6V7uw@mail.gmail.com>

Hi guys

I found this via the OpenStack group.  It may be of interest to you.

alexis



On Mon, Feb 20, 2012 at 8:15 PM, Sandy Walsh <sandy.walsh at rackspace.com> wrote:
> Hey!
>
> Last week I started on a little debugging tool for OpenStack based on
> AMQP events that I've been calling StackTach. It's really handy for
> watching the flow of an operation through the various parts of OpenStack.
>
> It consists of two parts:
>
> 1. The Worker.
>
> Sits somewhere on your OpenStack network. It listens to AMQP "monitor.*"
> notifications and sends them to the StackTach server.
>
> (I need this branch to land for it to work ... hint hint)
> https://review.openstack.org/#change,4194
>
> 2. The Web Interface
>
> Collects events via REST calls (poorman multi-tenant) and presents these
> events in a funky little web interface.
>
> You can play around with the UI here:
> http://darksecretsoftware.com/stacktach/1/
> (this is with data coming from my personal OpenStack Dev env)
>
> "What do I do?"
>
> Click on anything and you'll see the particulars in the Details window.
> Click on [+] to see the JSON for the event.
> "Hosts" shows the last 20 events that have a Host defined.
> "Instances" shows the last 20 events that have the Instance field
> populated.
> Hosts and Instances windows are resize-able.
> You may see duplication between both windows.
> Click on Time to see any events around that time (+/- 1 minute I think)
>
> "Where is the code?"
>
> The code is hosted below. There's LOTS of work to do to make it ready
> for prime-time ... but please, contribute.
>
> https://github.com/rackspace/stacktach
>
> "How do I install it?"
>
> I need to make this process cleaner. Right know you need to know how to
> create a Django Project and stick StackTach in there.
>
> Look forward to the feedback.
>
> Cheers,
> Sandy
>
>
> _______________________________________________
> Mailing list: https://launchpad.net/~openstack
> Post to ? ? : openstack at lists.launchpad.net
> Unsubscribe : https://launchpad.net/~openstack
> More help ? : https://help.launchpad.net/ListHelp

From steve at rabbitmq.com  Tue Feb 21 13:23:02 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 21 Feb 2012 13:23:02 +0000
Subject: [rabbitmq-discuss] Passive queue declaration and channel closure
In-Reply-To: <88E590DC4586974D825FC82AE798294E520F1E82@GSVCLU04.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E520F1E82@GSVCLU04.ges.ferlan.it>
Message-ID: <73831E29-46BF-464A-A9B9-CA040F734011@rabbitmq.com>

Simone, 

Replies in-line below..

I don't think this is likely to change in the near future, since it
would be disruptive to most clients that use this.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 16 Feb 2012, at 17:10, Busoli, Simone wrote:

> Without relying on the management plugin I think the only way to do that is to
> declare the queue as passive. At least with the .NET client and apparently the
> Java client too, when the queue does not exist, besides throwing an exception,
> the channel is closed as well. From the spec:
> 
> If set, the server will reply with Declare-Ok if the queue already exists with
> the same name, and raise an error if not. The client can use this to check
> whether a queue exists without modifying the server state.

The spec goes on to say:

  The client MAY ask the server to assert that a queue exists without creating
  the queue if not. If the queue does not exist, the server treats this as a
  failure. Error code: not-found

> There is no mention of channel closure, while the last sentence implies that
> using the passive bit is indeed a way for a client to check queue existence, so
> closing the channel when it doesn?t is a bit unexpected. That said, it?s not a
> big deal to recreate the channel in such cases, but I?d appreciate your opinion.
> Any chance this behavior can be changed in the client libraries?

This is the mention of channel-closure -- an 'error' raised on the channel will
close it.


From simon at rabbitmq.com  Tue Feb 21 13:32:02 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 21 Feb 2012 13:32:02 +0000
Subject: [rabbitmq-discuss] rabbitmqadmin and ability to read
 configuration files
In-Reply-To: <bw7aa4d4qbn.fsf@mail.cern.ch>
References: <CAMOXM2-yT_ZSX4_FkJpnh=GFX4_QT8pLKt+j8pnnZF6QHp1BmA@mail.gmail.com>	<4F33DFC9.60903@rabbitmq.com>	<CAMOXM28oeg5E=7x1+dLrPdkt_r21_G1j=Nh8hX+X8i5yq60ZJA@mail.gmail.com>	<4F393239.5000707@rabbitmq.com>	<CAMOXM29HisUL=ERb6B1wgUv+6Hgh4jOuUL2a1b5gyHVrrrVeSw@mail.gmail.com>	<4F423454.1040201@rabbitmq.com>
	<bw7aa4d4qbn.fsf@mail.cern.ch>
Message-ID: <4F439CD2.7020401@rabbitmq.com>

On 20/02/12 12:55, Lionel Cons wrote:
> With our patch, we can put default_vhost=foo in the conf file and both
> list/show commands (ignoring it) and declare commands (using it) will work.

Ah, thanks, I see.

It doesn't seem to work though:

$ cat /home/simon/.rabbitmqadmin.conf

[test]
hostname = localhost
default_vhost = foo

$ rabbitmqadmin list vhosts

+------+---------+
| name | tracing |
+------+---------+
| /    | False   |
| foo  | False   |
+------+---------+

$ rabbitmqadmin -N test declare queue name=lives_in_foo

queue declared

$ rabbitmqadmin -N test list queues vhost name
+-------+--------------+
| vhost |     name     |
+-------+--------------+
| /     | lives_in_foo |
+-------+--------------+

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From lionel.cons at cern.ch  Tue Feb 21 13:44:53 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Tue, 21 Feb 2012 14:44:53 +0100
Subject: [rabbitmq-discuss] Problems with STOMP & access control
Message-ID: <20120221143400.242c.abe10f7e5afbbb3a79ce619739541149@cern.ch>

I've read http://www.rabbitmq.com/access-control.html and
http://www.rabbitmq.com/stomp.html and I did not find any practical
way to use access control with STOMP.

In the STOMP world (in fact, since STOMP is broker behavior agnostic,
this is rather tied to the JMS world), one can use destinations like
/queue/test.foo or /topic/test.bar. It would be natural to use these
names in the access control regexps to allow, for instance, a given
user to access all queues matching "test\..*".

Unfortunately, the STOMP destinations names get mapped to AMQP
resource names that loose the original names, for instance
amq.gen-AXVr2gFuBTO4duQ5OEC9b9.

Is there a way in RabbitMQ to use access control based on the STOMP
destination names?

Cheers,

Lionel

From aloroi18 at gmail.com  Tue Feb 21 14:14:57 2012
From: aloroi18 at gmail.com (Bamboula)
Date: Tue, 21 Feb 2012 06:14:57 -0800 (PST)
Subject: [rabbitmq-discuss] Re  storing a message to the queue
In-Reply-To: <CAMcAHLWwUzMxbpxHpObix8DmRzw4ReeMsTPzJk3ESEE2DHOBwg@mail.gmail.com>
References: <33362597.post@talk.nabble.com>
	<CAMcAHLWwUzMxbpxHpObix8DmRzw4ReeMsTPzJk3ESEE2DHOBwg@mail.gmail.com>
Message-ID: <33364165.post@talk.nabble.com>


Hi,

Thanks for your quick reply. I think that my problem is not really to
restore a message, because if I check with the RabbitMQ command line (using
"rabbitmqctl list_queues"),I can see that the message I sent is stored in
the queue. My problem is rather to be able to retrieve the message to my
consumer GUI.
 I've created a project (with C# .net) where the consumer can choose whether
he wants to be connected or disconnected from the queue.

When the consumer chooses the disconnect radiobutton, I'm writing in the
consumer form:

consumer.onMessageReceived -= handleMessage;

This causes to go to the catch of this loop:
 
            while (isConsuming)
            {
                try
                {
                    RabbitMQ.Client.Events.BasicDeliverEventArgs e =
(RabbitMQ.Client.Events.BasicDeliverEventArgs)consumer.Queue.Dequeue();

                    IBasicProperties props = e.BasicProperties;
                    byte[] body = e.Body;
                    // ... process the message
                    onMessageReceived(body);
                    Model.BasicAck(e.DeliveryTag,true);

                }
                catch
                {
                    Model.BasicCancel(consumerTag);
                    break;
                }

Now, the producer sends a message, and the message is stocked in the queue.
Then, the consumer chooses the Connect RadioButton. I'm expecting to see the
message on the consumer GUI, but I'm not.
I checked the consumer instance's properties during debugging and I saw
that:m_queue count=0. This explains why I don't see any message on my
consumer GUI.

If I do the same experience with more than one message, I will be able to
retrieve all the messages except the first one.

I think that the reason to this is that the consumer instance goes through a
Dequeue() before the user chooses the disconnect radiobutton and maybe due
to this, there is no possibility to retrieve the message from the queue.
But maybe I'm wrong. However, the problem is still the same: I can't
retrieve the first message.

Could you help me?if you can't, give me a link to someone who could help.
Thanks a lot,I've been working on this for several days

Bamboula

Alvaro Videla-2 wrote:
> 
> Hi,
> 
> It all depends on why you want the message to be back in the queue. Also
> do
> you want the exact message to be back in the queue or just the contents of
> it?
> 
> If you want the exact message you can basic.reject it I guess. See the
> Spec
> here: http://www.rabbitmq.com/amqp-0-9-1-quickref.html
> 
> If you just want the msg body back in the queue then you can republish the
> message body.
> 
> Regards,
> 
> Alvaro
> 
> On Tue, Feb 21, 2012 at 10:29 AM, Bamboula <aloroi18 at gmail.com> wrote:
> 
>>
>> After using Dequeue() to my queue, I want to restore the retrieved
>> message
>> to
>> the queue. Is this possible?
>>
>>
>> --
>> View this message in context:
>> http://old.nabble.com/Restoring-a-message-to-the-queue-tp33362597p33362597.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Restoring-a-message-to-the-queue-tp33362597p33364165.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From aloroi18 at gmail.com  Tue Feb 21 14:26:52 2012
From: aloroi18 at gmail.com (Bamboula)
Date: Tue, 21 Feb 2012 06:26:52 -0800 (PST)
Subject: [rabbitmq-discuss]  Who did the "Simon Dixon's blog"?
Message-ID: <33364220.post@talk.nabble.com>


Hi everybody,

Who did the Simon Dixon's first part (using C# .net)?
(http://simonwdixon.wordpress.com/2011/05/08/getting-started-with-rabbitmq-in-dotnet/)
I need some urgent help using this code!

Thanks a lot,

Bamboula
-- 
View this message in context: http://old.nabble.com/Who-did-the-%22Simon-Dixon%27s-blog%22--tp33364220p33364220.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From majek04 at gmail.com  Tue Feb 21 14:32:55 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 21 Feb 2012 14:32:55 +0000
Subject: [rabbitmq-discuss] Who did the "Simon Dixon's blog"?
In-Reply-To: <33364220.post@talk.nabble.com>
References: <33364220.post@talk.nabble.com>
Message-ID: <CABzX+qzYqStmOx8QirgoAitiR2V2YDKB7z=eAX3utAUubM6u3w@mail.gmail.com>

On Tue, Feb 21, 2012 at 14:26, Bamboula <aloroi18 at gmail.com> wrote:
> Who did the Simon Dixon's first part (using C# .net)?
> (http://simonwdixon.wordpress.com/2011/05/08/getting-started-with-rabbitmq-in-dotnet/)
> I need some urgent help using this code!

Hi,

Have you seen our console-only (not GUI) version of the rabbit tutorials in C#?

  https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/dotnet

  http://www.rabbitmq.com/getstarted.html

Cheers,
   Marek

From Massimo.Paladin at cern.ch  Tue Feb 21 15:37:24 2012
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Tue, 21 Feb 2012 16:37:24 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin and ability to read
 configuration files
In-Reply-To: <4F439CD2.7020401@rabbitmq.com>
References: <CAMOXM2-yT_ZSX4_FkJpnh=GFX4_QT8pLKt+j8pnnZF6QHp1BmA@mail.gmail.com>
	<4F33DFC9.60903@rabbitmq.com>
	<CAMOXM28oeg5E=7x1+dLrPdkt_r21_G1j=Nh8hX+X8i5yq60ZJA@mail.gmail.com>
	<4F393239.5000707@rabbitmq.com>
	<CAMOXM29HisUL=ERb6B1wgUv+6Hgh4jOuUL2a1b5gyHVrrrVeSw@mail.gmail.com>
	<4F423454.1040201@rabbitmq.com> <bw7aa4d4qbn.fsf@mail.cern.ch>
	<4F439CD2.7020401@rabbitmq.com>
Message-ID: <CAMOXM29_=_r1fxF_b0fsiGT7qOwh-9WLszpsO3oJsgaAWM0u1w@mail.gmail.com>

Simon,

you are right.

I believe now it is fine:
https://raw.github.com/mpaladin/rabbitmq-custom/master/rabbitmqadmin/rabbitmqadmin

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Tue, Feb 21, 2012 at 2:32 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 20/02/12 12:55, Lionel Cons wrote:
>
>> With our patch, we can put default_vhost=foo in the conf file and both
>> list/show commands (ignoring it) and declare commands (using it) will
>> work.
>>
>
> Ah, thanks, I see.
>
> It doesn't seem to work though:
>
> $ cat /home/simon/.rabbitmqadmin.**conf
>
> [test]
> hostname = localhost
> default_vhost = foo
>
> $ rabbitmqadmin list vhosts
>
> +------+---------+
> | name | tracing |
> +------+---------+
> | /    | False   |
> | foo  | False   |
> +------+---------+
>
> $ rabbitmqadmin -N test declare queue name=lives_in_foo
>
> queue declared
>
> $ rabbitmqadmin -N test list queues vhost name
> +-------+--------------+
> | vhost |     name     |
> +-------+--------------+
> | /     | lives_in_foo |
> +-------+--------------+
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120221/0b3de2de/attachment.htm>

From steve at rabbitmq.com  Tue Feb 21 17:41:07 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 21 Feb 2012 17:41:07 +0000
Subject: [rabbitmq-discuss] Consumers and exceptions
In-Reply-To: <136bb8b3-7484-4830-9e8d-4a0af5bb1df2@bs8g2000vbb.googlegroups.com>
References: <136bb8b3-7484-4830-9e8d-4a0af5bb1df2@bs8g2000vbb.googlegroups.com>
Message-ID: <11213BC2-92C4-4F3A-87F3-7DAF727F47B2@rabbitmq.com>

Hi Jon,

I can't see Consumer Exceptions discussed in that thread, but in any case: if a
Consumer callback throws an Exception, it is caught (on the Consumer callback
thread) and passed to the connection's ExceptionHandler
handleConsumerException() method.

This setting is not exposed on the newConnection() call but is accessible on
one of the low-level, public AMQConnection() constructors. It is a final
attribute.

By default this is set to the DefaultExceptionHandler, which implements methods:

  handleUnexpectedConnectionDriverException -- and is a no-op
and
  handleReturnListenerException
  handleFlowListenerException
  handleConfirmListenerException
  handleConsumerException
each of which kills the connection.

The basic idea is that Consumer callbacks and Listeners should NOT throw
exceptions except in the direst of circumstances.

The connection.close() ought to drive the ShutdownListeners for the connection
and for any open channels on that connection, but there was a bug in this area
(which is fixed and will be in the next release).

It is entirely possible that Consumers will continue to be called (there may be
consumer callbacks queued up), and the last call should be handleCancel().

But the connection and all its channels will need to be recreated to continue.

Does this help?

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 19 Feb 2012, at 18:01, Jon Hill wrote:

> Hi
> 
> I've just been reading this post:
> http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/77bc5f0329fa61c4/bf0c15a0502555ae?lnk=gst&q=defaultconsumer#bf0c15a0502555ae
> 
> It tells me that if an Exception is thrown from a Consumer the
> expected behaviour is to close the connection (my shutdown listener
> doesn't kick in when this occurs either).
> 
> So, should I return immediately once the consumption has finished and
> handle the application layer processing of the messages in a separate
> thread?
> 
> Best,
> 
> Jon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From ejarendt at gmail.com  Tue Feb 21 17:51:47 2012
From: ejarendt at gmail.com (Eric)
Date: Tue, 21 Feb 2012 09:51:47 -0800 (PST)
Subject: [rabbitmq-discuss] Ensuring low latency for publishers
Message-ID: <1e665e68-b239-44a0-aecd-af98dec19d1d@qs5g2000pbc.googlegroups.com>

Hi,

I've made some effort to answer these questions on my own, but I'm
still a bit unsure.  I'm designing an application for a webserver that
needs to publish events to a broker as part of the work to render a
request.  The information is important, but in the event of a broker
failure or broker throttling, the most important thing is to get the
web request rendered.  If that means messages get dropped, that's fine
- the consumers are idempotent and we can replay the messages later if
necessary.

I'd like this information to be published with as little latency to
the rendering thread as possible, so large delays while publishing
messages (20ms+) aren't acceptable, even if the broker is down or
throttling.  Essentially, I want a situation where publishing gets
done, but the publishing process and/or the state of the broker don't
impact the process of rendering the request.  I'm using the Java
client library.

My first inclination was to put all messages in a blocking queue and
have a single thread dedicated to publishing the contents of that
queue to the broker.  If the broker goes down that's ok - a bound on
the queue will make sure we don't exceed the server's heap capacity.
The problem there is that such queues synchronize all writers on a
single lock, and given the high concurrency of the server there could
be a lot of contention.  I want to avoid a single point of
synchronization.

There are lock-free queue implementations, but they don't offer an
easy way to implement a size bound.

Rather than queuing locally, isn't RabbitMQ for queueing?  So I
figured I could keep a single connection around for all publishers in
the JVM, with one thread responsible for maintaining the connection.
Since the server uses a thread pool to render requests, every thread
can have their own channel in a threadlocal, only creating a new
channel if the underlying connection breaks and is reestablished or
they haven't created one before.  If the connection is down when the
rendering thread tries to publish, we'll just drop the message.
Otherwise each rendering thread can publish straight to RabbitMQ.

A couple of questions about doing it this way.  First, does publishing
a message require a roundtrip to the broker?  I dug around on the
topic and came to some part of the AMQP spec that indicates publishing
is a "cast", not a "call", so it seems like it shouldn't.  ACKs come
back asynchronously, so I'm assuming publishing is essentially a 0ms
operation, but I want to be sure.  Second, if the broker is throttling
via "TCP backpressure" (which I'm having a hard time finding a good
definition for) will that increase publisher latency?   I see that I
can set a socket timeout, but I think that only applies if the broker
is actually down.

Thanks!

 - Eric

From simon at rabbitmq.com  Tue Feb 21 17:58:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 21 Feb 2012 17:58:57 +0000
Subject: [rabbitmq-discuss] Ensuring low latency for publishers
In-Reply-To: <1e665e68-b239-44a0-aecd-af98dec19d1d@qs5g2000pbc.googlegroups.com>
References: <1e665e68-b239-44a0-aecd-af98dec19d1d@qs5g2000pbc.googlegroups.com>
Message-ID: <4F43DB61.2030304@rabbitmq.com>

On 21/02/12 17:51, Eric wrote:
 > First, does publishing
 > a message require a roundtrip to the broker?

No. Well, there are various ways you can force it to, but by default 
it's async.

 > so I'm assuming publishing is essentially a 0ms
 > operation

Well, you still have the one way network latency - or do you mean from 
the point of view of the client?

 > but I want to be sure.  Second, if the broker is throttling
 > via "TCP backpressure" (which I'm having a hard time finding a good
 > definition for) will that increase publisher latency?

Maybe we should call it TCP flow control? But yes, if your broker is out 
of memory, publishing will block until the broker is ready to read again.

Would you rather drop the message at this point?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware


From ejarendt at gmail.com  Tue Feb 21 18:11:43 2012
From: ejarendt at gmail.com (Eric)
Date: Tue, 21 Feb 2012 10:11:43 -0800 (PST)
Subject: [rabbitmq-discuss] Ensuring low latency for publishers
In-Reply-To: <4F43DB61.2030304@rabbitmq.com>
References: <1e665e68-b239-44a0-aecd-af98dec19d1d@qs5g2000pbc.googlegroups.com>
	<4F43DB61.2030304@rabbitmq.com>
Message-ID: <e105cb4d-f320-4c04-8068-9c58a068ea05@x6g2000pbk.googlegroups.com>

Thanks for the quick reply.

> No. Well, there are various ways you can force it to, but by default
> it's async.

Awesome!  Great that publishing is async.

> Well, you still have the one way network latency - or do you mean from
> the point of view of the client?

Right, sorry.  I mean ~0ms from the point of view of the client.  I
don't care too much about message latency from publisher to the
eventual consumer, just so long as the publisher doesn't experience
any delay.

> Maybe we should call it TCP flow control? But yes, if your broker is out
> of memory, publishing will block until the broker is ready to read again.
>
> Would you rather drop the message at this point?

"TCP flow control" got me to a helpful Wikipedia article much faster,
so maybe that's better.  :)  I would rather drop the message at that
point.  Ideally there'd be some timeout to specify there... if I've
been blocked for a few ms, it's time to give up.  But publisher
throttling is supposed to be transparent to the publisher, right?

On Feb 21, 9:58?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 21/02/12 17:51, Eric wrote:
> ?> First, does publishing
> ?> a message require a roundtrip to the broker?
>
> No. Well, there are various ways you can force it to, but by default
> it's async.
>
> ?> so I'm assuming publishing is essentially a 0ms
> ?> operation
>
> Well, you still have the one way network latency - or do you mean from
> the point of view of the client?
>
> ?> but I want to be sure. ?Second, if the broker is throttling
> ?> via "TCP backpressure" (which I'm having a hard time finding a good
> ?> definition for) will that increase publisher latency?
>
> Maybe we should call it TCP flow control? But yes, if your broker is out
> of memory, publishing will block until the broker is ready to read again.
>
> Would you rather drop the message at this point?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From steve at rabbitmq.com  Tue Feb 21 18:16:21 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 21 Feb 2012 18:16:21 +0000
Subject: [rabbitmq-discuss] Re trieving a message to the queue
In-Reply-To: <33357047.post@talk.nabble.com>
References: <33357047.post@talk.nabble.com>
Message-ID: <9A11FD64-3B78-4E05-8491-073A995BA51B@rabbitmq.com>

Bamboula,

I have to make lots of assumptions here...

Assuming you are using the dot-net client, and the SharedQueue class (probably
behind a QueueingBasicConsumer), you have the ability to Enqueue(Object o) to
the SharedQueue, which puts it on the other end.

I wouldn't recommend it, though, since the QueueingBasicConsumer is Enqueueing
things there, too (in response to the Broker delivering messages), so you have
no control over what order the resulting queue is in.

In any case, the SharedQueue is entirely local to the client, and this action
doesn't involve RabbitMQ at all -- so the messages have no
delivery/ACK/NACK/order/persistence/redelivery guarantees at all. Plus, if you
try to ACK them twice (which you might the second time they reach the front of
the queue), you will get an error.

The way to resurrect a message in the RabbitMQ queue, is to NACK it with
requeue=true. RabbitMQ will then redeliver it. If you have already Acknowledged
it, you cannot get RabbitMQ to redeliver it and instead you need to re-publish the
message, or arrange for some other action to be taken.

If you choose to republish or simply get RabbitMQ to re-deliver be aware that
you should understand how this affects message-order in your application, and
have a strategy for preventing a 'slow-loop', whereby a so-called "poison
message" is requeued over and over again, indefinitely.

Steve Powell  (a loopy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 20 Feb 2012, at 14:39, Bamboula wrote:

> 
> After using Dequeue() to my queue, I want to restore the retrieved message to
> the queue. Is this possible?
> 
> -- 
> View this message in context: http://old.nabble.com/Retrieving-a-message-to-the-queue-tp33357047p33357047.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Tue Feb 21 18:25:07 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 21 Feb 2012 18:25:07 +0000
Subject: [rabbitmq-discuss] STOMP Plugin: Alternative exchange other
	than amq.topic?
In-Reply-To: <CADSpLP9gb9R2ZbEJ1OntxedX0VqMX1c_9-cGTBdyo+a8NbWmNQ@mail.gmail.com>
References: <CADSpLP9gb9R2ZbEJ1OntxedX0VqMX1c_9-cGTBdyo+a8NbWmNQ@mail.gmail.com>
Message-ID: <5EE26AB5-AC20-479F-B304-8B7DC73D21BD@rabbitmq.com>

Hi Ken,

It is possible for you to SEND to the exchange of your choice from a STOMP
application, using a destination of the form: /exchange/<name>/<pattern> (see
http://www.rabbitmq.com/stomp.html#d.ed) and there is no reason why this
shouldn't be a topic exchange of your own making.

If you need to SUBSCRIBE to AMQP destinations you can use the destination
/amq/queue/<name> (but the queue must exist).

Between them, these should allow you to use STOMP with federated exchanges
without plugin modifications.

Let us know how you get on.

Steve Powell  (a federated bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 20 Feb 2012, at 16:19, Ken Simon wrote:

> Greetings,
> 
> I'm trying to get federation working (via the rabbitmq_federation
> plugin) in our environment of STOMP hosts, and to do so I have to
> enable federation in the STOMP plugin's exchange: amq.topic.  This
> unfortunately doesn't seem to work because amq.* exchanges are
> reserved and cannot be re-declared.
> 
> My solution at this point has been to edit the source of the STOMP
> plugin and point it at an exchange called "stomp_topic" (which I made
> up, but could be anything) instead of the default amq.topic.  Then I
> just configure the federation plugin to work with that exchange and it
> works fine.
> 
> My question is, is there a better way of doing this?  I hate
> maintaining my own downstream changes to plugins if I don't have to.
> The docs say that the STOMP plugin routes all messages through
> amq.topic, so it appears that's not configurable.  But wouldn't it
> make sense to allow use of an exchange that's not reserved?  Or am I
> missing something, and this is actually way easier?  I'm having
> trouble finding any documented cases of people using both STOMP and
> federation.
> 
> Thanks,
> 
> --
> Ken
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Tue Feb 21 18:29:23 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 21 Feb 2012 18:29:23 +0000
Subject: [rabbitmq-discuss] Re trieving a message to the queue
In-Reply-To: <9A11FD64-3B78-4E05-8491-073A995BA51B@rabbitmq.com>
References: <33357047.post@talk.nabble.com>
	<9A11FD64-3B78-4E05-8491-073A995BA51B@rabbitmq.com>
Message-ID: <225B3FE1-3CA1-45A8-84C9-1EE5991107F2@rabbitmq.com>

I see you asked this before...

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 21 Feb 2012, at 18:16, Steve Powell wrote:
> (lots)

From mpietrek at skytap.com  Tue Feb 21 18:49:02 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 21 Feb 2012 10:49:02 -0800
Subject: [rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
Message-ID: <CB69271E.2EDC1%mpietrek@skytap.com>

I've noticed a pattern here that seems to be consistently reproducible.

In our setup, we have three RabbitMQ 2.71 brokers in a cluster on Ubuntu
10.04. They're all mirroring the same set of queues, but that may or may not
be relevant here.

Starting from a healthy state (Management web console showing all brokers,
and all queues in sync), I simply run "rabbitmqctl stop_app" for one of the
nodes, followed by running "rabbitmqctl start_app" on the same node.

The expected results is that the one broker should drop out of the cluster,
then rejoin it. This is indeed what happens when I run against a broker that
does *not* have the stats database (as shown by the Web UI).

If I try this action on the node with the stats database, rabbitmqctl waits
forever and I have to ctrl-c out.  If I then try "rabbitmqctl stop", it
errors out, saying that the node is down.

The only way I can get the cluster back up is to shut down the other two
actively running nodes, then restart all three nodes.

Known issue? Something I'm overlooking? Searching online isn't turning up
anything obvious.

Thanks,

Matt



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120221/8f43f1a7/attachment.htm>

From james.poole at rsa.com  Tue Feb 21 18:54:56 2012
From: james.poole at rsa.com (james.poole at rsa.com)
Date: Tue, 21 Feb 2012 13:54:56 -0500
Subject: [rabbitmq-discuss] FIPS Compliance
Message-ID: <FC3463BECF39B74996BF6ADDCB9BE7D707F37425E5@MX36A.corp.emc.com>

Does anyone know of a RabbitMQ deployment that was FIPS compliant?  If so, I
am eager to hear how they accomplished this.

 

We've investigated replacing the crypto library in Erlang, but we don't
think this is going to be feasible.

 

Thanks!

James

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120221/3b562d78/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7449 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120221/3b562d78/attachment.bin>

From mpietrek at skytap.com  Tue Feb 21 19:04:16 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 21 Feb 2012 11:04:16 -0800
Subject: [rabbitmq-discuss] Correct way of determining which node is master?
Message-ID: <CB692AB0.2EDD5%mpietrek@skytap.com>

In a clustered scenario (3 brokers) with mirrored queues, what is the
correct way to determine which node is the "master" via inspection?

On approach would be to look at the list of queues and see which node is
hosting the queue (as opposed to slave_nodes). However, I'm unsure if
there's some scenario where queue 'A' is hosted by one broker, while queue
'B' is hosted by another.

Another approach is to go off of whichever node has the statistics database,
but I'm unsure if there's a 1:1 correlation there.

If I were to use some combination of rabbitmqctl or rabbitmqadmin commands,
what heuristic should I use?

Background info, in case it matters:

We're using keepalived to maintain a virtual IP that all clients connect to.
We'd obviously like keepalived to put the VIP on whatever node is the master
rather than on a slave node. Our understanding is that if the master has
messages that aren't in the slave node, a client that connects via the VIP
to the slave node and tries to read messages won't see them as they're only
on the master.

Thanks,

Matt


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120221/d2ce196b/attachment.htm>

From james.mcmahon at TASC.COM  Tue Feb 21 20:33:38 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Tue, 21 Feb 2012 20:33:38 +0000
Subject: [rabbitmq-discuss] Initiating queue monitoring,
 but returning to main method with indication of success
Message-ID: <C974010E949511448F6DC6F748F604D90FEB1959@TSEAMB01>

The rabbitMQ examples all show a use case where the receiver enters into a while( true ) loop that is only terminated when the coder hits Ctrl-C at the command line.

In my case, I call a method in a Listener class from a main java method in my primary class, Driver. As a result, control passes to callListener() in Listener.java and loops there endlessly waiting for messages it gets from the direct exchange. In my main() method of Driver.java, it makes a call right now like this:

callListener();

and inside my callListener method I implement similar to that that which was shown in the tutorials:

        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("localhost");
        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();

        channel.exchangeDeclare(EXCHANGE_NAME, "topic");
        String queueName = channel.queueDeclare().getQueue();

        for(String bindingKey : argv){
            channel.queueBind(queueName, EXCHANGE_NAME, bindingKey);
        }

        System.out.println(" [*] Waiting for messages. To exit press CTRL+C");

        QueueingConsumer consumer = new QueueingConsumer(channel);
        channel.basicConsume(queueName, true, consumer);

        while (true) {
            QueueingConsumer.Delivery delivery = consumer.nextDelivery();
            String message = new String(delivery.getBody());
            String routingKey = delivery.getEnvelope().getRoutingKey();

            // ...my other method calls to process the messages
        }

I lose program control at that point, because this does not return me to my main() in Driver, where I need to accomplish other actions while this listener is monitoring the queue. What I need is for that call to initiate the while loop and listen to the queue, and if it does so successfully return me to my calling program with some indication of success even as the while loop sits there listening to the queue for messages.

How can I implement this?

Thanks very much.

CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120221/b735f141/attachment.htm>

From simone.busoli at gmail.com  Tue Feb 21 21:18:04 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Tue, 21 Feb 2012 22:18:04 +0100
Subject: [rabbitmq-discuss] Passive queue declaration and channel closure
In-Reply-To: <73831E29-46BF-464A-A9B9-CA040F734011@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E520F1E82@GSVCLU04.ges.ferlan.it>
	<73831E29-46BF-464A-A9B9-CA040F734011@rabbitmq.com>
Message-ID: <CAOn7oW_QumnbXwHO-boNBU9DrXpMHmY+iYBBX8EXR5pWdLFP8Q@mail.gmail.com>

Thanks Steve, that's pretty much what Simon had already clarified, and I
agreed that changing this behavior is not practical.
On Feb 21, 2012 2:24 PM, "Steve Powell" <steve at rabbitmq.com> wrote:

> Simone,
>
> Replies in-line below..
>
> I don't think this is likely to change in the near future, since it
> would be disruptive to most clients that use this.
>
> Steve Powell  (a happy bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>
> On 16 Feb 2012, at 17:10, Busoli, Simone wrote:
>
> > Without relying on the management plugin I think the only way to do that
> is to
> > declare the queue as passive. At least with the .NET client and
> apparently the
> > Java client too, when the queue does not exist, besides throwing an
> exception,
> > the channel is closed as well. From the spec:
> >
> > If set, the server will reply with Declare-Ok if the queue already
> exists with
> > the same name, and raise an error if not. The client can use this to
> check
> > whether a queue exists without modifying the server state.
>
> The spec goes on to say:
>
>  The client MAY ask the server to assert that a queue exists without
> creating
>  the queue if not. If the queue does not exist, the server treats this as a
>  failure. Error code: not-found
>
> > There is no mention of channel closure, while the last sentence implies
> that
> > using the passive bit is indeed a way for a client to check queue
> existence, so
> > closing the channel when it doesn?t is a bit unexpected. That said, it?s
> not a
> > big deal to recreate the channel in such cases, but I?d appreciate your
> opinion.
> > Any chance this behavior can be changed in the client libraries?
>
> This is the mention of channel-closure -- an 'error' raised on the channel
> will
> close it.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120221/ed7b0dde/attachment.htm>

From jerryk at vmware.com  Wed Feb 22 03:24:43 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 21 Feb 2012 19:24:43 -0800 (PST)
Subject: [rabbitmq-discuss] Shovel config example with declare.queue
 with a x-ha-policy argument?
In-Reply-To: <25810258.2337.1328634270592.JavaMail.geo-discussion-forums@yqkz3>
References: <CAFDmHdNB=zFYWM+xxLhz3SG90ff4Yki2mOT=V=ZPdUnNNWxvhg@mail.gmail.com>
	<25810258.2337.1328634270592.JavaMail.geo-discussion-forums@yqkz3>
Message-ID: <33368593.post@talk.nabble.com>


Hi, Lance and Elias...

As you've surmised, the access_refused errors you're seeing are to be
expected when you try to declare an already existing queue or exchange
whose properties don't 100% match what you're now asking for.  To
avoid the problem, you'll need to make sure all of the easy fields in
the Shovel config's declaration of the queue are exactly equal and
then deal with the optional arguments list which requires a bit of
care to encode.

The arguments list can be a bit tricky since it ultimately gets passed
through to the RabbitMQ Erlang client under the covers and I'm not
sure we document how to properly populate the arguments list with the
appropriate structures and type annotations anywhere.

Here are a couple of examples corresponding to x-ha-policy settings of
"all" and "nodes".  In the case of the latter you also need a list of
nodes in the "x-ha-policy-params" argument.  The "nodes" example here
has a single node, but with a bit of care you can complete the pattern
using your own cluster's node names...  Snippets of the forms below
will replace the 'queue.declare' sections in your Shovel config:

Example 1:  "all" mirroring

        [{'queue.declare',
            [{queue, <<"backup_orders">>},
             durable,
             {arguments, [{<<"x-ha-policy">>,longstr,<<"all">>}]}]},

Example 2: specified "nodes" mirroring

        [{'queue.declare',
          [{queue, <<"backup_orders">>},
           durable,
           arguments, [{<<"x-ha-policy-params">>,
                        array,
                        [{longstr,<<"rabbit at StrongMad">>}]},
                        {<<"x-ha-policy">>,longstr,<<"nodes">>}]}}]},

The key thing to note in the "nodes" case is that the we encode the
node's names as Erlang binaries, wrap the binaries up in tuples with 
the atom-label longstr in first position, and then store them in a list,
tagged with the atom array.

While looking at this I also noticed that the "working shovel config"
example we refer to on our website probably isn't all that working
anymore due to the auto_ack and tx_size settings it contains.  I've
let the authors of that file (and the book in which it will appear)
know that things may have changed and that they might want to
sanity check it...

Best regards,
Jerry



Lance-9 wrote:
> 
> Hello all, I'm also looking for an example of Shovel with x-ha-policy.
>  Looks like I'm getting access_refused errors connecting to the
> destination
> queue because I'm missing this parameter.  Is this a supported
> configuration?
> 
> Thanks
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
-- 
View this message in context: http://old.nabble.com/Shovel-config-example-with-declare.queue-with-a-x-ha-policy-argument--tp33258095p33368593.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From rev.chip at gmail.com  Wed Feb 22 09:30:14 2012
From: rev.chip at gmail.com (Reverend Chip)
Date: Wed, 22 Feb 2012 01:30:14 -0800
Subject: [rabbitmq-discuss] [PATCH] rabbitmqadmin support for mirrored
	queues and alternate exchanges
Message-ID: <4F44B5A6.2080209@gmail.com>

The attached patch allows mirror= for queues and alternate= for exchanges.

Share & Enjoy
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: rabbitmq.arguments.diff
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120222/a41ed81f/attachment.asc>

From simon at rabbitmq.com  Wed Feb 22 09:58:27 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 Feb 2012 09:58:27 +0000
Subject: [rabbitmq-discuss] Correct way of determining which node is
	master?
In-Reply-To: <CB692AB0.2EDD5%mpietrek@skytap.com>
References: <CB692AB0.2EDD5%mpietrek@skytap.com>
Message-ID: <4F44BC43.7070701@rabbitmq.com>

On 21/02/12 19:04, Matt Pietrek wrote:
> In a clustered scenario (3 brokers) with mirrored queues, what is the
> correct way to determine which node is the "master" via inspection?

There isn't one. As in, there isn't really an overall master node.

> On approach would be to look at the list of queues and see which node is
> hosting the queue (as opposed to slave_nodes). However, I'm unsure if
> there's some scenario where queue 'A' is hosted by one broker, while
> queue 'B' is hosted by another.

Absolutely. The original master node *for a given queue* is the one that 
the client that first declared the queue was connected to. But then they 
can fail over to other nodes pretty arbitrarily.

> Another approach is to go off of whichever node has the statistics
> database, but I'm unsure if there's a 1:1 correlation there.

Again, this is the first node with mgmt to come up, or some other node 
at random in the case of failover.

> Background info, in case it matters:
>
> We're using keepalived to maintain a virtual IP that all clients connect
> to. We'd obviously like keepalived to put the VIP on whatever node is
> the master rather than on a slave node. Our understanding is that if the
> master has messages that aren't in the slave node, a client that
> connects via the VIP to the slave node and tries to read messages won't
> see them as they're only on the master.

No, that's not correct. Messages are *always* read from the master node 
(for a given queue).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Feb 22 11:42:16 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 Feb 2012 11:42:16 +0000
Subject: [rabbitmq-discuss] Initiating queue monitoring,
 but returning to main method with indication of success
In-Reply-To: <C974010E949511448F6DC6F748F604D90FEB1959@TSEAMB01>
References: <C974010E949511448F6DC6F748F604D90FEB1959@TSEAMB01>
Message-ID: <4F44D498.7060404@rabbitmq.com>

Hi James. You could either fire up a new thread, or (probably simpler) 
use a DefaultConsumer and override its handleDelivery() method rather 
than use QueueingConsumer.

Cheers, Simon

On 21/02/12 20:33, McMahon, James S (TASC) wrote:
> The rabbitMQ examples all show a use case where the receiver enters into
> a while( true ) loop that is only terminated when the coder hits Ctrl-C
> at the command line.
>
> In my case, I call a method in a Listener class from a main java method
> in my primary class, Driver. As a result, control passes to
> callListener() in Listener.java and loops there endlessly waiting for
> messages it gets from the direct exchange. In my main() method of
> Driver.java, it makes a call right now like this:
>
> callListener();
>
> and inside my callListener method I implement similar to that that which
> was shown in the tutorials:
>
> ConnectionFactory factory = new ConnectionFactory();
> factory.setHost("localhost");
> Connection connection = factory.newConnection();
> Channel channel = connection.createChannel();
>
> channel.exchangeDeclare(EXCHANGE_NAME, "topic");
> String queueName = channel.queueDeclare().getQueue();
>
> for(String bindingKey : argv){
> channel.queueBind(queueName, EXCHANGE_NAME, bindingKey);
> }
>
> System.out.println(" [*] Waiting for messages. To exit press CTRL+C");
>
> QueueingConsumer consumer = new QueueingConsumer(channel);
> channel.basicConsume(queueName, true, consumer);
>
> while (true) {
> QueueingConsumer.Delivery delivery = consumer.nextDelivery();
> String message = new String(delivery.getBody());
> String routingKey = delivery.getEnvelope().getRoutingKey();
>
> // ...my other method calls to process the messages
> }
>
> I lose program control at that point, because this does not return me to
> my main() in Driver, where I need to accomplish other actions while this
> listener is monitoring the queue. What I need is for that call to
> initiate the while loop and listen to the queue, and if it does so
> successfully return me to my calling program with some indication of
> success even as the while loop sits there listening to the queue for
> messages.
>
> How can I implement this?
>
> Thanks very much.
>
> CONFIDENTIALITY NOTICE: This message and any attachments or files
> transmitted with it (collectively, the "Message") are intended only for
> the addressee and may contain information that is privileged,
> proprietary and/or prohibited from disclosure by law or contract. If you
> are not the intended recipient: (a) please do not read, copy or
> retransmit the Message; (b) permanently delete and/or destroy all
> electronic and hard copies of the Message; (c) notify us by return
> email; and (d) you are hereby notified that any dissemination,
> distribution or copying of the Message is strictly prohibited.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Feb 22 11:45:10 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 Feb 2012 11:45:10 +0000
Subject: [rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
In-Reply-To: <CB69271E.2EDC1%mpietrek@skytap.com>
References: <CB69271E.2EDC1%mpietrek@skytap.com>
Message-ID: <4F44D546.200@rabbitmq.com>

On 21/02/12 18:49, Matt Pietrek wrote:
> If I try this action on the node with the stats database, rabbitmqctl
> waits forever and I have to ctrl-c out.  If I then try "rabbitmqctl
> stop", it errors out, saying that the node is down.

Hmm. Needless to say, this does not happen when I try it :(

Does anything show up in the logs on that node at this point?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Feb 22 12:00:39 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 Feb 2012 12:00:39 +0000
Subject: [rabbitmq-discuss] Initiating queue monitoring,
 but returning to main method with indication of success
In-Reply-To: <C974010E949511448F6DC6F748F604D90FEB1A06@TSEAMB01>
References: <C974010E949511448F6DC6F748F604D90FEB1959@TSEAMB01>,
	<4F44D498.7060404@rabbitmq.com>
	<C974010E949511448F6DC6F748F604D90FEB1A06@TSEAMB01>
Message-ID: <4F44D8E7.3050906@rabbitmq.com>

Please keep the mailing list CCed.

Rather than pass a QueueingConsumer to basicConsume() and pulling 
deliveries out of it with nextDelivery(), you can override 
handleDelivery() on DefaultConsumer to do whatever you need to to when 
receiving a message. The handleDelivery() callback will then get invoked 
in another thread, although this is invisible to you, so you don't need 
to enter any while loop.

Does this answer your question? It's not clear what is unclear to you :)

Cheers, Simon

On 22/02/12 11:52, McMahon, James S (TASC) wrote:
>       Thank you for the reply and guidance, Simon. Being new to rabbitMQ, I don't have an understanding of what you mean, though. Is there a link to an example or reference to which you can direct me?
>
>       Thanks again for your help.
>
> Jim
> ________________________________________
> From: Simon MacMullen [simon at rabbitmq.com]
> Sent: Wednesday, February 22, 2012 6:42 AM
> To: McMahon, James S (TASC)
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success
>
> Hi James. You could either fire up a new thread, or (probably simpler)
> use a DefaultConsumer and override its handleDelivery() method rather
> than use QueueingConsumer.
>
> Cheers, Simon
>
> On 21/02/12 20:33, McMahon, James S (TASC) wrote:
>> The rabbitMQ examples all show a use case where the receiver enters into
>> a while( true ) loop that is only terminated when the coder hits Ctrl-C
>> at the command line.
>>
>> In my case, I call a method in a Listener class from a main java method
>> in my primary class, Driver. As a result, control passes to
>> callListener() in Listener.java and loops there endlessly waiting for
>> messages it gets from the direct exchange. In my main() method of
>> Driver.java, it makes a call right now like this:
>>
>> callListener();
>>
>> and inside my callListener method I implement similar to that that which
>> was shown in the tutorials:
>>
>> ConnectionFactory factory = new ConnectionFactory();
>> factory.setHost("localhost");
>> Connection connection = factory.newConnection();
>> Channel channel = connection.createChannel();
>>
>> channel.exchangeDeclare(EXCHANGE_NAME, "topic");
>> String queueName = channel.queueDeclare().getQueue();
>>
>> for(String bindingKey : argv){
>> channel.queueBind(queueName, EXCHANGE_NAME, bindingKey);
>> }
>>
>> System.out.println(" [*] Waiting for messages. To exit press CTRL+C");
>>
>> QueueingConsumer consumer = new QueueingConsumer(channel);
>> channel.basicConsume(queueName, true, consumer);
>>
>> while (true) {
>> QueueingConsumer.Delivery delivery = consumer.nextDelivery();
>> String message = new String(delivery.getBody());
>> String routingKey = delivery.getEnvelope().getRoutingKey();
>>
>> // ...my other method calls to process the messages
>> }
>>
>> I lose program control at that point, because this does not return me to
>> my main() in Driver, where I need to accomplish other actions while this
>> listener is monitoring the queue. What I need is for that call to
>> initiate the while loop and listen to the queue, and if it does so
>> successfully return me to my calling program with some indication of
>> success even as the while loop sits there listening to the queue for
>> messages.
>>
>> How can I implement this?
>>
>> Thanks very much.
>>
>> CONFIDENTIALITY NOTICE: This message and any attachments or files
>> transmitted with it (collectively, the "Message") are intended only for
>> the addressee and may contain information that is privileged,
>> proprietary and/or prohibited from disclosure by law or contract. If you
>> are not the intended recipient: (a) please do not read, copy or
>> retransmit the Message; (b) permanently delete and/or destroy all
>> electronic and hard copies of the Message; (c) notify us by return
>> email; and (d) you are hereby notified that any dissemination,
>> distribution or copying of the Message is strictly prohibited.
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.


-- 
Simon MacMullen
RabbitMQ, VMware

From james.mcmahon at TASC.COM  Wed Feb 22 12:14:34 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Wed, 22 Feb 2012 12:14:34 +0000
Subject: [rabbitmq-discuss] Initiating queue monitoring,
 but returning to main method with indication of success
In-Reply-To: <4F44D8E7.3050906@rabbitmq.com>
References: <C974010E949511448F6DC6F748F604D90FEB1959@TSEAMB01>,
	<4F44D498.7060404@rabbitmq.com>
	<C974010E949511448F6DC6F748F604D90FEB1A06@TSEAMB01>,
	<4F44D8E7.3050906@rabbitmq.com>
Message-ID: <C974010E949511448F6DC6F748F604D90FEB1A14@TSEAMB01>

I apologize for omitting the mailing list. Am still learning the ropes of the forum. Will be sure to keep the mailing list on the cc line from now on.

I think this does answer my question. You hit the nail ont he head re: the source of my confusion: how would handleDelivery() substitute for the while() loop in this:

    while (true) {
      QueueingConsumer.Delivery delivery = consumer.nextDelivery();
      String message = new String(delivery.getBody());
      System.out.println(" [x] Received '" + message + "'");
    }

The source of my confusion is piecing this all together. Would I simply replace this

    QueueingConsumer consumer = new QueueingConsumer(channel);
    channel.basicConsume(QUEUE_NAME, true, consumer);

with something like the following?

    //strike the Queueingconsumer consumer.....
    
    boolean autoAck = false;
channel.basicConsume(ticket, queueName, autoAck,
     new DefaultConsumer(channel) {
         @Override
         public void handleDelivery(String consumerTag,
                                    Envelope envelope,
                                    AMQP.BasicProperties properties,
                                    byte[] body)
             throws IOException
         {
             String routingKey = envelope.getRoutingKey();
             String contentType = properties.contentType;
             long deliveryTag = envelope.getDeliveryTag();
             //
             // my custom handling stuff here
             //
             channel.basicAck(deliveryTag, false);
         }
     });

Does this get invoked every time a message arrives for my queue through the direct exchange?

What purpose does the   channel.basicAck(deliveryTag, false);    serve?

Thank you again for helping me to better understand how to work with this as I learn rabbitMQ, Simon.

Jim



________________________________________
From: Simon MacMullen [simon at rabbitmq.com]
Sent: Wednesday, February 22, 2012 7:00 AM
To: McMahon, James S (TASC)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success

Please keep the mailing list CCed.

Rather than pass a QueueingConsumer to basicConsume() and pulling
deliveries out of it with nextDelivery(), you can override
handleDelivery() on DefaultConsumer to do whatever you need to to when
receiving a message. The handleDelivery() callback will then get invoked
in another thread, although this is invisible to you, so you don't need
to enter any while loop.

Does this answer your question? It's not clear what is unclear to you :)

Cheers, Simon

On 22/02/12 11:52, McMahon, James S (TASC) wrote:
>       Thank you for the reply and guidance, Simon. Being new to rabbitMQ, I don't have an understanding of what you mean, though. Is there a link to an example or reference to which you can direct me?
>
>       Thanks again for your help.
>
> Jim
> ________________________________________
> From: Simon MacMullen [simon at rabbitmq.com]
> Sent: Wednesday, February 22, 2012 6:42 AM
> To: McMahon, James S (TASC)
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Initiating queue monitoring, but returning to main method with indication of success
>
> Hi James. You could either fire up a new thread, or (probably simpler)
> use a DefaultConsumer and override its handleDelivery() method rather
> than use QueueingConsumer.
>
> Cheers, Simon
>
> On 21/02/12 20:33, McMahon, James S (TASC) wrote:
>> The rabbitMQ examples all show a use case where the receiver enters into
>> a while( true ) loop that is only terminated when the coder hits Ctrl-C
>> at the command line.
>>
>> In my case, I call a method in a Listener class from a main java method
>> in my primary class, Driver. As a result, control passes to
>> callListener() in Listener.java and loops there endlessly waiting for
>> messages it gets from the direct exchange. In my main() method of
>> Driver.java, it makes a call right now like this:
>>
>> callListener();
>>
>> and inside my callListener method I implement similar to that that which
>> was shown in the tutorials:
>>
>> ConnectionFactory factory = new ConnectionFactory();
>> factory.setHost("localhost");
>> Connection connection = factory.newConnection();
>> Channel channel = connection.createChannel();
>>
>> channel.exchangeDeclare(EXCHANGE_NAME, "topic");
>> String queueName = channel.queueDeclare().getQueue();
>>
>> for(String bindingKey : argv){
>> channel.queueBind(queueName, EXCHANGE_NAME, bindingKey);
>> }
>>
>> System.out.println(" [*] Waiting for messages. To exit press CTRL+C");
>>
>> QueueingConsumer consumer = new QueueingConsumer(channel);
>> channel.basicConsume(queueName, true, consumer);
>>
>> while (true) {
>> QueueingConsumer.Delivery delivery = consumer.nextDelivery();
>> String message = new String(delivery.getBody());
>> String routingKey = delivery.getEnvelope().getRoutingKey();
>>
>> // ...my other method calls to process the messages
>> }
>>
>> I lose program control at that point, because this does not return me to
>> my main() in Driver, where I need to accomplish other actions while this
>> listener is monitoring the queue. What I need is for that call to
>> initiate the while loop and listen to the queue, and if it does so
>> successfully return me to my calling program with some indication of
>> success even as the while loop sits there listening to the queue for
>> messages.
>>
>> How can I implement this?
>>
>> Thanks very much.
>>
>> CONFIDENTIALITY NOTICE: This message and any attachments or files
>> transmitted with it (collectively, the "Message") are intended only for
>> the addressee and may contain information that is privileged,
>> proprietary and/or prohibited from disclosure by law or contract. If you
>> are not the intended recipient: (a) please do not read, copy or
>> retransmit the Message; (b) permanently delete and/or destroy all
>> electronic and hard copies of the Message; (c) notify us by return
>> email; and (d) you are hereby notified that any dissemination,
>> distribution or copying of the Message is strictly prohibited.
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.


--
Simon MacMullen
RabbitMQ, VMware

From lionel.cons at cern.ch  Wed Feb 22 12:24:19 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 22 Feb 2012 13:24:19 +0100
Subject: [rabbitmq-discuss] Unexpected behaviour with STOMP & NACK
Message-ID: <20120222131513.83a8.abe10f7e5afbbb3a79ce619739541149@cern.ch>

I get an unexpected behaviour with STOMP & NACK with RabbitMQ 2.7.1.

Here is my test, using an empty queue.
 - client1 connects, sends a message to the queue and disconnects
 - client2 connects, subscribes to the queue with ack:client
 - client2 receives the message (so far so good) but does not ack it
 - client3 connects, subscribes to the queue
 - client2 sends a NACK frame for the message
 - client2 receives the message once more
 - client3 receives nothing

I would have expected the other client (client3) to receive the
message that has not been consumed by client2. In fact, this is how
ActiveMQ and Apollo work.

FWIW, the STOMP 1.1 spec mentions:

 | NACK is the opposite of ACK. It is used to tell the server that the
 | client did not consume the message. The server can then either send
 | the message to a different client, discard it, or put it in a dead
 | letter queue. The exact behavior is server specific.

So, although the behavior is not strictly defined, re-sending the
message to the same client does not look appropriate to me.

What do you think?

Cheers,

Lionel

From simon at rabbitmq.com  Wed Feb 22 12:52:18 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 Feb 2012 12:52:18 +0000
Subject: [rabbitmq-discuss] Initiating queue monitoring,
 but returning to main method with indication of success
In-Reply-To: <C974010E949511448F6DC6F748F604D90FEB1A14@TSEAMB01>
References: <C974010E949511448F6DC6F748F604D90FEB1959@TSEAMB01>,
	<4F44D498.7060404@rabbitmq.com>
	<C974010E949511448F6DC6F748F604D90FEB1A06@TSEAMB01>,
	<4F44D8E7.3050906@rabbitmq.com>
	<C974010E949511448F6DC6F748F604D90FEB1A14@TSEAMB01>
Message-ID: <4F44E502.60607@rabbitmq.com>

On 22/02/12 12:14, McMahon, James S (TASC) wrote:
> The source of my confusion is piecing this all together. Would I
> simply replace this

<snip>

> with something like the following?

<snip>

Yes.

> Does this get invoked every time a message arrives for my queue
> through the direct exchange?

Yes.

> What purpose does the   channel.basicAck(deliveryTag, false);
> serve?

See the section under "Message Acknowledgement" at:

http://www.rabbitmq.com/tutorials/tutorial-two-java.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Feb 22 13:29:42 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 Feb 2012 13:29:42 +0000
Subject: [rabbitmq-discuss] rabbitmqadmin and ability to read
 configuration files
In-Reply-To: <CAMOXM29_=_r1fxF_b0fsiGT7qOwh-9WLszpsO3oJsgaAWM0u1w@mail.gmail.com>
References: <CAMOXM2-yT_ZSX4_FkJpnh=GFX4_QT8pLKt+j8pnnZF6QHp1BmA@mail.gmail.com>
	<4F33DFC9.60903@rabbitmq.com>
	<CAMOXM28oeg5E=7x1+dLrPdkt_r21_G1j=Nh8hX+X8i5yq60ZJA@mail.gmail.com>
	<4F393239.5000707@rabbitmq.com>
	<CAMOXM29HisUL=ERb6B1wgUv+6Hgh4jOuUL2a1b5gyHVrrrVeSw@mail.gmail.com>
	<4F423454.1040201@rabbitmq.com> <bw7aa4d4qbn.fsf@mail.cern.ch>
	<4F439CD2.7020401@rabbitmq.com>
	<CAMOXM29_=_r1fxF_b0fsiGT7qOwh-9WLszpsO3oJsgaAWM0u1w@mail.gmail.com>
Message-ID: <4F44EDC6.9010006@rabbitmq.com>

On 21/02/12 15:37, Massimo Paladin wrote:
> I believe now it is fine:

Thanks. That's now merged.

I renamed it to "declare_vhost" since I think that expresses the intent 
better - everything in that file is a default, after all...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From u2.storm at gmail.com  Wed Feb 22 16:13:56 2012
From: u2.storm at gmail.com (Artsiom)
Date: Wed, 22 Feb 2012 19:13:56 +0300
Subject: [rabbitmq-discuss] RabbitMQ crash after few hours
Message-ID: <4F451444.2040308@gmail.com>

Hello everybody.

I have RabbitMQ cluster across 4 machines. Then 2 machines were added to 
cluster.
Everything was ok, but after few hours of load three of them crashed 
almost simulteneously (according to log).
Besides at crash time memory consumption increased 3 times.

Log files from crashed machines:

(dell33) - machine 1
http://pastebin.com/A1rdBSkN

# rabbitmqctl cluster_status
Error: unable to connect to node wosnfs at dell33: nodedown
diagnostics:
- nodes and their ports on dell33: [{rabbitmqctl15567,47802},
                                     {rabbitmqctl15576,41488},
                                     {rabbitmqctl16776,44227},
                                     {rabbitmqctl16634,41524},
                                     {rabbitmqctl20944,36980},
                                     {rabbitmqctl20942,41667},
                                     {rabbitmqctl8262,44050}]
- current node: rabbitmqctl8262 at dell33
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: FwHV/NurYGNpetHE+jQlMQ==

(dell34) - machine 2
http://pastebin.com/36ihKNqv

# rabbitmqctl list_queues

/usr/lib/rabbitmq/bin/rabbitmq-env: fork: retry: Resource temporarily 
unavailable
/usr/lib/rabbitmq/bin/rabbitmq-env: fork: retry: Resource temporarily 
unavailable
/usr/lib/rabbitmq/bin/rabbitmq-env: fork: retry: Resource temporarily 
unavailable
/usr/lib/rabbitmq/bin/rabbitmq-env: fork: retry: Resource temporarily 
unavailable

(dell38) - machine 3
http://pastebin.com/TfWBcSus

Log file from one of survived machines:

(dell39) - machine 4
http://pastebin.com/ij1k4L9K

Above mentioned issue appeared on rabbitmq 2.6.1, but sometimes it 
appears on 2.7.1.
Queues, which names are in log (queue-batch-{3,4,5,6}), are durable with 
"x-ha-policy" property.
All rabbitmq brokers are clustered as disk nodes.

Could anybody help me to examine log files and find out the reason?

--
Best regards,
Artsiom
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120222/cca49afc/attachment.htm>

From simon at rabbitmq.com  Wed Feb 22 17:07:41 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 Feb 2012 17:07:41 +0000
Subject: [rabbitmq-discuss] RabbitMQ crash after few hours
In-Reply-To: <4F451444.2040308@gmail.com>
References: <4F451444.2040308@gmail.com>
Message-ID: <4F4520DD.6040302@rabbitmq.com>

On 22/02/12 16:13, Artsiom wrote:
> /usr/lib/rabbitmq/bin/rabbitmq-env: fork: retry: Resource temporarily
> unavailable

This implies that you're running into some OS-imposed limit on the 
number of (OS not Erlang) processes. When you do that, Bad Things are 
likely to happen.

I also see a bunch of errors along the lines of:

=ERROR REPORT==== 14-Feb-2012::20:51:30 ===
Mnesia(wosnfs at dell39): ** ERROR ** mnesia_event got 
{inconsistent_database, running_partitioned_network, wosnfs at dell33}

in machine 4's log, which is another bad sign - RabbitMQ clusters are 
not designed to tolerate network partitions.

I'll look into some of the other error messages that are showing up in 
your logs; it's possible some of then are real, but you have some bad 
things going on underneath RabbitMQ - you need to sort those out first,

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From u2.storm at gmail.com  Wed Feb 22 17:34:11 2012
From: u2.storm at gmail.com (Artsiom)
Date: Wed, 22 Feb 2012 20:34:11 +0300
Subject: [rabbitmq-discuss] RabbitMQ crash after few hours
In-Reply-To: <4F4520DD.6040302@rabbitmq.com>
References: <4F451444.2040308@gmail.com> <4F4520DD.6040302@rabbitmq.com>
Message-ID: <4F452713.6000007@gmail.com>

Thanks for reply.
/
/usr/lib/rabbitmq/bin/rabbitmq-env: fork: retry: Resource temporarily
unavailable
/
I've checked that no limit of processes was reached (over 300 proc. were 
running),
I was able to start new processes. May be there was a file lock on one 
of the (configuration?) files?
This error disappeared when local rabbitmq broker have become able to 
see other brokers.

Most of all I'm interested why 3 nodes crashed at once and why following 
message appeared:

     =ERROR REPORT==== 14-Feb-2012::19:13:47 ===
     ** Generic server <0.1093.0> terminating
     ** Last message in was {mnesia_locker,wosnfs at dell39,granted}
     ** When Server state == 5
     ** Reason for termination ==
     ** {unexpected_info,{mnesia_locker,wosnfs at dell39,granted}}

Following error messages may be the consuquece of this.
Look forward to results of your investigation.

P.S. better way to recover cluster is (to leave cluster if possible), 
clear mnesia on crashed nodes and rejoin them?

On 02/22/2012 08:07 PM, Simon MacMullen wrote:
> On 22/02/12 16:13, Artsiom wrote:
>> /usr/lib/rabbitmq/bin/rabbitmq-env: fork: retry: Resource temporarily
>> unavailable
>
> This implies that you're running into some OS-imposed limit on the 
> number of (OS not Erlang) processes. When you do that, Bad Things are 
> likely to happen.
>
> I also see a bunch of errors along the lines of:
>
> =ERROR REPORT==== 14-Feb-2012::20:51:30 ===
> Mnesia(wosnfs at dell39): ** ERROR ** mnesia_event got 
> {inconsistent_database, running_partitioned_network, wosnfs at dell33}
>
> in machine 4's log, which is another bad sign - RabbitMQ clusters are 
> not designed to tolerate network partitions.
>
> I'll look into some of the other error messages that are showing up in 
> your logs; it's possible some of then are real, but you have some bad 
> things going on underneath RabbitMQ - you need to sort those out first,
>
> Cheers, Simon
>
--
Best regards,
Artsiom
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120222/97d33609/attachment.htm>

From ejarendt at gmail.com  Wed Feb 22 17:44:54 2012
From: ejarendt at gmail.com (Eric)
Date: Wed, 22 Feb 2012 09:44:54 -0800 (PST)
Subject: [rabbitmq-discuss] Ensuring low latency for publishers
In-Reply-To: <e105cb4d-f320-4c04-8068-9c58a068ea05@x6g2000pbk.googlegroups.com>
References: <1e665e68-b239-44a0-aecd-af98dec19d1d@qs5g2000pbc.googlegroups.com>
	<4F43DB61.2030304@rabbitmq.com>
	<e105cb4d-f320-4c04-8068-9c58a068ea05@x6g2000pbk.googlegroups.com>
Message-ID: <7dc34cad-d8f9-4903-a72d-cb3dfc2a4749@o4g2000pbc.googlegroups.com>

I think I found my answer in another thread:
http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/dda41e9e8e089eaf/2c5995dc93a7a3df?lnk=gst&q=Memory+Management+Concerns+%2F+Questions#2c5995dc93a7a3df

In summary:  there's no way to know you're being throttled and no way
to timeout during a throttled publish.  That means that publishing
should be really fast! ...unless the broker's out of memory, and then
you'll be stuck waiting for an undefined amount of time.  That's a
really disappointing situation.

The solution proposed in that thread is to use a blocking queue with a
single publisher, which I threw out already due to worries about lock
contention.

On Feb 21, 10:11?am, Eric <ejare... at gmail.com> wrote:
> Thanks for the quick reply.
>
> > No. Well, there are various ways you can force it to, but by default
> > it's async.
>
> Awesome! ?Great that publishing is async.
>
> > Well, you still have the one way network latency - or do you mean from
> > the point of view of the client?
>
> Right, sorry. ?I mean ~0ms from the point of view of the client. ?I
> don't care too much about message latency from publisher to the
> eventual consumer, just so long as the publisher doesn't experience
> any delay.
>
> > Maybe we should call it TCP flow control? But yes, if your broker is out
> > of memory, publishing will block until the broker is ready to read again.
>
> > Would you rather drop the message at this point?
>
> "TCP flow control" got me to a helpful Wikipedia article much faster,
> so maybe that's better. ?:) ?I would rather drop the message at that
> point. ?Ideally there'd be some timeout to specify there... if I've
> been blocked for a few ms, it's time to give up. ?But publisher
> throttling is supposed to be transparent to the publisher, right?
>
> On Feb 21, 9:58?am, Simon MacMullen <si... at rabbitmq.com> wrote:
>
>
>
>
>
>
>
> > On 21/02/12 17:51, Eric wrote:
> > ?> First, does publishing
> > ?> a message require a roundtrip to the broker?
>
> > No. Well, there are various ways you can force it to, but by default
> > it's async.
>
> > ?> so I'm assuming publishing is essentially a 0ms
> > ?> operation
>
> > Well, you still have the one way network latency - or do you mean from
> > the point of view of the client?
>
> > ?> but I want to be sure. ?Second, if the broker is throttling
> > ?> via "TCP backpressure" (which I'm having a hard time finding a good
> > ?> definition for) will that increase publisher latency?
>
> > Maybe we should call it TCP flow control? But yes, if your broker is out
> > of memory, publishing will block until the broker is ready to read again.
>
> > Would you rather drop the message at this point?
>
> > Cheers, Simon
>
> > --
> > Simon MacMullen
> > RabbitMQ, VMware
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ejarendt at gmail.com  Wed Feb 22 17:48:58 2012
From: ejarendt at gmail.com (Eric)
Date: Wed, 22 Feb 2012 09:48:58 -0800 (PST)
Subject: [rabbitmq-discuss] Ensuring low latency for publishers
In-Reply-To: <7dc34cad-d8f9-4903-a72d-cb3dfc2a4749@o4g2000pbc.googlegroups.com>
References: <1e665e68-b239-44a0-aecd-af98dec19d1d@qs5g2000pbc.googlegroups.com>
	<4F43DB61.2030304@rabbitmq.com>
	<e105cb4d-f320-4c04-8068-9c58a068ea05@x6g2000pbk.googlegroups.com>
	<7dc34cad-d8f9-4903-a72d-cb3dfc2a4749@o4g2000pbc.googlegroups.com>
Message-ID: <4f4690a9-038d-4fdb-bce1-ae8c246a3247@ub4g2000pbc.googlegroups.com>

Is it possible to configure the broker to never page to disk so that
it never throttles?  Basically, when it hits its high watermark for
memory can it just drop inbound messages?

On Feb 22, 9:44?am, Eric <ejare... at gmail.com> wrote:
> I think I found my answer in another thread:http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/...
>
> In summary: ?there's no way to know you're being throttled and no way
> to timeout during a throttled publish. ?That means that publishing
> should be really fast! ...unless the broker's out of memory, and then
> you'll be stuck waiting for an undefined amount of time. ?That's a
> really disappointing situation.
>
> The solution proposed in that thread is to use a blocking queue with a
> single publisher, which I threw out already due to worries about lock
> contention.
>
> On Feb 21, 10:11?am, Eric <ejare... at gmail.com> wrote:
>
>
>
>
>
>
>
> > Thanks for the quick reply.
>
> > > No. Well, there are various ways you can force it to, but by default
> > > it's async.
>
> > Awesome! ?Great that publishing is async.
>
> > > Well, you still have the one way network latency - or do you mean from
> > > the point of view of the client?
>
> > Right, sorry. ?I mean ~0ms from the point of view of the client. ?I
> > don't care too much about message latency from publisher to the
> > eventual consumer, just so long as the publisher doesn't experience
> > any delay.
>
> > > Maybe we should call it TCP flow control? But yes, if your broker is out
> > > of memory, publishing will block until the broker is ready to read again.
>
> > > Would you rather drop the message at this point?
>
> > "TCP flow control" got me to a helpful Wikipedia article much faster,
> > so maybe that's better. ?:) ?I would rather drop the message at that
> > point. ?Ideally there'd be some timeout to specify there... if I've
> > been blocked for a few ms, it's time to give up. ?But publisher
> > throttling is supposed to be transparent to the publisher, right?
>
> > On Feb 21, 9:58?am, Simon MacMullen <si... at rabbitmq.com> wrote:
>
> > > On 21/02/12 17:51, Eric wrote:
> > > ?> First, does publishing
> > > ?> a message require a roundtrip to the broker?
>
> > > No. Well, there are various ways you can force it to, but by default
> > > it's async.
>
> > > ?> so I'm assuming publishing is essentially a 0ms
> > > ?> operation
>
> > > Well, you still have the one way network latency - or do you mean from
> > > the point of view of the client?
>
> > > ?> but I want to be sure. ?Second, if the broker is throttling
> > > ?> via "TCP backpressure" (which I'm having a hard time finding a good
> > > ?> definition for) will that increase publisher latency?
>
> > > Maybe we should call it TCP flow control? But yes, if your broker is out
> > > of memory, publishing will block until the broker is ready to read again.
>
> > > Would you rather drop the message at this point?
>
> > > Cheers, Simon
>
> > > --
> > > Simon MacMullen
> > > RabbitMQ, VMware
>
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Wed Feb 22 17:52:07 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 22 Feb 2012 17:52:07 +0000
Subject: [rabbitmq-discuss] Ensuring low latency for publishers
In-Reply-To: <4f4690a9-038d-4fdb-bce1-ae8c246a3247@ub4g2000pbc.googlegroups.com>
References: <1e665e68-b239-44a0-aecd-af98dec19d1d@qs5g2000pbc.googlegroups.com>
	<4F43DB61.2030304@rabbitmq.com>
	<e105cb4d-f320-4c04-8068-9c58a068ea05@x6g2000pbk.googlegroups.com>
	<7dc34cad-d8f9-4903-a72d-cb3dfc2a4749@o4g2000pbc.googlegroups.com>
	<4f4690a9-038d-4fdb-bce1-ae8c246a3247@ub4g2000pbc.googlegroups.com>
Message-ID: <20120222175207.GA29288@wellquite.org>

On Wed, Feb 22, 2012 at 09:48:58AM -0800, Eric wrote:
> Is it possible to configure the broker to never page to disk so that
> it never throttles?  Basically, when it hits its high watermark for
> memory can it just drop inbound messages?

Nope.

Matthew

From mpietrek at skytap.com  Wed Feb 22 18:39:04 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 22 Feb 2012 10:39:04 -0800
Subject: [rabbitmq-discuss] Correct way of determining which node is
	master?
In-Reply-To: <4F44BC43.7070701@rabbitmq.com>
References: <CB692AB0.2EDD5%mpietrek@skytap.com>
	<4F44BC43.7070701@rabbitmq.com>
Message-ID: <CACLE7iwZ0L8fd8Ke=xzBtGdQX8weMvhnhRGp4q3pT1M8LAm_+Q@mail.gmail.com>

| Messages are *always* read from the master node (for a given queue).

This is very helpful. Going a step further, is it true to say that in a
cluster where we mirror all queues, there's really no benefit to assigning
the VIP to one node over another?

Matt


On Wed, Feb 22, 2012 at 1:58 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 21/02/12 19:04, Matt Pietrek wrote:
>
>> In a clustered scenario (3 brokers) with mirrored queues, what is the
>> correct way to determine which node is the "master" via inspection?
>>
>
> There isn't one. As in, there isn't really an overall master node.
>
>
>  On approach would be to look at the list of queues and see which node is
>> hosting the queue (as opposed to slave_nodes). However, I'm unsure if
>> there's some scenario where queue 'A' is hosted by one broker, while
>> queue 'B' is hosted by another.
>>
>
> Absolutely. The original master node *for a given queue* is the one that
> the client that first declared the queue was connected to. But then they
> can fail over to other nodes pretty arbitrarily.
>
>
>  Another approach is to go off of whichever node has the statistics
>> database, but I'm unsure if there's a 1:1 correlation there.
>>
>
> Again, this is the first node with mgmt to come up, or some other node at
> random in the case of failover.
>
>
>  Background info, in case it matters:
>>
>> We're using keepalived to maintain a virtual IP that all clients connect
>> to. We'd obviously like keepalived to put the VIP on whatever node is
>> the master rather than on a slave node. Our understanding is that if the
>> master has messages that aren't in the slave node, a client that
>> connects via the VIP to the slave node and tries to read messages won't
>> see them as they're only on the master.
>>
>
> No, that's not correct. Messages are *always* read from the master node
> (for a given queue).
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120222/8fda9491/attachment.htm>

From mpietrek at skytap.com  Wed Feb 22 18:40:10 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 22 Feb 2012 10:40:10 -0800
Subject: [rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
In-Reply-To: <4F44D546.200@rabbitmq.com>
References: <CB69271E.2EDC1%mpietrek@skytap.com>
	<4F44D546.200@rabbitmq.com>
Message-ID: <CACLE7iwXrRpgqZeiMr7yJ=CJ6EjP1wYEU=Z+M+tKesu9=x86CA@mail.gmail.com>

Unfortunately, I don't see anything in the logs. I'll try again. Is there
anything I can do on my end to gather more information?

Matt

On Wed, Feb 22, 2012 at 3:45 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 21/02/12 18:49, Matt Pietrek wrote:
>
>> If I try this action on the node with the stats database, rabbitmqctl
>> waits forever and I have to ctrl-c out.  If I then try "rabbitmqctl
>> stop", it errors out, saying that the node is down.
>>
>
> Hmm. Needless to say, this does not happen when I try it :(
>
> Does anything show up in the logs on that node at this point?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120222/50a3f215/attachment.htm>

From kbaltrinic at bericotechnologies.com  Wed Feb 22 20:04:50 2012
From: kbaltrinic at bericotechnologies.com (Ken Baltrinic)
Date: Wed, 22 Feb 2012 12:04:50 -0800 (PST)
Subject: [rabbitmq-discuss] timestamp basic property looses milliseconds?
Message-ID: <7ee00ad0-3ee2-49a6-8ee5-b217e929078a@ge5g2000vbb.googlegroups.com>

We are attempting to use the amqp basic property "timestamp" via the
RabbitMQ java client (see code below) to record the point in time when
the message gets sent.  However, we are finding that when a message is
pulled from the bus, the timestamp property of the retrieve message
has had its milliseconds component dropped.  We are using rabbitmq
2.7.1 with erlang R15B.  Is this a bug or by design? Other than using
our own headers, is there a better way to do this?  We would love it
if Rabbit itself would provide this timestamp as it would eliminate
issues with client clocks not being in sync.

        BasicProperties props = new BasicProperties.Builder()
        	.messageId(UUID.randomUUID().toString())
        	.correlationId(UUID.randomUUID().toString())
        	.type("test.event")
        	.replyTo("replyto_routingkey")
            .timestamp(new Date(2930830427321L))
            .headers(headers)
            .build();

Thereafter do a basicPublish and basicGet() and compare sent and
received timestamps.  They differ by 321 mills.


From matthew at rabbitmq.com  Wed Feb 22 20:10:05 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 22 Feb 2012 20:10:05 +0000
Subject: [rabbitmq-discuss] Correct way of determining which node is
 master?
In-Reply-To: <CACLE7iwZ0L8fd8Ke=xzBtGdQX8weMvhnhRGp4q3pT1M8LAm_+Q@mail.gmail.com>
References: <CB692AB0.2EDD5%mpietrek@skytap.com>
	<4F44BC43.7070701@rabbitmq.com>
	<CACLE7iwZ0L8fd8Ke=xzBtGdQX8weMvhnhRGp4q3pT1M8LAm_+Q@mail.gmail.com>
Message-ID: <20120222201004.GB29288@wellquite.org>

On Wed, Feb 22, 2012 at 10:39:04AM -0800, Matt Pietrek wrote:
> | Messages are *always* read from the master node (for a given queue).
> 
> This is very helpful. Going a step further, is it true to say that in a
> cluster where we mirror all queues, there's really no benefit to assigning
> the VIP to one node over another?

Correct, though for performance reasons you might like to ensure the
masters are roughly uniformly spread over all the nodes.

Matthew

From rev.chip at gmail.com  Wed Feb 22 20:12:50 2012
From: rev.chip at gmail.com (Reverend Chip)
Date: Wed, 22 Feb 2012 12:12:50 -0800
Subject: [rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory on
	slave nodes
Message-ID: <4F454C42.4080400@gmail.com>

I have a four-node 2.7.1 cluster.  I just started experimenting with
mirrored queues.  One queue is mirrored across nodes 1&2, a second queue
is mirrored across nodes 3&4.  I've been feeding a lot of large messages
through, using delivery-mode 2.  Most of the messages I've purged, since
the reader process can't keep up yet.

Here's the problem: Memory usage.  Nodes 1 & 3, presumably the master
nodes for the queues, have maintained a normal memory profile, 3-6GB. 
But nodes 2 & 4, the presumable slaves, have had their memory grow to
58GB each.  Worse, when I purged and then even deleted the queues, the
memory usage did not go down.  It seems I may have to reboot these nodes
to get the memory back, and obviously I can't use mirrored queues if
they're going to make my nodes do this, which is disappointing.  I do
have a workaround involving alternate exchanges, but the workaround can
leave data stranded if a node is lost forever.

Is there any other info I can provide to help diagnose and/or fix this?


From hcoyote at ghostar.org  Wed Feb 22 21:58:22 2012
From: hcoyote at ghostar.org (Travis)
Date: Wed, 22 Feb 2012 15:58:22 -0600
Subject: [rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory
 on slave nodes
In-Reply-To: <4F454C42.4080400@gmail.com>
References: <4F454C42.4080400@gmail.com>
Message-ID: <CAChq9g3Bh4=mm3qask6SiingrnyjFU9DdWpPhWBAYJyYb6+Vdg@mail.gmail.com>

On Wed, Feb 22, 2012 at 2:12 PM, Reverend Chip <rev.chip at gmail.com> wrote:
> I have a four-node 2.7.1 cluster. ?I just started experimenting with
> mirrored queues. ?One queue is mirrored across nodes 1&2, a second queue
> is mirrored across nodes 3&4. ?I've been feeding a lot of large messages
> through, using delivery-mode 2. ?Most of the messages I've purged, since
> the reader process can't keep up yet.
>
> Here's the problem: Memory usage. ?Nodes 1 & 3, presumably the master
> nodes for the queues, have maintained a normal memory profile, 3-6GB.
> But nodes 2 & 4, the presumable slaves, have had their memory grow to
> 58GB each. ?Worse, when I purged and then even deleted the queues, the
> memory usage did not go down. ?It seems I may have to reboot these nodes
> to get the memory back, and obviously I can't use mirrored queues if
> they're going to make my nodes do this, which is disappointing. ?I do
> have a workaround involving alternate exchanges, but the workaround can
> leave data stranded if a node is lost forever.
>
> Is there any other info I can provide to help diagnose and/or fix this?

I think we're experiencing the same thing.  Previously, we were seeing
a memory leak in 2.6.1 which was patched[1] in subsequent releases.
Since then, we've upgraded to 2.7.1 as well and we're seeing slowly
growing memory usage on our slaves that requires us to restart the
slaves periodically to keep the memory usage down.

In our case, we're using only two nodes with mirrored queues.

Travis

[1] this patch http://hg.rabbitmq.com/rabbitmq-server/rev/89315378597d
fixed our memory leak in 2.6.1.  worked great when we applied just the
patch to 2.6.1.  it has to be something different in 2.7.1 causing
this new memory leak though.


-- 
Travis Campbell
travis at ghostar.org

From mpietrek at skytap.com  Wed Feb 22 23:05:56 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 22 Feb 2012 15:05:56 -0800
Subject: [rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
In-Reply-To: <CACLE7iwXrRpgqZeiMr7yJ=CJ6EjP1wYEU=Z+M+tKesu9=x86CA@mail.gmail.com>
References: <CB69271E.2EDC1%mpietrek@skytap.com> <4F44D546.200@rabbitmq.com>
	<CACLE7iwXrRpgqZeiMr7yJ=CJ6EjP1wYEU=Z+M+tKesu9=x86CA@mail.gmail.com>
Message-ID: <CACLE7ixq2WEZxiCyWrWfoXBC=UMRRvg0Y9yW33ru4Atsf4R5uw@mail.gmail.com>

I was able to just now repro this again. Because of some layers of
scripting, it turns out it's not hanging up when running rabbitmq-server.
Rather, it's hanging up when running "rabbitmqctl wait <pidfile>"

The output from rabbitmqctl when run on any node is:

Waiting for rabbit at play ...   << Where 'play' is the node that's
restarting>>
pid is 21925 ...                     << Where the PID value is different
depending on which node it's run>>


The last few lines of the event log for the 'play' node:


=INFO REPORT==== 22-Feb-2012::14:52:08 ===
Stopping Rabbit

=INFO REPORT==== 22-Feb-2012::14:52:08 ===
    application: rabbitmq_management
    exited: stopped
    type: permanent

=INFO REPORT==== 22-Feb-2012::14:52:08 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: permanent

=INFO REPORT==== 22-Feb-2012::14:52:08 ===
stopped TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 22-Feb-2012::14:52:08 ===
    application: rabbit
    exited: stopped
    type: permanent

=INFO REPORT==== 22-Feb-2012::14:52:08 ===
    application: os_mon
    exited: stopped
    type: permanent

=INFO REPORT==== 22-Feb-2012::14:52:08 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 22-Feb-2012::14:52:08 ===
Halting Erlang VM

=INFO REPORT==== 22-Feb-2012::14:52:13 ===
Limiting to approx 924 file handles (829 sockets)



On Wed, Feb 22, 2012 at 10:40 AM, Matt Pietrek <mpietrek at skytap.com> wrote:

> Unfortunately, I don't see anything in the logs. I'll try again. Is there
> anything I can do on my end to gather more information?
>
> Matt
>
>
> On Wed, Feb 22, 2012 at 3:45 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 21/02/12 18:49, Matt Pietrek wrote:
>>
>>> If I try this action on the node with the stats database, rabbitmqctl
>>> waits forever and I have to ctrl-c out.  If I then try "rabbitmqctl
>>> stop", it errors out, saying that the node is down.
>>>
>>
>> Hmm. Needless to say, this does not happen when I try it :(
>>
>> Does anything show up in the logs on that node at this point?
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120222/ea755ab7/attachment.htm>

From hcoyote at ghostar.org  Wed Feb 22 23:24:34 2012
From: hcoyote at ghostar.org (Travis)
Date: Wed, 22 Feb 2012 17:24:34 -0600
Subject: [rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory
 on slave nodes
In-Reply-To: <CAChq9g3Bh4=mm3qask6SiingrnyjFU9DdWpPhWBAYJyYb6+Vdg@mail.gmail.com>
References: <4F454C42.4080400@gmail.com>
	<CAChq9g3Bh4=mm3qask6SiingrnyjFU9DdWpPhWBAYJyYb6+Vdg@mail.gmail.com>
Message-ID: <CAChq9g3=AWMD0kMioxML4i0Kj3Q_WJPaYgCw36Vm+UfVBZP8Rw@mail.gmail.com>

On Wed, Feb 22, 2012 at 3:58 PM, Travis <hcoyote at ghostar.org> wrote:
>
> I think we're experiencing the same thing. ?Previously, we were seeing
> a memory leak in 2.6.1 which was patched[1] in subsequent releases.
> Since then, we've upgraded to 2.7.1 as well and we're seeing slowly
> growing memory usage on our slaves that requires us to restart the
> slaves periodically to keep the memory usage down.
>
> In our case, we're using only two nodes with mirrored queues.
>

Also, just to show how bad the problem is, I've uploaded (to imgur) a
graph of the memory utilization to for the slave over the last few
weeks.

http://i.imgur.com/dBNO8.png

We currently set the vm highwater mark to 10% (which ends up being
2.4GB of ram available to the system).

As you can see, we had flat memory utilization up until about week 5.
There's a small dip (where we turned things off for abit to upgrade
from 2.6.1 (with the previously mentioned patch) to 2.7.1.  After
that, memory has grown pretty steadily.  The points where it has going
almost down to zero usage after that was right after restarts of the
rabbitmq-server on this node.

Travis
-- 
Travis Campbell
travis at ghostar.org

From mpietrek at skytap.com  Thu Feb 23 00:30:03 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 22 Feb 2012 16:30:03 -0800
Subject: [rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
In-Reply-To: <CACLE7ixq2WEZxiCyWrWfoXBC=UMRRvg0Y9yW33ru4Atsf4R5uw@mail.gmail.com>
References: <CB69271E.2EDC1%mpietrek@skytap.com> <4F44D546.200@rabbitmq.com>
	<CACLE7iwXrRpgqZeiMr7yJ=CJ6EjP1wYEU=Z+M+tKesu9=x86CA@mail.gmail.com>
	<CACLE7ixq2WEZxiCyWrWfoXBC=UMRRvg0Y9yW33ru4Atsf4R5uw@mail.gmail.com>
Message-ID: <CACLE7iwV0+k6d__8kUG3KCNi4UsSJ6NaP412mgn8v9gTiZD2Mg@mail.gmail.com>

Let me add some additional information, and re-summarize what I'm seeing.

In our startup script for RabbitMQ we do the following;

rabbitmq-server -detached
rabbitmqctl status
<Extract the PID from rabbitmqctl status, write to our PIDFILE>
rabbitmqctl wait PIDFILE

On shutdown, we do:

rabbitmqctl stop PIDFILE
rm PIDFILE

In normal circumstances, this works just fine hundreds of times in a row.
However as mentioned earlier in the thread, sometimes when restarting the
node that had a stats database, the "rabbitmqctl wait" hangs.

Thanks,

Mat


On Wed, Feb 22, 2012 at 3:05 PM, Matt Pietrek <mpietrek at skytap.com> wrote:

> I was able to just now repro this again. Because of some layers of
> scripting, it turns out it's not hanging up when running rabbitmq-server.
> Rather, it's hanging up when running "rabbitmqctl wait <pidfile>"
>
> The output from rabbitmqctl when run on any node is:
>
> Waiting for rabbit at play ...   << Where 'play' is the node that's
> restarting>>
> pid is 21925 ...                     << Where the PID value is different
> depending on which node it's run>>
>
>
> The last few lines of the event log for the 'play' node:
>
>
> =INFO REPORT==== 22-Feb-2012::14:52:08 ===
> Stopping Rabbit
>
> =INFO REPORT==== 22-Feb-2012::14:52:08 ===
>     application: rabbitmq_management
>     exited: stopped
>     type: permanent
>
> =INFO REPORT==== 22-Feb-2012::14:52:08 ===
>     application: rabbitmq_management_agent
>     exited: stopped
>     type: permanent
>
> =INFO REPORT==== 22-Feb-2012::14:52:08 ===
> stopped TCP Listener on 0.0.0.0:5672
>
> =INFO REPORT==== 22-Feb-2012::14:52:08 ===
>     application: rabbit
>     exited: stopped
>     type: permanent
>
> =INFO REPORT==== 22-Feb-2012::14:52:08 ===
>     application: os_mon
>     exited: stopped
>     type: permanent
>
> =INFO REPORT==== 22-Feb-2012::14:52:08 ===
>     application: mnesia
>     exited: stopped
>     type: permanent
>
> =INFO REPORT==== 22-Feb-2012::14:52:08 ===
> Halting Erlang VM
>
> =INFO REPORT==== 22-Feb-2012::14:52:13 ===
> Limiting to approx 924 file handles (829 sockets)
>
>
>
>
> On Wed, Feb 22, 2012 at 10:40 AM, Matt Pietrek <mpietrek at skytap.com>wrote:
>
>> Unfortunately, I don't see anything in the logs. I'll try again. Is there
>> anything I can do on my end to gather more information?
>>
>> Matt
>>
>>
>> On Wed, Feb 22, 2012 at 3:45 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>>
>>> On 21/02/12 18:49, Matt Pietrek wrote:
>>>
>>>> If I try this action on the node with the stats database, rabbitmqctl
>>>> waits forever and I have to ctrl-c out.  If I then try "rabbitmqctl
>>>> stop", it errors out, saying that the node is down.
>>>>
>>>
>>> Hmm. Needless to say, this does not happen when I try it :(
>>>
>>> Does anything show up in the logs on that node at this point?
>>>
>>> Cheers, Simon
>>>
>>> --
>>> Simon MacMullen
>>> RabbitMQ, VMware
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120222/75ee78a8/attachment.htm>

From alistair at abayley.org  Thu Feb 23 02:47:21 2012
From: alistair at abayley.org (Alistair Bayley)
Date: Thu, 23 Feb 2012 15:47:21 +1300
Subject: [rabbitmq-discuss] [help] [beginner] server stops sending messages;
 publish (in transaction) hangs on commit
Message-ID: <CAKYODbhUWBDy4KJQJO7OW2aRnw9LYkerLiNN8kG8=NAnO8FgPQ@mail.gmail.com>

Hello,

I'm looking for ways to debug a rabbitmq server that has been running
since 2010-02-01. Sometime in the last 2 days it stopped delivering
messages. I've seen this happen before, and restarting fixes it, but
I'd like to get to the bottom of why it stops delivering messages, so
I'd prefer to run tests while it is still in this state.

We're using the python amqplib client. The various versions are:

$ uname -srvmpio
Linux 2.6.32-37-generic-pae #81-Ubuntu SMP Fri Dec 2 22:24:22 UTC 2011
i686 unknown unknown GNU/Linux

$ sudo rabbitmqctl report
Reporting server status on {{2012,2,23},{2,18,37}}

Status of node 'rabbit at rabbitmq1' ...
[{pid,11649},
 {running_applications,[{rabbit,"RabbitMQ","2.7.1"},
                        {os_mon,"CPO  CXC 138 46","2.2.4"},
                        {sasl,"SASL  CXC 138 11","2.1.8"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.12"},
                        {stdlib,"ERTS  CXC 138 10","1.16.4"},
                        {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R13B03 (erts-5.7.4) [source] [rq:1]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,107054896},
          {processes,72060236},
          {processes_used,72055268},
          {system,34994660},
          {atom,736077},
          {atom_used,727538},
          {binary,15125896},
          {code,6063325},
          {ets,10643172}]},
 {vm_memory_high_watermark,0.3999999992195367},
 {vm_memory_limit,102503219}]
...


Python 2.6.5
python-amqplib 0.6.1-1


I've used this python test program:
#----------------------------------------------
"""
To setup for this test you must say (on rabbitmq1):
sudo rabbitmqctl add_user scheduler scheduler
sudo rabbitmqctl add_vhost /test
sudo rabbitmqctl set_permissions -p /test scheduler ".*" ".*" ".*"
"""
from amqplib import client_0_8 as amqp

conn = amqp.Connection(host="rabbitmq1:5672", userid="scheduler",
password="scheduler", virtual_host="/test", insist=False)
chan = conn.channel()
chan.queue_declare("alistair_test_q", durable=True, auto_delete=False)
chan.exchange_declare("alistair_test_ex", type="direct", durable=True,
auto_delete=False)
chan.queue_bind("alistair_test_q", "alistair_test_ex", routing_key="alistair")

msg = amqp.Message("test", delivery_mode=2)
print "tx_select"
chan.tx_select()
print "send message"
chan.basic_publish(msg, "alistair_test_ex", "alistair")
print "tx_commit"
chan.tx_commit()
#----------------------------------------------


It hangs on the chan.tx_commit().

tcpdump shows this (pruned summary, 172.22.2.53 is the client,
172.22.2.50 is the rabbitmq server):

23	0.047038	172.22.2.53	172.22.2.50	AMQP	Tx.Select
24	0.047369	172.22.2.50	172.22.2.53	AMQP	Tx.Select-Ok
25	0.047607	172.22.2.53	172.22.2.50	AMQP	Basic.Publish
26	0.086293	172.22.2.50	172.22.2.53	TCP	amqp > 34000 [ACK] Seq=365
Ack=385 Win=6864 Len=0 TSV=951060977 TSER=951060626
27	0.086469	172.22.2.53	172.22.2.50	AMQP	Content-Header Content-Body Tx.Commit
28	0.126293	172.22.2.50	172.22.2.53	TCP	amqp > 34000 [ACK] Seq=365
Ack=432 Win=6864 Len=0 TSV=951060987 TSER=951060636

You can see the client Tx.Commit (and it gets an ACK) but no
Tx.Commit-Ok comes back from the server. The client hangs here until I
ctrl-C it.

$ sudo rabbitmqctl list_queues -p /test name messages
Listing queues ...
alistair_test_q 0
...done.


A good session on a different broker shows this (again pruned,
172.22.3.2 is client, 172.22.3.3 is rabbitmq):

23	0.051783	172.22.3.2	172.22.3.3	AMQP	Tx.Select
24	0.052205	172.22.3.3	172.22.3.2	AMQP	Tx.Select-Ok
25	0.052517	172.22.3.2	172.22.3.3	AMQP	Basic.Publish
26	0.090882	172.22.3.3	172.22.3.2	TCP	amqp > 45215 [ACK] Seq=365
Ack=385 Win=6864 Len=0 TSV=2487670438 TSER=2160225287
27	0.091095	172.22.3.2	172.22.3.3	AMQP	Content-Header Content-Body Tx.Commit
28	0.091288	172.22.3.3	172.22.3.2	TCP	amqp > 45215 [ACK] Seq=365
Ack=432 Win=6864 Len=0 TSV=2487670438 TSER=2160225297
29	0.097365	172.22.3.3	172.22.3.2	AMQP	Tx.Commit-Ok
30	0.097703	172.22.3.2	172.22.3.3	AMQP	Tx.Select
31	0.097926	172.22.3.3	172.22.3.2	AMQP	Tx.Select-Ok
32	0.098190	172.22.3.2	172.22.3.3	AMQP	Basic.Get
33	0.098900	172.22.3.3	172.22.3.2	AMQP	Basic.Get-Ok Content-Header Content-Body
34	0.099780	172.22.3.2	172.22.3.3	AMQP	Tx.Commit
35	0.100436	172.22.3.3	172.22.3.2	AMQP	Tx.Commit-Ok

$ sudo rabbitmqctl list_queues -p /test name messages
Listing queues ...
alistair_test_q 1
...done.


What else can I do to figure out what is wrong? Is there a way to get
more verbose logging without restarting the server? Are there some
other tools that'll help with debugging this?

Thanks,
Alistair

From Marek.Cermak at Honeywell.com  Thu Feb 23 09:51:39 2012
From: Marek.Cermak at Honeywell.com (Cermak, Marek)
Date: Thu, 23 Feb 2012 09:51:39 +0000
Subject: [rabbitmq-discuss] Message presence notification
Message-ID: <F1A539826FC33E4CA602BB52E5C450220F88C3A5@FR44EX3004.global.ds.honeywell.com>

Hello everybody,
in our scenario we use two different connections to rabbitmq server - one is using a slow and permanently open link the second is very fast but opens only on demand and should be closed once it is not in use.
These two connection we want to use for consuming messages from many (tens, hundreds) queues in the following way

1.       open the connection on a slow link and "watch" the queues;

2.       once there is a message in one of the watched queues, the client receives a notification (no message) from rabbit;

3.       client opens the fast link, consumes available messages from queues and closes  the link;

4.       back to #2.

How can we achieve this with AMQP (0.9.1 or 1.0) ? Can we do it with no RabbitMQ protocol extension?
I was thinking about channel.basicQoS(0) but what would I get in that case?

Thank you for your help.
Marek

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120223/488e3fa4/attachment.htm>

From denis.melique at morpho.com  Thu Feb 23 10:56:56 2012
From: denis.melique at morpho.com (MELIQUE Denis (MORPHO))
Date: Thu, 23 Feb 2012 11:56:56 +0100
Subject: [rabbitmq-discuss] Understanding Federation
Message-ID: <C3481B5CE3E61E438EEF6143B51DC17F652F5A11E5@Y000IIIV01.rd1.rf1>

I'm doing some testing with federation plug-in to try to understand it.

I have set a little test bed with 2 brokers. One (2.7.1) running on Windows XP, the other (2.6.1) running on RedHat 6.
I have set some producer and consumers, which seem to work fine.

But I'd like to get some explanation about Exchanges and Queues that I see in the RabbitMQ Management.

I Have one federated exchange declared on both brokers.

Here is my rabbit.config file for the windows side, on linux it's the same except connection and host:
[
{rabbitmq_federation,
    [ {exchanges, [[{exchange,     "federation.forward"},
                    {virtual_host, "/"},
                    {type,         "topic"},
                    {durable,      true},
                    {auto_delete,  false},
                    {internal,     false},
                    {upstream_set, "common-upstream"}]
                  ]},
      {upstream_sets, [{"common-upstream", [[{connection, "linux-host"},
                                          {max_hops,   1}]
                                        ]}
                      ]},
      {connections, [{"linux-host", [{host,            "linux-host"},
                                          {protocol,        "amqp"},
                                          {port,            5672},
                                          {virtual_host,    "/"},
                                          {username,        "guest"},
                                          {password,        "guest"},
                                          {mechanism,       default},
                                          {prefetch_count,  1000},
                                          {reconnect_delay, 5},
                                          {heartbeat,       1},
                                          {queue_expires,   30000},
                                          {message_ttl,     10000}
                                         ]}
                    ]},
      {local_username, "guest"},
      {local_nodename, "win-host"}
    ]
}
].


When I start the brokers, I can see additional exchanges and Queues on  both part.
But they are not the symmetric.
On the Windows side :
                Additional Exchanges
                               federation.forward, x-federation (OK for this one that's what I excpected)
federation: federation.forward -> linux-host B , fanaout, D, AD, I

And additional Queue:
federation: federation.forward -> linux-host, TTL,D

On the Linux Side:
                Additional Exchanges
federation.forward, x-federation (OK for this one that's what I excpected)
federation: federation.forward -> win-host B, fanout, D, AD,I
And additional Queue:
federation: federation.forward -> win-host, TTL,D


What are these Exchange and Queues used for ?
Are they reserved for federation internal use ?
When do messages go into these queues ?
Do they have to be durable or is there a way to configure them as transient ?

I would be very interested by  a brief description of how federation works internally.

Thank you
Cheers
Denis

#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120223/38bb00d9/attachment.htm>

From simon at rabbitmq.com  Thu Feb 23 11:10:43 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 23 Feb 2012 11:10:43 +0000
Subject: [rabbitmq-discuss] Understanding Federation
In-Reply-To: <C3481B5CE3E61E438EEF6143B51DC17F652F5A11E5@Y000IIIV01.rd1.rf1>
References: <C3481B5CE3E61E438EEF6143B51DC17F652F5A11E5@Y000IIIV01.rd1.rf1>
Message-ID: <4F461EB3.3000503@rabbitmq.com>

On 23/02/12 10:56, MELIQUE Denis (MORPHO) wrote:
> I?m doing some testing with federation plug-in to try to understand it.

Cool!

<snip>

> What are these Exchange and Queues used for ?

The queue is there to buffer messages that are published to the upstream 
exchange and have not yet been consumed from the downstream exchange.

It is bound to the internal exchange with the union of all the bindings 
that are in use downstream, so we only transfer messages that are going 
to be of use downstream.

The internal exchange is there so that whenever we (re)establish a 
federation link we can set up an exact set of bindings 
mostly-atomically, by creating a new internal exchange, creating all the 
bindings to it, then binding it to the upstream exchange.

> Are they reserved for federation internal use ?

Yes.

> When do messages go into these queues ?

As mentioned, the bindings are pushed upstream so messages from upstream 
go into these queues if they will be routed once they get downstream.

> Do they have to be durable or is there a way to configure them as
> transient ?

At the moment they have to be durable. Is this a problem? The idea is 
that you can set the queue TTL if you do not want them to hang around 
forever.

> I would be very interested by a brief description of how federation
> works internally.

Hopefully this answers your question.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Thu Feb 23 11:12:36 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 23 Feb 2012 11:12:36 +0000
Subject: [rabbitmq-discuss] timestamp basic property looses milliseconds?
In-Reply-To: <7ee00ad0-3ee2-49a6-8ee5-b217e929078a@ge5g2000vbb.googlegroups.com>
References: <7ee00ad0-3ee2-49a6-8ee5-b217e929078a@ge5g2000vbb.googlegroups.com>
Message-ID: <CABzX+qy_0GttnW0atPSrYbmuuNsxEGEQX7kLi_i=Dojtz72VLA@mail.gmail.com>

On Wed, Feb 22, 2012 at 20:04, Ken Baltrinic
<kbaltrinic at bericotechnologies.com> wrote:
> We are attempting to use the amqp basic property "timestamp" via the
> RabbitMQ java client (see code below) to record the point in time when
> the message gets sent. ?However, we are finding that when a message is
> pulled from the bus, the timestamp property of the retrieve message
> has had its milliseconds component dropped. ?We are using rabbitmq
> 2.7.1 with erlang R15B. ?Is this a bug or by design? Other than using
> our own headers, is there a better way to do this? ?We would love it
> if Rabbit itself would provide this timestamp as it would eliminate
> issues with client clocks not being in sync.

AMQP spec says:

> 4.2.5.4 Timestamps
> Time stamps are held in the 64-bit POSIX time_t format with an
> accuracy of one second. By using 64 bits we avoid future wraparound
> issues associated with 31-bit and 32-bit time_t values.

So, as far as you're using the built-in timestamp field, it will be
rounded to a second. Sorry.

Marek

From majek04 at gmail.com  Thu Feb 23 11:15:11 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 23 Feb 2012 11:15:11 +0000
Subject: [rabbitmq-discuss] timestamp basic property looses milliseconds?
In-Reply-To: <CABzX+qy_0GttnW0atPSrYbmuuNsxEGEQX7kLi_i=Dojtz72VLA@mail.gmail.com>
References: <7ee00ad0-3ee2-49a6-8ee5-b217e929078a@ge5g2000vbb.googlegroups.com>
	<CABzX+qy_0GttnW0atPSrYbmuuNsxEGEQX7kLi_i=Dojtz72VLA@mail.gmail.com>
Message-ID: <CABzX+qyBWtEk=T9x2ZjEpKnGx+msuqeJrC+dWMGJ97ekKpZHzw@mail.gmail.com>

On Thu, Feb 23, 2012 at 11:12, Marek Majkowski <majek04 at gmail.com> wrote:
> On Wed, Feb 22, 2012 at 20:04, Ken Baltrinic
> <kbaltrinic at bericotechnologies.com> wrote:
>> We are attempting to use the amqp basic property "timestamp" via the
>> RabbitMQ java client (see code below) to record the point in time when
>> the message gets sent. ?However, we are finding that when a message is
>> pulled from the bus, the timestamp property of the retrieve message
>> has had its milliseconds component dropped. ?We are using rabbitmq
>> 2.7.1 with erlang R15B. ?Is this a bug or by design? Other than using
>> our own headers, is there a better way to do this? ?We would love it
>> if Rabbit itself would provide this timestamp as it would eliminate
>> issues with client clocks not being in sync.
>
> AMQP spec says:
>
>> 4.2.5.4 Timestamps
>> Time stamps are held in the 64-bit POSIX time_t format with an
>> accuracy of one second. By using 64 bits we avoid future wraparound
>> issues associated with 31-bit and 32-bit time_t values.
>
> So, as far as you're using the built-in timestamp field, it will be
> rounded to a second. Sorry.

Of course nothing is topping you from sending a custom header
with an arbitrary data type (float, string or long long). That way
you could send the timestamp data in any format you wish.

Marek

From simon at rabbitmq.com  Thu Feb 23 11:15:32 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 23 Feb 2012 11:15:32 +0000
Subject: [rabbitmq-discuss] Understanding Federation
In-Reply-To: <4F461EB3.3000503@rabbitmq.com>
References: <C3481B5CE3E61E438EEF6143B51DC17F652F5A11E5@Y000IIIV01.rd1.rf1>
	<4F461EB3.3000503@rabbitmq.com>
Message-ID: <4F461FD4.20202@rabbitmq.com>

On 23/02/12 11:10, Simon MacMullen wrote:
> The queue is there to buffer messages that are published to the upstream
> exchange and have not yet been consumed from the downstream exchange.

Sorry, this is clumsily phrased. I could say:

...have not yet been consumed *by* the downstream exchange, which 
consumes messages from the upstream queue and then publishes them to 
itself for routing to local queues.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Thu Feb 23 11:21:16 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 23 Feb 2012 11:21:16 +0000
Subject: [rabbitmq-discuss] Message presence notification
In-Reply-To: <F1A539826FC33E4CA602BB52E5C450220F88C3A5@FR44EX3004.global.ds.honeywell.com>
References: <F1A539826FC33E4CA602BB52E5C450220F88C3A5@FR44EX3004.global.ds.honeywell.com>
Message-ID: <CABzX+qz+ydRXsAkcNDsPOh5s50ubcRiQFxPktdJkSbjnnykbyQ@mail.gmail.com>

On Thu, Feb 23, 2012 at 09:51, Cermak, Marek <Marek.Cermak at honeywell.com> wrote:
> in our scenario we use two different connections to rabbitmq server ? one is
> using a slow and permanently open link the second is very fast but opens
> only on demand and should be closed once it is not in use.
>
> These two connection we want to use for consuming messages from many (tens,
> hundreds) queues in the following way
>
> 1.?????? open the connection on a slow link and "watch" the queues;
>
> 2.?????? once there is a message in one of the watched queues, the client
> receives a notification (no message) from rabbit;
>
> 3.?????? client opens the fast link, consumes available messages from queues
> and closes? the link;
>
> 4.?????? back to #2.
>
> How can we achieve this with AMQP (0.9.1 or 1.0) ? Can we do it with no
> RabbitMQ protocol extension?

Why not just send two messages? One to a real queue, and another
one, with no payload, to a queue called 'notifications'.

In this case, whenever there is a new message coming to 'notifications' queue,
the consumer will know that there should be another, big, message in some
other queue.

Does it make sense?

> I was thinking about channel.basicQoS(0) but what would I get in that case?

Spec says:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos

> May be set to zero, meaning "no specific limit", although other
> prefetch limits may still apply.

Cheers,
    Marek

From simon at rabbitmq.com  Thu Feb 23 11:22:35 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 23 Feb 2012 11:22:35 +0000
Subject: [rabbitmq-discuss] Message presence notification
In-Reply-To: <F1A539826FC33E4CA602BB52E5C450220F88C3A5@FR44EX3004.global.ds.honeywell.com>
References: <F1A539826FC33E4CA602BB52E5C450220F88C3A5@FR44EX3004.global.ds.honeywell.com>
Message-ID: <4F46217B.7030504@rabbitmq.com>

Hmm, interesting situation.

basic.qos(0) means "no limit" and RabbitMQ will push all the messages at 
you. Unlikely to be what you want.

I don't think there's a completely beautiful answer to your question. 
You could:

a) Have the slow link poll with (passive?) queue.declare()s. The 
declare-ok you get back will tell you the number of messages in the 
queue at the time the declare was received.

b) Do the same, but using HTTP to the management plugin. You have to use 
another protocol, which is a pain, but you can poll a ton of queues with 
one request, so that may be useful.

c) Have the slow link consume with qos(1) and acks. Every time it gets a 
message, it cancels its consumer and rejects the message (with 
requeue=true). Then the fast link fires up, does its consuming, shuts 
down again, then the slow link starts its consumer again. The bad news 
is that the first message always gets its requeued flag set. The good 
news is, no polling.

Cheers, Simon

On 23/02/12 09:51, Cermak, Marek wrote:
> Hello everybody,
>
> in our scenario we use two different connections to rabbitmq server ?
> one is using a slow and permanently open link the second is very fast
> but opens only on demand and should be closed once it is not in use.
>
> These two connection we want to use for consuming messages from many
> (tens, hundreds) queues in the following way
>
> 1.open the connection on a slow link and "watch" the queues;
>
> 2.once there is a message in one of the watched queues, the client
> receives a notification (no message) from rabbit;
>
> 3.client opens the fast link, consumes available messages from queues
> and closes the link;
>
> 4.back to #2.
>
> How can we achieve this with AMQP (0.9.1 or 1.0) ? Can we do it with no
> RabbitMQ protocol extension?
>
> I was thinking about channel.basicQoS(0) but what would I get in that case?
>
> Thank you for your help.
>
> Marek
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Thu Feb 23 11:34:50 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 23 Feb 2012 11:34:50 +0000
Subject: [rabbitmq-discuss] [help] [beginner] server stops sending
 messages; publish (in transaction) hangs on commit
In-Reply-To: <CAKYODbhUWBDy4KJQJO7OW2aRnw9LYkerLiNN8kG8=NAnO8FgPQ@mail.gmail.com>
References: <CAKYODbhUWBDy4KJQJO7OW2aRnw9LYkerLiNN8kG8=NAnO8FgPQ@mail.gmail.com>
Message-ID: <CABzX+qwJhotUDEshpfDJKyQKkXWv+uOci+fgY8m1RoX7R-UHXQ@mail.gmail.com>

On Thu, Feb 23, 2012 at 02:47, Alistair Bayley <alistair at abayley.org> wrote:
> I'm looking for ways to debug a rabbitmq server that has been running
> since 2010-02-01. Sometime in the last 2 days it stopped delivering
> messages. I've seen this happen before, and restarting fixes it, but
> I'd like to get to the bottom of why it stops delivering messages, so
> I'd prefer to run tests while it is still in this state.
>
> We're using the python amqplib client. The various versions are:
>
> $ uname -srvmpio
> Linux 2.6.32-37-generic-pae #81-Ubuntu SMP Fri Dec 2 22:24:22 UTC 2011
> i686 unknown unknown GNU/Linux
>
> $ sudo rabbitmqctl report
> Reporting server status on {{2012,2,23},{2,18,37}}
>
> Status of node 'rabbit at rabbitmq1' ...
> [{pid,11649},
> ?{running_applications,[{rabbit,"RabbitMQ","2.7.1"},
> ? ? ? ? ? ? ? ? ? ? ? ?{os_mon,"CPO ?CXC 138 46","2.2.4"},
> ? ? ? ? ? ? ? ? ? ? ? ?{sasl,"SASL ?CXC 138 11","2.1.8"},
> ? ? ? ? ? ? ? ? ? ? ? ?{mnesia,"MNESIA ?CXC 138 12","4.4.12"},
> ? ? ? ? ? ? ? ? ? ? ? ?{stdlib,"ERTS ?CXC 138 10","1.16.4"},
> ? ? ? ? ? ? ? ? ? ? ? ?{kernel,"ERTS ?CXC 138 10","2.13.4"}]},
> ?{os,{unix,linux}},
> ?{erlang_version,"Erlang R13B03 (erts-5.7.4) [source] [rq:1]
> [async-threads:30] [hipe] [kernel-poll:true]\n"},
> ?{memory,[{total,107054896},
> ? ? ? ? ?{processes,72060236},
> ? ? ? ? ?{processes_used,72055268},
> ? ? ? ? ?{system,34994660},
> ? ? ? ? ?{atom,736077},
> ? ? ? ? ?{atom_used,727538},
> ? ? ? ? ?{binary,15125896},
> ? ? ? ? ?{code,6063325},
> ? ? ? ? ?{ets,10643172}]},
> ?{vm_memory_high_watermark,0.3999999992195367},
> ?{vm_memory_limit,102503219}]

Hi,

You seem to have quite a small amount of RAM - 100MiB, right?

Do logs show high memory watermark being set?

If so: rabbitmq tries not to go above a memory limit.
When rabbit hits memory limit it stops consuming messages -
all connections that produce messages will be stopped.
The connection won't be touched until some memory is freed.

But in setups where total memory is small, RabbitMQ may
enter a state of just being above memory watermark and not
being able to free anything. This may be happening to you.

Cheers,
   Marek

From simon at rabbitmq.com  Thu Feb 23 11:52:17 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 23 Feb 2012 11:52:17 +0000
Subject: [rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
In-Reply-To: <CACLE7iwV0+k6d__8kUG3KCNi4UsSJ6NaP412mgn8v9gTiZD2Mg@mail.gmail.com>
References: <CB69271E.2EDC1%mpietrek@skytap.com>	<4F44D546.200@rabbitmq.com>	<CACLE7iwXrRpgqZeiMr7yJ=CJ6EjP1wYEU=Z+M+tKesu9=x86CA@mail.gmail.com>	<CACLE7ixq2WEZxiCyWrWfoXBC=UMRRvg0Y9yW33ru4Atsf4R5uw@mail.gmail.com>
	<CACLE7iwV0+k6d__8kUG3KCNi4UsSJ6NaP412mgn8v9gTiZD2Mg@mail.gmail.com>
Message-ID: <4F462871.4070602@rabbitmq.com>

I *think* the stats database is a red herring. You say this happens when 
restarting?

On 23/02/12 00:30, Matt Pietrek wrote:
> Let me add some additional information, and re-summarize what I'm seeing.
>
> In our startup script for RabbitMQ we do the following;
>
> rabbitmq-server -detached
> rabbitmqctl status
> <Extract the PID from rabbitmqctl status, write to our PIDFILE>

There's a potential race here if an old server is running (maybe about 
to shut down?). rabbitmqctl status could pick up the old pid.

> rabbitmqctl wait PIDFILE

However, rabbitmqctl wait should then detect that the pid has died and 
fail. Unless the pid gets reused by the OS but that is presumably unlikely.

But rabbitmqctl wait will wait indefinitely as long as the pid is alive 
and not a fully functional rabbit node. So I'd check two things:

1) You should fix that race, it can be done safely:

Do not use rabbitmq-server -detached and rabbitmqctl status to get the 
pid. Instead set RABBITMQ_PID_FILE and background the rabbitmq-server 
script. You will then *definitely* get the right pid since the script 
writes its own pid then execs - no race possible.

2) Capture the stdout of rabbitmq-server when you start it - if 
rabbitmqctl wait still hangs, see how far it's got / what it's doing.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From sonali.abhonkar at atos.net  Thu Feb 23 11:56:21 2012
From: sonali.abhonkar at atos.net (Abhonkar, Sonali)
Date: Thu, 23 Feb 2012 17:26:21 +0530
Subject: [rabbitmq-discuss] Regarding C++
Message-ID: <CEE0C758004FF3408989AAB1547146060279315E@inicx002.in.int.atosorigin.com>

Hi,

 

First time I am working on messaging. So I am not able to do it using
rabbitMQ.

My aim is to write a code in C++, to transfer message   "Hi World" to
other machine using RabbitMQ. 

Can you please help me in this.

 

Thanks & Regards,

Sonali.

 



This e-mail and the documents attached are confidential and intended solely for the addressee; it may also be privileged. If you receive this e-mail in error, please notify the sender immediately and destroy it. As its integrity cannot be secured on the Internet, the Atos group liability cannot be triggered for the message content. Although the sender endeavors to maintain a computer virus-free network, the sender does not warrant that this transmission is virus-free and will not be liable for any damages resulting from any virus transmitted.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120223/e73191db/attachment.htm>

From simon at rabbitmq.com  Thu Feb 23 12:01:18 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 23 Feb 2012 12:01:18 +0000
Subject: [rabbitmq-discuss] [help] [beginner] server stops sending
 messages; publish (in transaction) hangs on commit
In-Reply-To: <CABzX+qwJhotUDEshpfDJKyQKkXWv+uOci+fgY8m1RoX7R-UHXQ@mail.gmail.com>
References: <CAKYODbhUWBDy4KJQJO7OW2aRnw9LYkerLiNN8kG8=NAnO8FgPQ@mail.gmail.com>
	<CABzX+qwJhotUDEshpfDJKyQKkXWv+uOci+fgY8m1RoX7R-UHXQ@mail.gmail.com>
Message-ID: <4F462A8E.3080509@rabbitmq.com>

On 23/02/12 11:34, Marek Majkowski wrote:
> You seem to have quite a small amount of RAM - 100MiB, right?
>
> Do logs show high memory watermark being set?

More to the point, the OP's "rabbitmqctl report" output shows memory use 
above the watermark. So yes...

> If so: rabbitmq tries not to go above a memory limit.
> When rabbit hits memory limit it stops consuming messages -

As in, it will block on message publish. In tx mode that equates to a 
commit.

> all connections that produce messages will be stopped.
> The connection won't be touched until some memory is freed.
>
> But in setups where total memory is small, RabbitMQ may
> enter a state of just being above memory watermark and not
> being able to free anything. This may be happening to you.

...and you can set vm_memory_high_watermark higher to work around this. 
See http://www.rabbitmq.com/memory.html.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Feb 23 12:09:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 23 Feb 2012 12:09:36 +0000
Subject: [rabbitmq-discuss] Ensuring low latency for publishers
In-Reply-To: <20120222175207.GA29288@wellquite.org>
References: <1e665e68-b239-44a0-aecd-af98dec19d1d@qs5g2000pbc.googlegroups.com>	<4F43DB61.2030304@rabbitmq.com>	<e105cb4d-f320-4c04-8068-9c58a068ea05@x6g2000pbk.googlegroups.com>	<7dc34cad-d8f9-4903-a72d-cb3dfc2a4749@o4g2000pbc.googlegroups.com>	<4f4690a9-038d-4fdb-bce1-ae8c246a3247@ub4g2000pbc.googlegroups.com>
	<20120222175207.GA29288@wellquite.org>
Message-ID: <4F462C80.4080108@rabbitmq.com>

On 22/02/12 17:52, Matthew Sackman wrote:
>> >  Is it possible to configure the broker to never page to disk so that
>> >  it never throttles?  Basically, when it hits its high watermark for
>> >  memory can it just drop inbound messages?
> Nope.

I find myself wondering whether some such feature may be useful though. 
At the moment Rabbit is concerned with never throwing anything away, how 
many people would find it useful to drop messages when the server is busy?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Marek.Cermak at Honeywell.com  Thu Feb 23 12:15:19 2012
From: Marek.Cermak at Honeywell.com (Cermak, Marek)
Date: Thu, 23 Feb 2012 12:15:19 +0000
Subject: [rabbitmq-discuss] Message presence notification
In-Reply-To: <CABzX+qz+ydRXsAkcNDsPOh5s50ubcRiQFxPktdJkSbjnnykbyQ@mail.gmail.com>
References: <F1A539826FC33E4CA602BB52E5C450220F88C3A5@FR44EX3004.global.ds.honeywell.com>
	<CABzX+qz+ydRXsAkcNDsPOh5s50ubcRiQFxPktdJkSbjnnykbyQ@mail.gmail.com>
Message-ID: <F1A539826FC33E4CA602BB52E5C450220F88D475@FR44EX3004.global.ds.honeywell.com>

Hello Marek,

> -----Original Message-----
> From: Marek Majkowski [mailto:majek04 at gmail.com]
> Sent: Thursday, February 23, 2012 12:21
> Subject: Re: [rabbitmq-discuss] Message presence notification
> 
> On Thu, Feb 23, 2012 at 09:51, Cermak, Marek 
> <Marek.Cermak at honeywell.com>
> wrote:
> > in our scenario we use two different connections to rabbitmq server 
> > ? one is using a slow and permanently open link the second is very 
> > fast but opens only on demand and should be closed once it is not in use.
> >
> > These two connection we want to use for consuming messages from many 
> > (tens,
> > hundreds) queues in the following way
> >
> > 1.       open the connection on a slow link and "watch" the queues;
> >
> > 2.       once there is a message in one of the watched queues, the 
> > client receives a notification (no message) from rabbit;
> >
> > 3.       client opens the fast link, consumes available messages 
> > from queues and closes  the link;
> >
> > 4.       back to #2.
> >
> > How can we achieve this with AMQP (0.9.1 or 1.0) ? Can we do it with 
> > no RabbitMQ protocol extension?
> 
> Why not just send two messages? One to a real queue, and another one, 
> with no payload, to a queue called 'notifications'.
> 
> In this case, whenever there is a new message coming to 'notifications'
> queue, the consumer will know that there should be another, big, 
> message in some other queue.
> 
> Does it make sense?
> 

It indeed does, but it would be useful in case there is only one producer (or not many of them). We can have lot of producers and that would bring tons of messages in notification queue (in the worst case one for every message in the 'real' queue). 
Another issue would be sending of such notification messages since producers are not willing to be changed ;-)


> > I was thinking about channel.basicQoS(0) but what would I get in that case?
> 
> Spec says:
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos
> 
> > May be set to zero, meaning "no specific limit", although other 
> > prefetch limits may still apply.
> 

True, you're right.


> Cheers,
>     Marek

Thanks.

Regards
Marek

From mikeb at rabbitmq.com  Thu Feb 23 12:15:34 2012
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 23 Feb 2012 12:15:34 +0000
Subject: [rabbitmq-discuss] Ensuring low latency for publishers
In-Reply-To: <4F462C80.4080108@rabbitmq.com>
References: <1e665e68-b239-44a0-aecd-af98dec19d1d@qs5g2000pbc.googlegroups.com>	<4F43DB61.2030304@rabbitmq.com>	<e105cb4d-f320-4c04-8068-9c58a068ea05@x6g2000pbk.googlegroups.com>	<7dc34cad-d8f9-4903-a72d-cb3dfc2a4749@o4g2000pbc.googlegroups.com>	<4f4690a9-038d-4fdb-bce1-ae8c246a3247@ub4g2000pbc.googlegroups.com>	<20120222175207.GA29288@wellquite.org>
	<4F462C80.4080108@rabbitmq.com>
Message-ID: <4F462DE6.4060104@rabbitmq.com>

On 02/23/2012 12:09 PM, Simon MacMullen wrote:
> On 22/02/12 17:52, Matthew Sackman wrote:
>>> > Is it possible to configure the broker to never page to disk so that
>>> > it never throttles? Basically, when it hits its high watermark for
>>> > memory can it just drop inbound messages?
>> Nope.
>
> I find myself wondering whether some such feature may be useful though.
> At the moment Rabbit is concerned with never throwing anything away, how
> many people would find it useful to drop messages when the server is busy?

If data needs to be timely in preference to being reliable -- better to 
throw away data if it looks like connections are blocked, and send fresh 
data when things are clear again.

-Michael

From Marek.Cermak at Honeywell.com  Thu Feb 23 12:22:02 2012
From: Marek.Cermak at Honeywell.com (Cermak, Marek)
Date: Thu, 23 Feb 2012 12:22:02 +0000
Subject: [rabbitmq-discuss] Message presence notification
In-Reply-To: <4F46217B.7030504@rabbitmq.com>
References: <F1A539826FC33E4CA602BB52E5C450220F88C3A5@FR44EX3004.global.ds.honeywell.com>
	<4F46217B.7030504@rabbitmq.com>
Message-ID: <F1A539826FC33E4CA602BB52E5C450220F88D499@FR44EX3004.global.ds.honeywell.com>

Hello Simon,

> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-
> bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
> Sent: Thursday, February 23, 2012 12:23
> Subject: Re: [rabbitmq-discuss] Message presence notification
> 
> Hmm, interesting situation.
> 
> basic.qos(0) means "no limit" and RabbitMQ will push all the messages at you.
> Unlikely to be what you want.

No, it's not.

> 
> I don't think there's a completely beautiful answer to your question.
> You could:
> 
> a) Have the slow link poll with (passive?) queue.declare()s. The declare-ok
> you get back will tell you the number of messages in the queue at the time
> the declare was received.

What do you mean by _passive_ queue.declare() ? is there a way to not poll in a time loop? 


> 
> b) Do the same, but using HTTP to the management plugin. You have to use
> another protocol, which is a pain, but you can poll a ton of queues with one
> request, so that may be useful.

We want to limit the communication to AMQP.

> 
> c) Have the slow link consume with qos(1) and acks. Every time it gets a
> message, it cancels its consumer and rejects the message (with requeue=true).
> Then the fast link fires up, does its consuming, shuts down again, then the
> slow link starts its consumer again. The bad news is that the first message
> always gets its requeued flag set. The good news is, no polling.

We can't change order of messages.

Not good news but thank you anyway.

regards
Marek

> 
> Cheers, Simon
> 
> On 23/02/12 09:51, Cermak, Marek wrote:
> > Hello everybody,
> >
> > in our scenario we use two different connections to rabbitmq server -
> > one is using a slow and permanently open link the second is very fast
> > but opens only on demand and should be closed once it is not in use.
> >
> > These two connection we want to use for consuming messages from many
> > (tens, hundreds) queues in the following way
> >
> > 1.open the connection on a slow link and "watch" the queues;
> >
> > 2.once there is a message in one of the watched queues, the client
> > receives a notification (no message) from rabbit;
> >
> > 3.client opens the fast link, consumes available messages from queues
> > and closes the link;
> >
> > 4.back to #2.
> >
> > How can we achieve this with AMQP (0.9.1 or 1.0) ? Can we do it with
> > no RabbitMQ protocol extension?
> >
> > I was thinking about channel.basicQoS(0) but what would I get in that case?
> >
> > Thank you for your help.
> >
> > Marek
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Feb 23 12:36:45 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 23 Feb 2012 12:36:45 +0000
Subject: [rabbitmq-discuss] Message presence notification
In-Reply-To: <F1A539826FC33E4CA602BB52E5C450220F88D499@FR44EX3004.global.ds.honeywell.com>
References: <F1A539826FC33E4CA602BB52E5C450220F88C3A5@FR44EX3004.global.ds.honeywell.com>
	<4F46217B.7030504@rabbitmq.com>
	<F1A539826FC33E4CA602BB52E5C450220F88D499@FR44EX3004.global.ds.honeywell.com>
Message-ID: <4F4632DD.9070303@rabbitmq.com>

On 23/02/12 12:22, Cermak, Marek wrote:
> Hello Simon,

Hi!

>> a) Have the slow link poll with (passive?) queue.declare()s. The declare-ok
>> you get back will tell you the number of messages in the queue at the time
>> the declare was received.
>
> What do you mean by _passive_ queue.declare() ? is there a way to not poll in a time loop?

Just with the passive flag set, so that if you make a mistake and 
declare a queue that does not exist then you get an error rather than 
recreating the queue. No big deal.

But yes, this polls.

>> b) Do the same, but using HTTP to the management plugin. You have to use
>> another protocol, which is a pain, but you can poll a ton of queues with one
>> request, so that may be useful.
>
> We want to limit the communication to AMQP.

Understandable.

>> c) Have the slow link consume with qos(1) and acks. Every time it gets a
>> message, it cancels its consumer and rejects the message (with requeue=true).
>> Then the fast link fires up, does its consuming, shuts down again, then the
>> slow link starts its consumer again. The bad news is that the first message
>> always gets its requeued flag set. The good news is, no polling.
>
> We can't change order of messages.

As of 2.7.0+ this will not reorder messages (assuming you only have one 
slow / fast consumer pair per queue; not sure how well this even could 
work if that was not true).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From abdullahsaima at yahoo.com  Thu Feb 23 12:37:00 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Thu, 23 Feb 2012 12:37:00 +0000 (GMT)
Subject: [rabbitmq-discuss] Simulating AMQP 0-9-1
Message-ID: <1330000620.45451.YahooMailNeo@web29703.mail.ird.yahoo.com>

Dear All,

I am working on idea to simulate the basics of AMQP 0 and compare with other technologies. Can anyone suggest what kind of simulation model would be best to try.?
I want to understand it from the point of view of speed and reliability. 

Any help would be highly appreciated. 


Best Regards,

Saima Asif
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120223/dc50523d/attachment.htm>

From steve at rabbitmq.com  Thu Feb 23 12:50:11 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 23 Feb 2012 12:50:11 +0000
Subject: [rabbitmq-discuss] Federation and Stomp
In-Reply-To: <C68D39B8-C152-4BF3-8EF9-75170106C225@rabbitmq.com>
References: <7406945.782.1329319767011.JavaMail.geo-discussion-forums@vbbdv1>
	<C68D39B8-C152-4BF3-8EF9-75170106C225@rabbitmq.com>
Message-ID: <C0126B9D-8270-4D00-B773-010B2D3F333D@rabbitmq.com>

Patrick,
Sorry to take so long to get back to you.

As you point out, SUBSCRIBE to an exchange destination will create an exclusive,
auto-delete queue for that STOMP session and client, and topic exchanges discard
messages when there is no queue to put the messages in.

What is happening is that the queue NOT created on a SEND, so when there is no
SUBSCRIBEr, there is no queue and so the topic exchange discards the messages.

If you want to retain topic messages after the subscriber disconnects,
then look at the Durable Topic Subscription extension for RabbitMQ STOMP
(see http://www.rabbitmq.com/stomp.html#d.dts).

Hope this helps,

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 15 Feb 2012, at 15:29, patrickf wrote:

> I am testing RabbitMQ for suitability in a pub/sub application over multi data centre network.
> 
> Existing clients are using stomp so we need to stay on stomp if at all possible.  I am trying to set up federation with stomp.  Federation seems to work fine, in that the log tells me it has federated links to the 2 upstream exchanges that are set up in the .config file.  And using amqp I can send to the upstream exchange and have a consumer pick it up off the downstream exchange.
> 
> When using stomp with a perl client set, I connect to the upstream exchange with destination /exchange/<exchange name> and get an auto-delete queue.  I can configure a consumer client with the same destination and it pulls off the messages fine.   The problem is that the consumer must be connected or any messages sent by the producer are lost.
> 
> Is there a way to have a non-auto delete queue on the upstream exchange that I can connect to via stomp?
> 
> Thanks
> Patrick
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From steve at rabbitmq.com  Thu Feb 23 12:57:20 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 23 Feb 2012 12:57:20 +0000
Subject: [rabbitmq-discuss] Regarding C++
In-Reply-To: <CEE0C758004FF3408989AAB1547146060279315E@inicx002.in.int.atosorigin.com>
References: <CEE0C758004FF3408989AAB1547146060279315E@inicx002.in.int.atosorigin.com>
Message-ID: <662F069D-654A-4FA4-93D7-D8CD9F3D46E5@rabbitmq.com>

Sonali,

You might like to check out the C/C++ clients that have been developed by the
RabbitMQ Community. See the list at
(http://www.rabbitmq.com/devtools.html#c-dev).

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 23 Feb 2012, at 11:56, Abhonkar, Sonali wrote:

> Hi,
>  
> First time I am working on messaging. So I am not able to do it using rabbitMQ.
> My aim is to write a code in C++, to transfer message   ?Hi World? to other machine using RabbitMQ.
> Can you please help me in this.
>  
> Thanks & Regards,
> Sonali.
>  
> This e-mail and the documents attached are confidential and intended solely for the addressee; it may also be privileged. If you receive this e-mail in error, please notify the sender immediately and destroy it. As its integrity cannot be secured on the Internet, the Atos group liability cannot be triggered for the message content. Although the sender endeavors to maintain a computer virus-free network, the sender does not warrant that this transmission is virus-free and will not be liable for any damages resulting from any virus transmitted.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tonygarnockjones+rabbitmq at gmail.com  Thu Feb 23 13:44:05 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 23 Feb 2012 08:44:05 -0500
Subject: [rabbitmq-discuss] Message presence notification
In-Reply-To: <F1A539826FC33E4CA602BB52E5C450220F88D475@FR44EX3004.global.ds.honeywell.com>
References: <F1A539826FC33E4CA602BB52E5C450220F88C3A5@FR44EX3004.global.ds.honeywell.com>
	<CABzX+qz+ydRXsAkcNDsPOh5s50ubcRiQFxPktdJkSbjnnykbyQ@mail.gmail.com>
	<F1A539826FC33E4CA602BB52E5C450220F88D475@FR44EX3004.global.ds.honeywell.com>
Message-ID: <CAM8fPiTWZ+pxmeVdseWyC-0fsH3fnN6o3+P-jBhSPCiCaX2+OA@mail.gmail.com>

On 23 February 2012 07:15, Cermak, Marek <Marek.Cermak at honeywell.com> wrote:

> > Why not just send two messages? One to a real queue, and another one,
> > with no payload, to a queue called 'notifications'.
>
> It indeed does, but it would be useful in case there is only one producer
> (or not many of them). We can have lot of producers and that would bring
> tons of messages in notification queue (in the worst case one for every
> message in the 'real' queue).
> Another issue would be sending of such notification messages since
> producers are not willing to be changed ;-)
>

How about one process that polls (using passive queue.declare) the main
queue every n seconds? When the message count changes (hmm, what if
consumers are keeping it at zero) it can send a small notification. That
way the producers don't have to be changed.

Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120223/c30a3023/attachment.htm>

From ask at rabbitmq.com  Thu Feb 23 14:39:16 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Thu, 23 Feb 2012 14:39:16 +0000
Subject: [rabbitmq-discuss] Message presence notification
In-Reply-To: <CAM8fPiTWZ+pxmeVdseWyC-0fsH3fnN6o3+P-jBhSPCiCaX2+OA@mail.gmail.com>
References: <F1A539826FC33E4CA602BB52E5C450220F88C3A5@FR44EX3004.global.ds.honeywell.com>
	<CABzX+qz+ydRXsAkcNDsPOh5s50ubcRiQFxPktdJkSbjnnykbyQ@mail.gmail.com>
	<F1A539826FC33E4CA602BB52E5C450220F88D475@FR44EX3004.global.ds.honeywell.com>
	<CAM8fPiTWZ+pxmeVdseWyC-0fsH3fnN6o3+P-jBhSPCiCaX2+OA@mail.gmail.com>
Message-ID: <3B74EA83-5DD9-478C-B509-500959E64E04@rabbitmq.com>

Or why not just have the slow connection consume from the queues, but not ack when it receives a message? It could could use epoll/select to see if there is data to read of the messages are very large

-- 
Ask Solem

On Feb 23, 2012, at 1:44 PM, Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com> wrote:

> On 23 February 2012 07:15, Cermak, Marek <Marek.Cermak at honeywell.com> wrote:
> > Why not just send two messages? One to a real queue, and another one,
> > with no payload, to a queue called 'notifications'.
> 
> It indeed does, but it would be useful in case there is only one producer (or not many of them). We can have lot of producers and that would bring tons of messages in notification queue (in the worst case one for every message in the 'real' queue).
> Another issue would be sending of such notification messages since producers are not willing to be changed ;-)
> 
> How about one process that polls (using passive queue.declare) the main queue every n seconds? When the message count changes (hmm, what if consumers are keeping it at zero) it can send a small notification. That way the producers don't have to be changed.
> 
> Tony
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120223/83272aa2/attachment.htm>

From pbell at syncsort.com  Thu Feb 23 14:54:27 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Thu, 23 Feb 2012 09:54:27 -0500
Subject: [rabbitmq-discuss] Another Naive Question
In-Reply-To: <CACLE7izPH9h9wivEsKbJ3NK4_qXAkJuecZd0O7XCtByzy0BH6w@mail.gmail.com>
References: <CB602924.2DF9C%mpietrek@skytap.com><4F3B8435.2040401@rabbitmq.com><CACLE7iwUVeao_ceQdUr-y43srcNVrk+R5R9OBOiZxGG8FZ4O
	nA@mail.gmail.com><4F3BED29.6050602@rabbitmq.com><CACLE7iyaxmc0pJZ+gzNXa93da13s1iiStApp-A58BYPmmHkejw@mail.gmail.com><4F3E4A8E.
	8060807@rabbitmq.com><CACLE7iw0zRurNgeNRO7aO3AesLrYDvkSr6vm1vGL8kdyKoL-mQ@mail.gmail.com><20120220112803.GA5917@rabbitmq.com>
	<CACLE7izPH9h9wivEsKbJ3NK4_qXAkJuecZd0O7XCtByzy0BH6w@mail.gmail.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40694AA4@MAILCCR.us.syncsort.com>

Hi All,

Well, I've managed to sell folks here on the merits of RabbitMQ. So now, in trying to dot the Is and cross the Ts, I hit upon something simple that it escaped my earlier notice.

Is there any problem with multiple Producers publishing to the same queue? I assume that this presents no problem to Rabbit - but I just need to be certain.

As always, thanks.

-Paul

________________________________


ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120223/4f8791ca/attachment.htm>

From simon at rabbitmq.com  Thu Feb 23 15:04:37 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 23 Feb 2012 15:04:37 +0000
Subject: [rabbitmq-discuss] Another Naive Question
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40694AA4@MAILCCR.us.syncsort.com>
References: <CB602924.2DF9C%mpietrek@skytap.com><4F3B8435.2040401@rabbitmq.com><CACLE7iwUVeao_ceQdUr-y43srcNVrk+R5R9OBOiZxGG8FZ4O	nA@mail.gmail.com><4F3BED29.6050602@rabbitmq.com><CACLE7iyaxmc0pJZ+gzNXa93da13s1iiStApp-A58BYPmmHkejw@mail.gmail.com><4F3E4A8E.	8060807@rabbitmq.com><CACLE7iw0zRurNgeNRO7aO3AesLrYDvkSr6vm1vGL8kdyKoL-mQ@mail.gmail.com><20120220112803.GA5917@rabbitmq.com>	<CACLE7izPH9h9wivEsKbJ3NK4_qXAkJuecZd0O7XCtByzy0BH6w@mail.gmail.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B40694AA4@MAILCCR.us.syncsort.com>
Message-ID: <4F465585.6030500@rabbitmq.com>

On 23/02/12 14:54, Bell, Paul M. wrote:
> Is there any problem with multiple Producers publishing to the same
> queue? I assume that this presents no problem to Rabbit ? but I just
> need to be certain.

No, not at all. That's a large part of the point :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From colleen at collegebrain.com  Thu Feb 23 16:22:12 2012
From: colleen at collegebrain.com (Colleen Ross)
Date: Thu, 23 Feb 2012 08:22:12 -0800
Subject: [rabbitmq-discuss] rabbitmq-server causes ubuntu restart/shutdown
	buttons to break
Message-ID: <CAD86m_Z3fJzU7ttZfVgyJ92ze-B66rzLQQjweMT0TscmAHrp8w@mail.gmail.com>

I'm on Ubuntu (Ocelot) and since I installed rabbitmq, my shutdown and
restart buttons don't work-- they just log me out. I uninstalled rabbitmq
and the buttons started working again. Wondering if there's a bug fix for
this?


Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120223/1552abcb/attachment.htm>

From simon at rabbitmq.com  Thu Feb 23 16:25:27 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 23 Feb 2012 16:25:27 +0000
Subject: [rabbitmq-discuss] rabbitmq-server causes ubuntu
 restart/shutdown buttons to break
In-Reply-To: <CAD86m_Z3fJzU7ttZfVgyJ92ze-B66rzLQQjweMT0TscmAHrp8w@mail.gmail.com>
References: <CAD86m_Z3fJzU7ttZfVgyJ92ze-B66rzLQQjweMT0TscmAHrp8w@mail.gmail.com>
Message-ID: <4F466877.6090902@rabbitmq.com>

On 23/02/12 16:22, Colleen Ross wrote:
> I'm on Ubuntu (Ocelot) and since I installed rabbitmq, my shutdown and
> restart buttons don't work-- they just log me out. I uninstalled
> rabbitmq and the buttons started working again. Wondering if there's a
> bug fix for this?

Not yet, it'll be in the next release.

See discussion: 
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/017934.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From denis.melique at morpho.com  Thu Feb 23 16:36:09 2012
From: denis.melique at morpho.com (MELIQUE Denis (MORPHO))
Date: Thu, 23 Feb 2012 17:36:09 +0100
Subject: [rabbitmq-discuss] Understanding Federation
In-Reply-To: <4F461EB3.3000503@rabbitmq.com>
References: <C3481B5CE3E61E438EEF6143B51DC17F652F5A11E5@Y000IIIV01.rd1.rf1>
	<4F461EB3.3000503@rabbitmq.com>
Message-ID: <C3481B5CE3E61E438EEF6143B51DC17F652F5A15AA@Y000IIIV01.rd1.rf1>

Thank you Simon.

This makes it much clearer for me.
I was first surprised to see this queue always empty on my test bed,  
but the reason is (correct me if I'm wrong) 
that my system was not loaded enough, and consumers got messages as soon as they came in.

So every message consumed from the downstream is first written on disk.
This might be a disadvantage for performance.
And gives an advantage to Shovel, as you can configure it with transient queues.

Denis

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Thursday, February 23, 2012 12:11 PM
To: MELIQUE Denis (MORPHO)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Understanding Federation

On 23/02/12 10:56, MELIQUE Denis (MORPHO) wrote:
> I?m doing some testing with federation plug-in to try to understand it.

Cool!

<snip>

> What are these Exchange and Queues used for ?

The queue is there to buffer messages that are published to the upstream 
exchange and have not yet been consumed from the downstream exchange.

It is bound to the internal exchange with the union of all the bindings 
that are in use downstream, so we only transfer messages that are going 
to be of use downstream.

The internal exchange is there so that whenever we (re)establish a 
federation link we can set up an exact set of bindings 
mostly-atomically, by creating a new internal exchange, creating all the 
bindings to it, then binding it to the upstream exchange.

> Are they reserved for federation internal use ?

Yes.

> When do messages go into these queues ?

As mentioned, the bindings are pushed upstream so messages from upstream 
go into these queues if they will be routed once they get downstream.

> Do they have to be durable or is there a way to configure them as
> transient ?

At the moment they have to be durable. Is this a problem? The idea is 
that you can set the queue TTL if you do not want them to hang around 
forever.

> I would be very interested by a brief description of how federation
> works internally.

Hopefully this answers your question.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#

From simon at rabbitmq.com  Thu Feb 23 16:47:11 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 23 Feb 2012 16:47:11 +0000
Subject: [rabbitmq-discuss] Understanding Federation
In-Reply-To: <C3481B5CE3E61E438EEF6143B51DC17F652F5A15AA@Y000IIIV01.rd1.rf1>
References: <C3481B5CE3E61E438EEF6143B51DC17F652F5A11E5@Y000IIIV01.rd1.rf1>
	<4F461EB3.3000503@rabbitmq.com>
	<C3481B5CE3E61E438EEF6143B51DC17F652F5A15AA@Y000IIIV01.rd1.rf1>
Message-ID: <4F466D8F.8050705@rabbitmq.com>

On 23/02/12 16:36, MELIQUE Denis (MORPHO) wrote:
> Thank you Simon.
>
> This makes it much clearer for me.
> I was first surprised to see this queue always empty on my test bed,
> but the reason is (correct me if I'm wrong)
> that my system was not loaded enough, and consumers got messages as soon as they came in.

You're partly right. Your system was not loaded enough, but the messages 
in that queue will be consumed by the downstream exchange, not 
(directly) by your consumers.

> So every message consumed from the downstream is first written on disk.

No. The queue is durable, but that just determines whether it survives a 
restart. Transient messages can still through it, and remain transient.

Cheers, Simon

> This might be a disadvantage for performance.
> And gives an advantage to Shovel, as you can configure it with transient queues.
>
> Denis
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: Thursday, February 23, 2012 12:11 PM
> To: MELIQUE Denis (MORPHO)
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Understanding Federation
>
> On 23/02/12 10:56, MELIQUE Denis (MORPHO) wrote:
>> I?m doing some testing with federation plug-in to try to understand it.
>
> Cool!
>
> <snip>
>
>> What are these Exchange and Queues used for ?
>
> The queue is there to buffer messages that are published to the upstream
> exchange and have not yet been consumed from the downstream exchange.
>
> It is bound to the internal exchange with the union of all the bindings
> that are in use downstream, so we only transfer messages that are going
> to be of use downstream.
>
> The internal exchange is there so that whenever we (re)establish a
> federation link we can set up an exact set of bindings
> mostly-atomically, by creating a new internal exchange, creating all the
> bindings to it, then binding it to the upstream exchange.
>
>> Are they reserved for federation internal use ?
>
> Yes.
>
>> When do messages go into these queues ?
>
> As mentioned, the bindings are pushed upstream so messages from upstream
> go into these queues if they will be routed once they get downstream.
>
>> Do they have to be durable or is there a way to configure them as
>> transient ?
>
> At the moment they have to be durable. Is this a problem? The idea is
> that you can set the queue TTL if you do not want them to hang around
> forever.
>
>> I would be very interested by a brief description of how federation
>> works internally.
>
> Hopefully this answers your question.
>
> Cheers, Simon
>


-- 
Simon MacMullen
RabbitMQ, VMware

From tsuraan at gmail.com  Thu Feb 23 16:54:50 2012
From: tsuraan at gmail.com (tsuraan)
Date: Thu, 23 Feb 2012 10:54:50 -0600
Subject: [rabbitmq-discuss] Design for Comet
Message-ID: <CALKcMwLih8m2nR9rDn9mhdLC8AaOd=TKzhAM6wuOuABg_z_6zA@mail.gmail.com>

We have a comet-like server that has four basic tiers of messages:
page-level, user-level, topic, and global.  When a page is rendered
that hooks into the comet system, it initially subscribes to the comet
server using a POST with the tiers that it wants, and then it uses GET
to wait on new messages using long-polling.  To support this, I've
made a somewhat overly-complicated server that does a lot of internal
queueing, but is ultimately backed by Rabbit.

I've been looking at simplifying this, but first I thought I'd run it
past you guys, since I think my idea may have some components that
rabbit would hate.  Basically, what I want to do is make a short-lived
(and non-durable) queue per page (where a single page is dynamic, so
it tends to live for a while), and then have that queue be subscribed
to a "global" exchange, a "user" exchange, and a "topics" exchange.  I
see that Rabbit now has a queue-expiry extension, so unused queues
could be automatically garbage collected (I was thinking of basically
having a 10s idle timeout on my temp queues).  My concern is whether
rabbit likes having thousands or tens of thousands of queues created
and torn down every few minutes.  I seem to recall that it didn't like
that at all in the past, but Rabbit's been progressing like mad
lately, so I figured I'd ask if that's a sane thing to do these days.

From alistair at abayley.org  Thu Feb 23 16:58:19 2012
From: alistair at abayley.org (Alistair Bayley)
Date: Fri, 24 Feb 2012 05:58:19 +1300
Subject: [rabbitmq-discuss] [help] [beginner] server stops sending
 messages; publish (in transaction) hangs on commit
In-Reply-To: <4F462A8E.3080509@rabbitmq.com>
References: <CAKYODbhUWBDy4KJQJO7OW2aRnw9LYkerLiNN8kG8=NAnO8FgPQ@mail.gmail.com>
	<CABzX+qwJhotUDEshpfDJKyQKkXWv+uOci+fgY8m1RoX7R-UHXQ@mail.gmail.com>
	<4F462A8E.3080509@rabbitmq.com>
Message-ID: <CAKYODbikMzvX_VC5z0Az8FHh+RHqxuppgMVBwS9OgLG=f6RZ2A@mail.gmail.com>

On 24 February 2012 01:01, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 23/02/12 11:34, Marek Majkowski wrote:
>>
>> You seem to have quite a small amount of RAM - 100MiB, right?
>>
>> Do logs show high memory watermark being set?
>
>
> More to the point, the OP's "rabbitmqctl report" output shows memory use
> above the watermark. So yes...
>
>
>> If so: rabbitmq tries not to go above a memory limit.
>> When rabbit hits memory limit it stops consuming messages -
>
>
> As in, it will block on message publish. In tx mode that equates to a
> commit.
>
>
>> all connections that produce messages will be stopped.
>> The connection won't be touched until some memory is freed.
>>
>> But in setups where total memory is small, RabbitMQ may
>> enter a state of just being above memory watermark and not
>> being able to free anything. This may be happening to you.
>
>
> ...and you can set vm_memory_high_watermark higher to work around this. See
> http://www.rabbitmq.com/memory.html.

Thanks.

Why is it not able to free memory? A rabbitmqctl report on a freshly
started server shows total memory about 10M, what causes it to grow
and not shrink back? This server is currently doing literally nothing
- all queues are empty - so I'd like to know why total memory doesn't
drop back down to something close to the initial state.

It is running on a deliberately small VM. As it is the only service on
the VM (the VM exists solely to host rabbitmq) we can increase the
vm_memory_high_watermark . I would try 80%, is there a reason to go
higher (or not)?.

Alistair

From majek04 at gmail.com  Thu Feb 23 17:52:43 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 23 Feb 2012 17:52:43 +0000
Subject: [rabbitmq-discuss] [help] [beginner] server stops sending
 messages; publish (in transaction) hangs on commit
In-Reply-To: <CAKYODbikMzvX_VC5z0Az8FHh+RHqxuppgMVBwS9OgLG=f6RZ2A@mail.gmail.com>
References: <CAKYODbhUWBDy4KJQJO7OW2aRnw9LYkerLiNN8kG8=NAnO8FgPQ@mail.gmail.com>
	<CABzX+qwJhotUDEshpfDJKyQKkXWv+uOci+fgY8m1RoX7R-UHXQ@mail.gmail.com>
	<4F462A8E.3080509@rabbitmq.com>
	<CAKYODbikMzvX_VC5z0Az8FHh+RHqxuppgMVBwS9OgLG=f6RZ2A@mail.gmail.com>
Message-ID: <CABzX+qzu04N6Kb4gxoXhkMDvikkxza5RyZitiacfXsR3zosUYQ@mail.gmail.com>

On Thu, Feb 23, 2012 at 16:58, Alistair Bayley <alistair at abayley.org> wrote:
> On 24 February 2012 01:01, Simon MacMullen <simon at rabbitmq.com> wrote:
>> On 23/02/12 11:34, Marek Majkowski wrote:
>>>
>>> You seem to have quite a small amount of RAM - 100MiB, right?
>>>
>>> Do logs show high memory watermark being set?
>>
>>
>> More to the point, the OP's "rabbitmqctl report" output shows memory use
>> above the watermark. So yes...
>>
>>
>>> If so: rabbitmq tries not to go above a memory limit.
>>> When rabbit hits memory limit it stops consuming messages -
>>
>>
>> As in, it will block on message publish. In tx mode that equates to a
>> commit.
>>
>>
>>> all connections that produce messages will be stopped.
>>> The connection won't be touched until some memory is freed.
>>>
>>> But in setups where total memory is small, RabbitMQ may
>>> enter a state of just being above memory watermark and not
>>> being able to free anything. This may be happening to you.
>>
>>
>> ...and you can set vm_memory_high_watermark higher to work around this. See
>> http://www.rabbitmq.com/memory.html.
>
> Thanks.
>
> Why is it not able to free memory? A rabbitmqctl report on a freshly
> started server shows total memory about 10M, what causes it to grow
> and not shrink back? This server is currently doing literally nothing
> - all queues are empty - so I'd like to know why total memory doesn't
> drop back down to something close to the initial state.
>
> It is running on a deliberately small VM. As it is the only service on
> the VM (the VM exists solely to host rabbitmq) we can increase the
> vm_memory_high_watermark . I would try 80%, is there a reason to go
> higher (or not)?.

Unfortunately Erlang memory handling is quite complex. By default,
Erlang tries to optimize what it can, and that may mean allocating more memory
that you would want to.

Basically - Erlang VM is quite heavy even if it is not doing much.

I'm afraid you just need to:
 a) buy more RAM
 b) or, tweak the vm_memory_high_watermark . You can even set
  it to be more than 100% - if you don't mind getting erlang
  process into swap sometimes.
  But in such case, it's better to make sure that you won't have much
  data residing in queues. (It should be okay to have high throughput
   through rabbit, as far as consumers are keeping up)

Marek

From majek04 at gmail.com  Thu Feb 23 17:55:44 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 23 Feb 2012 17:55:44 +0000
Subject: [rabbitmq-discuss] [help] [beginner] server stops sending
 messages; publish (in transaction) hangs on commit
In-Reply-To: <CABzX+qzu04N6Kb4gxoXhkMDvikkxza5RyZitiacfXsR3zosUYQ@mail.gmail.com>
References: <CAKYODbhUWBDy4KJQJO7OW2aRnw9LYkerLiNN8kG8=NAnO8FgPQ@mail.gmail.com>
	<CABzX+qwJhotUDEshpfDJKyQKkXWv+uOci+fgY8m1RoX7R-UHXQ@mail.gmail.com>
	<4F462A8E.3080509@rabbitmq.com>
	<CAKYODbikMzvX_VC5z0Az8FHh+RHqxuppgMVBwS9OgLG=f6RZ2A@mail.gmail.com>
	<CABzX+qzu04N6Kb4gxoXhkMDvikkxza5RyZitiacfXsR3zosUYQ@mail.gmail.com>
Message-ID: <CABzX+qw2+CS2OUAxF_0B-6BMO+LMM7qEXKOdoiyrMyuQTd+d1A@mail.gmail.com>

> Unfortunately Erlang memory handling is quite complex. By default,
> Erlang tries to optimize what it can, and that may mean allocating more memory
> that you would want to.
>
> Basically - Erlang VM is quite heavy even if it is not doing much.
>
> I'm afraid you just need to:
> ?a) buy more RAM
> ?b) or, tweak the vm_memory_high_watermark . You can even set
> ?it to be more than 100% - if you don't mind getting erlang
> ?process into swap sometimes.
> ?But in such case, it's better to make sure that you won't have much
> ?data residing in queues. (It should be okay to have high throughput
> ? through rabbit, as far as consumers are keeping up)

You could also do:
 c) Tweak erlang gc: http://www.erlang.org/doc/man/erts_alloc.html
    but this is generally discouraged and hard enough to be a topic
for a PhD thesis.

Marek

From simon at rabbitmq.com  Thu Feb 23 17:57:28 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 23 Feb 2012 17:57:28 +0000
Subject: [rabbitmq-discuss] [help] [beginner] server stops sending
 messages; publish (in transaction) hangs on commit
In-Reply-To: <CAKYODbikMzvX_VC5z0Az8FHh+RHqxuppgMVBwS9OgLG=f6RZ2A@mail.gmail.com>
References: <CAKYODbhUWBDy4KJQJO7OW2aRnw9LYkerLiNN8kG8=NAnO8FgPQ@mail.gmail.com>	<CABzX+qwJhotUDEshpfDJKyQKkXWv+uOci+fgY8m1RoX7R-UHXQ@mail.gmail.com>	<4F462A8E.3080509@rabbitmq.com>
	<CAKYODbikMzvX_VC5z0Az8FHh+RHqxuppgMVBwS9OgLG=f6RZ2A@mail.gmail.com>
Message-ID: <4F467E08.3030505@rabbitmq.com>

On 23/02/12 16:58, Alistair Bayley wrote:
> Why is it not able to free memory? A rabbitmqctl report on a freshly
> started server shows total memory about 10M, what causes it to grow
> and not shrink back? This server is currently doing literally nothing
> - all queues are empty - so I'd like to know why total memory doesn't
> drop back down to something close to the initial state.

The report you posted showed most memory in the VM being used by Erlang 
processes. You could run something like:

rabbitmqctl eval 
'lists:sublist(lists:reverse(lists:sort([{process_info(Pid,memory), Pid, 
process_info(Pid)} || Pid <- processes()])), 10).'

to list the top 10 processes by memory use, along with some information 
for each one. This may tell us something interesting.

Having said that, 100Mb for an idle server does not seem totally 
unreasonable - RabbitMQ is not optimised for small memory use when idle.

> It is running on a deliberately small VM. As it is the only service on
> the VM (the VM exists solely to host rabbitmq) we can increase the
> vm_memory_high_watermark . I would try 80%, is there a reason to go
> higher (or not)?.

The reason we set 0.4 is that in a worst case scenario memory use can 
double during GC. That's relatively unlikely though and assuming you 
have some swapspace as well it will not be too bad if you do.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dawgtool at aol.com  Thu Feb 23 18:37:46 2012
From: dawgtool at aol.com (DawgTool)
Date: Thu, 23 Feb 2012 13:37:46 -0500
Subject: [rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory
 on slave nodes
In-Reply-To: <4F454C42.4080400@gmail.com>
References: <4F454C42.4080400@gmail.com>
Message-ID: <4F46877A.90206@aol.com>

Which version of Erlang are you running?
I had the same issue with R13/R14, but after upgrading to R15B, no issues.
Not sure if its related or if I just got lucky, but might be worth a shot.
-- DawgTool

ps> I also recall making some config changes, but don't recall at the 
moment. I'll look at those later today.


On 2/22/12 3:12 PM, Reverend Chip wrote:
> I have a four-node 2.7.1 cluster.  I just started experimenting with
> mirrored queues.  One queue is mirrored across nodes 1&2, a second queue
> is mirrored across nodes 3&4.  I've been feeding a lot of large messages
> through, using delivery-mode 2.  Most of the messages I've purged, since
> the reader process can't keep up yet.
>
> Here's the problem: Memory usage.  Nodes 1&  3, presumably the master
> nodes for the queues, have maintained a normal memory profile, 3-6GB.
> But nodes 2&  4, the presumable slaves, have had their memory grow to
> 58GB each.  Worse, when I purged and then even deleted the queues, the
> memory usage did not go down.  It seems I may have to reboot these nodes
> to get the memory back, and obviously I can't use mirrored queues if
> they're going to make my nodes do this, which is disappointing.  I do
> have a workaround involving alternate exchanges, but the workaround can
> leave data stranded if a node is lost forever.
>
> Is there any other info I can provide to help diagnose and/or fix this?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alistair at abayley.org  Thu Feb 23 20:00:36 2012
From: alistair at abayley.org (Alistair Bayley)
Date: Fri, 24 Feb 2012 09:00:36 +1300
Subject: [rabbitmq-discuss] [help] [beginner] server stops sending
 messages; publish (in transaction) hangs on commit
In-Reply-To: <4F467E08.3030505@rabbitmq.com>
References: <CAKYODbhUWBDy4KJQJO7OW2aRnw9LYkerLiNN8kG8=NAnO8FgPQ@mail.gmail.com>
	<CABzX+qwJhotUDEshpfDJKyQKkXWv+uOci+fgY8m1RoX7R-UHXQ@mail.gmail.com>
	<4F462A8E.3080509@rabbitmq.com>
	<CAKYODbikMzvX_VC5z0Az8FHh+RHqxuppgMVBwS9OgLG=f6RZ2A@mail.gmail.com>
	<4F467E08.3030505@rabbitmq.com>
Message-ID: <CAKYODbhKD3JyASyzzCZYeOGE1aMzApfsy-6jfW_bNFv4ATs77Q@mail.gmail.com>

On 24 February 2012 06:57, Simon MacMullen <simon at rabbitmq.com> wrote:
>
> The report you posted showed most memory in the VM being used by Erlang
> processes. You could run something like:
>
> rabbitmqctl eval
> 'lists:sublist(lists:reverse(lists:sort([{process_info(Pid,memory), Pid,
> process_info(Pid)} || Pid <- processes()])), 10).'
>
> to list the top 10 processes by memory use, along with some information for
> each one. This may tell us something interesting.

Just ran this:

$ sudo rabbitmqctl eval
'lists:sublist(lists:reverse(lists:sort([{process_info(Pid,memory),
Pid, process_info(Pid)} || Pid <- processes()])), 10).'

(wait for a bit - about 30s or so...)

Crash dump was written to: erl_crash.dump
eheap_alloc: Cannot allocate 153052320 bytes of memory (of type "old_heap").
Aborted
$

hmmm....


> Having said that, 100Mb for an idle server does not seem totally
> unreasonable - RabbitMQ is not optimised for small memory use when idle.

OK. Can I have some guidance as to how much memory we should allocate?
The ubuntu VMs we use have 256M by default; this is usually more than
enough for our needs. Is that enough for rabbitmq? Let's assume that
we have a small number of queues (6 or so) and the queues will contain
a small number (in the 100s) of fairly small messages (a few hundred
bytes each). The consumers are aggressive; messages should not remain
on queues for long, although they are persistent.

I don't see much in the docs about memory requirements. I think I'll
start by setting the vm_memory_high_watermark to 0, and seeing where
the memory use plateaus (assuming it does).

Also, I see from the tcpdump capture that the server does not send
back a response to the Tx.Commit, which presumably makes it difficult
for the client to detect that the message has not been accepted (other
than timeout). Indeed, the basic_publish returns nothing immediately,
although that could be a feature of the amqplib library. Is there an
option to get the server to return something that says that it is not
accepting messages?

Thanks,
Alistair

From ejarendt at gmail.com  Thu Feb 23 20:27:48 2012
From: ejarendt at gmail.com (Eric)
Date: Thu, 23 Feb 2012 12:27:48 -0800 (PST)
Subject: [rabbitmq-discuss] Ensuring low latency for publishers
In-Reply-To: <4F462DE6.4060104@rabbitmq.com>
References: <1e665e68-b239-44a0-aecd-af98dec19d1d@qs5g2000pbc.googlegroups.com>
	<4F43DB61.2030304@rabbitmq.com>
	<e105cb4d-f320-4c04-8068-9c58a068ea05@x6g2000pbk.googlegroups.com>
	<7dc34cad-d8f9-4903-a72d-cb3dfc2a4749@o4g2000pbc.googlegroups.com>
	<4f4690a9-038d-4fdb-bce1-ae8c246a3247@ub4g2000pbc.googlegroups.com>
	<20120222175207.GA29288@wellquite.org> <4F462C80.4080108@rabbitmq.com>
	<4F462DE6.4060104@rabbitmq.com>
Message-ID: <b16ad838-4b64-4cae-8f07-b4d086332418@m3g2000pbi.googlegroups.com>

Well... I would find it useful.  And the person in the thread I linked
to would have found it useful as well.

It's pretty tough to go into a production environment with the
statement "Publishing should be fast unless the broker is throttling.
If the broker is throttling we won't be able to tell, we don't have a
good way of knowing beforehand, and we don't know how long the threads
will be blocked".  It's useful in any case where an application would
rather not publish the message rather than waiting to publish it
indefinitely.

The net result is that a struggling broker will cause a chain
reaction; publishers will block indefinitely, which may bring the
publishing application to a halt.  In that case I'd like to abandon
the publishing process, but it's quite impossible at that point - it's
too late, the broker is already throttling, and there's no timeout.
The thread could block for seconds, or more.  I'm concerned about not
throwing the message away, but I'm more concerned about being able to
isolate services from RabbitMQ broker events.

I know that this is solved by decoupling the publishing process, but
then I'm back to the data structure conundrum I mentioned in my first
post.  It's very elegant if a thread can simply publish a message and
move on with life, and that's only problematic if there's no guarantee
as to how long that publish can take.

One more question along this line.  The flow control document says "By
default, when the RabbitMQ server uses above 40% of the installed RAM,
it raises a memory alarm... Connection heartbeat monitoring gets
disabled too."  If I set up a connection heartbeat on the shared
connection, will the heartbeat detect a broker alarm that exceeds the
interval and disconnect?  A disconnect would terminate the publisher
channels and free things up.

 - Eric

On Feb 23, 4:15?am, Michael Bridgen <mi... at rabbitmq.com> wrote:
> On 02/23/2012 12:09 PM, Simon MacMullen wrote:
>
> > On 22/02/12 17:52, Matthew Sackman wrote:
> >>> > Is it possible to configure the broker to never page to disk so that
> >>> > it never throttles? Basically, when it hits its high watermark for
> >>> > memory can it just drop inbound messages?
> >> Nope.
>
> > I find myself wondering whether some such feature may be useful though.
> > At the moment Rabbit is concerned with never throwing anything away, how
> > many people would find it useful to drop messages when the server is busy?
>
> If data needs to be timely in preference to being reliable -- better to
> throw away data if it looks like connections are blocked, and send fresh
> data when things are clear again.
>
> -Michael
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mpietrek at skytap.com  Thu Feb 23 21:00:27 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 23 Feb 2012 13:00:27 -0800
Subject: [rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
In-Reply-To: <4F462871.4070602@rabbitmq.com>
References: <CB69271E.2EDC1%mpietrek@skytap.com> <4F44D546.200@rabbitmq.com>
	<CACLE7iwXrRpgqZeiMr7yJ=CJ6EjP1wYEU=Z+M+tKesu9=x86CA@mail.gmail.com>
	<CACLE7ixq2WEZxiCyWrWfoXBC=UMRRvg0Y9yW33ru4Atsf4R5uw@mail.gmail.com>
	<CACLE7iwV0+k6d__8kUG3KCNi4UsSJ6NaP412mgn8v9gTiZD2Mg@mail.gmail.com>
	<4F462871.4070602@rabbitmq.com>
Message-ID: <CACLE7iyzMhn7wJm8=-RKjQHrYZ5e4hFCLST93em0FW9KJd01Nw@mail.gmail.com>

| I *think* the stats database is a red herring.

Perhaps. But it's the only correlation that I've seen. That is, I've never
seen it happen on node that didn't have the stats database before it shut
down.

A little more background context: I'm writing "rolling restart" logic. For
each node in the cluster, in sequence, I stop the node, perform update
logic (currently nothing), then restart the node.

| You say this happens when restarting?

Yes. Occasionally the node will restart OK, but more often than not, it
hangs on the "rabbitmqctl wait"

I modified my script to run rabbitmq-server as a background task. Also,
worth noting that these scripts are invoked remotely via Capistrano, so
until I prefaced them with nohup, the server would start then immediately
exit. The invocation line now looks like this:

nohup rabbitmq-server &

The nohup.out on the failing node ends with:

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.7.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at play2
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-2.7.1/sbin/../ebin/rabbit.app
home dir       : /home/mpietrek
config file(s) : /home/mpietrek/work/var/run/rabbitmq.config
cookie hash    : pS5H9kY3Wra/XdLEKT5hgQ==
log            : /home/mpietrek/work/logs/
play2.mpietrek.internal.illumita.com/rabbit at play2.log
sasl log       : /home/mpietrek/work/logs/
play2.mpietrek.internal.illumita.com/rabbit at play2-sasl.log
database dir   : /home/mpietrek/work/var/lib/rabbit at play2
erlang version : 5.7.4

-- rabbit boot start
starting file handle cache server
...done
starting worker pool
...done
starting database                                                     ...


On Thu, Feb 23, 2012 at 3:52 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> I *think* the stats database is a red herring. You say this happens when
> restarting?
>
>
> On 23/02/12 00:30, Matt Pietrek wrote:
>
>> Let me add some additional information, and re-summarize what I'm seeing.
>>
>> In our startup script for RabbitMQ we do the following;
>>
>> rabbitmq-server -detached
>> rabbitmqctl status
>> <Extract the PID from rabbitmqctl status, write to our PIDFILE>
>>
>
> There's a potential race here if an old server is running (maybe about to
> shut down?). rabbitmqctl status could pick up the old pid.
>
>  rabbitmqctl wait PIDFILE
>>
>
> However, rabbitmqctl wait should then detect that the pid has died and
> fail. Unless the pid gets reused by the OS but that is presumably unlikely.
>
> But rabbitmqctl wait will wait indefinitely as long as the pid is alive
> and not a fully functional rabbit node. So I'd check two things:
>
> 1) You should fix that race, it can be done safely:
>
> Do not use rabbitmq-server -detached and rabbitmqctl status to get the
> pid. Instead set RABBITMQ_PID_FILE and background the rabbitmq-server
> script. You will then *definitely* get the right pid since the script
> writes its own pid then execs - no race possible.
>
> 2) Capture the stdout of rabbitmq-server when you start it - if
> rabbitmqctl wait still hangs, see how far it's got / what it's doing.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120223/bbd5ed6d/attachment.htm>

From alistair at abayley.org  Thu Feb 23 21:19:52 2012
From: alistair at abayley.org (Alistair Bayley)
Date: Fri, 24 Feb 2012 10:19:52 +1300
Subject: [rabbitmq-discuss] [help] [beginner] server stops sending
 messages; publish (in transaction) hangs on commit
In-Reply-To: <CAKYODbhKD3JyASyzzCZYeOGE1aMzApfsy-6jfW_bNFv4ATs77Q@mail.gmail.com>
References: <CAKYODbhUWBDy4KJQJO7OW2aRnw9LYkerLiNN8kG8=NAnO8FgPQ@mail.gmail.com>
	<CABzX+qwJhotUDEshpfDJKyQKkXWv+uOci+fgY8m1RoX7R-UHXQ@mail.gmail.com>
	<4F462A8E.3080509@rabbitmq.com>
	<CAKYODbikMzvX_VC5z0Az8FHh+RHqxuppgMVBwS9OgLG=f6RZ2A@mail.gmail.com>
	<4F467E08.3030505@rabbitmq.com>
	<CAKYODbhKD3JyASyzzCZYeOGE1aMzApfsy-6jfW_bNFv4ATs77Q@mail.gmail.com>
Message-ID: <CAKYODbhLmeBovrh-DV1A-m9gTKch6jO8OF_52frAnBqT4vTGhw@mail.gmail.com>

On 24 February 2012 09:00, Alistair Bayley <alistair at abayley.org> wrote:
>
> I don't see much in the docs about memory requirements. I think I'll
> start by setting the vm_memory_high_watermark to 0, and seeing where
> the memory use plateaus (assuming it does).

OK. I've just set the vm_memory_high_watermark to 0 and now the broker
won't accept any messages. In the log:

=INFO REPORT==== 24-Feb-2012::09:18:29 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 24-Feb-2012::09:18:30 ===
Memory limit set to 0MB of 244MB total.

=INFO REPORT==== 24-Feb-2012::09:18:30 ===
vm_memory_high_watermark set. Memory used:12963672 allowed:0

=INFO REPORT==== 24-Feb-2012::09:18:30 ===
    alarm_handler: {set,
                       {{vm_memory_high_watermark,
                            'rabbit at kollector-staging-rabbitmq1'},
                        []}}

In the docs (http://www.rabbitmq.com/memory.html) it says: "A value of
0 disables the memory monitor and throttling of producers."

I took this to mean that there is no throttling i.e. messages would
always be accepted. Have I misunderstood?

Alistair

From uday.subbarayan at yahoo.com  Thu Feb 23 21:41:06 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Thu, 23 Feb 2012 13:41:06 -0800 (PST)
Subject: [rabbitmq-discuss] HA Documentation Error?
In-Reply-To: <20120216111437.GB32295@rabbitmq.com>
References: <1328830347.88766.YahooMailNeo@web44913.mail.sp1.yahoo.com>
	<4F34EB96.6090203@rabbitmq.com>
	<1328903410.78762.YahooMailNeo@web44915.mail.sp1.yahoo.com>
	<4F38E2B4.7010508@rabbitmq.com>
	<20120216111437.GB32295@rabbitmq.com>
Message-ID: <1330033266.59514.YahooMailNeo@web44915.mail.sp1.yahoo.com>

Thanks Matt. It would be nice if the HA documentation is revisited again and?explain the basic steps well, it's of great help to the community.

Best,
Uday.?
?


________________________________
 From: Matthew Sackman <matthew at rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Thursday, February 16, 2012 3:14 AM
Subject: Re: [rabbitmq-discuss] HA Documentation Error?
 
On Mon, Feb 13, 2012 at 10:15:16AM +0000, Emile Joubert wrote:
> On 10/02/12 19:50, Uday Subbarayan wrote:
> > Note: There is a risk in the above strategy if the master node goes
> > down. If you want to avoid, then publish to all slaves? Here on wards, i
> 
> If the master becomes unavailable then a slave is promoted to take its
> place. Message replication between slaves and the master happens
> internally and automatically. As long as the queue is declared as
> mirrored, the publisher is not required to take any action to republish
> messages to slaves.

Well, that's not necessarily true. If the node that failed was also the
node to which the client was connected, then the client needs to detect
the death of the connection, establish a new connection to a surviving
node and then republish all messages that it never got
publisher-confirms back for - assuming the client even turned
publisher-confirms on. That would be the only way to ensure
at-least-once delivery.

> Active-active mirrored queues are recommended instead of the
> active-passive approach, because it does not require additional software
> and the failover process is quicker.

However, throughput is lower, and it does not have any chance of
integration with other clustering/HA software elsewhere in the stack.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120223/38980ee4/attachment.htm>

From pablomolnar at gmail.com  Thu Feb 23 21:57:25 2012
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Thu, 23 Feb 2012 18:57:25 -0300
Subject: [rabbitmq-discuss] Filter by presence in a header Exchange
Message-ID: <CANVSfpKV3dJ2+YEGKDktz1Mgp6cmBCLboecLBNVrQ_Oe0L8JrQ@mail.gmail.com>

Hi there,

I'm using a header exchange with "x-match any/all" value matching
binding without any problem. I'm wondering if there something like a
presence key header binding. I've a use case where no matter the value
if a header was sent then I have to consume the message.

Cheers,
Pablo

From lionel.cons at cern.ch  Fri Feb 24 07:17:38 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Fri, 24 Feb 2012 08:17:38 +0100
Subject: [rabbitmq-discuss] RabbitMQ's STOMP CONNECTED Frame
Message-ID: <20120224080231.15e5.abe10f7e5afbbb3a79ce619739541149@cern.ch>

If one wants to write STOMP clients that can work with multiple
messaging brokers, (s)he must take into account some details that
are implementation's specific. For instance, what ActiveMQ calls
activemq.prefetchSize, RabbitMQ calls prefetch-count. This is doable
since these details are not too many.

However, it would help a lot to be able to reliably identify the type
of messaging broker a STOMP client is connected to. This has been
foreseen in the STOMP 1.1 specification that contains for the
CONNECTED frame:

 | STOMP 1.1 servers MAY set the following headers:
 | [...]
 | server : A field that contains information about the STOMP server. The
 |   field MUST contain a server-name field and MAY be followed by optional
 |   comment feilds delimited by a space character. The server-name field
 |   consists of a name token followed by an optional version number token.
 | 
 |   server = name ["/" version] *(comment)
 | 
 |   Example: server:Apache/1.3.9

RabbitMQ 2.7.1 does not set the "server" header on the CONNECTED frame.
FWIW, both ActiveMQ and Apollo do set this header.

Would it be possible to have RabbitMQ's STOMP plugin also advertise
the server version in the CONNECTED frame?

If people are concerned with security, this could be optional and the
version string could be configurable.

Cheers,

Lionel

From andrea.rosa at hp.com  Fri Feb 24 09:21:35 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Fri, 24 Feb 2012 09:21:35 +0000
Subject: [rabbitmq-discuss] Rabbitmq 2.7.1 and plugin dependenices
Message-ID: <5F389C517756284F80239F55BCA5DDDD3692B98F@G9W0721.americas.hpqcorp.net>

Hi

Where I can find the dependencies required by different plugins? 
For example I need to install the management plugin with the latest version of rabbitmq (2.7.1), can you confirm that it requires the latest version of erlang (15B)?

Best Regards
--
Andrea Rosa

From simon at rabbitmq.com  Fri Feb 24 09:59:22 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 24 Feb 2012 09:59:22 +0000
Subject: [rabbitmq-discuss] RabbitMQ's STOMP CONNECTED Frame
In-Reply-To: <20120224080231.15e5.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20120224080231.15e5.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <4F475F7A.3060409@rabbitmq.com>

On 24/02/12 07:17, Lionel Cons wrote:
> RabbitMQ 2.7.1 does not set the "server" header on the CONNECTED frame.
> FWIW, both ActiveMQ and Apollo do set this header.

Good point.

> Would it be possible to have RabbitMQ's STOMP plugin also advertise
> the server version in the CONNECTED frame?

Yes.

> If people are concerned with security, this could be optional and the
> version string could be configurable.

Nah, we already do the same for AMQP.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Feb 24 10:05:32 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 24 Feb 2012 10:05:32 +0000
Subject: [rabbitmq-discuss] Rabbitmq 2.7.1 and plugin dependenices
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD3692B98F@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD3692B98F@G9W0721.americas.hpqcorp.net>
Message-ID: <4F4760EC.30407@rabbitmq.com>

On 24/02/12 09:21, Rosa, Andrea (HP Cloud Services) wrote:
> Where I can find the dependencies required by different plugins?
> For example I need to install the management plugin with the latest version of rabbitmq (2.7.1), can you confirm that it requires the latest version of erlang (15B)?

In terms of Erlang, see http://www.rabbitmq.com/which-erlang.html. So 
you don't need R15B.

In terms of inter-plugin dependencies, the rabbitmq-plugins tools will 
sort it out for you.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From david.perez at ateofinance.com  Fri Feb 24 10:06:24 2012
From: david.perez at ateofinance.com (David Perez [Ateo])
Date: Fri, 24 Feb 2012 11:06:24 +0100
Subject: [rabbitmq-discuss] Problem connecting to Red Hat Messaging MRP
	using SSL
Message-ID: <01ae01ccf2db$f7021450$e5063cf0$@perez@ateofinance.com>

Hi everyone,

 

I stumbled upon while looking for a flexible AMQP implementation compatible
with Red Hat Messaging MRP.

First I would like to congratulate you guy because I find Rabbit MQ really
well documented and easy to learn.

 

So, I'm trying to connect to a Red Hat Messaging MRP server using SSL
authentication, but I receive the following error when connecting to the
broker:

 

RabbitMQ.Client.Exceptions.ProtocolVersionMismatchException: AMQP server

protocol negotiation failure: server version unknown-unknown, client

version 0-9

 

Would you have any clue about this error ? Is there a way to skip the
protocol negotiation ?

 

Thanks,

 

David Perez 
ATEO - Developer

Email :  <mailto:david.perez at ateofinance.com> david.perez at ateofinance.com

Address : 5, rue Magellan, 75008 Paris, France

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120224/acb0d7c8/attachment.htm>

From simon at rabbitmq.com  Fri Feb 24 10:12:20 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 24 Feb 2012 10:12:20 +0000
Subject: [rabbitmq-discuss] Problem connecting to Red Hat Messaging MRP
 using SSL
In-Reply-To: <01ae01ccf2db$f7021450$e5063cf0$@perez@ateofinance.com>
References: <01ae01ccf2db$f7021450$e5063cf0$@perez@ateofinance.com>
Message-ID: <4F476284.2060400@rabbitmq.com>

On 24/02/12 10:06, David Perez [Ateo] wrote:
> Would you have any clue about this error ?

I'm not sure why it's coming back unknown-unknown, that's clearly wrong.

As far as I know, MRG moved to AMQP 0-10 some time ago - I don't know if 
they support AMQP 0-9-1 as used by RabbitMQ.

 > Is there a way to skip the protocol negotiation ?

No.

Unfortunately the different "versions" of AMQP tend to be *really* 
different from each other. 0-10 is a completely different beast from 
0-9-1 (*far* more complicated for a start, which is why we don't 
particularly intend to support it).

Sorry I can't give you better news.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Feb 24 10:46:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 24 Feb 2012 10:46:08 +0000
Subject: [rabbitmq-discuss] Filter by presence in a header Exchange
In-Reply-To: <CANVSfpKV3dJ2+YEGKDktz1Mgp6cmBCLboecLBNVrQ_Oe0L8JrQ@mail.gmail.com>
References: <CANVSfpKV3dJ2+YEGKDktz1Mgp6cmBCLboecLBNVrQ_Oe0L8JrQ@mail.gmail.com>
Message-ID: <4F476A70.2080108@rabbitmq.com>

On 23/02/12 21:57, Pablo Molnar wrote:
> I'm using a header exchange with "x-match any/all" value matching
> binding without any problem. I'm wondering if there something like a
> presence key header binding. I've a use case where no matter the value
> if a header was sent then I have to consume the message.

No, there isn't I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Feb 24 10:48:07 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 24 Feb 2012 10:48:07 +0000
Subject: [rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory
 on slave nodes
In-Reply-To: <4F46877A.90206@aol.com>
References: <4F454C42.4080400@gmail.com> <4F46877A.90206@aol.com>
Message-ID: <4F476AE7.8050508@rabbitmq.com>

On 23/02/12 18:37, DawgTool wrote:
> ps> I also recall making some config changes, but don't recall at the
> moment. I'll look at those later today.

That would be marvellous. Needless to say we've not been able to 
replicate this here.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From david.perez at ateofinance.com  Fri Feb 24 11:03:43 2012
From: david.perez at ateofinance.com (David Perez [Ateo])
Date: Fri, 24 Feb 2012 12:03:43 +0100
Subject: [rabbitmq-discuss] Problem connecting to Red Hat Messaging MRP
	using SSL
In-Reply-To: <4F476284.2060400@rabbitmq.com>
References: <01ae01ccf2db$f7021450$e5063cf0$@perez@ateofinance.com>
	<4F476284.2060400@rabbitmq.com>
Message-ID: <01b901ccf2e3$f9106140$eb3123c0$@perez@ateofinance.com>

Thanks a lot Simon. At least this is a really clear answer :)

David Perez 
ATEO -?Developer
Email : david.perez at ateofinance.com
Address : 5, rue Magellan, 75008 Paris, France


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon
MacMullen
Sent: vendredi 24 f?vrier 2012 11:12
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Problem connecting to Red Hat Messaging MRP
using SSL

On 24/02/12 10:06, David Perez [Ateo] wrote:
> Would you have any clue about this error ?

I'm not sure why it's coming back unknown-unknown, that's clearly wrong.

As far as I know, MRG moved to AMQP 0-10 some time ago - I don't know if 
they support AMQP 0-9-1 as used by RabbitMQ.

 > Is there a way to skip the protocol negotiation ?

No.

Unfortunately the different "versions" of AMQP tend to be *really* 
different from each other. 0-10 is a completely different beast from 
0-9-1 (*far* more complicated for a start, which is why we don't 
particularly intend to support it).

Sorry I can't give you better news.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Fri Feb 24 11:20:10 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 24 Feb 2012 11:20:10 +0000
Subject: [rabbitmq-discuss] Ensuring low latency for publishers
In-Reply-To: <b16ad838-4b64-4cae-8f07-b4d086332418@m3g2000pbi.googlegroups.com>
References: <1e665e68-b239-44a0-aecd-af98dec19d1d@qs5g2000pbc.googlegroups.com>	<4F43DB61.2030304@rabbitmq.com>	<e105cb4d-f320-4c04-8068-9c58a068ea05@x6g2000pbk.googlegroups.com>	<7dc34cad-d8f9-4903-a72d-cb3dfc2a4749@o4g2000pbc.googlegroups.com>	<4f4690a9-038d-4fdb-bce1-ae8c246a3247@ub4g2000pbc.googlegroups.com>	<20120222175207.GA29288@wellquite.org>
	<4F462C80.4080108@rabbitmq.com>	<4F462DE6.4060104@rabbitmq.com>
	<b16ad838-4b64-4cae-8f07-b4d086332418@m3g2000pbi.googlegroups.com>
Message-ID: <4F47726A.7000401@rabbitmq.com>

On 23/02/12 20:27, Eric wrote:
> Well... I would find it useful.  And the person in the thread I linked
> to would have found it useful as well.

Sure, I'm trying to gauge how widespread such a demand is. It looks like 
we could plausibly do something in this direction.

> It's pretty tough to go into a production environment with the
> statement "Publishing should be fast unless the broker is throttling.
> If the broker is throttling we won't be able to tell, we don't have a
> good way of knowing beforehand, and we don't know how long the threads
> will be blocked".  It's useful in any case where an application would
> rather not publish the message rather than waiting to publish it
> indefinitely.

Yeah, the problem is that we've historically optimised for Never 
Throwing Away Messages Ever Ever...

> The net result is that a struggling broker will cause a chain
> reaction; publishers will block indefinitely, which may bring the
> publishing application to a halt.  In that case I'd like to abandon
> the publishing process, but it's quite impossible at that point - it's
> too late, the broker is already throttling, and there's no timeout.
> The thread could block for seconds, or more.  I'm concerned about not
> throwing the message away, but I'm more concerned about being able to
> isolate services from RabbitMQ broker events.

If it's any consolation the flow control stuff that's coming in 2.8.0 
will make it much harder to make the memory alarm go off, so blocking 
for seconds should be much less likely.

> One more question along this line.  The flow control document says "By
> default, when the RabbitMQ server uses above 40% of the installed RAM,
> it raises a memory alarm... Connection heartbeat monitoring gets
> disabled too."  If I set up a connection heartbeat on the shared
> connection, will the heartbeat detect a broker alarm that exceeds the
> interval and disconnect?  A disconnect would terminate the publisher
> channels and free things up.

No - the whole point of disabling heartbeats is to make sure connections 
stay up when this happens...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Feb 24 11:21:18 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 24 Feb 2012 11:21:18 +0000
Subject: [rabbitmq-discuss] [help] [beginner] server stops sending
 messages; publish (in transaction) hangs on commit
In-Reply-To: <CAKYODbhLmeBovrh-DV1A-m9gTKch6jO8OF_52frAnBqT4vTGhw@mail.gmail.com>
References: <CAKYODbhUWBDy4KJQJO7OW2aRnw9LYkerLiNN8kG8=NAnO8FgPQ@mail.gmail.com>	<CABzX+qwJhotUDEshpfDJKyQKkXWv+uOci+fgY8m1RoX7R-UHXQ@mail.gmail.com>	<4F462A8E.3080509@rabbitmq.com>	<CAKYODbikMzvX_VC5z0Az8FHh+RHqxuppgMVBwS9OgLG=f6RZ2A@mail.gmail.com>	<4F467E08.3030505@rabbitmq.com>	<CAKYODbhKD3JyASyzzCZYeOGE1aMzApfsy-6jfW_bNFv4ATs77Q@mail.gmail.com>
	<CAKYODbhLmeBovrh-DV1A-m9gTKch6jO8OF_52frAnBqT4vTGhw@mail.gmail.com>
Message-ID: <4F4772AE.5060709@rabbitmq.com>

On 23/02/12 21:19, Alistair Bayley wrote:
> OK. I've just set the vm_memory_high_watermark to 0 and now the broker
> won't accept any messages. In the log:

Damn, that documentation was wrong. I've fixed it. Try setting it to 100...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Feb 24 11:38:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 24 Feb 2012 11:38:08 +0000
Subject: [rabbitmq-discuss] [help] [beginner] server stops sending
 messages; publish (in transaction) hangs on commit
In-Reply-To: <CAKYODbhKD3JyASyzzCZYeOGE1aMzApfsy-6jfW_bNFv4ATs77Q@mail.gmail.com>
References: <CAKYODbhUWBDy4KJQJO7OW2aRnw9LYkerLiNN8kG8=NAnO8FgPQ@mail.gmail.com>	<CABzX+qwJhotUDEshpfDJKyQKkXWv+uOci+fgY8m1RoX7R-UHXQ@mail.gmail.com>	<4F462A8E.3080509@rabbitmq.com>	<CAKYODbikMzvX_VC5z0Az8FHh+RHqxuppgMVBwS9OgLG=f6RZ2A@mail.gmail.com>	<4F467E08.3030505@rabbitmq.com>
	<CAKYODbhKD3JyASyzzCZYeOGE1aMzApfsy-6jfW_bNFv4ATs77Q@mail.gmail.com>
Message-ID: <4F4776A0.6020801@rabbitmq.com>

On 23/02/12 20:00, Alistair Bayley wrote:
> Just ran this:
>
> $ sudo rabbitmqctl eval
> 'lists:sublist(lists:reverse(lists:sort([{process_info(Pid,memory),
> Pid, process_info(Pid)} || Pid<- processes()])), 10).'
>
> (wait for a bit - about 30s or so...)
>
> Crash dump was written to: erl_crash.dump
> eheap_alloc: Cannot allocate 153052320 bytes of memory (of type "old_heap").
> Aborted
> $
>
> hmmm....

Hmm indeed. If it ran out of memory doing that, then that implies you 
might have a ton of processes hanging around for some reason. Either 
that or you were very close to the edge anyway.

rabbitmqctl eval 'length(processes()).' will tell you how many processes 
are in use in total.

So you may want to try the second rabbitmqctl eval command above, and 
then the first one with more memory available to the server.

>> Having said that, 100Mb for an idle server does not seem totally
>> unreasonable - RabbitMQ is not optimised for small memory use when idle.
>
> OK. Can I have some guidance as to how much memory we should allocate?

This is a real how-long-is-a-piece-of-string question I'm afraid. 512M 
would already be a significant step towards the comfort zone though.

> Also, I see from the tcpdump capture that the server does not send
> back a response to the Tx.Commit, which presumably makes it difficult
> for the client to detect that the message has not been accepted (other
> than timeout). Indeed, the basic_publish returns nothing immediately,
> although that could be a feature of the amqplib library. Is there an
> option to get the server to return something that says that it is not
> accepting messages?

In ancient history we used to do this; there's a method in AMQP 0-9-1 
called channel.flow which the server should be able to use to tell a 
client to shut up. In practice it was unreliable (client may not support 
it, or may take too long to take notice of it).

We could just send channel.flows informationally but again this would 
require client support.

I am currently wondering about modifying our clients so they have a 
non-blocking publish (see the thread "Ensuring low latency for 
publishers"). This should not be too hard to do. However, this might not 
help when using transactions. OTOH blocking in such a way that we don't 
send back a tx.commit is unhelpful; I'll see how easy it would be to 
change this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Feb 24 12:22:22 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 24 Feb 2012 12:22:22 +0000
Subject: [rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
In-Reply-To: <CACLE7iyzMhn7wJm8=-RKjQHrYZ5e4hFCLST93em0FW9KJd01Nw@mail.gmail.com>
References: <CB69271E.2EDC1%mpietrek@skytap.com>	<4F44D546.200@rabbitmq.com>	<CACLE7iwXrRpgqZeiMr7yJ=CJ6EjP1wYEU=Z+M+tKesu9=x86CA@mail.gmail.com>	<CACLE7ixq2WEZxiCyWrWfoXBC=UMRRvg0Y9yW33ru4Atsf4R5uw@mail.gmail.com>	<CACLE7iwV0+k6d__8kUG3KCNi4UsSJ6NaP412mgn8v9gTiZD2Mg@mail.gmail.com>	<4F462871.4070602@rabbitmq.com>
	<CACLE7iyzMhn7wJm8=-RKjQHrYZ5e4hFCLST93em0FW9KJd01Nw@mail.gmail.com>
Message-ID: <4F4780FE.1060609@rabbitmq.com>

On 23/02/12 21:00, Matt Pietrek wrote:
> The nohup.out on the failing node ends with:

<snip>

> starting database                                                     ...

So how long are you waiting when determining it's hanging? Less than 30 
seconds?

Because that looks like Rabbit is waiting for another cluster node (if 
it was not the last to shut down, but is the first to start up, it will 
wait for the one that was the last to shut down. But it will only wait 
for 30 seconds before spitting out an error. I'm not sure how else you 
could get it to stop there *without* any further output though.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From kamaradclimber at gmail.com  Fri Feb 24 13:09:50 2012
From: kamaradclimber at gmail.com (=?UTF-8?Q?Gr=C3=A9goire_Seux?=)
Date: Fri, 24 Feb 2012 14:09:50 +0100
Subject: [rabbitmq-discuss] Possible bug when disposing connections in .NET
	client 2.7.0/1
Message-ID: <CAE3ghBsdCmMuSnm+7zkkPhxVpFErR70Qs2Ge4peynRRb-7HuUQ@mail.gmail.com>

Hi,

I got a strange error after having upgraded to rabbitmq .NET client 2.7.1.
This has been previously discussed in :
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-December/017068.html

but the bug tracker does not seem to be accessible and there is no further
answer to this thread.
Do you know if the issue has been fixed ?

Any answer will be appreciated :-)
Regards,

-- 
Greg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120224/8514102f/attachment.htm>

From simon at rabbitmq.com  Fri Feb 24 13:12:15 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 24 Feb 2012 13:12:15 +0000
Subject: [rabbitmq-discuss] Possible bug when disposing connections in
 .NET	client 2.7.0/1
In-Reply-To: <CAE3ghBsdCmMuSnm+7zkkPhxVpFErR70Qs2Ge4peynRRb-7HuUQ@mail.gmail.com>
References: <CAE3ghBsdCmMuSnm+7zkkPhxVpFErR70Qs2Ge4peynRRb-7HuUQ@mail.gmail.com>
Message-ID: <4F478CAF.9040901@rabbitmq.com>

On 24/02/12 13:09, Gr?goire Seux wrote:
> Do you know if the issue has been fixed ?

Yes, it will be in the next release.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Fri Feb 24 13:37:43 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 24 Feb 2012 13:37:43 +0000
Subject: [rabbitmq-discuss] Design for Comet
In-Reply-To: <CALKcMwLih8m2nR9rDn9mhdLC8AaOd=TKzhAM6wuOuABg_z_6zA@mail.gmail.com>
References: <CALKcMwLih8m2nR9rDn9mhdLC8AaOd=TKzhAM6wuOuABg_z_6zA@mail.gmail.com>
Message-ID: <CABzX+qx23akhSjojHeQ+7ooKCYpLJYQ4FrdBnOufbY2eYOm5Pg@mail.gmail.com>

On Thu, Feb 23, 2012 at 16:54, tsuraan <tsuraan at gmail.com> wrote:
> We have a comet-like server that has four basic tiers of messages:
> page-level, user-level, topic, and global. ?When a page is rendered
> that hooks into the comet system, it initially subscribes to the comet
> server using a POST with the tiers that it wants, and then it uses GET
> to wait on new messages using long-polling. ?To support this, I've
> made a somewhat overly-complicated server that does a lot of internal
> queueing, but is ultimately backed by Rabbit.
>
> I've been looking at simplifying this, but first I thought I'd run it
> past you guys, since I think my idea may have some components that
> rabbit would hate. ?Basically, what I want to do is make a short-lived
> (and non-durable) queue per page (where a single page is dynamic, so
> it tends to live for a while), and then have that queue be subscribed
> to a "global" exchange, a "user" exchange, and a "topics" exchange.

Does it mean that every page is user specific? Or is "user" exchange
not for per-user messages but rather global ones?

> I see that Rabbit now has a queue-expiry extension, so unused queues
> could be automatically garbage collected (I was thinking of basically
> having a 10s idle timeout on my temp queues).

I'm not sure what your scale is, but this setup has a good property -
it should be relatively easy to shard it. So it's generally reasonable.

>?My concern is whether
> rabbit likes having thousands or tens of thousands of queues created
> and torn down every few minutes. ?I seem to recall that it didn't like
> that at all in the past, but Rabbit's been progressing like mad
> lately, so I figured I'd ask if that's a sane thing to do these days.

Like always - you need to prototype and benchmark it :)

But generally, I would probably go for a different setup.

I think we can assume with reasonable confidence that number
of concurrent users on your site is constant. (as opposed to
dynamic pages AFAIU)

So why not create queue-per-user? (for users actively browsing).

When user enters a page - you can subscribe the queue to a per-page
exchange. When user navigates away - you unsubscribe.

Of course, this has some limitations - you may want to buffer
data per-page, and this setup can't do that easily (you would
need to use redis or something for that).

Hope that helps,
  Marek

From kamaradclimber at gmail.com  Fri Feb 24 14:14:21 2012
From: kamaradclimber at gmail.com (=?UTF-8?Q?Gr=C3=A9goire_Seux?=)
Date: Fri, 24 Feb 2012 15:14:21 +0100
Subject: [rabbitmq-discuss] Possible bug when disposing connections in
 .NET client 2.7.0/1
In-Reply-To: <4F478CAF.9040901@rabbitmq.com>
References: <CAE3ghBsdCmMuSnm+7zkkPhxVpFErR70Qs2Ge4peynRRb-7HuUQ@mail.gmail.com>
	<4F478CAF.9040901@rabbitmq.com>
Message-ID: <CAE3ghBs6gaEg=iMm7=FqDXVjh7hcwZZ5usouE2p5EePZy8-s_A@mail.gmail.com>

Thanks Simon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120224/f77cd6fd/attachment.htm>

From steve at rabbitmq.com  Fri Feb 24 15:06:42 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 24 Feb 2012 15:06:42 +0000
Subject: [rabbitmq-discuss] Regarding C++
In-Reply-To: <03B74058-6798-4061-8E81-F4BB77929735@rabbitmq.com>
References: <CEE0C758004FF3408989AAB1547146060279315E@inicx002.in.int.atosorigin.com>
	<662F069D-654A-4FA4-93D7-D8CD9F3D46E5@rabbitmq.com>
	<CEE0C758004FF3408989AAB154714606027935D4@inicx002.in.int.atosorigin.com>
	<03B74058-6798-4061-8E81-F4BB77929735@rabbitmq.com>
Message-ID: <BADE9D6A-6361-4607-B1C7-1D2BDBB709D7@rabbitmq.com>

Just putting this on the m/l.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 24 Feb 2012, at 15:05, Steve Powell wrote:

> Sonali,
> 
> This is not our client code base, but if you go to
> https://github.com/cbusbey/rabbitmq-cpp#readme
> (at the top of the GitHub rabbitmq-cpp repository)
> you should find some instructions, which
> ought to be sufficient for building the examples!
> 
> It seems to say you need rabbitmq-c as well.
> 
> Sorry I can't give you explicit guidance, but it is a
> case of asking the community; try messaging Chris
> Busbey (cbusbey -- owner of the rabbitmq-cpp
> github repo) for more help.
> 
> Steve Powell
> steve at rabbitmq.com
> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
> 
> On 24 Feb 2012, at 10:35, Abhonkar, Sonali wrote:
> 
>> Hi Steve,
>> 
>> I tried following code from
>> https://github.com/cbusbey/rabbitmq-cpp/blob/master/examples/producer.cc
>> 
>> 
>> #include <iostream>
>> #include <client.h>
>> 
>> using namespace rabbitmqcpp;
>> 
>> int main(int argc, char * argv[])
>> {
>> if(argc < 5)
>> {
>>   std::cout << "usage: producer <host> <port> <exchange> <routing key>
>> <message>" << std::endl;
>>   return 1;
>> }
>> 
>> char const * host = argv[1];
>> int port = atoi(argv[2]);
>> char const * exchange = argv[3];
>> char const * routingkey = argv[4];
>> char const * message = argv[5];
>> 
>> Client c(host, port);
>> c.connect();
>> 
>> c.send(exchange, routingkey, message, strlen(message));
>> }
>> 
>> I have to include client.h file in my project?
>> In client.h there again another header files.
>> I want to know what are libraries are needed to communicate with AMQP,
>> How to compile & build the code. Can you please provide me steps.
>> 
>> Thanks,
>> Sonali
>> 
>> 
>> 
>> -----Original Message-----
>> From: Steve Powell [mailto:steve at rabbitmq.com] 
>> Sent: Thursday, February 23, 2012 6:27 PM
>> To: Abhonkar, Sonali
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] Regarding C++
>> 
>> Sonali,
>> 
>> You might like to check out the C/C++ clients that have been developed
>> by the
>> RabbitMQ Community. See the list at
>> (http://www.rabbitmq.com/devtools.html#c-dev).
>> 
>> Steve Powell
>> steve at rabbitmq.com
>> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
>> 
>> On 23 Feb 2012, at 11:56, Abhonkar, Sonali wrote:
>> 
>>> Hi,
>>> 
>>> First time I am working on messaging. So I am not able to do it using
>> rabbitMQ.
>>> My aim is to write a code in C++, to transfer message   "Hi World" to
>> other machine using RabbitMQ.
>>> Can you please help me in this.
>>> 
>>> Thanks & Regards,
>>> Sonali.
>>> 
>>> This e-mail and the documents attached are confidential and intended
>> solely for the addressee; it may also be privileged. If you receive this
>> e-mail in error, please notify the sender immediately and destroy it. As
>> its integrity cannot be secured on the Internet, the Atos group
>> liability cannot be triggered for the message content. Although the
>> sender endeavors to maintain a computer virus-free network, the sender
>> does not warrant that this transmission is virus-free and will not be
>> liable for any damages resulting from any virus transmitted.
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> 
>> 
>> This e-mail and the documents attached are confidential and intended solely for the addressee; it may also be privileged. If you receive this e-mail in error, please notify the sender immediately and destroy it. As its integrity cannot be secured on the Internet, the Atos group liability cannot be triggered for the message content. Although the sender endeavors to maintain a computer virus-free network, the sender does not warrant that this transmission is virus-free and will not be liable for any damages resulting from any virus transmitted.
>> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120224/8d7cbeb6/attachment.htm>

From tsuraan at gmail.com  Fri Feb 24 16:13:25 2012
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 24 Feb 2012 10:13:25 -0600
Subject: [rabbitmq-discuss] Design for Comet
In-Reply-To: <CABzX+qx23akhSjojHeQ+7ooKCYpLJYQ4FrdBnOufbY2eYOm5Pg@mail.gmail.com>
References: <CALKcMwLih8m2nR9rDn9mhdLC8AaOd=TKzhAM6wuOuABg_z_6zA@mail.gmail.com>
	<CABzX+qx23akhSjojHeQ+7ooKCYpLJYQ4FrdBnOufbY2eYOm5Pg@mail.gmail.com>
Message-ID: <CALKcMwJNm50LrPekfNSRkaNd322gYWSctg_KdQNs-vxVTe12dw@mail.gmail.com>

> Does it mean that every page is user specific? Or is "user" exchange
> not for per-user messages but rather global ones?

The user exchange is for messages that are addressed to specific
users, so every web page that a given user has open (on all their
different browsers, etc) would get all messages addressed to that
user.  Global messages get sent to all pages that are opened in all
browsers, topic messages get sent to all subscribers to a topic, and
there are "page" messages that are targeted towards a specific
instance of a page (i.e. a specific tab that's opened on one of our
pages).

> Like always - you need to prototype and benchmark it :)

Yeah, I'm really wondering about hidden things, like "that will work
for a week, but then mnesia will start on fire" or something to that
effect :)

> But generally, I would probably go for a different setup.
>
> I think we can assume with reasonable confidence that number
> of concurrent users on your site is constant. (as opposed to
> dynamic pages AFAIU)
>
> So why not create queue-per-user? (for users actively browsing).
>
> When user enters a page - you can subscribe the queue to a per-page
> exchange. When user navigates away - you unsubscribe.

Ok, I think I'm missing something.  Are you saying to create per-page
exchanges rather than per-page queues, and then subscribe the
exchanges to queues?  Is it cheaper to create exchanges than to create
queues?  Also, binding a queue to an exchange isn't something I was
aware could be done; does it just use the normal queue.bind command,
but putting the exchange name where the queue name normally goes, and
vice versa?

> Hope that helps,
> ?Marek

It's an idea that I had never thought of, anyhow :)  Thanks!

From majek04 at gmail.com  Fri Feb 24 16:57:53 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 24 Feb 2012 16:57:53 +0000
Subject: [rabbitmq-discuss] Design for Comet
In-Reply-To: <CALKcMwJNm50LrPekfNSRkaNd322gYWSctg_KdQNs-vxVTe12dw@mail.gmail.com>
References: <CALKcMwLih8m2nR9rDn9mhdLC8AaOd=TKzhAM6wuOuABg_z_6zA@mail.gmail.com>
	<CABzX+qx23akhSjojHeQ+7ooKCYpLJYQ4FrdBnOufbY2eYOm5Pg@mail.gmail.com>
	<CALKcMwJNm50LrPekfNSRkaNd322gYWSctg_KdQNs-vxVTe12dw@mail.gmail.com>
Message-ID: <CABzX+qyfTEM4Yzmb3d5+HjDAQN5xJTtVAZyd3VL5c+v=6ne_Rg@mail.gmail.com>

On Fri, Feb 24, 2012 at 16:13, tsuraan <tsuraan at gmail.com> wrote:
>> Does it mean that every page is user specific? Or is "user" exchange
>> not for per-user messages but rather global ones?
>
> The user exchange is for messages that are addressed to specific
> users, so every web page that a given user has open (on all their
> different browsers, etc) would get all messages addressed to that
> user. ?Global messages get sent to all pages that are opened in all
> browsers, topic messages get sent to all subscribers to a topic, and
> there are "page" messages that are targeted towards a specific
> instance of a page (i.e. a specific tab that's opened on one of our
> pages).
>
>> Like always - you need to prototype and benchmark it :)
>
> Yeah, I'm really wondering about hidden things, like "that will work
> for a week, but then mnesia will start on fire" or something to that
> effect :)
>
>> But generally, I would probably go for a different setup.
>>
>> I think we can assume with reasonable confidence that number
>> of concurrent users on your site is constant. (as opposed to
>> dynamic pages AFAIU)
>>
>> So why not create queue-per-user? (for users actively browsing).
>>
>> When user enters a page - you can subscribe the queue to a per-page
>> exchange. When user navigates away - you unsubscribe.
>
> Ok, I think I'm missing something. ?Are you saying to create per-page
> exchanges rather than per-page queues, and then subscribe the
> exchanges to queues? ?Is it cheaper to create exchanges than to create
> queues?

Yes, exchanges have no state, while queues actually store data.
Exchanges - light, Queues - heavy.

> Also, binding a queue to an exchange isn't something I was
> aware could be done; does it just use the normal queue.bind command,
> but putting the exchange name where the queue name normally goes, and
> vice versa?

I said:
>> When user enters a page - you can subscribe the queue to a per-page
>> exchange. When user navigates away - you unsubscribe.

So, I suggest to bind the per-user-queue to an per-page-exchange.
(or, bind per-user-queue to a all-pages-exchange but with a binding
key that will catch only messages flying to the particular page
on which the user is right now)

Marek

From ejarendt at gmail.com  Fri Feb 24 18:07:38 2012
From: ejarendt at gmail.com (Eric)
Date: Fri, 24 Feb 2012 10:07:38 -0800 (PST)
Subject: [rabbitmq-discuss] Ensuring low latency for publishers
In-Reply-To: <4F47726A.7000401@rabbitmq.com>
References: <1e665e68-b239-44a0-aecd-af98dec19d1d@qs5g2000pbc.googlegroups.com>
	<4F43DB61.2030304@rabbitmq.com>
	<e105cb4d-f320-4c04-8068-9c58a068ea05@x6g2000pbk.googlegroups.com>
	<7dc34cad-d8f9-4903-a72d-cb3dfc2a4749@o4g2000pbc.googlegroups.com>
	<4f4690a9-038d-4fdb-bce1-ae8c246a3247@ub4g2000pbc.googlegroups.com>
	<20120222175207.GA29288@wellquite.org> <4F462C80.4080108@rabbitmq.com>
	<4F462DE6.4060104@rabbitmq.com>
	<b16ad838-4b64-4cae-8f07-b4d086332418@m3g2000pbi.googlegroups.com>
	<4F47726A.7000401@rabbitmq.com>
Message-ID: <a94ae5aa-189f-4071-a61d-af847232753e@vj8g2000pbc.googlegroups.com>

> Sure, I'm trying to gauge how widespread such a demand is. It looks like
> we could plausibly do something in this direction.

Seems like it's not very widespread.  That's fine - I'm probably
pushing towards a less common use case.  We can deal with somewhat
unreliable messaging but we'd really like a broker.  0MQ is great for
unreliable messaging but it's brokerless, and we'd rather not write
our own broker.  RabbitMQ has a great broker, it's just sort of...
narcissistic.  :)

> If it's any consolation the flow control stuff that's coming in 2.8.0
> will make it much harder to make the memory alarm go off, so blocking
> for seconds should be much less likely.

In reality, the throttling case is extremely unlikely anyway, right?
You basically have to create a case where publishers are outpacing
consumers and/or the speed of disk writes on the broker.  So you'd
have to publish something like 100mb/s with little or no consumption,
and our application is roughly 5mb/minute.  So we'd probably never
throttle.  It's just that having some kind of guarantee is nice from
an operational standpoint.

In conclusion, I finally did what I should have done in the first
place.  I mocked up the threading scenario we're likely to see in
production and benchmarked it against Java's LinkedBlockingQueue and
ArrayBlockingQueue.  Compared to each producer thread having its own
linked list (the completely uncontended scenario) the blocking queues
introduced virtually no additional waiting - a microsecond or two at
most.  That's the case even at rates 50x or more than we'd see in
production.  So blocking queue it is, and that's a comfortingly simple
solution.

Thanks for all the help and apologies for under-researching what I was
doing.

 - Eric

On Feb 24, 3:20?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 23/02/12 20:27, Eric wrote:
>
> > Well... I would find it useful. ?And the person in the thread I linked
> > to would have found it useful as well.
>
> Sure, I'm trying to gauge how widespread such a demand is. It looks like
> we could plausibly do something in this direction.
>
> > It's pretty tough to go into a production environment with the
> > statement "Publishing should be fast unless the broker is throttling.
> > If the broker is throttling we won't be able to tell, we don't have a
> > good way of knowing beforehand, and we don't know how long the threads
> > will be blocked". ?It's useful in any case where an application would
> > rather not publish the message rather than waiting to publish it
> > indefinitely.
>
> Yeah, the problem is that we've historically optimised for Never
> Throwing Away Messages Ever Ever...
>
> > The net result is that a struggling broker will cause a chain
> > reaction; publishers will block indefinitely, which may bring the
> > publishing application to a halt. ?In that case I'd like to abandon
> > the publishing process, but it's quite impossible at that point - it's
> > too late, the broker is already throttling, and there's no timeout.
> > The thread could block for seconds, or more. ?I'm concerned about not
> > throwing the message away, but I'm more concerned about being able to
> > isolate services from RabbitMQ broker events.
>
> If it's any consolation the flow control stuff that's coming in 2.8.0
> will make it much harder to make the memory alarm go off, so blocking
> for seconds should be much less likely.
>
> > One more question along this line. ?The flow control document says "By
> > default, when the RabbitMQ server uses above 40% of the installed RAM,
> > it raises a memory alarm... Connection heartbeat monitoring gets
> > disabled too." ?If I set up a connection heartbeat on the shared
> > connection, will the heartbeat detect a broker alarm that exceeds the
> > interval and disconnect? ?A disconnect would terminate the publisher
> > channels and free things up.
>
> No - the whole point of disabling heartbeats is to make sure connections
> stay up when this happens...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mpietrek at skytap.com  Fri Feb 24 21:43:14 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 24 Feb 2012 13:43:14 -0800
Subject: [rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
In-Reply-To: <4F4780FE.1060609@rabbitmq.com>
References: <CB69271E.2EDC1%mpietrek@skytap.com> <4F44D546.200@rabbitmq.com>
	<CACLE7iwXrRpgqZeiMr7yJ=CJ6EjP1wYEU=Z+M+tKesu9=x86CA@mail.gmail.com>
	<CACLE7ixq2WEZxiCyWrWfoXBC=UMRRvg0Y9yW33ru4Atsf4R5uw@mail.gmail.com>
	<CACLE7iwV0+k6d__8kUG3KCNi4UsSJ6NaP412mgn8v9gTiZD2Mg@mail.gmail.com>
	<4F462871.4070602@rabbitmq.com>
	<CACLE7iyzMhn7wJm8=-RKjQHrYZ5e4hFCLST93em0FW9KJd01Nw@mail.gmail.com>
	<4F4780FE.1060609@rabbitmq.com>
Message-ID: <CACLE7iwzkasgaJ96RhRQ4jp1QL2kKF2ab8-PJHj=O3YPw9JWnA@mail.gmail.com>

| So how long are you waiting when determining it's hanging? Less than 30
seconds?

Just to be double sure, I let it sit for an hour yesterday. I would have
expected a timeout, but it never came.

It's a pretty easy scenario to script and try out. I'd send you my code,
but it relies on other internal commands.

There may also be a timing issue. If I put a 10 second delay after
restarting one broker, and before stopping the next, it seems to help.

That is:

for x in broker_list:
    stop x
    start x
    sleep(10)

Matt

On Fri, Feb 24, 2012 at 4:22 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 23/02/12 21:00, Matt Pietrek wrote:
>
>> The nohup.out on the failing node ends with:
>>
>
> <snip>
>
>  starting database                                                     ...
>>
>
> So how long are you waiting when determining it's hanging? Less than 30
> seconds?
>
> Because that looks like Rabbit is waiting for another cluster node (if it
> was not the last to shut down, but is the first to start up, it will wait
> for the one that was the last to shut down. But it will only wait for 30
> seconds before spitting out an error. I'm not sure how else you could get
> it to stop there *without* any further output though.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120224/11ea4200/attachment.htm>

From pbell at syncsort.com  Fri Feb 24 23:11:32 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Fri, 24 Feb 2012 18:11:32 -0500
Subject: [rabbitmq-discuss] Another Naive Question
In-Reply-To: <4F465585.6030500@rabbitmq.com>
References: <CB602924.2DF9C%mpietrek@skytap.com><4F3B8435.2040401@rabbitmq.com><CACLE7iwUVeao_ceQdUr-y43srcNVrk+R5R9OBOiZxGG8FZ4O
	nA@mail.gmail.com><4F3BED29.6050602@rabbitmq.com><CACLE7iyaxmc0pJZ+gzNXa93da13s1iiStApp-A58BYPmmHkejw@mail.gmail.com><4F3E4A8E.
	8060807@rabbitmq.com><CACLE7iw0zRurNgeNRO7aO3AesLrYDvkSr6vm1vGL8kdyKoL-mQ@mail.gmail.com><20120220112803.GA5917@rabbitmq.com>
	<CACLE7izPH9h9wivEsKbJ3NK4_qXAkJuecZd0O7XCtByzy0BH6w@mail.gmail.com><AF4AD4ADFB23054CB4C75F50FF8C40B73B40694AA4@MAILCCR.us.sync
	sort.com> <4F465585.6030500@rabbitmq.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40694CA7@MAILCCR.us.syncsort.com>

Thanks, Simon.

I realize, now, that I had put a very na?ve question.

Maybe these will be less so and, consequently, more interesting:

What is a "best practices" way of handling the following:

a. broker dies (maybe it's down for several minutes)
b. in-flight producers and consumers remain up, trying to do their thing. In my case, the producer merely produces, but consumer both consumes and produces.

I assume that producer will, with next attempt at publishing to the exchange, get some kind exception/error (econnreset?) Is this correct? But if the consumer is subscribed to the queue (and I assume this means that it employs some variant of a MessageListenerContainer), will it receive any error at all?

Assuming that at least the producer gets an error, I suppose it could simply cease sending messages and perhaps periodically check that broker is back up. How best to do that, e.g., every Nth msg actually try to send it to the exchange and see what happens?

Then there's the matter of exchange/queue durability. Suppose that neither the producer nor consumer declared (created) the queues they are dealing with (some other component might have created them). Broker is again available, but the non-durable queues no longer exist AND neither producer nor consumer has the logic to declare them. Is the answer here simply to make the exchange and queues durable? In this way, I think, the exchange/queues are always there so neither P nor C need declare them. Or, is it better for components always to declare any queue that they will use (given the idempotency of declaring a queue)?

Thanks again, everyone.

-Paul



-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: Thursday, February 23, 2012 10:05 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Another Naive Question

On 23/02/12 14:54, Bell, Paul M. wrote:
> Is there any problem with multiple Producers publishing to the same
> queue? I assume that this presents no problem to Rabbit - but I just
> need to be certain.

No, not at all. That's a large part of the point :-)

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From moseley at hank.org  Fri Feb 24 23:25:23 2012
From: moseley at hank.org (Bill Moseley)
Date: Sat, 25 Feb 2012 06:25:23 +0700
Subject: [rabbitmq-discuss] Centralized web logging options.
Message-ID: <CAKhN_m5bViVyThm-2_2AwvDY5QKtL_by=J9N-gONk-ZrkvcH_w@mail.gmail.com>

We have a busy pool of web servers running Apache that are currently
logging on each machine.  I'm looking at using RabbitMQ and a centralized
log server.

I have no concerns about RabbitMQ handling the traffic, and no concerns
about getting the logs into the queue.

Anyone here doing this currently?

What log collection/aggregator tools are you using?

What's was required to read the logs off the queues?

Do you have multiple aggregators running (say for HA or redundancy)?

Any other experiences you can share setting this up?



-- 
Bill Moseley
moseley at hank.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120225/6712d3c1/attachment.htm>

From pbell at syncsort.com  Fri Feb 24 23:29:30 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Fri, 24 Feb 2012 18:29:30 -0500
Subject: [rabbitmq-discuss] Redelivery to Multiple Consumers
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40694CA7@MAILCCR.us.syncsort.com>
References: <CB602924.2DF9C%mpietrek@skytap.com><4F3B8435.2040401@rabbitmq.com><CACLE7iwUVeao_ceQdUr-y43srcNVrk+R5R9OBOiZxGG8FZ4O
	nA@mail.gmail.com><4F3BED29.6050602@rabbitmq.com><CACLE7iyaxmc0pJZ+gzNXa93da13s1iiStApp-A58BYPmmHkejw@mail.gmail.com><4F3E4A8E.
	8060807@rabbitmq.com><CACLE7iw0zRurNgeNRO7aO3AesLrYDvkSr6vm1vGL8kdyKoL-mQ@mail.gmail.com><20120220112803.GA5917@rabbitmq.com><C
	ACLE7izPH9h9wivEsKbJ3NK4_qXAkJuecZd0O7XCtByzy0BH6w@mail.gmail.com><AF4AD4ADFB23054CB4C75F50FF8C40B73B40694AA4@MAILCCR.us.syncso
	rt.com> <4F465585.6030500@rabbitmq.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B40694CA7@MAILCCR.us.syncsort.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B40694CB5@MAILCCR.us.syncsort.com>

Hi,

Imagine multiple consumers reading from same queue. It's a fanout exchange so each C is getting a subset of the messages in the queue. In response to a message, C1 starts some long-running task; but C1 does not ACK the message (C1 won't ACK it until the long-running task has finished). Now C1 dies.

As I've learned on this list, after detecting the broken connection between it and C1, the broker will redeliver the consumed yet un-ACKed message.

Is the broker free to redeliver that message to *another* consumer, C2; or will it redeliver only to C1 when it comes back on-line?

Thank you.

-Paul



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From liuzhuofu at huawei.com  Sat Feb 25 02:54:40 2012
From: liuzhuofu at huawei.com (Liuzhuofu)
Date: Sat, 25 Feb 2012 02:54:40 +0000
Subject: [rabbitmq-discuss] =?gb2312?b?ILTwuLQ6ICBQYXNzaXZlIHF1ZXVlIGRl?=
 =?gb2312?b?Y2xhcmF0aW9uIGFuZCBjaGFubmVsIGNsb3N1cmU=?=
In-Reply-To: <CAOn7oW_QumnbXwHO-boNBU9DrXpMHmY+iYBBX8EXR5pWdLFP8Q@mail.gmail.com>
References: <88E590DC4586974D825FC82AE798294E520F1E82@GSVCLU04.ges.ferlan.it>
	<73831E29-46BF-464A-A9B9-CA040F734011@rabbitmq.com>
	<CAOn7oW_QumnbXwHO-boNBU9DrXpMHmY+iYBBX8EXR5pWdLFP8Q@mail.gmail.com>
Message-ID: <D027DE656EBD4F4C8EE57361B5EF438E39924E5D@szxeml524-mbx.china.huawei.com>

Hi all:
    I have met the problem too. I know how to change my client code to fix it.
    And I have a question, problem or skill like this can only be found in the mail-list, but there is no document describe them full-scale. In my opinion, this is a big  difficulty for all the developers on Rabbit-MQ.

Regards,
David
________________________________
???: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] ?? Simone Busoli [simone.busoli at gmail.com]
????: 2012?2?22? 5:18
?: Steve Powell
Cc: rabbitmq-discuss at lists.rabbitmq.com
??: Re: [rabbitmq-discuss] Passive queue declaration and channel closure


Thanks Steve, that's pretty much what Simon had already clarified, and I agreed that changing this behavior is not practical.

On Feb 21, 2012 2:24 PM, "Steve Powell" <steve at rabbitmq.com<mailto:steve at rabbitmq.com>> wrote:
Simone,

Replies in-line below..

I don't think this is likely to change in the near future, since it
would be disruptive to most clients that use this.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 16 Feb 2012, at 17:10, Busoli, Simone wrote:

> Without relying on the management plugin I think the only way to do that is to
> declare the queue as passive. At least with the .NET client and apparently the
> Java client too, when the queue does not exist, besides throwing an exception,
> the channel is closed as well. From the spec:
>
> If set, the server will reply with Declare-Ok if the queue already exists with
> the same name, and raise an error if not. The client can use this to check
> whether a queue exists without modifying the server state.

The spec goes on to say:

 The client MAY ask the server to assert that a queue exists without creating
 the queue if not. If the queue does not exist, the server treats this as a
 failure. Error code: not-found

> There is no mention of channel closure, while the last sentence implies that
> using the passive bit is indeed a way for a client to check queue existence, so
> closing the channel when it doesn?t is a bit unexpected. That said, it?s not a
> big deal to recreate the channel in such cases, but I?d appreciate your opinion.
> Any chance this behavior can be changed in the client libraries?

This is the mention of channel-closure -- an 'error' raised on the channel will
close it.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120225/7bce25bd/attachment.htm>

From simone.busoli at gmail.com  Sat Feb 25 18:37:55 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sat, 25 Feb 2012 19:37:55 +0100
Subject: [rabbitmq-discuss] =?gb2312?b?tPC4tDogIFBhc3NpdmUgcXVldWUgZGVj?=
	=?gb2312?b?bGFyYXRpb24gYW5kIGNoYW5uZWwgY2xvc3VyZQ==?=
In-Reply-To: <D027DE656EBD4F4C8EE57361B5EF438E39924E5D@szxeml524-mbx.china.huawei.com>
References: <88E590DC4586974D825FC82AE798294E520F1E82@GSVCLU04.ges.ferlan.it>
	<73831E29-46BF-464A-A9B9-CA040F734011@rabbitmq.com>
	<CAOn7oW_QumnbXwHO-boNBU9DrXpMHmY+iYBBX8EXR5pWdLFP8Q@mail.gmail.com>
	<D027DE656EBD4F4C8EE57361B5EF438E39924E5D@szxeml524-mbx.china.huawei.com>
Message-ID: <CAOn7oW_rgYW37zQZGqKCOoN8uW3FvkYCHCHRuiBgH8pa11NC4A@mail.gmail.com>

David, I somewhat agree with you, lack of documentation about operational
aspects of broker behavior is something I have been missing as well. That
said it's usually not so difficult to overcome as it's fortunately quite
easy to explore the behavior of the broker under certain circumstances, and
it may take less than waiting for a reply on the mailing list!

On Sat, Feb 25, 2012 at 03:54, Liuzhuofu <liuzhuofu at huawei.com> wrote:

>  Hi all:
>     I have met the problem too. I know how to change my client code to fix
> it.
>     And I have a question, problem or skill like this can only be found in
> the mail-list, but there is no document describe them full-scale. In my
> opinion, this is a big  difficulty for all the developers on Rabbit-MQ.
>
>  Regards,
> David
>  ------------------------------
> *???:* rabbitmq-discuss-bounces at lists.rabbitmq.com [
> rabbitmq-discuss-bounces at lists.rabbitmq.com] ?? Simone Busoli [
> simone.busoli at gmail.com]
> *????:* 2012?2?22? 5:18
> *?:* Steve Powell
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *??:* Re: [rabbitmq-discuss] Passive queue declaration and channel closure
>
>   Thanks Steve, that's pretty much what Simon had already clarified, and
> I agreed that changing this behavior is not practical.
> On Feb 21, 2012 2:24 PM, "Steve Powell" <steve at rabbitmq.com> wrote:
>
>> Simone,
>>
>> Replies in-line below..
>>
>> I don't think this is likely to change in the near future, since it
>> would be disruptive to most clients that use this.
>>
>> Steve Powell  (a happy bunny)
>> ----------some more definitions from the SPD----------
>> vermin (v.) Treating the dachshund for roundworm.
>> chinchilla (n.) Cooling device for the lower jaw.
>> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>>
>> On 16 Feb 2012, at 17:10, Busoli, Simone wrote:
>>
>> > Without relying on the management plugin I think the only way to do
>> that is to
>> > declare the queue as passive. At least with the .NET client and
>> apparently the
>> > Java client too, when the queue does not exist, besides throwing an
>> exception,
>> > the channel is closed as well. From the spec:
>> >
>> > If set, the server will reply with Declare-Ok if the queue already
>> exists with
>> > the same name, and raise an error if not. The client can use this to
>> check
>> > whether a queue exists without modifying the server state.
>>
>> The spec goes on to say:
>>
>>  The client MAY ask the server to assert that a queue exists without
>> creating
>>  the queue if not. If the queue does not exist, the server treats this as
>> a
>>  failure. Error code: not-found
>>
>> > There is no mention of channel closure, while the last sentence implies
>> that
>> > using the passive bit is indeed a way for a client to check queue
>> existence, so
>> > closing the channel when it doesn?t is a bit unexpected. That said,
>> it?s not a
>> > big deal to recreate the channel in such cases, but I?d appreciate your
>> opinion.
>> > Any chance this behavior can be changed in the client libraries?
>>
>> This is the mention of channel-closure -- an 'error' raised on the
>> channel will
>> close it.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120225/b4345dff/attachment.htm>

From visionofarun at gmail.com  Sun Feb 26 09:02:36 2012
From: visionofarun at gmail.com (Arun Chandrasekaran)
Date: Sun, 26 Feb 2012 01:02:36 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-c: Nonblocking recv
In-Reply-To: <CAAt2poJyZJ+c1dD5FSoCQ0Dfx7a_8YFUbD53t0fHPt=JkdmRkA@mail.gmail.com>
References: <3663841.2.1329332313215.JavaMail.geo-discussion-forums@vbnd9>
	<CAAt2poLm3rmD6SsBOoQ089+LSd6kKMrcxQhr=0C2Vz62T9gnrQ@mail.gmail.com>
	<CA+FLvt8wPA35fFKZc+13cvjgcpv2eKd0X_ninjSk7OD65Vfsfg@mail.gmail.com>
	<CALPqkipRjHuURkKipbRjD4iXZaNaYPkxU6fKK+P_NjW7O+kF_A@mail.gmail.com>
	<CAAt2poJ6mVu-qLbxDfZJaLOYO5OkEfWe4k3H4dqaFGU_stAqQg@mail.gmail.com>
	<CA+FLvt-OL1RenytuRyrvv=39dJn_GCVY4fAT7no6Jj-D5xADMw@mail.gmail.com>
	<CAAt2poJyZJ+c1dD5FSoCQ0Dfx7a_8YFUbD53t0fHPt=JkdmRkA@mail.gmail.com>
Message-ID: <26429647.1820.1330246956668.JavaMail.geo-discussion-forums@pbbpk4>

Hi Alan,

I was out of country. So I was not able to reply.

Thanks, that made it work. I was actually trying with the sample consumer 
(amqp_consumer.c) which operates with the unnamed queues. The messages were 
actually dropped by the broker.

-Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120226/ff2ae3ff/attachment.htm>

From smetj.net at gmail.com  Sun Feb 26 10:07:29 2012
From: smetj.net at gmail.com (Jelle Smet)
Date: Sun, 26 Feb 2012 02:07:29 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ/Shovel & Compression
In-Reply-To: <4F213061.6050408@rabbitmq.com>
References: <CAFDmHdPLnZNBcdvunyx7KfM=db7wt-h84t+r0Z014Ao642VZpA@mail.gmail.com>
	<4F213061.6050408@rabbitmq.com>
Message-ID: <19803215.1587.1330250849949.JavaMail.geo-discussion-forums@vbtv22>

On Thursday, January 26, 2012 11:52:17 AM UTC+1, Simon MacMullen wrote:
>
> On 25/01/12 18:44, Elias Levy wrote:
> > Instead of using SSH, you could use the built-in SSL functionality. If
> > SSLv2 is disabled and both the client and server are compiled against
> > zlib, then OpenSSL should negociate compression, and if you select a
> > cipher with no encryption or authentication, you can avoid the crypto
> > overhead.
>
> Yeah, I did wonder about saying this but...
>
That's interesting indeed.
 

> Jelle, if go this route and get it working, do let us know...
>

OK, I will do some testing on my side.

Thanks for the tip !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120226/7a01f0d2/attachment.htm>

From jaysnanavati at hotmail.co.uk  Sun Feb 26 18:45:39 2012
From: jaysnanavati at hotmail.co.uk (jay nanavati)
Date: Sun, 26 Feb 2012 18:45:39 +0000
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <BAY154-W539870CC6FC7A6D83362DC99680@phx.gbl>


Hi everyone,
I have followed this guide to setup rabbitMQ for android.http://simonwdixon.wordpress.com/2011/06/03/getting-started-with-rabbitmq-on-android-part-1/
The problem I am facing is On the line mConsumer.connectToRabbitMQ() in the ActivityHome, I have changed it to:
mOutput.append(?\n?+mConsumer.connectToRabbitMQ());
now when I have the wrong server, it prints false as expected however when I have the write server it does not print anything. In fact it does not even print the @string/hello which it should anyways..
The app does not consume messages and I think this could be the reason.. Also I have used loger and found out that the error must be on this method because I can logg before the call however I cannot logg anything after the call.
Any help would be greatly appreciated.. Thanks!

  		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120226/4bea75c7/attachment.htm>

From uday.subbarayan at yahoo.com  Sun Feb 26 20:51:53 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Sun, 26 Feb 2012 12:51:53 -0800 (PST)
Subject: [rabbitmq-discuss] Apache MINA Integration
Message-ID: <1330289513.57728.YahooMailNeo@web44910.mail.sp1.yahoo.com>

Hi All,
? ? ?Has anyone integrated Apache MINA with Rabbit MQ to publish and receive messages?

Thanks,
-Uday.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120226/55d812e1/attachment.htm>

From codevally at gmail.com  Mon Feb 27 03:00:15 2012
From: codevally at gmail.com (Codevally)
Date: Sun, 26 Feb 2012 19:00:15 -0800 (PST)
Subject: [rabbitmq-discuss] Problem with using rabbitmqctl on EC2
Message-ID: <17970f1d-15cf-42a2-9b5a-f431ffd74a6d@v2g2000vbx.googlegroups.com>

Hi Experts

I have installed RabbitMQ 2.7.1 on EC2 (host name is ec2test2) and
server getting started without any issue.

AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at ec2test2
app descriptor : /app/rabbitmq_server-2.7.1/sbin/../ebin/rabbit.app
home dir       : /root
config file(s) : (none)
cookie hash    : 4lZvwoYL5ZJbkEiBx9CgDA==
log            : /var/log/rabbitmq/rabbit at ec2test2.log
sasl log       : /var/log/rabbitmq/rabbit at ec2test2-sasl.log
database dir   : /app/rabbitmq-config/lib/rabbitmq/mnesia/
rabbit at ec2test2
erlang version : 5.9

But when I try to use rabbitmqctl, I am getting the below error.

ec2test2:/app/rabbitmq/sbin # sh rabbitmqctl
{error_logger,{{2012,2,27},{2,55,8}},"Can't set long node name!
\nPlease check your configuration\n",[]}
{error_logger,{{2012,2,27},{2,55,8}},crash_report,[[{initial_call,
{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},
{error_info,{exit,{error,badarg},[{gen_server,init_it,6,
[{file,"gen_server.erl"},{line,313}]},{proc_lib,init_p_do_apply,3,
[{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,
[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.17.0>]},
{dictionary,[{longnames,true}]},{trap_exit,true},{status,running},
{heap_size,6765},{stack_size,24},{reductions,2361}],[]]}

Host name is correctly configured and it displays:
ec2test2:/app/rabbitmq/sbin # hostname
ec2test2
ec2test2:/app/rabbitmq/sbin #

Could someone please explain this erroneous behavior?

Thanks.

From alistair at abayley.org  Mon Feb 27 03:37:24 2012
From: alistair at abayley.org (Alistair Bayley)
Date: Mon, 27 Feb 2012 16:37:24 +1300
Subject: [rabbitmq-discuss] [help] [beginner] server stops sending
 messages; publish (in transaction) hangs on commit
In-Reply-To: <4F4776A0.6020801@rabbitmq.com>
References: <CAKYODbhUWBDy4KJQJO7OW2aRnw9LYkerLiNN8kG8=NAnO8FgPQ@mail.gmail.com>
	<CABzX+qwJhotUDEshpfDJKyQKkXWv+uOci+fgY8m1RoX7R-UHXQ@mail.gmail.com>
	<4F462A8E.3080509@rabbitmq.com>
	<CAKYODbikMzvX_VC5z0Az8FHh+RHqxuppgMVBwS9OgLG=f6RZ2A@mail.gmail.com>
	<4F467E08.3030505@rabbitmq.com>
	<CAKYODbhKD3JyASyzzCZYeOGE1aMzApfsy-6jfW_bNFv4ATs77Q@mail.gmail.com>
	<4F4776A0.6020801@rabbitmq.com>
Message-ID: <CAKYODbip9zOg2=7xNukG6oMAGVqZHdU1ibza=5+98xvUTQtzow@mail.gmail.com>

On 25 February 2012 00:38, Simon MacMullen <simon at rabbitmq.com> wrote:
>>
>> OK. Can I have some guidance as to how much memory we should allocate?
>
> This is a real how-long-is-a-piece-of-string question I'm afraid. 512M would
> already be a significant step towards the comfort zone though.

rabbitmqctl report shows a large number of channels (in the thousands)
and memory usage seems to correlate with the large number of channels.
I've left the server running and shut down each of the clients, and
the channels have vanished from the report output, so I suspect a
dodgy client here. We're using python kombu over ampqlib, so maybe
kombu is doing something undesirable. A quick glance at the source
shows that it has a channel pool, so maybe that's to blame. Anyway,
more investigation required...

Once the number of channels is down to less than 10, the memory usage
is around 32M, which seems fine to me. Maybe I don't need to allocate
more, if I can solve this channels problem.


>> Is there an
>> option to get the server to return something that says that it is not
>> accepting messages?
>
> In ancient history we used to do this; there's a method in AMQP 0-9-1 called
> channel.flow which the server should be able to use to tell a client to shut
> up. In practice it was unreliable (client may not support it, or may take
> too long to take notice of it).

I will do some more testing. Maybe the immediate flag on basic_publish
will do something useful. python amqplib is protocol version 0.8, so
whatever I do must fit in with that.

Alistair

From zmstone at gmail.com  Mon Feb 27 09:25:37 2012
From: zmstone at gmail.com (stone)
Date: Mon, 27 Feb 2012 10:25:37 +0100
Subject: [rabbitmq-discuss] dead connection lingers around?
Message-ID: <CAPNZrFUMw1ZarWq-cuooqw8g6FJXhCNM7xgaBuiYS=a+cwHHQw@mail.gmail.com>

Hi

Have a problem while testing my Erlang client based application.
I have no idea if it's due to some bad behavior in my app or whatsoever,
hope I can get some useful information here.

In my case, I have:
three rabbit nodes in a cluster;
one non-durable topic exchange;
two connections established;
several channels and queues (exclusive & non-exclusive) declared.

While i'm testing, sometimes the connections they just linger around even
the client has quit already.

For instance, here is one or my dead connections (copied from admin page):

AMQP 0-9-110.15.36.246:36526rabbit at test-app20B/s(1.9kB total) 0B/s(1.1kB
total)4guestrunning
I'm pretty sure that the client on 10.15.36.246 has been killed already,
but the connection is still in "running" state.

/stone
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120227/3187eb08/attachment.htm>

From steve at rabbitmq.com  Mon Feb 27 09:44:56 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 27 Feb 2012 09:44:56 +0000
Subject: [rabbitmq-discuss] Problems with STOMP & access control
In-Reply-To: <20120221143400.242c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20120221143400.242c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <7245AC14-4662-4F85-B38A-EAFF206DD7EF@rabbitmq.com>

Lionel,

Apologies for tardy reply.

Presently there is no way to set access control based upon the STOMP names,
though I agree this would be desirable. Does the STOMP specification talk about
access control at all?

I think the destination names aren't all entirely opaque, so it might be
possible to exert access control on some resources, but a comprehensive solution
is not available, I'm afraid.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 21 Feb 2012, at 13:44, Lionel Cons wrote:

> I've read http://www.rabbitmq.com/access-control.html and
> http://www.rabbitmq.com/stomp.html and I did not find any practical
> way to use access control with STOMP.
> 
> In the STOMP world (in fact, since STOMP is broker behavior agnostic,
> this is rather tied to the JMS world), one can use destinations like
> /queue/test.foo or /topic/test.bar. It would be natural to use these
> names in the access control regexps to allow, for instance, a given
> user to access all queues matching "test\..*".
> 
> Unfortunately, the STOMP destinations names get mapped to AMQP
> resource names that loose the original names, for instance
> amq.gen-AXVr2gFuBTO4duQ5OEC9b9.
> 
> Is there a way in RabbitMQ to use access control based on the STOMP
> destination names?
> 
> Cheers,
> 
> Lionel
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Mon Feb 27 10:21:39 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 27 Feb 2012 10:21:39 +0000
Subject: [rabbitmq-discuss] Unexpected behaviour with STOMP & NACK
In-Reply-To: <20120222131513.83a8.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20120222131513.83a8.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <C71F5D87-E010-4007-8CEB-7560CCEBFFD7@rabbitmq.com>

Lionel,

Apologies for the tardy reply.

Thank you for reporting this. What is happening is that the NACK sets the
'requeue=true' flag, which, by definition, puts the message back on its queue.
It is then available for redelivery. Whether it gets redelivered to the same
consumer depends on lots of things, but is entirely possible, and is expected
when there is only one consumer.

Currently, we expect this behaviour and did not think it was prohibited by the
specification.

If this is determined to violate the specification we could set requeue=false on
NACK, then neither this client, nor any other, will see the message; which is
allowable server behaviour. There is currently no mechanism for re-routing
messages that are NACKd, but this may change in the near future.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 22 Feb 2012, at 12:24, Lionel Cons wrote:

> I get an unexpected behaviour with STOMP & NACK with RabbitMQ 2.7.1.
> 
> Here is my test, using an empty queue.
> - client1 connects, sends a message to the queue and disconnects
> - client2 connects, subscribes to the queue with ack:client
> - client2 receives the message (so far so good) but does not ack it
> - client3 connects, subscribes to the queue
> - client2 sends a NACK frame for the message
> - client2 receives the message once more
> - client3 receives nothing
> 
> I would have expected the other client (client3) to receive the
> message that has not been consumed by client2. In fact, this is how
> ActiveMQ and Apollo work.
> 
> FWIW, the STOMP 1.1 spec mentions:
> 
> | NACK is the opposite of ACK. It is used to tell the server that the
> | client did not consume the message. The server can then either send
> | the message to a different client, discard it, or put it in a dead
> | letter queue. The exact behavior is server specific.
> 
> So, although the behavior is not strictly defined, re-sending the
> message to the same client does not look appropriate to me.
> 
> What do you think?
> 
> Cheers,
> 
> Lionel
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jon.hill at comshen.com  Mon Feb 27 10:30:15 2012
From: jon.hill at comshen.com (Jon Hill)
Date: Mon, 27 Feb 2012 02:30:15 -0800 (PST)
Subject: [rabbitmq-discuss] Consumers and exceptions
In-Reply-To: <11213BC2-92C4-4F3A-87F3-7DAF727F47B2@rabbitmq.com>
References: <136bb8b3-7484-4830-9e8d-4a0af5bb1df2@bs8g2000vbb.googlegroups.com>
	<11213BC2-92C4-4F3A-87F3-7DAF727F47B2@rabbitmq.com>
Message-ID: <3b4977f4-5f27-4b7b-97bc-64606fc3acc9@hs8g2000vbb.googlegroups.com>

Steve

Many thanks for the reply. That makes sense, and I am now progressing.

All the best

Jon

From lionel.cons at cern.ch  Mon Feb 27 10:31:45 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 27 Feb 2012 11:31:45 +0100
Subject: [rabbitmq-discuss] Problems with STOMP & access control
In-Reply-To: <7245AC14-4662-4F85-B38A-EAFF206DD7EF@rabbitmq.com>
References: <20120221143400.242c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<7245AC14-4662-4F85-B38A-EAFF206DD7EF@rabbitmq.com>
Message-ID: <20299.23441.992131.685344@mail.cern.ch>

Steve Powell writes:
 > Does the STOMP specification talk about access control at all?

No. The specification does not describe the broker behavior. Even
something like "/topic/foo" means a JMS-style topic named "foo" is
outside of the spec.

 > I think the destination names aren't all entirely opaque, so it
 > might be possible to exert access control on some resources, but a
 > comprehensive solution is not available, I'm afraid.

It seems that things might work with queues since a STOMP destination
of "/queue/foo" will AFAIK use a queue named "foo". To be confirmed.

Topics are more problematic but this does not seem to be STOMP specific.

In AMQP, how would you configure the RabbitMQ ACLs so that client A
can only send to amq.topic with a routing key matching A.* while
client B is restrcited to routing keys matching B.*?

The http://www.rabbitmq.com/access-control.html page does not really
describe what a reource is. Would a syntax like amq.topic:A.* make
sense to perform routing key based access control?

Cheers,

Lionel

From simon at rabbitmq.com  Mon Feb 27 10:42:00 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 27 Feb 2012 10:42:00 +0000
Subject: [rabbitmq-discuss] Ensuring low latency for publishers
In-Reply-To: <a94ae5aa-189f-4071-a61d-af847232753e@vj8g2000pbc.googlegroups.com>
References: <1e665e68-b239-44a0-aecd-af98dec19d1d@qs5g2000pbc.googlegroups.com>	<4F43DB61.2030304@rabbitmq.com>	<e105cb4d-f320-4c04-8068-9c58a068ea05@x6g2000pbk.googlegroups.com>	<7dc34cad-d8f9-4903-a72d-cb3dfc2a4749@o4g2000pbc.googlegroups.com>	<4f4690a9-038d-4fdb-bce1-ae8c246a3247@ub4g2000pbc.googlegroups.com>	<20120222175207.GA29288@wellquite.org>
	<4F462C80.4080108@rabbitmq.com>	<4F462DE6.4060104@rabbitmq.com>	<b16ad838-4b64-4cae-8f07-b4d086332418@m3g2000pbi.googlegroups.com>	<4F47726A.7000401@rabbitmq.com>
	<a94ae5aa-189f-4071-a61d-af847232753e@vj8g2000pbc.googlegroups.com>
Message-ID: <4F4B5DF8.5090500@rabbitmq.com>

On 24/02/12 18:07, Eric wrote:
> In reality, the throttling case is extremely unlikely anyway, right?
> You basically have to create a case where publishers are outpacing
> consumers and/or the speed of disk writes on the broker.  So you'd
> have to publish something like 100mb/s with little or no consumption,
> and our application is roughly 5mb/minute.

With small messages in fact the first thing you run into is being 
CPU-bound making routing decisions. But the general principle holds, yes.

> In conclusion, I finally did what I should have done in the first
> place.  I mocked up the threading scenario we're likely to see in
> production and benchmarked it against Java's LinkedBlockingQueue and
> ArrayBlockingQueue.  Compared to each producer thread having its own
> linked list (the completely uncontended scenario) the blocking queues
> introduced virtually no additional waiting - a microsecond or two at
> most.  That's the case even at rates 50x or more than we'd see in
> production.  So blocking queue it is, and that's a comfortingly simple
> solution.
>
> Thanks for all the help and apologies for under-researching what I was
> doing.

Ah, good.

I had a quick look at implementing non-blocking publish on Java on 
Friday. Unfortunately it's not possible to do this without NIO on Java, 
so a prerequisite becomes "port the Java client to NIO", which... makes 
it less likely to happen I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Mon Feb 27 10:56:09 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 27 Feb 2012 10:56:09 +0000
Subject: [rabbitmq-discuss] STOMP doesn't include the routing-key on
	MESSAGE frames
In-Reply-To: <CAM8fPiTXAB3g8jhTEukJJvbju=eJSbmWyspQOKpyx=mOAZYmHw@mail.gmail.com>
References: <CAM8fPiQe4nZGdwPvmYae=YtA6ruN96TedYNLOHpQBcxo9niQOg@mail.gmail.com>
	<CAM8fPiRDo_i=qTQSMOfQGqTg1YBbAZQtNfBqXn1bhnY-_E7LYg@mail.gmail.com>
	<E2D4D1E4-13BF-4D66-8F40-A9766BCEE0A5@rabbitmq.com>
	<CAM8fPiTqRg8LtiMa21U-Vh7nFFc3YdBw9Gs8X_nASeVn8Oxiaw@mail.gmail.com>
	<CAM8fPiTXAB3g8jhTEukJJvbju=eJSbmWyspQOKpyx=mOAZYmHw@mail.gmail.com>
Message-ID: <5E2DB83D-C02B-48D6-97C2-FDB76643B855@rabbitmq.com>

Tony,

Read your patch, and prefer this solution to adding extra headers.

I'm raising a bug (24763) to fix our spec-compliance problem (thank you for
pointing this out), and see if we can get this change in.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 20 Feb 2012, at 20:36, Tony Garnock-Jones wrote:

> Hi Steve,
> 
> How about the attached patch? It attempts to bring the "destination"
> header in MESSAGEs in to line with the STOMP 1.1 spec. I've paid
> cursory attention to binary-and-slash-escaping issues but it could use
> a second glance before being committed, I reckon.
> 
> Regards,
>  Tony
> 
> On 20 February 2012 14:56, Tony Garnock-Jones
> <tonygarnockjones+rabbitmq at gmail.com> wrote:
>> Adding the routing_key puts the final small missing piece in place. A
>> perhaps more STOMPish way of giving it would be to have a "to" header
>> or similar carried in a MESSAGE, containing the full destination given
>> in the SEND. Oh wait! I've just checked, and actually that's what's
>> required by the 1.1 spec already. So the STOMP adapter isn't quite
>> spec-compliant, in that it's giving the destination from the
>> *subscribe* rather than the *send*.
> -- 
> Tony Garnock-Jones
> tonygarnockjones at gmail.com
> http://homepages.kcbbs.gen.nz/tonyg/
> <better-destination-patch.patch>


From simon at rabbitmq.com  Mon Feb 27 11:05:56 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 27 Feb 2012 11:05:56 +0000
Subject: [rabbitmq-discuss] dead connection lingers around?
In-Reply-To: <CAPNZrFUMw1ZarWq-cuooqw8g6FJXhCNM7xgaBuiYS=a+cwHHQw@mail.gmail.com>
References: <CAPNZrFUMw1ZarWq-cuooqw8g6FJXhCNM7xgaBuiYS=a+cwHHQw@mail.gmail.com>
Message-ID: <4F4B6394.10903@rabbitmq.com>

Hi.

Sometimes if a TCP connection gets killed outright the OS never notices 
and so we don't know either.

This probably implies you are not closing connections properly? (i.e. 
with the AMQP close handshake, by invoking amqp_connection:close/1.)

Enabling AMQP heartbeats will allow RabbitMQ to detect this condition.

Cheers, Simon

On 27/02/12 09:25, stone wrote:
> Hi
>
> Have a problem while testing my Erlang client based application.
> I have no idea if it's due to some bad behavior in my app or whatsoever,
> hope I can get some useful information here.
>
> In my case, I have:
> three rabbit nodes in a cluster;
> one non-durable topic exchange;
> two connections established;
> several channels and queues (exclusive & non-exclusive) declared.
>
> While i'm testing, sometimes the connections they just linger around
> even the client has quit already.
>
> For instance, here is one or my dead connections (copied from admin page):
>
> AMQP 0-9-1	10.15.36.246:36526 <http://10.15.36.246:36526>
> rabbit at test-app2	0B/s_(1.9kB total) 	0B/s_(1.1kB total) 	4	guest	running
>
> I'm pretty sure that the client on 10.15.36.246 has been killed already,
> but the connection is still in "running" state.
>
> /stone
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Feb 27 11:06:49 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 27 Feb 2012 11:06:49 +0000
Subject: [rabbitmq-discuss] =?gb2312?b?tPC4tDogIFBhc3NpdmUgcXVldWUgZGVj?=
 =?gb2312?b?bGFyYXRpb24gYW5kIGNoYW5uZWwgY2xvc3VyZQ==?=
In-Reply-To: <CAOn7oW_rgYW37zQZGqKCOoN8uW3FvkYCHCHRuiBgH8pa11NC4A@mail.gmail.com>
References: <88E590DC4586974D825FC82AE798294E520F1E82@GSVCLU04.ges.ferlan.it>	<73831E29-46BF-464A-A9B9-CA040F734011@rabbitmq.com>	<CAOn7oW_QumnbXwHO-boNBU9DrXpMHmY+iYBBX8EXR5pWdLFP8Q@mail.gmail.com>	<D027DE656EBD4F4C8EE57361B5EF438E39924E5D@szxeml524-mbx.china.huawei.com>
	<CAOn7oW_rgYW37zQZGqKCOoN8uW3FvkYCHCHRuiBgH8pa11NC4A@mail.gmail.com>
Message-ID: <4F4B63C9.7070909@rabbitmq.com>

On 25/02/12 18:37, Simone Busoli wrote:
> David, I somewhat agree with you, lack of documentation about 
> operational aspects of broker behavior is something I have been missing 
> as well.

Yeah, I suspect our documentation could still be better. But this is one
of the areas where it's really easy to be blinded by over-familiarity.
What sort of things do you think are particularly missing?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mikeb at rabbitmq.com  Mon Feb 27 11:43:12 2012
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Mon, 27 Feb 2012 11:43:12 +0000
Subject: [rabbitmq-discuss] Apache MINA Integration
In-Reply-To: <1330289513.57728.YahooMailNeo@web44910.mail.sp1.yahoo.com>
References: <1330289513.57728.YahooMailNeo@web44910.mail.sp1.yahoo.com>
Message-ID: <4F4B6C50.9070702@rabbitmq.com>

> Has anyone integrated Apache MINA with Rabbit MQ to publish and receive
> messages?

What form would you expect such an integration to take?

From majek04 at gmail.com  Mon Feb 27 11:49:18 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 27 Feb 2012 11:49:18 +0000
Subject: [rabbitmq-discuss] [help] [beginner] server stops sending
 messages; publish (in transaction) hangs on commit
In-Reply-To: <CAKYODbip9zOg2=7xNukG6oMAGVqZHdU1ibza=5+98xvUTQtzow@mail.gmail.com>
References: <CAKYODbhUWBDy4KJQJO7OW2aRnw9LYkerLiNN8kG8=NAnO8FgPQ@mail.gmail.com>
	<CABzX+qwJhotUDEshpfDJKyQKkXWv+uOci+fgY8m1RoX7R-UHXQ@mail.gmail.com>
	<4F462A8E.3080509@rabbitmq.com>
	<CAKYODbikMzvX_VC5z0Az8FHh+RHqxuppgMVBwS9OgLG=f6RZ2A@mail.gmail.com>
	<4F467E08.3030505@rabbitmq.com>
	<CAKYODbhKD3JyASyzzCZYeOGE1aMzApfsy-6jfW_bNFv4ATs77Q@mail.gmail.com>
	<4F4776A0.6020801@rabbitmq.com>
	<CAKYODbip9zOg2=7xNukG6oMAGVqZHdU1ibza=5+98xvUTQtzow@mail.gmail.com>
Message-ID: <CABzX+qznWcOPTsLob0w+uK0vUg7GBbOqot0EzhbKud12DDLAJQ@mail.gmail.com>

On Mon, Feb 27, 2012 at 03:37, Alistair Bayley <alistair at abayley.org> wrote:
> On 25 February 2012 00:38, Simon MacMullen <simon at rabbitmq.com> wrote:
>>>
>>> OK. Can I have some guidance as to how much memory we should allocate?
>>
>> This is a real how-long-is-a-piece-of-string question I'm afraid. 512M would
>> already be a significant step towards the comfort zone though.
>
> rabbitmqctl report shows a large number of channels (in the thousands)
> and memory usage seems to correlate with the large number of channels.
> I've left the server running and shut down each of the clients, and
> the channels have vanished from the report output, so I suspect a
> dodgy client here. We're using python kombu over ampqlib, so maybe
> kombu is doing something undesirable. A quick glance at the source
> shows that it has a channel pool, so maybe that's to blame. Anyway,
> more investigation required...

Right. This is definitely possible that channels are the main
thing that consumes memory.

> Once the number of channels is down to less than 10, the memory usage
> is around 32M, which seems fine to me. Maybe I don't need to allocate
> more, if I can solve this channels problem.

Yup, quite possible.

>>> Is there an
>>> option to get the server to return something that says that it is not
>>> accepting messages?
>>
>> In ancient history we used to do this; there's a method in AMQP 0-9-1 called
>> channel.flow which the server should be able to use to tell a client to shut
>> up. In practice it was unreliable (client may not support it, or may take
>> too long to take notice of it).
>
> I will do some more testing. Maybe the immediate flag on basic_publish
> will do something useful. python amqplib is protocol version 0.8, so
> whatever I do must fit in with that.

Nope, "immediate" flag is a completely unrelated:
  http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish

Marek

From majek04 at gmail.com  Mon Feb 27 12:25:08 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 27 Feb 2012 12:25:08 +0000
Subject: [rabbitmq-discuss] Problem with using rabbitmqctl on EC2
In-Reply-To: <17970f1d-15cf-42a2-9b5a-f431ffd74a6d@v2g2000vbx.googlegroups.com>
References: <17970f1d-15cf-42a2-9b5a-f431ffd74a6d@v2g2000vbx.googlegroups.com>
Message-ID: <CABzX+qyoBX2CHX5z1wWrPyG-d7iTqLUcZWozEGDsp1UARCbubg@mail.gmail.com>

On Mon, Feb 27, 2012 at 03:00, Codevally <codevally at gmail.com> wrote:
> I have installed RabbitMQ 2.7.1 on EC2 (host name is ec2test2) and
> server getting started without any issue.
>
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2011 VMware, Inc.
> Licensed under the MPL. ?See http://www.rabbitmq.com/
>
> node ? ? ? ? ? : rabbit at ec2test2
> app descriptor : /app/rabbitmq_server-2.7.1/sbin/../ebin/rabbit.app
> home dir ? ? ? : /root
> config file(s) : (none)
> cookie hash ? ?: 4lZvwoYL5ZJbkEiBx9CgDA==
> log ? ? ? ? ? ?: /var/log/rabbitmq/rabbit at ec2test2.log
> sasl log ? ? ? : /var/log/rabbitmq/rabbit at ec2test2-sasl.log
> database dir ? : /app/rabbitmq-config/lib/rabbitmq/mnesia/
> rabbit at ec2test2
> erlang version : 5.9
>
> But when I try to use rabbitmqctl, I am getting the below error.
>
> ec2test2:/app/rabbitmq/sbin # sh rabbitmqctl
> {error_logger,{{2012,2,27},{2,55,8}},"Can't set long node name!
> \nPlease check your configuration\n",[]}
> {error_logger,{{2012,2,27},{2,55,8}},crash_report,[[{initial_call,
> {net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},
> {error_info,{exit,{error,badarg},[{gen_server,init_it,6,
> [{file,"gen_server.erl"},{line,313}]},{proc_lib,init_p_do_apply,3,
> [{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,
> [net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.17.0>]},
> {dictionary,[{longnames,true}]},{trap_exit,true},{status,running},
> {heap_size,6765},{stack_size,24},{reductions,2361}],[]]}
>
> Host name is correctly configured and it displays:
> ec2test2:/app/rabbitmq/sbin # hostname
> ec2test2
> ec2test2:/app/rabbitmq/sbin #
>
> Could someone please explain this erroneous behavior?

Google suggests:
 https://groups.google.com/group/erlang-programming/msg/72f4dc5311729eb2

> A little more experimentation revealed that the problem was that the
> system returned no FQDN for itself, as indicated for example by
> 'hostname -f'. A little /etc/hosts manipulation fixed that, and all
> was well.

Basically, make sure that this works fine:
  ping `hostname`
  ping `hostname -f`

Cheers,
    Marek

From vbernard42 at gmail.com  Mon Feb 27 13:59:26 2012
From: vbernard42 at gmail.com (Valentin BERNARD)
Date: Mon, 27 Feb 2012 05:59:26 -0800 (PST)
Subject: [rabbitmq-discuss] Log rotation with rabbitmq-service on Windows
Message-ID: <df50ddb0-ce63-41fc-aaf7-4e4c90ba8674@em9g2000vbb.googlegroups.com>

Hello,

We're experiencing some strange behaviour with our RabbitMQ service
(2.5.0) on a Windows server. It seems that RabbitMQ randomly restarts
(once or twice a day), and it looks like the log file is erased every
time this happens. I read something about rabbitmq-service not
rotating logs, but that was a while ago. Is there a way to keep an
history, please?

Thanks.

Valentin.

From simon at rabbitmq.com  Mon Feb 27 14:19:45 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 27 Feb 2012 14:19:45 +0000
Subject: [rabbitmq-discuss] Log rotation with rabbitmq-service on Windows
In-Reply-To: <df50ddb0-ce63-41fc-aaf7-4e4c90ba8674@em9g2000vbb.googlegroups.com>
References: <df50ddb0-ce63-41fc-aaf7-4e4c90ba8674@em9g2000vbb.googlegroups.com>
Message-ID: <4F4B9101.9090707@rabbitmq.com>

On 27/02/12 13:59, Valentin BERNARD wrote:
> Is there a way to keep an history, please?

Not in 2.5.0. That version relied on startup scripts to append the 
existing log file to a backup; since the Windows service starts without 
any script running it did nothing.

As of 2.7.0 RabbitMQ does not overwrite the log file on startup. So you 
probably want to upgrade.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ozhurakousky at vmware.com  Mon Feb 27 14:20:28 2012
From: ozhurakousky at vmware.com (Oleg Zhurakousky)
Date: Mon, 27 Feb 2012 06:20:28 -0800 (PST)
Subject: [rabbitmq-discuss] Apache MINA Integration
In-Reply-To: <4F4B6C50.9070702@rabbitmq.com>
Message-ID: <3a6a63fd-615c-4fec-8dfd-7db4595f6c64@oleg-2.local>

I believe it is a more general concern and typically handled by integration frameworks, in this case EIP-style (http://www.eaipatterns.com/) frameworks such as Spring Integration (http://www.springsource.org/spring-integration)
These frameworks already have fist class integration with AMQP (e.g., AMQP inbound and outbound channel adapters) as well as other protocols and products including TCP/IP.

Oleg

----- Original Message -----
From: "Michael Bridgen" <mikeb at rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, February 27, 2012 6:43:12 AM
Subject: Re: [rabbitmq-discuss] Apache MINA Integration

> Has anyone integrated Apache MINA with Rabbit MQ to publish and receive
> messages?

What form would you expect such an integration to take?
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From vbernard42 at gmail.com  Mon Feb 27 14:29:11 2012
From: vbernard42 at gmail.com (Valentin BERNARD)
Date: Mon, 27 Feb 2012 06:29:11 -0800 (PST)
Subject: [rabbitmq-discuss] Log rotation with rabbitmq-service on Windows
In-Reply-To: <4F4B9101.9090707@rabbitmq.com>
References: <df50ddb0-ce63-41fc-aaf7-4e4c90ba8674@em9g2000vbb.googlegroups.com>
	<4F4B9101.9090707@rabbitmq.com>
Message-ID: <88f7367a-041b-49e3-ba9b-e966ba5d02a6@9g2000vbq.googlegroups.com>

OK, thanks for your fast answer!

Cheers,

Valentin.

On 27 f?v, 15:19, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 27/02/12 13:59, Valentin BERNARD wrote:
>
> > Is there a way to keep an history, please?
>
> Not in 2.5.0. That version relied on startup scripts to append the
> existing log file to a backup; since the Windows service starts without
> any script running it did nothing.
>
> As of 2.7.0 RabbitMQ does not overwrite the log file on startup. So you
> probably want to upgrade.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tonygarnockjones+rabbitmq at gmail.com  Mon Feb 27 15:10:59 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 27 Feb 2012 10:10:59 -0500
Subject: [rabbitmq-discuss] STOMP doesn't include the routing-key on
 MESSAGE frames
In-Reply-To: <5E2DB83D-C02B-48D6-97C2-FDB76643B855@rabbitmq.com>
References: <CAM8fPiQe4nZGdwPvmYae=YtA6ruN96TedYNLOHpQBcxo9niQOg@mail.gmail.com>
	<CAM8fPiRDo_i=qTQSMOfQGqTg1YBbAZQtNfBqXn1bhnY-_E7LYg@mail.gmail.com>
	<E2D4D1E4-13BF-4D66-8F40-A9766BCEE0A5@rabbitmq.com>
	<CAM8fPiTqRg8LtiMa21U-Vh7nFFc3YdBw9Gs8X_nASeVn8Oxiaw@mail.gmail.com>
	<CAM8fPiTXAB3g8jhTEukJJvbju=eJSbmWyspQOKpyx=mOAZYmHw@mail.gmail.com>
	<5E2DB83D-C02B-48D6-97C2-FDB76643B855@rabbitmq.com>
Message-ID: <CAM8fPiRrtMPqE=tg03SKmUR-z1ESdBGhdHj5bkUU7S4E42a-Yg@mail.gmail.com>

Thanks very much - looking forward to it. (By the way, I just created a
fresh bz account with my gmail address (without the +rabbitmq) - would you
mind adding it to the bug's ACL?)

Regards,
  Tony

On 27 February 2012 05:56, Steve Powell <steve at rabbitmq.com> wrote:

> Tony,
>
> Read your patch, and prefer this solution to adding extra headers.
>
> I'm raising a bug (24763) to fix our spec-compliance problem (thank you for
> pointing this out), and see if we can get this change in.
>
> Steve Powell
> steve at rabbitmq.com
> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
>
> On 20 Feb 2012, at 20:36, Tony Garnock-Jones wrote:
>
> > Hi Steve,
> >
> > How about the attached patch? It attempts to bring the "destination"
> > header in MESSAGEs in to line with the STOMP 1.1 spec. I've paid
> > cursory attention to binary-and-slash-escaping issues but it could use
> > a second glance before being committed, I reckon.
> >
> > Regards,
> >  Tony
> >
> > On 20 February 2012 14:56, Tony Garnock-Jones
> > <tonygarnockjones+rabbitmq at gmail.com> wrote:
> >> Adding the routing_key puts the final small missing piece in place. A
> >> perhaps more STOMPish way of giving it would be to have a "to" header
> >> or similar carried in a MESSAGE, containing the full destination given
> >> in the SEND. Oh wait! I've just checked, and actually that's what's
> >> required by the 1.1 spec already. So the STOMP adapter isn't quite
> >> spec-compliant, in that it's giving the destination from the
> >> *subscribe* rather than the *send*.
> > --
> > Tony Garnock-Jones
> > tonygarnockjones at gmail.com
> > http://homepages.kcbbs.gen.nz/tonyg/
> > <better-destination-patch.patch>
>
>


-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120227/13586220/attachment.htm>

From ionel.gog at gmail.com  Mon Feb 27 19:25:41 2012
From: ionel.gog at gmail.com (Ionel Gog)
Date: Mon, 27 Feb 2012 19:25:41 +0000
Subject: [rabbitmq-discuss] Moving a queue from one node to another
Message-ID: <CAKrcBhSYqV-ffFu_Nq5BK1aQNOxWjoR039+O9SAThv7nhM0QQQ@mail.gmail.com>

Hello,

Is there any way I can move queues from one RabbitMQ node to another?

My usage scenario is moving a live RabbitMQ instance from one server to
another as transparently as possible. Something like:
- start another RabbitMQ instance on the target server
- cluster together the source and target RabbitMQ instances
- close all existing connections
- flip IPs (target's IP takes the source's IP)
- start moving all the queues from source to target. During this time
clients should be able to consume from the target queues.
- when the move process has finished, terminate the source RabbitMQ instance

Reading the documentation I see the following potential options - which
don't seem completely satisfactory:
- The shovel plugin. I would need to redeclare all queues on the target
RabbitMQ and then shovel messages over. The only problem that I see is that
it's not completely transparent to clients - a queue may appear empty or
may report less messages if not all messages have been shoveled over when a
client starts using it.
- Mirrored queues. But I don't think you can make a queue mirrored *after*
it has been created. Can you?
- Shared network disk. But this requires a broker restart - and thus
implies loosing all non-durable queues and non-persistent messages.

Is there any other way?

Thanks,
Ionel.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120227/89d7b28e/attachment.htm>

From rev.chip at gmail.com  Mon Feb 27 19:34:00 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Mon, 27 Feb 2012 11:34:00 -0800 (PST)
Subject: [rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory
 on slave nodes
In-Reply-To: <4F476AE7.8050508@rabbitmq.com>
References: <4F454C42.4080400@gmail.com> <4F46877A.90206@aol.com>
	<4F476AE7.8050508@rabbitmq.com>
Message-ID: <6e37792a-06c9-4b30-8536-fa78d90e00dc@p7g2000yqk.googlegroups.com>

Simon MacMullen wrote:
> On 23/02/12 18:37, DawgTool wrote:
> > ps> I also recall making some config changes, but don't recall at the
> > moment. I'll look at those later today.
>
> That would be marvellous. Needless to say we've not been able to
> replicate this here.

Our local Erlang expert is on vacation, but he rescued our cluster.
He described a mailbox full of messages that some process was not
consuming.  When he killed the process and, IIRC, the "shell" that had
spawned it (I am merely parroting what I recall, this may be the wrong
term), the bloat was cured and memory usage returned to normal.

Details that might matter in reproduction:  Our troubled mirrored
queue used mode "nodes" (not "all"), picking two nodes out of a
cluster of four.  When I created it, I used a modified rabbitmqadmin
that connected to one of the two nodes, and specified that it and one
other node should mirror the queue.  All messages were written with
delivery-mode 2.  Messages are about 46K each.  While some of the
messages were consumed, most were purged.  Queue deletion did not cure
the leak.

From rev.chip at gmail.com  Mon Feb 27 19:50:51 2012
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Mon, 27 Feb 2012 11:50:51 -0800 (PST)
Subject: [rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory
	on slave nodes
In-Reply-To: <6e37792a-06c9-4b30-8536-fa78d90e00dc@p7g2000yqk.googlegroups.com>
References: <4F454C42.4080400@gmail.com> <4F46877A.90206@aol.com>
	<4F476AE7.8050508@rabbitmq.com>
	<6e37792a-06c9-4b30-8536-fa78d90e00dc@p7g2000yqk.googlegroups.com>
Message-ID: <ecbeabac-4567-4906-bba9-0903eddc5b49@p6g2000yqi.googlegroups.com>

On Feb 27, 11:34?am, Chip Salzenberg <rev.c... at gmail.com> wrote:
> Simon MacMullen wrote:
> > On 23/02/12 18:37, DawgTool wrote:
> > > ps> I also recall making some config changes, but don't recall at the
> > > moment. I'll look at those later today.
>
> > That would be marvellous. Needless to say we've not been able to
> > replicate this here.

An additional note: Most messages were written by clients that did not
require acks.

>
> Our local Erlang expert is on vacation, but he rescued our cluster.
> He described a mailbox full of messages that some process was not
> consuming. ?When he killed the process and, IIRC, the "shell" that had
> spawned it (I am merely parroting what I recall, this may be the wrong
> term), the bloat was cured and memory usage returned to normal.
>
> Details that might matter in reproduction: ?Our troubled mirrored
> queue used mode "nodes" (not "all"), picking two nodes out of a
> cluster of four. ?When I created it, I used a modified rabbitmqadmin
> that connected to one of the two nodes, and specified that it and one
> other node should mirror the queue. ?All messages were written with
> delivery-mode 2. ?Messages are about 46K each. ?While some of the
> messages were consumed, most were purged. ?Queue deletion did not cure
> the leak.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.r.carr at gmail.com  Mon Feb 27 20:12:28 2012
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 27 Feb 2012 14:12:28 -0600
Subject: [rabbitmq-discuss] Understanding Federation
In-Reply-To: <4F466D8F.8050705@rabbitmq.com>
References: <C3481B5CE3E61E438EEF6143B51DC17F652F5A11E5@Y000IIIV01.rd1.rf1>
	<4F461EB3.3000503@rabbitmq.com>
	<C3481B5CE3E61E438EEF6143B51DC17F652F5A15AA@Y000IIIV01.rd1.rf1>
	<4F466D8F.8050705@rabbitmq.com>
Message-ID: <CAJreXKBh1qDgt+T5FYL8aehdw4U99tRh8Ckuu1A5n0ShN=o7eA@mail.gmail.com>

Sorry to hijack an existing thread, but I'm delving into using
federation myself (after a 3 month break of even working with
rabbitmq) and have a couple questions.

1) Does federation need to be installed on both upstream and downstream?
2) I have a configuration that matches what Denis has but it only
creates the exchange on the downstream server and does nothing
upstream (only difference between his and mine is the remote hostname,
of course). What am I missing?


Thanks,
James


On Thu, Feb 23, 2012 at 10:47 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 23/02/12 16:36, MELIQUE Denis (MORPHO) wrote:
>>
>> Thank you Simon.
>>
>> This makes it much clearer for me.
>> I was first surprised to see this queue always empty on my test bed,
>> but the reason is (correct me if I'm wrong)
>> that my system was not loaded enough, and consumers got messages as soon
>> as they came in.
>
>
> You're partly right. Your system was not loaded enough, but the messages in
> that queue will be consumed by the downstream exchange, not (directly) by
> your consumers.
>
>
>> So every message consumed from the downstream is first written on disk.
>
>
> No. The queue is durable, but that just determines whether it survives a
> restart. Transient messages can still through it, and remain transient.
>
> Cheers, Simon
>
>
>> This might be a disadvantage for performance.
>> And gives an advantage to Shovel, as you can configure it with transient
>> queues.
>>
>> Denis
>>
>> -----Original Message-----
>> From: Simon MacMullen [mailto:simon at rabbitmq.com]
>> Sent: Thursday, February 23, 2012 12:11 PM
>> To: MELIQUE Denis (MORPHO)
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] Understanding Federation
>>
>> On 23/02/12 10:56, MELIQUE Denis (MORPHO) wrote:
>>>
>>> I?m doing some testing with federation plug-in to try to understand it.
>>
>>
>> Cool!
>>
>> <snip>
>>
>>> What are these Exchange and Queues used for ?
>>
>>
>> The queue is there to buffer messages that are published to the upstream
>> exchange and have not yet been consumed from the downstream exchange.
>>
>> It is bound to the internal exchange with the union of all the bindings
>> that are in use downstream, so we only transfer messages that are going
>> to be of use downstream.
>>
>> The internal exchange is there so that whenever we (re)establish a
>> federation link we can set up an exact set of bindings
>> mostly-atomically, by creating a new internal exchange, creating all the
>> bindings to it, then binding it to the upstream exchange.
>>
>>> Are they reserved for federation internal use ?
>>
>>
>> Yes.
>>
>>> When do messages go into these queues ?
>>
>>
>> As mentioned, the bindings are pushed upstream so messages from upstream
>> go into these queues if they will be routed once they get downstream.
>>
>>> Do they have to be durable or is there a way to configure them as
>>> transient ?
>>
>>
>> At the moment they have to be durable. Is this a problem? The idea is
>> that you can set the queue TTL if you do not want them to hang around
>> forever.
>>
>>> I would be very interested by a brief description of how federation
>>> works internally.
>>
>>
>> Hopefully this answers your question.
>>
>> Cheers, Simon
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.r.carr at gmail.com  Mon Feb 27 21:13:05 2012
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 27 Feb 2012 15:13:05 -0600
Subject: [rabbitmq-discuss] Understanding Federation
In-Reply-To: <CAJreXKBh1qDgt+T5FYL8aehdw4U99tRh8Ckuu1A5n0ShN=o7eA@mail.gmail.com>
References: <C3481B5CE3E61E438EEF6143B51DC17F652F5A11E5@Y000IIIV01.rd1.rf1>
	<4F461EB3.3000503@rabbitmq.com>
	<C3481B5CE3E61E438EEF6143B51DC17F652F5A15AA@Y000IIIV01.rd1.rf1>
	<4F466D8F.8050705@rabbitmq.com>
	<CAJreXKBh1qDgt+T5FYL8aehdw4U99tRh8Ckuu1A5n0ShN=o7eA@mail.gmail.com>
Message-ID: <CAJreXKCWFdaokHbNUZ7W17-P5A2zDVV73qvZg_ocDZsYwQ3fOg@mail.gmail.com>

FYI, here is the configuration I am using on the downstream server:

[
  {rabbitmq_federation,
    [ {exchanges, [[{exchange,     "usage"},
                    {virtual_host, "/"},
                    {type,         "topic"},
                    {durable,      true},
                    {auto_delete,  false},
                    {internal,     false},
                    {upstream_set, "remotes"}]
                  ]},
      {upstream_sets, [{"remotes", [[{connection,  "upstream-server"},
                                     {exchange,    "usage"},
                                     {max_hops,    2}]
                                   ]}
                      ]},
      {connections, [{"upstream-server", [{host,            "dc2rabbitmq1"},
                                          {protocol,        "amqp"},
                                          {port,            "5672"},
                                          {virtual_host,    "/"},
                                          {username,        "guest"},
                                          {password,        "guest"},
                                          {mechanism,       default},
                                          {prefetch_count,  1000},
                                          {reconnect_delay, 5},
                                          {heartbeat,       1},
                                          {queue_expires,   30000},
                                          {message_ttl,     10000}
                                          ]}
                      ]},
      {local_username, "guest"},
      {local_nodename, "rabbit"}
    ]
  }
].


It creates the local exchange on the downstream node just fine, but no
action on the upstream (dc2rabbitmq1). A look at the error logs
reveals the below messages, but I don't completely grok erlang yet. :S

=ERROR REPORT==== 27-Feb-2012::15:01:20 ===
** Generic server <0.1963.0> terminating
** Last message in was connect
** When Server state == {state,amqp_network_connection,
                            {state,undefined,undefined,undefined,undefined,
                                undefined,false},
                            <0.1962.0>,undefined,
                            {amqp_params_network,<<"guest">>,<<"guest">>,
                                <<"/">>,"dc2rabbitmq1","5672",0,0,1,infinity,
                                none,
                                [#Fun<amqp_auth_mechanisms.plain.3>,
                                 #Fun<amqp_auth_mechanisms.amqplain.3>],
                                [],[]},
                            undefined,undefined,
                            #Fun<amqp_connection_sup.0.39273983>,
                            #Fun<amqp_connection_sup.2.54430129>,false}
** Reason for termination ==
** {function_clause,[{inet_tcp,getserv,["5672"]},
                     {gen_tcp,connect1,4},
                     {gen_tcp,connect,4},
                     {amqp_network_connection,do_connect,5},
                     {amqp_gen_connection,handle_call,3},
                     {gen_server,handle_msg,5},
                     {proc_lib,init_p_do_apply,3}]}

=ERROR REPORT==== 27-Feb-2012::15:01:20 ===
** Generic server <0.1949.0> terminating
** Last message in was {'$gen_cast',maybe_go}
** When Server state == {not_started,
                            {{upstream,
                                 {amqp_params_network,<<"guest">>,
                                     <<"guest">>,<<"/">>,"dc2rabbitmq1",
                                     "5672",0,0,1,infinity,none,
                                     [#Fun<amqp_auth_mechanisms.plain.3>,
                                      #Fun<amqp_auth_mechanisms.amqplain.3>],
                                     [],[]},
                                 <<"usage">>,1000,2,5,none,10000,
                                 "upstream-server"},
                             {resource,<<"/">>,exchange,<<"usage">>}}}
** Reason for termination ==
** {{function_clause,[{inet_tcp,getserv,["5672"]},
                      {gen_tcp,connect1,4},
                      {gen_tcp,connect,4},
                      {amqp_network_connection,do_connect,5},
                      {amqp_gen_connection,handle_call,3},
                      {gen_server,handle_msg,5},
                      {proc_lib,init_p_do_apply,3}]},
    {gen_server,call,[<0.1963.0>,connect,infinity]}}

=WARNING REPORT==== 27-Feb-2012::15:01:20 ===
Channel (<0.1958.0>): Unregistering confirm handler <0.1949.0> because
it died. Reason: {{function_clause,

                   [{inet_tcp,

                     getserv,

                     ["5672"]},

                    {gen_tcp,

                     connect1,

                     4},

                    {gen_tcp,

                     connect,

                     4},

                    {amqp_network_connection,

                     do_connect,

                     5},

                    {amqp_gen_connection,

                     handle_call,

                     3},

                    {gen_server,

                     handle_msg,

                     5},

                    {proc_lib,

                     init_p_do_apply,

                     3}]},

                  {gen_server,

                   call,

                   [<0.1963.0>,

                    connect,

                    infinity]}}

Any help would be appreciated.

Thanks,
James


On Mon, Feb 27, 2012 at 2:12 PM, James Carr <james.r.carr at gmail.com> wrote:
> Sorry to hijack an existing thread, but I'm delving into using
> federation myself (after a 3 month break of even working with
> rabbitmq) and have a couple questions.
>
> 1) Does federation need to be installed on both upstream and downstream?
> 2) I have a configuration that matches what Denis has but it only
> creates the exchange on the downstream server and does nothing
> upstream (only difference between his and mine is the remote hostname,
> of course). What am I missing?
>
>
> Thanks,
> James
>
>
> On Thu, Feb 23, 2012 at 10:47 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
>> On 23/02/12 16:36, MELIQUE Denis (MORPHO) wrote:
>>>
>>> Thank you Simon.
>>>
>>> This makes it much clearer for me.
>>> I was first surprised to see this queue always empty on my test bed,
>>> but the reason is (correct me if I'm wrong)
>>> that my system was not loaded enough, and consumers got messages as soon
>>> as they came in.
>>
>>
>> You're partly right. Your system was not loaded enough, but the messages in
>> that queue will be consumed by the downstream exchange, not (directly) by
>> your consumers.
>>
>>
>>> So every message consumed from the downstream is first written on disk.
>>
>>
>> No. The queue is durable, but that just determines whether it survives a
>> restart. Transient messages can still through it, and remain transient.
>>
>> Cheers, Simon
>>
>>
>>> This might be a disadvantage for performance.
>>> And gives an advantage to Shovel, as you can configure it with transient
>>> queues.
>>>
>>> Denis
>>>
>>> -----Original Message-----
>>> From: Simon MacMullen [mailto:simon at rabbitmq.com]
>>> Sent: Thursday, February 23, 2012 12:11 PM
>>> To: MELIQUE Denis (MORPHO)
>>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>>> Subject: Re: [rabbitmq-discuss] Understanding Federation
>>>
>>> On 23/02/12 10:56, MELIQUE Denis (MORPHO) wrote:
>>>>
>>>> I?m doing some testing with federation plug-in to try to understand it.
>>>
>>>
>>> Cool!
>>>
>>> <snip>
>>>
>>>> What are these Exchange and Queues used for ?
>>>
>>>
>>> The queue is there to buffer messages that are published to the upstream
>>> exchange and have not yet been consumed from the downstream exchange.
>>>
>>> It is bound to the internal exchange with the union of all the bindings
>>> that are in use downstream, so we only transfer messages that are going
>>> to be of use downstream.
>>>
>>> The internal exchange is there so that whenever we (re)establish a
>>> federation link we can set up an exact set of bindings
>>> mostly-atomically, by creating a new internal exchange, creating all the
>>> bindings to it, then binding it to the upstream exchange.
>>>
>>>> Are they reserved for federation internal use ?
>>>
>>>
>>> Yes.
>>>
>>>> When do messages go into these queues ?
>>>
>>>
>>> As mentioned, the bindings are pushed upstream so messages from upstream
>>> go into these queues if they will be routed once they get downstream.
>>>
>>>> Do they have to be durable or is there a way to configure them as
>>>> transient ?
>>>
>>>
>>> At the moment they have to be durable. Is this a problem? The idea is
>>> that you can set the queue TTL if you do not want them to hang around
>>> forever.
>>>
>>>> I would be very interested by a brief description of how federation
>>>> works internally.
>>>
>>>
>>> Hopefully this answers your question.
>>>
>>> Cheers, Simon
>>>
>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.r.carr at gmail.com  Mon Feb 27 21:48:22 2012
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 27 Feb 2012 15:48:22 -0600
Subject: [rabbitmq-discuss] Understanding Federation
In-Reply-To: <CAJreXKCWFdaokHbNUZ7W17-P5A2zDVV73qvZg_ocDZsYwQ3fOg@mail.gmail.com>
References: <C3481B5CE3E61E438EEF6143B51DC17F652F5A11E5@Y000IIIV01.rd1.rf1>
	<4F461EB3.3000503@rabbitmq.com>
	<C3481B5CE3E61E438EEF6143B51DC17F652F5A15AA@Y000IIIV01.rd1.rf1>
	<4F466D8F.8050705@rabbitmq.com>
	<CAJreXKBh1qDgt+T5FYL8aehdw4U99tRh8Ckuu1A5n0ShN=o7eA@mail.gmail.com>
	<CAJreXKCWFdaokHbNUZ7W17-P5A2zDVV73qvZg_ocDZsYwQ3fOg@mail.gmail.com>
Message-ID: <CAJreXKBQD9QukjgbMy6VeZ0201NzJCitCSsQ3tYd55f=9XqAiA@mail.gmail.com>

Nvm, I got it working.

On Mon, Feb 27, 2012 at 3:13 PM, James Carr <james.r.carr at gmail.com> wrote:
> FYI, here is the configuration I am using on the downstream server:
>
> [
> ?{rabbitmq_federation,
> ? ?[ {exchanges, [[{exchange, ? ? "usage"},
> ? ? ? ? ? ? ? ? ? ?{virtual_host, "/"},
> ? ? ? ? ? ? ? ? ? ?{type, ? ? ? ? "topic"},
> ? ? ? ? ? ? ? ? ? ?{durable, ? ? ?true},
> ? ? ? ? ? ? ? ? ? ?{auto_delete, ?false},
> ? ? ? ? ? ? ? ? ? ?{internal, ? ? false},
> ? ? ? ? ? ? ? ? ? ?{upstream_set, "remotes"}]
> ? ? ? ? ? ? ? ? ?]},
> ? ? ?{upstream_sets, [{"remotes", [[{connection, ?"upstream-server"},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {exchange, ? ?"usage"},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {max_hops, ? ?2}]
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ]}
> ? ? ? ? ? ? ? ? ? ? ?]},
> ? ? ?{connections, [{"upstream-server", [{host, ? ? ? ? ? ?"dc2rabbitmq1"},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{protocol, ? ? ? ?"amqp"},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{port, ? ? ? ? ? ?"5672"},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{virtual_host, ? ?"/"},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{username, ? ? ? ?"guest"},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{password, ? ? ? ?"guest"},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{mechanism, ? ? ? default},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{prefetch_count, ?1000},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{reconnect_delay, 5},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{heartbeat, ? ? ? 1},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{queue_expires, ? 30000},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{message_ttl, ? ? 10000}
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?]}
> ? ? ? ? ? ? ? ? ? ? ?]},
> ? ? ?{local_username, "guest"},
> ? ? ?{local_nodename, "rabbit"}
> ? ?]
> ?}
> ].
>
>
> It creates the local exchange on the downstream node just fine, but no
> action on the upstream (dc2rabbitmq1). A look at the error logs
> reveals the below messages, but I don't completely grok erlang yet. :S
>
> =ERROR REPORT==== 27-Feb-2012::15:01:20 ===
> ** Generic server <0.1963.0> terminating
> ** Last message in was connect
> ** When Server state == {state,amqp_network_connection,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{state,undefined,undefined,undefined,undefined,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?undefined,false},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?<0.1962.0>,undefined,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{amqp_params_network,<<"guest">>,<<"guest">>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?<<"/">>,"dc2rabbitmq1","5672",0,0,1,infinity,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?none,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[#Fun<amqp_auth_mechanisms.plain.3>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? #Fun<amqp_auth_mechanisms.amqplain.3>],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],[]},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?undefined,undefined,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?#Fun<amqp_connection_sup.0.39273983>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?#Fun<amqp_connection_sup.2.54430129>,false}
> ** Reason for termination ==
> ** {function_clause,[{inet_tcp,getserv,["5672"]},
> ? ? ? ? ? ? ? ? ? ? {gen_tcp,connect1,4},
> ? ? ? ? ? ? ? ? ? ? {gen_tcp,connect,4},
> ? ? ? ? ? ? ? ? ? ? {amqp_network_connection,do_connect,5},
> ? ? ? ? ? ? ? ? ? ? {amqp_gen_connection,handle_call,3},
> ? ? ? ? ? ? ? ? ? ? {gen_server,handle_msg,5},
> ? ? ? ? ? ? ? ? ? ? {proc_lib,init_p_do_apply,3}]}
>
> =ERROR REPORT==== 27-Feb-2012::15:01:20 ===
> ** Generic server <0.1949.0> terminating
> ** Last message in was {'$gen_cast',maybe_go}
> ** When Server state == {not_started,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{{upstream,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {amqp_params_network,<<"guest">>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? <<"guest">>,<<"/">>,"dc2rabbitmq1",
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? "5672",0,0,1,infinity,none,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [#Fun<amqp_auth_mechanisms.plain.3>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?#Fun<amqp_auth_mechanisms.amqplain.3>],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [],[]},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? <<"usage">>,1000,2,5,none,10000,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? "upstream-server"},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? {resource,<<"/">>,exchange,<<"usage">>}}}
> ** Reason for termination ==
> ** {{function_clause,[{inet_tcp,getserv,["5672"]},
> ? ? ? ? ? ? ? ? ? ? ?{gen_tcp,connect1,4},
> ? ? ? ? ? ? ? ? ? ? ?{gen_tcp,connect,4},
> ? ? ? ? ? ? ? ? ? ? ?{amqp_network_connection,do_connect,5},
> ? ? ? ? ? ? ? ? ? ? ?{amqp_gen_connection,handle_call,3},
> ? ? ? ? ? ? ? ? ? ? ?{gen_server,handle_msg,5},
> ? ? ? ? ? ? ? ? ? ? ?{proc_lib,init_p_do_apply,3}]},
> ? ?{gen_server,call,[<0.1963.0>,connect,infinity]}}
>
> =WARNING REPORT==== 27-Feb-2012::15:01:20 ===
> Channel (<0.1958.0>): Unregistering confirm handler <0.1949.0> because
> it died. Reason: {{function_clause,
>
> ? ? ? ? ? ? ? ? ? [{inet_tcp,
>
> ? ? ? ? ? ? ? ? ? ? getserv,
>
> ? ? ? ? ? ? ? ? ? ? ["5672"]},
>
> ? ? ? ? ? ? ? ? ? ?{gen_tcp,
>
> ? ? ? ? ? ? ? ? ? ? connect1,
>
> ? ? ? ? ? ? ? ? ? ? 4},
>
> ? ? ? ? ? ? ? ? ? ?{gen_tcp,
>
> ? ? ? ? ? ? ? ? ? ? connect,
>
> ? ? ? ? ? ? ? ? ? ? 4},
>
> ? ? ? ? ? ? ? ? ? ?{amqp_network_connection,
>
> ? ? ? ? ? ? ? ? ? ? do_connect,
>
> ? ? ? ? ? ? ? ? ? ? 5},
>
> ? ? ? ? ? ? ? ? ? ?{amqp_gen_connection,
>
> ? ? ? ? ? ? ? ? ? ? handle_call,
>
> ? ? ? ? ? ? ? ? ? ? 3},
>
> ? ? ? ? ? ? ? ? ? ?{gen_server,
>
> ? ? ? ? ? ? ? ? ? ? handle_msg,
>
> ? ? ? ? ? ? ? ? ? ? 5},
>
> ? ? ? ? ? ? ? ? ? ?{proc_lib,
>
> ? ? ? ? ? ? ? ? ? ? init_p_do_apply,
>
> ? ? ? ? ? ? ? ? ? ? 3}]},
>
> ? ? ? ? ? ? ? ? ?{gen_server,
>
> ? ? ? ? ? ? ? ? ? call,
>
> ? ? ? ? ? ? ? ? ? [<0.1963.0>,
>
> ? ? ? ? ? ? ? ? ? ?connect,
>
> ? ? ? ? ? ? ? ? ? ?infinity]}}
>
> Any help would be appreciated.
>
> Thanks,
> James
>
>
> On Mon, Feb 27, 2012 at 2:12 PM, James Carr <james.r.carr at gmail.com> wrote:
>> Sorry to hijack an existing thread, but I'm delving into using
>> federation myself (after a 3 month break of even working with
>> rabbitmq) and have a couple questions.
>>
>> 1) Does federation need to be installed on both upstream and downstream?
>> 2) I have a configuration that matches what Denis has but it only
>> creates the exchange on the downstream server and does nothing
>> upstream (only difference between his and mine is the remote hostname,
>> of course). What am I missing?
>>
>>
>> Thanks,
>> James
>>
>>
>> On Thu, Feb 23, 2012 at 10:47 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
>>> On 23/02/12 16:36, MELIQUE Denis (MORPHO) wrote:
>>>>
>>>> Thank you Simon.
>>>>
>>>> This makes it much clearer for me.
>>>> I was first surprised to see this queue always empty on my test bed,
>>>> but the reason is (correct me if I'm wrong)
>>>> that my system was not loaded enough, and consumers got messages as soon
>>>> as they came in.
>>>
>>>
>>> You're partly right. Your system was not loaded enough, but the messages in
>>> that queue will be consumed by the downstream exchange, not (directly) by
>>> your consumers.
>>>
>>>
>>>> So every message consumed from the downstream is first written on disk.
>>>
>>>
>>> No. The queue is durable, but that just determines whether it survives a
>>> restart. Transient messages can still through it, and remain transient.
>>>
>>> Cheers, Simon
>>>
>>>
>>>> This might be a disadvantage for performance.
>>>> And gives an advantage to Shovel, as you can configure it with transient
>>>> queues.
>>>>
>>>> Denis
>>>>
>>>> -----Original Message-----
>>>> From: Simon MacMullen [mailto:simon at rabbitmq.com]
>>>> Sent: Thursday, February 23, 2012 12:11 PM
>>>> To: MELIQUE Denis (MORPHO)
>>>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>>>> Subject: Re: [rabbitmq-discuss] Understanding Federation
>>>>
>>>> On 23/02/12 10:56, MELIQUE Denis (MORPHO) wrote:
>>>>>
>>>>> I?m doing some testing with federation plug-in to try to understand it.
>>>>
>>>>
>>>> Cool!
>>>>
>>>> <snip>
>>>>
>>>>> What are these Exchange and Queues used for ?
>>>>
>>>>
>>>> The queue is there to buffer messages that are published to the upstream
>>>> exchange and have not yet been consumed from the downstream exchange.
>>>>
>>>> It is bound to the internal exchange with the union of all the bindings
>>>> that are in use downstream, so we only transfer messages that are going
>>>> to be of use downstream.
>>>>
>>>> The internal exchange is there so that whenever we (re)establish a
>>>> federation link we can set up an exact set of bindings
>>>> mostly-atomically, by creating a new internal exchange, creating all the
>>>> bindings to it, then binding it to the upstream exchange.
>>>>
>>>>> Are they reserved for federation internal use ?
>>>>
>>>>
>>>> Yes.
>>>>
>>>>> When do messages go into these queues ?
>>>>
>>>>
>>>> As mentioned, the bindings are pushed upstream so messages from upstream
>>>> go into these queues if they will be routed once they get downstream.
>>>>
>>>>> Do they have to be durable or is there a way to configure them as
>>>>> transient ?
>>>>
>>>>
>>>> At the moment they have to be durable. Is this a problem? The idea is
>>>> that you can set the queue TTL if you do not want them to hang around
>>>> forever.
>>>>
>>>>> I would be very interested by a brief description of how federation
>>>>> works internally.
>>>>
>>>>
>>>> Hopefully this answers your question.
>>>>
>>>> Cheers, Simon
>>>>
>>>
>>>
>>> --
>>> Simon MacMullen
>>> RabbitMQ, VMware
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From codevally at gmail.com  Tue Feb 28 00:20:04 2012
From: codevally at gmail.com (Codevally)
Date: Mon, 27 Feb 2012 16:20:04 -0800 (PST)
Subject: [rabbitmq-discuss] Problem with using rabbitmqctl on EC2
In-Reply-To: <CABzX+qyoBX2CHX5z1wWrPyG-d7iTqLUcZWozEGDsp1UARCbubg@mail.gmail.com>
References: <17970f1d-15cf-42a2-9b5a-f431ffd74a6d@v2g2000vbx.googlegroups.com>
	<CABzX+qyoBX2CHX5z1wWrPyG-d7iTqLUcZWozEGDsp1UARCbubg@mail.gmail.com>
Message-ID: <dabea8d6-2f46-4712-b591-3850c5cae201@em9g2000vbb.googlegroups.com>

Hi

Both ping `hostname` and ping `hostname -f` is working fine.

The latest issue is when I try to get the status using rabbitmqctl
(rabbitmq status) it says

ec2test2:/app/rabbitmq/sbin # sh rabbitmqctl status
Status of node rabbit at ec2test2 ...

=ERROR REPORT==== 28-Feb-2012::00:14:34 ===
** System running to use fully qualified hostnames **
** Hostname ec2test2 is illegal **
Error: unable to connect to node rabbit at ec2test2: nodedown
diagnostics:
- nodes and their ports on ec2test2: [{rabbit,30000},
{rabbitmqctl12151,54167}]
- current node: 'rabbitmqctl12151 at ec2test2.xx-
xx-1.compute.amazonaws.com'
- current node home dir: /root
- current node cookie hash: 4lZvwoYL5ZJbkEiBx9CgDB==

But if I specify the node using -n (rabbitmqctl -n ec2test2 status)
and it says

ec2test2:/app/rabbitmq/sbin # sh rabbitmqctl -n ec2test2 status
Status of node 'ec2test2 at ec2test2.xx-xx-1.compute.amazonaws.com' ...
Error: unable to connect to node 'ec2test2 at ec2test2.xx-
xx-1.compute.amazonaws.com': nodedown
diagnostics:
- nodes and their ports on ec2test2.xx-xx-1.compute.amazonaws.com:
[{rabbit,
 
30000},
 
{rabbitmqctl12163,
 
56206}]
- current node: 'rabbitmqctl12163 at ec2test2.xx-
xx-1.compute.amazonaws.com'
- current node home dir: /root
- current node cookie hash: 4lZvwoYL5ZJbkEiBx9CgDB==

Any idea??

On Feb 27, 11:25?pm, Marek Majkowski <maje... at gmail.com> wrote:
> On Mon, Feb 27, 2012 at 03:00, Codevally <codeva... at gmail.com> wrote:
> > I have installed RabbitMQ 2.7.1 on EC2 (host name is ec2test2) and
> > server getting started without any issue.
>
> > AMQP 0-9-1 / 0-9 / 0-8
> > Copyright (C) 2007-2011 VMware, Inc.
> > Licensed under the MPL. ?Seehttp://www.rabbitmq.com/
>
> > node ? ? ? ? ? : rabbit at ec2test2
> > app descriptor : /app/rabbitmq_server-2.7.1/sbin/../ebin/rabbit.app
> > home dir ? ? ? : /root
> > config file(s) : (none)
> > cookie hash ? ?: 4lZvwoYL5ZJbkEiBx9CgDA==
> > log ? ? ? ? ? ?: /var/log/rabbitmq/rab... at ec2test2.log
> > sasl log ? ? ? : /var/log/rabbitmq/rab... at ec2test2-sasl.log
> > database dir ? : /app/rabbitmq-config/lib/rabbitmq/mnesia/
> > rabbit at ec2test2
> > erlang version : 5.9
>
> > But when I try to use rabbitmqctl, I am getting the below error.
>
> > ec2test2:/app/rabbitmq/sbin # sh rabbitmqctl
> > {error_logger,{{2012,2,27},{2,55,8}},"Can't set long node name!
> > \nPlease check your configuration\n",[]}
> > {error_logger,{{2012,2,27},{2,55,8}},crash_report,[[{initial_call,
> > {net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},
> > {error_info,{exit,{error,badarg},[{gen_server,init_it,6,
> > [{file,"gen_server.erl"},{line,313}]},{proc_lib,init_p_do_apply,3,
> > [{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,
> > [net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.17.0>]},
> > {dictionary,[{longnames,true}]},{trap_exit,true},{status,running},
> > {heap_size,6765},{stack_size,24},{reductions,2361}],[]]}
>
> > Host name is correctly configured and it displays:
> > ec2test2:/app/rabbitmq/sbin # hostname
> > ec2test2
> > ec2test2:/app/rabbitmq/sbin #
>
> > Could someone please explain this erroneous behavior?
>
> Google suggests:
> ?https://groups.google.com/group/erlang-programming/msg/72f4dc5311729eb2
>
> > A little more experimentation revealed that the problem was that the
> > system returned no FQDN for itself, as indicated for example by
> > 'hostname -f'. A little /etc/hosts manipulation fixed that, and all
> > was well.
>
> Basically, make sure that this works fine:
> ? ping `hostname`
> ? ping `hostname -f`
>
> Cheers,
> ? ? Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From preetisp_83 at yahoo.com  Tue Feb 28 03:13:04 2012
From: preetisp_83 at yahoo.com (preeti sp)
Date: Mon, 27 Feb 2012 19:13:04 -0800 (PST)
Subject: [rabbitmq-discuss] Regd: Spring AMQP versus Java Client Library
In-Reply-To: <1328609477.83860.YahooMailClassic@web39302.mail.mud.yahoo.com>
Message-ID: <1330398784.33543.YahooMailClassic@web39301.mail.mud.yahoo.com>

Hi?Do we get any advantages If we use Spring AMQP over Java Client Library or vice-versa?
Is it advised to use Spring AMQP If we do not intend to primarily use Spring as such?
Thanks,Preeti
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120227/ba4b3cb7/attachment.htm>

From uday.subbarayan at yahoo.com  Tue Feb 28 05:14:45 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Mon, 27 Feb 2012 21:14:45 -0800 (PST)
Subject: [rabbitmq-discuss] Apache MINA Integration
In-Reply-To: <4F4B6C50.9070702@rabbitmq.com>
References: <1330289513.57728.YahooMailNeo@web44910.mail.sp1.yahoo.com>
	<4F4B6C50.9070702@rabbitmq.com>
Message-ID: <1330406085.22452.YahooMailNeo@web44903.mail.sp1.yahoo.com>

Very simple- I run MINA as a TCP server with integrated Rabbit MQ Java client to publish and consume messages.

Thanks,
Uday.


________________________________
 From: Michael Bridgen <mikeb at rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Monday, February 27, 2012 3:43 AM
Subject: Re: [rabbitmq-discuss] Apache MINA Integration
 
> Has anyone integrated Apache MINA with Rabbit MQ to publish and receive
> messages?

What form would you expect such an integration to take?
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120227/69c23fc1/attachment.htm>

From uday.subbarayan at yahoo.com  Tue Feb 28 05:16:13 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Mon, 27 Feb 2012 21:16:13 -0800 (PST)
Subject: [rabbitmq-discuss] Apache MINA Integration
In-Reply-To: <3a6a63fd-615c-4fec-8dfd-7db4595f6c64@oleg-2.local>
References: <4F4B6C50.9070702@rabbitmq.com>
	<3a6a63fd-615c-4fec-8dfd-7db4595f6c64@oleg-2.local>
Message-ID: <1330406173.4296.YahooMailNeo@web44909.mail.sp1.yahoo.com>

I am aware of the general purpose EAI frameworks including Camel. We are building a high performance compute cluster and using Rabbit MQ to pass messages. So, i want something very simple TCP server to receive & send messages to the queue.

Best,
Uday.


________________________________
 From: Oleg Zhurakousky <ozhurakousky at vmware.com>
To: Michael Bridgen <mikeb at rabbitmq.com> 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Monday, February 27, 2012 6:20 AM
Subject: Re: [rabbitmq-discuss] Apache MINA Integration
 
I believe it is a more general concern and typically handled by integration frameworks, in this case EIP-style (http://www.eaipatterns.com/) frameworks such as Spring Integration (http://www.springsource.org/spring-integration)
These frameworks already have fist class integration with AMQP (e.g., AMQP inbound and outbound channel adapters) as well as other protocols and products including TCP/IP.

Oleg

----- Original Message -----
From: "Michael Bridgen" <mikeb at rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, February 27, 2012 6:43:12 AM
Subject: Re: [rabbitmq-discuss] Apache MINA Integration

> Has anyone integrated Apache MINA with Rabbit MQ to publish and receive
> messages?

What form would you expect such an integration to take?
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120227/20f75108/attachment.htm>

From mabrek at gmail.com  Tue Feb 28 05:41:22 2012
From: mabrek at gmail.com (Anton Lebedevich)
Date: Tue, 28 Feb 2012 08:41:22 +0300
Subject: [rabbitmq-discuss] Ensuring low latency for publishers
In-Reply-To: <4F47726A.7000401@rabbitmq.com>
References: <1e665e68-b239-44a0-aecd-af98dec19d1d@qs5g2000pbc.googlegroups.com>
	<4F43DB61.2030304@rabbitmq.com>
	<e105cb4d-f320-4c04-8068-9c58a068ea05@x6g2000pbk.googlegroups.com>
	<7dc34cad-d8f9-4903-a72d-cb3dfc2a4749@o4g2000pbc.googlegroups.com>
	<4f4690a9-038d-4fdb-bce1-ae8c246a3247@ub4g2000pbc.googlegroups.com>
	<20120222175207.GA29288@wellquite.org>
	<4F462C80.4080108@rabbitmq.com> <4F462DE6.4060104@rabbitmq.com>
	<b16ad838-4b64-4cae-8f07-b4d086332418@m3g2000pbi.googlegroups.com>
	<4F47726A.7000401@rabbitmq.com>
Message-ID: <CAOTaUYMpmnsvn2L0qTXxnKEhCEwnWntOhN8=a8m59qDtg7b76A@mail.gmail.com>

Hello.
I had the same situation. Web application written in java that
publishes on each request and needs to respond fast (even with 50x
error). Rabbitmq throttling once halted all connected web frontends
causing whole cluster failure.
Then I used a separate publishing thread with blocking queue and
single lock contention wasn't a problem for me. But publishing rate on
a single machine was quite low about hundred/s.

On Fri, Feb 24, 2012 at 3:20 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 23/02/12 20:27, Eric wrote:
>>
>> Well... I would find it useful. ?And the person in the thread I linked
>> to would have found it useful as well.
>
>
> Sure, I'm trying to gauge how widespread such a demand is. It looks like we
> could plausibly do something in this direction.
>
>
>> It's pretty tough to go into a production environment with the
>> statement "Publishing should be fast unless the broker is throttling.
>> If the broker is throttling we won't be able to tell, we don't have a
>> good way of knowing beforehand, and we don't know how long the threads
>> will be blocked". ?It's useful in any case where an application would
>> rather not publish the message rather than waiting to publish it
>> indefinitely.
>
>
> Yeah, the problem is that we've historically optimised for Never Throwing
> Away Messages Ever Ever...
>
>
>> The net result is that a struggling broker will cause a chain
>> reaction; publishers will block indefinitely, which may bring the
>> publishing application to a halt. ?In that case I'd like to abandon
>> the publishing process, but it's quite impossible at that point - it's
>> too late, the broker is already throttling, and there's no timeout.
>> The thread could block for seconds, or more. ?I'm concerned about not
>> throwing the message away, but I'm more concerned about being able to
>> isolate services from RabbitMQ broker events.
>
>
> If it's any consolation the flow control stuff that's coming in 2.8.0 will
> make it much harder to make the memory alarm go off, so blocking for seconds
> should be much less likely.
>
>
>> One more question along this line. ?The flow control document says "By
>> default, when the RabbitMQ server uses above 40% of the installed RAM,
>> it raises a memory alarm... Connection heartbeat monitoring gets
>> disabled too." ?If I set up a connection heartbeat on the shared
>> connection, will the heartbeat detect a broker alarm that exceeds the
>> interval and disconnect? ?A disconnect would terminate the publisher
>> channels and free things up.
>
>
> No - the whole point of disabling heartbeats is to make sure connections
> stay up when this happens...
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simone.busoli at gmail.com  Tue Feb 28 07:31:44 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Tue, 28 Feb 2012 08:31:44 +0100
Subject: [rabbitmq-discuss]
	=?utf-8?b?562U5aSNOiBQYXNzaXZlIHF1ZXVlIGRlY2xh?=
	=?utf-8?q?ration_and_channel_closure?=
In-Reply-To: <4F4B63C9.7070909@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E520F1E82@GSVCLU04.ges.ferlan.it>
	<73831E29-46BF-464A-A9B9-CA040F734011@rabbitmq.com>
	<CAOn7oW_QumnbXwHO-boNBU9DrXpMHmY+iYBBX8EXR5pWdLFP8Q@mail.gmail.com>
	<D027DE656EBD4F4C8EE57361B5EF438E39924E5D@szxeml524-mbx.china.huawei.com>
	<CAOn7oW_rgYW37zQZGqKCOoN8uW3FvkYCHCHRuiBgH8pa11NC4A@mail.gmail.com>
	<4F4B63C9.7070909@rabbitmq.com>
Message-ID: <CAOn7oW-dqgQhCJ3F63S9n-XsNxUzWf9PsMdMB4W29_yZf0djVw@mail.gmail.com>

Hi Simon,

As I pointed out in the past there is unfortunately not one main category
of information that is difficult to discover without trying it out
yourself, but perhaps the most relevant unanswered questions are about
conclusions that could be inferred from the spec and the docs, but that you
can't usually infer unless you know the end of the story already. The one
in this thread is a good example of that.
On Feb 27, 2012 12:06 PM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

> On 25/02/12 18:37, Simone Busoli wrote:
> > David, I somewhat agree with you, lack of documentation about
> > operational aspects of broker behavior is something I have been missing
> > as well.
>
> Yeah, I suspect our documentation could still be better. But this is one
> of the areas where it's really easy to be blinded by over-familiarity.
> What sort of things do you think are particularly missing?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120228/4f4befe1/attachment.htm>

From simon at rabbitmq.com  Tue Feb 28 09:50:18 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 28 Feb 2012 09:50:18 +0000
Subject: [rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory
 on slave nodes
In-Reply-To: <6e37792a-06c9-4b30-8536-fa78d90e00dc@p7g2000yqk.googlegroups.com>
References: <4F454C42.4080400@gmail.com>
	<4F46877A.90206@aol.com>	<4F476AE7.8050508@rabbitmq.com>
	<6e37792a-06c9-4b30-8536-fa78d90e00dc@p7g2000yqk.googlegroups.com>
Message-ID: <4F4CA35A.1090008@rabbitmq.com>

Thanks for the additional information. I'll have another go at 
replicating...

On 27/02/12 19:34, Chip Salzenberg wrote:

> Our local Erlang expert is on vacation, but he rescued our cluster.
> He described a mailbox full of messages that some process was not
> consuming.  When he killed the process and, IIRC, the "shell" that had
> spawned it (I am merely parroting what I recall, this may be the wrong
> term), the bloat was cured and memory usage returned to normal.

I don't suppose you have any record of what type of process it was / 
what the messages looked like?

Cheers, Simon

> Details that might matter in reproduction:  Our troubled mirrored
> queue used mode "nodes" (not "all"), picking two nodes out of a
> cluster of four.  When I created it, I used a modified rabbitmqadmin
> that connected to one of the two nodes, and specified that it and one
> other node should mirror the queue.  All messages were written with
> delivery-mode 2.  Messages are about 46K each.  While some of the
> messages were consumed, most were purged.  Queue deletion did not cure
> the leak.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Tue Feb 28 10:02:49 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 28 Feb 2012 10:02:49 +0000
Subject: [rabbitmq-discuss] STOMP Plugin: Alternative exchange other
	than amq.topic?
In-Reply-To: <0b60a172-aa64-48e5-a9bb-a63e2f83250b@gr6g2000vbb.googlegroups.com>
References: <CADSpLP9gb9R2ZbEJ1OntxedX0VqMX1c_9-cGTBdyo+a8NbWmNQ@mail.gmail.com>
	<5EE26AB5-AC20-479F-B304-8B7DC73D21BD@rabbitmq.com>
	<0b60a172-aa64-48e5-a9bb-a63e2f83250b@gr6g2000vbb.googlegroups.com>
Message-ID: <FD6F02F2-5F48-46AB-B61B-E46EAA48F11F@rabbitmq.com>

Hi Cliff,

On the STOMP page, it says that subscribing to an explicit exchange does what
you want. Is there something I've missed?

> Having to create a queue and bind it to an alternatively named
> federated topic exchange using an AMQ client before each Stomp
> subscription significantly reduces the utility of the Stomp plugin (in
> this federated case).

--8<---cut-here------------------------
For SUBSCRIBE frames, a destination of the form /exchange/<name>[/<pattern>] can be used. This destination:

	? creates an exclusive, auto-delete queue on <name> exchange;
	? if <pattern> is supplied, binds the queue to <name> exchange using <pattern>; and
	? registers a subscription against the queue, for the current STOMP session.
---------------------------------------

Steve Powell  (a hippy bunny, man)
----------some more definitions from the SPD----------
vermin (v.) Treating the dachshund for roundworm.
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.

On 22 Feb 2012, at 12:08, Cliff Redmond wrote:

> (Sending directly because my post is awaiting moderator approval)
> 
> Hi Steve,
> 
> thanks for your answer.
> 
> I'm facing the exact same problem as Ken: I think your solution only
> partially addresses the issue.
> 
> One of the most useful features of the Stomp plugin is that when a
> (Stomp) consumer subscribes to a Stomp topic, it automatically creates
> a new queue (with a lifecycle dictated by the subscription) and binds
> it to the default topic exchange on the relevant host.
> 
> e.g. invoking the following in a consumer:
> 
> $frame = Net::Stomp::Frame->new( {
>      command => "SUBSCRIBE",
>      headers => {
>          destination => "/topic/durable-topic-prefetch",
>          id => $subscriberId,
>          persistent => "true",
>          ack => "client",
>          prefetch_count => 1,
>      },
> });
> 
> $stomp->send_frame($frame);
> 
> will create a queue on the relevant broker:
> 
> sh-3.2# rabbitmqctl list_queues
> Listing queues ...
> [...]
> stomp.dsub.durable-topic-prefetch.???R?M?\0006??1>?U	0
> [...]
> ...done.
> 
> and bind it to the default topic exchange:
> 
> Listing bindings ...
> [...]
> amq.topic	exchange	stomp.dsub.durable-topic-prefetch.???R?M?\0006??1>?
> U	queue	durable-topic-prefetch	[]
> [...]
> ...done.
> 
> Having to create a queue and bind it to an alternatively named
> federated topic exchange using an AMQ client before each Stomp
> subscription significantly reduces the utility of the Stomp plugin (in
> this federated case).
> 
> My suggestion would be for a change to either of the Stomp or
> Federation plugins:
> 
> - be able to specify a topic exchange to the Stomp plugin (i.e. rather
> than have it always use amq.topic),
> - be able to federate internal/predefined exchanges in the Federation
> plugin.
> 
> With a preference for the former.
> 
> Hope this helps & many thanks,
> 
> Cliff.
> 
> On Feb 21, 6:25 pm, Steve Powell <st... at rabbitmq.com> wrote:
>> Hi Ken,
>> 
>> It is possible for you to SEND to the exchange of your choice from a STOMP
>> application, using a destination of the form: /exchange/<name>/<pattern> (seehttp://www.rabbitmq.com/stomp.html#d.ed) and there is no reason why this
>> shouldn't be a topic exchange of your own making.
>> 
>> If you need to SUBSCRIBE to AMQP destinations you can use the destination
>> /amq/queue/<name> (but the queue must exist).
>> 
>> Between them, these should allow you to use STOMP with federated exchanges
>> without plugin modifications.
>> 
>> Let us know how you get on.
>> 
>> Steve Powell  (a federated bunny)
>> ----------some more definitions from the SPD----------
>> vermin (v.) Treating the dachshund for roundworm.
>> chinchilla (n.) Cooling device for the lower jaw.
>> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>> 
>> On 20 Feb 2012, at 16:19, Ken Simon wrote:
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>>> Greetings,
>> 
>>> I'm trying to get federation working (via the rabbitmq_federation
>>> plugin) in our environment of STOMP hosts, and to do so I have to
>>> enable federation in the STOMP plugin's exchange: amq.topic.  This
>>> unfortunately doesn't seem to work because amq.* exchanges are
>>> reserved and cannot be re-declared.
>> 
>>> My solution at this point has been to edit the source of the STOMP
>>> plugin and point it at an exchange called "stomp_topic" (which I made
>>> up, but could be anything) instead of the default amq.topic.  Then I
>>> just configure the federation plugin to work with that exchange and it
>>> works fine.
>> 
>>> My question is, is there a better way of doing this?  I hate
>>> maintaining my own downstream changes to plugins if I don't have to.
>>> The docs say that the STOMP plugin routes all messages through
>>> amq.topic, so it appears that's not configurable.  But wouldn't it
>>> make sense to allow use of an exchange that's not reserved?  Or am I
>>> missing something, and this is actually way easier?  I'm having
>>> trouble finding any documented cases of people using both STOMP and
>>> federation.
>> 
>>> Thanks,
>> 
>>> --
>>> Ken
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From majek04 at gmail.com  Tue Feb 28 11:06:40 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 28 Feb 2012 11:06:40 +0000
Subject: [rabbitmq-discuss] Problem with using rabbitmqctl on EC2
In-Reply-To: <dabea8d6-2f46-4712-b591-3850c5cae201@em9g2000vbb.googlegroups.com>
References: <17970f1d-15cf-42a2-9b5a-f431ffd74a6d@v2g2000vbx.googlegroups.com>
	<CABzX+qyoBX2CHX5z1wWrPyG-d7iTqLUcZWozEGDsp1UARCbubg@mail.gmail.com>
	<dabea8d6-2f46-4712-b591-3850c5cae201@em9g2000vbb.googlegroups.com>
Message-ID: <CABzX+qx53_xvg2UXihbHVS8hcmEzP1CDj9-DN5Z05OgbkeD2gw@mail.gmail.com>

On Tue, Feb 28, 2012 at 00:20, Codevally <codevally at gmail.com> wrote:
> Both ping `hostname` and ping `hostname -f` is working fine.
>
> The latest issue is when I try to get the status using rabbitmqctl
> (rabbitmq status) it says
>
> ec2test2:/app/rabbitmq/sbin # sh rabbitmqctl status
> Status of node rabbit at ec2test2 ...
>
> =ERROR REPORT==== 28-Feb-2012::00:14:34 ===
> ** System running to use fully qualified hostnames **
> ** Hostname ec2test2 is illegal **
> Error: unable to connect to node rabbit at ec2test2: nodedown
> diagnostics:
> - nodes and their ports on ec2test2: [{rabbit,30000},
> {rabbitmqctl12151,54167}]
> - current node: 'rabbitmqctl12151 at ec2test2.xx-
> xx-1.compute.amazonaws.com'

See? Your system is clearly confused if hostname
is ec2test2.xx-xx-1.compute.amazonaws.com or ec2test2.

Take a look at http://www.rabbitmq.com/ec2.html
the "Issues with hostname" section.

Marek

> - current node home dir: /root
> - current node cookie hash: 4lZvwoYL5ZJbkEiBx9CgDB==
>
> But if I specify the node using -n (rabbitmqctl -n ec2test2 status)
> and it says
>
> ec2test2:/app/rabbitmq/sbin # sh rabbitmqctl -n ec2test2 status
> Status of node 'ec2test2 at ec2test2.xx-xx-1.compute.amazonaws.com' ...
> Error: unable to connect to node 'ec2test2 at ec2test2.xx-
> xx-1.compute.amazonaws.com': nodedown
> diagnostics:
> - nodes and their ports on ec2test2.xx-xx-1.compute.amazonaws.com:
> [{rabbit,
>
> 30000},
>
> {rabbitmqctl12163,
>
> 56206}]
> - current node: 'rabbitmqctl12163 at ec2test2.xx-
> xx-1.compute.amazonaws.com'
> - current node home dir: /root
> - current node cookie hash: 4lZvwoYL5ZJbkEiBx9CgDB==
>
> Any idea??
>
> On Feb 27, 11:25?pm, Marek Majkowski <maje... at gmail.com> wrote:
>> On Mon, Feb 27, 2012 at 03:00, Codevally <codeva... at gmail.com> wrote:
>> > I have installed RabbitMQ 2.7.1 on EC2 (host name is ec2test2) and
>> > server getting started without any issue.
>>
>> > AMQP 0-9-1 / 0-9 / 0-8
>> > Copyright (C) 2007-2011 VMware, Inc.
>> > Licensed under the MPL. ?Seehttp://www.rabbitmq.com/
>>
>> > node ? ? ? ? ? : rabbit at ec2test2
>> > app descriptor : /app/rabbitmq_server-2.7.1/sbin/../ebin/rabbit.app
>> > home dir ? ? ? : /root
>> > config file(s) : (none)
>> > cookie hash ? ?: 4lZvwoYL5ZJbkEiBx9CgDA==
>> > log ? ? ? ? ? ?: /var/log/rabbitmq/rab... at ec2test2.log
>> > sasl log ? ? ? : /var/log/rabbitmq/rab... at ec2test2-sasl.log
>> > database dir ? : /app/rabbitmq-config/lib/rabbitmq/mnesia/
>> > rabbit at ec2test2
>> > erlang version : 5.9
>>
>> > But when I try to use rabbitmqctl, I am getting the below error.
>>
>> > ec2test2:/app/rabbitmq/sbin # sh rabbitmqctl
>> > {error_logger,{{2012,2,27},{2,55,8}},"Can't set long node name!
>> > \nPlease check your configuration\n",[]}
>> > {error_logger,{{2012,2,27},{2,55,8}},crash_report,[[{initial_call,
>> > {net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},
>> > {error_info,{exit,{error,badarg},[{gen_server,init_it,6,
>> > [{file,"gen_server.erl"},{line,313}]},{proc_lib,init_p_do_apply,3,
>> > [{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,
>> > [net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.17.0>]},
>> > {dictionary,[{longnames,true}]},{trap_exit,true},{status,running},
>> > {heap_size,6765},{stack_size,24},{reductions,2361}],[]]}
>>
>> > Host name is correctly configured and it displays:
>> > ec2test2:/app/rabbitmq/sbin # hostname
>> > ec2test2
>> > ec2test2:/app/rabbitmq/sbin #
>>
>> > Could someone please explain this erroneous behavior?
>>
>> Google suggests:
>> ?https://groups.google.com/group/erlang-programming/msg/72f4dc5311729eb2
>>
>> > A little more experimentation revealed that the problem was that the
>> > system returned no FQDN for itself, as indicated for example by
>> > 'hostname -f'. A little /etc/hosts manipulation fixed that, and all
>> > was well.
>>
>> Basically, make sure that this works fine:
>> ? ping `hostname`
>> ? ping `hostname -f`
>>
>> Cheers,
>> ? ? Marek
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Tue Feb 28 11:21:55 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 28 Feb 2012 11:21:55 +0000
Subject: [rabbitmq-discuss] Moving a queue from one node to another
In-Reply-To: <CAKrcBhSYqV-ffFu_Nq5BK1aQNOxWjoR039+O9SAThv7nhM0QQQ@mail.gmail.com>
References: <CAKrcBhSYqV-ffFu_Nq5BK1aQNOxWjoR039+O9SAThv7nhM0QQQ@mail.gmail.com>
Message-ID: <20120228112155.GA26899@rabbitmq.com>

Hi Ionel,

On Mon, Feb 27, 2012 at 07:25:41PM +0000, Ionel Gog wrote:
> Is there any way I can move queues from one RabbitMQ node to another?

Nope, sorry, not an individual queue.

> - Mirrored queues. But I don't think you can make a queue mirrored *after*
> it has been created. Can you?

No, you can't do that.

> - Shared network disk. But this requires a broker restart - and thus
> implies loosing all non-durable queues and non-persistent messages.
> 
> Is there any other way?

I would suggest something along the lines of the following.

- bring up the new broker. Do not cluster it.
- declare all the exchanges/bindings/queues you need on the new broker
  - i.e. have the topology match exactly
- change all publishers to be publishing to the new broker
- wait for all messages to be drained from the old broker, and then
  switch over all consumers to be consuming from the new broker
- shut down the old broker

In general, whilst this does require manual intervention, and will
certainly require thought especially if your consumers also publish
messages (you'll want to abstract those connections out and generally
start the switchover from the top of the message flow to the bottom),
this process does allow you to upgrade Rabbits with no downtime at all,
though potentially with some service disruption.

Matthew

From j-jimenez at finamex.com.mx  Tue Feb 28 14:56:00 2012
From: j-jimenez at finamex.com.mx (Jose Jimenez Ortiz)
Date: Tue, 28 Feb 2012 08:56:00 -0600
Subject: [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 57, Issue 28
In-Reply-To: <mailman.1.1330344001.19760.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.1.1330344001.19760.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <AFFA651B612BDE4EB570E34F0571834D0E170F8B17@mail.vfinamex.local>

Hi all,

I installed rabbitmq 2.7.1 and enable Rabbitmq_Management plugin but in the explorer I don't see anything on OVERVIEW panel.

Any idea?

Regards,


-----Mensaje original-----
De: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] En nombre de rabbitmq-discuss-request at lists.rabbitmq.com
Enviado el: Lunes, 27 de Febrero de 2012 06:00
Para: rabbitmq-discuss at lists.rabbitmq.com
Asunto: rabbitmq-discuss Digest, Vol 57, Issue 28

Send rabbitmq-discuss mailing list submissions to
        rabbitmq-discuss at lists.rabbitmq.com

To subscribe or unsubscribe via the World Wide Web, visit
        https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
or, via email, send a message with subject or body 'help' to
        rabbitmq-discuss-request at lists.rabbitmq.com

You can reach the person managing the list at
        rabbitmq-discuss-owner at lists.rabbitmq.com

When replying, please edit your Subject line so it is more specific than "Re: Contents of rabbitmq-discuss digest..."


Today's Topics:

   1. (no subject) (jay nanavati)
   2. Apache MINA Integration (Uday Subbarayan)
   3. Problem with using rabbitmqctl on EC2 (Codevally)
   4. Re: [help] [beginner] server stops sending messages; publish
      (in transaction) hangs on commit (Alistair Bayley)
   5. dead connection lingers around? (stone)
   6. Re: Problems with STOMP & access control (Steve Powell)
   7. Re: Unexpected behaviour with STOMP & NACK (Steve Powell)
   8. Re: Consumers and exceptions (Jon Hill)
   9. Re: Problems with STOMP & access control (Lionel Cons)
  10. Re: Ensuring low latency for publishers (Simon MacMullen)
  11. Re: STOMP doesn't include the routing-key on      MESSAGE frames
      (Steve Powell)
  12. Re: dead connection lingers around? (Simon MacMullen)
  13. Re: ??:  Passive queue declaration and channel closure
      (Simon MacMullen)
  14. Re: Apache MINA Integration (Michael Bridgen)
  15. Re: [help] [beginner] server stops sending messages; publish
      (in transaction) hangs on commit (Marek Majkowski)


----------------------------------------------------------------------

Message: 1
Date: Sun, 26 Feb 2012 18:45:39 +0000
From: jay nanavati <jaysnanavati at hotmail.co.uk>
Subject: [rabbitmq-discuss] (no subject)
To: <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <BAY154-W539870CC6FC7A6D83362DC99680 at phx.gbl>
Content-Type: text/plain; charset="windows-1252"


Hi everyone,
I have followed this guide to setup rabbitMQ for android.http://simonwdixon.wordpress.com/2011/06/03/getting-started-with-rabbitmq-on-android-part-1/
The problem I am facing is On the line mConsumer.connectToRabbitMQ() in the ActivityHome, I have changed it to:
mOutput.append(?\n?+mConsumer.connectToRabbitMQ());
now when I have the wrong server, it prints false as expected however when I have the write server it does not print anything. In fact it does not even print the @string/hello which it should anyways..
The app does not consume messages and I think this could be the reason.. Also I have used loger and found out that the error must be on this method because I can logg before the call however I cannot logg anything after the call.
Any help would be greatly appreciated.. Thanks!


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120226/4bea75c7/attachment.html>

------------------------------

Message: 2
Date: Sun, 26 Feb 2012 12:51:53 -0800 (PST)
From: Uday Subbarayan <uday.subbarayan at yahoo.com>
Subject: [rabbitmq-discuss] Apache MINA Integration
To: "rabbitmq-discuss at lists.rabbitmq.com"
        <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
        <1330289513.57728.YahooMailNeo at web44910.mail.sp1.yahoo.com>
Content-Type: text/plain; charset="iso-8859-1"

Hi All,
? ? ?Has anyone integrated Apache MINA with Rabbit MQ to publish and receive messages?

Thanks,
-Uday.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120226/55d812e1/attachment-0001.htm>

------------------------------

Message: 3
Date: Sun, 26 Feb 2012 19:00:15 -0800 (PST)
From: Codevally <codevally at gmail.com>
Subject: [rabbitmq-discuss] Problem with using rabbitmqctl on EC2
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID:
        <17970f1d-15cf-42a2-9b5a-f431ffd74a6d at v2g2000vbx.googlegroups.com>
Content-Type: text/plain; charset=ISO-8859-1

Hi Experts

I have installed RabbitMQ 2.7.1 on EC2 (host name is ec2test2) and server getting started without any issue.

AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at ec2test2
app descriptor : /app/rabbitmq_server-2.7.1/sbin/../ebin/rabbit.app
home dir       : /root
config file(s) : (none)
cookie hash    : 4lZvwoYL5ZJbkEiBx9CgDA==
log            : /var/log/rabbitmq/rabbit at ec2test2.log
sasl log       : /var/log/rabbitmq/rabbit at ec2test2-sasl.log
database dir   : /app/rabbitmq-config/lib/rabbitmq/mnesia/
rabbit at ec2test2
erlang version : 5.9

But when I try to use rabbitmqctl, I am getting the below error.

ec2test2:/app/rabbitmq/sbin # sh rabbitmqctl {error_logger,{{2012,2,27},{2,55,8}},"Can't set long node name!
\nPlease check your configuration\n",[]} {error_logger,{{2012,2,27},{2,55,8}},crash_report,[[{initial_call,
{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},
{error_info,{exit,{error,badarg},[{gen_server,init_it,6,
[{file,"gen_server.erl"},{line,313}]},{proc_lib,init_p_do_apply,3,
[{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,
[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.17.0>]},
{dictionary,[{longnames,true}]},{trap_exit,true},{status,running},
{heap_size,6765},{stack_size,24},{reductions,2361}],[]]}

Host name is correctly configured and it displays:
ec2test2:/app/rabbitmq/sbin # hostname
ec2test2
ec2test2:/app/rabbitmq/sbin #

Could someone please explain this erroneous behavior?

Thanks.


------------------------------

Message: 4
Date: Mon, 27 Feb 2012 16:37:24 +1300
From: Alistair Bayley <alistair at abayley.org>
Subject: Re: [rabbitmq-discuss] [help] [beginner] server stops sending
        messages; publish (in transaction) hangs on commit
To: Simon MacMullen <simon at rabbitmq.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID:
        <CAKYODbip9zOg2=7xNukG6oMAGVqZHdU1ibza=5+98xvUTQtzow at mail.gmail.com>
Content-Type: text/plain; charset=UTF-8

On 25 February 2012 00:38, Simon MacMullen <simon at rabbitmq.com> wrote:
>>
>> OK. Can I have some guidance as to how much memory we should allocate?
>
> This is a real how-long-is-a-piece-of-string question I'm afraid. 512M
> would already be a significant step towards the comfort zone though.

rabbitmqctl report shows a large number of channels (in the thousands) and memory usage seems to correlate with the large number of channels.
I've left the server running and shut down each of the clients, and the channels have vanished from the report output, so I suspect a dodgy client here. We're using python kombu over ampqlib, so maybe kombu is doing something undesirable. A quick glance at the source shows that it has a channel pool, so maybe that's to blame. Anyway, more investigation required...

Once the number of channels is down to less than 10, the memory usage is around 32M, which seems fine to me. Maybe I don't need to allocate more, if I can solve this channels problem.


>> Is there an
>> option to get the server to return something that says that it is not
>> accepting messages?
>
> In ancient history we used to do this; there's a method in AMQP 0-9-1
> called channel.flow which the server should be able to use to tell a
> client to shut up. In practice it was unreliable (client may not
> support it, or may take too long to take notice of it).

I will do some more testing. Maybe the immediate flag on basic_publish will do something useful. python amqplib is protocol version 0.8, so whatever I do must fit in with that.

Alistair


------------------------------

Message: 5
Date: Mon, 27 Feb 2012 10:25:37 +0100
From: stone <zmstone at gmail.com>
Subject: [rabbitmq-discuss] dead connection lingers around?
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID:
        <CAPNZrFUMw1ZarWq-cuooqw8g6FJXhCNM7xgaBuiYS=a+cwHHQw at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Hi

Have a problem while testing my Erlang client based application.
I have no idea if it's due to some bad behavior in my app or whatsoever, hope I can get some useful information here.

In my case, I have:
three rabbit nodes in a cluster;
one non-durable topic exchange;
two connections established;
several channels and queues (exclusive & non-exclusive) declared.

While i'm testing, sometimes the connections they just linger around even the client has quit already.

For instance, here is one or my dead connections (copied from admin page):

AMQP 0-9-110.15.36.246:36526rabbit at test-app20B/s(1.9kB total) 0B/s(1.1kB total)4guestrunning I'm pretty sure that the client on 10.15.36.246 has been killed already, but the connection is still in "running" state.

/stone
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120227/3187eb08/attachment-0001.htm>

------------------------------

Message: 6
Date: Mon, 27 Feb 2012 09:44:56 +0000
From: Steve Powell <steve at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Problems with STOMP & access control
To: Lionel Cons <lionel.cons at cern.ch>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <7245AC14-4662-4F85-B38A-EAFF206DD7EF at rabbitmq.com>
Content-Type: text/plain; charset=us-ascii

Lionel,

Apologies for tardy reply.

Presently there is no way to set access control based upon the STOMP names, though I agree this would be desirable. Does the STOMP specification talk about access control at all?

I think the destination names aren't all entirely opaque, so it might be possible to exert access control on some resources, but a comprehensive solution is not available, I'm afraid.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 21 Feb 2012, at 13:44, Lionel Cons wrote:

> I've read http://www.rabbitmq.com/access-control.html and
> http://www.rabbitmq.com/stomp.html and I did not find any practical
> way to use access control with STOMP.
>
> In the STOMP world (in fact, since STOMP is broker behavior agnostic,
> this is rather tied to the JMS world), one can use destinations like
> /queue/test.foo or /topic/test.bar. It would be natural to use these
> names in the access control regexps to allow, for instance, a given
> user to access all queues matching "test\..*".
>
> Unfortunately, the STOMP destinations names get mapped to AMQP
> resource names that loose the original names, for instance
> amq.gen-AXVr2gFuBTO4duQ5OEC9b9.
>
> Is there a way in RabbitMQ to use access control based on the STOMP
> destination names?
>
> Cheers,
>
> Lionel
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



------------------------------

Message: 7
Date: Mon, 27 Feb 2012 10:21:39 +0000
From: Steve Powell <steve at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Unexpected behaviour with STOMP & NACK
To: Lionel Cons <lionel.cons at cern.ch>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <C71F5D87-E010-4007-8CEB-7560CCEBFFD7 at rabbitmq.com>
Content-Type: text/plain; charset=us-ascii

Lionel,

Apologies for the tardy reply.

Thank you for reporting this. What is happening is that the NACK sets the 'requeue=true' flag, which, by definition, puts the message back on its queue.
It is then available for redelivery. Whether it gets redelivered to the same consumer depends on lots of things, but is entirely possible, and is expected when there is only one consumer.

Currently, we expect this behaviour and did not think it was prohibited by the specification.

If this is determined to violate the specification we could set requeue=false on NACK, then neither this client, nor any other, will see the message; which is allowable server behaviour. There is currently no mechanism for re-routing messages that are NACKd, but this may change in the near future.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 22 Feb 2012, at 12:24, Lionel Cons wrote:

> I get an unexpected behaviour with STOMP & NACK with RabbitMQ 2.7.1.
>
> Here is my test, using an empty queue.
> - client1 connects, sends a message to the queue and disconnects
> - client2 connects, subscribes to the queue with ack:client
> - client2 receives the message (so far so good) but does not ack it
> - client3 connects, subscribes to the queue
> - client2 sends a NACK frame for the message
> - client2 receives the message once more
> - client3 receives nothing
>
> I would have expected the other client (client3) to receive the
> message that has not been consumed by client2. In fact, this is how
> ActiveMQ and Apollo work.
>
> FWIW, the STOMP 1.1 spec mentions:
>
> | NACK is the opposite of ACK. It is used to tell the server that the
> | client did not consume the message. The server can then either send
> | the message to a different client, discard it, or put it in a dead
> | letter queue. The exact behavior is server specific.
>
> So, although the behavior is not strictly defined, re-sending the
> message to the same client does not look appropriate to me.
>
> What do you think?
>
> Cheers,
>
> Lionel
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



------------------------------

Message: 8
Date: Mon, 27 Feb 2012 02:30:15 -0800 (PST)
From: Jon Hill <jon.hill at comshen.com>
Subject: Re: [rabbitmq-discuss] Consumers and exceptions
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID:
        <3b4977f4-5f27-4b7b-97bc-64606fc3acc9 at hs8g2000vbb.googlegroups.com>
Content-Type: text/plain; charset=ISO-8859-1

Steve

Many thanks for the reply. That makes sense, and I am now progressing.

All the best

Jon


------------------------------

Message: 9
Date: Mon, 27 Feb 2012 11:31:45 +0100
From: Lionel Cons <lionel.cons at cern.ch>
Subject: Re: [rabbitmq-discuss] Problems with STOMP & access control
To: Steve Powell <steve at rabbitmq.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <20299.23441.992131.685344 at mail.cern.ch>
Content-Type: text/plain; charset="us-ascii"

Steve Powell writes:
 > Does the STOMP specification talk about access control at all?

No. The specification does not describe the broker behavior. Even something like "/topic/foo" means a JMS-style topic named "foo" is outside of the spec.

 > I think the destination names aren't all entirely opaque, so it  > might be possible to exert access control on some resources, but a  > comprehensive solution is not available, I'm afraid.

It seems that things might work with queues since a STOMP destination of "/queue/foo" will AFAIK use a queue named "foo". To be confirmed.

Topics are more problematic but this does not seem to be STOMP specific.

In AMQP, how would you configure the RabbitMQ ACLs so that client A can only send to amq.topic with a routing key matching A.* while client B is restrcited to routing keys matching B.*?

The http://www.rabbitmq.com/access-control.html page does not really describe what a reource is. Would a syntax like amq.topic:A.* make sense to perform routing key based access control?

Cheers,

Lionel


------------------------------

Message: 10
Date: Mon, 27 Feb 2012 10:42:00 +0000
From: Simon MacMullen <simon at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Ensuring low latency for publishers
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <4F4B5DF8.5090500 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

On 24/02/12 18:07, Eric wrote:
> In reality, the throttling case is extremely unlikely anyway, right?
> You basically have to create a case where publishers are outpacing
> consumers and/or the speed of disk writes on the broker.  So you'd
> have to publish something like 100mb/s with little or no consumption,
> and our application is roughly 5mb/minute.

With small messages in fact the first thing you run into is being CPU-bound making routing decisions. But the general principle holds, yes.

> In conclusion, I finally did what I should have done in the first
> place.  I mocked up the threading scenario we're likely to see in
> production and benchmarked it against Java's LinkedBlockingQueue and
> ArrayBlockingQueue.  Compared to each producer thread having its own
> linked list (the completely uncontended scenario) the blocking queues
> introduced virtually no additional waiting - a microsecond or two at
> most.  That's the case even at rates 50x or more than we'd see in
> production.  So blocking queue it is, and that's a comfortingly simple
> solution.
>
> Thanks for all the help and apologies for under-researching what I was
> doing.

Ah, good.

I had a quick look at implementing non-blocking publish on Java on Friday. Unfortunately it's not possible to do this without NIO on Java, so a prerequisite becomes "port the Java client to NIO", which... makes it less likely to happen I'm afraid.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware


------------------------------

Message: 11
Date: Mon, 27 Feb 2012 10:56:09 +0000
From: Steve Powell <steve at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] STOMP doesn't include the routing-key
        on      MESSAGE frames
To: Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com>
Cc: RabbitMQ Discuss <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <5E2DB83D-C02B-48D6-97C2-FDB76643B855 at rabbitmq.com>
Content-Type: text/plain; charset=us-ascii

Tony,

Read your patch, and prefer this solution to adding extra headers.

I'm raising a bug (24763) to fix our spec-compliance problem (thank you for
pointing this out), and see if we can get this change in.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 20 Feb 2012, at 20:36, Tony Garnock-Jones wrote:

> Hi Steve,
>
> How about the attached patch? It attempts to bring the "destination"
> header in MESSAGEs in to line with the STOMP 1.1 spec. I've paid
> cursory attention to binary-and-slash-escaping issues but it could use
> a second glance before being committed, I reckon.
>
> Regards,
>  Tony
>
> On 20 February 2012 14:56, Tony Garnock-Jones
> <tonygarnockjones+rabbitmq at gmail.com> wrote:
>> Adding the routing_key puts the final small missing piece in place. A
>> perhaps more STOMPish way of giving it would be to have a "to" header
>> or similar carried in a MESSAGE, containing the full destination given
>> in the SEND. Oh wait! I've just checked, and actually that's what's
>> required by the 1.1 spec already. So the STOMP adapter isn't quite
>> spec-compliant, in that it's giving the destination from the
>> *subscribe* rather than the *send*.
> --
> Tony Garnock-Jones
> tonygarnockjones at gmail.com
> http://homepages.kcbbs.gen.nz/tonyg/
> <better-destination-patch.patch>



------------------------------

Message: 12
Date: Mon, 27 Feb 2012 11:05:56 +0000
From: Simon MacMullen <simon at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] dead connection lingers around?
To: stone <zmstone at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <4F4B6394.10903 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

Hi.

Sometimes if a TCP connection gets killed outright the OS never notices
and so we don't know either.

This probably implies you are not closing connections properly? (i.e.
with the AMQP close handshake, by invoking amqp_connection:close/1.)

Enabling AMQP heartbeats will allow RabbitMQ to detect this condition.

Cheers, Simon

On 27/02/12 09:25, stone wrote:
> Hi
>
> Have a problem while testing my Erlang client based application.
> I have no idea if it's due to some bad behavior in my app or whatsoever,
> hope I can get some useful information here.
>
> In my case, I have:
> three rabbit nodes in a cluster;
> one non-durable topic exchange;
> two connections established;
> several channels and queues (exclusive & non-exclusive) declared.
>
> While i'm testing, sometimes the connections they just linger around
> even the client has quit already.
>
> For instance, here is one or my dead connections (copied from admin page):
>
> AMQP 0-9-1    10.15.36.246:36526 <http://10.15.36.246:36526>
> rabbit at test-app2      0B/s_(1.9kB total)      0B/s_(1.1kB total)      4       guest   running
>
> I'm pretty sure that the client on 10.15.36.246 has been killed already,
> but the connection is still in "running" state.
>
> /stone
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


--
Simon MacMullen
RabbitMQ, VMware


------------------------------

Message: 13
Date: Mon, 27 Feb 2012 11:06:49 +0000
From: Simon MacMullen <simon at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] ??:  Passive queue declaration and
        channel closure
To: Simone Busoli <simone.busoli at gmail.com>
Cc: "rabbitmq-discuss at lists.rabbitmq.com"
        <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <4F4B63C9.7070909 at rabbitmq.com>
Content-Type: text/plain; charset=GB2312

On 25/02/12 18:37, Simone Busoli wrote:
> David, I somewhat agree with you, lack of documentation about
> operational aspects of broker behavior is something I have been missing
> as well.

Yeah, I suspect our documentation could still be better. But this is one
of the areas where it's really easy to be blinded by over-familiarity.
What sort of things do you think are particularly missing?

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware


------------------------------

Message: 14
Date: Mon, 27 Feb 2012 11:43:12 +0000
From: Michael Bridgen <mikeb at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Apache MINA Integration
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <4F4B6C50.9070702 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

> Has anyone integrated Apache MINA with Rabbit MQ to publish and receive
> messages?

What form would you expect such an integration to take?


------------------------------

Message: 15
Date: Mon, 27 Feb 2012 11:49:18 +0000
From: Marek Majkowski <majek04 at gmail.com>
Subject: Re: [rabbitmq-discuss] [help] [beginner] server stops sending
        messages; publish (in transaction) hangs on commit
To: Alistair Bayley <alistair at abayley.org>
Cc: rabbitmq-discuss <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
        <CABzX+qznWcOPTsLob0w+uK0vUg7GBbOqot0EzhbKud12DDLAJQ at mail.gmail.com>
Content-Type: text/plain; charset=UTF-8

On Mon, Feb 27, 2012 at 03:37, Alistair Bayley <alistair at abayley.org> wrote:
> On 25 February 2012 00:38, Simon MacMullen <simon at rabbitmq.com> wrote:
>>>
>>> OK. Can I have some guidance as to how much memory we should allocate?
>>
>> This is a real how-long-is-a-piece-of-string question I'm afraid. 512M would
>> already be a significant step towards the comfort zone though.
>
> rabbitmqctl report shows a large number of channels (in the thousands)
> and memory usage seems to correlate with the large number of channels.
> I've left the server running and shut down each of the clients, and
> the channels have vanished from the report output, so I suspect a
> dodgy client here. We're using python kombu over ampqlib, so maybe
> kombu is doing something undesirable. A quick glance at the source
> shows that it has a channel pool, so maybe that's to blame. Anyway,
> more investigation required...

Right. This is definitely possible that channels are the main
thing that consumes memory.

> Once the number of channels is down to less than 10, the memory usage
> is around 32M, which seems fine to me. Maybe I don't need to allocate
> more, if I can solve this channels problem.

Yup, quite possible.

>>> Is there an
>>> option to get the server to return something that says that it is not
>>> accepting messages?
>>
>> In ancient history we used to do this; there's a method in AMQP 0-9-1 called
>> channel.flow which the server should be able to use to tell a client to shut
>> up. In practice it was unreliable (client may not support it, or may take
>> too long to take notice of it).
>
> I will do some more testing. Maybe the immediate flag on basic_publish
> will do something useful. python amqplib is protocol version 0.8, so
> whatever I do must fit in with that.

Nope, "immediate" flag is a completely unrelated:
  http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish

Marek


------------------------------

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


End of rabbitmq-discuss Digest, Vol 57, Issue 28
************************************************

From santiagomonttco at gmail.com  Tue Feb 28 15:48:03 2012
From: santiagomonttco at gmail.com (CONFERENCIA)
Date: Tue, 28 Feb 2012 12:48:03 -0300
Subject: [rabbitmq-discuss] =?windows-1252?q?=7CSpam=7C_ACCIDENTES_DEL_TRA?=
	=?windows-1252?q?BAJO_=22RESPONSABILIDAD_CIVIL_Y_PENAL=22?=
Message-ID: <fb9cc8f8818c16aba67404620019a3af@gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120228/db899444/attachment.htm>

From grussell at vmware.com  Tue Feb 28 15:44:55 2012
From: grussell at vmware.com (Gary Russell)
Date: Tue, 28 Feb 2012 07:44:55 -0800
Subject: [rabbitmq-discuss] Apache MINA Integration
In-Reply-To: <1330406173.4296.YahooMailNeo@web44909.mail.sp1.yahoo.com>
References: <4F4B6C50.9070702@rabbitmq.com>
	<3a6a63fd-615c-4fec-8dfd-7db4595f6c64@oleg-2.local>
	<1330406173.4296.YahooMailNeo@web44909.mail.sp1.yahoo.com>
Message-ID: <4F4CF677.7090600@vmware.com>

We have lightweight TCP adapters in Spring Integration; it makes it very easy to bridge tcp to/from Rabbit. I just pushed a very simple sample here.


https://github.com/garyrussell/spring-integration-samples/tree/INTSAMPLES-66/basic/tcp-amqp


It sends data from a telnet client to a netcat server via a rabbit queue.


Gary

On 02/28/2012 12:16 AM, Uday Subbarayan wrote:
I am aware of the general purpose EAI frameworks including Camel. We are building a high performance compute cluster and using Rabbit MQ to pass messages. So, i want something very simple TCP server to receive & send messages to the queue.

Best,
Uday.

________________________________
From: Oleg Zhurakousky <ozhurakousky at vmware.com><mailto:ozhurakousky at vmware.com>
To: Michael Bridgen <mikeb at rabbitmq.com><mailto:mikeb at rabbitmq.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Sent: Monday, February 27, 2012 6:20 AM
Subject: Re: [rabbitmq-discuss] Apache MINA Integration

I believe it is a more general concern and typically handled by integration frameworks, in this case EIP-style (http://www.eaipatterns.com/) frameworks such as Spring Integration (http://www.springsource.org/spring-integration)
These frameworks already have fist class integration with AMQP (e.g., AMQP inbound and outbound channel adapters) as well as other protocols and products including TCP/IP.

Oleg

----- Original Message -----
From: "Michael Bridgen" <mikeb at rabbitmq.com<mailto:mikeb at rabbitmq.com>>
To: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Sent: Monday, February 27, 2012 6:43:12 AM
Subject: Re: [rabbitmq-discuss] Apache MINA Integration

> Has anyone integrated Apache MINA with Rabbit MQ to publish and receive
> messages?

What form would you expect such an integration to take?
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120228/9d91cb89/attachment.htm>

From CLefevre at Transparent.com  Tue Feb 28 15:53:56 2012
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Tue, 28 Feb 2012 15:53:56 +0000
Subject: [rabbitmq-discuss] Query a queue status from the client
Message-ID: <5798631D5F355D4C99FDF23580295AF8187E009E@TLMAIL1.Transparent.local>

Hello,
In my searches for obtaining the queue's status from a client, I stumbled upon this Stack Overflow question:
http://stackoverflow.com/questions/1038318/check-rabbitmq-queue-size-from-client

The user is asking about .NET, however I need it to work for Python.

I'm using PIka (0-9-1, if I recall correctly), with RabbitMQ 2.7.1


The user on Stack Overflow seems to be posting the exact solution I need as:


name, jobs, consumers = chan.queue_declare(queue=queuename, passive=True)

However, when I use this line, I only receive back an error that a None type object is not iterable. Which is due to the function only returning None.

Does anyone have any experience with this use case? Am I missing something in the queue declare?


Thank you for your time,
-Christopher Lefevre
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120228/ccd8903e/attachment.htm>

From grussell at vmware.com  Tue Feb 28 15:57:41 2012
From: grussell at vmware.com (Gary Russell)
Date: Tue, 28 Feb 2012 07:57:41 -0800
Subject: [rabbitmq-discuss] Regd: Spring AMQP versus Java Client Library
In-Reply-To: <1330398784.33543.YahooMailClassic@web39301.mail.mud.yahoo.com>
References: <1330398784.33543.YahooMailClassic@web39301.mail.mud.yahoo.com>
Message-ID: <4F4CF975.5090507@vmware.com>

Spring AMQP...

http://static.springsource.org/spring-amqp/reference/html/

...brings, to AMQP, the familiar benefits of Spring (high level abstractions - eliminating boilerplate code, while providing access to lower level APIs when necessary, consistent exception hierarchy across different vendor implementations,  etc).

It also provides a listener container, enabling message-driven POJOs, thus eliminating all infrastructure dependencies from application code.

While clearly aimed at existing Spring users, who are already aware of these benefits, we feel it is equally applicable to those users who are not (yet) using Spring.

Gary

On 02/27/2012 10:13 PM, preeti sp wrote:
Hi
Do we get any advantages If we use Spring AMQP over Java Client Library or vice-versa?

Is it advised to use Spring AMQP If we do not intend to primarily use Spring as such?

Thanks,
Preeti

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120228/9c4c3bf1/attachment.htm>

From CLefevre at Transparent.com  Tue Feb 28 16:51:29 2012
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Tue, 28 Feb 2012 16:51:29 +0000
Subject: [rabbitmq-discuss] Query a queue status from the client
Message-ID: <5798631D5F355D4C99FDF23580295AF8187E00B9@TLMAIL1.Transparent.local>

I apologize, in my haste to send this out, I didn't get to fully investigate.

If someone else were to come upon this issue, what you need to do is declare a different Callback method, which accepts a variable.

This variable will contain member items for the Queue, Awaiting Messages, Consumers, Channel Number, and Frame Type.

To access these you would need to use:
variable.frame_type
variable.channel_number
variable.method.queue
variable.method.message_count
variable.method.consumer_count

Sorry to clog up the mailing list, and I hope I'm appending to the message correctly, but hopefully this will clear up any questions people may have had like this.

-Christopher Lefevre

From: Christopher Lefevre
Sent: Tuesday, February 28, 2012 10:54 AM
To: 'rabbitmq-discuss at lists.rabbitmq.com'
Subject: Query a queue status from the client

Hello,
In my searches for obtaining the queue's status from a client, I stumbled upon this Stack Overflow question:
http://stackoverflow.com/questions/1038318/check-rabbitmq-queue-size-from-client

The user is asking about .NET, however I need it to work for Python.

I'm using PIka (0-9-1, if I recall correctly), with RabbitMQ 2.7.1


The user on Stack Overflow seems to be posting the exact solution I need as:

name, jobs, consumers = chan.queue_declare(queue=queuename, passive=True)

However, when I use this line, I only receive back an error that a None type object is not iterable. Which is due to the function only returning None.

Does anyone have any experience with this use case? Am I missing something in the queue declare?


Thank you for your time,
-Christopher Lefevre
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120228/0cc5aa63/attachment.htm>

From jerryk at vmware.com  Tue Feb 28 19:47:45 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 28 Feb 2012 11:47:45 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ and MySQL
In-Reply-To: <0e103414-8038-4231-8c48-e3f6934718fa@f30g2000yqh.googlegroups.com>
Message-ID: <0a594157-bc17-40e1-ab02-505ba0e7cd6e@CoachZ.local>

Hi, Pep:

Can you tell us a bit more what you're trying to do?  I think
the StackOverflow poster is hinting at perhaps a more messaging-based
design for your application, rather than a quick drop-in hack to make
some side effect beyond the RDBMS happen as a result of a MySQL trigger.

Best regards,
Jerry

----- Original Message -----
From: "PepMad" <pepmadon at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, February 20, 2012 2:24:29 PM
Subject: [rabbitmq-discuss] RabbitMQ and MySQL

http://stackoverflow.com/questions/1467369/invoking-a-php-script-from-a-mysql-trigger

I was reading this post on Stack Overflow and the last suggestion was
to use RabbitMQ. Is this possible? I read the documentation on
RabbitMQ, how can a single mysql update be sent to a producer? I have
seen the mysql log file but that encapsulates multiple updates.

Thanks Pep
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Tue Feb 28 19:53:46 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 28 Feb 2012 11:53:46 -0800 (PST)
Subject: [rabbitmq-discuss] Design Help?
In-Reply-To: <4F427D0C.10907@2600hz.com>
Message-ID: <3418300e-6989-4f26-9846-8c0f6682f9e0@CoachZ.local>

Hi, James:

Some of this appears to go beyond messaging per se and into more
general distributed systems/services coordination.  Have you contemplated
using something like Apache Zookeeper or Heroku's Doozer?  The primitives
provided by those may lend themselves well to integrating-with/supporting
your application, while the messaging heavy lifting continues using Rabbit
and its features/guarantees in the ways they work best without strange
fetch-peek-ack-nack trickery that will likely make your application 
pretty complex and hard to reason about.

http://zookeeper.apache.org/

http://xph.us/2011/04/13/introducing-doozer.html

Doozer is quite new; Zookeeper by virtue of its position in the
Hadoop ecology is older, more mature and well documented both online
and in books...

Best regards,
Jerry

----- Original Message -----
From: "James Aimonetti" <james at 2600hz.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, February 20, 2012 9:04:12 AM
Subject: [rabbitmq-discuss] Design Help?

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey list,

Curious for feedback, as this design idea I have would possibly extend
to several places in our application, and I'd love to make it generic
enough to do so.

The basic problem:

We have a queue of work to be done, represented as a named queue. For
redundancy, we have 2->many processes (in Erlang) that will read from
the queue and do the work. Easy so far.

However, we also have a list of resources needed to process the work
queue, which needs to be shared across all worker processes. When one
worker retrieves a job from the work queue, it must also get the list of
available resources, match resource to job, and return the list of
resources (with the used resource flagged as such) back to a globally
accessible place (hoping to avoid the DB, but it may be a good-enough
sync point).

So, for example, there are four jobs, two that require a paper shredder,
two that require a wood chipper. There is only one paper shredder and
one wood chipper. There are also 10 workers available to actually shred
stuff.

Worker one consumes the list of available equipment (one paper shredder,
one wood chipper), and then pulls the first job (paper to be shredded).
Worker one grabs the paper shredder, returns the list of resources
having flagged the paper shredder as in use, and ACKs the job. When
worker one finishes shredding paper, it will wait until the resources
list is available and update it with 1 more paper shredder available.

Once a job is actually started, I don't care if the worker crashes or
not; that will be handled later. And I'll have a supervising gen_server
pull the resource list, add the resource its using to its state, and
spawn the actual worker (catching exits to return the resource). I'm
sure other measures will be needed to ensure the resource is added back
eventually, but I'm trying to get the basic idea down.

So once worker one is done retrieving a resource, worker two can next
get the resources list and the next job. If the job is paper shredding,
worker two will nack the job (as there are no paper shredders at the
moment) and return the resource list. I will eventually want to support
being able to requeue the job to the back of the job queue, but for now,
work stalls until the first item in the queue can be processed successfully.

So while the resources list is out of queue, no workers will consume
jobs from the work queue. As soon as it reappears in queue, I want the
next worker in line to grab it and try to process the next job.


Some initial concerns:

No resources available for the job at the front of the queue means a lot
of fetching and nacking of jobs, and fetching/returning the resource list.

Losing the resources list: if whatever node (our Erlang VMs only
communicate via AMQP) goes down while handling the resources list, it
will obviously never be republished. We do usually have a timeout window
for the worker to get a resource for a job (sometimes the actual finding
of the resource takes a while), so if I could coordinate all workers
consuming from the resources_available queue, I could know after timeout
+ a small fudge factor, that someone else should have begun processing.
So maybe the resources_available queue is more a try_to_process_a_job
queue, and each worker process maintains an identical list of resources
available, with a worker that pairs a job to resource publishing the
resource's in-use status.

So perhaps the solution is:

Jobs queue round robins amongst all workers, but only one worker can
fetch/(n)ack. A worker can only fetch from the jobs queue by consuming a
"next" message from a shared coordination queue. All workers publish
updates to resources available to a routing key so all workers'
resources state is in sync. If a worker can't find a resource for a job,
it can (configurable) 1) nack the job and send a 'next' to the
coordination queue; 2) requeue the job at the end of the jobs queue and
send a 'next'; 3) sit on the job (meaning no other worker can fetch from
the jobs queue) until an appropriate resource comes available.

Concerns here:

Starting/recovering the 'next' token.

I'm sure others but am realizing this is getting long.

Sorry for the wall of text and stream of consciousness writing. We have
a lot of places where this pattern is showing up and would love to get a
module or library written to ease doing this kind of coordination. Any
ideas or directions towards appropriate messaging patterns warmly welcome :)

- -- 
James Aimonetti
Distributed Systems Engineer / DJ MC_

2600hz | http://2600hz.com
sip:james at 2600hz.com
tel: 415.886.7905
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJPQn0MAAoJENc77s1OYoGgh+gH/i/kW2M5EMfQ/xz3dU6soUd4
joGvWC46MdAX2CqlEKyIcP+EsmiTH4Ojjh64Y5MrVv68xV2Zasi8O7W5scFGK31Q
5r1Uc4lLrCANiEA7MYnaKM3J+s+bf4m3NlDwhE/QKCO+OhZoZl/zYfzlzSlsQ3QX
3dIKIxJnvnvmehat/oqbpZFFZO7NX4dKWGr3Ysp4OBjPhQLDGGkZ3Tbjbe3KfL0j
EfdZubwXQQLsTU7oqI7K3HoZc1uWx50VdR28JT1ZTaBdchpUpQ9PXdbq1b++KA++
SkHpwYB37PgTqK9A3gsmuRCsRMmYP8p3iGPrflnP53kuuESZIZwUFuhbthV5DM8=
=MDx7
-----END PGP SIGNATURE-----
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james at 2600hz.com  Tue Feb 28 20:23:48 2012
From: james at 2600hz.com (James Aimonetti)
Date: Tue, 28 Feb 2012 12:23:48 -0800
Subject: [rabbitmq-discuss] Design Help?
In-Reply-To: <3418300e-6989-4f26-9846-8c0f6682f9e0@CoachZ.local>
References: <3418300e-6989-4f26-9846-8c0f6682f9e0@CoachZ.local>
Message-ID: <4F4D37D4.90307@2600hz.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Jerry,

Thanks for the suggestions. You're right that this is an abuse of the
messaging patterns, but the way our system is structured seems to
require building these higher level concepts on top of the primitives we
get from AMQP/RabbitMQ.

We have a system spread out over many servers, across datacenters, with
redundant applications running, and we need ways to coordinate work
amongst the redundant workers in this manner. When we don't care about
the order of work, its really easy to have the queue round-robin the
work to each worker.

As we're building more advanced features into our platform, this pattern
of only allowing one worker to process a job, across the whole platform,
is popping up in a few places and we'd like to encapsulate that pattern
into a reusable bit of code (a behaviour in Erlang).

AMQP is the glue that binds all these apps together, so we look to build
on top of its feature set.

I'll let the list know more if I figure a tenable solution :)

On 02/28/2012 11:53 AM, Jerry Kuch wrote:
> Hi, James:
> 
> Some of this appears to go beyond messaging per se and into more
> general distributed systems/services coordination.  Have you contemplated
> using something like Apache Zookeeper or Heroku's Doozer?  The primitives
> provided by those may lend themselves well to integrating-with/supporting
> your application, while the messaging heavy lifting continues using Rabbit
> and its features/guarantees in the ways they work best without strange
> fetch-peek-ack-nack trickery that will likely make your application 
> pretty complex and hard to reason about.
> 
> http://zookeeper.apache.org/
> 
> http://xph.us/2011/04/13/introducing-doozer.html
> 
> Doozer is quite new; Zookeeper by virtue of its position in the
> Hadoop ecology is older, more mature and well documented both online
> and in books...
> 
> Best regards,
> Jerry
> 
> ----- Original Message -----
> From: "James Aimonetti" <james at 2600hz.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Monday, February 20, 2012 9:04:12 AM
> Subject: [rabbitmq-discuss] Design Help?
> 
> Hey list,
> 
> Curious for feedback, as this design idea I have would possibly extend
> to several places in our application, and I'd love to make it generic
> enough to do so.
> 
> The basic problem:
> 
> We have a queue of work to be done, represented as a named queue. For
> redundancy, we have 2->many processes (in Erlang) that will read from
> the queue and do the work. Easy so far.
> 
> However, we also have a list of resources needed to process the work
> queue, which needs to be shared across all worker processes. When one
> worker retrieves a job from the work queue, it must also get the list of
> available resources, match resource to job, and return the list of
> resources (with the used resource flagged as such) back to a globally
> accessible place (hoping to avoid the DB, but it may be a good-enough
> sync point).
> 
> So, for example, there are four jobs, two that require a paper shredder,
> two that require a wood chipper. There is only one paper shredder and
> one wood chipper. There are also 10 workers available to actually shred
> stuff.
> 
> Worker one consumes the list of available equipment (one paper shredder,
> one wood chipper), and then pulls the first job (paper to be shredded).
> Worker one grabs the paper shredder, returns the list of resources
> having flagged the paper shredder as in use, and ACKs the job. When
> worker one finishes shredding paper, it will wait until the resources
> list is available and update it with 1 more paper shredder available.
> 
> Once a job is actually started, I don't care if the worker crashes or
> not; that will be handled later. And I'll have a supervising gen_server
> pull the resource list, add the resource its using to its state, and
> spawn the actual worker (catching exits to return the resource). I'm
> sure other measures will be needed to ensure the resource is added back
> eventually, but I'm trying to get the basic idea down.
> 
> So once worker one is done retrieving a resource, worker two can next
> get the resources list and the next job. If the job is paper shredding,
> worker two will nack the job (as there are no paper shredders at the
> moment) and return the resource list. I will eventually want to support
> being able to requeue the job to the back of the job queue, but for now,
> work stalls until the first item in the queue can be processed successfully.
> 
> So while the resources list is out of queue, no workers will consume
> jobs from the work queue. As soon as it reappears in queue, I want the
> next worker in line to grab it and try to process the next job.
> 
> 
> Some initial concerns:
> 
> No resources available for the job at the front of the queue means a lot
> of fetching and nacking of jobs, and fetching/returning the resource list.
> 
> Losing the resources list: if whatever node (our Erlang VMs only
> communicate via AMQP) goes down while handling the resources list, it
> will obviously never be republished. We do usually have a timeout window
> for the worker to get a resource for a job (sometimes the actual finding
> of the resource takes a while), so if I could coordinate all workers
> consuming from the resources_available queue, I could know after timeout
> + a small fudge factor, that someone else should have begun processing.
> So maybe the resources_available queue is more a try_to_process_a_job
> queue, and each worker process maintains an identical list of resources
> available, with a worker that pairs a job to resource publishing the
> resource's in-use status.
> 
> So perhaps the solution is:
> 
> Jobs queue round robins amongst all workers, but only one worker can
> fetch/(n)ack. A worker can only fetch from the jobs queue by consuming a
> "next" message from a shared coordination queue. All workers publish
> updates to resources available to a routing key so all workers'
> resources state is in sync. If a worker can't find a resource for a job,
> it can (configurable) 1) nack the job and send a 'next' to the
> coordination queue; 2) requeue the job at the end of the jobs queue and
> send a 'next'; 3) sit on the job (meaning no other worker can fetch from
> the jobs queue) until an appropriate resource comes available.
> 
> Concerns here:
> 
> Starting/recovering the 'next' token.
> 
> I'm sure others but am realizing this is getting long.
> 
> Sorry for the wall of text and stream of consciousness writing. We have
> a lot of places where this pattern is showing up and would love to get a
> module or library written to ease doing this kind of coordination. Any
> ideas or directions towards appropriate messaging patterns warmly welcome :)
> 
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

- -- 
James Aimonetti
Distributed Systems Engineer / DJ MC_

2600hz | http://2600hz.com
sip:james at 2600hz.com
tel: 415.886.7905
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJPTTfUAAoJENc77s1OYoGgdq0H/2X7oohyxx0MhsoD06J07l2P
DZm7PdEEZhUCSRGb43cBszNjiFLvYtmbSGgWUEzQMjZvI0idKC6m4XIgZqKfJ7Wk
yVQcvMfeHmE0w1NIyrJLFlXToONHlX2mLStRHnsmhFdMZuDHuAwF41N3rZPX5/wV
JIUIvYg45VccYu0zL4kRq/9nBORJsfXxXcsB8pdKJa0uLxv2OPptDOHFgZVz/wVe
FC99/fBU/WixtDvzhe2D7d+ubn5UT1jf01ZKUTAgkesM3EpcmqdqI51jQR2Q0hbT
VhVODLSlTSrYSYsumStXOaFzZ8kwY7+mT3UDbRqtv+ThIKuWWejCXGFVjDeKcA8=
=NhsO
-----END PGP SIGNATURE-----

From pepmadon at gmail.com  Tue Feb 28 21:16:06 2012
From: pepmadon at gmail.com (PepMad)
Date: Tue, 28 Feb 2012 13:16:06 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ and MySQL
In-Reply-To: <0a594157-bc17-40e1-ab02-505ba0e7cd6e@CoachZ.local>
References: <0a594157-bc17-40e1-ab02-505ba0e7cd6e@CoachZ.local>
Message-ID: <97320990-eca5-46a4-bd47-f6b7e66973a2@p12g2000yqe.googlegroups.com>

Hi Jerry,

A website that the user can submit a job, the job is a script on the
server, the script takes an unknown length of time. I didn't want the
user on the site to wait, I just wanted a return status that the job
was sent to a que. I thought about using mysql udf's or a mysql script
for polling an update table, then I found the StackOverflow post and I
thought RabbitMQ might be a better solution for messaging a que via
the site.

Pep

From jerryk at vmware.com  Tue Feb 28 21:20:18 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 28 Feb 2012 13:20:18 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ and MySQL
In-Reply-To: <97320990-eca5-46a4-bd47-f6b7e66973a2@p12g2000yqe.googlegroups.com>
Message-ID: <77adf375-7d45-4988-a92f-0a9c369da3a1@CoachZ.local>

Hi, Pep:

That very well might be.  Your application would put together the
specifics of the job, publish them as a message into RabbitMQ, after
which some consumers which do the actual work of the job would dequeue
those tasks and do the work behind the scenes, thus decoupling your
users from having to wait on them.

Check out the tutorials here:

http://www.rabbitmq.com/getstarted.html

For ideas on how you might incorporate such patterns into your app.
It will likely work far better for you than scary database tricks. :-)

You can also look at the book "RabbitMQ in Action" from Manning (now
available as a preview eBook from Manning, print version due out 
very soon) for a thorough discussion of messaging and its use in some 
example application scenarios that are likely similar to what you have.

Best regards,
Jerry


----- Original Message -----
From: "PepMad" <pepmadon at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, February 28, 2012 1:16:06 PM
Subject: Re: [rabbitmq-discuss] RabbitMQ and MySQL

Hi Jerry,

A website that the user can submit a job, the job is a script on the
server, the script takes an unknown length of time. I didn't want the
user on the site to wait, I just wanted a return status that the job
was sent to a que. I thought about using mysql udf's or a mysql script
for polling an update table, then I found the StackOverflow post and I
thought RabbitMQ might be a better solution for messaging a que via
the site.

Pep
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alistair at abayley.org  Wed Feb 29 01:54:24 2012
From: alistair at abayley.org (Alistair Bayley)
Date: Wed, 29 Feb 2012 14:54:24 +1300
Subject: [rabbitmq-discuss] [help] [beginner] testing with pika: some
	questions and complaints
Message-ID: <CAKYODbh2qeJC3+j-PCgpsu7VH7HCaMHq2KPbGpZUupRsuY8HBA@mail.gmail.com>

I've been testing rabbitmq with pika (python) to understand how they
interact and learn about the AMQP protocol. I've some questions and
some complaints; no doubt much of this will be from my
misunderstandings of the AMQP/rabbitmq specs.

Pika (is this better posted to the pika mailing list?):

1.  why is the test in channel.py:102 like so:
        if callback and not isinstance(callback, types.FunctionType) and \
           not isinstance(callback, types.MethodType):
            raise TypeError("callback should be None, a function or method.")

    i.e. why isn't is just a callable() test e.g.
        if callback and not callable(callback):
            raise TypeError("callback should be callable.")

    (is this a python-3 compatibility thing?)


2.  documentation for callback functions is mostly non-existent, and when it
    exists is sometimes wrong e.g. on http://pika.github.com/channel.html :

    (i) channel.basic_get:
        "callback method signature should have 3 parameters:
        The method frame, header frame and the body"
    In fact the callback gets 4 parameters:
        channel, method (Basic.GetOk), properties (Basic.Properties), body

    (ii) channel.add_on_close_callback:
        "The callback function should receive a frame parameter."
    In fact the callback gets 2 parameters: error_code, error_message


3.  why does basic_ack cause this warning?
    CallbackManager.add: Duplicate callback found for "0:Connection.CloseOk"
    i.e. why does it appear to add a(nother) connection close callback?
    I've grubbed through the pika source but can't see how/where it happens.


AMQP/rabbitmq:

4.  why doesn't basic_ack do what I expect?
    If I do a basic_get with no_ack=False, and then a basic_ack,
    the message stays on the queue.
    I can repeatedly fetch-and-ack it, and each time redelivered=true.


5.  if the server reaches a state where it stops accepting messages
    (e.g. memory usage exceeds the high water mark) it does not send
    nack or return responses to basic_publish.
    This is both with transactions, or with channel confirm_delivery
    enabled.


(5) is a concern when one requires guaranteed delivery. Having the
server swallow the message and not respond doesn't seem reliable to
me. Is there some other method I should be using for guaranteed
delivery?

Alistair

From amathur.q at gmail.com  Wed Feb 29 09:46:54 2012
From: amathur.q at gmail.com (Ashutosh Mathur)
Date: Wed, 29 Feb 2012 15:16:54 +0530
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <CA+u4LE6Sg4Ou6JAMpP4EKgB0Ep1i_UCRfsmmK4J-tKY3o9rGzQ@mail.gmail.com>

Hi,

I wanted to know:
- whether RabbitMQ 2.7.1 supports AMQP 1.0 or will there be a newer version
of RabbitMQ to support this?
-Can you please throw some light on the JMS-AMQP mapping which is added in
the AMQP 1.0 release.

Thanks in Advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120229/9c33dd27/attachment.htm>

From simon at rabbitmq.com  Wed Feb 29 10:13:26 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 29 Feb 2012 10:13:26 +0000
Subject: [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 57, Issue 28
In-Reply-To: <AFFA651B612BDE4EB570E34F0571834D0E170F8B17@mail.vfinamex.local>
References: <mailman.1.1330344001.19760.rabbitmq-discuss@lists.rabbitmq.com>
	<AFFA651B612BDE4EB570E34F0571834D0E170F8B17@mail.vfinamex.local>
Message-ID: <4F4DFA46.4060709@rabbitmq.com>

On 28/02/12 14:56, Jose Jimenez Ortiz wrote:
> I installed rabbitmq 2.7.1 and enable Rabbitmq_Management plugin but
> in the explorer I don't see anything on OVERVIEW panel.

This is a bit of a vague question, making it a bit hard to answer. All I 
can say is it works for lots of people :-)

When you say you don't see anything, you mean a completely blank page? 
By explorer do you mean MSIE (which version?) Are there any Javascript 
errors shown?

What does http://<server_name>:55672/api/overview look like?

What about http://localhost:55672/js/tmpl/overview.ejs ?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Feb 29 10:28:18 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 29 Feb 2012 10:28:18 +0000
Subject: [rabbitmq-discuss] [help] [beginner] testing with pika: some
 questions and complaints
In-Reply-To: <CAKYODbh2qeJC3+j-PCgpsu7VH7HCaMHq2KPbGpZUupRsuY8HBA@mail.gmail.com>
References: <CAKYODbh2qeJC3+j-PCgpsu7VH7HCaMHq2KPbGpZUupRsuY8HBA@mail.gmail.com>
Message-ID: <4F4DFDC2.3020801@rabbitmq.com>

On 29/02/12 01:54, Alistair Bayley wrote:
> I've been testing rabbitmq with pika (python) to understand how they
> interact and learn about the AMQP protocol. I've some questions and
> some complaints; no doubt much of this will be from my
> misunderstandings of the AMQP/rabbitmq specs.
>
> Pika (is this better posted to the pika mailing list?):

Maybe?

> AMQP/rabbitmq:
>
> 4.  why doesn't basic_ack do what I expect?
>      If I do a basic_get with no_ack=False, and then a basic_ack,
>      the message stays on the queue.
>      I can repeatedly fetch-and-ack it, and each time redelivered=true.

That sounds like somehow the ack is malformed somehow (wrong ack tag?) 
and instead taking the channel / connection down. Is anything showing up 
in the server logs at this point?

> 5.  if the server reaches a state where it stops accepting messages
>      (e.g. memory usage exceeds the high water mark) it does not send
>      nack or return responses to basic_publish.
>      This is both with transactions, or with channel confirm_delivery
>      enabled.
>
>
> (5) is a concern when one requires guaranteed delivery. Having the
> server swallow the message and not respond doesn't seem reliable to
> me. Is there some other method I should be using for guaranteed
> delivery?

The server is not swallowing the message without responding; it's 
stopped accepting messages altogether, and will (eventually) send 
confirms for everything it's accepted. However, in this scenario you're 
presumably hammering the server with messages, and in that case there 
can be lots of messages waiting in the OS TCP buffers - RabbitMQ hasn't 
seen them at all.

It's not clear what else RabbitMQ could do in this situation - for 
guaranteed delivery you need to treat the message as the producer's 
responsibility until you see the confirm or tx.commit-ok.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Feb 29 11:13:35 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 29 Feb 2012 11:13:35 +0000
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <CA+u4LE6Sg4Ou6JAMpP4EKgB0Ep1i_UCRfsmmK4J-tKY3o9rGzQ@mail.gmail.com>
References: <CA+u4LE6Sg4Ou6JAMpP4EKgB0Ep1i_UCRfsmmK4J-tKY3o9rGzQ@mail.gmail.com>
Message-ID: <4F4E085F.9040607@rabbitmq.com>

On 29/02/12 09:46, Ashutosh Mathur wrote:
> I wanted to know:
> - whether RabbitMQ 2.7.1 supports AMQP 1.0 or will there be a newer
> version of RabbitMQ to support this?

2.7.1 does not. We have an experimental 1.0 plugin but it requires a 
patched server which has not been kept up to date.

We *may* support AMQP 1.0 in the future. But AMQP 1.0 is a huge change 
from 0-9-1, there is almost nothing in common. So it's a really 
substantial piece of work to support it, and we are a small team. So 
we're waiting to see what the demand for it turns out to be.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From oyvind at tjervaag.com  Wed Feb 29 12:42:18 2012
From: oyvind at tjervaag.com (=?iso-8859-1?Q?=D8yvind_Tjervaag?=)
Date: Wed, 29 Feb 2012 13:42:18 +0100
Subject: [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 57, Issue 28
In-Reply-To: <4F4DFA46.4060709@rabbitmq.com>
References: <mailman.1.1330344001.19760.rabbitmq-discuss@lists.rabbitmq.com>
	<AFFA651B612BDE4EB570E34F0571834D0E170F8B17@mail.vfinamex.local>
	<4F4DFA46.4060709@rabbitmq.com>
Message-ID: <CA7F5DBB-7844-40C2-AF6F-C3FE5635ED4E@tjervaag.com>

Hi Simon!

Just hijacking, since I've seen the same problem..

On Feb 29, 2012, at 11:13 AM, Simon MacMullen wrote:
> 
> This is a bit of a vague question, making it a bit hard to answer. All I can say is it works for lots of people :-)

It works for me as long as I stay away from MSIE (And I usually do, and that's why I haven't reported this before?)

> 
> When you say you don't see anything, you mean a completely blank page? By explorer do you mean MSIE (which version?) Are there any Javascript errors shown?

Javascript error on the overview page. MSIE 8.

> 
> What does http://<server_name>:55672/api/overview look like?

Not found..

> 
> What about http://localhost:55672/js/tmpl/overview.ejs ?

Found! :)

I took some screenshots and placed them here:  http://imgur.com/a/OgXap  Should be at least one screenshot per question above ;)
I started noticing this from version 2.7.1, but it seems to work fine from the same browser on the same machine if I contact a 2.4.0 Rabbit (I've not tested every version in-between?.).

regards,
?yvind


From MDworkin at spmllc.com  Wed Feb 29 13:00:51 2012
From: MDworkin at spmllc.com (Marc Dworkin)
Date: Wed, 29 Feb 2012 08:00:51 -0500
Subject: [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 57, Issue 30
In-Reply-To: <mailman.1.1330516801.22501.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <D7C3BE0871FF3A4089E1CDF857E2E60E15E83534B0@spm-mx01>



----- Original Message -----
From: rabbitmq-discuss-request at lists.rabbitmq.com [mailto:rabbitmq-discuss-request at lists.rabbitmq.com]
Sent: Wednesday, February 29, 2012 07:00 AM
To: rabbitmq-discuss at lists.rabbitmq.com <rabbitmq-discuss at lists.rabbitmq.com>
Subject: rabbitmq-discuss Digest, Vol 57, Issue 30

Send rabbitmq-discuss mailing list submissions to
        rabbitmq-discuss at lists.rabbitmq.com

To subscribe or unsubscribe via the World Wide Web, visit
        https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
or, via email, send a message with subject or body 'help' to
        rabbitmq-discuss-request at lists.rabbitmq.com

You can reach the person managing the list at
        rabbitmq-discuss-owner at lists.rabbitmq.com

When replying, please edit your Subject line so it is more specific
than "Re: Contents of rabbitmq-discuss digest..."


Today's Topics:

   1. Re: rabbitmq-discuss Digest, Vol 57, Issue 28 (Jose Jimenez Ortiz)
   2. |Spam| ACCIDENTES DEL TRABAJO "RESPONSABILIDAD CIVIL Y PENAL"
      (CONFERENCIA)
   3. Re: Apache MINA Integration (Gary Russell)
   4. Query a queue status from the client (Christopher Lefevre)
   5. Re: Regd: Spring AMQP versus Java Client Library (Gary Russell)
   6. Re: Query a queue status from the client (Christopher Lefevre)
   7. Re: RabbitMQ and MySQL (Jerry Kuch)
   8. Re: Design Help? (Jerry Kuch)
   9. Re: Design Help? (James Aimonetti)
  10. Re: RabbitMQ and MySQL (PepMad)
  11. Re: RabbitMQ and MySQL (Jerry Kuch)
  12. [help] [beginner] testing with pika: some questions and
      complaints (Alistair Bayley)
  13. (no subject) (Ashutosh Mathur)
  14. Re: rabbitmq-discuss Digest, Vol 57, Issue 28 (Simon MacMullen)
  15. Re: [help] [beginner] testing with pika: some questions and
      complaints (Simon MacMullen)
  16. Re: (no subject) (Simon MacMullen)


----------------------------------------------------------------------

Message: 1
Date: Tue, 28 Feb 2012 08:56:00 -0600
From: Jose Jimenez Ortiz <j-jimenez at finamex.com.mx>
Subject: Re: [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 57, Issue
        28
To: "rabbitmq-discuss at lists.rabbitmq.com"
        <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
        <AFFA651B612BDE4EB570E34F0571834D0E170F8B17 at mail.vfinamex.local>
Content-Type: text/plain; charset="us-ascii"

Hi all,

I installed rabbitmq 2.7.1 and enable Rabbitmq_Management plugin but in the explorer I don't see anything on OVERVIEW panel.

Any idea?

Regards,


-----Mensaje original-----
De: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] En nombre de rabbitmq-discuss-request at lists.rabbitmq.com
Enviado el: Lunes, 27 de Febrero de 2012 06:00
Para: rabbitmq-discuss at lists.rabbitmq.com
Asunto: rabbitmq-discuss Digest, Vol 57, Issue 28

Send rabbitmq-discuss mailing list submissions to
        rabbitmq-discuss at lists.rabbitmq.com

To subscribe or unsubscribe via the World Wide Web, visit
        https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
or, via email, send a message with subject or body 'help' to
        rabbitmq-discuss-request at lists.rabbitmq.com

You can reach the person managing the list at
        rabbitmq-discuss-owner at lists.rabbitmq.com

When replying, please edit your Subject line so it is more specific than "Re: Contents of rabbitmq-discuss digest..."


Today's Topics:

   1. (no subject) (jay nanavati)
   2. Apache MINA Integration (Uday Subbarayan)
   3. Problem with using rabbitmqctl on EC2 (Codevally)
   4. Re: [help] [beginner] server stops sending messages; publish
      (in transaction) hangs on commit (Alistair Bayley)
   5. dead connection lingers around? (stone)
   6. Re: Problems with STOMP & access control (Steve Powell)
   7. Re: Unexpected behaviour with STOMP & NACK (Steve Powell)
   8. Re: Consumers and exceptions (Jon Hill)
   9. Re: Problems with STOMP & access control (Lionel Cons)
  10. Re: Ensuring low latency for publishers (Simon MacMullen)
  11. Re: STOMP doesn't include the routing-key on      MESSAGE frames
      (Steve Powell)
  12. Re: dead connection lingers around? (Simon MacMullen)
  13. Re: ??:  Passive queue declaration and channel closure
      (Simon MacMullen)
  14. Re: Apache MINA Integration (Michael Bridgen)
  15. Re: [help] [beginner] server stops sending messages; publish
      (in transaction) hangs on commit (Marek Majkowski)


----------------------------------------------------------------------

Message: 1
Date: Sun, 26 Feb 2012 18:45:39 +0000
From: jay nanavati <jaysnanavati at hotmail.co.uk>
Subject: [rabbitmq-discuss] (no subject)
To: <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <BAY154-W539870CC6FC7A6D83362DC99680 at phx.gbl>
Content-Type: text/plain; charset="windows-1252"


Hi everyone,
I have followed this guide to setup rabbitMQ for android.http://simonwdixon.wordpress.com/2011/06/03/getting-started-with-rabbitmq-on-android-part-1/
The problem I am facing is On the line mConsumer.connectToRabbitMQ() in the ActivityHome, I have changed it to:
mOutput.append(?\n?+mConsumer.connectToRabbitMQ());
now when I have the wrong server, it prints false as expected however when I have the write server it does not print anything. In fact it does not even print the @string/hello which it should anyways..
The app does not consume messages and I think this could be the reason.. Also I have used loger and found out that the error must be on this method because I can logg before the call however I cannot logg anything after the call.
Any help would be greatly appreciated.. Thanks!


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120226/4bea75c7/attachment.html>

------------------------------

Message: 2
Date: Sun, 26 Feb 2012 12:51:53 -0800 (PST)
From: Uday Subbarayan <uday.subbarayan at yahoo.com>
Subject: [rabbitmq-discuss] Apache MINA Integration
To: "rabbitmq-discuss at lists.rabbitmq.com"
        <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
        <1330289513.57728.YahooMailNeo at web44910.mail.sp1.yahoo.com>
Content-Type: text/plain; charset="iso-8859-1"

Hi All,
? ? ?Has anyone integrated Apache MINA with Rabbit MQ to publish and receive messages?

Thanks,
-Uday.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120226/55d812e1/attachment-0001.htm>

------------------------------

Message: 3
Date: Sun, 26 Feb 2012 19:00:15 -0800 (PST)
From: Codevally <codevally at gmail.com>
Subject: [rabbitmq-discuss] Problem with using rabbitmqctl on EC2
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID:
        <17970f1d-15cf-42a2-9b5a-f431ffd74a6d at v2g2000vbx.googlegroups.com>
Content-Type: text/plain; charset=ISO-8859-1

Hi Experts

I have installed RabbitMQ 2.7.1 on EC2 (host name is ec2test2) and server getting started without any issue.

AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at ec2test2
app descriptor : /app/rabbitmq_server-2.7.1/sbin/../ebin/rabbit.app
home dir       : /root
config file(s) : (none)
cookie hash    : 4lZvwoYL5ZJbkEiBx9CgDA==
log            : /var/log/rabbitmq/rabbit at ec2test2.log
sasl log       : /var/log/rabbitmq/rabbit at ec2test2-sasl.log
database dir   : /app/rabbitmq-config/lib/rabbitmq/mnesia/
rabbit at ec2test2
erlang version : 5.9

But when I try to use rabbitmqctl, I am getting the below error.

ec2test2:/app/rabbitmq/sbin # sh rabbitmqctl {error_logger,{{2012,2,27},{2,55,8}},"Can't set long node name!
\nPlease check your configuration\n",[]} {error_logger,{{2012,2,27},{2,55,8}},crash_report,[[{initial_call,
{net_kernel,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},
{error_info,{exit,{error,badarg},[{gen_server,init_it,6,
[{file,"gen_server.erl"},{line,313}]},{proc_lib,init_p_do_apply,3,
[{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,
[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.17.0>]},
{dictionary,[{longnames,true}]},{trap_exit,true},{status,running},
{heap_size,6765},{stack_size,24},{reductions,2361}],[]]}

Host name is correctly configured and it displays:
ec2test2:/app/rabbitmq/sbin # hostname
ec2test2
ec2test2:/app/rabbitmq/sbin #

Could someone please explain this erroneous behavior?

Thanks.


------------------------------

Message: 4
Date: Mon, 27 Feb 2012 16:37:24 +1300
From: Alistair Bayley <alistair at abayley.org>
Subject: Re: [rabbitmq-discuss] [help] [beginner] server stops sending
        messages; publish (in transaction) hangs on commit
To: Simon MacMullen <simon at rabbitmq.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID:
        <CAKYODbip9zOg2=7xNukG6oMAGVqZHdU1ibza=5+98xvUTQtzow at mail.gmail.com>
Content-Type: text/plain; charset=UTF-8

On 25 February 2012 00:38, Simon MacMullen <simon at rabbitmq.com> wrote:
>>
>> OK. Can I have some guidance as to how much memory we should allocate?
>
> This is a real how-long-is-a-piece-of-string question I'm afraid. 512M
> would already be a significant step towards the comfort zone though.

rabbitmqctl report shows a large number of channels (in the thousands) and memory usage seems to correlate with the large number of channels.
I've left the server running and shut down each of the clients, and the channels have vanished from the report output, so I suspect a dodgy client here. We're using python kombu over ampqlib, so maybe kombu is doing something undesirable. A quick glance at the source shows that it has a channel pool, so maybe that's to blame. Anyway, more investigation required...

Once the number of channels is down to less than 10, the memory usage is around 32M, which seems fine to me. Maybe I don't need to allocate more, if I can solve this channels problem.


>> Is there an
>> option to get the server to return something that says that it is not
>> accepting messages?
>
> In ancient history we used to do this; there's a method in AMQP 0-9-1
> called channel.flow which the server should be able to use to tell a
> client to shut up. In practice it was unreliable (client may not
> support it, or may take too long to take notice of it).

I will do some more testing. Maybe the immediate flag on basic_publish will do something useful. python amqplib is protocol version 0.8, so whatever I do must fit in with that.

Alistair


------------------------------

Message: 5
Date: Mon, 27 Feb 2012 10:25:37 +0100
From: stone <zmstone at gmail.com>
Subject: [rabbitmq-discuss] dead connection lingers around?
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID:
        <CAPNZrFUMw1ZarWq-cuooqw8g6FJXhCNM7xgaBuiYS=a+cwHHQw at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Hi

Have a problem while testing my Erlang client based application.
I have no idea if it's due to some bad behavior in my app or whatsoever, hope I can get some useful information here.

In my case, I have:
three rabbit nodes in a cluster;
one non-durable topic exchange;
two connections established;
several channels and queues (exclusive & non-exclusive) declared.

While i'm testing, sometimes the connections they just linger around even the client has quit already.

For instance, here is one or my dead connections (copied from admin page):

AMQP 0-9-110.15.36.246:36526rabbit at test-app20B/s(1.9kB total) 0B/s(1.1kB total)4guestrunning I'm pretty sure that the client on 10.15.36.246 has been killed already, but the connection is still in "running" state.

/stone
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120227/3187eb08/attachment-0001.htm>

------------------------------

Message: 6
Date: Mon, 27 Feb 2012 09:44:56 +0000
From: Steve Powell <steve at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Problems with STOMP & access control
To: Lionel Cons <lionel.cons at cern.ch>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <7245AC14-4662-4F85-B38A-EAFF206DD7EF at rabbitmq.com>
Content-Type: text/plain; charset=us-ascii

Lionel,

Apologies for tardy reply.

Presently there is no way to set access control based upon the STOMP names, though I agree this would be desirable. Does the STOMP specification talk about access control at all?

I think the destination names aren't all entirely opaque, so it might be possible to exert access control on some resources, but a comprehensive solution is not available, I'm afraid.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 21 Feb 2012, at 13:44, Lionel Cons wrote:

> I've read http://www.rabbitmq.com/access-control.html and
> http://www.rabbitmq.com/stomp.html and I did not find any practical
> way to use access control with STOMP.
>
> In the STOMP world (in fact, since STOMP is broker behavior agnostic,
> this is rather tied to the JMS world), one can use destinations like
> /queue/test.foo or /topic/test.bar. It would be natural to use these
> names in the access control regexps to allow, for instance, a given
> user to access all queues matching "test\..*".
>
> Unfortunately, the STOMP destinations names get mapped to AMQP
> resource names that loose the original names, for instance
> amq.gen-AXVr2gFuBTO4duQ5OEC9b9.
>
> Is there a way in RabbitMQ to use access control based on the STOMP
> destination names?
>
> Cheers,
>
> Lionel
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



------------------------------

Message: 7
Date: Mon, 27 Feb 2012 10:21:39 +0000
From: Steve Powell <steve at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Unexpected behaviour with STOMP & NACK
To: Lionel Cons <lionel.cons at cern.ch>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <C71F5D87-E010-4007-8CEB-7560CCEBFFD7 at rabbitmq.com>
Content-Type: text/plain; charset=us-ascii

Lionel,

Apologies for the tardy reply.

Thank you for reporting this. What is happening is that the NACK sets the 'requeue=true' flag, which, by definition, puts the message back on its queue.
It is then available for redelivery. Whether it gets redelivered to the same consumer depends on lots of things, but is entirely possible, and is expected when there is only one consumer.

Currently, we expect this behaviour and did not think it was prohibited by the specification.

If this is determined to violate the specification we could set requeue=false on NACK, then neither this client, nor any other, will see the message; which is allowable server behaviour. There is currently no mechanism for re-routing messages that are NACKd, but this may change in the near future.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 22 Feb 2012, at 12:24, Lionel Cons wrote:

> I get an unexpected behaviour with STOMP & NACK with RabbitMQ 2.7.1.
>
> Here is my test, using an empty queue.
> - client1 connects, sends a message to the queue and disconnects
> - client2 connects, subscribes to the queue with ack:client
> - client2 receives the message (so far so good) but does not ack it
> - client3 connects, subscribes to the queue
> - client2 sends a NACK frame for the message
> - client2 receives the message once more
> - client3 receives nothing
>
> I would have expected the other client (client3) to receive the
> message that has not been consumed by client2. In fact, this is how
> ActiveMQ and Apollo work.
>
> FWIW, the STOMP 1.1 spec mentions:
>
> | NACK is the opposite of ACK. It is used to tell the server that the
> | client did not consume the message. The server can then either send
> | the message to a different client, discard it, or put it in a dead
> | letter queue. The exact behavior is server specific.
>
> So, although the behavior is not strictly defined, re-sending the
> message to the same client does not look appropriate to me.
>
> What do you think?
>
> Cheers,
>
> Lionel
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



------------------------------

Message: 8
Date: Mon, 27 Feb 2012 02:30:15 -0800 (PST)
From: Jon Hill <jon.hill at comshen.com>
Subject: Re: [rabbitmq-discuss] Consumers and exceptions
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID:
        <3b4977f4-5f27-4b7b-97bc-64606fc3acc9 at hs8g2000vbb.googlegroups.com>
Content-Type: text/plain; charset=ISO-8859-1

Steve

Many thanks for the reply. That makes sense, and I am now progressing.

All the best

Jon


------------------------------

Message: 9
Date: Mon, 27 Feb 2012 11:31:45 +0100
From: Lionel Cons <lionel.cons at cern.ch>
Subject: Re: [rabbitmq-discuss] Problems with STOMP & access control
To: Steve Powell <steve at rabbitmq.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <20299.23441.992131.685344 at mail.cern.ch>
Content-Type: text/plain; charset="us-ascii"

Steve Powell writes:
 > Does the STOMP specification talk about access control at all?

No. The specification does not describe the broker behavior. Even something like "/topic/foo" means a JMS-style topic named "foo" is outside of the spec.

 > I think the destination names aren't all entirely opaque, so it  > might be possible to exert access control on some resources, but a  > comprehensive solution is not available, I'm afraid.

It seems that things might work with queues since a STOMP destination of "/queue/foo" will AFAIK use a queue named "foo". To be confirmed.

Topics are more problematic but this does not seem to be STOMP specific.

In AMQP, how would you configure the RabbitMQ ACLs so that client A can only send to amq.topic with a routing key matching A.* while client B is restrcited to routing keys matching B.*?

The http://www.rabbitmq.com/access-control.html page does not really describe what a reource is. Would a syntax like amq.topic:A.* make sense to perform routing key based access control?

Cheers,

Lionel


------------------------------

Message: 10
Date: Mon, 27 Feb 2012 10:42:00 +0000
From: Simon MacMullen <simon at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Ensuring low latency for publishers
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <4F4B5DF8.5090500 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

On 24/02/12 18:07, Eric wrote:
> In reality, the throttling case is extremely unlikely anyway, right?
> You basically have to create a case where publishers are outpacing
> consumers and/or the speed of disk writes on the broker.  So you'd
> have to publish something like 100mb/s with little or no consumption,
> and our application is roughly 5mb/minute.

With small messages in fact the first thing you run into is being CPU-bound making routing decisions. But the general principle holds, yes.

> In conclusion, I finally did what I should have done in the first
> place.  I mocked up the threading scenario we're likely to see in
> production and benchmarked it against Java's LinkedBlockingQueue and
> ArrayBlockingQueue.  Compared to each producer thread having its own
> linked list (the completely uncontended scenario) the blocking queues
> introduced virtually no additional waiting - a microsecond or two at
> most.  That's the case even at rates 50x or more than we'd see in
> production.  So blocking queue it is, and that's a comfortingly simple
> solution.
>
> Thanks for all the help and apologies for under-researching what I was
> doing.

Ah, good.

I had a quick look at implementing non-blocking publish on Java on Friday. Unfortunately it's not possible to do this without NIO on Java, so a prerequisite becomes "port the Java client to NIO", which... makes it less likely to happen I'm afraid.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware


------------------------------

Message: 11
Date: Mon, 27 Feb 2012 10:56:09 +0000
From: Steve Powell <steve at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] STOMP doesn't include the routing-key
        on      MESSAGE frames
To: Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com>
Cc: RabbitMQ Discuss <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <5E2DB83D-C02B-48D6-97C2-FDB76643B855 at rabbitmq.com>
Content-Type: text/plain; charset=us-ascii

Tony,

Read your patch, and prefer this solution to adding extra headers.

I'm raising a bug (24763) to fix our spec-compliance problem (thank you for
pointing this out), and see if we can get this change in.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 20 Feb 2012, at 20:36, Tony Garnock-Jones wrote:

> Hi Steve,
>
> How about the attached patch? It attempts to bring the "destination"
> header in MESSAGEs in to line with the STOMP 1.1 spec. I've paid
> cursory attention to binary-and-slash-escaping issues but it could use
> a second glance before being committed, I reckon.
>
> Regards,
>  Tony
>
> On 20 February 2012 14:56, Tony Garnock-Jones
> <tonygarnockjones+rabbitmq at gmail.com> wrote:
>> Adding the routing_key puts the final small missing piece in place. A
>> perhaps more STOMPish way of giving it would be to have a "to" header
>> or similar carried in a MESSAGE, containing the full destination given
>> in the SEND. Oh wait! I've just checked, and actually that's what's
>> required by the 1.1 spec already. So the STOMP adapter isn't quite
>> spec-compliant, in that it's giving the destination from the
>> *subscribe* rather than the *send*.
> --
> Tony Garnock-Jones
> tonygarnockjones at gmail.com
> http://homepages.kcbbs.gen.nz/tonyg/
> <better-destination-patch.patch>



------------------------------

Message: 12
Date: Mon, 27 Feb 2012 11:05:56 +0000
From: Simon MacMullen <simon at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] dead connection lingers around?
To: stone <zmstone at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <4F4B6394.10903 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

Hi.

Sometimes if a TCP connection gets killed outright the OS never notices
and so we don't know either.

This probably implies you are not closing connections properly? (i.e.
with the AMQP close handshake, by invoking amqp_connection:close/1.)

Enabling AMQP heartbeats will allow RabbitMQ to detect this condition.

Cheers, Simon

On 27/02/12 09:25, stone wrote:
> Hi
>
> Have a problem while testing my Erlang client based application.
> I have no idea if it's due to some bad behavior in my app or whatsoever,
> hope I can get some useful information here.
>
> In my case, I have:
> three rabbit nodes in a cluster;
> one non-durable topic exchange;
> two connections established;
> several channels and queues (exclusive & non-exclusive) declared.
>
> While i'm testing, sometimes the connections they just linger around
> even the client has quit already.
>
> For instance, here is one or my dead connections (copied from admin page):
>
> AMQP 0-9-1    10.15.36.246:36526 <http://10.15.36.246:36526>
> rabbit at test-app2      0B/s_(1.9kB total)      0B/s_(1.1kB total)      4       guest   running
>
> I'm pretty sure that the client on 10.15.36.246 has been killed already,
> but the connection is still in "running" state.
>
> /stone
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


--
Simon MacMullen
RabbitMQ, VMware


------------------------------

Message: 13
Date: Mon, 27 Feb 2012 11:06:49 +0000
From: Simon MacMullen <simon at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] ??:  Passive queue declaration and
        channel closure
To: Simone Busoli <simone.busoli at gmail.com>
Cc: "rabbitmq-discuss at lists.rabbitmq.com"
        <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <4F4B63C9.7070909 at rabbitmq.com>
Content-Type: text/plain; charset=GB2312

On 25/02/12 18:37, Simone Busoli wrote:
> David, I somewhat agree with you, lack of documentation about
> operational aspects of broker behavior is something I have been missing
> as well.

Yeah, I suspect our documentation could still be better. But this is one
of the areas where it's really easy to be blinded by over-familiarity.
What sort of things do you think are particularly missing?

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware


------------------------------

Message: 14
Date: Mon, 27 Feb 2012 11:43:12 +0000
From: Michael Bridgen <mikeb at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Apache MINA Integration
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <4F4B6C50.9070702 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

> Has anyone integrated Apache MINA with Rabbit MQ to publish and receive
> messages?

What form would you expect such an integration to take?


------------------------------

Message: 15
Date: Mon, 27 Feb 2012 11:49:18 +0000
From: Marek Majkowski <majek04 at gmail.com>
Subject: Re: [rabbitmq-discuss] [help] [beginner] server stops sending
        messages; publish (in transaction) hangs on commit
To: Alistair Bayley <alistair at abayley.org>
Cc: rabbitmq-discuss <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
        <CABzX+qznWcOPTsLob0w+uK0vUg7GBbOqot0EzhbKud12DDLAJQ at mail.gmail.com>
Content-Type: text/plain; charset=UTF-8

On Mon, Feb 27, 2012 at 03:37, Alistair Bayley <alistair at abayley.org> wrote:
> On 25 February 2012 00:38, Simon MacMullen <simon at rabbitmq.com> wrote:
>>>
>>> OK. Can I have some guidance as to how much memory we should allocate?
>>
>> This is a real how-long-is-a-piece-of-string question I'm afraid. 512M would
>> already be a significant step towards the comfort zone though.
>
> rabbitmqctl report shows a large number of channels (in the thousands)
> and memory usage seems to correlate with the large number of channels.
> I've left the server running and shut down each of the clients, and
> the channels have vanished from the report output, so I suspect a
> dodgy client here. We're using python kombu over ampqlib, so maybe
> kombu is doing something undesirable. A quick glance at the source
> shows that it has a channel pool, so maybe that's to blame. Anyway,
> more investigation required...

Right. This is definitely possible that channels are the main
thing that consumes memory.

> Once the number of channels is down to less than 10, the memory usage
> is around 32M, which seems fine to me. Maybe I don't need to allocate
> more, if I can solve this channels problem.

Yup, quite possible.

>>> Is there an
>>> option to get the server to return something that says that it is not
>>> accepting messages?
>>
>> In ancient history we used to do this; there's a method in AMQP 0-9-1 called
>> channel.flow which the server should be able to use to tell a client to shut
>> up. In practice it was unreliable (client may not support it, or may take
>> too long to take notice of it).
>
> I will do some more testing. Maybe the immediate flag on basic_publish
> will do something useful. python amqplib is protocol version 0.8, so
> whatever I do must fit in with that.

Nope, "immediate" flag is a completely unrelated:
  http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish

Marek


------------------------------

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


End of rabbitmq-discuss Digest, Vol 57, Issue 28
************************************************


------------------------------

Message: 2
Date: Tue, 28 Feb 2012 12:48:03 -0300
From: "CONFERENCIA" <santiagomonttco at gmail.com>
Subject: [rabbitmq-discuss] |Spam| ACCIDENTES DEL TRABAJO
        "RESPONSABILIDAD CIVIL Y PENAL"
To: <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <fb9cc8f8818c16aba67404620019a3af at gmail.com>
Content-Type: text/plain; charset="us-ascii"

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120228/db899444/attachment.html>

------------------------------

Message: 3
Date: Tue, 28 Feb 2012 07:44:55 -0800
From: Gary Russell <grussell at vmware.com>
Subject: Re: [rabbitmq-discuss] Apache MINA Integration
To: "rabbitmq-discuss at lists.rabbitmq.com"
        <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <4F4CF677.7090600 at vmware.com>
Content-Type: text/plain; charset="iso-8859-1"

We have lightweight TCP adapters in Spring Integration; it makes it very easy to bridge tcp to/from Rabbit. I just pushed a very simple sample here.


https://github.com/garyrussell/spring-integration-samples/tree/INTSAMPLES-66/basic/tcp-amqp


It sends data from a telnet client to a netcat server via a rabbit queue.


Gary

On 02/28/2012 12:16 AM, Uday Subbarayan wrote:
I am aware of the general purpose EAI frameworks including Camel. We are building a high performance compute cluster and using Rabbit MQ to pass messages. So, i want something very simple TCP server to receive & send messages to the queue.

Best,
Uday.

________________________________
From: Oleg Zhurakousky <ozhurakousky at vmware.com><mailto:ozhurakousky at vmware.com>
To: Michael Bridgen <mikeb at rabbitmq.com><mailto:mikeb at rabbitmq.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Sent: Monday, February 27, 2012 6:20 AM
Subject: Re: [rabbitmq-discuss] Apache MINA Integration

I believe it is a more general concern and typically handled by integration frameworks, in this case EIP-style (http://www.eaipatterns.com/) frameworks such as Spring Integration (http://www.springsource.org/spring-integration)
These frameworks already have fist class integration with AMQP (e.g., AMQP inbound and outbound channel adapters) as well as other protocols and products including TCP/IP.

Oleg

----- Original Message -----
From: "Michael Bridgen" <mikeb at rabbitmq.com<mailto:mikeb at rabbitmq.com>>
To: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Sent: Monday, February 27, 2012 6:43:12 AM
Subject: Re: [rabbitmq-discuss] Apache MINA Integration

> Has anyone integrated Apache MINA with Rabbit MQ to publish and receive
> messages?

What form would you expect such an integration to take?
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120228/9d91cb89/attachment-0001.htm>

------------------------------

Message: 4
Date: Tue, 28 Feb 2012 15:53:56 +0000
From: Christopher Lefevre <CLefevre at Transparent.com>
Subject: [rabbitmq-discuss] Query a queue status from the client
To: "rabbitmq-discuss at lists.rabbitmq.com"
        <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
        <5798631D5F355D4C99FDF23580295AF8187E009E at TLMAIL1.Transparent.local>
Content-Type: text/plain; charset="us-ascii"

Hello,
In my searches for obtaining the queue's status from a client, I stumbled upon this Stack Overflow question:
http://stackoverflow.com/questions/1038318/check-rabbitmq-queue-size-from-client

The user is asking about .NET, however I need it to work for Python.

I'm using PIka (0-9-1, if I recall correctly), with RabbitMQ 2.7.1


The user on Stack Overflow seems to be posting the exact solution I need as:


name, jobs, consumers = chan.queue_declare(queue=queuename, passive=True)

However, when I use this line, I only receive back an error that a None type object is not iterable. Which is due to the function only returning None.

Does anyone have any experience with this use case? Am I missing something in the queue declare?


Thank you for your time,
-Christopher Lefevre
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120228/ccd8903e/attachment-0001.htm>

------------------------------

Message: 5
Date: Tue, 28 Feb 2012 07:57:41 -0800
From: Gary Russell <grussell at vmware.com>
Subject: Re: [rabbitmq-discuss] Regd: Spring AMQP versus Java Client
        Library
To: "rabbitmq-discuss at lists.rabbitmq.com"
        <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <4F4CF975.5090507 at vmware.com>
Content-Type: text/plain; charset="iso-8859-1"

Spring AMQP...

http://static.springsource.org/spring-amqp/reference/html/

...brings, to AMQP, the familiar benefits of Spring (high level abstractions - eliminating boilerplate code, while providing access to lower level APIs when necessary, consistent exception hierarchy across different vendor implementations,  etc).

It also provides a listener container, enabling message-driven POJOs, thus eliminating all infrastructure dependencies from application code.

While clearly aimed at existing Spring users, who are already aware of these benefits, we feel it is equally applicable to those users who are not (yet) using Spring.

Gary

On 02/27/2012 10:13 PM, preeti sp wrote:
Hi
Do we get any advantages If we use Spring AMQP over Java Client Library or vice-versa?

Is it advised to use Spring AMQP If we do not intend to primarily use Spring as such?

Thanks,
Preeti

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120228/9c4c3bf1/attachment-0001.htm>

------------------------------

Message: 6
Date: Tue, 28 Feb 2012 16:51:29 +0000
From: Christopher Lefevre <CLefevre at Transparent.com>
Subject: Re: [rabbitmq-discuss] Query a queue status from the client
To: "rabbitmq-discuss at lists.rabbitmq.com"
        <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
        <5798631D5F355D4C99FDF23580295AF8187E00B9 at TLMAIL1.Transparent.local>
Content-Type: text/plain; charset="us-ascii"

I apologize, in my haste to send this out, I didn't get to fully investigate.

If someone else were to come upon this issue, what you need to do is declare a different Callback method, which accepts a variable.

This variable will contain member items for the Queue, Awaiting Messages, Consumers, Channel Number, and Frame Type.

To access these you would need to use:
variable.frame_type
variable.channel_number
variable.method.queue
variable.method.message_count
variable.method.consumer_count

Sorry to clog up the mailing list, and I hope I'm appending to the message correctly, but hopefully this will clear up any questions people may have had like this.

-Christopher Lefevre

From: Christopher Lefevre
Sent: Tuesday, February 28, 2012 10:54 AM
To: 'rabbitmq-discuss at lists.rabbitmq.com'
Subject: Query a queue status from the client

Hello,
In my searches for obtaining the queue's status from a client, I stumbled upon this Stack Overflow question:
http://stackoverflow.com/questions/1038318/check-rabbitmq-queue-size-from-client

The user is asking about .NET, however I need it to work for Python.

I'm using PIka (0-9-1, if I recall correctly), with RabbitMQ 2.7.1


The user on Stack Overflow seems to be posting the exact solution I need as:

name, jobs, consumers = chan.queue_declare(queue=queuename, passive=True)

However, when I use this line, I only receive back an error that a None type object is not iterable. Which is due to the function only returning None.

Does anyone have any experience with this use case? Am I missing something in the queue declare?


Thank you for your time,
-Christopher Lefevre
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120228/0cc5aa63/attachment-0001.htm>

------------------------------

Message: 7
Date: Tue, 28 Feb 2012 11:47:45 -0800 (PST)
From: Jerry Kuch <jerryk at vmware.com>
Subject: Re: [rabbitmq-discuss] RabbitMQ and MySQL
To: PepMad <pepmadon at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <0a594157-bc17-40e1-ab02-505ba0e7cd6e at CoachZ.local>
Content-Type: text/plain; charset=utf-8

Hi, Pep:

Can you tell us a bit more what you're trying to do?  I think
the StackOverflow poster is hinting at perhaps a more messaging-based
design for your application, rather than a quick drop-in hack to make
some side effect beyond the RDBMS happen as a result of a MySQL trigger.

Best regards,
Jerry

----- Original Message -----
From: "PepMad" <pepmadon at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, February 20, 2012 2:24:29 PM
Subject: [rabbitmq-discuss] RabbitMQ and MySQL

http://stackoverflow.com/questions/1467369/invoking-a-php-script-from-a-mysql-trigger

I was reading this post on Stack Overflow and the last suggestion was
to use RabbitMQ. Is this possible? I read the documentation on
RabbitMQ, how can a single mysql update be sent to a producer? I have
seen the mysql log file but that encapsulates multiple updates.

Thanks Pep
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


------------------------------

Message: 8
Date: Tue, 28 Feb 2012 11:53:46 -0800 (PST)
From: Jerry Kuch <jerryk at vmware.com>
Subject: Re: [rabbitmq-discuss] Design Help?
To: James Aimonetti <james at 2600hz.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <3418300e-6989-4f26-9846-8c0f6682f9e0 at CoachZ.local>
Content-Type: text/plain; charset=utf-8

Hi, James:

Some of this appears to go beyond messaging per se and into more
general distributed systems/services coordination.  Have you contemplated
using something like Apache Zookeeper or Heroku's Doozer?  The primitives
provided by those may lend themselves well to integrating-with/supporting
your application, while the messaging heavy lifting continues using Rabbit
and its features/guarantees in the ways they work best without strange
fetch-peek-ack-nack trickery that will likely make your application
pretty complex and hard to reason about.

http://zookeeper.apache.org/

http://xph.us/2011/04/13/introducing-doozer.html

Doozer is quite new; Zookeeper by virtue of its position in the
Hadoop ecology is older, more mature and well documented both online
and in books...

Best regards,
Jerry

----- Original Message -----
From: "James Aimonetti" <james at 2600hz.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Monday, February 20, 2012 9:04:12 AM
Subject: [rabbitmq-discuss] Design Help?

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey list,

Curious for feedback, as this design idea I have would possibly extend
to several places in our application, and I'd love to make it generic
enough to do so.

The basic problem:

We have a queue of work to be done, represented as a named queue. For
redundancy, we have 2->many processes (in Erlang) that will read from
the queue and do the work. Easy so far.

However, we also have a list of resources needed to process the work
queue, which needs to be shared across all worker processes. When one
worker retrieves a job from the work queue, it must also get the list of
available resources, match resource to job, and return the list of
resources (with the used resource flagged as such) back to a globally
accessible place (hoping to avoid the DB, but it may be a good-enough
sync point).

So, for example, there are four jobs, two that require a paper shredder,
two that require a wood chipper. There is only one paper shredder and
one wood chipper. There are also 10 workers available to actually shred
stuff.

Worker one consumes the list of available equipment (one paper shredder,
one wood chipper), and then pulls the first job (paper to be shredded).
Worker one grabs the paper shredder, returns the list of resources
having flagged the paper shredder as in use, and ACKs the job. When
worker one finishes shredding paper, it will wait until the resources
list is available and update it with 1 more paper shredder available.

Once a job is actually started, I don't care if the worker crashes or
not; that will be handled later. And I'll have a supervising gen_server
pull the resource list, add the resource its using to its state, and
spawn the actual worker (catching exits to return the resource). I'm
sure other measures will be needed to ensure the resource is added back
eventually, but I'm trying to get the basic idea down.

So once worker one is done retrieving a resource, worker two can next
get the resources list and the next job. If the job is paper shredding,
worker two will nack the job (as there are no paper shredders at the
moment) and return the resource list. I will eventually want to support
being able to requeue the job to the back of the job queue, but for now,
work stalls until the first item in the queue can be processed successfully.

So while the resources list is out of queue, no workers will consume
jobs from the work queue. As soon as it reappears in queue, I want the
next worker in line to grab it and try to process the next job.


Some initial concerns:

No resources available for the job at the front of the queue means a lot
of fetching and nacking of jobs, and fetching/returning the resource list.

Losing the resources list: if whatever node (our Erlang VMs only
communicate via AMQP) goes down while handling the resources list, it
will obviously never be republished. We do usually have a timeout window
for the worker to get a resource for a job (sometimes the actual finding
of the resource takes a while), so if I could coordinate all workers
consuming from the resources_available queue, I could know after timeout
+ a small fudge factor, that someone else should have begun processing.
So maybe the resources_available queue is more a try_to_process_a_job
queue, and each worker process maintains an identical list of resources
available, with a worker that pairs a job to resource publishing the
resource's in-use status.

So perhaps the solution is:

Jobs queue round robins amongst all workers, but only one worker can
fetch/(n)ack. A worker can only fetch from the jobs queue by consuming a
"next" message from a shared coordination queue. All workers publish
updates to resources available to a routing key so all workers'
resources state is in sync. If a worker can't find a resource for a job,
it can (configurable) 1) nack the job and send a 'next' to the
coordination queue; 2) requeue the job at the end of the jobs queue and
send a 'next'; 3) sit on the job (meaning no other worker can fetch from
the jobs queue) until an appropriate resource comes available.

Concerns here:

Starting/recovering the 'next' token.

I'm sure others but am realizing this is getting long.

Sorry for the wall of text and stream of consciousness writing. We have
a lot of places where this pattern is showing up and would love to get a
module or library written to ease doing this kind of coordination. Any
ideas or directions towards appropriate messaging patterns warmly welcome :)

- --
James Aimonetti
Distributed Systems Engineer / DJ MC_

2600hz | http://2600hz.com
sip:james at 2600hz.com
tel: 415.886.7905
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJPQn0MAAoJENc77s1OYoGgh+gH/i/kW2M5EMfQ/xz3dU6soUd4
joGvWC46MdAX2CqlEKyIcP+EsmiTH4Ojjh64Y5MrVv68xV2Zasi8O7W5scFGK31Q
5r1Uc4lLrCANiEA7MYnaKM3J+s+bf4m3NlDwhE/QKCO+OhZoZl/zYfzlzSlsQ3QX
3dIKIxJnvnvmehat/oqbpZFFZO7NX4dKWGr3Ysp4OBjPhQLDGGkZ3Tbjbe3KfL0j
EfdZubwXQQLsTU7oqI7K3HoZc1uWx50VdR28JT1ZTaBdchpUpQ9PXdbq1b++KA++
SkHpwYB37PgTqK9A3gsmuRCsRMmYP8p3iGPrflnP53kuuESZIZwUFuhbthV5DM8=
=MDx7
-----END PGP SIGNATURE-----
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


------------------------------

Message: 9
Date: Tue, 28 Feb 2012 12:23:48 -0800
From: James Aimonetti <james at 2600hz.com>
Subject: Re: [rabbitmq-discuss] Design Help?
To: Jerry Kuch <jerryk at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <4F4D37D4.90307 at 2600hz.com>
Content-Type: text/plain; charset="UTF-8"

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Jerry,

Thanks for the suggestions. You're right that this is an abuse of the
messaging patterns, but the way our system is structured seems to
require building these higher level concepts on top of the primitives we
get from AMQP/RabbitMQ.

We have a system spread out over many servers, across datacenters, with
redundant applications running, and we need ways to coordinate work
amongst the redundant workers in this manner. When we don't care about
the order of work, its really easy to have the queue round-robin the
work to each worker.

As we're building more advanced features into our platform, this pattern
of only allowing one worker to process a job, across the whole platform,
is popping up in a few places and we'd like to encapsulate that pattern
into a reusable bit of code (a behaviour in Erlang).

AMQP is the glue that binds all these apps together, so we look to build
on top of its feature set.

I'll let the list know more if I figure a tenable solution :)

On 02/28/2012 11:53 AM, Jerry Kuch wrote:
> Hi, James:
>
> Some of this appears to go beyond messaging per se and into more
> general distributed systems/services coordination.  Have you contemplated
> using something like Apache Zookeeper or Heroku's Doozer?  The primitives
> provided by those may lend themselves well to integrating-with/supporting
> your application, while the messaging heavy lifting continues using Rabbit
> and its features/guarantees in the ways they work best without strange
> fetch-peek-ack-nack trickery that will likely make your application
> pretty complex and hard to reason about.
>
> http://zookeeper.apache.org/
>
> http://xph.us/2011/04/13/introducing-doozer.html
>
> Doozer is quite new; Zookeeper by virtue of its position in the
> Hadoop ecology is older, more mature and well documented both online
> and in books...
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "James Aimonetti" <james at 2600hz.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Monday, February 20, 2012 9:04:12 AM
> Subject: [rabbitmq-discuss] Design Help?
>
> Hey list,
>
> Curious for feedback, as this design idea I have would possibly extend
> to several places in our application, and I'd love to make it generic
> enough to do so.
>
> The basic problem:
>
> We have a queue of work to be done, represented as a named queue. For
> redundancy, we have 2->many processes (in Erlang) that will read from
> the queue and do the work. Easy so far.
>
> However, we also have a list of resources needed to process the work
> queue, which needs to be shared across all worker processes. When one
> worker retrieves a job from the work queue, it must also get the list of
> available resources, match resource to job, and return the list of
> resources (with the used resource flagged as such) back to a globally
> accessible place (hoping to avoid the DB, but it may be a good-enough
> sync point).
>
> So, for example, there are four jobs, two that require a paper shredder,
> two that require a wood chipper. There is only one paper shredder and
> one wood chipper. There are also 10 workers available to actually shred
> stuff.
>
> Worker one consumes the list of available equipment (one paper shredder,
> one wood chipper), and then pulls the first job (paper to be shredded).
> Worker one grabs the paper shredder, returns the list of resources
> having flagged the paper shredder as in use, and ACKs the job. When
> worker one finishes shredding paper, it will wait until the resources
> list is available and update it with 1 more paper shredder available.
>
> Once a job is actually started, I don't care if the worker crashes or
> not; that will be handled later. And I'll have a supervising gen_server
> pull the resource list, add the resource its using to its state, and
> spawn the actual worker (catching exits to return the resource). I'm
> sure other measures will be needed to ensure the resource is added back
> eventually, but I'm trying to get the basic idea down.
>
> So once worker one is done retrieving a resource, worker two can next
> get the resources list and the next job. If the job is paper shredding,
> worker two will nack the job (as there are no paper shredders at the
> moment) and return the resource list. I will eventually want to support
> being able to requeue the job to the back of the job queue, but for now,
> work stalls until the first item in the queue can be processed successfully.
>
> So while the resources list is out of queue, no workers will consume
> jobs from the work queue. As soon as it reappears in queue, I want the
> next worker in line to grab it and try to process the next job.
>
>
> Some initial concerns:
>
> No resources available for the job at the front of the queue means a lot
> of fetching and nacking of jobs, and fetching/returning the resource list.
>
> Losing the resources list: if whatever node (our Erlang VMs only
> communicate via AMQP) goes down while handling the resources list, it
> will obviously never be republished. We do usually have a timeout window
> for the worker to get a resource for a job (sometimes the actual finding
> of the resource takes a while), so if I could coordinate all workers
> consuming from the resources_available queue, I could know after timeout
> + a small fudge factor, that someone else should have begun processing.
> So maybe the resources_available queue is more a try_to_process_a_job
> queue, and each worker process maintains an identical list of resources
> available, with a worker that pairs a job to resource publishing the
> resource's in-use status.
>
> So perhaps the solution is:
>
> Jobs queue round robins amongst all workers, but only one worker can
> fetch/(n)ack. A worker can only fetch from the jobs queue by consuming a
> "next" message from a shared coordination queue. All workers publish
> updates to resources available to a routing key so all workers'
> resources state is in sync. If a worker can't find a resource for a job,
> it can (configurable) 1) nack the job and send a 'next' to the
> coordination queue; 2) requeue the job at the end of the jobs queue and
> send a 'next'; 3) sit on the job (meaning no other worker can fetch from
> the jobs queue) until an appropriate resource comes available.
>
> Concerns here:
>
> Starting/recovering the 'next' token.
>
> I'm sure others but am realizing this is getting long.
>
> Sorry for the wall of text and stream of consciousness writing. We have
> a lot of places where this pattern is showing up and would love to get a
> module or library written to ease doing this kind of coordination. Any
> ideas or directions towards appropriate messaging patterns warmly welcome :)
>
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

- --
James Aimonetti
Distributed Systems Engineer / DJ MC_

2600hz | http://2600hz.com
sip:james at 2600hz.com
tel: 415.886.7905
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJPTTfUAAoJENc77s1OYoGgdq0H/2X7oohyxx0MhsoD06J07l2P
DZm7PdEEZhUCSRGb43cBszNjiFLvYtmbSGgWUEzQMjZvI0idKC6m4XIgZqKfJ7Wk
yVQcvMfeHmE0w1NIyrJLFlXToONHlX2mLStRHnsmhFdMZuDHuAwF41N3rZPX5/wV
JIUIvYg45VccYu0zL4kRq/9nBORJsfXxXcsB8pdKJa0uLxv2OPptDOHFgZVz/wVe
FC99/fBU/WixtDvzhe2D7d+ubn5UT1jf01ZKUTAgkesM3EpcmqdqI51jQR2Q0hbT
VhVODLSlTSrYSYsumStXOaFzZ8kwY7+mT3UDbRqtv+ThIKuWWejCXGFVjDeKcA8=
=NhsO
-----END PGP SIGNATURE-----


------------------------------

Message: 10
Date: Tue, 28 Feb 2012 13:16:06 -0800 (PST)
From: PepMad <pepmadon at gmail.com>
Subject: Re: [rabbitmq-discuss] RabbitMQ and MySQL
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID:
        <97320990-eca5-46a4-bd47-f6b7e66973a2 at p12g2000yqe.googlegroups.com>
Content-Type: text/plain; charset=ISO-8859-1

Hi Jerry,

A website that the user can submit a job, the job is a script on the
server, the script takes an unknown length of time. I didn't want the
user on the site to wait, I just wanted a return status that the job
was sent to a que. I thought about using mysql udf's or a mysql script
for polling an update table, then I found the StackOverflow post and I
thought RabbitMQ might be a better solution for messaging a que via
the site.

Pep


------------------------------

Message: 11
Date: Tue, 28 Feb 2012 13:20:18 -0800 (PST)
From: Jerry Kuch <jerryk at vmware.com>
Subject: Re: [rabbitmq-discuss] RabbitMQ and MySQL
To: PepMad <pepmadon at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <77adf375-7d45-4988-a92f-0a9c369da3a1 at CoachZ.local>
Content-Type: text/plain; charset=utf-8

Hi, Pep:

That very well might be.  Your application would put together the
specifics of the job, publish them as a message into RabbitMQ, after
which some consumers which do the actual work of the job would dequeue
those tasks and do the work behind the scenes, thus decoupling your
users from having to wait on them.

Check out the tutorials here:

http://www.rabbitmq.com/getstarted.html

For ideas on how you might incorporate such patterns into your app.
It will likely work far better for you than scary database tricks. :-)

You can also look at the book "RabbitMQ in Action" from Manning (now
available as a preview eBook from Manning, print version due out
very soon) for a thorough discussion of messaging and its use in some
example application scenarios that are likely similar to what you have.

Best regards,
Jerry


----- Original Message -----
From: "PepMad" <pepmadon at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, February 28, 2012 1:16:06 PM
Subject: Re: [rabbitmq-discuss] RabbitMQ and MySQL

Hi Jerry,

A website that the user can submit a job, the job is a script on the
server, the script takes an unknown length of time. I didn't want the
user on the site to wait, I just wanted a return status that the job
was sent to a que. I thought about using mysql udf's or a mysql script
for polling an update table, then I found the StackOverflow post and I
thought RabbitMQ might be a better solution for messaging a que via
the site.

Pep
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


------------------------------

Message: 12
Date: Wed, 29 Feb 2012 14:54:24 +1300
From: Alistair Bayley <alistair at abayley.org>
Subject: [rabbitmq-discuss] [help] [beginner] testing with pika: some
        questions and complaints
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID:
        <CAKYODbh2qeJC3+j-PCgpsu7VH7HCaMHq2KPbGpZUupRsuY8HBA at mail.gmail.com>
Content-Type: text/plain; charset=UTF-8

I've been testing rabbitmq with pika (python) to understand how they
interact and learn about the AMQP protocol. I've some questions and
some complaints; no doubt much of this will be from my
misunderstandings of the AMQP/rabbitmq specs.

Pika (is this better posted to the pika mailing list?):

1.  why is the test in channel.py:102 like so:
        if callback and not isinstance(callback, types.FunctionType) and \
           not isinstance(callback, types.MethodType):
            raise TypeError("callback should be None, a function or method.")

    i.e. why isn't is just a callable() test e.g.
        if callback and not callable(callback):
            raise TypeError("callback should be callable.")

    (is this a python-3 compatibility thing?)


2.  documentation for callback functions is mostly non-existent, and when it
    exists is sometimes wrong e.g. on http://pika.github.com/channel.html :

    (i) channel.basic_get:
        "callback method signature should have 3 parameters:
        The method frame, header frame and the body"
    In fact the callback gets 4 parameters:
        channel, method (Basic.GetOk), properties (Basic.Properties), body

    (ii) channel.add_on_close_callback:
        "The callback function should receive a frame parameter."
    In fact the callback gets 2 parameters: error_code, error_message


3.  why does basic_ack cause this warning?
    CallbackManager.add: Duplicate callback found for "0:Connection.CloseOk"
    i.e. why does it appear to add a(nother) connection close callback?
    I've grubbed through the pika source but can't see how/where it happens.


AMQP/rabbitmq:

4.  why doesn't basic_ack do what I expect?
    If I do a basic_get with no_ack=False, and then a basic_ack,
    the message stays on the queue.
    I can repeatedly fetch-and-ack it, and each time redelivered=true.


5.  if the server reaches a state where it stops accepting messages
    (e.g. memory usage exceeds the high water mark) it does not send
    nack or return responses to basic_publish.
    This is both with transactions, or with channel confirm_delivery
    enabled.


(5) is a concern when one requires guaranteed delivery. Having the
server swallow the message and not respond doesn't seem reliable to
me. Is there some other method I should be using for guaranteed
delivery?

Alistair


------------------------------

Message: 13
Date: Wed, 29 Feb 2012 15:16:54 +0530
From: Ashutosh Mathur <amathur.q at gmail.com>
Subject: [rabbitmq-discuss] (no subject)
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID:
        <CA+u4LE6Sg4Ou6JAMpP4EKgB0Ep1i_UCRfsmmK4J-tKY3o9rGzQ at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Hi,

I wanted to know:
- whether RabbitMQ 2.7.1 supports AMQP 1.0 or will there be a newer version
of RabbitMQ to support this?
-Can you please throw some light on the JMS-AMQP mapping which is added in
the AMQP 1.0 release.

Thanks in Advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120229/9c33dd27/attachment-0001.htm>

------------------------------

Message: 14
Date: Wed, 29 Feb 2012 10:13:26 +0000
From: Simon MacMullen <simon at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 57, Issue
        28
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <4F4DFA46.4060709 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

On 28/02/12 14:56, Jose Jimenez Ortiz wrote:
> I installed rabbitmq 2.7.1 and enable Rabbitmq_Management plugin but
> in the explorer I don't see anything on OVERVIEW panel.

This is a bit of a vague question, making it a bit hard to answer. All I
can say is it works for lots of people :-)

When you say you don't see anything, you mean a completely blank page?
By explorer do you mean MSIE (which version?) Are there any Javascript
errors shown?

What does http://<server_name>:55672/api/overview look like?

What about http://localhost:55672/js/tmpl/overview.ejs ?

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware


------------------------------

Message: 15
Date: Wed, 29 Feb 2012 10:28:18 +0000
From: Simon MacMullen <simon at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] [help] [beginner] testing with pika:
        some questions and complaints
To: Alistair Bayley <alistair at abayley.org>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <4F4DFDC2.3020801 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

On 29/02/12 01:54, Alistair Bayley wrote:
> I've been testing rabbitmq with pika (python) to understand how they
> interact and learn about the AMQP protocol. I've some questions and
> some complaints; no doubt much of this will be from my
> misunderstandings of the AMQP/rabbitmq specs.
>
> Pika (is this better posted to the pika mailing list?):

Maybe?

> AMQP/rabbitmq:
>
> 4.  why doesn't basic_ack do what I expect?
>      If I do a basic_get with no_ack=False, and then a basic_ack,
>      the message stays on the queue.
>      I can repeatedly fetch-and-ack it, and each time redelivered=true.

That sounds like somehow the ack is malformed somehow (wrong ack tag?)
and instead taking the channel / connection down. Is anything showing up
in the server logs at this point?

> 5.  if the server reaches a state where it stops accepting messages
>      (e.g. memory usage exceeds the high water mark) it does not send
>      nack or return responses to basic_publish.
>      This is both with transactions, or with channel confirm_delivery
>      enabled.
>
>
> (5) is a concern when one requires guaranteed delivery. Having the
> server swallow the message and not respond doesn't seem reliable to
> me. Is there some other method I should be using for guaranteed
> delivery?

The server is not swallowing the message without responding; it's
stopped accepting messages altogether, and will (eventually) send
confirms for everything it's accepted. However, in this scenario you're
presumably hammering the server with messages, and in that case there
can be lots of messages waiting in the OS TCP buffers - RabbitMQ hasn't
seen them at all.

It's not clear what else RabbitMQ could do in this situation - for
guaranteed delivery you need to treat the message as the producer's
responsibility until you see the confirm or tx.commit-ok.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware


------------------------------

Message: 16
Date: Wed, 29 Feb 2012 11:13:35 +0000
From: Simon MacMullen <simon at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] (no subject)
To: Ashutosh Mathur <amathur.q at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <4F4E085F.9040607 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

On 29/02/12 09:46, Ashutosh Mathur wrote:
> I wanted to know:
> - whether RabbitMQ 2.7.1 supports AMQP 1.0 or will there be a newer
> version of RabbitMQ to support this?

2.7.1 does not. We have an experimental 1.0 plugin but it requires a
patched server which has not been kept up to date.

We *may* support AMQP 1.0 in the future. But AMQP 1.0 is a huge change
from 0-9-1, there is almost nothing in common. So it's a really
substantial piece of work to support it, and we are a small team. So
we're waiting to see what the demand for it turns out to be.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware


------------------------------

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


End of rabbitmq-discuss Digest, Vol 57, Issue 30
************************************************


This message is for the sole use of the intended recipient. If you received this message in error please delete it and notify us. If this message was misdirected, Structured Portfolio Management, LLC, and its affiliates ("SPM") do not waive any confidentiality or privilege. Opinions expressed are subject to change without notice and may differ or be contrary to the opinions or recommendations of SPM or the opinions expressed by other business areas or groups of SPM as a result of using different assumptions and criteria. SPM is not responsible for any recommendation, solicitation, offer or agreement or any information about any transaction, customer account or account activity contained in this communication.


From simon at rabbitmq.com  Wed Feb 29 13:32:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 29 Feb 2012 13:32:44 +0000
Subject: [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 57, Issue 28
In-Reply-To: <CA7F5DBB-7844-40C2-AF6F-C3FE5635ED4E@tjervaag.com>
References: <mailman.1.1330344001.19760.rabbitmq-discuss@lists.rabbitmq.com>
	<AFFA651B612BDE4EB570E34F0571834D0E170F8B17@mail.vfinamex.local>
	<4F4DFA46.4060709@rabbitmq.com>
	<CA7F5DBB-7844-40C2-AF6F-C3FE5635ED4E@tjervaag.com>
Message-ID: <4F4E28FC.5070307@rabbitmq.com>

On 29/02/12 12:42, ?yvind Tjervaag wrote:
> Javascript error on the overview page. MSIE 8.

Thank you. Replicated, will be fixed in the next release.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From brendan at soundcloud.com  Wed Feb 29 15:16:58 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Wed, 29 Feb 2012 16:16:58 +0100
Subject: [rabbitmq-discuss] Changing the arguments of queues created by the
	federation plugin
Message-ID: <CAHZsVQY41=b3zUUKYzgYSr0hbiFhyj94F89iJvHnur++qx6NZQ@mail.gmail.com>

Hi,

I have a load balancer in front of a cluster, which is the upstream_set of
another cluster.
This works fine and dandy, until a node that a 'federation:' queue resides
on in the upstream goes down.

Since the federation plugin creates queues without x-ha-policy, the link
can't be re-established until the dead node is brought back into the
upstream cluster.

Questions:
Is there anyway to override the federation plugin behaviour and make it
specify x-ha-policy = all without forking the plugin?
When will upstream sets be dynamically add-able? =)
Is this sane?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120229/2c48ba8e/attachment.htm>

From simon at rabbitmq.com  Wed Feb 29 15:20:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 29 Feb 2012 15:20:13 +0000
Subject: [rabbitmq-discuss] Changing the arguments of queues created by
 the	federation plugin
In-Reply-To: <CAHZsVQY41=b3zUUKYzgYSr0hbiFhyj94F89iJvHnur++qx6NZQ@mail.gmail.com>
References: <CAHZsVQY41=b3zUUKYzgYSr0hbiFhyj94F89iJvHnur++qx6NZQ@mail.gmail.com>
Message-ID: <4F4E422D.3000107@rabbitmq.com>

On 29/02/12 15:16, Brendan Hay wrote:
> Questions:
> Is there anyway to override the federation plugin behaviour and make it
> specify x-ha-policy = all without forking the plugin?

No. That's a bit lame, maybe I should just add it in now.

> When will upstream sets be dynamically add-able? =)

Hopefully within a few months, probably next release +1, it's bubbling 
to the top of the to do list.

> Is this sane?

Yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From gmr at myyearbook.com  Wed Feb 29 19:56:03 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 29 Feb 2012 14:56:03 -0500
Subject: [rabbitmq-discuss] Management Plugin URL Encoding Bug
Message-ID: <5010B638917648B6ACAD5503B2186E64@myyearbook.com>

It appears that the Javascript code that encodes values does not properly encode more than one underscore (_) when creating a URL.  

For example, when deleting a binding: 

Routing Key: foo_bar_baz

Will be encoded as foo%255Fbar_baz

/api/bindings/vhost_name/e/exchange_name/q/queue_name/foo%255Fbar_baz

Should be encoded as foo%255Fbar%255Fbaz

/api/bindings/vhost_name/e/exchange_name/q/queue_name/foo%255Fbar%255Fbaz

If there's an external bug-tracker I can use to submit this (or other trivial items like it), please let me know.

Thanks,

Gavin


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120229/ecc2f561/attachment.htm>

From jerryk at vmware.com  Wed Feb 29 20:04:13 2012
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 29 Feb 2012 12:04:13 -0800 (PST)
Subject: [rabbitmq-discuss] Management Plugin URL Encoding Bug
In-Reply-To: <5010B638917648B6ACAD5503B2186E64@myyearbook.com>
Message-ID: <260b92d1-2a83-4527-b129-b7b85b4ed059@strongmad.batnest.org>

Gavin:

Ooops... that looks like a bug.  I'll file one in our Bugzilla for it.
Thanks for pointing it out.

Best regards,
Jerry

----- Original Message -----
From: "Gavin M. Roy" <gmr at myyearbook.com>
To: "List::RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, February 29, 2012 11:56:03 AM
Subject: [rabbitmq-discuss] Management Plugin URL Encoding Bug



It appears that the Javascript code that encodes values does not properly encode more than one underscore (_) when creating a URL. 


For example, when deleting a binding: 


Routing Key: foo_bar_baz 


Will be encoded as foo%255Fbar_baz 


/api/bindings/vhost_name/e/exchange_name/q/queue_name/foo%255Fbar_baz 


Should be encoded as foo%255Fbar%255Fbaz 


/api/bindings/vhost_name/e/exchange_name/q/queue_name/foo%255Fbar%255Fbaz 


If there's an external bug-tracker I can use to submit this (or other trivial items like it), please let me know. 


Thanks, 


Gavin 





_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From richard at mistraltech.co.uk  Fri Feb 24 10:02:15 2012
From: richard at mistraltech.co.uk (rwilson)
Date: Fri, 24 Feb 2012 02:02:15 -0800 (PST)
Subject: [rabbitmq-discuss] Ubuntu 11.10 does not shutdown
In-Reply-To: <CAL8b_0cqoC_1Dh4tpG-1FPsKPkaEtC3gihxcgw1NzJc_ffPTUA@mail.gmail.com>
References: <CAL8b_0dORe_EO88mp5R_aSUOZYJ7ujnbNScG6ai60An+0fKK2A@mail.gmail.com>
	<32052927.1398.1328484574945.JavaMail.geo-discussion-forums@yqtt30>
	<CAL8b_0cqoC_1Dh4tpG-1FPsKPkaEtC3gihxcgw1NzJc_ffPTUA@mail.gmail.com>
Message-ID: <33383959.post@talk.nabble.com>



Sampo Savolainen-2 wrote:
> 
> 
> I've fixed this on my computers by changing /usr/sbin/rabbitmq-server to
> start rabbitmq with start-stop-daemon instead of su:
> 
> .. snip
> if [ `id -u` = `id -u rabbitmq` -o "$SCRIPT" = "rabbitmq-plugins" ] ; then
>     /usr/lib/rabbitmq/bin/${SCRIPT} "$@"
> elif [ `id -u` = 0 ] ; then
>     # don't use su, use start-stop-daemon instead
>     #su rabbitmq -s /bin/sh -c "/usr/lib/rabbitmq/bin/${SCRIPT}
> ${CMDLINE}"
>     start-stop-daemon \
>         --chuid rabbitmq \
>         --start \
>         --pidfile $RABBITMQ_PID_FILE \
>         --exec /bin/sh \
>         -- /usr/lib/rabbitmq/bin/${SCRIPT} ${CMDLINE}
> else
> .. snap
> 
> 

Fixes it for me too, although start-stop-daemon wanted the parameters
re-ordered to:
...
    start-stop-daemon \
        --chuid rabbitmq \
        --start \
        --exec /bin/sh \
        --pidfile $RABBITMQ_PID_FILE \
        -- /usr/lib/rabbitmq/bin/${SCRIPT} ${CMDLINE}
...

Thanks
-- 
View this message in context: http://old.nabble.com/Ubuntu-11.10-does-not-shutdown-tp32853378p33383959.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From cliff.redmond at gmail.com  Fri Feb 24 12:43:27 2012
From: cliff.redmond at gmail.com (Cliff Redmond)
Date: Fri, 24 Feb 2012 04:43:27 -0800 (PST)
Subject: [rabbitmq-discuss] STOMP Plugin: Alternative exchange other
	than amq.topic?
In-Reply-To: <5EE26AB5-AC20-479F-B304-8B7DC73D21BD@rabbitmq.com>
References: <CADSpLP9gb9R2ZbEJ1OntxedX0VqMX1c_9-cGTBdyo+a8NbWmNQ@mail.gmail.com>
	<5EE26AB5-AC20-479F-B304-8B7DC73D21BD@rabbitmq.com>
Message-ID: <c28ec65f-c0c8-4a72-adfa-01ce481d783c@s13g2000yqe.googlegroups.com>

Hi Steve,

thanks for your answer.

I was facing the exact same problem as Ken: I think your solution only
partially addresses the issue - requiring a subscription to a pre-
existing queue significantly reduces the flexibility of Stomp/
RabbitMQ.

One of the most useful features of the Stomp plugin is that when a
Stomp consumer subscribes to a topic, it automatically creates a new
queue (with a lifecycle dictated by the subscription) and binds it to
the default topic exchange on that broker.

e.g. invoking the following in a consumer:

$frame = Net::Stomp::Frame->new( {
      command => "SUBSCRIBE",
      headers => {
          destination => "/topic/durable-topic-prefetch",
          id => $subscriberId,
          persistent => "true",
          ack => "client",
          prefetch_count => 1,
      },
});

$stomp->send_frame($frame);

will create a queue on the relevant broker:

sh-3.2# rabbitmqctl list_queues
Listing queues ...
[...]
stomp.dsub.durable-topic-prefetch.???R?M?\0006??1>?U	0
[...]
...done.

and bind it to the default topic exchange:

Listing bindings ...
[...]
amq.topic	exchange	stomp.dsub.durable-topic-prefetch.???R?M?\0006??1>?
U	queue	durable-topic-prefetch	[]
[...]
...done.

Pre-configuring AMQ queues is considerably less flexible, and the
alternative, creating a queue (and binding it to an alternatively
named federated topic exchange) using AMQP before each Stomp
subscription, militates against using Stomp at all.

Would it be possible to make a change to either of the Stomp or
Federation plugins:

- be able to specify a topic exchange in the Stomp plugin config (i.e.
rather than have it always use amq.topic),
- be able to federate internal/predefined exchanges in the Federation
plugin.

(I used the Shovel plugin to workaround this issue).

Many thanks,

Cliff.

On Feb 21, 6:25?pm, Steve Powell <st... at rabbitmq.com> wrote:
> Hi Ken,
>
> It is possible for you to SEND to the exchange of your choice from aSTOMP
> application, using a destination of the form: /exchange/<name>/<pattern> (seehttp://www.rabbitmq.com/stomp.html#d.ed) and there is no reason why this
> shouldn't be a topic exchange of your own making.
>
> If you need to SUBSCRIBE to AMQP destinations you can use the destination
> /amq/queue/<name> (but the queue must exist).
>
> Between them, these should allow you to useSTOMPwith federated exchanges
> without plugin modifications.
>
> Let us know how you get on.
>
> Steve Powell ?(a federated bunny)
> ----------some more definitions from the SPD----------
> vermin (v.) Treating the dachshund for roundworm.
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
>
> On 20 Feb 2012, at 16:19, Ken Simon wrote:
>
>
>
>
>
>
>
>
>
> > Greetings,
>
> > I'm trying to getfederationworking (via the rabbitmq_federation
> > plugin) in our environment ofSTOMPhosts, and to do so I have to
> > enablefederationin theSTOMPplugin's exchange: amq.topic. ?This
> > unfortunately doesn't seem to work because amq.* exchanges are
> > reserved and cannot be re-declared.
>
> > My solution at this point has been to edit the source of theSTOMP
> > plugin and point it at an exchange called "stomp_topic" (which I made
> > up, but could be anything) instead of the default amq.topic. ?Then I
> > just configure thefederationplugin to work with that exchange and it
> > works fine.
>
> > My question is, is there a better way of doing this? ?I hate
> > maintaining my own downstream changes to plugins if I don't have to.
> > The docs say that theSTOMPplugin routes all messages through
> > amq.topic, so it appears that's not configurable. ?But wouldn't it
> > make sense to allow use of an exchange that's not reserved? ?Or am I
> > missing something, and this is actually way easier? ?I'm having
> > trouble finding any documented cases of people using bothSTOMPand
> >federation.
>
> > Thanks,
>
> > --
> > Ken
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From max.kalika at gmail.com  Fri Feb 24 15:19:18 2012
From: max.kalika at gmail.com (Max Kalika)
Date: Fri, 24 Feb 2012 07:19:18 -0800 (PST)
Subject: [rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory
	on slave nodes
In-Reply-To: <4F454C42.4080400@gmail.com>
References: <4F454C42.4080400@gmail.com>
Message-ID: <7c0ffdda-7cec-4907-8c04-664c99922d2c@ob7g2000pbb.googlegroups.com>

This turned out to be worse than we first realized.  When two of the
servers exhibited high memory usage, clients became blocked and
stopped receiving data.  I was able to unwedge the running process
with some erlang surgery.  Obviously, this was a high-risk operation
on a running production system, but it seemed to have (mostly)
recovered and allowed data to flow again.  I say mostly because
there's a caveat which I'll describe later.

My procedure to fix this is as follows:
1) attach an erlang remote shell to the running process:

  erl -sname rabbitdbg@$(hostname -s) -setcookie $(sudo cat /var/lib/
rabbitmq/.erlang.cookie) -remsh rabbit@$(hostname -s) -hidden

2) list processes and look for anything consuming an unusually large
amount of memory pages (second column from the right):

  i().

3) There was one process with over 2 million pages.  It was constantly
running lists:zipwith/3.  Info on it showed lots and lots of messages
in the mailbox that just wasn't decreasing.

  process_info(list_to_pid("<0.XXXXX.XXX>")).

4) With fingers and toes crossed, I forced this process to die.  As
soon as this was executed, memory usage dropped and data started
flowing again:

  exit(list_to_pid("<0.XXXXX.XXX>"), kill).


I mentioned earlier that the system is *mostly* recovered.  The
remaining problem is disk utilization.  I suspect that since our
messages are marked durable, disk cleanup didn't occur.  I'm not sure
how to sync this up with runtime reality without restarting.

On Feb 22, 12:12?pm, Reverend Chip <rev.c... at gmail.com> wrote:
> I have a four-node 2.7.1 cluster. ?I just started experimenting with
> mirrored queues. ?One queue is mirrored across nodes 1&2, a second queue
> is mirrored across nodes 3&4. ?I've been feeding a lot of large messages
> through, using delivery-mode 2. ?Most of the messages I've purged, since
> the reader process can't keep up yet.
>
> Here's the problem: Memory usage. ?Nodes 1 & 3, presumably the master
> nodes for the queues, have maintained a normal memory profile, 3-6GB.
> But nodes 2 & 4, the presumable slaves, have had their memory grow to
> 58GB each. ?Worse, when I purged and then even deleted the queues, the
> memory usage did not go down. ?It seems I may have to reboot these nodes
> to get the memory back, and obviously I can't use mirrored queues if
> they're going to make my nodes do this, which is disappointing. ?I do
> have a workaround involving alternate exchanges, but the workaround can
> leave data stranded if a node is lost forever.
>
> Is there any other info I can provide to help diagnose and/or fix this?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matanzinger at gmail.com  Sun Feb 26 17:29:39 2012
From: matanzinger at gmail.com (matan zinger)
Date: Sun, 26 Feb 2012 09:29:39 -0800 (PST)
Subject: [rabbitmq-discuss] Does clustering increase throughput?
Message-ID: <e8d172a4-8921-4c22-869b-9638c37970f8@w4g2000vbc.googlegroups.com>

Hi All,

I've read and experienced with rabbit mq clustering feature over 2
machines.
Below are the results I found, which I found quite strange:

0. Direct exchange named "myexchange" was defined.
1. rabbit1 & rabbit2 were configured to work in a cluster. both are
using disc.
2. queue named "in.queue" was configured, and binded to routing key
"in"
3. 100k messages were enqueued with routing key "in". connection was
to rabbit1.
4. Running a single message handler on rabbit1 machine, connected to
rabbit1 mq.
Handling throuput: 2k messages / second
5. Running handlers on both rabbit1 & rabbit2 - each reached the
throuput of ~400 messages / second.
After stopping the message handler on rabbit2, handler on rabbit1
returned to 2k messages / second.
6. Running a single message handler on rabbit1 machine, connected to
rabbit2 mq.
Handling throuput: 400 messages / second

I still can't figure out this behavior:
I understood form the documentation that adding nodes to a cluster is
done in order to INCREASE throughput.
However, adding an additional handler leads to a degredation in
performance!

The second thing I can't figure out is the difference is throughput
between the cases of a single handler on rabbit1, and a single handler
on rabbit2.
If both nodes are active, and are using discs, than they should be
exactly the same.
There is no notion of master/slave.
If so - how come a different throughput received when running a single
handler on each of them?

Please help me understand these conflicts.

Thanks,
Matan

From steve at two-bulls.com  Sun Feb 26 21:42:47 2012
From: steve at two-bulls.com (stevecassidy)
Date: Sun, 26 Feb 2012 13:42:47 -0800 (PST)
Subject: [rabbitmq-discuss] Server connections not closing
In-Reply-To: <d175b484-ec2e-4275-8b56-0e014b89ef19@u37g2000prh.googlegroups.com>
References: <1b88645e-26fe-45b5-bdb8-ad42e551f7e4@u24g2000pru.googlegroups.com>
	<4EBA8958.20406@rabbitmq.com>
	<b2a63d75-6175-42a8-9f03-fae5d1df823a@m26g2000prn.googlegroups.com>
	<4EBBA756.8050701@rabbitmq.com>
	<d175b484-ec2e-4275-8b56-0e014b89ef19@u37g2000prh.googlegroups.com>
Message-ID: <33396464.post@talk.nabble.com>


Hi Robert,

Did you ever get to the bottom of this? We are seeing the same issue running
a number of ipad's all connecting to a rabbitmq server.

Cheers
Steve


Robert Gilland wrote:
> 
> Just an update
> 
> We are no closer currently to finding this gremlin.
> 
> We think it has something to do with the DSL Routers firewall,
> stopping the TCP tear down process.
> 
> Kind Regards,
> 
> Robert.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Server-connections-not-closing-tp32810152p33396464.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From thehollyhopdrive at gmail.com  Wed Feb 29 10:59:36 2012
From: thehollyhopdrive at gmail.com (Adam Pollock)
Date: Wed, 29 Feb 2012 02:59:36 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Release Roadmap
Message-ID: <17765093.11.1330513176399.JavaMail.geo-discussion-forums@vbne13>

Hi all,

Just wondering if there was a formal release roadmap? Failing that, when is 
the next release going to be available? My reason for asking is that I have 
converted our current JMS messaging system with OpenMQ over to an AMQP 
messaging system using RabbitMQ, and I've had some problems with a bug in 
the current release's (2.7.1) Java client (bug #24723 - memory leak). The 
bug has apparently been fixed and is scheduled to be included in the next 
release. 

We're looking to make this system live within the next few weeks and this 
is the last issue to address before that.

So, yes, if anyone could give me some idea of when the next release could 
be available, or point me in the right direction of a release roadmap of 
some kind, that would be very much appreciated.

Thanks,
Adam Pollock.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120229/8d5fdd18/attachment.htm>

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.3.1330951764.2884.rabbitmq-discuss@lists.rabbitmq.com>

LDAP system, but maybe I am mis-reading the output, and then STOMP
complains that its fails to authenticate.

Any help would be appreciated!


From allanfeid at gmail.com  Wed Feb 29 14:37:30 2012
From: allanfeid at gmail.com (Allan Feid)
Date: Wed, 29 Feb 2012 06:37:30 -0800 (PST)
Subject: [rabbitmq-discuss] Is there ever a need for a federation and
	a	cluster?
In-Reply-To: <a9f171b8-d22d-4f82-a2de-dc0a4b32b40f@StrongMad.local>
References: <CB2A0293.C52C%jim.langston@compuware.com>
	<a9f171b8-d22d-4f82-a2de-dc0a4b32b40f@StrongMad.local>
Message-ID: <23615420.432.1330526250708.JavaMail.geo-discussion-forums@ynlw24>

Hello Everyone,

I'm in the process of setting up multiple datacenters and would like 
separate clusters in each location, with some mechanism of reaching 
messages from other clusters. Looks like I'm not the only one interested in 
this, but is there currently any way of achieving this?

Thanks,
Allan

On Wednesday, 4 January 2012 13:25:33 UTC-5, Jerry Kuch wrote:
>
> Hi, Jim:
>
> It depends on your scenario.
>
> You might want to federate across a WAN; you wouldn't cluster across one, 
> since
> the Erlang distribution mechanisms that clustering builds on don't tolerate
> partitions and high latency well.
>
> You'd cluster if your goal is to increase the total capacity of your 
> broker,
> bearing in mind that the maximum throughput possible through a single queue
> won't get larger when you do so.
>
> Federating or Shoveling between different clusters, as you describe, is an 
> entirely reasonable thing to do in some circumstances.  Suppose, for 
> example
> that you want increased capacity over a single host broker, or mirrored 
> queues,
> or the like within each of two WAN-connected datacenters, but still wanted 
> to
> be able to pass some subset of your message traffic between the 
> datacenters.
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "Jim Langston" <Jim.Langston at compuware.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Wednesday, January 4, 2012 10:20:30 AM
> Subject: [rabbitmq-discuss] Is there ever a need for a federation and 
> a        cluster?
>
>
> Hi all,
>
>
> Given a scenario where the entire environment is identical for
> rabbitMQ (same servers, OS's , RMQ versions ? etc) , would there ever
> be a need to have the environment configured for using both
> as a cluster, and as a federation ?
>
>
> From what I've gathered so far, before experimenting, it seems that
> unless there is some sort of mixed environment, clustering is the way
> to go.
>
>
> What about if there are two different clusters, w/ different brokers and
> exchanges ? Would you want to use a federation between them ?
>
>
> Thanks,
>
>
> Jim
>
>
> The contents of this e-mail are intended for the named addressee only. It 
> contains information that may be confidential. Unless you are the named 
> addressee or an authorized designee, you may not copy or use it, or 
> disclose it to anyone else. If you received it in error please notify us 
> immediately and then destroy it .
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120229/a2155d0c/attachment.htm>

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.4.1331685554.2884.rabbitmq-discuss@lists.rabbitmq.com>

either do it with the rabbitmq management plugin, which comes with the
standard RabbitMQ installation and you only need to enable it. Or you
create queues using any client library, for instance pika, to connect to
the server and declare and bind queues to the exchanges.

I'm not aware of a way to create queues in rabbitmq.config.

Cheers,

Brian

On Tue, Mar 13, 2012 at 3:39 AM, Timya Tortus <timya15 at gmail.com> wrote:

> Sorry, Simon for the very small problem description.
> Considering ClientRabbit and ServerRabbit as two rabbitmq servers.
> On ClientRabbit rabbitmq.config file the federation plugin is configured.
> eg.
> {rabbit_federation,
>   [{exchanges, [[{exchange, "my-exchange"},
>      {virtual_host, "/"},
>      {type, "topic"},
>      {durable, true},
>      {auto_delete, false},
>      {internal, false},
>     {upstream_set, "my-upstreams"}]
>   ]},
>   {upstream_sets, [{"my-upstreams",
>     [[{connection, "upstream-server"},
>      {exchange, "my-upstream-x"},
>      {max_hops, 2}]
>     ]}
>    ]},
>    {connections, [{"upstream-server",
>      [{host, "ServerRabbit"},
>       {protocol, "amqps"},
>       {port, 5671},
>       {virtual_host, "/"},
>       {username, "guest"},
>       {password, "secret"},
>       {mechanism, default},
>       {prefetch_count, 1000},
>       {reconnect_delay, 5},
>       {heartbeat, 1},
>       {queue_expires, 30000},
>       {message_ttl, 10000},
>     ]}
>   ]},
>   {local_username, "guest"},
>   {local_nodename, "ClientRabbit"}
>  ]
> }
>
> On both servers the exchanges get created.
> Is there a way to create the queues and bind them to these exchanges.
>
> Also in the 2.7.9 release note it is stated as;
> federation plugin:
> enhancements
> - allow the queue declared upstream to be mirrored
>
> ? How to declare the queue on ServerRabbit and ClientRabbit, using the
> rabbitmq.config present on the ClientRabbit.
>
> Regards,
> Timya
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

--e0cb4efe334c30553904bb2933fa
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi Timya,<br><br>From what I know, to create queues and bind them to the ex=
changes, you can either do it with the rabbitmq management plugin, which co=
mes with the standard RabbitMQ installation and you only need to enable it.=
 Or you create queues using any client library, for instance pika, to conne=
ct to the server and declare and bind queues to the exchanges.<br>
<br>I&#39;m not aware of a way to create queues in rabbitmq.config.<br><br>=
Cheers,<br><br>Brian<br><br><div class=3D"gmail_quote">On Tue, Mar 13, 2012=
 at 3:39 AM, Timya Tortus <span dir=3D"ltr">&lt;<a href=3D"mailto:timya15 at g=
mail.com">timya15 at gmail.com</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div>Sorry, Simon for the very small problem=
 description.<br>Considering ClientRabbit and ServerRabbit as two rabbitmq =
servers.<br>
On ClientRabbit rabbitmq.config file the federation plugin is configured.<b=
r>eg.<br>{rabbit_federation,</div>
<div>=A0 [{exchanges, [[{exchange,     &quot;my-exchange&quot;},<br>=A0    =
            =A0 =A0{virtual_host, &quot;/&quot;},<br>=A0                =A0=
 =A0{type,         &quot;topic&quot;},<br>=A0                =A0 =A0{durabl=
e,      true},<br>

=A0                =A0 =A0{auto_delete,  false},<br>=A0                =A0 =
=A0{internal,     false},<br>=A0                =A0 {upstream_set, &quot;my=
-upstreams&quot;}]<br>=A0              ]},<br>=A0  {upstream_sets, [{&quot;=
my-upstreams&quot;,<br>

=A0       =A0 [[{connection, &quot;upstream-server&quot;},<br>=A0	  =A0 =A0=
{exchange,   &quot;my-upstream-x&quot;},<br>=A0	  =A0 =A0{max_hops,   2}]<b=
r>=A0       =A0 ]}<br>=A0  =A0]},<br>=A0  =A0{connections, [{&quot;upstream=
-server&quot;,<br>=A0       =A0 =A0[{host,            &quot;ServerRabbit&qu=
ot;},<br>

=A0	 =A0 =A0 {protocol,        &quot;amqps&quot;},<br>=A0	 =A0 =A0 {port,  =
          5671},<br>=A0	 =A0 =A0 {virtual_host,    &quot;/&quot;},<br>=A0	 =
=A0 =A0 {username,        &quot;guest&quot;},<br>=A0	 =A0 =A0 {password,   =
     &quot;secret&quot;},<br>

=A0	 =A0 =A0 {mechanism,       default},<br>=A0	 =A0 =A0 {prefetch_count,  =
1000},<br>=A0	 =A0 =A0 {reconnect_delay, 5},<br>=A0	 =A0 =A0 {heartbeat,   =
    1},<br>=A0	 =A0 =A0 {queue_expires,   30000},<br>=A0	 =A0 =A0 {message_=
ttl,     10000},<br>=A0	=A0 ]}<br>=A0       ]},<br>

=A0  {local_username, &quot;guest&quot;},<br>=A0  {local_nodename, &quot;Cl=
ientRabbit&quot;}<br>=A0]</div><div>}<br><br>On both servers the exchanges =
get created.<br>Is there a way to create the queues and bind them to these =
exchanges.<br>

<br>Also in the 2.7.9 release note it is stated as;<br>federation plugin:<b=
r>enhancements<br>- allow the queue declared upstream to be mirrored<br><br=
>? How to declare the queue on ServerRabbit and ClientRabbit, using the rab=
bitmq.config present on the ClientRabbit. <br>

</div><div><br></div><div>Regards,</div><div>Timya<br></div><div><br></div>
<br>_______________________________________________<br>
rabbitmq-discuss mailing list<br>
<a href=3D"mailto:rabbitmq-discuss at lists.rabbitmq.com">rabbitmq-discuss at lis=
ts.rabbitmq.com</a><br>
<a href=3D"https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-dis=
cuss" target=3D"_blank">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo=
/rabbitmq-discuss</a><br>
<br></blockquote></div><br>

--e0cb4efe334c30553904bb2933fa--

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.5.1332761758.2884.rabbitmq-discuss@lists.rabbitmq.com>

waiting for tx.commit-ok. The spec makes no guarantees if the client
connection closes or an error occurs before the tx.commit-ok is received.

> I will try and transfer things over to confirms, however when i detect a
> duplicate I cannot know whether it has a copy on the queue or not (in
> the requeue senario) so all I can do is fail.. any ideas? this is where
> transactions could really help.. come on rabbit ! :)

You can only detect the duplicate when the second copy arrives. You
can't know whether a duplicate is on the way when the first of two
identical messages arrive.


-Emile


From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.6.1332765772.2884.rabbitmq-discuss@lists.rabbitmq.com>

JSONish syntax?

That is, if the user types

12345

they get the longstr "12345";

Hello

they get the longstr "Hello";

=12345

they get a numeric type with value 12345;

="Hello"

they get the longstr "Hello";

=Hello

they get a syntax error (it isn't JSON).

JSON's numbers, strings, booleans, arrays and maps ought to be enough for
the majority of cases. (It might be worth an Application Note on the
website regarding the mapping from AMQP table data to and from JSON, and
encouraging applications and plugins to stick to the common interoperable
subset...)

Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/

--14dae93408f748a39f04bc24b5d1
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

On 26 March 2012 06:33, Simon MacMullen <span dir=3D"ltr">&lt;<a href=3D"ma=
ilto:simon at rabbitmq.com">simon at rabbitmq.com</a>&gt;</span> wrote:<br><div c=
lass=3D"gmail_quote"><blockquote class=3D"gmail_quote" style=3D"margin:0 0 =
0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
I was really determined to avoid having a type select in the UI. But I&#39;=
m not sure that can be avoided. I&#39;ll file a bug.<br></blockquote><div><=
br>From the &quot;Works for Excel&quot; file: how about a magic escape into=
 some kind of JSONish syntax?<br>
<br>That is, if the user types<br><br><div style=3D"margin-left:40px">12345=
<br></div><br>they get the longstr &quot;12345&quot;;<br><br><div style=3D"=
margin-left:40px">Hello<br></div><br>they get the longstr &quot;Hello&quot;=
;<br>
<br><div style=3D"margin-left:40px">=3D12345<br></div><br>they get a numeri=
c type with value 12345;<br><br><div style=3D"margin-left:40px">=3D&quot;He=
llo&quot;<br></div><br>they get the longstr &quot;Hello&quot;;<br><br><div =
style=3D"margin-left:40px">
=3DHello<br></div><br>they get a syntax error (it isn&#39;t JSON).<br><br>J=
SON&#39;s numbers, strings, booleans, arrays and maps ought to be enough fo=
r the majority of cases. (It might be worth an Application Note on the webs=
ite regarding the mapping from AMQP table data to and from JSON, and encour=
aging applications and plugins to stick to the common interoperable subset.=
..)<br>
<br>Tony<br>-- <br></div></div>Tony Garnock-Jones<br><a href=3D"mailto:tony=
garnockjones at gmail.com" target=3D"_blank">tonygarnockjones at gmail.com</a><br=
><a href=3D"http://homepages.kcbbs.gen.nz/tonyg/" target=3D"_blank">http://=
homepages.kcbbs.gen.nz/tonyg/</a><br>


--14dae93408f748a39f04bc24b5d1--

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.7.1333731086.2884.rabbitmq-discuss@lists.rabbitmq.com>

actually want the service running. However, I don't see a way to tell
the rabbitmq-server install to just drop the bits, and not leave
anything running.

That's the crux of the question: How can we install rabbitmq-server
without ending up any new programs running?

Some further background:

Our installation is done using Puppet. We do *not* want to use the
rabbitmq user account. Instead, we have a dedicated account that all
of our services run under.

My puppet script successfully configures things so that rabbitmq runs
correctly under our special account. I have *no* problem with this
part.

The issue is: We don't want these leftover processes running as the
rabbitmq user hanging around after puppet completes. I've experimented
with adding "epmd -kill" to the Puppet scripts, and it successfully
kills epmd on about 30% of the nodes, but it fails (exit code !=3D 0) on
the other 70%.

The only way I've seen to clean up this leftover setup state is to
reboot the nodes, and that's a pretty drastic, unsatisfactory
solution.

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.8.1334164642.2884.rabbitmq-discuss@lists.rabbitmq.com>

Are there any configuration parameters to control how that port is
bound, selected, or published?


From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.9.1334318146.2884.rabbitmq-discuss@lists.rabbitmq.com>

unpack it and get rabbit running in 20 seconds max provided you have Erlang
installed.

There's is where the problem comes. So I'm not criticizing RabbitMQ here.
In my case I've been using Erlang for a few years already so I like to
build it from source and so on, but some people don't. Actually some people
just want to evaluate RabbitMQ and see if it's the right solution for them.
If I can't get RabbitMQ running because something doesn't compile or
whatever the reason, but then I download MagickMQ and it works like a charm
then I will just evaluate MagickMQ and discard RabbitMQ. It's sad but it's
how it works most of the time.

I agree with you Matthew that you should learn how to compile Erlang,
Haskell or whatever you use, but not everybody would agree with that. See
for example the download numbers the Haskell guys are publishing from time
to time since they created the Haskell platform. Erlang solutions even has
their own page now where you can download a ready to use Erlang distro.

So what I want to do is just to add one command to the make files that can
generate those Erlang releases and put them in a tarball.

Alvaro

On Fri, Apr 13, 2012 at 1:41 PM, Matthew Sackman <matthew at rabbitmq.com>wrot=
e:

> On Fri, Apr 13, 2012 at 01:35:03PM +0200, Alvaro Videla wrote:
> > Are you serious? I mean=85 if you want to disagree with me I'm OK with
> that.
> > But there's no need to come up with that kind of sarcasm.
>
> Sorry, my apologies. Having a bad day. Didn't mean to take it out on
> you.
>
> I agree the packaging issue is a problem, and there has been a lot done
> to improve this. I do genuinely think that right now, the cloud foundary
> approach may be a viable alternative if getting going quickly is the
> key.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

--20cf303bfae6ed128304bd8e25a5
Content-Type: text/html; charset=windows-1252
Content-Transfer-Encoding: quoted-printable


From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.10.1334318146.2884.rabbitmq-discuss@lists.rabbitmq.com>

ck it and get rabbit running in 20 seconds max provided you have Erlang ins=
talled.<div><br></div><div>There&#39;s is where the problem comes. So I&#39=
;m not criticizing RabbitMQ here. In my case I&#39;ve been using Erlang for=
 a few years already so I like to build it from source and so on, but some =
people don&#39;t. Actually some people just want to evaluate RabbitMQ and s=
ee if it&#39;s the right solution for them. If I can&#39;t get RabbitMQ run=
ning because something doesn&#39;t compile or whatever the reason, but then=
 I download MagickMQ and it works like a charm then I will just evaluate Ma=
gickMQ and discard RabbitMQ. It&#39;s sad but it&#39;s how it works most of=
 the time.=A0</div>
<div><br></div><div>I agree with you Matthew that you should learn how to c=
ompile Erlang, Haskell or whatever you use, but not everybody would agree w=
ith that. See for example the download numbers the Haskell guys are publish=
ing from time to time since they created the Haskell platform. Erlang solut=
ions even has their own page now where you can download a ready to use Erla=
ng distro.</div>
<div><br></div><div>So what I want to do is just to add one command to the =
make files that can generate those Erlang releases and put them in a tarbal=
l.</div><div><br></div><div>Alvaro<br><br><div class=3D"gmail_quote">On Fri=
, Apr 13, 2012 at 1:41 PM, Matthew Sackman <span dir=3D"ltr">&lt;<a href=3D=
"mailto:matthew at rabbitmq.com">matthew at rabbitmq.com</a>&gt;</span> wrote:<br=
>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im">On Fri, Apr 13, 2012 at 01=
:35:03PM +0200, Alvaro Videla wrote:<br>
&gt; Are you serious? I mean=85 if you want to disagree with me I&#39;m OK =
with that.<br>
&gt; But there&#39;s no need to come up with that kind of sarcasm.<br>
<br>
</div>Sorry, my apologies. Having a bad day. Didn&#39;t mean to take it out=
 on<br>
you.<br>
<br>
I agree the packaging issue is a problem, and there has been a lot done<br>
to improve this. I do genuinely think that right now, the cloud foundary<br=
>
approach may be a viable alternative if getting going quickly is the<br>
key.<br>
<div class=3D"HOEnZb"><div class=3D"h5"><br>
Matthew<br>
_______________________________________________<br>
rabbitmq-discuss mailing list<br>
<a href=3D"mailto:rabbitmq-discuss at lists.rabbitmq.com">rabbitmq-discuss at lis=
ts.rabbitmq.com</a><br>
<a href=3D"https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-dis=
cuss" target=3D"_blank">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo=
/rabbitmq-discuss</a><br>
</div></div></blockquote></div><br></div>

--20cf303bfae6ed128304bd8e25a5--

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.11.1335307957.2884.rabbitmq-discuss@lists.rabbitmq.com>

explicitly specified

--14dae93a122f5c3c9f04be749b1f
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi all,<br>I&#39;m investigating a case when in certain conditions .net cli=
ent can kill server for ~15minutes.<br>We have a specific firewall setup an=
d it can return an ascii string &quot;uou do not have access to this servic=
e&quot;. Details do not matter, but in such case .net client will just kill=
 the client box instantly. Even mouse wont move.<br>
<br>I&#39;ve investigated it and found that the problem is in RabbitMQ.Clie=
nt.Impl.Frams.cs:ReadFrom():<br>=A0=A0=A0=A0=A0=A0=A0=A0=A0=A0=A0 int paylo=
adSize =3D reader.ReadInt32(); // FIXME - throw exn on unreasonable value<b=
r>In case if client attempts to connect to a socket which returns non-ampq =
message, it will attempt to allocate an array, of generally speaking random=
 size.<br>
Ampq-0.9.1 spec (paragraph 4.2.3=A0 General Frame Format) says:<br>&gt; If =
a peer receives a frame with a type that is not one of these defined types,=
 it MUST treat this as a<br>fatal protocol error and close the connection w=
ithout sending any further data on it<br>
<br>But I can not understand the logic of the code in Frame.ReadFrom:<br><a=
 href=3D"http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/0d3c7b59412e/pr=
ojects/client/RabbitMQ.Client/src/client/impl/Frame.cs#l107">http://hg.rabb=
itmq.com/rabbitmq-dotnet-client/file/0d3c7b59412e/projects/client/RabbitMQ.=
Client/src/client/impl/Frame.cs#l107</a><br>
<pre> if (type =3D=3D &#39;A&#39;)</pre>The local variable name which recie=
ves the value is &quot;type&quot;, but it checks for &quot;AMQP&quot; which=
 should not be expected and it fail to check for type in 1-4 range which sh=
ould be expected according to the spec. And it will keep reading &quot;size=
&quot; and &quot;byte[size]&quot; even though they can be a garbage.<br>
Am I missing something?<br><br>Vadim.<br clear=3D"all"><br>-- <br>From RFC =
2631: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT is explicitly =
specified<br>

--14dae93a122f5c3c9f04be749b1f--

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.12.1335482892.2884.rabbitmq-discuss@lists.rabbitmq.com>

explicitly specified

--047d7b33d9bef7fea004be9d55ad
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div class=3D"gmail_extra">Hi Matthew,<br><br>Thanks for your reply. At lea=
st web UI reports that all 3 nodes are 2.8.1 so I guess they are=A0 up to d=
ate.<br>Reproducing this bug is difficult. I&#39;ll work on it for may be 2=
 more days, trying to find a combination which would be reproducible. Very =
preliminary, I have impression that &quot;exclusive&quot; queue flag have s=
omething to do with it, but I will experiment with ttl too, as you suggeste=
d. <br>
<br>I dont know if it is related, but I had a strange situation when there =
was an exclusive autodelete queue without a connection (connection reported=
 &quot;unknown&quot;) and it was impossible to delete it because &quot;reso=
urce lock&quot; error. <br>
Hopefully I&#39;ll be able to report more tomorrow.<br><br>Thanks,<br>Vadim=
.<br><br><div class=3D"gmail_quote">On Thu, Apr 26, 2012 at 3:31 PM, Matthe=
w Sackman <span dir=3D"ltr">&lt;<a href=3D"mailto:matthew at rabbitmq.com" tar=
get=3D"_blank">matthew at rabbitmq.com</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">Hi Vadim,<br>
<div class=3D"im"><br>
On Thu, Apr 26, 2012 at 01:01:20PM -0700, Vadim Chekan wrote:<br>
&gt; I&#39;m testing my active-active setup (2.8.1, linux 64) and I am rand=
omly<br>
&gt; running into some crashes when I&#39;m stopping a node. I can stop one=
 node<br>
&gt; abut another one fails along with it. Below is a crash log.<br>
&gt;<br>
</div><div class=3D"im">&gt; =3DERROR REPORT=3D=3D=3D=3D 26-Apr-2012::12:15=
:59 =3D=3D=3D<br>
&gt; Discarding message<br>
&gt; {&#39;$gen_call&#39;,{&lt;0.1955.0&gt;,#Ref&lt;0.0.0.5513&gt;},{add_on=
_right,{9,&lt;0.1955.0&gt;}}}<br>
&gt; from &lt;0.1955.0&gt; to &lt;0.26823.834&gt;<br>
&gt; =A0in an old incarnation (2) of this node (3)<br>
<br>
</div>I&#39;m worried about these messages. Someone else on this list has s=
een<br>
this sort of thing too and it&#39;s causing them trouble. I&#39;ve not seen=
 this<br>
issue myself in testing which is frustrating. However, that&#39;s not the<b=
r>
cause of your crash in this case (I think).<br>
<div class=3D"im"><br>
&gt; ** Generic server &lt;0.1800.0&gt; terminating<br>
&gt; ** Last message in was {&#39;$gen_cast&#39;,{gm_deaths,[&lt;0.4684.0&g=
t;]}}<br>
&gt; ** When Server state =3D=3D {state,<br>
&gt; =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 {amqqueue,<br>
&gt; =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 {resou=
rce,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,&lt;&lt;&quot;test_29&quot;&gt;&gt;=
},<br>
&gt; =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 true,f=
alse,&lt;0.1433.0&gt;,<br>
&gt; =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 [{&lt;=
&lt;&quot;x-ha-policy&quot;&gt;&gt;,longstr,&lt;&lt;&quot;all&quot;&gt;&gt;=
},<br>
&gt; =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0{&l=
t;&lt;&quot;x-message-ttl&quot;&gt;&gt;,signedint,600000}],<br>
&gt; =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 &lt;0.=
1799.0&gt;,[],all},<br>
&gt; =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 &lt;0.1801.0&g=
t;,<br>
&gt; =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 {dict,0,16,16,=
8,80,48,<br>
&gt;<br>
&gt; {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],<br>
&gt; =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0[]}=
,<br>
&gt; =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 {{[],[=
],[],[],[],[],[],[],[],[],[],[],[],[],<br>
&gt; =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 []=
,[]}}},<br>
&gt; =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 #Fun&lt;rabbit=
_mirror_queue_master.1.2951048&gt;,<br>
&gt; =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 #Fun&lt;rabbit=
_mirror_queue_master.2.72654940&gt;}<br>
&gt; ** Reason for termination =3D=3D<br>
&gt; ** {{case_clause,{ok,&lt;3066.9234.0&gt;,[&lt;0.4683.0&gt;]}},<br>
&gt; =A0 =A0 [{rabbit_mirror_queue_coordinator,handle_cast,2},<br>
&gt; =A0 =A0 =A0{gen_server2,handle_msg,2},<br>
&gt; =A0 =A0 =A0{proc_lib,wake_up,3}]}<br>
<br>
</div>Well this is very odd. We fixed a bug that looked like this, but it g=
ot<br>
fixed in 2.7.1 (and related to x-ha-policy =3D nodes. Could you just check<=
br>
that you really are running 2.8.1? We&#39;re not aware of any bug in this<b=
r>
area in 2.8.1, but that&#39;s certainly not saying there&#39;s not one ther=
e! Is<br>
there any particular sequence of events that you can perform that<br>
reliably triggers this crash? Could you also check the logs of the other<br=
>
nodes (both .log and -sasl.log) to see if there&#39;s further crash reports=
<br>
in there?<br>
<br>
Also, there have been discovered lots of bugs relating to the code<br>
changes made to add DLX support in 2.8.1, especially in relation to HA.<br>
It&#39;s possible one of the issues I found with TTL and HA is causing this=
.<br>
2.8.2 should be out soonish which might introduce fewer new bugs than it<br=
>
fixes, but in the mean time, could you try without the TTL and see if<br>
that helps?<br>
<br>
Matthew<br>
_______________________________________________<br>
rabbitmq-discuss mailing list<br>
<a href=3D"mailto:rabbitmq-discuss at lists.rabbitmq.com">rabbitmq-discuss at lis=
ts.rabbitmq.com</a><br>
<a href=3D"https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-dis=
cuss" target=3D"_blank">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo=
/rabbitmq-discuss</a><br>
</blockquote></div><br><br clear=3D"all"><br>-- <br>From RFC 2631: In ASN.1=
, EXPLICIT tagging is implicit unless IMPLICIT is explicitly specified<br>
</div>

--047d7b33d9bef7fea004be9d55ad--

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.13.1335534323.2884.rabbitmq-discuss@lists.rabbitmq.com>

escaping algorithm for both names and values.

 > If the broker (or anyone else) stipulates they need a header value, they
 > define how it is encoded.

Then how do you write client code that works with multiple broker flavors?
You have to understand these peculiarities and bloat your code with "if"s.

Specifications make life easier by defining a common ground where all
parties can interact painlessly.

 > I repeat: there is no conceivable advantage in this rule, and it makes
 > life harder for brokers and clients.

Feel free to air your concerns on the stomp-spec mailing list. I think
we all agree that there is room for improvement and that STOMP 1.1 is
not the last version of the STOMP spec.

Cheers,

Lionel

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.14.1335804254.2884.rabbitmq-discuss@lists.rabbitmq.com>

explicitly specified

--047d7b15ab85e34dc204bee8284e
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Thanks for looking into it Matthias,<br><br>&quot;rabbitmq-dev&quot;: yes, =
it is load balancer.<br>Disconnects: I was too lazy to write code for it an=
d just restarted client manually.<br>I did make a short try to reproduce fa=
ilure without any load but it worked just fine. I&#39;ll try more today.<br=
>
<br>Vadim.<br><br><div class=3D"gmail_quote">On Sat, Apr 28, 2012 at 12:13 =
AM, Matthias Radestock <span dir=3D"ltr">&lt;<a href=3D"mailto:matthias at rab=
bitmq.com" target=3D"_blank">matthias at rabbitmq.com</a>&gt;</span> wrote:<br=
><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1=
px #ccc solid;padding-left:1ex">
Vadim,<br>
<br>
(putting the list back on cc)<div class=3D"im"><br>
<br>
On 27/04/12 23:28, Vadim Chekan wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
I&#39;ve spent some time today playing with different client settings. Seem=
s<br>
ttl does not affect failures at all.<br>
</blockquote>
<br></div>
That&#39;s good to know. The more factors we can eliminate as possible caus=
es the better.<div class=3D"im"><br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
I managed to reproduce crash many times today. Basic idea is: an<br>
application, 40 threads create a pub/sub exchange and publish a message<br>
every second. Under this load I bring the master node (all queues are<br>
usually created on the same node) and often it causes another node to<br>
fail. Here is my load simulator (in c#):<br>
<a href=3D"http://www.heypasteit.com/clip/0B5W" target=3D"_blank">http://ww=
w.heypasteit.com/<u></u>clip/0B5W</a><br>
</blockquote>
<br></div>
That code connects to &quot;rabbitmq-dev&quot;. Is that a load balancer sit=
ting in front of the three nodes?<br>
<br>
How do you deal with the disconnects resulting from the shutting down of no=
des? There doesn&#39;t seem to be any code to handle that.<br>
<br>
Mind you, I suspect that the failure should still be reproducible without a=
ny subscriptions and publishes. Would be good to try that and just watch th=
e broker logs for errors.<div class=3D"im"><br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
As long as maillist does not allow zip attaches, I&#39;m mailing to you guy=
s<br>
directly<br>
</blockquote>
<br></div>
Thanks for posting these. There is an error in the logs that we haven&#39;t=
 seen before:<br>
<br>
 =A0 =A0 =A0 =A0 =A0 {{badmatch,[]},<br>
 =A0 =A0 =A0 =A0 =A0 =A0[{rabbit_mirror_queue_misc,&#39;-<u></u>remove_from=
_queue/2-fun-0-&#39;,2}<u></u>,<br>
 =A0 =A0 =A0 =A0 =A0 =A0 {mnesia_tm,apply_fun,3},<br>
 =A0 =A0 =A0 =A0 =A0 =A0 {mnesia_tm,execute_<u></u>transaction,5},<br>
 =A0 =A0 =A0 =A0 =A0 =A0 {rabbit_misc,&#39;-execute_mnesia_<u></u>transacti=
on/1-fun-0-&#39;,1},<br>
 =A0 =A0 =A0 =A0 =A0 =A0 {worker_pool_worker,handle_<u></u>call,3},<br>
 =A0 =A0 =A0 =A0 =A0 =A0 {gen_server2,handle_msg,2},<br>
 =A0 =A0 =A0 =A0 =A0 =A0 {proc_lib,wake_up,3}]}<br>
<br>
Looking at the code, this appears to indicate that there are no master/mirr=
or processes left for the queue. Which is...unexpected. That should give us=
 something to go on.<br>
<br>
Regards,<br>
<br>
Matthias.<br>
</blockquote></div><br><br clear=3D"all"><br>-- <br>From RFC 2631: In ASN.1=
, EXPLICIT tagging is implicit unless IMPLICIT is explicitly specified<br>

--047d7b15ab85e34dc204bee8284e--

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.15.1335986696.2884.rabbitmq-discuss@lists.rabbitmq.com>

with the Server Certificate ("ecertfile" reference), but how would I debug
this further to try and diagnose the cause?

 

See below for the 2 logs that are generated:

 

server.log >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

 

=INFO REPORT==== 2-May-2012::15:02:34 ===

accepting AMQP connection <0.1437.0> (10.238.194.182:63860 ->
10.6.68.60:5671)

 

=ERROR REPORT==== 2-May-2012::15:02:36 ===

SSL: 1074:
error:[<<48,130,3,72,48,130,2,48,160,3,2,1,2,2,17,0,236,148,73,61,

 
234,255,249,79,156,2,245,72,245,155,177,150,48,13,6,9,42,

 
134,72,134,247,13,1,1,5,5,0,48,82,49,80,48,78,6,3,85,4,5,

** Snip (lots of numbers inserted here) **

                    149,145,5,154,244,95,165,237,248,248,24,169,134,248,206,

                    209,123,138,28,179,152,110,87,9,193,181,165,253>>]
C:\testdir\certs.crt

  [{ssl_connection,init_certificates,6,

                   [{file,"ssl_connection.erl"},{line,1070}]},

   {ssl_connection,ssl_init,2,[{file,"ssl_connection.erl"},{line,1025}]},

   {ssl_connection,init,1,[{file,"ssl_connection.erl"},{line,305}]},

   {gen_fsm,init_it,6,[{file,"gen_fsm.erl"},{line,343}]},

   {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]

 

 

=ERROR REPORT==== 2-May-2012::15:02:36 ===

error on AMQP connection <0.1437.0>: {ssl_upgrade_error,ecertfile}

 

<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< 

 

sasl.log >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

 

=CRASH REPORT==== 2-May-2012::15:02:36 ===

  crasher:

    initial call: ssl_connection:init/1

    pid: <0.1438.0>

    registered_name: []

    exception exit: ecertfile

      in function  gen_fsm:init_it/6 (gen_fsm.erl, line 353)

    ancestors: [ssl_connection_sup,ssl_sup,<0.220.0>]

    messages: []

    links: [<0.223.0>]

    dictionary: [{ssl_manager,ssl_manager}]

    trap_exit: false

    status: running

    heap_size: 46368

    stack_size: 24

    reductions: 34417

  neighbours:

 

=SUPERVISOR REPORT==== 2-May-2012::15:02:36 ===

     Supervisor: {local,ssl_connection_sup}

     Context:    child_terminated

     Reason:     ecertfile

     Offender:   [{pid,<0.1438.0>},

                  {name,undefined},

                  {mfargs,{ssl_connection,start_link,undefined}},

                  {restart_type,temporary},

                  {shutdown,4000},

                  {child_type,worker}]

 

<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< 

 


------=_NextPart_001_041C_01CD2877.9DB2EA60
Content-Type: text/html;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

<html xmlns:v=3D"urn:schemas-microsoft-com:vml" =
xmlns:o=3D"urn:schemas-microsoft-com:office:office" =
xmlns:w=3D"urn:schemas-microsoft-com:office:word" =
xmlns:x=3D"urn:schemas-microsoft-com:office:excel" =
xmlns:p=3D"urn:schemas-microsoft-com:office:powerpoint" =
xmlns:a=3D"urn:schemas-microsoft-com:office:access" =
xmlns:dt=3D"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" =
xmlns:s=3D"uuid:BDC6E3F0-6DA3-11d1-A2A3-00AA00C14882" =
xmlns:rs=3D"urn:schemas-microsoft-com:rowset" xmlns:z=3D"#RowsetSchema" =
xmlns:b=3D"urn:schemas-microsoft-com:office:publisher" =
xmlns:ss=3D"urn:schemas-microsoft-com:office:spreadsheet" =
xmlns:c=3D"urn:schemas-microsoft-com:office:component:spreadsheet" =
xmlns:odc=3D"urn:schemas-microsoft-com:office:odc" =
xmlns:oa=3D"urn:schemas-microsoft-com:office:activation" =
xmlns:html=3D"http://www.w3.org/TR/REC-html40" =
xmlns:q=3D"http://schemas.xmlsoap.org/soap/envelope/" =
xmlns:rtc=3D"http://microsoft.com/officenet/conferencing" =
xmlns:D=3D"DAV:" xmlns:Repl=3D"http://schemas.microsoft.com/repl/" =
xmlns:mt=3D"http://schemas.microsoft.com/sharepoint/soap/meetings/" =
xmlns:x2=3D"http://schemas.microsoft.com/office/excel/2003/xml" =
xmlns:ppda=3D"http://www.passport.com/NameSpace.xsd" =
xmlns:ois=3D"http://schemas.microsoft.com/sharepoint/soap/ois/" =
xmlns:dir=3D"http://schemas.microsoft.com/sharepoint/soap/directory/" =
xmlns:ds=3D"http://www.w3.org/2000/09/xmldsig#" =
xmlns:dsp=3D"http://schemas.microsoft.com/sharepoint/dsp" =
xmlns:udc=3D"http://schemas.microsoft.com/data/udc" =
xmlns:xsd=3D"http://www.w3.org/2001/XMLSchema" =
xmlns:sub=3D"http://schemas.microsoft.com/sharepoint/soap/2002/1/alerts/"=
 xmlns:ec=3D"http://www.w3.org/2001/04/xmlenc#" =
xmlns:sp=3D"http://schemas.microsoft.com/sharepoint/" =
xmlns:sps=3D"http://schemas.microsoft.com/sharepoint/soap/" =
xmlns:xsi=3D"http://www.w3.org/2001/XMLSchema-instance" =
xmlns:udcs=3D"http://schemas.microsoft.com/data/udc/soap" =
xmlns:udcxf=3D"http://schemas.microsoft.com/data/udc/xmlfile" =
xmlns:udcp2p=3D"http://schemas.microsoft.com/data/udc/parttopart" =
xmlns:wf=3D"http://schemas.microsoft.com/sharepoint/soap/workflow/" =
xmlns:dsss=3D"http://schemas.microsoft.com/office/2006/digsig-setup" =
xmlns:dssi=3D"http://schemas.microsoft.com/office/2006/digsig" =
xmlns:mdssi=3D"http://schemas.openxmlformats.org/package/2006/digital-sig=
nature" =
xmlns:mver=3D"http://schemas.openxmlformats.org/markup-compatibility/2006=
" xmlns:m=3D"http://schemas.microsoft.com/office/2004/12/omml" =
xmlns:mrels=3D"http://schemas.openxmlformats.org/package/2006/relationshi=
ps" xmlns:spwp=3D"http://microsoft.com/sharepoint/webpartpages" =
xmlns:ex12t=3D"http://schemas.microsoft.com/exchange/services/2006/types"=
 =
xmlns:ex12m=3D"http://schemas.microsoft.com/exchange/services/2006/messag=
es" =
xmlns:pptsl=3D"http://schemas.microsoft.com/sharepoint/soap/SlideLibrary/=
" =
xmlns:spsl=3D"http://microsoft.com/webservices/SharePointPortalServer/Pub=
lishedLinksService" xmlns:Z=3D"urn:schemas-microsoft-com:" =
xmlns:st=3D"&#1;" xmlns=3D"http://www.w3.org/TR/REC-html40"><head><meta =
http-equiv=3DContent-Type content=3D"text/html; =
charset=3Dus-ascii"><meta name=3DGenerator content=3D"Microsoft Word 12 =
(filtered medium)"><style><!--
/* Font Definitions */
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
span.EmailStyle17
	{mso-style-type:personal-compose;
	font-family:"Calibri","sans-serif";
	color:windowtext;}
.MsoChpDefault
	{mso-style-type:export-only;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
--></style><!--[if gte mso 9]><xml>
<o:shapedefaults v:ext=3D"edit" spidmax=3D"1026" />
</xml><![endif]--><!--[if gte mso 9]><xml>
<o:shapelayout v:ext=3D"edit">
<o:idmap v:ext=3D"edit" data=3D"1" />
</o:shapelayout></xml><![endif]--></head><body lang=3DEN-US link=3Dblue =
vlink=3Dpurple><div class=3DWordSection1><p class=3DMsoNormal>Can anyone =
help me understand what is happening when I try to enable SSL using =
Non-OpenSSL certificates?&nbsp; The certificates being used are working =
as SSL Server certificates with Apache 2.2.22, but when I use them with =
RabbitMQ, it is failing.&nbsp; Also, if I generate OpenSSL certificates =
to test with, the same setup works (same config file, server, =
etc).<o:p></o:p></p><p class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>From the online docs, it definitely looks like Erlang =
is having problems with the Server Certificate (&#8220;ecertfile&#8221; =
reference), but how would I debug this further to try and diagnose the =
cause?<o:p></o:p></p><p class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>See below for the 2 logs that are =
generated:<o:p></o:p></p><p class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>server.log =
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&=
gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&g=
t;&gt;&gt;<o:p></o:p></p><p class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>=3DINFO REPORT=3D=3D=3D=3D 2-May-2012::15:02:34 =
=3D=3D=3D<o:p></o:p></p><p class=3DMsoNormal>accepting AMQP connection =
&lt;0.1437.0&gt; (10.238.194.182:63860 -&gt; =
10.6.68.60:5671)<o:p></o:p></p><p =
class=3DMsoNormal><o:p>&nbsp;</o:p></p><p class=3DMsoNormal>=3DERROR =
REPORT=3D=3D=3D=3D 2-May-2012::15:02:36 =3D=3D=3D<o:p></o:p></p><p =
class=3DMsoNormal>SSL: 1074: =
error:[&lt;&lt;48,130,3,72,48,130,2,48,160,3,2,1,2,2,17,0,236,148,73,61,<=
o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
234,255,249,79,156,2,245,72,245,155,177,150,48,13,6,9,42,<o:p></o:p></p><=
p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
134,72,134,247,13,1,1,5,5,0,48,82,49,80,48,78,6,3,85,4,5,<o:p></o:p></p><=
p class=3DMsoNormal>** Snip (lots of numbers inserted here) =
**<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
149,145,5,154,244,95,165,237,248,248,24,169,134,248,206,<o:p></o:p></p><p=
 =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
209,123,138,28,179,152,110,87,9,193,181,165,253&gt;&gt;] =
C:\testdir\certs.crt<o:p></o:p></p><p class=3DMsoNormal>&nbsp; =
[{ssl_connection,init_certificates,6,<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
[{file,&quot;ssl_connection.erl&quot;},{line,1070}]},<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp; =
{ssl_connection,ssl_init,2,[{file,&quot;ssl_connection.erl&quot;},{line,1=
025}]},<o:p></o:p></p><p class=3DMsoNormal>&nbsp;&nbsp; =
{ssl_connection,init,1,[{file,&quot;ssl_connection.erl&quot;},{line,305}]=
},<o:p></o:p></p><p class=3DMsoNormal>&nbsp;&nbsp; =
{gen_fsm,init_it,6,[{file,&quot;gen_fsm.erl&quot;},{line,343}]},<o:p></o:=
p></p><p class=3DMsoNormal>&nbsp;&nbsp; =
{proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}=
]<o:p></o:p></p><p class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal><o:p>&nbsp;</o:p></p><p class=3DMsoNormal>=3DERROR =
REPORT=3D=3D=3D=3D 2-May-2012::15:02:36 =3D=3D=3D<o:p></o:p></p><p =
class=3DMsoNormal>error on AMQP connection &lt;0.1437.0&gt;: =
{ssl_upgrade_error,ecertfile}<o:p></o:p></p><p =
class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt=
;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;=
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<o:p>&nbs=
p;</o:p></p><p class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>sasl.log =
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&=
gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&g=
t;&gt;&gt;<o:p></o:p></p><p class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>=3DCRASH REPORT=3D=3D=3D=3D 2-May-2012::15:02:36 =
=3D=3D=3D<o:p></o:p></p><p class=3DMsoNormal>&nbsp; =
crasher:<o:p></o:p></p><p class=3DMsoNormal>&nbsp;&nbsp;&nbsp; initial =
call: ssl_connection:init/1<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; pid: =
&lt;0.1438.0&gt;<o:p></o:p></p><p class=3DMsoNormal>&nbsp;&nbsp;&nbsp; =
registered_name: []<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; exception exit: =
ecertfile<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in function&nbsp; =
gen_fsm:init_it/6 (gen_fsm.erl, line 353)<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; ancestors: =
[ssl_connection_sup,ssl_sup,&lt;0.220.0&gt;]<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; messages: []<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; links: =
[&lt;0.223.0&gt;]<o:p></o:p></p><p class=3DMsoNormal>&nbsp;&nbsp;&nbsp; =
dictionary: [{ssl_manager,ssl_manager}]<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; trap_exit: false<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; status: running<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; heap_size: 46368<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; stack_size: 24<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; reductions: 34417<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp; neighbours:<o:p></o:p></p><p =
class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>=3DSUPERVISOR REPORT=3D=3D=3D=3D 2-May-2012::15:02:36 =
=3D=3D=3D<o:p></o:p></p><p class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp; =
Supervisor: {local,ssl_connection_sup}<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp; Context:&nbsp;&nbsp;&nbsp; =
child_terminated<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp; =
Reason:&nbsp;&nbsp;&nbsp;&nbsp; ecertfile<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp; Offender:&nbsp;&nbsp; =
[{pid,&lt;0.1438.0&gt;},<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
{name,undefined},<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
{mfargs,{ssl_connection,start_link,undefined}},<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
{restart_type,temporary},<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
{shutdown,4000},<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
{child_type,worker}]<o:p></o:p></p><p =
class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt=
;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;=
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<o:p>&nbs=
p;</o:p></p><p =
class=3DMsoNormal><o:p>&nbsp;</o:p></p></div></body></html>
------=_NextPart_001_041C_01CD2877.9DB2EA60--

------=_NextPart_000_041B_01CD2877.9DB2EA60
Content-Type: application/x-pkcs7-signature; name="smime.p7s"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="smime.p7s"

MIAGCSqGSIb3DQEHAqCAMIACAQExCzAJBgUrDgMCGgUAMIAGCSqGSIb3DQEHAQAAoIIYozCCA2Ew
ggJJoAMCAQICEAoBAQEAAAJ8AAAACgAAAAIwDQYJKoZIhvcNAQEFBQAwOjEZMBcGA1UEChMQUlNB
IFNlY3VyaXR5IEluYzEdMBsGA1UECxMUUlNBIFNlY3VyaXR5IDIwNDggVjMwHhcNMDEwMjIyMjAz
OTIzWhcNMjYwMjIyMjAzOTIzWjA6MRkwFwYDVQQKExBSU0EgU2VjdXJpdHkgSW5jMR0wGwYDVQQL
ExRSU0EgU2VjdXJpdHkgMjA0OCBWMzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALeP
VXHSgN17aXmn8BhQMjxiZ/YKlQfd5hvzntnSQVRrrZ98vhnN+0arQWgeGOpVyC+ReIko+ycpYP/f
j4w7yUmbtaSUzgHqPrVje38m/RndwCG9hNEtT0bDTtzYNzk7KK/LnRrqK68hpcEjIri4G1oTh1eD
0fAg5+hPI0KwAKV9ienpYXOUmHEmvC1q4PdN8PG2KjgxgQ0p4QDBUQ9MUvgEWqp9ctO4hyq7YxAD
KrOhTw1aXka3PQ71dOyZn/k9JIGIpt1gVOiVNj3GCZOaoxKAAFWZGUe90KV8w7r7H/f1D/isubX0
N5gTGN6FW7cMgjuHb5U5WDDabgFoFyLMwAsCAwEAAaNjMGEwDwYDVR0TAQH/BAUwAwEB/zAOBgNV
HQ8BAf8EBAMCAQYwHwYDVR0jBBgwFoAUB8NRMKSq6UWuNST6/yQsM9CxnYwwHQYDVR0OBBYEFAfD
UTCkqulFrjUk+v8kLDPQsZ2MMA0GCSqGSIb3DQEBBQUAA4IBAQBfPoZ2brg1PE42HB55mL/91RIR
eVIO7jGJvN1/+dHGFSHoigFUDTr7VLnWY9SxqpZNokJN1FMfixDef2W+YBMncYikc+OEY9GkVeFQ
k+YbDnnQZ7xGyL8/Fw2V5saQad7ntC/elX3QEj89Pn9NPxRo9RFQ1cH0kKUIHTFg/2CMI1QKr/6h
bsXReipoeM8eggogtB+t5YWyamh1Tq0lN5SFvr2h1Oq3DEs8negSAPBfrA3hrHBjc/d/eZ8yJUJ0
BYAov73BJJZYFbEXIemJS9sHiGf0Fa1wPi9NhTvCt9v+mGgjieF0D970xYRjKRvMywfJAKSp18Ii
T2fXd+wgBWHeMIIEzDCCA7SgAwIBAgIQfwkpTisxI69dQcDR3n6N2TANBgkqhkiG9w0BAQUFADA6
MRkwFwYDVQQKExBSU0EgU2VjdXJpdHkgSW5jMR0wGwYDVQQLExRSU0EgU2VjdXJpdHkgMjA0OCBW
MzAeFw0xMTAzMDMyMDUyMTVaFw0xOTA0MDExNDQ1MzlaMIGXMQswCQYDVQQGEwJVUzEWMBQGA1UE
CBMNTWFzc2FjaHVzZXR0czEQMA4GA1UEBxMHQmVkZm9yZDEZMBcGA1UEChMQUlNBIFNlY3VyaXR5
IExMQzElMCMGA1UECxMcR2xvYmFsIFNlY3VyaXR5IE9yZ2FuaXphdGlvbjEcMBoGA1UEAxMTUlNB
IENvcnBvcmF0ZSBDQSB2MjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALaLCcEh7lhj
dqYo6ryZ8oHK4kJRmQuxfwMa/3PE1Vd4U7U5x15UuSX+qd78hnEdR6yGGxhmY8U2SDG31u+yJD9o
OpXFQm6/A4xzItwfcs6SD3Gt6nI/Oa6M0M/7MjPqSc1aUUm2NFiyb6DjotYLDzeAVCqF+4V/Dgc2
QdO1FZeFUCcb5lMqkVAr+O3uAEZEmtD3Cr06YavA38fxeWCiPoheUuWuAQcvOdEnSzJFm6GM8yBJ
l9J1cAibE6c4DCl+eHj4M+O/ON2fFVb/lQdS4xO7cSZ9fKGCI7kWr0/7ssSjPsIIGpg0hLRZ35aZ
fCK1fFLi9VKvIcTYTrA8Gf9bIGsCAwEAAaOCAW4wggFqMB8GA1UdIwQYMBaAFAfDUTCkqulFrjUk
+v8kLDPQsZ2MMBIGA1UdEwEB/wQIMAYBAf8CAQMwcAYDVR0fBGkwZzBloGOgYYZfaHR0cDovL3d3
dy5yc2FzZWN1cml0eS5jb20vcHJvZHVjdHMva2Vvbi9yZXBvc2l0b3J5L2NlcnRpZmljYXRlX3N0
YXR1cy9SU0FfU2VjdXJpdHlfMjA0OF92My5DUkwwHQYDVR0OBBYEFHMbOEsly1qOvQLs310p9hB0
DtiYMIGRBgNVHSAEgYkwgYYwgYMGCSqGSIb3DQUGATB2MC4GCCsGAQUFBwIBFiJodHRwOi8vY2Eu
cnNhc2VjdXJpdHkuY29tL0NQUy5odG1sMEQGCCsGAQUFBwICMDgwFxYQUlNBIFNlY3VyaXR5IExM
QzADAgEBGh1DUFMgSW5jb3Jwb3JhdGVkIGJ5IHJlZmVyZW5jZTAOBgNVHQ8BAf8EBAMCAYYwDQYJ
KoZIhvcNAQEFBQADggEBAHGIVCAjCZ+z2vRElolRsLsz4L/js0Zm019rr/+eFks5VnSf5T0HJj7Z
tzjtna/+O5b01L8L6Fz64Yui+h/cnxvDwQrhzajbiMiN/JFH+kNOUJ9LcInBkmu45d98h+EQw3Yz
XwfnHYaXLArfgeY3CP8AYi0pxXEXf0bH8Prl+P0n4SOUqxh6J0GIz/haW1+usvMscB7lCpJ2loo9
+TmRn3WQrokgr1ILm/3apel6ydpkoFUxEoP5a1806Z7SD9KljN+Vc9o521VkMtnzLlDEkn05by/p
QNdlidY7eV7xcpCvuI6qFzyfHdI3G0/Vao0L0os6lEwb5PSa1IysLlHT0uUwggT+MIID5qADAgEC
AhBiTV1a7zr4E+gcgJ4lG6TBMA0GCSqGSIb3DQEBBQUAMIGXMQswCQYDVQQGEwJVUzEWMBQGA1UE
CBMNTWFzc2FjaHVzZXR0czEQMA4GA1UEBxMHQmVkZm9yZDEZMBcGA1UEChMQUlNBIFNlY3VyaXR5
IExMQzElMCMGA1UECxMcR2xvYmFsIFNlY3VyaXR5IE9yZ2FuaXphdGlvbjEcMBoGA1UEAxMTUlNB
IENvcnBvcmF0ZSBDQSB2MjAeFw0xMTAzMTAyMjQwMDRaFw0xOTAyMjgyMTU2MzNaMIGeMQswCQYD
VQQGEwJVUzEWMBQGA1UECBMNTWFzc2FjaHVzZXR0czEQMA4GA1UEBxMHQmVkZm9yZDEZMBcGA1UE
ChMQUlNBIFNlY3VyaXR5IExMQzElMCMGA1UECxMcR2xvYmFsIFNlY3VyaXR5IE9yZ2FuaXphdGlv
bjEjMCEGA1UEAxMaUlNBIENsYXNzIDIgUGVyc29uYWwgQ0EgdjIwggEiMA0GCSqGSIb3DQEBAQUA
A4IBDwAwggEKAoIBAQDNEVsNPFZOP83bMzCpUDGnf/5IDIQvVRhDHkyrkbv5X1ih4xdTsSdzTDrj
LUxIzC7nJswCv+jBaWWm1YoqzBXqQl2/Hl6T5Bt3HBT302GSYamtKcCWve25DoJav+dJd9U/XkCq
SSNN7DNVXkJrKC7Zq7OS6/O308pZNkCRJJfMRrodgSx1NoQYZJCfufTOshslVSVhj3Ar274qmuf8
iqM0RR5OMpm7t2dtHzvYJPHR3+HwfQ+s64YBC7NBrBLOYMeq8tzkPKzyITXhwopgbM6gbp+Z8qX5
/lo4Y3OEm7ED51iDqdruRoRnfTQGKdZJT7IYGLH+x0roRKmYKP/2HRNpAgMBAAGjggE7MIIBNzAP
BgNVHRMECDAGAQH/AgECMIGRBgNVHSAEgYkwgYYwgYMGCSqGSIb3DQUHAjB2MC4GCCsGAQUFBwIB
FiJodHRwOi8vY2EucnNhc2VjdXJpdHkuY29tL0NQUy5odG1sMEQGCCsGAQUFBwICMDgwFxYQUlNB
IFNlY3VyaXR5IExMQzADAgEBGh1DUFMgSW5jb3Jwb3JhdGVkIGJ5IHJlZmVyZW5jZTBABgNVHR8E
OTA3MDWgM6Axhi9odHRwOi8vY3JsLnJzYXNlY3VyaXR5LmNvbS9SU0FDb3Jwb3JhdGVDQXYyLmNy
bDAOBgNVHQ8BAf8EBAMCAYYwHQYDVR0OBBYEFBQw62v19Em1aFJ1ptu9rlvIrH1MMB8GA1UdIwQY
MBaAFHMbOEsly1qOvQLs310p9hB0DtiYMA0GCSqGSIb3DQEBBQUAA4IBAQCPepLT4buLa9p5VwF1
OW2YUwliCqxecs0CxRGJVR4cwvOuMeXxutP+m51n3vzseGkM0d1fmA9JTz8X+5LFdRD12Iw124oj
79QA7NKhO/xoPgbo0QxgnvHS15o94BPvFiZE6QGUjkHs9/hDvU+eIx7OG+Kzxt47vZZef+fJF0+s
ZgEDIMXXPXAtJW3xg/JhPrl4z0L7gmjgO+KxV0cyxaDrk6SEW5zZCqAcLehnW7MH8vvlzMsQ6pVr
f1g8xMCJonyxow9AwXGyQ0z1866qbJ8t+nQC/sGx3msJVHQg1JyjOWF4PMm8DdeUt+qUrSFRLY4J
MroY51gM90nnhtijtleCMIIFqjCCBJKgAwIBAgIRANloLV/aFM+Q1GlMqdzTb70wDQYJKoZIhvcN
AQEFBQAwgZ4xCzAJBgNVBAYTAlVTMRYwFAYDVQQIEw1NYXNzYWNodXNldHRzMRAwDgYDVQQHEwdC
ZWRmb3JkMRkwFwYDVQQKExBSU0EgU2VjdXJpdHkgTExDMSUwIwYDVQQLExxHbG9iYWwgU2VjdXJp
dHkgT3JnYW5pemF0aW9uMSMwIQYDVQQDExpSU0EgQ2xhc3MgMiBQZXJzb25hbCBDQSB2MjAeFw0x
MjAyMTQxNTMxNDBaFw0xNDAyMTQxNTMxNDBaMIHfMRMwEQYKCZImiZPyLGQBGRYDY29tMRMwEQYK
CZImiZPyLGQBGRYDZW1jMRgwFgYDVQQKEw9FTUMgQ29ycG9yYXRpb24xDDAKBgNVBAsTA1JTQTER
MA8GA1UECxMIQW1lcmljYXMxFDASBgNVBAsTC0VuZ2luZWVyaW5nMQ8wDQYDVQQFEwYxMDcyMDkx
FzAVBgoJkiaJk/IsZAEBEwdwb29sZWoyMRQwEgYDVQQDEwtKYW1lcyBQb29sZTEiMCAGCSqGSIb3
DQEJARYTamFtZXMucG9vbGVAcnNhLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB
ALTeqoL+Hxiw0+ina1/uVw1L24NTxmGqovLzY0pPD6PxwA+Ubi30LYUinSg0MrE7sEGuTQNWKc04
b/iZHUk+C6CrOeqtbwex9p8Ep4Mp4hEudQi/wWgBAOKw8kR7q7PJnFl4k8FBZuU75wztCBbArFcx
2wx0e8+BHVf7d5qb34TQV+ypiSEulCDEnlQwD3niXq+Brktidn5pH1i56dsUPX8ZOYvNS3SABHOW
X7n2/tmslm6ZbGT1jL81tsvOT7bQy6d4eT3v96Z/yPFhY1qnnn2TZs+e7TV97Z2fM9xBmN/VLtqu
1rw8eeN2f3gUwZc05rLILMU9YO7MnvBcyqC/BIsCAwEAAaOCAZ4wggGaMB8GA1UdIwQYMBaAFBQw
62v19Em1aFJ1ptu9rlvIrH1MMIGRBgNVHSAEgYkwgYYwgYMGCSqGSIb3DQUHBTB2MC4GCCsGAQUF
BwIBFiJodHRwOi8vY2EucnNhc2VjdXJpdHkuY29tL0NQUy5odG1sMEQGCCsGAQUFBwICMDgwFxYQ
UlNBIFNlY3VyaXR5IExMQzADAgEBGh1DUFMgSW5jb3Jwb3JhdGVkIGJ5IHJlZmVyZW5jZTApBgNV
HSUEIjAgBgorBgEEAYI3FAICBggrBgEFBQcDAgYIKwYBBQUHAwQwPwYDVR0RBDgwNoETamFtZXMu
cG9vbGVAcnNhLmNvbaAfBgorBgEEAYI3FAIDoBEMD3Bvb2xlajJAZW1jLmNvbTAOBgNVHQ8BAf8E
BAMCB4AwSAYDVR0fBEEwPzA9oDugOYY3aHR0cDovL2NybC5yc2FzZWN1cml0eS5jb206ODAvUlNB
Q2xhc3MyUGVyc29uYWxDQXYyLmNybDAdBgNVHQ4EFgQU23MkxGkgZNJhdX+WQxATw0HWQlAwDQYJ
KoZIhvcNAQEFBQADggEBACy9/o9dXkAB9DguuVnHJjkQUtg/RnIjNXoqHJEjehTeCLHr1jxwAnOK
EZ63xZEEeLkfd8zqWCFeZuNnjr2EoGyHGt7033lib4D8Fk1PPAaaljB8hsin4IKXrr+bbqpLydlp
eE1IxXym7vwehwYDfQePqu9eVrKJdGQ+3bKJqPEAiB7rqlnNbROuk/HOQjl8Yx/q/A3XzlnTeQ1y
hZ5OltX396JbNUveZ9bZ/BUNCjBtg8Q0XBKDrCn6mkYl4zdJMVak9wIAgTPIPTAqFcpJtei31G/7
KzC4fBB+XttSb8hgz5qijHtDYvdC7Uw1xUjrobR1Xn6O1erfzrgHjHds0jAwggW6MIIEoqADAgEC
AhEA1ZUxE0eRDDzk8e5klewElDANBgkqhkiG9w0BAQUFADCBnjELMAkGA1UEBhMCVVMxFjAUBgNV
BAgTDU1hc3NhY2h1c2V0dHMxEDAOBgNVBAcTB0JlZGZvcmQxGTAXBgNVBAoTEFJTQSBTZWN1cml0
eSBMTEMxJTAjBgNVBAsTHEdsb2JhbCBTZWN1cml0eSBPcmdhbml6YXRpb24xIzAhBgNVBAMTGlJT
QSBDbGFzcyAyIFBlcnNvbmFsIENBIHYyMB4XDTEyMDIxNDE1MzE0M1oXDTE0MDIxNDE1MzE0MFow
geMxEzARBgoJkiaJk/IsZAEZFgNjb20xEzARBgoJkiaJk/IsZAEZFgNlbWMxGDAWBgNVBAoTD0VN
QyBDb3Jwb3JhdGlvbjEMMAoGA1UECxMDUlNBMREwDwYDVQQLEwhBbWVyaWNhczEUMBIGA1UECxML
RW5naW5lZXJpbmcxDzANBgNVBAUTBjEwNzIwOTEXMBUGCgmSJomT8ixkAQETB3Bvb2xlajIxGDAW
BgNVBAMTD0phbWVzIFBvb2xlLUVuYzEiMCAGCSqGSIb3DQEJARYTamFtZXMucG9vbGVAcnNhLmNv
bTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKpiRb78i247pZ8dzTKC441uHq4mLq5T
Ji//1P9AOwV14KKZEJmuk5qtR/73mDLAc9zqAjfS8upUgpwNGhuJK3fQz8Kj5BXdtikh2Wiuokkp
b+z0aGBkonV3iBvYAdYoA3butIoeW6OwWbNmgAj9UQ9O8m+B8mdlI9u2ZIfgbss0LFbGuxay+2Tg
p3K1/SHLpzjBCRrKyKbFQfiR/S3d/9YTNRIZKbw9EbZZfbvjUvqziHYhsKwZ6u5Q/i4D1xSumubi
0SOFAPOfUbOmN5e9COW63MPXjAhEnYdDFgxQXXufu6Yqgi5XKHrFfxPrDOlR7bEwQxa+OYGWt6Fc
siz2eLUCAwEAAaOCAaowggGmMDUGA1UdJQQuMCwGCisGAQQBgjcUAgIGCCsGAQUFBwMCBggrBgEF
BQcDBAYKKwYBBAGCNwoDBDAfBgNVHSMEGDAWgBQUMOtr9fRJtWhSdabbva5byKx9TDCBkQYDVR0g
BIGJMIGGMIGDBgkqhkiG9w0FBwUwdjAuBggrBgEFBQcCARYiaHR0cDovL2NhLnJzYXNlY3VyaXR5
LmNvbS9DUFMuaHRtbDBEBggrBgEFBQcCAjA4MBcWEFJTQSBTZWN1cml0eSBMTEMwAwIBARodQ1BT
IEluY29ycG9yYXRlZCBieSByZWZlcmVuY2UwPwYDVR0RBDgwNoETamFtZXMucG9vbGVAcnNhLmNv
baAfBgorBgEEAYI3FAIDoBEMD3Bvb2xlajJAZW1jLmNvbTBIBgNVHR8EQTA/MD2gO6A5hjdodHRw
Oi8vY3JsLnJzYXNlY3VyaXR5LmNvbTo4MC9SU0FDbGFzczJQZXJzb25hbENBdjIuY3JsMB0GA1Ud
DgQWBBQCAVyQDByO4mcTzLcoN8/79S4U0TAOBgNVHQ8BAf8EBAMCAzgwDQYJKoZIhvcNAQEFBQAD
ggEBAGvvVTWtXWQeb4h4270T279juqH2TKT6wGMaVneJ+AcUHHl/Qy+W4k7/POe29t6Cj9F1PvpU
e4F9Wb82OUQEugwL6uupWzJE2lTY3MmKhgK2PVN4DJGWg+WhhwW80Xuk58iAifDiiDnnk4ZgYGlY
7LaE7FG0CaH05LilQ6lJER0iUlZfxkAOy8QPFHnmaoBM9PrIeMlmjjP1csW7Ble6j5kPa3LU8hvq
pCdsXByj47ipiRPb1oKaxcZrKn7JzRUkPK1kmdmNJ8RhYZF+Co9imxlsfKTVFsvXspYhxgHOMDWR
QQsvBVjF6hV47AiOB/65p9rda2WLxFMQuxi88MZE7bYxggQ4MIIENAIBATCBtDCBnjELMAkGA1UE
BhMCVVMxFjAUBgNVBAgTDU1hc3NhY2h1c2V0dHMxEDAOBgNVBAcTB0JlZGZvcmQxGTAXBgNVBAoT
EFJTQSBTZWN1cml0eSBMTEMxJTAjBgNVBAsTHEdsb2JhbCBTZWN1cml0eSBPcmdhbml6YXRpb24x
IzAhBgNVBAMTGlJTQSBDbGFzcyAyIFBlcnNvbmFsIENBIHYyAhEA2WgtX9oUz5DUaUyp3NNvvTAJ
BgUrDgMCGgUAoIICWDAYBgkqhkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3DQEJBTEPFw0x
MjA1MDIxOTI0MDdaMCMGCSqGSIb3DQEJBDEWBBTNehNXlXPW+A7D+8zTn7Zu1olerzBnBgkqhkiG
9w0BCQ8xWjBYMAoGCCqGSIb3DQMHMA4GCCqGSIb3DQMCAgIAgDANBggqhkiG9w0DAgIBQDAHBgUr
DgMCBzANBggqhkiG9w0DAgIBKDAHBgUrDgMCGjAKBggqhkiG9w0CBTCBxQYJKwYBBAGCNxAEMYG3
MIG0MIGeMQswCQYDVQQGEwJVUzEWMBQGA1UECBMNTWFzc2FjaHVzZXR0czEQMA4GA1UEBxMHQmVk
Zm9yZDEZMBcGA1UEChMQUlNBIFNlY3VyaXR5IExMQzElMCMGA1UECxMcR2xvYmFsIFNlY3VyaXR5
IE9yZ2FuaXphdGlvbjEjMCEGA1UEAxMaUlNBIENsYXNzIDIgUGVyc29uYWwgQ0EgdjICEQDVlTET
R5EMPOTx7mSV7ASUMIHHBgsqhkiG9w0BCRACCzGBt6CBtDCBnjELMAkGA1UEBhMCVVMxFjAUBgNV
BAgTDU1hc3NhY2h1c2V0dHMxEDAOBgNVBAcTB0JlZGZvcmQxGTAXBgNVBAoTEFJTQSBTZWN1cml0
eSBMTEMxJTAjBgNVBAsTHEdsb2JhbCBTZWN1cml0eSBPcmdhbml6YXRpb24xIzAhBgNVBAMTGlJT
QSBDbGFzcyAyIFBlcnNvbmFsIENBIHYyAhEA1ZUxE0eRDDzk8e5klewElDANBgkqhkiG9w0BAQEF
AASCAQCs3I3nx5mm+pph2gMyG//WWjl4J2MfB7EN8bnMp0V2IWZAj4uDoHFol4FMkaElBCC5WDE5
CKHDpa6wti5T/RafQsp1v2jy/4g1pbfTIt9Z9LAs58rKtqqC3BzP2J99l56k0TL2HEBfHyHDt+mS
2kXwG2mTHiWD80y+AUbBI7PY/utHAlDS4WMAF6kpiiMj4Hu65QxBMdVQF5cDOjqFkvNtOwy+lthm
Y/VmDTKlu8SC4bHZtElR6gb9aULaNc+Q+oRIjVTxu/yBoi3BGxNL8v7HfB6RYAU84gJsNtKIn7H/
ZUEEEWI6yJPOR/PcaL+Kk7lMlQr3IoFn5iFbf7MC2Eq9AAAAAAAA

------=_NextPart_000_041B_01CD2877.9DB2EA60--

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.16.1336485298.2884.rabbitmq-discuss@lists.rabbitmq.com>

with the Server Certificate ("ecertfile" reference), but how would I debug
this further to try and diagnose the cause?

 

See below for the 2 logs that are generated:

 

server.log >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

 

=INFO REPORT==== 2-May-2012::15:02:34 ===

accepting AMQP connection <0.1437.0> (10.238.194.182:63860 ->
10.6.68.60:5671)

 

=ERROR REPORT==== 2-May-2012::15:02:36 ===

SSL: 1074:
error:[<<48,130,3,72,48,130,2,48,160,3,2,1,2,2,17,0,236,148,73,61,

 
234,255,249,79,156,2,245,72,245,155,177,150,48,13,6,9,42,

 
134,72,134,247,13,1,1,5,5,0,48,82,49,80,48,78,6,3,85,4,5,

** Snip (lots of numbers inserted here) **

                    149,145,5,154,244,95,165,237,248,248,24,169,134,248,206,

                    209,123,138,28,179,152,110,87,9,193,181,165,253>>]
C:\testdir\certs.crt

  [{ssl_connection,init_certificates,6,

                   [{file,"ssl_connection.erl"},{line,1070}]},

   {ssl_connection,ssl_init,2,[{file,"ssl_connection.erl"},{line,1025}]},

   {ssl_connection,init,1,[{file,"ssl_connection.erl"},{line,305}]},

   {gen_fsm,init_it,6,[{file,"gen_fsm.erl"},{line,343}]},

   {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]

 

 

=ERROR REPORT==== 2-May-2012::15:02:36 ===

error on AMQP connection <0.1437.0>: {ssl_upgrade_error,ecertfile}

 

<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< 

 

sasl.log >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

 

=CRASH REPORT==== 2-May-2012::15:02:36 ===

  crasher:

    initial call: ssl_connection:init/1

    pid: <0.1438.0>

    registered_name: []

    exception exit: ecertfile

      in function  gen_fsm:init_it/6 (gen_fsm.erl, line 353)

    ancestors: [ssl_connection_sup,ssl_sup,<0.220.0>]

    messages: []

    links: [<0.223.0>]

    dictionary: [{ssl_manager,ssl_manager}]

    trap_exit: false

    status: running

    heap_size: 46368

    stack_size: 24

    reductions: 34417

  neighbours:

 

=SUPERVISOR REPORT==== 2-May-2012::15:02:36 ===

     Supervisor: {local,ssl_connection_sup}

     Context:    child_terminated

     Reason:     ecertfile

     Offender:   [{pid,<0.1438.0>},

                  {name,undefined},

                  {mfargs,{ssl_connection,start_link,undefined}},

                  {restart_type,temporary},

                  {shutdown,4000},

                  {child_type,worker}]

 

<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< 

 


------=_NextPart_001_005F_01CD2D00.83E7D130
Content-Type: text/html;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

<html xmlns:v=3D"urn:schemas-microsoft-com:vml" =
xmlns:o=3D"urn:schemas-microsoft-com:office:office" =
xmlns:w=3D"urn:schemas-microsoft-com:office:word" =
xmlns:x=3D"urn:schemas-microsoft-com:office:excel" =
xmlns:p=3D"urn:schemas-microsoft-com:office:powerpoint" =
xmlns:a=3D"urn:schemas-microsoft-com:office:access" =
xmlns:dt=3D"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" =
xmlns:s=3D"uuid:BDC6E3F0-6DA3-11d1-A2A3-00AA00C14882" =
xmlns:rs=3D"urn:schemas-microsoft-com:rowset" xmlns:z=3D"#RowsetSchema" =
xmlns:b=3D"urn:schemas-microsoft-com:office:publisher" =
xmlns:ss=3D"urn:schemas-microsoft-com:office:spreadsheet" =
xmlns:c=3D"urn:schemas-microsoft-com:office:component:spreadsheet" =
xmlns:odc=3D"urn:schemas-microsoft-com:office:odc" =
xmlns:oa=3D"urn:schemas-microsoft-com:office:activation" =
xmlns:html=3D"http://www.w3.org/TR/REC-html40" =
xmlns:q=3D"http://schemas.xmlsoap.org/soap/envelope/" =
xmlns:rtc=3D"http://microsoft.com/officenet/conferencing" =
xmlns:D=3D"DAV:" xmlns:Repl=3D"http://schemas.microsoft.com/repl/" =
xmlns:mt=3D"http://schemas.microsoft.com/sharepoint/soap/meetings/" =
xmlns:x2=3D"http://schemas.microsoft.com/office/excel/2003/xml" =
xmlns:ppda=3D"http://www.passport.com/NameSpace.xsd" =
xmlns:ois=3D"http://schemas.microsoft.com/sharepoint/soap/ois/" =
xmlns:dir=3D"http://schemas.microsoft.com/sharepoint/soap/directory/" =
xmlns:ds=3D"http://www.w3.org/2000/09/xmldsig#" =
xmlns:dsp=3D"http://schemas.microsoft.com/sharepoint/dsp" =
xmlns:udc=3D"http://schemas.microsoft.com/data/udc" =
xmlns:xsd=3D"http://www.w3.org/2001/XMLSchema" =
xmlns:sub=3D"http://schemas.microsoft.com/sharepoint/soap/2002/1/alerts/"=
 xmlns:ec=3D"http://www.w3.org/2001/04/xmlenc#" =
xmlns:sp=3D"http://schemas.microsoft.com/sharepoint/" =
xmlns:sps=3D"http://schemas.microsoft.com/sharepoint/soap/" =
xmlns:xsi=3D"http://www.w3.org/2001/XMLSchema-instance" =
xmlns:udcs=3D"http://schemas.microsoft.com/data/udc/soap" =
xmlns:udcxf=3D"http://schemas.microsoft.com/data/udc/xmlfile" =
xmlns:udcp2p=3D"http://schemas.microsoft.com/data/udc/parttopart" =
xmlns:wf=3D"http://schemas.microsoft.com/sharepoint/soap/workflow/" =
xmlns:dsss=3D"http://schemas.microsoft.com/office/2006/digsig-setup" =
xmlns:dssi=3D"http://schemas.microsoft.com/office/2006/digsig" =
xmlns:mdssi=3D"http://schemas.openxmlformats.org/package/2006/digital-sig=
nature" =
xmlns:mver=3D"http://schemas.openxmlformats.org/markup-compatibility/2006=
" xmlns:m=3D"http://schemas.microsoft.com/office/2004/12/omml" =
xmlns:mrels=3D"http://schemas.openxmlformats.org/package/2006/relationshi=
ps" xmlns:spwp=3D"http://microsoft.com/sharepoint/webpartpages" =
xmlns:ex12t=3D"http://schemas.microsoft.com/exchange/services/2006/types"=
 =
xmlns:ex12m=3D"http://schemas.microsoft.com/exchange/services/2006/messag=
es" =
xmlns:pptsl=3D"http://schemas.microsoft.com/sharepoint/soap/SlideLibrary/=
" =
xmlns:spsl=3D"http://microsoft.com/webservices/SharePointPortalServer/Pub=
lishedLinksService" xmlns:Z=3D"urn:schemas-microsoft-com:" =
xmlns:st=3D"&#1;" xmlns=3D"http://www.w3.org/TR/REC-html40"><head><meta =
http-equiv=3DContent-Type content=3D"text/html; =
charset=3Dus-ascii"><meta name=3DGenerator content=3D"Microsoft Word 12 =
(filtered medium)"><style><!--
/* Font Definitions */
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
span.EmailStyle17
	{mso-style-type:personal;
	font-family:"Calibri","sans-serif";
	color:windowtext;}
span.EmailStyle18
	{mso-style-type:personal-reply;
	font-family:"Calibri","sans-serif";
	color:#1F497D;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-size:10.0pt;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
--></style><!--[if gte mso 9]><xml>
<o:shapedefaults v:ext=3D"edit" spidmax=3D"1026" />
</xml><![endif]--><!--[if gte mso 9]><xml>
<o:shapelayout v:ext=3D"edit">
<o:idmap v:ext=3D"edit" data=3D"1" />
</o:shapelayout></xml><![endif]--></head><body lang=3DEN-US link=3Dblue =
vlink=3Dpurple><div class=3DWordSection1><p class=3DMsoNormal><span =
style=3D'color:#1F497D'>In case anyone runs into a similar issue, we =
found that our certificate had a subject length of over 64 =
characters.&nbsp; This length limit seems like it is not part of the =
actual standard (LDAP doesn&#8217;t enforce it), but in any case, =
shortening the subject fixed the issue.<o:p></o:p></span></p><p =
class=3DMsoNormal><span =
style=3D'color:#1F497D'><o:p>&nbsp;</o:p></span></p><p =
class=3DMsoNormal><span style=3D'color:#1F497D'>An error message stating =
the cause could have been a real time saver </span><span =
style=3D'font-family:Wingdings;color:#1F497D'>J</span><span =
style=3D'color:#1F497D'><o:p></o:p></span></p><p class=3DMsoNormal><span =
style=3D'color:#1F497D'><o:p>&nbsp;</o:p></span></p><p =
class=3DMsoNormal><span =
style=3D'color:#1F497D'>-James<o:p></o:p></span></p><p =
class=3DMsoNormal><span =
style=3D'color:#1F497D'><o:p>&nbsp;</o:p></span></p><div><div =
style=3D'border:none;border-top:solid #B5C4DF 1.0pt;padding:3.0pt 0in =
0in 0in'><p class=3DMsoNormal><b><span =
style=3D'font-size:10.0pt;font-family:"Tahoma","sans-serif"'>From:</span>=
</b><span style=3D'font-size:10.0pt;font-family:"Tahoma","sans-serif"'> =
rabbitmq-discuss-bounces at lists.rabbitmq.com =
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] <b>On Behalf Of =
</b>james.poole at rsa.com<br><b>Sent:</b> Wednesday, May 02, 2012 3:24 =
PM<br><b>To:</b> rabbitmq-discuss at lists.rabbitmq.com<br><b>Subject:</b> =
[rabbitmq-discuss] SSL Certificate =
Error<o:p></o:p></span></p></div></div><p =
class=3DMsoNormal><o:p>&nbsp;</o:p></p><p class=3DMsoNormal>Can anyone =
help me understand what is happening when I try to enable SSL using =
Non-OpenSSL certificates?&nbsp; The certificates being used are working =
as SSL Server certificates with Apache 2.2.22, but when I use them with =
RabbitMQ, it is failing.&nbsp; Also, if I generate OpenSSL certificates =
to test with, the same setup works (same config file, server, =
etc).<o:p></o:p></p><p class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>From the online docs, it definitely looks like Erlang =
is having problems with the Server Certificate (&#8220;ecertfile&#8221; =
reference), but how would I debug this further to try and diagnose the =
cause?<o:p></o:p></p><p class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>See below for the 2 logs that are =
generated:<o:p></o:p></p><p class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>server.log =
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&=
gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&g=
t;&gt;&gt;<o:p></o:p></p><p class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>=3DINFO REPORT=3D=3D=3D=3D 2-May-2012::15:02:34 =
=3D=3D=3D<o:p></o:p></p><p class=3DMsoNormal>accepting AMQP connection =
&lt;0.1437.0&gt; (10.238.194.182:63860 -&gt; =
10.6.68.60:5671)<o:p></o:p></p><p =
class=3DMsoNormal><o:p>&nbsp;</o:p></p><p class=3DMsoNormal>=3DERROR =
REPORT=3D=3D=3D=3D 2-May-2012::15:02:36 =3D=3D=3D<o:p></o:p></p><p =
class=3DMsoNormal>SSL: 1074: =
error:[&lt;&lt;48,130,3,72,48,130,2,48,160,3,2,1,2,2,17,0,236,148,73,61,<=
o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
234,255,249,79,156,2,245,72,245,155,177,150,48,13,6,9,42,<o:p></o:p></p><=
p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
134,72,134,247,13,1,1,5,5,0,48,82,49,80,48,78,6,3,85,4,5,<o:p></o:p></p><=
p class=3DMsoNormal>** Snip (lots of numbers inserted here) =
**<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
149,145,5,154,244,95,165,237,248,248,24,169,134,248,206,<o:p></o:p></p><p=
 =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
209,123,138,28,179,152,110,87,9,193,181,165,253&gt;&gt;] =
C:\testdir\certs.crt<o:p></o:p></p><p class=3DMsoNormal>&nbsp; =
[{ssl_connection,init_certificates,6,<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
[{file,&quot;ssl_connection.erl&quot;},{line,1070}]},<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp; =
{ssl_connection,ssl_init,2,[{file,&quot;ssl_connection.erl&quot;},{line,1=
025}]},<o:p></o:p></p><p class=3DMsoNormal>&nbsp;&nbsp; =
{ssl_connection,init,1,[{file,&quot;ssl_connection.erl&quot;},{line,305}]=
},<o:p></o:p></p><p class=3DMsoNormal>&nbsp;&nbsp; =
{gen_fsm,init_it,6,[{file,&quot;gen_fsm.erl&quot;},{line,343}]},<o:p></o:=
p></p><p class=3DMsoNormal>&nbsp;&nbsp; =
{proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}=
]<o:p></o:p></p><p class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal><o:p>&nbsp;</o:p></p><p class=3DMsoNormal>=3DERROR =
REPORT=3D=3D=3D=3D 2-May-2012::15:02:36 =3D=3D=3D<o:p></o:p></p><p =
class=3DMsoNormal>error on AMQP connection &lt;0.1437.0&gt;: =
{ssl_upgrade_error,ecertfile}<o:p></o:p></p><p =
class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt=
;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;=
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<o:p>&nbs=
p;</o:p></p><p class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>sasl.log =
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&=
gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&g=
t;&gt;&gt;<o:p></o:p></p><p class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>=3DCRASH REPORT=3D=3D=3D=3D 2-May-2012::15:02:36 =
=3D=3D=3D<o:p></o:p></p><p class=3DMsoNormal>&nbsp; =
crasher:<o:p></o:p></p><p class=3DMsoNormal>&nbsp;&nbsp;&nbsp; initial =
call: ssl_connection:init/1<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; pid: =
&lt;0.1438.0&gt;<o:p></o:p></p><p class=3DMsoNormal>&nbsp;&nbsp;&nbsp; =
registered_name: []<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; exception exit: =
ecertfile<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in function&nbsp; =
gen_fsm:init_it/6 (gen_fsm.erl, line 353)<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; ancestors: =
[ssl_connection_sup,ssl_sup,&lt;0.220.0&gt;]<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; messages: []<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; links: =
[&lt;0.223.0&gt;]<o:p></o:p></p><p class=3DMsoNormal>&nbsp;&nbsp;&nbsp; =
dictionary: [{ssl_manager,ssl_manager}]<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; trap_exit: false<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; status: running<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; heap_size: 46368<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; stack_size: 24<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp; reductions: 34417<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp; neighbours:<o:p></o:p></p><p =
class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>=3DSUPERVISOR REPORT=3D=3D=3D=3D 2-May-2012::15:02:36 =
=3D=3D=3D<o:p></o:p></p><p class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp; =
Supervisor: {local,ssl_connection_sup}<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp; Context:&nbsp;&nbsp;&nbsp; =
child_terminated<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp; =
Reason:&nbsp;&nbsp;&nbsp;&nbsp; ecertfile<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp; Offender:&nbsp;&nbsp; =
[{pid,&lt;0.1438.0&gt;},<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
{name,undefined},<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
{mfargs,{ssl_connection,start_link,undefined}},<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
{restart_type,temporary},<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
{shutdown,4000},<o:p></o:p></p><p =
class=3DMsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
{child_type,worker}]<o:p></o:p></p><p =
class=3DMsoNormal><o:p>&nbsp;</o:p></p><p =
class=3DMsoNormal>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt=
;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;=
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<o:p>&nbs=
p;</o:p></p><p =
class=3DMsoNormal><o:p>&nbsp;</o:p></p></div></body></html>
------=_NextPart_001_005F_01CD2D00.83E7D130--

------=_NextPart_000_005E_01CD2D00.83E7D130
Content-Type: application/x-pkcs7-signature; name="smime.p7s"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="smime.p7s"

MIAGCSqGSIb3DQEHAqCAMIACAQExCzAJBgUrDgMCGgUAMIAGCSqGSIb3DQEHAQAAoIIYozCCA2Ew
ggJJoAMCAQICEAoBAQEAAAJ8AAAACgAAAAIwDQYJKoZIhvcNAQEFBQAwOjEZMBcGA1UEChMQUlNB
IFNlY3VyaXR5IEluYzEdMBsGA1UECxMUUlNBIFNlY3VyaXR5IDIwNDggVjMwHhcNMDEwMjIyMjAz
OTIzWhcNMjYwMjIyMjAzOTIzWjA6MRkwFwYDVQQKExBSU0EgU2VjdXJpdHkgSW5jMR0wGwYDVQQL
ExRSU0EgU2VjdXJpdHkgMjA0OCBWMzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALeP
VXHSgN17aXmn8BhQMjxiZ/YKlQfd5hvzntnSQVRrrZ98vhnN+0arQWgeGOpVyC+ReIko+ycpYP/f
j4w7yUmbtaSUzgHqPrVje38m/RndwCG9hNEtT0bDTtzYNzk7KK/LnRrqK68hpcEjIri4G1oTh1eD
0fAg5+hPI0KwAKV9ienpYXOUmHEmvC1q4PdN8PG2KjgxgQ0p4QDBUQ9MUvgEWqp9ctO4hyq7YxAD
KrOhTw1aXka3PQ71dOyZn/k9JIGIpt1gVOiVNj3GCZOaoxKAAFWZGUe90KV8w7r7H/f1D/isubX0
N5gTGN6FW7cMgjuHb5U5WDDabgFoFyLMwAsCAwEAAaNjMGEwDwYDVR0TAQH/BAUwAwEB/zAOBgNV
HQ8BAf8EBAMCAQYwHwYDVR0jBBgwFoAUB8NRMKSq6UWuNST6/yQsM9CxnYwwHQYDVR0OBBYEFAfD
UTCkqulFrjUk+v8kLDPQsZ2MMA0GCSqGSIb3DQEBBQUAA4IBAQBfPoZ2brg1PE42HB55mL/91RIR
eVIO7jGJvN1/+dHGFSHoigFUDTr7VLnWY9SxqpZNokJN1FMfixDef2W+YBMncYikc+OEY9GkVeFQ
k+YbDnnQZ7xGyL8/Fw2V5saQad7ntC/elX3QEj89Pn9NPxRo9RFQ1cH0kKUIHTFg/2CMI1QKr/6h
bsXReipoeM8eggogtB+t5YWyamh1Tq0lN5SFvr2h1Oq3DEs8negSAPBfrA3hrHBjc/d/eZ8yJUJ0
BYAov73BJJZYFbEXIemJS9sHiGf0Fa1wPi9NhTvCt9v+mGgjieF0D970xYRjKRvMywfJAKSp18Ii
T2fXd+wgBWHeMIIEzDCCA7SgAwIBAgIQfwkpTisxI69dQcDR3n6N2TANBgkqhkiG9w0BAQUFADA6
MRkwFwYDVQQKExBSU0EgU2VjdXJpdHkgSW5jMR0wGwYDVQQLExRSU0EgU2VjdXJpdHkgMjA0OCBW
MzAeFw0xMTAzMDMyMDUyMTVaFw0xOTA0MDExNDQ1MzlaMIGXMQswCQYDVQQGEwJVUzEWMBQGA1UE
CBMNTWFzc2FjaHVzZXR0czEQMA4GA1UEBxMHQmVkZm9yZDEZMBcGA1UEChMQUlNBIFNlY3VyaXR5
IExMQzElMCMGA1UECxMcR2xvYmFsIFNlY3VyaXR5IE9yZ2FuaXphdGlvbjEcMBoGA1UEAxMTUlNB
IENvcnBvcmF0ZSBDQSB2MjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALaLCcEh7lhj
dqYo6ryZ8oHK4kJRmQuxfwMa/3PE1Vd4U7U5x15UuSX+qd78hnEdR6yGGxhmY8U2SDG31u+yJD9o
OpXFQm6/A4xzItwfcs6SD3Gt6nI/Oa6M0M/7MjPqSc1aUUm2NFiyb6DjotYLDzeAVCqF+4V/Dgc2
QdO1FZeFUCcb5lMqkVAr+O3uAEZEmtD3Cr06YavA38fxeWCiPoheUuWuAQcvOdEnSzJFm6GM8yBJ
l9J1cAibE6c4DCl+eHj4M+O/ON2fFVb/lQdS4xO7cSZ9fKGCI7kWr0/7ssSjPsIIGpg0hLRZ35aZ
fCK1fFLi9VKvIcTYTrA8Gf9bIGsCAwEAAaOCAW4wggFqMB8GA1UdIwQYMBaAFAfDUTCkqulFrjUk
+v8kLDPQsZ2MMBIGA1UdEwEB/wQIMAYBAf8CAQMwcAYDVR0fBGkwZzBloGOgYYZfaHR0cDovL3d3
dy5yc2FzZWN1cml0eS5jb20vcHJvZHVjdHMva2Vvbi9yZXBvc2l0b3J5L2NlcnRpZmljYXRlX3N0
YXR1cy9SU0FfU2VjdXJpdHlfMjA0OF92My5DUkwwHQYDVR0OBBYEFHMbOEsly1qOvQLs310p9hB0
DtiYMIGRBgNVHSAEgYkwgYYwgYMGCSqGSIb3DQUGATB2MC4GCCsGAQUFBwIBFiJodHRwOi8vY2Eu
cnNhc2VjdXJpdHkuY29tL0NQUy5odG1sMEQGCCsGAQUFBwICMDgwFxYQUlNBIFNlY3VyaXR5IExM
QzADAgEBGh1DUFMgSW5jb3Jwb3JhdGVkIGJ5IHJlZmVyZW5jZTAOBgNVHQ8BAf8EBAMCAYYwDQYJ
KoZIhvcNAQEFBQADggEBAHGIVCAjCZ+z2vRElolRsLsz4L/js0Zm019rr/+eFks5VnSf5T0HJj7Z
tzjtna/+O5b01L8L6Fz64Yui+h/cnxvDwQrhzajbiMiN/JFH+kNOUJ9LcInBkmu45d98h+EQw3Yz
XwfnHYaXLArfgeY3CP8AYi0pxXEXf0bH8Prl+P0n4SOUqxh6J0GIz/haW1+usvMscB7lCpJ2loo9
+TmRn3WQrokgr1ILm/3apel6ydpkoFUxEoP5a1806Z7SD9KljN+Vc9o521VkMtnzLlDEkn05by/p
QNdlidY7eV7xcpCvuI6qFzyfHdI3G0/Vao0L0os6lEwb5PSa1IysLlHT0uUwggT+MIID5qADAgEC
AhBiTV1a7zr4E+gcgJ4lG6TBMA0GCSqGSIb3DQEBBQUAMIGXMQswCQYDVQQGEwJVUzEWMBQGA1UE
CBMNTWFzc2FjaHVzZXR0czEQMA4GA1UEBxMHQmVkZm9yZDEZMBcGA1UEChMQUlNBIFNlY3VyaXR5
IExMQzElMCMGA1UECxMcR2xvYmFsIFNlY3VyaXR5IE9yZ2FuaXphdGlvbjEcMBoGA1UEAxMTUlNB
IENvcnBvcmF0ZSBDQSB2MjAeFw0xMTAzMTAyMjQwMDRaFw0xOTAyMjgyMTU2MzNaMIGeMQswCQYD
VQQGEwJVUzEWMBQGA1UECBMNTWFzc2FjaHVzZXR0czEQMA4GA1UEBxMHQmVkZm9yZDEZMBcGA1UE
ChMQUlNBIFNlY3VyaXR5IExMQzElMCMGA1UECxMcR2xvYmFsIFNlY3VyaXR5IE9yZ2FuaXphdGlv
bjEjMCEGA1UEAxMaUlNBIENsYXNzIDIgUGVyc29uYWwgQ0EgdjIwggEiMA0GCSqGSIb3DQEBAQUA
A4IBDwAwggEKAoIBAQDNEVsNPFZOP83bMzCpUDGnf/5IDIQvVRhDHkyrkbv5X1ih4xdTsSdzTDrj
LUxIzC7nJswCv+jBaWWm1YoqzBXqQl2/Hl6T5Bt3HBT302GSYamtKcCWve25DoJav+dJd9U/XkCq
SSNN7DNVXkJrKC7Zq7OS6/O308pZNkCRJJfMRrodgSx1NoQYZJCfufTOshslVSVhj3Ar274qmuf8
iqM0RR5OMpm7t2dtHzvYJPHR3+HwfQ+s64YBC7NBrBLOYMeq8tzkPKzyITXhwopgbM6gbp+Z8qX5
/lo4Y3OEm7ED51iDqdruRoRnfTQGKdZJT7IYGLH+x0roRKmYKP/2HRNpAgMBAAGjggE7MIIBNzAP
BgNVHRMECDAGAQH/AgECMIGRBgNVHSAEgYkwgYYwgYMGCSqGSIb3DQUHAjB2MC4GCCsGAQUFBwIB
FiJodHRwOi8vY2EucnNhc2VjdXJpdHkuY29tL0NQUy5odG1sMEQGCCsGAQUFBwICMDgwFxYQUlNB
IFNlY3VyaXR5IExMQzADAgEBGh1DUFMgSW5jb3Jwb3JhdGVkIGJ5IHJlZmVyZW5jZTBABgNVHR8E
OTA3MDWgM6Axhi9odHRwOi8vY3JsLnJzYXNlY3VyaXR5LmNvbS9SU0FDb3Jwb3JhdGVDQXYyLmNy
bDAOBgNVHQ8BAf8EBAMCAYYwHQYDVR0OBBYEFBQw62v19Em1aFJ1ptu9rlvIrH1MMB8GA1UdIwQY
MBaAFHMbOEsly1qOvQLs310p9hB0DtiYMA0GCSqGSIb3DQEBBQUAA4IBAQCPepLT4buLa9p5VwF1
OW2YUwliCqxecs0CxRGJVR4cwvOuMeXxutP+m51n3vzseGkM0d1fmA9JTz8X+5LFdRD12Iw124oj
79QA7NKhO/xoPgbo0QxgnvHS15o94BPvFiZE6QGUjkHs9/hDvU+eIx7OG+Kzxt47vZZef+fJF0+s
ZgEDIMXXPXAtJW3xg/JhPrl4z0L7gmjgO+KxV0cyxaDrk6SEW5zZCqAcLehnW7MH8vvlzMsQ6pVr
f1g8xMCJonyxow9AwXGyQ0z1866qbJ8t+nQC/sGx3msJVHQg1JyjOWF4PMm8DdeUt+qUrSFRLY4J
MroY51gM90nnhtijtleCMIIFqjCCBJKgAwIBAgIRANloLV/aFM+Q1GlMqdzTb70wDQYJKoZIhvcN
AQEFBQAwgZ4xCzAJBgNVBAYTAlVTMRYwFAYDVQQIEw1NYXNzYWNodXNldHRzMRAwDgYDVQQHEwdC
ZWRmb3JkMRkwFwYDVQQKExBSU0EgU2VjdXJpdHkgTExDMSUwIwYDVQQLExxHbG9iYWwgU2VjdXJp
dHkgT3JnYW5pemF0aW9uMSMwIQYDVQQDExpSU0EgQ2xhc3MgMiBQZXJzb25hbCBDQSB2MjAeFw0x
MjAyMTQxNTMxNDBaFw0xNDAyMTQxNTMxNDBaMIHfMRMwEQYKCZImiZPyLGQBGRYDY29tMRMwEQYK
CZImiZPyLGQBGRYDZW1jMRgwFgYDVQQKEw9FTUMgQ29ycG9yYXRpb24xDDAKBgNVBAsTA1JTQTER
MA8GA1UECxMIQW1lcmljYXMxFDASBgNVBAsTC0VuZ2luZWVyaW5nMQ8wDQYDVQQFEwYxMDcyMDkx
FzAVBgoJkiaJk/IsZAEBEwdwb29sZWoyMRQwEgYDVQQDEwtKYW1lcyBQb29sZTEiMCAGCSqGSIb3
DQEJARYTamFtZXMucG9vbGVAcnNhLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB
ALTeqoL+Hxiw0+ina1/uVw1L24NTxmGqovLzY0pPD6PxwA+Ubi30LYUinSg0MrE7sEGuTQNWKc04
b/iZHUk+C6CrOeqtbwex9p8Ep4Mp4hEudQi/wWgBAOKw8kR7q7PJnFl4k8FBZuU75wztCBbArFcx
2wx0e8+BHVf7d5qb34TQV+ypiSEulCDEnlQwD3niXq+Brktidn5pH1i56dsUPX8ZOYvNS3SABHOW
X7n2/tmslm6ZbGT1jL81tsvOT7bQy6d4eT3v96Z/yPFhY1qnnn2TZs+e7TV97Z2fM9xBmN/VLtqu
1rw8eeN2f3gUwZc05rLILMU9YO7MnvBcyqC/BIsCAwEAAaOCAZ4wggGaMB8GA1UdIwQYMBaAFBQw
62v19Em1aFJ1ptu9rlvIrH1MMIGRBgNVHSAEgYkwgYYwgYMGCSqGSIb3DQUHBTB2MC4GCCsGAQUF
BwIBFiJodHRwOi8vY2EucnNhc2VjdXJpdHkuY29tL0NQUy5odG1sMEQGCCsGAQUFBwICMDgwFxYQ
UlNBIFNlY3VyaXR5IExMQzADAgEBGh1DUFMgSW5jb3Jwb3JhdGVkIGJ5IHJlZmVyZW5jZTApBgNV
HSUEIjAgBgorBgEEAYI3FAICBggrBgEFBQcDAgYIKwYBBQUHAwQwPwYDVR0RBDgwNoETamFtZXMu
cG9vbGVAcnNhLmNvbaAfBgorBgEEAYI3FAIDoBEMD3Bvb2xlajJAZW1jLmNvbTAOBgNVHQ8BAf8E
BAMCB4AwSAYDVR0fBEEwPzA9oDugOYY3aHR0cDovL2NybC5yc2FzZWN1cml0eS5jb206ODAvUlNB
Q2xhc3MyUGVyc29uYWxDQXYyLmNybDAdBgNVHQ4EFgQU23MkxGkgZNJhdX+WQxATw0HWQlAwDQYJ
KoZIhvcNAQEFBQADggEBACy9/o9dXkAB9DguuVnHJjkQUtg/RnIjNXoqHJEjehTeCLHr1jxwAnOK
EZ63xZEEeLkfd8zqWCFeZuNnjr2EoGyHGt7033lib4D8Fk1PPAaaljB8hsin4IKXrr+bbqpLydlp
eE1IxXym7vwehwYDfQePqu9eVrKJdGQ+3bKJqPEAiB7rqlnNbROuk/HOQjl8Yx/q/A3XzlnTeQ1y
hZ5OltX396JbNUveZ9bZ/BUNCjBtg8Q0XBKDrCn6mkYl4zdJMVak9wIAgTPIPTAqFcpJtei31G/7
KzC4fBB+XttSb8hgz5qijHtDYvdC7Uw1xUjrobR1Xn6O1erfzrgHjHds0jAwggW6MIIEoqADAgEC
AhEA1ZUxE0eRDDzk8e5klewElDANBgkqhkiG9w0BAQUFADCBnjELMAkGA1UEBhMCVVMxFjAUBgNV
BAgTDU1hc3NhY2h1c2V0dHMxEDAOBgNVBAcTB0JlZGZvcmQxGTAXBgNVBAoTEFJTQSBTZWN1cml0
eSBMTEMxJTAjBgNVBAsTHEdsb2JhbCBTZWN1cml0eSBPcmdhbml6YXRpb24xIzAhBgNVBAMTGlJT
QSBDbGFzcyAyIFBlcnNvbmFsIENBIHYyMB4XDTEyMDIxNDE1MzE0M1oXDTE0MDIxNDE1MzE0MFow
geMxEzARBgoJkiaJk/IsZAEZFgNjb20xEzARBgoJkiaJk/IsZAEZFgNlbWMxGDAWBgNVBAoTD0VN
QyBDb3Jwb3JhdGlvbjEMMAoGA1UECxMDUlNBMREwDwYDVQQLEwhBbWVyaWNhczEUMBIGA1UECxML
RW5naW5lZXJpbmcxDzANBgNVBAUTBjEwNzIwOTEXMBUGCgmSJomT8ixkAQETB3Bvb2xlajIxGDAW
BgNVBAMTD0phbWVzIFBvb2xlLUVuYzEiMCAGCSqGSIb3DQEJARYTamFtZXMucG9vbGVAcnNhLmNv
bTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKpiRb78i247pZ8dzTKC441uHq4mLq5T
Ji//1P9AOwV14KKZEJmuk5qtR/73mDLAc9zqAjfS8upUgpwNGhuJK3fQz8Kj5BXdtikh2Wiuokkp
b+z0aGBkonV3iBvYAdYoA3butIoeW6OwWbNmgAj9UQ9O8m+B8mdlI9u2ZIfgbss0LFbGuxay+2Tg
p3K1/SHLpzjBCRrKyKbFQfiR/S3d/9YTNRIZKbw9EbZZfbvjUvqziHYhsKwZ6u5Q/i4D1xSumubi
0SOFAPOfUbOmN5e9COW63MPXjAhEnYdDFgxQXXufu6Yqgi5XKHrFfxPrDOlR7bEwQxa+OYGWt6Fc
siz2eLUCAwEAAaOCAaowggGmMDUGA1UdJQQuMCwGCisGAQQBgjcUAgIGCCsGAQUFBwMCBggrBgEF
BQcDBAYKKwYBBAGCNwoDBDAfBgNVHSMEGDAWgBQUMOtr9fRJtWhSdabbva5byKx9TDCBkQYDVR0g
BIGJMIGGMIGDBgkqhkiG9w0FBwUwdjAuBggrBgEFBQcCARYiaHR0cDovL2NhLnJzYXNlY3VyaXR5
LmNvbS9DUFMuaHRtbDBEBggrBgEFBQcCAjA4MBcWEFJTQSBTZWN1cml0eSBMTEMwAwIBARodQ1BT
IEluY29ycG9yYXRlZCBieSByZWZlcmVuY2UwPwYDVR0RBDgwNoETamFtZXMucG9vbGVAcnNhLmNv
baAfBgorBgEEAYI3FAIDoBEMD3Bvb2xlajJAZW1jLmNvbTBIBgNVHR8EQTA/MD2gO6A5hjdodHRw
Oi8vY3JsLnJzYXNlY3VyaXR5LmNvbTo4MC9SU0FDbGFzczJQZXJzb25hbENBdjIuY3JsMB0GA1Ud
DgQWBBQCAVyQDByO4mcTzLcoN8/79S4U0TAOBgNVHQ8BAf8EBAMCAzgwDQYJKoZIhvcNAQEFBQAD
ggEBAGvvVTWtXWQeb4h4270T279juqH2TKT6wGMaVneJ+AcUHHl/Qy+W4k7/POe29t6Cj9F1PvpU
e4F9Wb82OUQEugwL6uupWzJE2lTY3MmKhgK2PVN4DJGWg+WhhwW80Xuk58iAifDiiDnnk4ZgYGlY
7LaE7FG0CaH05LilQ6lJER0iUlZfxkAOy8QPFHnmaoBM9PrIeMlmjjP1csW7Ble6j5kPa3LU8hvq
pCdsXByj47ipiRPb1oKaxcZrKn7JzRUkPK1kmdmNJ8RhYZF+Co9imxlsfKTVFsvXspYhxgHOMDWR
QQsvBVjF6hV47AiOB/65p9rda2WLxFMQuxi88MZE7bYxggQ4MIIENAIBATCBtDCBnjELMAkGA1UE
BhMCVVMxFjAUBgNVBAgTDU1hc3NhY2h1c2V0dHMxEDAOBgNVBAcTB0JlZGZvcmQxGTAXBgNVBAoT
EFJTQSBTZWN1cml0eSBMTEMxJTAjBgNVBAsTHEdsb2JhbCBTZWN1cml0eSBPcmdhbml6YXRpb24x
IzAhBgNVBAMTGlJTQSBDbGFzcyAyIFBlcnNvbmFsIENBIHYyAhEA2WgtX9oUz5DUaUyp3NNvvTAJ
BgUrDgMCGgUAoIICWDAYBgkqhkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3DQEJBTEPFw0x
MjA1MDgxMzU0MDlaMCMGCSqGSIb3DQEJBDEWBBQcyJnIhqGVtwya4BM4l6Cn+jrBdjBnBgkqhkiG
9w0BCQ8xWjBYMAoGCCqGSIb3DQMHMA4GCCqGSIb3DQMCAgIAgDANBggqhkiG9w0DAgIBQDAHBgUr
DgMCBzANBggqhkiG9w0DAgIBKDAHBgUrDgMCGjAKBggqhkiG9w0CBTCBxQYJKwYBBAGCNxAEMYG3
MIG0MIGeMQswCQYDVQQGEwJVUzEWMBQGA1UECBMNTWFzc2FjaHVzZXR0czEQMA4GA1UEBxMHQmVk
Zm9yZDEZMBcGA1UEChMQUlNBIFNlY3VyaXR5IExMQzElMCMGA1UECxMcR2xvYmFsIFNlY3VyaXR5
IE9yZ2FuaXphdGlvbjEjMCEGA1UEAxMaUlNBIENsYXNzIDIgUGVyc29uYWwgQ0EgdjICEQDVlTET
R5EMPOTx7mSV7ASUMIHHBgsqhkiG9w0BCRACCzGBt6CBtDCBnjELMAkGA1UEBhMCVVMxFjAUBgNV
BAgTDU1hc3NhY2h1c2V0dHMxEDAOBgNVBAcTB0JlZGZvcmQxGTAXBgNVBAoTEFJTQSBTZWN1cml0
eSBMTEMxJTAjBgNVBAsTHEdsb2JhbCBTZWN1cml0eSBPcmdhbml6YXRpb24xIzAhBgNVBAMTGlJT
QSBDbGFzcyAyIFBlcnNvbmFsIENBIHYyAhEA1ZUxE0eRDDzk8e5klewElDANBgkqhkiG9w0BAQEF
AASCAQCE7L941mLmU3lHNF6yAD0fbrnL4YwvKYo6GWmUzCYtiGMBuDGUI5ix3P+cv/GGGC+nSDvF
hsErGkL/GigiWEQKGGKtsW9awPeUH575I0tEz/IG6mJbT5E0ijuXfCfYn9xdKvh4eYh3euTT8DRQ
DuTy+tZKmJCmGIh8ofpuCXzFPd+qic1nY5X9+1qNCf/pdyXiXLrs1k7g1MYECGstBXZ71Y6tkv2e
JZF2DbYCSTmhZAGK/1hVK7gGaeaNk38N5wYWp75pMHJEudzGl0QH9/CUk58UQSLP7KUpeKNTJud+
GU6JT51fpHTS9JSZGFCD9s+iKd2eIpLUY8MlHhH1aGMkAAAAAAAA

------=_NextPart_000_005E_01CD2D00.83E7D130--

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.17.1337593768.2884.rabbitmq-discuss@lists.rabbitmq.com>

tasks to the queue, but never emptying it', which I doubt is true. In the 
tutorials, a consumer/worker program listens to the queue, and process 
messages as they arrive, without using celery.

So my questions: what's the added-value celery brings to rabbitmq, and what 
are the common use cases of it?

------=_Part_248_6655364.1337537246127
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: quoted-printable

<br><div>I finished reading through the rabbitmq tutorials <a href=3D"http:=
//www.rabbitmq.com/getstarted.html">here</a>, and later found out people ve=
ry often associate celery with rabbitmq.</div><div><br></div><div>From the =
tutorials, it seems that we <b>don't have to</b> use celery to process the =
messages in the queues (i.e. emptying them). However, someone on <a href=3D=
"http://stackoverflow.com/questions/7309112/newbie-question-to-rabbitmq-and=
-celery">SO</a>&nbsp;says that: '<span style=3D"color: rgb(0, 0, 0); font-f=
amily: Arial, 'Liberation Sans', 'DejaVu Sans', sans-serif; font-size: 14px=
; font-style: normal; font-variant: normal; font-weight: normal; letter-spa=
cing: normal; line-height: 18px; orphans: 2; text-align: left; text-indent:=
 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0=
px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; backgro=
und-color: rgb(255, 255, 255); display: inline !important; float: none; ">I=
f you don't have a celeryd process running, you'll just be adding tasks to =
the queue, but never emptying it',&nbsp;</span>which I doubt is true. In th=
e tutorials, a consumer/worker program listens to the queue, and process me=
ssages as they arrive, without using celery.</div><div><br></div><div>So my=
 questions: what's the added-value celery brings to rabbitmq, and what are =
the common use cases of it?</div>
------=_Part_248_6655364.1337537246127--

------=_Part_247_23720286.1337537246126--

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.18.1338019803.2884.rabbitmq-discuss@lists.rabbitmq.com>

with offered traffic is a good time to throttle the producers. Perhaps call
this the "steady state" point of view - I'm unsure if it has a better name
already.


From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.19.1338019804.2884.rabbitmq-discuss@lists.rabbitmq.com>

- the growth of queues is perfectly acceptable, whether consumers exist at
the time or not.

ISTM Rabbit makes a guess about whether the application is "steady state"
or "bursty", choosing "steady state" all the time. Rabbit team, is this the
case? Is there a way of configuring the flow control to permit unbounded
queue growth to support the "bursty" case? Or do I have the wrong end of
the stick entirely?


> 1. A client is publishing 1.5K/sec to each of four exchanges, each of
> which has a queue.
> 2. There are no consumers.  Therefore the queue is growing.
> 3. RMQ does not stop this.  "Flow control" does not trigger.
> 4. The consumers appear to begin to tear down the backlog.
>  5. RMQ per-connection flow control suddenly decides that now there are
> some consumers, now it has a reason to throttle the sender.
> 6. If the consumers had not shown up, the producer would not have been
> blocked.
>

7. The consumers drain some of the messages from the queues.
8. The producers are unblocked.
9. Profit!!!

Regards,
  Tony




-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/

--14dae93403d7eb63fb04c0ec0197
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Aha, after this bounced, I&#39;m now forwarding to the proper list address =
rather than the possibly-bogus google-groups alias.<br><br><div class=3D"gm=
ail_quote">---------- Forwarded message ----------<br>From: <b class=3D"gma=
il_sendername">Tony Garnock-Jones</b> <span dir=3D"ltr">&lt;<a href=3D"mail=
to:tonygarnockjones%2Brabbitmq at gmail.com">tonygarnockjones+rabbitmq at gmail.c=
om</a>&gt;</span><br>
Date: 26 May 2012 09:08<br>Subject: Re: [rabbitmq-discuss] Per-Connection F=
low Control -- The Case Against (Try #2)<br>To: Chip Salzenberg &lt;<a href=
=3D"mailto:rev.chip at gmail.com">rev.chip at gmail.com</a>&gt;<br>Cc: <a href=3D=
"mailto:rabbitmq-discuss at googlegroups.com">rabbitmq-discuss at googlegroups.co=
m</a><br>
<br><br>On 25 May 2012 18:57, Chip Salzenberg <span dir=3D"ltr">&lt;<a href=
=3D"mailto:rev.chip at gmail.com" target=3D"_blank">rev.chip at gmail.com</a>&gt;=
</span> wrote:<br><div class=3D"gmail_quote"><blockquote class=3D"gmail_quo=
te" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"=
>


<div>This is not acceptable.</div></blockquote><div><br></div><div>Why not?=
 I&#39;d be interested to learn what problems this is causing for you.</div=
><div><br></div><div>From one point of view, any time consumers exist but a=
re not keeping up with offered traffic is a good time to throttle the produ=
cers. Perhaps call this the &quot;steady state&quot; point of view - I&#39;=
m unsure if it has a better name already.</div>

<div><br></div><div>From another point of view - call this the &quot;bursty=
&quot; point of view, perhaps - the growth of queues is perfectly acceptabl=
e, whether consumers exist at the time or not.</div><div><br></div><div>

ISTM Rabbit makes a guess about whether the application is &quot;steady sta=
te&quot; or &quot;bursty&quot;, choosing &quot;steady state&quot; all the t=
ime. Rabbit team, is this the case? Is there a way of configuring the flow =
control to permit unbounded queue growth to support the &quot;bursty&quot; =
case? Or do I have the wrong end of the stick entirely?</div>
<div class=3D"im">
<div>=C2=A0</div><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8=
ex;border-left:1px #ccc solid;padding-left:1ex"><div>1. A client is publish=
ing 1.5K/sec to each of four exchanges, each of which has a queue.</div>
<div>2. There are no consumers. =C2=A0Therefore the queue is growing.</div>=
<div>3. RMQ does not stop this. =C2=A0&quot;Flow control&quot; does not tri=
gger.</div><div>4. The consumers appear to begin to tear down the backlog.<=
/div>

<div>
5. RMQ per-connection flow control suddenly decides that now there are some=
 consumers, now it has a reason to throttle the sender.</div><div>6. If the=
 consumers had not shown up, the producer would not have been blocked.</div=
>

</blockquote><div><br></div></div><div>7. The consumers drain some of the m=
essages from the queues.</div><div>8. The producers are unblocked.</div><di=
v>9. Profit!!!</div><div><br></div><div>Regards,</div><div>=C2=A0 Tony</div=
>
<div><br>
</div></div>

</div><br><br clear=3D"all"><div><br></div>-- <br>Tony Garnock-Jones<br><a =
href=3D"mailto:tonygarnockjones at gmail.com" target=3D"_blank">tonygarnockjon=
es at gmail.com</a><br><a href=3D"http://homepages.kcbbs.gen.nz/tonyg/" target=
=3D"_blank">http://homepages.kcbbs.gen.nz/tonyg/</a><br>


--14dae93403d7eb63fb04c0ec0197--

From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.20.1339576057.2884.rabbitmq-discuss@lists.rabbitmq.com>

the Erlang distributed networking not working on windows 2003 64bit.
This platform is sufficiently rare that no-one else has reported this
problem for Erlang, but I see there was a similar report in Wireshark
caused by a library ordering problem:

https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=5160#c16

If you can find the shortest set of steps that provokes the error then
that should be enough to give the Erlang developers a handle on the
problem. I would expect these commands to cause a failure - can you
confirm? Make sure the Erlang bin directory is in your PATH:

werl -sname testnode@%COMPUTERNAME%
werl -sname foo -remsh testnode@%COMPUTERNAME%


If you need a working RabbitMQ broker in the meantime then consider
installing the 32bit version of Erlang. I not expect it to suffer from
the same problem.



-Emile



From bogus@does.not.exist.com  Thu Feb 16 03:44:05 2012
From: bogus@does.not.exist.com ()
Date: Thu, 16 Feb 2012 03:44:05 -0000
Subject: No subject
Message-ID: <mailman.21.1339718424.2884.rabbitmq-discuss@lists.rabbitmq.com>

now) caused by shovel can not find remote rabbitMQ host name.
This problem will also kill my producer script ... since it\'ll fail to
connect to local RabbitMQ server.

Kindly please give me your enlightment to solve this problem.


Sincerely
-bino-


