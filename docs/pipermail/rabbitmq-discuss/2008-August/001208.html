<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ/AMQP understanding
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ/AMQP%20understanding&In-Reply-To=269388e30808220725o157501ffua477768b194e90d6%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001205.html">
   <LINK REL="Next"  HREF="001211.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ/AMQP understanding</H1>
    <B>Torben Hoffmann</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ/AMQP%20understanding&In-Reply-To=269388e30808220725o157501ffua477768b194e90d6%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] RabbitMQ/AMQP understanding">torben.lehoff at googlemail.com
       </A><BR>
    <I>Fri Aug 22 21:05:03 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001205.html">[rabbitmq-discuss] RabbitMQ/AMQP understanding
</A></li>
        <LI>Next message: <A HREF="001211.html">[rabbitmq-discuss] RabbitMQ/AMQP understanding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1208">[ date ]</a>
              <a href="thread.html#1208">[ thread ]</a>
              <a href="subject.html#1208">[ subject ]</a>
              <a href="author.html#1208">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Aug 22, 2008 at 4:25 PM, Ben Hood &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">0x6e6562 at gmail.com</A>&gt; wrote:

&gt;<i> Torben,
</I>&gt;<i>
</I>&gt;<i> On Fri, Aug 22, 2008 at 2:31 PM, Torben Hoffmann
</I>&gt;<i> &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">torben.lehoff at googlemail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Not sure what a MOM system is, but I am trying to map the functionality
</I>&gt;<i> of a
</I>&gt;<i> &gt; legacy system to AMQP since I think it could save a lot of effort and
</I>&gt;<i> money.
</I>&gt;<i>
</I>&gt;<i> MOM = Message-oriented middleware
</I>&gt;<i>
</I>&gt;<i> &gt; For my basic problem I would like to have a queue for the group G that I
</I>&gt;<i> can
</I>&gt;<i> &gt; send to and then all members of the queue (bar the sender) will receive
</I>&gt;<i> that
</I>&gt;<i> &gt; message.
</I>&gt;<i>
</I>&gt;<i> As indicated in my previous mail, one way this can be achieved is
</I>&gt;<i> using a fanout exchange.
</I>&gt;<i>
</I>&gt;<i> [Taken from the spec] The fanout exchange type works as follows:
</I>&gt;<i>
</I>&gt;<i> 1. A message queue binds to the exchange with no arguments.
</I>&gt;<i> 2. A publisher sends the exchange a message.
</I>&gt;<i> 3. The message is passed to the message queue unconditionally.
</I>&gt;<i>
</I>&gt;<i> Here is a simple example using the Ruby client for AMQP:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://github.com/tmm1/amqp/tree/master/examples/mq/clock.rb">http://github.com/tmm1/amqp/tree/master/examples/mq/clock.rb</A>
</I>&gt;<i>
</I>&gt;<i> Although this is a Ruby example, the basic principle of a creating a
</I>&gt;<i> queue, binding it to an exchange and subscribing a consumer to it hold
</I>&gt;<i> true of any client language. I just used this as an example because it
</I>&gt;<i> is a quick link.
</I>

Good example - that part is now under control for me.


&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; It does not matter if I have one or more logical instances, but from a
</I>&gt;<i> &gt; architectural perspective I think that it would be best to have a single
</I>&gt;<i> &gt; logical instance so that I could utilise the distribution mechanisms of
</I>&gt;<i> &gt; RabbitMQ without knowing about the topology at the application level.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If I have more than one server how would the messages be distributed?
</I>&gt;<i>
</I>&gt;<i> This is achieved using OTP distribution mechanisms with some
</I>&gt;<i> AMQP/Rabbit-specific optimizations between nodes.
</I>&gt;<i>
</I>&gt;<i> In *very* loose terms, a client opens a channel on a particular node
</I>&gt;<i> and this broker-side channel creates a communication link between
</I>&gt;<i> itself and the underlying queue *instance*, wherever that may
</I>&gt;<i> physically reside. If it declares a queue that doesn't already exist,
</I>&gt;<i> the queue will be created locally, if it already exists it *may*
</I>&gt;<i> already reside on another node, but OTP message passing keeps this
</I>&gt;<i> transparent.
</I>

Good - this is what I gather from the documentation. It fits my needs rather
well.


&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; If I have a AMQP server at each of my machines and user A sends a message
</I>&gt;<i> to
</I>&gt;<i> &gt; the group G how would that message be routed to  B and C? How should the
</I>&gt;<i> &gt; servers be connected/configured to allow that routing?
</I>&gt;<i>
</I>&gt;<i> G would be the name an exchange and B &amp; C create queues and bind them
</I>&gt;<i> to the exchange G.
</I>&gt;<i>
</I>&gt;<i> As indicated above this could be a simple fanout, but a direct
</I>&gt;<i> exchange with multiple bindings would work as well.
</I>

Okay, I did not think of this type of solution, but I think this would work
just as fine. So either I get a lot of queues or a lot of exchanges
depending on how I choose to represent the groups. I will let that be up to
a practical test on a couple of machines.


&gt;<i>
</I>&gt;<i> Note that you do not necessarily need an AMQP instance on machine that
</I>&gt;<i> clients run on. Multiple remote clients can connect to a single broker
</I>&gt;<i> instance.
</I>

Yes, but for the sake of performance I think that the more I can distribute
the work load the better.


&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Note that I could have hundreds of machines but I will send the message
</I>&gt;<i> to
</I>&gt;<i> &gt; the few of them that has a member of the group registered at the machine.
</I>&gt;<i>
</I>&gt;<i> When you say you have hundreds of machines, do you mean machines that
</I>&gt;<i> you will use to run consumer processes on?
</I>

Indeed! The machines are already there and cannot be removed, but with AMQP
I think that I can let them do more of the work in my system and remove all
the machines that connect the machines where the consumer processes run.


&gt;<i>
</I>&gt;<i> The size of your broker cluster will depend (amongst other factors) on
</I>&gt;<i> the amount of messages you need the system to be able to handle.
</I>

A system today consisting of 100 &quot;consumer&quot; machines plus some inner
machines handles in the neighbourhood of 3,000 message per second.
So when I aim to remove the inner machines that does the most of the
intelligence regarding routing of the messages I expect to get rid of the
inner bottleneck and thus get a higher performance... or at least one that
is closer to the limits of the &quot;consumer&quot; machines which I think is a better
constraint.

Sorry if I sound a bit vague at times but I have only just read about AMQP
and are now trying to get the concepts for a new AMQP based architecture in
place.

Cheers,
Torben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080822/20ca0184/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080822/20ca0184/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001205.html">[rabbitmq-discuss] RabbitMQ/AMQP understanding
</A></li>
	<LI>Next message: <A HREF="001211.html">[rabbitmq-discuss] RabbitMQ/AMQP understanding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1208">[ date ]</a>
              <a href="thread.html#1208">[ thread ]</a>
              <a href="subject.html#1208">[ subject ]</a>
              <a href="author.html#1208">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
