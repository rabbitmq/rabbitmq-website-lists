<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Load balancing with multiple consumers on a	single queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Load%20balancing%20with%20multiple%20consumers%20on%20a%0A%09single%20queue&In-Reply-To=OFB6A00138.536BBD2C-ON80257497.002EF08F-80257497.002FB0E4%40Edftrading.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001120.html">
   <LINK REL="Next"  HREF="001118.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Load balancing with multiple consumers on a	single queue</H1>
    <B>Nathan Oorloff</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Load%20balancing%20with%20multiple%20consumers%20on%20a%0A%09single%20queue&In-Reply-To=OFB6A00138.536BBD2C-ON80257497.002EF08F-80257497.002FB0E4%40Edftrading.com"
       TITLE="[rabbitmq-discuss] Load balancing with multiple consumers on a	single queue">nathan at comvine.com
       </A><BR>
    <I>Fri Aug  1 05:17:06 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001120.html">[rabbitmq-discuss] Information about EndlessSummerOfCode
</A></li>
        <LI>Next message: <A HREF="001118.html">[rabbitmq-discuss] Load balancing with multiple consumers on a	single queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1116">[ date ]</a>
              <a href="thread.html#1116">[ thread ]</a>
              <a href="subject.html#1116">[ subject ]</a>
              <a href="author.html#1116">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

Alexis: although your solution isn't ideal, the amount of processing a task
requires is roughly related to the size so that might be a good option.
Where can I find the options for doing the advanced routing rules? So far
I've only seen routing based on the routing_key property.

Re: Basic reject, it appears to be implemented in the library I'm using and
I've done some initial tests in which the reject seems to work right up
until the last message where I get the following back from the server: (503,
u'COMMAND_INVALID', (60, 90), 'Channel.basic_reject'). I'll have to
test/look into this more, it could just be a library issue. However, we
would then have to make our clients multi-threaded, one thread to reject the
new messages as they come in and another to deal with the current job. This
is a viable solution but not a great one, hoping to use the cancel instead.

Finally, after my initial tests the consume, ack message, cancel, deal with
message, send response, re-consume system worked perfectly, until I upped
the message throughput and the client library gets a basic_deliver instead
of the basic_cancel_ok it expected. I edited the library to not error in
this instance and to ignore messages after the cancel had been sent however
when I start the consume again I have a client waiting for a message to
finish getting delivered it seems which never happens. Tonyg (on irc) said
for the cancel to work properly I'd probably have to cancel the
channel/connection rather than just doing a basic_cancel. Which I've tried
with limited success (it appears to work, however I'm running into the
unexpected response issue again so I'll have to check the client code).

I might give &quot;recover&quot; a test. At first glance it looks like I should run it
after I've ack'd the message I'm about to process and issued the cancel?

Nathan.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080801/daf493ce/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080801/daf493ce/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001120.html">[rabbitmq-discuss] Information about EndlessSummerOfCode
</A></li>
	<LI>Next message: <A HREF="001118.html">[rabbitmq-discuss] Load balancing with multiple consumers on a	single queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1116">[ date ]</a>
              <a href="thread.html#1116">[ thread ]</a>
              <a href="subject.html#1116">[ subject ]</a>
              <a href="author.html#1116">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
