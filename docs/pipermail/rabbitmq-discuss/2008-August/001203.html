<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ/AMQP understanding
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ/AMQP%20understanding&In-Reply-To=269388e30808220605q3406b1cfjd3bd703434d71a09%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001202.html">
   <LINK REL="Next"  HREF="001205.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ/AMQP understanding</H1>
    <B>Torben Hoffmann</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ/AMQP%20understanding&In-Reply-To=269388e30808220605q3406b1cfjd3bd703434d71a09%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] RabbitMQ/AMQP understanding">torben.lehoff at googlemail.com
       </A><BR>
    <I>Fri Aug 22 14:31:11 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001202.html">[rabbitmq-discuss] RabbitMQ/AMQP understanding
</A></li>
        <LI>Next message: <A HREF="001205.html">[rabbitmq-discuss] RabbitMQ/AMQP understanding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1203">[ date ]</a>
              <a href="thread.html#1203">[ thread ]</a>
              <a href="subject.html#1203">[ subject ]</a>
              <a href="author.html#1203">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Aug 22, 2008 at 3:05 PM, Ben Hood &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">0x6e6562 at gmail.com</A>&gt; wrote:

&gt;<i> Torben,
</I>&gt;<i>
</I>&gt;<i> On Fri, Aug 22, 2008 at 1:57 PM, Torben Hoffmann
</I>&gt;<i> &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">torben.lehoff at googlemail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Here is the basic problem I need to solve - see attached picture:
</I>&gt;<i> &gt; A, B and C are all members of the same group G and when they send
</I>&gt;<i> messages
</I>&gt;<i> &gt; to each other in the group the group ID is used as the target address in
</I>&gt;<i> the
</I>&gt;<i> &gt; message.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; (In case the attached picture does not arrive: A is located at machine
</I>&gt;<i> M1, B
</I>&gt;<i> &gt; @ M2 and C @ M3.)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So when A sends Msg to the group G it has to be routed to B and C where
</I>&gt;<i> ever
</I>&gt;<i> &gt; they may be. As you can see A sends Msg to M1 which notices that it is
</I>&gt;<i> &gt; targeted to the group G and M1 then finds out that there are group
</I>&gt;<i> members
</I>&gt;<i> &gt; of G at the machines M2 and M3, hence it sends Msg to M2 and M3. At the
</I>&gt;<i> &gt; receiving machines - M2 and M3 - the message is then delivered to the
</I>&gt;<i> &gt; members of the group attached to the machine.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This *sounds* like a simple fanout exchange scenario. Fanout exchanges
</I>&gt;<i> are one of the basic exchange types in AMQP. It could also be achieved
</I>&gt;<i> using other exchange types, depending on what the specific
</I>&gt;<i> requirements are.
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The na&#239;ve approach would be to create a queue for the group G and have
</I>&gt;<i> all
</I>&gt;<i> &gt; group members subscribe to that queue.
</I>&gt;<i> &gt; Questions:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;    1. Does the sender receives its own message though the queue?
</I>&gt;<i>
</I>&gt;<i> Not quite sure what you mean with this. Are you asking whether a
</I>&gt;<i> producer gets an echo of each message it sends by default? In general
</I>&gt;<i> nobody will receive a message unless it is consuming from a queue that
</I>&gt;<i> messages are routed to.
</I>

Alexis added the last bit of explanation so now I know that I can send to a
queue where I am a consumer without getting my own messages.


&gt;<i> &gt;    2. Is there a way to notify clients like B and C that there is a
</I>&gt;<i> message
</I>&gt;<i> &gt; for them in one of their queues? Or do you have to poll the queue to find
</I>&gt;<i> &gt; out if there is something for you? (Basically this is a question of using
</I>&gt;<i> a
</I>&gt;<i> &gt; interrupt like thing vs polling.)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> If a client subscribes to a queue, the channel will deliver messages
</I>&gt;<i> to it as and when they are routed, so there is no need to poll
</I>&gt;<i> explicitly. If for some reason you need to poll, there is a method
</I>&gt;<i> called basic.get which allows you to poll a queue.
</I>

This is brilliant - for sanity I would really like to avoid polling the
queue since the non-polling setup makes my architecture a lot nicer.


&gt;<i>
</I>&gt;<i>
</I>&gt;<i> BTW, are you asking this question in the context of the API of a MOM
</I>&gt;<i> system that you have used in the past?
</I>

Not sure what a MOM system is, but I am trying to map the functionality of a
legacy system to AMQP since I think it could save a lot of effort and money.


&gt;<i> &gt;
</I>&gt;<i> &gt; Now for the deployment: I cannot use a single AMQP server to handle all
</I>&gt;<i> of
</I>&gt;<i> &gt; this since the load would be too high to meet the strict performance
</I>&gt;<i> &gt; requirements in place so some sort of distribution of the work must be
</I>&gt;<i> done.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; My initial understanding leads me to say that for the attached problem I
</I>&gt;<i> &gt; should create a cluster consisting of M1, M2 and M3 and then just let
</I>&gt;<i> &gt; RabbitMQ deal with all the nitty gritty details.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You can set up a cluster of Rabbit broker instances. This is explained
</I>&gt;<i> in more detail in the clustering guide:
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/clustering.html">http://www.rabbitmq.com/clustering.html</A>
</I>&gt;<i>
</I>&gt;<i> &gt; Is that a correct understanding of how to use RabbitMQ to address the
</I>&gt;<i> basic
</I>&gt;<i> &gt; problem?
</I>&gt;<i>
</I>&gt;<i> Without wanting to assume anything from the attachment, the impression
</I>&gt;<i> arises that you are thinking of an MQ-Series topology with
</I>&gt;<i> transmission queues.
</I>&gt;<i>
</I>&gt;<i> You don't necessarily need to do that with AMQP. You could treat a
</I>&gt;<i> broker or cluster of brokers as a single logical instance that clients
</I>&gt;<i> connect to in order to subscribe to queues.
</I>

For my basic problem I would like to have a queue for the group G that I can
send to and then all members of the queue (bar the sender) will receive that
message.
It does not matter if I have one or more logical instances, but from a
architectural perspective I think that it would be best to have a single
logical instance so that I could utilise the distribution mechanisms of
RabbitMQ without knowing about the topology at the application level.

If I have more than one server how would the messages be distributed?
If I have a AMQP server at each of my machines and user A sends a message to
the group G how would that message be routed to  B and C? How should the
servers be connected/configured to allow that routing?

Note that I could have hundreds of machines but I will send the message to
the few of them that has a member of the group registered at the machine.

Cheers,
Torben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080822/985e2c74/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080822/985e2c74/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001202.html">[rabbitmq-discuss] RabbitMQ/AMQP understanding
</A></li>
	<LI>Next message: <A HREF="001205.html">[rabbitmq-discuss] RabbitMQ/AMQP understanding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1203">[ date ]</a>
              <a href="thread.html#1203">[ thread ]</a>
              <a href="subject.html#1203">[ subject ]</a>
              <a href="author.html#1203">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
