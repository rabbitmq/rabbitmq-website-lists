<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20performance&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001260.html">
   <LINK REL="Next"  HREF="001262.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] performance</H1>
    <B>Ryan Pratt</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20performance&In-Reply-To="
       TITLE="[rabbitmq-discuss] performance">ryan.pratt at gmail.com
       </A><BR>
    <I>Fri Aug 29 23:17:20 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001260.html">[rabbitmq-discuss] Stomp
</A></li>
        <LI>Next message: <A HREF="001262.html">[rabbitmq-discuss] performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1261">[ date ]</a>
              <a href="thread.html#1261">[ thread ]</a>
              <a href="subject.html#1261">[ subject ]</a>
              <a href="author.html#1261">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have been running some small performance tests and have not seen the
throughput I was expecting. I want to see if my numbers are similar to what
others have seen, or if something else (setup, etc) is causing my
performance to be not so good.

I have a single broker running with a sender and receiver all on the same
machine. The machine is a dual quad core 2.66 GHz Xeon with 8 gigs of
memory. I have to throttle the sender to keep the queue from backing way up,
which then causes the broker to basically go to a crawl. The sender sends 40
messages then sleeps for 5 millseconds, and loops doing this continually. If
a run a receiver that continuously calls basicGet I am seeing a max of about
4000 messages per second. The message I am sending is &quot;Hello, World!&quot;
If I add a second Receiver on the same queue I end up getting it up to about
6000 messages per second. 3 Receivers is about the same as 2. Maybe my
expectations are off but I was hoping to see at least 20000 messages per
second going through. The sender and receiver code is attached. Is there
anything obviously wrong with my setup, or is this throughput what I should
expect to see? Thanks

package com.optionshouse.test;

import java.io.IOException;
import com.rabbitmq.client.*;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.AMQP;
import java.util.*;

public class TestSender {

    public static boolean doStop = false;

    public static void main(String[] args) {

        try {
                ConnectionParameters params = new ConnectionParameters();
                params.setUsername(&quot;guest&quot;);
                params.setPassword(&quot;guest&quot;);
                params.setVirtualHost(&quot;/&quot;);
                params.setRequestedHeartbeat(0);
                ConnectionFactory factory = new ConnectionFactory(params);
                Connection conn = factory.newConnection(&quot;localhost&quot;, 5672);

                Channel channel = conn.createChannel();
                int ticket = channel.accessRequest(&quot;/data&quot;);
                channel.exchangeDeclare(ticket, &quot;TEST&quot;, &quot;direct&quot;);
                channel.queueDeclare(ticket, &quot;action.test&quot;);
                channel.queueBind(ticket, &quot;action.test&quot;, &quot;TEST&quot;,
&quot;action.test&quot;);

                byte[] messageBodyBytes = &quot;Hello, world!&quot;.getBytes();
int counter = 0;
                while (!doStop) {
                    channel.basicPublish(ticket, &quot;TEST&quot;, &quot;action.test&quot;,
null, messageBodyBytes);
                    counter++;

                    if (counter == 30) {
                    try {
                        counter = 0;
                        Thread.sleep(5);
                    }
                    catch (InterruptedException ex) {
                        ex.printStackTrace();
                    }
                    }
                }

        }
        catch (IOException ex) {
            ex.printStackTrace();
        }
    }

}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080829/29198ebe/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080829/29198ebe/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001260.html">[rabbitmq-discuss] Stomp
</A></li>
	<LI>Next message: <A HREF="001262.html">[rabbitmq-discuss] performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1261">[ date ]</a>
              <a href="thread.html#1261">[ thread ]</a>
              <a href="subject.html#1261">[ subject ]</a>
              <a href="author.html#1261">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
