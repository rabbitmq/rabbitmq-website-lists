<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] questions about RabbitMQ linear scalability
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20questions%20about%20RabbitMQ%20linear%20scalability&In-Reply-To=%3CF1FF3B28-FB92-4051-9571-288271C3268D%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029503.html">
   <LINK REL="Next"  HREF="029507.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] questions about RabbitMQ linear scalability</H1>
    <B>Zhihui Jiao</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20questions%20about%20RabbitMQ%20linear%20scalability&In-Reply-To=%3CF1FF3B28-FB92-4051-9571-288271C3268D%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] questions about RabbitMQ linear scalability">jzhihui521 at gmail.com
       </A><BR>
    <I>Thu Aug 22 05:51:44 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029503.html">[rabbitmq-discuss] questions about RabbitMQ linear scalability
</A></li>
        <LI>Next message: <A HREF="029507.html">[rabbitmq-discuss] questions about RabbitMQ linear scalability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29504">[ date ]</a>
              <a href="thread.html#29504">[ thread ]</a>
              <a href="subject.html#29504">[ subject ]</a>
              <a href="author.html#29504">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I don't think RabbitMQ will have linear scalability in any case(ha, non-ha):
In ha mode, message are broadcast to multiple nodes, so the more node you have, the worse performance you get 
if your setting is to ha all nodes int the cluster;
In non-ha mode, message data only reside in one queue on only one node, but queue meta are spread to all nodes
in the cluster, so if adding more nodes, you may got some performance improvement, but not linear improvement.

Zhihui Jiao

&#22312; 2013-8-22&#65292;&#19978;&#21320;11:15&#65292;Junius Wang &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">wangjunbo924 at gmail.com</A>&gt; &#20889;&#36947;&#65306;

&gt;<i> I&#8217;m sorry to pick this email again because we really want to see any comments from all of you.
</I>&gt;<i> The key point is that we try to prove the linear scaling of RabbitMQ high availability queues but no lucky. What we see are that:
</I>&gt;<i> 1.       The throughput of two node cluster is 50%-60% worse than a single node broker.
</I>&gt;<i> 2.       Adding more node did have improvement on throughput but we only got 25% improvement(throughput of 3 node cluster is 25% better than 2 node cluster. 4 node cluster is 25% better than 3 node cluster too). What we expected is a 45-degree line, that means when 2 nodes are used the throughput is double. With 3 nodes, then triple.
</I>&gt;<i>  
</I>&gt;<i> Can anybody give any advice? What&#8217;s the best practice in using RabbitMQ mirror queues?
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> From: Junius Wang [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">wangjunbo924 at gmail.com</A>] 
</I>&gt;<i> Sent: Thursday, August 08, 2013 6:50 PM
</I>&gt;<i> To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> Subject: questions about RabbitMQ linear scalability
</I>&gt;<i>  
</I>&gt;<i> Hi guys,
</I>&gt;<i> Our team are performing some performance tests and we try to prove that we can get linear scalability of our services, it means when we add more RabbitMQ nodes, the throughputs should increase as well.  We use RabbitMQ as our backend message system. However, when we add more RabbitMQ servers to cluster, the throughput decreases which is not expected and I would like to ask for your help. Following are the details, any comments are appreciated.
</I>&gt;<i>  
</I>&gt;<i> We setup the our testing environment on AWS. All instances, including app servers, RabbitMQ servers and Jmeter servers(host test tool Jmeter 2.7), are of  type m1.xlarge(8ECUs, 4 Cores and 15Gib memory). For RabbitMQ servers, &#8220;EBS optimized&#8221; are enabled, and the PIOPs are set to 2000 to improve the disc read/write speed. There are two ELBs. One for App servers and the another for RabbitMQ servers.  Here are some more environment configurations:
</I>&gt;<i> Instances Type
</I>&gt;<i> m1.xlarge
</I>&gt;<i> connect pool size for App servers
</I>&gt;<i> 40000
</I>&gt;<i> JVM args for App servers
</I>&gt;<i> -Xmx12G -Xms6G -XX:MaxPermSize=2G
</I>&gt;<i> App servers count
</I>&gt;<i> 2
</I>&gt;<i> Jmeter servers
</I>&gt;<i> 10
</I>&gt;<i> total concurrent users
</I>&gt;<i> 4000
</I>&gt;<i> PIOPs for RabbitMQ Servers
</I>&gt;<i> 2000
</I>&gt;<i> Consumer Prefetch Count
</I>&gt;<i> 1000
</I>&gt;<i> message size
</I>&gt;<i> 1KB
</I>&gt;<i> hipe_compile
</I>&gt;<i> FALSE
</I>&gt;<i>  
</I>&gt;<i> The designed topologic of broker:
</I>&gt;<i> &lt;image001.jpg&gt;
</I>&gt;<i> 1)      We create only one global topic exchange &#8220;events&#8221; to route all incoming messages. It&#8217;s durable.
</I>&gt;<i> 2)      There will be an event log queue which receive all messages with binding key &#8220;#&#8221;. It&#8217;s durable as well.
</I>&gt;<i> 3)      There will be several queues for our external services and each service queue may have several bindings to the global exchange which we called eventypes.
</I>&gt;<i> Actually In our test scenarios,  we create only one service queue and only one binding on this queue. Message publishers publish messages using the only binding routing key.  So in fact, every message resides on two queues: the event log queue and a test service queue. And all messages are persistent.
</I>&gt;<i>  
</I>&gt;<i> We start with 1 single RabbitMQ node. And then run different configurations with 2-RabbitMQ node cluster. For example ,1) change the node type 2) enable/disable mirrored queues(also called high available queue, showed as &#8220;ha&#8221; in the following tables). The test results shown as following:
</I>&gt;<i> configurations
</I>&gt;<i> Avg response time(ms)
</I>&gt;<i> Throughput(requests/sec)
</I>&gt;<i> 1 rabbitmq node
</I>&gt;<i> 1125
</I>&gt;<i> 2702.904
</I>&gt;<i> 2disc,ha
</I>&gt;<i> 2957
</I>&gt;<i> 1192.645
</I>&gt;<i> 1disc+1ram,ha
</I>&gt;<i> 3654
</I>&gt;<i> 998.126
</I>&gt;<i> 1disc+1ram,non-ha
</I>&gt;<i> 1110
</I>&gt;<i> 2799.826
</I>&gt;<i>  
</I>&gt;<i> 1015
</I>&gt;<i> 2720.422
</I>&gt;<i> 2disc,non-ha
</I>&gt;<i> 1289
</I>&gt;<i> 2570.826
</I>&gt;<i>  
</I>&gt;<i> 1080
</I>&gt;<i> 2845.821
</I>&gt;<i>  
</I>&gt;<i> 1118
</I>&gt;<i> 2802.278
</I>&gt;<i> We can see that, while two rabbitmq servers are used, we see no throughput improvement. This doesn&#8217;t make sense to me. To my understanding,  Here comes my questions:
</I>&gt;<i> 1.       What does RabbitMQ cluster scalability means exactly? Does it refer to the capacity of handing messages? The queue capacity? Or the message number?
</I>&gt;<i> 2.       The  mirrored queues seems to affect performance in a large scale. What&#8217;s the possible cause of this?
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/7bd45e06/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/7bd45e06/attachment.htm</A>&gt;
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029503.html">[rabbitmq-discuss] questions about RabbitMQ linear scalability
</A></li>
	<LI>Next message: <A HREF="029507.html">[rabbitmq-discuss] questions about RabbitMQ linear scalability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29504">[ date ]</a>
              <a href="thread.html#29504">[ thread ]</a>
              <a href="subject.html#29504">[ subject ]</a>
              <a href="author.html#29504">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
