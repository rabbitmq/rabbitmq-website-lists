<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Messages not getting moved to the Upstream Federation, only empty queue is getting created.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Messages%20not%20getting%20moved%20to%20the%20Upstream%0A%20Federation%2C%20only%20empty%20queue%20is%20getting%20created.&In-Reply-To=%3C1376289948933-28726.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029245.html">
   <LINK REL="Next"  HREF="029229.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Messages not getting moved to the Upstream Federation, only empty queue is getting created.</H1>
    <B>k.madnani84</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Messages%20not%20getting%20moved%20to%20the%20Upstream%0A%20Federation%2C%20only%20empty%20queue%20is%20getting%20created.&In-Reply-To=%3C1376289948933-28726.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] Messages not getting moved to the Upstream Federation, only empty queue is getting created.">k.madnani84 at gmail.com
       </A><BR>
    <I>Mon Aug 12 07:45:48 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029245.html">[rabbitmq-discuss] ANN RabbitMQ tutorials ported to Clojure
</A></li>
        <LI>Next message: <A HREF="029229.html">[rabbitmq-discuss] Messages not getting moved to the Upstream Federation, only empty queue is getting created.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29228">[ date ]</a>
              <a href="thread.html#29228">[ thread ]</a>
              <a href="subject.html#29228">[ subject ]</a>
              <a href="author.html#29228">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I have two clusters Cluster1 &amp; Cluster2.Cluster2 has a federation Upstream
to Cluster 1 and there is a HA-Federation-policy that whatever reources end
with pattern '.federate' will get this policy applied.
When i run my Java client and hit Cluster2, a Federation Exchange and a
Federation Queue bound it it gets created in Cluster1 but the queue is
empty.The newly created queue in Cluster2 does have message but the
fedration queue in Cluster1 doesnt have it.
Is my understanding of Federation is wrong?I believe thats how it should
happen that message should move from Cluster 2 to Cluster1 if i have a
upstream of Cluster 1 in cluster 2.

So the problem is the queue &quot;queue.federate&quot; in Cluster2 as shown below has
2 msgs but queue in Cluster1 &quot;federation: exchange.federate -&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">CLUSTER2 at zldv0435.vci.com</A>&quot; has 0 msgs. 

Here is the configuration of Cluster 2.&quot;exchange.federate&quot; is the new
exchange created with queue &quot;queue.federate&quot;:
 /opt/app/rabbitmq/sbin/rabbitmqctl list_parameters
Listing runtime parameters ...
federation      local-nodename  &quot;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">CLUSTER2 at zldv0435.vci.com</A>&quot;
federation      local-username  &quot;rbtadmin&quot;
federation-upstream     HA-upstream-CLUSTER1-adminvhost
{&quot;uri&quot;:&quot;<A HREF="amqp://feduser:myFedPassword@zldv0433.vci.com:5691&quot;,&quot;max-hops&quot;:1}">amqp://feduser:myFedPassword@zldv0433.vci.com:5691&quot;,&quot;max-hops&quot;:1}</A>
...done.

 /opt/app/rabbitmq/sbin/rabbitmqctl list_policies
Listing policies ...
/       HA-Federation-adminvhost        \\.federate$   
{&quot;federation-upstream-set&quot;:&quot;all&quot;}       0
/       HA-Mirror-Federate-adminvhost   \\.fedMirror$  
{&quot;federation-upstream-set&quot;:&quot;all&quot;,&quot;ha-mode&quot;:&quot;all&quot;}       2
/       HA-Mirror-adminvhost    \\.mirror$      {&quot;ha-mode&quot;:&quot;all&quot;}       1
...done.


/opt/app/rabbitmq/sbin/rabbitmqctl list_exchanges
Listing exchanges ...
        direct
amq.direct      direct
amq.fanout      fanout
amq.headers     headers
amq.match       headers
amq.rabbitmq.log        topic
amq.rabbitmq.trace      topic
amq.topic       topic
exchange.federate       fanout
...done.

/opt/app/rabbitmq/sbin/rabbitmqctl list_queues
Listing queues ...
queue.federate  2
...done.


Here is the list of queues and exchanges in Cluster1:

/opt/app/rabbitmq/sbin/rabbitmqctl list_exchanges
Listing exchanges ...
        direct
amq.direct      direct
amq.fanout      fanout
amq.headers     headers
amq.match       headers
amq.rabbitmq.log        topic
amq.rabbitmq.trace      topic
amq.topic       topic
exchange.federate       fanout
federation: exchange.federate -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">CLUSTER2 at zldv0435.vci.com</A> A       
x-federation-upstream

 /opt/app/rabbitmq/sbin/rabbitmqctl list_queues
Listing queues ...
federation: exchange.federate -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">CLUSTER2 at zldv0435.vci.com</A>  0





--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Messages-not-getting-moved-to-the-Upstream-Federation-only-empty-queue-is-getting-created-tp28726.html">http://rabbitmq.1065348.n5.nabble.com/Messages-not-getting-moved-to-the-Upstream-Federation-only-empty-queue-is-getting-created-tp28726.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029245.html">[rabbitmq-discuss] ANN RabbitMQ tutorials ported to Clojure
</A></li>
	<LI>Next message: <A HREF="029229.html">[rabbitmq-discuss] Messages not getting moved to the Upstream Federation, only empty queue is getting created.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29228">[ date ]</a>
              <a href="thread.html#29228">[ thread ]</a>
              <a href="subject.html#29228">[ subject ]</a>
              <a href="author.html#29228">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
