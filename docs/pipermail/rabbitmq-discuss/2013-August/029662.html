<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Using SelectConnection to simulate a blocking	&quot;basic_get&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Using%20SelectConnection%20to%20simulate%20a%20blocking%0A%09%22basic_get%22&In-Reply-To=%3CCACLE7ix8%2BKT%3DqJ8H68Sit_Okzk%2BFWiw%3DawKaP%3D6g9fNaAVb_7g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029664.html">
   <LINK REL="Next"  HREF="029663.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Using SelectConnection to simulate a blocking	&quot;basic_get&quot;</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Using%20SelectConnection%20to%20simulate%20a%20blocking%0A%09%22basic_get%22&In-Reply-To=%3CCACLE7ix8%2BKT%3DqJ8H68Sit_Okzk%2BFWiw%3DawKaP%3D6g9fNaAVb_7g%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Using SelectConnection to simulate a blocking	&quot;basic_get&quot;">mpietrek at skytap.com
       </A><BR>
    <I>Wed Aug 28 20:03:42 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029664.html">[rabbitmq-discuss] Unable to Start Cluster Nodes on Windows
</A></li>
        <LI>Next message: <A HREF="029663.html">[rabbitmq-discuss] Using SelectConnection to simulate a	blocking &quot;basic_get&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29662">[ date ]</a>
              <a href="thread.html#29662">[ thread ]</a>
              <a href="subject.html#29662">[ subject ]</a>
              <a href="author.html#29662">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>(I know this is Pika, rather than specifically RabbitMQ, but figure there's
a broader audience here.)

In our architecture, I'm investigating moving away from polling with
basic_get, and towards using basic_consume.

However, our twist is that our overall design doesn't just let us call
connection.io.loop.start() and handle all our messages inside the
registered handler like all the example code does.

What I'd like to do is something like the following, but I can't quite
figure out the combination of calls/callbacks to make it work.

Goals:

   - Create a &quot;blocking&quot; routine that either returns a message or &quot;None&quot; if
   the whole system is shutting down:
   - Let the broker push 1 message/time to us, rather than us polling via
   basic_get.


Here's my admittedly incomplete thoughts on how this might work:

   - Create a SelectConnection instance
   - In the blocking read logic, use basic_consume to tell the broker it's
   OK to send a message to us now (prefetch=1).
   - call connection.ioloop.start()
   - In the message handler, save off the message, then send a basic_cancel
   to tell the broker &quot;No more for now, thanks!&quot;
   - The connection.ioloop.start() returns to the caller
   - Return the saved message to the caller.
   - Wash, rinse, repeat...

Is this sane? Are there examples of how I might do this?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/108d809b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130828/108d809b/attachment.htm</A>&gt;
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029664.html">[rabbitmq-discuss] Unable to Start Cluster Nodes on Windows
</A></li>
	<LI>Next message: <A HREF="029663.html">[rabbitmq-discuss] Using SelectConnection to simulate a	blocking &quot;basic_get&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29662">[ date ]</a>
              <a href="thread.html#29662">[ thread ]</a>
              <a href="subject.html#29662">[ subject ]</a>
              <a href="author.html#29662">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
