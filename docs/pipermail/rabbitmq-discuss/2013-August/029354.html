<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Question on RabbitMQ and file I/O	characteristics
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Question%20on%20RabbitMQ%20and%20file%20I/O%0A%09characteristics&In-Reply-To=%3CCACLE7iyQp_y5TZqpxv_Xh9OjixFSs8jPJU%3D7JK_gbdxhq1dS7Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029136.html">
   <LINK REL="Next"  HREF="029408.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Question on RabbitMQ and file I/O	characteristics</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Question%20on%20RabbitMQ%20and%20file%20I/O%0A%09characteristics&In-Reply-To=%3CCACLE7iyQp_y5TZqpxv_Xh9OjixFSs8jPJU%3D7JK_gbdxhq1dS7Q%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Question on RabbitMQ and file I/O	characteristics">mpietrek at skytap.com
       </A><BR>
    <I>Thu Aug 15 18:00:21 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029136.html">[rabbitmq-discuss] Question on RabbitMQ and file I/O	characteristics
</A></li>
        <LI>Next message: <A HREF="029408.html">[rabbitmq-discuss] Question on RabbitMQ and file I/O	characteristics
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29354">[ date ]</a>
              <a href="thread.html#29354">[ thread ]</a>
              <a href="subject.html#29354">[ subject ]</a>
              <a href="author.html#29354">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry for coming back to this thread so much after your reply - Was off on
vacation for a week.

&gt;<i> But your ping-pong test is doing the same thing! If it can't send another
</I>message until the previous one has been received, we can't coalesce
together two writes.

Understood - Back to the original question, in this scenario would you
expect each written message to cause approximately four disk writes?
Naively, I'd expect it to be closer to two or three writes.

It's fine if so - I just want to ensure that our experimental data matches
up with your expert opinion on what should be happening.

Thanks much,

Matt





On Wed, Aug 7, 2013 at 3:22 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 06/08/13 18:42, Matt Pietrek wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> The net effect is that messages 'ping-pong' between the two ioloop
</I>&gt;&gt;<i> threads as fast as possible. In the 'main' ioloop init, it sends an
</I>&gt;&gt;<i> initial message to kick things off.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &lt;snip&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  I also have a global switch (USE_TRANSACTIONS) that lets me switch
</I>&gt;&gt;<i> between using transactions and not. When set, it adds tx_select() when
</I>&gt;&gt;<i> opening the channels and tx_commit after publishing messages. For the
</I>&gt;&gt;<i> tests I was running, I wasn't using transactions. If I do run with
</I>&gt;&gt;<i> transactions the numbers are very similar (surprising I know, but I
</I>&gt;&gt;<i> stepped through the code to verify that the tx_xxx calls are only made
</I>&gt;&gt;<i> when I intend them to be.)
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Ah, I see. The thing is that transactions are quite lightweight in and of
</I>&gt;<i> themselves, the reason they tend to slow things down is they form a barrier
</I>&gt;<i> across which we can't coalesce writes / have to wait for a synchronous
</I>&gt;<i> network round trip.
</I>&gt;<i>
</I>&gt;<i> But your ping-pong test is doing the same thing! If it can't send another
</I>&gt;<i> message until the previous one has been received, we can't coalesce
</I>&gt;<i> together two writes. And it also ensures there's only one message on the
</I>&gt;<i> wire at once.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/2cd00ad6/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130815/2cd00ad6/attachment.htm</A>&gt;
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029136.html">[rabbitmq-discuss] Question on RabbitMQ and file I/O	characteristics
</A></li>
	<LI>Next message: <A HREF="029408.html">[rabbitmq-discuss] Question on RabbitMQ and file I/O	characteristics
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29354">[ date ]</a>
              <a href="thread.html#29354">[ thread ]</a>
              <a href="subject.html#29354">[ subject ]</a>
              <a href="author.html#29354">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
