<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Enabling publisher confirms damages performance	by a factor of 10x
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Enabling%20publisher%20confirms%20damages%20performance%0A%09by%20a%20factor%20of%2010x&In-Reply-To=%3C1376904909257-28914.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029471.html">
   <LINK REL="Next"  HREF="029546.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Enabling publisher confirms damages performance	by a factor of 10x</H1>
    <B>ModronMaze</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Enabling%20publisher%20confirms%20damages%20performance%0A%09by%20a%20factor%20of%2010x&In-Reply-To=%3C1376904909257-28914.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] Enabling publisher confirms damages performance	by a factor of 10x">jtlg at vp.pl
       </A><BR>
    <I>Mon Aug 19 10:35:09 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029471.html">[rabbitmq-discuss] rabbitmq-c use amqp_basic_ack(..., qwTag, ..) twice lead consumer lose
</A></li>
        <LI>Next message: <A HREF="029546.html">[rabbitmq-discuss] Enabling publisher confirms damages performance by a factor of 10x
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29419">[ date ]</a>
              <a href="thread.html#29419">[ thread ]</a>
              <a href="subject.html#29419">[ subject ]</a>
              <a href="author.html#29419">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I tried to use publisher confirms to ensure my messages are not lost, but
encountered a performance issue. My test case is as follows:

1. One publisher sends 200.000 messages in a loop and asynchronously marks
them as confirmed.
2. One consumer reads messages from queue, executes some work (db access,
sends other messages etc)
3. Prefetch is set to 512.
4. Queue and messages are durable/persistent.
5. I tried using versions 3.0.2, 3.1.4, 3.1.5

Without using publisher confirms I publish at least *250 msg/s* (and ack
with the same speed). Queue contains only prefetched messages.

When I enable confirms (separate channel and connection - only for sending
messages that require it) speed drops to *15-25 msg/s*. Using management API
I found out that publisher's connection is constantly blocked by flow
control.
I think it is strange, because all messages are consumed as soon as they
enter a queue. I did not observe any problems with memory/disk limits.

I'm attaching a screenshot with blocked connection. Usually &quot;To client&quot; is
not zero (about 250 B/s).

&lt;<A HREF="http://rabbitmq.1065348.n5.nabble.com/file/n28914/42.png">http://rabbitmq.1065348.n5.nabble.com/file/n28914/42.png</A>&gt; 






--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Enabling-publisher-confirms-damages-performance-by-a-factor-of-10x-tp28914.html">http://rabbitmq.1065348.n5.nabble.com/Enabling-publisher-confirms-damages-performance-by-a-factor-of-10x-tp28914.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029471.html">[rabbitmq-discuss] rabbitmq-c use amqp_basic_ack(..., qwTag, ..) twice lead consumer lose
</A></li>
	<LI>Next message: <A HREF="029546.html">[rabbitmq-discuss] Enabling publisher confirms damages performance by a factor of 10x
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29419">[ date ]</a>
              <a href="thread.html#29419">[ thread ]</a>
              <a href="subject.html#29419">[ subject ]</a>
              <a href="author.html#29419">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
