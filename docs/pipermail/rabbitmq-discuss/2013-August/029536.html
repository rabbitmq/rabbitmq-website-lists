<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] A three-node cluster hangs completely in ec2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20A%20three-node%20cluster%20hangs%20completely%20in%20ec2&In-Reply-To=%3Cd3dc6a40-4694-485f-89ec-fc3e4a235b32%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029621.html">
   <LINK REL="Next"  HREF="029537.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] A three-node cluster hangs completely in ec2</H1>
    <B>Jon Dokulil</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20A%20three-node%20cluster%20hangs%20completely%20in%20ec2&In-Reply-To=%3Cd3dc6a40-4694-485f-89ec-fc3e4a235b32%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] A three-node cluster hangs completely in ec2">jondokulil at gmail.com
       </A><BR>
    <I>Thu Aug 22 20:17:35 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029621.html">[rabbitmq-discuss] rabbitmq shutdown return code 2
</A></li>
        <LI>Next message: <A HREF="029537.html">[rabbitmq-discuss] A three-node cluster hangs completely in ec2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29536">[ date ]</a>
              <a href="thread.html#29536">[ thread ]</a>
              <a href="subject.html#29536">[ subject ]</a>
              <a href="author.html#29536">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We've seen this happen twice now and each time it's been a pain to work 
around (we ended up creating a whole new cluster each time). Here's the 
scenario we have seen:

Our setup:

   1. Three RabbitMQ 3.1.5 nodes running on the Amazon Linux AMI. Each node 
   is in a different availability zone in the US-EAST region on AWS. We'll 
   call them nodes A, B, and C
   2. Each queue is using an HA policy
   3. All queues are durable
   4. We Basic.Publish with DeliveryMode=2
   5. All clients are initially connected to node A

The scenario:

   1. Node A is shutdown (the last time I did it via 'sudo 
   /etc/init.d/rabbitmq-server stop
   2. All connected clients see the shutdown and successfully transition to 
   using one of the other nodes. About half connect to node B and the other 
   half connect to node C
   3. We notice that a few of the queues still show their &quot;node&quot; as being 
   node A, even though it is not currently running.
   4. Node A is brought back online. The RabbitMQ management console 
   (webapp) shows everything is fine on the homepage.
   5. When A comes back online, those queues that show A as their 'node' 
   now show zero mirrors.
   6. I attempt to delete the queue via the management webapp. At that 
   point all three nodes become 100% unresponsive. The management webapp fails 
   to respond and all communication in our application stops. CPU fluctuates 
   between 10-40% on but memory doesn't seem to be leaking. It's difficult to 
   know what is happening because rabbitmqctl is also unresponsive. Attempts 
   to gracefully stop the nodes all hang.

Does anybody have experience with this? What additional information should 
I provide? It's causing a lot of stress and confuses the heck out of me. 
Any guidance is much appreciated.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/e6d7e508/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/e6d7e508/attachment.htm</A>&gt;
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029621.html">[rabbitmq-discuss] rabbitmq shutdown return code 2
</A></li>
	<LI>Next message: <A HREF="029537.html">[rabbitmq-discuss] A three-node cluster hangs completely in ec2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29536">[ date ]</a>
              <a href="thread.html#29536">[ thread ]</a>
              <a href="subject.html#29536">[ subject ]</a>
              <a href="author.html#29536">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
