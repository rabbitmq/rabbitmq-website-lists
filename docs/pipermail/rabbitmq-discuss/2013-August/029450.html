<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Clustering Behaviour
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20Behaviour&In-Reply-To=%3CC7E4496D-433A-42DE-8BA9-159F35946575%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029400.html">
   <LINK REL="Next"  HREF="029401.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Clustering Behaviour</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20Behaviour&In-Reply-To=%3CC7E4496D-433A-42DE-8BA9-159F35946575%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Clustering Behaviour">tim at rabbitmq.com
       </A><BR>
    <I>Mon Aug 19 23:35:57 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029400.html">[rabbitmq-discuss] Clustering Behaviour
</A></li>
        <LI>Next message: <A HREF="029401.html">[rabbitmq-discuss] AMQP port 5672
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29450">[ date ]</a>
              <a href="thread.html#29450">[ thread ]</a>
              <a href="subject.html#29450">[ subject ]</a>
              <a href="author.html#29450">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Max,

On 18 Aug 2013, at 13:34, Max Manders wrote:
&gt;<i> If I configure the cluster to use mirrored queues, I'm also working on the assumption that nodes may be transient and might get terminated and created via scaling events.
</I>
Not really sure what you mean by this. For the record, it is not entire nodes that are configured to use mirroring, but individual queues. In a RabbitMQ cluster, all schema definitions (e.g., queues, exchanges, bindings, users, etc) are replicated atomically between all nodes. Messages (inside queues) are normally not shared, but mirroring allows these to be replicated as well, for those queues to which the ha policy is applied.

&gt;<i> If a node dies, I can see via `rabbitmqctl cluster_status` that the node is still part of the cluster, but not a 'running node'.  What are the implications of this?
</I>
Client previously connected to that node will have been disconnected. If the master queue process for a mirrored queue previously resided on the now disconnected node, one of the remaining slaves - the most up date, i.e., complete replica - will be elected as the new master. When the node eventually re-establishes connectivity with the rest of the cluster, its copy of all the cluster-wide definitions (mentioned above) will be synchronised to reflect any changes that occurred whilst it was offline. If the node is selected (by an ha policy) to host mirrors for any HA/Mirrored queues, then slaves (i.e., replica queue processes) will be started for them.

&gt;<i>  If a client requests a message from a queue via an exchange, will the cluster service the request from an available node, knowing not to use the dead node?
</I>
That's not quite right - clients *publish* to exchanges and *consume* from queues. It sounds like your question is about location transparency (from the client's perspective) within a cluster however - in which case yes, that is right. Clients can connect to any node and see exchanges and queues that were declared on other nodes. Publishing and consuming works transparently, so that you can connect to any node in the cluster and publish to an exchange or consume from a queue, regardless of whether they were declared on the node to which you connected or not.

Queue will not however, magically &quot;fail-over&quot; if the node on which they were declared crashes - they will disappear from the cluster and any undelivered messages will be lost. If an exchange is bound to a queue on another node (and is not bound to any others!) and that node goes down, then the message will be lost since there is no longer a binding and the broker will drop the message in that case.

If a queue is mirrored (due to ha policy) however, you don't have to worry about that because a replica will take over and the message will be received there instead.

&gt;<i> Do I need to worry about cluster nodes versus running node; will the cluster remove a node that hasn't been running for some time, or should I programmatically clean up dead nodes?
</I>&gt;<i> 
</I>
The cluster won't remove dead nodes. The assumption is that they will come back at some point. If they don't, then you are indeed responsible for removing them from the cluster.

&gt;<i> Also, how do clients connect to a cluster?  Do I put a load balancer in front of a cluster and have an application connect to the load balancer?
</I>
A lot of users seem to get along fine doing that.

&gt;<i> Or should an application connect to a particular cluster node, or any cluster node?  Apologies for the questions, but I'm not developing the app, just providing the infrastructure / middleware; not a fan of doing so without having a better understanding.
</I>&gt;<i> 
</I>&gt;<i> Any help, gratefully received!
</I>&gt;<i> 
</I>
Sure not a problem. Hopefully I've answered some of the above without adding too much confusion! :)

Do spend some time reading the copious documentation on the website, and feel free to drop back here with any further questions.

Kind regards,

Tim


</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029400.html">[rabbitmq-discuss] Clustering Behaviour
</A></li>
	<LI>Next message: <A HREF="029401.html">[rabbitmq-discuss] AMQP port 5672
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29450">[ date ]</a>
              <a href="thread.html#29450">[ thread ]</a>
              <a href="subject.html#29450">[ subject ]</a>
              <a href="author.html#29450">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
