<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ clustering with SSL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20clustering%20with%20SSL&In-Reply-To=%3Cf8fccacb-0632-430b-96cd-aa701ac92dce%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029306.html">
   <LINK REL="Next"  HREF="029263.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ clustering with SSL</H1>
    <B>ramviv.123 at gmail.com</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20clustering%20with%20SSL&In-Reply-To=%3Cf8fccacb-0632-430b-96cd-aa701ac92dce%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ clustering with SSL">ramviv.123 at gmail.com
       </A><BR>
    <I>Tue Aug 13 17:00:57 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029306.html">[rabbitmq-discuss] Delay between minority detected and stopped server
</A></li>
        <LI>Next message: <A HREF="029263.html">[rabbitmq-discuss] RabbitMQ clustering with SSL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29262">[ date ]</a>
              <a href="thread.html#29262">[ thread ]</a>
              <a href="subject.html#29262">[ subject ]</a>
              <a href="author.html#29262">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

    We are setting up a RabbitMQ env with clustering on the LAN and 
federated on the WAN.  We also intend to use consistent hash on the 
receiver side.  We were able to successfully setup a federated 
configuration with ssl enabled.  But we are having issues trying to setup 
ssl with clusters.  We are using RabbitMQ 3.1.3 with erlang 
version  5.9.3.1.  We have setup the erlang config based on 
<A HREF="http://www.erlang.org/doc/apps/ssl/ssl_distribution.html.">http://www.erlang.org/doc/apps/ssl/ssl_distribution.html.</A>   I am able 
connect tru an erlang client server program to send data back and forth and 
so I know the ssl with erlang works.  But when I bring RabbitMQ with 
clusters and take a TCP dump of the packets, the data transfer seem to be 
clear text.  Is there a way to check if the clusters are configured for ssl 
by any other means.  Also, would appreciate if someone can point out what 
am I doing wrong here.  Here is the env file (rabbitmq-env.conf)

SERVER_START_ARGS=&quot;-boot /usr/lib64/erlang/releases/R15B03/start_ssl 
-proto_dist inet_tls&quot;
#SERVER_START_ARGS=&quot;${SERVER_START_ARGS} -pa 
/usr/lib64/erlang/lib/ssl-5.1.2/ebin&quot;
#SERVER_START_ARGS=&quot;${SERVER_START_ARGS} 
/usr/lib64/erlang/lib/asn1-1.8/ebin&quot;
#SERVER_START_ARGS=&quot;${SERVER_START_ARGS} -ssl_portprogram_dir 
/usr/lib64/erlang/lib/ssl-5.1.2/ebin&quot;
SERVER_START_ARGS=&quot;${SERVER_START_ARGS} -ssl_dist_opt server_cacertfile 
/etc/openssl/all_cacerts.pem&quot;
SERVER_START_ARGS=&quot;${SERVER_START_ARGS} -ssl_dist_opt server_certfile 
/etc/openssl/nn-vmrh5/cert.pem&quot;
SERVER_START_ARGS=&quot;${SERVER_START_ARGS} -ssl_dist_opt server_keyfile 
/etc/openssl/nn-vmrh5/key.pem&quot;
SERVER_START_ARGS=&quot;${SERVER_START_ARGS} -ssl_dist_opt server_verify 1&quot;
SERVER_START_ARGS=&quot;${SERVER_START_ARGS} -ssl_dist_opt 
server_fail_if_no_peer_cert true&quot;
SERVER_START_ARGS=&quot;${SERVER_START_ARGS} -ssl_dist_opt 
server_secure_renegotiate true&quot;
SERVER_START_ARGS=&quot;${SERVER_START_ARGS} -ssl_dist_opt client_cacertfile 
/etc/openssl/all_cacerts.pem&quot;
SERVER_START_ARGS=&quot;${SERVER_START_ARGS} -ssl_dist_opt client_certfile 
/etc/openssl/nn-vmrh5/cert.pem&quot;
SERVER_START_ARGS=&quot;${SERVER_START_ARGS} -ssl_dist_opt client_keyfile 
/etc/openssl/nn-vmrh5/key.pem&quot;
SERVER_START_ARGS=&quot;${SERVER_START_ARGS} -ssl_dist_opt client_verify 1&quot;
SERVER_START_ARGS=&quot;${SERVER_START_ARGS} -ssl_dist_opt 
client_secure_renegotiate true&quot;
#echo SERVER_START_ARGS: ${SERVER_START_ARGS}

Here is the rabbitmq.config for clustering and ssl option set for other 
modes.


[nn-vmrh5: /etc/rabbitmq]vi rabbitmq.config
[
    {rabbit, [
        {default_vhost, &lt;&lt;&quot;alert&quot;&gt;&gt;},
        {tcp_listeners, [5672]},
        {ssl_listeners, [5671]},
        {rabbitmq_tracing, [{username, &quot;guest&quot;}]},
        {cluster_nodes, ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at nn-vmrh5</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at nn-vmrh5g</A>']},
        {ssl_options, [{cacertfile,&quot;/etc/openssl/all_cacerts.pem&quot;},
                       {certfile,&quot;/etc/openssl/nn-vmrh5/cert.pem&quot;},
                       {keyfile,&quot;/etc/openssl/nn-vmrh5/key.pem&quot;},
                       {verify,verify_peer},
                       {fail_if_no_peer_cert,true}] },
        {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']},
        {ssl_cert_login_from, common_name},
        {log_levels, [{connection, info}]}
    ] }
].

   Would really appreciate any help on this.

Thanks
Venkat
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130813/18a98126/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130813/18a98126/attachment.htm</A>&gt;
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029306.html">[rabbitmq-discuss] Delay between minority detected and stopped server
</A></li>
	<LI>Next message: <A HREF="029263.html">[rabbitmq-discuss] RabbitMQ clustering with SSL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29262">[ date ]</a>
              <a href="thread.html#29262">[ thread ]</a>
              <a href="subject.html#29262">[ subject ]</a>
              <a href="author.html#29262">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
