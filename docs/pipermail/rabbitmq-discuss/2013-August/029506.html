<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Best way to subscribe-unsubscribe-subscribe
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Best%20way%20to%20subscribe-unsubscribe-subscribe&In-Reply-To=%3C672b9622-f88a-4198-8cb6-0d5a110d9ebc%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029692.html">
   <LINK REL="Next"  HREF="029511.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Best way to subscribe-unsubscribe-subscribe</H1>
    <B>Valentin Polezhaev</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Best%20way%20to%20subscribe-unsubscribe-subscribe&In-Reply-To=%3C672b9622-f88a-4198-8cb6-0d5a110d9ebc%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Best way to subscribe-unsubscribe-subscribe">valentin.polezhaev at gmail.com
       </A><BR>
    <I>Thu Aug 22 09:36:30 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029692.html">[rabbitmq-discuss] questions about RabbitMQ linear scalability
</A></li>
        <LI>Next message: <A HREF="029511.html">[rabbitmq-discuss] Best way to subscribe-unsubscribe-subscribe
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29506">[ date ]</a>
              <a href="thread.html#29506">[ thread ]</a>
              <a href="subject.html#29506">[ subject ]</a>
              <a href="author.html#29506">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,
I am new in Rabbit and I need to write consumer code which can 1) subscribe 
to queue with specified name, 2) recieve messages, 3) if another queue name 
is specified switch to new queue and start to recieve messages from it 4) 
go to step 2).

I use official .NET client and my code looks like:

\\consumer:

private string _currentQueue;

public T Consume(string queue)
{
    ...
    if (_currentQueue != queue)                
       Subscribe(queue);
    ... 
    var ea = (BasicDeliverEventArgs) _basicConsumer.Queue.Dequeue();
    ...               
}

private void Subscribe(string queue)
{
        _currentQueue = queue;
        if (_basicConsumer.IsRunning)
        {                
            _channel.BasicCancel(_basicConsumer.ConsumerTag);               
 
            _basicConsumer = new QueueingBasicConsumer(_channel) { 
ConsumerTag = GetNewTag()};
         }
         _channel.BasicConsume(_currentQueue, false, _basicConsumer);
}

For example I have 2 queues (&quot;A&quot;, &quot;B&quot;) with 2 messages in each and I 
consume in A-B-A-B order.
My code successfully reads first messages from both A and B queues, but 
third time (second read from A) it stays at line
var ea = (BasicDeliverEventArgs) _basicConsumer.Queue.Dequeue();
and nothing happens.

Moreover it'is strange that via control panel I can see 2 unacked messages 
in both A and B queues. Corresponding to program beheaviour I can 
understand unacked message in A queue but not in B - second consuming from 
B was not started yet.

Please, tell me the best way to do this.

I consider that simple reconnection will solve my problem, but seems it's a 
bad practice.

Thanks a lot.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/da54876e/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130822/da54876e/attachment.htm</A>&gt;
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029692.html">[rabbitmq-discuss] questions about RabbitMQ linear scalability
</A></li>
	<LI>Next message: <A HREF="029511.html">[rabbitmq-discuss] Best way to subscribe-unsubscribe-subscribe
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29506">[ date ]</a>
              <a href="thread.html#29506">[ thread ]</a>
              <a href="subject.html#29506">[ subject ]</a>
              <a href="author.html#29506">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
