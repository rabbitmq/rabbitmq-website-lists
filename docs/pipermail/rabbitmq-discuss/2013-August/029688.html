<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] ldap user declare queue =problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20ldap%20user%20declare%20queue%20%3Dproblem&In-Reply-To=%3CCAOBraDH%2BG71-u8jZcs4Ui8dcRU9SF7BZTNZmvx4%3DcCLasftpjg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029684.html">
   <LINK REL="Next"  HREF="029689.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] ldap user declare queue =problem</H1>
    <B>Artur Nike</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20ldap%20user%20declare%20queue%20%3Dproblem&In-Reply-To=%3CCAOBraDH%2BG71-u8jZcs4Ui8dcRU9SF7BZTNZmvx4%3DcCLasftpjg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] ldap user declare queue =problem">opalsie at gmail.com
       </A><BR>
    <I>Thu Aug 29 14:18:48 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029684.html">[rabbitmq-discuss] Sent message to other Network Rabbit MQ
</A></li>
        <LI>Next message: <A HREF="029689.html">[rabbitmq-discuss] ANN QDB 0.4.8 released
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29688">[ date ]</a>
              <a href="thread.html#29688">[ thread ]</a>
              <a href="subject.html#29688">[ subject ]</a>
              <a href="author.html#29688">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a problem :) .

I configured, or rather do me wondering, RMQ to use ldap (openldap)
for authentication and authorization.

LDAP works ok, but the LDAP-user can not declare exchanges and queues,
(login wheel:pass it works, published msg to exchange works, read msg from
queque works )

Here's my Rabbit configs :

CONFIG1:
[
  {rabbit, [
     {auth_backends, [rabbit_auth_backend_ldap,
rabbit_auth_backend_internal]},
     {tcp_listeners, []},
     {ssl_listeners, [{&quot;127.0.0.1&quot;, 5671} ]},
     {ssl_options, [{cacertfile,&quot;/home/hg/cert/testca/cacert.pem&quot;},
                    {certfile,&quot;/home/hg/cert/server/cert.pem&quot;},
                    {keyfile,&quot;/home/hg/cert/server/key.pem&quot;},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,true}]}
   ]
  },
  {rabbitmq_auth_backend_ldap,
   [ {servers,               [&quot;localhost&quot;]},
     {user_dn_pattern,       &quot;cn=${username},o=org1,dc=nodomain&quot;},
     {use_ssl,               false},
     {port,                  389},
     {log,                   true},
     {resource_access_query,
      {for, [{permission, configure, {in_group,
&quot;cn=wheel,o=org1,dc=nodomain&quot;}},
             {permission, write,
              {for, [{resource, queue,    {in_group,
&quot;cn=wheel,o=org1,dc=nodomain&quot;}},
                     {resource, exchange, {constant, true}}]}},
             {permission, read,
              {for, [{resource, exchange, {in_group,
&quot;cn=wheel,o=org1,dc=nodomain&quot;}},
                     {resource, queue,    {constant, true}}]}}
            ]
      }},
     {tag_queries,           [{administrator, {constant, false}},
                              {management,    {constant, true}}]}
   ]
  }
].

LOG:
=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP DECISION: does wheel have tag management? true

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
LDAP DECISION: login for wheel: ok

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
LDAP CHECK: access to vhost &quot;/&quot; for &quot;wheel&quot;

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP bind succeeded: cn=wheel,o=org1,dc=nodomain

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP evaluating query: {constant,true}

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP evaluated constant: true

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
LDAP DECISION: access to vhost &quot;/&quot; for &quot;wheel&quot;: ok

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
LDAP CHECK: configure permission for queue &quot;tyerter&quot; in &quot;/&quot; for &quot;wheel&quot;

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP bind succeeded: cn=wheel,o=org1,dc=nodomain

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP evaluating query: {for,
                            [{permission,configure,
                              {in_group,&quot;cn=wheel,o=org1,dc=nodomain&quot;}},
                             {permission,write,
                              {for,
                               [{resource,queue,
                                 {in_group,&quot;cn=wheel,o=org1,dc=nodomain&quot;}},
                                {resource,exchange,{constant,true}}]}},
                             {permission,read,
                              {for,
                               [{resource,exchange,
                                 {in_group,&quot;cn=wheel,o=org1,dc=nodomain&quot;}},
                                {resource,queue,{constant,true}}]}}]}

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP selecting subquery permission = configure

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP evaluating query: {in_group,&quot;cn=wheel,o=org1,dc=nodomain&quot;}

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP evaluating query: {in_group,&quot;cn=wheel,o=org1,dc=nodomain&quot;,&quot;member&quot;}

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
        LDAP filling template &quot;cn=wheel,o=org1,dc=nodomain&quot; with
            [{username,&lt;&lt;&quot;wheel&quot;&gt;&gt;},
             {user_dn,&quot;cn=wheel,o=org1,dc=nodomain&quot;},
             {vhost,&lt;&lt;&quot;/&quot;&gt;&gt;},
             {resource,queue},
             {name,&lt;&lt;&quot;tyerter&quot;&gt;&gt;},
             {permission,configure}]

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
        LDAP template result: &quot;cn=wheel,o=org1,dc=nodomain&quot;

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
    LDAP evaluated in_group for &quot;cn=wheel,o=org1,dc=nodomain&quot;: false

=INFO REPORT==== 29-Aug-2013::14:24:05 ===
LDAP DECISION: configure permission for queue &quot;tyerter&quot; in &quot;/&quot; for &quot;wheel&quot;:
denied

=ERROR REPORT==== 29-Aug-2013::14:24:05 ===
connection &lt;0.1234.0&gt;, channel 1 - soft error:
{amqp_error,access_refused,
            &quot;access to queue 'tyerter' in vhost '/' refused for user
'wheel'&quot;,
            'queue.declare'}

=ERROR REPORT==== 29-Aug-2013::14:24:05 ===
webmachine error: path=&quot;/api/queues/%2F/tyerter&quot;
&quot;Unauthorized&quot;



Can anyone have any suggestions or experience with this problem.
For all thank you in advance.

Muniek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/44121917/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130829/44121917/attachment.htm</A>&gt;
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029684.html">[rabbitmq-discuss] Sent message to other Network Rabbit MQ
</A></li>
	<LI>Next message: <A HREF="029689.html">[rabbitmq-discuss] ANN QDB 0.4.8 released
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29688">[ date ]</a>
              <a href="thread.html#29688">[ thread ]</a>
              <a href="subject.html#29688">[ subject ]</a>
              <a href="author.html#29688">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
