<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Keeping idle connections alive in EC2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Keeping%20idle%20connections%20alive%20in%20EC2&In-Reply-To=%3C1377612090757-29132.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029627.html">
   <LINK REL="Next"  HREF="029635.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Keeping idle connections alive in EC2</H1>
    <B>slash</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Keeping%20idle%20connections%20alive%20in%20EC2&In-Reply-To=%3C1377612090757-29132.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] Keeping idle connections alive in EC2">neilbriancastro at gmail.com
       </A><BR>
    <I>Tue Aug 27 15:01:30 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029627.html">[rabbitmq-discuss] Keeping idle connections alive in EC2
</A></li>
        <LI>Next message: <A HREF="029635.html">[rabbitmq-discuss] Keeping idle connections alive in EC2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29636">[ date ]</a>
              <a href="thread.html#29636">[ thread ]</a>
              <a href="subject.html#29636">[ subject ]</a>
              <a href="author.html#29636">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Laing, Michael P. wrote
&gt;<i> We run lots of ec2 connections without problem and also use pika 0.9.13 or
</I>&gt;<i> 0.9.14pre.
</I>&gt;<i> 
</I>&gt;<i> Some connections go idle for lengthy periods. We use the default heartbeat
</I>&gt;<i> of 600 secs for most connections.
</I>&gt;<i> 
</I>&gt;<i> If going through a load balancer like EC2's ELB or haproxy, we found a
</I>&gt;<i> heartbeat of 25 seconds worked well. At the current time we have
</I>&gt;<i> engineered
</I>&gt;<i> load balancers out of our architecture by using AWS Route 53 least latency
</I>&gt;<i> / weighted routing with health checks.
</I>&gt;<i> 
</I>&gt;<i> Our domain specific framework built on pika automatically reconnects if we
</I>&gt;<i> do lose a connection, typically trying a different machine in the cluster
</I>&gt;<i> via the above routing scheme. Inter- and intra-region shovel/federation
</I>&gt;<i> links do this explicitly using standard multi-endpoint configurations.
</I>&gt;<i> 
</I>&gt;<i> So I would try the default of 600 secs, i.e. don't specify a heartbeat, or
</I>&gt;<i> use 25 secs if a load balancer is in the picture.
</I>&gt;<i> 
</I>&gt;<i> ml
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Tue, Aug 27, 2013 at 4:21 AM, Michael Klishin &amp;lt;
</I>
&gt;<i> mklishin@
</I>
&gt;<i> &amp;gt;wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> slash:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; I tried setting the connection parameter heartbeat_interval to both
</I>&gt;&gt;<i> zero
</I>&gt;&gt;<i> and 3600 and also the socket_timeout to 1860 seconds
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> These are pretty high intervals. Have you tried setting heartbeats to,
</I>&gt;&gt;<i> say, 20-30 seconds?
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> MK
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> 
</I>
&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at .rabbitmq</A>
</I>
&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>
&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at .rabbitmq</A>
</I>
&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
Thank you for sharing- it helps to know this pika, Rabbitmq, ec2 stack
works.

I've tried several values for that parameter INCLUDING NOT specifying it
which should default to 600. Yesterday, I also tried different high and low
values for the tcp_keepalive_time of the producer/consumer ec2 instances.
All failed. I still got the *pika.Connection.Close* exception at the
30-minute mark.

I'm running 3-5 connections between 2 EC2 machines launched from a Linux
AMI. The size of messaging data are in the order of kilobytes only. One of
the instances that has the long running process runs an FFMPEG transcoder.
But for debugging purposes I replaced it with a 30-minute while loop that
calls *process_event_data* and *sleep* methods of the
*pika.BlockingConnection* object. I also send a fan-out message every
iteration to make sure data is sent across the connection.

Any thoughts?



--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Keeping-idle-connections-alive-in-EC2-tp25324p29132.html">http://rabbitmq.1065348.n5.nabble.com/Keeping-idle-connections-alive-in-EC2-tp25324p29132.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029627.html">[rabbitmq-discuss] Keeping idle connections alive in EC2
</A></li>
	<LI>Next message: <A HREF="029635.html">[rabbitmq-discuss] Keeping idle connections alive in EC2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29636">[ date ]</a>
              <a href="thread.html#29636">[ thread ]</a>
              <a href="subject.html#29636">[ subject ]</a>
              <a href="author.html#29636">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
