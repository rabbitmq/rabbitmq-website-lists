<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] High load average with rabbitmq-server 3.1.x
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20High%20load%20average%20with%20rabbitmq-server%203.1.x&In-Reply-To=%3C5211C0C1.9040400%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029404.html">
   <LINK REL="Next"  HREF="029409.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] High load average with rabbitmq-server 3.1.x</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20High%20load%20average%20with%20rabbitmq-server%203.1.x&In-Reply-To=%3C5211C0C1.9040400%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] High load average with rabbitmq-server 3.1.x">matthias at rabbitmq.com
       </A><BR>
    <I>Mon Aug 19 07:52:49 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029404.html">[rabbitmq-discuss] High load average with rabbitmq-server 3.1.x
</A></li>
        <LI>Next message: <A HREF="029409.html">[rabbitmq-discuss] High load average with rabbitmq-server 3.1.x
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29406">[ date ]</a>
              <a href="thread.html#29406">[ thread ]</a>
              <a href="subject.html#29406">[ subject ]</a>
              <a href="author.html#29406">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dan,

On 19/08/13 03:58, Dan_b wrote:
&gt;<i> We have recently upgraded from rabbitmq-server 2.6.1 to 3.1.x (we have one
</I>&gt;<i> cluster running 3.1.5 and one running 3.1.3).  On both servers we have seen
</I>&gt;<i> the load average increase significantly, with it peaking up to 2x the number
</I>&gt;<i> cores.  The CPU utilization and IO wait aren't affected and it seems to be
</I>&gt;<i> down to internal locks.
</I>
I'd guess those FUTEXes have something to do with timers. They are 
immediately followed by fsyncs, which in rabbit are typically triggered 
by timers. So the sequence you are seeing is

1. write message to disk
2. wait for timer to expire
3. fsync

e.g.

&gt;<i> write(27,
</I>&gt;<i> &quot;\0\0\0\0\0\3\324=\226(\16\265\355\200\307\7J\34b\4\240\&quot;\355)\0\0\0\0\0\0\0\0&quot;...,
</I>&gt;<i> 48) = 48
</I>&gt;<i> futex(0x2aaaab594524, FUTEX_WAIT_PRIVATE, 235521, NULL) = -1 EAGAIN
</I>&gt;<i> (Resource temporarily unavailable)
</I>&gt;<i> futex(0x2aaaab5944f8, FUTEX_WAKE_PRIVATE, 1) = 0
</I>&gt;<i> fsync(27)                               = 0
</I>
So nothing to worry about.

Matthias.
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029404.html">[rabbitmq-discuss] High load average with rabbitmq-server 3.1.x
</A></li>
	<LI>Next message: <A HREF="029409.html">[rabbitmq-discuss] High load average with rabbitmq-server 3.1.x
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29406">[ date ]</a>
              <a href="thread.html#29406">[ thread ]</a>
              <a href="subject.html#29406">[ subject ]</a>
              <a href="author.html#29406">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
