<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] More detail on bug refusing publishes fixed in 2.8.3
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20More%20detail%20on%20bug%20refusing%20publishes%20fixed%0A%20in%202.8.3&In-Reply-To=%3C51FB7D9F.2070902%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029059.html">
   <LINK REL="Next"  HREF="029060.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] More detail on bug refusing publishes fixed in 2.8.3</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20More%20detail%20on%20bug%20refusing%20publishes%20fixed%0A%20in%202.8.3&In-Reply-To=%3C51FB7D9F.2070902%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] More detail on bug refusing publishes fixed in 2.8.3">simon at rabbitmq.com
       </A><BR>
    <I>Fri Aug  2 10:36:31 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029059.html">[rabbitmq-discuss] More detail on bug refusing publishes fixed in	2.8.3
</A></li>
        <LI>Next message: <A HREF="029060.html">[rabbitmq-discuss] flow control blocked producers vs consumers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29064">[ date ]</a>
              <a href="thread.html#29064">[ thread ]</a>
              <a href="subject.html#29064">[ subject ]</a>
              <a href="author.html#29064">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/08/2013 6:36PM, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">asternb at gmail.com</A> wrote:
&gt;<i> I'm looking for more detail on a bug fixed in 2.8.3. The only
</I>&gt;<i> description in the release notes is &quot;queues with many busy consumers
</I>&gt;<i> could refuse to accept publishes until empty&quot;
</I>&gt;<i> (<A HREF="http://www.rabbitmq.com/release-notes/README-2.8.3.txt">http://www.rabbitmq.com/release-notes/README-2.8.3.txt</A>). Could someone
</I>&gt;<i> link me to the bug with detail in a tracker or copy that info here?
</I>
We don't have a public bug tracker I'm afraid.

The bug was that queues always prioritised sending messages to consumers 
over accepting messages from publishers. Normally this was OK, since the 
limiting factor in sending messages to consumers was either how fast 
they could be streamed off disc, how fast they were coming in, or how 
fast they could be pushed onto the network, thus giving the queue CPU 
time to do other things.

However, if the queue had a lot of consumers (typically at least 
hundreds), and all those consumers were active, then the queue could get 
into a state where it was CPU-bound - at which point it would then fail 
to accept publishes at all until empty.

&gt;<i> With
</I>&gt;<i> that bug, does the broker block connections similar to flow control?
</I>
Before RabbitMQ 2.8.0 messages would back up indefinitely in the broker 
before getting to the queue - so the symptom of this bug would be a 
sudden spike in memory use (possibly leading to the memory alarm going 
off). In 2.8.0 to 2.8.2 the broker would put the publishers into flow 
control - normally flow control should flick on and off rapidly to 
restrict the publishing rate, but in this case flow control would stay 
on and the publishing rate would drop to 0.

The bug was fixed in 2.8.3; now queues give equal priority to accepting 
and delivering messages.

Of course, many other bugs have also been fixed since then so as ever 
you are advised to upgrade :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029059.html">[rabbitmq-discuss] More detail on bug refusing publishes fixed in	2.8.3
</A></li>
	<LI>Next message: <A HREF="029060.html">[rabbitmq-discuss] flow control blocked producers vs consumers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29064">[ date ]</a>
              <a href="thread.html#29064">[ thread ]</a>
              <a href="subject.html#29064">[ subject ]</a>
              <a href="author.html#29064">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
