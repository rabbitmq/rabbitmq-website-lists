<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] High load average with rabbitmq-server 3.1.x
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20High%20load%20average%20with%20rabbitmq-server%203.1.x&In-Reply-To=%3CCAHdxdCfQK_P28E-5cnmwPSbMbh15vdurr4ifYADbTm3h4V2ttg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029406.html">
   <LINK REL="Next"  HREF="029410.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] High load average with rabbitmq-server 3.1.x</H1>
    <B>Daniel Bason</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20High%20load%20average%20with%20rabbitmq-server%203.1.x&In-Reply-To=%3CCAHdxdCfQK_P28E-5cnmwPSbMbh15vdurr4ifYADbTm3h4V2ttg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] High load average with rabbitmq-server 3.1.x">daniel.bason at telogis.com
       </A><BR>
    <I>Mon Aug 19 08:37:40 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029406.html">[rabbitmq-discuss] High load average with rabbitmq-server 3.1.x
</A></li>
        <LI>Next message: <A HREF="029410.html">[rabbitmq-discuss] High load average with rabbitmq-server 3.1.x
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29409">[ date ]</a>
              <a href="thread.html#29409">[ thread ]</a>
              <a href="subject.html#29409">[ subject ]</a>
              <a href="author.html#29409">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matthias,

Thanks for the response, so the extra process queue during our peak message
throughput which in turn causes the load average to be reported much higher
is just a side effect of this?  We normally have about 600 connections
(mostly consumers) and our producers all publish to topic exchanges, we
have around 250 queues.

Regards
Dan


On Mon, Aug 19, 2013 at 6:52 PM, Matthias Radestock
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt;wrote:

&gt;<i> Dan,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 19/08/13 03:58, Dan_b wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> We have recently upgraded from rabbitmq-server 2.6.1 to 3.1.x (we have one
</I>&gt;&gt;<i> cluster running 3.1.5 and one running 3.1.3).  On both servers we have
</I>&gt;&gt;<i> seen
</I>&gt;&gt;<i> the load average increase significantly, with it peaking up to 2x the
</I>&gt;&gt;<i> number
</I>&gt;&gt;<i> cores.  The CPU utilization and IO wait aren't affected and it seems to be
</I>&gt;&gt;<i> down to internal locks.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'd guess those FUTEXes have something to do with timers. They are
</I>&gt;<i> immediately followed by fsyncs, which in rabbit are typically triggered by
</I>&gt;<i> timers. So the sequence you are seeing is
</I>&gt;<i>
</I>&gt;<i> 1. write message to disk
</I>&gt;<i> 2. wait for timer to expire
</I>&gt;<i> 3. fsync
</I>&gt;<i>
</I>&gt;<i> e.g.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  write(27,
</I>&gt;&gt;<i> &quot;\0\0\0\0\0\3\324=\226(\16\**265\355\200\307\7J\34b\4\240\&quot;**
</I>&gt;&gt;<i> \355)\0\0\0\0\0\0\0\0&quot;...,
</I>&gt;&gt;<i> 48) = 48
</I>&gt;&gt;<i> futex(0x2aaaab594524, FUTEX_WAIT_PRIVATE, 235521, NULL) = -1 EAGAIN
</I>&gt;&gt;<i> (Resource temporarily unavailable)
</I>&gt;&gt;<i> futex(0x2aaaab5944f8, FUTEX_WAKE_PRIVATE, 1) = 0
</I>&gt;&gt;<i> fsync(27)                               = 0
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So nothing to worry about.
</I>&gt;<i>
</I>&gt;<i> Matthias.
</I>&gt;<i>
</I>


-- 
*Dan Bason *
Infrastructure Engineer &#8211; Telogis
www.telogis.com  www.telogis.co.nz
+1 201 477-1448 (USA)  +64 3 281-8065 (NZ)

&lt;<A HREF="http://www.google.com/url?q=http%3A%2F%2Fwww.telogis.com%2F&amp;sa=D&amp;sntz=1&amp;usg=AFrqEze6z4qIWKcAMjgXqM25xkuw9JMysQ">http://www.google.com/url?q=http%3A%2F%2Fwww.telogis.com%2F&amp;sa=D&amp;sntz=1&amp;usg=AFrqEze6z4qIWKcAMjgXqM25xkuw9JMysQ</A>&gt;

*One Platform for Location Intelligence*

-- 


This e-mail, and any attachments, is intended only for use by the 
addressee(s) named herein and may contain legally privileged and/or 
confidential information.  It is the property of Telogis.  If you are not 
the intended recipient of this e-mail, you are hereby notified that any 
dissemination, distribution or copying of this e-mail, any attachments 
thereto, and use of the information contained, is strictly prohibited.  If 
you have received this e-mail in error, please notify the sender and 
permanently delete the original and any copy thereof.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/9bb2512d/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130819/9bb2512d/attachment.htm</A>&gt;
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029406.html">[rabbitmq-discuss] High load average with rabbitmq-server 3.1.x
</A></li>
	<LI>Next message: <A HREF="029410.html">[rabbitmq-discuss] High load average with rabbitmq-server 3.1.x
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29409">[ date ]</a>
              <a href="thread.html#29409">[ thread ]</a>
              <a href="subject.html#29409">[ subject ]</a>
              <a href="author.html#29409">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
