<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Routing through multiple dead-letter	exchanges
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Routing%20through%20multiple%20dead-letter%0A%09exchanges&In-Reply-To=%3C68AB98DC-BAE0-4BE7-93E1-73DE80BDD5AD%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029469.html">
   <LINK REL="Next"  HREF="029476.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Routing through multiple dead-letter	exchanges</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Routing%20through%20multiple%20dead-letter%0A%09exchanges&In-Reply-To=%3C68AB98DC-BAE0-4BE7-93E1-73DE80BDD5AD%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Routing through multiple dead-letter	exchanges">tim at rabbitmq.com
       </A><BR>
    <I>Tue Aug 20 16:37:34 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029469.html">[rabbitmq-discuss] Routing through multiple dead-letter exchanges
</A></li>
        <LI>Next message: <A HREF="029476.html">[rabbitmq-discuss] Routing through multiple dead-letter	exchanges
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29470">[ date ]</a>
              <a href="thread.html#29470">[ thread ]</a>
              <a href="subject.html#29470">[ subject ]</a>
              <a href="author.html#29470">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

On 20 Aug 2013, at 16:12, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">reaperman123456789 at gmail.com</A> wrote:
&gt;<i> Everything works as expected up to this point. However, when the message TTL of &quot;deferredqueue&quot; is up, I expected the message to reappear again in &quot;livequeue&quot; via the dead-letter exchange of &quot;deferredqueue&quot;, but the message is dropped instead.
</I>&gt;<i> If, however, I ack the message in &quot;livequeue&quot; and publish it to &quot;deferredqueue&quot; using basic_publish, instead of rejecting it, the message does reappear in &quot;livequeue&quot;  after the TTL is over, as expected.
</I>&gt;<i> 
</I>&gt;<i> So my question is, is this the normal (intended) behavior, or am I doing something wrong? 
</I>
This is indeed normal/expected behaviour. Dead letter cycles that occur entirely due to expiry are removed, so if the TTL expiry initially occurred in 'livequeue' then when the message later expires in 'deferredqueue' it won't be delivered to 'livequeue' again.

&gt;<i> If this is the normal behavior, is there a way to change it by some exchange/queue/message property, so it will work as I initially planned?
</I>
That one I'm not so sure about. One way to handle this would be to use the shovel plugin to handle republishing messages once they expire in the 'deferredqueue', rather than attempting to use TTL + DLX in a cyclic configuration. Set up a third exchange + queue: 'repub-ex' and 'repub-queue'. Configure the DLX for the 'deferredqueue' to publish to the 'repub-ex'  exchange. Enable the shovel plugin and set up the 'repub-queue' as the source and the 'live' exchange as the destination. Once messages in the 'deferredqueue' expire, they will be delivered to the 'repub-ex' exchange and routed to the 'repub-queue', at which point the shovel will dequeue and ACK them, then publish them to the 'live' exchange once again. You can configure the shovel plugin to add a custom header to these messages to indicate that they're being republished, if that's something your client application needs to now. 

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/9926c0be/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130820/9926c0be/attachment.htm</A>&gt;
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029469.html">[rabbitmq-discuss] Routing through multiple dead-letter exchanges
</A></li>
	<LI>Next message: <A HREF="029476.html">[rabbitmq-discuss] Routing through multiple dead-letter	exchanges
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29470">[ date ]</a>
              <a href="thread.html#29470">[ thread ]</a>
              <a href="subject.html#29470">[ subject ]</a>
              <a href="author.html#29470">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
