<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3 and Erlang R16B01 - Single Node and Cluster Node
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Throughput%20observation%20with%20RabbitMQ-3.1.3%0A%20and%20Erlang%20R16B01%20-%20Single%20Node%20and%20Cluster%20Node&In-Reply-To=%3CCA%2B0nT8Bc34ffx5s1D8gDsuzF1R1vjKMBNuG_ADjOwEkY5G5t0A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029394.html">
   <LINK REL="Next"  HREF="029397.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3 and Erlang R16B01 - Single Node and Cluster Node</H1>
    <B>Priyanki Vashi</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Throughput%20observation%20with%20RabbitMQ-3.1.3%0A%20and%20Erlang%20R16B01%20-%20Single%20Node%20and%20Cluster%20Node&In-Reply-To=%3CCA%2B0nT8Bc34ffx5s1D8gDsuzF1R1vjKMBNuG_ADjOwEkY5G5t0A%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3 and Erlang R16B01 - Single Node and Cluster Node">vashi.priyanki at gmail.com
       </A><BR>
    <I>Fri Aug 16 18:44:29 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029394.html">[rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3 and Erlang R16B01 - Single Node and Cluster Node
</A></li>
        <LI>Next message: <A HREF="029397.html">[rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3	and Erlang R16B01 - Single Node and Cluster Node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29395">[ date ]</a>
              <a href="thread.html#29395">[ thread ]</a>
              <a href="subject.html#29395">[ subject ]</a>
              <a href="author.html#29395">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi ,

Simon - Thanks for comparitive values and some more insight into my
questions. The discussion is going in a direction to understand

1) how good or bad my pika clients efficiciency is and then how exactly my
system resources are used by both client and rabbit server.

So far I can only see that if I send 100 byes of payload, maximum
throughput I get is around 30,000 msg/sec and maximum bandwidth usage is
160-170 mbps. Trying to understand what is happening in system with RAM,
memory etc. etc....

As you mentioned I see comapritively better bandwidth usage with 500 bytes
and 1000 bytes and they are in range of 350 Mbps and 580 Mpbs. Which I
don't know is appropriate or not.

Do you know if one can saturate 8Gbps link with Rabbit ?
I mean does the other fastest client could really show bandwidth usage like
2, 3 or 5 Gbps, given there are 20 cores of CPU and 10GB of RAM exclusively
given to rabbit or even higher RAM.

My goal is to understand and hopefully to pin point what could be the
bottleneck in the environment I am currently running.



For the earlier question of Micheal on number of cores, here is some more
info.

I have 10 physical cores and they are hyperthreaded so that's how I have 20
cores. I have such two machines. So then,

Machine-1 with 20 cores running exclusively my Producer &amp; Receiver based on
pika
Machine-2, again with 20 cores running exclusively RABBITMQ server

I us KVM hypervisor and create virtual machine and through this control
both cores, RAM and DISK resources for both client and rabbit server.

I had noticed one more thing, may be worth mentioning. When I run

dstat --top-latency ( which I understand will show me a process with
highest latency) it most of the time display 'rcu_sched' process. After
some googling, I learnt that it's Read,Copy update scheduling available
with linux kernel &gt; 2.6.x (I guess). This is a kind of improvement, which
allow to read memory while it's being updated. I don't know much of it.

Thank you again !

Best Regards,
Priyanki.



On Fri, Aug 16, 2013 at 6:10 PM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> I'm not completely sure where this discussion is going :-) but I'll pitch
</I>&gt;<i> in anyway...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 16/08/13 10:33, Priyanki Vashi wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> In my wireshark traces, I see following frames for every message I send.
</I>&gt;&gt;<i> I have publisher confirm and consumer ack enabled with prefetch_count
</I>&gt;&gt;<i> not set.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Of course publisher confirm is optional. Also if the broker is busy enough
</I>&gt;<i> it can start to issue acks with multiple=true. So you don't have to pay the
</I>&gt;<i> cost of an ack for every message published.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  content header = 88 bytes ( does not show any direct info so not sure)
</I>&gt;&gt;<i> basic.publish frame = 85 bytes ( shows details of queue, exchange,
</I>&gt;&gt;<i> routing key etc)
</I>&gt;&gt;<i> content body = 137 bytes ( in this my payload is 100 bytes of string +
</I>&gt;&gt;<i> 37 bytes might be checksum etc.)
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I don't see this much. Publishing with:
</I>&gt;<i>
</I>&gt;<i> $ runjava.sh com.rabbitmq.examples.**MulticastMain -C 1 -y0 -s 100
</I>&gt;<i>
</I>&gt;<i> (i.e. publish 1 message of 100 bytes, don't consume anything, then stop)
</I>&gt;<i>
</I>&gt;<i> I get a 255 byte (Ethernet) frame sent for the publish:
</I>&gt;<i>
</I>&gt;<i> 14 bytes Ethernet II header
</I>&gt;<i> 20 bytes IPv4 header
</I>&gt;<i> 32 bytes TCP header
</I>&gt;<i> 59 bytes AMQP basic.publish method (variable size, including exchange name
</I>&gt;<i> and routing key)
</I>&gt;<i> 22 bytes content header (i.e. minimal basic.properties)
</I>&gt;<i> 108 bytes content (100 bytes payload)
</I>&gt;<i>
</I>&gt;<i> So I suspect there's something different with your client and / or test
</I>&gt;<i> app. Note that things like whether you set anything in basic.properties can
</I>&gt;<i> make quite a difference here, the AMQP encoding is designed to be shorter
</I>&gt;<i> in the common case.
</I>&gt;<i>
</I>&gt;<i> For most people the framing costs per message are not excessive. I don't
</I>&gt;<i> think there is any particular waste there. If the costs are excessive for
</I>&gt;<i> you, then MQTT would offer lower (but still present) per-message framing
</I>&gt;<i> costs.
</I>&gt;<i>
</I>&gt;<i> But you can't expect to send tiny messages and fill your network bandwidth
</I>&gt;<i> anyway. Each message's framing has a fixed cost to decode, and then each
</I>&gt;<i> message has a fixed cost for routing logic as well. (Even with fanout
</I>&gt;<i> exchanges we still have to look up bindings after all.)
</I>&gt;<i>
</I>&gt;<i> tl;dr: you'll notice much higher bandwidth utilisation if you start
</I>&gt;<i> sending longer messages.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/a9dc2117/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130816/a9dc2117/attachment.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029394.html">[rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3 and Erlang R16B01 - Single Node and Cluster Node
</A></li>
	<LI>Next message: <A HREF="029397.html">[rabbitmq-discuss] Throughput observation with RabbitMQ-3.1.3	and Erlang R16B01 - Single Node and Cluster Node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29395">[ date ]</a>
              <a href="thread.html#29395">[ thread ]</a>
              <a href="subject.html#29395">[ subject ]</a>
              <a href="author.html#29395">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
