<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] A three-node cluster hangs completely in ec2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20A%20three-node%20cluster%20hangs%20completely%20in%20ec2&In-Reply-To=%3C5216A1AF.2090805%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029544.html">
   <LINK REL="Next"  HREF="029545.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] A three-node cluster hangs completely in ec2</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20A%20three-node%20cluster%20hangs%20completely%20in%20ec2&In-Reply-To=%3C5216A1AF.2090805%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] A three-node cluster hangs completely in ec2">matthias at rabbitmq.com
       </A><BR>
    <I>Fri Aug 23 00:41:35 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029544.html">[rabbitmq-discuss] A three-node cluster hangs completely in ec2
</A></li>
        <LI>Next message: <A HREF="029545.html">[rabbitmq-discuss] A three-node cluster hangs completely in ec2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29541">[ date ]</a>
              <a href="thread.html#29541">[ thread ]</a>
              <a href="subject.html#29541">[ subject ]</a>
              <a href="author.html#29541">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jon,

On 22/08/13 20:17, Jon Dokulil wrote:
&gt;<i> We've seen this happen twice now and each time it's been a pain to work
</I>&gt;<i> around (we ended up creating a whole new cluster each time). Here's the
</I>&gt;<i> scenario we have seen:
</I>&gt;<i>
</I>&gt;<i> Our setup:
</I>&gt;<i>
</I>&gt;<i>  1. Three RabbitMQ 3.1.5 nodes running on the Amazon Linux AMI. Each
</I>&gt;<i>     node is in a different availability zone in the US-EAST region on
</I>&gt;<i>     AWS. We'll call them nodes A, B, and C
</I>&gt;<i>  2. Each queue is using an HA policy
</I>&gt;<i>  3. All queues are durable
</I>&gt;<i>  4. We Basic.Publish with DeliveryMode=2
</I>&gt;<i>  5. All clients are initially connected to node A
</I>&gt;<i>
</I>&gt;<i> The scenario:
</I>&gt;<i>
</I>&gt;<i>  1. Node A is shutdown (the last time I did it via 'sudo
</I>&gt;<i>     /etc/init.d/rabbitmq-server stop
</I>&gt;<i>  2. All connected clients see the shutdown and successfully transition
</I>&gt;<i>     to using one of the other nodes. About half connect to node B and
</I>&gt;<i>     the other half connect to node C
</I>&gt;<i>  3. We notice that a few of the queues still show their &quot;node&quot; as being
</I>&gt;<i>     node A, even though it is not currently running.
</I>&gt;<i>  4. Node A is brought back online. The RabbitMQ management console
</I>&gt;<i>     (webapp) shows everything is fine on the homepage.
</I>&gt;<i>  5. When A comes back online, those queues that show A as their 'node'
</I>&gt;<i>     now show zero mirrors.
</I>&gt;<i>  6. I attempt to delete the queue via the management webapp. At that
</I>&gt;<i>     point all three nodes become 100% unresponsive. The management
</I>&gt;<i>     webapp fails to respond and all communication in our application
</I>&gt;<i>     stops. CPU fluctuates between 10-40% on but memory doesn't seem to
</I>&gt;<i>     be leaking. It's difficult to know what is happening because
</I>&gt;<i>     rabbitmqctl is also unresponsive. Attempts to gracefully stop the
</I>&gt;<i>     nodes all hang.
</I>
Is this reproducible at will?

If so, please grab the RabbitMQ log files (both the normal and the sasl 
log) from all nodes, post them and indicate at what time you performed 
each of the above steps, so we can correlate that with log entries.

Regards,

Matthias.
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029544.html">[rabbitmq-discuss] A three-node cluster hangs completely in ec2
</A></li>
	<LI>Next message: <A HREF="029545.html">[rabbitmq-discuss] A three-node cluster hangs completely in ec2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29541">[ date ]</a>
              <a href="thread.html#29541">[ thread ]</a>
              <a href="subject.html#29541">[ subject ]</a>
              <a href="author.html#29541">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
