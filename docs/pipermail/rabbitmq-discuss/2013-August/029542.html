<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] questions about RabbitMQ linear scalability
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20questions%20about%20RabbitMQ%20linear%20scalability&In-Reply-To=%3C07bc01ce9fa6%2491259570%24b370c050%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029508.html">
   <LINK REL="Next"  HREF="029646.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] questions about RabbitMQ linear scalability</H1>
    <B>Junius Wang</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20questions%20about%20RabbitMQ%20linear%20scalability&In-Reply-To=%3C07bc01ce9fa6%2491259570%24b370c050%24%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] questions about RabbitMQ linear scalability">wangjunbo924 at gmail.com
       </A><BR>
    <I>Fri Aug 23 03:14:54 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029508.html">[rabbitmq-discuss] questions about RabbitMQ linear scalability
</A></li>
        <LI>Next message: <A HREF="029646.html">[rabbitmq-discuss] questions about RabbitMQ linear scalability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29542">[ date ]</a>
              <a href="thread.html#29542">[ thread ]</a>
              <a href="subject.html#29542">[ subject ]</a>
              <a href="author.html#29542">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks your guys.  It really helps us a lot understanding the mirror queues.


In our test scenarios, we actually always set an mirrored queues with
ha-mode &quot;exactly&quot; on 2 nodes.  I'd like to provide some details:
Before every test ( after a new RabbitMQ node added/removed to the cluster):
1).we reset the policy to &quot;exactly&quot; on 2 nodes. 2). declared 10 queues using
rabbitmqctl and force them distributed evenly on all nodes.  e.g.in a 2 node
cluster,5 queues resides on rabbit1, another 5 resides on rabbit2. 3-3-4 for
3 node cluster ,3-3-2-2 for 4 node cluster.   3) declare a 'topic&quot; exchange
4) binding the 10 queues to the exchange with 10 different routing keys.
Publishers publish messages with the 10 routing keys by turns. Thus all
queues receive the same number of messages.  
Is the number of queues large enough?  we can declare more queues in test
but I don't think there will be too many queues in production.  

publishers connect to the cluster via load balancer(AWS ELB) as well as
consumers, they don't know to which node they are connect.  So we may not
decrease the intra-cluster traffic. But  we can try some high bandwidth
instances. Does this help?
 Another question is that we will have a queue with lots of messages
handled, perhaps 5000/sec(size of 2K), which is about 90% of the total
messages handled by the cluster.  It's hard for us to split it into multiple
queues, it's really a big design change which we try to avoid. From your
comments, even if messages are synchronized on only 2 nodes , hardly we can
get linear scaling , right?  If so, is the network traffic the major factor
impacting the performance?  If so ,we can try some high bandwidth instances
or using AWS instance group. Hopes that will get better performance.


-----Original Message-----
From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>
[mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] On Behalf Of Michael
Klishin
Sent: Thursday, August 22, 2013 4:56 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] questions about RabbitMQ linear scalability

Junius Wang:

&gt;<i> 1.       The throughput of two node cluster is 50%-60% worse than a single
</I>node broker.

With mirroring, messages have to be copied to multiple (N or, depending on
configuration, even all) nodes in the cluster. That obviously takes more
time than not copying anything.

&gt;<i> 2.       Adding more node did have improvement on throughput but we only
</I>got 25% improvement(throughput of 3 node cluster is 25% better than 2 node
cluster. 4 node cluster is 25% better than 3 node cluster too). What we
expected is a 45-degree line, that means when 2 nodes are used the
throughput is double. With 3 nodes, then triple.

You are not providing any details about your workload but the way you extend
capacity with RabbitMQ is by adding nodes and using more queues. Queue
mirroring is an HA feature, which means copying more data across the
cluster.

Maximum throughput and highest availability are largely at odds with each
other, so you need to

1. Use multiple queues (and the number should grow with the number of nodes)
2. Choose what queues to mirror. Likely not all queues are equally important
to your system, so you can make some of them non-HA.
3. Configure mirroring to, say, 2 nodes instead of &quot;all&quot;.
4. If you know what node is the master for a particular queue (e.g. was
declared on that node),
     make your clients connect there. It will decrease intra-cluster
traffic.
--
MK


</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029508.html">[rabbitmq-discuss] questions about RabbitMQ linear scalability
</A></li>
	<LI>Next message: <A HREF="029646.html">[rabbitmq-discuss] questions about RabbitMQ linear scalability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29542">[ date ]</a>
              <a href="thread.html#29542">[ thread ]</a>
              <a href="subject.html#29542">[ subject ]</a>
              <a href="author.html#29542">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
