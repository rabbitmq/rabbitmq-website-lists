<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1	single node as well as cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Question%20on%20throughput%20with%20RabbitMQ-3.1.1%0A%09single%20node%20as%20well%20as%20cluster&In-Reply-To=%3C1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028063.html">
   <LINK REL="Next"  HREF="028078.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1	single node as well as cluster</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Question%20on%20throughput%20with%20RabbitMQ-3.1.1%0A%09single%20node%20as%20well%20as%20cluster&In-Reply-To=%3C1B457225-F1BC-4DB7-8242-F7EE8AD3AE2A%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1	single node as well as cluster">watson.timothy at gmail.com
       </A><BR>
    <I>Tue Jun 25 09:38:47 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028063.html">[rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1 single node as well as cluster
</A></li>
        <LI>Next message: <A HREF="028078.html">[rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1	single node as well as cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28064">[ date ]</a>
              <a href="thread.html#28064">[ thread ]</a>
              <a href="subject.html#28064">[ subject ]</a>
              <a href="author.html#28064">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>What does your publishing code look like? The figures below are expected in that the consumer can keep pace with the producer - it could hardly be expected to consume faster than messages are arriving in the queue(s). So the slowness is very likely on the producing side.

Are you using persistent messages and either publisher confirms or transactions? If so, how often are you waiting on confirms/commits?

With the official clients we typically see avg rates of 50 - 60Khz with non-persistent messages. Persistence slows things down a tad, as do confirms (and more so transactions) but even with persistent messages and confirms, rates &gt;= 5Khz are expected. It /sounds/ like you might be publishing persistent messages with confirms enabled and waiting for a confirm (ack) from the broker for each message. That  involves disk I/O on the server for each message plus network latency, effectively making publishing synchronous (and very slow by comparison).

Cheers,
Tim

On 25 Jun 2013, at 08:44, Priyanki Vashi &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">vashi.priyanki at gmail.com</A>&gt; wrote:

&gt;<i> Hi there,
</I>&gt;<i> 
</I>&gt;<i> I am doing a performance study of RabbitMQ-3.1.1 and this is my first time to do such a performance study with any messaging broker :))-
</I>&gt;<i> 
</I>&gt;<i> 1) I have thoroughly gone through rabbitMQ in action' and learnt important concepts. 
</I>&gt;<i> 
</I>&gt;<i> 2) Tried single node broker to get a feel of how it is working and then set up a four node cluster (with two disk and two RAM type of node). Also configured HAproxy TCP Load balancer so that I can just provide single port to connect to the Cluster.
</I>&gt;<i> 
</I>&gt;<i> 3) I am simulating producer and consumers through Python scripts ( using Python-pika library methods to connect to server , publish subscribe etc.)
</I>&gt;<i> 
</I>&gt;<i> 4) My scripts are working fine but where I am stuck is no matter what I do my throughout is always 300 msg/sec. 
</I>&gt;<i> 
</I>&gt;<i> 5) I have defines durable exchanges and queues
</I>&gt;<i> 
</I>&gt;<i> My final requirement is to run atleast 10 to 15 producer and 60 to 70 consumer simultaneously and I want to start with linear increase in number of producer and consumer so that I can make conclusions about  throughout, fault handling, processor utilization etc. etc but I am seriously stuck now after trying to start in initial steps only. This group's help would be really appreciated. 
</I>&gt;<i> 
</I>&gt;<i> I have started with following different scenarios but no matter what I do my throughput is more or less remaining same (300 msg/sec) except for Scenario-1
</I>&gt;<i> 
</I>&gt;<i> Scenario-1
</I>&gt;<i> -1 producer and No consumer and no queue binded to exchange
</I>&gt;<i> -Producer is running in infinite loop and publishing to one fanout exchange
</I>&gt;<i> - publisher/confirm disabled
</I>&gt;<i> -Publisher rate - 6200 msg/sec ( checked through web management plugin)
</I>&gt;<i> 
</I>&gt;<i> Tried scenario-1 with also fanout type of exchange and it's the same publish rate
</I>&gt;<i> I know that Scenario-1 is not really useful, since there are no queues and ultimately messages will be dropped but as a part of debugging process I tried this and I see above mentioned results.
</I>&gt;<i> 
</I>&gt;<i> Scenario-2
</I>&gt;<i> -1 producer and 1 consumer 
</I>&gt;<i> -Producer is running in infinite loop and publishing to one direct exchange
</I>&gt;<i> -A consumer has it's own dedicated queue and listening to above exchange 
</I>&gt;<i> - publisher/confirm and consumer ack are disabled
</I>&gt;<i> Throughput - 300 msg/sec ( which is basically publish rate = 300 msg/sec and deliver rate - 300 msg/sec)
</I>&gt;<i> 
</I>&gt;<i> Tried Scenario-2 also with fanout type of exchange and enabling publisher confirm and consumer ack
</I>&gt;<i> Still the same throughput as 300 msg/sec
</I>&gt;<i> 
</I>&gt;<i> Scenario-3
</I>&gt;<i> -1 producer and 4 consumer 
</I>&gt;<i> -Producer is running in infinite loop and publishing to four direct exchange
</I>&gt;<i> -A consumer has it's own dedicated queue and listening to respective exchange 
</I>&gt;<i> - publisher/confirm and consumer ack are disabled
</I>&gt;<i> Throughput - 300 msg/sec ( which is basically publish rate = 300 msg/sec and deliver rate - 300 msg/sec)
</I>&gt;<i> 
</I>&gt;<i> Tried Scenario-3 also with fanout type of exchange and enabling publisher confirm and consumer ack
</I>&gt;<i> Still the same throughput as 300 msg/sec
</I>&gt;<i> 
</I>&gt;<i> Tried configuring prefetch_count parameters also to 100 but it still gives me same throughput of 300 msg/sec.
</I>&gt;<i> I am honestly going crazy with this.
</I>&gt;<i> 
</I>&gt;<i> After seeing this behavior, I am seriously suspecting that there is some serious limitation with my simulated producers and consumers.
</I>&gt;<i> Has anyone else has tried Python-pika client and any idea on throughput with this version of rabbit ? 
</I>&gt;<i> Did anyone have rough idea about throughout with rabbitMQ-3.1.1 ?
</I>&gt;<i> 
</I>&gt;<i> I can also share my python scripts if required but I would really appreciate some light on this situation
</I>&gt;<i> Also what points to take care, in order to improve throughput ?
</I>&gt;<i> 
</I>&gt;<i> Best Regards,
</I>&gt;<i> Priyanki
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/2c92c1a4/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/2c92c1a4/attachment.htm</A>&gt;
</PRE>









































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028063.html">[rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1 single node as well as cluster
</A></li>
	<LI>Next message: <A HREF="028078.html">[rabbitmq-discuss] Question on throughput with RabbitMQ-3.1.1	single node as well as cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28064">[ date ]</a>
              <a href="thread.html#28064">[ thread ]</a>
              <a href="subject.html#28064">[ subject ]</a>
              <a href="author.html#28064">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
