<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ's Mirroring results in weird behavior	when slave goes down
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%27s%20Mirroring%20results%20in%20weird%20behavior%0A%09when%20slave%20goes%20down&In-Reply-To=%3C1372141680170-27572.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028150.html">
   <LINK REL="Next"  HREF="028075.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ's Mirroring results in weird behavior	when slave goes down</H1>
    <B>thomas</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%27s%20Mirroring%20results%20in%20weird%20behavior%0A%09when%20slave%20goes%20down&In-Reply-To=%3C1372141680170-27572.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ's Mirroring results in weird behavior	when slave goes down">taihock at gmail.com
       </A><BR>
    <I>Tue Jun 25 07:28:00 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028150.html">[rabbitmq-discuss] rabbitmq clustering issues
</A></li>
        <LI>Next message: <A HREF="028075.html">[rabbitmq-discuss] RabbitMQ's Mirroring results in weird	behavior when slave goes down
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28062">[ date ]</a>
              <a href="thread.html#28062">[ thread ]</a>
              <a href="subject.html#28062">[ subject ]</a>
              <a href="author.html#28062">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have set up 3 cluster nodes namely <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at A</A>, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at B</A>, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at C</A> all running
on erlang 16B and rabbitmq 3.1.1. I set net_ticktime to 2 so as to detect
node failure faster.

I have did some test on it and found that there seems to be a weird behavior
when setting policy for mirroring.
For the purpose of testing, I modified the code for the java tutorial 1
hello world to send out 200,000 messages instead of 1 and also the queue is
created using the management console and not created in the code. Each time
it sends a message it will print out the current number starting from 1 til
199,999

Below is what I did:

1)For my 1st test, I only added a queue for the sending of messages which I
call it &quot;test&quot;. Throughout this test <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at A</A> is the master. Halfway into
sending the messages i will cut off the network connection for <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at B.</A> The
observation is that there is no disruption to the master. The result is
consistent for 10 tries.

2)For my 2nd test, it is almost identical to the 1st test except that i am
using mirroring using the following command:

rabbitmqctl set_policy HA '^(?!amq\.).*' '{&quot;ha-mode&quot;: &quot;all&quot;}'&quot;

The observation is different from that of the 1st test. Shortly after I cut
off the network connection from <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at B</A>, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at A</A> which is the master
handling the client's messages comes to a pause for over 15 seconds and the
pause is consistent for 10 tries. The client gets stuck in basic publish
when <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at A</A> comes to a pause.



I am quite puzzled about this behavior and would like to find out if that is
the intended behavior for rabbit's mirroring feature? Does anyone else
encounter such behavior when using mirroring? 

I have attached my code for sending messages. Thanks.
send.txt &lt;<A HREF="http://rabbitmq.1065348.n5.nabble.com/file/n27572/send.txt">http://rabbitmq.1065348.n5.nabble.com/file/n27572/send.txt</A>&gt;  



--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-s-Mirroring-results-in-weird-behavior-when-slave-goes-down-tp27572.html">http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-s-Mirroring-results-in-weird-behavior-when-slave-goes-down-tp27572.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028150.html">[rabbitmq-discuss] rabbitmq clustering issues
</A></li>
	<LI>Next message: <A HREF="028075.html">[rabbitmq-discuss] RabbitMQ's Mirroring results in weird	behavior when slave goes down
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28062">[ date ]</a>
              <a href="thread.html#28062">[ thread ]</a>
              <a href="subject.html#28062">[ subject ]</a>
              <a href="author.html#28062">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
