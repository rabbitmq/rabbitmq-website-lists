<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Mirrored queues behind a load balancer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mirrored%20queues%20behind%20a%20load%20balancer&In-Reply-To=%3C51BADC69.6020501%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027875.html">
   <LINK REL="Next"  HREF="027899.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Mirrored queues behind a load balancer</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mirrored%20queues%20behind%20a%20load%20balancer&In-Reply-To=%3C51BADC69.6020501%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Mirrored queues behind a load balancer">emile at rabbitmq.com
       </A><BR>
    <I>Fri Jun 14 10:03:37 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027875.html">[rabbitmq-discuss] Mirrored queues behind a load balancer
</A></li>
        <LI>Next message: <A HREF="027899.html">[rabbitmq-discuss] Mirrored queues behind a load balancer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27877">[ date ]</a>
              <a href="thread.html#27877">[ thread ]</a>
              <a href="subject.html#27877">[ subject ]</a>
              <a href="author.html#27877">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

On 13/06/13 20:41, Girish Gangadharan wrote:
&gt;<i> For example, if a publisher writes a message to an exchange that ends
</I>&gt;<i> up in a specific queue bound to that exchange, it immediately shows
</I>&gt;<i> up in the same queue on the other node.
</I>
There is only one queue on one node in this case. The cluster offers a
consistent view of all resources in the cluster and allows producers and
consumers to connect to any node. Messages are transparently routed
across the cluster.

&gt;<i> But then why does the article on Mirrored Queues say that *you have
</I>&gt;<i> to explicitly set up mirrored queues by policy*?
</I>
If a queue exists on only one node and that node crashes then the queue
becomes unavailable. Mirrored queues provides resilience by maintaining
copies of the queue that can take over in case a node crashes. See
<A HREF="http://www.rabbitmq.com/ha.html">http://www.rabbitmq.com/ha.html</A>

&gt;<i> So if one node goes down, the load balancer would automatically
</I>&gt;<i> redirect all the traffic just to the node that is up and running. And
</I>&gt;<i> the clients will not be affected. Would that work? Is that the 
</I>&gt;<i> recommended approach?
</I>
That is a common approach. Another is to provide clients with reconnect
logic that allows them to select the alternative node when one node crashes.

&gt;<i> I was thinking about using Shoveling technique to push messages from
</I>&gt;<i> a logical broker sitting on a cluster in our local HA servers to a
</I>&gt;<i> different logical broker to the DR server. In this case, a copy of
</I>&gt;<i> the messages will keep getting pumped into the DR with no clients
</I>&gt;<i> processing it. What will happen to those messages?
</I>
Nothing will happen to them. They will accumulate in the DR server
unless you take action to remove them, or unless they expire.

&gt;<i> Should I have a workflow to go purge them every day manually or via a
</I>&gt;<i> script (after I make sure those messages aren't needed anymore since
</I>&gt;<i> the clients have already process them from the main HA cluster).
</I>
That depends on the specifics of your disaster scenario, your messaging
pattern and how you plan to switch over to your DR environment. Purging
queues after a day sounds reasonable.

&gt;<i> If the main HA cluster goes down and I have to bring the DR server into
</I>&gt;<i> action, what happens to the messages that did get processed already by
</I>&gt;<i> the clients? Should the clients have logic built in to ignore duplicates
</I>&gt;<i> to handle this specific scenario?
</I>
Performing deduplication in clients is probably the simplest solution,
or you could mirror the effects of consumers removing messages from
queues in your DR environment.



-Emile




</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027875.html">[rabbitmq-discuss] Mirrored queues behind a load balancer
</A></li>
	<LI>Next message: <A HREF="027899.html">[rabbitmq-discuss] Mirrored queues behind a load balancer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27877">[ date ]</a>
              <a href="thread.html#27877">[ thread ]</a>
              <a href="subject.html#27877">[ subject ]</a>
              <a href="author.html#27877">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
