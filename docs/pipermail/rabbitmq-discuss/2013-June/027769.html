<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Connection.createChannel() hangs using amqp-client 3.1.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Connection.createChannel%28%29%20hangs%20using%0A%20amqp-client%203.1.1&In-Reply-To=%3CCA%2Bes_-wUnWeB--QMAB6RcjPWe6zgZM%3DowsVq9Qsq4kTeCV7zWg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027754.html">
   <LINK REL="Next"  HREF="027745.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Connection.createChannel() hangs using amqp-client 3.1.1</H1>
    <B>Jonathan Halterman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Connection.createChannel%28%29%20hangs%20using%0A%20amqp-client%203.1.1&In-Reply-To=%3CCA%2Bes_-wUnWeB--QMAB6RcjPWe6zgZM%3DowsVq9Qsq4kTeCV7zWg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Connection.createChannel() hangs using amqp-client 3.1.1">jhalterman at gmail.com
       </A><BR>
    <I>Fri Jun  7 16:47:57 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027754.html">[rabbitmq-discuss] Connection.createChannel() hangs using	amqp-client 3.1.1
</A></li>
        <LI>Next message: <A HREF="027745.html">[rabbitmq-discuss] How to identify connection?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27769">[ date ]</a>
              <a href="thread.html#27769">[ thread ]</a>
              <a href="subject.html#27769">[ subject ]</a>
              <a href="author.html#27769">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Tim,

Sounds good. Thanks for the info.

- jonathan

On Fri, Jun 7, 2013 at 1:57 AM, Tim Watson &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at rabbitmq.com</A>&gt; wrote:

&gt;<i> Hi Jonathan,
</I>&gt;<i>
</I>&gt;<i> Ok, you can safely ignore what I've written below. What's actually going
</I>&gt;<i> on (thanks to Matthias for pointing it out) is that the ShutdownListener
</I>&gt;<i> callbacks run in the connection's thread, so the call to createChannel
</I>&gt;<i> causes a deadlock since it blocks waiting for a response (whilst the
</I>&gt;<i> connection's thread is stuck executing the listener). I'm going to add some
</I>&gt;<i> notes to the API documentation explaining that, so future users don't get
</I>&gt;<i> caught out in the same way.
</I>&gt;<i>
</I>&gt;<i> The canonical approach to dealing with this is to have the shutdown
</I>&gt;<i> listener callback signal your own (application) thread, from which you can
</I>&gt;<i> manage recovery without risking deadlock in this fashion.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Tim
</I>&gt;<i>
</I>&gt;<i> On 7 Jun 2013, at 09:38, Tim Watson wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Hi Jonathan,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 6 Jun 2013, at 23:42, Jonathan Halterman wrote:
</I>&gt;<i> &gt;&gt; I hit on a scenario where connection.createChannel() may hang forever.
</I>&gt;<i> The scenario: obtain a channel and attempt to publish to a non-existent
</I>&gt;<i> exchange. The channel will be shutdown. Attempt to establish a new
</I>&gt;<i> (replacement) channel via Connection.createChannel(), which hangs forever.
</I>&gt;<i> A simple version of this scenario:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This should not be happening. Are you absolutely sure you're using
</I>&gt;<i> version 3.1.1 of the java client library, since a similar bug (involving
</I>&gt;<i> accidentally re-used channel ids) was fixed in a previous release:
</I>&gt;<i> <A HREF="http://hg.rabbitmq.com/rabbitmq-java-client/rev/ea7d68c2154d">http://hg.rabbitmq.com/rabbitmq-java-client/rev/ea7d68c2154d</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; From Tracer:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; 1370554962786: &lt;Tracer-0&gt; ch#1 &lt;-
</I>&gt;<i> {#method&lt;channel.close&gt;(reply-code=404, reply-text=NOT_FOUND - no exchange
</I>&gt;<i> 'foo' in vhost '/', class-id=60, method-id=40), null, &quot;&quot;}
</I>&gt;<i> &gt;&gt; 1370554962788: &lt;Tracer-0&gt; ch#1 -&gt; {#method&lt;channel.close-ok&gt;(), null,
</I>&gt;<i> &quot;&quot;}
</I>&gt;<i> &gt;&gt; 1370554974891: &lt;Tracer-0&gt; ch#1 -&gt; {#method&lt;channel.open&gt;(out-of-band=),
</I>&gt;<i> null, &quot;&quot;}
</I>&gt;<i> &gt;&gt; 1370554974970: &lt;Tracer-0&gt; ch#1 &lt;-
</I>&gt;<i> {#method&lt;channel.open-ok&gt;(channel-id=), null, &quot;&quot;}
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That last line seems very odd - I would've expected to a see a channel
</I>&gt;<i> id in there, though truth be told I'm not overly familiar with the Tracer
</I>&gt;<i> tool in the java client.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; Any ideas why things are hanging?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; According to the last line of the trace you've supplied, a new channel
</I>&gt;<i> was opened successfully, though there's no channel id present which is
</I>&gt;<i> worrying. Please confirm that you are definitely using the right version
</I>&gt;<i> (i.e., where did you obtain the amqp-client binary from) and we'll take a
</I>&gt;<i> closer look.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Cheers,
</I>&gt;<i> &gt; Tim
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/3ce45d8b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130607/3ce45d8b/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027754.html">[rabbitmq-discuss] Connection.createChannel() hangs using	amqp-client 3.1.1
</A></li>
	<LI>Next message: <A HREF="027745.html">[rabbitmq-discuss] How to identify connection?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27769">[ date ]</a>
              <a href="thread.html#27769">[ thread ]</a>
              <a href="subject.html#27769">[ subject ]</a>
              <a href="author.html#27769">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
