<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] |Spam| Re: Possible memory leak in the management plugin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%7CSpam%7C%20Re%3A%20Possible%20memory%20leak%20in%20the%0A%20management%20plugin&In-Reply-To=%3CCACCscvzKubvsiGWNXBgkb651UUPKY%3DEey0HZwVMr4VBrUrVAQg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027980.html">
   <LINK REL="Next"  HREF="027931.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] |Spam| Re: Possible memory leak in the management plugin</H1>
    <B>Travis Mehlinger</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%7CSpam%7C%20Re%3A%20Possible%20memory%20leak%20in%20the%0A%20management%20plugin&In-Reply-To=%3CCACCscvzKubvsiGWNXBgkb651UUPKY%3DEey0HZwVMr4VBrUrVAQg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] |Spam| Re: Possible memory leak in the management plugin">tmehlinger at gmail.com
       </A><BR>
    <I>Thu Jun 20 01:32:57 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027980.html">[rabbitmq-discuss] |Spam| Re: Possible memory leak in the management plugin
</A></li>
        <LI>Next message: <A HREF="027931.html">[rabbitmq-discuss] Possible memory leak in the management plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27995">[ date ]</a>
              <a href="thread.html#27995">[ thread ]</a>
              <a href="subject.html#27995">[ subject ]</a>
              <a href="author.html#27995">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I won't be able to test it in the same production environment but should be
able to reproduce the behavior in a test environment. I'm travelling
tomorrow afternoon, so if you don't hear from me by end of business UK time
tomorrow, I'll definitely have something for you Monday.

Thanks so much for all your help. :)

Best, Travis


On Wed, Jun 19, 2013 at 10:34 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt;wrote:

&gt;<i> Also, I have a patched version of the management plugin which fixes the
</I>&gt;<i> leak I found today:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/**releases/plugins/v3.1.1/**">http://www.rabbitmq.com/**releases/plugins/v3.1.1/**</A>
</I>&gt;<i> rabbitmq_management-3.1.1-**leakfix1.ez&lt;<A HREF="http://www.rabbitmq.com/releases/plugins/v3.1.1/rabbitmq_management-3.1.1-leakfix1.ez">http://www.rabbitmq.com/releases/plugins/v3.1.1/rabbitmq_management-3.1.1-leakfix1.ez</A>&gt;
</I>&gt;<i>
</I>&gt;<i> (see <A HREF="http://www.rabbitmq.com/**plugins.html#installing-**plugins&lt;http://www.rabbitmq.com/plugins.html#installing-plugins">http://www.rabbitmq.com/**plugins.html#installing-**plugins&lt;http://www.rabbitmq.com/plugins.html#installing-plugins</A>&gt;for where to put it, it replaces rabbitmq_management-3.1.1.ez)
</I>&gt;<i>
</I>&gt;<i> If you are able to test this version, that would also be great.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> On 19/06/13 15:57, Simon MacMullen wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Thanks.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Could you run
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> rabbitmqctl eval
</I>&gt;&gt;<i> '{_,_,_,[_,_,_,_,[_,_,{_,[{_,**S}]}]]}=sys:get_status(global:**
</I>&gt;&gt;<i> whereis_name(rabbit_mgmt_db)),**T=element(5,S),ets:foldl(fun(**
</I>&gt;&gt;<i> E,_)-&gt;io:format(&quot;~p~n~n&quot;,[E])**end,[],T).'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> please? This will dump the entire leaky table to standard output, so you
</I>&gt;&gt;<i> would want to redirect it to a file.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you could also accompany that with &quot;rabbitmqctl report&quot; so I can see
</I>&gt;&gt;<i> what actually exists at that time then I can at least see what is leaking.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers, Simon
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 19/06/13 15:30, Travis Mehlinger wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi Simon,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> We aren't doing anything like that. Whenever one of our services starts
</I>&gt;&gt;&gt;<i> (which are based on Kombu, if that helps), it plucks a connection from
</I>&gt;&gt;&gt;<i> its internal pool, creates a channel on that connection, then binds on
</I>&gt;&gt;&gt;<i> its request queue, which hangs around until the service stops. The only
</I>&gt;&gt;&gt;<i> thing that deviates from this pattern is our monitor, which connects and
</I>&gt;&gt;&gt;<i> disconnects fairly rapidly, and uses exclusive queues.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> That said, it's entirely possible that we have something floating around
</I>&gt;&gt;&gt;<i> that I don't know about that fits the behavior you described. I'll keep
</I>&gt;&gt;&gt;<i> digging and see what I can turn up. In the meantime, let me know if
</I>&gt;&gt;&gt;<i> there's any more information I can collect from Rabbit.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks, Travis
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Wed, Jun 19, 2013 at 6:13 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>
</I>&gt;&gt;&gt;<i> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt;&gt; wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     On 18/06/13 16:11, Travis Mehlinger wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         We declare those queues as exclusive so they're getting
</I>&gt;&gt;&gt;<i> cleaned up
</I>&gt;&gt;&gt;<i>         automatically.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     I have found a plausible candidate for the leak. But it's dependent
</I>&gt;&gt;&gt;<i>     on having a long lived channel which declares and deletes lots of
</I>&gt;&gt;&gt;<i>     short-lived queues. We keep some information on the deleted queues
</I>&gt;&gt;&gt;<i>     until the channel is closed. Could your monitoring tool be doing
</I>&gt;&gt;&gt;<i>     that? Obviously it would have to be deleting queues explicitly, not
</I>&gt;&gt;&gt;<i>     relying on them being exclusive.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     Cheers, Simon
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     --
</I>&gt;&gt;&gt;<i>     Simon MacMullen
</I>&gt;&gt;&gt;<i>     RabbitMQ, Pivotal
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/7db18ab3/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130619/7db18ab3/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027980.html">[rabbitmq-discuss] |Spam| Re: Possible memory leak in the management plugin
</A></li>
	<LI>Next message: <A HREF="027931.html">[rabbitmq-discuss] Possible memory leak in the management plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27995">[ date ]</a>
              <a href="thread.html#27995">[ thread ]</a>
              <a href="subject.html#27995">[ subject ]</a>
              <a href="author.html#27995">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
