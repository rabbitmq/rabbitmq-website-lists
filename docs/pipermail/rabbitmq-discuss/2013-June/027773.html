<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Persistent queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Persistent%20queues&In-Reply-To=%3C51B22BDA.4000403%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027767.html">
   <LINK REL="Next"  HREF="027762.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Persistent queues</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Persistent%20queues&In-Reply-To=%3C51B22BDA.4000403%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Persistent queues">matthias at rabbitmq.com
       </A><BR>
    <I>Fri Jun  7 19:52:10 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027767.html">[rabbitmq-discuss] Persistent queues
</A></li>
        <LI>Next message: <A HREF="027762.html">[rabbitmq-discuss] Management console UI lists many consumers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27773">[ date ]</a>
              <a href="thread.html#27773">[ thread ]</a>
              <a href="subject.html#27773">[ subject ]</a>
              <a href="author.html#27773">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Marc,

just a few observations on your setup, to supplement the answers to your 
specific questions that Simon gave...

On 07/06/13 15:12, Marc Labbe wrote:
&gt;<i> RabbitMQ
</I>&gt;<i> - RabbitMQ 3.0.x (not exactly sure what x was)
</I>&gt;<i> - 5 brokers (behind HA proxy)
</I>&gt;<i> - Messages posted to multiple topics (called it A, B, C) where the topic
</I>&gt;<i> is used as the routing key by the exchange
</I>&gt;<i> - Queues and messages are persistent (+ replicated)
</I>&gt;<i>
</I>&gt;<i> Consumers
</I>&gt;<i> - Consumer 1 subscribes to Topic A (near real-time) - Queue 1
</I>&gt;<i> - Consumer 2 subscribes to Topic B (near real-time)  - Queue 2
</I>&gt;<i> - Consumer 3 subscribes to A, B and C (offline, BI) - Queue 3
</I>&gt;<i>
</I>&gt;<i> Published 10M messages (size varying between 500b to 2k)
</I>
So is that a cluster of five rabbit nodes, with ha-mode='all' set for 
all queues?

If so, note...

- RabbitMQ 3.1 has some significant bug fixes over 3.0, including to a 
memory leak in HA queues, and performance improvements (to HA queues and 
beyond); so you should really upgrade

- with five nodes, you probably ought to configure the ha-mode for the 
queues to be 'exactly' or 'nodes', to limit mirroring to a sub-set; 
unless you really want five replicas of your data.

- if there are really only three queues then you'll want to make sure 
their masters (and slaves) are not clumped together on just a few nodes. 
The 'nodes' policy is useful for that.

- with five nodes, you probably ought to configure all but two or three 
as ram nodes instead of disk nodes, to cut down on the number of 
synchronous disk operations performed for queue/exchange/binding 
creation/deletion. I guess this won't matter much in your case though, 
since it looks like the set of exchanges, queues and bindings is pretty 
static.

Regards,

Matthias.
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027767.html">[rabbitmq-discuss] Persistent queues
</A></li>
	<LI>Next message: <A HREF="027762.html">[rabbitmq-discuss] Management console UI lists many consumers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27773">[ date ]</a>
              <a href="thread.html#27773">[ thread ]</a>
              <a href="subject.html#27773">[ subject ]</a>
              <a href="author.html#27773">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
