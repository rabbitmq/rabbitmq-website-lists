<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Mirrored queues behind a load balancer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mirrored%20queues%20behind%20a%20load%20balancer&In-Reply-To=%3CCAGT39YvSuJCUwQv8Bm%2BWEhkR3NncgXb5NP%3D1GQiitJKOnpyGiA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027877.html">
   <LINK REL="Next"  HREF="027909.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Mirrored queues behind a load balancer</H1>
    <B>Girish Gangadharan</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mirrored%20queues%20behind%20a%20load%20balancer&In-Reply-To=%3CCAGT39YvSuJCUwQv8Bm%2BWEhkR3NncgXb5NP%3D1GQiitJKOnpyGiA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Mirrored queues behind a load balancer">girish at giri.sh
       </A><BR>
    <I>Fri Jun 14 16:37:07 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027877.html">[rabbitmq-discuss] Mirrored queues behind a load balancer
</A></li>
        <LI>Next message: <A HREF="027909.html">[rabbitmq-discuss] Mirrored queues behind a load balancer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27899">[ date ]</a>
              <a href="thread.html#27899">[ thread ]</a>
              <a href="subject.html#27899">[ subject ]</a>
              <a href="author.html#27899">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for your reply. Please see my response in red.

On Fri, Jun 14, 2013 at 4:03 AM, Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> On 13/06/13 20:41, Girish Gangadharan wrote:
</I>&gt;<i> &gt; For example, if a publisher writes a message to an exchange that ends
</I>&gt;<i> &gt; up in a specific queue bound to that exchange, it immediately shows
</I>&gt;<i> &gt; up in the same queue on the other node.
</I>&gt;<i>
</I>&gt;<i> There is only one queue on one node in this case. The cluster offers a
</I>&gt;<i> consistent view of all resources in the cluster and allows producers and
</I>&gt;<i> consumers to connect to any node. Messages are transparently routed
</I>&gt;<i> across the cluster.
</I>&gt;<i>
</I>
Does this mean that the queues actually exist only in one node to whose
exchange the message was originally written to? And the fact that I can see
them in the admin console of the other node is just to provide a consistent
view across the cluster? So any action that I do with the original queue on
the other nodes' admin consoles basically makes the changes to the queue on
the original node and not to the copy of that queue on the other nodes? In
fact, if I understand you correctly, there IS no copy of the queue on the
other nodes? Did I get that right?

Not sure I understand the consistent view explanation either? What are the
main benefits of having multiple nodes in a cluster if they can't really
share anything? I would think Mirrored Queues should be an automatic
by-product of clustering, thus offering HA out of the box. Can you explain
to me why somebody would create a cluster of nodes and NOT have mirrored
queues set up?


&gt;<i>
</I>&gt;<i> &gt; But then why does the article on Mirrored Queues say that *you have
</I>&gt;<i> &gt; to explicitly set up mirrored queues by policy*?
</I>&gt;<i>
</I>&gt;<i> If a queue exists on only one node and that node crashes then the queue
</I>&gt;<i> becomes unavailable. Mirrored queues provides resilience by maintaining
</I>&gt;<i> copies of the queue that can take over in case a node crashes. See
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/ha.html">http://www.rabbitmq.com/ha.html</A>
</I>&gt;<i>
</I>&gt;<i> &gt; So if one node goes down, the load balancer would automatically
</I>&gt;<i> &gt; redirect all the traffic just to the node that is up and running. And
</I>&gt;<i> &gt; the clients will not be affected. Would that work? Is that the
</I>&gt;<i> &gt; recommended approach?
</I>&gt;<i>
</I>&gt;<i> That is a common approach. Another is to provide clients with reconnect
</I>&gt;<i> logic that allows them to select the alternative node when one node
</I>&gt;<i> crashes.
</I>&gt;<i>
</I>&gt;<i> &gt; I was thinking about using Shoveling technique to push messages from
</I>&gt;<i> &gt; a logical broker sitting on a cluster in our local HA servers to a
</I>&gt;<i> &gt; different logical broker to the DR server. In this case, a copy of
</I>&gt;<i> &gt; the messages will keep getting pumped into the DR with no clients
</I>&gt;<i> &gt; processing it. What will happen to those messages?
</I>&gt;<i>
</I>&gt;<i> Nothing will happen to them. They will accumulate in the DR server
</I>&gt;<i> unless you take action to remove them, or unless they expire.
</I>&gt;<i>
</I>&gt;<i> &gt; Should I have a workflow to go purge them every day manually or via a
</I>&gt;<i> &gt; script (after I make sure those messages aren't needed anymore since
</I>&gt;<i> &gt; the clients have already process them from the main HA cluster).
</I>&gt;<i>
</I>&gt;<i> That depends on the specifics of your disaster scenario, your messaging
</I>&gt;<i> pattern and how you plan to switch over to your DR environment. Purging
</I>&gt;<i> queues after a day sounds reasonable.
</I>&gt;<i>
</I>&gt;<i> &gt; If the main HA cluster goes down and I have to bring the DR server into
</I>&gt;<i> &gt; action, what happens to the messages that did get processed already by
</I>&gt;<i> &gt; the clients? Should the clients have logic built in to ignore duplicates
</I>&gt;<i> &gt; to handle this specific scenario?
</I>&gt;<i>
</I>&gt;<i> Performing deduplication in clients is probably the simplest solution,
</I>&gt;<i> or you could mirror the effects of consumers removing messages from
</I>&gt;<i> queues in your DR environment.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -Emile
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/0a4dc238/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/0a4dc238/attachment.htm</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027877.html">[rabbitmq-discuss] Mirrored queues behind a load balancer
</A></li>
	<LI>Next message: <A HREF="027909.html">[rabbitmq-discuss] Mirrored queues behind a load balancer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27899">[ date ]</a>
              <a href="thread.html#27899">[ thread ]</a>
              <a href="subject.html#27899">[ subject ]</a>
              <a href="author.html#27899">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
