<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Possible memory leak in the management plugin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20memory%20leak%20in%20the%20management%20plugin&In-Reply-To=%3C8a1af6ed-c599-42a3-85c3-c5dc22a99bd8%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027889.html">
   <LINK REL="Next"  HREF="027915.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Possible memory leak in the management plugin</H1>
    <B>Travis Mehlinger</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20memory%20leak%20in%20the%20management%20plugin&In-Reply-To=%3C8a1af6ed-c599-42a3-85c3-c5dc22a99bd8%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Possible memory leak in the management plugin">tmehlinger at gmail.com
       </A><BR>
    <I>Sat Jun 15 03:09:21 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027889.html">[rabbitmq-discuss] ANN Bunny 0.9.0.rc1 is released
</A></li>
        <LI>Next message: <A HREF="027915.html">[rabbitmq-discuss] Possible memory leak in the management plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27902">[ date ]</a>
              <a href="thread.html#27902">[ thread ]</a>
              <a href="subject.html#27902">[ subject ]</a>
              <a href="author.html#27902">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We recently upgraded RabbitMQ from 3.0.4 to 3.1.1 after noticing two bug 
fixes in 3.1.0 related to our RabbitMQ deployment:

   - 25524 fix memory leak in mirror queue slave with many short-lived 
   publishing channel
   - 25290 fix per-queue memory leak recording stats for mirror queue slaves

However, in our case, it seems that the management plugin may still have a 
memory leak. We have a monitoring agent that hits the REST API to gather 
information about the broker (number of queues, queue depth, etc.). With 
the monitoring agent running and making requests against the API, memory 
consumption steadily increased; when we stopped the agent, memory 
consumption in the management plugin leveled off.

Here a couple graphs detailing memory consumption in the broker (the 
figures are parsed from rabbitmqctl report). The first graph shows the ebb 
and flow of memory consumption in a number of components and the second 
shows just consumption by the management plugin. You can see pretty clearly 
where we stopped the monitoring agent at 1:20.

<A HREF="https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png">https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png</A>
<A HREF="https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png">https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png</A>

We have two clustered brokers, both running RabbitMQ 3.1.1 on Erlang 
R14B-04.1. There are typically around 200 queues, about 20 of which are 
mirrored. There are generally about 200 consumers. Messages are rarely 
queued and most queues typically sit idle.

I'll be happy to provide any further diagnostic information.

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/308e884e/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/308e884e/attachment.htm</A>&gt;
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027889.html">[rabbitmq-discuss] ANN Bunny 0.9.0.rc1 is released
</A></li>
	<LI>Next message: <A HREF="027915.html">[rabbitmq-discuss] Possible memory leak in the management plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27902">[ date ]</a>
              <a href="thread.html#27902">[ thread ]</a>
              <a href="subject.html#27902">[ subject ]</a>
              <a href="author.html#27902">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
