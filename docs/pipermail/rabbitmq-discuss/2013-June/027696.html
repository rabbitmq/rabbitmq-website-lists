<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Possible process leak in RabbitMQ server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20process%20leak%20in%20RabbitMQ%20server&In-Reply-To=%3CCAMbH-owesAXQfpVsAsFSB%2BFFKe6c9NwmAh5JWePMtrT3FEOcWQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027695.html">
   <LINK REL="Next"  HREF="027757.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Possible process leak in RabbitMQ server</H1>
    <B>Daniel Luna</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20process%20leak%20in%20RabbitMQ%20server&In-Reply-To=%3CCAMbH-owesAXQfpVsAsFSB%2BFFKe6c9NwmAh5JWePMtrT3FEOcWQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Possible process leak in RabbitMQ server">daniel at siftlogic.com
       </A><BR>
    <I>Wed Jun  5 17:00:45 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027695.html">[rabbitmq-discuss] 3.1.1 HTTP API leaks information
</A></li>
        <LI>Next message: <A HREF="027757.html">[rabbitmq-discuss] Possible process leak in RabbitMQ server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27696">[ date ]</a>
              <a href="thread.html#27696">[ thread ]</a>
              <a href="subject.html#27696">[ subject ]</a>
              <a href="author.html#27696">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

We are experiencing a growth of processes in the rabbitmq server for long
running connections.  I have no idea if we are doing something wrong or if
this is a bug in rabbitmq itself.

In an idle system we have about 30k connections to rabbitmq, using around
31k channels.

Sockets and file descriptors match more or less one-to-one to the
connections and so does the number of Erlang processes initally.  My
problem here is that the number of Erlang processes is steadily growing.

At the moment we have ~500k Erlang processes in our rabbitmq server with
47k connections using 54k channels.  As soon as the load on our system
lightens up the number of connections and channels will go down as
expected, but the number of processes will stay high.

Restarting the client will drop the process count, so this is something
related to keeping long living connections and/or channels around.

Oh, yeah, upgrading from 2.8.2 to 3.1.1 made no difference.

Connection counts are steady as are channel counts (i.e. they grow and
shrink as expected depending on load).  We use both a polling and a
subscribing pattern depending on the particular consumer.  I've seen a
system with all empty queues have this issue so it's not based on that
either.

I'm suspecting that there's a missing exit that leaves a dangling processes
for some sort of operation. It's something that's properly linked with the
connection (or channel) though since they go away on connection restart.

I'll research some more and see what I can dig up.

Help would be appreciated.

Cheers,

Daniel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130605/ced2d1dd/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130605/ced2d1dd/attachment.htm</A>&gt;
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027695.html">[rabbitmq-discuss] 3.1.1 HTTP API leaks information
</A></li>
	<LI>Next message: <A HREF="027757.html">[rabbitmq-discuss] Possible process leak in RabbitMQ server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27696">[ date ]</a>
              <a href="thread.html#27696">[ thread ]</a>
              <a href="subject.html#27696">[ subject ]</a>
              <a href="author.html#27696">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
