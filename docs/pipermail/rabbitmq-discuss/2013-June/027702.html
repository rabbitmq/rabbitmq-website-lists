<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Pika connection negotiation behavior
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Pika%20connection%20negotiation%20behavior&In-Reply-To=%3C51B01FBC.1030506%40yahoo.co.in%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027728.html">
   <LINK REL="Next"  HREF="027703.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Pika connection negotiation behavior</H1>
    <B>maitreya</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Pika%20connection%20negotiation%20behavior&In-Reply-To=%3C51B01FBC.1030506%40yahoo.co.in%3E"
       TITLE="[rabbitmq-discuss] Pika connection negotiation behavior">maitreya_vvm at yahoo.co.in
       </A><BR>
    <I>Thu Jun  6 06:35:56 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027728.html">[rabbitmq-discuss] Acknowledging messages across the federation
</A></li>
        <LI>Next message: <A HREF="027703.html">[rabbitmq-discuss] Pika connection negotiation behavior
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27702">[ date ]</a>
              <a href="thread.html#27702">[ thread ]</a>
              <a href="subject.html#27702">[ subject ]</a>
              <a href="author.html#27702">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matthias,

I had a problem with the Pika connection negotiation behavior which is 
leading to a situation where the heartbeat interval has a maximum 
possible value of 600s. The problem i had is the following,

I am using pika 0.9.9 with RabbitMQ 3.0.3. Few of the consumers we have 
are long running, so I would want to have a long heartbeat_interval so 
that the connections are not removed from either side. But the network 
infrastructure will not allow long idle connections so I wanted to set 
the heartbeat interval to 3600s(assuming pika is single threaded and can 
analyze the heartbeat events only between requests). But when I check 
the Timeout value in the RMQ Management page, I see it set only to 600.

Any number i try in the range of (300-600) works but above 600, it 
somehow defaults to 600. I think I didnt have this problem with RMQ 2.8. 
I am using php-amqplib for other piece of code and it is able to set 
heartbeat_interval to 3600s with RabbitMQ 3.0.3. My usage of creating a 
conncetion is as follows:


and my thoughts on why there shouldnt be a maximum value for heatbeat 
interval is the following,

I think the heartbeat interval should be flexible enough for different 
type of workers. For example, we have a combination of long-running 
tasks and short-running tasks. The short running tasks range from 1 to 
10 seconds. The long running tasks can take anytime depending on the 
input video size. So, for long running tasks, if the heartbeat interval 
set is 10 minutes, the client will not respond to the server's heartbeat 
for a long time which will result in the server disconnecting the 
client. Now the problem for disabling the heartbeat is the network 
infrastructure (like EC2) will kill any connections which are idle for 
more than about a day(dont know the exact time). So if the heartbeat is 
disabled then the connections are gone for good. An application can have 
a variety of load patterns, mine being short bursts with long idle time. 
So I think the heartbeat should be flexible enough to support a variety 
of consumers and different network infrastructures.

Please let me know your thoughts on this so that there could be a 
possible change in the client's connection behavior

regards,
Maitreya

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/b9aa2593/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130606/b9aa2593/attachment.htm</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027728.html">[rabbitmq-discuss] Acknowledging messages across the federation
</A></li>
	<LI>Next message: <A HREF="027703.html">[rabbitmq-discuss] Pika connection negotiation behavior
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27702">[ date ]</a>
              <a href="thread.html#27702">[ thread ]</a>
              <a href="subject.html#27702">[ subject ]</a>
              <a href="author.html#27702">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
