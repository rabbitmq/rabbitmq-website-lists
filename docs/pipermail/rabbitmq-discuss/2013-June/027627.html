<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] New lua-resty-rabbitmq library
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20New%20lua-resty-rabbitmq%20library&In-Reply-To=%3CCAMF%2B%2BH8tWSOHun%3DAtVyroz-JF2BQz7ZRBXVVfEY7jDwcaemhHA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027626.html">
   <LINK REL="Next"  HREF="027637.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] New lua-resty-rabbitmq library</H1>
    <B>Rohit Yadav</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20New%20lua-resty-rabbitmq%20library&In-Reply-To=%3CCAMF%2B%2BH8tWSOHun%3DAtVyroz-JF2BQz7ZRBXVVfEY7jDwcaemhHA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] New lua-resty-rabbitmq library">rohit.yadav at wingify.com
       </A><BR>
    <I>Sat Jun  1 13:57:26 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027626.html">[rabbitmq-discuss] RabbitMQ monitoring app shows load balancer	IP instead of client IP
</A></li>
        <LI>Next message: <A HREF="027637.html">[rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27627">[ date ]</a>
              <a href="thread.html#27627">[ thread ]</a>
              <a href="subject.html#27627">[ subject ]</a>
              <a href="author.html#27627">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I've finished the first production ready iteration v0.1 of
lua-resty-rabbitmqstomp library. I've renamed the library after concerns
from Brian;

<A HREF="https://github.com/wingify/lua-resty-rabbitmqstomp">https://github.com/wingify/lua-resty-rabbitmqstomp</A>

After correct usage of cosocket api, I'm able to publish concurrently
without any errors as seen in our lab tests. The throughput rate is still
low when receipts (or confirms) are enabled due to STOMP over AMQP overhead
so we've decided to go with a different architecture which involves Redis,
message aggregation and RabbitMQ for fast and reliable messaging. For this
work, we've written a transport agent called agentredrabbit which is
already being used in our production pipelines and we are planning to
opensource it soon.

Regards.



On Fri, May 31, 2013 at 12:40 AM, agentzh &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">agentzh at gmail.com</A>&gt; wrote:

&gt;<i> Hello!
</I>&gt;<i>
</I>&gt;<i> On Thu, May 30, 2013 at 11:56 AM, Rohit Yadav wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I think this could be a reason, due to RabbitMQ's disk io for persisting
</I>&gt;<i> &gt; queue/messages.
</I>&gt;<i> &gt; In that case would it be too much performance penalty to sleep for a
</I>&gt;<i> while
</I>&gt;<i> &gt; and retry with a new connection in the request?
</I>&gt;<i>
</I>&gt;<i> Explicit sleeping may be too much, because the waiting latency is not
</I>&gt;<i> under complete control.
</I>&gt;<i>
</I>&gt;<i> I've been thinking about some kind of automatic request queueing in
</I>&gt;<i> ngx_lua's cosocket connection pool so that your tcpsock:connect() call
</I>&gt;<i> can just temporarily hang up waiting for other connections to complete
</I>&gt;<i> when the backend request concurrency limit is hit. That way, the
</I>&gt;<i> waiting latency involved cannot be any longer than necessary and
</I>&gt;<i> client traffic peaks cannot overload the backend services.
</I>&gt;<i>
</I>&gt;<i> Before that happens, the standard ngx_limit_req and ngx_limit_conn
</I>&gt;<i> modules can also temporarily block exceeding client connections or
</I>&gt;<i> request, thus effectively limiting the backend request concurrency
</I>&gt;<i> level.
</I>&gt;<i>
</I>&gt;<i> &gt; To make the request finish fast I can do a pcall(ngx.eof) and end the
</I>&gt;<i> &gt; request and then carry on with publishing message to the RabbitMQ broker.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> This is a common trick used by the community. Alternatively, you can
</I>&gt;<i> also use ngx.timer.at() to do async job processing:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://wiki.nginx.org/HttpLuaModule#ngx.timer.at">http://wiki.nginx.org/HttpLuaModule#ngx.timer.at</A>
</I>&gt;<i>
</I>&gt;<i> But always keep in mind, async processing can be a devil because jobs
</I>&gt;<i> can accumulate really fast and eventually exhaust the system resources
</I>&gt;<i> if the backend cannot catch up with the frontend. This is also an
</I>&gt;<i> effective DoS attack.
</I>&gt;<i>
</I>&gt;<i> Happy hacking!
</I>&gt;<i>
</I>&gt;<i> Best regards,
</I>&gt;<i> -agentzh
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> You received this message because you are subscribed to the Google Groups
</I>&gt;<i> &quot;openresty-en&quot; group.
</I>&gt;<i> To unsubscribe from this group and stop receiving emails from it, send an
</I>&gt;<i> email to <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">openresty-en+unsubscribe at googlegroups.com.</A>
</I>&gt;<i> For more options, visit <A HREF="https://groups.google.com/groups/opt_out.">https://groups.google.com/groups/opt_out.</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130601/7d576c13/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130601/7d576c13/attachment.htm</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027626.html">[rabbitmq-discuss] RabbitMQ monitoring app shows load balancer	IP instead of client IP
</A></li>
	<LI>Next message: <A HREF="027637.html">[rabbitmq-discuss] RabbitMQ 3.1.0 HTTP API rates are always zero
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27627">[ date ]</a>
              <a href="thread.html#27627">[ thread ]</a>
              <a href="subject.html#27627">[ subject ]</a>
              <a href="author.html#27627">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
