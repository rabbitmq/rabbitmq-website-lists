<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq-c close channel already but still get message from the channel
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq-c%20close%20channel%20already%20but%20still%0A%20get%20message%20from%20the%20channel&In-Reply-To=%3CCAAt2poLz1srVxQFGwXSp68nXGUu%3DsFMeS%2BMLi0NDH2j_7gcbLA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027879.html">
   <LINK REL="Next"  HREF="027891.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq-c close channel already but still get message from the channel</H1>
    <B>Alan Antonuk</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq-c%20close%20channel%20already%20but%20still%0A%20get%20message%20from%20the%20channel&In-Reply-To=%3CCAAt2poLz1srVxQFGwXSp68nXGUu%3DsFMeS%2BMLi0NDH2j_7gcbLA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmq-c close channel already but still get message from the channel">alan.antonuk at gmail.com
       </A><BR>
    <I>Fri Jun 14 18:13:15 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027879.html">[rabbitmq-discuss] rabbitmq-c close channel already but still get message from the channel
</A></li>
        <LI>Next message: <A HREF="027891.html">[rabbitmq-discuss] rabbitmq-c close channel already but still get message from the channel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27887">[ date ]</a>
              <a href="thread.html#27887">[ thread ]</a>
              <a href="subject.html#27887">[ subject ]</a>
              <a href="author.html#27887">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Inlined below.

-Alan

On Fri, Jun 14, 2013 at 3:18 AM, 3k4b251 &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">314992959 at qq.com</A>&gt; wrote:

&gt;<i> &lt;<A HREF="http://rabbitmq.1065348.n5.nabble.com/file/n27390/list_queue.jpg">http://rabbitmq.1065348.n5.nabble.com/file/n27390/list_queue.jpg</A>&gt;
</I>&gt;<i>
</I>&gt;<i> you can see  tha   I  get  four  messages  in the  queue -----fb_test_2
</I>&gt;<i> ,so  I  will  use  function wait_simple_frame()  to  receive   msg in a
</I>&gt;<i> thread.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in  the void main(){};
</I>&gt;<i>
</I>&gt;<i> Scene 1:
</I>&gt;<i> I  open  the  channel  1  :  amqp_channel_open(conn,1);
</I>&gt;<i> ask consumer   :amqp_basic_consume(conn,1...);
</I>&gt;<i> I get  the  message from  queue---fb_test_2
</I>&gt;<i>
</I>&gt;<i> Scene 2:
</I>&gt;<i> I  did  nothing;
</I>&gt;<i> I  block   in the  wait_simple_frame()  and nothing receive;
</I>&gt;<i>
</I>&gt;<i> Scene 3:
</I>&gt;<i> I  open the channel  1:  amqp_channel_open(conn,1);
</I>&gt;<i> I ask  consumer :  amqp_basic_consume(conn,1...);
</I>&gt;<i> then I close the channel immediately :  amqp_channel_close(conn,1);
</I>&gt;<i> but what happens,  I  still  receive  the message... I don't  think  I
</I>&gt;<i> should receive them.  what' the problem?
</I>&gt;<i>
</I>
You're seeing the result of the network buffering. As soon as the broker
received the basic.consume method, if there are messages in the queue, the
broker will start sending queued messages to the client. Even though you
immediately closed the channel, because it takes time to send the
channel.close method across the network, the broker will still have time to
send messages to the client before the channel is closed. You are seeing
messages that are sent before the broker closes the channel.

This is expected behavior.


&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context:
</I>&gt;<i> <A HREF="http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-close-channel-already-but-still-get-message-from-the-channel-tp27390.html">http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-close-channel-already-but-still-get-message-from-the-channel-tp27390.html</A>
</I>&gt;<i> Sent from the RabbitMQ mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/b1899e13/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130614/b1899e13/attachment.htm</A>&gt;
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027879.html">[rabbitmq-discuss] rabbitmq-c close channel already but still get message from the channel
</A></li>
	<LI>Next message: <A HREF="027891.html">[rabbitmq-discuss] rabbitmq-c close channel already but still get message from the channel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27887">[ date ]</a>
              <a href="thread.html#27887">[ thread ]</a>
              <a href="subject.html#27887">[ subject ]</a>
              <a href="author.html#27887">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
