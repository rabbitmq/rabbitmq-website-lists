From tilak.chauhan at ymail.com  Mon Apr  1 10:16:22 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Mon, 1 Apr 2013 02:16:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem with multiple consumers on multiple
	servers !
In-Reply-To: <E545C841-72CF-48AC-A49D-C7283282066B@rabbitmq.com>
References: <1364583437418-25790.post@n5.nabble.com>
	<3CBCB0F9-112C-4CC3-BB5B-5D1B4C753AFD@rabbitmq.com>
	<1364653711470-25800.post@n5.nabble.com>
	<E545C841-72CF-48AC-A49D-C7283282066B@rabbitmq.com>
Message-ID: <1364807782973-25809.post@n5.nabble.com>

Hi,

The real problem seems is the working fashion of rabbitmq (round robin). If
there are 2 consumers on a queue then I should see 2 unacknowledged messages
at a time (meaning, 2 consumers are consuming messages). But, I see only 1
unacknowledged message even there are plenty of messages in queue waiting to
be consumed. If both the consumers are running on different threads then how
could this possible ? why only 1 consumer is consuming message and other one
is in idle state ? 

Is there any other way by which I can make consumers to consume next
messages from the queue as soon as they finish their last job/message ?  

Thanks.
T.luck



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Problem-with-multiple-consumers-on-multiple-servers-tp25790p25809.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Mon Apr  1 13:42:59 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 1 Apr 2013 13:42:59 +0100
Subject: [rabbitmq-discuss] Problem with multiple consumers on multiple
	servers !
In-Reply-To: <1364807782973-25809.post@n5.nabble.com>
References: <1364583437418-25790.post@n5.nabble.com>
	<3CBCB0F9-112C-4CC3-BB5B-5D1B4C753AFD@rabbitmq.com>
	<1364653711470-25800.post@n5.nabble.com>
	<E545C841-72CF-48AC-A49D-C7283282066B@rabbitmq.com>
	<1364807782973-25809.post@n5.nabble.com>
Message-ID: <0948EB5F-B5A7-4C46-962A-E4D57AB6BA65@rabbitmq.com>

tluck,

On 1 Apr 2013, at 10:16, tluck wrote:

> The real problem seems is the working fashion of rabbitmq (round robin). If
> there are 2 consumers on a queue then I should see 2 unacknowledged messages
> at a time (meaning, 2 consumers are consuming messages).

No that is just not correct, or at the very least you're phrasing it in a way
that doesn't make any sense to me. Are you saying that you want a per-queue (rather
than per-consumer) prefetch count?

> But, I see only 1
> unacknowledged message even there are plenty of messages in queue waiting to
> be consumed.

You 'see only 1 unacknowledged message' where? In one consumer, or across all
consumers, or what!? How are you determining this - are you using the management console?

* How many consumers connected to the one queue?
* What prefetch setting (if any) for each consumer? Is it set to '1' per-chance?

> If both the consumers are running on different threads then how
> could this possible ? why only 1 consumer is consuming message and other one
> is in idle state ? 

Do you have the prefetch count set explicitly (or does your client library do this)? It appears
that you do:

"$channel->basic_qos(null, 1, null);"

This tells rabbit not to give that consumer more than 1 un-acked message at a time. Where are
these other consumers getting created? If they're on a separate connection (and machine) then
can you see them in the management console?

> 
> Is there any other way by which I can make consumers to consume next
> messages from the queue as soon as they finish their last job/message ?  
> 

What? That's what happens as soon as they send an ACK - are you forgetting to ACK or something?
Perhaps someone who understands the PHP client better than I do can comment on what might be
going on here, because this just doesn't make any sense to me. Are these second consumers by
any chance running in the same PHP application? Isn't PHP single threaded? Could that be why your
application isn't progressing the way you'd expect it to?


From atlanta444484 at yahoo.com  Mon Apr  1 16:31:57 2013
From: atlanta444484 at yahoo.com (Atlanta44)
Date: Mon, 1 Apr 2013 08:31:57 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and AMQP
In-Reply-To: <1364681266322-25806.post@n5.nabble.com>
References: <1364681266322-25806.post@n5.nabble.com>
Message-ID: <1364830317460-25811.post@n5.nabble.com>

Does RabbitMQ have any future plans to go to AMQP 1.0 ?

Thanks



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-and-AMQP-tp25806p25811.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Mon Apr  1 16:45:08 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 1 Apr 2013 19:45:08 +0400
Subject: [rabbitmq-discuss] RabbitMQ and AMQP
In-Reply-To: <1364830317460-25811.post@n5.nabble.com>
References: <1364681266322-25806.post@n5.nabble.com>
	<1364830317460-25811.post@n5.nabble.com>
Message-ID: <CAE3HoVR8eztR4Os=so4AdoAty=LdDMeyBb28ZH_mZ-9YCjLA=w@mail.gmail.com>

2013/4/1 Atlanta44 <atlanta444484 at yahoo.com>

> Does RabbitMQ have any future plans to go to AMQP 1.0 ?


See my previous reply. In any case, AMQP 0.9.1 will stay around for a very
long time.

As far as I know there aren't many mature AMQP 1.0 clients. All or nearly
all RabbitMQ clients
today use AMQP 0.9.1.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130401/c196fdd6/attachment.htm>

From saprykin.dmitry at gmail.com  Mon Apr  1 17:03:57 2013
From: saprykin.dmitry at gmail.com (Dmitry Saprykin)
Date: Mon, 1 Apr 2013 20:03:57 +0400
Subject: [rabbitmq-discuss] RabbitMQ Queues memory leak?
Message-ID: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>

Hello,

I have durable persistent queue which is mirrored between 2 nodes.
Nodes live on separate hosts.
Clients publish about 400 messages per second which is received and acked
by 60 consumers.
So queue is almost empty all the time.

Meanwhile management plugin shows steady grows of memory consumption by
Queues on master node. (~1Mb per minute)

rabbitmqctl stop_app && rabbitmqctl start_app solves the problem temporary.

I have tried to set {queue_index_max_journal_entries, 65536} instead
of 262144 it does not change anything.

RabbitMQ version is 3.0.4
Erlang version R14B04

What am I missing here? Or should I schedule stop_app && start_app to free
Queues memory?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130401/cf8724d7/attachment.htm>

From michael.s.klishin at gmail.com  Mon Apr  1 17:17:11 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 1 Apr 2013 20:17:11 +0400
Subject: [rabbitmq-discuss] RabbitMQ Queues memory leak?
In-Reply-To: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
Message-ID: <CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>

2013/4/1 Dmitry Saprykin <saprykin.dmitry at gmail.com>

> Clients publish about 400 messages per second which is received and acked
> by 60 consumers.
> So queue is almost empty all the time.
>

Do your consumers acknolwedge the messages? Does the UI say there are no
ready messages
or messages at all?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130401/d3f27f3b/attachment.htm>

From stuff at moesel.net  Mon Apr  1 18:40:57 2013
From: stuff at moesel.net (Chris)
Date: Mon, 1 Apr 2013 13:40:57 -0400
Subject: [rabbitmq-discuss] AD Queues Not AutoDeleting
Message-ID: <CAHEpgBBt3xWwB8-A+wqGUC_yRygtCZLitTZ_Fkw2UFE2Tf25mA@mail.gmail.com>

Hi All,

I've seen an issue a few times where auto-delete queues never go away.
 Even after I've disconnected all clients and restarted RabbitMQ, the AD
queues are still there.  Sometimes they have lots of messages in them, but
sometimes they have none.

When it happened today, I noticed the system was very low on disk space--
could that be part of the problem?

When this happens, is there a quicker way to force-delete these queues
without going through one by one in the Management Console?

Thanks!
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130401/3e5d11bc/attachment.htm>

From michael.s.klishin at gmail.com  Mon Apr  1 19:06:32 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 1 Apr 2013 22:06:32 +0400
Subject: [rabbitmq-discuss] AD Queues Not AutoDeleting
In-Reply-To: <CAHEpgBBt3xWwB8-A+wqGUC_yRygtCZLitTZ_Fkw2UFE2Tf25mA@mail.gmail.com>
References: <CAHEpgBBt3xWwB8-A+wqGUC_yRygtCZLitTZ_Fkw2UFE2Tf25mA@mail.gmail.com>
Message-ID: <CAE3HoVSiOO1Z=J77bd0=YPC=ev5+LYHMv6Y4jGm44K5OZNLQ_w@mail.gmail.com>

2013/4/1 Chris <stuff at moesel.net>

> When it happened today, I noticed the system was very low on disk space--
> could that be part of the problem?
>

It is more likely that said queues never have a single consumer registered
with them. Auto-deletion
kicks in when the last consumer disconnects.


>
> When this happens, is there a quicker way to force-delete these queues
> without going through one by one in the Management Console?
>

Using HTTP API:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/3646dee55e02/priv/www-api/help.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130401/37542e71/attachment.htm>

From saprykin.dmitry at gmail.com  Mon Apr  1 19:26:24 2013
From: saprykin.dmitry at gmail.com (Dmitry Saprykin)
Date: Mon, 1 Apr 2013 22:26:24 +0400
Subject: [rabbitmq-discuss] RabbitMQ Queues memory leak?
In-Reply-To: <CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
Message-ID: <CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>

Yeah, consumers acknowledge messages. UI says that there are no messages at
all.


On 1 April 2013 20:17, Michael Klishin <michael.s.klishin at gmail.com> wrote:

>
> 2013/4/1 Dmitry Saprykin <saprykin.dmitry at gmail.com>
>
>> Clients publish about 400 messages per second which is received and acked
>> by 60 consumers.
>> So queue is almost empty all the time.
>>
>
> Do your consumers acknolwedge the messages? Does the UI say there are no
> ready messages
> or messages at all?
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130401/f255fa42/attachment.htm>

From michael.s.klishin at gmail.com  Mon Apr  1 19:37:00 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 1 Apr 2013 22:37:00 +0400
Subject: [rabbitmq-discuss] RabbitMQ Queues memory leak?
In-Reply-To: <CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
	<CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
Message-ID: <CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>

2013/4/1 Dmitry Saprykin <saprykin.dmitry at gmail.com>

> Yeah, consumers acknowledge messages. UI says that there are no messages
> at all.


Do you use TLS?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130401/6246c537/attachment.htm>

From sean1965 at gmail.com  Tue Apr  2 06:55:28 2013
From: sean1965 at gmail.com (Sean Shannon)
Date: Mon, 1 Apr 2013 22:55:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Export Causes Server To Crash
Message-ID: <6d670ac2-0a4f-4495-9498-0937a2059406@googlegroups.com>

Hi, I'm sorry I can't say what version I'm running because the server is 
down.

All I did from the Admin site home page is export the settings for the 
RabbitMQ and now I can't log in anymore.

Got response code 500 with body
Internal Server ErrorThe server encountered an error while processing this 
request:

{error,{case_clause,{{[],false},2}},
       [{base64,strip_illegal,3},
        {base64,mime_decode_l,1},
        {rabbit_mochiweb_util,parse_auth_header,1},
        {rabbit_mgmt_util,is_authorized,3},
        {webmachine_resource,resource_call,3},
        {webmachine_resource,do,3},
        {webmachine_decision_core,resource_call,1},
        {webmachine_decision_core,decision,1}]}



Anyone have this issue?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130401/477a9c8f/attachment.htm>

From saprykin.dmitry at gmail.com  Tue Apr  2 08:44:29 2013
From: saprykin.dmitry at gmail.com (Dmitry Saprykin)
Date: Tue, 2 Apr 2013 11:44:29 +0400
Subject: [rabbitmq-discuss] RabbitMQ Queues memory leak?
In-Reply-To: <CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
	<CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
	<CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>
Message-ID: <CAHWt7w0+H87VoXnSuqhVi6FAsm_PbtEbuvH_H=CckWX6k9sW6g@mail.gmail.com>

No, just local TCP connections by IP address.


On 1 April 2013 22:37, Michael Klishin <michael.s.klishin at gmail.com> wrote:

>
> 2013/4/1 Dmitry Saprykin <saprykin.dmitry at gmail.com>
>
>> Yeah, consumers acknowledge messages. UI says that there are no messages
>> at all.
>
>
> Do you use TLS?
>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/9e5244f0/attachment.htm>

From michael.s.klishin at gmail.com  Tue Apr  2 08:49:27 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 2 Apr 2013 11:49:27 +0400
Subject: [rabbitmq-discuss] RabbitMQ Queues memory leak?
In-Reply-To: <CAHWt7w0+H87VoXnSuqhVi6FAsm_PbtEbuvH_H=CckWX6k9sW6g@mail.gmail.com>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
	<CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
	<CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>
	<CAHWt7w0+H87VoXnSuqhVi6FAsm_PbtEbuvH_H=CckWX6k9sW6g@mail.gmail.com>
Message-ID: <CAE3HoVTcg54NCD9DmsPuZB8vjvB8HXxg0kLwO2hUtp2hjVBFiw@mail.gmail.com>

2013/4/2 Dmitry Saprykin <saprykin.dmitry at gmail.com>

> No, just local TCP connections by IP address.


Please post `rabbitmqctl report` output.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/a4270f15/attachment.htm>

From saprykin.dmitry at gmail.com  Tue Apr  2 09:15:36 2013
From: saprykin.dmitry at gmail.com (Dmitry Saprykin)
Date: Tue, 2 Apr 2013 12:15:36 +0400
Subject: [rabbitmq-discuss] RabbitMQ Queues memory leak?
In-Reply-To: <CAE3HoVTcg54NCD9DmsPuZB8vjvB8HXxg0kLwO2hUtp2hjVBFiw@mail.gmail.com>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
	<CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
	<CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>
	<CAHWt7w0+H87VoXnSuqhVi6FAsm_PbtEbuvH_H=CckWX6k9sW6g@mail.gmail.com>
	<CAE3HoVTcg54NCD9DmsPuZB8vjvB8HXxg0kLwO2hUtp2hjVBFiw@mail.gmail.com>
Message-ID: <CAHWt7w0pDVbews1OWGsJTv3aOOk-K26PEHLBn=F=Yctg6rc41w@mail.gmail.com>

report from master attached to email. Current Queues memory 180 Mb


On 2 April 2013 11:49, Michael Klishin <michael.s.klishin at gmail.com> wrote:

> 2013/4/2 Dmitry Saprykin <saprykin.dmitry at gmail.com>
>
>> No, just local TCP connections by IP address.
>
>
> Please post `rabbitmqctl report` output.
>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/5b66f41c/attachment.htm>
-------------- next part --------------
Reporting server status on {{2013,4,2},{8,9,27}}

 ...
Status of node rabbit at cdaemon2 ...
[{pid,15197},
 {running_applications,
     [{rabbitmq_shovel_management,"Shovel Status","3.0.4"},
      {rabbitmq_management_visualiser,"RabbitMQ Visualiser","3.0.4"},
      {rabbitmq_federation_management,"RabbitMQ Federation Management",
          "3.0.4"},
      {rabbitmq_tracing,"RabbitMQ message logging / tracing","3.0.4"},
      {rabbitmq_management,"RabbitMQ Management Console","3.0.4"},
      {rabbitmq_federation,"RabbitMQ Federation","3.0.4"},
      {rabbitmq_shovel,"Data Shovel for RabbitMQ","3.0.4"},
      {rabbitmq_auth_backend_ldap,"RabbitMQ LDAP Authentication Backend",
          "3.0.4"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.4"},
      {rabbit,"RabbitMQ","3.0.4"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.0.4"},
      {webmachine,"webmachine","1.9.1-rmq3.0.4-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.4-gitd541e9a"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {eldap,"LDAP Client Library","3.0.4-gite309de4"},
      {amqp_client,"RabbitMQ AMQP Client","3.0.4"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:8:8] [rq:8] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,676203200},
      {connection_procs,14752584},
      {queue_procs,1118128},
      {plugins,329128},
      {other_proc,12137072},
      {mnesia,90632},
      {mgmt_db,1400840},
      {msg_index,27648},
      {other_ets,1452888},
      {binary,5147024},
      {code,19790707},
      {atom,1915985},
      {other_system,618040564}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,6689424998},
 {disk_free_limit,1000000000},
 {disk_free,55133155328},
 {file_descriptors,
     [{total_limit,999900},
      {total_used,129},
      {sockets_limit,899908},
      {sockets_used,127}]},
 {processes,[{limit,1048576},{used,1240}]},
 {run_queue,0},
 {uptime,70966}]

Cluster status of node rabbit at cdaemon2 ...
[{nodes,[{disc,[rabbit at cdaemon2,rabbit at cdaemon4]}]},
 {running_nodes,[rabbit at cdaemon4,rabbit at cdaemon2]},
 {partitions,[]}]

Application environment of node rabbit at cdaemon2 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,{[],disc}},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at cdaemon2.log"}},
 {frame_max,131072},
 {heartbeat,30},
 {hipe_compile,true},
 {included_applications,[]},
 {log_levels,[{connection,error}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.4/sbin/../plugins"},
 {plugins_expand_dir,"/monamour/rabbit-data/mnesia/rabbit at cdaemon2-plugins-expand"},
 {queue_index_max_journal_entries,65536},
 {reverse_dns_lookups,false},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at cdaemon2-sasl.log"}},
 {server_properties,[]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false},
                      {keepalive,true}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]

Status of node rabbit at cdaemon4 ...
[{pid,2926},
 {running_applications,
     [{rabbitmq_shovel_management,"Shovel Status","3.0.4"},
      {rabbitmq_management_visualiser,"RabbitMQ Visualiser","3.0.4"},
      {rabbitmq_federation_management,"RabbitMQ Federation Management",
          "3.0.4"},
      {rabbitmq_tracing,"RabbitMQ message logging / tracing","3.0.4"},
      {rabbitmq_management,"RabbitMQ Management Console","3.0.4"},
      {rabbitmq_federation,"RabbitMQ Federation","3.0.4"},
      {rabbitmq_shovel,"Data Shovel for RabbitMQ","3.0.4"},
      {rabbitmq_auth_backend_ldap,"RabbitMQ LDAP Authentication Backend",
          "3.0.4"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.4"},
      {rabbit,"RabbitMQ","3.0.4"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.0.4"},
      {webmachine,"webmachine","1.9.1-rmq3.0.4-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.4-gitd541e9a"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {eldap,"LDAP Client Library","3.0.4-gite309de4"},
      {amqp_client,"RabbitMQ AMQP Client","3.0.4"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:8:8] [rq:8] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,859404112},
      {connection_procs,4832056},
      {queue_procs,189148496},
      {plugins,341904},
      {other_proc,3888792},
      {mnesia,90504},
      {mgmt_db,29000},
      {msg_index,27648},
      {other_ets,3919736},
      {binary,5214416},
      {code,19922856},
      {atom,1915177},
      {other_system,630073527}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,13521731584},
 {disk_free_limit,1000000000},
 {disk_free,185078022144},
 {file_descriptors,
     [{total_limit,999900},
      {total_used,85},
      {sockets_limit,899908},
      {sockets_used,83}]},
 {processes,[{limit,1048576},{used,829}]},
 {run_queue,0},
 {uptime,70888}]

Cluster status of node rabbit at cdaemon4 ...
[{nodes,[{disc,[rabbit at cdaemon2,rabbit at cdaemon4]}]},
 {running_nodes,[rabbit at cdaemon2,rabbit at cdaemon4]},
 {partitions,[]}]

Application environment of node rabbit at cdaemon4 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,{[],disc}},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at cdaemon4.log"}},
 {frame_max,131072},
 {heartbeat,30},
 {hipe_compile,true},
 {included_applications,[]},
 {log_levels,[{connection,error}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.4/sbin/../plugins"},
 {plugins_expand_dir,"/monamour/rabbit-data/mnesia/rabbit at cdaemon4-plugins-expand"},
 {queue_index_max_journal_entries,65536},
 {reverse_dns_lookups,false},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at cdaemon4-sasl.log"}},
 {server_properties,[]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false},
                      {keepalive,true}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]

Connections:
pid	name	port	peer_port	host	peer_host	ssl	peer_cert_subject	peer_cert_issuer	peer_cert_validity	auth_mechanism	ssl_protocol	ssl_key_exchange	ssl_cipher	ssl_hash	protocol	user	vhost	timeout	frame_max	client_properties	recv_oct	recv_cnt	send_oct	send_cnt	send_pend	state	last_blocked_by	last_blocked_age	channels
<rabbit at cdaemon2.1.16940.2256>	10.5.2.60:38309 -> 10.5.1.39:5672	5672	38309	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	284118	10925	135076	10925	0	running	none	infinity	1
<rabbit at cdaemon2.1.3615.2344>	10.5.2.60:42744 -> 10.5.1.39:5672	5672	42744	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	668440	27387	834100	26207	0	running	none	infinity	1
<rabbit at cdaemon2.1.27638.2346>	10.5.2.60:43368 -> 10.5.1.39:5672	5672	43368	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	633745	25983	765629	24902	0	running	none	infinity	1
<rabbit at cdaemon2.1.1412.2347>	10.5.2.60:47487 -> 10.5.1.39:5672	5672	47487	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	639622	26227	783951	25109	0	running	none	infinity	1
<rabbit at cdaemon2.1.28909.2350>	10.5.2.60:55526 -> 10.5.1.39:5672	5672	55526	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	569660	23352	706817	22340	0	running	none	infinity	1
<rabbit at cdaemon2.1.16601.2357>	10.5.2.60:37245 -> 10.5.1.39:5672	5672	37245	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	501788	20552	616861	19694	0	running	none	infinity	1
<rabbit at cdaemon2.1.7062.2366>	10.5.2.60:58585 -> 10.5.1.39:5672	5672	58585	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	390025	16007	483098	15290	0	running	none	infinity	1
<rabbit at cdaemon2.1.8878.2368>	10.5.2.60:54195 -> 10.5.1.39:5672	5672	54195	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	364092	14923	454078	14270	0	running	none	infinity	1
<rabbit at cdaemon2.1.8886.2368>	10.5.2.60:54196 -> 10.5.1.39:5672	5672	54196	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	390600	16012	463863	15368	0	running	none	infinity	1
<rabbit at cdaemon2.1.27587.2369>	10.5.2.60:42227 -> 10.5.1.39:5672	5672	42227	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	347389	14255	433813	13625	0	running	none	infinity	1
<rabbit at cdaemon2.1.5393.2375>	10.5.2.60:55325 -> 10.5.1.39:5672	5672	55325	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	280602	11496	337933	11021	0	running	none	infinity	1
<rabbit at cdaemon2.1.22100.2375>	10.5.2.60:38710 -> 10.5.1.39:5672	5672	38710	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	272854	11164	339965	10700	0	running	none	infinity	1
<rabbit at cdaemon2.1.28907.2376>	10.5.2.104:49838 -> 10.5.1.39:5672	5672	49838	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	735863	28596	2232057	26345	0	running	none	infinity	1
<rabbit at cdaemon2.1.12224.2377>	10.5.2.60:57013 -> 10.5.1.39:5672	5672	57013	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	259847	10671	324745	10181	0	running	none	infinity	1
<rabbit at cdaemon2.1.30124.2377>	10.5.2.104:50277 -> 10.5.1.39:5672	5672	50277	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	701739	27339	2102439	25214	0	running	none	infinity	1
<rabbit at cdaemon2.1.3018.2378>	10.5.2.60:33847 -> 10.5.1.39:5672	5672	33847	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	243742	10000	306062	9539	0	running	none	infinity	1
<rabbit at cdaemon2.1.3022.2378>	10.5.2.100:56192 -> 10.5.1.39:5672	5672	56192	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	705080	27541	2095585	25409	0	running	none	infinity	1
<rabbit at cdaemon2.1.3038.2378>	10.5.2.60:33851 -> 10.5.1.39:5672	5672	33851	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	253675	10385	322550	9917	0	running	none	infinity	1
<rabbit at cdaemon2.1.18306.2378>	10.5.2.100:56430 -> 10.5.1.39:5672	5672	56430	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	677527	26395	2037363	24293	0	running	none	infinity	1
<rabbit at cdaemon2.1.20024.2378>	10.5.2.104:50672 -> 10.5.1.39:5672	5672	50672	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	679929	26553	2090046	24425	0	running	none	infinity	1
<rabbit at cdaemon2.1.20989.2378>	10.5.2.98:43393 -> 10.5.1.39:5672	5672	43393	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	668967	26215	2043375	24152	0	running	none	infinity	1
<rabbit at cdaemon2.1.21655.2378>	10.5.2.100:56527 -> 10.5.1.39:5672	5672	56527	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	668870	26238	2040010	24164	0	running	none	infinity	1
<rabbit at cdaemon2.1.21859.2378>	10.5.2.104:50730 -> 10.5.1.39:5672	5672	50730	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	672912	26260	2086020	24167	0	running	none	infinity	1
<rabbit at cdaemon2.1.21950.2378>	10.5.2.100:56546 -> 10.5.1.39:5672	5672	56546	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	673550	26336	1971825	24347	0	running	none	infinity	1
<rabbit at cdaemon2.1.27557.2378>	10.5.2.104:50921 -> 10.5.1.39:5672	5672	50921	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	679887	26436	2019898	24398	0	running	none	infinity	1
<rabbit at cdaemon2.1.27597.2378>	10.5.2.100:56727 -> 10.5.1.39:5672	5672	56727	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	668046	26266	2013338	24266	0	running	none	infinity	1
<rabbit at cdaemon2.1.30798.2378>	10.5.2.104:51036 -> 10.5.1.39:5672	5672	51036	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	670713	26167	2034394	24116	0	running	none	infinity	1
<rabbit at cdaemon2.1.30882.2378>	10.5.2.98:43636 -> 10.5.1.39:5672	5672	43636	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	657199	25826	1975240	23813	0	running	none	infinity	1
<rabbit at cdaemon2.1.31219.2378>	10.5.2.100:56850 -> 10.5.1.39:5672	5672	56850	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	673200	26260	2003407	24227	0	running	none	infinity	1
<rabbit at cdaemon2.1.2115.2379>	10.5.2.98:43777 -> 10.5.1.39:5672	5672	43777	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	653711	25610	1991577	23597	0	running	none	infinity	1
<rabbit at cdaemon2.1.3345.2379>	10.5.2.100:56999 -> 10.5.1.39:5672	5672	56999	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	657093	25643	2028539	23633	0	running	none	infinity	1
<rabbit at cdaemon2.1.4612.2379>	10.5.2.98:43874 -> 10.5.1.39:5672	5672	43874	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	649901	25714	1929409	23780	0	running	none	infinity	1
<rabbit at cdaemon2.1.8157.2379>	10.5.2.98:44080 -> 10.5.1.39:5672	5672	44080	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	647487	25217	1986878	23174	0	running	none	infinity	1
<rabbit at cdaemon2.1.8637.2379>	10.5.2.100:57149 -> 10.5.1.39:5672	5672	57149	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	647935	25482	1973409	23531	0	running	none	infinity	1
<rabbit at cdaemon2.1.10100.2379>	10.5.2.98:44214 -> 10.5.1.39:5672	5672	44214	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	643434	25368	1961189	23366	0	running	none	infinity	1
<rabbit at cdaemon2.1.10486.2379>	10.5.2.98:44236 -> 10.5.1.39:5672	5672	44236	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	654010	25324	1937336	23342	0	running	none	infinity	1
<rabbit at cdaemon2.1.12385.2379>	10.5.2.100:57331 -> 10.5.1.39:5672	5672	57331	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	639125	25359	1998181	23363	0	running	none	infinity	1
<rabbit at cdaemon2.1.12572.2379>	10.5.2.100:57341 -> 10.5.1.39:5672	5672	57341	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	650219	25436	2011449	23402	0	running	none	infinity	1
<rabbit at cdaemon2.1.12890.2379>	10.5.2.104:51654 -> 10.5.1.39:5672	5672	51654	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	653777	25479	2008210	23450	0	running	none	infinity	1
<rabbit at cdaemon2.1.14258.2379>	10.5.2.98:44449 -> 10.5.1.39:5672	5672	44449	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	644381	25340	1992174	23315	0	running	none	infinity	1
<rabbit at cdaemon2.1.14448.2379>	10.5.2.104:51725 -> 10.5.1.39:5672	5672	51725	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	644521	25389	2002581	23357	0	running	none	infinity	1
<rabbit at cdaemon2.1.15275.2379>	10.5.2.98:44504 -> 10.5.1.39:5672	5672	44504	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	644549	25242	1993466	23240	0	running	none	infinity	1
<rabbit at cdaemon2.1.15371.2379>	10.5.2.100:57505 -> 10.5.1.39:5672	5672	57505	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	642198	25300	1966416	23303	0	running	none	infinity	1
<rabbit at cdaemon2.1.15707.2379>	10.5.2.104:51800 -> 10.5.1.39:5672	5672	51800	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	649169	25349	2009996	23294	0	running	none	infinity	1
<rabbit at cdaemon2.1.17401.2379>	10.5.2.100:57590 -> 10.5.1.39:5672	5672	57590	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	637738	25054	1933695	23099	0	running	none	infinity	1
<rabbit at cdaemon2.1.18172.2379>	10.5.2.104:51922 -> 10.5.1.39:5672	5672	51922	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	642372	25361	1927885	23402	0	running	none	infinity	1
<rabbit at cdaemon2.1.19271.2379>	10.5.2.98:44732 -> 10.5.1.39:5672	5672	44732	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	631596	24915	1990718	22916	0	running	none	infinity	1
<rabbit at cdaemon2.1.21973.2379>	10.5.2.100:57861 -> 10.5.1.39:5672	5672	57861	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	634011	25120	1923870	23195	0	running	none	infinity	1
<rabbit at cdaemon2.1.22488.2379>	10.5.2.104:52179 -> 10.5.1.39:5672	5672	52179	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	637570	24969	1887329	23060	0	running	none	infinity	1
<rabbit at cdaemon2.1.23841.2379>	10.5.2.100:57977 -> 10.5.1.39:5672	5672	57977	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	643296	25039	1882202	23129	0	running	none	infinity	1
<rabbit at cdaemon2.1.24781.2379>	10.5.2.98:45108 -> 10.5.1.39:5672	5672	45108	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	632929	24868	1947780	22922	0	running	none	infinity	1
<rabbit at cdaemon2.1.25829.2379>	10.5.2.98:45193 -> 10.5.1.39:5672	5672	45193	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	640990	24972	1936116	23012	0	running	none	infinity	1
<rabbit at cdaemon2.1.26893.2379>	10.5.2.104:52437 -> 10.5.1.39:5672	5672	52437	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	634120	25002	1943397	23072	0	running	none	infinity	1
<rabbit at cdaemon2.1.29294.2379>	10.5.2.98:45422 -> 10.5.1.39:5672	5672	45422	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	630668	24594	1932312	22622	0	running	none	infinity	1
<rabbit at cdaemon2.1.29390.2379>	10.5.2.98:45442 -> 10.5.1.39:5672	5672	45442	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	637392	24909	1909575	22964	0	running	none	infinity	1
<rabbit at cdaemon2.1.318.2380>	10.5.2.104:52782 -> 10.5.1.39:5672	5672	52782	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	630824	24609	1966238	22598	0	running	none	infinity	1
<rabbit at cdaemon2.1.3064.2380>	10.5.2.104:52911 -> 10.5.1.39:5672	5672	52911	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	614245	24182	1899840	22253	0	running	none	infinity	1
<rabbit at cdaemon2.1.3184.2380>	10.5.2.100:58710 -> 10.5.1.39:5672	5672	58710	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	628780	24635	1900453	22730	0	running	none	infinity	1
<rabbit at cdaemon2.1.3772.2380>	10.5.2.98:45825 -> 10.5.1.39:5672	5672	45825	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	621745	24425	1839810	22568	0	running	none	infinity	1
<rabbit at cdaemon2.1.6825.2380>	10.5.2.98:45959 -> 10.5.1.39:5672	5672	45959	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	617670	24169	1883475	22271	0	running	none	infinity	1
<rabbit at cdaemon2.1.7557.2380>	10.5.2.100:58947 -> 10.5.1.39:5672	5672	58947	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	618069	24466	1872738	22598	0	running	none	infinity	1
<rabbit at cdaemon2.1.8057.2380>	10.5.2.100:58957 -> 10.5.1.39:5672	5672	58957	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	625223	24467	1840053	22583	0	running	none	infinity	1
<rabbit at cdaemon2.1.8067.2380>	10.5.2.104:53170 -> 10.5.1.39:5672	5672	53170	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	613335	24195	1904356	22298	0	running	none	infinity	1
<rabbit at cdaemon2.1.8076.2380>	10.5.2.98:46011 -> 10.5.1.39:5672	5672	46011	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	625743	24534	1892575	22613	0	running	none	infinity	1
<rabbit at cdaemon2.1.8081.2380>	10.5.2.100:58958 -> 10.5.1.39:5672	5672	58958	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	610483	24225	1839197	22388	0	running	none	infinity	1
<rabbit at cdaemon2.1.8093.2380>	10.5.2.98:46012 -> 10.5.1.39:5672	5672	46012	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	616331	24152	1921415	22196	0	running	none	infinity	1
<rabbit at cdaemon2.1.8100.2380>	10.5.2.98:46013 -> 10.5.1.39:5672	5672	46013	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	611496	24072	1878580	22172	0	running	none	infinity	1
<rabbit at cdaemon2.1.8105.2380>	10.5.2.104:53171 -> 10.5.1.39:5672	5672	53171	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	624361	24506	1915336	22595	0	running	none	infinity	1
<rabbit at cdaemon2.1.8109.2380>	10.5.2.104:53172 -> 10.5.1.39:5672	5672	53172	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	619673	24172	1859722	22277	0	running	none	infinity	1
<rabbit at cdaemon2.1.8113.2380>	10.5.2.100:58959 -> 10.5.1.39:5672	5672	58959	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	621693	24249	1872105	22388	0	running	none	infinity	1
<rabbit at cdaemon2.1.8117.2380>	10.5.2.100:58960 -> 10.5.1.39:5672	5672	58960	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	608168	23933	1858870	22049	0	running	none	infinity	1
<rabbit at cdaemon2.1.8121.2380>	10.5.2.98:46014 -> 10.5.1.39:5672	5672	46014	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	622927	24506	1880643	22637	0	running	none	infinity	1
<rabbit at cdaemon2.1.8125.2380>	10.5.2.98:46016 -> 10.5.1.39:5672	5672	46016	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	626772	24157	1855175	22262	0	running	none	infinity	1
<rabbit at cdaemon2.1.8129.2380>	10.5.2.98:46015 -> 10.5.1.39:5672	5672	46015	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	618271	24401	1921155	22472	0	running	none	infinity	1
<rabbit at cdaemon2.1.8133.2380>	10.5.2.100:58961 -> 10.5.1.39:5672	5672	58961	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	632529	24591	1916853	22640	0	running	none	infinity	1
<rabbit at cdaemon2.1.8137.2380>	10.5.2.104:53173 -> 10.5.1.39:5672	5672	53173	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	622276	24273	1899350	22343	0	running	none	infinity	1
<rabbit at cdaemon2.1.8141.2380>	10.5.2.104:53174 -> 10.5.1.39:5672	5672	53174	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	619583	24270	1833450	22409	0	running	none	infinity	1
<rabbit at cdaemon2.1.8145.2380>	10.5.2.100:58962 -> 10.5.1.39:5672	5672	58962	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	616028	24223	1899156	22298	0	running	none	infinity	1
<rabbit at cdaemon2.1.8157.2380>	10.5.2.98:46017 -> 10.5.1.39:5672	5672	46017	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	624705	24253	1881741	22343	0	running	none	infinity	1
<rabbit at cdaemon2.1.8161.2380>	10.5.2.98:46018 -> 10.5.1.39:5672	5672	46018	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	616948	24265	1876046	22382	0	running	none	infinity	1
<rabbit at cdaemon2.1.8165.2380>	10.5.2.104:53175 -> 10.5.1.39:5672	5672	53175	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	621122	24332	1849939	22463	0	running	none	infinity	1
<rabbit at cdaemon2.1.8169.2380>	10.5.2.104:53176 -> 10.5.1.39:5672	5672	53176	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	620593	24413	1861970	22514	0	running	none	infinity	1
<rabbit at cdaemon2.1.8173.2380>	10.5.2.104:53177 -> 10.5.1.39:5672	5672	53177	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	619515	24308	1899592	22406	0	running	none	infinity	1
<rabbit at cdaemon2.1.8177.2380>	10.5.2.100:58965 -> 10.5.1.39:5672	5672	58965	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	613893	24177	1844782	22313	0	running	none	infinity	1
<rabbit at cdaemon2.1.8185.2380>	10.5.2.104:53178 -> 10.5.1.39:5672	5672	53178	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	621775	24416	1906742	22487	0	running	none	infinity	1
<rabbit at cdaemon2.1.8189.2380>	10.5.2.98:46019 -> 10.5.1.39:5672	5672	46019	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	617321	24125	1937522	22151	0	running	none	infinity	1
<rabbit at cdaemon2.1.8211.2380>	10.5.2.100:58967 -> 10.5.1.39:5672	5672	58967	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	612013	24066	1901692	22154	0	running	none	infinity	1
<rabbit at cdaemon2.1.8294.2380>	10.5.2.98:46020 -> 10.5.1.39:5672	5672	46020	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	620236	24392	1878456	22502	0	running	none	infinity	1
<rabbit at cdaemon2.1.8311.2380>	10.5.2.100:58968 -> 10.5.1.39:5672	5672	58968	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	621198	24220	1943551	22244	0	running	none	infinity	1
<rabbit at cdaemon2.1.8322.2380>	10.5.2.98:46021 -> 10.5.1.39:5672	5672	46021	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	618338	24309	1871214	22442	0	running	none	infinity	1
<rabbit at cdaemon2.1.8327.2380>	10.5.2.104:53180 -> 10.5.1.39:5672	5672	53180	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	622980	24364	1833643	22517	0	running	none	infinity	1
<rabbit at cdaemon2.1.8331.2380>	10.5.2.104:53179 -> 10.5.1.39:5672	5672	53179	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	616694	24314	1902607	22415	0	running	none	infinity	1
<rabbit at cdaemon2.1.8335.2380>	10.5.2.60:60634 -> 10.5.1.39:5672	5672	60634	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	223381	9140	285089	8729	0	running	none	infinity	1
<rabbit at cdaemon2.1.8339.2380>	10.5.2.104:53181 -> 10.5.1.39:5672	5672	53181	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	625674	24698	1824883	22874	0	running	none	infinity	1
<rabbit at cdaemon2.1.8343.2380>	10.5.2.100:58969 -> 10.5.1.39:5672	5672	58969	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	616146	24242	1909363	22289	0	running	none	infinity	1
<rabbit at cdaemon2.1.8347.2380>	10.5.2.98:46022 -> 10.5.1.39:5672	5672	46022	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	620120	24193	1872360	22265	0	running	none	infinity	1
<rabbit at cdaemon2.1.8351.2380>	10.5.2.98:46023 -> 10.5.1.39:5672	5672	46023	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	609804	23983	1875176	22076	0	running	none	infinity	1
<rabbit at cdaemon2.1.8355.2380>	10.5.2.104:53182 -> 10.5.1.39:5672	5672	53182	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	619573	24221	1881761	22340	0	running	none	infinity	1
<rabbit at cdaemon2.1.8359.2380>	10.5.2.100:58970 -> 10.5.1.39:5672	5672	58970	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	626377	24469	1924035	22505	0	running	none	infinity	1
<rabbit at cdaemon2.1.8363.2380>	10.5.2.100:58971 -> 10.5.1.39:5672	5672	58971	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	614113	24166	1847768	22304	0	running	none	infinity	1
<rabbit at cdaemon2.1.8367.2380>	10.5.2.100:58972 -> 10.5.1.39:5672	5672	58972	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	621435	24378	1889265	22454	0	running	none	infinity	1
<rabbit at cdaemon2.1.8371.2380>	10.5.2.98:46024 -> 10.5.1.39:5672	5672	46024	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	617953	24283	1873162	22406	0	running	none	infinity	1
<rabbit at cdaemon2.1.8383.2380>	10.5.2.104:53183 -> 10.5.1.39:5672	5672	53183	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	623436	24292	1860061	22391	0	running	none	infinity	1
<rabbit at cdaemon2.1.8387.2380>	10.5.2.100:58974 -> 10.5.1.39:5672	5672	58974	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	611001	24121	1850807	22265	0	running	none	infinity	1
<rabbit at cdaemon2.1.8391.2380>	10.5.2.100:58975 -> 10.5.1.39:5672	5672	58975	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	622761	24301	1827356	22445	0	running	none	infinity	1
<rabbit at cdaemon2.1.8395.2380>	10.5.2.104:53185 -> 10.5.1.39:5672	5672	53185	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	618098	24305	1875599	22427	0	running	none	infinity	1
<rabbit at cdaemon2.1.8399.2380>	10.5.2.98:46025 -> 10.5.1.39:5672	5672	46025	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	618995	24313	1836178	22436	0	running	none	infinity	1
<rabbit at cdaemon2.1.8403.2380>	10.5.2.98:46026 -> 10.5.1.39:5672	5672	46026	10.5.1.39	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	627816	24268	1842507	22370	0	running	none	infinity	1
<rabbit at cdaemon2.1.8407.2380>	10.5.2.104:53184 -> 10.5.1.39:5672	5672	53184	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	620163	24389	1816030	22550	0	running	none	infinity	1
<rabbit at cdaemon2.1.8411.2380>	10.5.2.104:53187 -> 10.5.1.39:5672	5672	53187	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	615978	24204	1891884	22295	0	running	none	infinity	1
<rabbit at cdaemon2.1.8415.2380>	10.5.2.100:58976 -> 10.5.1.39:5672	5672	58976	10.5.1.39	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	617442	24230	1861592	22352	0	running	none	infinity	1
<rabbit at cdaemon2.1.11421.2380>	10.5.2.104:53321 -> 10.5.1.39:5672	5672	53321	10.5.1.39	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	615267	24080	1883763	22178	0	running	none	infinity	1
<rabbit at cdaemon2.1.21428.2382>	10.5.2.60:53048 -> 10.5.1.39:5672	5672	53048	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	201501	8260	248103	7898	0	running	none	infinity	1
<rabbit at cdaemon2.1.4343.2385>	10.5.2.60:50218 -> 10.5.1.39:5672	5672	50218	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	163476	6701	194285	6413	0	running	none	infinity	1
<rabbit at cdaemon2.1.4617.2385>	10.5.2.60:50364 -> 10.5.1.39:5672	5672	50364	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	158795	6514	202174	6212	0	running	none	infinity	1
<rabbit at cdaemon2.1.21907.2387>	10.5.2.60:36234 -> 10.5.1.39:5672	5672	36234	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	131716	5387	169050	5138	0	running	none	infinity	1
<rabbit at cdaemon2.1.17666.2389>	10.5.2.60:56356 -> 10.5.1.39:5672	5672	56356	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	121247	4958	142937	4763	0	running	none	infinity	1
<rabbit at cdaemon2.1.17674.2389>	10.5.2.60:56358 -> 10.5.1.39:5672	5672	56358	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	116523	4774	144149	4568	0	running	none	infinity	1
<rabbit at cdaemon2.1.17685.2389>	10.5.2.60:56355 -> 10.5.1.39:5672	5672	56355	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	121948	4997	153149	4778	0	running	none	infinity	1
<rabbit at cdaemon2.1.3314.2390>	10.5.2.60:46119 -> 10.5.1.39:5672	5672	46119	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	106639	4363	147598	4148	0	running	none	infinity	1
<rabbit at cdaemon2.1.17188.2392>	10.5.2.60:40998 -> 10.5.1.39:5672	5672	40998	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	82984	3402	100770	3257	0	running	none	infinity	1
<rabbit at cdaemon2.1.31123.2396>	10.5.2.60:49730 -> 10.5.1.39:5672	5672	49730	10.5.1.39	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	28959	1181	39092	1130	0	running	none	infinity	1
<rabbit at cdaemon2.1.16601.2399>	10.5.2.66:45519 -> 10.5.1.39:5672	5672	45519	10.5.1.39	10.5.2.66	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	1411	6	396	5	0	running	none	infinity	1
<rabbit at cdaemon4.1.3677.3146>	10.5.2.69:42098 -> 10.5.1.24:5672	5672	42098	10.5.1.24	10.5.2.69	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	166	3	368	3	0	running	none	infinity	0
<rabbit at cdaemon4.1.6278.3178>	10.5.2.144:35896 -> 10.5.1.24:5672	5672	35896	10.5.1.24	10.5.2.144	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	166	3	368	3	0	running	none	infinity	0
<rabbit at cdaemon4.1.14301.3204>	10.5.2.132:48618 -> 10.5.1.24:5672	5672	48618	10.5.1.24	10.5.2.132	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	166	3	368	3	0	running	none	infinity	0
<rabbit at cdaemon4.1.14775.3252>	10.5.2.28:58031 -> 10.5.1.24:5672	5672	58031	10.5.1.24	10.5.2.28	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	166	3	368	3	0	running	none	infinity	0
<rabbit at cdaemon4.1.17826.3292>	10.5.2.32:50564 -> 10.5.1.24:5672	5672	50564	10.5.1.24	10.5.2.32	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	166	3	368	3	0	running	none	infinity	0
<rabbit at cdaemon4.1.26789.3298>	10.5.2.60:53409 -> 10.5.1.24:5672	5672	53409	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	1212	44	877	44	0	running	none	infinity	1
<rabbit at cdaemon4.1.18895.3302>	10.5.2.87:60132 -> 10.5.1.24:5672	5672	60132	10.5.1.24	10.5.2.87	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	166	3	368	3	0	running	none	infinity	0
<rabbit at cdaemon4.1.15643.3306>	10.5.2.65:50322 -> 10.5.1.24:5672	5672	50322	10.5.1.24	10.5.2.65	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	166	3	368	3	0	running	none	infinity	0
<rabbit at cdaemon4.1.9977.3325>	10.5.2.94:51404 -> 10.5.1.24:5672	5672	51404	10.5.1.24	10.5.2.94	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	166	3	368	3	0	running	none	infinity	0
<rabbit at cdaemon4.1.26583.3325>	10.5.2.121:47814 -> 10.5.1.24:5672	5672	47814	10.5.1.24	10.5.2.121	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	166	3	368	3	0	running	none	infinity	0
<rabbit at cdaemon4.1.2690.3374>	10.5.2.23:34315 -> 10.5.1.24:5672	5672	34315	10.5.1.24	10.5.2.23	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	166	3	368	3	0	running	none	infinity	0
<rabbit at cdaemon4.1.9739.3429>	10.5.2.60:60893 -> 10.5.1.24:5672	5672	60893	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	2691	107	2783	104	0	running	none	infinity	1
<rabbit at cdaemon4.1.26916.3430>	10.5.2.87:52879 -> 10.5.1.24:5672	5672	52879	10.5.1.24	10.5.2.87	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	166	3	368	3	0	running	none	infinity	0
<rabbit at cdaemon4.1.12236.3433>	10.5.2.60:58425 -> 10.5.1.24:5672	5672	58425	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	3589	142	5828	134	0	running	none	infinity	1
<rabbit at cdaemon4.1.21367.3441>	10.5.2.41:46529 -> 10.5.1.24:5672	5672	46529	10.5.1.24	10.5.2.41	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	166	3	368	3	0	running	none	infinity	0
<rabbit at cdaemon4.1.26261.3461>	10.5.2.60:48813 -> 10.5.1.24:5672	5672	48813	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	24922	1017	31958	971	0	running	none	infinity	1
<rabbit at cdaemon4.1.23270.3463>	10.5.2.60:55950 -> 10.5.1.24:5672	5672	55950	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	11516	468	13830	452	0	running	none	infinity	1
<rabbit at cdaemon4.1.15917.3466>	10.5.2.60:57263 -> 10.5.1.24:5672	5672	57263	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	4799	195	7751	182	0	running	none	infinity	1
<rabbit at cdaemon4.1.16884.3471>	10.5.2.92:44262 -> 10.5.1.24:5672	5672	44262	10.5.1.24	10.5.2.92	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	166	3	368	3	0	running	none	infinity	0
<rabbit at cdaemon4.1.6521.3473>	10.5.2.60:55187 -> 10.5.1.24:5672	5672	55187	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	24669	1010	25695	977	0	running	none	infinity	1
<rabbit at cdaemon4.1.1473.3477>	10.5.2.60:47492 -> 10.5.1.24:5672	5672	47492	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	18015	734	23124	707	0	running	none	infinity	1
<rabbit at cdaemon4.1.24559.3477>	10.5.2.60:54824 -> 10.5.1.24:5672	5672	54824	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	12288	500	14512	482	0	running	none	infinity	1
<rabbit at cdaemon4.1.32611.3478>	10.5.2.100:47811 -> 10.5.1.24:5672	5672	47811	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	8890	344	31732	317	0	running	none	infinity	1
<rabbit at cdaemon4.1.27416.3479>	10.5.2.98:37415 -> 10.5.1.24:5672	5672	37415	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	53585	2137	176777	1976	0	running	none	infinity	1
<rabbit at cdaemon4.1.2460.3480>	10.5.2.100:48169 -> 10.5.1.24:5672	5672	48169	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	51018	1940	141277	1799	0	running	none	infinity	1
<rabbit at cdaemon4.1.18533.3480>	10.5.2.100:48528 -> 10.5.1.24:5672	5672	48528	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	40523	1567	125867	1439	0	running	none	infinity	1
<rabbit at cdaemon4.1.20353.3480>	10.5.2.98:37763 -> 10.5.1.24:5672	5672	37763	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	40863	1510	119404	1382	0	running	none	infinity	1
<rabbit at cdaemon4.1.23309.3480>	10.5.2.104:53988 -> 10.5.1.24:5672	5672	53988	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	37084	1430	117675	1322	0	running	none	infinity	1
<rabbit at cdaemon4.1.26546.3480>	10.5.2.98:37897 -> 10.5.1.24:5672	5672	37897	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	34303	1375	103627	1274	0	running	none	infinity	1
<rabbit at cdaemon4.1.29640.3480>	10.5.2.60:35884 -> 10.5.1.24:5672	5672	35884	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	12373	500	17764	476	0	running	none	infinity	1
<rabbit at cdaemon4.1.31530.3480>	10.5.2.98:38014 -> 10.5.1.24:5672	5672	38014	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	30463	1208	94332	1121	0	running	none	infinity	1
<rabbit at cdaemon4.1.32758.3480>	10.5.2.104:54213 -> 10.5.1.24:5672	5672	54213	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	30485	1191	92629	1106	0	running	none	infinity	1
<rabbit at cdaemon4.1.77.3481>	10.5.2.104:54215 -> 10.5.1.24:5672	5672	54215	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	29852	1211	91217	1133	0	running	none	infinity	1
<rabbit at cdaemon4.1.1720.3481>	10.5.2.98:38076 -> 10.5.1.24:5672	5672	38076	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	29151	1156	100029	1070	0	running	none	infinity	1
<rabbit at cdaemon4.1.1786.3481>	10.5.2.98:38082 -> 10.5.1.24:5672	5672	38082	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	29251	1158	95872	1064	0	running	none	infinity	1
<rabbit at cdaemon4.1.2190.3481>	10.5.2.100:48838 -> 10.5.1.24:5672	5672	48838	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	29625	1173	79985	1100	0	running	none	infinity	1
<rabbit at cdaemon4.1.2833.3481>	10.5.2.104:54334 -> 10.5.1.24:5672	5672	54334	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	30679	1191	88541	1118	0	running	none	infinity	1
<rabbit at cdaemon4.1.2970.3481>	10.5.2.98:38156 -> 10.5.1.24:5672	5672	38156	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	30351	1137	91372	1034	0	running	none	infinity	1
<rabbit at cdaemon4.1.3320.3481>	10.5.2.100:48863 -> 10.5.1.24:5672	5672	48863	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	29518	1125	96357	1031	0	running	none	infinity	1
<rabbit at cdaemon4.1.7279.3481>	10.5.2.104:54443 -> 10.5.1.24:5672	5672	54443	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	28598	1057	82891	974	0	running	none	infinity	1
<rabbit at cdaemon4.1.7915.3481>	10.5.2.100:48979 -> 10.5.1.24:5672	5672	48979	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	26063	1066	87201	992	0	running	none	infinity	1
<rabbit at cdaemon4.1.8487.3481>	10.5.2.100:48994 -> 10.5.1.24:5672	5672	48994	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	27191	1033	84883	956	0	running	none	infinity	1
<rabbit at cdaemon4.1.9768.3481>	10.5.2.100:49046 -> 10.5.1.24:5672	5672	49046	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	25594	1023	72920	959	0	running	none	infinity	1
<rabbit at cdaemon4.1.11842.3481>	10.5.2.104:54585 -> 10.5.1.24:5672	5672	54585	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	24668	989	70761	926	0	running	none	infinity	1
<rabbit at cdaemon4.1.14195.3481>	10.5.2.104:54664 -> 10.5.1.24:5672	5672	54664	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	22380	902	61758	848	0	running	none	infinity	1
<rabbit at cdaemon4.1.19286.3481>	10.5.2.100:49403 -> 10.5.1.24:5672	5672	49403	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	20027	742	61207	677	0	running	none	infinity	1
<rabbit at cdaemon4.1.21904.3481>	10.5.2.98:38930 -> 10.5.1.24:5672	5672	38930	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	18286	709	59542	653	0	running	none	infinity	1
<rabbit at cdaemon4.1.22537.3481>	10.5.2.98:38958 -> 10.5.1.24:5672	5672	38958	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	17545	702	56565	653	0	running	none	infinity	1
<rabbit at cdaemon4.1.23214.3481>	10.5.2.100:49546 -> 10.5.1.24:5672	5672	49546	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	18596	721	51179	674	0	running	none	infinity	1
<rabbit at cdaemon4.1.23475.3481>	10.5.2.104:54981 -> 10.5.1.24:5672	5672	54981	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	17324	694	54716	641	0	running	none	infinity	1
<rabbit at cdaemon4.1.23600.3481>	10.5.2.104:54991 -> 10.5.1.24:5672	5672	54991	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	16083	669	59540	617	0	running	none	infinity	1
<rabbit at cdaemon4.1.24956.3481>	10.5.2.100:49588 -> 10.5.1.24:5672	5672	49588	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	16259	646	51721	599	0	running	none	infinity	1
<rabbit at cdaemon4.1.25270.3481>	10.5.2.98:39077 -> 10.5.1.24:5672	5672	39077	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	16555	655	54368	611	0	running	none	infinity	1
<rabbit at cdaemon4.1.31266.3481>	10.5.2.100:49863 -> 10.5.1.24:5672	5672	49863	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	13262	510	37656	476	0	running	none	infinity	1
<rabbit at cdaemon4.1.31909.3481>	10.5.2.104:55296 -> 10.5.1.24:5672	5672	55296	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	13357	512	45080	467	0	running	none	infinity	1
<rabbit at cdaemon4.1.32687.3481>	10.5.2.104:55334 -> 10.5.1.24:5672	5672	55334	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	12606	497	31934	473	0	running	none	infinity	1
<rabbit at cdaemon4.1.1760.3482>	10.5.2.98:39470 -> 10.5.1.24:5672	5672	39470	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	12358	461	37796	422	0	running	none	infinity	1
<rabbit at cdaemon4.1.3284.3482>	10.5.2.104:55470 -> 10.5.1.24:5672	5672	55470	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	12691	431	36397	395	0	running	none	infinity	1
<rabbit at cdaemon4.1.3645.3482>	10.5.2.98:39543 -> 10.5.1.24:5672	5672	39543	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	10116	409	38639	374	0	running	none	infinity	1
<rabbit at cdaemon4.1.8422.3482>	10.5.2.104:55638 -> 10.5.1.24:5672	5672	55638	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	8728	327	27993	302	0	running	none	infinity	1
<rabbit at cdaemon4.1.8446.3482>	10.5.2.100:50256 -> 10.5.1.24:5672	5672	50256	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	7482	296	29220	272	0	running	none	infinity	1
<rabbit at cdaemon4.1.8787.3482>	10.5.2.98:39766 -> 10.5.1.24:5672	5672	39766	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	8357	296	21634	272	0	running	none	infinity	1
<rabbit at cdaemon4.1.10232.3482>	10.5.2.104:55705 -> 10.5.1.24:5672	5672	55705	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	6522	268	22048	251	0	running	none	infinity	1
<rabbit at cdaemon4.1.10237.3482>	10.5.2.100:50328 -> 10.5.1.24:5672	5672	50328	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	6847	260	23943	239	0	running	none	infinity	1
<rabbit at cdaemon4.1.10710.3482>	10.5.2.104:55711 -> 10.5.1.24:5672	5672	55711	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	6908	269	15803	254	0	running	none	infinity	1
<rabbit at cdaemon4.1.11656.3482>	10.5.2.98:39881 -> 10.5.1.24:5672	5672	39881	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	5511	226	15000	215	0	running	none	infinity	1
<rabbit at cdaemon4.1.12215.3482>	10.5.2.104:55797 -> 10.5.1.24:5672	5672	55797	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	5764	229	20066	212	0	running	none	infinity	1
<rabbit at cdaemon4.1.12604.3482>	10.5.2.100:50415 -> 10.5.1.24:5672	5672	50415	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	5028	204	15268	194	0	running	none	infinity	1
<rabbit at cdaemon4.1.14661.3482>	10.5.2.100:50497 -> 10.5.1.24:5672	5672	50497	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	4284	160	7964	155	0	running	none	infinity	1
<rabbit at cdaemon4.1.16949.3482>	10.5.2.104:55954 -> 10.5.1.24:5672	5672	55954	10.5.1.24	10.5.2.104	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	2661	107	12527	98	0	running	none	infinity	1
<rabbit at cdaemon4.1.18706.3482>	10.5.2.100:50643 -> 10.5.1.24:5672	5672	50643	10.5.1.24	10.5.2.100	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	1599	63	6813	59	0	running	none	infinity	1
<rabbit at cdaemon4.1.18837.3482>	10.5.2.98:40110 -> 10.5.1.24:5672	5672	40110	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	1536	59	3063	59	0	running	none	infinity	1
<rabbit at cdaemon4.1.20618.3482>	10.5.2.98:40157 -> 10.5.1.24:5672	5672	40157	10.5.1.24	10.5.2.98	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	363	11	1236	11	0	running	none	infinity	1
<rabbit at cdaemon4.1.29487.3483>	10.5.2.60:53964 -> 10.5.1.24:5672	5672	53964	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	18016	737	23160	701	0	running	none	infinity	1
<rabbit at cdaemon4.1.15249.3493>	10.5.2.60:53697 -> 10.5.1.24:5672	5672	53697	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	1283	49	2213	47	0	running	none	infinity	1
<rabbit at cdaemon4.1.2869.3495>	10.5.2.60:41362 -> 10.5.1.24:5672	5672	41362	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	10463	426	14007	407	0	running	none	infinity	1
<rabbit at cdaemon4.1.6140.3495>	10.5.2.60:42237 -> 10.5.1.24:5672	5672	42237	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	9003	363	12218	347	0	running	none	infinity	1
<rabbit at cdaemon4.1.29070.3495>	10.5.2.60:55390 -> 10.5.1.24:5672	5672	55390	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	4684	189	6603	179	0	running	none	infinity	1
<rabbit at cdaemon4.1.27844.3496>	10.5.2.60:53246 -> 10.5.1.24:5672	5672	53246	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	4996	202	4929	197	0	running	none	infinity	1
<rabbit at cdaemon4.1.20230.3507>	10.5.2.60:39138 -> 10.5.1.24:5672	5672	39138	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	1189	46	1566	44	0	running	none	infinity	1
<rabbit at cdaemon4.1.5414.3511>	10.5.2.60:57474 -> 10.5.1.24:5672	5672	57474	10.5.1.24	10.5.2.60	false				PLAIN					{0,9,1}	guest	/	0	131072	[{"product","rabbitmq-c"},{"information","See http://hg.rabbitmq.com/rabbitmq-c/"}]	4047	163	4610	158	0	running	none	infinity	1

Channels:
pid	name	connection	number	user	vhost	transactional	confirm	consumer_count	messages_unacknowledged	messages_unconfirmed	messages_uncommitted	acks_uncommitted	prefetch_count	client_flow_blocked
<rabbit at cdaemon2.1.16944.2256>	10.5.2.60:38309 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.16940.2256>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.3623.2344>	10.5.2.60:42744 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.3615.2344>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.27646.2346>	10.5.2.60:43368 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.27638.2346>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.1421.2347>	10.5.2.60:47487 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.1412.2347>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.28913.2350>	10.5.2.60:55526 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.28909.2350>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.16624.2357>	10.5.2.60:37245 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.16601.2357>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.7067.2366>	10.5.2.60:58585 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.7062.2366>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.8898.2368>	10.5.2.60:54195 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8878.2368>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8906.2368>	10.5.2.60:54196 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8886.2368>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.27591.2369>	10.5.2.60:42227 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.27587.2369>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.5397.2375>	10.5.2.60:55325 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.5393.2375>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.22104.2375>	10.5.2.60:38710 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.22100.2375>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.28911.2376>	10.5.2.104:49838 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.28907.2376>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.12232.2377>	10.5.2.60:57013 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.12224.2377>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.30134.2377>	10.5.2.104:50277 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.30124.2377>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.3035.2378>	10.5.2.60:33847 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.3018.2378>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.3042.2378>	10.5.2.100:56192 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.3022.2378>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.3050.2378>	10.5.2.60:33851 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.3038.2378>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.18314.2378>	10.5.2.100:56430 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.18306.2378>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.20028.2378>	10.5.2.104:50672 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.20024.2378>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.21001.2378>	10.5.2.98:43393 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.20989.2378>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.21664.2378>	10.5.2.100:56527 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.21655.2378>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.21863.2378>	10.5.2.104:50730 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.21859.2378>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.21954.2378>	10.5.2.100:56546 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.21950.2378>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.27561.2378>	10.5.2.104:50921 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.27557.2378>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.27606.2378>	10.5.2.100:56727 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.27597.2378>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.30802.2378>	10.5.2.104:51036 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.30798.2378>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.30886.2378>	10.5.2.98:43636 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.30882.2378>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.31223.2378>	10.5.2.100:56850 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.31219.2378>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.2119.2379>	10.5.2.98:43777 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.2115.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.3349.2379>	10.5.2.100:56999 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.3345.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.4616.2379>	10.5.2.98:43874 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.4612.2379>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.8161.2379>	10.5.2.98:44080 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8157.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8641.2379>	10.5.2.100:57149 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8637.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.10104.2379>	10.5.2.98:44214 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.10100.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.10490.2379>	10.5.2.98:44236 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.10486.2379>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.12389.2379>	10.5.2.100:57331 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.12385.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.12579.2379>	10.5.2.100:57341 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.12572.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.12894.2379>	10.5.2.104:51654 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.12890.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.14262.2379>	10.5.2.98:44449 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.14258.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.14452.2379>	10.5.2.104:51725 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.14448.2379>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.15279.2379>	10.5.2.98:44504 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.15275.2379>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.15392.2379>	10.5.2.100:57505 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.15371.2379>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.15711.2379>	10.5.2.104:51800 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.15707.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.17406.2379>	10.5.2.100:57590 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.17401.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.18176.2379>	10.5.2.104:51922 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.18172.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.19279.2379>	10.5.2.98:44732 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.19271.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.21981.2379>	10.5.2.100:57861 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.21973.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.22492.2379>	10.5.2.104:52179 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.22488.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.23845.2379>	10.5.2.100:57977 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.23841.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.24797.2379>	10.5.2.98:45108 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.24781.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.25833.2379>	10.5.2.98:45193 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.25829.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.26905.2379>	10.5.2.104:52437 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.26893.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.29298.2379>	10.5.2.98:45422 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.29294.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.29394.2379>	10.5.2.98:45442 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.29390.2379>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.323.2380>	10.5.2.104:52782 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.318.2380>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.3072.2380>	10.5.2.104:52911 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.3064.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.3188.2380>	10.5.2.100:58710 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.3184.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.3776.2380>	10.5.2.98:45825 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.3772.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.6833.2380>	10.5.2.98:45959 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.6825.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.7561.2380>	10.5.2.100:58947 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.7557.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8069.2380>	10.5.2.100:58957 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8057.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8089.2380>	10.5.2.104:53170 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8067.2380>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.8092.2380>	10.5.2.98:46011 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8076.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8101.2380>	10.5.2.100:58958 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8081.2380>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.8197.2380>	10.5.2.98:46012 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8093.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8203.2380>	10.5.2.98:46013 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8100.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8213.2380>	10.5.2.104:53178 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8185.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8223.2380>	10.5.2.104:53171 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8105.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8241.2380>	10.5.2.104:53175 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8165.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8281.2380>	10.5.2.100:58965 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8177.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8286.2380>	10.5.2.104:53177 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8173.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8288.2380>	10.5.2.98:46017 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8157.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8291.2380>	10.5.2.100:58961 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8133.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8292.2380>	10.5.2.104:53172 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8109.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8293.2380>	10.5.2.100:58959 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8113.2380>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.8295.2380>	10.5.2.98:46019 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8189.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8296.2380>	10.5.2.100:58962 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8145.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8298.2380>	10.5.2.100:58960 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8117.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8299.2380>	10.5.2.104:53173 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8137.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8300.2380>	10.5.2.104:53176 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8169.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8301.2380>	10.5.2.98:46015 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8129.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8303.2380>	10.5.2.104:53174 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8141.2380>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.8304.2380>	10.5.2.98:46014 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8121.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8305.2380>	10.5.2.98:46018 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8161.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8306.2380>	10.5.2.98:46016 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8125.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8307.2380>	10.5.2.100:58967 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8211.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8315.2380>	10.5.2.98:46020 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8294.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8323.2380>	10.5.2.100:58968 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8311.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8434.2380>	10.5.2.104:53179 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8331.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8442.2380>	10.5.2.98:46021 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8322.2380>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.8446.2380>	10.5.2.104:53180 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8327.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8477.2380>	10.5.2.98:46026 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8403.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8482.2380>	10.5.2.104:53181 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8339.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8519.2380>	10.5.2.104:53182 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8355.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8521.2380>	10.5.2.104:53187 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8411.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8522.2380>	10.5.2.60:60634 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8335.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8524.2380>	10.5.2.100:58976 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8415.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8526.2380>	10.5.2.100:58974 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8387.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8528.2380>	10.5.2.98:46025 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8399.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8529.2380>	10.5.2.98:46023 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8351.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8531.2380>	10.5.2.104:53183 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8383.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8532.2380>	10.5.2.100:58975 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8391.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8533.2380>	10.5.2.104:53185 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8395.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8534.2380>	10.5.2.100:58970 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8359.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8535.2380>	10.5.2.98:46022 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8347.2380>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.8539.2380>	10.5.2.104:53184 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8407.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8540.2380>	10.5.2.100:58971 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8363.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8542.2380>	10.5.2.100:58972 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8367.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8544.2380>	10.5.2.100:58969 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8343.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.8546.2380>	10.5.2.98:46024 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.8371.2380>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.11425.2380>	10.5.2.104:53321 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.11421.2380>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.21448.2382>	10.5.2.60:53048 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.21428.2382>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.4347.2385>	10.5.2.60:50218 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.4343.2385>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.4621.2385>	10.5.2.60:50364 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.4617.2385>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.21921.2387>	10.5.2.60:36234 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.21907.2387>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.17686.2389>	10.5.2.60:56356 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.17666.2389>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.17706.2389>	10.5.2.60:56358 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.17674.2389>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.17719.2389>	10.5.2.60:56355 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.17685.2389>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon2.1.3369.2390>	10.5.2.60:46119 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.3314.2390>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.17204.2392>	10.5.2.60:40998 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.17188.2392>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon2.1.31129.2396>	10.5.2.60:49730 -> 10.5.1.39:5672 (1)	<rabbit at cdaemon2.1.31123.2396>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.26793.3298>	10.5.2.60:53409 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.26789.3298>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.9747.3429>	10.5.2.60:60893 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.9739.3429>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.12251.3433>	10.5.2.60:58425 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.12236.3433>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.26269.3461>	10.5.2.60:48813 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.26261.3461>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.23274.3463>	10.5.2.60:55950 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.23270.3463>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.15956.3466>	10.5.2.60:57263 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.15917.3466>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.6533.3473>	10.5.2.60:55187 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.6521.3473>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.1477.3477>	10.5.2.60:47492 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.1473.3477>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.24565.3477>	10.5.2.60:54824 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.24559.3477>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.32650.3478>	10.5.2.100:47811 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.32611.3478>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.27420.3479>	10.5.2.98:37415 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.27416.3479>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.2466.3480>	10.5.2.100:48169 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.2460.3480>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.18537.3480>	10.5.2.100:48528 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.18533.3480>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.20358.3480>	10.5.2.98:37763 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.20353.3480>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.23317.3480>	10.5.2.104:53988 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.23309.3480>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.26564.3480>	10.5.2.98:37897 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.26546.3480>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.29646.3480>	10.5.2.60:35884 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.29640.3480>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.31534.3480>	10.5.2.98:38014 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.31530.3480>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.32762.3480>	10.5.2.104:54213 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.32758.3480>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon4.1.81.3481>	10.5.2.104:54215 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.77.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.1729.3481>	10.5.2.98:38076 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.1720.3481>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon4.1.1791.3481>	10.5.2.98:38082 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.1786.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.2194.3481>	10.5.2.100:48838 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.2190.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.2837.3481>	10.5.2.104:54334 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.2833.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.2974.3481>	10.5.2.98:38156 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.2970.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.3328.3481>	10.5.2.100:48863 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.3320.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.7283.3481>	10.5.2.104:54443 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.7279.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.7919.3481>	10.5.2.100:48979 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.7915.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.8495.3481>	10.5.2.100:48994 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.8487.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.9772.3481>	10.5.2.100:49046 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.9768.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.11846.3481>	10.5.2.104:54585 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.11842.3481>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon4.1.14199.3481>	10.5.2.104:54664 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.14195.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.19295.3481>	10.5.2.100:49403 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.19286.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.21913.3481>	10.5.2.98:38930 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.21904.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.22541.3481>	10.5.2.98:38958 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.22537.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.23244.3481>	10.5.2.100:49546 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.23214.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.23488.3481>	10.5.2.104:54981 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.23475.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.23612.3481>	10.5.2.104:54991 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.23600.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.25016.3481>	10.5.2.100:49588 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.24956.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.25283.3481>	10.5.2.98:39077 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.25270.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.31279.3481>	10.5.2.100:49863 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.31266.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.31922.3481>	10.5.2.104:55296 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.31909.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.32710.3481>	10.5.2.104:55334 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.32687.3481>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.1764.3482>	10.5.2.98:39470 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.1760.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.3292.3482>	10.5.2.104:55470 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.3284.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.3649.3482>	10.5.2.98:39543 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.3645.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.8437.3482>	10.5.2.104:55638 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.8422.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.8454.3482>	10.5.2.100:50256 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.8446.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.8796.3482>	10.5.2.98:39766 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.8787.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.10245.3482>	10.5.2.104:55705 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.10232.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.10257.3482>	10.5.2.100:50328 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.10237.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.10714.3482>	10.5.2.104:55711 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.10710.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.11679.3482>	10.5.2.98:39881 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.11656.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.12230.3482>	10.5.2.104:55797 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.12215.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.12612.3482>	10.5.2.100:50415 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.12604.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.14665.3482>	10.5.2.100:50497 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.14661.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.16966.3482>	10.5.2.104:55954 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.16949.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.18729.3482>	10.5.2.100:50643 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.18706.3482>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon4.1.18847.3482>	10.5.2.98:40110 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.18837.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.20636.3482>	10.5.2.98:40157 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.20618.3482>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.29495.3483>	10.5.2.60:53964 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.29487.3483>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.15253.3493>	10.5.2.60:53697 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.15249.3493>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.2881.3495>	10.5.2.60:41362 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.2869.3495>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.6145.3495>	10.5.2.60:42237 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.6140.3495>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.29074.3495>	10.5.2.60:55390 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.29070.3495>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.27852.3496>	10.5.2.60:53246 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.27844.3496>	1	guest	/	false	false	0	1	0	0	0	1	false
<rabbit at cdaemon4.1.20246.3507>	10.5.2.60:39138 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.20230.3507>	1	guest	/	false	false	0	0	0	0	0	1	false
<rabbit at cdaemon4.1.5420.3511>	10.5.2.60:57474 -> 10.5.1.24:5672 (1)	<rabbit at cdaemon4.1.5414.3511>	1	guest	/	false	false	0	1	0	0	0	1	false

Queues on /:
pid	name	durable	auto_delete	arguments	owner_pid	policy	exclusive_consumer_pid	exclusive_consumer_tag	messages_ready	messages_unacknowledged	messages	consumers	active_consumers	memory	slave_pids	synchronised_slave_pids	backing_queue_status
<rabbit at cdaemon2.1.18454.567>	queue_message_user_test	true	false	[]		Messaging			0	0	0	0	0	34760	[<rabbit at cdaemon4.1.16566.823>]	[<rabbit at cdaemon4.1.16566.823>]	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}, {mirror_seen,0}, {mirror_senders,0}]
<rabbit at cdaemon2.1.18456.567>	mobile_push_message	true	false	[]		MobilePush			0	15	15	0	0	294712	[<rabbit at cdaemon4.1.16577.823>]	[<rabbit at cdaemon4.1.16577.823>]	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,15}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,15}, {next_seq_id,1238409}, {persistent_count,0}, {avg_ingress_rate,25.36366401493221}, {avg_egress_rate,25.36366401493221}, {avg_ack_ingress_rate,25.36366401493221}, {avg_ack_egress_rate,24.86437929022882}, {mirror_seen,0}, {mirror_senders,138}]
<rabbit at cdaemon2.1.18458.567>	queue_message_user	true	false	[]		Messaging			0	17	17	0	0	714544	[<rabbit at cdaemon4.1.16596.823>]	[<rabbit at cdaemon4.1.16596.823>]	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,17}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,17}, {next_seq_id,15952332}, {persistent_count,0}, {avg_ingress_rate,356.3292686401749}, {avg_egress_rate,356.5292289480538}, {avg_ack_ingress_rate,356.5292289480538}, {avg_ack_egress_rate,357.12910987169045}, {mirror_seen,0}, {mirror_senders,5}]
<rabbit at cdaemon2.1.18460.567>	mobile_push_errorusername	true	false	[]		MobilePush			0	0	0	0	0	34760	[<rabbit at cdaemon4.1.16602.823>]	[<rabbit at cdaemon4.1.16602.823>]	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,0}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}, {mirror_seen,0}, {mirror_senders,0}]
<rabbit at cdaemon2.1.18462.567>	mobile_push_notification	true	false	[]		MobilePush			0	0	0	0	0	39640	[<rabbit at cdaemon4.1.16612.823>]	[<rabbit at cdaemon4.1.16612.823>]	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,33}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}, {mirror_seen,0}, {mirror_senders,0}]

Exchanges on /:
name	type	durable	auto_delete	internal	arguments	policy
	direct	true	false	false	[]	
amq.direct	direct	true	false	false	[]	
amq.fanout	fanout	true	false	false	[]	
amq.headers	headers	true	false	false	[]	
amq.match	headers	true	false	false	[]	
amq.rabbitmq.log	topic	true	false	false	[]	
amq.rabbitmq.trace	topic	true	false	false	[]	
amq.topic	topic	true	false	false	[]	
exchange_message_user	direct	true	false	false	[]	
exchange_message_user_test	direct	true	false	false	[]	
mobile_push	direct	true	false	false	[]	MobilePush
mobile_push_errorusername	direct	true	false	false	[]	MobilePush

Bindings on /:
source_name	source_kind	destination_name	destination_kind	routing_key	arguments
	exchange	mobile_push_errorusername	queue	mobile_push_errorusername	[]
	exchange	mobile_push_message	queue	mobile_push_message	[]
	exchange	mobile_push_notification	queue	mobile_push_notification	[]
	exchange	queue_message_user	queue	queue_message_user	[]
	exchange	queue_message_user_test	queue	queue_message_user_test	[]
exchange_message_user	exchange	queue_message_user	queue	message.user	[]
exchange_message_user_test	exchange	queue_message_user_test	queue	message.user	[]
mobile_push	exchange	mobile_push_message	queue	message	[]
mobile_push	exchange	mobile_push_notification	queue	notification	[]
mobile_push	exchange	mobile_push_notification	queue	visit	[]
mobile_push_errorusername	exchange	mobile_push_errorusername	queue	message	[]

Consumers on /:

Permissions on /:
user	configure	write	read
admin	.*	.*	.*
guest	.*	.*	.*

Policies on /:
vhost	name	pattern	definition	priority
/	Messaging	^queue_message	{"ha-mode":"all"}	0
/	MobilePush	^mobile_push	{"ha-mode":"all"}	0

Parameters on /:

...done.

From emile at rabbitmq.com  Tue Apr  2 10:37:56 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 02 Apr 2013 10:37:56 +0100
Subject: [rabbitmq-discuss] Same consumer getting the rejected message
 again
In-Reply-To: <1364543044995-25785.post@n5.nabble.com>
References: <1364543044995-25785.post@n5.nabble.com>
Message-ID: <515AA6F4.4020006@rabbitmq.com>



Hi,

On 29/03/13 07:44, reddylast wrote:

> I've set-up multiple queues and multiple consumers are processing those
> queues. There is a case when a consumer receives a message , if that
> consumer is not authorized  to process that message then system sent it back
> to the queue (by using basic.reject method). I want to stop the same
> consumer getting the same rejected message  again and again. Is there any
> way that prevents a message from looping through the system forever ?

If you requeue a message then it will return to the queue in the same
position that it was, and that may lead to the same consumer getting the
message if it goes to the front of the queue.

You could re-publish the message instead of requeueing, which will force
it to the back of the queue and hope that a different consumer gets the
message when it reaches the front. You could also publish such messages
to a different location where you guarantee that authorisation will not
fail.

In general you should try to route messages to separate queues and bind
consumers in such a way that they will only receive messages which they
are able to process.



-Emile





From emile at rabbitmq.com  Tue Apr  2 10:56:07 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 02 Apr 2013 10:56:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ server connections close issue
In-Reply-To: <CAHWt7w2Mfi3pQ8=7ZDuBZJVoX2PJqkCOty6YKLL+7gd_2SWoGQ@mail.gmail.com>
References: <CAHWt7w2Mfi3pQ8=7ZDuBZJVoX2PJqkCOty6YKLL+7gd_2SWoGQ@mail.gmail.com>
Message-ID: <515AAB37.6060303@rabbitmq.com>


Hi,

On 29/03/13 08:45, Dmitry Saprykin wrote:
> When everything goes bad  (rabbitmqctl list_connections | wc -l) twice
> as much connections than (netstat -nt | wc -l)

Does the logfile contain anything beyond the handshake time-out message?
Are there any entries from the time when the counts start to diverge?

What state are the connections in when the failure occurs? Can you show
some representative output from "rabbitmqctl list_connections" during
the error?

Have you tried using AMQP heartbeats instead of TCP keepalives?




-Emile






From emile at rabbitmq.com  Tue Apr  2 11:10:09 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 02 Apr 2013 11:10:09 +0100
Subject: [rabbitmq-discuss] rabbitmq-java-messagepatterns
In-Reply-To: <CAHEpgBBrupMf=JsWY4SfjFgNe_GFeLgqAwYsZU0scDqH4mkFew@mail.gmail.com>
References: <CAHEpgBBrupMf=JsWY4SfjFgNe_GFeLgqAwYsZU0scDqH4mkFew@mail.gmail.com>
Message-ID: <515AAE81.5050607@rabbitmq.com>



Hi Chris,

On 29/03/13 12:46, Chris wrote:
> Can anyone recommend for or against this library for 3.x deployments?
>  Should we look into it, or should we just plan on implementing the
> reconnection and resubscription logic ourselves?

The project you refer to has been deprecated. You may decide to re-use
the ideas in it, but the code is no longer maintained and may fail to
compile.

RabbitMQ has not released a Java client library that contains logic for
reconnecting to HA clusters, but it is simple to do so yourself:
see http://www.rabbitmq.com/ha.html for details.

You may also want to look at Spring AMQP which offers some reconnection
support. Another alternative is to front the cluster with a
load-balancing proxy.




-Emile






From emile at rabbitmq.com  Tue Apr  2 11:23:54 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 02 Apr 2013 11:23:54 +0100
Subject: [rabbitmq-discuss] RabbitMQ unable to talk to remote server
In-Reply-To: <1364596697774-25793.post@n5.nabble.com>
References: <1364596697774-25793.post@n5.nabble.com>
Message-ID: <515AB1BA.9000601@rabbitmq.com>


Hi,

On 29/03/13 22:38, sender.eric wrote:
> Code: 10 (Host administratively prohibited)

That description matches an ICMP response which is typically generated
by a firewall blocking access. This is probably not a broker
configuration issue. Check that the client can open a connection to the
server on port 5672 by ensuring that all intervening firewalls and
proxies allow it.

Check whether "iptables" is running on the server. (See "man iptables"
for details.) Make sure the server has a routable address. Check your
hypervisor documentation for configuration of the virtual NIC.



-Emile







From emile at rabbitmq.com  Tue Apr  2 12:14:25 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 02 Apr 2013 12:14:25 +0100
Subject: [rabbitmq-discuss] Unable to start direct connection using
 Erlang client
In-Reply-To: <a0b3f8d1-aa1e-4256-b95a-d79e2e55cbd4@googlegroups.com>
References: <a0b3f8d1-aa1e-4256-b95a-d79e2e55cbd4@googlegroups.com>
Message-ID: <515ABD91.20708@rabbitmq.com>


Hi Alexander,

On 29/03/13 21:07, Alexander Reshniuk wrote:
>     {ok, Connection} =
>             amqp_connection:start(#amqp_params_direct{ node =
>     <<"kiosk at localhost">>}),

If the client and server are located on the same host then there is no
need to specify the 'node' field in the amqp_params_direct record. If
you do specify the node then provide it as an atom rather than a binary.

> RabbitMQ version: 2.7.1

You should consider upgrading.

> node with name "kiosk" already running on "localhost"



From watson.timothy at gmail.com  Tue Apr  2 12:20:59 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 2 Apr 2013 12:20:59 +0100
Subject: [rabbitmq-discuss] Export Causes Server To Crash
In-Reply-To: <6d670ac2-0a4f-4495-9498-0937a2059406@googlegroups.com>
References: <6d670ac2-0a4f-4495-9498-0937a2059406@googlegroups.com>
Message-ID: <8CE5DE34-8E25-437D-9CDC-84E820F0398B@rabbitmq.com>

Have you tried disabling and then re-enabling the management plugin?

On 2 Apr 2013, at 06:55, Sean Shannon <sean1965 at gmail.com> wrote:

> Hi, I'm sorry I can't say what version I'm running because the server is down.
> 
> All I did from the Admin site home page is export the settings for the RabbitMQ and now I can't log in anymore.
> 
> Got response code 500 with body
> 
> Internal Server Error
> 
> The server encountered an error while processing this request:
> {error,{case_clause,{{[],false},2}},
>        [{base64,strip_illegal,3},
>         {base64,mime_decode_l,1},
>         {rabbit_mochiweb_util,parse_auth_header,1},
>         {rabbit_mgmt_util,is_authorized,3},
>         {webmachine_resource,resource_call,3},
>         {webmachine_resource,do,3},
>         {webmachine_decision_core,resource_call,1},
>         {webmachine_decision_core,decision,1}]}
> 
> 
> Anyone have this issue?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/3ff6a270/attachment.htm>

From watson.timothy at gmail.com  Tue Apr  2 12:30:54 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 2 Apr 2013 12:30:54 +0100
Subject: [rabbitmq-discuss] Configuring RabbitMQ to support
	change	in	hostname
In-Reply-To: <215e265c.00001508.000000f6@KAPILPC.vmware.com>
References: <9915783f.00001508.000000cf@KAPILPC.vmware.com>
	<95003806-680B-425F-AC8D-9466CAB8071D@dushin.net>
	<215e265c.00001508.000000f6@KAPILPC.vmware.com>
Message-ID: <40BB9183-870B-45DA-AAA5-31EB0D801592@rabbitmq.com>

On 29 Mar 2013, at 23:18, Kapil Goyal <goyalk at vmware.com> wrote:

>  am thinking of solving it by replacing rabbit at localhost with rabbit@<random string> before RabbitMQ starts for the first time. Does <random string> have to be DNS resolvable?

Yes. It needs to be the proper hostname for the node.


>  
>  
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Dushin Fred
> Sent: Thursday, March 28, 2013 6:44 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Configuring RabbitMQ to support change in hostname
>  
> See
>  
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-February/025368.html
>  
>  
> On Mar 28, 2013, at 4:53 PM, Kapil Goyal <goyalk at vmware.com> wrote:
> 
> 
> RabbitMQ creates a new database if hostname is changed (as documented at http://www.rabbitmq.com/ec2.html).
>  
> I need to support the hostname change on my RabbitMQ server without impacting its functioning. Can I accomplish this by setting the NODENAME environment variable in rabbitmq-env.conf. It seems from rabbitmq-server script that names of database, logs etc. try to use this variable before resorting to using hostname. Is this the right approach? Are there any side-effects to look out for?
>  
> Thanks
> Kapil Goyal
> Sr. MTS
> VMware Inc.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/427ddbc4/attachment.htm>

From watson.timothy at gmail.com  Tue Apr  2 12:42:39 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 2 Apr 2013 12:42:39 +0100
Subject: [rabbitmq-discuss] Export Causes Server To Crash
In-Reply-To: <8CE5DE34-8E25-437D-9CDC-84E820F0398B@rabbitmq.com>
References: <6d670ac2-0a4f-4495-9498-0937a2059406@googlegroups.com>
	<8CE5DE34-8E25-437D-9CDC-84E820F0398B@rabbitmq.com>
Message-ID: <6551C72A-CB07-444C-B787-5C98236676CE@rabbitmq.com>

Do you get asked for auth details when downloading the exported data? I do, although I don't get this crash afterwards.

On 2 Apr 2013, at 12:20, Tim Watson <watson.timothy at gmail.com> wrote:

> Have you tried disabling and then re-enabling the management plugin?
> 
> On 2 Apr 2013, at 06:55, Sean Shannon <sean1965 at gmail.com> wrote:
> 
>> Hi, I'm sorry I can't say what version I'm running because the server is down.
>> 
>> All I did from the Admin site home page is export the settings for the RabbitMQ and now I can't log in anymore.
>> 
>> Got response code 500 with body
>> 
>> Internal Server Error
>> 
>> The server encountered an error while processing this request:
>> {error,{case_clause,{{[],false},2}},
>>        [{base64,strip_illegal,3},
>>         {base64,mime_decode_l,1},
>>         {rabbit_mochiweb_util,parse_auth_header,1},
>>         {rabbit_mgmt_util,is_authorized,3},
>>         {webmachine_resource,resource_call,3},
>>         {webmachine_resource,do,3},
>>         {webmachine_decision_core,resource_call,1},
>>         {webmachine_decision_core,decision,1}]}
>> 
>> 
>> Anyone have this issue?
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/282c6a0d/attachment.htm>

From watson.timothy at gmail.com  Tue Apr  2 12:58:16 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 2 Apr 2013 12:58:16 +0100
Subject: [rabbitmq-discuss] Export Causes Server To Crash
In-Reply-To: <6551C72A-CB07-444C-B787-5C98236676CE@rabbitmq.com>
References: <6d670ac2-0a4f-4495-9498-0937a2059406@googlegroups.com>
	<8CE5DE34-8E25-437D-9CDC-84E820F0398B@rabbitmq.com>
	<6551C72A-CB07-444C-B787-5C98236676CE@rabbitmq.com>
Message-ID: <5FD3B4A1-1955-45BC-96A4-E3ADDB282F7B@rabbitmq.com>

Oh and you should be able to run 'rabbitmqctl status' to tell us the version number you're running.

Cheers
Tim

On 2 Apr 2013, at 12:42, Tim Watson <watson.timothy at gmail.com> wrote:

> Do you get asked for auth details when downloading the exported data? I do, although I don't get this crash afterwards.
> 
> On 2 Apr 2013, at 12:20, Tim Watson <watson.timothy at gmail.com> wrote:
> 
>> Have you tried disabling and then re-enabling the management plugin?
>> 
>> On 2 Apr 2013, at 06:55, Sean Shannon <sean1965 at gmail.com> wrote:
>> 
>>> Hi, I'm sorry I can't say what version I'm running because the server is down.
>>> 
>>> All I did from the Admin site home page is export the settings for the RabbitMQ and now I can't log in anymore.
>>> 
>>> Got response code 500 with body
>>> 
>>> Internal Server Error
>>> 
>>> The server encountered an error while processing this request:
>>> {error,{case_clause,{{[],false},2}},
>>>        [{base64,strip_illegal,3},
>>>         {base64,mime_decode_l,1},
>>>         {rabbit_mochiweb_util,parse_auth_header,1},
>>>         {rabbit_mgmt_util,is_authorized,3},
>>>         {webmachine_resource,resource_call,3},
>>>         {webmachine_resource,do,3},
>>>         {webmachine_decision_core,resource_call,1},
>>>         {webmachine_decision_core,decision,1}]}
>>> 
>>> 
>>> Anyone have this issue?
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/39e7dc87/attachment.htm>

From emile at rabbitmq.com  Tue Apr  2 13:16:06 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 02 Apr 2013 13:16:06 +0100
Subject: [rabbitmq-discuss] Blocking connections
In-Reply-To: <1364560602974-25788.post@n5.nabble.com>
References: <1364560602974-25788.post@n5.nabble.com>
Message-ID: <515ACC06.90209@rabbitmq.com>



Hi,

On 29/03/13 12:36, rabbit15 wrote:
> B forwards data to consumer C, which is also connected with 1 exchange
> and 16 queues bound to it.

Consumers connect to exchanges, not queues.

> On the begginning there were about 40 000 messages /s After about 15
> minutes rabbit is not able to deliver nor to receive messages,
> because all connections seem to be blocked.. Memory and disk usage
> were under watermarks.

Can you please check the broker logfile for error entries  around the
time when connections were last blocked? Are you sure there are no
resource limit alarms?



-Emile




From saprykin.dmitry at gmail.com  Tue Apr  2 13:23:23 2013
From: saprykin.dmitry at gmail.com (Dmitry Saprykin)
Date: Tue, 2 Apr 2013 16:23:23 +0400
Subject: [rabbitmq-discuss] RabbitMQ server connections close issue
In-Reply-To: <515AAB37.6060303@rabbitmq.com>
References: <CAHWt7w2Mfi3pQ8=7ZDuBZJVoX2PJqkCOty6YKLL+7gd_2SWoGQ@mail.gmail.com>
	<515AAB37.6060303@rabbitmq.com>
Message-ID: <CAHWt7w07Rtw5jvB-7tGspgTLwSG0eNWNTwWQPw-MscVrN3SQRg@mail.gmail.com>

Thank you for reply,

Unfortunately our client library does not support heartbeats so it is being
disabled on connect.
But problem disappeared after we upgraded RabbitMQ to 3.0.4 AND changed
system tcp_keepalive_time to reasonable small value.

Now we have
$ cat /proc/sys/net/ipv4/tcp_keepalive_time
14
$ cat /proc/sys/net/ipv4/tcp_keepalive_intvl
14
$ cat /proc/sys/net/ipv4/tcp_keepalive_probes
4
 and everything is fine with connection counts.

Thank you


On 2 April 2013 13:56, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 29/03/13 08:45, Dmitry Saprykin wrote:
> > When everything goes bad  (rabbitmqctl list_connections | wc -l) twice
> > as much connections than (netstat -nt | wc -l)
>
> Does the logfile contain anything beyond the handshake time-out message?
> Are there any entries from the time when the counts start to diverge?
>
> What state are the connections in when the failure occurs? Can you show
> some representative output from "rabbitmqctl list_connections" during
> the error?
>
> Have you tried using AMQP heartbeats instead of TCP keepalives?
>
>
>
>
> -Emile
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/53a8bb98/attachment.htm>

From emile at rabbitmq.com  Tue Apr  2 13:27:26 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 02 Apr 2013 13:27:26 +0100
Subject: [rabbitmq-discuss] Blocking connections
In-Reply-To: <515ACC06.90209@rabbitmq.com>
References: <1364560602974-25788.post@n5.nabble.com>
	<515ACC06.90209@rabbitmq.com>
Message-ID: <515ACEAE.4030309@rabbitmq.com>


Hi,

On 02/04/13 13:16, Emile Joubert wrote:
> On 29/03/13 12:36, rabbit15 wrote:
>> B forwards data to consumer C, which is also connected with 1 exchange
>> and 16 queues bound to it.
> 
> Consumers connect to exchanges, not queues.

Sorry, I meant to say "Consumers connect to queues, not exchanges".

Can you also please provide the output of "rabbitmqctl list_connections
state" with your previous output?

Thanks




-Emile






From matthias at rabbitmq.com  Tue Apr  2 13:43:02 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 02 Apr 2013 13:43:02 +0100
Subject: [rabbitmq-discuss] Blocking connections
In-Reply-To: <515ACEAE.4030309@rabbitmq.com>
References: <1364560602974-25788.post@n5.nabble.com>
	<515ACC06.90209@rabbitmq.com> <515ACEAE.4030309@rabbitmq.com>
Message-ID: <515AD256.4030205@rabbitmq.com>

On 02/04/13 13:27, Emile Joubert wrote:
> Can you also please provide the output of "rabbitmqctl list_connections
> state" with your previous output?

Just to clarify, the output you provided previously, namely 'rabbitmqctl 
list_connections last_blocked_by last_blocked_age' indicates why/when 
connections were *last* blocked, not whether connections are *currently* 
blocked. The latter is represented by the 'state'.

It would also be helpful to know what version of RabbitMQ you are 
running. In particular note the following item from the 3.0.3 release 
notes: "25457 fix connection failure to start reading again in rare 
circumstances when coming out of flow control"; so please make sure you 
are running the most recent version.

Regards,

Matthias.

From sean1965 at gmail.com  Tue Apr  2 14:05:44 2013
From: sean1965 at gmail.com (Sean Shannon)
Date: Tue, 2 Apr 2013 06:05:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Export Causes Server To Crash
In-Reply-To: <6551C72A-CB07-444C-B787-5C98236676CE@rabbitmq.com>
References: <6d670ac2-0a4f-4495-9498-0937a2059406@googlegroups.com>
	<8CE5DE34-8E25-437D-9CDC-84E820F0398B@rabbitmq.com>
	<6551C72A-CB07-444C-B787-5C98236676CE@rabbitmq.com>
Message-ID: <3633fdf2-b3a9-435d-afd3-d7ae9d8e656c@googlegroups.com>

Yes.

On Tuesday, April 2, 2013 4:42:39 AM UTC-7, hyperthunk wrote:
>
> Do you get asked for auth details when downloading the exported data? I 
> do, although I don't get this crash afterwards.
>
> On 2 Apr 2013, at 12:20, Tim Watson <watson.... at gmail.com <javascript:>> 
> wrote:
>
> Have you tried disabling and then re-enabling the management plugin?
>
> On 2 Apr 2013, at 06:55, Sean Shannon <sean... at gmail.com <javascript:>> 
> wrote:
>
> Hi, I'm sorry I can't say what version I'm running because the server is 
> down.
>
> All I did from the Admin site home page is export the settings for the 
> RabbitMQ and now I can't log in anymore.
>
> Got response code 500 with body
> Internal Server ErrorThe server encountered an error while processing 
> this request:
>
> {error,{case_clause,{{[],false},2}},
>        [{base64,strip_illegal,3},
>         {base64,mime_decode_l,1},
>         {rabbit_mochiweb_util,parse_auth_header,1},
>         {rabbit_mgmt_util,is_authorized,3},
>         {webmachine_resource,resource_call,3},
>         {webmachine_resource,do,3},
>         {webmachine_decision_core,resource_call,1},
>         {webmachine_decision_core,decision,1}]}
>
>
>
> Anyone have this issue?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/452d5271/attachment.htm>

From tim at rabbitmq.com  Tue Apr  2 14:14:07 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 2 Apr 2013 14:14:07 +0100
Subject: [rabbitmq-discuss] Export Causes Server To Crash
In-Reply-To: <3633fdf2-b3a9-435d-afd3-d7ae9d8e656c@googlegroups.com>
References: <6d670ac2-0a4f-4495-9498-0937a2059406@googlegroups.com>
	<8CE5DE34-8E25-437D-9CDC-84E820F0398B@rabbitmq.com>
	<6551C72A-CB07-444C-B787-5C98236676CE@rabbitmq.com>
	<3633fdf2-b3a9-435d-afd3-d7ae9d8e656c@googlegroups.com>
Message-ID: <FFABE046-E28D-4146-B8E3-1F22B9BA44DF@rabbitmq.com>

I see you're using an old version of Rabbit (as we're now using rabbitmq-web-dispatch as the web server dependency). Can you run `rabbitmqctl status` to get the version info please?

On 2 Apr 2013, at 14:05, Sean Shannon wrote:

> Yes.
> 
> On Tuesday, April 2, 2013 4:42:39 AM UTC-7, hyperthunk wrote:
> Do you get asked for auth details when downloading the exported data? I do, although I don't get this crash afterwards.
> 
> On 2 Apr 2013, at 12:20, Tim Watson <watson.... at gmail.com> wrote:
> 
>> Have you tried disabling and then re-enabling the management plugin?
>> 
>> On 2 Apr 2013, at 06:55, Sean Shannon <sean... at gmail.com> wrote:
>> 
>>> Hi, I'm sorry I can't say what version I'm running because the server is down.
>>> 
>>> All I did from the Admin site home page is export the settings for the RabbitMQ and now I can't log in anymore.
>>> 
>>> Got response code 500 with body
>>> 
>>> Internal Server Error
>>> 
>>> The server encountered an error while processing this request:
>>> {error,{case_clause,{{[],false},2}},
>>>        [{base64,strip_illegal,3},
>>>         {base64,mime_decode_l,1},
>>>         {rabbit_mochiweb_util,parse_auth_header,1},
>>>         {rabbit_mgmt_util,is_authorized,3},
>>>         {webmachine_resource,resource_call,3},
>>>         {webmachine_resource,do,3},
>>>         {webmachine_decision_core,resource_call,1},
>>>         {webmachine_decision_core,decision,1}]}
>>> 
>>> 
>>> Anyone have this issue?
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq... at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/7591d3ea/attachment.htm>

From stuff at moesel.net  Tue Apr  2 14:31:17 2013
From: stuff at moesel.net (Chris)
Date: Tue, 2 Apr 2013 09:31:17 -0400
Subject: [rabbitmq-discuss] rabbitmq-java-messagepatterns
In-Reply-To: <515AAE81.5050607@rabbitmq.com>
References: <CAHEpgBBrupMf=JsWY4SfjFgNe_GFeLgqAwYsZU0scDqH4mkFew@mail.gmail.com>
	<515AAE81.5050607@rabbitmq.com>
Message-ID: <CAHEpgBCpEvAjUrn3zyBrnE6FOA80170Y-Y52sRa6EYVxq2OtfQ@mail.gmail.com>

Thank you, Emile.  This is what I expected, but I appreciate the
confirmation!

That said, auto-reconnection would be a nice feature enhancement for the
Java client. Node-amqp does it and we've found it quite helpful. ;-)

-Chris


On Tue, Apr 2, 2013 at 6:10 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
>
> Hi Chris,
>
> On 29/03/13 12:46, Chris wrote:
> > Can anyone recommend for or against this library for 3.x deployments?
> >  Should we look into it, or should we just plan on implementing the
> > reconnection and resubscription logic ourselves?
>
> The project you refer to has been deprecated. You may decide to re-use
> the ideas in it, but the code is no longer maintained and may fail to
> compile.
>
> RabbitMQ has not released a Java client library that contains logic for
> reconnecting to HA clusters, but it is simple to do so yourself:
> see http://www.rabbitmq.com/ha.html for details.
>
> You may also want to look at Spring AMQP which offers some reconnection
> support. Another alternative is to front the cluster with a
> load-balancing proxy.
>
>
>
>
> -Emile
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/ea7c9853/attachment.htm>

From stuff at moesel.net  Tue Apr  2 14:36:27 2013
From: stuff at moesel.net (Chris)
Date: Tue, 2 Apr 2013 09:36:27 -0400
Subject: [rabbitmq-discuss] AD Queues Not AutoDeleting
In-Reply-To: <CAE3HoVSiOO1Z=J77bd0=YPC=ev5+LYHMv6Y4jGm44K5OZNLQ_w@mail.gmail.com>
References: <CAHEpgBBt3xWwB8-A+wqGUC_yRygtCZLitTZ_Fkw2UFE2Tf25mA@mail.gmail.com>
	<CAE3HoVSiOO1Z=J77bd0=YPC=ev5+LYHMv6Y4jGm44K5OZNLQ_w@mail.gmail.com>
Message-ID: <CAHEpgBCZChrux1cHL4Zh8f4tg0xZCcH6KEAbPwDv0ct4cquDVw@mail.gmail.com>

Ah.  I never thought of that!  I guess I better put some logic in my code
to delete the queues if something fails at subscription time.  Thanks for
the hint!

-Chris


On Mon, Apr 1, 2013 at 2:06 PM, Michael Klishin <michael.s.klishin at gmail.com
> wrote:

>
> 2013/4/1 Chris <stuff at moesel.net>
>
>> When it happened today, I noticed the system was very low on disk space--
>> could that be part of the problem?
>>
>
> It is more likely that said queues never have a single consumer registered
> with them. Auto-deletion
> kicks in when the last consumer disconnects.
>
>
>>
>> When this happens, is there a quicker way to force-delete these queues
>> without going through one by one in the Management Console?
>>
>
> Using HTTP API:
>
> http://hg.rabbitmq.com/rabbitmq-management/raw-file/3646dee55e02/priv/www-api/help.html
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/8143e820/attachment.htm>

From matthias at rabbitmq.com  Tue Apr  2 14:39:21 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 02 Apr 2013 14:39:21 +0100
Subject: [rabbitmq-discuss] AD Queues Not AutoDeleting
In-Reply-To: <CAHEpgBCZChrux1cHL4Zh8f4tg0xZCcH6KEAbPwDv0ct4cquDVw@mail.gmail.com>
References: <CAHEpgBBt3xWwB8-A+wqGUC_yRygtCZLitTZ_Fkw2UFE2Tf25mA@mail.gmail.com>
	<CAE3HoVSiOO1Z=J77bd0=YPC=ev5+LYHMv6Y4jGm44K5OZNLQ_w@mail.gmail.com>
	<CAHEpgBCZChrux1cHL4Zh8f4tg0xZCcH6KEAbPwDv0ct4cquDVw@mail.gmail.com>
Message-ID: <515ADF89.2040202@rabbitmq.com>

Chris,

On 02/04/13 14:36, Chris wrote:
> Ah.  I never thought of that!  I guess I better put some logic in my
> code to delete the queues if something fails at subscription time.

Couldn't you simply declare the queues as 'exclusive' instead of 
'auto-delete'?

Matthias.

From michael.s.klishin at gmail.com  Tue Apr  2 14:41:49 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 2 Apr 2013 17:41:49 +0400
Subject: [rabbitmq-discuss] AD Queues Not AutoDeleting
In-Reply-To: <515ADF89.2040202@rabbitmq.com>
References: <CAHEpgBBt3xWwB8-A+wqGUC_yRygtCZLitTZ_Fkw2UFE2Tf25mA@mail.gmail.com>
	<CAE3HoVSiOO1Z=J77bd0=YPC=ev5+LYHMv6Y4jGm44K5OZNLQ_w@mail.gmail.com>
	<CAHEpgBCZChrux1cHL4Zh8f4tg0xZCcH6KEAbPwDv0ct4cquDVw@mail.gmail.com>
	<515ADF89.2040202@rabbitmq.com>
Message-ID: <CAE3HoVQLoHu9F4UEzP9k8=B=EPcxuqYudeVrrKJ6iJuHn0ZiRg@mail.gmail.com>

2013/4/2 Matthias Radestock <matthias at rabbitmq.com>

> Couldn't you simply declare the queues as 'exclusive' instead of
> 'auto-delete'?


Clarification: then it will always be removed when the connection that
created it is closed
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/6ed1b126/attachment.htm>

From andlju at gmail.com  Tue Apr  2 13:51:33 2013
From: andlju at gmail.com (Anders Ljusberg)
Date: Tue, 2 Apr 2013 05:51:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to cluster rabbit nodes
In-Reply-To: <fce8ec32-c4f2-4356-ae37-a2d502bd1d62@googlegroups.com>
References: <fce8ec32-c4f2-4356-ae37-a2d502bd1d62@googlegroups.com>
Message-ID: <d57367d3-4d2e-4834-ba07-2c1f16b72722@googlegroups.com>

You may have already figured this out by now, but for anyone else.

Rabbit by default uses a random port range to do the actual communication 
between nodes in the cluster and you need to allow communication on all 
these ports. If it's the Windows firewall that is blocking you, the easiest 
way is probably to allow erl.exe to communicate on any TCP port.

See the last paragraph under "(Windows) Firewall Settings" in my post on 
clustering RabbitMQ on Windows:

http://coding-insomnia.com/2013/02/23/clustering-rabbitmq-on-windows/

Cheers,

Anders Ljusberg


On Monday, March 18, 2013 10:39:13 PM UTC+1, Govind wrote:
>
> I see below error when I try to cluster rabbitmq.
>
> C:\Program Files (x86)\RabbitMQ 
> Server\rabbitmq_server-3.0.3\sbin>rabbitmqctl.bat join_cluster 
> rabbit at WIN-GOVIND1
> Clustering node 'rabbit at WIN-GOVIND2' with 'rabbit at WIN-GOVIND1' ...
> Error: {cannot_discover_cluster,"The nodes provided are either offline or 
> not running"}
>
> a) Node GOVIND1 is up
> b) Can ping each other machine with name
> c) Can telnet to 5672 and 4369 (empd) ports from each box prior to running 
> stop_app on GOVIND2.
> d) Synced up erlang cookie
>
> What else did I miss for this not to work?
>
> I get GOVIND1 as node down. why?
>
> C:\Program Files (x86)\RabbitMQ 
> Server\rabbitmq_server-3.0.3\sbin>rabbitmqctl.bat -n 
> rabbit at WIN-GOVIND1status
> Status of node 'rabbit at WIN-GOVIND1' ...
> Error: unable to connect to node 'rabbit at WIN-GOVIND1': nodedown
>
> DIAGNOSTICS
> ===========
>
> nodes in question: ['rabbit at WIN-GOVIND1']
>
> hosts, their running nodes and ports:
> - WIN-GOVIND1: [{rabbit,49283}]
>
> current node details:
> - node name: 'rabbitmqctl2221614 at WIN-GOVIND1'
> - home dir: C:\Users\Administrator
> - cookie hash: IgPbUHwN5LE8HjnJYwYTiA==
>
>
> C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.0.3\sbin>
>
> I didn't change default port (5672) but what is 49283 from above status?
>
> I appreciate any help to cluster rabbit nodes.
>
> Thanks,
> Govind
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/a0ef8844/attachment.htm>

From stuff at moesel.net  Tue Apr  2 19:17:29 2013
From: stuff at moesel.net (Chris)
Date: Tue, 2 Apr 2013 14:17:29 -0400
Subject: [rabbitmq-discuss] AD Queues Not AutoDeleting
In-Reply-To: <CAE3HoVQLoHu9F4UEzP9k8=B=EPcxuqYudeVrrKJ6iJuHn0ZiRg@mail.gmail.com>
References: <CAHEpgBBt3xWwB8-A+wqGUC_yRygtCZLitTZ_Fkw2UFE2Tf25mA@mail.gmail.com>
	<CAE3HoVSiOO1Z=J77bd0=YPC=ev5+LYHMv6Y4jGm44K5OZNLQ_w@mail.gmail.com>
	<CAHEpgBCZChrux1cHL4Zh8f4tg0xZCcH6KEAbPwDv0ct4cquDVw@mail.gmail.com>
	<515ADF89.2040202@rabbitmq.com>
	<CAE3HoVQLoHu9F4UEzP9k8=B=EPcxuqYudeVrrKJ6iJuHn0ZiRg@mail.gmail.com>
Message-ID: <CAHEpgBAqBd=6R7rJi5DEYBdYc4XxDrQ8o658gL32TrL9csZPsQ@mail.gmail.com>

Thanks for the hint.  My concern with that is how it works with HA /
Failover.  In fact, it may be a concern for autodelete as well.

I'd like to have the concept of exclusive queues, but if the server goes
down and I have to reconnect to it again, or reconnect to another node in
the cluster (if HA policy mirrors queues), I assume it will not allow me to
resubscribe to the exclusive queue.  So... I will lose messages.

Or to put it another way:  I think that if I want to be sure not to lose
messages during a reconnection, I have to reconnect to the same queue, and
therefore that queue cannot be declared exclusive.  Which leads to the next
question: If it is declared autodelete, do I have a small grace period in
which I can reconnect and resubscribe before it autodeletes itself?

Thanks again!  You guys are awesome!
Chris


On Tue, Apr 2, 2013 at 9:41 AM, Michael Klishin <michael.s.klishin at gmail.com
> wrote:

>
> 2013/4/2 Matthias Radestock <matthias at rabbitmq.com>
>
>> Couldn't you simply declare the queues as 'exclusive' instead of
>> 'auto-delete'?
>
>
> Clarification: then it will always be removed when the connection that
> created it is closed
>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/762d08ec/attachment.htm>

From michael.s.klishin at gmail.com  Tue Apr  2 19:25:11 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 2 Apr 2013 22:25:11 +0400
Subject: [rabbitmq-discuss] AD Queues Not AutoDeleting
In-Reply-To: <CAHEpgBAqBd=6R7rJi5DEYBdYc4XxDrQ8o658gL32TrL9csZPsQ@mail.gmail.com>
References: <CAHEpgBBt3xWwB8-A+wqGUC_yRygtCZLitTZ_Fkw2UFE2Tf25mA@mail.gmail.com>
	<CAE3HoVSiOO1Z=J77bd0=YPC=ev5+LYHMv6Y4jGm44K5OZNLQ_w@mail.gmail.com>
	<CAHEpgBCZChrux1cHL4Zh8f4tg0xZCcH6KEAbPwDv0ct4cquDVw@mail.gmail.com>
	<515ADF89.2040202@rabbitmq.com>
	<CAE3HoVQLoHu9F4UEzP9k8=B=EPcxuqYudeVrrKJ6iJuHn0ZiRg@mail.gmail.com>
	<CAHEpgBAqBd=6R7rJi5DEYBdYc4XxDrQ8o658gL32TrL9csZPsQ@mail.gmail.com>
Message-ID: <CAE3HoVSS+=OWi8xsafux4+pUB=0Zb1urXXsNuOXsqyN3Y31T+A@mail.gmail.com>

2013/4/2 Chris <stuff at moesel.net>

> Or to put it another way:  I think that if I want to be sure not to lose
> messages during a reconnection, I have to reconnect to the same queue, and
> therefore that queue cannot be declared exclusive.  Which leads to the next
> question: If it is declared autodelete, do I have a small grace period in
> which I can reconnect and resubscribe before it autodeletes itself?


I would not rely on that. It would create a race condition that will cause
a lot of operational pain.

So you want a temporary queue that will be mirrored and needs to preserve
messages when the client disconnects?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/59e515e3/attachment.htm>

From goyalk at vmware.com  Tue Apr  2 19:44:28 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Tue, 2 Apr 2013 11:44:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Configuring RabbitMQ to support change	in
	hostname
In-Reply-To: <40BB9183-870B-45DA-AAA5-31EB0D801592@rabbitmq.com>
References: <9915783f.00001508.000000cf@KAPILPC.vmware.com>	<95003806-680B-425F-AC8D-9466CAB8071D@dushin.net>	<215e265c.00001508.000000f6@KAPILPC.vmware.com>
	<40BB9183-870B-45DA-AAA5-31EB0D801592@rabbitmq.com>
Message-ID: <e3316de2.00001688.00000003@KAPILPC.vmware.com>

So, RabbitMQ does not really support change in hostname at all without 
losing existing data. Is that correct?



From: rabbitmq-discuss-bounces at lists.rabbitmq.com 
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: Tuesday, April 02, 2013 4:31 AM
To: Discussions about RabbitMQ
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuring RabbitMQ to support change in 
hostname



On 29 Mar 2013, at 23:18, Kapil Goyal <goyalk at vmware.com> wrote:



 am thinking of solving it by replacing rabbit at localhost with rabbit@<random 
string> before RabbitMQ starts for the first time. Does <random string> have 
to be DNS resolvable?



Yes. It needs to be the proper hostname for the node.











From: rabbitmq-discuss-bounces at lists.rabbitmq.com 
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Dushin 
Fred
Sent: Thursday, March 28, 2013 6:44 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuring RabbitMQ to support change in 
hostname



See



http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-February/025368.html





On Mar 28, 2013, at 4:53 PM, Kapil Goyal <goyalk at vmware.com> wrote:






RabbitMQ creates a new database if hostname is changed (as documented at 
<http://www.rabbitmq.com/ec2.html> http://www.rabbitmq.com/ec2.html).



I need to support the hostname change on my RabbitMQ server without 
impacting its functioning. Can I accomplish this by setting the NODENAME 
environment variable in rabbitmq-env.conf. It seems from rabbitmq-server 
script that names of database, logs etc. try to use this variable before 
resorting to using hostname. Is this the right approach? Are there any 
side-effects to look out for?



Thanks

Kapil Goyal

Sr. MTS

VMware Inc.

_______________________________________________
rabbitmq-discuss mailing list
 <mailto:rabbitmq-discuss at lists.rabbitmq.com> 
rabbitmq-discuss at lists.rabbitmq.com
 <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss> 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/01a9e433/attachment.htm>

From watson.timothy at gmail.com  Tue Apr  2 19:59:15 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 2 Apr 2013 19:59:15 +0100
Subject: [rabbitmq-discuss] Configuring RabbitMQ to support change	in
	hostname
In-Reply-To: <e3316de2.00001688.00000003@KAPILPC.vmware.com>
References: <9915783f.00001508.000000cf@KAPILPC.vmware.com>
	<95003806-680B-425F-AC8D-9466CAB8071D@dushin.net>
	<215e265c.00001508.000000f6@KAPILPC.vmware.com>
	<40BB9183-870B-45DA-AAA5-31EB0D801592@rabbitmq.com>
	<e3316de2.00001688.00000003@KAPILPC.vmware.com>
Message-ID: <51B3A6B5-FC4E-4254-A403-3941856C29DB@rabbitmq.com>

Hi

On 2 Apr 2013, at 19:44, Kapil Goyal <goyalk at vmware.com> wrote:

> So, RabbitMQ does not really support change in hostname at all without losing existing data. Is that correct?
>  

Erm not quite - if you copy/rename the mnesia directory you can work around this. The node name is dev1 then you can rename/move directories to something else (or override directory names to use something that isn't bound to the node name if you prefer). I don't see how your proposed use of a
Random stein would make any different though. 

> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
> Sent: Tuesday, April 02, 2013 4:31 AM
> To: Discussions about RabbitMQ
> Cc: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Configuring RabbitMQ to support change in hostname
>  
> On 29 Mar 2013, at 23:18, Kapil Goyal <goyalk at vmware.com> wrote:
>  
>  am thinking of solving it by replacing rabbit at localhost with rabbit@<random string> before RabbitMQ starts for the first time. Does <random string> have to be DNS resolvable?
>  
> Yes. It needs to be the proper hostname for the node.
>  
> 
> 
>  
>  
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Dushin Fred
> Sent: Thursday, March 28, 2013 6:44 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Configuring RabbitMQ to support change in hostname
>  
> See
>  
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-February/025368.html
>  
>  
> On Mar 28, 2013, at 4:53 PM, Kapil Goyal <goyalk at vmware.com> wrote:
> 
> 
> 
> RabbitMQ creates a new database if hostname is changed (as documented at http://www.rabbitmq.com/ec2.html).
>  
> I need to support the hostname change on my RabbitMQ server without impacting its functioning. Can I accomplish this by setting the NODENAME environment variable in rabbitmq-env.conf. It seems from rabbitmq-server script that names of database, logs etc. try to use this variable before resorting to using hostname. Is this the right approach? Are there any side-effects to look out for?
>  
> Thanks
> Kapil Goyal
> Sr. MTS
> VMware Inc.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/051b75cf/attachment.htm>

From goyalk at vmware.com  Tue Apr  2 20:29:16 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Tue, 2 Apr 2013 12:29:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Configuring RabbitMQ to support
	change	in	hostname
In-Reply-To: <51B3A6B5-FC4E-4254-A403-3941856C29DB@rabbitmq.com>
References: <9915783f.00001508.000000cf@KAPILPC.vmware.com>	<95003806-680B-425F-AC8D-9466CAB8071D@dushin.net>	<215e265c.00001508.000000f6@KAPILPC.vmware.com>	<40BB9183-870B-45DA-AAA5-31EB0D801592@rabbitmq.com>	<e3316de2.00001688.00000003@KAPILPC.vmware.com>
	<51B3A6B5-FC4E-4254-A403-3941856C29DB@rabbitmq.com>
Message-ID: <9509e512.00001688.00000009@KAPILPC.vmware.com>

I noticed that names of log files, DB etc. are created from node-name. 
Node-name itself is created based on hostname by default. So, if hostname 
changes, node-names changes and so do the DB, logs etc.



My idea was to fix the node-name and make it independent of the hostname, 
thus fixing the names of DB and logs. But, if I try to use a clustered or 
federated setup, the multiple RabbitMQ instances will need to talk to each 
other and I cannot use the same fixed node-name for all the instances. To 
solve that, I thought I will generate the node-name at first boot of the 
RabbitMQ server (and not change it ever). Random-string was just to ensure 
that all RabbitMQ instances get unique node-names.



From: rabbitmq-discuss-bounces at lists.rabbitmq.com 
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: Tuesday, April 02, 2013 11:59 AM
To: Discussions about RabbitMQ
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuring RabbitMQ to support change in 
hostname



Hi


On 2 Apr 2013, at 19:44, Kapil Goyal <goyalk at vmware.com> wrote:

So, RabbitMQ does not really support change in hostname at all without 
losing existing data. Is that correct?





Erm not quite - if you copy/rename the mnesia directory you can work around 
this. The node name is dev1 then you can rename/move directories to 
something else (or override directory names to use something that isn't 
bound to the node name if you prefer). I don't see how your proposed use of 
a

Random stein would make any different though.





From: rabbitmq-discuss-bounces at lists.rabbitmq.com 
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: Tuesday, April 02, 2013 4:31 AM
To: Discussions about RabbitMQ
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuring RabbitMQ to support change in 
hostname



On 29 Mar 2013, at 23:18, Kapil Goyal <goyalk at vmware.com> wrote:



 am thinking of solving it by replacing rabbit at localhost with rabbit@<random 
string> before RabbitMQ starts for the first time. Does <random string> have 
to be DNS resolvable?



Yes. It needs to be the proper hostname for the node.












From: rabbitmq-discuss-bounces at lists.rabbitmq.com 
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Dushin 
Fred
Sent: Thursday, March 28, 2013 6:44 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuring RabbitMQ to support change in 
hostname



See



http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-February/025368.html





On Mar 28, 2013, at 4:53 PM, Kapil Goyal <goyalk at vmware.com> wrote:







RabbitMQ creates a new database if hostname is changed (as documented at 
<http://www.rabbitmq.com/ec2.html> http://www.rabbitmq.com/ec2.html).



I need to support the hostname change on my RabbitMQ server without 
impacting its functioning. Can I accomplish this by setting the NODENAME 
environment variable in rabbitmq-env.conf. It seems from rabbitmq-server 
script that names of database, logs etc. try to use this variable before 
resorting to using hostname. Is this the right approach? Are there any 
side-effects to look out for?



Thanks

Kapil Goyal

Sr. MTS

VMware Inc.

_______________________________________________
rabbitmq-discuss mailing list
 <mailto:rabbitmq-discuss at lists.rabbitmq.com> 
rabbitmq-discuss at lists.rabbitmq.com
 <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss> 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/d8ff46ba/attachment.htm>

From chiragpujara at gmail.com  Tue Apr  2 20:41:08 2013
From: chiragpujara at gmail.com (chiragpujara)
Date: Tue, 2 Apr 2013 12:41:08 -0700 (PDT)
Subject: [rabbitmq-discuss] queue persistance/ queue mode
Message-ID: <1364931668022-25848.post@n5.nabble.com>

I am new to queuing stuff. I was looking in rabbitmq for my project. I want
my msgs to be persisted those are on queue in the event of crash. I found
that if i set deliver-mode to 2 it keeps msgs. Does it stores messages on
disk? But still it is upto producer to write msgs to queue with that option.
Is there a way for me to create queue that stores all the messages to disk.
I read some about disk mode queue but I couldn't set it. I also found post
where they suggested some thing like this:
 

    rabbitmqctl pin_queue_to_disk queue_name_you_want_to_pin

But it didnt work either.   I got error msg "Error: could not recognise
command"



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/queue-persistance-queue-mode-tp25848.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Tue Apr  2 20:46:38 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 2 Apr 2013 23:46:38 +0400
Subject: [rabbitmq-discuss] queue persistance/ queue mode
In-Reply-To: <1364931668022-25848.post@n5.nabble.com>
References: <1364931668022-25848.post@n5.nabble.com>
Message-ID: <CAE3HoVTJ6vS1+fcg=C9-fh6Pz6Lfe0yt66fkYQgs+YGQrr7XVw@mail.gmail.com>

2013/4/2 chiragpujara <chiragpujara at gmail.com>

> Does it stores messages on
> disk? But still it is upto producer to write msgs to queue with that
> option.
> Is there a way for me to create queue that stores all the messages to disk.
>
>
Messages that are published as persistent will be stored on disk. You can
also declare a queue
as durable so that it survives broker restarts.

Producers do not publish messages to queues. They publish them to
exchanges, then RabbitMQ routes
them to queues. It is, of course, up to your application to publish
messages to exchanges. There is
something called Publisher Confirms to make that more reliable.

I highly recommend you to read
http://rabbitmq.com/tutorials/amqp-concepts.html first.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/6da935a0/attachment.htm>

From chiragpujara at gmail.com  Tue Apr  2 22:10:55 2013
From: chiragpujara at gmail.com (Chirag Pujara)
Date: Tue, 2 Apr 2013 16:10:55 -0500
Subject: [rabbitmq-discuss] queue persistance/ queue mode
In-Reply-To: <CAE3HoVTJ6vS1+fcg=C9-fh6Pz6Lfe0yt66fkYQgs+YGQrr7XVw@mail.gmail.com>
References: <1364931668022-25848.post@n5.nabble.com>
	<CAE3HoVTJ6vS1+fcg=C9-fh6Pz6Lfe0yt66fkYQgs+YGQrr7XVw@mail.gmail.com>
Message-ID: <CAKineiJ4apOp7DC_QvKTg6tvAfevL+mNzUFn7pr_Un3+3QvJGg@mail.gmail.com>

Thanks for info.

So there is no concept like disk mode queue where msgs are stored on disk
no matter how they are published?




On Tue, Apr 2, 2013 at 2:46 PM, Michael Klishin <michael.s.klishin at gmail.com
> wrote:

>
> 2013/4/2 chiragpujara <chiragpujara at gmail.com>
>
>> Does it stores messages on
>> disk? But still it is upto producer to write msgs to queue with that
>> option.
>> Is there a way for me to create queue that stores all the messages to
>> disk.
>>
>>
> Messages that are published as persistent will be stored on disk. You can
> also declare a queue
> as durable so that it survives broker restarts.
>
> Producers do not publish messages to queues. They publish them to
> exchanges, then RabbitMQ routes
> them to queues. It is, of course, up to your application to publish
> messages to exchanges. There is
> something called Publisher Confirms to make that more reliable.
>
> I highly recommend you to read
> http://rabbitmq.com/tutorials/amqp-concepts.html first.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/a014b77f/attachment.htm>

From michael.s.klishin at gmail.com  Tue Apr  2 22:14:35 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 3 Apr 2013 01:14:35 +0400
Subject: [rabbitmq-discuss] queue persistance/ queue mode
In-Reply-To: <CAKineiJ4apOp7DC_QvKTg6tvAfevL+mNzUFn7pr_Un3+3QvJGg@mail.gmail.com>
References: <1364931668022-25848.post@n5.nabble.com>
	<CAE3HoVTJ6vS1+fcg=C9-fh6Pz6Lfe0yt66fkYQgs+YGQrr7XVw@mail.gmail.com>
	<CAKineiJ4apOp7DC_QvKTg6tvAfevL+mNzUFn7pr_Un3+3QvJGg@mail.gmail.com>
Message-ID: <CAE3HoVS-zdNcjBxA-Fm+2cce12oNXS8JtGgYxo3_qoFjkVeirQ@mail.gmail.com>

2013/4/3 Chirag Pujara <chiragpujara at gmail.com>

> So there is no concept like disk mode queue where msgs are stored on disk
> no matter how they are published?


There is no, it is decided on the per-message basis.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/37940e99/attachment.htm>

From matthias at rabbitmq.com  Tue Apr  2 22:20:39 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 02 Apr 2013 22:20:39 +0100
Subject: [rabbitmq-discuss] queue persistance/ queue mode
In-Reply-To: <CAE3HoVS-zdNcjBxA-Fm+2cce12oNXS8JtGgYxo3_qoFjkVeirQ@mail.gmail.com>
References: <1364931668022-25848.post@n5.nabble.com>
	<CAE3HoVTJ6vS1+fcg=C9-fh6Pz6Lfe0yt66fkYQgs+YGQrr7XVw@mail.gmail.com>
	<CAKineiJ4apOp7DC_QvKTg6tvAfevL+mNzUFn7pr_Un3+3QvJGg@mail.gmail.com>
	<CAE3HoVS-zdNcjBxA-Fm+2cce12oNXS8JtGgYxo3_qoFjkVeirQ@mail.gmail.com>
Message-ID: <515B4BA7.7050505@rabbitmq.com>

On 02/04/13 22:14, Michael Klishin wrote:
> 2013/4/3 Chirag Pujara <chiragpujara at gmail.com
> <mailto:chiragpujara at gmail.com>>
>
>     So there is no concept like disk mode queue where msgs are stored on
>     disk no matter how they are published?
>
> There is no, it is decided on the per-message basis.

If the client *always* publishes with persistent delivery_mode then the 
decision is in effect made on a per queue basis, controlled by the 
'durable' attribute of a queue.

Matthias.

From stuff at moesel.net  Tue Apr  2 23:07:24 2013
From: stuff at moesel.net (Chris)
Date: Tue, 2 Apr 2013 18:07:24 -0400
Subject: [rabbitmq-discuss] AD Queues Not AutoDeleting
In-Reply-To: <CAE3HoVSS+=OWi8xsafux4+pUB=0Zb1urXXsNuOXsqyN3Y31T+A@mail.gmail.com>
References: <CAHEpgBBt3xWwB8-A+wqGUC_yRygtCZLitTZ_Fkw2UFE2Tf25mA@mail.gmail.com>
	<CAE3HoVSiOO1Z=J77bd0=YPC=ev5+LYHMv6Y4jGm44K5OZNLQ_w@mail.gmail.com>
	<CAHEpgBCZChrux1cHL4Zh8f4tg0xZCcH6KEAbPwDv0ct4cquDVw@mail.gmail.com>
	<515ADF89.2040202@rabbitmq.com>
	<CAE3HoVQLoHu9F4UEzP9k8=B=EPcxuqYudeVrrKJ6iJuHn0ZiRg@mail.gmail.com>
	<CAHEpgBAqBd=6R7rJi5DEYBdYc4XxDrQ8o658gL32TrL9csZPsQ@mail.gmail.com>
	<CAE3HoVSS+=OWi8xsafux4+pUB=0Zb1urXXsNuOXsqyN3Y31T+A@mail.gmail.com>
Message-ID: <CAHEpgBBmqdVDw-Bj-vp1Z9Hbf+U=dW=jtbANJoJAGnh+VSXV9w@mail.gmail.com>

>> So you want a temporary queue that will be mirrored and needs to
preserve messages when the client disconnects?

Ha.  When you put it that way, it sounds like a foolish request, doesn't
it?  I think maybe my best bet is to setup the queue with an expiry policy.
 That way I can give my client some time to reconnect, but if they never
reconnect, I can eventually trash the queue...  Maybe that is the answer
for me...

-Chris



On Tue, Apr 2, 2013 at 2:25 PM, Michael Klishin <michael.s.klishin at gmail.com
> wrote:

>
> 2013/4/2 Chris <stuff at moesel.net>
>
>> Or to put it another way:  I think that if I want to be sure not to lose
>> messages during a reconnection, I have to reconnect to the same queue, and
>> therefore that queue cannot be declared exclusive.  Which leads to the next
>> question: If it is declared autodelete, do I have a small grace period in
>> which I can reconnect and resubscribe before it autodeletes itself?
>
>
> I would not rely on that. It would create a race condition that will cause
> a lot of operational pain.
>
> So you want a temporary queue that will be mirrored and needs to preserve
> messages when the client disconnects?
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/cdc0dbba/attachment.htm>

From michael.s.klishin at gmail.com  Tue Apr  2 23:10:14 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 3 Apr 2013 02:10:14 +0400
Subject: [rabbitmq-discuss] AD Queues Not AutoDeleting
In-Reply-To: <CAHEpgBBmqdVDw-Bj-vp1Z9Hbf+U=dW=jtbANJoJAGnh+VSXV9w@mail.gmail.com>
References: <CAHEpgBBt3xWwB8-A+wqGUC_yRygtCZLitTZ_Fkw2UFE2Tf25mA@mail.gmail.com>
	<CAE3HoVSiOO1Z=J77bd0=YPC=ev5+LYHMv6Y4jGm44K5OZNLQ_w@mail.gmail.com>
	<CAHEpgBCZChrux1cHL4Zh8f4tg0xZCcH6KEAbPwDv0ct4cquDVw@mail.gmail.com>
	<515ADF89.2040202@rabbitmq.com>
	<CAE3HoVQLoHu9F4UEzP9k8=B=EPcxuqYudeVrrKJ6iJuHn0ZiRg@mail.gmail.com>
	<CAHEpgBAqBd=6R7rJi5DEYBdYc4XxDrQ8o658gL32TrL9csZPsQ@mail.gmail.com>
	<CAE3HoVSS+=OWi8xsafux4+pUB=0Zb1urXXsNuOXsqyN3Y31T+A@mail.gmail.com>
	<CAHEpgBBmqdVDw-Bj-vp1Z9Hbf+U=dW=jtbANJoJAGnh+VSXV9w@mail.gmail.com>
Message-ID: <CAE3HoVT0QhR-nft0HtJC8vfTaM2dJqtMZ-+XOLQ-aa1YRYLQRw@mail.gmail.com>

2013/4/3 Chris <stuff at moesel.net>

> Ha.  When you put it that way, it sounds like a foolish request, doesn't
> it?  I think maybe my best bet is to setup the queue with an expiry policy.
>  That way I can give my client some time to reconnect, but if they never
> reconnect, I can eventually trash the queue...  Maybe that is the answer
> for me...


RabbitMQ 3.0 supports both queue TTL and message TTL, so you can use some
combination of the two.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/d4086ae0/attachment.htm>

From sender.eric at gmail.com  Wed Apr  3 00:19:57 2013
From: sender.eric at gmail.com (sender.eric)
Date: Tue, 2 Apr 2013 16:19:57 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ unable to talk to remote server
In-Reply-To: <515AB1BA.9000601@rabbitmq.com>
References: <1364596697774-25793.post@n5.nabble.com>
	<515AB1BA.9000601@rabbitmq.com>
Message-ID: <1364944797422-25855.post@n5.nabble.com>

Thank you Emile! I was able to get it working by modifying the iptables using
this tutorial 

http://wiki.centos.org/HowTos/Network/IPTables

And using the line 
iptables -A INPUT -p tcp --dport 5672 -j ACCEPT

to the sample file. And it worked!



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-unable-to-talk-to-remote-server-tp25793p25855.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jonathan.schwietert at gmail.com  Tue Apr  2 23:32:28 2013
From: jonathan.schwietert at gmail.com (Jonathan Schwietert)
Date: Tue, 2 Apr 2013 15:32:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Durable + Exclusive queue disappeared
Message-ID: <e9308733-7b89-4244-81aa-2db184fb9128@googlegroups.com>

Hi, I have a queue which was declared with BOTH durable and exclusive (on 
accident) whose owner disconnected then reconnected and now receives: 
"NOT_FOUND - no queue 'test.queue' in vhost '/test.vhost'". This queue is 
no longer visible in any administrative application: web management, 
rabbitmqadmin, or even rabbitmqctl (for list_queues).

I believe it may still exist in the mnesia DB and thus is causing 
subsequent queue.declare calls to fail as it had been declared exclusive. 
This happens in the management plugin as well. I've also installed the 
rabbitmqadmin and tried to delete the queue to which it replies: "*** Not 
found: /queues/%2Ftest.vhost/test.queue" I cat'ed out the durable queue 
mnesia file: "cat 
/var/lib/rabbitmq/mnesia/rabbit\@test-broker/rabbit_durable_queue.DCD | 
grep test.queue" and received "Binary file (standard input) matches"

Unfortunately i'm unfamiliar with mnesia and unable to simply delete the 
entry. Any suggestions? Would backing up the configuration; then calling 
stop_app, then reset, then start_app; then reloading the configuration fix 
it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130402/8386892b/attachment.htm>

From emile at rabbitmq.com  Wed Apr  3 10:27:39 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 03 Apr 2013 10:27:39 +0100
Subject: [rabbitmq-discuss] Durable + Exclusive queue disappeared
In-Reply-To: <e9308733-7b89-4244-81aa-2db184fb9128@googlegroups.com>
References: <e9308733-7b89-4244-81aa-2db184fb9128@googlegroups.com>
Message-ID: <515BF60B.5060301@rabbitmq.com>



Hi,

On 02/04/13 23:32, Jonathan Schwietert wrote:
> Hi, I have a queue which was declared with BOTH durable and exclusive
> (on accident) whose owner disconnected then reconnected and now
> receives: "NOT_FOUND - no queue 'test.queue' in vhost '/test.vhost'".

See the documentation for the exclusive parameter:

http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.exclusive

"Exclusive queues may only be accessed by the current connection, and
are deleted when that connection closes."

So your 'test.queue' should not longer exist. The presence of the string
in the internal Mnesia files does not necessarily mean that the queue
still exists since the name could appear in internal logs.

The scenario you describe can occur if a queue was declared on a node
which leaves a cluster. A "Not Found" error will result when attempting
to redeclare or delete the queue on any remaining nodes in the cluster.
The solution is for the node that left the cluster to rejoin. The use of
mirrored queues will prevent this condition.


-Emile







From tim at rabbitmq.com  Wed Apr  3 10:48:21 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 3 Apr 2013 10:48:21 +0100
Subject: [rabbitmq-discuss] Configuring RabbitMQ to support
	change	in	hostname
In-Reply-To: <9509e512.00001688.00000009@KAPILPC.vmware.com>
References: <9915783f.00001508.000000cf@KAPILPC.vmware.com>	<95003806-680B-425F-AC8D-9466CAB8071D@dushin.net>	<215e265c.00001508.000000f6@KAPILPC.vmware.com>	<40BB9183-870B-45DA-AAA5-31EB0D801592@rabbitmq.com>	<e3316de2.00001688.00000003@KAPILPC.vmware.com>
	<51B3A6B5-FC4E-4254-A403-3941856C29DB@rabbitmq.com>
	<9509e512.00001688.00000009@KAPILPC.vmware.com>
Message-ID: <F5F4BA6F-3E83-46DB-AD55-45C8DDEC0616@rabbitmq.com>

Hi

On 2 Apr 2013, at 20:29, Kapil Goyal wrote:

> I noticed that names of log files, DB etc. are created from node-name. Node-name itself is created based on hostname by default. So, if hostname changes, node-names changes and so do the DB, logs etc.

I can see why this is a source of difficulty if your hostname changes with regularly, but surely the better solution would be to find some way to prevent the hostname from changing?

>  
> My idea was to fix the node-name and make it independent of the hostname, thus fixing the names of DB and logs. But, if I try to use a clustered or federated setup, the multiple RabbitMQ instances will need to talk to each other and I cannot use the same fixed node-name for all the instances. To solve that, I thought I will generate the node-name at first boot of the RabbitMQ server (and not change it ever). Random-string was just to ensure that all RabbitMQ instances get unique node-names.

I understand that, but it will not work. The node name has to be a valid Erlang node name, and that has the form <name>@<host> where the <host> part can be either a fully qualified domain name or a short name such as 'myhost'. You cannot use 'rabbit at 987sdfkjhisd7f7d87sdf' to connect to other Erlang nodes unless the part after the @ is actually the hostname. In addition to this, mnesia - Erlang's distributed database - insists on creating its on-disk schema in a folder which is named Mnesia.<node-name>, and we have no control over that. Renaming the mnesia directory is fine in principle, although if you change the node's name when you're in a cluster then there's a bigger problem because you'll have to notify all the other member nodes that you're changing name - I think the only way to do that would be to leave the cluster and then come back as another node. 

>  
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
> Sent: Tuesday, April 02, 2013 11:59 AM
> To: Discussions about RabbitMQ
> Cc: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Configuring RabbitMQ to support change in hostname
>  
> Hi
> 
> On 2 Apr 2013, at 19:44, Kapil Goyal <goyalk at vmware.com> wrote:
> 
> So, RabbitMQ does not really support change in hostname at all without losing existing data. Is that correct?
>  
>  
> Erm not quite - if you copy/rename the mnesia directory you can work around this. The node name is dev1 then you can rename/move directories to something else (or override directory names to use something that isn't bound to the node name if you prefer). I don't see how your proposed use of a
> Random stein would make any different though. 
> 
> 
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
> Sent: Tuesday, April 02, 2013 4:31 AM
> To: Discussions about RabbitMQ
> Cc: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Configuring RabbitMQ to support change in hostname
>  
> On 29 Mar 2013, at 23:18, Kapil Goyal <goyalk at vmware.com> wrote:
>  
>  am thinking of solving it by replacing rabbit at localhost with rabbit@<random string> before RabbitMQ starts for the first time. Does <random string> have to be DNS resolvable?
>  
> Yes. It needs to be the proper hostname for the node.
>  
> 
> 
> 
>  
>  
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Dushin Fred
> Sent: Thursday, March 28, 2013 6:44 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Configuring RabbitMQ to support change in hostname
>  
> See
>  
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-February/025368.html
>  
>  
> On Mar 28, 2013, at 4:53 PM, Kapil Goyal <goyalk at vmware.com> wrote:
> 
> 
> 
> 
> RabbitMQ creates a new database if hostname is changed (as documented at http://www.rabbitmq.com/ec2.html).
>  
> I need to support the hostname change on my RabbitMQ server without impacting its functioning. Can I accomplish this by setting the NODENAME environment variable in rabbitmq-env.conf. It seems from rabbitmq-server script that names of database, logs etc. try to use this variable before resorting to using hostname. Is this the right approach? Are there any side-effects to look out for?
>  
> Thanks
> Kapil Goyal
> Sr. MTS
> VMware Inc.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/05fe44b6/attachment.htm>

From sujandutta at gmail.com  Wed Apr  3 12:12:48 2013
From: sujandutta at gmail.com (Sujan Dutta)
Date: Wed, 3 Apr 2013 16:42:48 +0530
Subject: [rabbitmq-discuss] rabbitmq management custom port
Message-ID: <CABUC-UA3mxG9f8zOzBs+spG7YS3j7bzFMWDxWTDg2waDWYH_4w@mail.gmail.com>

rabbitmq-server 3.0.4
i could change the rabbitmq-server port but when i am trying to change the
management port by following config tuple in rabbitmq.config file, nothing
is changed, it still use 15672 and 55672 to redirect to 15672

{rabbitmq_management, [{listeners, [{port, 55670}]}]}

earlier version rabbitmq-server 2.8, i could change the rabbitmq mochiweb
port through config file.

let me know, if i am missing something.
-- 
Sujan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/cdd32fe2/attachment.htm>

From Marek.Cermak at Honeywell.com  Wed Apr  3 13:16:22 2013
From: Marek.Cermak at Honeywell.com (Cermak, Marek)
Date: Wed, 3 Apr 2013 12:16:22 +0000
Subject: [rabbitmq-discuss] memory consumption during message delivery
Message-ID: <F1A539826FC33E4CA602BB52E5C4502222B6F005@FR44EX3004.global.ds.honeywell.com>

Hi everybody,
I did some measurements of memory consumption of RMQ (v3.0.2) during sending and delivering messages and found an interesting behaviour during delivery. In short: messages were stored in mnesia transient storage on disk and when a consumer starts to consume them all of them were read to memory in one chunk which was almost deadly for RMQ and the server.

The scenario was 1+2+8+10 pairs of bound direct exchanges and queues each received messages of particular size (1kB, 64 kB, 1 MB and 8MB) and after a while consumer was started to 'empty' each of the queues. The consumer of the queue with biggest messages triggered the avalanche of data being transferred from disk to memory. Similar behaviour can be seen always when you fill the queue up to the roof with bigger messages and start the consumer. I've created the chart where you can see it clearly.

Tested with 1G of memory, 64b Debian GNU/linux, Erlang R15B, RMQ v3.0.2.

Is it an expected behaviour? Can it be somehow tuned/adjusted? Thanks.

Marek


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/73bf1903/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: combo_020.gif
Type: image/gif
Size: 29688 bytes
Desc: combo_020.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/73bf1903/attachment.gif>

From tim at rabbitmq.com  Wed Apr  3 13:35:56 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 3 Apr 2013 13:35:56 +0100
Subject: [rabbitmq-discuss] memory consumption during message delivery
In-Reply-To: <F1A539826FC33E4CA602BB52E5C4502222B6F005@FR44EX3004.global.ds.honeywell.com>
References: <F1A539826FC33E4CA602BB52E5C4502222B6F005@FR44EX3004.global.ds.honeywell.com>
Message-ID: <9239D0CC-FD62-4BEA-B6A8-6154883F144F@rabbitmq.com>

Marek,

On 3 Apr 2013, at 13:16, Cermak, Marek wrote:

> Hi everybody,
> I did some measurements of memory consumption of RMQ (v3.0.2) during sending and delivering messages and found an interesting behaviour during delivery. In short: messages were stored in mnesia transient storage on disk and when a consumer starts to consume them all of them were read to memory in one chunk which was almost deadly for RMQ and the server.

The mnesia database is used to store schema elements (queue definitions, exchanges, users, etc), however messages are *never* stored in mnesia, they're stored in a custom file system storage layer - the persister -  which was purpose written for RabbitMQ.

>  
> The scenario was 1+2+8+10 pairs of bound direct exchanges and queues each received messages of particular size (1kB, 64 kB, 1 MB and 8MB) and after a while consumer was started to 'empty' each of the queues. The consumer of the queue with biggest messages triggered the avalanche of data being transferred from disk to memory. Similar behaviour can be seen always when you fill the queue up to the roof with bigger messages and start the consumer.
[snip]
> Tested with 1G of memory, 64b Debian GNU/linux, Erlang R15B, RMQ v3.0.2.
>  
> Is it an expected behaviour? Can it be somehow tuned/adjusted? Thanks.
>  

Well if you've got a bunch of data on disk that needs to be delivered to a consumer later on, it'll need to be read into memory in order to be transferred onto the wire. One obvious way to avoid getting into this position would be to allocate a good deal more memory - if you're expecting a large volume of data in your queues, then 1Gb seems quite small.

How would you like to be able to tune it? There are some parameters of the message store which are configurable, see http://www.rabbitmq.com/configure.html - but I suspect these will not do what you want and I'd strongly advise against fiddling with them - as far as we can tell, these are already optimally tuned. In fact, I really suspect that the right thing for you to do is add more memory. Rabbit will use as much memory as possible to get its job done, so allocating more memory is the way to do IMO.

Cheers,
Tim

> Marek
>  
>  
> <combo_020.gif>_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/546ac7c9/attachment.htm>

From Marek.Cermak at Honeywell.com  Wed Apr  3 13:52:37 2013
From: Marek.Cermak at Honeywell.com (Cermak, Marek)
Date: Wed, 3 Apr 2013 12:52:37 +0000
Subject: [rabbitmq-discuss] memory consumption during message delivery
In-Reply-To: <9239D0CC-FD62-4BEA-B6A8-6154883F144F@rabbitmq.com>
References: <F1A539826FC33E4CA602BB52E5C4502222B6F005@FR44EX3004.global.ds.honeywell.com>
	<9239D0CC-FD62-4BEA-B6A8-6154883F144F@rabbitmq.com>
Message-ID: <F1A539826FC33E4CA602BB52E5C4502222B6F03A@FR44EX3004.global.ds.honeywell.com>

Hi Tim,
thanks for answer.

I would reckon that 'slowing down' the transfer from disk to memory may be a way to go. It definitely is not desirable for all purposes but for particular cases - like the one I tested - it would be nice to be able to set some values :) Another effect I've seen was using of huge amount of file descriptors which after all limits the  transfer from RMQ to consumer as RMQ has to wait. The delivery was very slow (at least in comparison with publishing).

I know 1G of memory is not much but I look for the limits for various purposes so this is the way to go in my case.

thanks
Marek

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: 03 April, 2013 14:36
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] memory consumption during message delivery

Marek,

On 3 Apr 2013, at 13:16, Cermak, Marek wrote:


Hi everybody,
I did some measurements of memory consumption of RMQ (v3.0.2) during sending and delivering messages and found an interesting behaviour during delivery. In short: messages were stored in mnesia transient storage on disk and when a consumer starts to consume them all of them were read to memory in one chunk which was almost deadly for RMQ and the server.

The mnesia database is used to store schema elements (queue definitions, exchanges, users, etc), however messages are *never* stored in mnesia, they're stored in a custom file system storage layer - the persister -  which was purpose written for RabbitMQ.



The scenario was 1+2+8+10 pairs of bound direct exchanges and queues each received messages of particular size (1kB, 64 kB, 1 MB and 8MB) and after a while consumer was started to 'empty' each of the queues. The consumer of the queue with biggest messages triggered the avalanche of data being transferred from disk to memory. Similar behaviour can be seen always when you fill the queue up to the roof with bigger messages and start the consumer.
[snip]

Tested with 1G of memory, 64b Debian GNU/linux, Erlang R15B, RMQ v3.0.2.

Is it an expected behaviour? Can it be somehow tuned/adjusted? Thanks.


Well if you've got a bunch of data on disk that needs to be delivered to a consumer later on, it'll need to be read into memory in order to be transferred onto the wire. One obvious way to avoid getting into this position would be to allocate a good deal more memory - if you're expecting a large volume of data in your queues, then 1Gb seems quite small.

How would you like to be able to tune it? There are some parameters of the message store which are configurable, see http://www.rabbitmq.com/configure.html - but I suspect these will not do what you want and I'd strongly advise against fiddling with them - as far as we can tell, these are already optimally tuned. In fact, I really suspect that the right thing for you to do is add more memory. Rabbit will use as much memory as possible to get its job done, so allocating more memory is the way to do IMO.

Cheers,
Tim


Marek


<combo_020.gif>_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/95584f23/attachment.htm>

From tim at rabbitmq.com  Wed Apr  3 13:57:08 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 3 Apr 2013 13:57:08 +0100
Subject: [rabbitmq-discuss] memory consumption during message delivery
In-Reply-To: <F1A539826FC33E4CA602BB52E5C4502222B6F03A@FR44EX3004.global.ds.honeywell.com>
References: <F1A539826FC33E4CA602BB52E5C4502222B6F005@FR44EX3004.global.ds.honeywell.com>
	<9239D0CC-FD62-4BEA-B6A8-6154883F144F@rabbitmq.com>
	<F1A539826FC33E4CA602BB52E5C4502222B6F03A@FR44EX3004.global.ds.honeywell.com>
Message-ID: <60E53360-A041-4A79-A1C5-F1DCF3E1D82A@rabbitmq.com>

Marek,

On 3 Apr 2013, at 13:52, Cermak, Marek wrote:
> I would reckon that 'slowing down' the transfer from disk to memory may be a way to go.

You could set a low (ish) prefetch count in your consumer so as to only bring 'n' messages off the disk at a time and then only ACK them (in batch mode or otherwise) when you're done with them, thereby slowing things down.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/582103c7/attachment.htm>

From michael.justin at gmx.net  Wed Apr  3 15:40:07 2013
From: michael.justin at gmx.net (Michael Justin)
Date: Wed, 03 Apr 2013 16:40:07 +0200
Subject: [rabbitmq-discuss] ANN: Habari Client for RabbitMQ - Delphi and
	Free Pascal client
Message-ID: <kjhf09$7cr$1@ger.gmane.org>

April 2, 2013 - Habarisoft released version 1.6 of Habari Client for 
RabbitMQ, a Delphi and Free Pascal client library for the RabbitMQ 
message broker.

New features in this release include improved support for heart-beating 
(STOMP 1.1), broker receipts for sent messages, detection of lost 
connections, and on-demand creation of the background thread for 
asynchronous receive.

Home page and demo download:
http://www.habarisoft.com/habari_rabbitmq.html

Regards
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/


From jonathan.schwietert at gmail.com  Wed Apr  3 17:28:02 2013
From: jonathan.schwietert at gmail.com (Jonathan Schwietert)
Date: Wed, 3 Apr 2013 09:28:02 -0700 (PDT)
Subject: [rabbitmq-discuss] Durable + Exclusive queue disappeared
In-Reply-To: <e9308733-7b89-4244-81aa-2db184fb9128@googlegroups.com>
References: <e9308733-7b89-4244-81aa-2db184fb9128@googlegroups.com>
Message-ID: <d82e81ea-d03f-4188-a06a-6f3b2f8fcaaf@googlegroups.com>

Pasting in a response i received via email that isn't showing up on this 
list, from *Emile Joubert:*
Hi,

On 02/04/13 23:32, Jonathan Schwietert wrote:

Hi, I have a queue which was declared with BOTH durable and exclusive

(on accident) whose owner disconnected then reconnected and now

receives: "NOT_FOUND - no queue 'test.queue' in vhost '/test.vhost'".


See the documentation for the exclusive parameter:

http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.exclusive

"Exclusive queues may only be accessed by the current connection, and
are deleted when that connection closes."

So your 'test.queue' should not longer exist. The presence of the string
in the internal Mnesia files does not necessarily mean that the queue
still exists since the name could appear in internal logs.

The scenario you describe can occur if a queue was declared on a node
which leaves a cluster. A "Not Found" error will result when attempting
to redeclare or delete the queue on any remaining nodes in the cluster.
The solution is for the node that left the cluster to rejoin. The use of
mirrored queues will prevent this condition.


-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/6ebefa4a/attachment.htm>

From jonathan.schwietert at gmail.com  Wed Apr  3 17:28:46 2013
From: jonathan.schwietert at gmail.com (Jonathan Schwietert)
Date: Wed, 3 Apr 2013 09:28:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Durable + Exclusive queue disappeared
In-Reply-To: <d82e81ea-d03f-4188-a06a-6f3b2f8fcaaf@googlegroups.com>
References: <e9308733-7b89-4244-81aa-2db184fb9128@googlegroups.com>
	<d82e81ea-d03f-4188-a06a-6f3b2f8fcaaf@googlegroups.com>
Message-ID: <c24c752c-2ce7-4fad-92d0-5f906abd1c98@googlegroups.com>

Thanks for the quick response Emile. I did happen to see that result in my 
searching but unfortunately our broker is standalone - so there are no 
other nodes to bring up.

On Wednesday, April 3, 2013 10:28:02 AM UTC-6, Jonathan Schwietert wrote:
>
> Pasting in a response i received via email that isn't showing up on this 
> list, from *Emile Joubert:*
> Hi,
>
> On 02/04/13 23:32, Jonathan Schwietert wrote:
>
> Hi, I have a queue which was declared with BOTH durable and exclusive
>
> (on accident) whose owner disconnected then reconnected and now
>
> receives: "NOT_FOUND - no queue 'test.queue' in vhost '/test.vhost'".
>
>
> See the documentation for the exclusive parameter:
>
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.exclusive
>
> "Exclusive queues may only be accessed by the current connection, and
> are deleted when that connection closes."
>
> So your 'test.queue' should not longer exist. The presence of the string
> in the internal Mnesia files does not necessarily mean that the queue
> still exists since the name could appear in internal logs.
>
> The scenario you describe can occur if a queue was declared on a node
> which leaves a cluster. A "Not Found" error will result when attempting
> to redeclare or delete the queue on any remaining nodes in the cluster.
> The solution is for the node that left the cluster to rejoin. The use of
> mirrored queues will prevent this condition.
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/d96dcef5/attachment.htm>

From sujandutta at gmail.com  Thu Apr  4 05:54:23 2013
From: sujandutta at gmail.com (sujan dutta)
Date: Wed, 3 Apr 2013 21:54:23 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq management custom port
Message-ID: <8897b945-2320-4225-9349-2e403ab93508@googlegroups.com>

rabbitmq-server 3.0.4
i could change the rabbitmq-server port but when i am trying to change the 
management port by following config tuple in rabbitmq.config file, nothing 
is changed, it still use 15672 and 55672 to redirect to 15672

{rabbitmq_management, [{listeners, [{port, 55670}]}]}

earlier version rabbitmq-server 2.8, i could change the rabbitmq mochiweb 
port through config file.
let me know, if i am missing something
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130403/42d2876d/attachment.htm>

From frank.shearar at gmail.com  Thu Apr  4 09:16:23 2013
From: frank.shearar at gmail.com (Frank Shearar)
Date: Thu, 4 Apr 2013 09:16:23 +0100
Subject: [rabbitmq-discuss] rabbitmq management custom port
In-Reply-To: <8897b945-2320-4225-9349-2e403ab93508@googlegroups.com>
References: <8897b945-2320-4225-9349-2e403ab93508@googlegroups.com>
Message-ID: <CAJbhyREvnXQkf=0_GQ_YO8B=A=1i5VAf5tgZch9tYkMuSmAvCQ@mail.gmail.com>

On 4 April 2013 05:54, sujan dutta <sujandutta at gmail.com> wrote:
> rabbitmq-server 3.0.4
> i could change the rabbitmq-server port but when i am trying to change the
> management port by following config tuple in rabbitmq.config file, nothing
> is changed, it still use 15672 and 55672 to redirect to 15672
>
> {rabbitmq_management, [{listeners, [{port, 55670}]}]}

Rabbit's quite sensitive as to _where_ you put this:

[{rabbit,
    [
        {tcp_listeners, [5672]}
    ]
},
{rabbitmq_management,
    [
        {listener, [
            {port, 12345}
        ]}
    ]
}
].

should work just fine in a 3.0.4 Rabbit.

frank

From sujandutta at gmail.com  Thu Apr  4 09:34:01 2013
From: sujandutta at gmail.com (Sujan Dutta)
Date: Thu, 4 Apr 2013 14:04:01 +0530
Subject: [rabbitmq-discuss] rabbitmq management custom port
In-Reply-To: <CAJbhyREvnXQkf=0_GQ_YO8B=A=1i5VAf5tgZch9tYkMuSmAvCQ@mail.gmail.com>
References: <8897b945-2320-4225-9349-2e403ab93508@googlegroups.com>
	<CAJbhyREvnXQkf=0_GQ_YO8B=A=1i5VAf5tgZch9tYkMuSmAvCQ@mail.gmail.com>
Message-ID: <CABUC-UDdZ=e9bQK4hf9Qk3cgTDtW6Fui7FWB4aCvEpktR1OV-Q@mail.gmail.com>

thanks frank,

i was writing listeners instead of listener in config.

sujan


On 4 April 2013 13:46, Frank Shearar <frank.shearar at gmail.com> wrote:

> On 4 April 2013 05:54, sujan dutta <sujandutta at gmail.com> wrote:
> > rabbitmq-server 3.0.4
> > i could change the rabbitmq-server port but when i am trying to change
> the
> > management port by following config tuple in rabbitmq.config file,
> nothing
> > is changed, it still use 15672 and 55672 to redirect to 15672
> >
> > {rabbitmq_management, [{listeners, [{port, 55670}]}]}
>
> Rabbit's quite sensitive as to _where_ you put this:
>
> [{rabbit,
>     [
>         {tcp_listeners, [5672]}
>     ]
> },
> {rabbitmq_management,
>     [
>         {listener, [
>             {port, 12345}
>         ]}
>     ]
> }
> ].
>
> should work just fine in a 3.0.4 Rabbit.
>
> frank
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Sujan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/08a0b7c5/attachment.htm>

From emile at rabbitmq.com  Thu Apr  4 11:21:29 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 04 Apr 2013 11:21:29 +0100
Subject: [rabbitmq-discuss] Durable + Exclusive queue disappeared
In-Reply-To: <c24c752c-2ce7-4fad-92d0-5f906abd1c98@googlegroups.com>
References: <e9308733-7b89-4244-81aa-2db184fb9128@googlegroups.com>
	<d82e81ea-d03f-4188-a06a-6f3b2f8fcaaf@googlegroups.com>
	<c24c752c-2ce7-4fad-92d0-5f906abd1c98@googlegroups.com>
Message-ID: <515D5429.6060505@rabbitmq.com>


Hi Jonathan,

On 03/04/13 17:28, Jonathan Schwietert wrote:
> Thanks for the quick response Emile. I did happen to see that result in
> my searching but unfortunately our broker is standalone - so there are
> no other nodes to bring up.


If your broker has only ever been standalone then the explanation that
involves another broker does not apply, though that is the only way I
know of to replicate the error condition. If you can recreate the error
with a small sequence of steps then please post them. The only way to
recover from the error is to move or delete the broker database directory.



-Emile






From pkelly at gmail.com  Thu Apr  4 13:06:48 2013
From: pkelly at gmail.com (Pete Kelly)
Date: Thu, 4 Apr 2013 13:06:48 +0100
Subject: [rabbitmq-discuss] Cluster reverted to old config!
Message-ID: <CAEWH9M--OPwMCO36B3orXOJdtD9QWkb5wNq7MniycL58R5maXw@mail.gmail.com>

Hi

We are running an (admittedly old) rabbitmq cluster pair, both running 2.7.1
/ R14B04

Our NOC recently did some recabling which involved replacing the network
cables on both rabbitmq boxes. During this recabling, it looks like both
boxes lost network connectivity for a short period (or eth1 became eth0 and
vice versa) which caused rabbitmq on both boxes to crash.

However, upon restart they came back with the vast majority of
queues/exchanges and vhosts missing missing, to what looks like a very very
old set of 'definitions'

Does anyone have any pointers or ideas as to how this can have happened?
Both nodes in the cluster are disk nodes so I would have thought the
definitions would be stored on disk to be read in in the event of a restart.

Is it possible it lost the definitions (because both cluster nodes crashed
at the same time) so it just loaded in the last one which was imported via
the management GUI?

Any advice or thoughts would be appreciated, if only to help prevent this
from happening in the future!

Thanks

Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/f2bb2f4f/attachment.htm>

From Marek.Cermak at Honeywell.com  Thu Apr  4 14:17:41 2013
From: Marek.Cermak at Honeywell.com (Cermak, Marek)
Date: Thu, 4 Apr 2013 13:17:41 +0000
Subject: [rabbitmq-discuss] memory consumption during message delivery
In-Reply-To: <60E53360-A041-4A79-A1C5-F1DCF3E1D82A@rabbitmq.com>
References: <F1A539826FC33E4CA602BB52E5C4502222B6F005@FR44EX3004.global.ds.honeywell.com>
	<9239D0CC-FD62-4BEA-B6A8-6154883F144F@rabbitmq.com>
	<F1A539826FC33E4CA602BB52E5C4502222B6F03A@FR44EX3004.global.ds.honeywell.com>
	<60E53360-A041-4A79-A1C5-F1DCF3E1D82A@rabbitmq.com>
Message-ID: <F1A539826FC33E4CA602BB52E5C4502222B6F24D@FR44EX3004.global.ds.honeywell.com>

Hi Tim,
the prefetch works perfectly. Thanks for help.
Marek

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: 03 April, 2013 14:57
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] memory consumption during message delivery

Marek,

On 3 Apr 2013, at 13:52, Cermak, Marek wrote:
I would reckon that 'slowing down' the transfer from disk to memory may be a way to go.

You could set a low (ish) prefetch count in your consumer so as to only bring 'n' messages off the disk at a time and then only ACK them (in batch mode or otherwise) when you're done with them, thereby slowing things down.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/027d28b8/attachment.htm>

From emile at rabbitmq.com  Thu Apr  4 15:07:05 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 04 Apr 2013 15:07:05 +0100
Subject: [rabbitmq-discuss] Cluster reverted to old config!
In-Reply-To: <CAEWH9M--OPwMCO36B3orXOJdtD9QWkb5wNq7MniycL58R5maXw@mail.gmail.com>
References: <CAEWH9M--OPwMCO36B3orXOJdtD9QWkb5wNq7MniycL58R5maXw@mail.gmail.com>
Message-ID: <515D8909.5020803@rabbitmq.com>



Hi Pete,

On 04/04/13 13:06, Pete Kelly wrote:
> boxes lost network connectivity for a short period (or eth1 became eth0
> and vice versa) which caused rabbitmq on both boxes to crash.

Brokers will survive network interruptions, but probably not network
hardware reconfiguration.

> Is it possible it lost the definitions (because both cluster nodes
> crashed at the same time) so it just loaded in the last one which was
> imported via the management GUI?

If the management plugin was configured to load an out-of-date
definition at startup (available on brokers since v2.8.0) then it could
appear like a reversion. The same could happen on a pre-v2.8.0 broker if
you scripted the load of a configuration file at startup.

Disc nodes will retain configuration for durable resources during a
restart, assuming the Mnesia database directory survives intact.
Transient resources will not survive a broker restart, so that may
explain the discrepancy you see for exchanges and queues, but not for
vhosts. E.g. see

http://www.rabbitmq.com/amqp-0-9-1-reference.html#exchange.declare.durable

http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.durable



-Emile





From pkelly at gmail.com  Thu Apr  4 15:29:34 2013
From: pkelly at gmail.com (Pete Kelly)
Date: Thu, 4 Apr 2013 15:29:34 +0100
Subject: [rabbitmq-discuss] Cluster reverted to old config!
In-Reply-To: <515D8909.5020803@rabbitmq.com>
References: <CAEWH9M--OPwMCO36B3orXOJdtD9QWkb5wNq7MniycL58R5maXw@mail.gmail.com>
	<515D8909.5020803@rabbitmq.com>
Message-ID: <CAEWH9M-FpCE=pNAznoFWxJ0rDRb1qCWa=Ad=VA0=sYZv_+8aDw@mail.gmail.com>

On 4 April 2013 15:07, Emile Joubert <emile at rabbitmq.com> wrote:

>
>
> Hi Pete,
>
> On 04/04/13 13:06, Pete Kelly wrote:
> > boxes lost network connectivity for a short period (or eth1 became eth0
> > and vice versa) which caused rabbitmq on both boxes to crash.
>
> Brokers will survive network interruptions, but probably not network
> hardware reconfiguration.
>
> > Is it possible it lost the definitions (because both cluster nodes
> > crashed at the same time) so it just loaded in the last one which was
> > imported via the management GUI?
>
> If the management plugin was configured to load an out-of-date
> definition at startup (available on brokers since v2.8.0) then it could
> appear like a reversion. The same could happen on a pre-v2.8.0 broker if
> you scripted the load of a configuration file at startup.
>
> Disc nodes will retain configuration for durable resources during a
> restart, assuming the Mnesia database directory survives intact.
> Transient resources will not survive a broker restart, so that may
> explain the discrepancy you see for exchanges and queues, but not for
> vhosts. E.g. see
>
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#exchange.declare.durable
>
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.durable


Thanks Emile

All exchanges and queues are marked with the durable bit.

Do you know how I could check to see if there is any predefined startup
configuration anywhere? It certainly looks like the configuration that
could have been active at the point the cluster was created if that would
make any sense?


>
>
>
>
> -Emile
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/4559940b/attachment.htm>

From emile at rabbitmq.com  Thu Apr  4 15:38:38 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 04 Apr 2013 15:38:38 +0100
Subject: [rabbitmq-discuss] Cluster reverted to old config!
In-Reply-To: <CAEWH9M-FpCE=pNAznoFWxJ0rDRb1qCWa=Ad=VA0=sYZv_+8aDw@mail.gmail.com>
References: <CAEWH9M--OPwMCO36B3orXOJdtD9QWkb5wNq7MniycL58R5maXw@mail.gmail.com>
	<515D8909.5020803@rabbitmq.com>
	<CAEWH9M-FpCE=pNAznoFWxJ0rDRb1qCWa=Ad=VA0=sYZv_+8aDw@mail.gmail.com>
Message-ID: <515D906E.3050702@rabbitmq.com>

On 04/04/13 15:29, Pete Kelly wrote:
> All exchanges and queues are marked with the durable bit.
> 
> Do you know how I could check to see if there is any predefined startup
> configuration anywhere? It certainly looks like the configuration that
> could have been active at the point the cluster was created if that
> would make any sense?

This link is relevant for v2.8.0 or later brokers:
http://www.rabbitmq.com/management.html#load-definitions

Older brokers do not have a way of automatically loading a definition file.


-Emile



From jonathan.schwietert at gmail.com  Thu Apr  4 16:11:00 2013
From: jonathan.schwietert at gmail.com (Jonathan Schwietert)
Date: Thu, 4 Apr 2013 08:11:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Durable + Exclusive queue disappeared
In-Reply-To: <c24c752c-2ce7-4fad-92d0-5f906abd1c98@googlegroups.com>
References: <e9308733-7b89-4244-81aa-2db184fb9128@googlegroups.com>
	<d82e81ea-d03f-4188-a06a-6f3b2f8fcaaf@googlegroups.com>
	<c24c752c-2ce7-4fad-92d0-5f906abd1c98@googlegroups.com>
Message-ID: <bb7f3ae3-9110-4620-83b7-c4d7f75a286a@googlegroups.com>

Again, pasting in a response i received via email that isn't showing up on 
this list, from *Emile Joubert:*
*
*Hi Jonathan,

On 03/04/13 17:28, Jonathan Schwietert wrote:

Thanks for the quick response Emile. I did happen to see that result in

my searching but unfortunately our broker is standalone - so there are

no other nodes to bring up.


If your broker has only ever been standalone then the explanation that
involves another broker does not apply, though that is the only way I
know of to replicate the error condition. If you can recreate the error
with a small sequence of steps then please post them. The only way to
recover from the error is to move or delete the broker database directory.

-Emile

On Wednesday, April 3, 2013 10:28:46 AM UTC-6, Jonathan Schwietert wrote:
>
> Thanks for the quick response Emile. I did happen to see that result in my 
> searching but unfortunately our broker is standalone - so there are no 
> other nodes to bring up.
>
> On Wednesday, April 3, 2013 10:28:02 AM UTC-6, Jonathan Schwietert wrote:
>>
>> Pasting in a response i received via email that isn't showing up on this 
>> list, from *Emile Joubert:*
>> Hi,
>>
>> On 02/04/13 23:32, Jonathan Schwietert wrote:
>>
>> Hi, I have a queue which was declared with BOTH durable and exclusive
>>
>> (on accident) whose owner disconnected then reconnected and now
>>
>> receives: "NOT_FOUND - no queue 'test.queue' in vhost '/test.vhost'".
>>
>>
>> See the documentation for the exclusive parameter:
>>
>> http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.exclusive
>>
>> "Exclusive queues may only be accessed by the current connection, and
>> are deleted when that connection closes."
>>
>> So your 'test.queue' should not longer exist. The presence of the string
>> in the internal Mnesia files does not necessarily mean that the queue
>> still exists since the name could appear in internal logs.
>>
>> The scenario you describe can occur if a queue was declared on a node
>> which leaves a cluster. A "Not Found" error will result when attempting
>> to redeclare or delete the queue on any remaining nodes in the cluster.
>> The solution is for the node that left the cluster to rejoin. The use of
>> mirrored queues will prevent this condition.
>>
>>
>> -Emile
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/cc4e9df7/attachment.htm>

From jonathan.schwietert at gmail.com  Thu Apr  4 16:43:45 2013
From: jonathan.schwietert at gmail.com (Jonathan Schwietert)
Date: Thu, 4 Apr 2013 08:43:45 -0700 (PDT)
Subject: [rabbitmq-discuss] Durable + Exclusive queue disappeared
In-Reply-To: <bb7f3ae3-9110-4620-83b7-c4d7f75a286a@googlegroups.com>
References: <e9308733-7b89-4244-81aa-2db184fb9128@googlegroups.com>
	<d82e81ea-d03f-4188-a06a-6f3b2f8fcaaf@googlegroups.com>
	<c24c752c-2ce7-4fad-92d0-5f906abd1c98@googlegroups.com>
	<bb7f3ae3-9110-4620-83b7-c4d7f75a286a@googlegroups.com>
Message-ID: <4a6dddf4-7d32-459c-bcde-ca37ec16c475@googlegroups.com>

Thanks again for the response Emile. We've given up on fixing the problem 
for now & will try, as you've noted, blowing away the DB in order to start 
fresh. After trying to duplicate the issue I can't find any way to 
replicate it. Multiple attempts of restarting the process, restarting the 
consumer in a running process all yield a fully working queue. 

The event which originally triggered this was our shovel had got into a bad 
state so we used a 'shutdown -r now' to simply restart the server which 
evidently failed at the point it was trying to shutdown the broker. At this 
point the broker was hard-rebooted and came back up with the error i posted 
here. If you're interested enough in me trying to replicate this issue 
again i wouldn't mind trying but it does seem like its a rather unique 
case. Our versions are: RabbitMQ *2.8.2* on Erlang *R15B01.*

On Thursday, April 4, 2013 9:11:00 AM UTC-6, Jonathan Schwietert wrote:
>
> Again, pasting in a response i received via email that isn't showing up 
> on this list, from *Emile Joubert:*
> *
> *Hi Jonathan,
>
> On 03/04/13 17:28, Jonathan Schwietert wrote:
>
> Thanks for the quick response Emile. I did happen to see that result in
>
> my searching but unfortunately our broker is standalone - so there are
>
> no other nodes to bring up.
>
>
> If your broker has only ever been standalone then the explanation that
> involves another broker does not apply, though that is the only way I
> know of to replicate the error condition. If you can recreate the error
> with a small sequence of steps then please post them. The only way to
> recover from the error is to move or delete the broker database directory.
>
> -Emile
>
> On Wednesday, April 3, 2013 10:28:46 AM UTC-6, Jonathan Schwietert wrote:
>>
>> Thanks for the quick response Emile. I did happen to see that result in 
>> my searching but unfortunately our broker is standalone - so there are no 
>> other nodes to bring up.
>>
>> On Wednesday, April 3, 2013 10:28:02 AM UTC-6, Jonathan Schwietert wrote:
>>>
>>> Pasting in a response i received via email that isn't showing up on this 
>>> list, from *Emile Joubert:*
>>> Hi,
>>>
>>> On 02/04/13 23:32, Jonathan Schwietert wrote:
>>>
>>> Hi, I have a queue which was declared with BOTH durable and exclusive
>>>
>>> (on accident) whose owner disconnected then reconnected and now
>>>
>>> receives: "NOT_FOUND - no queue 'test.queue' in vhost '/test.vhost'".
>>>
>>>
>>> See the documentation for the exclusive parameter:
>>>
>>> http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.exclusive
>>>
>>> "Exclusive queues may only be accessed by the current connection, and
>>> are deleted when that connection closes."
>>>
>>> So your 'test.queue' should not longer exist. The presence of the string
>>> in the internal Mnesia files does not necessarily mean that the queue
>>> still exists since the name could appear in internal logs.
>>>
>>> The scenario you describe can occur if a queue was declared on a node
>>> which leaves a cluster. A "Not Found" error will result when attempting
>>> to redeclare or delete the queue on any remaining nodes in the cluster.
>>> The solution is for the node that left the cluster to rejoin. The use of
>>> mirrored queues will prevent this condition.
>>>
>>>
>>> -Emile
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/cfec6280/attachment.htm>

From dbgreer at gmail.com  Thu Apr  4 18:56:18 2013
From: dbgreer at gmail.com (Derek Greer)
Date: Thu, 4 Apr 2013 10:56:18 -0700 (PDT)
Subject: [rabbitmq-discuss] TTL
Message-ID: <39aab164-6e51-4409-8b33-069365e35838@googlegroups.com>

I've got several tests which publish a message with a TTL of 1 millisecond 
and then attempt to pull the message off was fail intermittently.  I've 
altered the tests to insert a thread sleep of 1, 3, 5 and finally 10 
seconds before the tests pass 100% of the time.  This seems to be a bug. 
 Are messages checked for expiration periodically, at the point a consumer 
connects and dequeues, both?  It would seem the latter isn't happening.

Derek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/a0f98a03/attachment.htm>

From jerryk at rbcon.com  Thu Apr  4 19:51:50 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Thu, 4 Apr 2013 11:51:50 -0700
Subject: [rabbitmq-discuss] TTL
In-Reply-To: <39aab164-6e51-4409-8b33-069365e35838@googlegroups.com>
References: <39aab164-6e51-4409-8b33-069365e35838@googlegroups.com>
Message-ID: <CAE0Sz=zpe4tb6Sg4x2e6hB2FHWyO2fGBui8pcJ8coqVudh70Ww@mail.gmail.com>

What characterizes a pass or fail for your particular tests?

The behavior you'd expect to see is documented at:
http://www.rabbitmq.com/ttl.html

Note that:

"While consumers never see expired messages, only when expired messages
reach the head of a queue will they actually be discarded (or
dead-lettered). When setting a per-queue TTL this is not a problem, since
expired messages are always at the head of the queue. When setting
per-message TTL however, expired messages can queue up behind non-expired
ones until the latter are consumed or expired. Hence resources used by such
expired messages will not be freed, and they will be counted in queue
statistics (e.g. the number of messages in the queue)."


On Thu, Apr 4, 2013 at 10:56 AM, Derek Greer <dbgreer at gmail.com> wrote:

> I've got several tests which publish a message with a TTL of 1 millisecond
> and then attempt to pull the message off was fail intermittently.  I've
> altered the tests to insert a thread sleep of 1, 3, 5 and finally 10
> seconds before the tests pass 100% of the time.  This seems to be a bug.
>  Are messages checked for expiration periodically, at the point a consumer
> connects and dequeues, both?  It would seem the latter isn't happening.
>
> Derek
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/c084457b/attachment.htm>

From dbgreer at gmail.com  Thu Apr  4 20:33:41 2013
From: dbgreer at gmail.com (Derek Greer)
Date: Thu, 4 Apr 2013 14:33:41 -0500
Subject: [rabbitmq-discuss] TTL
In-Reply-To: <CAE0Sz=zpe4tb6Sg4x2e6hB2FHWyO2fGBui8pcJ8coqVudh70Ww@mail.gmail.com>
References: <39aab164-6e51-4409-8b33-069365e35838@googlegroups.com>
	<CAE0Sz=zpe4tb6Sg4x2e6hB2FHWyO2fGBui8pcJ8coqVudh70Ww@mail.gmail.com>
Message-ID: <CAAzMECnGEur6t=UJRNMNFJ_7+RG0LN_CpWSZ2KebfZ+TR61v4w@mail.gmail.com>

No, I'm seeing my consumer retrieve a message which should have been
expired.


On Thu, Apr 4, 2013 at 1:51 PM, Jerry Kuch <jerryk at rbcon.com> wrote:

> What characterizes a pass or fail for your particular tests?
>
> The behavior you'd expect to see is documented at:
> http://www.rabbitmq.com/ttl.html
>
> Note that:
>
> "While consumers never see expired messages, only when expired messages
> reach the head of a queue will they actually be discarded (or
> dead-lettered). When setting a per-queue TTL this is not a problem, since
> expired messages are always at the head of the queue. When setting
> per-message TTL however, expired messages can queue up behind non-expired
> ones until the latter are consumed or expired. Hence resources used by such
> expired messages will not be freed, and they will be counted in queue
> statistics (e.g. the number of messages in the queue)."
>
>
> On Thu, Apr 4, 2013 at 10:56 AM, Derek Greer <dbgreer at gmail.com> wrote:
>
>> I've got several tests which publish a message with a TTL of 1
>> millisecond and then attempt to pull the message off was
>> fail intermittently.  I've altered the tests to insert a thread sleep of 1,
>> 3, 5 and finally 10 seconds before the tests pass 100% of the time.  This
>> seems to be a bug.  Are messages checked for expiration periodically, at
>> the point a consumer connects and dequeues, both?  It would seem the latter
>> isn't happening.
>>
>> Derek
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
___________________________________________
Derek Greer
dbgreer at gmail.com     | @derekgreer <http://twitter.com/derekgreer>
lostechies.com <http://derekgreer.lostechies.com/> |
freshbrewedcode.com<http://derekgreer.freshbrewedcode.com>
 | aspiringcraftsman.com
___________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/3b0dc550/attachment.htm>

From michael.s.klishin at gmail.com  Thu Apr  4 20:48:42 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 4 Apr 2013 23:48:42 +0400
Subject: [rabbitmq-discuss] TTL
In-Reply-To: <CAAzMECnGEur6t=UJRNMNFJ_7+RG0LN_CpWSZ2KebfZ+TR61v4w@mail.gmail.com>
References: <39aab164-6e51-4409-8b33-069365e35838@googlegroups.com>
	<CAE0Sz=zpe4tb6Sg4x2e6hB2FHWyO2fGBui8pcJ8coqVudh70Ww@mail.gmail.com>
	<CAAzMECnGEur6t=UJRNMNFJ_7+RG0LN_CpWSZ2KebfZ+TR61v4w@mail.gmail.com>
Message-ID: <CAE3HoVS+gk3ho+7L02kUzz1UeH2Ca0z3JmybWhmSfksn9GDU6w@mail.gmail.com>

2013/4/4 Derek Greer <dbgreer at gmail.com>

> No, I'm seeing my consumer retrieve a message which should have been
> expired.


Derek,

Can you post a code example that reproduces the problem?

Thanks.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/dc7aea67/attachment.htm>

From dbgreer at gmail.com  Thu Apr  4 21:10:41 2013
From: dbgreer at gmail.com (Derek Greer)
Date: Thu, 4 Apr 2013 15:10:41 -0500
Subject: [rabbitmq-discuss] TTL
In-Reply-To: <CAE3HoVS+gk3ho+7L02kUzz1UeH2Ca0z3JmybWhmSfksn9GDU6w@mail.gmail.com>
References: <39aab164-6e51-4409-8b33-069365e35838@googlegroups.com>
	<CAE0Sz=zpe4tb6Sg4x2e6hB2FHWyO2fGBui8pcJ8coqVudh70Ww@mail.gmail.com>
	<CAAzMECnGEur6t=UJRNMNFJ_7+RG0LN_CpWSZ2KebfZ+TR61v4w@mail.gmail.com>
	<CAE3HoVS+gk3ho+7L02kUzz1UeH2Ca0z3JmybWhmSfksn9GDU6w@mail.gmail.com>
Message-ID: <CAAzMECn4Z03Li-USK1KT7OHv6h3KRT=EWwuAzT3W404kzA49GQ@mail.gmail.com>

Perhaps an important note, I'm using the pull API which I'm remembering
doesn't create a "consumer".

I'll pull together a small example and post it here.


On Thu, Apr 4, 2013 at 2:48 PM, Michael Klishin <michael.s.klishin at gmail.com
> wrote:

> 2013/4/4 Derek Greer <dbgreer at gmail.com>
>
>> No, I'm seeing my consumer retrieve a message which should have been
>> expired.
>
>
> Derek,
>
> Can you post a code example that reproduces the problem?
>
> Thanks.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
___________________________________________
Derek Greer
dbgreer at gmail.com     | @derekgreer <http://twitter.com/derekgreer>
lostechies.com <http://derekgreer.lostechies.com/> |
freshbrewedcode.com<http://derekgreer.freshbrewedcode.com>
 | aspiringcraftsman.com
___________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/f5e4805c/attachment.htm>

From dbgreer at gmail.com  Thu Apr  4 21:35:16 2013
From: dbgreer at gmail.com (Derek Greer)
Date: Thu, 4 Apr 2013 15:35:16 -0500
Subject: [rabbitmq-discuss] TTL
In-Reply-To: <CAAzMECn4Z03Li-USK1KT7OHv6h3KRT=EWwuAzT3W404kzA49GQ@mail.gmail.com>
References: <39aab164-6e51-4409-8b33-069365e35838@googlegroups.com>
	<CAE0Sz=zpe4tb6Sg4x2e6hB2FHWyO2fGBui8pcJ8coqVudh70Ww@mail.gmail.com>
	<CAAzMECnGEur6t=UJRNMNFJ_7+RG0LN_CpWSZ2KebfZ+TR61v4w@mail.gmail.com>
	<CAE3HoVS+gk3ho+7L02kUzz1UeH2Ca0z3JmybWhmSfksn9GDU6w@mail.gmail.com>
	<CAAzMECn4Z03Li-USK1KT7OHv6h3KRT=EWwuAzT3W404kzA49GQ@mail.gmail.com>
Message-ID: <CAAzMEC=Z9irPK6C9emqRz+MZjT3_EJKzHcK_CcjQdFGdWTBWHg@mail.gmail.com>

A note of clarification, I was using values of 1, 3, 5, 10 milliseconds,
not seconds, to give the server enough time to expire a 1 millisecond TTL
on a message.  I discovered 10 milliseconds still wasn't always successful.
 Regardless, I would expect to only have to sleep for 1 millisecond to give
the sever enough time to remove a 1 millisecond TTL message.  Here's my
example using the .Net API in which I'm seeing about a 3% failure rate:


using System;
using System.Text;
using System.Threading;
using RabbitMQ.Client;
using RabbitMQ.Client.Framing.v0_9_1;

namespace RabbitTTLTest
{
class Program
{
static void Main(string[] args)
{
var messages = 0;
var iterations = 1000;

for (int i = 0; i < iterations; i++)
messages += SendAndReceive();

Console.WriteLine("Received {0} messages", messages);
Console.WriteLine("API works {0}% of the time.", ((iterations - messages) /
(decimal)iterations) * 100);
Console.WriteLine("Press any key to exit");
Console.ReadKey();
}

static int SendAndReceive()
{
ProduceMessage();
Thread.Sleep(10);
return ConsumeMessage();
}

static int ConsumeMessage()
{
int messages = 0;
var connectionFactory = new ConnectionFactory();
IConnection connection = connectionFactory.CreateConnection();
IModel channel = connection.CreateModel();
channel.QueueDeclare("sample-queue", false, false, false, null);
BasicGetResult result = channel.BasicGet("sample-queue", true);
if (result != null)
{
messages++;
string message = Encoding.UTF8.GetString(result.Body);
Console.WriteLine(message);
}
channel.Close();
connection.Close();
return messages;
}

static void ProduceMessage()
{
var connectionFactory = new ConnectionFactory();
IConnection connection = connectionFactory.CreateConnection();
IModel channel = connection.CreateModel();
channel.QueueDeclare("sample-queue", false, false, false, null);
byte[] message = Encoding.UTF8.GetBytes("Hello, World!");
var properties = new BasicProperties();
properties.Expiration = "1";
channel.BasicPublish(string.Empty, "sample-queue", properties, message);
channel.Close();
connection.Close();
}
}
}


On Thu, Apr 4, 2013 at 3:10 PM, Derek Greer <dbgreer at gmail.com> wrote:

> Perhaps an important note, I'm using the pull API which I'm remembering
> doesn't create a "consumer".
>
> I'll pull together a small example and post it here.
>
>
> On Thu, Apr 4, 2013 at 2:48 PM, Michael Klishin <
> michael.s.klishin at gmail.com> wrote:
>
>> 2013/4/4 Derek Greer <dbgreer at gmail.com>
>>
>>> No, I'm seeing my consumer retrieve a message which should have been
>>> expired.
>>
>>
>> Derek,
>>
>> Can you post a code example that reproduces the problem?
>>
>> Thanks.
>> --
>> MK
>>
>> http://github.com/michaelklishin
>> http://twitter.com/michaelklishin
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> --
> ___________________________________________
> Derek Greer
> dbgreer at gmail.com     | @derekgreer <http://twitter.com/derekgreer>
> lostechies.com <http://derekgreer.lostechies.com/> | freshbrewedcode.com<http://derekgreer.freshbrewedcode.com>
>  | aspiringcraftsman.com
> ___________________________________________
>
>


-- 
___________________________________________
Derek Greer
dbgreer at gmail.com     | @derekgreer <http://twitter.com/derekgreer>
lostechies.com <http://derekgreer.lostechies.com/> |
freshbrewedcode.com<http://derekgreer.freshbrewedcode.com>
 | aspiringcraftsman.com
___________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/b64355c5/attachment.htm>

From christopher.carver at gmail.com  Thu Apr  4 16:33:59 2013
From: christopher.carver at gmail.com (Christopher Carver)
Date: Thu, 4 Apr 2013 08:33:59 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Windows 8 client incompatibility
Message-ID: <51aeebf6-36bd-4088-8816-83d6d3dee8e7@googlegroups.com>

This is a stab in the dark in finding a solution. I am currently using a 
consulting service to create a Windows 8 Live Tile application that will 
act as a RabbitMQ consumer retrieving messages from a RabbitMQ broker. 
However I got an odd response from the engineers of the consulting services.

He said:

The difficult is to convert the RabbitMQ .net client. it does not support 
.NetCore directly. NetCore is for the windows store app (which supports the 
mobile devices like Windows RT). The tiles feature is part of windows store 
app. in .net 4.5, the original .net becomes .NetCore and .NetFramework (see 
http://social.msdn.microsoft.com/Forums/en-US/winappswithcsharp/thread/aecf4846-6eca-444a-beb7-d4ba9d6ad754
)

I want to believe the engineer, but I'm taken a back that a .net driver for 
RabbitMQ is not usable within a Windows 8 application. Is the engineer 
telling the truth? 

I will posting this on a Windows 8 development forum too. But I still 
wanted to cover my basis from both sides of the aisle. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/536fa337/attachment.htm>

From jonatan.andres at gmail.com  Thu Apr  4 18:17:30 2013
From: jonatan.andres at gmail.com (Jonatan Andres)
Date: Thu, 4 Apr 2013 10:17:30 -0700 (PDT)
Subject: [rabbitmq-discuss] SSL
Message-ID: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>

Hello,
I'm trying to set up a RabbitMQ server with SSL authentication (in 
Windows). 
The service starts correctly, and I get to set the AMQP connection *(Connection 
conn = factory.newConnection ();),* 
but when I try to create the channel *(Channel channel = conn.createChannel 
();)* I get the following error:

= ERROR REPORT ==== 4-Apr-2013 :: 19:01:09 ===
AMQP closing connection <0.407.0> (127.0.0.1:52063 -> 127.0.0.1:5671):
{handshake_error, opening, 0,
                  {error, badarg, 'connection.open'
                         [{io_lib, format,
                                  ["\ \ ~ 2.16.0B"
                                   [[60.60,
                                     ["19", 44, "8", 44 "68" 44 "83" 44 
"73" 44,
                                      "83", 44 "79" 44 "70" 44 "84" 44 
"49"],
                                     62.62]]],
                                  [{file, "io_lib.erl"}, {line, 152}]},
                          {rabbit_misc, format, 2, []},
                          {rabbit_ssl, escape_rdn_value, 2, []},
                          {rabbit_ssl, format_rdn, 1, []},
                          {rabbit_ssl, '0/1-0- -format_complex_rdn/1-lc $ 
^', 1, []},
                          {rabbit_ssl, format_complex_rdn, 1, []},
                          {rabbit_ssl, '0/1-0- -format_rdn_sequence/1-lc $ 
^', 1, []},
                          {rabbit_ssl, '0/1-0- -format_rdn_sequence/1-lc $ 
^', 1,
                                      []}]}}
 
 
And in my client app i get this:
 

*AMQP Connection 127.0.0.1:5671, called closeSocket(selfInitiated)*
* **

java.io.IOException

*

I've done all the tests described in 
http://www.rabbitmq.com/troubleshooting-ssl.html, and all are correct.
Can anybody help?
Thank you very much.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/378b9760/attachment.htm>

From will.e.daly at gmail.com  Fri Apr  5 03:51:52 2013
From: will.e.daly at gmail.com (William Daly)
Date: Thu, 4 Apr 2013 19:51:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika IncompatibleProtocolError
Message-ID: <2e9530e4-f5bc-4787-9bd0-07f2d3fc9ef7@googlegroups.com>

Hi,

I'm trying to use rabbitmq and pika on localhost for testing purposes, and 
I am receiving an IncompatibleProtocolError.

Here are the steps I'm following:

1) I start up rabbitmq-server, and when I run rabbitmqctl status I get:
Status of node rabbit at localhost ...
[{pid,390},
 {running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","3.0.4"},
      {rabbitmq_management,"RabbitMQ Management Console","3.0.4"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.4"},
      {rabbit,"RabbitMQ","3.0.4"},
      {os_mon,"CPO  CXC 138 46","2.2.10"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.0.4"},
      {webmachine,"webmachine","1.9.1-rmq3.0.4-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.4-gitd541e9a"},
      {xmerl,"XML parser","1.3.2"},
      {inets,"INETS  CXC 138 49","5.9.2"},
      {mnesia,"MNESIA  CXC 138 12","4.7.1"},
      {amqp_client,"RabbitMQ AMQP Client","3.0.4"},
      {sasl,"SASL  CXC 138 11","2.2.1"},
      {stdlib,"ERTS  CXC 138 10","1.18.3"},
      {kernel,"ERTS  CXC 138 10","2.15.3"}]},
 {os,{unix,darwin}},
 {erlang_version,
     "Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:8:8] 
[async-threads:30] [hipe] [kernel-poll:true] [dtrace]\n"},
 {memory,
     [{total,35653280},
      {connection_procs,5696},
      {queue_procs,27576},
      {plugins,152984},
      {other_proc,9868108},
      {mnesia,62360},
      {mgmt_db,47384},
      {msg_index,22960},
      {other_ets,1239568},
      {binary,522528},
      {code,18264216},
      {atom,695185},
      {other_system,4744715}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,6523774566},
 {disk_free_limit,1000000000},
 {disk_free,199230787584},
 {file_descriptors,
    
 [{total_limit,156},{total_used,4},{sockets_limit,138},{sockets_used,1}]},
 {processes,[{limit,1048576},{used,196}]},
 {run_queue,0},
 {uptime,2667}]
...done.

2) I run the following code (RABBITMQ_USER='guest', RABBITMQ_PASS='guest', 
RABBIT_HOST='localhost')

credentials = pika.PlainCredentials(settings.RABBITMQ_USER,             
                                            settings.RABBITMQ_PASS)         
    
                                                                            
                                   
parameters = pika.ConnectionParameters(heartbeat_interval=5,            
                                               credentials=credentials,     
    
                                               host=settings.RABBIT_HOST)   
    
                                                                            
                                   
self.channel = None                                                         
                           
self.connection = pika.SelectConnection(parameters, self.on_connected)

# ....

self.connection.ioloop.start()

3) I get the following traceback:

Traceback (most recent call last):
  File 
"/usr/local/Cellar/python/2.7.3/Frameworks/Python.framework/Versions/2.7/lib/python2.7/multiprocessing/process.py", 
line 258, in _bootstrap
    self.run()
  File "/Users/will/queue/consumer.py", line 237, in run
    self.connection.ioloop.start()
  File 
"/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/select_connection.py", 
line 108, in start
    self.poller.start()
  File 
"/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/select_connection.py", 
line 336, in start
    self.poll()
  File 
"/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/select_connection.py", 
line 351, in poll
    return self._handler(self.fileno, ERROR, error)
  File 
"/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py", 
line 315, in _handle_events
    self._handle_error(error)
  File 
"/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py", 
line 291, in _handle_error
    self._handle_disconnect()
  File 
"/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py", 
line 240, in _handle_disconnect
    self._adapter_disconnect()
  File 
"/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py", 
line 131, in _adapter_disconnect
    self._check_state_on_disconnect()
  File 
"/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py", 
line 143, in _check_state_on_disconnect
    raise exceptions.IncompatibleProtocolError
IncompatibleProtocolError

Any idea what could be causing this?  I'm running Mac OS X Mountain Lion. 
 Any help would be greatly appreciated.

Thanks!
-- Will
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130404/de22634f/attachment.htm>

From tim at rabbitmq.com  Fri Apr  5 09:03:30 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 5 Apr 2013 09:03:30 +0100
Subject: [rabbitmq-discuss] RabbitMQ Windows 8 client incompatibility
In-Reply-To: <51aeebf6-36bd-4088-8816-83d6d3dee8e7@googlegroups.com>
References: <51aeebf6-36bd-4088-8816-83d6d3dee8e7@googlegroups.com>
Message-ID: <A1A6A505-E9C6-4791-BB6A-FD064455E5FC@rabbitmq.com>

Hi Christopher,

On 4 Apr 2013, at 16:33, Christopher Carver wrote:

> This is a stab in the dark in finding a solution. I am currently using a consulting service to create a Windows 8 Live Tile application that will act as a RabbitMQ consumer retrieving messages from a RabbitMQ broker. However I got an odd response from the engineers of the consulting services.
> 
> He said:
> 
> The difficult is to convert the RabbitMQ .net client. it does not support .NetCore directly. NetCore is for the windows store app (which supports the mobile devices like Windows RT). The tiles feature is part of windows store app. in .net 4.5, the original .net becomes .NetCore and .NetFramework (see http://social.msdn.microsoft.com/Forums/en-US/winappswithcsharp/thread/aecf4846-6eca-444a-beb7-d4ba9d6ad754)
> 
> I want to believe the engineer, but I'm taken a back that a .net driver for RabbitMQ is not usable within a Windows 8 application. Is the engineer telling the truth? 
> 

The issue is that the .NET client is compiled against the full version of the .NET Framework class library (and runtime) and that isn't compatible with Metro applications (according to the thread you've posted). The .NETCore identifier is used for the new .NET framework for Windows Store applications. Windows Store is different from the desktop .NET 4.5 framework, which was released at the same time. In order to include a .NET assembly as a reference in your project, it has to target the same framework/assembly for binary compatibility. In order words *all assemblies in the project need to target the same framework* - and the RabbitMQ .NET client is built (and published on our website and via NuGet) against the desktop version of the framework.  

In theory, it might be possible to recompile the .NET client against .NetCore instead, although I'm not sure if our MSBuild configuration will support doing that without modification. It may be easier to try opening up the .NET client library in Visual Studio and recompiling with the correct "Client Profile" set up.

You should be aware however, that there's no guarantee that compiling the RabbitMQ client against another framework runtime/class-library will work either. It is possible that the RabbitMQ .NET client uses APIs that only exist in the desktop version of the framework, however I cannot confirm this and you'll have to get your engineers to try it and see.

If that approach doesn't work, another solution that you might consider is hosting a web service that uses the RabbitMQ .NET framework WCF bindings to expose RabbitMQ as a WFC service, and then consume that via the regular WCF bindings, which I assume are included in .NETCore (although I haven't checked).  
> I will posting this on a Windows 8 development forum too. But I still wanted to cover my basis from both sides of the aisle. 
> 
Please confirm what I've said above with the guys on that forum, and if it's accurate please get them to point us to any documentation covering incompatibilities between the various different 'flavours' of .NET. I'd be interested in seeing that, as supporting as many of these as possible would make sense for us, as long as it doesn't require totally rewriting the client! :)

Kind regards,

Tim Watson
Staff Engineer
RabbitMQ (SpringSource/VMWare)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130405/2924c7b5/attachment.htm>

From emile at rabbitmq.com  Fri Apr  5 10:19:32 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 05 Apr 2013 10:19:32 +0100
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
Message-ID: <515E9724.1050301@rabbitmq.com>


Hi,

On 04/04/13 18:17, Jonatan Andres wrote:
> {rabbit_ssl, escape_rdn_value, 2, []},

Some details in a certificate are parsed incorrectly. Could you send a
copy of the certificate to support at rabbitmq.com (if that does not pose a
security risk)?

The error message refers to an nested string "<<DSISOFT1>>". Is there
any reason why this string would be encoded differently?





-Emile








From jandres at omie.es  Fri Apr  5 10:38:11 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Fri, 5 Apr 2013 09:38:11 +0000
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <515E9724.1050301@rabbitmq.com>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>

Thank you very much!

DSISOF1 is the UID of the certificate (stored in a file. P12). I can not send it because it is a certificate used in our company (although it is only a test certificate). 
The certificate is used to create connections correctly HTTPS or sign documents, so I think that in principle is correct.
The SSL connection without client certificate is correct.

This is the code I use to connect:

	char [] keyPassphrase = "1234". ToCharArray ();
	KeyStore ks = KeyStore.getInstance ("PKCS12");
	ks.load (new FileInputStream ("C :/DSISOFT1.p12"), keyPassphrase);

	KeyManagerFactory kmf = KeyManagerFactory.getInstance ("SunX509");
	kmf.init (ks, keyPassphrase);

	Tks = KeyStore.getInstance KeyStore ("JKS");
	tks.load (new FileInputStream ("C :/truststore.jks"), "password". ToCharArray ());

	TrustManagerFactory tmf = TrustManagerFactory.getInstance ("SunX509");
	tmf.init (tks);

	/ / SSLContext
	SSLContext c = SSLContext.getInstance ("SSLv3");
	c.init (kmf.getKeyManagers (), tmf.getTrustManagers (), null);

	/ / CONNECTION AMQP
	ConnectionFactory factory = new ConnectionFactory ();
	factory.setHost ("localhost");
	factory.setPort (5671);
	factory.useSslProtocol (c);

	conn = factory.newConnection ();		// - It seems OK?
	channel = conn.createChannel();		// The exception is here


Can you think of anything else I can look?
Thank you very much again!





-----Mensaje original-----
De: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] En nombre de Emile Joubert
Enviado el: viernes, 05 de abril de 2013 11:20
Para: Discussions about RabbitMQ
CC: Jonatan Andres
Asunto: Re: [rabbitmq-discuss] SSL


Hi,

On 04/04/13 18:17, Jonatan Andres wrote:
> {rabbit_ssl, escape_rdn_value, 2, []},

Some details in a certificate are parsed incorrectly. Could you send a copy of the certificate to support at rabbitmq.com (if that does not pose a security risk)?

The error message refers to an nested string "<<DSISOFT1>>". Is there any reason why this string would be encoded differently?





-Emile







_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Fri Apr  5 11:50:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 05 Apr 2013 11:50:31 +0100
Subject: [rabbitmq-discuss] Pika IncompatibleProtocolError
In-Reply-To: <2e9530e4-f5bc-4787-9bd0-07f2d3fc9ef7@googlegroups.com>
References: <2e9530e4-f5bc-4787-9bd0-07f2d3fc9ef7@googlegroups.com>
Message-ID: <515EAC77.3060304@rabbitmq.com>

Hmm. I'm no Pika expert but that seems wrong. Is there anything 
interesting-looking in the server logs at that point?

Cheers, Simon

On 05/04/13 03:51, William Daly wrote:
> Hi,
>
> I'm trying to use rabbitmq and pika on localhost for testing purposes,
> and I am receiving an IncompatibleProtocolError.
>
> Here are the steps I'm following:
>
> 1) I start up rabbitmq-server, and when I run rabbitmqctl status I get:
> Status of node rabbit at localhost ...
> [{pid,390},
>   {running_applications,
>       [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","3.0.4"},
>        {rabbitmq_management,"RabbitMQ Management Console","3.0.4"},
>        {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.4"},
>        {rabbit,"RabbitMQ","3.0.4"},
>        {os_mon,"CPO  CXC 138 46","2.2.10"},
>        {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.0.4"},
>        {webmachine,"webmachine","1.9.1-rmq3.0.4-git52e62bc"},
>        {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.4-gitd541e9a"},
>        {xmerl,"XML parser","1.3.2"},
>        {inets,"INETS  CXC 138 49","5.9.2"},
>        {mnesia,"MNESIA  CXC 138 12","4.7.1"},
>        {amqp_client,"RabbitMQ AMQP Client","3.0.4"},
>        {sasl,"SASL  CXC 138 11","2.2.1"},
>        {stdlib,"ERTS  CXC 138 10","1.18.3"},
>        {kernel,"ERTS  CXC 138 10","2.15.3"}]},
>   {os,{unix,darwin}},
>   {erlang_version,
>       "Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:8:8]
> [async-threads:30] [hipe] [kernel-poll:true] [dtrace]\n"},
>   {memory,
>       [{total,35653280},
>        {connection_procs,5696},
>        {queue_procs,27576},
>        {plugins,152984},
>        {other_proc,9868108},
>        {mnesia,62360},
>        {mgmt_db,47384},
>        {msg_index,22960},
>        {other_ets,1239568},
>        {binary,522528},
>        {code,18264216},
>        {atom,695185},
>        {other_system,4744715}]},
>   {vm_memory_high_watermark,0.4},
>   {vm_memory_limit,6523774566},
>   {disk_free_limit,1000000000},
>   {disk_free,199230787584},
>   {file_descriptors,
>
>   [{total_limit,156},{total_used,4},{sockets_limit,138},{sockets_used,1}]},
>   {processes,[{limit,1048576},{used,196}]},
>   {run_queue,0},
>   {uptime,2667}]
> ...done.
>
> 2) I run the following code (RABBITMQ_USER='guest',
> RABBITMQ_PASS='guest', RABBIT_HOST='localhost')
>
> credentials = pika.PlainCredentials(settings.RABBITMQ_USER,
>                                              settings.RABBITMQ_PASS)
> parameters = pika.ConnectionParameters(heartbeat_interval=5,
>                                                 credentials=credentials,
>                                                 host=settings.RABBIT_HOST)
> self.channel = None
> self.connection = pika.SelectConnection(parameters, self.on_connected)
>
> # ....
>
> self.connection.ioloop.start()
>
> 3) I get the following traceback:
>
> Traceback (most recent call last):
>    File
> "/usr/local/Cellar/python/2.7.3/Frameworks/Python.framework/Versions/2.7/lib/python2.7/multiprocessing/process.py",
> line 258, in _bootstrap
>      self.run()
>    File "/Users/will/queue/consumer.py", line 237, in run
>      self.connection.ioloop.start()
>    File
> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/select_connection.py",
> line 108, in start
>      self.poller.start()
>    File
> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/select_connection.py",
> line 336, in start
>      self.poll()
>    File
> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/select_connection.py",
> line 351, in poll
>      return self._handler(self.fileno, ERROR, error)
>    File
> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py",
> line 315, in _handle_events
>      self._handle_error(error)
>    File
> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py",
> line 291, in _handle_error
>      self._handle_disconnect()
>    File
> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py",
> line 240, in _handle_disconnect
>      self._adapter_disconnect()
>    File
> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py",
> line 131, in _adapter_disconnect
>      self._check_state_on_disconnect()
>    File
> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py",
> line 143, in _check_state_on_disconnect
>      raise exceptions.IncompatibleProtocolError
> IncompatibleProtocolError
>
> Any idea what could be causing this?  I'm running Mac OS X Mountain
> Lion.  Any help would be greatly appreciated.
>
> Thanks!
> -- Will
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Apr  5 11:57:18 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 05 Apr 2013 11:57:18 +0100
Subject: [rabbitmq-discuss] Export Causes Server To Crash
In-Reply-To: <6d670ac2-0a4f-4495-9498-0937a2059406@googlegroups.com>
References: <6d670ac2-0a4f-4495-9498-0937a2059406@googlegroups.com>
Message-ID: <515EAE0E.3020304@rabbitmq.com>

On 02/04/13 06:55, Sean Shannon wrote:
> {error,{case_clause,{{[],false},2}},
>         [{base64,strip_illegal,3},
>          {base64,mime_decode_l,1},
>          {rabbit_mochiweb_util,parse_auth_header,1},
>          {rabbit_mgmt_util,is_authorized,3},
>          {webmachine_resource,resource_call,3},
>          {webmachine_resource,do,3},
>          {webmachine_decision_core,resource_call,1},
>          {webmachine_decision_core,decision,1}]}

Hmm. That looks like the HTTP basic auth is not valid base64.

I would expect you should be able to fix this by either closing and 
reopening your browser (if using RabbitMQ 2.x) or by logging out and 
then in again (if using 3.x).

After you've done that, can you tell me if you're using 2.x or 3.x? 
Since the origin of the HTTP basic auth is quite different in the two cases.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Fri Apr  5 12:04:49 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 05 Apr 2013 12:04:49 +0100
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
Message-ID: <515EAFD1.2040201@rabbitmq.com>

On 05/04/13 10:38, SAG - Jonathan Andr?s wrote:
> I can not send it because it is a certificate used in our company

Can you provide an ASN.1 dump of the part of the certificate containing
the problematic string? Running this on the DER version of the
certificate should show enough useful information to debug:

http://www.cs.auckland.ac.nz/~pgut001/dumpasn1.c



-Emile



From simon at rabbitmq.com  Fri Apr  5 12:11:36 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 05 Apr 2013 12:11:36 +0100
Subject: [rabbitmq-discuss] Cluster reverted to old config!
In-Reply-To: <CAEWH9M--OPwMCO36B3orXOJdtD9QWkb5wNq7MniycL58R5maXw@mail.gmail.com>
References: <CAEWH9M--OPwMCO36B3orXOJdtD9QWkb5wNq7MniycL58R5maXw@mail.gmail.com>
Message-ID: <515EB168.8010006@rabbitmq.com>

On 04/04/13 13:06, Pete Kelly wrote:
> Any advice or thoughts would be appreciated, if only to help prevent
> this from happening in the future!

To add to what Emile already said: RabbitMQ prior to 2.8.0 did not force 
an fsync on declare / delete operations for durable objects, so it was 
possible for such operations to get (effectively) rolled back after a 
crash. I don't know how long you can manage to go without an fsync 
though - I would expect you'd struggle to get to an hour and it sounds 
like your definitions were much older than that.

However, an upgrade is, as usual, recommended :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Apr  5 12:12:27 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 05 Apr 2013 12:12:27 +0100
Subject: [rabbitmq-discuss] Cluster reverted to old config!
In-Reply-To: <515D8909.5020803@rabbitmq.com>
References: <CAEWH9M--OPwMCO36B3orXOJdtD9QWkb5wNq7MniycL58R5maXw@mail.gmail.com>
	<515D8909.5020803@rabbitmq.com>
Message-ID: <515EB19B.3030508@rabbitmq.com>

On 04/04/13 15:07, Emile Joubert wrote:
> If the management plugin was configured to load an out-of-date
> definition at startup (available on brokers since v2.8.0) then it could
> appear like a reversion.

However, those definitions *merge* with what's already in the database, 
they don't overwrite it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Marek.Cermak at Honeywell.com  Fri Apr  5 13:07:10 2013
From: Marek.Cermak at Honeywell.com (Cermak, Marek)
Date: Fri, 5 Apr 2013 12:07:10 +0000
Subject: [rabbitmq-discuss] Ingress does not work for me and the RMQ goes
	down
Message-ID: <F1A539826FC33E4CA602BB52E5C4502222B6F50C@FR44EX3004.global.ds.honeywell.com>

Hello everybody,
I continue with stress testing on limited memory. This time I have problem with RMQ going down without any warning after consuming a lot of memory.

Producer asks for ingress on the channel
amqp_channel:register_flow_handler(Channel, self()),

and then it uses the channel for publishing messages. I.e. every 20 secs 4 messages of 16 MB each to 2 different exchanges. After some time the consumer starts to consume them (using one channel and prefetch of 4 msgs). Consumer is too slow to consume faster than messages are produced. The broker warns once on the console and then it is killed:

13:48:24.429 [warning] Undefined: memory resource limit alarm set on node hare at xxx
Killed

shouldn't the producer be warned instead?

thanks
marek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130405/45874082/attachment.htm>

From simon at rabbitmq.com  Fri Apr  5 13:16:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 05 Apr 2013 13:16:01 +0100
Subject: [rabbitmq-discuss] Ingress does not work for me and the RMQ
 goes down
In-Reply-To: <F1A539826FC33E4CA602BB52E5C4502222B6F50C@FR44EX3004.global.ds.honeywell.com>
References: <F1A539826FC33E4CA602BB52E5C4502222B6F50C@FR44EX3004.global.ds.honeywell.com>
Message-ID: <515EC081.4000304@rabbitmq.com>

Hi. amqp_channel:register_flow_handler/2 allows the client to know about 
channel.flow methods sent by the server. But in practice we haven't sent 
channel.flow for a long, long time (it doesn't really work very well).

Instead we block the network socket. This works more immediately... 
assuming we are receiving messages over the network. However, if you are 
using the Erlang client in direct mode that won't happen - is that what 
you're doing?

Cheers, Simon

On 05/04/13 13:07, Cermak, Marek wrote:
> Hello everybody,
>
> I continue with stress testing on limited memory. This time I have
> problem with RMQ going down without any warning after consuming a lot of
> memory.
>
> Producer asks for ingress on the channel
>
> amqp_channel:register_flow_handler(Channel, self()),
>
> and then it uses the channel for publishing messages. I.e. every 20 secs
> 4 messages of 16 MB each to 2 different exchanges. After some time the
> consumer starts to consume them (using one channel and prefetch of 4
> msgs). Consumer is too slow to consume faster than messages are
> produced. The broker warns once on the console and then it is killed:
>
> 13:48:24.429 [warning] Undefined: memory resource limit alarm set on
> node hare at xxx
>
> Killed
>
> shouldn't the producer be warned instead?
>
> thanks
>
> marek
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From Marek.Cermak at Honeywell.com  Fri Apr  5 13:18:18 2013
From: Marek.Cermak at Honeywell.com (Cermak, Marek)
Date: Fri, 5 Apr 2013 12:18:18 +0000
Subject: [rabbitmq-discuss] Ingress does not work for me and the RMQ
 goes down
In-Reply-To: <515EC081.4000304@rabbitmq.com>
References: <F1A539826FC33E4CA602BB52E5C4502222B6F50C@FR44EX3004.global.ds.honeywell.com>
	<515EC081.4000304@rabbitmq.com>
Message-ID: <F1A539826FC33E4CA602BB52E5C4502222B6F53C@FR44EX3004.global.ds.honeywell.com>

Hi Simon,
yes, I use direct for both consumer and publisher. They run in one node, RMQ is in another.

Marek

> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: 05 April, 2013 14:16
> To: Discussions about RabbitMQ
> Cc: Cermak, Marek
> Subject: Re: [rabbitmq-discuss] Ingress does not work for me and the RMQ goes
> down
> 
> Hi. amqp_channel:register_flow_handler/2 allows the client to know about
> channel.flow methods sent by the server. But in practice we haven't sent
> channel.flow for a long, long time (it doesn't really work very well).
> 
> Instead we block the network socket. This works more immediately...
> assuming we are receiving messages over the network. However, if you are
> using the Erlang client in direct mode that won't happen - is that what
> you're doing?
> 
> Cheers, Simon
> 
> On 05/04/13 13:07, Cermak, Marek wrote:
> > Hello everybody,
> >
> > I continue with stress testing on limited memory. This time I have
> > problem with RMQ going down without any warning after consuming a lot
> > of memory.
> >
> > Producer asks for ingress on the channel
> >
> > amqp_channel:register_flow_handler(Channel, self()),
> >
> > and then it uses the channel for publishing messages. I.e. every 20
> > secs
> > 4 messages of 16 MB each to 2 different exchanges. After some time the
> > consumer starts to consume them (using one channel and prefetch of 4
> > msgs). Consumer is too slow to consume faster than messages are
> > produced. The broker warns once on the console and then it is killed:
> >
> > 13:48:24.429 [warning] Undefined: memory resource limit alarm set on
> > node hare at xxx
> >
> > Killed
> >
> > shouldn't the producer be warned instead?
> >
> > thanks
> >
> > marek
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> 
> 
> --
> Simon MacMullen
> RabbitMQ, VMware

From tim at rabbitmq.com  Fri Apr  5 13:23:06 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 5 Apr 2013 13:23:06 +0100
Subject: [rabbitmq-discuss] Ingress does not work for me and the RMQ
	goes down
In-Reply-To: <F1A539826FC33E4CA602BB52E5C4502222B6F50C@FR44EX3004.global.ds.honeywell.com>
References: <F1A539826FC33E4CA602BB52E5C4502222B6F50C@FR44EX3004.global.ds.honeywell.com>
Message-ID: <B2E7B16C-C8FE-45FD-8F98-FC9747E8740A@rabbitmq.com>


On 5 Apr 2013, at 13:07, Cermak, Marek wrote:
> Hello everybody,
> I continue with stress testing on limited memory. This time I have problem with RMQ going down without any warning after consuming a lot of memory.
>  
> Producer asks for ingress on the channel
> amqp_channel:register_flow_handler(Channel, self()),

The process represented by 'self()' in that call should receive `#channel.flow{}` messages yes.

> The broker warns once on the console and then it is killed:
>  
> 13:48:24.429 [warning] Undefined: memory resource limit alarm set on node hare at xxx
> Killed
>  
> shouldn't the producer be warned instead?

The producer should get throttled as well as receiving a flow notification - rabbit stops reading from the socket, at which point TCP back-pressure is exerted. Who does the killing here, i.e., where does that 'Killed' come from? Are you saying that rabbit crashes (with OOM for example) before the producer gets the flow notification?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130405/ef75b87e/attachment.htm>

From tim at rabbitmq.com  Fri Apr  5 13:24:15 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 5 Apr 2013 13:24:15 +0100
Subject: [rabbitmq-discuss] Ingress does not work for me and the RMQ
	goes down
In-Reply-To: <B2E7B16C-C8FE-45FD-8F98-FC9747E8740A@rabbitmq.com>
References: <F1A539826FC33E4CA602BB52E5C4502222B6F50C@FR44EX3004.global.ds.honeywell.com>
	<B2E7B16C-C8FE-45FD-8F98-FC9747E8740A@rabbitmq.com>
Message-ID: <F5A56C0A-3D41-4E31-983C-450C368D4353@rabbitmq.com>

Sorry guys - just ignore me - I didn't notice that Simon had already answered (and was more on the money about the issue to boot)....

On 5 Apr 2013, at 13:23, Tim Watson wrote:

> 
> On 5 Apr 2013, at 13:07, Cermak, Marek wrote:
>> Hello everybody,
>> I continue with stress testing on limited memory. This time I have problem with RMQ going down without any warning after consuming a lot of memory.
>>  
>> Producer asks for ingress on the channel
>> amqp_channel:register_flow_handler(Channel, self()),
> 
> The process represented by 'self()' in that call should receive `#channel.flow{}` messages yes.
> 
>> The broker warns once on the console and then it is killed:
>>  
>> 13:48:24.429 [warning] Undefined: memory resource limit alarm set on node hare at xxx
>> Killed
>>  
>> shouldn't the producer be warned instead?
> 
> The producer should get throttled as well as receiving a flow notification - rabbit stops reading from the socket, at which point TCP back-pressure is exerted. Who does the killing here, i.e., where does that 'Killed' come from? Are you saying that rabbit crashes (with OOM for example) before the producer gets the flow notification?
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130405/d44fb03f/attachment.htm>

From jandres at omie.es  Fri Apr  5 13:29:00 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Fri, 5 Apr 2013 12:29:00 +0000
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <515EAFD1.2040201@rabbitmq.com>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>

Thank you again!

I'm trying to run the file dumpasn1.c but is giving me problems (not usually work with C).
Do you think there are a problematic string in the certificate? I use it every day in https conections.

Is there any way to increase the level of rabitMq logs?

This is the ASN.1 dump:


SEQUENCE
{
    INTEGER=2
    INTEGER=364
    SEQUENCE
    {
        OBJECT IDENTIFIER=SHA-1 with RSA Encryption (1.2.840.113549.1.1.5)
        NULL
    }
    SEQUENCE
    {
        SET
        {
            SEQUENCE
            {
                OBJECT IDENTIFIER=Organization (2.5.4.10)
                PRINTABLE STRING=OMEL PKI Domain
            }
        }
        SET
        {
            SEQUENCE
            {
                OBJECT IDENTIFIER=Common Name (2.5.4.3)
                PRINTABLE STRING=omelCA
            }
        }
    }
    SEQUENCE
    {
        UTC TIME=03/may/2010 16:48:59 CEST (100503144859Z)
        UTC TIME=02/may/2013 16:48:59 CEST (130502144859Z)
    }
    SEQUENCE
    {
        SET
        {
            SEQUENCE
            {
                OBJECT IDENTIFIER=Country (2.5.4.6)
                PRINTABLE STRING=ES
            }
        }
        SET
        {
            SEQUENCE
            {
                OBJECT IDENTIFIER=Organization (2.5.4.10)
                PRINTABLE STRING=OMEL
            }
        }
        SET
        {
            SEQUENCE
            {
                OBJECT IDENTIFIER=Organizational Unit (2.5.4.11)
                PRINTABLE STRING=OM
            }
        }
        SET
        {
            SEQUENCE
            {
                OBJECT IDENTIFIER=Common Name (2.5.4.3)
                PRINTABLE STRING=DSISOFT1
            }
        }
        SET
        {
            SEQUENCE
            {
                OBJECT IDENTIFIER=0.9.2342.19200300.100.1.1
                PRINTABLE STRING=DSISOFT1
            }
        }
    }
    SEQUENCE
    {
        SEQUENCE
        {
            OBJECT IDENTIFIER=RSA encryption (1.2.840.113549.1.1.1)
            NULL
        }
        BIT STRING=
01010010010110001101100110010000001000000011000000010000000000000001
    }
    SEQUENCE
    {
        SEQUENCE
        {
            OBJECT IDENTIFIER=Authority Key Identifier (2.5.29.35)
            OCTET STRING=
                30 16 80 14 D6 CA 47 8A   0...??G.
                07 63 C1 70 F7 66 A7 1B   .c?p?f?.
                4B D6 AC 41 5E 79 B4 78   K??A^y?x
        }
        SEQUENCE
        {
            OBJECT IDENTIFIER=Authority Info Access (1.3.6.1.5.5.7.1.1)
            OCTET STRING=
                30 32 30 30 06 08 2B 06   0200..+.
                01 05 05 07 30 01 86 24   ....0..$
                68 74 74 70 3A 2F 2F 43   http://C
                45 52 54 31 2D 4F 4D 2E   ERT1-OM.
                4F 4D 45 4C 2E 45 53 3A   OMEL.ES:
                39 30 38 30 2F 63 61 2F   9080/ca/
                6F 63 73 70               ocsp
        }
        SEQUENCE
        {
            OBJECT IDENTIFIER=Key Usage (2.5.29.15)
            BOOLEAN=true
            OCTET STRING=
                03 02 05 E0               ...?
        }
        SEQUENCE
        {
            OBJECT IDENTIFIER=Extended key usage (2.5.29.37)
            OCTET STRING=
                30 14 06 08 2B 06 01 05   0...+...
                05 07 03 02 06 08 2B 06   ......+.
                01 05 05 07 03 04         ......
        }
        SEQUENCE
        {
            OBJECT IDENTIFIER=Subject Alternative Name (2.5.29.17)
            OCTET STRING=
                30 1D 81 1B 53 69 73 74   0...Sist
                65 6D 61 73 49 6E 66 6F   emasInfo
                72 6D 61 63 69 6F 6E 40   rmacion@
                6F 6D 65 6C 2E 65 73      omel.es
        }
    }
}


Thank you again! 





-----Mensaje original-----
De: Emile Joubert [mailto:emile at rabbitmq.com] 
Enviado el: viernes, 05 de abril de 2013 13:05
Para: Discussions about RabbitMQ
CC: SAG - Jonathan Andr?s
Asunto: Re: [rabbitmq-discuss] SSL

On 05/04/13 10:38, SAG - Jonathan Andr?s wrote:
> I can not send it because it is a certificate used in our company

Can you provide an ASN.1 dump of the part of the certificate containing the problematic string? Running this on the DER version of the certificate should show enough useful information to debug:

http://www.cs.auckland.ac.nz/~pgut001/dumpasn1.c



-Emile



From simon at rabbitmq.com  Fri Apr  5 13:36:57 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 05 Apr 2013 13:36:57 +0100
Subject: [rabbitmq-discuss] Ingress does not work for me and the RMQ
 goes down
In-Reply-To: <F1A539826FC33E4CA602BB52E5C4502222B6F53C@FR44EX3004.global.ds.honeywell.com>
References: <F1A539826FC33E4CA602BB52E5C4502222B6F50C@FR44EX3004.global.ds.honeywell.com>
	<515EC081.4000304@rabbitmq.com>
	<F1A539826FC33E4CA602BB52E5C4502222B6F53C@FR44EX3004.global.ds.honeywell.com>
Message-ID: <515EC569.5050003@rabbitmq.com>

On 05/04/13 13:18, Cermak, Marek wrote:
> Hi Simon,
> yes, I use direct for both consumer and publisher. They run in one node, RMQ is in another.

In that case you'll need to participate in the internal flow control 
scheme (which is not related to register_flow_handler) on the publisher 
side. This is slightly more fiddly:

* Use amqp_channel:cast_flow/3 instead of amqp_channel:cast/3 to publish.
* Be prepared to receive {bump_credit, Msg}, and pass that Msg to 
credit_flow:handle_bump_msg(Msg).
* Use credit_flow:blocked/0 to determine if you are allowed to publish.

That's if you have a single (class of) processes which publish. If you 
have a pipeline of processes through which messages pass then you might 
want to extend the same flow control mechanism through the pipeline. See 
for example the pipeline

rabbit_stomp_reader -> rabbit_stomp_processor -> amqp_channel.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Marek.Cermak at Honeywell.com  Fri Apr  5 13:48:42 2013
From: Marek.Cermak at Honeywell.com (Cermak, Marek)
Date: Fri, 5 Apr 2013 12:48:42 +0000
Subject: [rabbitmq-discuss] Ingress does not work for me and the RMQ
 goes down
In-Reply-To: <515EC569.5050003@rabbitmq.com>
References: <F1A539826FC33E4CA602BB52E5C4502222B6F50C@FR44EX3004.global.ds.honeywell.com>
	<515EC081.4000304@rabbitmq.com>
	<F1A539826FC33E4CA602BB52E5C4502222B6F53C@FR44EX3004.global.ds.honeywell.com>
	<515EC569.5050003@rabbitmq.com>
Message-ID: <F1A539826FC33E4CA602BB52E5C4502222B6F59A@FR44EX3004.global.ds.honeywell.com>

Hi,
well does this flow_control mechanism help against the broker crash? Is it handled by the broker using socket blocking you mentioned in case of TCP connection?

thanks
marek

> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: 05 April, 2013 14:37
> To: Cermak, Marek
> Cc: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Ingress does not work for me and the RMQ goes
> down
> 
> On 05/04/13 13:18, Cermak, Marek wrote:
> > Hi Simon,
> > yes, I use direct for both consumer and publisher. They run in one node,
> RMQ is in another.
> 
> In that case you'll need to participate in the internal flow control scheme
> (which is not related to register_flow_handler) on the publisher side. This
> is slightly more fiddly:
> 
> * Use amqp_channel:cast_flow/3 instead of amqp_channel:cast/3 to publish.
> * Be prepared to receive {bump_credit, Msg}, and pass that Msg to
> credit_flow:handle_bump_msg(Msg).
> * Use credit_flow:blocked/0 to determine if you are allowed to publish.
> 
> That's if you have a single (class of) processes which publish. If you have a
> pipeline of processes through which messages pass then you might want to
> extend the same flow control mechanism through the pipeline. See for example
> the pipeline
> 
> rabbit_stomp_reader -> rabbit_stomp_processor -> amqp_channel.
> 
> Cheers, Simon
> 
> --
> Simon MacMullen
> RabbitMQ, VMware

From simon at rabbitmq.com  Fri Apr  5 13:53:38 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 05 Apr 2013 13:53:38 +0100
Subject: [rabbitmq-discuss] Ingress does not work for me and the RMQ
 goes down
In-Reply-To: <F1A539826FC33E4CA602BB52E5C4502222B6F59A@FR44EX3004.global.ds.honeywell.com>
References: <F1A539826FC33E4CA602BB52E5C4502222B6F50C@FR44EX3004.global.ds.honeywell.com>
	<515EC081.4000304@rabbitmq.com>
	<F1A539826FC33E4CA602BB52E5C4502222B6F53C@FR44EX3004.global.ds.honeywell.com>
	<515EC569.5050003@rabbitmq.com>
	<F1A539826FC33E4CA602BB52E5C4502222B6F59A@FR44EX3004.global.ds.honeywell.com>
Message-ID: <515EC952.60606@rabbitmq.com>

On 05/04/13 13:48, Cermak, Marek wrote:
> Hi,
> well does this flow_control mechanism help against the broker crash?

Yes, I suspect you were overwhelming the broker with messages (which 
were waiting to get into a queue or on to disc, they take up more memory 
that way) - then memory use exploded to the point where the kernel oom 
killer took Rabbit out.

When using the direct client the normal safeties are off, the client 
will not slow down in the presence of flow control or memory alarms 
unless you make it.

> Is it handled by the broker using socket blocking you mentioned in case of TCP connection?

Yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Fri Apr  5 14:07:36 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 05 Apr 2013 14:07:36 +0100
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
Message-ID: <515ECC98.3040409@rabbitmq.com>


Hi,

I will need more information about these sections:

On 05/04/13 13:29, SAG - Jonathan Andr?s wrote:
>         SET
>         {
>             SEQUENCE
>             {
>                 OBJECT IDENTIFIER=Common Name (2.5.4.3)
>                 PRINTABLE STRING=DSISOFT1
>             }
>         }
>         SET
>         {
>             SEQUENCE
>             {
>                 OBJECT IDENTIFIER=0.9.2342.19200300.100.1.1
>                 PRINTABLE STRING=DSISOFT1
>             }
>         }

Can you please provide the bytes that corresponds with the output above?
The full output from dumpasn1 should contain the offset and length for
each set. The Unix 'cut' command with parameter "-b" can be used to
obtain the corresponding bytes. If you could please provide those in
base64 or uuencoded format. Sharing this information should not pose a
security risk.

If you have problems with the suggested ASN.1 dumper then please free to
use "openssl asn1parse" or the program of your choice.

Do you have any information about the software that generated this
certificate?


-Emile








From gmr at meetme.com  Fri Apr  5 14:41:22 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Fri, 05 Apr 2013 06:41:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika IncompatibleProtocolError
In-Reply-To: <515EAC77.3060304@rabbitmq.com>
References: <515EAC77.3060304@rabbitmq.com>
Message-ID: <1365169281710.aa7efacc@Nodemailer>

Is a pre-release tag of the next version. Please file a bug report on github. I'll look at it later today. Is likely a new bug Introduced with the re-factored connection handling.


Gavin

On Fri, Apr 5, 2013 at 6:51 AM, Simon MacMullen <simon at rabbitmq.com>
wrote:

> Hmm. I'm no Pika expert but that seems wrong. Is there anything 
> interesting-looking in the server logs at that point?
> Cheers, Simon
> On 05/04/13 03:51, William Daly wrote:
>> Hi,
>>
>> I'm trying to use rabbitmq and pika on localhost for testing purposes,
>> and I am receiving an IncompatibleProtocolError.
>>
>> Here are the steps I'm following:
>>
>> 1) I start up rabbitmq-server, and when I run rabbitmqctl status I get:
>> Status of node rabbit at localhost ...
>> [{pid,390},
>>   {running_applications,
>>       [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","3.0.4"},
>>        {rabbitmq_management,"RabbitMQ Management Console","3.0.4"},
>>        {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.4"},
>>        {rabbit,"RabbitMQ","3.0.4"},
>>        {os_mon,"CPO  CXC 138 46","2.2.10"},
>>        {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.0.4"},
>>        {webmachine,"webmachine","1.9.1-rmq3.0.4-git52e62bc"},
>>        {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.4-gitd541e9a"},
>>        {xmerl,"XML parser","1.3.2"},
>>        {inets,"INETS  CXC 138 49","5.9.2"},
>>        {mnesia,"MNESIA  CXC 138 12","4.7.1"},
>>        {amqp_client,"RabbitMQ AMQP Client","3.0.4"},
>>        {sasl,"SASL  CXC 138 11","2.2.1"},
>>        {stdlib,"ERTS  CXC 138 10","1.18.3"},
>>        {kernel,"ERTS  CXC 138 10","2.15.3"}]},
>>   {os,{unix,darwin}},
>>   {erlang_version,
>>       "Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:8:8]
>> [async-threads:30] [hipe] [kernel-poll:true] [dtrace]\n"},
>>   {memory,
>>       [{total,35653280},
>>        {connection_procs,5696},
>>        {queue_procs,27576},
>>        {plugins,152984},
>>        {other_proc,9868108},
>>        {mnesia,62360},
>>        {mgmt_db,47384},
>>        {msg_index,22960},
>>        {other_ets,1239568},
>>        {binary,522528},
>>        {code,18264216},
>>        {atom,695185},
>>        {other_system,4744715}]},
>>   {vm_memory_high_watermark,0.4},
>>   {vm_memory_limit,6523774566},
>>   {disk_free_limit,1000000000},
>>   {disk_free,199230787584},
>>   {file_descriptors,
>>
>>   [{total_limit,156},{total_used,4},{sockets_limit,138},{sockets_used,1}]},
>>   {processes,[{limit,1048576},{used,196}]},
>>   {run_queue,0},
>>   {uptime,2667}]
>> ...done.
>>
>> 2) I run the following code (RABBITMQ_USER='guest',
>> RABBITMQ_PASS='guest', RABBIT_HOST='localhost')
>>
>> credentials = pika.PlainCredentials(settings.RABBITMQ_USER,
>>                                              settings.RABBITMQ_PASS)
>> parameters = pika.ConnectionParameters(heartbeat_interval=5,
>>                                                 credentials=credentials,
>>                                                 host=settings.RABBIT_HOST)
>> self.channel = None
>> self.connection = pika.SelectConnection(parameters, self.on_connected)
>>
>> # ....
>>
>> self.connection.ioloop.start()
>>
>> 3) I get the following traceback:
>>
>> Traceback (most recent call last):
>>    File
>> "/usr/local/Cellar/python/2.7.3/Frameworks/Python.framework/Versions/2.7/lib/python2.7/multiprocessing/process.py",
>> line 258, in _bootstrap
>>      self.run()
>>    File "/Users/will/queue/consumer.py", line 237, in run
>>      self.connection.ioloop.start()
>>    File
>> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/select_connection.py",
>> line 108, in start
>>      self.poller.start()
>>    File
>> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/select_connection.py",
>> line 336, in start
>>      self.poll()
>>    File
>> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/select_connection.py",
>> line 351, in poll
>>      return self._handler(self.fileno, ERROR, error)
>>    File
>> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py",
>> line 315, in _handle_events
>>      self._handle_error(error)
>>    File
>> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py",
>> line 291, in _handle_error
>>      self._handle_disconnect()
>>    File
>> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py",
>> line 240, in _handle_disconnect
>>      self._adapter_disconnect()
>>    File
>> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py",
>> line 131, in _adapter_disconnect
>>      self._check_state_on_disconnect()
>>    File
>> "/Users/will/python/lib/python2.7/site-packages/pika-0.9.13p0-py2.7.egg/pika/adapters/base_connection.py",
>> line 143, in _check_state_on_disconnect
>>      raise exceptions.IncompatibleProtocolError
>> IncompatibleProtocolError
>>
>> Any idea what could be causing this?  I'm running Mac OS X Mountain
>> Lion.  Any help would be greatly appreciated.
>>
>> Thanks!
>> -- Will
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130405/0bbc70e3/attachment.htm>

From emile at rabbitmq.com  Fri Apr  5 15:41:40 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 05 Apr 2013 15:41:40 +0100
Subject: [rabbitmq-discuss] TTL
In-Reply-To: <CAAzMEC=Z9irPK6C9emqRz+MZjT3_EJKzHcK_CcjQdFGdWTBWHg@mail.gmail.com>
References: <39aab164-6e51-4409-8b33-069365e35838@googlegroups.com>
	<CAE0Sz=zpe4tb6Sg4x2e6hB2FHWyO2fGBui8pcJ8coqVudh70Ww@mail.gmail.com>
	<CAAzMECnGEur6t=UJRNMNFJ_7+RG0LN_CpWSZ2KebfZ+TR61v4w@mail.gmail.com>
	<CAE3HoVS+gk3ho+7L02kUzz1UeH2Ca0z3JmybWhmSfksn9GDU6w@mail.gmail.com>
	<CAAzMECn4Z03Li-USK1KT7OHv6h3KRT=EWwuAzT3W404kzA49GQ@mail.gmail.com>
	<CAAzMEC=Z9irPK6C9emqRz+MZjT3_EJKzHcK_CcjQdFGdWTBWHg@mail.gmail.com>
Message-ID: <515EE2A4.2060805@rabbitmq.com>



Hi Derek,

On 04/04/13 21:35, Derek Greer wrote:
> Here's my example using the .Net API in which I'm seeing about a 3%
> failure rate:

We've tried the same test on Mono, .NET2 and .NET3.5 and get 100%
success rate in all cases. (The .NET tests were conducted on virtual
hardware.) Can you please supply the versions of all the components in
your tests, including the version of Erlang? I assume the broker and
client are on the same server?

Do you get the same error if you re-use a connection instead of
re-establishing a new connection each time? Do you get the same error if
you re-use the same channel as well, instead of re-establishing a new
channel each time?



-Emile






From sean1965 at gmail.com  Fri Apr  5 17:49:29 2013
From: sean1965 at gmail.com (Sean Shannon)
Date: Fri, 5 Apr 2013 09:49:29 -0700 (PDT)
Subject: [rabbitmq-discuss] Export Causes Server To Crash
In-Reply-To: <5FD3B4A1-1955-45BC-96A4-E3ADDB282F7B@rabbitmq.com>
References: <6d670ac2-0a4f-4495-9498-0937a2059406@googlegroups.com>
	<8CE5DE34-8E25-437D-9CDC-84E820F0398B@rabbitmq.com>
	<6551C72A-CB07-444C-B787-5C98236676CE@rabbitmq.com>
	<5FD3B4A1-1955-45BC-96A4-E3ADDB282F7B@rabbitmq.com>
Message-ID: <83bbf408-512f-4424-a0ca-4b0e8e458660@googlegroups.com>

Amazingly, the service started working again on its own.  Another post 
suggests that it was an issue with my client (browser) and not the admin 
portal.  

I am running  RabbitMQ 3.0.0, Erlang R14B04 

Thanks!

On Tuesday, April 2, 2013 4:58:16 AM UTC-7, hyperthunk wrote:
>
> Oh and you should be able to run 'rabbitmqctl status' to tell us the 
> version number you're running.
>
> Cheers
> Tim
>
> On 2 Apr 2013, at 12:42, Tim Watson <watson.... at gmail.com <javascript:>> 
> wrote:
>
> Do you get asked for auth details when downloading the exported data? I 
> do, although I don't get this crash afterwards.
>
> On 2 Apr 2013, at 12:20, Tim Watson <watson.... at gmail.com <javascript:>> 
> wrote:
>
> Have you tried disabling and then re-enabling the management plugin?
>
> On 2 Apr 2013, at 06:55, Sean Shannon <sean... at gmail.com <javascript:>> 
> wrote:
>
> Hi, I'm sorry I can't say what version I'm running because the server is 
> down.
>
> All I did from the Admin site home page is export the settings for the 
> RabbitMQ and now I can't log in anymore.
>
> Got response code 500 with body
> Internal Server ErrorThe server encountered an error while processing 
> this request:
>
> {error,{case_clause,{{[],false},2}},
>        [{base64,strip_illegal,3},
>         {base64,mime_decode_l,1},
>         {rabbit_mochiweb_util,parse_auth_header,1},
>         {rabbit_mgmt_util,is_authorized,3},
>         {webmachine_resource,resource_call,3},
>         {webmachine_resource,do,3},
>         {webmachine_decision_core,resource_call,1},
>         {webmachine_decision_core,decision,1}]}
>
>
>
> Anyone have this issue?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130405/e5afd379/attachment.htm>

From sean1965 at gmail.com  Fri Apr  5 17:50:27 2013
From: sean1965 at gmail.com (Sean Shannon)
Date: Fri, 5 Apr 2013 09:50:27 -0700
Subject: [rabbitmq-discuss] Export Causes Server To Crash
In-Reply-To: <515EAE0E.3020304@rabbitmq.com>
References: <6d670ac2-0a4f-4495-9498-0937a2059406@googlegroups.com>
	<515EAE0E.3020304@rabbitmq.com>
Message-ID: <CAN6vurT6nprPo95T9tNnQKhSL0M2ZtNc0jDxEdvaRThQRc6s7A@mail.gmail.com>

It somehow fixed itself, probably because of what you suggest.  This is the
version we are running:  RabbitMQ 3.0.0, Erlang R14B04


On Fri, Apr 5, 2013 at 3:57 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 02/04/13 06:55, Sean Shannon wrote:
>
>> {error,{case_clause,{{[],**false},2}},
>>         [{base64,strip_illegal,3},
>>          {base64,mime_decode_l,1},
>>          {rabbit_mochiweb_util,parse_**auth_header,1},
>>          {rabbit_mgmt_util,is_**authorized,3},
>>          {webmachine_resource,resource_**call,3},
>>          {webmachine_resource,do,3},
>>          {webmachine_decision_core,**resource_call,1},
>>          {webmachine_decision_core,**decision,1}]}
>>
>
> Hmm. That looks like the HTTP basic auth is not valid base64.
>
> I would expect you should be able to fix this by either closing and
> reopening your browser (if using RabbitMQ 2.x) or by logging out and then
> in again (if using 3.x).
>
> After you've done that, can you tell me if you're using 2.x or 3.x? Since
> the origin of the HTTP basic auth is quite different in the two cases.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
-Sean
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130405/56c7a847/attachment.htm>

From christopher.carver at gmail.com  Fri Apr  5 20:39:27 2013
From: christopher.carver at gmail.com (Christopher Carver)
Date: Fri, 5 Apr 2013 12:39:27 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Windows 8 client incompatibility
In-Reply-To: <51aeebf6-36bd-4088-8816-83d6d3dee8e7@googlegroups.com>
References: <51aeebf6-36bd-4088-8816-83d6d3dee8e7@googlegroups.com>
Message-ID: <d1d6e9d3-ed7b-4fcf-a638-69266755cac3@googlegroups.com>

Thank you Hyperthunk. Here is a link to Microsoft's reply.
http://social.msdn.microsoft.com/Forums/en-US/winappswithcsharp/thread/5b8803b4-0bf5-45dc-b746-3433ebc737c6

I will be going with a web services solution attached to RabbitMQ. Thank 
you for your response.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130405/bbfce6bf/attachment.htm>

From aggarwalsandeep at optonline.net  Fri Apr  5 22:17:23 2013
From: aggarwalsandeep at optonline.net (Sandeep Aggarwal)
Date: Fri, 5 Apr 2013 14:17:23 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Trace not working
Message-ID: <72083490-62fd-4c40-b4d6-eaf392dda934@googlegroups.com>

Hello - 

I'm trying to turn on the trace in order to watch the messages flowing 
between various queues. It used to be working earlier but ever since I've 
upgraded to version 3.0.0 onwards, I'm not able to see the trace option in 
the web admin console. When I try to turn on the trace feature using 
rabbitmqctl, it tells me that trace is on. However, I can't see the trace 
option in the admin menu. I have even tried to reinstall the management 
plugins but did not help.

Please advise what am I missing.

Thanks,
Sandy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130405/dd7d421c/attachment.htm>

From tim at rabbitmq.com  Sat Apr  6 13:24:01 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Sat, 6 Apr 2013 13:24:01 +0100
Subject: [rabbitmq-discuss] RabbitMQ Windows 8 client incompatibility
In-Reply-To: <d1d6e9d3-ed7b-4fcf-a638-69266755cac3@googlegroups.com>
References: <51aeebf6-36bd-4088-8816-83d6d3dee8e7@googlegroups.com>
	<d1d6e9d3-ed7b-4fcf-a638-69266755cac3@googlegroups.com>
Message-ID: <3B437BB2-F92B-4F78-908B-BDA725CF1E98@rabbitmq.com>

Hi Christopher,

On 5 Apr 2013, at 20:39, Christopher Carver wrote:

> Thank you Hyperthunk. Here is a link to Microsoft's reply.
> http://social.msdn.microsoft.com/Forums/en-US/winappswithcsharp/thread/5b8803b4-0bf5-45dc-b746-3433ebc737c6
> 

Pretty much what I'd guessed. It's a pity they don't provide an API comparison tool (or documentation resource), as that'd make it plausible for us to determine whether or not there are any real incompatibilities.

> I will be going with a web services solution attached to RabbitMQ. Thank you for your response.

Sure thing - good luck with it and feel free to drop by with any questions/issues.

Kind Regards,
Tim

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130406/610f6ae0/attachment.htm>

From sean.farrow at seanfarrow.co.uk  Sat Apr  6 15:57:11 2013
From: sean.farrow at seanfarrow.co.uk (Sean Farrow)
Date: Sat, 6 Apr 2013 15:57:11 +0100
Subject: [rabbitmq-discuss] Query regarding architecture including rabbiMQ
Message-ID: <95BC1059FB290D48835F2531A70ECB9AAA540FC6DA@EX27MAIL03.msghub.com>

Hi all,

I'm Justin he process of looking at updating a multi-threaded application to use message oriented architecture.
Currently there is a thread per device which I realize will not scale.
I'm looking at splitting the process in to 3 separate stages, one which grabs the input from the device, the second that processes that data and the 3rd that outputs the data where needed.
The current process lives in one application executable/process.
I've got a few questions.
If I'm changing this to use rabbit, can I have multiple connections in a single process. What is the best way of doing this.
If I've overlooked anything feel free to let me know.
Regards
Sean.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130406/a3f1d6a2/attachment.htm>

From edyesed at gmail.com  Fri Apr  5 16:27:27 2013
From: edyesed at gmail.com (ed anderson)
Date: Fri, 5 Apr 2013 08:27:27 -0700 (PDT)
Subject: [rabbitmq-discuss] separating wheat from chaff inside the stats
 from rabbitmq_management
Message-ID: <e2d9b0e9-5f74-4283-ba4f-53bf98caecac@googlegroups.com>

I'm using rabbitmq version 2.8.7, and i'm curious about what some of the 
stats that come out of the management plugin mean.. 

These are the things that I don't grok ( please direct me to the decoder 
ring if it exists, I'm happy to read about this topic, but I haven't found 
much via google-search ): 
FWIW, I'm interested in monitoring operational readiness, and throughput. 

inside /api/nodes .. 
 *  Is it good/bad/neither that mem_atom_used is 99% of mem_atom? Does this 
tell me anything about performance or availability?
        "mem_atom": 1547217,
        "mem_atom_used": 1536812,

 * mem_alarm ( not listed ) , is clearly valuable for availability 
monitoring, but how is it triggered?  
        "mem_binary": 6349904,
        "mem_code": 17345156,
        "mem_ets": 1961472,
        "mem_limit": 787570688,
        "mem_proc": 18586392,
        "mem_proc_used": 18559872,
        "mem_used": 47203120,
 * mem_atom_used + mem_binary + mem_code + mem_ets + mem_proc is _almost_ 
equal to mem_used, but not quite. It doesn't appear to be off by any 
reported counter.   Do I even care about that?  What matters from these 
counters?
 * is mem_used / mem_limit  enough to keep track of my memory-related 
utilization and health?

 * run_queue ?  What is this a reference to ? 


inside /api/queues/{vhost}
 * sometimes message_stats is in the output, and sometimes not. 
 * if present, message_stats has two possible formats.  
   When rate is present, is it messages/sec? 
   What does "publish" mean?
  (1)   "message_stats": {
              "publish": 20
         },
  (2)  "message_stats": {
             "publish_details": {
                 "rate": 2.2547070391502824, 
                 "interval": 4435166, 
                 "last_event": 1365091799843
           }, 
          "publish": 40
 * inside the backing_queue_status block, does the difference between q1 .. 
q4 matter ( from an operational point of view )
 * messages vs messages_ready vs messages_unacknowledged - what's with 
that?  Also, could their respective _details have changed as in the example 
above for message. 
 * why doesn't message_stats have a correlating "message" key?

Thanks!
-ed
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130405/5bfd3cfb/attachment.htm>

From pgaltieri at gmail.com  Fri Apr  5 18:44:32 2013
From: pgaltieri at gmail.com (pgaltieri at gmail.com)
Date: Fri, 5 Apr 2013 10:44:32 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ unable to talk to remote server
In-Reply-To: <cb0ea5ec-2b43-413e-800b-a169a87f46a9@googlegroups.com>
References: <cb0ea5ec-2b43-413e-800b-a169a87f46a9@googlegroups.com>
Message-ID: <218d2cda-ad07-4fb9-bb51-86df9bcca2d7@googlegroups.com>

What you need to do is edit the file /etc/sysconfig/iptables on the RedHat 
server system and add the following line

-A INPUT -m state --state NEW -m tcp -p tcp --dport 5672 -j ACCEPT

Here is a snippet of my /etc/sysconfig/iptables

-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 5672 -j ACCEPT

dport 5672 is the well known port for amqp messages.  After you have added 
the line you need to run

service iptables restart

on the RedHat system.  This should fix the problem.  I had the same issue 
when trying out the RabbitMQ tutorials.  What I described here solved my 
problem.

Hope this helps.

Paolo

On Friday, March 29, 2013 3:08:44 PM UTC-7, Eric Sender wrote:
>
> Hello,
>
> I am setting up an enviornment where the server and client are on seperate 
> hosts. Using wireshark, I am finding that my connection requests are being 
> blocked by code 10:
>
> Code: 10 (Host administratively prohibited)
>
> I was wondering if anyone knows how to make sure my server is set up right 
> to work with RabbitMQ? I am using the default ports.
>
> Here is my set up:
>
>
>    - Remote server is CentOS. It is on my same subnet (its actually a 
>    guestOS on my PC)
>    - I am currently running the server as Python. Just the tutorial #1 
>    recieve.py server
>       - connection = 
>       pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
>       - My client is my HostOS PC running Java.
>       - factory.setHost("192.168.1.124"); //x.x.x.124 is my "remote" 
>       GuestOS
>       - Everything works find through localhost, but when I try 
>    to separate the client and server, I am getting what looks like firewall 
>    issues. 
>
>
> So, this question may require some help from a person who uses 
> RedHat/CentOS as their server OS, as I imagine part of the solution has to 
> do with modifying the firewall or something in the virtual NIC card?
>
> I am posting this on the Google Groups, and I have noticed google doesn't 
> update for every reply? Please be sure to CC my personal email just in case 
> Google doesn't update. sender.eric (at) gmail
>
> Thanks,
> Eric
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130405/0e11ccb4/attachment.htm>

From cmorris at voicerite.com  Fri Apr  5 19:48:00 2013
From: cmorris at voicerite.com (Moebius)
Date: Fri, 5 Apr 2013 11:48:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Is heartbeat option working in C-client?
In-Reply-To: <CAAt2poK8WMe7-6bU-rxtqffcV+t_C8yjY3QvbiO_dsTxjaRvyg@mail.gmail.com>
References: <1354437874.6889.YahooMailNeo@web161201.mail.bf1.yahoo.com>
	<CAAt2poLz0jqwHsV8H=ORgOHse7P=Hc8BLq+u34dVfMpWCUTJYg@mail.gmail.com>
	<50BBAA53.1030809@rabbitmq.com>
	<CAAt2poJqOb3UfOxDHWc_qEUUh71h=yMy+TuKwh=XouEuvLGWkw@mail.gmail.com>
	<CADXMcw1R5XTY1iAPCkHPNFT28-rvhKr3kUth_4Yt4eMFyEJ-wQ@mail.gmail.com>
	<CAAt2poK8WMe7-6bU-rxtqffcV+t_C8yjY3QvbiO_dsTxjaRvyg@mail.gmail.com>
Message-ID: <1365187680367-25909.post@n5.nabble.com>

I am new to all this, but wanted to ask a couple of questions.  If the
library sees a heartbeat come in, why can't it just send one back in
response?  Why would there have to be a message queue involved?


Alan Antonuk wrote
> While I cannot comment on what Dawn ended up doing, I can say a few words
> about the rabbitmq-c library.
> 
> Currently the rabbitmq-c only has partial support for AMQP heartbeats: the
> library understands AMQP hearbeats at a protocol level, the library
> provides an interface for sending and receiving frames that allows
> heartbeat frames to be sent, however the library does not have an event
> loop that will automatically handle heartbeats for you.
> 
> To use heartbeats with rabbitmq-c you would need to provide your own event
> loop/logic to send and receive heartbeat frames.
> 
> HTH
> -Alan





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Is-heartbeat-option-working-in-C-client-tp23785p25909.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From dharmanshu at ophio.co.in  Sun Apr  7 15:20:54 2013
From: dharmanshu at ophio.co.in (dharmanshu at ophio.co.in)
Date: Sun, 7 Apr 2013 07:20:54 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ AMQP :- Socket error: Broken pipe on
	high load
Message-ID: <28b773c7-2884-4283-94aa-bd6ef116175e@googlegroups.com>

Hey , 
So i am running rabbitmq 3.02 on Ubuntu 12.04. Using PECL AMQP client. 
Using 1 queue, 35 consumers. The consumer fetches an xml object and saves 
it to the  db.

And 1 reader that publishes messages using a for loop.

After publishing around 120,000 messages , the reader gives out the 
following error on publish.
 
Socket error: Broken pipe.

The reader process then needs to be killed manually and the broker needs to 
be restarted. 
Any idea how to handle this ?

Message Queue class

class AppMessageQueue {
    
    public function __construct() {
$this->_createNewConnectionAndChannel();
    }
    
    public function __destruct() {
    if ($this->conn) {
        $this->conn->disconnect();
    }
    }
    
public function purge($queue) {
$this->ch->queue_purge($queue);
}
    public function startConsuming(Parsable $parser) {
        $this->messageParser = $parser;
        //$ch->basic_consume(queue, consumer_tag, no_local, no_ack, 
exclusive, nowait, callback);
$this->queue = new AMQPQueue($this->ch);
$this->queue->setName(MQ_QUEUE);
$this->queue->declare();
$this->queue->bind(MQ_EXCHANGE, MQ_ROUTING_KEY);
$this->queue->consume(array($this , 'processMessage') , AMQP_AUTOACK);
    }
    
    public function processMessage($msg) {
return $this->messageParser->parse($msg->getBody());
    }
    
    public function publishMessage($message) {
try {
$this->exchange->publish($message , MQ_ROUTING_KEY);
} catch (Exception $e) {
echo "Caught exception : " . $e->getMessage();
}
}

protected function _createNewConnectionAndChannel() {

$this->conn = new AMQPConnection(array(
'host' => 'localhost' ,
'port' => 5672 ,
'login' =>  MQ_USER,
'password' => MQ_PASS
));
$this->conn->connect();
$this->ch = new AMQPChannel($this->conn);
 $this->exchange = new AMQPExchange($this->ch);
$this->exchange->setName(MQ_EXCHANGE);
$this->exchange->setType('direct');
$this->exchange->declare();
}
 
}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130407/ad3d7989/attachment.htm>

From michael.s.klishin at gmail.com  Sun Apr  7 20:45:58 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 7 Apr 2013 23:45:58 +0400
Subject: [rabbitmq-discuss] RabbitMQ AMQP :- Socket error: Broken pipe
 on high load
In-Reply-To: <28b773c7-2884-4283-94aa-bd6ef116175e@googlegroups.com>
References: <28b773c7-2884-4283-94aa-bd6ef116175e@googlegroups.com>
Message-ID: <CAE3HoVQ9Fq1bp+5GRjiDqaEYsnjw0s1AKbAkx0egt1k3cJ+GVA@mail.gmail.com>

2013/4/7 <dharmanshu at ophio.co.in>

> And 1 reader that publishes messages using a for loop.
>
> After publishing around 120,000 messages , the reader gives out the
> following error on publish.
>
> Socket error: Broken pipe.
>
> The reader process then needs to be killed manually and the broker needs
> to be restarted.
> Any idea how to handle this ?
>

What is in RabbitMQ log? Your publisher is likely to be blocked because you
are going
above the RAM watermark (or even disk, on a small partition, for example).

It will be unblocked when consumers catch up and drain some messages to
free up resources.

The client should not fail with a socket error, though.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130407/4a74d486/attachment.htm>

From matthias at rabbitmq.com  Sun Apr  7 22:34:19 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 07 Apr 2013 22:34:19 +0100
Subject: [rabbitmq-discuss] Configuring RabbitMQ to support change	in
 hostname
In-Reply-To: <F5F4BA6F-3E83-46DB-AD55-45C8DDEC0616@rabbitmq.com>
References: <9915783f.00001508.000000cf@KAPILPC.vmware.com>	<95003806-680B-425F-AC8D-9466CAB8071D@dushin.net>	<215e265c.00001508.000000f6@KAPILPC.vmware.com>	<40BB9183-870B-45DA-AAA5-31EB0D801592@rabbitmq.com>	<e3316de2.00001688.00000003@KAPILPC.vmware.com>
	<51B3A6B5-FC4E-4254-A403-3941856C29DB@rabbitmq.com>
	<9509e512.00001688.00000009@KAPILPC.vmware.com>
	<F5F4BA6F-3E83-46DB-AD55-45C8DDEC0616@rabbitmq.com>
Message-ID: <5161E65B.4090703@rabbitmq.com>

On 03/04/13 10:48, Tim Watson wrote:
> You cannot use 'rabbit at 987sdfkjhisd7f7d87sdf' to connect to
> other Erlang nodes unless the part after the @ is actually the hostname.

Indeed.

> In addition to this, mnesia - Erlang's distributed database - insists on
> creating its on-disk schema in a folder which is named
> Mnesia.<node-name>, and we have no control over that.

Actually, that directory is configurable. The real problem is that the 
mnesia schema contains for each table a reference to the node(s) on 
which it has copies. So if the host name changes and rabbit is restarted 
it will think that its tables still live on the host with the old hostname.

Matthias.

From alan.antonuk at gmail.com  Mon Apr  8 06:52:56 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sun, 7 Apr 2013 22:52:56 -0700
Subject: [rabbitmq-discuss] Is heartbeat option working in C-client?
In-Reply-To: <1365187680367-25909.post@n5.nabble.com>
References: <1354437874.6889.YahooMailNeo@web161201.mail.bf1.yahoo.com>
	<CAAt2poLz0jqwHsV8H=ORgOHse7P=Hc8BLq+u34dVfMpWCUTJYg@mail.gmail.com>
	<50BBAA53.1030809@rabbitmq.com>
	<CAAt2poJqOb3UfOxDHWc_qEUUh71h=yMy+TuKwh=XouEuvLGWkw@mail.gmail.com>
	<CADXMcw1R5XTY1iAPCkHPNFT28-rvhKr3kUth_4Yt4eMFyEJ-wQ@mail.gmail.com>
	<CAAt2poK8WMe7-6bU-rxtqffcV+t_C8yjY3QvbiO_dsTxjaRvyg@mail.gmail.com>
	<1365187680367-25909.post@n5.nabble.com>
Message-ID: <CAAt2poLcQMKuipCdK5_ASjAWeSTQtOfo6zSvPUDPXQQW-B4oDg@mail.gmail.com>

Because thats not quite how AMQP heartbeats work (I'm sorry if some code I
posted earlier lead you astray). Heartbeats in AMQP work by having each
peer (the broker, and the client) have a timer for receiving something from
the other host (something could be useful communication like message
delivery or publishing, or in the case that a peer has nothing useful to
send, it can send a heartbeat). If the timer reaches 0 at either end, that
peer is supposed to close the socket immediately.


From jandres at omie.es  Mon Apr  8 09:06:46 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Mon, 8 Apr 2013 08:06:46 +0000
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <515ECC98.3040409@rabbitmq.com>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>

Thank you again!

If I run the following command: 

	openssl asn1parse-in "DSISOFT1. Pem"

I get this:

? 152: d = 3 hl = 2 l = 17 cons: SET
? 154: d = 4 hl = 2 l = 15 cons: SEQUENCE
? 156: d = 5 hl = 2 l = 3 prim: OBJECT: commonName
? 161: d = 5 hl = 2 l = 8 prim: PrintableString: DSISOFT1

So after I executed: 

	openssl asn1parse -strparse 161 -in "DSISOFT1.pem"

And I get this:

Error in encoding
12172:error:0D07209B:asn1 encoding routines:ASN1_get_object:too long:.\crypto\as
n1\asn1_lib.c:142:

Is it because of this that I can not connect by SSL? The certificates are generated with Red Hat Certificate System 7.3, and we have been using them for years, so it is not easy to change or generate differently.

And I can establish the SSL with this:

	openssl s_server -accept 8443 ....
	openssl s_client -connect localhost:8443 .....


Thank you!




-----Mensaje original-----
De: Emile Joubert [mailto:emile at rabbitmq.com] 
Enviado el: viernes, 05 de abril de 2013 15:08
Para: SAG - Jonathan Andr?s
CC: Discussions about RabbitMQ
Asunto: Re: [rabbitmq-discuss] SSL


Hi,

I will need more information about these sections:

On 05/04/13 13:29, SAG - Jonathan Andr?s wrote:
>         SET
>         {
>             SEQUENCE
>             {
>                 OBJECT IDENTIFIER=Common Name (2.5.4.3)
>                 PRINTABLE STRING=DSISOFT1
>             }
>         }
>         SET
>         {
>             SEQUENCE
>             {
>                 OBJECT IDENTIFIER=0.9.2342.19200300.100.1.1
>                 PRINTABLE STRING=DSISOFT1
>             }
>         }

Can you please provide the bytes that corresponds with the output above?
The full output from dumpasn1 should contain the offset and length for each set. The Unix 'cut' command with parameter "-b" can be used to obtain the corresponding bytes. If you could please provide those in
base64 or uuencoded format. Sharing this information should not pose a security risk.

If you have problems with the suggested ASN.1 dumper then please free to use "openssl asn1parse" or the program of your choice.

Do you have any information about the software that generated this certificate?


-Emile








From emile at rabbitmq.com  Mon Apr  8 10:05:28 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 08 Apr 2013 10:05:28 +0100
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
Message-ID: <51628858.5020600@rabbitmq.com>


On 08/04/13 09:06, SAG - Jonathan Andr?s wrote:
> The certificates are generated with Red Hat Certificate System 7.3

If you generate another certificate in the same way which exhibits the
same problem will you be able to make that available for testing?



-Emile




From emile at rabbitmq.com  Mon Apr  8 10:17:54 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 08 Apr 2013 10:17:54 +0100
Subject: [rabbitmq-discuss] Query regarding architecture including
	rabbiMQ
In-Reply-To: <95BC1059FB290D48835F2531A70ECB9AAA540FC6DA@EX27MAIL03.msghub.com>
References: <95BC1059FB290D48835F2531A70ECB9AAA540FC6DA@EX27MAIL03.msghub.com>
Message-ID: <51628B42.3000106@rabbitmq.com>

On 06/04/13 15:57, Sean Farrow wrote:

> If I?m changing this to use rabbit, can I have multiple connections in a
> single process.

Yes, a single process can open many connections to a broker. An
alternative is to open one connection and use many channels within that
connection. A single thread of execution mostly needs only one channel
to receive and process messages from the broker.


-Emile


From simon at rabbitmq.com  Mon Apr  8 10:52:26 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 08 Apr 2013 10:52:26 +0100
Subject: [rabbitmq-discuss] separating wheat from chaff inside the stats
 from rabbitmq_management
In-Reply-To: <e2d9b0e9-5f74-4283-ba4f-53bf98caecac@googlegroups.com>
References: <e2d9b0e9-5f74-4283-ba4f-53bf98caecac@googlegroups.com>
Message-ID: <5162935A.7060405@rabbitmq.com>

On 05/04/13 16:27, ed anderson wrote:
> I'm using rabbitmq version 2.8.7, and i'm curious about what some of the
> stats that come out of the management plugin mean..

Hi!

> These are the things that I don't grok ( please direct me to the decoder
> ring if it exists, I'm happy to read about this topic, but I haven't
> found much via google-search ):
> FWIW, I'm interested in monitoring operational readiness, and throughput.
>
> inside /api/nodes ..
>   *  Is it good/bad/neither that mem_atom_used is 99% of mem_atom? Does
> this tell me anything about performance or availability?

In 2.x most of these mem_ things are taken straight from the figures 
reported by the underlying Erlang VM, without much regard for usefulness 
- see http://www.erlang.org/doc/man/erlang.html#memory-0.

In 3.0 this was rewritten to give a (somewhat) more RabbitMQ-centric and 
thus hopefully useful view of things.

>          "mem_atom": 1547217,
>          "mem_atom_used": 1536812,

>   * mem_alarm ( not listed ) , is clearly valuable for availability
> monitoring, but how is it triggered?

See memory based flow control at http://www.rabbitmq.com/memory.html

>          "mem_binary": 6349904,
>          "mem_code": 17345156,
>          "mem_ets": 1961472,
>          "mem_limit": 787570688,
>          "mem_proc": 18586392,
>          "mem_proc_used": 18559872,
>          "mem_used": 47203120,
>   * mem_atom_used + mem_binary + mem_code + mem_ets + mem_proc is
> _almost_ equal to mem_used, but not quite. It doesn't appear to be off
> by any reported counter.   Do I even care about that?  What matters from
> these counters?
>   * is mem_used / mem_limit  enough to keep track of my memory-related
> utilization and health?

Pretty much so. We occasionally might want to use the others for 
debugging, but they're quite obscure.

>   * run_queue ?  What is this a reference to ?

Again, quite obscure. This is an approximate equivalent of load average 
for Erlang processes inside the VM.

> inside /api/queues/{vhost}
>   * sometimes message_stats is in the output, and sometimes not.

...depending on whether any channels currently exist that are publishing 
to / consuming from the queue.

>   * if present, message_stats has two possible formats.

...depending on whether that's been going on long enough to calculate rates.

>     When rate is present, is it messages/sec?

Yes.

>     What does "publish" mean?

That's the raw count of publishes to that queue - but only those from 
channels which are still open. We'll be fixing that and making it 
monotonic in 3.1 (as well as adding a history).

>    (1)   "message_stats": {
>                "publish": 20
>           },
>    (2)  "message_stats": {
>               "publish_details": {
>                   "rate": 2.2547070391502824,
>                   "interval": 4435166,
>                   "last_event": 1365091799843
>             },
>            "publish": 40
>   * inside the backing_queue_status block, does the difference between
> q1 .. q4 matter ( from an operational point of view )

Probably not. Again backing_queue_status is mostly for debugging. q1 - 
q4 and delta are the internal queues that make up the AMQP queue, 
representing different levels of paged-outness.

>   * messages vs messages_ready vs messages_unacknowledged - what's with
> that?  Also, could their respective _details have changed as in the
> example above for message.

messages_ready - messages which could be consumed. 
messages_unacknowledged - messages which have already been consumed and 
are held waiting for the client to acknowledge. messages - the total of 
the two.

And yes, the code that adds _details is generic.

>   * why doesn't message_stats have a correlating "message" key?

What would that key represent?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Apr  8 10:53:27 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 08 Apr 2013 10:53:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ Trace not working
In-Reply-To: <72083490-62fd-4c40-b4d6-eaf392dda934@googlegroups.com>
References: <72083490-62fd-4c40-b4d6-eaf392dda934@googlegroups.com>
Message-ID: <51629397.2010308@rabbitmq.com>

On 05/04/13 22:17, Sandeep Aggarwal wrote:
> Hello -
>
> I'm trying to turn on the trace in order to watch the messages flowing
> between various queues. It used to be working earlier but ever since
> I've upgraded to version 3.0.0 onwards, I'm not able to see the trace
> option in the web admin console. When I try to turn on the trace feature
> using rabbitmqctl, it tells me that trace is on. However, I can't see
> the trace option in the admin menu. I have even tried to reinstall the
> management plugins but did not help.

In 3.x it moved to a submenu - you should be able to see it by clicking 
on the "admin" tab.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jandres at omie.es  Mon Apr  8 11:55:15 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Mon, 8 Apr 2013 10:55:15 +0000
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <51628858.5020600@rabbitmq.com>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
	<51628858.5020600@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA1096B3E@EXCHG01-OM.omel.es>

OK. The password is: 1234

Thank you!



-----Mensaje original-----
De: Emile Joubert [mailto:emile at rabbitmq.com] 
Enviado el: lunes, 08 de abril de 2013 11:05
Para: SAG - Jonathan Andr?s
CC: Discussions about RabbitMQ
Asunto: Re: [rabbitmq-discuss] SSL


On 08/04/13 09:06, SAG - Jonathan Andr?s wrote:
> The certificates are generated with Red Hat Certificate System 7.3

If you generate another certificate in the same way which exhibits the same problem will you be able to make that available for testing?



-Emile



-------------- next part --------------
A non-text attachment was scrubbed...
Name: DSISOFT99.p12
Type: application/x-pkcs12
Size: 3724 bytes
Desc: DSISOFT99.p12
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130408/f15d7238/attachment.p12>

From emile at rabbitmq.com  Mon Apr  8 17:15:25 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 08 Apr 2013 17:15:25 +0100
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA1096B3E@EXCHG01-OM.omel.es>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
	<51628858.5020600@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096B3E@EXCHG01-OM.omel.es>
Message-ID: <5162ED1D.6050603@rabbitmq.com>


Hi,

On 08/04/13 11:55, SAG - Jonathan Andr?s wrote:
> On 08/04/13 09:06, SAG - Jonathan Andr?s wrote:
>> The certificates are generated with Red Hat Certificate System 7.3
> 
> If you generate another certificate in the same way which exhibits
> the same problem


Can you please confirm that you get exactly the same error as before
with this certificate?


-Emile





From richard at raseley.com  Mon Apr  8 17:26:30 2013
From: richard at raseley.com (Richard Raseley)
Date: Mon, 8 Apr 2013 09:26:30 -0700
Subject: [rabbitmq-discuss] Federation Over SSL with Intermediate
	Certificate Authority
Message-ID: <CAO=6ox9+F9sprfF4TCBe5JV1ONvOn4Cr5WSuQx1H0aGhN9vgTA@mail.gmail.com>

When attempting to federate two brokers over SSL, I understand that one
would configure SSL as described in the RabbitMQ documentation,
then instantiate the federation connection over the port specified in the
SSL configuration. That seems pretty straight forward. What I am not seeing
any documentation on is the use of a certificate that requires an
intermediate certificate to validate.

I was able to find one thread from this discussion list from a while back (
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-March/018702.html),
but it is not 100% clear to me what was done there to successfully include
the intermediate certificate.

Is there any official guidance out there on how to use an intermediate
certificate in this scenario, or if not, could someone who has actually
done this before comment on the process required to get it working?

Thank you in advance.

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130408/2ae39166/attachment.htm>

From clujin at gmail.com  Tue Apr  9 01:50:34 2013
From: clujin at gmail.com (Lujin)
Date: Mon, 8 Apr 2013 17:50:34 -0700
Subject: [rabbitmq-discuss] Mechanism to Add Nodes to the Mirror Queue
	actively
Message-ID: <CAHNOpyQrjEoYHGRFikKc2w2_b_X0oRxe9JKPOTbP3zxssmgUcQ@mail.gmail.com>

Hello RabbitMQ Devs,

In recent days, I've been experimenting with RabbitMQ's HA mechanism to get
messages mirrored to different nodes. I am concerned mainly with fail over
scenarios where the message would be lost if all the nodes for Queue X goes
down.

What I have observed is that as it is right now (3.0.0), the broker doesn't
actively find a node in the cluster to mirror the queue whenever a node
fails over.*

However, I have find a trick/bug/scheme I can employ to have a node added.

What I did was to have the following policies:
(In the scenario that I only want to mirror to 2 other nodes)

rabbitmqctl set_policy HA-1 "^two\." '{"ha-mode":"exactly","ha-params":2}' 1

rabbitmqctl set_policy HA-2 "^two\." '{"ha-mode":"exactly","ha-params":3}' 2

So from the beginning, upon creation,  a queue follows the HA-2 policy with
the highest priority which matched the "pattern". If that policy is
deleted, it will either default to a lower priority policy or none. In this
case it wouldn't matter, because there's a fail over. However, I noticed
that if I add a 'new' policy right afterwards, the queue will retroactively
follow the new policy!

So what I do is, whenever a node fails over, I immediately delete the HA-2
policy and then immediately add the same HA-2 policy right back. This is
the only way that I know of that allows the queue to pick up a node from my
cluster for mirroring. (Without bringing the node back up) Yes, the new
node will be unsynchronized but with active synchronization, this is not a
big problem.

*So my question is: Are there other ways for a mirrored queue to actively
find node(s) in the cluster to mirror to without some intricate steps like
the ones above? Perhaps there's a plugin in the works or some new feature
in a upcoming version relaese?

I look forward to hearing what interesting plans you guys have in store for
RabbitMQ!

Regards,
Lujin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130408/b2654d48/attachment.htm>

From jandres at omie.es  Tue Apr  9 07:29:50 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Tue, 9 Apr 2013 06:29:50 +0000
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <5162ED1D.6050603@rabbitmq.com>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
	<51628858.5020600@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096B3E@EXCHG01-OM.omel.es>
	<5162ED1D.6050603@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA1096CD0@EXCHG01-OM.omel.es>

Yes, it's the same error.

In my java app I get an IOException:

.....
Padded plaintext before ENCRYPTION:  len = 32
0000: 01 6E FC 2A E2 FD AB 48   89 39 4D E2 57 AF FE 38  .n.*...H.9M.W..8
0010: 1F FE 8E 69 D2 0A 0A 0A   0A 0A 0A 0A 0A 0A 0A 0A  ...i............
main, WRITE: TLSv1 Application Data, length = 32
[Raw write]: length = 37
0000: 17 03 01 00 20 6B CB C7   4A 3B 0C C6 AB 4D 91 32  .... k..J;...M.2
0010: 1C C5 00 E8 4C 6A F5 81   2D 73 CE C4 2C E9 5B 79  ....Lj..-s..,.[y
0020: F9 C4 08 56 BF                                     ...V.
Padded plaintext before ENCRYPTION:  len = 48
0000: 00 01 00 00 00 05 00 14   00 0A 00 CE 71 CE EA 2A  ............q..*
0010: 79 05 5B 90 21 21 23 22   E6 8C 62 86 28 C0 02 12  y.[.!!#"..b.(...
0020: 0F 0F 0F 0F 0F 0F 0F 0F   0F 0F 0F 0F 0F 0F 0F 0F  ................
main, WRITE: TLSv1 Application Data, length = 48
[Raw write]: length = 53
0000: 17 03 01 00 30 A8 FE 5E   E8 7C 65 7A FE EE EC D7  ....0..^..ez....
0010: 75 79 6B 2D 19 58 47 12   F4 17 90 B4 46 06 27 84  uyk-.XG.....F.'.
0020: D8 36 69 BC B3 67 99 82   1E C2 0F 9F DE 1D DA 39  .6i..g.........9
0030: E1 2F 7C EF 71                                     ./..q
[Raw read]: length = 5
0000: 15 03 01 00 20                                     .... 
[Raw read]: length = 32
0000: 4C A8 61 69 CA BB 8A 0C   9A DF 51 13 46 5E 0F BF  L.ai......Q.F^..
0010: 28 A4 CC 3D 62 53 86 1E   5C A6 79 EA 42 06 25 C2  (..=bS..\.y.B.%.
AMQP Connection 127.0.0.1:5671, READ: TLSv1 Alert, length = 32
Padded plaintext after DECRYPTION:  len = 32
0000: 01 00 DA DA 68 F2 FA 9F   4F 2D 5C 51 12 9C 88 57  ....h...O-\Q...W
0010: C1 06 B0 FC 7C 3C 09 09   09 09 09 09 09 09 09 09  .....<..........
AMQP Connection 127.0.0.1:5671, RECV TLSv1 ALERT:  warning, close_notify
AMQP Connection 127.0.0.1:5671, called closeInternal(false)
AMQP Connection 127.0.0.1:5671, SEND TLSv1 ALERT:  warning, description = close_notify
Padded plaintext before ENCRYPTION:  len = 32
0000: 01 00 A5 22 B9 FF C9 25   0D AC B1 04 7A 90 78 BC  ..."...%....z.x.
0010: F7 98 84 A8 96 0F 09 09   09 09 09 09 09 09 09 09  ................
AMQP Connection 127.0.0.1:5671, WRITE: TLSv1 Alert, length = 32
[Raw write]: length = 37
0000: 15 03 01 00 20 D7 DB 40   94 77 51 4E 4C 97 BE CE  .... .. at .wQNL...
0010: E9 DC 1A BE 94 38 17 E9   0D F6 1B 4D 4D 85 A2 39  .....8.....MM..9
0020: D5 C7 60 2D 63                                     ..`-c
AMQP Connection 127.0.0.1:5671, called closeSocket(selfInitiated)
java.io.IOException
main, called close()
main, called closeInternal(true)
AMQP Connection 127.0.0.1:5671, called close()
AMQP Connection 127.0.0.1:5671, called closeInternal(true)


And this is the rabbitmq Log:

=INFO REPORT==== 9-Apr-2013::08:19:50 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 9-Apr-2013::08:19:50 ===
started SSL Listener on [::]:5671

=INFO REPORT==== 9-Apr-2013::08:19:50 ===
started SSL Listener on 0.0.0.0:5671

=INFO REPORT==== 9-Apr-2013::08:19:50 ===
Management agent started.

=INFO REPORT==== 9-Apr-2013::08:19:51 ===
Management plugin started. Port: 15672

=INFO REPORT==== 9-Apr-2013::08:19:51 ===
Statistics database started.

=INFO REPORT==== 9-Apr-2013::08:25:20 ===
accepting AMQP connection <0.331.0> (127.0.0.1:51980 -> 127.0.0.1:5671)

=ERROR REPORT==== 9-Apr-2013::08:25:23 ===
closing AMQP connection <0.331.0> (127.0.0.1:51980 -> 127.0.0.1:5671):
{handshake_error,opening,0,
                 {error,badarg,'connection.open',
                        [{io_lib,format,
                                 ["\\~2.16.0B",
                                  [[60,60,
                                    ["19",44,"9",44,"68",44,"83",44,"73",44,
                                     "83",44,"79",44,"70",44,"84",44,"57",44,
                                     "57"],
                                    62,62]]],
                                 [{file,"io_lib.erl"},{line,152}]},
                         {rabbit_misc,format,2,[]},
                         {rabbit_ssl,escape_rdn_value,2,[]},
                         {rabbit_ssl,format_rdn,1,[]},
                         {rabbit_ssl,'-format_complex_rdn/1-lc$^0/1-0-',1,[]},
                         {rabbit_ssl,format_complex_rdn,1,[]},
                         {rabbit_ssl,'-format_rdn_sequence/1-lc$^0/1-0-',1,[]},
                         {rabbit_ssl,'-format_rdn_sequence/1-lc$^0/1-0-',1,
                                     []}]}}



Thank you again! I do not know what else to do.







-----Mensaje original-----
De: Emile Joubert [mailto:emile at rabbitmq.com] 
Enviado el: lunes, 08 de abril de 2013 18:15
Para: SAG - Jonathan Andr?s
CC: Discussions about RabbitMQ
Asunto: Re: [rabbitmq-discuss] SSL


Hi,

On 08/04/13 11:55, SAG - Jonathan Andr?s wrote:
> On 08/04/13 09:06, SAG - Jonathan Andr?s wrote:
>> The certificates are generated with Red Hat Certificate System 7.3
> 
> If you generate another certificate in the same way which exhibits the 
> same problem


Can you please confirm that you get exactly the same error as before with this certificate?


-Emile





From Punit.Jain at emc.com  Tue Apr  9 07:39:41 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Tue, 9 Apr 2013 02:39:41 -0400
Subject: [rabbitmq-discuss] Error While starting rabbitmq server
Message-ID: <DB14E94115BBC84E8960C12C176D06762A93609C@MX25A.corp.emc.com>

Hi,
I have rabbitmq server(2.8.2) installed on my linux machine, but when I try to start it I get following error:
# rabbitmq-server
su: incorrect password

I have tried googling it but couldn't find anything useful. Help is really appreciated.

Thanks in Advance,
Punit
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130409/bb560f9c/attachment.htm>

From kilian.devouassoux at gmail.com  Tue Apr  9 10:14:08 2013
From: kilian.devouassoux at gmail.com (misterdev)
Date: Tue, 9 Apr 2013 02:14:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Very low delivery rate : how to diagnose ?
Message-ID: <24f7dc01-8ffc-4642-853c-5bed224470be@googlegroups.com>


Hello everybody.

I have a probleme in the implementation I have done of RabbitMQ, in a 
production environment :
I have very low delivery rate.
I have one perl processus (using library Net::RabbitMQ) listening to a 
queue with, as I speak, about 600 messages pending. I got some stats 
showing that it takes my process in average 3 seconds in order to receive a 
new message :
Here some code example : 
while($message = $mqConnection->recv()) {    
    # treat the message
}

Time to treat the message : about 0.1s
Time between two "receive" : in average 3s (sometimes 0.5s, sometimes 
10s...)

My question is : how can I debug this kind of situation ?

Some input : 
- This queue and its messages are durable.
- The listener has a prefetch_count of 1 ( # 
$mqConnection->basic_qos($mqChannelNumber,{prefetch_count => 1}); )
- All messages need to be Ack
- My processus and the rabbitmq broker are not on the same server but get a 
100Mb/s VPN between them.

Given these information, what do you think could help my processus getting 
messages more quickly ?
Should I play with the persistant mode before the prefetch_count or the 
contrary ?

Is there any other information I should check to understant what my problem 
could be ?

Thanks in advance for any help.

Yours,

Kilian D.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130409/feb23e11/attachment.htm>

From watson.timothy at gmail.com  Tue Apr  9 10:35:42 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 9 Apr 2013 10:35:42 +0100
Subject: [rabbitmq-discuss] Error While starting rabbitmq server
In-Reply-To: <DB14E94115BBC84E8960C12C176D06762A93609C@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D06762A93609C@MX25A.corp.emc.com>
Message-ID: <5E2CFA7C-37AF-4E3B-B04E-04DAC245254D@rabbitmq.com>

Start with the right user/permissions (via sudo and using /sbin/service or similar depending on your flavour of linux) might help (!?) and please consider upgrading to the latest version as that 2.8.x series is almost ancient now.

On 9 Apr 2013, at 07:39, "Jain, Punit" <Punit.Jain at emc.com> wrote:

> Hi,
> I have rabbitmq server(2.8.2) installed on my linux machine, but when I try to start it I get following error:
> # rabbitmq-server
> su: incorrect password
>  
> I have tried googling it but couldn?t find anything useful. Help is really appreciated.
>  
> Thanks in Advance,
> Punit
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130409/6bf5c314/attachment.htm>

From V_Rajendraprasad at mahindrasatyam.com  Tue Apr  9 10:56:37 2013
From: V_Rajendraprasad at mahindrasatyam.com (V_Rajendraprasad)
Date: Tue, 9 Apr 2013 09:56:37 +0000
Subject: [rabbitmq-discuss] Connection not openrd when try to connect server
	in RabbitMQ-C
Message-ID: <95DEA5F74D5FCB46AB720EA5906FF97F038E41EB@BSDMSATMBX002.mahindrasatyam.ad>

Hi to all
we are working on rabbitMQ by using C-APIs
when I try to connect server by using sample programs which are provided by rabbitmq-c library..
I tried my own  programs and example programs so many times initially all are working good.the connection is Good ,messagess also tx properly ...
suddenly the below error appread
ERROR I am Geeting: socket connection failure.
can any one suggest me...on this...


________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130409/7dbba496/attachment.htm>

From tim at rabbitmq.com  Tue Apr  9 11:17:08 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 9 Apr 2013 11:17:08 +0100
Subject: [rabbitmq-discuss] Connection not openrd when try to connect
	server in RabbitMQ-C
In-Reply-To: <95DEA5F74D5FCB46AB720EA5906FF97F038E41EB@BSDMSATMBX002.mahindrasatyam.ad>
References: <95DEA5F74D5FCB46AB720EA5906FF97F038E41EB@BSDMSATMBX002.mahindrasatyam.ad>
Message-ID: <39C639BF-2014-4AA8-B80F-5A6A4F7A2A69@rabbitmq.com>

Hi

On 9 Apr 2013, at 10:56, V_Rajendraprasad wrote:

> suddenly the below error appread
> ERROR I am Geeting: socket connection failure.
> can any one suggest me...on this...  

Looks like a 'socket connection failure' to me! ;)

Have you checked to see if a network interruption (interface down, firewall/rules changed, etc) could've terminated the connection? Are you sure that the broker is still up and running and contactable on the requisite port(s) from the client?

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130409/5710245b/attachment.htm>

From tim at rabbitmq.com  Tue Apr  9 11:17:53 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 9 Apr 2013 11:17:53 +0100
Subject: [rabbitmq-discuss] Connection not openrd when try to connect
	server in RabbitMQ-C
In-Reply-To: <95DEA5F74D5FCB46AB720EA5906FF97F038E41EB@BSDMSATMBX002.mahindrasatyam.ad>
References: <95DEA5F74D5FCB46AB720EA5906FF97F038E41EB@BSDMSATMBX002.mahindrasatyam.ad>
Message-ID: <3CA6BDA9-7326-4F39-B4A2-3D27AC0D4A57@rabbitmq.com>

Hi

On 9 Apr 2013, at 10:56, V_Rajendraprasad wrote:

> suddenly the below error appread
> ERROR I am Geeting: socket connection failure.
> can any one suggest me...on this...  

Looks like a 'socket connection failure' to me! ;)

Have you checked to see if a network interruption (interface down, firewall/rules changed, etc) could've terminated the connection? Are you sure that the broker is still up and running and contactable on the requisite port(s) from the client?

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130409/5feff174/attachment.htm>

From simon at rabbitmq.com  Tue Apr  9 11:33:30 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 09 Apr 2013 11:33:30 +0100
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA1096CD0@EXCHG01-OM.omel.es>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
	<51628858.5020600@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096B3E@EXCHG01-OM.omel.es>
	<5162ED1D.6050603@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096CD0@EXCHG01-OM.omel.es>
Message-ID: <5163EE7A.5030206@rabbitmq.com>

On 09/04/13 07:29, SAG - Jonathan Andr?s wrote:
> Yes, it's the same error.

Hi. I have installed the certificates you sent and can connect 
successfully. Can you tell me about your configuration? Which versions 
of RabbitMQ and Erlang? How is SSL configured? Are you using any unusual 
auth mechanisms or backends?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jandres at omie.es  Tue Apr  9 11:36:55 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Tue, 9 Apr 2013 10:36:55 +0000
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <5163EE7A.5030206@rabbitmq.com>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
	<51628858.5020600@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096B3E@EXCHG01-OM.omel.es>
	<5162ED1D.6050603@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096CD0@EXCHG01-OM.omel.es>
	<5163EE7A.5030206@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA1096DA7@EXCHG01-OM.omel.es>

Thanks!

I'm the RabbitMQ server on my computer:

	Windows 7
	RabbitMQ Server 3.0.4
	Erlang 5.10.1
	JRE 1.0.0_17
	OpenSSL 1.0.1e

I Installed everything last week, so I think it is fairly updated.	

And this is my rabbitmq.config:

[
  {rabbit, [
     {ssl_listeners, [5671]},
     {ssl_options, [{cacertfile,"C:/cert/omie/www/ssl.ca/ca.pem"},
                    {certfile,"C:/cert/omie/www/ssl.crt/apache.pem"},
                    {keyfile,"C:/cert/omie/www/ssl.key/apache.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,true}]}
   ]}
].


Thank you again!




-----Mensaje original-----
De: Simon MacMullen [mailto:simon at rabbitmq.com] 
Enviado el: martes, 09 de abril de 2013 12:34
Para: Discussions about RabbitMQ
CC: SAG - Jonathan Andr?s
Asunto: Re: [rabbitmq-discuss] SSL

On 09/04/13 07:29, SAG - Jonathan Andr?s wrote:
> Yes, it's the same error.

Hi. I have installed the certificates you sent and can connect successfully. Can you tell me about your configuration? Which versions of RabbitMQ and Erlang? How is SSL configured? Are you using any unusual auth mechanisms or backends?

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Apr  9 11:42:54 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 09 Apr 2013 11:42:54 +0100
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA1096DA7@EXCHG01-OM.omel.es>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
	<51628858.5020600@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096B3E@EXCHG01-OM.omel.es>
	<5162ED1D.6050603@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096CD0@EXCHG01-OM.omel.es>
	<5163EE7A.5030206@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DA7@EXCHG01-OM.omel.es>
Message-ID: <5163F0AE.5090804@rabbitmq.com>

On 09/04/13 11:36, SAG - Jonathan Andr?s wrote:
>                      {verify,verify_peer},
>                      {fail_if_no_peer_cert,true}]}

Ah. So maybe the problem is with the client cert? Can you give me the 
corresponding client cert / key?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Apr  9 11:48:28 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 09 Apr 2013 11:48:28 +0100
Subject: [rabbitmq-discuss] Mechanism to Add Nodes to the Mirror Queue
 actively
In-Reply-To: <CAHNOpyQrjEoYHGRFikKc2w2_b_X0oRxe9JKPOTbP3zxssmgUcQ@mail.gmail.com>
References: <CAHNOpyQrjEoYHGRFikKc2w2_b_X0oRxe9JKPOTbP3zxssmgUcQ@mail.gmail.com>
Message-ID: <5163F1FC.5020406@rabbitmq.com>

On 09/04/13 01:50, Lujin wrote:
> Hello RabbitMQ Devs,
>
> In recent days, I've been experimenting with RabbitMQ's HA mechanism to
> get messages mirrored to different nodes. I am concerned mainly with
> fail over scenarios where the message would be lost if all the nodes for
> Queue X goes down.
>
> What I have observed is that as it is right now (3.0.0), the broker
> doesn't actively find a node in the cluster to mirror the queue whenever
> a node fails over.*

Yeah. The reason for this is to avoid repeatedly migrating queues to new 
nodes when shutting down a cluster.

Otherwise imagine you have a cluster ABCD. The queue is on AB. You shut 
down A; it starts up on C. You shut down B, it starts up on D - and 
you've lost data if the queue didn't get time to synchronise.

> So what I do is, whenever a node fails over, I immediately delete the
> HA-2 policy and then immediately add the same HA-2 policy right back.
> This is the only way that I know of that allows the queue to pick up a
> node from my cluster for mirroring. (Without bringing the node back up)
> Yes, the new node will be unsynchronized but with active
> synchronization, this is not a big problem.

Understandable.

> *So my question is: Are there other ways for a mirrored queue to
> actively find node(s) in the cluster to mirror to without some intricate
> steps like the ones above? Perhaps there's a plugin in the works or some
> new feature in a upcoming version relaese?

I'm afraid not yet.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Apr  9 11:55:30 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 09 Apr 2013 11:55:30 +0100
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA1096DC1@EXCHG01-OM.omel.es>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
	<51628858.5020600@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096B3E@EXCHG01-OM.omel.es>
	<5162ED1D.6050603@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096CD0@EXCHG01-OM.omel.es>
	<5163EE7A.5030206@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DA7@EXCHG01-OM.omel.es>
	<5163F0AE.5090804@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DC1@EXCHG01-OM.omel.es>
Message-ID: <5163F3A2.8050504@rabbitmq.com>

I believe that's still the server side cert. Can you send my the cert 
your client is using?

Cheers, Simon

On 09/04/13 11:50, SAG - Jonathan Andr?s wrote:
> Yes,
>
> I can give you the certificate (is just for testing). The password is 1234
>
> I can use the certificate in others SSL connections (HTTPS) without problems. And I can establish the SSL connection with OpenSSL:
>
> 	openssl s_server -accept 8443 ....
> 	openssl s_client -connect localhost:8443 .....
>
> Do you think there is something wrong in the certificate?
>
> Thank you again!
>
>
> -----Mensaje original-----
> De: Simon MacMullen [mailto:simon at rabbitmq.com]
> Enviado el: martes, 09 de abril de 2013 12:43
> Para: SAG - Jonathan Andr?s
> CC: Discussions about RabbitMQ
> Asunto: Re: [rabbitmq-discuss] SSL
>
> On 09/04/13 11:36, SAG - Jonathan Andr?s wrote:
>>                       {verify,verify_peer},
>>                       {fail_if_no_peer_cert,true}]}
>
> Ah. So maybe the problem is with the client cert? Can you give me the corresponding client cert / key?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Apr  9 11:59:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 09 Apr 2013 11:59:45 +0100
Subject: [rabbitmq-discuss] Error While starting rabbitmq server
In-Reply-To: <DB14E94115BBC84E8960C12C176D06762A93609C@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D06762A93609C@MX25A.corp.emc.com>
Message-ID: <5163F4A1.4060303@rabbitmq.com>

For some of our packagings "rabbitmq-server" will attempt to su to the 
rabbitmq user if invoked as root. Normally we expect this will succeed 
without a password. How did you install? Note that if you installed from 
.deb / RPM then you probably want "/etc/init.d/rabbitmq-server start".

Also, as Tim said, 2.8.2 is quite old.

Cheers, Simon

On 09/04/13 07:39, Jain, Punit wrote:
> Hi,
>
> I have rabbitmq server(2.8.2) installed on my linux machine, but when I
> try to start it I get following error:
>
> # rabbitmq-server
>
> su: incorrect password
>
> I have tried googling it but couldn?t find anything useful. Help is
> really appreciated.
>
> Thanks in Advance,
>
> Punit
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From jandres at omie.es  Tue Apr  9 12:13:32 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Tue, 9 Apr 2013 11:13:32 +0000
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <5163F3A2.8050504@rabbitmq.com>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
	<51628858.5020600@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096B3E@EXCHG01-OM.omel.es>
	<5162ED1D.6050603@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096CD0@EXCHG01-OM.omel.es>
	<5163EE7A.5030206@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DA7@EXCHG01-OM.omel.es>
	<5163F0AE.5090804@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DC1@EXCHG01-OM.omel.es>
	<5163F3A2.8050504@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA1096DE2@EXCHG01-OM.omel.es>

I use the next code to connect to the server:

	ConnectionFactory factory = new ConnectionFactory();
	factory.setHost("localhost");

But the server cert was not emitted for localhost. Maybe this is the problem? What URL should be used to issue the certificate? localhost?

Thank you!
 





-----Mensaje original-----
De: Simon MacMullen [mailto:simon at rabbitmq.com] 
Enviado el: martes, 09 de abril de 2013 12:56
Para: SAG - Jonathan Andr?s
CC: rabbitmq-discuss
Asunto: Re: [rabbitmq-discuss] SSL

I believe that's still the server side cert. Can you send my the cert your client is using?

Cheers, Simon

On 09/04/13 11:50, SAG - Jonathan Andr?s wrote:
> Yes,
>
> I can give you the certificate (is just for testing). The password is 
> 1234
>
> I can use the certificate in others SSL connections (HTTPS) without problems. And I can establish the SSL connection with OpenSSL:
>
> 	openssl s_server -accept 8443 ....
> 	openssl s_client -connect localhost:8443 .....
>
> Do you think there is something wrong in the certificate?
>
> Thank you again!
>
>
> -----Mensaje original-----
> De: Simon MacMullen [mailto:simon at rabbitmq.com] Enviado el: martes, 09 
> de abril de 2013 12:43
> Para: SAG - Jonathan Andr?s
> CC: Discussions about RabbitMQ
> Asunto: Re: [rabbitmq-discuss] SSL
>
> On 09/04/13 11:36, SAG - Jonathan Andr?s wrote:
>>                       {verify,verify_peer},
>>                       {fail_if_no_peer_cert,true}]}
>
> Ah. So maybe the problem is with the client cert? Can you give me the corresponding client cert / key?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>


--
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue Apr  9 12:39:25 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 09 Apr 2013 12:39:25 +0100
Subject: [rabbitmq-discuss] Very low delivery rate : how to diagnose ?
In-Reply-To: <24f7dc01-8ffc-4642-853c-5bed224470be@googlegroups.com>
References: <24f7dc01-8ffc-4642-853c-5bed224470be@googlegroups.com>
Message-ID: <5163FDED.4010704@rabbitmq.com>


Hi,

On 09/04/13 10:14, misterdev wrote:
> Given these information, what do you think could help my processus
> getting messages more quickly ?
> Should I play with the persistant mode before the prefetch_count or the
> contrary ?


Using modest hardware I'm able to send and receive a few dozen small
durable messages per second using consume() and recv() in Net::RabbitMQ,
with prefetch_count set to 1 and client-side acknowledgements.

Raising the prefetch count should improve throughput significantly.

You could also compare the performance of the Java client using
MulticastMain to confirm that your infrastructure is capable of better
throughput.

The delay you report falls within the range of a DNS timeout. Make sure
your throughput is not held back by name resolution.



-Emile










From Chris.Nicel at 15below.com  Tue Apr  9 13:45:58 2013
From: Chris.Nicel at 15below.com (Chris Nicel)
Date: Tue, 9 Apr 2013 07:45:58 -0500
Subject: [rabbitmq-discuss] Clustering and Scalability
Message-ID: <A57B6B00637AF741A9FA2D006B40C3C882A0C86EC2@AUSP01VMBX29.collaborationhost.net>

Hi Guys,

We are looking to use RabbitMQ as a messagebus in a scalable application. In order to achieve complete scalability it is important that we can ramp up our RabbitMQ cluster to have more nodes when a performance bottleneck is realised.

I have reviewed the clustering guidelines and understand the queues do not migrate across a cluster when the nodes are being taken down. If a node fails/is taken down then queues for which it maintained will no longer be protected if an HA policy of exactly two nodes is used, until that node is restored that is.

I believe these three questions will further my understanding:

Is there a way to re-nice the queues across the cluster to even out the load?

Is there a way to migrate already existing queues to new nodes as slaves?

If a queue loses a node and a new node is added to the cluster, will the new node join the ha policy for that particular queue?


Thanks in advance.

Chris

 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From simon at rabbitmq.com  Tue Apr  9 13:46:43 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 09 Apr 2013 13:46:43 +0100
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA1096DE2@EXCHG01-OM.omel.es>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
	<51628858.5020600@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096B3E@EXCHG01-OM.omel.es>
	<5162ED1D.6050603@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096CD0@EXCHG01-OM.omel.es>
	<5163EE7A.5030206@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DA7@EXCHG01-OM.omel.es>
	<5163F0AE.5090804@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DC1@EXCHG01-OM.omel.es>
	<5163F3A2.8050504@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DE2@EXCHG01-OM.omel.es>
Message-ID: <51640DB3.7070706@rabbitmq.com>

On 09/04/13 12:13, SAG - Jonathan Andr?s wrote:
> I use the next code to connect to the server:
>
> 	ConnectionFactory factory = new ConnectionFactory();
> 	factory.setHost("localhost");
>
> But the server cert was not emitted for localhost. Maybe this is the problem? What URL should be used to issue the certificate? localhost?

OK, now I'm confused. Looking back at your original post I see you ware 
using this certificate for the client. In that case I must be missing 
the certificate you are using for the server. I note that trying to use 
the same cert for both gives the error "Extended key usage does not 
permit use for TLS server authentication" - which suggests that the cert 
really is a client cert.

So can you send the certificate / key you are using on the server side?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From aggarwalsandeep at optonline.net  Tue Apr  9 15:15:00 2013
From: aggarwalsandeep at optonline.net (Sandeep Aggarwal)
Date: Tue, 9 Apr 2013 07:15:00 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Trace not working
In-Reply-To: <72083490-62fd-4c40-b4d6-eaf392dda934@googlegroups.com>
References: <72083490-62fd-4c40-b4d6-eaf392dda934@googlegroups.com>
Message-ID: <13e43318-e0e7-4f8c-a5ab-fcdbfc889f89@googlegroups.com>

I realized that even though I had enabled trade using rabbitmqctl, I had 
not enabled the trace plugin. Once I enabled the trace plugin using 
rabbitmq-plugins enable rabbitmq_tracing, I was able to get this to work. 
Thx!

On Friday, April 5, 2013 5:17:23 PM UTC-4, Sandeep Aggarwal wrote:
>
> Hello - 
>
> I'm trying to turn on the trace in order to watch the messages flowing 
> between various queues. It used to be working earlier but ever since I've 
> upgraded to version 3.0.0 onwards, I'm not able to see the trace option in 
> the web admin console. When I try to turn on the trace feature using 
> rabbitmqctl, it tells me that trace is on. However, I can't see the trace 
> option in the admin menu. I have even tried to reinstall the management 
> plugins but did not help.
>
> Please advise what am I missing.
>
> Thanks,
> Sandy
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130409/82ac3355/attachment.htm>

From simon at rabbitmq.com  Tue Apr  9 16:25:26 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 09 Apr 2013 16:25:26 +0100
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <51640DB3.7070706@rabbitmq.com>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
	<51628858.5020600@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096B3E@EXCHG01-OM.omel.es>
	<5162ED1D.6050603@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096CD0@EXCHG01-OM.omel.es>
	<5163EE7A.5030206@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DA7@EXCHG01-OM.omel.es>
	<5163F0AE.5090804@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DC1@EXCHG01-OM.omel.es>
	<5163F3A2.8050504@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DE2@EXCHG01-OM.omel.es>
	<51640DB3.7070706@rabbitmq.com>
Message-ID: <516432E6.8070604@rabbitmq.com>

In the end I have replicated this using another server certificate. 
There's a somewhat unusual type OID (0.9.2342.19200300.100.1.1) in the 
cert whose value is not getting decoded properly. I'll chase with the 
Erlang folks, and the next version of RabbitMQ to be released will 
contain a workaround.

Cheers, Simon

On 09/04/13 13:46, Simon MacMullen wrote:



-- 
Simon MacMullen
RabbitMQ, VMware

From jandres at omie.es  Tue Apr  9 16:32:22 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Tue, 9 Apr 2013 15:32:22 +0000
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <516432E6.8070604@rabbitmq.com>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
	<51628858.5020600@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096B3E@EXCHG01-OM.omel.es>
	<5162ED1D.6050603@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096CD0@EXCHG01-OM.omel.es>
	<5163EE7A.5030206@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DA7@EXCHG01-OM.omel.es>
	<5163F0AE.5090804@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DC1@EXCHG01-OM.omel.es>
	<5163F3A2.8050504@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DE2@EXCHG01-OM.omel.es>
	<51640DB3.7070706@rabbitmq.com> <516432E6.8070604@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA1096E5D@EXCHG01-OM.omel.es>

Thank you very much! 

Is there an approximate date for the next version of RabbitMQ?



-----Mensaje original-----
De: Simon MacMullen [mailto:simon at rabbitmq.com] 
Enviado el: martes, 09 de abril de 2013 17:25
Para: Discussions about RabbitMQ
CC: SAG - Jonathan Andr?s
Asunto: Re: [rabbitmq-discuss] SSL

In the end I have replicated this using another server certificate. 
There's a somewhat unusual type OID (0.9.2342.19200300.100.1.1) in the cert whose value is not getting decoded properly. I'll chase with the Erlang folks, and the next version of RabbitMQ to be released will contain a workaround.

Cheers, Simon

On 09/04/13 13:46, Simon MacMullen wrote:



--
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Apr  9 16:34:10 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 09 Apr 2013 16:34:10 +0100
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <1BA7091C5FA9834BB45EFCC77F3E3BA1096E5D@EXCHG01-OM.omel.es>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
	<51628858.5020600@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096B3E@EXCHG01-OM.omel.es>
	<5162ED1D.6050603@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096CD0@EXCHG01-OM.omel.es>
	<5163EE7A.5030206@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DA7@EXCHG01-OM.omel.es>
	<5163F0AE.5090804@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DC1@EXCHG01-OM.omel.es>
	<5163F3A2.8050504@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DE2@EXCHG01-OM.omel.es>
	<51640DB3.7070706@rabbitmq.com> <516432E6.8070604@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096E5D@EXCHG01-OM.omel.es>
Message-ID: <516434F2.2080505@rabbitmq.com>

This month hopefully.

On 09/04/13 16:32, SAG - Jonathan Andr?s wrote:
> Thank you very much!
>
> Is there an approximate date for the next version of RabbitMQ?
>
>
>
> -----Mensaje original-----
> De: Simon MacMullen [mailto:simon at rabbitmq.com]
> Enviado el: martes, 09 de abril de 2013 17:25
> Para: Discussions about RabbitMQ
> CC: SAG - Jonathan Andr?s
> Asunto: Re: [rabbitmq-discuss] SSL
>
> In the end I have replicated this using another server certificate.
> There's a somewhat unusual type OID (0.9.2342.19200300.100.1.1) in the cert whose value is not getting decoded properly. I'll chase with the Erlang folks, and the next version of RabbitMQ to be released will contain a workaround.
>
> Cheers, Simon
>
> On 09/04/13 13:46, Simon MacMullen wrote:
>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>


-- 
Simon MacMullen
RabbitMQ, VMware

From jandres at omie.es  Tue Apr  9 16:35:00 2013
From: jandres at omie.es (=?iso-8859-1?Q?SAG_-_Jonathan_Andr=E9s?=)
Date: Tue, 9 Apr 2013 15:35:00 +0000
Subject: [rabbitmq-discuss] SSL
In-Reply-To: <516434F2.2080505@rabbitmq.com>
References: <5e8e31e9-9774-4b90-a6ab-f0d252696f46@googlegroups.com>
	<515E9724.1050301@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA10968FF@EXCHG01-OM.omel.es>
	<515EAFD1.2040201@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096A04@EXCHG01-OM.omel.es>
	<515ECC98.3040409@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096ADB@EXCHG01-OM.omel.es>
	<51628858.5020600@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096B3E@EXCHG01-OM.omel.es>
	<5162ED1D.6050603@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096CD0@EXCHG01-OM.omel.es>
	<5163EE7A.5030206@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DA7@EXCHG01-OM.omel.es>
	<5163F0AE.5090804@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DC1@EXCHG01-OM.omel.es>
	<5163F3A2.8050504@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096DE2@EXCHG01-OM.omel.es>
	<51640DB3.7070706@rabbitmq.com> <516432E6.8070604@rabbitmq.com>
	<1BA7091C5FA9834BB45EFCC77F3E3BA1096E5D@EXCHG01-OM.omel.es>
	<516434F2.2080505@rabbitmq.com>
Message-ID: <1BA7091C5FA9834BB45EFCC77F3E3BA1096E72@EXCHG01-OM.omel.es>

Good news!

Thank you so much!


-----Mensaje original-----
De: Simon MacMullen [mailto:simon at rabbitmq.com] 
Enviado el: martes, 09 de abril de 2013 17:34
Para: SAG - Jonathan Andr?s
CC: Discussions about RabbitMQ
Asunto: Re: [rabbitmq-discuss] SSL

This month hopefully.

On 09/04/13 16:32, SAG - Jonathan Andr?s wrote:
> Thank you very much!
>
> Is there an approximate date for the next version of RabbitMQ?
>
>
>
> -----Mensaje original-----
> De: Simon MacMullen [mailto:simon at rabbitmq.com] Enviado el: martes, 09 
> de abril de 2013 17:25
> Para: Discussions about RabbitMQ
> CC: SAG - Jonathan Andr?s
> Asunto: Re: [rabbitmq-discuss] SSL
>
> In the end I have replicated this using another server certificate.
> There's a somewhat unusual type OID (0.9.2342.19200300.100.1.1) in the cert whose value is not getting decoded properly. I'll chase with the Erlang folks, and the next version of RabbitMQ to be released will contain a workaround.
>
> Cheers, Simon
>
> On 09/04/13 13:46, Simon MacMullen wrote:
>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>


--
Simon MacMullen
RabbitMQ, VMware

From tomer.paz at gmail.com  Tue Apr  9 17:05:04 2013
From: tomer.paz at gmail.com (Tomer Paz)
Date: Tue, 9 Apr 2013 09:05:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Newbee consulting question
Message-ID: <b2781511-9ee4-4a2b-b479-76b20b5976a5@googlegroups.com>

Hi.

I am examining RabbitMQ as an AMQP broker for a workflow system that we 
wish to develop in-house, on-premise.
The closest description to our architecture is Amazon SWF. it is ~95% the 
solution concept to our requirements, but we can't use it as it is a cloud 
SaaS and our requirement is 'on-premise' :)

I was wondering How to manage distributed Tasks where the task manager 
('orchestrator') is at the data-center, 
 the workers are distributed in different physical sites (some on the same 
site, some far in other site separated by WAN),
 where the connection between the datacenter and the sites might be 
disrupted sometimes.

We don't have a major performance requirement, we need not thousands of 
msg/sec, more like 1-3k messages a minute. Each worker might work for 
minutes on a single task...

Since the requirement is for WorkFlow management, it means we want tasks 
marked done by a remote worker, will be reported back to the manager, to 
keep the State of all tasks managed in central manner.
We use that for monitoring and reports (statistics).
I have read about the RPC like pattern, prefer to avoid it (!)
I also read the tutorials about task/worker pattern which is closer to what 
we need, but we also need the capability to parallelise 'steps' (that's 
what workflow orchestration is about) within a parent task so that
some tasks in the workflow tree will be processed consequently, some in 
parallel. 
Assume workers are not necessarily the same. i.e. there are different task 
"types" thus different workers processing them (hence this is not a simple 
pub/sub pattern either).

It sounds like we need some kind of mixture of three patterns to pull this 
out, but I am not sure: task/worker, pub/sub and the "Topic" Exchange kind 
of routing.
Oh, and did I mention we want the architecture to be "pull" rather than 
"push" in terms of workers 'asking' the workflow manager to get new tasks 
when they are free, 
 rather than task manager pushing tasks to workers blindly.

Would love to hear some experience if there is such, with such pattern 
using AMQ and RubbitMQ in particular to communicate the tasks.

TIA
Tomer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130409/25ca3e17/attachment.htm>

From emile at rabbitmq.com  Wed Apr 10 10:06:56 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 10 Apr 2013 10:06:56 +0100
Subject: [rabbitmq-discuss] Newbee consulting question
In-Reply-To: <b2781511-9ee4-4a2b-b479-76b20b5976a5@googlegroups.com>
References: <b2781511-9ee4-4a2b-b479-76b20b5976a5@googlegroups.com>
Message-ID: <51652BB0.1040400@rabbitmq.com>


Hi,


On 09/04/13 17:05, Tomer Paz wrote:
> The closest description to our architecture is Amazon SWF. it is ~95%
> the solution concept to our requirements, but we can't use it as it is a
> cloud SaaS and our requirement is 'on-premise' :)

Have you looked at Celery? http://www.celeryproject.org/
However your requirements look sufficiently unique that you will
probably need to create a more specialised workflow manager.

> I was wondering How to manage distributed Tasks where the task
> manager ('orchestrator') is at the data-center, the workers are
> distributed in different physical sites (some on the same site, some
> far in other site separated by WAN), where the connection between the
> datacenter and the sites might be disrupted sometimes.

In general workers connect to the broker via AMQP. If the connection
between the broker and the worker is disrupted then any unacknowledged
messages held by that worker will become available at the broker and
will need to be repeated. If the likelihood of network disconnection is
great then workers should communicate the work completion event via
publishing a new message instead of acknowledging the work message.

> Since the requirement is for WorkFlow management, it means we want tasks
> marked done by a remote worker, will be reported back to the manager, to
> keep the State of all tasks managed in central manner.

Workers can publish as well as consume messages. Workers can publish the
outcome of a piece of work to a dedicated queue used for tracking and
statistics.

> we also need the capability to parallelise 'steps' (that's what
> workflow orchestration is about) within a parent task so that some
> tasks in the workflow tree will be processed consequently, some in 
> parallel.

Work will be executed in parallel if workers consume message with a
small prefetch count, or if they retrieve work synchronously with
basic.get. There are different ways of ensuring that a set of tasks are
performed in sequence - the simplest is to roll up all the details of
the work into a single message. Workers that complete one stage of
processing republish an updated version of the message to the next
stage, possibly using a different queue for each stage.

> Assume workers are not necessarily the same. i.e. there are different
> task "types" thus different workers processing them (hence this is not a
> simple pub/sub pattern either).

You can meet this requirement by routing messages to work queues
according to their type, and having workers of the same type consume
messages from queues containing the appropriate type of message.

> we want the architecture to be "pull" rather than "push" in terms of
> workers 'asking' the workflow manager to get new tasks when they are
> free, rather than task manager pushing tasks to workers blindly.

Workers can retrieve messages from a queue synchronously using the
basic.get method.




-Emile










From efuquen at gmail.com  Tue Apr  9 23:10:23 2013
From: efuquen at gmail.com (ed)
Date: Tue, 9 Apr 2013 15:10:23 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-server with esl-erlang in debian
Message-ID: <6f01c607-fe2e-47bf-bd9c-21eabc3619e3@a14g2000vbm.googlegroups.com>

I was wondering if anyone here has any solution to install rabbitmq-
server debian package with esl-erlang (version of erlang from their
repos vs standard debian repos)?  Right now the rabbitmq-server
default debian package depends on the standard erlang but I want to
run it with the latest stable one.  The only resource I could find for
someone doing this was this script that makes "fake" packages to make
rabbitmq-server thing erlang it's installed and install esl-erlang on
top of that:

https://gist.github.com/RJ/2284940

This is a somewhat hacky solution, I would prefer to have a package
that just depends on esl-erlang but before I go through the trouble of
building a package myself I want to know if someone here as

a) already done that or
b) has another solution that would be less hacky then the above script

From menita.subramanian at hp.com  Tue Apr  9 23:38:21 2013
From: menita.subramanian at hp.com (Subramanian, Menita)
Date: Tue, 9 Apr 2013 22:38:21 +0000
Subject: [rabbitmq-discuss]  Running RabbitMQ as a different user
Message-ID: <A9CB1E1C542C314BAE6B959E894CA9FE0BBDA7A1@G1W3654.americas.hpqcorp.net>

Hi,

I am trying to run the rabbitmqctl script to create new user and set-user-tag. I have the commands declared in a bash script file that takes a username and password as parameters. I updates the sudoers file and allowed the webapplication to run the script as root. But that did not work. I have very limited knowledge of Rabbitmq setup and configuration.

Here is the error I see on the output file when I run the script that creates the user...

Kernel pid terminated (application_controller) ({application_start_failure,kernel,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,auth,{"Failed to create cookie file '/ci/

The error message at the end appears incomplete in my text output...not sure why.

Regards,

Menita

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130409/e506911a/attachment.htm>

From jiri.kuchta at deutsche-boerse.com  Wed Apr 10 08:25:35 2013
From: jiri.kuchta at deutsche-boerse.com (jkuchta.db)
Date: Wed, 10 Apr 2013 00:25:35 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ crashed after all memory was consumed
Message-ID: <1365578735193-25952.post@n5.nabble.com>

Hi 

RabbitMQ version 2.7.1, Erlang R14B (erts-5.8.1)

RabbitMQ crashed after several weeks of running. I have Erlang VM dump. It
shows that almost 3GB of memory was allocated and there was no more memory
available. It looks like a memory leak. I am not able to figure out what
consumed all the memory from the Erlang dump.

RabbitMQ log is attached.

The zipped dump has 23MB. Is it ok if I attached the file here?

Is it possible to find out were the leak is? Is it rabbitmq, erlang or just
too many messages (it should not be the case as all the messages we produce
have rather short TTL 1 minute and we do not produce a high load either)?

rabbitmq.log
<http://rabbitmq.1065348.n5.nabble.com/file/n25952/rabbitmq.log>  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-crashed-after-all-memory-was-consumed-tp25952.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Wed Apr 10 10:17:10 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 10 Apr 2013 10:17:10 +0100
Subject: [rabbitmq-discuss] Running RabbitMQ as a different user
In-Reply-To: <A9CB1E1C542C314BAE6B959E894CA9FE0BBDA7A1@G1W3654.americas.hpqcorp.net>
References: <A9CB1E1C542C314BAE6B959E894CA9FE0BBDA7A1@G1W3654.americas.hpqcorp.net>
Message-ID: <51652E16.6000806@rabbitmq.com>


Hi Menita,

On 09/04/13 23:38, Subramanian, Menita wrote:
> I am trying to run the rabbitmqctl script to create new user and
> set-user-tag.

You may be able to achieve a similar effect by loading a definition file
via the management plugin:

http://www.rabbitmq.com/management.html#load-definitions

> Kernel pid terminated (application_controller) 
> ({application_start_failure,kernel, {{shutdown,
> {failed_to_start_child,net_sup, {shutdown, {failed_to_start_child, auth,
> {"Failed to create cookie file '/ci/

This error indicates that the broker was running as a user without
permission to write to its own $HOME directory. Ensure that the broker
runs in a security context with permission to create files in $HOME.




-Emile




From emile at rabbitmq.com  Wed Apr 10 10:26:12 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 10 Apr 2013 10:26:12 +0100
Subject: [rabbitmq-discuss] Running RabbitMQ as a different user
In-Reply-To: <51652E16.6000806@rabbitmq.com>
References: <A9CB1E1C542C314BAE6B959E894CA9FE0BBDA7A1@G1W3654.americas.hpqcorp.net>
	<51652E16.6000806@rabbitmq.com>
Message-ID: <51653034.5010606@rabbitmq.com>

On 10/04/13 10:17, Emile Joubert wrote:
>> Kernel pid terminated (application_controller) 
>> ({application_start_failure,kernel, {{shutdown,
>> {failed_to_start_child,net_sup, {shutdown, {failed_to_start_child, auth,
>> {"Failed to create cookie file '/ci/
> 
> This error indicates that the broker was running as a user


Sorry, it "rabbitmqctl" rather than the broker that was running as user
with insufficient privileges. Your script should get further if it runs
as a user with an erlang cookie file that matches the broker.



-Emile






From emile at rabbitmq.com  Wed Apr 10 10:33:58 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 10 Apr 2013 10:33:58 +0100
Subject: [rabbitmq-discuss] RabbitMQ crashed after all memory was
	consumed
In-Reply-To: <1365578735193-25952.post@n5.nabble.com>
References: <1365578735193-25952.post@n5.nabble.com>
Message-ID: <51653206.5000407@rabbitmq.com>


Hi,

On 10/04/13 08:25, jkuchta.db wrote:
> The zipped dump has 23MB. Is it ok if I attached the file here?

Please get in touch via support at rabbitmq.com to arrange transfer instead
of attempting to attach such a big file.

> rabbitmq.log
> <http://rabbitmq.1065348.n5.nabble.com/file/n25952/rabbitmq.log>  

The error in this log says "enospc" which means the disk was full. Disk
space monitoring was added in v2.8.2 so you are advised to upgrade.



-Emile








From simon at rabbitmq.com  Wed Apr 10 10:54:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Apr 2013 10:54:31 +0100
Subject: [rabbitmq-discuss] rabbitmq-server with esl-erlang in debian
In-Reply-To: <6f01c607-fe2e-47bf-bd9c-21eabc3619e3@a14g2000vbm.googlegroups.com>
References: <6f01c607-fe2e-47bf-bd9c-21eabc3619e3@a14g2000vbm.googlegroups.com>
Message-ID: <516536D7.1020001@rabbitmq.com>

On 09/04/13 23:10, ed wrote:
> I was wondering if anyone here has any solution to install rabbitmq-
> server debian package with esl-erlang (version of erlang from their
> repos vs standard debian repos)?

Hmm. Jason McIntosh created a fake RPM for the same purpose... but I 
think debs are more expressive, I think we could just depend on 
erlang-nox | esl-erlang. I'll investigate.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jiri.kuchta at deutsche-boerse.com  Wed Apr 10 11:40:17 2013
From: jiri.kuchta at deutsche-boerse.com (jkuchta.db)
Date: Wed, 10 Apr 2013 03:40:17 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ crashed after all memory was
	consumed
In-Reply-To: <51653206.5000407@rabbitmq.com>
References: <1365578735193-25952.post@n5.nabble.com>
	<51653206.5000407@rabbitmq.com>
Message-ID: <1365590417410-25960.post@n5.nabble.com>

Thanks for the quick reply. 

The provided email does not work for me. When I try to send a message I get
an error:
Missing domain
Please fix the error and try again.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-crashed-after-all-memory-was-consumed-tp25952p25960.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ask at rabbitmq.com  Wed Apr 10 11:44:41 2013
From: ask at rabbitmq.com (Ask Solem)
Date: Wed, 10 Apr 2013 11:44:41 +0100
Subject: [rabbitmq-discuss] Newbee consulting question
In-Reply-To: <51652BB0.1040400@rabbitmq.com>
References: <b2781511-9ee4-4a2b-b479-76b20b5976a5@googlegroups.com>
	<51652BB0.1040400@rabbitmq.com>
Message-ID: <16506B79-90C9-46AE-A20E-3E6B20DAFD18@rabbitmq.com>


On Apr 10, 2013, at 10:06 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>> we want the architecture to be "pull" rather than "push" in terms of
>> workers 'asking' the workflow manager to get new tasks when they are
>> free, rather than task manager pushing tasks to workers blindly.
> 
> Workers can retrieve messages from a queue synchronously using the
> basic.get method.


Why do you think you need to use pull instead of push?
Are you really sure you want smart dispatch?

In that case you also have the option of using push, but reroute the
message to the best worker.

From tomer.paz at gmail.com  Wed Apr 10 11:49:46 2013
From: tomer.paz at gmail.com (Tomer Paz)
Date: Wed, 10 Apr 2013 13:49:46 +0300
Subject: [rabbitmq-discuss] Newbee consulting question
In-Reply-To: <16506B79-90C9-46AE-A20E-3E6B20DAFD18@rabbitmq.com>
References: <b2781511-9ee4-4a2b-b479-76b20b5976a5@googlegroups.com>
	<51652BB0.1040400@rabbitmq.com>
	<16506B79-90C9-46AE-A20E-3E6B20DAFD18@rabbitmq.com>
Message-ID: <CALt-o1karu5QzVXh5z=GxnMOzViV4j6T7q452h27EkyEaKX_nQ@mail.gmail.com>

that's a good question why not push. Lets just say that it is our system
constraints, its beyond me :)


On Wed, Apr 10, 2013 at 1:44 PM, Ask Solem <ask at rabbitmq.com> wrote:

>
> On Apr 10, 2013, at 10:06 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>
> >> we want the architecture to be "pull" rather than "push" in terms of
> >> workers 'asking' the workflow manager to get new tasks when they are
> >> free, rather than task manager pushing tasks to workers blindly.
> >
> > Workers can retrieve messages from a queue synchronously using the
> > basic.get method.
>
>
> Why do you think you need to use pull instead of push?
> Are you really sure you want smart dispatch?
>
> In that case you also have the option of using push, but reroute the
> message to the best worker.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 

Rgrds
Tomer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130410/e47e83e4/attachment.htm>

From dmitry.andrianov at alertme.com  Wed Apr 10 11:51:16 2013
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Wed, 10 Apr 2013 06:51:16 -0400
Subject: [rabbitmq-discuss] Establishing user identity
Message-ID: <A20AB29F86ACF34C89AEE6BE272FFE4A457303FD@IAD2MBX18.mex02.mlsrvr.com>

Hi.
I'm very new to RabbitMQ but I googled as much as I could before mailing here so my apologies in case the issue was discussed a million times.
I need your advise on the general approach.

What we need in the end is for consumers to be able to see which client sent the message. Producers should not be able to impersonate each other.
We use SSL certificates for each client and our own certificate authority.

Here is what I came with:
1. Use rabbitmq_auth_mechanism_ssl so RabbitMQ extracts name from client SSL certificate and uses it as "authenticated user".
2. Create our own auth backend which basically says "everyone is allowed to post anything" so we do not need to maintain a database of our users or anything like that. If account needs to be removed we can just revoke the certificate.
3. Producers add user-id property to every message they send - just the name from its certificate. RabbitMQ already checks that user-id against authenticated user id and will discard a message if they do not match. So one user won't be able to impersonate another.
4. Consumer just uses user-id property supplied with the message to see where it came from.

What I do not like about this approach:

* Most of all I do not like the fact that sending client needs to explicitly provide its user-id with each message. I would much prefer RabbitMQ has the ability to "attach" authenticated user ID to every received message automatically before passing it down the queues. Is that possible at all? Can it be done with plugins? Are there any examples?

* Second, I do not like the fact we need to create auth backend even though it is very simple. But from the other hand we do not want to add every user because there can be thousands of them. Is there a better way?

Or maybe this problem needs to be solved in a completely different way?

Thanks very much.
Dmitry
This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From simon at rabbitmq.com  Wed Apr 10 12:00:07 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Apr 2013 12:00:07 +0100
Subject: [rabbitmq-discuss] rabbitmq-server with esl-erlang in debian
In-Reply-To: <516536D7.1020001@rabbitmq.com>
References: <6f01c607-fe2e-47bf-bd9c-21eabc3619e3@a14g2000vbm.googlegroups.com>
	<516536D7.1020001@rabbitmq.com>
Message-ID: <51654637.7040403@rabbitmq.com>

On 10/04/13 10:54, Simon MacMullen wrote:
> I think we could just depend on erlang-nox | esl-erlang

Yes, that works. So the next release will do so.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Apr 10 12:33:25 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Apr 2013 12:33:25 +0100
Subject: [rabbitmq-discuss] Clustering and Scalability
In-Reply-To: <A57B6B00637AF741A9FA2D006B40C3C882A0C86EC2@AUSP01VMBX29.collaborationhost.net>
References: <A57B6B00637AF741A9FA2D006B40C3C882A0C86EC2@AUSP01VMBX29.collaborationhost.net>
Message-ID: <51654E05.4090103@rabbitmq.com>

On 09/04/13 13:45, Chris Nicel wrote:
> I have reviewed the clustering guidelines and understand the queues
> do not migrate across a cluster when the nodes are being taken down.
> If a node fails/is taken down then queues for which it maintained
> will no longer be protected if an HA policy of exactly two nodes is
> used, until that node is restored that is.

Or until another node comes on line, or until

>
> I believe these three questions will further my understanding:
>
> Is there a way to re-nice the queues across the cluster to even out
> the load?
>
> Is there a way to migrate already existing queues to new nodes as
> slaves?
>
> If a queue loses a node and a new node is added to the cluster, will
> the new node join the ha policy for that particular queue?
>
>
> Thanks in advance.
>
> Chris
>
> 15below Limited: Company registered in England and Wales No 3945289
> Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1
> 3XB, United Kingdom
>
> 15below Australia Pty Limited: ABN 25 132 716 379 Level 50, 120
> Collins Street, Melbourne, Victoria 3000, Australia
>
> Please think about the environment before printing this email.
>
> ************************************************************************
>
>
This email and any attachments may be confidential and/or legally 
privileged and are solely for the use of the intended recipient.  If you 
have received this email in error please contact the sender.  Any views 
or opinions expressed within this e-mail are solely those of the sender, 
and do not necessarily represent those of 15below unless otherwise 
specifically stated.  Although 15below has taken every reasonable 
precaution to ensure that any attachment to this e-mail has been checked 
for viruses, it is strongly recommended that you carry out your own 
virus check before opening any attachment, as we cannot accept liability 
for any damage sustained as a result of software virus infection.
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Apr 10 12:40:05 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Apr 2013 12:40:05 +0100
Subject: [rabbitmq-discuss] Clustering and Scalability
In-Reply-To: <A57B6B00637AF741A9FA2D006B40C3C882A0C86EC2@AUSP01VMBX29.collaborationhost.net>
References: <A57B6B00637AF741A9FA2D006B40C3C882A0C86EC2@AUSP01VMBX29.collaborationhost.net>
Message-ID: <51654F95.3070109@rabbitmq.com>

Sorry about the previous response, hit "send" too early...

On 09/04/13 13:45, Chris Nicel wrote:
> Hi Guys,
>
> We are looking to use RabbitMQ as a messagebus in a scalable
> application. In order to achieve complete scalability it is important
> that we can ramp up our RabbitMQ cluster to have more nodes when a
> performance bottleneck is realised.
>
> I have reviewed the clustering guidelines and understand the queues
> do not migrate across a cluster when the nodes are being taken down.
> If a node fails/is taken down then queues for which it maintained
> will no longer be protected if an HA policy of exactly two nodes is
> used, until that node is restored that is.

Or until another node comes on line, or you change the policy.

> I believe these three questions will further my understanding:

I assume you are asking these questions in the context of "exactly" mode...

> Is there a way to re-nice the queues across the cluster to even out
> the load?

> Is there a way to migrate already existing queues to new nodes as
> slaves?

You could do both of these by setting a (queue-specific?) policy using 
"nodes" with a higher priority, waiting for the queues to migrate, and 
then deleting it again.

But it's becoming apparent that people seem to want something more 
automated that that. What exactly that would look like I'm less sure.

> If a queue loses a node and a new node is added to the cluster, will
> the new node join the ha policy for that particular queue?

Yes. (Again assuming "exactly" mode).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Apr 10 13:33:40 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Apr 2013 13:33:40 +0100
Subject: [rabbitmq-discuss] Establishing user identity
In-Reply-To: <A20AB29F86ACF34C89AEE6BE272FFE4A457303FD@IAD2MBX18.mex02.mlsrvr.com>
References: <A20AB29F86ACF34C89AEE6BE272FFE4A457303FD@IAD2MBX18.mex02.mlsrvr.com>
Message-ID: <51655C24.1060706@rabbitmq.com>

On 10/04/13 11:51, Dmitry Andrianov wrote:
> Hi. I'm very new to RabbitMQ but I googled as much as I could before
> mailing here so my apologies in case the issue was discussed a
> million times.

No, I don't think it was.

<snip>

> What I do not like about this approach:
>
> * Most of all I do not like the fact that sending client needs to
> explicitly provide its user-id with each message. I would much prefer
> RabbitMQ has the ability to "attach" authenticated user ID to every
> received message automatically before passing it down the queues. Is
> that possible at all? Can it be done with plugins? Are there any
> examples?

Hmm. The reason we did it like that was so that we could avoid modifying 
messages as they come in (something we go to some lengths to do). I'm 
not sure a plugin can do this sanely either.

How many other people are interested in not needing to specify the user-id?

> * Second, I do not like the fact we need to create auth backend even
> though it is very simple. But from the other hand we do not want to
> add every user because there can be thousands of them. Is there a
> better way?

You could use the HTTP or LDAP backends - but then you'd need to have 
another moving part around.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Apr 10 13:59:55 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Apr 2013 13:59:55 +0100
Subject: [rabbitmq-discuss] rabbitmq-management-themes
Message-ID: <5165624B.1090106@rabbitmq.com>

I originally wrote this intending for it to be an April Fool's joke. But 
then I felt like overcomplicated April Fool's jokes are already too much 
of a thing in software, and it wasn't that funny, and anyway I was busy 
with DIY.

But I didn't want it to go completely to waste. So make of it what you will.

https://github.com/simonmacmullen/rabbitmq-management-themes

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Chris.Nicel at 15below.com  Wed Apr 10 14:25:40 2013
From: Chris.Nicel at 15below.com (Chris Nicel)
Date: Wed, 10 Apr 2013 08:25:40 -0500
Subject: [rabbitmq-discuss] Clustering and Scalability
In-Reply-To: <51654F95.3070109@rabbitmq.com>
References: <A57B6B00637AF741A9FA2D006B40C3C882A0C86EC2@AUSP01VMBX29.collaborationhost.net>
	<51654F95.3070109@rabbitmq.com>
Message-ID: <A57B6B00637AF741A9FA2D006B40C3C882A0C8774E@AUSP01VMBX29.collaborationhost.net>

Hi Simon,

Thanks for coming back to me. Yes in all cases I was referring to "exactly" mode for the ha policy.

It seems we do have some options by programmatically adding ha policies and then removing them after the migration has occurred.

In terms of ideas for an automatic system of spreading load out across a cluster. You could monitor the size/speed of various queues and migrate them to even the load on any individual node. Similar to VMWare's vsphere DRS and storage DRS. Monitoring CPU and RAM usage (in the case of DRS) and storage IO to determine which hosts the vm's should be running on. This could allow you to add nodes and have the load balanced "automatically".

As with most software development you "could" do almost anything... I hope that my ideas are in some way helpful :o)

Cheers

Chris

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: 10 April 2013 12:40
To: Discussions about RabbitMQ
Cc: Chris Nicel
Subject: Re: [rabbitmq-discuss] Clustering and Scalability

Sorry about the previous response, hit "send" too early...

On 09/04/13 13:45, Chris Nicel wrote:
> Hi Guys,
>
> We are looking to use RabbitMQ as a messagebus in a scalable
> application. In order to achieve complete scalability it is important
> that we can ramp up our RabbitMQ cluster to have more nodes when a
> performance bottleneck is realised.
>
> I have reviewed the clustering guidelines and understand the queues do
> not migrate across a cluster when the nodes are being taken down.
> If a node fails/is taken down then queues for which it maintained will
> no longer be protected if an HA policy of exactly two nodes is used,
> until that node is restored that is.

Or until another node comes on line, or you change the policy.

> I believe these three questions will further my understanding:

I assume you are asking these questions in the context of "exactly" mode...

> Is there a way to re-nice the queues across the cluster to even out
> the load?

> Is there a way to migrate already existing queues to new nodes as
> slaves?

You could do both of these by setting a (queue-specific?) policy using "nodes" with a higher priority, waiting for the queues to migrate, and then deleting it again.

But it's becoming apparent that people seem to want something more automated that that. What exactly that would look like I'm less sure.

> If a queue loses a node and a new node is added to the cluster, will
> the new node join the ha policy for that particular queue?

Yes. (Again assuming "exactly" mode).

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware

 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From Petr.Gotthard at Honeywell.com  Wed Apr 10 16:22:05 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Wed, 10 Apr 2013 15:22:05 +0000
Subject: [rabbitmq-discuss] rabbitmq-management-themes
In-Reply-To: <5165624B.1090106@rabbitmq.com>
References: <5165624B.1090106@rabbitmq.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D3225FC@FR44EX3005.global.ds.honeywell.com>

Cool!

Next year you should implement some Easter eggs ;-)


Petr

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: 10. dubna 2013 15:00
To: rabbitmq-discuss
Subject: [rabbitmq-discuss] rabbitmq-management-themes

I originally wrote this intending for it to be an April Fool's joke. But 
then I felt like overcomplicated April Fool's jokes are already too much 
of a thing in software, and it wasn't that funny, and anyway I was busy 
with DIY.

But I didn't want it to go completely to waste. So make of it what you will.

https://github.com/simonmacmullen/rabbitmq-management-themes

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Wed Apr 10 17:38:59 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 10 Apr 2013 20:38:59 +0400
Subject: [rabbitmq-discuss] amqp gem 1.0.1 is released
Message-ID: <CAE3HoVQR-OBt45HSSPXVBPCXswQ10gUE9HuLyXVigaPtpAppjg@mail.gmail.com>

amqp gem 1.0.1 is released to rubygems.org [1].

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/04/10/amqp-gem-1-dot-0-1-is-released/

1. https://rubygems.org/gems/amqp/versions/1.0.1
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130410/d124c4d0/attachment.htm>

From fmeshkinpour at fonality.com  Wed Apr 10 17:51:29 2013
From: fmeshkinpour at fonality.com (Farshad Meshkinpour)
Date: Wed, 10 Apr 2013 09:51:29 -0700
Subject: [rabbitmq-discuss] Rabbit Cluster Failure
Message-ID: <CAO4q6_9fnfEKOmJPO30BFvGZwpP4_M0PeHo2FNgrd6RUo2MeMw@mail.gmail.com>

Hello,
We are running Rabbit 2.8.6 on Erlang R14B04.  We got this error on one of
3 rabbit servers in our cluster. After that we observed the followings:
1. all 3 rabbit servers went on high cpu usage
2. management interface was not functional
3. workers were not able to consume from queues

Trying to stop the rabbit server failed (/etc/init.d/rabbitmq-server stop)
and end up hard kill (kill -9) rabbit process on all nodes of the cluster
to get the system back.  All mirrored queues contents were lost.

Can someone points us to what may have caused this? Any help is greatly
appreciated.

Thanks,


ERROR REPORT==== 9-Apr-2013::10:56:49 ===
** Generic server <0.9085.0> terminating
** Last message in was {'$gen_cast',
                        {delete_and_terminate,
                         {function_clause,
                          [{rabbit_amqqueue_process,handle_call,
                            [{add_on_right,{74,<0.7181.510>}},
                             {<0.7181.510>,#Ref<0.0.14625.121725>},
                             {q,
                              {amqqueue,
                               {resource,<<"/fonsyncd/prod/">>,queue,
                                <<"Q-SID.16970.fonsyncd">>},
                               true,false,none,
                               [{<<"x-message-ttl">>,signedint,100000},
                                {<<"x-dead-letter-exchange">>,longstr,
                                 <<"EX-fonsyncd-Exception">>},
                                {<<"x-ha-policy">>,longstr,<<"all">>}],
                               <0.4403.0>,[],all},
                              none,false,rabbit_mirror_queue_master,
                              {state,<0.4404.0>,<0.9085.0>,
                               rabbit_variable_queue,
                               {vqstate,
                                {0,{[],[]}},
                                {0,{[],[]}},
                                {delta,undefined,0,undefined},
                                {0,{[],[]}},
                                {0,{[],[]}},
                                2114,
                                {0,nil},
                                undefined,
                                {0,nil},
                                {qistate,
                                 "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/queues/EYHEI3SQW41F6NFSH8WB2CD91",
                                 {{dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]}}},
                                  []},
                                 #Ref<0.0.25.88612>,0,262144,
                                 #Fun<rabbit_variable_queue.2.36908642>,
                                 {0,nil}},
                                {{client_msstate,msg_store_persistent,
                                  <<72,22,217,216,236,0,110,187,235,185,163,
                                    249,92,182,156,56>>,
                                  {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]}}},
                                  {state,696393,
                                   "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent"},
                                  rabbit_msg_store_ets_index,
                                  "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent",
                                  <0.269.0>,700490,692296,704587,708684},
                                 {client_msstate,msg_store_transient,

<<51,15,67,134,52,182,142,196,131,185,177,5,
                                    223,15,45,61>>,
                                  {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]}}},
                                  {state,675908,
                                   "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient"},
                                  rabbit_msg_store_ets_index,
                                  "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient",
                                  <0.264.0>,680005,671795,684102,688199}},
                                true,0,

#Fun<rabbit_mirror_queue_slave.1.52898136>,0,
                                0,infinity,0,0,0,0,0,
                                {rates,
                                 {{1365,529204,602738},0},
                                 {{1365,529204,602738},0},
                                 0.0,0.0,
                                 {1365,529286,74299}},
                                {0,nil},
                                {0,nil},
                                {0,nil},
                                {0,nil},
                                0,0,
                                {rates,
                                 {{1365,529204,602738},0},
                                 {{1365,529204,602738},0},
                                 0.0,0.0,
                                 {1365,529286,74299}}},
                               0,
                               {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                               [],
                               {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                               {set,6,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],
                                  [<0.17350.499>],
                                  [<0.17781.499>],
                                  [],
                                  [<7525.9758.575>],
                                  [],
                                  [<7526.18741.575>,<7526.16733.575>],
                                  [],[],[],[],[],[],[],[],
                                  [<7525.13515.575>]}}}},
                              {[],[]},
                              undefined,undefined,undefined,undefined,
                              {state,fine,5000,undefined},
                              {0,nil},
                              100000,undefined,1365529282744274,
                              {dict,6,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],
                                 [[<0.17350.499>|#Ref<0.0.14563.86478>]],
                                 [[<0.17781.499>|#Ref<0.0.14563.86169>]],
                                 [],
                                 [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
                                 [],
                                 [[<7526.16733.575>|#Ref<0.0.14563.86260>],
                                  [<7526.18741.575>|#Ref<0.0.14563.86683>]],
                                 [],[],[],[],[],[],[],[],

 [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
                              1,
                              {{0,nil},{0,nil}},
                              undefined,
                              {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []}}},
                              {resource,<<"/fonsyncd/prod/">>,exchange,
                               <<"EX-fonsyncd-Exception">>},
                              undefined}]},
                           {gen_server2,handle_msg,2},
                           {proc_lib,wake_up,3}]}}}
** When Server state == {state,
                            {amqqueue,
                                {resource,<<"/fonsyncd/prod/">>,queue,
                                    <<"Q-SID.16970.fonsyncd">>},
                                true,false,none,
                                [{<<"x-message-ttl">>,signedint,100000},
                                 {<<"x-dead-letter-exchange">>,longstr,
                                  <<"EX-fonsyncd-Exception">>},
                                 {<<"x-ha-policy">>,longstr,<<"all">>}],
                                <0.4403.0>,[],all},
                            <0.4404.0>,
                            {dict,6,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],
                                  [[<0.17350.499>|#Ref<0.0.14563.86480>]],
                                  [[<0.17781.499>|#Ref<0.0.14563.86174>]],
                                  [],
                                  [[<7525.9758.575>|#Ref<0.0.14563.86397>]],
                                  [],
                                  [[<7526.16733.575>|#Ref<0.0.14563.86263>],

 [<7526.18741.575>|#Ref<0.0.14563.86686>]],
                                  [],[],[],[],[],[],[],[],
                                  [[<7525.13515.575>|
                                    #Ref<0.0.14563.86622>]]}}},
                            #Fun<rabbit_mirror_queue_master.1.37767645>,
                            #Fun<rabbit_mirror_queue_master.2.24464450>}
** Reason for termination ==
** {function_clause,
       [{rabbit_amqqueue_process,handle_call,
            [{add_on_right,{74,<0.7181.510>}},
             {<0.7181.510>,#Ref<0.0.14625.121725>},
             {q,{amqqueue,
                    {resource,<<"/fonsyncd/prod/">>,queue,
                        <<"Q-SID.16970.fonsyncd">>},
                    true,false,none,
                    [{<<"x-message-ttl">>,signedint,100000},
                     {<<"x-dead-letter-exchange">>,longstr,
                      <<"EX-fonsyncd-Exception">>},
                     {<<"x-ha-policy">>,longstr,<<"all">>}],
                    <0.4403.0>,[],all},
                none,false,rabbit_mirror_queue_master,
                {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
                    {vqstate,
                        {0,{[],[]}},
                        {0,{[],[]}},
                        {delta,undefined,0,undefined},
                        {0,{[],[]}},
                        {0,{[],[]}},
                        2114,
                        {0,nil},
                        undefined,
                        {0,nil},
                        {qistate,
                            "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/queues/EYHEI3SQW41F6NFSH8WB2CD91",
                            {{dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             []},
                            #Ref<0.0.25.88612>,0,262144,
                            #Fun<rabbit_variable_queue.2.36908642>,
                            {0,nil}},
                        {{client_msstate,msg_store_persistent,

 <<72,22,217,216,236,0,110,187,235,185,163,249,92,
                               182,156,56>>,
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             {state,696393,
                                 "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent"},
                             rabbit_msg_store_ets_index,
                             "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent",
                             <0.269.0>,700490,692296,704587,708684},
                         {client_msstate,msg_store_transient,

 <<51,15,67,134,52,182,142,196,131,185,177,5,223,
                               15,45,61>>,
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             {state,675908,
                                 "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient"},
                             rabbit_msg_store_ets_index,
                             "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient",
                             <0.264.0>,680005,671795,684102,688199}},

true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,0,
                        infinity,0,0,0,0,0,
                        {rates,
                            {{1365,529204,602738},0},
                            {{1365,529204,602738},0},
                            0.0,0.0,
                            {1365,529286,74299}},
                        {0,nil},
                        {0,nil},
                        {0,nil},
                        {0,nil},
                        0,0,
                        {rates,
                            {{1365,529204,602738},0},
                            {{1365,529204,602738},0},
                            0.0,0.0,
                            {1365,529286,74299}}},
                    0,
                    {dict,0,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                    [],
                    {dict,0,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                    {set,6,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                        {{[],
                          [<0.17350.499>],
                          [<0.17781.499>],
                          [],
                          [<7525.9758.575>],
                          [],
                          [<7526.18741.575>,<7526.16733.575>],
                          [],[],[],[],[],[],[],[],
                          [<7525.13515.575>]}}}},
                {[],[]},
                undefined,undefined,undefined,undefined,
                {state,fine,5000,undefined},
                {0,nil},
                100000,undefined,1365529282744274,
                {dict,6,16,16,8,80,48,
                    {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                    {{[],
                      [[<0.17350.499>|#Ref<0.0.14563.86478>]],
                      [[<0.17781.499>|#Ref<0.0.14563.86169>]],
                      [],
                      [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
                      [],
                      [[<7526.16733.575>|#Ref<0.0.14563.86260>],
                       [<7526.18741.575>|#Ref<0.0.14563.86683>]],
                      [],[],[],[],[],[],[],[],
                      [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
                1,
                {{0,nil},{0,nil}},
                undefined,
                {dict,0,16,16,8,80,48,
                    {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                    {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                {resource,<<"/fonsyncd/prod/">>,exchange,
                    <<"EX-fonsyncd-Exception">>},
                undefined}]},
        {gen_server2,handle_msg,2},
        {proc_lib,wake_up,3}]}


=ERROR REPORT==== 9-Apr-2013::10:56:49 ===
** Generic server <0.4403.0> terminating
** Last message in was {add_on_right,{74,<0.7181.510>}}
** When Server state == {q,
                         {amqqueue,
                          {resource,<<"/fonsyncd/prod/">>,queue,
                           <<"Q-SID.16970.fonsyncd">>},
                          true,false,none,
                          [{<<"x-message-ttl">>,signedint,100000},
                           {<<"x-dead-letter-exchange">>,longstr,
                            <<"EX-fonsyncd-Exception">>},
                           {<<"x-ha-policy">>,longstr,<<"all">>}],
                          <0.4403.0>,[],all},
                         none,false,rabbit_mirror_queue_master,
                         {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
                          {vqstate,
                           {0,{[],[]}},
                           {0,{[],[]}},
                           {delta,undefined,0,undefined},
                           {0,{[],[]}},
                           {0,{[],[]}},
                           2114,
                           {0,nil},
                           undefined,
                           {0,nil},
                           {qistate,
                            "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/queues/EYHEI3SQW41F6NFSH8WB2CD91",
                            {{dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             []},
                            #Ref<0.0.25.88612>,0,262144,
                            #Fun<rabbit_variable_queue.2.36908642>,
                            {0,nil}},
                           {{client_msstate,msg_store_persistent,

 <<72,22,217,216,236,0,110,187,235,185,163,249,92,
                               182,156,56>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,696393,
                              "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent"},
                             rabbit_msg_store_ets_index,
                             "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent",
                             <0.269.0>,700490,692296,704587,708684},
                            {client_msstate,msg_store_transient,

 <<51,15,67,134,52,182,142,196,131,185,177,5,223,
                               15,45,61>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,675908,
                              "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient"},
                             rabbit_msg_store_ets_index,
                             "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient",
                             <0.264.0>,680005,671795,684102,688199}},

 true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,
                           0,0,infinity,0,0,0,0,0,
                           {rates,
                            {{1365,529204,602738},0},
                            {{1365,529204,602738},0},
                            0.0,0.0,
                            {1365,529286,74299}},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           0,0,
                           {rates,
                            {{1365,529204,602738},0},
                            {{1365,529204,602738},0},
                            0.0,0.0,
                            {1365,529286,74299}}},
                          0,
                          {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          [],
                          {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          {set,6,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],
                             [<0.17350.499>],
                             [<0.17781.499>],
                             [],
                             [<7525.9758.575>],
                             [],
                             [<7526.18741.575>,<7526.16733.575>],
                             [],[],[],[],[],[],[],[],
                             [<7525.13515.575>]}}}},
                         {[],[]},
                         undefined,undefined,undefined,undefined,
                         {state,fine,5000,undefined},
                         {0,nil},
                         100000,undefined,1365529282744274,
                         {dict,6,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],
                            [[<0.17350.499>|#Ref<0.0.14563.86478>]],
                            [[<0.17781.499>|#Ref<0.0.14563.86169>]],
                            [],
                            [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
                            [],
                            [[<7526.16733.575>|#Ref<0.0.14563.86260>],
                             [<7526.18741.575>|#Ref<0.0.14563.86683>]],
                            [],[],[],[],[],[],[],[],
                            [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
                         1,
                         {{0,nil},{0,nil}},
                         undefined,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {resource,<<"/fonsyncd/prod/">>,exchange,
                          <<"EX-fonsyncd-Exception">>},
                         undefined}
** Reason for termination ==
** {function_clause,
       [{rabbit_amqqueue_process,handle_call,
            [{add_on_right,{74,<0.7181.510>}},
             {<0.7181.510>,#Ref<0.0.14625.121725>},
             {q,{amqqueue,
                    {resource,<<"/fonsyncd/prod/">>,queue,
                        <<"Q-SID.16970.fonsyncd">>},
                    true,false,none,
                    [{<<"x-message-ttl">>,signedint,100000},
                     {<<"x-dead-letter-exchange">>,longstr,
                      <<"EX-fonsyncd-Exception">>},
                     {<<"x-ha-policy">>,longstr,<<"all">>}],
                    <0.4403.0>,[],all},
                none,false,rabbit_mirror_queue_master,
                {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
                    {vqstate,
                        {0,{[],[]}},
                        {0,{[],[]}},
                        {delta,undefined,0,undefined},
                        {0,{[],[]}},
                        {0,{[],[]}},
                        2114,
                        {0,nil},
                        undefined,
                        {0,nil},
                        {qistate,
                            "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/queues/EYHEI3SQW41F6NFSH8WB2CD91",
                            {{dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             []},
                            #Ref<0.0.25.88612>,0,262144,
                            #Fun<rabbit_variable_queue.2.36908642>,
                            {0,nil}},
                        {{client_msstate,msg_store_persistent,

 <<72,22,217,216,236,0,110,187,235,185,163,249,92,
                               182,156,56>>,
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             {state,696393,
                                 "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent"},
                             rabbit_msg_store_ets_index,
                             "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent",
                             <0.269.0>,700490,692296,704587,708684},
                         {client_msstate,msg_store_transient,

 <<51,15,67,134,52,182,142,196,131,185,177,5,223,
                               15,45,61>>,
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             {state,675908,
                                 "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient"},
                             rabbit_msg_store_ets_index,
                             "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient",
                             <0.264.0>,680005,671795,684102,688199}},

true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,0,
                        infinity,0,0,0,0,0,
                        {rates,
                            {{1365,529204,602738},0},
                            {{1365,529204,602738},0},
                            0.0,0.0,
                            {1365,529286,74299}},
                        {0,nil},
                        {0,nil},
                        {0,nil},
                        {0,nil},
                        0,0,
                        {rates,
                            {{1365,529204,602738},0},
                            {{1365,529204,602738},0},
                            0.0,0.0,
                            {1365,529286,74299}}},
                    0,
                    {dict,0,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                    [],
                    {dict,0,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                    {set,6,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                        {{[],
                          [<0.17350.499>],
                          [<0.17781.499>],
                          [],
                          [<7525.9758.575>],
                          [],
                          [<7526.18741.575>,<7526.16733.575>],
                          [],[],[],[],[],[],[],[],
                          [<7525.13515.575>]}}}},
                {[],[]},
                undefined,undefined,undefined,undefined,
                {state,fine,5000,undefined},
                {0,nil},
                100000,undefined,1365529282744274,
                {dict,6,16,16,8,80,48,
                    {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                    {{[],
                      [[<0.17350.499>|#Ref<0.0.14563.86478>]],
                      [[<0.17781.499>|#Ref<0.0.14563.86169>]],
                      [],
                      [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
                      [],
                      [[<7526.16733.575>|#Ref<0.0.14563.86260>],
                       [<7526.18741.575>|#Ref<0.0.14563.86683>]],
                      [],[],[],[],[],[],[],[],
                      [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
                1,
                {{0,nil},{0,nil}},
                undefined,
                {dict,0,16,16,8,80,48,
                    {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                    {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                {resource,<<"/fonsyncd/prod/">>,exchange,
                    <<"EX-fonsyncd-Exception">>},
                undefined}]},
        {gen_server2,handle_msg,2},
        {proc_lib,wake_up,3}]}

=ERROR REPORT==== 9-Apr-2013::10:56:49 ===
** Generic server <0.7181.510> terminating
** Last message in was {'$gen_cast',join}
** When Server state == {state,
                            {74,<0.7181.510>},
                            {{74,<0.7181.510>},undefined},
                            {{74,<0.7181.510>},undefined},
                            {resource,<<"/fonsyncd/prod/">>,queue,
                                <<"Q-SID.18335.fonsyncd">>},

rabbit_mirror_queue_slave,undefined,-1,undefined,
                            [<0.7180.510>],
                            {[],[]},
                            [],undefined}
** Reason for termination ==
** {{function_clause,
        [{rabbit_amqqueue_process,handle_call,
             [{add_on_right,{74,<0.7181.510>}},
              {<0.7181.510>,#Ref<0.0.14625.121725>},
              {q,{amqqueue,
                     {resource,<<"/fonsyncd/prod/">>,queue,
                         <<"Q-SID.16970.fonsyncd">>},
                     true,false,none,
                     [{<<"x-message-ttl">>,signedint,100000},
                      {<<"x-dead-letter-exchange">>,longstr,
                       <<"EX-fonsyncd-Exception">>},
                      {<<"x-ha-policy">>,longstr,<<"all">>}],
                     <0.4403.0>,[],all},
                 none,false,rabbit_mirror_queue_master,
                 {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
                     {vqstate,
                         {0,{[],[]}},
                         {0,{[],[]}},
                         {delta,undefined,0,undefined},
                         {0,{[],[]}},
                         {0,{[],[]}},
                         2114,
                         {0,nil},
                         undefined,
                         {0,nil},
                         {qistate,
                             "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/queues/EYHEI3SQW41F6NFSH8WB2CD91",
                             {{dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                              []},
                             #Ref<0.0.25.88612>,0,262144,
                             #Fun<rabbit_variable_queue.2.36908642>,
                             {0,nil}},
                         {{client_msstate,msg_store_persistent,

<<72,22,217,216,236,0,110,187,235,185,163,249,92,
                                182,156,56>>,
                              {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                              {state,696393,
                                  "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent"},
                              rabbit_msg_store_ets_index,
                              "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent",
                              <0.269.0>,700490,692296,704587,708684},
                          {client_msstate,msg_store_transient,

<<51,15,67,134,52,182,142,196,131,185,177,5,223,
                                15,45,61>>,
                              {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                              {state,675908,
                                  "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient"},
                              rabbit_msg_store_ets_index,
                              "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient",
                              <0.264.0>,680005,671795,684102,688199}},

 true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,
                         0,infinity,0,0,0,0,0,
                         {rates,
                             {{1365,529204,602738},0},
                             {{1365,529204,602738},0},
                             0.0,0.0,
                             {1365,529286,74299}},
                         {0,nil},
                         {0,nil},
                         {0,nil},
                         {0,nil},
                         0,0,
                         {rates,
                             {{1365,529204,602738},0},
                             {{1365,529204,602738},0},
                             0.0,0.0,
                             {1365,529286,74299}}},
                     0,
                     {dict,0,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                     [],
                     {dict,0,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                     {set,6,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                         {{[],
                           [<0.17350.499>],
                           [<0.17781.499>],
                           [],
                           [<7525.9758.575>],
                           [],
                           [<7526.18741.575>,<7526.16733.575>],
                           [],[],[],[],[],[],[],[],
                           [<7525.13515.575>]}}}},
                 {[],[]},
                 undefined,undefined,undefined,undefined,
                 {state,fine,5000,undefined},
                 {0,nil},
                 100000,undefined,1365529282744274,
                 {dict,6,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                     {{[],
                       [[<0.17350.499>|#Ref<0.0.14563.86478>]],
                       [[<0.17781.499>|#Ref<0.0.14563.86169>]],
                       [],
                       [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
                       [],
                       [[<7526.16733.575>|#Ref<0.0.14563.86260>],
                        [<7526.18741.575>|#Ref<0.0.14563.86683>]],
                       [],[],[],[],[],[],[],[],
                       [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
                 1,
                 {{0,nil},{0,nil}},
                 undefined,
                 {dict,0,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                     {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                 {resource,<<"/fonsyncd/prod/">>,exchange,
                     <<"EX-fonsyncd-Exception">>},
                 undefined}]},
         {gen_server2,handle_msg,2},
         {proc_lib,wake_up,3}]},

{gen_server2,call,[<0.4403.0>,{add_on_right,{74,<0.7181.510>}},infinity]}}



ERROR REPORT==== 9-Apr-2013::10:56:49 ===
** Generic server <0.9085.0> terminating
** Last message in was {'$gen_cast',
                        {delete_and_terminate,
                         {function_clause,
                          [{rabbit_amqqueue_process,handle_call,
                            [{add_on_right,{74,<0.7181.510>}},
                             {<0.7181.510>,#Ref<0.0.14625.121725>},
                             {q,
                              {amqqueue,
                               {resource,<<"/fonsyncd/prod/">>,queue,
                                <<"Q-SID.16970.fonsyncd">>},
                               true,false,none,
                               [{<<"x-message-ttl">>,signedint,100000},
                                {<<"x-dead-letter-exchange">>,longstr,
                                 <<"EX-fonsyncd-Exception">>},
                                {<<"x-ha-policy">>,longstr,<<"all">>}],
                               <0.4403.0>,[],all},
                              none,false,rabbit_mirror_queue_master,
                              {state,<0.4404.0>,<0.9085.0>,
                               rabbit_variable_queue,
                               {vqstate,
                                {0,{[],[]}},
                                {0,{[],[]}},
                                {delta,undefined,0,undefined},
                                {0,{[],[]}},
                                {0,{[],[]}},
                                2114,
                                {0,nil},
                                undefined,
                                {0,nil},
                                {qistate,
                                 "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/queues/EYHEI3SQW41F6NFSH8WB2CD91",
                                 {{dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]}}},
                                  []},
                                 #Ref<0.0.25.88612>,0,262144,
                                 #Fun<rabbit_variable_queue.2.36908642>,
                                 {0,nil}},
                                {{client_msstate,msg_store_persistent,
                                  <<72,22,217,216,236,0,110,187,235,185,163,
                                    249,92,182,156,56>>,
                                  {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]}}},
                                  {state,696393,
                                   "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent"},
                                  rabbit_msg_store_ets_index,
                                  "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent",
                                  <0.269.0>,700490,692296,704587,708684},
                                 {client_msstate,msg_store_transient,

<<51,15,67,134,52,182,142,196,131,185,177,5,
                                    223,15,45,61>>,
                                  {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]}}},
                                  {state,675908,
                                   "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient"},
                                  rabbit_msg_store_ets_index,
                                  "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient",
                                  <0.264.0>,680005,671795,684102,688199}},
                                true,0,

#Fun<rabbit_mirror_queue_slave.1.52898136>,0,
                                0,infinity,0,0,0,0,0,
                                {rates,
                                 {{1365,529204,602738},0},
                                 {{1365,529204,602738},0},
                                 0.0,0.0,
                                 {1365,529286,74299}},
                                {0,nil},
                                {0,nil},
                                {0,nil},
                                {0,nil},
                                0,0,
                                {rates,
                                 {{1365,529204,602738},0},
                                 {{1365,529204,602738},0},
                                 0.0,0.0,
                                 {1365,529286,74299}}},
                               0,
                               {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                               [],
                               {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                               {set,6,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],
                                  [<0.17350.499>],
                                  [<0.17781.499>],
                                  [],
                                  [<7525.9758.575>],
                                  [],
                                  [<7526.18741.575>,<7526.16733.575>],
                                  [],[],[],[],[],[],[],[],
                                  [<7525.13515.575>]}}}},
                              {[],[]},
                              undefined,undefined,undefined,undefined,
                              {state,fine,5000,undefined},
                              {0,nil},
                              100000,undefined,1365529282744274,
                              {dict,6,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],
                                 [[<0.17350.499>|#Ref<0.0.14563.86478>]],
                                 [[<0.17781.499>|#Ref<0.0.14563.86169>]],
                                 [],
                                 [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
                                 [],
                                 [[<7526.16733.575>|#Ref<0.0.14563.86260>],
                                  [<7526.18741.575>|#Ref<0.0.14563.86683>]],
                                 [],[],[],[],[],[],[],[],

 [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
                              1,
                              {{0,nil},{0,nil}},
                              undefined,
                              {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []}}},
                              {resource,<<"/fonsyncd/prod/">>,exchange,
                               <<"EX-fonsyncd-Exception">>},
                              undefined}]},
                           {gen_server2,handle_msg,2},
                           {proc_lib,wake_up,3}]}}}
** When Server state == {state,
                            {amqqueue,
                                {resource,<<"/fonsyncd/prod/">>,queue,
                                    <<"Q-SID.16970.fonsyncd">>},
                                true,false,none,
                                [{<<"x-message-ttl">>,signedint,100000},
                                 {<<"x-dead-letter-exchange">>,longstr,
                                  <<"EX-fonsyncd-Exception">>},
                                 {<<"x-ha-policy">>,longstr,<<"all">>}],
                                <0.4403.0>,[],all},
                            <0.4404.0>,
                            {dict,6,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],
                                  [[<0.17350.499>|#Ref<0.0.14563.86480>]],
                                  [[<0.17781.499>|#Ref<0.0.14563.86174>]],
                                  [],
                                  [[<7525.9758.575>|#Ref<0.0.14563.86397>]],
                                  [],
                                  [[<7526.16733.575>|#Ref<0.0.14563.86263>],

 [<7526.18741.575>|#Ref<0.0.14563.86686>]],
                                  [],[],[],[],[],[],[],[],
                                  [[<7525.13515.575>|
                                    #Ref<0.0.14563.86622>]]}}},
                            #Fun<rabbit_mirror_queue_master.1.37767645>,
                            #Fun<rabbit_mirror_queue_master.2.24464450>}
** Reason for termination ==
** {function_clause,
       [{rabbit_amqqueue_process,handle_call,
            [{add_on_right,{74,<0.7181.510>}},
             {<0.7181.510>,#Ref<0.0.14625.121725>},
             {q,{amqqueue,
                    {resource,<<"/fonsyncd/prod/">>,queue,
                        <<"Q-SID.16970.fonsyncd">>},
                    true,false,none,
                    [{<<"x-message-ttl">>,signedint,100000},
                     {<<"x-dead-letter-exchange">>,longstr,
                      <<"EX-fonsyncd-Exception">>},
                     {<<"x-ha-policy">>,longstr,<<"all">>}],
                    <0.4403.0>,[],all},
                none,false,rabbit_mirror_queue_master,
                {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
                    {vqstate,
                        {0,{[],[]}},
                        {0,{[],[]}},
                        {delta,undefined,0,undefined},
                        {0,{[],[]}},
                        {0,{[],[]}},
                        2114,
                        {0,nil},
                        undefined,
                        {0,nil},
                        {qistate,
                            "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/queues/EYHEI3SQW41F6NFSH8WB2CD91",
                            {{dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             []},
                            #Ref<0.0.25.88612>,0,262144,
                            #Fun<rabbit_variable_queue.2.36908642>,
                            {0,nil}},
                        {{client_msstate,msg_store_persistent,

 <<72,22,217,216,236,0,110,187,235,185,163,249,92,
                               182,156,56>>,
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             {state,696393,
                                 "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent"},
                             rabbit_msg_store_ets_index,
                             "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent",
                             <0.269.0>,700490,692296,704587,708684},
                         {client_msstate,msg_store_transient,

 <<51,15,67,134,52,182,142,196,131,185,177,5,223,
                               15,45,61>>,
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             {state,675908,
                                 "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient"},
                             rabbit_msg_store_ets_index,
                             "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient",
                             <0.264.0>,680005,671795,684102,688199}},

true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,0,
                        infinity,0,0,0,0,0,
                        {rates,
                            {{1365,529204,602738},0},
                            {{1365,529204,602738},0},
                            0.0,0.0,
                            {1365,529286,74299}},
                        {0,nil},
                        {0,nil},
                        {0,nil},
                        {0,nil},
                        0,0,
                        {rates,
                            {{1365,529204,602738},0},
                            {{1365,529204,602738},0},
                            0.0,0.0,
                            {1365,529286,74299}}},
                    0,
                    {dict,0,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                    [],
                    {dict,0,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                    {set,6,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                        {{[],
                          [<0.17350.499>],
                          [<0.17781.499>],
                          [],
                          [<7525.9758.575>],
                          [],
                          [<7526.18741.575>,<7526.16733.575>],
                          [],[],[],[],[],[],[],[],
                          [<7525.13515.575>]}}}},
                {[],[]},
                undefined,undefined,undefined,undefined,
                {state,fine,5000,undefined},
                {0,nil},
                100000,undefined,1365529282744274,
                {dict,6,16,16,8,80,48,
                    {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                    {{[],
                      [[<0.17350.499>|#Ref<0.0.14563.86478>]],
                      [[<0.17781.499>|#Ref<0.0.14563.86169>]],
                      [],
                      [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
                      [],
                      [[<7526.16733.575>|#Ref<0.0.14563.86260>],
                       [<7526.18741.575>|#Ref<0.0.14563.86683>]],
                      [],[],[],[],[],[],[],[],
                      [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
                1,
                {{0,nil},{0,nil}},
                undefined,
                {dict,0,16,16,8,80,48,
                    {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                    {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                {resource,<<"/fonsyncd/prod/">>,exchange,
                    <<"EX-fonsyncd-Exception">>},
                undefined}]},
        {gen_server2,handle_msg,2},
        {proc_lib,wake_up,3}]}


=ERROR REPORT==== 9-Apr-2013::10:56:49 ===
** Generic server <0.4403.0> terminating
** Last message in was {add_on_right,{74,<0.7181.510>}}
** When Server state == {q,
                         {amqqueue,
                          {resource,<<"/fonsyncd/prod/">>,queue,
                           <<"Q-SID.16970.fonsyncd">>},
                          true,false,none,
                          [{<<"x-message-ttl">>,signedint,100000},
                           {<<"x-dead-letter-exchange">>,longstr,
                            <<"EX-fonsyncd-Exception">>},
                           {<<"x-ha-policy">>,longstr,<<"all">>}],
                          <0.4403.0>,[],all},
                         none,false,rabbit_mirror_queue_master,
                         {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
                          {vqstate,
                           {0,{[],[]}},
                           {0,{[],[]}},
                           {delta,undefined,0,undefined},
                           {0,{[],[]}},
                           {0,{[],[]}},
                           2114,
                           {0,nil},
                           undefined,
                           {0,nil},
                           {qistate,
                            "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/queues/EYHEI3SQW41F6NFSH8WB2CD91",
                            {{dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             []},
                            #Ref<0.0.25.88612>,0,262144,
                            #Fun<rabbit_variable_queue.2.36908642>,
                            {0,nil}},
                           {{client_msstate,msg_store_persistent,

 <<72,22,217,216,236,0,110,187,235,185,163,249,92,
                               182,156,56>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,696393,
                              "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent"},
                             rabbit_msg_store_ets_index,
                             "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent",
                             <0.269.0>,700490,692296,704587,708684},
                            {client_msstate,msg_store_transient,

 <<51,15,67,134,52,182,142,196,131,185,177,5,223,
                               15,45,61>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,675908,
                              "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient"},
                             rabbit_msg_store_ets_index,
                             "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient",
                             <0.264.0>,680005,671795,684102,688199}},

 true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,
                           0,0,infinity,0,0,0,0,0,
                           {rates,
                            {{1365,529204,602738},0},
                            {{1365,529204,602738},0},
                            0.0,0.0,
                            {1365,529286,74299}},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           0,0,
                           {rates,
                            {{1365,529204,602738},0},
                            {{1365,529204,602738},0},
                            0.0,0.0,
                            {1365,529286,74299}}},
                          0,
                          {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          [],
                          {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          {set,6,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],
                             [<0.17350.499>],
                             [<0.17781.499>],
                             [],
                             [<7525.9758.575>],
                             [],
                             [<7526.18741.575>,<7526.16733.575>],
                             [],[],[],[],[],[],[],[],
                             [<7525.13515.575>]}}}},
                         {[],[]},
                         undefined,undefined,undefined,undefined,
                         {state,fine,5000,undefined},
                         {0,nil},
                         100000,undefined,1365529282744274,
                         {dict,6,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],
                            [[<0.17350.499>|#Ref<0.0.14563.86478>]],
                            [[<0.17781.499>|#Ref<0.0.14563.86169>]],
                            [],
                            [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
                            [],
                            [[<7526.16733.575>|#Ref<0.0.14563.86260>],
                             [<7526.18741.575>|#Ref<0.0.14563.86683>]],
                            [],[],[],[],[],[],[],[],
                            [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
                         1,
                         {{0,nil},{0,nil}},
                         undefined,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {resource,<<"/fonsyncd/prod/">>,exchange,
                          <<"EX-fonsyncd-Exception">>},
                         undefined}
** Reason for termination ==
** {function_clause,
       [{rabbit_amqqueue_process,handle_call,
            [{add_on_right,{74,<0.7181.510>}},
             {<0.7181.510>,#Ref<0.0.14625.121725>},
             {q,{amqqueue,
                    {resource,<<"/fonsyncd/prod/">>,queue,
                        <<"Q-SID.16970.fonsyncd">>},
                    true,false,none,
                    [{<<"x-message-ttl">>,signedint,100000},
                     {<<"x-dead-letter-exchange">>,longstr,
                      <<"EX-fonsyncd-Exception">>},
                     {<<"x-ha-policy">>,longstr,<<"all">>}],
                    <0.4403.0>,[],all},
                none,false,rabbit_mirror_queue_master,
                {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
                    {vqstate,
                        {0,{[],[]}},
                        {0,{[],[]}},
                        {delta,undefined,0,undefined},
                        {0,{[],[]}},
                        {0,{[],[]}},
                        2114,
                        {0,nil},
                        undefined,
                        {0,nil},
                        {qistate,
                            "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/queues/EYHEI3SQW41F6NFSH8WB2CD91",
                            {{dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             []},
                            #Ref<0.0.25.88612>,0,262144,
                            #Fun<rabbit_variable_queue.2.36908642>,
                            {0,nil}},
                        {{client_msstate,msg_store_persistent,

 <<72,22,217,216,236,0,110,187,235,185,163,249,92,
                               182,156,56>>,
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             {state,696393,
                                 "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent"},
                             rabbit_msg_store_ets_index,
                             "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent",
                             <0.269.0>,700490,692296,704587,708684},
                         {client_msstate,msg_store_transient,

 <<51,15,67,134,52,182,142,196,131,185,177,5,223,
                               15,45,61>>,
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             {state,675908,
                                 "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient"},
                             rabbit_msg_store_ets_index,
                             "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient",
                             <0.264.0>,680005,671795,684102,688199}},

true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,0,
                        infinity,0,0,0,0,0,
                        {rates,
                            {{1365,529204,602738},0},
                            {{1365,529204,602738},0},
                            0.0,0.0,
                            {1365,529286,74299}},
                        {0,nil},
                        {0,nil},
                        {0,nil},
                        {0,nil},
                        0,0,
                        {rates,
                            {{1365,529204,602738},0},
                            {{1365,529204,602738},0},
                            0.0,0.0,
                            {1365,529286,74299}}},
                    0,
                    {dict,0,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                    [],
                    {dict,0,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                    {set,6,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                        {{[],
                          [<0.17350.499>],
                          [<0.17781.499>],
                          [],
                          [<7525.9758.575>],
                          [],
                          [<7526.18741.575>,<7526.16733.575>],
                          [],[],[],[],[],[],[],[],
                          [<7525.13515.575>]}}}},
                {[],[]},
                undefined,undefined,undefined,undefined,
                {state,fine,5000,undefined},
                {0,nil},
                100000,undefined,1365529282744274,
                {dict,6,16,16,8,80,48,
                    {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                    {{[],
                      [[<0.17350.499>|#Ref<0.0.14563.86478>]],
                      [[<0.17781.499>|#Ref<0.0.14563.86169>]],
                      [],
                      [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
                      [],
                      [[<7526.16733.575>|#Ref<0.0.14563.86260>],
                       [<7526.18741.575>|#Ref<0.0.14563.86683>]],
                      [],[],[],[],[],[],[],[],
                      [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
                1,
                {{0,nil},{0,nil}},
                undefined,
                {dict,0,16,16,8,80,48,
                    {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                    {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                {resource,<<"/fonsyncd/prod/">>,exchange,
                    <<"EX-fonsyncd-Exception">>},
                undefined}]},
        {gen_server2,handle_msg,2},
        {proc_lib,wake_up,3}]}

=ERROR REPORT==== 9-Apr-2013::10:56:49 ===
** Generic server <0.7181.510> terminating
** Last message in was {'$gen_cast',join}
** When Server state == {state,
                            {74,<0.7181.510>},
                            {{74,<0.7181.510>},undefined},
                            {{74,<0.7181.510>},undefined},
                            {resource,<<"/fonsyncd/prod/">>,queue,
                                <<"Q-SID.18335.fonsyncd">>},

rabbit_mirror_queue_slave,undefined,-1,undefined,
                            [<0.7180.510>],
                            {[],[]},
                            [],undefined}
** Reason for termination ==
** {{function_clause,
        [{rabbit_amqqueue_process,handle_call,
             [{add_on_right,{74,<0.7181.510>}},
              {<0.7181.510>,#Ref<0.0.14625.121725>},
              {q,{amqqueue,
                     {resource,<<"/fonsyncd/prod/">>,queue,
                         <<"Q-SID.16970.fonsyncd">>},
                     true,false,none,
                     [{<<"x-message-ttl">>,signedint,100000},
                      {<<"x-dead-letter-exchange">>,longstr,
                       <<"EX-fonsyncd-Exception">>},
                      {<<"x-ha-policy">>,longstr,<<"all">>}],
                     <0.4403.0>,[],all},
                 none,false,rabbit_mirror_queue_master,
                 {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
                     {vqstate,
                         {0,{[],[]}},
                         {0,{[],[]}},
                         {delta,undefined,0,undefined},
                         {0,{[],[]}},
                         {0,{[],[]}},
                         2114,
                         {0,nil},
                         undefined,
                         {0,nil},
                         {qistate,
                             "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/queues/EYHEI3SQW41F6NFSH8WB2CD91",
                             {{dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                              []},
                             #Ref<0.0.25.88612>,0,262144,
                             #Fun<rabbit_variable_queue.2.36908642>,
                             {0,nil}},
                         {{client_msstate,msg_store_persistent,

<<72,22,217,216,236,0,110,187,235,185,163,249,92,
                                182,156,56>>,
                              {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                              {state,696393,
                                  "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent"},
                              rabbit_msg_store_ets_index,
                              "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent",
                              <0.269.0>,700490,692296,704587,708684},
                          {client_msstate,msg_store_transient,

<<51,15,67,134,52,182,142,196,131,185,177,5,223,
                                15,45,61>>,
                              {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                              {state,675908,
                                  "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient"},
                              rabbit_msg_store_ets_index,
                              "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient",
                              <0.264.0>,680005,671795,684102,688199}},

 true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,
                         0,infinity,0,0,0,0,0,
                         {rates,
                             {{1365,529204,602738},0},
                             {{1365,529204,602738},0},
                             0.0,0.0,
                             {1365,529286,74299}},
                         {0,nil},
                         {0,nil},
                         {0,nil},
                         {0,nil},
                         0,0,
                         {rates,
                             {{1365,529204,602738},0},
                             {{1365,529204,602738},0},
                             0.0,0.0,
                             {1365,529286,74299}}},
                     0,
                     {dict,0,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                     [],
                     {dict,0,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                     {set,6,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                         {{[],
                           [<0.17350.499>],
                           [<0.17781.499>],
                           [],
                           [<7525.9758.575>],
                           [],
                           [<7526.18741.575>,<7526.16733.575>],
                           [],[],[],[],[],[],[],[],
                           [<7525.13515.575>]}}}},
                 {[],[]},
                 undefined,undefined,undefined,undefined,
                 {state,fine,5000,undefined},
                 {0,nil},
                 100000,undefined,1365529282744274,
                 {dict,6,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                     {{[],
                       [[<0.17350.499>|#Ref<0.0.14563.86478>]],
                       [[<0.17781.499>|#Ref<0.0.14563.86169>]],
                       [],
                       [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
                       [],
                       [[<7526.16733.575>|#Ref<0.0.14563.86260>],
                        [<7526.18741.575>|#Ref<0.0.14563.86683>]],
                       [],[],[],[],[],[],[],[],
                       [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
                 1,
                 {{0,nil},{0,nil}},
                 undefined,
                 {dict,0,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                     {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                 {resource,<<"/fonsyncd/prod/">>,exchange,
                     <<"EX-fonsyncd-Exception">>},
                 undefined}]},
         {gen_server2,handle_msg,2},
         {proc_lib,wake_up,3}]},

{gen_server2,call,[<0.4403.0>,{add_on_right,{74,<0.7181.510>}},infinity]}}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130410/6c5c73d3/attachment.htm>

From JWU2 at lifetouch.com  Wed Apr 10 18:58:46 2013
From: JWU2 at lifetouch.com (Jim Wu)
Date: Wed, 10 Apr 2013 17:58:46 +0000
Subject: [rabbitmq-discuss] Connect to RabbitMQ server over BigIP failed
Message-ID: <2E0219B99692FF489BBB96C50340D70314876FCE@LTIVW-P-MBX01.LIFETOUCH.NET>

Hi,

I need help on an issue  in BigIP/F5 load balanced rabbitMQ cluster. We set up a cluster of two RabbitMQ servers which were fronted by a BigIP load balancer.

When running a client program (Java based) to send messages to each rabbitMQ server directly, it works fine.  However, when using the same client to send messages via BigIP VIP (pointing to the RabbitMQ cluster), I got the following error.  Double checked the BigIP setup, and it seems right (TCP/IP timeout set at 5mins).  Thanks for shedding some light on it.

java.io.IOException
       at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:106)
       at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:102)
       at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:360)
       at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:516)
       at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:533)
       at com.rabbitmq.examples.SendString.main(SendString.java:44)
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error; reason: java.net.SocketTimeoutException: Timeout during Connection negotiation
       at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
       at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
       at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
       at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:313)
       ... 3 more
Caused by: java.net.SocketTimeoutException: Timeout during Connection negotiation
       at com.rabbitmq.client.impl.AMQConnection.handleSocketTimeout(AMQConnection.java:566)
       at com.rabbitmq.client.impl.AMQConnection.access$500(AMQConnection.java:59)
       at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:541)


Jim Wu


______________________________________________________________________
This email has been scanned by the Symantec Email Security.cloud service.
For more information please visit http://www.symanteccloud.com
_____________________________________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130410/e351e8dd/attachment.htm>

From richard at raseley.com  Wed Apr 10 19:18:45 2013
From: richard at raseley.com (Richard Raseley)
Date: Wed, 10 Apr 2013 11:18:45 -0700
Subject: [rabbitmq-discuss] Federated Link Not Producing Logging
Message-ID: <CAO=6ox_potEG+Ygu_10_-VLyGLFq1yWM+qzeY2d==QG-MuML2A@mail.gmail.com>

I am attempting to created a federated link between two clusters (Cluster01
and Cluster02) over a custom port configured for SSL. On Cluster01 I define
Cluster02 as upstream, and on Cluster02 I define Cluster01 as the upstream
(I am doing this all through the management UI).

After applying the changes, neither cluster shows as having an active
federated link, yet there are no errors or events of any kind logged
related to federation in /var/log/rabbitmq/rabbitmq.log. Any ideas why this
might be?

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130410/ae362afc/attachment.htm>

From richard at raseley.com  Wed Apr 10 19:38:21 2013
From: richard at raseley.com (Richard Raseley)
Date: Wed, 10 Apr 2013 11:38:21 -0700
Subject: [rabbitmq-discuss] Issue with specifying custom vhost and port in
	federation URI.
Message-ID: <CAO=6ox94BShdMS1egwEopnya-8kFMG_TY0QMLNRLwDEfvKLwfA@mail.gmail.com>

=WARNING REPORT==== 10-Apr-2013::11:31:27 ===
Federation exchange 'amq.topic' in vhost 'myvhost' did not connect to
exchange 'amq.topic' in vhost *'myvhost:5671'* on amqp://
myuser:mypass at remotesite.domain.com/myvhost:5671
{error,etimedout}

As you can see above, there seems to be some issue where RabbitMQ
is concatenating the custom vhost name and custom port when used together
in a federation URI. Is this a known issue? Is my syntax just incorrect? Am
I just reading this wrong?

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130410/a1a608ea/attachment.htm>

From efuquen at gmail.com  Wed Apr 10 19:53:37 2013
From: efuquen at gmail.com (Edwin Fuquen)
Date: Wed, 10 Apr 2013 14:53:37 -0400
Subject: [rabbitmq-discuss] rabbitmq-server with esl-erlang in debian
In-Reply-To: <51654637.7040403@rabbitmq.com>
References: <6f01c607-fe2e-47bf-bd9c-21eabc3619e3@a14g2000vbm.googlegroups.com>
	<516536D7.1020001@rabbitmq.com> <51654637.7040403@rabbitmq.com>
Message-ID: <CAHRJs4eDdzn80cgetfe-rOD7KO79qs-cJa-4iLJ+X9Fzg_jDBA@mail.gmail.com>

awesome, thanks so much.  any idea on a timeframe for the next release?


On Wed, Apr 10, 2013 at 7:00 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 10/04/13 10:54, Simon MacMullen wrote:
>
>> I think we could just depend on erlang-nox | esl-erlang
>>
>
> Yes, that works. So the next release will do so.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130410/f5e18010/attachment.htm>

From wsmith at tacc.utexas.edu  Wed Apr 10 20:58:38 2013
From: wsmith at tacc.utexas.edu (Warren Smith)
Date: Wed, 10 Apr 2013 19:58:38 +0000
Subject: [rabbitmq-discuss] error parsing DN
Message-ID: <4B5D885B77E8CC43852B8F0315AD03BA41BCD015@EXMBX01.austin.utexas.edu>


Hi, I'm getting an error parsing a distinguished name in an X.509 certificate and I'm wondering if this is a bug in the RabbitMQ code. The error in the RabbitMQ log file is:

{handshake_error,opening,0,
                 {error,badarg,'connection.open',
                        [{io_lib,format,
                                 ["\\~2.16.0B",
                                  [[60,60,
                                    ["19",44,"7",44,"99",44,"101",44,"114",44,
                                     "116",44,"109",44,"97",44,"110"],
                                    62,62]]],
                                 [{file,"io_lib.erl"},{line,152}]},
                         {rabbit_misc,format,2,
                                      [{file,"src/rabbit_misc.erl"},
                                       {line,608}]},
                         {rabbit_ssl,escape_rdn_value,2,
                                     [{file,"src/rabbit_ssl.erl"},{line,196}]},
                         {rabbit_ssl,format_rdn,1,
                                     [{file,"src/rabbit_ssl.erl"},{line,149}]},
                         {rabbit_ssl,'-format_complex_rdn/1-lc$^0/1-0-',1,
                                     [{file,"src/rabbit_ssl.erl"},{line,144}]},
                         {rabbit_ssl,format_complex_rdn,1,
                                     [{file,"src/rabbit_ssl.erl"},{line,144}]},
                         {rabbit_ssl,'-format_rdn_sequence/1-lc$^0/1-0-',1,
                                     [{file,"src/rabbit_ssl.erl"},{line,140}]},
                         {rabbit_ssl,'-format_rdn_sequence/1-lc$^0/1-0-',1,
                                     [{file,"src/rabbit_ssl.erl"},
                                      {line,140}]}]}}

It looks like there is a failure to parse either the subject or the issue of the client certificate. The client certificate is:

-----BEGIN CERTIFICATE-----
MIIEWzCCA0OgAwIBAgICB0YwDQYJKoZIhvcNAQEFBQAwZzELMAkGA1UEBhMCVVMx
DTALBgNVBAoTBFNEU0MxEDAOBgNVBAsTB1NEU0MtQ0ExHjAcBgNVBAMTFUNlcnRp
ZmljYXRlIEF1dGhvcml0eTEXMBUGCgmSJomT8ixkAQETB2NlcnRtYW4wHhcNMTIw
NTE0MTYzODQ1WhcNMTMwNTE1MTYzODQ1WjA/MQswCQYDVQQGEwJVUzENMAsGA1UE
ChMEU0RTQzENMAsGA1UECxMEU0RTQzESMBAGA1UEAxMJSW5jYSBJbmNhMIIBIjAN
BgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyKfvUWlReQgoQHhOFskbfaak6Q4y
BkmhCr9XbmDIOLwN7RoUm2/Av+e4kQnjo2fyraUa9Fio7KWWfDaxnIWcS6Rnx+dI
usMvxXgpx0tsCIAAB05QKBF1VuMvT0Hu+MFnkNgeRrbP4hInYPEzt6wuzcG/PTc7
6+zTsZ20xo9vbrV6saALuKaYyMZ/R6UUgHqIDaYiVXd+s2psC2wbgBX44cLvlXK9
cQXKoEHwHE7wWkGplgVRAR2wKSzKQkkRZb4d+BDHUg6+1rHM2rIrPo5MyVK9ZAo8
7cMQQOgiWMF97GDs7Nw9wYWjrAcRkw7iMqAjnz3FqEmFc5Ge8oQVF+OZkQIDAQAB
o4IBNzCCATMwCQYDVR0TBAIwADARBglghkgBhvhCAQEEBAMCBLAwLAYJYIZIAYb4
QgENBB8WHU9wZW5TU0wgR2VuZXJhdGVkIENlcnRpZmljYXRlMDIGCWCGSAGG+EIB
BAQlFiNodHRwOi8vd3d3LnNkc2MuZWR1L0NBL1NEU0NfQ1JMLnBlbTAdBgNVHQ4E
FgQUGo1yIlgWwzgzxPKg3dQ+HpnjvD4wgZEGA1UdIwSBiTCBhoAUv6OHLPYNdL1I
bA4nvwHk8k9Guieha6RpMGcxCzAJBgNVBAYTAlVTMQ0wCwYDVQQKEwRTRFNDMRAw
DgYDVQQLEwdTRFNDLUNBMR4wHAYDVQQDExVDZXJ0aWZpY2F0ZSBBdXRob3JpdHkx
FzAVBgoJkiaJk/IsZAEBEwdjZXJ0bWFuggEAMA0GCSqGSIb3DQEBBQUAA4IBAQBv
/3MSvUFWU0oV313RpR7922vnIjzZnuvUDPyTRhfqPpCQ9Yw9CFEsS8rM9xyqJ4wc
eLEB4zFn03DtUF3/5rqRG9KyEh8K8eJt5Ow7tBy6OQzgirZs1jhKL/2Ck6d+Adr8
XtaUy9c3VLYB4sU1yIEjDxD3YkLHZsLEFnfcWWmWr3p629/pEUhk04sUjz8ZUn7k
dlBMiX9nuBFWovpzn0urlqcqYKLqa7g7equH0ToxstABVOuw3e9L0pDQQs+SZZc6
EqwcEnwQ+TnaADGUr821gUaW8pxbpsi53d/0FpwA4Lc9OvCg6EVR2Tr/8p+jnH/v
0opU2WNT6IuglYjI6tvD
-----END CERTIFICATE-----

This certificate (and its CA certificate below) can be parsed by OpenSSL and Erlang.

In case it is helpful, the CA certificate for the above is:

-----BEGIN CERTIFICATE-----
MIIEDjCCAvagAwIBAgIBADANBgkqhkiG9w0BAQQFADBnMQswCQYDVQQGEwJVUzEN
MAsGA1UEChMEU0RTQzEQMA4GA1UECxMHU0RTQy1DQTEeMBwGA1UEAxMVQ2VydGlm
aWNhdGUgQXV0aG9yaXR5MRcwFQYKCZImiZPyLGQBARMHY2VydG1hbjAeFw0wNDA5
MDkwMjQyMjlaFw0xNDA5MDkwMjQyMjlaMGcxCzAJBgNVBAYTAlVTMQ0wCwYDVQQK
EwRTRFNDMRAwDgYDVQQLEwdTRFNDLUNBMR4wHAYDVQQDExVDZXJ0aWZpY2F0ZSBB
dXRob3JpdHkxFzAVBgoJkiaJk/IsZAEBEwdjZXJ0bWFuMIIBIjANBgkqhkiG9w0B
AQEFAAOCAQ8AMIIBCgKCAQEArXaQKLYiWyAq6ywSOAmKnmiV3u6tXCBmOYlF7Pzp
hHssQvgomjeh7H31PLzNlxTy/dXQOeyBaDowAL2kCzgwrh/cUo79tZu77Xzgc9o5
WR+Jq1huI2Au8QEz77PIi2c3fhsWyOYJMvHWXkDXhEr6YxYd1eTaIj435bZOJxVq
ZF6HePoB5cpflx54KkjjoY3Vh0407EUW9kA7Jcx86dIqH7cSupmPTORsAxvYTmwd
1qODvd6i06dBcR9VMCTSA4trJTS6pCodKSjLCR6Ru9dgUpwB65gNwH6AVEmmxVet
oXVsotHTMEghLAp5FBpMNF+s7olt7g19fq8VHnuhRRGkmQIDAQABo4HEMIHBMB0G
A1UdDgQWBBS/o4cs9g10vUhsDie/AeTyT0a6JzCBkQYDVR0jBIGJMIGGgBS/o4cs
9g10vUhsDie/AeTyT0a6J6FrpGkwZzELMAkGA1UEBhMCVVMxDTALBgNVBAoTBFNE
U0MxEDAOBgNVBAsTB1NEU0MtQ0ExHjAcBgNVBAMTFUNlcnRpZmljYXRlIEF1dGhv
cml0eTEXMBUGCgmSJomT8ixkAQETB2NlcnRtYW6CAQAwDAYDVR0TBAUwAwEB/zAN
BgkqhkiG9w0BAQQFAAOCAQEAWExIzttzYctC98r6ZC6h2uXPbyo9bvaU0fxtBrDF
prD23yq8WXClIzKbOxBpRETr1kkeQbzX2R5quFLTTMd6GNqP+I28sklM9FUCLqKV
DD75UjTqa0AVPgbNdRUECrm2wXXWTVpNIzTgX1M/uVX3yyQRHyi5gj7pqsESOTZ1
0xyOx4YnpCjrG9HCWIp0wjigWGw8I/GXe0UEPbAJTcPY844Z7E/PfyZuwcdYQSZF
L030oKjrlWbKm/vGywbqt5QahKM1J60Z6WyIh7VeJV4YuvsP3bT0Sd4FXzmnhybq
ca98K+/TyIvcWUgD/BGv4XYaUTOYWQRWOZGRSgGfwRq0FQ==
-----END CERTIFICATE-----



From wsmith at tacc.utexas.edu  Wed Apr 10 21:01:13 2013
From: wsmith at tacc.utexas.edu (Warren Smith)
Date: Wed, 10 Apr 2013 20:01:13 +0000
Subject: [rabbitmq-discuss] error parsing DN
In-Reply-To: <4B5D885B77E8CC43852B8F0315AD03BA41BCD015@EXMBX01.austin.utexas.edu>
References: <4B5D885B77E8CC43852B8F0315AD03BA41BCD015@EXMBX01.austin.utexas.edu>
Message-ID: <4B5D885B77E8CC43852B8F0315AD03BA41BCD02B@EXMBX01.austin.utexas.edu>


And I probably should have said RabbitMQ 3.0.4 and Erlang R16B.


Warren



> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
> discuss-bounces at lists.rabbitmq.com] On Behalf Of Warren Smith
> Sent: Wednesday, April 10, 2013 2:59 PM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] error parsing DN
> 
> 
> Hi, I'm getting an error parsing a distinguished name in an X.509
> certificate and I'm wondering if this is a bug in the RabbitMQ code.
> The error in the RabbitMQ log file is:
> 
> {handshake_error,opening,0,
>                  {error,badarg,'connection.open',
>                         [{io_lib,format,
>                                  ["\\~2.16.0B",
>                                   [[60,60,
> 
> ["19",44,"7",44,"99",44,"101",44,"114",44,
>                                      "116",44,"109",44,"97",44,"110"],
>                                     62,62]]],
>                                  [{file,"io_lib.erl"},{line,152}]},
>                          {rabbit_misc,format,2,
>                                       [{file,"src/rabbit_misc.erl"},
>                                        {line,608}]},
>                          {rabbit_ssl,escape_rdn_value,2,
> 
> [{file,"src/rabbit_ssl.erl"},{line,196}]},
>                          {rabbit_ssl,format_rdn,1,
> 
> [{file,"src/rabbit_ssl.erl"},{line,149}]},
>                          {rabbit_ssl,'-format_complex_rdn/1-lc$^0/1-0-
> ',1,
> 
> [{file,"src/rabbit_ssl.erl"},{line,144}]},
>                          {rabbit_ssl,format_complex_rdn,1,
> 
> [{file,"src/rabbit_ssl.erl"},{line,144}]},
>                          {rabbit_ssl,'-format_rdn_sequence/1-lc$^0/1-0-
> ',1,
> 
> [{file,"src/rabbit_ssl.erl"},{line,140}]},
>                          {rabbit_ssl,'-format_rdn_sequence/1-lc$^0/1-0-
> ',1,
>                                      [{file,"src/rabbit_ssl.erl"},
>                                       {line,140}]}]}}
> 
> It looks like there is a failure to parse either the subject or the
> issue of the client certificate. The client certificate is:
> 
> -----BEGIN CERTIFICATE-----
> MIIEWzCCA0OgAwIBAgICB0YwDQYJKoZIhvcNAQEFBQAwZzELMAkGA1UEBhMCVVMx
> DTALBgNVBAoTBFNEU0MxEDAOBgNVBAsTB1NEU0MtQ0ExHjAcBgNVBAMTFUNlcnRp
> ZmljYXRlIEF1dGhvcml0eTEXMBUGCgmSJomT8ixkAQETB2NlcnRtYW4wHhcNMTIw
> NTE0MTYzODQ1WhcNMTMwNTE1MTYzODQ1WjA/MQswCQYDVQQGEwJVUzENMAsGA1UE
> ChMEU0RTQzENMAsGA1UECxMEU0RTQzESMBAGA1UEAxMJSW5jYSBJbmNhMIIBIjAN
> BgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyKfvUWlReQgoQHhOFskbfaak6Q4y
> BkmhCr9XbmDIOLwN7RoUm2/Av+e4kQnjo2fyraUa9Fio7KWWfDaxnIWcS6Rnx+dI
> usMvxXgpx0tsCIAAB05QKBF1VuMvT0Hu+MFnkNgeRrbP4hInYPEzt6wuzcG/PTc7
> 6+zTsZ20xo9vbrV6saALuKaYyMZ/R6UUgHqIDaYiVXd+s2psC2wbgBX44cLvlXK9
> cQXKoEHwHE7wWkGplgVRAR2wKSzKQkkRZb4d+BDHUg6+1rHM2rIrPo5MyVK9ZAo8
> 7cMQQOgiWMF97GDs7Nw9wYWjrAcRkw7iMqAjnz3FqEmFc5Ge8oQVF+OZkQIDAQAB
> o4IBNzCCATMwCQYDVR0TBAIwADARBglghkgBhvhCAQEEBAMCBLAwLAYJYIZIAYb4
> QgENBB8WHU9wZW5TU0wgR2VuZXJhdGVkIENlcnRpZmljYXRlMDIGCWCGSAGG+EIB
> BAQlFiNodHRwOi8vd3d3LnNkc2MuZWR1L0NBL1NEU0NfQ1JMLnBlbTAdBgNVHQ4E
> FgQUGo1yIlgWwzgzxPKg3dQ+HpnjvD4wgZEGA1UdIwSBiTCBhoAUv6OHLPYNdL1I
> bA4nvwHk8k9Guieha6RpMGcxCzAJBgNVBAYTAlVTMQ0wCwYDVQQKEwRTRFNDMRAw
> DgYDVQQLEwdTRFNDLUNBMR4wHAYDVQQDExVDZXJ0aWZpY2F0ZSBBdXRob3JpdHkx
> FzAVBgoJkiaJk/IsZAEBEwdjZXJ0bWFuggEAMA0GCSqGSIb3DQEBBQUAA4IBAQBv
> /3MSvUFWU0oV313RpR7922vnIjzZnuvUDPyTRhfqPpCQ9Yw9CFEsS8rM9xyqJ4wc
> eLEB4zFn03DtUF3/5rqRG9KyEh8K8eJt5Ow7tBy6OQzgirZs1jhKL/2Ck6d+Adr8
> XtaUy9c3VLYB4sU1yIEjDxD3YkLHZsLEFnfcWWmWr3p629/pEUhk04sUjz8ZUn7k
> dlBMiX9nuBFWovpzn0urlqcqYKLqa7g7equH0ToxstABVOuw3e9L0pDQQs+SZZc6
> EqwcEnwQ+TnaADGUr821gUaW8pxbpsi53d/0FpwA4Lc9OvCg6EVR2Tr/8p+jnH/v
> 0opU2WNT6IuglYjI6tvD
> -----END CERTIFICATE-----
> 
> This certificate (and its CA certificate below) can be parsed by
> OpenSSL and Erlang.
> 
> In case it is helpful, the CA certificate for the above is:
> 
> -----BEGIN CERTIFICATE-----
> MIIEDjCCAvagAwIBAgIBADANBgkqhkiG9w0BAQQFADBnMQswCQYDVQQGEwJVUzEN
> MAsGA1UEChMEU0RTQzEQMA4GA1UECxMHU0RTQy1DQTEeMBwGA1UEAxMVQ2VydGlm
> aWNhdGUgQXV0aG9yaXR5MRcwFQYKCZImiZPyLGQBARMHY2VydG1hbjAeFw0wNDA5
> MDkwMjQyMjlaFw0xNDA5MDkwMjQyMjlaMGcxCzAJBgNVBAYTAlVTMQ0wCwYDVQQK
> EwRTRFNDMRAwDgYDVQQLEwdTRFNDLUNBMR4wHAYDVQQDExVDZXJ0aWZpY2F0ZSBB
> dXRob3JpdHkxFzAVBgoJkiaJk/IsZAEBEwdjZXJ0bWFuMIIBIjANBgkqhkiG9w0B
> AQEFAAOCAQ8AMIIBCgKCAQEArXaQKLYiWyAq6ywSOAmKnmiV3u6tXCBmOYlF7Pzp
> hHssQvgomjeh7H31PLzNlxTy/dXQOeyBaDowAL2kCzgwrh/cUo79tZu77Xzgc9o5
> WR+Jq1huI2Au8QEz77PIi2c3fhsWyOYJMvHWXkDXhEr6YxYd1eTaIj435bZOJxVq
> ZF6HePoB5cpflx54KkjjoY3Vh0407EUW9kA7Jcx86dIqH7cSupmPTORsAxvYTmwd
> 1qODvd6i06dBcR9VMCTSA4trJTS6pCodKSjLCR6Ru9dgUpwB65gNwH6AVEmmxVet
> oXVsotHTMEghLAp5FBpMNF+s7olt7g19fq8VHnuhRRGkmQIDAQABo4HEMIHBMB0G
> A1UdDgQWBBS/o4cs9g10vUhsDie/AeTyT0a6JzCBkQYDVR0jBIGJMIGGgBS/o4cs
> 9g10vUhsDie/AeTyT0a6J6FrpGkwZzELMAkGA1UEBhMCVVMxDTALBgNVBAoTBFNE
> U0MxEDAOBgNVBAsTB1NEU0MtQ0ExHjAcBgNVBAMTFUNlcnRpZmljYXRlIEF1dGhv
> cml0eTEXMBUGCgmSJomT8ixkAQETB2NlcnRtYW6CAQAwDAYDVR0TBAUwAwEB/zAN
> BgkqhkiG9w0BAQQFAAOCAQEAWExIzttzYctC98r6ZC6h2uXPbyo9bvaU0fxtBrDF
> prD23yq8WXClIzKbOxBpRETr1kkeQbzX2R5quFLTTMd6GNqP+I28sklM9FUCLqKV
> DD75UjTqa0AVPgbNdRUECrm2wXXWTVpNIzTgX1M/uVX3yyQRHyi5gj7pqsESOTZ1
> 0xyOx4YnpCjrG9HCWIp0wjigWGw8I/GXe0UEPbAJTcPY844Z7E/PfyZuwcdYQSZF
> L030oKjrlWbKm/vGywbqt5QahKM1J60Z6WyIh7VeJV4YuvsP3bT0Sd4FXzmnhybq
> ca98K+/TyIvcWUgD/BGv4XYaUTOYWQRWOZGRSgGfwRq0FQ==
> -----END CERTIFICATE-----
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From steveolivier22 at gmail.com  Wed Apr 10 21:02:51 2013
From: steveolivier22 at gmail.com (SteveO)
Date: Wed, 10 Apr 2013 13:02:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Issue with specifying custom vhost and port
	in federation URI.
In-Reply-To: <CAO=6ox94BShdMS1egwEopnya-8kFMG_TY0QMLNRLwDEfvKLwfA@mail.gmail.com>
References: <CAO=6ox94BShdMS1egwEopnya-8kFMG_TY0QMLNRLwDEfvKLwfA@mail.gmail.com>
Message-ID: <1365624171514-25979.post@n5.nabble.com>

Shouldn't the port specification come right after the host?

AMQP URI Spec <http://www.rabbitmq.com/uri-spec.html>  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Issue-with-specifying-custom-vhost-and-port-in-federation-URI-tp25975p25979.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From watson.timothy at gmail.com  Wed Apr 10 21:27:01 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 10 Apr 2013 21:27:01 +0100
Subject: [rabbitmq-discuss] Connect to RabbitMQ server over BigIP failed
In-Reply-To: <2E0219B99692FF489BBB96C50340D70314876FCE@LTIVW-P-MBX01.LIFETOUCH.NET>
References: <2E0219B99692FF489BBB96C50340D70314876FCE@LTIVW-P-MBX01.LIFETOUCH.NET>
Message-ID: <9CF3785F-89A7-4E07-BC1B-B7CDB312DE54@rabbitmq.com>

Looks like the LB isn't responding. Suggest checking the BigIP logs and rabbit server logs to see if connections are making it through ok.

Cheers
Tim

On 10 Apr 2013, at 18:58, Jim Wu <JWU2 at lifetouch.com> wrote:

> Hi,
>  
> I need help on an issue  in BigIP/F5 load balanced rabbitMQ cluster. We set up a cluster of two RabbitMQ servers which were fronted by a BigIP load balancer.
>  
> When running a client program (Java based) to send messages to each rabbitMQ server directly, it works fine.  However, when using the same client to send messages via BigIP VIP (pointing to the RabbitMQ cluster), I got the following error.  Double checked the BigIP setup, and it seems right (TCP/IP timeout set at 5mins).  Thanks for shedding some light on it.
>  
> java.io.IOException
>        at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:106)
>        at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:102)
>        at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:360)
>        at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:516)
>        at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:533)
>        at com.rabbitmq.examples.SendString.main(SendString.java:44)
> Caused by: com.rabbitmq.client.ShutdownSignalException: connection error; reason: java.net.SocketTimeoutException: Timeout during Connection negotiation
>        at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
>        at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
>        at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
>        at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:313)
>        ... 3 more
> Caused by: java.net.SocketTimeoutException: Timeout during Connection negotiation
>        at com.rabbitmq.client.impl.AMQConnection.handleSocketTimeout(AMQConnection.java:566)
>        at com.rabbitmq.client.impl.AMQConnection.access$500(AMQConnection.java:59)
>        at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:541)
>  
>  
> Jim Wu
>  
> 
> ______________________________________________________________________
> This email has been scanned by the Symantec Email Security.cloud service.
> For more information please visit http://www.symanteccloud.com
> _____________________________________________________________________
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130410/9a25e677/attachment.htm>

From watson.timothy at gmail.com  Wed Apr 10 21:28:48 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 10 Apr 2013 21:28:48 +0100
Subject: [rabbitmq-discuss] Issue with specifying custom vhost and port
	in federation URI.
In-Reply-To: <CAO=6ox94BShdMS1egwEopnya-8kFMG_TY0QMLNRLwDEfvKLwfA@mail.gmail.com>
References: <CAO=6ox94BShdMS1egwEopnya-8kFMG_TY0QMLNRLwDEfvKLwfA@mail.gmail.com>
Message-ID: <AFA989C1-4712-441C-867A-BF05C354A63E@rabbitmq.com>

What does your federation config look like?

On 10 Apr 2013, at 19:38, Richard Raseley <richard at raseley.com> wrote:

> =WARNING REPORT==== 10-Apr-2013::11:31:27 ===
> Federation exchange 'amq.topic' in vhost 'myvhost' did not connect to exchange 'amq.topic' in vhost 'myvhost:5671' on amqp://myuser:mypass at remotesite.domain.com/myvhost:5671
> {error,etimedout}
> 
> As you can see above, there seems to be some issue where RabbitMQ is concatenating the custom vhost name and custom port when used together in a federation URI. Is this a known issue? Is my syntax just incorrect? Am I just reading this wrong?
> 
> Regards,
> 
> Richard
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130410/31761377/attachment.htm>

From richard at raseley.com  Wed Apr 10 22:02:23 2013
From: richard at raseley.com (Richard Raseley)
Date: Wed, 10 Apr 2013 14:02:23 -0700
Subject: [rabbitmq-discuss] Issue with specifying custom vhost and port
 in federation URI.
In-Reply-To: <1365624171514-25979.post@n5.nabble.com>
References: <CAO=6ox94BShdMS1egwEopnya-8kFMG_TY0QMLNRLwDEfvKLwfA@mail.gmail.com>
	<1365624171514-25979.post@n5.nabble.com>
Message-ID: <CAO=6ox9RyntNDkdGOPg-gGTeNMV=0V=kGR9uaugqyzF42D-=aA@mail.gmail.com>

Ah, thank you!


On Wed, Apr 10, 2013 at 1:02 PM, SteveO <steveolivier22 at gmail.com> wrote:

> Shouldn't the port specification come right after the host?
>
> AMQP URI Spec <http://www.rabbitmq.com/uri-spec.html>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Issue-with-specifying-custom-vhost-and-port-in-federation-URI-tp25975p25979.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130410/fa25dcb2/attachment.htm>

From emile at rabbitmq.com  Thu Apr 11 10:13:29 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 11 Apr 2013 10:13:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ crashed after all memory was
	consumed
In-Reply-To: <1365590417410-25960.post@n5.nabble.com>
References: <1365578735193-25952.post@n5.nabble.com>
	<51653206.5000407@rabbitmq.com>
	<1365590417410-25960.post@n5.nabble.com>
Message-ID: <51667EB9.8080307@rabbitmq.com>

On 10/04/13 11:40, jkuchta.db wrote:
> Thanks for the quick reply. 
> 
> The provided email does not work for me.


The test email and DNS diagnostics that I requested off-list arrived at
the support inbox. In any case it is unlikely that the dumpfile contains
any further useful information, so no need to take that any further.




-Emile







From simon at rabbitmq.com  Thu Apr 11 10:32:30 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 11 Apr 2013 10:32:30 +0100
Subject: [rabbitmq-discuss] Federated Link Not Producing Logging
In-Reply-To: <CAO=6ox_potEG+Ygu_10_-VLyGLFq1yWM+qzeY2d==QG-MuML2A@mail.gmail.com>
References: <CAO=6ox_potEG+Ygu_10_-VLyGLFq1yWM+qzeY2d==QG-MuML2A@mail.gmail.com>
Message-ID: <5166832E.6080100@rabbitmq.com>

You need to do two things for federation to work:

1) Define one or more upstreams.
2) Define a policy to determine which exchanges are federated.

You don't mention having done the second - have you done so?

Cheers, Simon

On 10/04/13 19:18, Richard Raseley wrote:
> I am attempting to created a federated link between two clusters
> (Cluster01 and Cluster02) over a custom port configured for SSL. On
> Cluster01 I define Cluster02 as upstream, and on Cluster02 I define
> Cluster01 as the upstream (I am doing this all through the management UI).
>
> After applying the changes, neither cluster shows as having an active
> federated link, yet there are no errors or events of any kind logged
> related to federation in /var/log/rabbitmq/rabbitmq.log. Any ideas why
> this might be?
>
> Regards,
>
> Richard
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Apr 11 10:32:53 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 11 Apr 2013 10:32:53 +0100
Subject: [rabbitmq-discuss] rabbitmq-server with esl-erlang in debian
In-Reply-To: <CAHRJs4eDdzn80cgetfe-rOD7KO79qs-cJa-4iLJ+X9Fzg_jDBA@mail.gmail.com>
References: <6f01c607-fe2e-47bf-bd9c-21eabc3619e3@a14g2000vbm.googlegroups.com>
	<516536D7.1020001@rabbitmq.com> <51654637.7040403@rabbitmq.com>
	<CAHRJs4eDdzn80cgetfe-rOD7KO79qs-cJa-4iLJ+X9Fzg_jDBA@mail.gmail.com>
Message-ID: <51668345.9000802@rabbitmq.com>

On 10/04/13 19:53, Edwin Fuquen wrote:
> any idea on a timeframe for the next release?

Hopefully this month.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Apr 11 10:34:54 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 11 Apr 2013 10:34:54 +0100
Subject: [rabbitmq-discuss] error parsing DN
In-Reply-To: <4B5D885B77E8CC43852B8F0315AD03BA41BCD015@EXMBX01.austin.utexas.edu>
References: <4B5D885B77E8CC43852B8F0315AD03BA41BCD015@EXMBX01.austin.utexas.edu>
Message-ID: <516683BE.4040806@rabbitmq.com>

Wow, you wait ages for a bug and then two come along at once. This was 
just reported a few days ago [1]. We're already working on a fix, which 
will be in the next release.

[1] 
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-April/026415.html

Cheers, Simon

On 10/04/13 20:58, Warren Smith wrote:
>
> Hi, I'm getting an error parsing a distinguished name in an X.509 certificate and I'm wondering if this is a bug in the RabbitMQ code. The error in the RabbitMQ log file is:
>
> {handshake_error,opening,0,
>                   {error,badarg,'connection.open',
>                          [{io_lib,format,
>                                   ["\\~2.16.0B",
>                                    [[60,60,
>                                      ["19",44,"7",44,"99",44,"101",44,"114",44,
>                                       "116",44,"109",44,"97",44,"110"],
>                                      62,62]]],
>                                   [{file,"io_lib.erl"},{line,152}]},
>                           {rabbit_misc,format,2,
>                                        [{file,"src/rabbit_misc.erl"},
>                                         {line,608}]},
>                           {rabbit_ssl,escape_rdn_value,2,
>                                       [{file,"src/rabbit_ssl.erl"},{line,196}]},
>                           {rabbit_ssl,format_rdn,1,
>                                       [{file,"src/rabbit_ssl.erl"},{line,149}]},
>                           {rabbit_ssl,'-format_complex_rdn/1-lc$^0/1-0-',1,
>                                       [{file,"src/rabbit_ssl.erl"},{line,144}]},
>                           {rabbit_ssl,format_complex_rdn,1,
>                                       [{file,"src/rabbit_ssl.erl"},{line,144}]},
>                           {rabbit_ssl,'-format_rdn_sequence/1-lc$^0/1-0-',1,
>                                       [{file,"src/rabbit_ssl.erl"},{line,140}]},
>                           {rabbit_ssl,'-format_rdn_sequence/1-lc$^0/1-0-',1,
>                                       [{file,"src/rabbit_ssl.erl"},
>                                        {line,140}]}]}}
>
> It looks like there is a failure to parse either the subject or the issue of the client certificate. The client certificate is:
>
> -----BEGIN CERTIFICATE-----
> MIIEWzCCA0OgAwIBAgICB0YwDQYJKoZIhvcNAQEFBQAwZzELMAkGA1UEBhMCVVMx
> DTALBgNVBAoTBFNEU0MxEDAOBgNVBAsTB1NEU0MtQ0ExHjAcBgNVBAMTFUNlcnRp
> ZmljYXRlIEF1dGhvcml0eTEXMBUGCgmSJomT8ixkAQETB2NlcnRtYW4wHhcNMTIw
> NTE0MTYzODQ1WhcNMTMwNTE1MTYzODQ1WjA/MQswCQYDVQQGEwJVUzENMAsGA1UE
> ChMEU0RTQzENMAsGA1UECxMEU0RTQzESMBAGA1UEAxMJSW5jYSBJbmNhMIIBIjAN
> BgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyKfvUWlReQgoQHhOFskbfaak6Q4y
> BkmhCr9XbmDIOLwN7RoUm2/Av+e4kQnjo2fyraUa9Fio7KWWfDaxnIWcS6Rnx+dI
> usMvxXgpx0tsCIAAB05QKBF1VuMvT0Hu+MFnkNgeRrbP4hInYPEzt6wuzcG/PTc7
> 6+zTsZ20xo9vbrV6saALuKaYyMZ/R6UUgHqIDaYiVXd+s2psC2wbgBX44cLvlXK9
> cQXKoEHwHE7wWkGplgVRAR2wKSzKQkkRZb4d+BDHUg6+1rHM2rIrPo5MyVK9ZAo8
> 7cMQQOgiWMF97GDs7Nw9wYWjrAcRkw7iMqAjnz3FqEmFc5Ge8oQVF+OZkQIDAQAB
> o4IBNzCCATMwCQYDVR0TBAIwADARBglghkgBhvhCAQEEBAMCBLAwLAYJYIZIAYb4
> QgENBB8WHU9wZW5TU0wgR2VuZXJhdGVkIENlcnRpZmljYXRlMDIGCWCGSAGG+EIB
> BAQlFiNodHRwOi8vd3d3LnNkc2MuZWR1L0NBL1NEU0NfQ1JMLnBlbTAdBgNVHQ4E
> FgQUGo1yIlgWwzgzxPKg3dQ+HpnjvD4wgZEGA1UdIwSBiTCBhoAUv6OHLPYNdL1I
> bA4nvwHk8k9Guieha6RpMGcxCzAJBgNVBAYTAlVTMQ0wCwYDVQQKEwRTRFNDMRAw
> DgYDVQQLEwdTRFNDLUNBMR4wHAYDVQQDExVDZXJ0aWZpY2F0ZSBBdXRob3JpdHkx
> FzAVBgoJkiaJk/IsZAEBEwdjZXJ0bWFuggEAMA0GCSqGSIb3DQEBBQUAA4IBAQBv
> /3MSvUFWU0oV313RpR7922vnIjzZnuvUDPyTRhfqPpCQ9Yw9CFEsS8rM9xyqJ4wc
> eLEB4zFn03DtUF3/5rqRG9KyEh8K8eJt5Ow7tBy6OQzgirZs1jhKL/2Ck6d+Adr8
> XtaUy9c3VLYB4sU1yIEjDxD3YkLHZsLEFnfcWWmWr3p629/pEUhk04sUjz8ZUn7k
> dlBMiX9nuBFWovpzn0urlqcqYKLqa7g7equH0ToxstABVOuw3e9L0pDQQs+SZZc6
> EqwcEnwQ+TnaADGUr821gUaW8pxbpsi53d/0FpwA4Lc9OvCg6EVR2Tr/8p+jnH/v
> 0opU2WNT6IuglYjI6tvD
> -----END CERTIFICATE-----
>
> This certificate (and its CA certificate below) can be parsed by OpenSSL and Erlang.
>
> In case it is helpful, the CA certificate for the above is:
>
> -----BEGIN CERTIFICATE-----
> MIIEDjCCAvagAwIBAgIBADANBgkqhkiG9w0BAQQFADBnMQswCQYDVQQGEwJVUzEN
> MAsGA1UEChMEU0RTQzEQMA4GA1UECxMHU0RTQy1DQTEeMBwGA1UEAxMVQ2VydGlm
> aWNhdGUgQXV0aG9yaXR5MRcwFQYKCZImiZPyLGQBARMHY2VydG1hbjAeFw0wNDA5
> MDkwMjQyMjlaFw0xNDA5MDkwMjQyMjlaMGcxCzAJBgNVBAYTAlVTMQ0wCwYDVQQK
> EwRTRFNDMRAwDgYDVQQLEwdTRFNDLUNBMR4wHAYDVQQDExVDZXJ0aWZpY2F0ZSBB
> dXRob3JpdHkxFzAVBgoJkiaJk/IsZAEBEwdjZXJ0bWFuMIIBIjANBgkqhkiG9w0B
> AQEFAAOCAQ8AMIIBCgKCAQEArXaQKLYiWyAq6ywSOAmKnmiV3u6tXCBmOYlF7Pzp
> hHssQvgomjeh7H31PLzNlxTy/dXQOeyBaDowAL2kCzgwrh/cUo79tZu77Xzgc9o5
> WR+Jq1huI2Au8QEz77PIi2c3fhsWyOYJMvHWXkDXhEr6YxYd1eTaIj435bZOJxVq
> ZF6HePoB5cpflx54KkjjoY3Vh0407EUW9kA7Jcx86dIqH7cSupmPTORsAxvYTmwd
> 1qODvd6i06dBcR9VMCTSA4trJTS6pCodKSjLCR6Ru9dgUpwB65gNwH6AVEmmxVet
> oXVsotHTMEghLAp5FBpMNF+s7olt7g19fq8VHnuhRRGkmQIDAQABo4HEMIHBMB0G
> A1UdDgQWBBS/o4cs9g10vUhsDie/AeTyT0a6JzCBkQYDVR0jBIGJMIGGgBS/o4cs
> 9g10vUhsDie/AeTyT0a6J6FrpGkwZzELMAkGA1UEBhMCVVMxDTALBgNVBAoTBFNE
> U0MxEDAOBgNVBAsTB1NEU0MtQ0ExHjAcBgNVBAMTFUNlcnRpZmljYXRlIEF1dGhv
> cml0eTEXMBUGCgmSJomT8ixkAQETB2NlcnRtYW6CAQAwDAYDVR0TBAUwAwEB/zAN
> BgkqhkiG9w0BAQQFAAOCAQEAWExIzttzYctC98r6ZC6h2uXPbyo9bvaU0fxtBrDF
> prD23yq8WXClIzKbOxBpRETr1kkeQbzX2R5quFLTTMd6GNqP+I28sklM9FUCLqKV
> DD75UjTqa0AVPgbNdRUECrm2wXXWTVpNIzTgX1M/uVX3yyQRHyi5gj7pqsESOTZ1
> 0xyOx4YnpCjrG9HCWIp0wjigWGw8I/GXe0UEPbAJTcPY844Z7E/PfyZuwcdYQSZF
> L030oKjrlWbKm/vGywbqt5QahKM1J60Z6WyIh7VeJV4YuvsP3bT0Sd4FXzmnhybq
> ca98K+/TyIvcWUgD/BGv4XYaUTOYWQRWOZGRSgGfwRq0FQ==
> -----END CERTIFICATE-----
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Thu Apr 11 12:32:08 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 11 Apr 2013 12:32:08 +0100
Subject: [rabbitmq-discuss] Federation Over SSL with Intermediate
 Certificate Authority
In-Reply-To: <CAO=6ox9+F9sprfF4TCBe5JV1ONvOn4Cr5WSuQx1H0aGhN9vgTA@mail.gmail.com>
References: <CAO=6ox9+F9sprfF4TCBe5JV1ONvOn4Cr5WSuQx1H0aGhN9vgTA@mail.gmail.com>
Message-ID: <51669F38.1070805@rabbitmq.com>

Richard,

On 08/04/13 17:26, Richard Raseley wrote:
> When attempting to federate two brokers over SSL, I understand that one
> would configure SSL as described in the RabbitMQ documentation,
> then instantiate the federation connection over the port specified in
> the SSL configuration. That seems pretty straight forward. What I am not
> seeing any documentation on is the use of a certificate that requires an
> intermediate certificate to validate.
>
> I was able to find one thread from this discussion list from a while
> back
> (http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-March/018702.html),
> but it is not 100% clear to me what was done there to successfully
> include the intermediate certificate.
>
> Is there any official guidance out there on how to use an intermediate
> certificate in this scenario, or if not, could someone who has actually
> done this before comment on the process required to get it working?

Did you get this working in the end? If so, any suggestions for 
improving the rabbit docs?

Matthias.

From simon at rabbitmq.com  Thu Apr 11 14:04:28 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 11 Apr 2013 14:04:28 +0100
Subject: [rabbitmq-discuss] Rabbit Cluster Failure
In-Reply-To: <CAO4q6_9fnfEKOmJPO30BFvGZwpP4_M0PeHo2FNgrd6RUo2MeMw@mail.gmail.com>
References: <CAO4q6_9fnfEKOmJPO30BFvGZwpP4_M0PeHo2FNgrd6RUo2MeMw@mail.gmail.com>
Message-ID: <5166B4DC.5080306@rabbitmq.com>

Hi. We haven't seen a bug with that stack trace before, although I guess 
this could be a side effect of something we *have* already seen.

It's probably worth upgrading anyway - there are a few HA bugs which 
have been fixed in newer versions. Also, can you post / send complete 
logs so we can see if anything interesting happened before this?

Cheers, Simon

On 10/04/13 17:51, Farshad Meshkinpour wrote:
> Hello,
> We are running Rabbit 2.8.6 on Erlang R14B04.  We got this error on one
> of 3 rabbit servers in our cluster. After that we observed the followings:
> 1. all 3 rabbit servers went on high cpu usage
> 2. management interface was not functional
> 3. workers were not able to consume from queues
>
> Trying to stop the rabbit server failed (/etc/init.d/rabbitmq-server
> stop) and end up hard kill (kill -9) rabbit process on all nodes of the
> cluster to get the system back.  All mirrored queues contents were lost.
>
> Can someone points us to what may have caused this? Any help is greatly
> appreciated.
>
> Thanks,
>
>
> ERROR REPORT==== 9-Apr-2013::10:56:49 ===
> ** Generic server <0.9085.0> terminating
> ** Last message in was {'$gen_cast',
>                          {delete_and_terminate,
>                           {function_clause,
>                            [{rabbit_amqqueue_process,handle_call,
>                              [{add_on_right,{74,<0.7181.510>}},
>                               {<0.7181.510>,#Ref<0.0.14625.121725>},
>                               {q,
>                                {amqqueue,
>                                 {resource,<<"/fonsyncd/prod/">>,queue,
>                                  <<"Q-SID.16970.fonsyncd">>},
>                                 true,false,none,
>                                 [{<<"x-message-ttl">>,signedint,100000},
>                                  {<<"x-dead-letter-exchange">>,longstr,
>                                   <<"EX-fonsyncd-Exception">>},
>                                  {<<"x-ha-policy">>,longstr,<<"all">>}],
>                                 <0.4403.0>,[],all},
>                                none,false,rabbit_mirror_queue_master,
>                                {state,<0.4404.0>,<0.9085.0>,
>                                 rabbit_variable_queue,
>                                 {vqstate,
>                                  {0,{[],[]}},
>                                  {0,{[],[]}},
>                                  {delta,undefined,0,undefined},
>                                  {0,{[],[]}},
>                                  {0,{[],[]}},
>                                  2114,
>                                  {0,nil},
>                                  undefined,
>                                  {0,nil},
>                                  {qistate,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/queues/EYHEI3SQW41F6NFSH8WB2CD91",
>                                   {{dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                       [],[],[]}}},
>                                    []},
>                                   #Ref<0.0.25.88612>,0,262144,
>                                   #Fun<rabbit_variable_queue.2.36908642>,
>                                   {0,nil}},
>                                  {{client_msstate,msg_store_persistent,
>
> <<72,22,217,216,236,0,110,187,235,185,163,
>                                      249,92,182,156,56>>,
>                                    {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                       [],[],[]}}},
>                                    {state,696393,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent"},
>                                    rabbit_msg_store_ets_index,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent",
>                                    <0.269.0>,700490,692296,704587,708684},
>                                   {client_msstate,msg_store_transient,
>
> <<51,15,67,134,52,182,142,196,131,185,177,5,
>                                      223,15,45,61>>,
>                                    {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                       [],[],[]}}},
>                                    {state,675908,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient"},
>                                    rabbit_msg_store_ets_index,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient",
>                                    <0.264.0>,680005,671795,684102,688199}},
>                                  true,0,
>
> #Fun<rabbit_mirror_queue_slave.1.52898136>,0,
>                                  0,infinity,0,0,0,0,0,
>                                  {rates,
>                                   {{1365,529204,602738},0},
>                                   {{1365,529204,602738},0},
>                                   0.0,0.0,
>                                   {1365,529286,74299}},
>                                  {0,nil},
>                                  {0,nil},
>                                  {0,nil},
>                                  {0,nil},
>                                  0,0,
>                                  {rates,
>                                   {{1365,529204,602738},0},
>                                   {{1365,529204,602738},0},
>                                   0.0,0.0,
>                                   {1365,529286,74299}}},
>                                 0,
>                                 {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]}}},
>                                 [],
>                                 {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]}}},
>                                 {set,6,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   []},
>                                  {{[],
>                                    [<0.17350.499>],
>                                    [<0.17781.499>],
>                                    [],
>                                    [<7525.9758.575>],
>                                    [],
>                                    [<7526.18741.575>,<7526.16733.575>],
>                                    [],[],[],[],[],[],[],[],
>                                    [<7525.13515.575>]}}}},
>                                {[],[]},
>                                undefined,undefined,undefined,undefined,
>                                {state,fine,5000,undefined},
>                                {0,nil},
>                                100000,undefined,1365529282744274,
>                                {dict,6,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>                                 {{[],
>                                   [[<0.17350.499>|#Ref<0.0.14563.86478>]],
>                                   [[<0.17781.499>|#Ref<0.0.14563.86169>]],
>                                   [],
>                                   [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
>                                   [],
>                                   [[<7526.16733.575>|#Ref<0.0.14563.86260>],
>
> [<7526.18741.575>|#Ref<0.0.14563.86683>]],
>                                   [],[],[],[],[],[],[],[],
>
>   [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
>                                1,
>                                {{0,nil},{0,nil}},
>                                undefined,
>                                {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   []}}},
>                                {resource,<<"/fonsyncd/prod/">>,exchange,
>                                 <<"EX-fonsyncd-Exception">>},
>                                undefined}]},
>                             {gen_server2,handle_msg,2},
>                             {proc_lib,wake_up,3}]}}}
> ** When Server state == {state,
>                              {amqqueue,
>                                  {resource,<<"/fonsyncd/prod/">>,queue,
>                                      <<"Q-SID.16970.fonsyncd">>},
>                                  true,false,none,
>                                  [{<<"x-message-ttl">>,signedint,100000},
>                                   {<<"x-dead-letter-exchange">>,longstr,
>                                    <<"EX-fonsyncd-Exception">>},
>                                   {<<"x-ha-policy">>,longstr,<<"all">>}],
>                                  <0.4403.0>,[],all},
>                              <0.4404.0>,
>                              {dict,6,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   []},
>                                  {{[],
>                                    [[<0.17350.499>|#Ref<0.0.14563.86480>]],
>                                    [[<0.17781.499>|#Ref<0.0.14563.86174>]],
>                                    [],
>
> [[<7525.9758.575>|#Ref<0.0.14563.86397>]],
>                                    [],
>
> [[<7526.16733.575>|#Ref<0.0.14563.86263>],
>
>   [<7526.18741.575>|#Ref<0.0.14563.86686>]],
>                                    [],[],[],[],[],[],[],[],
>                                    [[<7525.13515.575>|
>                                      #Ref<0.0.14563.86622>]]}}},
>                              #Fun<rabbit_mirror_queue_master.1.37767645>,
>                              #Fun<rabbit_mirror_queue_master.2.24464450>}
> ** Reason for termination ==
> ** {function_clause,
>         [{rabbit_amqqueue_process,handle_call,
>              [{add_on_right,{74,<0.7181.510>}},
>               {<0.7181.510>,#Ref<0.0.14625.121725>},
>               {q,{amqqueue,
>                      {resource,<<"/fonsyncd/prod/">>,queue,
>                          <<"Q-SID.16970.fonsyncd">>},
>                      true,false,none,
>                      [{<<"x-message-ttl">>,signedint,100000},
>                       {<<"x-dead-letter-exchange">>,longstr,
>                        <<"EX-fonsyncd-Exception">>},
>                       {<<"x-ha-policy">>,longstr,<<"all">>}],
>                      <0.4403.0>,[],all},
>                  none,false,rabbit_mirror_queue_master,
>                  {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
>                      {vqstate,
>                          {0,{[],[]}},
>                          {0,{[],[]}},
>                          {delta,undefined,0,undefined},
>                          {0,{[],[]}},
>                          {0,{[],[]}},
>                          2114,
>                          {0,nil},
>                          undefined,
>                          {0,nil},
>                          {qistate,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/queues/EYHEI3SQW41F6NFSH8WB2CD91",
>                              {{dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               []},
>                              #Ref<0.0.25.88612>,0,262144,
>                              #Fun<rabbit_variable_queue.2.36908642>,
>                              {0,nil}},
>                          {{client_msstate,msg_store_persistent,
>
>   <<72,22,217,216,236,0,110,187,235,185,163,249,92,
>                                 182,156,56>>,
>                               {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               {state,696393,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent"},
>                               rabbit_msg_store_ets_index,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent",
>                               <0.269.0>,700490,692296,704587,708684},
>                           {client_msstate,msg_store_transient,
>
>   <<51,15,67,134,52,182,142,196,131,185,177,5,223,
>                                 15,45,61>>,
>                               {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               {state,675908,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient"},
>                               rabbit_msg_store_ets_index,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient",
>                               <0.264.0>,680005,671795,684102,688199}},
>
> true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,0,
>                          infinity,0,0,0,0,0,
>                          {rates,
>                              {{1365,529204,602738},0},
>                              {{1365,529204,602738},0},
>                              0.0,0.0,
>                              {1365,529286,74299}},
>                          {0,nil},
>                          {0,nil},
>                          {0,nil},
>                          {0,nil},
>                          0,0,
>                          {rates,
>                              {{1365,529204,602738},0},
>                              {{1365,529204,602738},0},
>                              0.0,0.0,
>                              {1365,529286,74299}}},
>                      0,
>                      {dict,0,16,16,8,80,48,
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                      [],
>                      {dict,0,16,16,8,80,48,
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                      {set,6,16,16,8,80,48,
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                          {{[],
>                            [<0.17350.499>],
>                            [<0.17781.499>],
>                            [],
>                            [<7525.9758.575>],
>                            [],
>                            [<7526.18741.575>,<7526.16733.575>],
>                            [],[],[],[],[],[],[],[],
>                            [<7525.13515.575>]}}}},
>                  {[],[]},
>                  undefined,undefined,undefined,undefined,
>                  {state,fine,5000,undefined},
>                  {0,nil},
>                  100000,undefined,1365529282744274,
>                  {dict,6,16,16,8,80,48,
>                      {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                      {{[],
>                        [[<0.17350.499>|#Ref<0.0.14563.86478>]],
>                        [[<0.17781.499>|#Ref<0.0.14563.86169>]],
>                        [],
>                        [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
>                        [],
>                        [[<7526.16733.575>|#Ref<0.0.14563.86260>],
>                         [<7526.18741.575>|#Ref<0.0.14563.86683>]],
>                        [],[],[],[],[],[],[],[],
>                        [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
>                  1,
>                  {{0,nil},{0,nil}},
>                  undefined,
>                  {dict,0,16,16,8,80,48,
>                      {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                      {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                  {resource,<<"/fonsyncd/prod/">>,exchange,
>                      <<"EX-fonsyncd-Exception">>},
>                  undefined}]},
>          {gen_server2,handle_msg,2},
>          {proc_lib,wake_up,3}]}
>
>
> =ERROR REPORT==== 9-Apr-2013::10:56:49 ===
> ** Generic server <0.4403.0> terminating
> ** Last message in was {add_on_right,{74,<0.7181.510>}}
> ** When Server state == {q,
>                           {amqqueue,
>                            {resource,<<"/fonsyncd/prod/">>,queue,
>                             <<"Q-SID.16970.fonsyncd">>},
>                            true,false,none,
>                            [{<<"x-message-ttl">>,signedint,100000},
>                             {<<"x-dead-letter-exchange">>,longstr,
>                              <<"EX-fonsyncd-Exception">>},
>                             {<<"x-ha-policy">>,longstr,<<"all">>}],
>                            <0.4403.0>,[],all},
>                           none,false,rabbit_mirror_queue_master,
>
>   {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
>                            {vqstate,
>                             {0,{[],[]}},
>                             {0,{[],[]}},
>                             {delta,undefined,0,undefined},
>                             {0,{[],[]}},
>                             {0,{[],[]}},
>                             2114,
>                             {0,nil},
>                             undefined,
>                             {0,nil},
>                             {qistate,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/queues/EYHEI3SQW41F6NFSH8WB2CD91",
>                              {{dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []}}},
>                               []},
>                              #Ref<0.0.25.88612>,0,262144,
>                              #Fun<rabbit_variable_queue.2.36908642>,
>                              {0,nil}},
>                             {{client_msstate,msg_store_persistent,
>
>   <<72,22,217,216,236,0,110,187,235,185,163,249,92,
>                                 182,156,56>>,
>                               {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []}}},
>                               {state,696393,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent"},
>                               rabbit_msg_store_ets_index,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent",
>                               <0.269.0>,700490,692296,704587,708684},
>                              {client_msstate,msg_store_transient,
>
>   <<51,15,67,134,52,182,142,196,131,185,177,5,223,
>                                 15,45,61>>,
>                               {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []}}},
>                               {state,675908,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient"},
>                               rabbit_msg_store_ets_index,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient",
>                               <0.264.0>,680005,671795,684102,688199}},
>
>   true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,
>                             0,0,infinity,0,0,0,0,0,
>                             {rates,
>                              {{1365,529204,602738},0},
>                              {{1365,529204,602738},0},
>                              0.0,0.0,
>                              {1365,529286,74299}},
>                             {0,nil},
>                             {0,nil},
>                             {0,nil},
>                             {0,nil},
>                             0,0,
>                             {rates,
>                              {{1365,529204,602738},0},
>                              {{1365,529204,602738},0},
>                              0.0,0.0,
>                              {1365,529286,74299}}},
>                            0,
>                            {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                               []}}},
>                            [],
>                            {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                               []}}},
>                            {set,6,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                             {{[],
>                               [<0.17350.499>],
>                               [<0.17781.499>],
>                               [],
>                               [<7525.9758.575>],
>                               [],
>                               [<7526.18741.575>,<7526.16733.575>],
>                               [],[],[],[],[],[],[],[],
>                               [<7525.13515.575>]}}}},
>                           {[],[]},
>                           undefined,undefined,undefined,undefined,
>                           {state,fine,5000,undefined},
>                           {0,nil},
>                           100000,undefined,1365529282744274,
>                           {dict,6,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],
>                              [[<0.17350.499>|#Ref<0.0.14563.86478>]],
>                              [[<0.17781.499>|#Ref<0.0.14563.86169>]],
>                              [],
>                              [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
>                              [],
>                              [[<7526.16733.575>|#Ref<0.0.14563.86260>],
>                               [<7526.18741.575>|#Ref<0.0.14563.86683>]],
>                              [],[],[],[],[],[],[],[],
>                              [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
>                           1,
>                           {{0,nil},{0,nil}},
>                           undefined,
>                           {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                           {resource,<<"/fonsyncd/prod/">>,exchange,
>                            <<"EX-fonsyncd-Exception">>},
>                           undefined}
> ** Reason for termination ==
> ** {function_clause,
>         [{rabbit_amqqueue_process,handle_call,
>              [{add_on_right,{74,<0.7181.510>}},
>               {<0.7181.510>,#Ref<0.0.14625.121725>},
>               {q,{amqqueue,
>                      {resource,<<"/fonsyncd/prod/">>,queue,
>                          <<"Q-SID.16970.fonsyncd">>},
>                      true,false,none,
>                      [{<<"x-message-ttl">>,signedint,100000},
>                       {<<"x-dead-letter-exchange">>,longstr,
>                        <<"EX-fonsyncd-Exception">>},
>                       {<<"x-ha-policy">>,longstr,<<"all">>}],
>                      <0.4403.0>,[],all},
>                  none,false,rabbit_mirror_queue_master,
>                  {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
>                      {vqstate,
>                          {0,{[],[]}},
>                          {0,{[],[]}},
>                          {delta,undefined,0,undefined},
>                          {0,{[],[]}},
>                          {0,{[],[]}},
>                          2114,
>                          {0,nil},
>                          undefined,
>                          {0,nil},
>                          {qistate,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/queues/EYHEI3SQW41F6NFSH8WB2CD91",
>                              {{dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               []},
>                              #Ref<0.0.25.88612>,0,262144,
>                              #Fun<rabbit_variable_queue.2.36908642>,
>                              {0,nil}},
>                          {{client_msstate,msg_store_persistent,
>
>   <<72,22,217,216,236,0,110,187,235,185,163,249,92,
>                                 182,156,56>>,
>                               {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               {state,696393,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent"},
>                               rabbit_msg_store_ets_index,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent",
>                               <0.269.0>,700490,692296,704587,708684},
>                           {client_msstate,msg_store_transient,
>
>   <<51,15,67,134,52,182,142,196,131,185,177,5,223,
>                                 15,45,61>>,
>                               {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               {state,675908,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient"},
>                               rabbit_msg_store_ets_index,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient",
>                               <0.264.0>,680005,671795,684102,688199}},
>
> true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,0,
>                          infinity,0,0,0,0,0,
>                          {rates,
>                              {{1365,529204,602738},0},
>                              {{1365,529204,602738},0},
>                              0.0,0.0,
>                              {1365,529286,74299}},
>                          {0,nil},
>                          {0,nil},
>                          {0,nil},
>                          {0,nil},
>                          0,0,
>                          {rates,
>                              {{1365,529204,602738},0},
>                              {{1365,529204,602738},0},
>                              0.0,0.0,
>                              {1365,529286,74299}}},
>                      0,
>                      {dict,0,16,16,8,80,48,
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                      [],
>                      {dict,0,16,16,8,80,48,
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                      {set,6,16,16,8,80,48,
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                          {{[],
>                            [<0.17350.499>],
>                            [<0.17781.499>],
>                            [],
>                            [<7525.9758.575>],
>                            [],
>                            [<7526.18741.575>,<7526.16733.575>],
>                            [],[],[],[],[],[],[],[],
>                            [<7525.13515.575>]}}}},
>                  {[],[]},
>                  undefined,undefined,undefined,undefined,
>                  {state,fine,5000,undefined},
>                  {0,nil},
>                  100000,undefined,1365529282744274,
>                  {dict,6,16,16,8,80,48,
>                      {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                      {{[],
>                        [[<0.17350.499>|#Ref<0.0.14563.86478>]],
>                        [[<0.17781.499>|#Ref<0.0.14563.86169>]],
>                        [],
>                        [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
>                        [],
>                        [[<7526.16733.575>|#Ref<0.0.14563.86260>],
>                         [<7526.18741.575>|#Ref<0.0.14563.86683>]],
>                        [],[],[],[],[],[],[],[],
>                        [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
>                  1,
>                  {{0,nil},{0,nil}},
>                  undefined,
>                  {dict,0,16,16,8,80,48,
>                      {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                      {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                  {resource,<<"/fonsyncd/prod/">>,exchange,
>                      <<"EX-fonsyncd-Exception">>},
>                  undefined}]},
>          {gen_server2,handle_msg,2},
>          {proc_lib,wake_up,3}]}
>
> =ERROR REPORT==== 9-Apr-2013::10:56:49 ===
> ** Generic server <0.7181.510> terminating
> ** Last message in was {'$gen_cast',join}
> ** When Server state == {state,
>                              {74,<0.7181.510>},
>                              {{74,<0.7181.510>},undefined},
>                              {{74,<0.7181.510>},undefined},
>                              {resource,<<"/fonsyncd/prod/">>,queue,
>                                  <<"Q-SID.18335.fonsyncd">>},
>
> rabbit_mirror_queue_slave,undefined,-1,undefined,
>                              [<0.7180.510>],
>                              {[],[]},
>                              [],undefined}
> ** Reason for termination ==
> ** {{function_clause,
>          [{rabbit_amqqueue_process,handle_call,
>               [{add_on_right,{74,<0.7181.510>}},
>                {<0.7181.510>,#Ref<0.0.14625.121725>},
>                {q,{amqqueue,
>                       {resource,<<"/fonsyncd/prod/">>,queue,
>                           <<"Q-SID.16970.fonsyncd">>},
>                       true,false,none,
>                       [{<<"x-message-ttl">>,signedint,100000},
>                        {<<"x-dead-letter-exchange">>,longstr,
>                         <<"EX-fonsyncd-Exception">>},
>                        {<<"x-ha-policy">>,longstr,<<"all">>}],
>                       <0.4403.0>,[],all},
>                   none,false,rabbit_mirror_queue_master,
>                   {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
>                       {vqstate,
>                           {0,{[],[]}},
>                           {0,{[],[]}},
>                           {delta,undefined,0,undefined},
>                           {0,{[],[]}},
>                           {0,{[],[]}},
>                           2114,
>                           {0,nil},
>                           undefined,
>                           {0,nil},
>                           {qistate,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/queues/EYHEI3SQW41F6NFSH8WB2CD91",
>                               {{dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[]}}},
>                                []},
>                               #Ref<0.0.25.88612>,0,262144,
>                               #Fun<rabbit_variable_queue.2.36908642>,
>                               {0,nil}},
>                           {{client_msstate,msg_store_persistent,
>
> <<72,22,217,216,236,0,110,187,235,185,163,249,92,
>                                  182,156,56>>,
>                                {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[]}}},
>                                {state,696393,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent"},
>                                rabbit_msg_store_ets_index,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent",
>                                <0.269.0>,700490,692296,704587,708684},
>                            {client_msstate,msg_store_transient,
>
> <<51,15,67,134,52,182,142,196,131,185,177,5,223,
>                                  15,45,61>>,
>                                {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[]}}},
>                                {state,675908,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient"},
>                                rabbit_msg_store_ets_index,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient",
>                                <0.264.0>,680005,671795,684102,688199}},
>
>   true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,
>                           0,infinity,0,0,0,0,0,
>                           {rates,
>                               {{1365,529204,602738},0},
>                               {{1365,529204,602738},0},
>                               0.0,0.0,
>                               {1365,529286,74299}},
>                           {0,nil},
>                           {0,nil},
>                           {0,nil},
>                           {0,nil},
>                           0,0,
>                           {rates,
>                               {{1365,529204,602738},0},
>                               {{1365,529204,602738},0},
>                               0.0,0.0,
>                               {1365,529286,74299}}},
>                       0,
>                       {dict,0,16,16,8,80,48,
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                       [],
>                       {dict,0,16,16,8,80,48,
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                       {set,6,16,16,8,80,48,
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                           {{[],
>                             [<0.17350.499>],
>                             [<0.17781.499>],
>                             [],
>                             [<7525.9758.575>],
>                             [],
>                             [<7526.18741.575>,<7526.16733.575>],
>                             [],[],[],[],[],[],[],[],
>                             [<7525.13515.575>]}}}},
>                   {[],[]},
>                   undefined,undefined,undefined,undefined,
>                   {state,fine,5000,undefined},
>                   {0,nil},
>                   100000,undefined,1365529282744274,
>                   {dict,6,16,16,8,80,48,
>                       {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                       {{[],
>                         [[<0.17350.499>|#Ref<0.0.14563.86478>]],
>                         [[<0.17781.499>|#Ref<0.0.14563.86169>]],
>                         [],
>                         [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
>                         [],
>                         [[<7526.16733.575>|#Ref<0.0.14563.86260>],
>                          [<7526.18741.575>|#Ref<0.0.14563.86683>]],
>                         [],[],[],[],[],[],[],[],
>                         [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
>                   1,
>                   {{0,nil},{0,nil}},
>                   undefined,
>                   {dict,0,16,16,8,80,48,
>                       {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                       {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                   {resource,<<"/fonsyncd/prod/">>,exchange,
>                       <<"EX-fonsyncd-Exception">>},
>                   undefined}]},
>           {gen_server2,handle_msg,2},
>           {proc_lib,wake_up,3}]},
>
> {gen_server2,call,[<0.4403.0>,{add_on_right,{74,<0.7181.510>}},infinity]}}
>
>
>
> ERROR REPORT==== 9-Apr-2013::10:56:49 ===
> ** Generic server <0.9085.0> terminating
> ** Last message in was {'$gen_cast',
>                          {delete_and_terminate,
>                           {function_clause,
>                            [{rabbit_amqqueue_process,handle_call,
>                              [{add_on_right,{74,<0.7181.510>}},
>                               {<0.7181.510>,#Ref<0.0.14625.121725>},
>                               {q,
>                                {amqqueue,
>                                 {resource,<<"/fonsyncd/prod/">>,queue,
>                                  <<"Q-SID.16970.fonsyncd">>},
>                                 true,false,none,
>                                 [{<<"x-message-ttl">>,signedint,100000},
>                                  {<<"x-dead-letter-exchange">>,longstr,
>                                   <<"EX-fonsyncd-Exception">>},
>                                  {<<"x-ha-policy">>,longstr,<<"all">>}],
>                                 <0.4403.0>,[],all},
>                                none,false,rabbit_mirror_queue_master,
>                                {state,<0.4404.0>,<0.9085.0>,
>                                 rabbit_variable_queue,
>                                 {vqstate,
>                                  {0,{[],[]}},
>                                  {0,{[],[]}},
>                                  {delta,undefined,0,undefined},
>                                  {0,{[],[]}},
>                                  {0,{[],[]}},
>                                  2114,
>                                  {0,nil},
>                                  undefined,
>                                  {0,nil},
>                                  {qistate,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/queues/EYHEI3SQW41F6NFSH8WB2CD91",
>                                   {{dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                       [],[],[]}}},
>                                    []},
>                                   #Ref<0.0.25.88612>,0,262144,
>                                   #Fun<rabbit_variable_queue.2.36908642>,
>                                   {0,nil}},
>                                  {{client_msstate,msg_store_persistent,
>
> <<72,22,217,216,236,0,110,187,235,185,163,
>                                      249,92,182,156,56>>,
>                                    {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                       [],[],[]}}},
>                                    {state,696393,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent"},
>                                    rabbit_msg_store_ets_index,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent",
>                                    <0.269.0>,700490,692296,704587,708684},
>                                   {client_msstate,msg_store_transient,
>
> <<51,15,67,134,52,182,142,196,131,185,177,5,
>                                      223,15,45,61>>,
>                                    {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                       [],[],[]}}},
>                                    {state,675908,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient"},
>                                    rabbit_msg_store_ets_index,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient",
>                                    <0.264.0>,680005,671795,684102,688199}},
>                                  true,0,
>
> #Fun<rabbit_mirror_queue_slave.1.52898136>,0,
>                                  0,infinity,0,0,0,0,0,
>                                  {rates,
>                                   {{1365,529204,602738},0},
>                                   {{1365,529204,602738},0},
>                                   0.0,0.0,
>                                   {1365,529286,74299}},
>                                  {0,nil},
>                                  {0,nil},
>                                  {0,nil},
>                                  {0,nil},
>                                  0,0,
>                                  {rates,
>                                   {{1365,529204,602738},0},
>                                   {{1365,529204,602738},0},
>                                   0.0,0.0,
>                                   {1365,529286,74299}}},
>                                 0,
>                                 {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]}}},
>                                 [],
>                                 {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]}}},
>                                 {set,6,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   []},
>                                  {{[],
>                                    [<0.17350.499>],
>                                    [<0.17781.499>],
>                                    [],
>                                    [<7525.9758.575>],
>                                    [],
>                                    [<7526.18741.575>,<7526.16733.575>],
>                                    [],[],[],[],[],[],[],[],
>                                    [<7525.13515.575>]}}}},
>                                {[],[]},
>                                undefined,undefined,undefined,undefined,
>                                {state,fine,5000,undefined},
>                                {0,nil},
>                                100000,undefined,1365529282744274,
>                                {dict,6,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>                                 {{[],
>                                   [[<0.17350.499>|#Ref<0.0.14563.86478>]],
>                                   [[<0.17781.499>|#Ref<0.0.14563.86169>]],
>                                   [],
>                                   [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
>                                   [],
>                                   [[<7526.16733.575>|#Ref<0.0.14563.86260>],
>
> [<7526.18741.575>|#Ref<0.0.14563.86683>]],
>                                   [],[],[],[],[],[],[],[],
>
>   [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
>                                1,
>                                {{0,nil},{0,nil}},
>                                undefined,
>                                {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   []}}},
>                                {resource,<<"/fonsyncd/prod/">>,exchange,
>                                 <<"EX-fonsyncd-Exception">>},
>                                undefined}]},
>                             {gen_server2,handle_msg,2},
>                             {proc_lib,wake_up,3}]}}}
> ** When Server state == {state,
>                              {amqqueue,
>                                  {resource,<<"/fonsyncd/prod/">>,queue,
>                                      <<"Q-SID.16970.fonsyncd">>},
>                                  true,false,none,
>                                  [{<<"x-message-ttl">>,signedint,100000},
>                                   {<<"x-dead-letter-exchange">>,longstr,
>                                    <<"EX-fonsyncd-Exception">>},
>                                   {<<"x-ha-policy">>,longstr,<<"all">>}],
>                                  <0.4403.0>,[],all},
>                              <0.4404.0>,
>                              {dict,6,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   []},
>                                  {{[],
>                                    [[<0.17350.499>|#Ref<0.0.14563.86480>]],
>                                    [[<0.17781.499>|#Ref<0.0.14563.86174>]],
>                                    [],
>
> [[<7525.9758.575>|#Ref<0.0.14563.86397>]],
>                                    [],
>
> [[<7526.16733.575>|#Ref<0.0.14563.86263>],
>
>   [<7526.18741.575>|#Ref<0.0.14563.86686>]],
>                                    [],[],[],[],[],[],[],[],
>                                    [[<7525.13515.575>|
>                                      #Ref<0.0.14563.86622>]]}}},
>                              #Fun<rabbit_mirror_queue_master.1.37767645>,
>                              #Fun<rabbit_mirror_queue_master.2.24464450>}
> ** Reason for termination ==
> ** {function_clause,
>         [{rabbit_amqqueue_process,handle_call,
>              [{add_on_right,{74,<0.7181.510>}},
>               {<0.7181.510>,#Ref<0.0.14625.121725>},
>               {q,{amqqueue,
>                      {resource,<<"/fonsyncd/prod/">>,queue,
>                          <<"Q-SID.16970.fonsyncd">>},
>                      true,false,none,
>                      [{<<"x-message-ttl">>,signedint,100000},
>                       {<<"x-dead-letter-exchange">>,longstr,
>                        <<"EX-fonsyncd-Exception">>},
>                       {<<"x-ha-policy">>,longstr,<<"all">>}],
>                      <0.4403.0>,[],all},
>                  none,false,rabbit_mirror_queue_master,
>                  {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
>                      {vqstate,
>                          {0,{[],[]}},
>                          {0,{[],[]}},
>                          {delta,undefined,0,undefined},
>                          {0,{[],[]}},
>                          {0,{[],[]}},
>                          2114,
>                          {0,nil},
>                          undefined,
>                          {0,nil},
>                          {qistate,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/queues/EYHEI3SQW41F6NFSH8WB2CD91",
>                              {{dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               []},
>                              #Ref<0.0.25.88612>,0,262144,
>                              #Fun<rabbit_variable_queue.2.36908642>,
>                              {0,nil}},
>                          {{client_msstate,msg_store_persistent,
>
>   <<72,22,217,216,236,0,110,187,235,185,163,249,92,
>                                 182,156,56>>,
>                               {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               {state,696393,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent"},
>                               rabbit_msg_store_ets_index,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent",
>                               <0.269.0>,700490,692296,704587,708684},
>                           {client_msstate,msg_store_transient,
>
>   <<51,15,67,134,52,182,142,196,131,185,177,5,223,
>                                 15,45,61>>,
>                               {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               {state,675908,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient"},
>                               rabbit_msg_store_ets_index,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient",
>                               <0.264.0>,680005,671795,684102,688199}},
>
> true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,0,
>                          infinity,0,0,0,0,0,
>                          {rates,
>                              {{1365,529204,602738},0},
>                              {{1365,529204,602738},0},
>                              0.0,0.0,
>                              {1365,529286,74299}},
>                          {0,nil},
>                          {0,nil},
>                          {0,nil},
>                          {0,nil},
>                          0,0,
>                          {rates,
>                              {{1365,529204,602738},0},
>                              {{1365,529204,602738},0},
>                              0.0,0.0,
>                              {1365,529286,74299}}},
>                      0,
>                      {dict,0,16,16,8,80,48,
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                      [],
>                      {dict,0,16,16,8,80,48,
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                      {set,6,16,16,8,80,48,
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                          {{[],
>                            [<0.17350.499>],
>                            [<0.17781.499>],
>                            [],
>                            [<7525.9758.575>],
>                            [],
>                            [<7526.18741.575>,<7526.16733.575>],
>                            [],[],[],[],[],[],[],[],
>                            [<7525.13515.575>]}}}},
>                  {[],[]},
>                  undefined,undefined,undefined,undefined,
>                  {state,fine,5000,undefined},
>                  {0,nil},
>                  100000,undefined,1365529282744274,
>                  {dict,6,16,16,8,80,48,
>                      {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                      {{[],
>                        [[<0.17350.499>|#Ref<0.0.14563.86478>]],
>                        [[<0.17781.499>|#Ref<0.0.14563.86169>]],
>                        [],
>                        [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
>                        [],
>                        [[<7526.16733.575>|#Ref<0.0.14563.86260>],
>                         [<7526.18741.575>|#Ref<0.0.14563.86683>]],
>                        [],[],[],[],[],[],[],[],
>                        [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
>                  1,
>                  {{0,nil},{0,nil}},
>                  undefined,
>                  {dict,0,16,16,8,80,48,
>                      {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                      {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                  {resource,<<"/fonsyncd/prod/">>,exchange,
>                      <<"EX-fonsyncd-Exception">>},
>                  undefined}]},
>          {gen_server2,handle_msg,2},
>          {proc_lib,wake_up,3}]}
>
>
> =ERROR REPORT==== 9-Apr-2013::10:56:49 ===
> ** Generic server <0.4403.0> terminating
> ** Last message in was {add_on_right,{74,<0.7181.510>}}
> ** When Server state == {q,
>                           {amqqueue,
>                            {resource,<<"/fonsyncd/prod/">>,queue,
>                             <<"Q-SID.16970.fonsyncd">>},
>                            true,false,none,
>                            [{<<"x-message-ttl">>,signedint,100000},
>                             {<<"x-dead-letter-exchange">>,longstr,
>                              <<"EX-fonsyncd-Exception">>},
>                             {<<"x-ha-policy">>,longstr,<<"all">>}],
>                            <0.4403.0>,[],all},
>                           none,false,rabbit_mirror_queue_master,
>
>   {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
>                            {vqstate,
>                             {0,{[],[]}},
>                             {0,{[],[]}},
>                             {delta,undefined,0,undefined},
>                             {0,{[],[]}},
>                             {0,{[],[]}},
>                             2114,
>                             {0,nil},
>                             undefined,
>                             {0,nil},
>                             {qistate,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/queues/EYHEI3SQW41F6NFSH8WB2CD91",
>                              {{dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []}}},
>                               []},
>                              #Ref<0.0.25.88612>,0,262144,
>                              #Fun<rabbit_variable_queue.2.36908642>,
>                              {0,nil}},
>                             {{client_msstate,msg_store_persistent,
>
>   <<72,22,217,216,236,0,110,187,235,185,163,249,92,
>                                 182,156,56>>,
>                               {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []}}},
>                               {state,696393,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent"},
>                               rabbit_msg_store_ets_index,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent",
>                               <0.269.0>,700490,692296,704587,708684},
>                              {client_msstate,msg_store_transient,
>
>   <<51,15,67,134,52,182,142,196,131,185,177,5,223,
>                                 15,45,61>>,
>                               {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []}}},
>                               {state,675908,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient"},
>                               rabbit_msg_store_ets_index,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient",
>                               <0.264.0>,680005,671795,684102,688199}},
>
>   true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,
>                             0,0,infinity,0,0,0,0,0,
>                             {rates,
>                              {{1365,529204,602738},0},
>                              {{1365,529204,602738},0},
>                              0.0,0.0,
>                              {1365,529286,74299}},
>                             {0,nil},
>                             {0,nil},
>                             {0,nil},
>                             {0,nil},
>                             0,0,
>                             {rates,
>                              {{1365,529204,602738},0},
>                              {{1365,529204,602738},0},
>                              0.0,0.0,
>                              {1365,529286,74299}}},
>                            0,
>                            {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                               []}}},
>                            [],
>                            {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                               []}}},
>                            {set,6,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                             {{[],
>                               [<0.17350.499>],
>                               [<0.17781.499>],
>                               [],
>                               [<7525.9758.575>],
>                               [],
>                               [<7526.18741.575>,<7526.16733.575>],
>                               [],[],[],[],[],[],[],[],
>                               [<7525.13515.575>]}}}},
>                           {[],[]},
>                           undefined,undefined,undefined,undefined,
>                           {state,fine,5000,undefined},
>                           {0,nil},
>                           100000,undefined,1365529282744274,
>                           {dict,6,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],
>                              [[<0.17350.499>|#Ref<0.0.14563.86478>]],
>                              [[<0.17781.499>|#Ref<0.0.14563.86169>]],
>                              [],
>                              [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
>                              [],
>                              [[<7526.16733.575>|#Ref<0.0.14563.86260>],
>                               [<7526.18741.575>|#Ref<0.0.14563.86683>]],
>                              [],[],[],[],[],[],[],[],
>                              [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
>                           1,
>                           {{0,nil},{0,nil}},
>                           undefined,
>                           {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                           {resource,<<"/fonsyncd/prod/">>,exchange,
>                            <<"EX-fonsyncd-Exception">>},
>                           undefined}
> ** Reason for termination ==
> ** {function_clause,
>         [{rabbit_amqqueue_process,handle_call,
>              [{add_on_right,{74,<0.7181.510>}},
>               {<0.7181.510>,#Ref<0.0.14625.121725>},
>               {q,{amqqueue,
>                      {resource,<<"/fonsyncd/prod/">>,queue,
>                          <<"Q-SID.16970.fonsyncd">>},
>                      true,false,none,
>                      [{<<"x-message-ttl">>,signedint,100000},
>                       {<<"x-dead-letter-exchange">>,longstr,
>                        <<"EX-fonsyncd-Exception">>},
>                       {<<"x-ha-policy">>,longstr,<<"all">>}],
>                      <0.4403.0>,[],all},
>                  none,false,rabbit_mirror_queue_master,
>                  {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
>                      {vqstate,
>                          {0,{[],[]}},
>                          {0,{[],[]}},
>                          {delta,undefined,0,undefined},
>                          {0,{[],[]}},
>                          {0,{[],[]}},
>                          2114,
>                          {0,nil},
>                          undefined,
>                          {0,nil},
>                          {qistate,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/queues/EYHEI3SQW41F6NFSH8WB2CD91",
>                              {{dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               []},
>                              #Ref<0.0.25.88612>,0,262144,
>                              #Fun<rabbit_variable_queue.2.36908642>,
>                              {0,nil}},
>                          {{client_msstate,msg_store_persistent,
>
>   <<72,22,217,216,236,0,110,187,235,185,163,249,92,
>                                 182,156,56>>,
>                               {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               {state,696393,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent"},
>                               rabbit_msg_store_ets_index,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent",
>                               <0.269.0>,700490,692296,704587,708684},
>                           {client_msstate,msg_store_transient,
>
>   <<51,15,67,134,52,182,142,196,131,185,177,5,223,
>                                 15,45,61>>,
>                               {dict,0,16,16,8,80,48,
>
>   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                    [],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]}}},
>                               {state,675908,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient"},
>                               rabbit_msg_store_ets_index,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient",
>                               <0.264.0>,680005,671795,684102,688199}},
>
> true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,0,
>                          infinity,0,0,0,0,0,
>                          {rates,
>                              {{1365,529204,602738},0},
>                              {{1365,529204,602738},0},
>                              0.0,0.0,
>                              {1365,529286,74299}},
>                          {0,nil},
>                          {0,nil},
>                          {0,nil},
>                          {0,nil},
>                          0,0,
>                          {rates,
>                              {{1365,529204,602738},0},
>                              {{1365,529204,602738},0},
>                              0.0,0.0,
>                              {1365,529286,74299}}},
>                      0,
>                      {dict,0,16,16,8,80,48,
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                      [],
>                      {dict,0,16,16,8,80,48,
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                      {set,6,16,16,8,80,48,
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                          {{[],
>                            [<0.17350.499>],
>                            [<0.17781.499>],
>                            [],
>                            [<7525.9758.575>],
>                            [],
>                            [<7526.18741.575>,<7526.16733.575>],
>                            [],[],[],[],[],[],[],[],
>                            [<7525.13515.575>]}}}},
>                  {[],[]},
>                  undefined,undefined,undefined,undefined,
>                  {state,fine,5000,undefined},
>                  {0,nil},
>                  100000,undefined,1365529282744274,
>                  {dict,6,16,16,8,80,48,
>                      {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                      {{[],
>                        [[<0.17350.499>|#Ref<0.0.14563.86478>]],
>                        [[<0.17781.499>|#Ref<0.0.14563.86169>]],
>                        [],
>                        [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
>                        [],
>                        [[<7526.16733.575>|#Ref<0.0.14563.86260>],
>                         [<7526.18741.575>|#Ref<0.0.14563.86683>]],
>                        [],[],[],[],[],[],[],[],
>                        [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
>                  1,
>                  {{0,nil},{0,nil}},
>                  undefined,
>                  {dict,0,16,16,8,80,48,
>                      {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                      {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                  {resource,<<"/fonsyncd/prod/">>,exchange,
>                      <<"EX-fonsyncd-Exception">>},
>                  undefined}]},
>          {gen_server2,handle_msg,2},
>          {proc_lib,wake_up,3}]}
>
> =ERROR REPORT==== 9-Apr-2013::10:56:49 ===
> ** Generic server <0.7181.510> terminating
> ** Last message in was {'$gen_cast',join}
> ** When Server state == {state,
>                              {74,<0.7181.510>},
>                              {{74,<0.7181.510>},undefined},
>                              {{74,<0.7181.510>},undefined},
>                              {resource,<<"/fonsyncd/prod/">>,queue,
>                                  <<"Q-SID.18335.fonsyncd">>},
>
> rabbit_mirror_queue_slave,undefined,-1,undefined,
>                              [<0.7180.510>],
>                              {[],[]},
>                              [],undefined}
> ** Reason for termination ==
> ** {{function_clause,
>          [{rabbit_amqqueue_process,handle_call,
>               [{add_on_right,{74,<0.7181.510>}},
>                {<0.7181.510>,#Ref<0.0.14625.121725>},
>                {q,{amqqueue,
>                       {resource,<<"/fonsyncd/prod/">>,queue,
>                           <<"Q-SID.16970.fonsyncd">>},
>                       true,false,none,
>                       [{<<"x-message-ttl">>,signedint,100000},
>                        {<<"x-dead-letter-exchange">>,longstr,
>                         <<"EX-fonsyncd-Exception">>},
>                        {<<"x-ha-policy">>,longstr,<<"all">>}],
>                       <0.4403.0>,[],all},
>                   none,false,rabbit_mirror_queue_master,
>                   {state,<0.4404.0>,<0.9085.0>,rabbit_variable_queue,
>                       {vqstate,
>                           {0,{[],[]}},
>                           {0,{[],[]}},
>                           {delta,undefined,0,undefined},
>                           {0,{[],[]}},
>                           {0,{[],[]}},
>                           2114,
>                           {0,nil},
>                           undefined,
>                           {0,nil},
>                           {qistate,
>
>   "/var/lib/rabbitmq/mnesia/rabbit at rmq1/queues/EYHEI3SQW41F6NFSH8WB2CD91",
>                               {{dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[]}}},
>                                []},
>                               #Ref<0.0.25.88612>,0,262144,
>                               #Fun<rabbit_variable_queue.2.36908642>,
>                               {0,nil}},
>                           {{client_msstate,msg_store_persistent,
>
> <<72,22,217,216,236,0,110,187,235,185,163,249,92,
>                                  182,156,56>>,
>                                {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[]}}},
>                                {state,696393,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent"},
>                                rabbit_msg_store_ets_index,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_persistent",
>                                <0.269.0>,700490,692296,704587,708684},
>                            {client_msstate,msg_store_transient,
>
> <<51,15,67,134,52,182,142,196,131,185,177,5,223,
>                                  15,45,61>>,
>                                {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                     [],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                      [],[]}}},
>                                {state,675908,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient"},
>                                rabbit_msg_store_ets_index,
>
> "/var/lib/rabbitmq/mnesia/rabbit at rmq1/msg_store_transient",
>                                <0.264.0>,680005,671795,684102,688199}},
>
>   true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,
>                           0,infinity,0,0,0,0,0,
>                           {rates,
>                               {{1365,529204,602738},0},
>                               {{1365,529204,602738},0},
>                               0.0,0.0,
>                               {1365,529286,74299}},
>                           {0,nil},
>                           {0,nil},
>                           {0,nil},
>                           {0,nil},
>                           0,0,
>                           {rates,
>                               {{1365,529204,602738},0},
>                               {{1365,529204,602738},0},
>                               0.0,0.0,
>                               {1365,529286,74299}}},
>                       0,
>                       {dict,0,16,16,8,80,48,
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                       [],
>                       {dict,0,16,16,8,80,48,
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>   {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                       {set,6,16,16,8,80,48,
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                           {{[],
>                             [<0.17350.499>],
>                             [<0.17781.499>],
>                             [],
>                             [<7525.9758.575>],
>                             [],
>                             [<7526.18741.575>,<7526.16733.575>],
>                             [],[],[],[],[],[],[],[],
>                             [<7525.13515.575>]}}}},
>                   {[],[]},
>                   undefined,undefined,undefined,undefined,
>                   {state,fine,5000,undefined},
>                   {0,nil},
>                   100000,undefined,1365529282744274,
>                   {dict,6,16,16,8,80,48,
>                       {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                       {{[],
>                         [[<0.17350.499>|#Ref<0.0.14563.86478>]],
>                         [[<0.17781.499>|#Ref<0.0.14563.86169>]],
>                         [],
>                         [[<7525.9758.575>|#Ref<0.0.14563.86395>]],
>                         [],
>                         [[<7526.16733.575>|#Ref<0.0.14563.86260>],
>                          [<7526.18741.575>|#Ref<0.0.14563.86683>]],
>                         [],[],[],[],[],[],[],[],
>                         [[<7525.13515.575>|#Ref<0.0.14563.86620>]]}}},
>                   1,
>                   {{0,nil},{0,nil}},
>                   undefined,
>                   {dict,0,16,16,8,80,48,
>                       {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                       {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                   {resource,<<"/fonsyncd/prod/">>,exchange,
>                       <<"EX-fonsyncd-Exception">>},
>                   undefined}]},
>           {gen_server2,handle_msg,2},
>           {proc_lib,wake_up,3}]},
>
> {gen_server2,call,[<0.4403.0>,{add_on_right,{74,<0.7181.510>}},infinity]}}
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From Chris.Nicel at 15below.com  Thu Apr 11 14:34:42 2013
From: Chris.Nicel at 15below.com (Chris Nicel)
Date: Thu, 11 Apr 2013 08:34:42 -0500
Subject: [rabbitmq-discuss] Rabbit MQ Host Operating System
Message-ID: <A57B6B00637AF741A9FA2D006B40C3C882A0D492BB@AUSP01VMBX29.collaborationhost.net>

Hi Guys,

We currently have several RabbitMQ servers running on Windows Server 2008 R2. I am proposing the idea that we move over to a linux based platform in order to reduce the storage size of the vm's we are running them in. We are on a hosted platform so every extra GB will cost us more each month. There is resistance to moving over to linux as we have less resource in our technical operations team who know linux. We are traditionally a Microsoft Shop. Our primary platform is written in .Net.

Could I have a show of hands to see who is running Rabbit on Linux and Windows?

If anyone has any good reasons why it would be better to switch to Linux I would be interested in those also.

Thanks in Advance.

Cheers

Chris

 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From bison_art at o2.pl  Thu Apr 11 16:27:08 2013
From: bison_art at o2.pl (rabbit15)
Date: Thu, 11 Apr 2013 08:27:08 -0700 (PDT)
Subject: [rabbitmq-discuss] HA performance
Message-ID: <1365694028639-25990.post@n5.nabble.com>

Hi, I have question about HA performance. I have 37 queues which are
mirriored and when I'm using HA then my performance  is worse several
times.I was trying with DISC and RAM options, both solution are similar for
my performance. Could you tell me what can I do to have better performance?
Is that good idea to switch off HA when the performance is too worse to
normal work and then switch on when application can work ?
Best Regards,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/HA-performance-tp25990.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Thu Apr 11 16:34:51 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 11 Apr 2013 16:34:51 +0100
Subject: [rabbitmq-discuss] HA performance
In-Reply-To: <1365694028639-25990.post@n5.nabble.com>
References: <1365694028639-25990.post@n5.nabble.com>
Message-ID: <5166D81B.3050109@rabbitmq.com>

On 11/04/13 16:27, rabbit15 wrote:
> Hi, I have question about HA performance. I have 37 queues which are
> mirriored and when I'm using HA then my performance  is worse several
> times.I was trying with DISC and RAM options, both solution are similar for
> my performance. Could you tell me what can I do to have better performance?
> Is that good idea to switch off HA when the performance is too worse to
> normal work and then switch on when application can work ?
> Best Regards,
> Artur

Well, HA queues do more work than non-HA queues. They do more work 
per-node, since they have to coordinate with each other - and then that 
work is duplicated across each node.

So for performance:

* Don't use HA if you don't need it
* If you have many nodes, replicate to as few of them as possible (i.e. 
don't use "all" mode)
* disc vs ram does not really matter
* Make sure you are using an up to date version of RabbitMQ (2.x is much 
slower for HA)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Apr 11 16:37:52 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 11 Apr 2013 16:37:52 +0100
Subject: [rabbitmq-discuss] Rabbit MQ Host Operating System
In-Reply-To: <A57B6B00637AF741A9FA2D006B40C3C882A0D492BB@AUSP01VMBX29.collaborationhost.net>
References: <A57B6B00637AF741A9FA2D006B40C3C882A0D492BB@AUSP01VMBX29.collaborationhost.net>
Message-ID: <5166D8D0.6020907@rabbitmq.com>

I don't know about a show of hands but I strongly suspect more people 
run RabbitMQ on Linux than Windows. And while we try hard to make 
Windows a first class citizen in the RabbitMQ world, in the end we do 
most development on Linux.

But really you should go with what you're most comfortable with.

Cheers, Simon

On 11/04/13 14:34, Chris Nicel wrote:
> Hi Guys,
>
> We currently have several RabbitMQ servers running on Windows Server
> 2008 R2. I am proposing the idea that we move over to a linux based
> platform in order to reduce the storage size of the vm's we are
> running them in. We are on a hosted platform so every extra GB will
> cost us more each month. There is resistance to moving over to linux
> as we have less resource in our technical operations team who know
> linux. We are traditionally a Microsoft Shop. Our primary platform is
> written in .Net.
>
> Could I have a show of hands to see who is running Rabbit on Linux
> and Windows?
>
> If anyone has any good reasons why it would be better to switch to
> Linux I would be interested in those also.
>
> Thanks in Advance.
>
> Cheers
>
> Chris
>
> 15below Limited: Company registered in England and Wales No 3945289
> Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1
> 3XB, United Kingdom
>
> 15below Australia Pty Limited: ABN 25 132 716 379 Level 50, 120
> Collins Street, Melbourne, Victoria 3000, Australia
>
> Please think about the environment before printing this email.
>
> ************************************************************************
>
>
This email and any attachments may be confidential and/or legally 
privileged and are solely for the use of the intended recipient.  If you 
have received this email in error please contact the sender.  Any views 
or opinions expressed within this e-mail are solely those of the sender, 
and do not necessarily represent those of 15below unless otherwise 
specifically stated.  Although 15below has taken every reasonable 
precaution to ensure that any attachment to this e-mail has been checked 
for viruses, it is strongly recommended that you carry out your own 
virus check before opening any attachment, as we cannot accept liability 
for any damage sustained as a result of software virus infection.
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From Chris.Nicel at 15below.com  Thu Apr 11 16:47:24 2013
From: Chris.Nicel at 15below.com (Chris Nicel)
Date: Thu, 11 Apr 2013 10:47:24 -0500
Subject: [rabbitmq-discuss] Rabbit MQ Host Operating System
In-Reply-To: <5166D8D0.6020907@rabbitmq.com>
References: <A57B6B00637AF741A9FA2D006B40C3C882A0D492BB@AUSP01VMBX29.collaborationhost.net>
	<5166D8D0.6020907@rabbitmq.com>
Message-ID: <A57B6B00637AF741A9FA2D006B40C3C882A0D494B2@AUSP01VMBX29.collaborationhost.net>

Thanks for that Simon.

Gives me something to go back to those above with.

Cheers

Chris

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: 11 April 2013 16:38
To: Discussions about RabbitMQ
Cc: Chris Nicel
Subject: Re: [rabbitmq-discuss] Rabbit MQ Host Operating System

I don't know about a show of hands but I strongly suspect more people run RabbitMQ on Linux than Windows. And while we try hard to make Windows a first class citizen in the RabbitMQ world, in the end we do most development on Linux.

But really you should go with what you're most comfortable with.

Cheers, Simon

On 11/04/13 14:34, Chris Nicel wrote:
> Hi Guys,
>
> We currently have several RabbitMQ servers running on Windows Server
> 2008 R2. I am proposing the idea that we move over to a linux based
> platform in order to reduce the storage size of the vm's we are
> running them in. We are on a hosted platform so every extra GB will
> cost us more each month. There is resistance to moving over to linux
> as we have less resource in our technical operations team who know
> linux. We are traditionally a Microsoft Shop. Our primary platform is
> written in .Net.
>
> Could I have a show of hands to see who is running Rabbit on Linux and
> Windows?
>
> If anyone has any good reasons why it would be better to switch to
> Linux I would be interested in those also.
>
> Thanks in Advance.
>
> Cheers
>
> Chris
>
> 15below Limited: Company registered in England and Wales No 3945289
> Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB,
> United Kingdom
>
> 15below Australia Pty Limited: ABN 25 132 716 379 Level 50, 120
> Collins Street, Melbourne, Victoria 3000, Australia
>
> Please think about the environment before printing this email.
>
> **********************************************************************
> **
>
>
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, VMware

 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From bison_art at o2.pl  Thu Apr 11 16:57:00 2013
From: bison_art at o2.pl (rabbit15)
Date: Thu, 11 Apr 2013 08:57:00 -0700 (PDT)
Subject: [rabbitmq-discuss] HA performance
In-Reply-To: <5166D81B.3050109@rabbitmq.com>
References: <1365694028639-25990.post@n5.nabble.com>
	<5166D81B.3050109@rabbitmq.com>
Message-ID: <1365695820785-25994.post@n5.nabble.com>

Thanks a lot!
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/HA-performance-tp25990p25994.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From richard at raseley.com  Thu Apr 11 21:16:44 2013
From: richard at raseley.com (Richard Raseley)
Date: Thu, 11 Apr 2013 13:16:44 -0700
Subject: [rabbitmq-discuss] Federation Over SSL with Intermediate
 Certificate Authority
In-Reply-To: <51669F38.1070805@rabbitmq.com>
References: <CAO=6ox9+F9sprfF4TCBe5JV1ONvOn4Cr5WSuQx1H0aGhN9vgTA@mail.gmail.com>
	<51669F38.1070805@rabbitmq.com>
Message-ID: <CAO=6ox9Ors9EyAAYjGxOjq8dGBX3Rooq=8hDTuAUE2S-EeNyzA@mail.gmail.com>

What I ended up doing is just specifying the issuing (intermediate) CA's
cert as the "CA" in the rabbitmq.config file and it didn't complain when
bringing the service back online. I am not sure if this is because the
system already trusted the root CA (it was a DigiCert certificate) or what.

I would suggest adding whatever the proper guidance is to the documents -
as I am not sure if what I did is "correct" or not (I think I might have
just gotten lucky).

Regards,

Richard


On Thu, Apr 11, 2013 at 4:32 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Richard,
>
>
> On 08/04/13 17:26, Richard Raseley wrote:
>
>> When attempting to federate two brokers over SSL, I understand that one
>> would configure SSL as described in the RabbitMQ documentation,
>> then instantiate the federation connection over the port specified in
>> the SSL configuration. That seems pretty straight forward. What I am not
>> seeing any documentation on is the use of a certificate that requires an
>> intermediate certificate to validate.
>>
>> I was able to find one thread from this discussion list from a while
>> back
>> (http://lists.rabbitmq.com/**pipermail/rabbitmq-discuss/**
>> 2012-March/018702.html<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-March/018702.html>
>> ),
>> but it is not 100% clear to me what was done there to successfully
>> include the intermediate certificate.
>>
>> Is there any official guidance out there on how to use an intermediate
>> certificate in this scenario, or if not, could someone who has actually
>> done this before comment on the process required to get it working?
>>
>
> Did you get this working in the end? If so, any suggestions for improving
> the rabbit docs?
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130411/8a8ddae5/attachment.htm>

From richard at raseley.com  Thu Apr 11 21:17:27 2013
From: richard at raseley.com (Richard Raseley)
Date: Thu, 11 Apr 2013 13:17:27 -0700
Subject: [rabbitmq-discuss] Federated Link Not Producing Logging
In-Reply-To: <5166832E.6080100@rabbitmq.com>
References: <CAO=6ox_potEG+Ygu_10_-VLyGLFq1yWM+qzeY2d==QG-MuML2A@mail.gmail.com>
	<5166832E.6080100@rabbitmq.com>
Message-ID: <CAO=6ox-k2PwVE3UBu7T=67WvkravhjT3WsERm0cLf-TBUfA0Rw@mail.gmail.com>

Simon,

I discovered that I had indeed not completed the second step shortly after
sending that message - doh!

Regards,

Richard


On Thu, Apr 11, 2013 at 2:32 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> You need to do two things for federation to work:
>
> 1) Define one or more upstreams.
> 2) Define a policy to determine which exchanges are federated.
>
> You don't mention having done the second - have you done so?
>
> Cheers, Simon
>
>
> On 10/04/13 19:18, Richard Raseley wrote:
>
>> I am attempting to created a federated link between two clusters
>> (Cluster01 and Cluster02) over a custom port configured for SSL. On
>> Cluster01 I define Cluster02 as upstream, and on Cluster02 I define
>> Cluster01 as the upstream (I am doing this all through the management UI).
>>
>> After applying the changes, neither cluster shows as having an active
>> federated link, yet there are no errors or events of any kind logged
>> related to federation in /var/log/rabbitmq/rabbitmq.**log. Any ideas why
>> this might be?
>>
>> Regards,
>>
>> Richard
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130411/73d3436b/attachment.htm>

From mcojocari at nabancard.com  Thu Apr 11 21:52:40 2013
From: mcojocari at nabancard.com (Michael A. Cojocari)
Date: Thu, 11 Apr 2013 16:52:40 -0400
Subject: [rabbitmq-discuss] rabbitmqadmin CLI...
Message-ID: <51672298.3000904@nabancard.com>

Hello!

Do you guys have any documentation on how binding works with the 
rabbitmqadmin CLI?

Mike

From goyalk at vmware.com  Thu Apr 11 22:27:48 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Thu, 11 Apr 2013 14:27:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Configuring RabbitMQ to support change	in
	hostname
In-Reply-To: <5161E65B.4090703@rabbitmq.com>
References: <9915783f.00001508.000000cf@KAPILPC.vmware.com>	<95003806-680B-425F-AC8D-9466CAB8071D@dushin.net>	<215e265c.00001508.000000f6@KAPILPC.vmware.com>	<40BB9183-870B-45DA-AAA5-31EB0D801592@rabbitmq.com>	<e3316de2.00001688.00000003@KAPILPC.vmware.com>	<51B3A6B5-FC4E-4254-A403-3941856C29DB@rabbitmq.com>	<9509e512.00001688.00000009@KAPILPC.vmware.com>	<F5F4BA6F-3E83-46DB-AD55-45C8DDEC0616@rabbitmq.com>
	<5161E65B.4090703@rabbitmq.com>
Message-ID: <3969c7a8.000002c0.00000010@KAPILPC.vmware.com>

Matthias, Tim,

Thanks for your response.

> The real problem is that the mnesia schema contains for each table a
reference to the node(s) on which it has copies. So if the host name
changes and rabbit is restarted it will think that its tables still live
on the host with the > old hostname.

So, if I change the node-name to rabbit at localhost in the evn-config file,
RabbitMQ still won't be able to handle the change in hostname because of
the old hostname being in mnesia tables. Is this correct? I am trying to
understand how RabbitMQ uses the hostname stored in mnesia tables.

Thanks
Kapil

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthias
Radestock
Sent: Sunday, April 07, 2013 2:34 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuring RabbitMQ to support change in
hostname

On 03/04/13 10:48, Tim Watson wrote:
> You cannot use 'rabbit at 987sdfkjhisd7f7d87sdf' to connect to other 
> Erlang nodes unless the part after the @ is actually the hostname.

Indeed.

> In addition to this, mnesia - Erlang's distributed database - insists 
> on creating its on-disk schema in a folder which is named 
> Mnesia.<node-name>, and we have no control over that.

Actually, that directory is configurable. The real problem is that the
mnesia schema contains for each table a reference to the node(s) on which
it has copies. So if the host name changes and rabbit is restarted it will
think that its tables still live on the host with the old hostname.

Matthias.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tim at rabbitmq.com  Thu Apr 11 23:51:41 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 11 Apr 2013 23:51:41 +0100
Subject: [rabbitmq-discuss] Configuring RabbitMQ to support change	in
	hostname
In-Reply-To: <3969c7a8.000002c0.00000010@KAPILPC.vmware.com>
References: <9915783f.00001508.000000cf@KAPILPC.vmware.com>	<95003806-680B-425F-AC8D-9466CAB8071D@dushin.net>	<215e265c.00001508.000000f6@KAPILPC.vmware.com>	<40BB9183-870B-45DA-AAA5-31EB0D801592@rabbitmq.com>	<e3316de2.00001688.00000003@KAPILPC.vmware.com>	<51B3A6B5-FC4E-4254-A403-3941856C29DB@rabbitmq.com>	<9509e512.00001688.00000009@KAPILPC.vmware.com>	<F5F4BA6F-3E83-46DB-AD55-45C8DDEC0616@rabbitmq.com>
	<5161E65B.4090703@rabbitmq.com>
	<3969c7a8.000002c0.00000010@KAPILPC.vmware.com>
Message-ID: <9E18B125-DA6B-4EAB-9E4F-F86DEF788868@rabbitmq.com>

Hi,

On 11 Apr 2013, at 22:27, Kapil Goyal wrote:

> Matthias, Tim,
> 
> Thanks for your response.
> 
>> The real problem is that the mnesia schema contains for each table a
> reference to the node(s) on which it has copies. So if the host name
> changes and rabbit is restarted it will think that its tables still live
> on the host with the > old hostname.
> 
> So, if I change the node-name to rabbit at localhost in the evn-config file,
> RabbitMQ still won't be able to handle the change in hostname because of
> the old hostname being in mnesia tables. Is this correct?

Yes, sort of.

> I am trying to
> understand how RabbitMQ uses the hostname stored in mnesia tables.
> 

The hostname isn't stored in mnesia tables - rather, for each table in mnesia, mnesia itself is storing a list of nodes on which the table is replicated. So if you change the hostname from a to b, mnesia will still think there there should be a table copy on node a and *that* will cause a problem. In fact, it is mnesia that is unable to cope with dynamic hostname changes in this instance.

Cheers,
Tim

From ilya at segment.io  Fri Apr 12 00:16:00 2013
From: ilya at segment.io (Ilya Volodarsky)
Date: Thu, 11 Apr 2013 16:16:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Subscribers per Channel
Message-ID: <217c4d80-7617-41d8-b576-442b5498f74c@googlegroups.com>

We run an API where each API call ends in RabbitMQ. Each project has its 
own queue with the idea that some customers are much bigger than others so 
 we can eventually have more workers dequeuing the queues of the largest 
customers. The end result is that we have 4,500 queues, where the majority 
are inactive while about a thousand are active and about 20 are very 
heavily used. 

We're using the node.js client node-amqp, and it currently creates a 
channel per queue (so a channel per subscription). That means each 
ingestion worker subscribes to 4.5k queues, and the RabbitMQ server has to 
handle 17k channels and subscriptions. 

Because of node-amqp, an issue is that we can't use prefetchCount since its 
on a subscription level rather on a worker level. The other issue is we're 
seeing a very high memory use on the server, even when all messages are 
happily going through the queues and being ack'd: 5GB memory without any 
active messages. It looks like having so many channels and queues are 
eating up all the memory: 

A few questions:

1. What is a recommended amount of subscriptions per channel?
2. Should we avoid having so many queues? (one queue per project design)

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130411/7463ccf9/attachment.htm>

From michael.s.klishin at gmail.com  Fri Apr 12 01:04:11 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 12 Apr 2013 04:04:11 +0400
Subject: [rabbitmq-discuss] Subscribers per Channel
In-Reply-To: <217c4d80-7617-41d8-b576-442b5498f74c@googlegroups.com>
References: <217c4d80-7617-41d8-b576-442b5498f74c@googlegroups.com>
Message-ID: <CAE3HoVQ5cFMnwQMG1T2HDQpbaVqqDTZ3kphujpFLXqAtSqcxuw@mail.gmail.com>

2013/4/12 Ilya Volodarsky <ilya at segment.io>

> 1. What is a recommended amount of subscriptions per channel?
>

Channels are just integers on the wire and a little bit of state on the
node you are connecting to.
It's unlikely to cause any issues.

Error handling is per-channel so it's a better idea to have one channel per
consumer than multiple
ones.


> 2. Should we avoid having so many queues? (one queue per project design)
>

Only real workload will tell but generally on multi-core machines it is a
better idea to have more queues
than a few very heavily congested ones.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130412/120bef25/attachment.htm>

From gopram at hushmail.com  Fri Apr 12 07:38:04 2013
From: gopram at hushmail.com (gopram at hushmail.com)
Date: Fri, 12 Apr 2013 12:38:04 +0600
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <20130412063804.DEE246F443@smtp.hushmail.com>

Hi,

I am trying RabbitMQ for the first time. installed latest rabbitmq
version 3.0.4 and installed latest erlang separately. 

i could start my rabbitmq-server successfully, but after enabling the
rabbitmq-management plugin it throws below error and fails to start.
there is no configuration(rabbitmq.config/rabbitmq-env.conf) file by
default and i did not create any. 

===========================================
File : mymachine-sasl.log
--------------------------
=SUPERVISOR REPORT==== 12-Apr-2013::10:26:14 ===
     Supervisor: {local,rabbit_web_dispatch_sup}
     Context:    child_terminated
     Reason:     {could_not_start_listener,
                  [{port,55672},{ignore_in_use,true}],
                  {'EXIT',
                   {undef,
                    [{lists,keyfind,
                      [name,1,
                       [{loop,
                         {mochiweb_http,loop,
                          [#Fun]}},
                        {name,rabbit_web_dispatch_sup_55672},
                        {port,55672}]]},
                     {mochilists,is_defined,2},
                     {mochilists,set_default,2},
                     {lists,foldl,3},
                     {mochiweb_http,start,1},
                     {supervisor,do_start_child,2},
                     {supervisor,handle_start_child,2},
                     {supervisor,handle_call,3}]}}}
     Offender:   [{pid,},
                  {name,rabbit_web_dispatch_registry},
                  {mfa,{rabbit_web_dispatch_registry,start_link,[]}},
                  {restart_type,transient},
                  {shutdown,5000},
                  {child_type,worker}]
=CRASH REPORT==== 12-Apr-2013::10:26:14 ===
  crasher:
    pid: 
    registered_name: []
    exception exit: {bad_return,
                     {{rabbit_mgmt_app,start,[normal,[]]},
                      {'EXIT',
                       {{could_not_start_listener,
                         [{port,55672},{ignore_in_use,true}],
                         {'EXIT',
                          {undef,
                           [{lists,keyfind,
                             [name,1,
                              [{loop,
                                {mochiweb_http,loop,
                                 [#Fun]}},
                               {name,rabbit_web_dispatch_sup_55672},
                               {port,55672}]]},
                            {mochilists,is_defined,2},
                            {mochilists,set_default,2},
                            {lists,foldl,3},
                            {mochiweb_http,start,1},
                            {supervisor,do_start_child,2},
                            {supervisor,handle_start_child,2},
                            {supervisor,handle_call,3}]}}},
                        {gen_server,call,
                         [rabbit_web_dispatch_registry,
                          {add,rabbit_mgmt_redirect,
                           [{port,55672},{ignore_in_use,true}],
                           #Fun,
                           #Fun,
                           {[],"Redirect to port 15672"}},
                          infinity]}}}}}
      in function  application_master:init/4
    initial call: application_master:init/4
    ancestors: []
    messages: [{'EXIT',,normal}]
    links: [,]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 610
    stack_size: 23
    reductions: 130
  neighbours:
==================================================

Thanks for your help in advance
-
Ram
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130412/5a6c60bd/attachment.htm>

From gopram at hushmail.com  Fri Apr 12 07:39:59 2013
From: gopram at hushmail.com (gopram at hushmail.com)
Date: Fri, 12 Apr 2013 12:39:59 +0600
Subject: [rabbitmq-discuss] Error : could_not_start_listener...
	rabbit_web_dispatch_su
Message-ID: <20130412063959.3ADB36F443@smtp.hushmail.com>

Hi,

I am trying RabbitMQ for the first time. installed latest rabbitmq
version 3.0.4 and installed latest erlang separately. 

i  could start my rabbitmq-server successfully, but after enabling the
 rabbitmq-management plugin it throws below error and fails to start.
there is no configuration(rabbitmq.config/rabbitmq-env.conf) file by
default and i did not create any. 

===========================================
File : mymachine-sasl.log
--------------------------
=SUPERVISOR REPORT==== 12-Apr-2013::10:26:14 ===
     Supervisor: {local,rabbit_web_dispatch_sup}
     Context:    child_terminated
     Reason:     {could_not_start_listener,
                  [{port,55672},{ignore_in_use,true}],
                  {'EXIT',
                   {undef,
                    [{lists,keyfind,
                      [name,1,
                       [{loop,
                         {mochiweb_http,loop,
                          [#Fun]}},
                        {name,rabbit_web_dispatch_sup_55672},
                        {port,55672}]]},
                     {mochilists,is_defined,2},
                     {mochilists,set_default,2},
                     {lists,foldl,3},
                     {mochiweb_http,start,1},
                     {supervisor,do_start_child,2},
                     {supervisor,handle_start_child,2},
                     {supervisor,handle_call,3}]}}}
     Offender:   [{pid,},
                  {name,rabbit_web_dispatch_registry},
                  {mfa,{rabbit_web_dispatch_registry,start_link,[]}},
                  {restart_type,transient},
                  {shutdown,5000},
                  {child_type,worker}]
=CRASH REPORT==== 12-Apr-2013::10:26:14 ===
  crasher:
    pid: 
    registered_name: []
    exception exit: {bad_return,
                     {{rabbit_mgmt_app,start,[normal,[]]},
                      {'EXIT',
                       {{could_not_start_listener,
                         [{port,55672},{ignore_in_use,true}],
                         {'EXIT',
                          {undef,
                           [{lists,keyfind,
                             [name,1,
                              [{loop,
                                {mochiweb_http,loop,
                                 [#Fun]}},
                               {name,rabbit_web_dispatch_sup_55672},
                               {port,55672}]]},
                            {mochilists,is_defined,2},
                            {mochilists,set_default,2},
                            {lists,foldl,3},
                            {mochiweb_http,start,1},
                            {supervisor,do_start_child,2},
                            {supervisor,handle_start_child,2},
                            {supervisor,handle_call,3}]}}},
                        {gen_server,call,
                         [rabbit_web_dispatch_registry,
                          {add,rabbit_mgmt_redirect,
                           [{port,55672},{ignore_in_use,true}],
                           #Fun,
                           #Fun,
                           {[],"Redirect to port 15672"}},
                          infinity]}}}}}
      in function  application_master:init/4
    initial call: application_master:init/4
    ancestors: []
    messages: [{'EXIT',,normal}]
    links: [,]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 610
    stack_size: 23
    reductions: 130
  neighbours:
==================================================

Thanks for your help in advance
-
Ram
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130412/887248f7/attachment.htm>

From watson.timothy at gmail.com  Fri Apr 12 09:19:53 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 12 Apr 2013 09:19:53 +0100
Subject: [rabbitmq-discuss] Error : could_not_start_listener...
	rabbit_web_dispatch_su
In-Reply-To: <20130412063959.3ADB36F443@smtp.hushmail.com>
References: <20130412063959.3ADB36F443@smtp.hushmail.com>
Message-ID: <6C6A5729-D040-43A2-807A-9FD62A8BEE15@rabbitmq.com>

Looks like a too old version of erlang.

On 12 Apr 2013, at 07:39, gopram at hushmail.com wrote:

> Hi,
> 
> I am trying RabbitMQ for the first time. installed latest rabbitmq version 3.0.4 and installed latest erlang separately. 
> 
> i could start my rabbitmq-server successfully, but after enabling the rabbitmq-management plugin it throws below error and fails to start.
> there is no configuration(rabbitmq.config/rabbitmq-env.conf) file by default and i did not create any. 
> 
> ===========================================
> File : mymachine-sasl.log
> --------------------------
> =SUPERVISOR REPORT==== 12-Apr-2013::10:26:14 ===
>      Supervisor: {local,rabbit_web_dispatch_sup}
>      Context:    child_terminated
>      Reason:     {could_not_start_listener,
>                   [{port,55672},{ignore_in_use,true}],
>                   {'EXIT',
>                    {undef,
>                     [{lists,keyfind,
>                       [name,1,
>                        [{loop,
>                          {mochiweb_http,loop,
>                           [#Fun<rabbit_web_dispatch_sup.0.23589304>]}},
>                         {name,rabbit_web_dispatch_sup_55672},
>                         {port,55672}]]},
>                      {mochilists,is_defined,2},
>                      {mochilists,set_default,2},
>                      {lists,foldl,3},
>                      {mochiweb_http,start,1},
>                      {supervisor,do_start_child,2},
>                      {supervisor,handle_start_child,2},
>                      {supervisor,handle_call,3}]}}}
>      Offender:   [{pid,<0.237.0>},
>                   {name,rabbit_web_dispatch_registry},
>                   {mfa,{rabbit_web_dispatch_registry,start_link,[]}},
>                   {restart_type,transient},
>                   {shutdown,5000},
>                   {child_type,worker}]
> 
> 
> =CRASH REPORT==== 12-Apr-2013::10:26:14 ===
>   crasher:
>     pid: <0.239.0>
>     registered_name: []
>     exception exit: {bad_return,
>                      {{rabbit_mgmt_app,start,[normal,[]]},
>                       {'EXIT',
>                        {{could_not_start_listener,
>                          [{port,55672},{ignore_in_use,true}],
>                          {'EXIT',
>                           {undef,
>                            [{lists,keyfind,
>                              [name,1,
>                               [{loop,
>                                 {mochiweb_http,loop,
>                                  [#Fun<rabbit_web_dispatch_sup.0.23589304>]}},
>                                {name,rabbit_web_dispatch_sup_55672},
>                                {port,55672}]]},
>                             {mochilists,is_defined,2},
>                             {mochilists,set_default,2},
>                             {lists,foldl,3},
>                             {mochiweb_http,start,1},
>                             {supervisor,do_start_child,2},
>                             {supervisor,handle_start_child,2},
>                             {supervisor,handle_call,3}]}}},
>                         {gen_server,call,
>                          [rabbit_web_dispatch_registry,
>                           {add,rabbit_mgmt_redirect,
>                            [{port,55672},{ignore_in_use,true}],
>                            #Fun<rabbit_web_dispatch.1.31447083>,
>                            #Fun<rabbit_web_dispatch.0.114103971>,
>                            {[],"Redirect to port 15672"}},
>                           infinity]}}}}}
>       in function application_master:init/4
>     initial call: application_master:init/4
>     ancestors: [<0.238.0>]
>     messages: [{'EXIT',<0.240.0>,normal}]
>     links: [<0.238.0>,<0.6.0>]
>     dictionary: []
>     trap_exit: true
>     status: running
>     heap_size: 610
>     stack_size: 23
>     reductions: 130
>   neighbours:
> ==================================================
> 
> Thanks for your help in advance
> -
> Ram
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130412/67ecfaa0/attachment.htm>

From matthias at rabbitmq.com  Fri Apr 12 09:34:20 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 12 Apr 2013 09:34:20 +0100
Subject: [rabbitmq-discuss] Error : could_not_start_listener...
	rabbit_web_dispatch_su
In-Reply-To: <6C6A5729-D040-43A2-807A-9FD62A8BEE15@rabbitmq.com>
References: <20130412063959.3ADB36F443@smtp.hushmail.com>
	<6C6A5729-D040-43A2-807A-9FD62A8BEE15@rabbitmq.com>
Message-ID: <5167C70C.4030401@rabbitmq.com>

On 12/04/13 09:19, Tim Watson wrote:
> Looks like a too old version of erlang.

Indeed. See http://www.rabbitmq.com/which-erlang.html

Matthias.

From yuva670 at gmail.com  Fri Apr 12 10:18:24 2013
From: yuva670 at gmail.com (Mahesh Viraktamath)
Date: Fri, 12 Apr 2013 14:48:24 +0530
Subject: [rabbitmq-discuss] Clustering Linux and Windows machines
Message-ID: <CAPrynAVSvAtoySeqQJRYhdv9vPp-kSSSmdBCzpXSfVijz4tRWg@mail.gmail.com>

Hi,

I am trying to cluster rabbitmq nodes on a linux and windows machines. I
ran consumers connecting to each of these nodes and they connected fine.
The cookies are similar on both the machines.

On windows, I installed the RabbitMQ and erlang using the installers -
2.8.4 and R15B01 respectively, My linux machine runs rhel 5, so the same
versions were not available in the repository, so I installed erlang by
building from the source and verified the version. I installed RabbitMQ
using the precompiled generic unix bundle (2.8.4).

To verify the installed versions, I enabled the management plugins and
checked there. Now, when I do a
"rabbitmqctl -n rabbit at 564654-host99 status", it says node down.

Am I missing any step here given that the servers run different platforms?


Thanks,
Mahesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130412/d645b9b1/attachment.htm>

From simon at rabbitmq.com  Fri Apr 12 10:48:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 12 Apr 2013 10:48:45 +0100
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <20130412063804.DEE246F443@smtp.hushmail.com>
References: <20130412063804.DEE246F443@smtp.hushmail.com>
Message-ID: <5167D87D.4030103@rabbitmq.com>

On 12/04/13 07:38, gopram at hushmail.com wrote:
> I am trying RabbitMQ for the first time. installed latest rabbitmq
> version 3.0.4 and installed latest erlang separately.

>                     {undef,
>                      [{lists,keyfind,

I strongly suspect you are not in fact using the latest Erlang - could 
you be picking up a different version from somewhere? The log file will 
tell you which version of Erlang you're actually running.

Cheers,  Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Apr 12 10:51:21 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 12 Apr 2013 10:51:21 +0100
Subject: [rabbitmq-discuss] Clustering Linux and Windows machines
In-Reply-To: <CAPrynAVSvAtoySeqQJRYhdv9vPp-kSSSmdBCzpXSfVijz4tRWg@mail.gmail.com>
References: <CAPrynAVSvAtoySeqQJRYhdv9vPp-kSSSmdBCzpXSfVijz4tRWg@mail.gmail.com>
Message-ID: <5167D919.6010908@rabbitmq.com>

Hi. Check http://www.rabbitmq.com/clustering.html#firewall - I suspect 
one or both of the machines is firewalling inter-node communication.

Also, any particular reason why you're installing 2.8.4? It's fairly old.

Cheers, Simon

On 12/04/13 10:18, Mahesh Viraktamath wrote:
> Hi,
>
> I am trying to cluster rabbitmq nodes on a linux and windows machines. I
> ran consumers connecting to each of these nodes and they connected fine.
> The cookies are similar on both the machines.
>
> On windows, I installed the RabbitMQ and erlang using the installers -
> 2.8.4 and R15B01 respectively, My linux machine runs rhel 5, so the same
> versions were not available in the repository, so I installed erlang by
> building from the source and verified the version. I installed RabbitMQ
> using the precompiled generic unix bundle (2.8.4).
>
> To verify the installed versions, I enabled the management plugins and
> checked there. Now, when I do a
> "rabbitmqctl -n rabbit at 564654-host99 status", it says node down.
>
> Am I missing any step here given that the servers run different platforms?
>
>
> Thanks,
> Mahesh
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From oullion.m at voila.fr  Fri Apr 12 10:04:02 2013
From: oullion.m at voila.fr (=?UTF-8?Q?Micha=C3=ABl_OULLION?=)
Date: Fri, 12 Apr 2013 11:04:02 +0200 (CEST)
Subject: [rabbitmq-discuss] Dead Letter, TTL and Cycle
Message-ID: <140565519.42411365757443026.JavaMail.www@wwinf7117>

Hello, 

I work on a solution to consume Message on queue and I use "Dead letter" mechanism.
I try to distingish 2 type of error when consuming message :
* Functional
the message cannot be proceed by the application due to a format bug, We can't requeue it because they won't be proceed.
* Technical 
The message cannot be proceed because the DB is offline. This kind of message can be proceed when the DB will be back.

So only "technical error"'s message are send to Dead Queue.
Now, I try to resend "automatically" the message from the Dead Queue to the "live" one.

To do this, I put a TTL parameter on the Queue ( for example 10 minutes), so the message are automatically recycle every 10 minutes.
This solution work fine... except that I create a cycle ( Live queue => Dead queue => Live Queue) and message are dropped.

Is there a way to "purge" the header of messages when they are recycled directly inside the RabbitMQ Server?
Or Do I create an specific client to read Dead message, purge header and resend it ?

Regards,
___________________________________________________________
Le spectacle de Franck Dubosc perturb? ? cause de Koh-Lanta ! Plus d'explications ici http://people.voila.fr/people/actu-stars/personnalites/franck-dubosc-oblige-de-reecrire-son-spectacle-a-cause-de-koh-lanta-people_9953.html

From simon at rabbitmq.com  Fri Apr 12 10:59:21 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 12 Apr 2013 10:59:21 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin CLI...
In-Reply-To: <51672298.3000904@nabancard.com>
References: <51672298.3000904@nabancard.com>
Message-ID: <5167DAF9.1050008@rabbitmq.com>

On 11/04/13 21:52, Michael A. Cojocari wrote:
> Hello!
>
> Do you guys have any documentation on how binding works with the
> rabbitmqadmin CLI?

"rabbitmqadmin help subcommands" says:

declare binding source=... destination=... [arguments=... 
routing_key=... destination_type=...]

delete binding source=... destination_type=... destination=... 
properties_key=...

So for example:

$ rabbitmqadmin declare queue name=test
$ rabbitmqadmin declare binding source=amq.topic destination=test 
destination_type=queue routing_key=mykey
$ rabbitmqadmin delete binding source=amq.topic destination=test 
destination_type=queue properties_key=mykey

What were you having trouble with?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Fri Apr 12 11:05:39 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 12 Apr 2013 11:05:39 +0100
Subject: [rabbitmq-discuss] Subscribers per Channel
In-Reply-To: <CAE3HoVQ5cFMnwQMG1T2HDQpbaVqqDTZ3kphujpFLXqAtSqcxuw@mail.gmail.com>
References: <217c4d80-7617-41d8-b576-442b5498f74c@googlegroups.com>
	<CAE3HoVQ5cFMnwQMG1T2HDQpbaVqqDTZ3kphujpFLXqAtSqcxuw@mail.gmail.com>
Message-ID: <5167DC73.1080205@rabbitmq.com>

On 12/04/13 01:04, Michael Klishin wrote:
> 2013/4/12 Ilya Volodarsky <ilya at segment.io <mailto:ilya at segment.io>>
>
>     1. What is a recommended amount of subscriptions per channel?
>
> Channels are just integers on the wire and a little bit of state on the
> node you are connecting to.
> It's unlikely to cause any issues.

Actually channels can take up a fair amount of memory - tens of kilobytes.

> Error handling is per-channel so it's a better idea to have one channel
> per consumer than multiple
> ones.

I'd say there should be one channel per logical "thread of control" in 
the consuming application. It's perfectly ok for an application that 
wants to consume from several queues to do so via a single channel.


Matthias.

From simon at rabbitmq.com  Fri Apr 12 11:19:40 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 12 Apr 2013 11:19:40 +0100
Subject: [rabbitmq-discuss] Dead Letter, TTL and Cycle
In-Reply-To: <140565519.42411365757443026.JavaMail.www@wwinf7117>
References: <140565519.42411365757443026.JavaMail.www@wwinf7117>
Message-ID: <5167DFBC.1000904@rabbitmq.com>

At the moment you would have to consume and republish to purge the 
header outside of RabbitMQ.

In a future release we might relax the no-cycle requirement.

Cheers, Simon

On 12/04/13 10:04, Micha?l OULLION wrote:
> Hello,
>
> I work on a solution to consume Message on queue and I use "Dead letter" mechanism.
> I try to distingish 2 type of error when consuming message :
> * Functional
> the message cannot be proceed by the application due to a format bug, We can't requeue it because they won't be proceed.
> * Technical
> The message cannot be proceed because the DB is offline. This kind of message can be proceed when the DB will be back.
>
> So only "technical error"'s message are send to Dead Queue.
> Now, I try to resend "automatically" the message from the Dead Queue to the "live" one.
>
> To do this, I put a TTL parameter on the Queue ( for example 10 minutes), so the message are automatically recycle every 10 minutes.
> This solution work fine... except that I create a cycle ( Live queue => Dead queue => Live Queue) and message are dropped.
>
> Is there a way to "purge" the header of messages when they are recycled directly inside the RabbitMQ Server?
> Or Do I create an specific client to read Dead message, purge header and resend it ?
>
> Regards,
> ___________________________________________________________
> Le spectacle de Franck Dubosc perturb? ? cause de Koh-Lanta ! Plus d'explications ici http://people.voila.fr/people/actu-stars/personnalites/franck-dubosc-oblige-de-reecrire-son-spectacle-a-cause-de-koh-lanta-people_9953.html
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From thomas.oulevey at cern.ch  Fri Apr 12 12:37:15 2013
From: thomas.oulevey at cern.ch (Thomas Oulevey)
Date: Fri, 12 Apr 2013 13:37:15 +0200
Subject: [rabbitmq-discuss] Fedora init script modification for ulimit
Message-ID: <5167F1EB.6040700@cern.ch>

Hi,

I'd like to submit the following patch.

Please note I submit a similar one for EPEL:
https://bugzilla.redhat.com/show_bug.cgi?id=951518

$ hg diff

diff -r f5c0fb06384a packaging/RPMS/Fedora/rabbitmq-server.init
--- a/packaging/RPMS/Fedora/rabbitmq-server.init    Wed Apr 10 11:57:54 
2013 +0100
+++ b/packaging/RPMS/Fedora/rabbitmq-server.init    Fri Apr 12 13:29:26 
2013 +0200
@@ -60,6 +60,13 @@
      else
          RETVAL=0
          ensure_pid_dir
+
+    # RABBIT_NOFILES_LIMIT from /etc/default/rabbitmq-server is not handled
+        # automatically
+       if [ -n "$RABBITMQ_NOFILES_LIMIT" ]; then
+            ulimit -n "$RABBITMQ_NOFILES_LIMIT"
+        fi
+
          set +e
          RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON \
              > "${INIT_LOG_DIR}/startup_log" \

PS: Is there an other way to submit patch ?

From simon at rabbitmq.com  Fri Apr 12 12:41:32 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 12 Apr 2013 12:41:32 +0100
Subject: [rabbitmq-discuss] Dead Letter, TTL and Cycle
In-Reply-To: <250954918.70251365766815236.JavaMail.www@wwinf7117>
References: <250954918.70251365766815236.JavaMail.www@wwinf7117>
Message-ID: <5167F2EC.4000508@rabbitmq.com>

On 12/04/13 12:40, Micha?l OULLION wrote:
> Thanks Simon for your answer.
> Any idea of when this feature will be available?
> Q4 2013? 2015? not planned yet?

We're still considering :-) but if I had to guess I'd say this year.

Cheers, Simon

> Just to know If I delay my dev to wait it or not.
>
> Regards,
>
>
>> Message du 12/04/13 ? 12h19
>> De : "Simon MacMullen"
>> A : "Micha?l OULLION" , "Discussions about RabbitMQ"
>> Copie ? :
>> Objet : Re: [rabbitmq-discuss] Dead Letter, TTL and Cycle
>>
>> At the moment you would have to consume and republish to purge the
>> header outside of RabbitMQ.
>>
>> In a future release we might relax the no-cycle requirement.
>>
>> Cheers, Simon
>>
>> On 12/04/13 10:04, Micha?l OULLION wrote:
>>> Hello,
>>>
>>> I work on a solution to consume Message on queue and I use "Dead letter" mechanism.
>>> I try to distingish 2 type of error when consuming message :
>>> * Functional
>>> the message cannot be proceed by the application due to a format bug, We can't requeue it because they won't be proceed.
>>> * Technical
>>> The message cannot be proceed because the DB is offline. This kind of message can be proceed when the DB will be back.
>>>
>>> So only "technical error"'s message are send to Dead Queue.
>>> Now, I try to resend "automatically" the message from the Dead Queue to the "live" one.
>>>
>>> To do this, I put a TTL parameter on the Queue ( for example 10 minutes), so the message are automatically recycle every 10 minutes.
>>> This solution work fine... except that I create a cycle ( Live queue => Dead queue => Live Queue) and message are dropped.
>>>
>>> Is there a way to "purge" the header of messages when they are recycled directly inside the RabbitMQ Server?
>>> Or Do I create an specific client to read Dead message, purge header and resend it ?
>>>
>>> Regards,
>>> ___________________________________________________________
>>> Le spectacle de Franck Dubosc perturb? ? cause de Koh-Lanta ! Plus d'explications ici http://people.voila.fr/people/actu-stars/personnalites/franck-dubosc-
> oblige-de-reecrire-son-spectacle-a-cause-de-koh-lanta-people_9953.html
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
> ___________________________________________________________
> Le spectacle de Franck Dubosc perturb? ? cause de Koh-Lanta ! Plus d'explications ici http://people.voila.fr/people/actu-stars/personnalites/franck-dubosc-oblige-de-reecrire-son-spectacle-a-cause-de-koh-lanta-people_9953.html
>


-- 
Simon MacMullen
RabbitMQ, VMware

From matt at nextdoor.com  Fri Apr 12 19:36:22 2013
From: matt at nextdoor.com (Matt Wise)
Date: Fri, 12 Apr 2013 11:36:22 -0700 (PDT)
Subject: [rabbitmq-discuss] 3.0.4 extremely unstable in production...?
Message-ID: <a3b2aa1d-b3f7-4093-9047-00bb579179c3@googlegroups.com>

We've been running RabbitMQ 2.8.x in production in Amazon for about 16 
months now without very many issues. Last week we ran into an issue where 
our 2.8.5 cluster nodes hit their high-memory-limit and stopped processing 
jobs, effectively taking down our entire Celery task queue. We decided to 
upgrade the software to 3.0.4 (which had been running in staging for a few 
weeks, as a single instance, without issue) and at the same time beef up 
the size and redundancy of our farm to 3 machines that were m1.larges.

Old Farm:
  server1: m1.small, 2.8.5, us-west-1c
  server2: m1.small, 2.8.5, us-west-1c

New Farm:
  server1: m1.large, 3.0.4, us-west-1a
  server2: m1.large, 3.0.4, us-west-1c
  server3: m1.large, 3.0.4, us-west-1c

Since creating the new server farm though we've had 3 outages. In the first 
two outages we received a Network Partition Split, and effectively all 3 of 
the systems decided to run their own queues independently of the other 
servers. This was the first time we'd ever seen this failure, ever. In the 
most recent failure we had 2 machines split off, and the 3rd rabbitmq 
service effectively became unresponsive entirely.

For sanity sake, at this point we've backed down to the following 
configuration:

New-New Farm:
  server1: m1.large, 2.8.5, us-west-1c
  server2: m1.large, 2.8.5, us-west-1a

Up until recently though I had felt extremely comfortable with RabbitMQ's 
clustering technology and reliability... now ... not so much. Has anyone 
else seen similar behaviors? Is it simply due to the fact that we're 
running cross-zone now in Amazon, or is it more likely the 3 servers that 
caused the problem? Or the 3.0.x upgrade?

--Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130412/e2ce6f06/attachment.htm>

From vito.sansevero at greenwavereality.com  Fri Apr 12 22:44:02 2013
From: vito.sansevero at greenwavereality.com (Veets)
Date: Fri, 12 Apr 2013 14:44:02 -0700 (PDT)
Subject: [rabbitmq-discuss] Naughty client needs frame_max
Message-ID: <054c4fc4-786d-4f61-826b-661676e0b2c0@googlegroups.com>

Hi, 

I have a naughty client that needs frame_max set to 0 so it can keep 
working until the client is fixed. 

I can't seem to get it to work. I have tried various ways of expressing it 
in rabbitmq.config like so: 

[ {rabbit, [{frame_max, [0]}]} ].

Just as one example. 

It either errors out and complains about the config, or rabbit starts but I 
get auth errors and it seems my users are no longer defined, if I remove 
the config all is well. 

Am I setting this value wrong? I am running on Ubuntu 12.04 and there is no 
default rabbitmq.config to modify, so I just create my own and insert the 
above. Does this not append the needed value or is it if you use a .config 
you need ALL of it? <confused> 


Cheers, 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130412/eba29476/attachment.htm>

From lee.sylvester at gmail.com  Mon Apr 15 07:30:52 2013
From: lee.sylvester at gmail.com (Lee Sylvester)
Date: Mon, 15 Apr 2013 07:30:52 +0100
Subject: [rabbitmq-discuss] Filtering
Message-ID: <30E58CEA-03A7-46DD-8CC5-B1692B611FAC@gmail.com>

Hi list,

This is my first post to the list.  I hope you guys don't mind, but this post is partially a "RMQ vs. ZMQ" thread.

So, I have a distributed Erland application and I want to add a mesh socket network on top of it to handle some heavy duty (potentially) traffic so as not to bog down the internal Erlang messaging.  My first thought for this was to go the route of ZMQ, simply because I've already read the book.  ZMQ was previously an attractive option for me, as it meant no broker and I'm lazy, so the least moving parts the better.  However, having thought more on the subject, I decided I simply want the best option.  I mean, I'm using Erlang, so one extra Erlang node (RMQ broker) doesn't scare the lazy side of me, and at least it's scalable, right?

So, here's my conundrum.  In my mesh, I need to distribute messages from a node on a single port and receive messages on a single port.  Each node will connect to one another, like lego. So, both incoming and outgoing ports will have many connections.  For incoming, I should be able to handle my messages using OTP's handle_info func on the gen_server pattern.  It should also expect all incoming messages to be meant for it specifically; thus I'd like to be able to filter outgoing messages on the publisher side, rather than incoming messages on the subscriber side, as I wish to reduce overall network traffic.

My question is; can RabbitMQ do that for me?  That I can find, ZMQ will allow for everything except for the filtering of messages from the publisher.

Thanks a lot, guys.

Regards,
Lee

From emile at rabbitmq.com  Mon Apr 15 09:46:46 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 15 Apr 2013 09:46:46 +0100
Subject: [rabbitmq-discuss] Fedora init script modification for ulimit
In-Reply-To: <5167F1EB.6040700@cern.ch>
References: <5167F1EB.6040700@cern.ch>
Message-ID: <516BBE76.1010708@rabbitmq.com>


Hi,

On 12/04/13 12:37, Thomas Oulevey wrote:
> +++ b/packaging/RPMS/Fedora/rabbitmq-server.init    Fri Apr 12 13:29:26 

> +       if [ -n "$RABBITMQ_NOFILES_LIMIT" ]; then
> +            ulimit -n "$RABBITMQ_NOFILES_LIMIT"
> +        fi


The way this is intended to work is that /etc/default/rabbitmq-server is
sourced from the startup script
(http://hg.rabbitmq.com/rabbitmq-server/file/105d6265b42d/packaging/RPMS/Fedora/rabbitmq-server.init#l40)

    [ -f /etc/default/${NAME} ] && . /etc/default/${NAME}

and that /etc/default/rabbitmq-server contains the commands to execute, e.g.

    ulimit -n 1024

That should work without needing a patch.



-Emile






From emile at rabbitmq.com  Mon Apr 15 09:59:32 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 15 Apr 2013 09:59:32 +0100
Subject: [rabbitmq-discuss] Naughty client needs frame_max
In-Reply-To: <054c4fc4-786d-4f61-826b-661676e0b2c0@googlegroups.com>
References: <054c4fc4-786d-4f61-826b-661676e0b2c0@googlegroups.com>
Message-ID: <516BC174.6070207@rabbitmq.com>


Hi

On 12/04/13 22:44, Veets wrote:
> [ {rabbit, [{frame_max, [0]}]} ].

It should be without brackets around the number:

[{rabbit, [{frame_max, 0}]}].

> It either errors out and complains about the config, or rabbit starts
> but I get auth errors and it seems my users are no longer defined, if I
> remove the config all is well. 

If you get authentication errors without the config file then that
points to a separate problem with a separate solution. See

https://www.rabbitmq.com/authentication.html

> Am I setting this value wrong? I am running on Ubuntu 12.04 and there is
> no default rabbitmq.config to modify, so I just create my own and insert
> the above. Does this not append the needed value or is it if you use a
> .config you need ALL of it? <confused> 

You may specify only the variables you are interested in. There is no
need to specify an exhaustive config file. For more details see

https://www.rabbitmq.com/configure.html




-Emile







From emile at rabbitmq.com  Mon Apr 15 10:16:23 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 15 Apr 2013 10:16:23 +0100
Subject: [rabbitmq-discuss] 3.0.4 extremely unstable in production...?
In-Reply-To: <a3b2aa1d-b3f7-4093-9047-00bb579179c3@googlegroups.com>
References: <a3b2aa1d-b3f7-4093-9047-00bb579179c3@googlegroups.com>
Message-ID: <516BC567.8020602@rabbitmq.com>


Hi,

On 12/04/13 19:36, Matt Wise wrote:
> Since creating the new server farm though we've had 3 outages. In the
> first two outages we received a Network Partition Split, and effectively
> all 3 of the systems decided to run their own queues independently of
> the other servers. This was the first time we'd ever seen this failure,
> ever. In the most recent failure we had 2 machines split off, and the
> 3rd rabbitmq service effectively became unresponsive entirely.

Versions 2.8.x and 3.0.x are equally susceptible to partitions. You can
confirm this experimentally by setting up a cluster of v2.8.x nodes and
interrupting connectivity for twice the net_ticktime (60s by default).

See https://www.rabbitmq.com/partitions.html

> Up until recently though I had felt extremely comfortable with
> RabbitMQ's clustering technology and reliability... now ... not so much.
> Has anyone else seen similar behaviors? Is it simply due to the fact
> that we're running cross-zone now in Amazon, or is it more likely the 3
> servers that caused the problem? Or the 3.0.x upgrade?

A network outage coincided with the period when nodes were running
v3.0.4. The network interruption is the cause of the partition rather
than the broker version.

At the time of writing RabbitMQ clustering does not tolerate network
partitions well, so it should not be used over a WAN. The shovel or
federation plugins are better solutions for that case.

See http://www.rabbitmq.com/clustering.html



-Emile








From simon at rabbitmq.com  Mon Apr 15 10:38:42 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 15 Apr 2013 10:38:42 +0100
Subject: [rabbitmq-discuss] 3.0.4 extremely unstable in production...?
In-Reply-To: <516BC567.8020602@rabbitmq.com>
References: <a3b2aa1d-b3f7-4093-9047-00bb579179c3@googlegroups.com>
	<516BC567.8020602@rabbitmq.com>
Message-ID: <516BCAA2.7060504@rabbitmq.com>

To add to what Emile said: the only difference between partition 
handling in 2.x and 3.x is that 3.x will show a big red warning in 
management when one has occurred whereas 2.x will stay silent. If you 
still have logs from the 2.x days you might want to grep for 
"running_partitioned_network" - I suspect you will find some matches.

The next release, 3.1 will have some features around automatic healing 
of network partitions.

Cheers, Simon

On 15/04/2013 10:16, Emile Joubert wrote:
>
> Hi,
>
> On 12/04/13 19:36, Matt Wise wrote:
>> Since creating the new server farm though we've had 3 outages. In the
>> first two outages we received a Network Partition Split, and effectively
>> all 3 of the systems decided to run their own queues independently of
>> the other servers. This was the first time we'd ever seen this failure,
>> ever. In the most recent failure we had 2 machines split off, and the
>> 3rd rabbitmq service effectively became unresponsive entirely.
>
> Versions 2.8.x and 3.0.x are equally susceptible to partitions. You can
> confirm this experimentally by setting up a cluster of v2.8.x nodes and
> interrupting connectivity for twice the net_ticktime (60s by default).
>
> See https://www.rabbitmq.com/partitions.html
>
>> Up until recently though I had felt extremely comfortable with
>> RabbitMQ's clustering technology and reliability... now ... not so much.
>> Has anyone else seen similar behaviors? Is it simply due to the fact
>> that we're running cross-zone now in Amazon, or is it more likely the 3
>> servers that caused the problem? Or the 3.0.x upgrade?
>
> A network outage coincided with the period when nodes were running
> v3.0.4. The network interruption is the cause of the partition rather
> than the broker version.
>
> At the time of writing RabbitMQ clustering does not tolerate network
> partitions well, so it should not be used over a WAN. The shovel or
> federation plugins are better solutions for that case.
>
> See http://www.rabbitmq.com/clustering.html
>
>
>
> -Emile
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From chaitanya.jawale at gmail.com  Mon Apr 15 09:58:21 2013
From: chaitanya.jawale at gmail.com (Chaitanya Jawale)
Date: Mon, 15 Apr 2013 01:58:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Multiple threads accessing the RPC queue
Message-ID: <a219d7b7-4737-46b5-93ce-943182ad4227@googlegroups.com>

Hi,

I am facing a problem with the RPC queue. In my case I have server and 
agent and between them communication medium is RabbitMQ through messages. 
To perform any action on the agent I post a message in RPC call back queue 
in which agent performs the action and returns me the result. Now in some 
cases there are multiple threads tries to put messages in the same RPC 
queue to perform different actions on the agent in parallel but none gets 
delivered to the agent(RPC server) and if i do it serially it works. What 
can be the issue?

Thanks,
Chaitanya.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130415/7a389e55/attachment.htm>

From tim at rabbitmq.com  Mon Apr 15 10:46:25 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 15 Apr 2013 10:46:25 +0100
Subject: [rabbitmq-discuss] Filtering
In-Reply-To: <30E58CEA-03A7-46DD-8CC5-B1692B611FAC@gmail.com>
References: <30E58CEA-03A7-46DD-8CC5-B1692B611FAC@gmail.com>
Message-ID: <34B513FC-235E-4A1B-B34C-72FE1B890917@rabbitmq.com>

Hi Lee,

Some (hopefully useful) comments inline...

On 15 Apr 2013, at 07:30, Lee Sylvester wrote:

> So, here's my conundrum.  In my mesh, I need to distribute messages from a node on a single port and receive messages on a single port.

An AMQP client can open multiple connections (on discrete ports) and can open multiple channels per connection (multiplexing). A channel can be used to publish or subscribe, or both, though it's probably best to do one or the other per channel IMHO. Setting up a port for receiving and another for producing/publishing messages to/from a broker is very simple.

>  Each node will connect to one another, like lego. So, both incoming and outgoing ports will have many connections.

Are you planning on having a broker act as an intermediary between all the nodes in your mesh? This is certainly possible, though you should be aware that you're introducing a potential bottleneck (from a performance standpoint) and a single point of (communications) failure should the broker's node become unavailable (through network disruption, for example).

Another option would be to run the broker embedded in your nodes, providing a communications fabric alongside regular distributed Erlang message passing. It is possible to run the Erlang client alongside a broker in the same node - this is how many RabbitMQ plugins work - and the Erlang client can send/receive messages to a broker using a 'direct mode' connection, that uses direct (internal, Erlang) message passing instead of a network connection. Running a broker embedded still allows you to listen on one or more specific ports, and you can connect to another (RabbitMQ broker embedded within another) node using the Erlang client as usual.

Yet another option that opens up if you're embedding RabbitMQ in your nodes is using the Shovel or Federation plugins to completely automate the communications fabric between them, leaving you (the developer) responsible only for handling the client portion of the code within each node - an explanation will follow.

>  For incoming, I should be able to handle my messages using OTP's handle_info func on the gen_server pattern.

This is certainly possible. The Erlang client allows you to register the calling process as a consumer, after which point AMQP messages will arrive in the process' mailbox as regular messages, thus...

init(_) ->
    %% inside gen_server's Module:init/1
    amqp_channel:subscribe(Channel,
                           #'basic.consume'{queue    = Queue,
                                            no_local = false,
                                            no_ack   = NoAck},
                           self()),
    {ok, State}.
 
handle_info(#'basic.consume_ok'{}, State) ->
    %% we're good to go....
    {noreply, State};
handle_info({Delivery = #'basic.deliver'{ redelivered = Redelivered },
                      #amqp_msg{payload = Payload}}, State) ->
    State2 = do_something(Payload, Redelivered, State),
    {noreply, State2};
.... etc


Another option is to use the amqp_gen_consumer behaviour, which allows for a set of callbacks quite similar to a gen_server, viz...

%% init(Args) -> {ok, InitialState} | {stop, Reason} | ignore
%% handle_consume(Consume, Sender, State) -> ok_error()
%% handle_consume_ok(ConsumeOk, Consume, State) -> ok_error()
%% handle_cancel(Cancel, State) -> ok_error()
%% handle_cancel_ok(CancelOk, Cancel, State) -> ok_error()
%% handle_deliver(Deliver, Message, State) -> ok_error()
%% handle_info(Info, State) -> ok_error()
%% handle_call(Msg, From, State) -> {reply, Reply, NewState} |
%% terminate(Reason, State) -> any()

As an OTP guy, I guess that'll look fairly obvious and familiar to you - check the amqp_gen_consumer documentation for details.

>  It should also expect all incoming messages to be meant for it specifically; thus I'd like to be able to filter outgoing messages on the publisher side, rather than incoming messages on the subscriber side, as I wish to reduce overall network traffic.

That's fine, and is really *entirely* up to you. If you wanted to filter on the consumer's side, there's a amqp_selective_consumer module in the Erlang client to help. Filtering outbound messages is surely an application specific issue, and the code to publish is very simple:

    amqp_channel:call(Channel, Method,
                      #amqp_msg{props = #'P_basic'{delivery_mode = 2}, %% persistent
                                payload = MyPayload}),


I think outbound filtering is up to your application isn't it? If you consider using federation or shovel to replicate messages across multiple (embedded) broker nodes, then you can automate the filtering by managing the topology which is being replicated such that only specific messages are forwarded via specific queues (or exchanges) - see the federation and/or shovel documentation for details.

> 
> My question is; can RabbitMQ do that for me?  That I can find, ZMQ will allow for everything except for the filtering of messages from the publisher.
> 

Yes, although you'll need to be a bit more specific about this filtering requirement for me to give you more concrete advice. In general, RabbitMQ offers extremely flexible routing which ought to meet all of your requirements.

Cheers,
Tim


From lee.sylvester at gmail.com  Mon Apr 15 11:18:15 2013
From: lee.sylvester at gmail.com (Lee Sylvester)
Date: Mon, 15 Apr 2013 11:18:15 +0100
Subject: [rabbitmq-discuss] Filtering
In-Reply-To: <34B513FC-235E-4A1B-B34C-72FE1B890917@rabbitmq.com>
References: <30E58CEA-03A7-46DD-8CC5-B1692B611FAC@gmail.com>
	<34B513FC-235E-4A1B-B34C-72FE1B890917@rabbitmq.com>
Message-ID: <86F7DA38-86DD-4CA7-9F89-F7247D623843@gmail.com>

Hi Tim,

Thank you, that's great information.  To give you a bit of a clearer picture of what I'm doing;

I have a clusterable node which creates websocket connections using Cowboy and Bullet.  Each websocket connection is stored in Mnesia, so that it can be referenced across the cluster.  As I add more nodes (load balanced), I can handle more connections.  What I want to do is to augment the Erlang messaging layer with an MQ layer so as not to clutter it with too much traffic.  Thus, I can get the PID of a connections process from Mnesia and send a message straight to it over RabbitMQ.  The RabbitMQ connections will be routed based on node name, so I know what node I want to message and what RabbitMQ filter to apply.  As new nodes come online, my Erlang node is setup to request all other nodes to create new RabbitMQ nodes to these new ones and vice versa.

I think what you describe could work very well.

Regards,
Lee



On 15 Apr 2013, at 10:46, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Lee,
> 
> Some (hopefully useful) comments inline...
> 
> On 15 Apr 2013, at 07:30, Lee Sylvester wrote:
> 
>> So, here's my conundrum.  In my mesh, I need to distribute messages from a node on a single port and receive messages on a single port.
> 
> An AMQP client can open multiple connections (on discrete ports) and can open multiple channels per connection (multiplexing). A channel can be used to publish or subscribe, or both, though it's probably best to do one or the other per channel IMHO. Setting up a port for receiving and another for producing/publishing messages to/from a broker is very simple.
> 
>> Each node will connect to one another, like lego. So, both incoming and outgoing ports will have many connections.
> 
> Are you planning on having a broker act as an intermediary between all the nodes in your mesh? This is certainly possible, though you should be aware that you're introducing a potential bottleneck (from a performance standpoint) and a single point of (communications) failure should the broker's node become unavailable (through network disruption, for example).
> 
> Another option would be to run the broker embedded in your nodes, providing a communications fabric alongside regular distributed Erlang message passing. It is possible to run the Erlang client alongside a broker in the same node - this is how many RabbitMQ plugins work - and the Erlang client can send/receive messages to a broker using a 'direct mode' connection, that uses direct (internal, Erlang) message passing instead of a network connection. Running a broker embedded still allows you to listen on one or more specific ports, and you can connect to another (RabbitMQ broker embedded within another) node using the Erlang client as usual.
> 
> Yet another option that opens up if you're embedding RabbitMQ in your nodes is using the Shovel or Federation plugins to completely automate the communications fabric between them, leaving you (the developer) responsible only for handling the client portion of the code within each node - an explanation will follow.
> 
>> For incoming, I should be able to handle my messages using OTP's handle_info func on the gen_server pattern.
> 
> This is certainly possible. The Erlang client allows you to register the calling process as a consumer, after which point AMQP messages will arrive in the process' mailbox as regular messages, thus...
> 
> init(_) ->
>    %% inside gen_server's Module:init/1
>    amqp_channel:subscribe(Channel,
>                           #'basic.consume'{queue    = Queue,
>                                            no_local = false,
>                                            no_ack   = NoAck},
>                           self()),
>    {ok, State}.
> 
> handle_info(#'basic.consume_ok'{}, State) ->
>    %% we're good to go....
>    {noreply, State};
> handle_info({Delivery = #'basic.deliver'{ redelivered = Redelivered },
>                      #amqp_msg{payload = Payload}}, State) ->
>    State2 = do_something(Payload, Redelivered, State),
>    {noreply, State2};
> .... etc
> 
> 
> Another option is to use the amqp_gen_consumer behaviour, which allows for a set of callbacks quite similar to a gen_server, viz...
> 
> %% init(Args) -> {ok, InitialState} | {stop, Reason} | ignore
> %% handle_consume(Consume, Sender, State) -> ok_error()
> %% handle_consume_ok(ConsumeOk, Consume, State) -> ok_error()
> %% handle_cancel(Cancel, State) -> ok_error()
> %% handle_cancel_ok(CancelOk, Cancel, State) -> ok_error()
> %% handle_deliver(Deliver, Message, State) -> ok_error()
> %% handle_info(Info, State) -> ok_error()
> %% handle_call(Msg, From, State) -> {reply, Reply, NewState} |
> %% terminate(Reason, State) -> any()
> 
> As an OTP guy, I guess that'll look fairly obvious and familiar to you - check the amqp_gen_consumer documentation for details.
> 
>> It should also expect all incoming messages to be meant for it specifically; thus I'd like to be able to filter outgoing messages on the publisher side, rather than incoming messages on the subscriber side, as I wish to reduce overall network traffic.
> 
> That's fine, and is really *entirely* up to you. If you wanted to filter on the consumer's side, there's a amqp_selective_consumer module in the Erlang client to help. Filtering outbound messages is surely an application specific issue, and the code to publish is very simple:
> 
>    amqp_channel:call(Channel, Method,
>                      #amqp_msg{props = #'P_basic'{delivery_mode = 2}, %% persistent
>                                payload = MyPayload}),
> 
> 
> I think outbound filtering is up to your application isn't it? If you consider using federation or shovel to replicate messages across multiple (embedded) broker nodes, then you can automate the filtering by managing the topology which is being replicated such that only specific messages are forwarded via specific queues (or exchanges) - see the federation and/or shovel documentation for details.
> 
>> 
>> My question is; can RabbitMQ do that for me?  That I can find, ZMQ will allow for everything except for the filtering of messages from the publisher.
>> 
> 
> Yes, although you'll need to be a bit more specific about this filtering requirement for me to give you more concrete advice. In general, RabbitMQ offers extremely flexible routing which ought to meet all of your requirements.
> 
> Cheers,
> Tim
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From watson.timothy at gmail.com  Mon Apr 15 11:36:56 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 15 Apr 2013 11:36:56 +0100
Subject: [rabbitmq-discuss] Filtering
In-Reply-To: <86F7DA38-86DD-4CA7-9F89-F7247D623843@gmail.com>
References: <30E58CEA-03A7-46DD-8CC5-B1692B611FAC@gmail.com>
	<34B513FC-235E-4A1B-B34C-72FE1B890917@rabbitmq.com>
	<86F7DA38-86DD-4CA7-9F89-F7247D623843@gmail.com>
Message-ID: <8F6D5082-6F99-4AD8-A0BF-D73E60A72579@rabbitmq.com>

Hi Lee,

I don't want to put you off using rabbit - quite the contrary of course - but I'm intrigued to know why you think good old inter-node erlang message passing won't meet your requirements? Obviously rabbit provides more flexible routing and you can take advantage of varying levels of delivery guarantee, but it doesn't sound like you're planning to take advantage of those, so what benefit is AMQP bringing to your architecture?

Cheers,
Tim

On 15 Apr 2013, at 11:18, Lee Sylvester <lee.sylvester at gmail.com> wrote:

> Hi Tim,
> 
> Thank you, that's great information.  To give you a bit of a clearer picture of what I'm doing;
> 
> I have a clusterable node which creates websocket connections using Cowboy and Bullet.  Each websocket connection is stored in Mnesia, so that it can be referenced across the cluster.  As I add more nodes (load balanced), I can handle more connections.  What I want to do is to augment the Erlang messaging layer with an MQ layer so as not to clutter it with too much traffic.  Thus, I can get the PID of a connections process from Mnesia and send a message straight to it over RabbitMQ.  The RabbitMQ connections will be routed based on node name, so I know what node I want to message and what RabbitMQ filter to apply.  As new nodes come online, my Erlang node is setup to request all other nodes to create new RabbitMQ nodes to these new ones and vice versa.
> 
> I think what you describe could work very well.
> 
> Regards,
> Lee
> 
> 
> 
> On 15 Apr 2013, at 10:46, Tim Watson <tim at rabbitmq.com> wrote:
> 
>> Hi Lee,
>> 
>> Some (hopefully useful) comments inline...
>> 
>> On 15 Apr 2013, at 07:30, Lee Sylvester wrote:
>> 
>>> So, here's my conundrum.  In my mesh, I need to distribute messages from a node on a single port and receive messages on a single port.
>> 
>> An AMQP client can open multiple connections (on discrete ports) and can open multiple channels per connection (multiplexing). A channel can be used to publish or subscribe, or both, though it's probably best to do one or the other per channel IMHO. Setting up a port for receiving and another for producing/publishing messages to/from a broker is very simple.
>> 
>>> Each node will connect to one another, like lego. So, both incoming and outgoing ports will have many connections.
>> 
>> Are you planning on having a broker act as an intermediary between all the nodes in your mesh? This is certainly possible, though you should be aware that you're introducing a potential bottleneck (from a performance standpoint) and a single point of (communications) failure should the broker's node become unavailable (through network disruption, for example).
>> 
>> Another option would be to run the broker embedded in your nodes, providing a communications fabric alongside regular distributed Erlang message passing. It is possible to run the Erlang client alongside a broker in the same node - this is how many RabbitMQ plugins work - and the Erlang client can send/receive messages to a broker using a 'direct mode' connection, that uses direct (internal, Erlang) message passing instead of a network connection. Running a broker embedded still allows you to listen on one or more specific ports, and you can connect to another (RabbitMQ broker embedded within another) node using the Erlang client as usual.
>> 
>> Yet another option that opens up if you're embedding RabbitMQ in your nodes is using the Shovel or Federation plugins to completely automate the communications fabric between them, leaving you (the developer) responsible only for handling the client portion of the code within each node - an explanation will follow.
>> 
>>> For incoming, I should be able to handle my messages using OTP's handle_info func on the gen_server pattern.
>> 
>> This is certainly possible. The Erlang client allows you to register the calling process as a consumer, after which point AMQP messages will arrive in the process' mailbox as regular messages, thus...
>> 
>> init(_) ->
>>   %% inside gen_server's Module:init/1
>>   amqp_channel:subscribe(Channel,
>>                          #'basic.consume'{queue    = Queue,
>>                                           no_local = false,
>>                                           no_ack   = NoAck},
>>                          self()),
>>   {ok, State}.
>> 
>> handle_info(#'basic.consume_ok'{}, State) ->
>>   %% we're good to go....
>>   {noreply, State};
>> handle_info({Delivery = #'basic.deliver'{ redelivered = Redelivered },
>>                     #amqp_msg{payload = Payload}}, State) ->
>>   State2 = do_something(Payload, Redelivered, State),
>>   {noreply, State2};
>> .... etc
>> 
>> 
>> Another option is to use the amqp_gen_consumer behaviour, which allows for a set of callbacks quite similar to a gen_server, viz...
>> 
>> %% init(Args) -> {ok, InitialState} | {stop, Reason} | ignore
>> %% handle_consume(Consume, Sender, State) -> ok_error()
>> %% handle_consume_ok(ConsumeOk, Consume, State) -> ok_error()
>> %% handle_cancel(Cancel, State) -> ok_error()
>> %% handle_cancel_ok(CancelOk, Cancel, State) -> ok_error()
>> %% handle_deliver(Deliver, Message, State) -> ok_error()
>> %% handle_info(Info, State) -> ok_error()
>> %% handle_call(Msg, From, State) -> {reply, Reply, NewState} |
>> %% terminate(Reason, State) -> any()
>> 
>> As an OTP guy, I guess that'll look fairly obvious and familiar to you - check the amqp_gen_consumer documentation for details.
>> 
>>> It should also expect all incoming messages to be meant for it specifically; thus I'd like to be able to filter outgoing messages on the publisher side, rather than incoming messages on the subscriber side, as I wish to reduce overall network traffic.
>> 
>> That's fine, and is really *entirely* up to you. If you wanted to filter on the consumer's side, there's a amqp_selective_consumer module in the Erlang client to help. Filtering outbound messages is surely an application specific issue, and the code to publish is very simple:
>> 
>>   amqp_channel:call(Channel, Method,
>>                     #amqp_msg{props = #'P_basic'{delivery_mode = 2}, %% persistent
>>                               payload = MyPayload}),
>> 
>> 
>> I think outbound filtering is up to your application isn't it? If you consider using federation or shovel to replicate messages across multiple (embedded) broker nodes, then you can automate the filtering by managing the topology which is being replicated such that only specific messages are forwarded via specific queues (or exchanges) - see the federation and/or shovel documentation for details.
>> 
>>> 
>>> My question is; can RabbitMQ do that for me?  That I can find, ZMQ will allow for everything except for the filtering of messages from the publisher.
>>> 
>> 
>> Yes, although you'll need to be a bit more specific about this filtering requirement for me to give you more concrete advice. In general, RabbitMQ offers extremely flexible routing which ought to meet all of your requirements.
>> 
>> Cheers,
>> Tim
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From kpoly84 at gmail.com  Mon Apr 15 11:47:31 2013
From: kpoly84 at gmail.com (Kwstantinos Polydwrou)
Date: Mon, 15 Apr 2013 12:47:31 +0200
Subject: [rabbitmq-discuss] Dead Lettering queries
Message-ID: <CAJM4cw11qLa_C1e99awz_f9Eir=MKbFBtt13Z90AiHZ=b2Q+Qw@mail.gmail.com>

 Hi everyone,


I am trying to set up a DL mechanism but I am unfamiliar with this topic.
So I had a look here http://www.rabbitmq.com/dlx.html.

However, I would like to see some code samples if possible. Can anyone
inform me if any DL code examples/samples are available?

Best regards,
K.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130415/5c47ad07/attachment.htm>

From lee.sylvester at gmail.com  Mon Apr 15 11:49:52 2013
From: lee.sylvester at gmail.com (Lee Sylvester)
Date: Mon, 15 Apr 2013 11:49:52 +0100
Subject: [rabbitmq-discuss] Filtering
In-Reply-To: <8F6D5082-6F99-4AD8-A0BF-D73E60A72579@rabbitmq.com>
References: <30E58CEA-03A7-46DD-8CC5-B1692B611FAC@gmail.com>
	<34B513FC-235E-4A1B-B34C-72FE1B890917@rabbitmq.com>
	<86F7DA38-86DD-4CA7-9F89-F7247D623843@gmail.com>
	<8F6D5082-6F99-4AD8-A0BF-D73E60A72579@rabbitmq.com>
Message-ID: <70EEBCC4-5F96-48E0-87CF-FB508D9BF453@gmail.com>

Hi Tim,

As someone relatively new to Erlang, my answer may be unfounded.  The simple answer is that I have been told to beware hogging the Erlang messaging layer, as too much traffic could restrict the node heartbeat which can cause nodes to disconnect from one another.  The websockets may send many packets per second which, over many connections, would make inter-node messaging the bottleneck.  I'm willing to deal with this, but if such traffic causes fragmentation between Erlang communications, it's yet another obstacle to tackle.

Cheers,
Lee




On 15 Apr 2013, at 11:36, Tim Watson <watson.timothy at gmail.com> wrote:

> Hi Lee,
> 
> I don't want to put you off using rabbit - quite the contrary of course - but I'm intrigued to know why you think good old inter-node erlang message passing won't meet your requirements? Obviously rabbit provides more flexible routing and you can take advantage of varying levels of delivery guarantee, but it doesn't sound like you're planning to take advantage of those, so what benefit is AMQP bringing to your architecture?
> 
> Cheers,
> Tim
> 
> On 15 Apr 2013, at 11:18, Lee Sylvester <lee.sylvester at gmail.com> wrote:
> 
>> Hi Tim,
>> 
>> Thank you, that's great information.  To give you a bit of a clearer picture of what I'm doing;
>> 
>> I have a clusterable node which creates websocket connections using Cowboy and Bullet.  Each websocket connection is stored in Mnesia, so that it can be referenced across the cluster.  As I add more nodes (load balanced), I can handle more connections.  What I want to do is to augment the Erlang messaging layer with an MQ layer so as not to clutter it with too much traffic.  Thus, I can get the PID of a connections process from Mnesia and send a message straight to it over RabbitMQ.  The RabbitMQ connections will be routed based on node name, so I know what node I want to message and what RabbitMQ filter to apply.  As new nodes come online, my Erlang node is setup to request all other nodes to create new RabbitMQ nodes to these new ones and vice versa.
>> 
>> I think what you describe could work very well.
>> 
>> Regards,
>> Lee
>> 
>> 
>> 
>> On 15 Apr 2013, at 10:46, Tim Watson <tim at rabbitmq.com> wrote:
>> 
>>> Hi Lee,
>>> 
>>> Some (hopefully useful) comments inline...
>>> 
>>> On 15 Apr 2013, at 07:30, Lee Sylvester wrote:
>>> 
>>>> So, here's my conundrum.  In my mesh, I need to distribute messages from a node on a single port and receive messages on a single port.
>>> 
>>> An AMQP client can open multiple connections (on discrete ports) and can open multiple channels per connection (multiplexing). A channel can be used to publish or subscribe, or both, though it's probably best to do one or the other per channel IMHO. Setting up a port for receiving and another for producing/publishing messages to/from a broker is very simple.
>>> 
>>>> Each node will connect to one another, like lego. So, both incoming and outgoing ports will have many connections.
>>> 
>>> Are you planning on having a broker act as an intermediary between all the nodes in your mesh? This is certainly possible, though you should be aware that you're introducing a potential bottleneck (from a performance standpoint) and a single point of (communications) failure should the broker's node become unavailable (through network disruption, for example).
>>> 
>>> Another option would be to run the broker embedded in your nodes, providing a communications fabric alongside regular distributed Erlang message passing. It is possible to run the Erlang client alongside a broker in the same node - this is how many RabbitMQ plugins work - and the Erlang client can send/receive messages to a broker using a 'direct mode' connection, that uses direct (internal, Erlang) message passing instead of a network connection. Running a broker embedded still allows you to listen on one or more specific ports, and you can connect to another (RabbitMQ broker embedded within another) node using the Erlang client as usual.
>>> 
>>> Yet another option that opens up if you're embedding RabbitMQ in your nodes is using the Shovel or Federation plugins to completely automate the communications fabric between them, leaving you (the developer) responsible only for handling the client portion of the code within each node - an explanation will follow.
>>> 
>>>> For incoming, I should be able to handle my messages using OTP's handle_info func on the gen_server pattern.
>>> 
>>> This is certainly possible. The Erlang client allows you to register the calling process as a consumer, after which point AMQP messages will arrive in the process' mailbox as regular messages, thus...
>>> 
>>> init(_) ->
>>>  %% inside gen_server's Module:init/1
>>>  amqp_channel:subscribe(Channel,
>>>                         #'basic.consume'{queue    = Queue,
>>>                                          no_local = false,
>>>                                          no_ack   = NoAck},
>>>                         self()),
>>>  {ok, State}.
>>> 
>>> handle_info(#'basic.consume_ok'{}, State) ->
>>>  %% we're good to go....
>>>  {noreply, State};
>>> handle_info({Delivery = #'basic.deliver'{ redelivered = Redelivered },
>>>                    #amqp_msg{payload = Payload}}, State) ->
>>>  State2 = do_something(Payload, Redelivered, State),
>>>  {noreply, State2};
>>> .... etc
>>> 
>>> 
>>> Another option is to use the amqp_gen_consumer behaviour, which allows for a set of callbacks quite similar to a gen_server, viz...
>>> 
>>> %% init(Args) -> {ok, InitialState} | {stop, Reason} | ignore
>>> %% handle_consume(Consume, Sender, State) -> ok_error()
>>> %% handle_consume_ok(ConsumeOk, Consume, State) -> ok_error()
>>> %% handle_cancel(Cancel, State) -> ok_error()
>>> %% handle_cancel_ok(CancelOk, Cancel, State) -> ok_error()
>>> %% handle_deliver(Deliver, Message, State) -> ok_error()
>>> %% handle_info(Info, State) -> ok_error()
>>> %% handle_call(Msg, From, State) -> {reply, Reply, NewState} |
>>> %% terminate(Reason, State) -> any()
>>> 
>>> As an OTP guy, I guess that'll look fairly obvious and familiar to you - check the amqp_gen_consumer documentation for details.
>>> 
>>>> It should also expect all incoming messages to be meant for it specifically; thus I'd like to be able to filter outgoing messages on the publisher side, rather than incoming messages on the subscriber side, as I wish to reduce overall network traffic.
>>> 
>>> That's fine, and is really *entirely* up to you. If you wanted to filter on the consumer's side, there's a amqp_selective_consumer module in the Erlang client to help. Filtering outbound messages is surely an application specific issue, and the code to publish is very simple:
>>> 
>>>  amqp_channel:call(Channel, Method,
>>>                    #amqp_msg{props = #'P_basic'{delivery_mode = 2}, %% persistent
>>>                              payload = MyPayload}),
>>> 
>>> 
>>> I think outbound filtering is up to your application isn't it? If you consider using federation or shovel to replicate messages across multiple (embedded) broker nodes, then you can automate the filtering by managing the topology which is being replicated such that only specific messages are forwarded via specific queues (or exchanges) - see the federation and/or shovel documentation for details.
>>> 
>>>> 
>>>> My question is; can RabbitMQ do that for me?  That I can find, ZMQ will allow for everything except for the filtering of messages from the publisher.
>>>> 
>>> 
>>> Yes, although you'll need to be a bit more specific about this filtering requirement for me to give you more concrete advice. In general, RabbitMQ offers extremely flexible routing which ought to meet all of your requirements.
>>> 
>>> Cheers,
>>> Tim
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From watson.timothy at gmail.com  Mon Apr 15 11:58:55 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 15 Apr 2013 11:58:55 +0100
Subject: [rabbitmq-discuss] Filtering
In-Reply-To: <70EEBCC4-5F96-48E0-87CF-FB508D9BF453@gmail.com>
References: <30E58CEA-03A7-46DD-8CC5-B1692B611FAC@gmail.com>
	<34B513FC-235E-4A1B-B34C-72FE1B890917@rabbitmq.com>
	<86F7DA38-86DD-4CA7-9F89-F7247D623843@gmail.com>
	<8F6D5082-6F99-4AD8-A0BF-D73E60A72579@rabbitmq.com>
	<70EEBCC4-5F96-48E0-87CF-FB508D9BF453@gmail.com>
Message-ID: <1334CFEB-8C91-4498-B2AF-E7FBB162FC5A@rabbitmq.com>

Hi Lee

On 15 Apr 2013, at 11:49, Lee Sylvester <lee.sylvester at gmail.com> wrote:

> The simple answer is that I have been told to beware hogging the Erlang messaging layer, as too much traffic could restrict the node heartbeat which can cause nodes to disconnect from one another.  

This is certainly true. Someone should really patch the distribution protocol to prioritise heartbeats, but that's a different story....

> The websockets may send many packets per second which, over many connections, would make inter-node messaging the bottleneck.  I'm willing to deal with this, but if such traffic causes fragmentation between Erlang communications, it's yet another obstacle to tackle.
> 

That's worth considering, although you might be able to work around chatty comms by batching. But if you really think you'll saturate the network then implementing a solution over AMQP might actually be less effort. Let us know how you get on please! :)

Cheers,
Tim

From watson.timothy at gmail.com  Mon Apr 15 12:25:05 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 15 Apr 2013 12:25:05 +0100
Subject: [rabbitmq-discuss] Multiple threads accessing the RPC queue
In-Reply-To: <a219d7b7-4737-46b5-93ce-943182ad4227@googlegroups.com>
References: <a219d7b7-4737-46b5-93ce-943182ad4227@googlegroups.com>
Message-ID: <88029C24-99F4-4AF4-A1AD-0FE0A3423112@rabbitmq.com>

Hi

On 15 Apr 2013, at 09:58, Chaitanya Jawale <chaitanya.jawale at gmail.com> wrote:

> Now in some cases there are multiple threads tries to put messages in the same RPC queue to perform different actions on the agent in parallel but none gets delivered to the agent(RPC server) and if i do it serially it works. What can be the issue?
> 

It's impossible to say without more information. What client library are you using? How is the reply-to queue configured - does the client do a basic.get on the reply-to queue and could the server be replying to queries out of order and this producing a kind of deadlock?

From emile at rabbitmq.com  Mon Apr 15 14:13:30 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 15 Apr 2013 14:13:30 +0100
Subject: [rabbitmq-discuss] Dead Lettering queries
In-Reply-To: <CAJM4cw11qLa_C1e99awz_f9Eir=MKbFBtt13Z90AiHZ=b2Q+Qw@mail.gmail.com>
References: <CAJM4cw11qLa_C1e99awz_f9Eir=MKbFBtt13Z90AiHZ=b2Q+Qw@mail.gmail.com>
Message-ID: <516BFCFA.3080409@rabbitmq.com>


Hi,

On 15/04/13 11:47, Kwstantinos Polydwrou wrote:
> Can anyone inform me if any DL code examples/samples are available?

There are some examples of use by the Java client in unit tests
(com.rabbitmq.client.test.functional.DeadLetterExchange):

http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/client/test/functional/DeadLetterExchange.java



-Emile






From frederic.cons at gmail.com  Mon Apr 15 14:53:04 2013
From: frederic.cons at gmail.com (=?UTF-8?Q?Fr=C3=A9d=C3=A9ric_Cons?=)
Date: Mon, 15 Apr 2013 06:53:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Disabling connection logs
Message-ID: <faf57ba4-7993-4563-8f1f-42361f3c5762@googlegroups.com>

Hi everyone

I have a cluster of two rabbitmq instances behind a haproxy server.
The connection tests made by haproxy generate a high volume of connection / 
disconnection logs such as : 

 =INFO REPORT==== 15-Apr-2013::00:08:05 ===
accepting AMQP connection <0.9464.45> (192.168.0.151:52341 -> 
192.168.0.151:5672)

=WARNING REPORT==== 15-Apr-2013::00:08:05 ===
closing AMQP connection <0.9464.45> (192.168.0.151:52341 -> 
192.168.0.151:5672):
connection_closed_abruptly

Not a big deal, but quite noisy
I changed by rabbitmq.config file to try to ignore these logs with : 


[
{log_levels, [{connection, error}]}
,
<other configuration items>
].
% EOF

But these messages keep flowing in the logs
Any idea of what I could to to prevent this ? 

Best regards
Fred

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130415/e7fe0298/attachment.htm>

From simon at rabbitmq.com  Mon Apr 15 18:02:09 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 15 Apr 2013 18:02:09 +0100
Subject: [rabbitmq-discuss] Disabling connection logs
In-Reply-To: <faf57ba4-7993-4563-8f1f-42361f3c5762@googlegroups.com>
References: <faf57ba4-7993-4563-8f1f-42361f3c5762@googlegroups.com>
Message-ID: <516C3291.7000902@rabbitmq.com>

On 15/04/13 14:53, Fr?d?ric Cons wrote:
>
> Not a big deal, but quite noisy
> I changed by rabbitmq.config file to try to ignore these logs with :
>
>
> [
> {log_levels, [{connection, error}]}
> ,
> <other configuration items>
> ].
> % EOF
>

log_levels needs to be inside rabbit, e.g.:

[{rabbit, [{log_levels, [{connection, error}]}]}].

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ehberg at gmail.com  Mon Apr 15 22:31:18 2013
From: ehberg at gmail.com (Eric Berg)
Date: Mon, 15 Apr 2013 17:31:18 -0400
Subject: [rabbitmq-discuss] RabbitMQ with many queues
Message-ID: <CAL8idP0qhp5mcM887v9FkRLCSZwbx1MjVdHZ==73FX7K68qoGQ@mail.gmail.com>

I know there has been discussion in the past about limits for queues in a
rabbit cluster, and there is no real hard limit except for what you impose
on yourself via file descriptors and memory (to a degree). I am curious
about those of you who have run Rabbit clusters with many thousands of
queues, how its been performance and management wise.

Our application structure is based on an 'account' and so everything that
needs to be queued needs to be segregated by account because of database
connections. We have a stream of generic change events that flow into the
cluster to a single master exchange and each interested functional area is
an exchange that is bound to the master exchange on a set of event types
via topic routing. Each functional area exchange has a queue for each
account.

Right now this is not a big problem because we have relatively few
functional areas and accounts, but as we grow bigger the number of queues
will grow very quickly. This is why Im curious about others' experiences
with complicated routing in combination with many many queues. Is there an
alternative that I should be considering? We are currently not in
production with this setup, but are very close.

Thanks guys!

- Eric Berg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130415/5cb670c2/attachment.htm>

From saprykin.dmitry at gmail.com  Tue Apr 16 13:01:13 2013
From: saprykin.dmitry at gmail.com (Dmitry Saprykin)
Date: Tue, 16 Apr 2013 16:01:13 +0400
Subject: [rabbitmq-discuss] RabbitMQ Queues memory leak?
In-Reply-To: <CAHWt7w0pDVbews1OWGsJTv3aOOk-K26PEHLBn=F=Yctg6rc41w@mail.gmail.com>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
	<CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
	<CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>
	<CAHWt7w0+H87VoXnSuqhVi6FAsm_PbtEbuvH_H=CckWX6k9sW6g@mail.gmail.com>
	<CAE3HoVTcg54NCD9DmsPuZB8vjvB8HXxg0kLwO2hUtp2hjVBFiw@mail.gmail.com>
	<CAHWt7w0pDVbews1OWGsJTv3aOOk-K26PEHLBn=F=Yctg6rc41w@mail.gmail.com>
Message-ID: <CAHWt7w0xoKZ3v8JpZVrs+b-_NW_u6JqPuNjb5KmAEmn7rf5VmA@mail.gmail.com>

Hello again, Michael

Is there any news about 3.0.4 Queues memory leak bug?
Is there anything interesting in `rabbitmqctl report` I have sent in last
message?
If you need any more information I will provide it ASAP.

Kind regards,
Dmirty Saprykin


On 2 April 2013 12:15, Dmitry Saprykin <saprykin.dmitry at gmail.com> wrote:

> report from master attached to email. Current Queues memory 180 Mb
>
>
> On 2 April 2013 11:49, Michael Klishin <michael.s.klishin at gmail.com>wrote:
>
>> 2013/4/2 Dmitry Saprykin <saprykin.dmitry at gmail.com>
>>
>>> No, just local TCP connections by IP address.
>>
>>
>> Please post `rabbitmqctl report` output.
>>
>> --
>> MK
>>
>> http://github.com/michaelklishin
>> http://twitter.com/michaelklishin
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130416/61cbce55/attachment.htm>

From aberry at sophiacom.fr  Tue Apr 16 13:50:15 2013
From: aberry at sophiacom.fr (Antoine Berry)
Date: Tue, 16 Apr 2013 14:50:15 +0200
Subject: [rabbitmq-discuss] RabbitMQ manager and Idle queues
In-Reply-To: <CAHWt7w0xoKZ3v8JpZVrs+b-_NW_u6JqPuNjb5KmAEmn7rf5VmA@mail.gmail.com>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
	<CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
	<CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>
	<CAHWt7w0+H87VoXnSuqhVi6FAsm_PbtEbuvH_H=CckWX6k9sW6g@mail.gmail.com>
	<CAE3HoVTcg54NCD9DmsPuZB8vjvB8HXxg0kLwO2hUtp2hjVBFiw@mail.gmail.com>
	<CAHWt7w0pDVbews1OWGsJTv3aOOk-K26PEHLBn=F=Yctg6rc41w@mail.gmail.com>
	<CAHWt7w0xoKZ3v8JpZVrs+b-_NW_u6JqPuNjb5KmAEmn7rf5VmA@mail.gmail.com>
Message-ID: <516D4907.2050109@sophiacom.fr>

Hello everybody,

We have a little problem with the rabbitMQ management plugin. Basically 
we would want to delete the Idle queues. So to do that we send a http 
request to the rabbitMQ management plugin REST API, to get the value of 
the "last_event" field.
But we always get last_event = now, even though we haven't used  the 
queue nor the virtual host in general for a day... Plus these queues 
don't even have any consumers, and the application is not even running. 
And all the queues are marked as active in the web management page too.

Here are an exemple of request, and a screen shot of the web manager 
page, which shows a queue without any consumers but marked as active :

HTTP/1.1 200 OK
Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
Date: Tue, 16 Apr 2013 09:54:44 GMT
Content-Type: application/json
Content-Length: 909
Cache-Control: no-cache

{"policy":"","exclusive_consumer_tag":"","messages_ready":0,"messages_unacknowledged":0,"messages":0,"consumers":0,"active_consumers":0,"memory":44356,"backing_queue_status":{"q1":0,"q2":0,"delta""delta","undefined",0,"undefined"],"q3":0,"q4":0,"len":0,"pending_acks":0,"target_ram_count":"infinity","ram_msg_count":0,"ram_ack_count":0,"next_seq_id":66,"persistent_count":0,"avg_ingress_rate":0.0,"avg_egress_rate":0.0,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},"messages_details":{"rate":0.0,"interval":10001924,"last_event":1366106079385},"messages_ready_details":{"rate":0.0,"interval":10001924,"last_event":1366106079385},"messages_unacknowledged_details":{"rate":0.0,"interval":10001924,"last_event":1366106079385},"consumer_details"],"name":"theQueue","vhost":"myHost","durable":true,"auto_delete":false,"arguments":{},"node":"rabbit at myServer"}

Does anybody ever had this kind of problem? We're using RabbitMQ 3.0.1, 
with the java client.

Thank you.


From aberry at sophiacom.fr  Tue Apr 16 13:51:56 2013
From: aberry at sophiacom.fr (Antoine Berry)
Date: Tue, 16 Apr 2013 14:51:56 +0200
Subject: [rabbitmq-discuss] RabbitMQ manager and Idle queues
In-Reply-To: <516D4907.2050109@sophiacom.fr>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
	<CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
	<CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>
	<CAHWt7w0+H87VoXnSuqhVi6FAsm_PbtEbuvH_H=CckWX6k9sW6g@mail.gmail.com>
	<CAE3HoVTcg54NCD9DmsPuZB8vjvB8HXxg0kLwO2hUtp2hjVBFiw@mail.gmail.com>
	<CAHWt7w0pDVbews1OWGsJTv3aOOk-K26PEHLBn=F=Yctg6rc41w@mail.gmail.com>
	<CAHWt7w0xoKZ3v8JpZVrs+b-_NW_u6JqPuNjb5KmAEmn7rf5VmA@mail.gmail.com>
	<516D4907.2050109@sophiacom.fr>
Message-ID: <516D496C.2020607@sophiacom.fr>

And the screenshot I was talking about...

Le 16/04/13 14:50, Antoine Berry a ?crit :
> Hello everybody,
>
> We have a little problem with the rabbitMQ management plugin. 
> Basically we would want to delete the Idle queues. So to do that we 
> send a http request to the rabbitMQ management plugin REST API, to get 
> the value of the "last_event" field.
> But we always get last_event = now, even though we haven't used the 
> queue nor the virtual host in general for a day... Plus these queues 
> don't even have any consumers, and the application is not even 
> running. And all the queues are marked as active in the web management 
> page too.
>
> Here are an exemple of request, and a screen shot of the web manager 
> page, which shows a queue without any consumers but marked as active :
>
> HTTP/1.1 200 OK
> Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
> Date: Tue, 16 Apr 2013 09:54:44 GMT
> Content-Type: application/json
> Content-Length: 909
> Cache-Control: no-cache
>
> {"policy":"","exclusive_consumer_tag":"","messages_ready":0,"messages_unacknowledged":0,"messages":0,"consumers":0,"active_consumers":0,"memory":44356,"backing_queue_status":{"q1":0,"q2":0,"delta""delta","undefined",0,"undefined"],"q3":0,"q4":0,"len":0,"pending_acks":0,"target_ram_count":"infinity","ram_msg_count":0,"ram_ack_count":0,"next_seq_id":66,"persistent_count":0,"avg_ingress_rate":0.0,"avg_egress_rate":0.0,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},"messages_details":{"rate":0.0,"interval":10001924,"last_event":1366106079385},"messages_ready_details":{"rate":0.0,"interval":10001924,"last_event":1366106079385},"messages_unacknowledged_details":{"rate":0.0,"interval":10001924,"last_event":1366106079385},"consumer_details"],"name":"theQueue","vhost":"myHost","durable":true,"auto_delete":false,"arguments":{},"node":"rabbit at myServer"} 
>
>
> Does anybody ever had this kind of problem? We're using RabbitMQ 
> 3.0.1, with the java client.
>
> Thank you.
>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screen Shot 2013-04-16 at 11.50.41.png
Type: image/png
Size: 89841 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130416/a4e52beb/attachment.png>

From simon at rabbitmq.com  Tue Apr 16 14:00:12 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 16 Apr 2013 14:00:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ manager and Idle queues
In-Reply-To: <516D4907.2050109@sophiacom.fr>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
	<CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
	<CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>
	<CAHWt7w0+H87VoXnSuqhVi6FAsm_PbtEbuvH_H=CckWX6k9sW6g@mail.gmail.com>
	<CAE3HoVTcg54NCD9DmsPuZB8vjvB8HXxg0kLwO2hUtp2hjVBFiw@mail.gmail.com>
	<CAHWt7w0pDVbews1OWGsJTv3aOOk-K26PEHLBn=F=Yctg6rc41w@mail.gmail.com>
	<CAHWt7w0xoKZ3v8JpZVrs+b-_NW_u6JqPuNjb5KmAEmn7rf5VmA@mail.gmail.com>
	<516D4907.2050109@sophiacom.fr>
Message-ID: <516D4B5C.3020606@rabbitmq.com>

Hi. There was a bug introduced in 3.0.0 and fixed in 3.0.2 where queues 
would sometimes not hibernate when idle (which is what drives those 
"last_event" fields and the "active" flag). So the short answer is 
"please upgrade".

But you should be cautious about driving anything from those 
"last_event" fields anyway - you're essentially looking at when the 
queue process last woke up, and something as trivial as "rabbitmqctl 
list_queues" will wake the queue process up.

You might want to look at http://www.rabbitmq.com/ttl.html#queue-ttl as 
an alternative.

Cheers, Simon

On 16/04/13 13:50, Antoine Berry wrote:
> Hello everybody,
>
> We have a little problem with the rabbitMQ management plugin. Basically
> we would want to delete the Idle queues. So to do that we send a http
> request to the rabbitMQ management plugin REST API, to get the value of
> the "last_event" field.
> But we always get last_event = now, even though we haven't used  the
> queue nor the virtual host in general for a day... Plus these queues
> don't even have any consumers, and the application is not even running.
> And all the queues are marked as active in the web management page too.
>
> Here are an exemple of request, and a screen shot of the web manager
> page, which shows a queue without any consumers but marked as active :
>
> HTTP/1.1 200 OK
> Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
> Date: Tue, 16 Apr 2013 09:54:44 GMT
> Content-Type: application/json
> Content-Length: 909
> Cache-Control: no-cache
>
> {"policy":"","exclusive_consumer_tag":"","messages_ready":0,"messages_unacknowledged":0,"messages":0,"consumers":0,"active_consumers":0,"memory":44356,"backing_queue_status":{"q1":0,"q2":0,"delta""delta","undefined",0,"undefined"],"q3":0,"q4":0,"len":0,"pending_acks":0,"target_ram_count":"infinity","ram_msg_count":0,"ram_ack_count":0,"next_seq_id":66,"persistent_count":0,"avg_ingress_rate":0.0,"avg_egress_rate":0.0,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},"messages_details":{"rate":0.0,"interval":10001924,"last_event":1366106079385},"messages_ready_details":{"rate":0.0,"interval":10001924,"last_event":1366106079385},"messages_unacknowledged_details":{"rate":0.0,"interval":10001924,"last_event":1366106079385},"consumer_details"],"name":"theQueue","vhost":"myHost","durable":true,"auto_delete":false,"arguments":{},"node":"rabbit at myServer"}
>
>
> Does anybody ever had this kind of problem? We're using RabbitMQ 3.0.1,
> with the java client.
>
> Thank you.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From aberry at sophiacom.fr  Tue Apr 16 14:18:51 2013
From: aberry at sophiacom.fr (Antoine Berry)
Date: Tue, 16 Apr 2013 15:18:51 +0200
Subject: [rabbitmq-discuss] RabbitMQ manager and Idle queues
In-Reply-To: <516D4B5C.3020606@rabbitmq.com>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
	<CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
	<CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>
	<CAHWt7w0+H87VoXnSuqhVi6FAsm_PbtEbuvH_H=CckWX6k9sW6g@mail.gmail.com>
	<CAE3HoVTcg54NCD9DmsPuZB8vjvB8HXxg0kLwO2hUtp2hjVBFiw@mail.gmail.com>
	<CAHWt7w0pDVbews1OWGsJTv3aOOk-K26PEHLBn=F=Yctg6rc41w@mail.gmail.com>
	<CAHWt7w0xoKZ3v8JpZVrs+b-_NW_u6JqPuNjb5KmAEmn7rf5VmA@mail.gmail.com>
	<516D4907.2050109@sophiacom.fr> <516D4B5C.3020606@rabbitmq.com>
Message-ID: <516D4FBB.5000602@sophiacom.fr>

Hi Simon,

Thank you for the quick answer. We will upgrade !
It was in the patch note indeed, but we hadn't seen it.
About the queue ttl, we saw it too, but the problem is that it doesn't 
seem to check if there still are some messages in the queue, and no 
consumer on it (for exemple), so it will be deleted anyway. Or that's 
not the behavior we wanted, if we understood it well.

Cheers

Antoine

Le 16/04/13 15:00, Simon MacMullen a ?crit :
> Hi. There was a bug introduced in 3.0.0 and fixed in 3.0.2 where 
> queues would sometimes not hibernate when idle (which is what drives 
> those "last_event" fields and the "active" flag). So the short answer 
> is "please upgrade".
>
> But you should be cautious about driving anything from those 
> "last_event" fields anyway - you're essentially looking at when the 
> queue process last woke up, and something as trivial as "rabbitmqctl 
> list_queues" will wake the queue process up.
>
> You might want to look at http://www.rabbitmq.com/ttl.html#queue-ttl 
> as an alternative.
>
> Cheers, Simon
>
> On 16/04/13 13:50, Antoine Berry wrote:
>> Hello everybody,
>>
>> We have a little problem with the rabbitMQ management plugin. Basically
>> we would want to delete the Idle queues. So to do that we send a http
>> request to the rabbitMQ management plugin REST API, to get the value of
>> the "last_event" field.
>> But we always get last_event = now, even though we haven't used the
>> queue nor the virtual host in general for a day... Plus these queues
>> don't even have any consumers, and the application is not even running.
>> And all the queues are marked as active in the web management page too.
>>
>> Here are an exemple of request, and a screen shot of the web manager
>> page, which shows a queue without any consumers but marked as active :
>>
>> HTTP/1.1 200 OK
>> Server: MochiWeb/1.1 WebMachine/1.9.0 (someone had painted it blue)
>> Date: Tue, 16 Apr 2013 09:54:44 GMT
>> Content-Type: application/json
>> Content-Length: 909
>> Cache-Control: no-cache
>>
>> {"policy":"","exclusive_consumer_tag":"","messages_ready":0,"messages_unacknowledged":0,"messages":0,"consumers":0,"active_consumers":0,"memory":44356,"backing_queue_status":{"q1":0,"q2":0,"delta""delta","undefined",0,"undefined"],"q3":0,"q4":0,"len":0,"pending_acks":0,"target_ram_count":"infinity","ram_msg_count":0,"ram_ack_count":0,"next_seq_id":66,"persistent_count":0,"avg_ingress_rate":0.0,"avg_egress_rate":0.0,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},"messages_details":{"rate":0.0,"interval":10001924,"last_event":1366106079385},"messages_ready_details":{"rate":0.0,"interval":10001924,"last_event":1366106079385},"messages_unacknowledged_details":{"rate":0.0,"interval":10001924,"last_event":1366106079385},"consumer_details"],"name":"theQueue","vhost":"myHost","durable":true,"auto_delete":false,"arguments":{},"node":"rabbit at myServer"} 
>>
>>
>>
>> Does anybody ever had this kind of problem? We're using RabbitMQ 3.0.1,
>> with the java client.
>>
>> Thank you.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


From ilya at segment.io  Tue Apr 16 17:53:06 2013
From: ilya at segment.io (Ilya Volodarsky)
Date: Tue, 16 Apr 2013 09:53:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Growing Memory Use and Queues
Message-ID: <ee8bca94-b015-4928-a1f3-7e258da28207@googlegroups.com>

We're having some strange memory problems in our rabbit that looks like 
it's attributed to our queues. We're running Rabbit 3.0.1 in production, 
here's the management plugin overview: http://cl.ly/image/0z25241k320Q

As you can see, we have almost no messages queued, but the server is using 
5.7GB of active memory. Here's the memory breakdown of the same node: 
http://cl.ly/image/03381l2M3v2p

The broker claims to be using 4.8 GB to store the 4454 queues. That's 
strange because most of the queues claim to be using 14kb - 23kb, which 
AFAIK, is the in the correct range for an idle queue. An average of 20kb 
per queue * 4500 queues = 90 MB, not 4800 MB (53 times bigger). 

Here's the JSON description of a queue from the /queues call:

{"memory":14624,"idle_since":"2013-04-15 
22:45:20","policy":"","exclusive_consumer_tag":"","messages_ready":0,"messages_unacknowledged":0,"messages":0,"consumers":4,"active_consumers":4,"backing_queue_status":{"q1":0,"q2":0,"delta":["delta","undefined",0,"undefined"],"q3":0,"q4":0,"len":0,"pending_acks":0,"target_ram_count":0,"ram_msg_count":0,"ram_ack_count":0,"next_seq_id":0,"persistent_count":0,"avg_ingress_rate":0.0,"avg_egress_rate":0.0,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},"messages_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"messages_ready_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"messages_unacknowledged_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"name":"Ingestion.1899vw88el","vhost":"/segment","durable":true,"auto_delete":false,"arguments":{},"node":"rabbit at rabbit2"}

A few things to note: we have 4 servers subscribing to every queue, and 
because of the RMQ client (node-amqp) we're using, it creates a channel per 
subscription. I realize that's not ideal and we'll be fixing the client to 
make multiple subscriptions per channel, but either way, the broker reports 
only 350 MB of the memory use coming from the connections vs. 4.8 GB for 
queues. 

The broker has also been up for 76 days without downtime, so maybe there's 
some kind of memory leak? We're seeing the memory go up over time. 

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130416/99e2cc54/attachment.htm>

From johngyates at hotmail.com  Tue Apr 16 19:27:44 2013
From: johngyates at hotmail.com (John)
Date: Tue, 16 Apr 2013 11:27:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Handling server connection failures
Message-ID: <1366136864160-26040.post@n5.nabble.com>

Hi,

I am looking for some advice on how best to handle connection failures
within my C#.NET test client using rabbitMQ 3.0.4.

I have read http://www.rabbitmq.com/consumer-cancel.html but I am struggling
to understand how to implement this exactly and also confused as to whether
this is the best way to proceed for the consumer to detect when a
subscription has failed and requires a re-subscription to an alternative
node in the cluster.

If I stop my node to which my client is connected to when it is subscribing
I receive the OperationInterruptedException exception but is this an
acceptable and consistent approach for detecting when the connection to the
node has been lost ?

Appreciate any assistance in this area.

Thanks



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Handling-server-connection-failures-tp26040.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matt at nextdoor.com  Tue Apr 16 22:58:44 2013
From: matt at nextdoor.com (Matt Wise)
Date: Tue, 16 Apr 2013 14:58:44 -0700
Subject: [rabbitmq-discuss] 3.0.4 extremely unstable in production...?
In-Reply-To: <516BCAA2.7060504@rabbitmq.com>
References: <a3b2aa1d-b3f7-4093-9047-00bb579179c3@googlegroups.com>
	<516BC567.8020602@rabbitmq.com> <516BCAA2.7060504@rabbitmq.com>
Message-ID: <51774816-5095-4EA4-9130-F764C83D2A48@nextdoor.com>

Interesting... We are still running one node in us-west-1a, and one in us-west-1c. Today alone we saw 3 network glitches on the node in us-west-1a where it became unable to connect to remote services in other datacenters. Obviously the hardware or rack that machine is living on is having problems.

The interesting part though is that RabbitMQ did not seem to report a network partition during these events now that we're running 2.8.5 and only two nodes instead of three. I'm still digging through the logs to see if there were other interruptions, but it still feels like the code is either:
  a) more stable with 2 nodes
  b) more fault-tolerant in 2.8.5 than it is in 3.0.4

--Matt


On Apr 15, 2013, at 2:38 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> To add to what Emile said: the only difference between partition handling in 2.x and 3.x is that 3.x will show a big red warning in management when one has occurred whereas 2.x will stay silent. If you still have logs from the 2.x days you might want to grep for "running_partitioned_network" - I suspect you will find some matches.
> 
> The next release, 3.1 will have some features around automatic healing of network partitions.
> 
> Cheers, Simon
> 
> On 15/04/2013 10:16, Emile Joubert wrote:
>> 
>> Hi,
>> 
>> On 12/04/13 19:36, Matt Wise wrote:
>>> Since creating the new server farm though we've had 3 outages. In the
>>> first two outages we received a Network Partition Split, and effectively
>>> all 3 of the systems decided to run their own queues independently of
>>> the other servers. This was the first time we'd ever seen this failure,
>>> ever. In the most recent failure we had 2 machines split off, and the
>>> 3rd rabbitmq service effectively became unresponsive entirely.
>> 
>> Versions 2.8.x and 3.0.x are equally susceptible to partitions. You can
>> confirm this experimentally by setting up a cluster of v2.8.x nodes and
>> interrupting connectivity for twice the net_ticktime (60s by default).
>> 
>> See https://www.rabbitmq.com/partitions.html
>> 
>>> Up until recently though I had felt extremely comfortable with
>>> RabbitMQ's clustering technology and reliability... now ... not so much.
>>> Has anyone else seen similar behaviors? Is it simply due to the fact
>>> that we're running cross-zone now in Amazon, or is it more likely the 3
>>> servers that caused the problem? Or the 3.0.x upgrade?
>> 
>> A network outage coincided with the period when nodes were running
>> v3.0.4. The network interruption is the cause of the partition rather
>> than the broker version.
>> 
>> At the time of writing RabbitMQ clustering does not tolerate network
>> partitions well, so it should not be used over a WAN. The shovel or
>> federation plugins are better solutions for that case.
>> 
>> See http://www.rabbitmq.com/clustering.html
>> 
>> 
>> 
>> -Emile
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 


From emile at rabbitmq.com  Wed Apr 17 09:22:57 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 17 Apr 2013 09:22:57 +0100
Subject: [rabbitmq-discuss] Handling server connection failures
In-Reply-To: <1366136864160-26040.post@n5.nabble.com>
References: <1366136864160-26040.post@n5.nabble.com>
Message-ID: <516E5BE1.1010901@rabbitmq.com>


Hi,


On 16/04/13 19:27, John wrote:

> I am looking for some advice on how best to handle connection failures
> within my C#.NET test client using rabbitMQ 3.0.4.

> I have read http://www.rabbitmq.com/consumer-cancel.html 

If your client is connected to an HA cluster then it may receive
basic.cancel notifications, as explained in that link.

If your client is connected to any broker then it should also be
prepared to accept connection errors and channel errors. The
ExceptionTest sample that ships with the .NET library illustrates.
Also see the ShutdownProtocols in section 4 of the User Guide:

http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v3.0.4/rabbitmq-dotnet-client-3.0.4-user-guide.pdf


-Emile



From emile at rabbitmq.com  Wed Apr 17 09:32:01 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 17 Apr 2013 09:32:01 +0100
Subject: [rabbitmq-discuss] Growing Memory Use and Queues
In-Reply-To: <ee8bca94-b015-4928-a1f3-7e258da28207@googlegroups.com>
References: <ee8bca94-b015-4928-a1f3-7e258da28207@googlegroups.com>
Message-ID: <516E5E01.5060603@rabbitmq.com>



Hi,

On 16/04/13 17:53, Ilya Volodarsky wrote:
> The broker claims to be using 4.8 GB to store the 4454 queues. That's
> strange because most of the queues claim to be using 14kb - 23kb,

Are you sure all the queues are in that range? It would only take a few
outliers to explain the total.

> {"memory":14624,

What do you get when you add the memory for all the queues?



-Emile

From Dirk.Plate at holidaycheck.com  Wed Apr 17 09:57:35 2013
From: Dirk.Plate at holidaycheck.com (Dirk Plate)
Date: Wed, 17 Apr 2013 08:57:35 +0000
Subject: [rabbitmq-discuss] Hanging connections/channels after crash
Message-ID: <1617278010F36646BFBD8AB81D86717D0723CA0B@exmailbox3.hc.lan>

Hello,
we have a cluster of three RabbitMQs (3.0.1). After having too many unacked messages (because of an error on client side) we ran into a memory error ("Cannot allocate 1167696400 bytes of memory (of type "old_heap")".
Now the management plugin shows "blocked" and "blocking" connections. Additional one of these connections has a channel with 1.6m unacked messages. These connections and channels are not displayed when calling "rabbitmqctl list_connections" or "rabbitmqctl list_channels"!
These connections/channels survived the restart of the client server and the RabbitMQ server.
Closing the connection with the management plugin results in this error:

{throw,{error,{not_a_connection_pid,<0.449.0>}},       [{rabbit_networking,close_connection,2},        {rabbit_mgmt_wm_connection,delete_resource,2},        {webmachine_resource,resource_call,3},        {webmachine_resource,do,3},        {webmachine_decision_core,resource_call,1},        {webmachine_decision_core,decision,1},        {webmachine_decision_core,handle_request,2},        {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}

This is the ouput of the rest client for one of these connections (ip addresses censored):

    {
       "recv_oct": 636365,
       "recv_cnt": 949,
       "send_oct": 1696,
       "send_cnt": 164,
       "send_pend": 0,
       "state": "blocked",
       "last_blocked_by": "resource",
       "last_blocked_age": 1.251632,
       "channels": 5,
       "recv_oct_details":
       {
           "rate": 0,
           "interval": 32663327,
           "last_event": 1365522007990
       },
       "send_oct_details":
       {
           "rate": 0,
           "interval": 32663327,
           "last_event": 1365522007990
       },
       "type": "network",
       "node": "m12n-production at rabbitmq1",
       "name": "###.##.1.102:13353 -> ###.##.1.70:5672",
       "port": 5672,
       "peer_port": 13353,
       "host": "###.##.1.70",
       "peer_host": "###.##.1.102",
       "ssl": false,
       "peer_cert_subject": "",
       "peer_cert_issuer": "",
       "peer_cert_validity": "",
       "auth_mechanism": "PLAIN",
       "ssl_protocol": "",
       "ssl_key_exchange": "",
       "ssl_cipher": "",
       "ssl_hash": "",
       "protocol": "AMQP 0-9-1",
       "user": "m12n",
       "vhost": "prod",
       "timeout": 30,
       "frame_max": 131072,
       "client_properties":
       {
           "product": "RabbitMQ",
           "information": "Licensed under the MPL. See http://www.rabbitmq.com/",
           "platform": "Java",
           "capabilities":
           {
               "exchange_exchange_bindings": true,
               "consumer_cancel_notify": true,
               "basic.nack": true,
               "publisher_confirms": true
           },
           "copyright": "Copyright (C) 2007-2012 VMware, Inc.",
           "version": "3.0.1"
       }
    }

How can we kill these connections/channels?

Greetings, Dirk


From johngyates at hotmail.com  Wed Apr 17 10:06:13 2013
From: johngyates at hotmail.com (John)
Date: Wed, 17 Apr 2013 02:06:13 -0700 (PDT)
Subject: [rabbitmq-discuss] Handling server connection failures
In-Reply-To: <516E5BE1.1010901@rabbitmq.com>
References: <1366136864160-26040.post@n5.nabble.com>
	<516E5BE1.1010901@rabbitmq.com>
Message-ID: <1366189573598-26045.post@n5.nabble.com>

Thanks Emile,

Do you have any C# examples of how to configure and handle the basic.cancel
notification ?

I have read the link but I am still confused about how we set this property
and exactly how we would expect to receive the notification so any examples
would really help.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Handling-server-connection-failures-tp26040p26045.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Wed Apr 17 10:28:41 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 17 Apr 2013 10:28:41 +0100
Subject: [rabbitmq-discuss] Handling server connection failures
In-Reply-To: <1366189573598-26045.post@n5.nabble.com>
References: <1366136864160-26040.post@n5.nabble.com>
	<516E5BE1.1010901@rabbitmq.com>
	<1366189573598-26045.post@n5.nabble.com>
Message-ID: <516E6B49.2040101@rabbitmq.com>

On 17/04/13 10:06, John wrote:
> Do you have any C# examples of how to configure and handle the basic.cancel
> notification ?

I don't have sample code but see IBasicConsumer.HandleBasicCancel().



From simon at rabbitmq.com  Wed Apr 17 10:33:41 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 17 Apr 2013 10:33:41 +0100
Subject: [rabbitmq-discuss] Hanging connections/channels after crash
In-Reply-To: <1617278010F36646BFBD8AB81D86717D0723CA0B@exmailbox3.hc.lan>
References: <1617278010F36646BFBD8AB81D86717D0723CA0B@exmailbox3.hc.lan>
Message-ID: <516E6C75.2000302@rabbitmq.com>

Hi.

These connections / channels do not exist. You're seeing a bug in the 
management plugin where it will retain information about connections and 
channels that were alive on a cluster node when it crashed.

This bug was fixed in RabbitMQ 3.0.3.

Cheers, Simon

On 17/04/13 09:57, Dirk Plate wrote:
> Hello,
> we have a cluster of three RabbitMQs (3.0.1). After having too many unacked messages (because of an error on client side) we ran into a memory error ("Cannot allocate 1167696400 bytes of memory (of type "old_heap")".
> Now the management plugin shows "blocked" and "blocking" connections. Additional one of these connections has a channel with 1.6m unacked messages. These connections and channels are not displayed when calling "rabbitmqctl list_connections" or "rabbitmqctl list_channels"!
> These connections/channels survived the restart of the client server and the RabbitMQ server.
> Closing the connection with the management plugin results in this error:
>
> {throw,{error,{not_a_connection_pid,<0.449.0>}},       [{rabbit_networking,close_connection,2},        {rabbit_mgmt_wm_connection,delete_resource,2},        {webmachine_resource,resource_call,3},        {webmachine_resource,do,3},        {webmachine_decision_core,resource_call,1},        {webmachine_decision_core,decision,1},        {webmachine_decision_core,handle_request,2},        {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}
>
> This is the ouput of the rest client for one of these connections (ip addresses censored):
>
>      {
>         "recv_oct": 636365,
>         "recv_cnt": 949,
>         "send_oct": 1696,
>         "send_cnt": 164,
>         "send_pend": 0,
>         "state": "blocked",
>         "last_blocked_by": "resource",
>         "last_blocked_age": 1.251632,
>         "channels": 5,
>         "recv_oct_details":
>         {
>             "rate": 0,
>             "interval": 32663327,
>             "last_event": 1365522007990
>         },
>         "send_oct_details":
>         {
>             "rate": 0,
>             "interval": 32663327,
>             "last_event": 1365522007990
>         },
>         "type": "network",
>         "node": "m12n-production at rabbitmq1",
>         "name": "###.##.1.102:13353 -> ###.##.1.70:5672",
>         "port": 5672,
>         "peer_port": 13353,
>         "host": "###.##.1.70",
>         "peer_host": "###.##.1.102",
>         "ssl": false,
>         "peer_cert_subject": "",
>         "peer_cert_issuer": "",
>         "peer_cert_validity": "",
>         "auth_mechanism": "PLAIN",
>         "ssl_protocol": "",
>         "ssl_key_exchange": "",
>         "ssl_cipher": "",
>         "ssl_hash": "",
>         "protocol": "AMQP 0-9-1",
>         "user": "m12n",
>         "vhost": "prod",
>         "timeout": 30,
>         "frame_max": 131072,
>         "client_properties":
>         {
>             "product": "RabbitMQ",
>             "information": "Licensed under the MPL. See http://www.rabbitmq.com/",
>             "platform": "Java",
>             "capabilities":
>             {
>                 "exchange_exchange_bindings": true,
>                 "consumer_cancel_notify": true,
>                 "basic.nack": true,
>                 "publisher_confirms": true
>             },
>             "copyright": "Copyright (C) 2007-2012 VMware, Inc.",
>             "version": "3.0.1"
>         }
>      }
>
> How can we kill these connections/channels?
>
> Greetings, Dirk
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Apr 17 11:04:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 17 Apr 2013 11:04:31 +0100
Subject: [rabbitmq-discuss] Hanging connections/channels after crash
In-Reply-To: <1617278010F36646BFBD8AB81D86717D0723CA3B@exmailbox3.hc.lan>
References: <1617278010F36646BFBD8AB81D86717D0723CA0B@exmailbox3.hc.lan>,
	<516E6C75.2000302@rabbitmq.com>
	<1617278010F36646BFBD8AB81D86717D0723CA3B@exmailbox3.hc.lan>
Message-ID: <516E73AF.4090803@rabbitmq.com>

On 17/04/13 10:48, Dirk Plate wrote:
> Hi,
> thanks for this information.
> Is it possible to reset the management plugin (where is this information stored?).

Hi. This information lives in the management statistics database. You 
can kill that process with e.g.:

$ rabbitmqctl eval 'exit(global:whereis_name(rabbit_mgmt_db), bang).'

and it will start up again and reconstruct all its data without the 
phantom connections / channels.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Apr 17 16:23:28 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 17 Apr 2013 16:23:28 +0100
Subject: [rabbitmq-discuss] RabbitMQ with many queues
In-Reply-To: <CAL8idP0qhp5mcM887v9FkRLCSZwbx1MjVdHZ==73FX7K68qoGQ@mail.gmail.com>
References: <CAL8idP0qhp5mcM887v9FkRLCSZwbx1MjVdHZ==73FX7K68qoGQ@mail.gmail.com>
Message-ID: <516EBE70.6070403@rabbitmq.com>


Hi Eric,

On 15/04/13 22:31, Eric Berg wrote:
> I am curious about those of you who have run Rabbit clusters with
> many thousands of queues

I have only used that many queues under testing conditions, rather than
production.

This is more relevant if you are using non-HA queues, but can be
relevant even for HA queues that are not mirrored to all nodes: make
sure you achieve a balanced load by not defining all queues on a single
node.

Make sure you provision adequate resources. It is possible to declare an
enormous number of idle queues without difficulty, but the broker will
grind to a halt if many queues on an under-resourced node start
consuming CPU and RAM. Use realistic workloads to estimate the required
resources.

Use a sensible naming scheme for queues so that you can easily manage a
subset. Consider binding queues via internal exchanges if that makes the
management of bindings easier.

Don't perform "rabbitmqctl list_queues" in a tight loop for monitoring
as this will generate significant load and slow down the broker.



Please report back anything you learn from your experience that other
may benefit from.


-Emile








From Michael.Laing at nytimes.com  Wed Apr 17 16:33:01 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Wed, 17 Apr 2013 11:33:01 -0400
Subject: [rabbitmq-discuss] 3.0.4 extremely unstable in production...?
In-Reply-To: <51774816-5095-4EA4-9130-F764C83D2A48@nextdoor.com>
Message-ID: <CD942A15.90D3%Michael.Laing@nytimes.com>

We run a combination of clustered (across zones) and shovel-connected
nodes in several regions, mostly m1 smalls but bigger ones too.

We've experienced one partition in the last few months, a 2/1. Partitions
occur  because an OTP heartbeat cannot be processed within the time frame
set by the net_ticktime OTP parameter, as I recall. In EC2 that can occur
for several reasons, most commonly because the shared network resource is
being dominated by something else. In our case we discovered that due to
an oversight, the three instances were simultaneously engaged in high IO
activity unrelated to rabbitmq. A good way to possibly trigger this state
would be to simultaneously snapshot EBS disks attached to the instances,
especially if they are large.

To mitigate against this you can: 1) use larger instances with more IO
capability (bigger hose), more cores, and more memory (more schlitz) - we
may do this; 2) cluster with fewer instances so there is less 'internal
work' going on - we cluster w no more than 3, then scale up as needed (at
the core - the retail layer scales out using shovels); 3) architecturally
lighten the load by: avoiding persistent messages, never using
transactions, offloading large message bodies and passing references
instead (we use S3, cassandra, DynamoDB), emphasizing federation/shovels
for broad deployments, tolerating duplicate messages, keeping queues
short, etc.

In your case, running celery, I would suggest: run 2 instances; make them
m1 large or xlarge; use us-west-2 instead of us-west1 if you can (cheaper,
newer, bigger); if possible with celery and your app designs, avoid
persistent messages - and do the other stuff in 3) above.

Michael Laing
NYTimes

On 4/16/13 5:58 PM, "Matt Wise" <matt at nextdoor.com> wrote:

>Interesting... We are still running one node in us-west-1a, and one in
>us-west-1c. Today alone we saw 3 network glitches on the node in
>us-west-1a where it became unable to connect to remote services in other
>datacenters. Obviously the hardware or rack that machine is living on is
>having problems.
>
>The interesting part though is that RabbitMQ did not seem to report a
>network partition during these events now that we're running 2.8.5 and
>only two nodes instead of three. I'm still digging through the logs to
>see if there were other interruptions, but it still feels like the code
>is either:
>  a) more stable with 2 nodes
>  b) more fault-tolerant in 2.8.5 than it is in 3.0.4
>
>--Matt
>
>
>On Apr 15, 2013, at 2:38 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
>
>> To add to what Emile said: the only difference between partition
>>handling in 2.x and 3.x is that 3.x will show a big red warning in
>>management when one has occurred whereas 2.x will stay silent. If you
>>still have logs from the 2.x days you might want to grep for
>>"running_partitioned_network" - I suspect you will find some matches.
>> 
>> The next release, 3.1 will have some features around automatic healing
>>of network partitions.
>> 
>> Cheers, Simon
>> 
>> On 15/04/2013 10:16, Emile Joubert wrote:
>>> 
>>> Hi,
>>> 
>>> On 12/04/13 19:36, Matt Wise wrote:
>>>> Since creating the new server farm though we've had 3 outages. In the
>>>> first two outages we received a Network Partition Split, and
>>>>effectively
>>>> all 3 of the systems decided to run their own queues independently of
>>>> the other servers. This was the first time we'd ever seen this
>>>>failure,
>>>> ever. In the most recent failure we had 2 machines split off, and the
>>>> 3rd rabbitmq service effectively became unresponsive entirely.
>>> 
>>> Versions 2.8.x and 3.0.x are equally susceptible to partitions. You can
>>> confirm this experimentally by setting up a cluster of v2.8.x nodes and
>>> interrupting connectivity for twice the net_ticktime (60s by default).
>>> 
>>> See https://www.rabbitmq.com/partitions.html
>>> 
>>>> Up until recently though I had felt extremely comfortable with
>>>> RabbitMQ's clustering technology and reliability... now ... not so
>>>>much.
>>>> Has anyone else seen similar behaviors? Is it simply due to the fact
>>>> that we're running cross-zone now in Amazon, or is it more likely the
>>>>3
>>>> servers that caused the problem? Or the 3.0.x upgrade?
>>> 
>>> A network outage coincided with the period when nodes were running
>>> v3.0.4. The network interruption is the cause of the partition rather
>>> than the broker version.
>>> 
>>> At the time of writing RabbitMQ clustering does not tolerate network
>>> partitions well, so it should not be used over a WAN. The shovel or
>>> federation plugins are better solutions for that case.
>>> 
>>> See http://www.rabbitmq.com/clustering.html
>>> 
>>> 
>>> 
>>> -Emile
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>> 
>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From lee.sylvester at gmail.com  Wed Apr 17 19:54:19 2013
From: lee.sylvester at gmail.com (Lee Sylvester)
Date: Wed, 17 Apr 2013 19:54:19 +0100
Subject: [rabbitmq-discuss] Erlang OTP handle
Message-ID: <20E2613C-8EAB-4939-9DC6-9D3697EB5FE8@gmail.com>

Hey guys,

So, I'm using RabbitMQ with Erlang.  Does anyone know how I'd receive messages through amqp_client using OTP?  The examples only show using a loop with the receive, whereas I'd like to avoid an actual loop where possible.

Thanks,
Lee

From videlalvaro at gmail.com  Wed Apr 17 20:00:46 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 17 Apr 2013 21:00:46 +0200
Subject: [rabbitmq-discuss] Erlang OTP handle
In-Reply-To: <20E2613C-8EAB-4939-9DC6-9D3697EB5FE8@gmail.com>
References: <20E2613C-8EAB-4939-9DC6-9D3697EB5FE8@gmail.com>
Message-ID: <CAMcAHLWPOV_KuK6ZSy5uApKhfWKUgbWot-wJTrn1ihVF_M1oOA@mail.gmail.com>

Yes, it's possible. Use handle_info in your gen_server behaviour and then
pattern match on the parameters.

handle_info is used for messages that are sent to the process but that are
not part of the gen_server API.


On Wed, Apr 17, 2013 at 8:54 PM, Lee Sylvester <lee.sylvester at gmail.com>wrote:

> Hey guys,
>
> So, I'm using RabbitMQ with Erlang.  Does anyone know how I'd receive
> messages through amqp_client using OTP?  The examples only show using a
> loop with the receive, whereas I'd like to avoid an actual loop where
> possible.
>
> Thanks,
> Lee
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130417/2bafff32/attachment.htm>

From lee.sylvester at gmail.com  Wed Apr 17 20:04:58 2013
From: lee.sylvester at gmail.com (Lee Sylvester)
Date: Wed, 17 Apr 2013 20:04:58 +0100
Subject: [rabbitmq-discuss] Erlang OTP handle
In-Reply-To: <CAMcAHLWPOV_KuK6ZSy5uApKhfWKUgbWot-wJTrn1ihVF_M1oOA@mail.gmail.com>
References: <20E2613C-8EAB-4939-9DC6-9D3697EB5FE8@gmail.com>
	<CAMcAHLWPOV_KuK6ZSy5uApKhfWKUgbWot-wJTrn1ihVF_M1oOA@mail.gmail.com>
Message-ID: <FEFBDE82-1000-4302-B2E0-F942C5F58832@gmail.com>

Thank you, Alvaro? However, do you know what the structure of Info is for RabbitMQ messages?  Or is it simply the message binary?

Thanks,
Lee



On 17 Apr 2013, at 20:00, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Yes, it's possible. Use handle_info in your gen_server behaviour and then pattern match on the parameters.
> 
> handle_info is used for messages that are sent to the process but that are not part of the gen_server API.
> 
> 
> On Wed, Apr 17, 2013 at 8:54 PM, Lee Sylvester <lee.sylvester at gmail.com> wrote:
> Hey guys,
> 
> So, I'm using RabbitMQ with Erlang.  Does anyone know how I'd receive messages through amqp_client using OTP?  The examples only show using a loop with the receive, whereas I'd like to avoid an actual loop where possible.
> 
> Thanks,
> Lee
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130417/c56db8a8/attachment.htm>

From watson.timothy at gmail.com  Wed Apr 17 20:08:38 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 17 Apr 2013 20:08:38 +0100
Subject: [rabbitmq-discuss] Erlang OTP handle
In-Reply-To: <FEFBDE82-1000-4302-B2E0-F942C5F58832@gmail.com>
References: <20E2613C-8EAB-4939-9DC6-9D3697EB5FE8@gmail.com>
	<CAMcAHLWPOV_KuK6ZSy5uApKhfWKUgbWot-wJTrn1ihVF_M1oOA@mail.gmail.com>
	<FEFBDE82-1000-4302-B2E0-F942C5F58832@gmail.com>
Message-ID: <83F675E1-8BBF-48A2-BC22-47B3620F7B00@rabbitmq.com>

Hi again Lee - just responded on erlang-questions. Take a look at amqp_gen_consumer. It does what you're trying to do so you can either use it as a template or just code your consumer process using it's behaviour instead of gen_server's.

Cheers,
Tim

On 17 Apr 2013, at 20:04, Lee Sylvester <lee.sylvester at gmail.com> wrote:

> Thank you, Alvaro? However, do you know what the structure of Info is for RabbitMQ messages?  Or is it simply the message binary?
> 
> Thanks,
> Lee
> 
> 
> 
> On 17 Apr 2013, at 20:00, Alvaro Videla <videlalvaro at gmail.com> wrote:
> 
>> Yes, it's possible. Use handle_info in your gen_server behaviour and then pattern match on the parameters.
>> 
>> handle_info is used for messages that are sent to the process but that are not part of the gen_server API.
>> 
>> 
>> On Wed, Apr 17, 2013 at 8:54 PM, Lee Sylvester <lee.sylvester at gmail.com> wrote:
>> Hey guys,
>> 
>> So, I'm using RabbitMQ with Erlang.  Does anyone know how I'd receive messages through amqp_client using OTP?  The examples only show using a loop with the receive, whereas I'd like to avoid an actual loop where possible.
>> 
>> Thanks,
>> Lee
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130417/dd31eaf5/attachment.htm>

From ilya at segment.io  Wed Apr 17 20:18:45 2013
From: ilya at segment.io (Ilya Volodarsky)
Date: Wed, 17 Apr 2013 12:18:45 -0700 (PDT)
Subject: [rabbitmq-discuss] Growing Memory Use and Queues
In-Reply-To: <ee8bca94-b015-4928-a1f3-7e258da28207@googlegroups.com>
References: <ee8bca94-b015-4928-a1f3-7e258da28207@googlegroups.com>
Message-ID: <9c01f9bb-548d-4153-8bb0-0962ebcc2553@googlegroups.com>

Looking more through the queues, it looks like the queue memory sum adds up 
based on the most active queues. 

The more the queues grow in size, the more memory they take up - which 
makes sense. The problem is that erlang isn't properly reclaiming that 
memory once it is no longer used. I checked out the memory consumption for 
all the queues.

The top culprits (sorted by memory).

25152048
25151848
21038056
21038016
21038016
19373624
19373584
19373584

None of these queues have any queued messages at all really, though most of 
them have had queued messages at one time or another in the past. 

The funny thing is, after running the command a second time, many of those 
queues had dropped back to normal levels, or significantly decreased. In 
particular, one went from 24mb to 600K. It seems like some of them are at 
least *trying* to garbage collect.

I'm also seeing queues that have been heavily used in the past, but haven't 
had any data going through them for months. One is at 12.8 MB and another 
at 6.3 MB. This seems to indicate that garbage collection isnt happening 
for now-inactive queues over long periods of time.

It seems like a memory leak or bug in garbage collection. Looking at the 
changelog for the versions of RMQ I don't see anything super relevant that 
would fix by updating to 3.0.4.

Having fewer queues will probably help things, seems to me like a deeper 
problem with rabbitmq though?

On Tuesday, April 16, 2013 12:53:06 PM UTC-4, Ilya Volodarsky wrote:
>
> We're having some strange memory problems in our rabbit that looks like 
> it's attributed to our queues. We're running Rabbit 3.0.1 in production, 
> here's the management plugin overview: http://cl.ly/image/0z25241k320Q
>
> As you can see, we have almost no messages queued, but the server is using 
> 5.7GB of active memory. Here's the memory breakdown of the same node: 
> http://cl.ly/image/03381l2M3v2p
>
> The broker claims to be using 4.8 GB to store the 4454 queues. That's 
> strange because most of the queues claim to be using 14kb - 23kb, which 
> AFAIK, is the in the correct range for an idle queue. An average of 20kb 
> per queue * 4500 queues = 90 MB, not 4800 MB (53 times bigger). 
>
> Here's the JSON description of a queue from the /queues call:
>
> {"memory":14624,"idle_since":"2013-04-15 
> 22:45:20","policy":"","exclusive_consumer_tag":"","messages_ready":0,"messages_unacknowledged":0,"messages":0,"consumers":4,"active_consumers":4,"backing_queue_status":{"q1":0,"q2":0,"delta":["delta","undefined",0,"undefined"],"q3":0,"q4":0,"len":0,"pending_acks":0,"target_ram_count":0,"ram_msg_count":0,"ram_ack_count":0,"next_seq_id":0,"persistent_count":0,"avg_ingress_rate":0.0,"avg_egress_rate":0.0,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},"messages_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"messages_ready_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"messages_unacknowledged_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"name":"Ingestion.1899vw88el","vhost":"/segment","durable":true,"auto_delete":false,"arguments":{},"node":"rabbit at rabbit2"}
>
> A few things to note: we have 4 servers subscribing to every queue, and 
> because of the RMQ client (node-amqp) we're using, it creates a channel per 
> subscription. I realize that's not ideal and we'll be fixing the client to 
> make multiple subscriptions per channel, but either way, the broker reports 
> only 350 MB of the memory use coming from the connections vs. 4.8 GB for 
> queues. 
>
> The broker has also been up for 76 days without downtime, so maybe there's 
> some kind of memory leak? We're seeing the memory go up over time. 
>
> Thanks!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130417/40ef0c05/attachment.htm>

From ilya at segment.io  Wed Apr 17 20:18:45 2013
From: ilya at segment.io (Ilya Volodarsky)
Date: Wed, 17 Apr 2013 12:18:45 -0700 (PDT)
Subject: [rabbitmq-discuss] Growing Memory Use and Queues
In-Reply-To: <ee8bca94-b015-4928-a1f3-7e258da28207@googlegroups.com>
References: <ee8bca94-b015-4928-a1f3-7e258da28207@googlegroups.com>
Message-ID: <9c01f9bb-548d-4153-8bb0-0962ebcc2553@googlegroups.com>

Looking more through the queues, it looks like the queue memory sum adds up 
based on the most active queues. 

The more the queues grow in size, the more memory they take up - which 
makes sense. The problem is that erlang isn't properly reclaiming that 
memory once it is no longer used. I checked out the memory consumption for 
all the queues.

The top culprits (sorted by memory).

25152048
25151848
21038056
21038016
21038016
19373624
19373584
19373584

None of these queues have any queued messages at all really, though most of 
them have had queued messages at one time or another in the past. 

The funny thing is, after running the command a second time, many of those 
queues had dropped back to normal levels, or significantly decreased. In 
particular, one went from 24mb to 600K. It seems like some of them are at 
least *trying* to garbage collect.

I'm also seeing queues that have been heavily used in the past, but haven't 
had any data going through them for months. One is at 12.8 MB and another 
at 6.3 MB. This seems to indicate that garbage collection isnt happening 
for now-inactive queues over long periods of time.

It seems like a memory leak or bug in garbage collection. Looking at the 
changelog for the versions of RMQ I don't see anything super relevant that 
would fix by updating to 3.0.4.

Having fewer queues will probably help things, seems to me like a deeper 
problem with rabbitmq though?

On Tuesday, April 16, 2013 12:53:06 PM UTC-4, Ilya Volodarsky wrote:
>
> We're having some strange memory problems in our rabbit that looks like 
> it's attributed to our queues. We're running Rabbit 3.0.1 in production, 
> here's the management plugin overview: http://cl.ly/image/0z25241k320Q
>
> As you can see, we have almost no messages queued, but the server is using 
> 5.7GB of active memory. Here's the memory breakdown of the same node: 
> http://cl.ly/image/03381l2M3v2p
>
> The broker claims to be using 4.8 GB to store the 4454 queues. That's 
> strange because most of the queues claim to be using 14kb - 23kb, which 
> AFAIK, is the in the correct range for an idle queue. An average of 20kb 
> per queue * 4500 queues = 90 MB, not 4800 MB (53 times bigger). 
>
> Here's the JSON description of a queue from the /queues call:
>
> {"memory":14624,"idle_since":"2013-04-15 
> 22:45:20","policy":"","exclusive_consumer_tag":"","messages_ready":0,"messages_unacknowledged":0,"messages":0,"consumers":4,"active_consumers":4,"backing_queue_status":{"q1":0,"q2":0,"delta":["delta","undefined",0,"undefined"],"q3":0,"q4":0,"len":0,"pending_acks":0,"target_ram_count":0,"ram_msg_count":0,"ram_ack_count":0,"next_seq_id":0,"persistent_count":0,"avg_ingress_rate":0.0,"avg_egress_rate":0.0,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},"messages_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"messages_ready_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"messages_unacknowledged_details":{"rate":0,"interval":90165823981,"last_event":1366065920939},"name":"Ingestion.1899vw88el","vhost":"/segment","durable":true,"auto_delete":false,"arguments":{},"node":"rabbit at rabbit2"}
>
> A few things to note: we have 4 servers subscribing to every queue, and 
> because of the RMQ client (node-amqp) we're using, it creates a channel per 
> subscription. I realize that's not ideal and we'll be fixing the client to 
> make multiple subscriptions per channel, but either way, the broker reports 
> only 350 MB of the memory use coming from the connections vs. 4.8 GB for 
> queues. 
>
> The broker has also been up for 76 days without downtime, so maybe there's 
> some kind of memory leak? We're seeing the memory go up over time. 
>
> Thanks!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130417/40ef0c05/attachment-0001.htm>

From watson.timothy at gmail.com  Wed Apr 17 20:24:01 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 17 Apr 2013 20:24:01 +0100
Subject: [rabbitmq-discuss] Erlang OTP handle
In-Reply-To: <83F675E1-8BBF-48A2-BC22-47B3620F7B00@rabbitmq.com>
References: <20E2613C-8EAB-4939-9DC6-9D3697EB5FE8@gmail.com>
	<CAMcAHLWPOV_KuK6ZSy5uApKhfWKUgbWot-wJTrn1ihVF_M1oOA@mail.gmail.com>
	<FEFBDE82-1000-4302-B2E0-F942C5F58832@gmail.com>
	<83F675E1-8BBF-48A2-BC22-47B3620F7B00@rabbitmq.com>
Message-ID: <93814F9F-82F1-4B8E-9D6A-ED954942B0C5@rabbitmq.com>

Oh and specifically, the messages will be records, see the header files for details.

Cheers,
Tim

On 17 Apr 2013, at 20:08, Tim Watson <watson.timothy at gmail.com> wrote:

> Hi again Lee - just responded on erlang-questions. Take a look at amqp_gen_consumer. It does what you're trying to do so you can either use it as a template or just code your consumer process using it's behaviour instead of gen_server's.
> 
> Cheers,
> Tim
> 
> On 17 Apr 2013, at 20:04, Lee Sylvester <lee.sylvester at gmail.com> wrote:
> 
>> Thank you, Alvaro? However, do you know what the structure of Info is for RabbitMQ messages?  Or is it simply the message binary?
>> 
>> Thanks,
>> Lee
>> 
>> 
>> 
>> On 17 Apr 2013, at 20:00, Alvaro Videla <videlalvaro at gmail.com> wrote:
>> 
>>> Yes, it's possible. Use handle_info in your gen_server behaviour and then pattern match on the parameters.
>>> 
>>> handle_info is used for messages that are sent to the process but that are not part of the gen_server API.
>>> 
>>> 
>>> On Wed, Apr 17, 2013 at 8:54 PM, Lee Sylvester <lee.sylvester at gmail.com> wrote:
>>> Hey guys,
>>> 
>>> So, I'm using RabbitMQ with Erlang.  Does anyone know how I'd receive messages through amqp_client using OTP?  The examples only show using a loop with the receive, whereas I'd like to avoid an actual loop where possible.
>>> 
>>> Thanks,
>>> Lee
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130417/3f185f3f/attachment.htm>

From videlalvaro at gmail.com  Wed Apr 17 20:31:34 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 17 Apr 2013 21:31:34 +0200
Subject: [rabbitmq-discuss] Erlang OTP handle
In-Reply-To: <93814F9F-82F1-4B8E-9D6A-ED954942B0C5@rabbitmq.com>
References: <20E2613C-8EAB-4939-9DC6-9D3697EB5FE8@gmail.com>
	<CAMcAHLWPOV_KuK6ZSy5uApKhfWKUgbWot-wJTrn1ihVF_M1oOA@mail.gmail.com>
	<FEFBDE82-1000-4302-B2E0-F942C5F58832@gmail.com>
	<83F675E1-8BBF-48A2-BC22-47B3620F7B00@rabbitmq.com>
	<93814F9F-82F1-4B8E-9D6A-ED954942B0C5@rabbitmq.com>
Message-ID: <CAMcAHLXDXybnzgD9rS-RC5ecwuPWptjuR2+qj9fBahx91ETxzw@mail.gmail.com>

Apart from what Tim have just said:

An AMQP message in Erlang:
http://hg.rabbitmq.com/rabbitmq-erlang-client/file/717e6ab8b95b/include/amqp_client.hrl#l23

And here are several handle_info callbacks for a gen_server
http://hg.rabbitmq.com/rabbitmq-erlang-client/file/717e6ab8b95b/src/amqp_rpc_client.erl#l160


On Wed, Apr 17, 2013 at 9:24 PM, Tim Watson <watson.timothy at gmail.com>wrote:

> Oh and specifically, the messages will be records, see the header files
> for details.
>
> Cheers,
> Tim
>
> On 17 Apr 2013, at 20:08, Tim Watson <watson.timothy at gmail.com> wrote:
>
> Hi again Lee - just responded on erlang-questions. Take a look at
> amqp_gen_consumer. It does what you're trying to do so you can either use
> it as a template or just code your consumer process using it's behaviour
> instead of gen_server's.
>
> Cheers,
> Tim
>
> On 17 Apr 2013, at 20:04, Lee Sylvester <lee.sylvester at gmail.com> wrote:
>
> Thank you, Alvaro? However, do you know what the structure of Info is for
> RabbitMQ messages?  Or is it simply the message binary?
>
> Thanks,
> Lee
>
>
>
> On 17 Apr 2013, at 20:00, Alvaro Videla <videlalvaro at gmail.com> wrote:
>
> Yes, it's possible. Use handle_info in your gen_server behaviour and then
> pattern match on the parameters.
>
> handle_info is used for messages that are sent to the process but that are
> not part of the gen_server API.
>
>
> On Wed, Apr 17, 2013 at 8:54 PM, Lee Sylvester <lee.sylvester at gmail.com>wrote:
>
>> Hey guys,
>>
>> So, I'm using RabbitMQ with Erlang.  Does anyone know how I'd receive
>> messages through amqp_client using OTP?  The examples only show using a
>> loop with the receive, whereas I'd like to avoid an actual loop where
>> possible.
>>
>> Thanks,
>> Lee
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130417/464035c8/attachment.htm>

From lee.sylvester at gmail.com  Wed Apr 17 20:31:37 2013
From: lee.sylvester at gmail.com (Lee Sylvester)
Date: Wed, 17 Apr 2013 20:31:37 +0100
Subject: [rabbitmq-discuss] Erlang OTP handle
In-Reply-To: <93814F9F-82F1-4B8E-9D6A-ED954942B0C5@rabbitmq.com>
References: <20E2613C-8EAB-4939-9DC6-9D3697EB5FE8@gmail.com>
	<CAMcAHLWPOV_KuK6ZSy5uApKhfWKUgbWot-wJTrn1ihVF_M1oOA@mail.gmail.com>
	<FEFBDE82-1000-4302-B2E0-F942C5F58832@gmail.com>
	<83F675E1-8BBF-48A2-BC22-47B3620F7B00@rabbitmq.com>
	<93814F9F-82F1-4B8E-9D6A-ED954942B0C5@rabbitmq.com>
Message-ID: <3032E030-0761-4C97-9930-E519CF92D987@gmail.com>

Thanks Tim.  I'm using this:

handle_info({#'basic.consume'{exchange=_Exchange, routing_key=_Key}, Packet}, State) ->

For receiving messages from RabbitMQ? Does that look about right?

Thanks,
Lee



On 17 Apr 2013, at 20:24, Tim Watson <watson.timothy at gmail.com> wrote:

> Oh and specifically, the messages will be records, see the header files for details.
> 
> Cheers,
> Tim
> 
> On 17 Apr 2013, at 20:08, Tim Watson <watson.timothy at gmail.com> wrote:
> 
>> Hi again Lee - just responded on erlang-questions. Take a look at amqp_gen_consumer. It does what you're trying to do so you can either use it as a template or just code your consumer process using it's behaviour instead of gen_server's.
>> 
>> Cheers,
>> Tim
>> 
>> On 17 Apr 2013, at 20:04, Lee Sylvester <lee.sylvester at gmail.com> wrote:
>> 
>>> Thank you, Alvaro? However, do you know what the structure of Info is for RabbitMQ messages?  Or is it simply the message binary?
>>> 
>>> Thanks,
>>> Lee
>>> 
>>> 
>>> 
>>> On 17 Apr 2013, at 20:00, Alvaro Videla <videlalvaro at gmail.com> wrote:
>>> 
>>>> Yes, it's possible. Use handle_info in your gen_server behaviour and then pattern match on the parameters.
>>>> 
>>>> handle_info is used for messages that are sent to the process but that are not part of the gen_server API.
>>>> 
>>>> 
>>>> On Wed, Apr 17, 2013 at 8:54 PM, Lee Sylvester <lee.sylvester at gmail.com> wrote:
>>>> Hey guys,
>>>> 
>>>> So, I'm using RabbitMQ with Erlang.  Does anyone know how I'd receive messages through amqp_client using OTP?  The examples only show using a loop with the receive, whereas I'd like to avoid an actual loop where possible.
>>>> 
>>>> Thanks,
>>>> Lee
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130417/ecc88254/attachment.htm>

From tim at rabbitmq.com  Wed Apr 17 20:48:52 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 17 Apr 2013 20:48:52 +0100
Subject: [rabbitmq-discuss] Erlang OTP handle
In-Reply-To: <3032E030-0761-4C97-9930-E519CF92D987@gmail.com>
References: <20E2613C-8EAB-4939-9DC6-9D3697EB5FE8@gmail.com>
	<CAMcAHLWPOV_KuK6ZSy5uApKhfWKUgbWot-wJTrn1ihVF_M1oOA@mail.gmail.com>
	<FEFBDE82-1000-4302-B2E0-F942C5F58832@gmail.com>
	<83F675E1-8BBF-48A2-BC22-47B3620F7B00@rabbitmq.com>
	<93814F9F-82F1-4B8E-9D6A-ED954942B0C5@rabbitmq.com>
	<3032E030-0761-4C97-9930-E519CF92D987@gmail.com>
Message-ID: <C3199F32-0142-404D-A47E-1212AEB3F28A@rabbitmq.com>

On 17 Apr 2013, at 20:31, Lee Sylvester wrote:

> Thanks Tim.  I'm using this:
> 
> handle_info({#'basic.consume'{exchange=_Exchange, routing_key=_Key}, Packet}, State) ->
> 
> For receiving messages from RabbitMQ? Does that look about right?
> 

No really - basic.consume is a message from to client to the server indicating that you want to receive messages. Try this instead:

handle_info({#'basic.deliver'{delivery_tag = DeliveryTag},
                  #amqp_msg{payload = Payload}}, State) ->

You might want to skim through http://www.rabbitmq.com/amqp-0-9-1-quickref.html if you're not too sure about AMQP classes and methods and what they're for. 

Cheers,
Tim

From tim at rabbitmq.com  Wed Apr 17 20:50:43 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 17 Apr 2013 20:50:43 +0100
Subject: [rabbitmq-discuss] Erlang OTP handle
In-Reply-To: <C3199F32-0142-404D-A47E-1212AEB3F28A@rabbitmq.com>
References: <20E2613C-8EAB-4939-9DC6-9D3697EB5FE8@gmail.com>
	<CAMcAHLWPOV_KuK6ZSy5uApKhfWKUgbWot-wJTrn1ihVF_M1oOA@mail.gmail.com>
	<FEFBDE82-1000-4302-B2E0-F942C5F58832@gmail.com>
	<83F675E1-8BBF-48A2-BC22-47B3620F7B00@rabbitmq.com>
	<93814F9F-82F1-4B8E-9D6A-ED954942B0C5@rabbitmq.com>
	<3032E030-0761-4C97-9930-E519CF92D987@gmail.com>
	<C3199F32-0142-404D-A47E-1212AEB3F28A@rabbitmq.com>
Message-ID: <4D5E3902-923C-48FA-B659-626718E5EBDF@rabbitmq.com>

On 17 Apr 2013, at 20:48, Tim Watson wrote:
> 
> No really ...

s/No/Not/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130417/b586e87a/attachment.htm>

From lee.sylvester at gmail.com  Wed Apr 17 21:05:28 2013
From: lee.sylvester at gmail.com (Lee Sylvester)
Date: Wed, 17 Apr 2013 21:05:28 +0100
Subject: [rabbitmq-discuss] Erlang OTP handle
In-Reply-To: <C3199F32-0142-404D-A47E-1212AEB3F28A@rabbitmq.com>
References: <20E2613C-8EAB-4939-9DC6-9D3697EB5FE8@gmail.com>
	<CAMcAHLWPOV_KuK6ZSy5uApKhfWKUgbWot-wJTrn1ihVF_M1oOA@mail.gmail.com>
	<FEFBDE82-1000-4302-B2E0-F942C5F58832@gmail.com>
	<83F675E1-8BBF-48A2-BC22-47B3620F7B00@rabbitmq.com>
	<93814F9F-82F1-4B8E-9D6A-ED954942B0C5@rabbitmq.com>
	<3032E030-0761-4C97-9930-E519CF92D987@gmail.com>
	<C3199F32-0142-404D-A47E-1212AEB3F28A@rabbitmq.com>
Message-ID: <93259A35-93F8-4561-A116-359F7B3489CF@gmail.com>

Perfect, thank you.

Lee


On 17 Apr 2013, at 20:48, Tim Watson <tim at rabbitmq.com> wrote:

> On 17 Apr 2013, at 20:31, Lee Sylvester wrote:
> 
>> Thanks Tim.  I'm using this:
>> 
>> handle_info({#'basic.consume'{exchange=_Exchange, routing_key=_Key}, Packet}, State) ->
>> 
>> For receiving messages from RabbitMQ? Does that look about right?
>> 
> 
> No really - basic.consume is a message from to client to the server indicating that you want to receive messages. Try this instead:
> 
> handle_info({#'basic.deliver'{delivery_tag = DeliveryTag},
>                  #amqp_msg{payload = Payload}}, State) ->
> 
> You might want to skim through http://www.rabbitmq.com/amqp-0-9-1-quickref.html if you're not too sure about AMQP classes and methods and what they're for. 
> 
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jsinsel at precysesolutions.com  Wed Apr 17 18:21:50 2013
From: jsinsel at precysesolutions.com (sinsei)
Date: Wed, 17 Apr 2013 10:21:50 -0700 (PDT)
Subject: [rabbitmq-discuss] Hash Exchange with temporary queues
Message-ID: <1366219310163-26051.post@n5.nabble.com>

I'm currently investigating RabbitMQ to perform some scenarios that our
software needs.  One of these is to process messages for a particular group
on the same consumer so that updates done to our database happen in order. 

Since grouping isn't built-in to RabbitMQ, I thought about using the hash
exchange plugin. This way updates for a particular ID go to the same bucket
and the same consumer. So when a consumer hooks up to the exchange, they
create an exclusive, temporary queue. Then I can add consumers dynamically
and they would automatically receive a bucket.

The problem I've noticed is that when I shut down a consumer, some messages
are just lost. I wasn't sure how to set this up as dead-letter-exchanges
won't work for this case. Is there a way I can ensure those messages are
passed somewhere else?

Also, what happens if I have no consumers, it appears the messages are just
gone.  I may have to set up an alternative exchange?

I've also considered adding some grouping as a plugin so I could have a
single durable, trunk queue, but I'm unsure if it is possible with the
current plugin model.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Hash-Exchange-with-temporary-queues-tp26051.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mag.geo8 at gmail.com  Thu Apr 18 04:30:20 2013
From: mag.geo8 at gmail.com (mag8)
Date: Wed, 17 Apr 2013 20:30:20 -0700 (PDT)
Subject: [rabbitmq-discuss] Max messages allowed in a queue in RabbitMQ?
Message-ID: <1366255820235-26063.post@n5.nabble.com>

Hi all,

Can anyone provide me with answers for my below questions:

1) Max queues allowed in RabbitMQ?
2) Max messages allowed in a queue in RabbitMQ?
3) Max size of a message in a queue?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Max-messages-allowed-in-a-queue-in-RabbitMQ-tp26063.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From frederic.cons at gmail.com  Thu Apr 18 09:13:54 2013
From: frederic.cons at gmail.com (=?UTF-8?Q?Fr=C3=A9d=C3=A9ric_Cons?=)
Date: Thu, 18 Apr 2013 01:13:54 -0700 (PDT)
Subject: [rabbitmq-discuss] Disabling connection logs
In-Reply-To: <faf57ba4-7993-4563-8f1f-42361f3c5762@googlegroups.com>
References: <faf57ba4-7993-4563-8f1f-42361f3c5762@googlegroups.com>
Message-ID: <b3f022ac-6c3b-4cea-94ca-fba14c857b97@googlegroups.com>

Ok so enclosing this log configuration inside a 'rabbit' config works way 
better :)

{rabbit, [ {log_levels, [{connection, error}]} ] }

Thanks to Simon MacMullen for pointing out this error

Le lundi 15 avril 2013 15:53:04 UTC+2, Fr?d?ric Cons a ?crit :
>
> Hi everyone
>
> I have a cluster of two rabbitmq instances behind a haproxy server.
> The connection tests made by haproxy generate a high volume of connection 
> / disconnection logs such as : 
>
>  =INFO REPORT==== 15-Apr-2013::00:08:05 ===
> accepting AMQP connection <0.9464.45> (192.168.0.151:52341 -> 
> 192.168.0.151:5672)
>
> =WARNING REPORT==== 15-Apr-2013::00:08:05 ===
> closing AMQP connection <0.9464.45> (192.168.0.151:52341 -> 
> 192.168.0.151:5672):
> connection_closed_abruptly
>
> Not a big deal, but quite noisy
> I changed by rabbitmq.config file to try to ignore these logs with : 
>
>
> [
> {log_levels, [{connection, error}]}
> ,
> <other configuration items>
> ].
> % EOF
>
> But these messages keep flowing in the logs
> Any idea of what I could to to prevent this ? 
>
> Best regards
> Fred
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130418/d95eb920/attachment.htm>

From tim at rabbitmq.com  Thu Apr 18 09:40:29 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 18 Apr 2013 09:40:29 +0100
Subject: [rabbitmq-discuss] Max messages allowed in a queue in RabbitMQ?
In-Reply-To: <1366255820235-26063.post@n5.nabble.com>
References: <1366255820235-26063.post@n5.nabble.com>
Message-ID: <734F6B54-1732-4DD3-B956-FC06EF5C55F0@rabbitmq.com>

Hi,

On 18 Apr 2013, at 04:30, mag8 wrote:

> Can anyone provide me with answers for my below questions:
> 

Each of these will be limited by some combination of the available memory, disk space and the level of producer/consumer throughput you're able to achieve as they're combined in various ways. There are no system enforced limits. You might like to look at http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-February/003042.html and 

> 1) Max queues allowed in RabbitMQ?

Thousands (or even tens of thousands) of queues should be no problem at all, though each object (e.g., queues, exchanges, bindings, etc) will take up some memory and/or disk space. By default, Erlang will enforce a maximum number of concurrent processes (i.e., lightweight threads) at around 32768 IIRC. Each queue is managed by its own process and each connection can result in several more, so if you're planning on having a very large number of active queues in a single node (?) and using them all at the same time, then you may need to tweak the emulator arguments rabbit passes the VM by setting +P <new limit> to a higher limit.

You're also likely to use up many Gb just with the overhead for each queue / connection pretty fast, so you're going to need a pretty meaty server to handle millions of both. Tens of thousands should be no problem at all, providing they fit into RAM.

> 2) Max messages allowed in a queue in RabbitMQ?

There is no limit to the number of messages in a queue (and we frequently see hundreds of thousands and even millions of enqueued messages discussed on this mailing list), although each message will take up some amount of memory (which varies depending on whether the message is persistent or transient, whether or not it has been paged to disk anyway to prevent memory overload, etc) and queue response times may vary depending on size.

> 3) Max size of a message in a queue?
> 


Although there is no max message size enforced by rabbit, messages *must* be able to fit into the available memory. Using 32-bit Erlang, 536870911 bytes is maximum binary size, which with 64-bit it's 2305843009213693951 bytes. This seems unlikely to bite you (no pun intended), and you're likely to bump into other system limits first I would've thought.

Cheers,
Tim

From carl.hoerberg at gmail.com  Thu Apr 18 09:41:43 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 18 Apr 2013 01:41:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Mgmt API stopped reporting a lot of stuff
Message-ID: <1366274503665-26065.post@n5.nabble.com>

Noticed that the mgmt interface started to report "TypeError:
overview.object_totals is undefined". 

and yes, /api/overview returns only: 
{"management_version":"3.0.4","statistics_level":"fine","exchange_types":[{"name":"topic","description":"AMQP
topic exchange, as per the AMQP
specification","enabled":true},{"name":"fanout","description":"AMQP fanout
exchange, as per the AMQP
specification","enabled":true},{"name":"direct","description":"AMQP direct
exchange, as per the AMQP
specification","enabled":true},{"name":"headers","description":"AMQP headers
exchange, as per the AMQP
specification","enabled":true}],"rabbitmq_version":"3.0.4","erlang_version":"R14B04","node":"rabbit at tiger01","statistics_db_node":"not_running","listeners":[{"node":"rabbit at tiger01","protocol":"amqp","ip_address":"0.0.0.0","port":5672},{"node":"rabbit at tiger02","protocol":"amqp","ip_address":"0.0.0.0","port":5672},{"node":"rabbit at tiger03","protocol":"amqp","ip_address":"0.0.0.0","port":5672},{"node":"rabbit at tiger01","protocol":"amqp/ssl","ip_address":"0.0.0.0","port":5671},{"node":"rabbit at tiger02","protocol":"amqp/ssl","ip_address":"0.0.0.0","port":5671},{"node":"rabbit at tiger03","protocol":"amqp/ssl","ip_address":"0.0.0.0","port":5671}],"contexts":[]}

/api/nodes also reports less stuff than usual: 
[{"name":"rabbit at tiger01","type":"disc","running":true},{"name":"rabbit at tiger02","type":"disc","running":true},{"name":"rabbit at tiger03","type":"disc","running":true}]

"rabbitmqctl report" did never return, waited ~10minutes..

The cluster has about ~800 connections and ~10000 queues. 

Can it be fixed without a restart? 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Mgmt-API-stopped-reporting-a-lot-of-stuff-tp26065.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Thu Apr 18 09:51:10 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 18 Apr 2013 09:51:10 +0100
Subject: [rabbitmq-discuss] Max messages allowed in a queue in RabbitMQ?
In-Reply-To: <734F6B54-1732-4DD3-B956-FC06EF5C55F0@rabbitmq.com>
References: <1366255820235-26063.post@n5.nabble.com>
	<734F6B54-1732-4DD3-B956-FC06EF5C55F0@rabbitmq.com>
Message-ID: <8C3AAAF5-567A-4B4F-B184-03907E912311@rabbitmq.com>

Oh and...

On 18 Apr 2013, at 09:40, Tim Watson wrote:
> you may need to tweak the emulator arguments rabbit passes the VM by setting +P <new limit> to a higher limit.
> 

We set this to 1048576 already in our startup scripts, so you're unlikely to hit that. :)

From simon at rabbitmq.com  Thu Apr 18 10:37:06 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 18 Apr 2013 10:37:06 +0100
Subject: [rabbitmq-discuss] Growing Memory Use and Queues
In-Reply-To: <9c01f9bb-548d-4153-8bb0-0962ebcc2553@googlegroups.com>
References: <ee8bca94-b015-4928-a1f3-7e258da28207@googlegroups.com>
	<9c01f9bb-548d-4153-8bb0-0962ebcc2553@googlegroups.com>
Message-ID: <516FBEC2.6020600@rabbitmq.com>

On 17/04/13 20:18, Ilya Volodarsky wrote:
> It seems like a memory leak or bug in garbage collection. Looking at the
> changelog for the versions of RMQ I don't see anything super relevant
> that would fix by updating to 3.0.4.

You are probably seeing this, fixed in 3.0.2:

25353 fix issue preventing idle queues from hibernating sometimes

The key point is that queues GC when they are working, and when they 
hibernate. A queue that is not doing work but has also not hibernated 
might not GC for a long time. So an upgrade is suggested after all :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jesper.louis.andersen at gmail.com  Thu Apr 18 10:51:41 2013
From: jesper.louis.andersen at gmail.com (Jesper Louis Andersen)
Date: Thu, 18 Apr 2013 11:51:41 +0200
Subject: [rabbitmq-discuss] Max messages allowed in a queue in RabbitMQ?
In-Reply-To: <8C3AAAF5-567A-4B4F-B184-03907E912311@rabbitmq.com>
References: <1366255820235-26063.post@n5.nabble.com>
	<734F6B54-1732-4DD3-B956-FC06EF5C55F0@rabbitmq.com>
	<8C3AAAF5-567A-4B4F-B184-03907E912311@rabbitmq.com>
Message-ID: <CAGrdgiVmOA_T41Ms5Ds9nBjtVWnMStOCf00im_T=3NsJFhWyUA@mail.gmail.com>

This has also been bumped in R16B as well since the allocation is more
dynamic now than it were.


On Thu, Apr 18, 2013 at 10:51 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Oh and...
>
> On 18 Apr 2013, at 09:40, Tim Watson wrote:
> > you may need to tweak the emulator arguments rabbit passes the VM by
> setting +P <new limit> to a higher limit.
> >
>
> We set this to 1048576 already in our startup scripts, so you're unlikely
> to hit that. :)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130418/d87ee7cc/attachment.htm>

From tim at rabbitmq.com  Thu Apr 18 11:09:12 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 18 Apr 2013 11:09:12 +0100
Subject: [rabbitmq-discuss] Max messages allowed in a queue in RabbitMQ?
In-Reply-To: <CAGrdgiVmOA_T41Ms5Ds9nBjtVWnMStOCf00im_T=3NsJFhWyUA@mail.gmail.com>
References: <1366255820235-26063.post@n5.nabble.com>
	<734F6B54-1732-4DD3-B956-FC06EF5C55F0@rabbitmq.com>
	<8C3AAAF5-567A-4B4F-B184-03907E912311@rabbitmq.com>
	<CAGrdgiVmOA_T41Ms5Ds9nBjtVWnMStOCf00im_T=3NsJFhWyUA@mail.gmail.com>
Message-ID: <49DC55EC-35B1-4A07-9308-EA87F0D6ECE0@rabbitmq.com>

On 18 Apr 2013, at 10:51, Jesper Louis Andersen wrote:
> This has also been bumped in R16B as well since the allocation is more dynamic now than it were.
> 

That's good to know - thanks!

From matthias at rabbitmq.com  Thu Apr 18 11:56:53 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 18 Apr 2013 11:56:53 +0100
Subject: [rabbitmq-discuss] RabbitMQ Queues memory leak?
In-Reply-To: <CAHWt7w0xoKZ3v8JpZVrs+b-_NW_u6JqPuNjb5KmAEmn7rf5VmA@mail.gmail.com>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
	<CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
	<CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>
	<CAHWt7w0+H87VoXnSuqhVi6FAsm_PbtEbuvH_H=CckWX6k9sW6g@mail.gmail.com>
	<CAE3HoVTcg54NCD9DmsPuZB8vjvB8HXxg0kLwO2hUtp2hjVBFiw@mail.gmail.com>
	<CAHWt7w0pDVbews1OWGsJTv3aOOk-K26PEHLBn=F=Yctg6rc41w@mail.gmail.com>
	<CAHWt7w0xoKZ3v8JpZVrs+b-_NW_u6JqPuNjb5KmAEmn7rf5VmA@mail.gmail.com>
Message-ID: <516FD175.2050302@rabbitmq.com>

Dmitry,

On 16/04/13 13:01, Dmitry Saprykin wrote:
> Is there any news about 3.0.4 Queues memory leak bug?

It remains to be seen whether there is a bug ;)

> Is there anything interesting in `rabbitmqctl report` I have sent in
> last message?

That report shows queue memory of just over 1Mb, not the 180 Mb you 
mention in your post. Can you post a report for the latter?

Regards,

Matthias.

From saprykin.dmitry at gmail.com  Thu Apr 18 12:52:26 2013
From: saprykin.dmitry at gmail.com (Dmitry Saprykin)
Date: Thu, 18 Apr 2013 15:52:26 +0400
Subject: [rabbitmq-discuss] RabbitMQ Queues memory leak?
In-Reply-To: <516FD175.2050302@rabbitmq.com>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
	<CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
	<CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>
	<CAHWt7w0+H87VoXnSuqhVi6FAsm_PbtEbuvH_H=CckWX6k9sW6g@mail.gmail.com>
	<CAE3HoVTcg54NCD9DmsPuZB8vjvB8HXxg0kLwO2hUtp2hjVBFiw@mail.gmail.com>
	<CAHWt7w0pDVbews1OWGsJTv3aOOk-K26PEHLBn=F=Yctg6rc41w@mail.gmail.com>
	<CAHWt7w0xoKZ3v8JpZVrs+b-_NW_u6JqPuNjb5KmAEmn7rf5VmA@mail.gmail.com>
	<516FD175.2050302@rabbitmq.com>
Message-ID: <CAHWt7w3SBaC8LbEywLnA8npH4dzROPQE_i8OO+1CXeLxLuo+3Q@mail.gmail.com>

Could you take a look at memory consumption of cdaemon4 node. Report
contains data for both cluster nodes.

{memory,
     [{total,859404112},
      {connection_procs,4832056},
      {queue_procs,!!!189148496!!!},


Kind regards,


Dmitry Saprykin



On 18 April 2013 14:56, Matthias Radestock <matthias at rabbitmq.com> wrote:

> Dmitry,
>
>
> On 16/04/13 13:01, Dmitry Saprykin wrote:
>
>> Is there any news about 3.0.4 Queues memory leak bug?
>>
>
> It remains to be seen whether there is a bug ;)
>
>
>  Is there anything interesting in `rabbitmqctl report` I have sent in
>> last message?
>>
>
> That report shows queue memory of just over 1Mb, not the 180 Mb you
> mention in your post. Can you post a report for the latter?
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130418/4f05a963/attachment.htm>

From ehberg at gmail.com  Thu Apr 18 14:23:24 2013
From: ehberg at gmail.com (Eric Berg)
Date: Thu, 18 Apr 2013 09:23:24 -0400
Subject: [rabbitmq-discuss] RabbitMQ with many queues
In-Reply-To: <516EBE70.6070403@rabbitmq.com>
References: <CAL8idP0qhp5mcM887v9FkRLCSZwbx1MjVdHZ==73FX7K68qoGQ@mail.gmail.com>
	<516EBE70.6070403@rabbitmq.com>
Message-ID: <CAL8idP3xQuAU5Lr9zkRgncUgQfVKGnZETX=1PJnXXWhznTQh6w@mail.gmail.com>

Thanks for the reply Emile. Right now we have a 4 node cluster with primary
and failover haproxy round robin load balancers, so dynamic generation of
queues tend to be pretty well distributed especially with a 2 node ha
policy. I guess it will just take some close monitoring to verify that the
resources are not being exhausted, though even adding new nodes to the
cluster would not help in that case correct? Since in a 4 node cluster with
a 2 node ha policy, only newly created queues would be replicated to the
new node? How do others handle situations like this?

- PHP -
On a related note, we have had some unfortunate experiences when testing a
few different php libraries and Rabbit kicks in its flow control. It looks
like that our producers using various php libs in an Apache setting dont
handle the flow control well, while the php connection dies Rabbit still
thinks they are active even though no producing is coming across, filling
up the file descriptors.

Thanks guys!




On Wed, Apr 17, 2013 at 11:23 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Eric,
>
> On 15/04/13 22:31, Eric Berg wrote:
> > I am curious about those of you who have run Rabbit clusters with
> > many thousands of queues
>
> I have only used that many queues under testing conditions, rather than
> production.
>
> This is more relevant if you are using non-HA queues, but can be
> relevant even for HA queues that are not mirrored to all nodes: make
> sure you achieve a balanced load by not defining all queues on a single
> node.
>
> Make sure you provision adequate resources. It is possible to declare an
> enormous number of idle queues without difficulty, but the broker will
> grind to a halt if many queues on an under-resourced node start
> consuming CPU and RAM. Use realistic workloads to estimate the required
> resources.
>
> Use a sensible naming scheme for queues so that you can easily manage a
> subset. Consider binding queues via internal exchanges if that makes the
> management of bindings easier.
>
> Don't perform "rabbitmqctl list_queues" in a tight loop for monitoring
> as this will generate significant load and slow down the broker.
>
>
>
> Please report back anything you learn from your experience that other
> may benefit from.
>
>
> -Emile
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130418/87c3cdea/attachment.htm>

From fred at dushin.net  Thu Apr 18 16:04:57 2013
From: fred at dushin.net (Fred Dushin)
Date: Thu, 18 Apr 2013 11:04:57 -0400
Subject: [rabbitmq-discuss] Proposed change to shovel
Message-ID: <48163C85-04EB-4B77-BD97-C96E1BD1B7B0@dushin.net>

Hi,

I would like to consider a change to the shovel plugin, to allow the shovel to failover more predictably against the list of broker endpoints in the rabbitmq_shovel configuration.  Essentially, the idea is to try each endpoint in order of the declaration, and to use the first endpoint to which a connection can be made, instead of selecting an endpoint at random.

This does slightly violate the spirit of Erlang's "let it fail" philosophy, and I am not sure if the random endpoint selection in the current code is really more designed for clustered environments.  Perhaps it would make more sense to make the iterative failover strategy an "opt-in" feature, if not simply for the sake of backwards-compatibility.

I am providing a patch, but not suggesting that this actual change go into production code, as I really did the change for testing purposes.  I'm really more interested in whether others would find the patch useful, and whether there would be a way for us to fold a feature like this into the shovel.  If there is interest, I would be happy to contribute something more production-worthy, for review.

Thanks,

-Fred

Here is the patch (based off 3.0.1 tag):

# HG changeset patch
# User Fred Dushin <fred at dushin.net>
# Date 1366295416 14400
# Branch fdushin-failover
# Node ID 0436511e18908fd8d38d5f56a1a3b0e5af807206
# Parent  cdf80b9ac08a61de718314baaff13f8ca5740c4c
Added changes to make failover to additional endpoints deterministic.

diff --git a/src/rabbit_shovel_worker.erl b/src/rabbit_shovel_worker.erl
--- a/src/rabbit_shovel_worker.erl
+++ b/src/rabbit_shovel_worker.erl
@@ -53,9 +53,9 @@
   random:seed(A, B, C),
   #shovel{sources = Sources, destinations = Destinations} = Config,
   {InboundConn, InboundChan, InboundParams} =
-        make_conn_and_chan(Sources#endpoint.amqp_params),
+        make_conn_and_chan(lists:reverse(Sources#endpoint.amqp_params)),
   {OutboundConn, OutboundChan, OutboundParams} =
-        make_conn_and_chan(Destinations#endpoint.amqp_params),
+        make_conn_and_chan(lists:reverse(Destinations#endpoint.amqp_params)),

   create_resources(InboundChan,
                    Sources#endpoint.resource_declarations),
@@ -240,11 +240,27 @@
       amqp_channel:call(Chan, #'channel.flow'{active = Active}),
   ok.

-make_conn_and_chan(AmqpParams) ->
-    AmqpParam = lists:nth(random:uniform(length(AmqpParams)), AmqpParams),
+amqp_params_to_string(#amqp_params_network{host=Host, port=Port, virtual_host=VirtualHost}) ->
+    io_lib:format("Host: ~p Port: ~p VirtualHost: ~p", [Host, Port, VirtualHost]);
+amqp_params_to_string(#amqp_params_direct{virtual_host=VirtualHost}) ->
+    io_lib:format("(Direct) Virtual Host: ~p", [VirtualHost]).
+
+make_conn_and_chan([]) ->
+    throw(no_endpoints);
+make_conn_and_chan([AmqpParam|Rest]) ->
+    try
+        get_conn_and_chan(AmqpParam)
+    catch
+        Type:Reason ->
+            error_logger:error_msg("Shovel failed to connect to ~s: ~p:~p", [amqp_params_to_string(AmqpParam), Type, Reason]),
+            make_conn_and_chan(Rest)
+    end.
+
+get_conn_and_chan(AmqpParam) ->
   {ok, Conn} = amqp_connection:start(AmqpParam),
   link(Conn),
   {ok, Chan} = amqp_connection:open_channel(Conn),
+    error_logger:info_msg("Shovel connected to ~s.", [amqp_params_to_string(AmqpParam)]),
   {Conn, Chan, AmqpParam}.

create_resources(Chan, Declarations) ->

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130418/ef9dd494/attachment.htm>

From tim at rabbitmq.com  Thu Apr 18 16:14:19 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 18 Apr 2013 16:14:19 +0100
Subject: [rabbitmq-discuss] Proposed change to shovel
In-Reply-To: <48163C85-04EB-4B77-BD97-C96E1BD1B7B0@dushin.net>
References: <48163C85-04EB-4B77-BD97-C96E1BD1B7B0@dushin.net>
Message-ID: <8E733FE2-8F92-46D2-B38D-065966001E6F@rabbitmq.com>

Hi Fred,

So this looks reasonable enough to me, although it's not really 'failover' as such. Perhaps 'robust endpoint selection' is a better description. 

On 18 Apr 2013, at 16:04, Fred Dushin wrote:

> Hi,
> 
> I would like to consider a change to the shovel plugin, to allow the shovel to failover more predictably against the list of broker endpoints in the rabbitmq_shovel configuration.  Essentially, the idea is to try each endpoint in order of the declaration, and to use the first endpoint to which a connection can be made, instead of selecting an endpoint at random.
> 
> This does slightly violate the spirit of Erlang's "let it fail" philosophy, and I am not sure if the random endpoint selection in the current code is really more designed for clustered environments.  Perhaps it would make more sense to make the iterative failover strategy an "opt-in" feature, if not simply for the sake of backwards-compatibility.

I'm not sure why random endpoint selection was previously selected. I'll do some hg archeology and try to figure that out at some point...

BTW have you see this: http://hg.rabbitmq.com/rabbitmq-shovel/rev/81231b905a3f ?

That allows for proper 'failover' when shovels are used in a cluster, but also means that a named shovel can only run on one node at once. With that in place, a shovel worker can fail over (i.e., migrate) to another node if it's node crashes. The two things are clearly orthogonal, but it's worth being aware of.

> 
> I am providing a patch, but not suggesting that this actual change go into production code, as I really did the change for testing purposes.  I'm really more interested in whether others would find the patch useful, and whether there would be a way for us to fold a feature like this into the shovel.  If there is interest, I would be happy to contribute something more production-worthy, for review.
> 

If there is sufficient interest, then we could certainly consider a patch. Let's see how this plays out for now... 

Cheers,
Tim

From simon at rabbitmq.com  Thu Apr 18 16:23:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 18 Apr 2013 16:23:08 +0100
Subject: [rabbitmq-discuss] Proposed change to shovel
In-Reply-To: <48163C85-04EB-4B77-BD97-C96E1BD1B7B0@dushin.net>
References: <48163C85-04EB-4B77-BD97-C96E1BD1B7B0@dushin.net>
Message-ID: <51700FDC.4090708@rabbitmq.com>

On 18/04/13 16:04, Fred Dushin wrote:
> I would like to consider a change to the shovel plugin, to allow the
> shovel to failover more predictably against the list of broker endpoints
> in the rabbitmq_shovel configuration.  Essentially, the idea is to try
> each endpoint in order of the declaration, and to use the first endpoint
> to which a connection can be made, instead of selecting an endpoint at
> random.

Why? How is this better than the random selection?

> This does slightly violate the spirit of Erlang's "let it fail"
> philosophy, and I am not sure if the random endpoint selection in the
> current code is really more designed for clustered environments.

Yeah, that's the intention.

>   Perhaps it would make more sense to make the iterative failover
> strategy an "opt-in" feature, if not simply for the sake of
> backwards-compatibility.

We could do that. But I'd like to see a reason for this feature to exist.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From carl.hoerberg at gmail.com  Thu Apr 18 16:25:42 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 18 Apr 2013 08:25:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Mgmt API stopped reporting a lot of stuff
In-Reply-To: <1366274503665-26065.post@n5.nabble.com>
References: <1366274503665-26065.post@n5.nabble.com>
Message-ID: <1366298742574-26077.post@n5.nabble.com>

I guess it's the statistics db that have crashed or something. Is it possible
to restart it while the cluster is online?  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Mgmt-API-stopped-reporting-a-lot-of-stuff-tp26065p26077.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From oscar.bego at gmail.com  Thu Apr 18 16:44:42 2013
From: oscar.bego at gmail.com (=?UTF-8?Q?Oscar_Beltr=C3=A1n?=)
Date: Thu, 18 Apr 2013 08:44:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Dynamic route
Message-ID: <0cb3d794-71de-4c97-afb9-58988a8921ee@googlegroups.com>

How a build the pattern dynamic route? by example recipient list with 
dynamic route.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130418/b3523850/attachment.htm>

From simon at rabbitmq.com  Thu Apr 18 16:48:58 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 18 Apr 2013 16:48:58 +0100
Subject: [rabbitmq-discuss] Mgmt API stopped reporting a lot of stuff
In-Reply-To: <1366298742574-26077.post@n5.nabble.com>
References: <1366274503665-26065.post@n5.nabble.com>
	<1366298742574-26077.post@n5.nabble.com>
Message-ID: <517015EA.9030708@rabbitmq.com>

On 18/04/13 16:25, carlhoerberg wrote:
> I guess it's the statistics db that have crashed or something.

I would guess so.

> Is it possible
> to restart it while the cluster is online?

It should restart automatically. Is there anything in the (sasl) log 
about that?

You might be able to forcibly restart it with:

# rabbitmqctl eval 'application:stop(rabbitmq_management), 
application:start(rabbitmq_management).'

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Apr 18 16:49:52 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 18 Apr 2013 16:49:52 +0100
Subject: [rabbitmq-discuss] Dynamic route
In-Reply-To: <0cb3d794-71de-4c97-afb9-58988a8921ee@googlegroups.com>
References: <0cb3d794-71de-4c97-afb9-58988a8921ee@googlegroups.com>
Message-ID: <51701620.5010707@rabbitmq.com>

On 18/04/13 16:44, Oscar Beltr?n wrote:
> How a build the pattern dynamic route? by example recipient list with
> dynamic route.

That's... not very clear. What do you want to make dynamic? Can you give 
an example?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From bryan.quigley at canonical.com  Thu Apr 18 16:50:26 2013
From: bryan.quigley at canonical.com (Bryan Quigley)
Date: Thu, 18 Apr 2013 11:50:26 -0400
Subject: [rabbitmq-discuss] RABBITMQ_SERVER_ERL_ARGS overridden for
	debugging purposes only?
Message-ID: <51701642.10502@canonical.com>

The documentation here [1] says that we should only specify
RABBITMQ_/SERVER_ERL_ARGS for debugging purposes.  Is this still the
case?  A search of this list does seem to show people using it for
production purposes.  I would be happy to help update the documentation
if it is out-of-date.

My specific use case is stopping the beam port from being externally
accessible.  (Some organizations have to justify every port that tries
to listen externally)
I was able to do it with the following in my rabbitmq-env.conf:
RABBITMQ_NODE_IP_ADDRESS="192.168.1.100"
SERVER_ERL_ARGS="-kernel inet_default_listen_options -kernel
inet_default_connect_options [{nodelay,true}] -kernel
inet_dist_use_interface {127,0,0,1}"
export ERL_EPMD_ADDRESS=127.0.0.1
export RABBITMQ_NODENAME=rabbit at localhost

The specific ERL_ARGS option to do this was -kernel
inet_dist_use_interface {127,0,0,1}

Confirmation test results:
lsof output with specific ERL_ARGS:
beam 3871 rabbitmq 7u IPv4 20936 0t0 TCP localhost:39387 (LISTEN)

lsof output without specific ERL_ARGS:
beam 4002 rabbitmq 8u IPv4 21419 0t0 TCP *:34264 (LISTEN)

Is there a better way to bind beam to localhost that I missed?

Thank you!
Bryan Quigley

[1] http://www.rabbitmq.com/configure.html

P.S.
The localhost question is actually pretty popular (top one about
RabbitMQ on the site):
(None of the solutions actually work for beam)
http://serverfault.com/questions/235669/how-do-i-make-rabbitmq-listen-only-to-localhost

Another similar use case is to just specify a range/port that beam
should be listening.

From danb at aeriandi.com  Thu Apr 18 16:53:22 2013
From: danb at aeriandi.com (danb)
Date: Thu, 18 Apr 2013 08:53:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Queues versus Bindings
Message-ID: <1366300402278-26082.post@n5.nabble.com>

For my scenario, what's better: a queue with 6000 bindings, or 6000 queues
each with one binding?

My Scenario:

In my application I'd expect perhaps 1 to 20 messages per "binding" over
about 3 minutes. So if I take the many queues approach the queues will be
mostly idle, and I would destroy the queue after around 3 minutes so they
would be relatively short lived. I only have one process listening to the
messages using one connection with multiple channels.

Note: 6000, over 3 minutes means I'll be creating and deleting 33 queues per
second. Or alternatively adding or removing 33 bindings per second.

In the thread
http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-with-many-queues-td26033.html
Emile mentions that Rabbit can declare an "enormous number of idle queues
without difficulty". But I remember reading that Rabbit uses one Thread per
Queue, so I'm wondering what an enormous number is? 

Many Thanks!

Regards,

Daniel





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Queues-versus-Bindings-tp26082.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From cjbhaines at gmail.com  Thu Apr 18 12:37:40 2013
From: cjbhaines at gmail.com (Chris Haines)
Date: Thu, 18 Apr 2013 04:37:40 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET Client ConnectionFactory threading issues
Message-ID: <9ed4e339-a6e5-4018-a971-add4a68efcbc@googlegroups.com>

Hi All,

I have attached a .cs Nunit test fixture to demonstrate a problem I am 
having with the ConnectionFactory. If I create 100 connections in a for 
loop single threaded then I can create them all in about 2 seconds. If I 
create them via a number of threads, in my test I am using 100 threads to 
create a connection on each, then I get a lot of timeout exceptions (my 
test bails out after 60 seconds). I have tried sharing an instance of the 
ConnectionFactory between all threads and also giving each thread its own 
instance but they both have the same result. I have also tried locking 
around the call to CreateConnection but that also didn't help. 

I find this behavior to be very strange. Has anyone else had similar 
problems?

Cheers,
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130418/327467a6/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ConnectionFactoryTests.cs
Type: text/x-csharp
Size: 4643 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130418/327467a6/attachment.bin>

From cjbhaines at gmail.com  Thu Apr 18 12:38:34 2013
From: cjbhaines at gmail.com (Chris Haines)
Date: Thu, 18 Apr 2013 04:38:34 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET Client ConnectionFactory threading
	issues
In-Reply-To: <9ed4e339-a6e5-4018-a971-add4a68efcbc@googlegroups.com>
References: <9ed4e339-a6e5-4018-a971-add4a68efcbc@googlegroups.com>
Message-ID: <5c9ceef8-1396-4895-8986-19acb48fbf66@googlegroups.com>

Sorry I forgot to mention. I am using the version 3.0.4 
client libraries and server.

On Thursday, 18 April 2013 12:37:40 UTC+1, Chris Haines wrote:
>
> Hi All,
>
> I have attached a .cs Nunit test fixture to demonstrate a problem I am 
> having with the ConnectionFactory. If I create 100 connections in a for 
> loop single threaded then I can create them all in about 2 seconds. If I 
> create them via a number of threads, in my test I am using 100 threads to 
> create a connection on each, then I get a lot of timeout exceptions (my 
> test bails out after 60 seconds). I have tried sharing an instance of the 
> ConnectionFactory between all threads and also giving each thread its own 
> instance but they both have the same result. I have also tried locking 
> around the call to CreateConnection but that also didn't help. 
>
> I find this behavior to be very strange. Has anyone else had similar 
> problems?
>
> Cheers,
> Chris
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130418/74f39657/attachment.htm>

From simon at rabbitmq.com  Thu Apr 18 17:01:05 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 18 Apr 2013 17:01:05 +0100
Subject: [rabbitmq-discuss] Queues versus Bindings
In-Reply-To: <1366300402278-26082.post@n5.nabble.com>
References: <1366300402278-26082.post@n5.nabble.com>
Message-ID: <517018C1.1080701@rabbitmq.com>

On 18/04/13 16:53, danb wrote:
> For my scenario, what's better: a queue with 6000 bindings, or 6000 queues
> each with one binding?
>
> My Scenario:
>
> In my application I'd expect perhaps 1 to 20 messages per "binding" over
> about 3 minutes. So if I take the many queues approach the queues will be
> mostly idle, and I would destroy the queue after around 3 minutes so they
> would be relatively short lived. I only have one process listening to the
> messages using one connection with multiple channels.

In that scenario I would go for just one queue; it just feels less 
complicated.

> Note: 6000, over 3 minutes means I'll be creating and deleting 33 queues per
> second. Or alternatively adding or removing 33 bindings per second.

While that rate of binding churn is tolerable I might try to figure out 
if it's possible to live without it - creating / deleting a binding is 
rather more work than publishing / consuming a message. If you must have 
that much churn you might want to ensure at least one of your queue and 
exchange are non-durable, otherwise you will force an fsync after each 
bind / unbind.

> In the thread
> http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-with-many-queues-td26033.html
> Emile mentions that Rabbit can declare an "enormous number of idle queues
> without difficulty". But I remember reading that Rabbit uses one Thread per
> Queue, so I'm wondering what an enormous number is?

It uses one *Erlang process* per queue - but Erlang processes are 
designed to be much more lightweight than native threads. Typically we 
limit the Erlang VM to 1M processes by default, but that limit can be 
exceeded with a reconfigure.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Apr 18 17:35:21 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 18 Apr 2013 17:35:21 +0100
Subject: [rabbitmq-discuss] RabbitMQ Queues memory leak?
In-Reply-To: <CAHWt7w3SBaC8LbEywLnA8npH4dzROPQE_i8OO+1CXeLxLuo+3Q@mail.gmail.com>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
	<CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
	<CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>
	<CAHWt7w0+H87VoXnSuqhVi6FAsm_PbtEbuvH_H=CckWX6k9sW6g@mail.gmail.com>
	<CAE3HoVTcg54NCD9DmsPuZB8vjvB8HXxg0kLwO2hUtp2hjVBFiw@mail.gmail.com>
	<CAHWt7w0pDVbews1OWGsJTv3aOOk-K26PEHLBn=F=Yctg6rc41w@mail.gmail.com>
	<CAHWt7w0xoKZ3v8JpZVrs+b-_NW_u6JqPuNjb5KmAEmn7rf5VmA@mail.gmail.com>
	<516FD175.2050302@rabbitmq.com>
	<CAHWt7w3SBaC8LbEywLnA8npH4dzROPQE_i8OO+1CXeLxLuo+3Q@mail.gmail.com>
Message-ID: <517020C9.30803@rabbitmq.com>


Hi Dmitry,

On 18/04/13 12:52, Dmitry Saprykin wrote:
> Could you take a look at memory consumption of cdaemon4 node. Report
> contains data for both cluster nodes.
> 
> {memory,
>      [{total,859404112},
>       {connection_procs,4832056},
>       {queue_procs,!!!189148496!!!},
> 

The difference between 1Mb and 180Mb is relatively large, even after
taking expected differences due to garbage collection into account. We
can't rule out a memory leak, but need some assistance from you to confirm.

Do you see the same asymmetry if the master node for the queues switch
from one node to the other? So if you shut the cdaemon2 node, let
cdaemon4 become the master for all the queue, turn cdaemon2 back on (it
will now be a slave node) does the memory on cdaemon2 now grow?

Have you been able to add a third node to the cluster for testing
purposes to see if memory grows on more than one slave node?

How long does it take for the memory use to reach the VM memory high
watermark? Does the memory use increase linearly?

Can you describe your messaging pattern in a bit more detail for us to
reproduce the problem - how often are new channels created when publishing?

In order to investigate further it might be helpful to execute some
diagnostic commands on the broker. Are you able to replicate the problem
in a staging or QA environment where it is safe to do this?



-Emile





From emile at rabbitmq.com  Thu Apr 18 18:10:05 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 18 Apr 2013 18:10:05 +0100
Subject: [rabbitmq-discuss] RABBITMQ_SERVER_ERL_ARGS overridden for
 debugging purposes only?
In-Reply-To: <51701642.10502@canonical.com>
References: <51701642.10502@canonical.com>
Message-ID: <517028ED.5080409@rabbitmq.com>


Hi,

On 18/04/13 16:50, Bryan Quigley wrote:
> SERVER_ERL_ARGS="-kernel inet_default_listen_options -kernel
> inet_default_connect_options [{nodelay,true}] -kernel
> inet_dist_use_interface {127,0,0,1}"

You could equally well place the configuration in the rabbitmq.config
file, as illustrated in the serverfault link that you listed.

It is worth pointing out that access to the port is useless without the
.erlang.cookie file.

This is completely unsupported and should not be performed in a
production environment, but removing "-sname <arg>" parameter in the
startup scripts will prevent the Erlang distribution framework from
starting, and hence listening on an external port. There is no way of
achieving this with configuration.



-Emile







From oscar.bego at gmail.com  Thu Apr 18 19:34:30 2013
From: oscar.bego at gmail.com (=?ISO-8859-1?Q?Oscar_Beltr=E1n?=)
Date: Thu, 18 Apr 2013 12:34:30 -0600
Subject: [rabbitmq-discuss] Dynamic route
Message-ID: <CAAdUACTnTv-o0f_ZY+oduatTYp34eDg3Cwn07dOitP6GJHTtfQ@mail.gmail.com>

Ok, I'll try but my english is bad.

How a build the pattern dynamic route? by example recipient list with
dynamic route.

I can send commands to queue "cmds", other app (app-1) read this messages,
by each message this app create a thread for read the queue "cmds" with a
 key routing, then, how avoid the arrival to the  messages the
application-1 for messages that have been routed.

thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130418/6a2fed9f/attachment.htm>

From ilya at segment.io  Thu Apr 18 20:44:37 2013
From: ilya at segment.io (Ilya Volodarsky)
Date: Thu, 18 Apr 2013 15:44:37 -0400
Subject: [rabbitmq-discuss] Growing Memory Use and Queues
In-Reply-To: <516FBEC2.6020600@rabbitmq.com>
References: <ee8bca94-b015-4928-a1f3-7e258da28207@googlegroups.com>
	<9c01f9bb-548d-4153-8bb0-0962ebcc2553@googlegroups.com>
	<516FBEC2.6020600@rabbitmq.com>
Message-ID: <784D4C2E5F4F4265AAEE0AAC2750C82F@segment.io>

Awesome, will give upgrade a try :) Thanks Simon! 

-- Ilya


On Thursday, April 18, 2013 at 5:37 AM, Simon MacMullen wrote:

> On 17/04/13 20:18, Ilya Volodarsky wrote:
> > It seems like a memory leak or bug in garbage collection. Looking at the
> > changelog for the versions of RMQ I don't see anything super relevant
> > that would fix by updating to 3.0.4.
> > 
> 
> 
> You are probably seeing this, fixed in 3.0.2:
> 
> 25353 fix issue preventing idle queues from hibernating sometimes
> 
> The key point is that queues GC when they are working, and when they 
> hibernate. A queue that is not doing work but has also not hibernated 
> might not GC for a long time. So an upgrade is suggested after all :-)
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130418/be34bc87/attachment.htm>

From carl.hoerberg at gmail.com  Thu Apr 18 23:50:54 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 18 Apr 2013 15:50:54 -0700 (PDT)
Subject: [rabbitmq-discuss] Mgmt API stopped reporting a lot of stuff
In-Reply-To: <517015EA.9030708@rabbitmq.com>
References: <1366274503665-26065.post@n5.nabble.com>
	<1366298742574-26077.post@n5.nabble.com>
	<517015EA.9030708@rabbitmq.com>
Message-ID: <1366325454804-26090.post@n5.nabble.com>

Yes, sasl log on one of the nodes reported: 

=CRASH REPORT==== 18-Apr-2013::02:02:13 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.27601.766>
    registered_name: []
    exception exit: {badarith,[{rabbit_mgmt_db,rate,5},
                               {rabbit_mgmt_db,'-rates/5-lc$^0/1-0-',5},
                               {rabbit_mgmt_db,rates,5},
                               {rabbit_mgmt_db,handle_stats,6},
                               {rabbit_mgmt_db,handle_cast,2},
                               {gen_server2,handle_msg,2},
                               {proc_lib,init_p_do_apply,3}]}
      in function  gen_server2:terminate/3
    ancestors: [<0.4529.0>,rabbit_mgmt_sup,<0.4418.0>]
    messages: []
    links: [<0.4529.0>]
    dictionary: [{delegate,delegate_11}]
    trap_exit: false
    status: running
    heap_size: 317811
    stack_size: 24
    reductions: 8391471040
  neighbours:





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Mgmt-API-stopped-reporting-a-lot-of-stuff-tp26065p26090.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Fri Apr 19 00:08:20 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 18 Apr 2013 16:08:20 -0700 (PDT)
Subject: [rabbitmq-discuss] Mgmt API stopped reporting a lot of stuff
In-Reply-To: <1366325454804-26090.post@n5.nabble.com>
References: <1366274503665-26065.post@n5.nabble.com>
	<1366298742574-26077.post@n5.nabble.com>
	<517015EA.9030708@rabbitmq.com>
	<1366325454804-26090.post@n5.nabble.com>
Message-ID: <1366326500907-26091.post@n5.nabble.com>

The eval thing didn't work (it never returned..) and the nodes can't be
restarted gracefully, 
"rabbitmqctl status" hangs indefinitely.. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Mgmt-API-stopped-reporting-a-lot-of-stuff-tp26065p26091.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Fri Apr 19 00:37:21 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 18 Apr 2013 16:37:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Mgmt API stopped reporting a lot of stuff
In-Reply-To: <1366326500907-26091.post@n5.nabble.com>
References: <1366274503665-26065.post@n5.nabble.com>
	<1366298742574-26077.post@n5.nabble.com>
	<517015EA.9030708@rabbitmq.com>
	<1366325454804-26090.post@n5.nabble.com>
	<1366326500907-26091.post@n5.nabble.com>
Message-ID: <1366328241249-26092.post@n5.nabble.com>

So tiger03 was the node that had the stats db, which crashed, it couldn't be
restarted gracefully either, so did a "kill -9". The stats db moved to
tiger01, so everything works fine there now, but tiger02 reports: 

=ERROR REPORT==== 18-Apr-2013::23:14:56 ===
webmachine error: path="/api/overview"
{error,{error,{badmatch,false},
              [{rabbit_mgmt_wm_overview,version,1},
               {rabbit_mgmt_wm_overview,to_json,2},
               {webmachine_resource,resource_call,3},
               {webmachine_resource,do,3},
               {webmachine_decision_core,resource_call,1},
               {webmachine_decision_core,decision,1},
               {webmachine_decision_core,handle_request,2},
               {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}}

When tiger03 started again the log contains a lot of these:

=ERROR REPORT==== 18-Apr-2013::23:14:36 ===
** Generic server <0.6527.4> terminating
** Last message in was {init,<0.3561.0>}
** When Server state == {q,{amqqueue,
                               {resource,<<"vhost1">>,queue,
                                   <<"tmp_topic-0.1643550938460976">>},
                               true,true,<0.12110.2>,[],<0.6527.4>,[],[],
                               [{vhost,<<"vhost1">>},
                                {name,<<"HA">>},
                                {pattern,<<".*">>},
                                {definition,[{<<"ha-mode">>,<<"all">>}]},
                                {priority,0}],
                               [{<4861.12913.2>,<4861.12912.2>},
                                {<4637.186.1>,<4637.185.1>},
                                {<0.15006.2>,<0.12987.2>}]},
                           none,false,undefined,undefined,
                           {[],[]},
                           undefined,undefined,undefined,undefined,
                           {state,fine,5000,undefined},
                           {0,nil},
                           undefined,undefined,undefined,
                           {dict,0,16,16,8,80,48,
                              
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                              
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []}}},
                           1,
                           {{0,nil},{0,nil}},
                           undefined,
                           {dict,0,16,16,8,80,48,
                              
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                              
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []}}},
                           undefined,undefined}
** Reason for termination == 
** {'module could not be loaded',
       [{undefined,init,
            [{amqqueue,
                 {resource,<<"vhost1">>,queue,
                     <<"tmp_topic-0.1643550938460976">>},
                 true,true,<0.12110.2>,[],<0.6527.4>,[],[],
                 [{vhost,<<"vhost1">>},
                  {name,<<"HA">>},
                  {pattern,<<".*">>},
                  {definition,[{<<"ha-mode">>,<<"all">>}]},
                  {priority,0}],
                 [{<4861.12913.2>,<4861.12912.2>},
                  {<4637.186.1>,<4637.185.1>},
                  {<0.15006.2>,<0.12987.2>}]},
             true,#Fun<rabbit_amqqueue_process.5.64830354>]},
        {rabbit_amqqueue_process,handle_call,3},
        {gen_server2,handle_msg,2},
        {proc_lib,wake_up,3}]}

and it stopped at "starting adding mirrors to queues                                    
...", but most notably, the whole cluster stopped deliver any messages!

The sasl log for tiger03 also contains:

=SUPERVISOR REPORT==== 18-Apr-2013::23:14:36 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    child_terminated
     Reason:     {undef,
                     [{undefined,init,
                          [{amqqueue,
                               {resource,<<"vhost1">>,queue,
                                   <<"tmp_topic-0.1643550938460976">>},
                               true,true,<0.12110.2>,[],<0.6527.4>,[],[],
                               [{vhost,<<"vhost1">>},
                                {name,<<"HA">>},
                                {pattern,<<".*">>},
                                {definition,[{<<"ha-mode">>,<<"all">>}]},
                                {priority,0}],
                               [{<4861.12913.2>,<4861.12912.2>},
                                {<4637.186.1>,<4637.185.1>},
                                {<0.15006.2>,<0.12987.2>}]},
                           true,#Fun<rabbit_amqqueue_process.5.64830354>]},
                      {rabbit_amqqueue_process,handle_call,3},
                      {gen_server2,handle_msg,2},
                      {proc_lib,wake_up,3}]}
     Offender:   [{pid,<0.6527.4>},
                  {name,rabbit_amqqueue},
                  {mfa,
                      {rabbit_amqqueue_process,start_link,
                          [{amqqueue,
                               {resource,<<"vhost1">>,queue,
                                   <<"tmp_topic-0.1643550938460976">>},
                               true,true,<0.12110.2>,[],<0.12987.2>,[],[],
                               [{vhost,<<"vhost1">>},
                                {name,<<"HA">>},
                                {pattern,<<".*">>},
                                {definition,[{<<"ha-mode">>,<<"all">>}]},
                                {priority,0}],
                               [{<4861.12913.2>,<4861.12912.2>},
                                {<4637.186.1>,<4637.185.1>},
                                {<0.15006.2>,<0.12987.2>}]}]}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Mgmt-API-stopped-reporting-a-lot-of-stuff-tp26065p26092.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Fri Apr 19 00:50:31 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 18 Apr 2013 16:50:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Mgmt API stopped reporting a lot of stuff
In-Reply-To: <1366328241249-26092.post@n5.nabble.com>
References: <1366274503665-26065.post@n5.nabble.com>
	<1366298742574-26077.post@n5.nabble.com>
	<517015EA.9030708@rabbitmq.com>
	<1366325454804-26090.post@n5.nabble.com>
	<1366326500907-26091.post@n5.nabble.com>
	<1366328241249-26092.post@n5.nabble.com>
Message-ID: <1366329031450-26093.post@n5.nabble.com>

The second restart attempt of tiger03 puts the following in startup_err:

Crash dump was written to: erl_crash.dump
eheap_alloc: Cannot allocate 4454408120 bytes of memory (of type "heap").

The log file was filled with these during startup:
=ERROR REPORT==== 18-Apr-2013::23:40:10 ===
Discarding message {'$gen_call',{<0.27239.1>,#Ref<0.0.0.102362>},stat} from
<0.27239.1> to <0.5995.4> in an old incarnation (3) of this node (1)



When tiger03 was killed the first time tiger02 reported this in the sasl:

=CRASH REPORT==== 18-Apr-2013::23:11:42 ===
  crasher:
    initial call: application_master:init/4
    pid: <0.9.743>
    registered_name: []
    exception exit: {bad_return,
                     {{rabbit_mgmt_app,start,[normal,[]]},
                      {'EXIT',
                       {{shutdown,
                         [{{nodedown,rabbit at tiger03},
                           {gen_server,call,
                            [<6872.4529.0>,which_children,infinity]}}]},
                        {gen_server2,call,
                         [<0.47.743>,{init,<0.45.743>},infinity]}}}}}
      in function  application_master:init/4
    ancestors: [<0.8.743>]
    messages: [{'EXIT',<0.10.743>,normal}]
    links: [<0.8.743>,<0.7.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 377
    stack_size: 24
    reductions: 116
  neighbours:

=SUPERVISOR REPORT==== 18-Apr-2013::23:11:42 ===
     Supervisor: {local,rabbit_mgmt_sup}
     Context:    child_terminated
     Reason:     {shutdown,
                     [{{nodedown,rabbit at tiger03},
                       {gen_server,call,
                           [<6872.4529.0>,which_children,infinity]}}]}
     Offender:   [{pid,<0.47.743>},
                  {name,mirroring},
                  {mfa,
                      {mirrored_supervisor,start_internal,
                          [rabbit_mgmt_sup,
                           [{rabbit_mgmt_db,
                                {rabbit_mgmt_db,start_link,[]},
                                permanent,4294967295,worker,
                                [rabbit_mgmt_db]}]]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Apr-2013::23:11:42 ===
     Supervisor: {local,rabbit_mgmt_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.47.743>},
                  {name,mirroring},
                  {mfa,
                      {mirrored_supervisor,start_internal,
                          [rabbit_mgmt_sup,
                           [{rabbit_mgmt_db,
                                {rabbit_mgmt_db,start_link,[]},
                                permanent,4294967295,worker,
                                [rabbit_mgmt_db]}]]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]

And now it doesn't respond to "rabbitmqctl status" any longer either, a
"rabbitmqctl stop" gives the following in the log:

=INFO REPORT==== 18-Apr-2013::23:45:40 ===
Stopping RabbitMQ

=INFO REPORT==== 18-Apr-2013::23:45:40 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: temporary

but nothing else. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Mgmt-API-stopped-reporting-a-lot-of-stuff-tp26065p26093.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Fri Apr 19 01:13:52 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 18 Apr 2013 17:13:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Mgmt API stopped reporting a lot of stuff
In-Reply-To: <1366329031450-26093.post@n5.nabble.com>
References: <1366274503665-26065.post@n5.nabble.com>
	<1366298742574-26077.post@n5.nabble.com>
	<517015EA.9030708@rabbitmq.com>
	<1366325454804-26090.post@n5.nabble.com>
	<1366326500907-26091.post@n5.nabble.com>
	<1366328241249-26092.post@n5.nabble.com>
	<1366329031450-26093.post@n5.nabble.com>
Message-ID: <1366330432237-26094.post@n5.nabble.com>

When I "kill -9" tiger02, tiger01 reported this in the sasl:
=CRASH REPORT==== 18-Apr-2013::23:51:35 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.29816.660>
    registered_name: []
    exception exit: {badarith,[{rabbit_mgmt_db,rate,5},
                               {rabbit_mgmt_db,'-rates/5-lc$^0/1-0-',5},
                               {rabbit_mgmt_db,rates,5},
                               {rabbit_mgmt_db,handle_stats,6},
                               {rabbit_mgmt_db,handle_cast,2},
                               {gen_server2,handle_msg,2},
                               {proc_lib,init_p_do_apply,3}]}
      in function  gen_server2:terminate/3
    ancestors: [<0.5880.0>,rabbit_mgmt_sup,<0.5843.0>]
    messages: []
    links: [<0.5880.0>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 832040
    stack_size: 24
    reductions: 3582745480
  neighbours:

and stopped working. Any calls to /api/overview or "rabbitmqctl status" just
hangs, as does "rabbitmqctl stop", this time the only output in the log is:

=INFO REPORT==== 18-Apr-2013::23:55:51 ===
Stopping RabbitMQ

I killed tiger01 and started it again, the sasl log then contained a couple
of these:

=SUPERVISOR REPORT==== 18-Apr-2013::23:57:27 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    child_terminated
     Reason:     {undef,
                     [{undefined,init,
                          [{amqqueue,
                               {resource,<<"vhost3">>,queue,
                                   <<"tmp_topic-0.4612013988662511">>},
                               true,true,<0.11266.6402>,[],<0.817.0>,[],[],
                               undefined,[]},
                           true,#Fun<rabbit_amqqueue_process.5.64830354>]},
                      {rabbit_amqqueue_process,handle_call,3},
                      {gen_server2,handle_msg,2},
                      {proc_lib,wake_up,3}]}
     Offender:   [{pid,<0.817.0>},
                  {name,rabbit_amqqueue},
                  {mfa,
                      {rabbit_amqqueue_process,start_link,
                          [{amqqueue,
                               {resource,<<"vhost3">>,queue,
                                   <<"tmp_topic-0.4612013988662511">>},
                              
true,true,<0.11266.6402>,[],<0.11437.6402>,[],
                               [],undefined,[]}]}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]


And even though all queues are mirrored, tiger01 still produces a lot of
these, while tiger03 hasn't been started yet: 

=ERROR REPORT==== 19-Apr-2013::00:07:49 ===
connection <0.28262.92>, channel 1 - soft error:
{amqp_error,not_found,
            "home node 'rabbit at tiger03' of durable queue 'celery' in vhost
'vhost2' is down or inaccessible",
            'queue.declare'}





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Mgmt-API-stopped-reporting-a-lot-of-stuff-tp26065p26094.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From pdezwart at rubiconproject.com  Fri Apr 19 07:46:53 2013
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Fri, 19 Apr 2013 01:46:53 -0500
Subject: [rabbitmq-discuss] FW: [PECL-DEV] [ANNOUNCEMENT] amqp-1.0.10
	(stable) Released.
In-Reply-To: <20130419064110.92677.qmail@pb12.pair.com>
Message-ID: <CD963615.3B525%pdezwart@rubiconproject.com>

Just released v1.0.10 of the native PHP AMQP client. All credit goes to
Bernhard and Lars for continuing to work on and improve this package.



On 4/18/13 11:41 PM, "PECL Announce" <pecl-dev at lists.php.net> wrote:

>The new PECL package amqp-1.0.10 (stable) has been released at
>http://pecl.php.net/.
>
>Release notes
>-------------
>1.0.10 Release:
>    * report correct version in module info (Lars Strojny)
>    * fix class interface definitions (Vladimir Kartaviy)
>    * add ability to bind a queue with an empty routing key (Vladimir
>Kartaviy)
>    * fix constant AMQP_IFUNUSED (Florin Patan, Bernhard Weisshuhn)
>    * added stubs for ide use (Vladimir Kartaviy, Bernhard Weisshuhn)
>    * Fixed memory leak in queue->declareQueue (Ilya a.k.a. coodix)
>    * support for php 5.5 (Lars Strojny)
>    * add support for read and write timeouts (Bogdan Padalko)
>    * fix memory leak in queue->consume (Dmitry Vinogradov)
>    * add support for custom exchange types (empi89)
>    * support for nested custom headers (Bernhard Weisshuhn)
>    * fix memory (Bernhard Weisshuhn)
>
>    For a complete list of changes see:
>    https://github.com/pdezwart/php-amqp/compare/v1.0.9...v1.0.10
>
>1.0.9 Release:
>    * Fix pecl relase
>
>1.0.8 Release:
>    * Skip var_dump test on PHP 5.2
>    * Initialize consumer tag string length to zero
>    * Support connection time outs
>    * Adding consumer_tag parameter to AMQPQueue::cancel
>    * Clean up error code handling
>
>1.0.6 Release:
>    * 62354: Segmentation fault when printing or dumping an object that
>contains an AMQP object
>    * Adding in missing tests
>    * Fixing release number in PHP information
>    * Adding .gitignore info for Git users
>    * Cleaning up debug handling
>
>1.0.5 Release:
>    * 62696: Incorrect exchange type
>    * Handles server connections being closed during consume and publish
>correctly
>    * 62628: Exception thrown in consume will lock PHP
>    * 61533: Segmentation fault when instantiating channel, queue or
>exchange with wrong object, then using it
>
>1.0.4 Release:
>    * 62549: Fixing broken persistent connection
>    * 62412: Fixing segfault due to destruction order
>    * 62411: Fixing declaration overload bug
>    * 62410: Fixing declaration overload for 5.4
>    * 61337: Adding License file
>    * 61749: Fixing handling for binary content in envelope
>    * 62087: Adding appropriate version information
>    * 62354: Enabling debugging dumping of objects
>    * 61351: Updating min PHP version requirements to 5.2.0
>
>1.0.3 Release:
>    * Fixing compilation issue with PHP 5.4
>
>1.0.2 Release:
>Fixed bug:
>    * Memory leak when using AMQPQueue::get from a queue with no messages
>
>1.0.1 Release:
>Fixed bug:
>    * 61247: Allow queue creation with empty queue name, and return auto
>generated name
>    * 61127: Segmentation fault when cleaning up an AMQPChannel without
>calling AMQPConnection::connect first
>
>1.0.0 Release:
>Changed/finalized API signature:
>    * Exposing AMQPChannel
>    * Exposing AMQPEnvelope
>    * Exposing more queue and exchange arguments and flags
>    * Exposing basic.qos
>Added persistent connections
>Cleaned up codebase
>Fixed memory leaks and segmentation faults
>
>0.3.1 Release:
>Fixed bug:
>    * 24323: Cannot get the name for auto-named reply-to queues
>
>0.3.0 Release:
>Fixed memory leaks in many functions (courtesy Jonathan Tansavatdi and
>Andy Wick)
>Fixed consume method to return proper values
>Cleaned up variable usage
>Fixed bugs:
>    * 22638: Unexpected exit code 1 with AMQPQueue::consume()
>    * 22698: AMQPQueue::consume
>
>0.2.2 Release:
>Made extension compatible with PHP lt 5.3 (courtesy John Skopis)
>Fixed wrong typing of message properties (courtesy John Skopis)
>
>0.2.1 Release:
>Fixed refcount decrementing bug causing segfaults.
>
>0.2.0 Release:
>Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
>Modified AMQPConnection object:
>    * Requires call to 'connect' method to connect (no longer connects on
>instantiation)
>    * Added support for disconnect and reconnect
>    * Added helper setters for port, host, vhost, login and password
>Improved consume method to block for MIN messages, and try to get MAX
>messages if available
>Fixed zval descoping bugs
>Fixed bugs:
>    * 17809: Couldn't compile pecl extension under PHP 5.3
>    * 17831: Segmentation fault when the exchange doesn't exists
>    * 19707: AMQPQueue::get() doesn't return the message
>    * 19840: Connection Exception
>
>Package Info
>-------------
>This extension can communicate with any AMQP spec 0-9-1 compatible
>server, such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to
>create and delete exchanges and queues, as well as publish to any
>exchange and consume from any queue.
>
>Related Links
>-------------
>Package home: http://pecl.php.net/package/amqp
>   Changelog: http://pecl.php.net/package-changelog.php?package=amqp
>    Download: http://pecl.php.net/get/amqp-1.0.10.tgz
>
>Authors
>-------------
>Pieter de Zwart (lead)
>
>
>-- 
>PECL development discussion Mailing List (http://pecl.php.net/)
>To unsubscribe, visit: http://www.php.net/unsub.php
>


From lars at strojny.net  Fri Apr 19 08:40:25 2013
From: lars at strojny.net (Lars Strojny)
Date: Fri, 19 Apr 2013 09:40:25 +0200
Subject: [rabbitmq-discuss] [PECL-DEV] [ANNOUNCEMENT] amqp-1.0.10
	(stable) Released.
In-Reply-To: <CD963615.3B525%pdezwart@rubiconproject.com>
References: <CD963615.3B525%pdezwart@rubiconproject.com>
Message-ID: <A8105F85-8ED0-461A-A042-F469437195D8@strojny.net>

In all fairness, it?s mostly Bernhard, who does the work :)

Am 19.04.2013 um 08:46 schrieb Pieter de Zwart <pdezwart at rubiconproject.com>:

> Just released v1.0.10 of the native PHP AMQP client. All credit goes to
> Bernhard and Lars for continuing to work on and improve this package.


From garry at robustsoftware.co.uk  Fri Apr 19 09:04:26 2013
From: garry at robustsoftware.co.uk (Garry Shutler)
Date: Fri, 19 Apr 2013 09:04:26 +0100
Subject: [rabbitmq-discuss] .NET Client ConnectionFactory threading
	issues
In-Reply-To: <5c9ceef8-1396-4895-8986-19acb48fbf66@googlegroups.com>
References: <9ed4e339-a6e5-4018-a971-add4a68efcbc@googlegroups.com>
	<5c9ceef8-1396-4895-8986-19acb48fbf66@googlegroups.com>
Message-ID: <CAKQzhmg=omMRUjWE_HwcpLRc2X30BvY_xBJvxSeYNriOP-veBA@mail.gmail.com>

My understanding is that you should be sharing a single connection, not
connection factory, across all threads. You then use channels for that
single connection on each thread.

*Garry Shutler*
@gshutler <http://twitter.com/gshutler>
gshutler.com


On 18 April 2013 12:38, Chris Haines <cjbhaines at gmail.com> wrote:

> Sorry I forgot to mention. I am using the version 3.0.4
> client libraries and server.
>
>
> On Thursday, 18 April 2013 12:37:40 UTC+1, Chris Haines wrote:
>>
>> Hi All,
>>
>> I have attached a .cs Nunit test fixture to demonstrate a problem I am
>> having with the ConnectionFactory. If I create 100 connections in a for
>> loop single threaded then I can create them all in about 2 seconds. If I
>> create them via a number of threads, in my test I am using 100 threads to
>> create a connection on each, then I get a lot of timeout exceptions (my
>> test bails out after 60 seconds). I have tried sharing an instance of the
>> ConnectionFactory between all threads and also giving each thread its own
>> instance but they both have the same result. I have also tried locking
>> around the call to CreateConnection but that also didn't help.
>>
>> I find this behavior to be very strange. Has anyone else had similar
>> problems?
>>
>> Cheers,
>> Chris
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130419/6248b578/attachment.htm>

From saprykin.dmitry at gmail.com  Fri Apr 19 10:23:55 2013
From: saprykin.dmitry at gmail.com (Dmitry Saprykin)
Date: Fri, 19 Apr 2013 13:23:55 +0400
Subject: [rabbitmq-discuss] RabbitMQ Queues memory leak?
In-Reply-To: <517020C9.30803@rabbitmq.com>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
	<CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
	<CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>
	<CAHWt7w0+H87VoXnSuqhVi6FAsm_PbtEbuvH_H=CckWX6k9sW6g@mail.gmail.com>
	<CAE3HoVTcg54NCD9DmsPuZB8vjvB8HXxg0kLwO2hUtp2hjVBFiw@mail.gmail.com>
	<CAHWt7w0pDVbews1OWGsJTv3aOOk-K26PEHLBn=F=Yctg6rc41w@mail.gmail.com>
	<CAHWt7w0xoKZ3v8JpZVrs+b-_NW_u6JqPuNjb5KmAEmn7rf5VmA@mail.gmail.com>
	<516FD175.2050302@rabbitmq.com>
	<CAHWt7w3SBaC8LbEywLnA8npH4dzROPQE_i8OO+1CXeLxLuo+3Q@mail.gmail.com>
	<517020C9.30803@rabbitmq.com>
Message-ID: <CAHWt7w3+Q6vY7Oex0Aa16sL26trOiXJgEp18iHu5WYpR7VQvdQ@mail.gmail.com>

Hello, Emile

Thank you very much for you help. I will try to provide anything what can
help to solve this issue.


> The difference between 1Mb and 180Mb is relatively large, even after
> taking expected differences due to garbage collection into account. We
> can't rule out a memory leak, but need some assistance from you to confirm.
>
> Do you see the same asymmetry if the master node for the queues switch
> from one node to the other? So if you shut the cdaemon2 node, let
> cdaemon4 become the master for all the queue, turn cdaemon2 back on (it
> will now be a slave node) does the memory on cdaemon2 now grow?
>

Yes, after current master stops and starts it becomes slave and its memory
starts to grow.
Meantime new selected master memory does not become free. So new master
memory stops to
grow but do not fall back to normal. I have attached memory graphs of our
nodes to this letter.


>
> Have you been able to add a third node to the cluster for testing
> purposes to see if memory grows on more than one slave node?
>

We have not tied to do this yet. But if it can help we can allocate one
more node.
Is is ok to create test node at the same physical host as one of existing
nodes?


>
> How long does it take for the memory use to reach the VM memory high
> watermark?
>

Critical point for our cluster comes much more earlier than VM memory high
watermark.
The same time with memory grow slave node starts to use CPU more and more
active.
In our case when memory consumption reaches ~1Gb broker stops to respond.

After slave restart memory grows linearily some time. After that memory
grow changes its pattern.
At some moments it increases by constant step (~20Mb). I have marked these
steps on graphs attached.


> Can you describe your messaging pattern in a bit more detail for us to
> reproduce the problem - how often are new channels created when publishing?
>

Queues and exchanges:

1 queue and 1 exchange (Durable, ha-mode: all, no autodelete).

Publishers:

We have about 100 web servers which publish messages by next steps:
1) Open connection
2) Create channel
3) Publish message to direct exchange
4) close connection
Publishing rate is between 50 and 600 messages per second at peak hours.
I have attached graph.

Consumers:

We have 3 servers consuming messages in 30 threads each.
Each consuming thread
1) Thread starts
2) Open broker connection
3) Create channel
4) Get message from the queue by basic-get with prefetch=1
5) Process message and acknowledge it.
6) If there are no new messages sleep some time
7) repeat steps 4,5,6 until limit count is reached
8) Close connection
9) Thread stops


>
> In order to investigate further it might be helpful to execute some
> diagnostic commands on the broker. Are you able to replicate the problem
> in a staging or QA environment where it is safe to do this?
>

I will execute diagnostic commands on the broker. If something goes wrong
our messaging
falls back to version without rabbitMQ involved ).


> -Emile
>
>
Kind regards,
Dmitry Saprykin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130419/f5a2a732/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: cdaemon2.memory.png
Type: image/png
Size: 37015 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130419/f5a2a732/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: cdaemon4.memory.png
Type: image/png
Size: 43829 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130419/f5a2a732/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: message.publishing.png
Type: image/png
Size: 73012 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130419/f5a2a732/attachment-0002.png>

From kpoly84 at gmail.com  Fri Apr 19 11:17:10 2013
From: kpoly84 at gmail.com (Kwstantinos Polydwrou)
Date: Fri, 19 Apr 2013 12:17:10 +0200
Subject: [rabbitmq-discuss] Dead Lettering queries
In-Reply-To: <516BFCFA.3080409@rabbitmq.com>
References: <CAJM4cw11qLa_C1e99awz_f9Eir=MKbFBtt13Z90AiHZ=b2Q+Qw@mail.gmail.com>
	<516BFCFA.3080409@rabbitmq.com>
Message-ID: <CAJM4cw2=htsA1AxzbO3__qFxMjufMBEi5VdktUmDVmwoVD2AWA@mail.gmail.com>

Hi Emile,

Thank you for your reply.

Unfortunately it is still not clear to me how to make use of Dead Lettering.

Here is the scenario I am trying to implement:

Simple case:
1. A message is sent from application A.
2. Message from Application A is queued in RabbitMQ.
3. Application B receives the message from RabbitMQ and performs the
processing.
This works fine.

DL case:
1. A message is sent from application A.
2. Message from Application A is queued in RabbitMQ.
3. Application B receives the message from RabbitMQ and starts the
processing.
4. Application B throws an NPE during the processing.
5. The message from step 1 is now in DLQ, to be re-sent to application B.

Step 5 is obviously the one causing me the headache.

So some more concrete questions are:
- Do I have to bind both of my 'Test queue' and 'Dead letter queue' to the
same exchange?
- Is the '"x-dead-letter-exchange" argument to be provided in the
'Dead letter queue' declaration arguments?
- How is the 're-routing' of messages performed from the original queue to
the 'Dead letter queue'?

I realise these are too many questions, but I am rather new to RabbitMQ.
Plus, it's been hard finding examples scenario implementations :)

Best regards,
K.





On 15 April 2013 15:13, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 15/04/13 11:47, Kwstantinos Polydwrou wrote:
> > Can anyone inform me if any DL code examples/samples are available?
>
> There are some examples of use by the Java client in unit tests
> (com.rabbitmq.client.test.functional.DeadLetterExchange):
>
>
> http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/client/test/functional/DeadLetterExchange.java
>
>
>
> -Emile
>
>
>
>
>
>

On 15 April 2013 15:13, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 15/04/13 11:47, Kwstantinos Polydwrou wrote:
> > Can anyone inform me if any DL code examples/samples are available?
>
> There are some examples of use by the Java client in unit tests
> (com.rabbitmq.client.test.functional.DeadLetterExchange):
>
>
> http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/client/test/functional/DeadLetterExchange.java
>
>
>
> -Emile
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130419/c79ba901/attachment.htm>

From emile at rabbitmq.com  Fri Apr 19 11:27:22 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 19 Apr 2013 11:27:22 +0100
Subject: [rabbitmq-discuss] Dead Lettering queries
In-Reply-To: <CAJM4cw2=htsA1AxzbO3__qFxMjufMBEi5VdktUmDVmwoVD2AWA@mail.gmail.com>
References: <CAJM4cw11qLa_C1e99awz_f9Eir=MKbFBtt13Z90AiHZ=b2Q+Qw@mail.gmail.com>
	<516BFCFA.3080409@rabbitmq.com>
	<CAJM4cw2=htsA1AxzbO3__qFxMjufMBEi5VdktUmDVmwoVD2AWA@mail.gmail.com>
Message-ID: <51711C0A.9070500@rabbitmq.com>


Hi,

On 19/04/13 11:17, Kwstantinos Polydwrou wrote:
> 4. Application B throws an NPE during the processing.
You don't need dead-lettering for this scenario. If Application B
crashes while processing an unacknowledged message then that message
will be returned to the queue and will be redelivered when Application B
restarts.

See the section on message acknowledgement in the second tutorial at
http://www.rabbitmq.com/tutorials/tutorial-two-python.html

Dead-lettering is applicable when a message is rejected with the requeue
flag set to false; or if a message expires.



-Emile





From kpoly84 at gmail.com  Fri Apr 19 11:40:40 2013
From: kpoly84 at gmail.com (Kwstantinos Polydwrou)
Date: Fri, 19 Apr 2013 12:40:40 +0200
Subject: [rabbitmq-discuss] Dead Lettering queries
In-Reply-To: <51711C0A.9070500@rabbitmq.com>
References: <CAJM4cw11qLa_C1e99awz_f9Eir=MKbFBtt13Z90AiHZ=b2Q+Qw@mail.gmail.com>
	<516BFCFA.3080409@rabbitmq.com>
	<CAJM4cw2=htsA1AxzbO3__qFxMjufMBEi5VdktUmDVmwoVD2AWA@mail.gmail.com>
	<51711C0A.9070500@rabbitmq.com>
Message-ID: <CAJM4cw3+UEwty8ytQ=q9cHgo3=vqa0Ogut3Rdo5E6eSXpifzZg@mail.gmail.com>

So this would mean that I need a mechanism on my Consumer side (application
B) which will do the following:
- rejecting the message (based on some logic) and
- setting the requeue flag to false.

Thanks for the insight Emile, much appreciated.

K.


On 19 April 2013 12:27, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 19/04/13 11:17, Kwstantinos Polydwrou wrote:
> > 4. Application B throws an NPE during the processing.
> You don't need dead-lettering for this scenario. If Application B
> crashes while processing an unacknowledged message then that message
> will be returned to the queue and will be redelivered when Application B
> restarts.
>
> See the section on message acknowledgement in the second tutorial at
> http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
> Dead-lettering is applicable when a message is rejected with the requeue
> flag set to false; or if a message expires.
>
>
>
> -Emile
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130419/4a60ac4b/attachment.htm>

From emile at rabbitmq.com  Fri Apr 19 12:02:16 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 19 Apr 2013 12:02:16 +0100
Subject: [rabbitmq-discuss] Dead Lettering queries
In-Reply-To: <CAJM4cw3+UEwty8ytQ=q9cHgo3=vqa0Ogut3Rdo5E6eSXpifzZg@mail.gmail.com>
References: <CAJM4cw11qLa_C1e99awz_f9Eir=MKbFBtt13Z90AiHZ=b2Q+Qw@mail.gmail.com>
	<516BFCFA.3080409@rabbitmq.com>
	<CAJM4cw2=htsA1AxzbO3__qFxMjufMBEi5VdktUmDVmwoVD2AWA@mail.gmail.com>
	<51711C0A.9070500@rabbitmq.com>
	<CAJM4cw3+UEwty8ytQ=q9cHgo3=vqa0Ogut3Rdo5E6eSXpifzZg@mail.gmail.com>
Message-ID: <51712438.2010205@rabbitmq.com>

On 19/04/13 11:40, Kwstantinos Polydwrou wrote:
> So this would mean that I need a mechanism on my Consumer side
> (application B) which will do the following:
> - rejecting the message (based on some logic) and 
> - setting the requeue flag to false.

If you want to make sure unacknowledged messages are not lost when
Application B crashes then you don't need to do that. Unacknowledged
messages are automatically requeued if the connection drops.
See the second tutorial (message acknowledgement):
http://www.rabbitmq.com/tutorials/tutorial-two-python.html

If you want to dead-letter a message explicitly then you should set up a
dead-letter-exchange and have Application B reject the message with
requeue set to false. The Application cannot do this if it experienced a
NPE or any condition that causes the channel to close.
See http://www.rabbitmq.com/dlx.html




From Chandrashekar_B03 at infosys.com  Fri Apr 19 13:09:31 2013
From: Chandrashekar_B03 at infosys.com (Chandrashekar Basavaraj03)
Date: Fri, 19 Apr 2013 12:09:31 +0000
Subject: [rabbitmq-discuss] not able to run rabbitmq-server service
Message-ID: <CBB468D8CF4B8B4AB51CC0D3EC49F7541EDADB1F@BLRKECMBX24.ad.infosys.com>

Hi All,

I installed rabbitmq-server on RHEL6.3 and when I try to start service I am getting as RabbitMQ is currently running.
I dig the init script and found that it is always returning 0 even though service is not running.
I installed the same RPM on another RHEL6.3 machine and init script is returning 3 when service is not running which is correct.

Can someone help me on this.

Regards,
Chandrashekar

**************** CAUTION - Disclaimer *****************
This e-mail contains PRIVILEGED AND CONFIDENTIAL INFORMATION intended solely 
for the use of the addressee(s). If you are not the intended recipient, please 
notify the sender by e-mail and delete the original message. Further, you are not 
to copy, disclose, or distribute this e-mail or its contents to any other person and 
any such actions are unlawful. This e-mail may contain viruses. Infosys has taken 
every reasonable precaution to minimize this risk, but is not liable for any damage 
you may sustain as a result of any virus in this e-mail. You should carry out your 
own virus checks before opening the e-mail or attachment. Infosys reserves the 
right to monitor and review the content of all messages sent to or from this e-mail 
address. Messages sent to or from this e-mail address may be stored on the 
Infosys e-mail system.
***INFOSYS******** End of Disclaimer ********INFOSYS***
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130419/251145e0/attachment.htm>

From emile at rabbitmq.com  Fri Apr 19 14:10:18 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 19 Apr 2013 14:10:18 +0100
Subject: [rabbitmq-discuss] Hash Exchange with temporary queues
In-Reply-To: <1366219310163-26051.post@n5.nabble.com>
References: <1366219310163-26051.post@n5.nabble.com>
Message-ID: <5171423A.5000101@rabbitmq.com>


Hi,

On 17/04/13 18:21, sinsei wrote:
> The problem I've noticed is that when I shut down a consumer, some messages
> are just lost. I wasn't sure how to set this up as dead-letter-exchanges
> won't work for this case. Is there a way I can ensure those messages are
> passed somewhere else?

The consistent hash exchange is not ideal in cases where queues are
deleted and message loss cannot be tolerated. The documentation makes
clear that messages are delivered to at most one queue. Message loss can
only be prevented by not deleting queues.

It is possible to reduce the chances of message loss: instead of relying
on auto-deletion, consumers could use the if-empty flag of the
queue.delete method to delete their queue prior to shutting down.
Unfortunately this process is not guaranteed to ever complete, because a
new message may have arrived by the time processing of the last one
completes

> Also, what happens if I have no consumers, it appears the messages are just
> gone.  I may have to set up an alternative exchange?

Yes, or use the mandatory publishing flag:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish.mandatory

> I've also considered adding some grouping as a plugin so I could have a
> single durable, trunk queue, but I'm unsure if it is possible with the
> current plugin model.

It is possible to create custom exchange and queue implementations as
plugins. The potential for messages en route to a disappearing queue to
be lost will exist regardless of queue implementation.












From fred at dushin.net  Fri Apr 19 14:20:59 2013
From: fred at dushin.net (Dushin Fred)
Date: Fri, 19 Apr 2013 09:20:59 -0400
Subject: [rabbitmq-discuss] Proposed change to shovel
In-Reply-To: <51700FDC.4090708@rabbitmq.com>
References: <48163C85-04EB-4B77-BD97-C96E1BD1B7B0@dushin.net>
	<51700FDC.4090708@rabbitmq.com>
Message-ID: <63091709-A63A-47AB-A7A2-DA9A091B19FC@dushin.net>


On Apr 18, 2013, at 11:23 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 18/04/13 16:04, Fred Dushin wrote:
>> I would like to consider a change to the shovel plugin, to allow the
>> shovel to failover more predictably against the list of broker endpoints
>> in the rabbitmq_shovel configuration.  Essentially, the idea is to try
>> each endpoint in order of the declaration, and to use the first endpoint
>> to which a connection can be made, instead of selecting an endpoint at
>> random.
> 
> Why? How is this better than the random selection?

In my case, I am pushing messages across WANs, potentially to different data centers, where some are treated as backups in the case where primaries go down.  So having a list of destinations provides some resiliency in the case of network or hardware failure.  I think in cases like this, operators need some predictability in where the messages are being sent.

> 
>> This does slightly violate the spirit of Erlang's "let it fail"
>> philosophy, and I am not sure if the random endpoint selection in the
>> current code is really more designed for clustered environments.
> 
> Yeah, that's the intention.
> 
>>  Perhaps it would make more sense to make the iterative failover
>> strategy an "opt-in" feature, if not simply for the sake of
>> backwards-compatibility.
> 
> We could do that. But I'd like to see a reason for this feature to exist.

I agree that is adds complexity to a fairly tight bit of code, hence increases test complexity, imposes an maintenance burden, etc.  So I can certainly understand the reluctance to fold it in.  I am mostly curious if other users have the same set of requirements, or whether instead the source and destination lists are really more used in clustering scenarios.  For all I know, I am abusing the use-case for which the multi-endpoint feature was designed.

-Fred


> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware


From bryan.quigley at canonical.com  Fri Apr 19 15:33:55 2013
From: bryan.quigley at canonical.com (Bryan Quigley)
Date: Fri, 19 Apr 2013 10:33:55 -0400
Subject: [rabbitmq-discuss] RABBITMQ_SERVER_ERL_ARGS overridden for
 debugging purposes only?
In-Reply-To: <517028ED.5080409@rabbitmq.com>
References: <51701642.10502@canonical.com> <517028ED.5080409@rabbitmq.com>
Message-ID: <517155D3.9070906@canonical.com>

On Thu 18 Apr 2013 01:10:05 PM EDT, Emile Joubert wrote:
> You could equally well place the configuration in the rabbitmq.config
> file, as illustrated in the serverfault link that you listed.

Indeed, I finally got this working by following a previous post on this 
list [1].   Thanks!  I am still curious of the difference between 
specifying that in ERL_ARGS vs specifying in rabbitmq.conf.   Is there 
an obvious benefit I'm missing?

> It is worth pointing out that access to the port is useless without the
> .erlang.cookie file.

Right, I am aware of this as the designed functionality.   Securing 
this wasn't for limiting the intended use, but more from limiting the 
attack vector (and compliance).

> This is completely unsupported and should not be performed in a
> production environment,
That rules that option out for us...

Thanks again,
Bryan Quigley

[1] 
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-April/019593.html

From emile at rabbitmq.com  Fri Apr 19 15:39:21 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 19 Apr 2013 15:39:21 +0100
Subject: [rabbitmq-discuss] RABBITMQ_SERVER_ERL_ARGS overridden for
 debugging purposes only?
In-Reply-To: <517155D3.9070906@canonical.com>
References: <51701642.10502@canonical.com> <517028ED.5080409@rabbitmq.com>
	<517155D3.9070906@canonical.com>
Message-ID: <51715719.9060801@rabbitmq.com>

On 19/04/13 15:33, Bryan Quigley wrote:
> I am still curious of the difference between specifying that in
> ERL_ARGS vs specifying in rabbitmq.conf. Is there an obvious benefit
> I'm missing?


Whether you use commandline config parameters or the equivalent config
file entries is a matter of preference. Use whatever you find most
convenient.



-Emile




From jisho89 at gmail.com  Fri Apr 19 16:19:10 2013
From: jisho89 at gmail.com (Jisho k Jose)
Date: Fri, 19 Apr 2013 20:49:10 +0530
Subject: [rabbitmq-discuss] ERLANG_HOME not set correctly.
Message-ID: <CALj+zzK53k03_mW4+dvx4=9u1Wey0gjyG+K2Y7EGDkWsoOgVJA@mail.gmail.com>

Hi  Rabbitmq team,

I am new in Rabbitmq and Erlang.I want to setup Chat server so i wish to
develop with rabbitmq.I am using Windows machine.I downloaded the setup
from http://www.rabbitmq.com/install-windows-manual.html.and Erlang is set
up But when i start the rabbitmq-server on command promt it shows the error
like"*ERLANG_HOME not set correctly..*".How can we solve these issue?.I
already read the guideline from your web site.But i cant solve the issue.I
hope you can replay the solution Asap.

Thank You,
Jisho K Jose.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130419/262c60b0/attachment.htm>

From doug at hacks.perl.sh  Fri Apr 19 16:24:37 2013
From: doug at hacks.perl.sh (Doug)
Date: Fri, 19 Apr 2013 23:24:37 +0800
Subject: [rabbitmq-discuss] Join a memory node into the cluster
Message-ID: <CAJxbUuX9Fk5YTAijOoufp3ycx0KykHQYhNsMR4jaJkyszXkE2A@mail.gmail.com>

Hello,

How to join a node into a cluster with memory mode?
The rabbitmqctl join_cluster gets a disk node in the cluster.
Many thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130419/f48b0831/attachment.htm>

From Michael.Laing at nytimes.com  Fri Apr 19 16:38:18 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Fri, 19 Apr 2013 11:38:18 -0400
Subject: [rabbitmq-discuss] Proposed change to shovel
In-Reply-To: <63091709-A63A-47AB-A7A2-DA9A091B19FC@dushin.net>
Message-ID: <CD96D68D.91AB%Michael.Laing@nytimes.com>

We use shovels and clustering extensively and prefer the current behavior.

Our architecture is 'headless' - every component is primary - our testing
and limited production rollout have demonstrated very resilient, adaptive
behavior.

-Michael

On 4/19/13 9:20 AM, "Dushin Fred" <fred at dushin.net> wrote:

>
>On Apr 18, 2013, at 11:23 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
>
>> On 18/04/13 16:04, Fred Dushin wrote:
>>> I would like to consider a change to the shovel plugin, to allow the
>>> shovel to failover more predictably against the list of broker
>>>endpoints
>>> in the rabbitmq_shovel configuration.  Essentially, the idea is to try
>>> each endpoint in order of the declaration, and to use the first
>>>endpoint
>>> to which a connection can be made, instead of selecting an endpoint at
>>> random.
>> 
>> Why? How is this better than the random selection?
>
>In my case, I am pushing messages across WANs, potentially to different
>data centers, where some are treated as backups in the case where
>primaries go down.  So having a list of destinations provides some
>resiliency in the case of network or hardware failure.  I think in cases
>like this, operators need some predictability in where the messages are
>being sent.
>
>> 
>>> This does slightly violate the spirit of Erlang's "let it fail"
>>> philosophy, and I am not sure if the random endpoint selection in the
>>> current code is really more designed for clustered environments.
>> 
>> Yeah, that's the intention.
>> 
>>>  Perhaps it would make more sense to make the iterative failover
>>> strategy an "opt-in" feature, if not simply for the sake of
>>> backwards-compatibility.
>> 
>> We could do that. But I'd like to see a reason for this feature to
>>exist.
>
>I agree that is adds complexity to a fairly tight bit of code, hence
>increases test complexity, imposes an maintenance burden, etc.  So I can
>certainly understand the reluctance to fold it in.  I am mostly curious
>if other users have the same set of requirements, or whether instead the
>source and destination lists are really more used in clustering
>scenarios.  For all I know, I am abusing the use-case for which the
>multi-endpoint feature was designed.
>
>-Fred
>
>
>> 
>> Cheers, Simon
>> 
>> -- 
>> Simon MacMullen
>> RabbitMQ, VMware
>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Fri Apr 19 17:34:22 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 19 Apr 2013 17:34:22 +0100
Subject: [rabbitmq-discuss] ERLANG_HOME not set correctly.
In-Reply-To: <CALj+zzK53k03_mW4+dvx4=9u1Wey0gjyG+K2Y7EGDkWsoOgVJA@mail.gmail.com>
References: <CALj+zzK53k03_mW4+dvx4=9u1Wey0gjyG+K2Y7EGDkWsoOgVJA@mail.gmail.com>
Message-ID: <5171720E.4000105@rabbitmq.com>

Did you set ERLANG_HOME as documented at that page?

Alternatively, unless you have a good reason not to, you will find it 
easier to install using the Windows installer:

http://www.rabbitmq.com/install-windows.html

Cheers, Simon

On 19/04/13 16:19, Jisho k Jose wrote:
> Hi  Rabbitmq team,
>
> I am new in Rabbitmq and Erlang.I want to setup Chat server so i wish to
> develop with rabbitmq.I am using Windows machine.I downloaded the setup
> from http://www.rabbitmq.com/install-windows-manual.html.and Erlang is
> set up But when i start the rabbitmq-server on command promt it shows
> the error like"*ERLANG_HOME not set correctly..*".How can we solve these
> issue?.I already read the guideline from your web site.But i cant solve
> the issue.I hope you can replay the solution Asap.
>
> Thank You,
> Jisho K Jose.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Apr 19 17:36:29 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 19 Apr 2013 17:36:29 +0100
Subject: [rabbitmq-discuss] Join a memory node into the cluster
In-Reply-To: <CAJxbUuX9Fk5YTAijOoufp3ycx0KykHQYhNsMR4jaJkyszXkE2A@mail.gmail.com>
References: <CAJxbUuX9Fk5YTAijOoufp3ycx0KykHQYhNsMR4jaJkyszXkE2A@mail.gmail.com>
Message-ID: <5171728D.10702@rabbitmq.com>

On 19/04/13 16:24, Doug wrote:
> How to join a node into a cluster with memory mode?
> The rabbitmqctl join_cluster gets a disk node in the cluster.
> Many thanks.

You should be able to specify --ram on the command line. See 
http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#join_cluster

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Fri Apr 19 17:39:09 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 19 Apr 2013 17:39:09 +0100
Subject: [rabbitmq-discuss] RabbitMQ Queues memory leak?
In-Reply-To: <CAHWt7w3+Q6vY7Oex0Aa16sL26trOiXJgEp18iHu5WYpR7VQvdQ@mail.gmail.com>
References: <CAHWt7w1K8oznU=_+WNiULEdRMgLf3vXvvdoTi0NCssTGcsqJgQ@mail.gmail.com>
	<CAE3HoVQxrhk=pygisdD9cYWCd4W-FQUuR9imZbeXp+D9Fsp=WQ@mail.gmail.com>
	<CAHWt7w3P2pjBtLWHUV6SoXF8FN02Z2+AK=9tJg5p6OjRfkLNBw@mail.gmail.com>
	<CAE3HoVQvFHh4VwotQPXWaQuMdGgAht+BGZsnKzkoMS33yBwXAg@mail.gmail.com>
	<CAHWt7w0+H87VoXnSuqhVi6FAsm_PbtEbuvH_H=CckWX6k9sW6g@mail.gmail.com>
	<CAE3HoVTcg54NCD9DmsPuZB8vjvB8HXxg0kLwO2hUtp2hjVBFiw@mail.gmail.com>
	<CAHWt7w0pDVbews1OWGsJTv3aOOk-K26PEHLBn=F=Yctg6rc41w@mail.gmail.com>
	<CAHWt7w0xoKZ3v8JpZVrs+b-_NW_u6JqPuNjb5KmAEmn7rf5VmA@mail.gmail.com>
	<516FD175.2050302@rabbitmq.com>
	<CAHWt7w3SBaC8LbEywLnA8npH4dzROPQE_i8OO+1CXeLxLuo+3Q@mail.gmail.com>
	<517020C9.30803@rabbitmq.com>
	<CAHWt7w3+Q6vY7Oex0Aa16sL26trOiXJgEp18iHu5WYpR7VQvdQ@mail.gmail.com>
Message-ID: <5171732D.4060804@rabbitmq.com>



Hi,


On 19/04/13 10:23, Dmitry Saprykin wrote:
>     The difference between 1Mb and 180Mb is relatively large, even after
>     taking expected differences due to garbage collection into account. We
>     can't rule out a memory leak, but need some assistance from you to
>     confirm.
> 
>     Do you see the same asymmetry if the master node for the queues switch
>     from one node to the other? So if you shut the cdaemon2 node, let
>     cdaemon4 become the master for all the queue, turn cdaemon2 back on (it
>     will now be a slave node) does the memory on cdaemon2 now grow?
> 
> 
> Yes, after current master stops and starts it becomes slave and its 
> memory starts to grow. Meantime new selected master memory does not
> become free. So new master memory stops to grow but do not fall back
> to normal. I have attached memory graphs of our nodes to this
> letter.


Thanks for confirming.


>     Have you been able to add a third node to the cluster for testing
>     purposes to see if memory grows on more than one slave node?
> 
> 
> We have not tied to do this yet. But if it can help we can allocate
> one more node. Is is ok to create test node at the same physical host
> as one of existing nodes?


This is probably not necessary. Based on the information you have
provided we have identified a problem which could be the cause.


>     How long does it take for the memory use to reach the VM memory high
>     watermark? 
> 
> 
> Critical point for our cluster comes much more earlier than VM
> memory high watermark. The same time with memory grow slave node
> starts to use CPU more and more active. In our case when memory
> consumption reaches ~1Gb broker stops to respond.
> 
> After slave restart memory grows linearily some time. After that
> memory grow changes its pattern. At some moments it increases by
> constant step (~20Mb). I have marked these steps on graphs attached.


The linear increase in memory use strongly suggests a memory leak.
Thanks for the detailed information and graphs.


>     Can you describe your messaging pattern in a bit more detail for us to
>     reproduce the problem - how often are new channels created when
>     publishing?

> 2) Create channel

> 3) Create channel


It it likely that the high turnover of channels is a critical
precondition for this leak.



>     In order to investigate further it might be helpful to execute some
>     diagnostic commands on the broker. Are you able to replicate the problem
>     in a staging or QA environment where it is safe to do this?
> 
> 
> I will execute diagnostic commands on the broker. If something goes 
> wrong our messaging falls back to version without rabbitMQ involved
> ).

Please be aware that this command could produce a large amount of
output. It should be run on the slave node:

rabbitmqctl eval 'hd(lists:reverse(lists:sort([{process_info(Pid,
memory), Pid, process_info(Pid)} || Pid <- processes()]))).'


Please pipe the output to a file, compress and email to me offlist.


Thanks again




-Emile








From sean.mccully at RACKSPACE.COM  Fri Apr 19 22:17:56 2013
From: sean.mccully at RACKSPACE.COM (Sean McCully)
Date: Fri, 19 Apr 2013 21:17:56 +0000
Subject: [rabbitmq-discuss] Rabbitmq Server dies unexpectedly
Message-ID: <CD971EDE.486B%sean.mccully@RACKSPACE.com>

To whom it may concern,

I have an installation of rabbitmq (3.0.4) that appears to just die unexpectedly. It is current a single node, and the only log information is from

$ tail Rabbit at host-name.log
=INFO REPORT==== 19-Apr-2013::16:08:56 ===
closing AMQP connection <0.14633.0> (127.0.0.1:41349 -> 127.0.0.1:5672)

$ tail startup_err
Killed

It is a standard rabbitmq-server without any real customization,

$ cat /etc/rabbitmq/rabbitmq.config
[
  {rabbit, [
    {ssl_listeners, [5671]},
    {ssl_options, [{cacertfile,"/path/to/cacert.pem"},
                    {certfile,"/path/to/cert.pem"},
                    {keyfile,"/path/to/key.pem"},
                    {verify,verify_none},
                    {fail_if_no_peer_cert,false}]},
    {default_user, <<"guest">>},
    {default_pass, <<"guest">>},
    {log_levels, [{connection, info}]}
  ]}
].

Sean

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130419/7b0bd20b/attachment.htm>

From jfdoubell at gmail.com  Fri Apr 19 16:06:16 2013
From: jfdoubell at gmail.com (Jacques Doubell)
Date: Fri, 19 Apr 2013 08:06:16 -0700 (PDT)
Subject: [rabbitmq-discuss] 3.0.4 extremely unstable in production...?
In-Reply-To: <a3b2aa1d-b3f7-4093-9047-00bb579179c3@googlegroups.com>
References: <a3b2aa1d-b3f7-4093-9047-00bb579179c3@googlegroups.com>
Message-ID: <398f5f6d-22c0-49ec-989b-6cfae1416cda@googlegroups.com>

We have also recently upgraded to 3.0.4 and have since then had 2 outages. 
In the one case the service was running but non functional. The logs didn't 
have errors, but at a certain point just stopped receiving new connections. 
We had to restart the service and all was well until about a week later 
when there were a lot of heaped up messages server side but clients could 
not connect to the queue anymore. (server actively refused connection 
message from the client side). We will be downgrading to 2.8.x in the mean 
time.

On Friday, April 12, 2013 8:36:22 PM UTC+2, Matt Wise wrote:
>
> We've been running RabbitMQ 2.8.x in production in Amazon for about 16 
> months now without very many issues. Last week we ran into an issue where 
> our 2.8.5 cluster nodes hit their high-memory-limit and stopped processing 
> jobs, effectively taking down our entire Celery task queue. We decided to 
> upgrade the software to 3.0.4 (which had been running in staging for a few 
> weeks, as a single instance, without issue) and at the same time beef up 
> the size and redundancy of our farm to 3 machines that were m1.larges.
>
> Old Farm:
>   server1: m1.small, 2.8.5, us-west-1c
>   server2: m1.small, 2.8.5, us-west-1c
>
> New Farm:
>   server1: m1.large, 3.0.4, us-west-1a
>   server2: m1.large, 3.0.4, us-west-1c
>   server3: m1.large, 3.0.4, us-west-1c
>
> Since creating the new server farm though we've had 3 outages. In the 
> first two outages we received a Network Partition Split, and effectively 
> all 3 of the systems decided to run their own queues independently of the 
> other servers. This was the first time we'd ever seen this failure, ever. 
> In the most recent failure we had 2 machines split off, and the 3rd 
> rabbitmq service effectively became unresponsive entirely.
>
> For sanity sake, at this point we've backed down to the following 
> configuration:
>
> New-New Farm:
>   server1: m1.large, 2.8.5, us-west-1c
>   server2: m1.large, 2.8.5, us-west-1a
>
> Up until recently though I had felt extremely comfortable with RabbitMQ's 
> clustering technology and reliability... now ... not so much. Has anyone 
> else seen similar behaviors? Is it simply due to the fact that we're 
> running cross-zone now in Amazon, or is it more likely the 3 servers that 
> caused the problem? Or the 3.0.x upgrade?
>
> --Matt
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130419/98d888cf/attachment.htm>

From michal.liwoj at gmail.com  Sat Apr 20 05:20:04 2013
From: michal.liwoj at gmail.com (=?UTF-8?Q?Michal_Lev=C3=BD?=)
Date: Fri, 19 Apr 2013 21:20:04 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET Client ConnectionFactory threading
	issues
In-Reply-To: <9ed4e339-a6e5-4018-a971-add4a68efcbc@googlegroups.com>
References: <9ed4e339-a6e5-4018-a971-add4a68efcbc@googlegroups.com>
Message-ID: <760f1fb1-98dd-4c6a-be1e-9a2efbf81309@googlegroups.com>

Hey

All your tests run just fine on my machine (Win7 64)
CanCreateConnectionsMultiThreaded: Elapsed seconds: 2,9939693
CanCreateConnectionsMultiThreadedWithLock: Elapsed seconds: 4,3135879

Two difference here:
- im connecting to remote RabbitMQ running on Debian (not localhost)
- my client\server version is 3.0.2

Here are few things to consider.
1) You are connecting to localhost. Each Rabbit connection opens 3 sockets 
(2 for heartbeats). With 100 connections, its minimum 300 + 300 sockets 
trying to open at the same time. Maybe your Win host cant handle it ?
2) Why are you trying to open 100 connection from one machine anyway ? Its 
real wasting of resources. Do you know, you can run multiple independent 
Rabbit channels on single connection ?

Michal

On Thursday, April 18, 2013 1:37:40 PM UTC+2, Chris Haines wrote:
>
> Hi All,
>
> I have attached a .cs Nunit test fixture to demonstrate a problem I am 
> having with the ConnectionFactory. If I create 100 connections in a for 
> loop single threaded then I can create them all in about 2 seconds. If I 
> create them via a number of threads, in my test I am using 100 threads to 
> create a connection on each, then I get a lot of timeout exceptions (my 
> test bails out after 60 seconds). I have tried sharing an instance of the 
> ConnectionFactory between all threads and also giving each thread its own 
> instance but they both have the same result. I have also tried locking 
> around the call to CreateConnection but that also didn't help. 
>
> I find this behavior to be very strange. Has anyone else had similar 
> problems?
>
> Cheers,
> Chris
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130419/677a4ceb/attachment.htm>

From matthias at rabbitmq.com  Sat Apr 20 05:56:53 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 20 Apr 2013 05:56:53 +0100
Subject: [rabbitmq-discuss] .NET Client ConnectionFactory threading
	issues
In-Reply-To: <760f1fb1-98dd-4c6a-be1e-9a2efbf81309@googlegroups.com>
References: <9ed4e339-a6e5-4018-a971-add4a68efcbc@googlegroups.com>
	<760f1fb1-98dd-4c6a-be1e-9a2efbf81309@googlegroups.com>
Message-ID: <51722015.4020706@rabbitmq.com>

On 20/04/13 05:20, Michal Lev? wrote:
> Each Rabbit connection opens 3 sockets (2 for heartbeats).

Actually, heartbeats go over the main connection, so each connection 
uses just one socket.

> Maybe your Win host cant handle it ?

That, i.e. some OS-imposed limit, is indeed the likely culprit. Could be 
client or server. For the latter, check the 'file_descriptors' limits in 
the output of 'rabbitmqctl status'.

Matthias.

From arun.viswanath at gmail.com  Sat Apr 20 07:37:08 2013
From: arun.viswanath at gmail.com (arunRabbitMQ)
Date: Fri, 19 Apr 2013 23:37:08 -0700 (PDT)
Subject: [rabbitmq-discuss] JSON Data to be send between Java Producer and
	Python Consumer
Message-ID: <1366439828326-26118.post@n5.nabble.com>

Hi,

I'm facing an issue while sending the JSON data between Java Producer and 
Python Consumer. 

I doing the following serialization in my Java Producer for my JSON data and
placing the serialize data in the Queue

/Java Code:
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;


// Reading the JSON content from the file and making it an JSONObject
JSONObject serviceObj = (JSONObject) parser.parse(new
FileReader("C:\\Msg2.json"));

String jsonText = new flexjson.JSONSerializer().serialize(jsonObj); 

channel.basicPublish("", CONDUCTOR_QUEUE_NAME, null, jsonText .getBytes());/

-----------------
My python consumer successfully takes the data from the Queue but it is not
able to process it.
Python consumer is expected to deserialize the json message read from the
Queue to Python dictionary but the data got after deserialize is python
unicode type.

My python consumer is third party code so I can't change my consumer side. 
I'm not sure whether I'm doing the correct stuff in my Java producer. 

Any help to resolve this issue will be appreciated.

Thanks In Advance,
Arun V




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/JSON-Data-to-be-send-between-Java-Producer-and-Python-Consumer-tp26118.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From arun.viswanath at gmail.com  Sat Apr 20 07:38:49 2013
From: arun.viswanath at gmail.com (Arun Viswanath)
Date: Fri, 19 Apr 2013 23:38:49 -0700 (PDT)
Subject: [rabbitmq-discuss] JSON Data to be send between Java Producer and
	Python Consumer
Message-ID: <af82e304-1f5b-430e-b654-bcdca853ca49@googlegroups.com>

Hi, 

I'm facing an issue while sending the JSON data between Java Producer and 
 Python Consumer. 

I doing the following serialization in my Java Producer for my JSON data 
and placing the serialize data in the Queue 

*Java Code: 
import org.json.simple.JSONObject; 
import org.json.simple.parser.JSONParser; 


// Reading the JSON content from the file and making it an JSONObject 
JSONObject serviceObj = (JSONObject) parser.parse(new 
FileReader("C:\\Msg2.json")); 

String jsonText = new flexjson.JSONSerializer().serialize(jsonObj); 

channel.basicPublish("", CONDUCTOR_QUEUE_NAME, null, jsonText .getBytes());*

----------------- 
My python consumer successfully takes the data from the Queue but it is not 
able to process it. 
Python consumer is expected to deserialize the json message read from the 
Queue to Python dictionary but the data got after deserialize is python 
unicode type. 

My python consumer is third party code so I can't change my consumer side. 
I'm not sure whether I'm doing the correct stuff in my Java producer. 

Any help to resolve this issue will be appreciated. 

Thanks In Advance, 
Arun V 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130419/e62a8f09/attachment.htm>

From michael.s.klishin at gmail.com  Sat Apr 20 07:48:51 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 20 Apr 2013 10:48:51 +0400
Subject: [rabbitmq-discuss] JSON Data to be send between Java Producer
 and Python Consumer
In-Reply-To: <1366439828326-26118.post@n5.nabble.com>
References: <1366439828326-26118.post@n5.nabble.com>
Message-ID: <CAE3HoVTn+7fPmpaXcRnc_cf48QnfRYCWxQYa8habq0sfKhcjrg@mail.gmail.com>

2013/4/20 arunRabbitMQ <arun.viswanath at gmail.com>

> My python consumer successfully takes the data from the Queue but it is not
> able to process it.
>

Do you have any exceptions you can post?

RabbitMQ treats messages are byte streams. There is also an interop test
suite that uses JSON
for communication: https://github.com/michaelklishin/acits

and it includes Java and one Python client (Pika).
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130420/20d39190/attachment.htm>

From jisho89 at gmail.com  Sat Apr 20 11:17:07 2013
From: jisho89 at gmail.com (Jisho k Jose)
Date: Sat, 20 Apr 2013 15:47:07 +0530
Subject: [rabbitmq-discuss] ERLANG_HOME not set correctly.
In-Reply-To: <5171720E.4000105@rabbitmq.com>
References: <CALj+zzK53k03_mW4+dvx4=9u1Wey0gjyG+K2Y7EGDkWsoOgVJA@mail.gmail.com>
	<5171720E.4000105@rabbitmq.com>
Message-ID: <CALj+zz+McFLrLy1mVgrYZHHv1hXnUkA6FuB7KVmB8Q4zkX8NpA@mail.gmail.com>

Hi Rabbitmq team,

I read the Documentation for setting ERLANG_HOME.but I couldnt understand
how it works.can u pls explain in detail.

Thank you,
Jisho k jose


On Fri, Apr 19, 2013 at 10:04 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> Did you set ERLANG_HOME as documented at that page?
>
> Alternatively, unless you have a good reason not to, you will find it
> easier to install using the Windows installer:
>
> http://www.rabbitmq.com/**install-windows.html<http://www.rabbitmq.com/install-windows.html>
>
> Cheers, Simon
>
>
> On 19/04/13 16:19, Jisho k Jose wrote:
>
>> Hi  Rabbitmq team,
>>
>> I am new in Rabbitmq and Erlang.I want to setup Chat server so i wish to
>> develop with rabbitmq.I am using Windows machine.I downloaded the setup
>> from http://www.rabbitmq.com/**install-windows-manual.html.**and<http://www.rabbitmq.com/install-windows-manual.html.and>Erlang is
>> set up But when i start the rabbitmq-server on command promt it shows
>> the error like"*ERLANG_HOME not set correctly..*".How can we solve these
>>
>> issue?.I already read the guideline from your web site.But i cant solve
>> the issue.I hope you can replay the solution Asap.
>>
>> Thank You,
>> Jisho K Jose.
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130420/7f92a9ee/attachment.htm>

From videlalvaro at gmail.com  Sat Apr 20 11:41:58 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 20 Apr 2013 12:41:58 +0200
Subject: [rabbitmq-discuss] Dynamic route
In-Reply-To: <CAAdUACTnTv-o0f_ZY+oduatTYp34eDg3Cwn07dOitP6GJHTtfQ@mail.gmail.com>
References: <CAAdUACTnTv-o0f_ZY+oduatTYp34eDg3Cwn07dOitP6GJHTtfQ@mail.gmail.com>
Message-ID: <CAMcAHLUmEiiQrNy3Ui5wGzHD00Gaa3FVaeMX2bArr2k=YtA_MA@mail.gmail.com>

My apologies to others in this list.

Oscar, podr?as reformular la pregunta en espa?ol y yo trato de postearla en
ingl?s? Si no la seguimos off list.


On Thu, Apr 18, 2013 at 8:34 PM, Oscar Beltr?n <oscar.bego at gmail.com> wrote:

> Ok, I'll try but my english is bad.
>
> How a build the pattern dynamic route? by example recipient list with
> dynamic route.
>
> I can send commands to queue "cmds", other app (app-1) read this messages,
> by each message this app create a thread for read the queue "cmds" with a
>  key routing, then, how avoid the arrival to the  messages the
> application-1 for messages that have been routed.
>
> thanks
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130420/40f8755e/attachment.htm>

From Michael.Laing at nytimes.com  Sat Apr 20 12:03:51 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Sat, 20 Apr 2013 07:03:51 -0400
Subject: [rabbitmq-discuss] JSON Data to be send between Java Producer
 and Python Consumer
In-Reply-To: <af82e304-1f5b-430e-b654-bcdca853ca49@googlegroups.com>
Message-ID: <CD97EB4D.91FE%Michael.Laing@nytimes.com>

Hi Arun,

Probably you are sending unicode in your json from the java side.

On the python side it is probably complaining about not being able to decode using the ascii codec? is that correct? This would mean that the received data is encoded in another scheme, probably utf8.

Really guessing here but? you could first try forcing the java side to only send ascii, stripping out or transforming any non-ascii characters. This would tell you if you are on the right track. Then you could try to really fix the problem by getting the java side to encode unicode as ascii rather than utf8 (you will see '\unnnn' strings in the output). I don't know how to do that.

I usually handle problems like this on the python side by decoding json using the utf8 codec, but that is not an option open to you.

Michael

From: Arun Viswanath <arun.viswanath at gmail.com<mailto:arun.viswanath at gmail.com>>
Reply-To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Saturday, April 20, 2013 2:38 AM
To: "rabbitmq-discuss at googlegroups.com<mailto:rabbitmq-discuss at googlegroups.com>" <rabbitmq-discuss at googlegroups.com<mailto:rabbitmq-discuss at googlegroups.com>>
Subject: [rabbitmq-discuss] JSON Data to be send between Java Producer and Python Consumer

Hi,

I'm facing an issue while sending the JSON data between Java Producer and  Python Consumer.

I doing the following serialization in my Java Producer for my JSON data and placing the serialize data in the Queue

Java Code:
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;


// Reading the JSON content from the file and making it an JSONObject
JSONObject serviceObj = (JSONObject) parser.parse(new FileReader("C:\\Msg2.json"));

String jsonText = new flexjson.JSONSerializer().serialize(jsonObj);

channel.basicPublish("", CONDUCTOR_QUEUE_NAME, null, jsonText .getBytes());

-----------------
My python consumer successfully takes the data from the Queue but it is not able to process it.
Python consumer is expected to deserialize the json message read from the Queue to Python dictionary but the data got after deserialize is python unicode type.

My python consumer is third party code so I can't change my consumer side.
I'm not sure whether I'm doing the correct stuff in my Java producer.

Any help to resolve this issue will be appreciated.

Thanks In Advance,
Arun V
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130420/508a88b3/attachment.htm>

From oscar.bego at gmail.com  Sat Apr 20 16:54:50 2013
From: oscar.bego at gmail.com (=?ISO-8859-1?Q?Oscar_Beltr=E1n?=)
Date: Sat, 20 Apr 2013 09:54:50 -0600
Subject: [rabbitmq-discuss] Dynamic route
In-Reply-To: <CAAdUACTnTv-o0f_ZY+oduatTYp34eDg3Cwn07dOitP6GJHTtfQ@mail.gmail.com>
References: <CAAdUACTnTv-o0f_ZY+oduatTYp34eDg3Cwn07dOitP6GJHTtfQ@mail.gmail.com>
Message-ID: <CAAdUACQ=tni9_ukxVn1e4ZPrnchow__vU0t516AeRb9oP=CYvQ@mail.gmail.com>

Muchas gracias Alvaro.

 Ok, ahora tengo una aplicaci?n que env?a comandos a varios clientes (unos
1500) los clientes son hardware, no les puedo cargar un cliente rabbitmq
(lo estoy investigando con arduino y mqtt), entonces programe una
aplicaci?n intermedia que iniciara un hilo al cliente al momento de llegada
de un mensaje, este hilo tiene un socket al cliente hardware para
re-enviarle el comando que viene desde el rabbitmq.

Trate de mejorar todo haciendo que el hilo reci?n creado se suscriba de
forma directa el server rabbitmq, ahora los mensajes se env?an a hilo y a
la aplicaci?n intermedia. La aplicaci?n intermedia descarta los mensajes
que tambi?n van de forma directa a alg?n cliente.

La pregunta es: Como modifico la suscripci?n para que la aplicaci?n
intermedia descarte los mensajes de clientes que ya cuentan con un hilo
directo para su atenci?n? y como regreso escuchar los mensajes descartados
cuando el hilo termina.

Creo que esto es una implementaci?n del patr?n Dynamic route.

Muchas gracias por la ayuda de antemano.


2013/4/18 Oscar Beltr?n <oscar.bego at gmail.com>

> Ok, I'll try but my english is bad.
>
> How a build the pattern dynamic route? by example recipient list with
> dynamic route.
>
> I can send commands to queue "cmds", other app (app-1) read this messages,
> by each message this app create a thread for read the queue "cmds" with a
>  key routing, then, how avoid the arrival to the  messages the
> application-1 for messages that have been routed.
>
> thanks
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130420/5597884e/attachment.htm>

From videlalvaro at gmail.com  Sat Apr 20 18:56:05 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 20 Apr 2013 19:56:05 +0200
Subject: [rabbitmq-discuss] Dynamic route
In-Reply-To: <CAAdUACQ=tni9_ukxVn1e4ZPrnchow__vU0t516AeRb9oP=CYvQ@mail.gmail.com>
References: <CAAdUACTnTv-o0f_ZY+oduatTYp34eDg3Cwn07dOitP6GJHTtfQ@mail.gmail.com>
	<CAAdUACQ=tni9_ukxVn1e4ZPrnchow__vU0t516AeRb9oP=CYvQ@mail.gmail.com>
Message-ID: <CAMcAHLV20wVXKh-OmLQu0AhN4vh_TJ=RcdMiDdTmNAsB8Eb70Q@mail.gmail.com>

Te respondo/pregunto algunas cosas inline:


2013/4/20 Oscar Beltr?n <oscar.bego at gmail.com>

> Muchas gracias Alvaro.
>
>  Ok, ahora tengo una aplicaci?n que env?a comandos a varios clientes
> (unos 1500) los clientes son hardware, no les puedo cargar un cliente
> rabbitmq (lo estoy investigando con arduino y mqtt), entonces programe una
> aplicaci?n intermedia que iniciara un hilo al cliente al momento de llegada
> de un mensaje, este hilo tiene un socket al cliente hardware para
> re-enviarle el comando que viene desde el rabbitmq.
>

Como llegan los mensajes a la aplicaci?n intermediaria? Supongo que hay un
exchange aqu?. Qu? tipo de exchange? La aplicaci?n intermediaria supongo
que tiene su queue con un binding. Cuantos consumers tienen esa queue?


> Trate de mejorar todo haciendo que el hilo reci?n creado se suscriba de
> forma directa el server rabbitmq, ahora los mensajes se env?an a hilo y a
> la aplicaci?n intermedia. La aplicaci?n intermedia descarta los mensajes
> que tambi?n van de forma directa a alg?n cliente.
>

Qu? quer?s decir con mensajes que llegan directamente al cliente? Si lo
clientes no pueden consumir desde rabbit, como es que le llegano mensajes
de forma directa?

>
> La pregunta es: Como modifico la suscripci?n para que la aplicaci?n
> intermedia descarte los mensajes de clientes que ya cuentan con un hilo
> directo para su atenci?n? y como regreso escuchar los mensajes descartados
> cuando el hilo termina.
>

"Regresar a escuchar los mensajes descartados", significa subscribirse al
t?pico de esos mensajes nuevamente, o por mensajes descartados te refer?s a
un tipo de storage que los guarda a un lado y luego hace un replay de esos
mensajes para que est?n disponibles nuevamente para la app?


>
> Creo que esto es una implementaci?n del patr?n Dynamic route.
>
> Muchas gracias por la ayuda de antemano.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130420/17d6fb05/attachment.htm>

From gmr at meetme.com  Sat Apr 20 19:28:39 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Sat, 20 Apr 2013 14:28:39 -0400
Subject: [rabbitmq-discuss] JSON Data to be send between Java Producer
 and Python Consumer
In-Reply-To: <CD97EB4D.91FE%Michael.Laing@nytimes.com>
References: <CD97EB4D.91FE%Michael.Laing@nytimes.com>
Message-ID: <E264A1CE98D74D07BAB271438A94A161@meetme.com>

To add to this the consumer probably needs to use json.loads(value, ensure_ascii=False) (not the default value for ensure_ascii) to allow it to decode UTF-8 in a JSON string.  


On Saturday, April 20, 2013 at 7:03 AM, Laing, Michael P. wrote:

> Hi Arun,
>  
> Probably you are sending unicode in your json from the java side.
>  
> On the python side it is probably complaining about not being able to decode using the ascii codec? is that correct? This would mean that the received data is encoded in another scheme, probably utf8.
>  
> Really guessing here but? you could first try forcing the java side to only send ascii, stripping out or transforming any non-ascii characters. This would tell you if you are on the right track. Then you could try to really fix the problem by getting the java side to encode unicode as ascii rather than utf8 (you will see '\unnnn' strings in the output). I don't know how to do that.
>  
> I usually handle problems like this on the python side by decoding json using the utf8 codec, but that is not an option open to you.
>  
> Michael
>  
> From: Arun Viswanath <arun.viswanath at gmail.com (mailto:arun.viswanath at gmail.com)>
> Reply-To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)>
> Date: Saturday, April 20, 2013 2:38 AM
> To: "rabbitmq-discuss at googlegroups.com (mailto:rabbitmq-discuss at googlegroups.com)" <rabbitmq-discuss at googlegroups.com (mailto:rabbitmq-discuss at googlegroups.com)>
> Subject: [rabbitmq-discuss] JSON Data to be send between Java Producer and Python Consumer
>  
> Hi,  
>  
> I'm facing an issue while sending the JSON data between Java Producer and  Python Consumer.  
>  
> I doing the following serialization in my Java Producer for my JSON data and placing the serialize data in the Queue  
>  
> Java Code:  
> import org.json.simple.JSONObject;  
> import org.json.simple.parser.JSONParser;  
>  
>  
> // Reading the JSON content from the file and making it an JSONObject  
> JSONObject serviceObj = (JSONObject) parser.parse(new FileReader("C:\\Msg2.json"));  
>  
> String jsonText = new flexjson.JSONSerializer().serialize(jsonObj);  
>  
> channel.basicPublish("", CONDUCTOR_QUEUE_NAME, null, jsonText .getBytes());
>  
> -----------------  
> My python consumer successfully takes the data from the Queue but it is not able to process it.  
> Python consumer is expected to deserialize the json message read from the Queue to Python dictionary but the data got after deserialize is python unicode type.  
>  
> My python consumer is third party code so I can't change my consumer side.  
> I'm not sure whether I'm doing the correct stuff in my Java producer.  
>  
> Any help to resolve this issue will be appreciated.  
>  
> Thanks In Advance,  
> Arun V  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  
>  


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130420/86aa606a/attachment.htm>

From Michael.Laing at nytimes.com  Sat Apr 20 19:32:34 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Sat, 20 Apr 2013 14:32:34 -0400
Subject: [rabbitmq-discuss] JSON Data to be send between Java Producer
 and Python Consumer
In-Reply-To: <E264A1CE98D74D07BAB271438A94A161@meetme.com>
Message-ID: <CD98572B.9246%Michael.Laing@nytimes.com>

Yes ? that's what I do too.

Unfortunately he said he has no control over the python code? :-/

From: "Gavin M. Roy" <gmr at meetme.com<mailto:gmr at meetme.com>>
Reply-To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Saturday, April 20, 2013 2:28 PM
To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Cc: "rabbitmq-discuss at googlegroups.com<mailto:rabbitmq-discuss at googlegroups.com>" <rabbitmq-discuss at googlegroups.com<mailto:rabbitmq-discuss at googlegroups.com>>
Subject: Re: [rabbitmq-discuss] JSON Data to be send between Java Producer and Python Consumer

To add to this the consumer probably needs to use json.loads(value, ensure_ascii=False) (not the default value for ensure_ascii) to allow it to decode UTF-8 in a JSON string.

On Saturday, April 20, 2013 at 7:03 AM, Laing, Michael P. wrote:

Hi Arun,

Probably you are sending unicode in your json from the java side.

On the python side it is probably complaining about not being able to decode using the ascii codec? is that correct? This would mean that the received data is encoded in another scheme, probably utf8.

Really guessing here but? you could first try forcing the java side to only send ascii, stripping out or transforming any non-ascii characters. This would tell you if you are on the right track. Then you could try to really fix the problem by getting the java side to encode unicode as ascii rather than utf8 (you will see '\unnnn' strings in the output). I don't know how to do that.

I usually handle problems like this on the python side by decoding json using the utf8 codec, but that is not an option open to you.

Michael

From: Arun Viswanath <arun.viswanath at gmail.com<mailto:arun.viswanath at gmail.com>>
Reply-To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Saturday, April 20, 2013 2:38 AM
To: "rabbitmq-discuss at googlegroups.com<mailto:rabbitmq-discuss at googlegroups.com>" <rabbitmq-discuss at googlegroups.com<mailto:rabbitmq-discuss at googlegroups.com>>
Subject: [rabbitmq-discuss] JSON Data to be send between Java Producer and Python Consumer

Hi,

I'm facing an issue while sending the JSON data between Java Producer and  Python Consumer.

I doing the following serialization in my Java Producer for my JSON data and placing the serialize data in the Queue

Java Code:
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;


// Reading the JSON content from the file and making it an JSONObject
JSONObject serviceObj = (JSONObject) parser.parse(new FileReader("C:\\Msg2.json"));

String jsonText = new flexjson.JSONSerializer().serialize(jsonObj);

channel.basicPublish("", CONDUCTOR_QUEUE_NAME, null, jsonText .getBytes());

-----------------
My python consumer successfully takes the data from the Queue but it is not able to process it.
Python consumer is expected to deserialize the json message read from the Queue to Python dictionary but the data got after deserialize is python unicode type.

My python consumer is third party code so I can't change my consumer side.
I'm not sure whether I'm doing the correct stuff in my Java producer.

Any help to resolve this issue will be appreciated.

Thanks In Advance,
Arun V
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130420/72d87b2d/attachment.htm>

From unix.nima at gmail.com  Sat Apr 20 22:01:31 2013
From: unix.nima at gmail.com (Nima Sahraneshin-Samani)
Date: Sun, 21 Apr 2013 01:31:31 +0430
Subject: [rabbitmq-discuss] Project idea
Message-ID: <CAD=WvJbcwrRx3DV95+NS=J7NUzOPvcdeY8Znu_1guk-GuiJOQA@mail.gmail.com>

Dear all,

I am looking for some project to do for my distributed systems
courses.Is there any project idea hear ?

regards,

Nima

From MJeffery at fnb.co.za  Mon Apr 22 07:26:08 2013
From: MJeffery at fnb.co.za (Jeffery, Mark)
Date: Mon, 22 Apr 2013 06:26:08 +0000
Subject: [rabbitmq-discuss] Rabbit crash
Message-ID: <06536F18C0038E489237EEE3CA9BF2D014012434@FRGR1D2MX07.services.firstrand.net>

Hello

We have a cluster of 6 Rabbit Nodes.
All disk nodes.

One keeps crashing (around 3 times a day), the others are fine.

From what I can see, it restarts itself and carries on.

The last time however, it didn?t come up because it said ?already running?.

When the process was killed manually, the entire cluster came down ?

I cannot interpret the crash report.

I have attached it.

Can anyone see what the problem is ?

To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser: 
https://www.fnb.co.za/disclaimer.html 

If you are unable to access the Disclaimer, send a blank e-mail to
firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: rabbit.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/d58e8e61/attachment.txt>

From tomer.paz at gmail.com  Sun Apr 21 12:39:43 2013
From: tomer.paz at gmail.com (Tomer Paz)
Date: Sun, 21 Apr 2013 04:39:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Prioritizing Between Queues
Message-ID: <27bbed3c-22c8-49d0-b021-b91a124e7d3c@googlegroups.com>

Hi
Two issues, starting with the simple one:

1. If a consumer (sub) declared a queue with topic binding key that has 
wild pattern, like "type_a.*"
    Then a publisher declared a queue that meets this binding key as well 
via routing key "type_a.something".
    Will the broker dynamically 'subscribe' the consumer above to the new 
queue created by the publisher? even though the consumer did not 'declare' 
such queue specifically, during its queue declaration? i.e. will broker 
push messages to that consumer from the new queue dynamically at run time?

2.I have read everything about AMQP in-queue priority feature requirements.
  I have not found if there is a way for RabbitMQ broker to do the 
following however:

  let clients subscribe to several queues, But prioritize which queue they 
take messages from, in a fashion different than the simple round-robin.
  In other words, we wish to have some algo that Broker could decide about *prioritizing 
queues* for consumers, rather than simple round-robin to them.
  Example:
   we have Q1 responsible for messages of task type A. Type A has priority 1
   we have Q2 responsible for messages of task type B. Type B has priority 2
   .... Q3... Type C.. priority 3.
  Now consumer client(s) subscribe to consume messages from all Queues 
(1..3).
  We wish Broker could give different priority for the three queues. It 
would be even more powerful if for example:
  At some point, there are very little # of messages in Q1. However Q3 is 
'full', or to be more sophisticated, the Rate in which tasks in Q3 
  handled is too slow. We wish to Dynamically change priority for the three 
queues in such case (thus dynamic prioritization of queues)

answers for both questions will significantly influence our decisions about 
the product of choice :)

TIA
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130421/72c687d1/attachment.htm>

From aflaed at gmail.com  Mon Apr 22 08:09:12 2013
From: aflaed at gmail.com (=?UTF-8?B?0J3QsNC40LvRjCDQodCw0LvQuNGF0L7Qsg==?=)
Date: Mon, 22 Apr 2013 00:09:12 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET Subscription class
Message-ID: <7ddd61d5-9d4e-4434-9039-3777b0bbbde0@googlegroups.com>

Hello!
Why *Subscription *class hasn't constructor overload with client consumer 
tag?
Inheritance from this class looks not very well, because *BasicConsume*method called is base class, and we should call 
*BasicCancel*:

public CustomSubscription(IModel model, string queueName, bool noAck) 

: base(model, queueName, noAck)

{
m_model.BasicCancel(m_consumerTag);
m_consumerTag = m_model.BasicConsume(m_queueName, m_noAck, "qweqwe", 
m_consumer);
}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/86686551/attachment.htm>

From michael.s.klishin at gmail.com  Mon Apr 22 09:57:15 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 22 Apr 2013 12:57:15 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre9 is released
Message-ID: <CAE3HoVSgsc8g_rM-2SU6FALYDHitSwyBdH5=gg73Ue_5ihS-9Q@mail.gmail.com>

Bunny 0.9.0.pre9 is released to rubygems.org [1]. This is a 100%
backwards-compatible
bug fix release that fixes at least two issues that resulted in abnormally
high CPU
usage [2].

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/04/22/bunny-0-dot-9-0-dot-pre9-is-released/

Because of the nature of the issue fixed, I *highly* recommend all users to
upgrade as soon as possible.

1. https://rubygems.org/gems/bunny/versions/0.9.0.pre9
2. https://github.com/ruby-amqp/bunny/issues/95,
https://logstash.jira.com/browse/LOGSTASH-940
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/819f6279/attachment.htm>

From emile at rabbitmq.com  Mon Apr 22 10:22:32 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 22 Apr 2013 10:22:32 +0100
Subject: [rabbitmq-discuss] Rabbitmq Server dies unexpectedly
In-Reply-To: <CD971EDE.486B%sean.mccully@RACKSPACE.com>
References: <CD971EDE.486B%sean.mccully@RACKSPACE.com>
Message-ID: <51750158.7050705@rabbitmq.com>



Hi,

On 19/04/13 22:17, Sean McCully wrote:
> $ tail startup_err
> Killed

Have you ruled out the possibility that the OS process for the Erlang VM
was killed - either explicitly or by an OOM handler? You should be able
to verify the latter by inspecting the OS logs.





-Emile






From emile at rabbitmq.com  Mon Apr 22 10:44:27 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 22 Apr 2013 10:44:27 +0100
Subject: [rabbitmq-discuss] .NET Subscription class
In-Reply-To: <7ddd61d5-9d4e-4434-9039-3777b0bbbde0@googlegroups.com>
References: <7ddd61d5-9d4e-4434-9039-3777b0bbbde0@googlegroups.com>
Message-ID: <5175067B.5040905@rabbitmq.com>

Hi,

On 22/04/13 08:09, ????? ??????? wrote:
> Why *Subscription *class hasn't constructor overload with client
> consumer tag?

Can you explain the problem that you are trying to solve? The consumer
tag alone is not much use unless there is a corresponding consumer.



-Emile






From aflaed at gmail.com  Mon Apr 22 10:56:18 2013
From: aflaed at gmail.com (=?UTF-8?B?0J3QsNC40LvRjCDQodCw0LvQuNGF0L7Qsg==?=)
Date: Mon, 22 Apr 2013 13:56:18 +0400
Subject: [rabbitmq-discuss] .NET Subscription class
In-Reply-To: <5175067B.5040905@rabbitmq.com>
References: <7ddd61d5-9d4e-4434-9039-3777b0bbbde0@googlegroups.com>
	<5175067B.5040905@rabbitmq.com>
Message-ID: <CANV4tdUoVU-Exx_8tP=6pTArkf4tgR8jMeLAj6QD14ssgGyuWw@mail.gmail.com>

I'm using *Subscription* class to consume messages and in RabbitMQ
Management plugin in queue consumers section i cant see them.
*Subscription* class names consumers automatically (because it use
this<http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v3.0.4/rabbitmq-dotnet-client-3.0.4-client-htmldoc/html/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicConsume(System.String,System.Boolean,RabbitMQ.Client.IBasicConsumer)>
overload
of IModel class in construction), but for me it's important to name
consumers with custom tags.


2013/4/22 Emile Joubert <emile at rabbitmq.com>

> Hi,
>
> On 22/04/13 08:09, ????? ??????? wrote:
> > Why *Subscription *class hasn't constructor overload with client
> > consumer tag?
>
> Can you explain the problem that you are trying to solve? The consumer
> tag alone is not much use unless there is a corresponding consumer.
>
>
>
> -Emile
>
>
>
>
>
>


-- 
? ?????????,
??????? ?????
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/10c44c7a/attachment.htm>

From simon at rabbitmq.com  Mon Apr 22 11:04:53 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 22 Apr 2013 11:04:53 +0100
Subject: [rabbitmq-discuss] Rabbit crash
In-Reply-To: <06536F18C0038E489237EEE3CA9BF2D014012434@FRGR1D2MX07.services.firstrand.net>
References: <06536F18C0038E489237EEE3CA9BF2D014012434@FRGR1D2MX07.services.firstrand.net>
Message-ID: <51750B45.4080701@rabbitmq.com>

Which version of RabbitMQ are you running?

Also: is there nothing in the logs before these {error,not_found} 
reports? It looks like a side effect of something else already having 
gone wrong. Could you post the complete logs (regular and sasl ones) 
somewhere?

Cheers, Simon

On 22/04/13 07:26, Jeffery, Mark wrote:
> Hello
>
> We have a cluster of 6 Rabbit Nodes.
> All disk nodes.
>
> One keeps crashing (around 3 times a day), the others are fine.
>
>  From what I can see, it restarts itself and carries on.
>
> The last time however, it didn?t come up because it said ?already running?.
>
> When the process was killed manually, the entire cluster came down ?
>
> I cannot interpret the crash report.
>
> I have attached it.
>
> Can anyone see what the problem is ?
>
> To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser:
> https://www.fnb.co.za/disclaimer.html
>
> If you are unable to access the Disclaimer, send a blank e-mail to
> firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From MJeffery at fnb.co.za  Mon Apr 22 11:23:47 2013
From: MJeffery at fnb.co.za (Jeffery, Mark)
Date: Mon, 22 Apr 2013 10:23:47 +0000
Subject: [rabbitmq-discuss] Rabbit crash
In-Reply-To: <51750B45.4080701@rabbitmq.com>
References: <06536F18C0038E489237EEE3CA9BF2D014012434@FRGR1D2MX07.services.firstrand.net>
	<51750B45.4080701@rabbitmq.com>
Message-ID: <06536F18C0038E489237EEE3CA9BF2D0140128D8@FRGR1D2MX07.services.firstrand.net>

Thanks.

It is Version 2.8.4

Attached are the logs.

I really appreciate any help.

Jeff

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Monday, April 22, 2013 12:05 PM
To: Discussions about RabbitMQ
Cc: Jeffery, Mark
Subject: Re: [rabbitmq-discuss] Rabbit crash

Which version of RabbitMQ are you running?

Also: is there nothing in the logs before these {error,not_found} reports? It looks like a side effect of something else already having gone wrong. Could you post the complete logs (regular and sasl ones) somewhere?

Cheers, Simon

On 22/04/13 07:26, Jeffery, Mark wrote:
> Hello
>
> We have a cluster of 6 Rabbit Nodes.
> All disk nodes.
>
> One keeps crashing (around 3 times a day), the others are fine.
>
>  From what I can see, it restarts itself and carries on.
>
> The last time however, it didn?t come up because it said ?already running?.
>
> When the process was killed manually, the entire cluster came down ?
>
> I cannot interpret the crash report.
>
> I have attached it.
>
> Can anyone see what the problem is ?
>
> To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser:
> https://www.fnb.co.za/disclaimer.html
>
> If you are unable to access the Disclaimer, send a blank e-mail to 
> firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, VMware

To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser: 
https://www.fnb.co.za/disclaimer.html 

If you are unable to access the Disclaimer, send a blank e-mail to
firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: logs.tar.gz
Type: application/x-gzip
Size: 583245 bytes
Desc: logs.tar.gz
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/94ad5276/attachment.bin>

From emile at rabbitmq.com  Mon Apr 22 11:25:54 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 22 Apr 2013 11:25:54 +0100
Subject: [rabbitmq-discuss] not able to run rabbitmq-server service
In-Reply-To: <CBB468D8CF4B8B4AB51CC0D3EC49F7541EDADB1F@BLRKECMBX24.ad.infosys.com>
References: <CBB468D8CF4B8B4AB51CC0D3EC49F7541EDADB1F@BLRKECMBX24.ad.infosys.com>
Message-ID: <51751032.7000309@rabbitmq.com>


Hi,

On 19/04/13 13:09, Chandrashekar Basavaraj03 wrote:

> I dig the init script and found that it is always returning 0 even
> though service is not running.


What version of rabbitmq-server are you trying to install? The problem
description is similar to an issue that has already been fixed, so if
you are not installing the latest version then please try that first:

http://www.rabbitmq.com/install-rpm.html






-Emile






From jsmundey at hotmail.com  Mon Apr 22 11:52:44 2013
From: jsmundey at hotmail.com (Jagtar Singh)
Date: Mon, 22 Apr 2013 16:22:44 +0530
Subject: [rabbitmq-discuss] Adoption of AMQP but ... roadblocks
Message-ID: <BLU176-W1903FD1223EEC8A52520EAD8CB0@phx.gbl>

Hi,

We were on decision to adopt rabbitmq as our core messaging solution. But then we came to know about the XML payload patent?20090063418 by Red Hat. It seems like patenting a SOAP protocol and it's detrimental to acceptance of AMQP as standard.

We could not get any news regarding this scenario except ones dating back to 2009. Is there any change happened or it's still the same? How would it affect development of the RabbitMQ?

Thanks for response.

Cheers
Jags. 		 	   		  

From alexis at rabbitmq.com  Mon Apr 22 12:02:40 2013
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 22 Apr 2013 12:02:40 +0100
Subject: [rabbitmq-discuss] Adoption of AMQP but ... roadblocks
In-Reply-To: <BLU176-W1903FD1223EEC8A52520EAD8CB0@phx.gbl>
References: <BLU176-W1903FD1223EEC8A52520EAD8CB0@phx.gbl>
Message-ID: <CACOPnvfaf9vpb489mhKdDiA+ybzwuuj1r+Dpe_waRTrJyDSpNw@mail.gmail.com>

Jags

This should not have any effect on your use of RabbitMQ.

The Red Hat patent relates to certain specific approaches to XML based
routing in combination with AMQP, in which exchange routing explicitly
encodes XML patterns.  I have not yet found any real world scenarios
where the patent could be relevant and applicable.  Even if such
scenarios existed, Red Hat's "patent pledge" would apply to them:
http://www.redhat.com/legal/patent_policy.html

Does this help?

alexis



On Mon, Apr 22, 2013 at 11:52 AM, Jagtar Singh <jsmundey at hotmail.com> wrote:
> Hi,
>
> We were on decision to adopt rabbitmq as our core messaging solution. But then we came to know about the XML payload patent 20090063418 by Red Hat. It seems like patenting a SOAP protocol and it's detrimental to acceptance of AMQP as standard.
>
> We could not get any news regarding this scenario except ones dating back to 2009. Is there any change happened or it's still the same? How would it affect development of the RabbitMQ?
>
> Thanks for response.
>
> Cheers
> Jags.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Mon Apr 22 12:10:18 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 22 Apr 2013 12:10:18 +0100
Subject: [rabbitmq-discuss] ERLANG_HOME not set correctly.
In-Reply-To: <CALj+zz+McFLrLy1mVgrYZHHv1hXnUkA6FuB7KVmB8Q4zkX8NpA@mail.gmail.com>
References: <CALj+zzK53k03_mW4+dvx4=9u1Wey0gjyG+K2Y7EGDkWsoOgVJA@mail.gmail.com>
	<5171720E.4000105@rabbitmq.com>
	<CALj+zz+McFLrLy1mVgrYZHHv1hXnUkA6FuB7KVmB8Q4zkX8NpA@mail.gmail.com>
Message-ID: <51751A9A.70408@rabbitmq.com>

The documentation says:

> Set ERLANG_HOME to where you actually put your Erlang installation,
> e.g. C:\Program Files\erlx.x.x (full path). The RabbitMQ batch files
> expect to execute %ERLANG_HOME%\bin\erl.exe.
>
> Go to Start > Settings > Control Panel > System > Advanced >
> Environment Variables. Create the system environment variable
> ERLANG_HOME and set it to the full path of the directory which
> contains bin\erl.exe.

Which part of this is not clear?

Also, to reiterate: installing on Windows manually is quite fiddly. 
Unless you have a good reason not to, I strongly recommend you use the 
Windows installer.

Cheers, Simon

On 20/04/13 11:17, Jisho k Jose wrote:
> Hi Rabbitmq team,
>
> I read the Documentation for setting ERLANG_HOME.but I couldnt
> understand how it works.can u pls explain in detail.
>
> Thank you,
> Jisho k jose
>
>
> On Fri, Apr 19, 2013 at 10:04 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Did you set ERLANG_HOME as documented at that page?
>
>     Alternatively, unless you have a good reason not to, you will find
>     it easier to install using the Windows installer:
>
>     http://www.rabbitmq.com/__install-windows.html
>     <http://www.rabbitmq.com/install-windows.html>
>
>     Cheers, Simon
>
>
>     On 19/04/13 16:19, Jisho k Jose wrote:
>
>         Hi  Rabbitmq team,
>
>         I am new in Rabbitmq and Erlang.I want to setup Chat server so i
>         wish to
>         develop with rabbitmq.I am using Windows machine.I downloaded
>         the setup
>         from http://www.rabbitmq.com/__install-windows-manual.html.__and
>         <http://www.rabbitmq.com/install-windows-manual.html.and> Erlang is
>         set up But when i start the rabbitmq-server on command promt it
>         shows
>         the error like"*ERLANG_HOME not set correctly..*".How can we
>         solve these
>
>         issue?.I already read the guideline from your web site.But i
>         cant solve
>         the issue.I hope you can replay the solution Asap.
>
>         Thank You,
>         Jisho K Jose.
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Apr 22 12:14:00 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 22 Apr 2013 12:14:00 +0100
Subject: [rabbitmq-discuss] Prioritizing Between Queues
In-Reply-To: <27bbed3c-22c8-49d0-b021-b91a124e7d3c@googlegroups.com>
References: <27bbed3c-22c8-49d0-b021-b91a124e7d3c@googlegroups.com>
Message-ID: <51751B78.6080604@rabbitmq.com>

On 21/04/13 12:39, Tomer Paz wrote:
> Hi
> Two issues, starting with the simple one:
>
> 1. If a consumer (sub) declared a queue with topic binding key that has
> wild pattern, like "type_a.*"
>      Then a publisher declared a queue that meets this binding key as
> well via routing key "type_a.something".

Bear in mind this is not really declaring a queue. Publishers stick 
routing keys on messages. At the moment the message is received by the 
broker, the routing key is compared to the bindings that exist, and the 
message is added to all matching queues.

>      Will the broker dynamically 'subscribe' the consumer above to the
> new queue created by the publisher? even though the consumer did not
> 'declare' such queue specifically, during its queue declaration? i.e.
> will broker push messages to that consumer from the new queue
> dynamically at run time?

As far as I understand what you mean, the answer is yes.

> 2.I have read everything about AMQP in-queue priority feature requirements.
>    I have not found if there is a way for RabbitMQ broker to do the
> following however:
>
>    let clients subscribe to several queues, But prioritize which queue
> they take messages from, in a fashion different than the simple round-robin.
>    In other words, we wish to have some algo that Broker could decide
> about *prioritizing queues* for consumers, rather than simple
> round-robin to them.
>    Example:
>     we have Q1 responsible for messages of task type A. Type A has
> priority 1
>     we have Q2 responsible for messages of task type B. Type B has
> priority 2
>     .... Q3... Type C.. priority 3.
>    Now consumer client(s) subscribe to consume messages from all Queues
> (1..3).
>    We wish Broker could give different priority for the three queues. It
> would be even more powerful if for example:
>    At some point, there are very little # of messages in Q1. However Q3
> is 'full', or to be more sophisticated, the Rate in which tasks in Q3
>    handled is too slow. We wish to Dynamically change priority for the
> three queues in such case (thus dynamic prioritization of queues)

Hmm. You can have your application consume from all three queues and 
control its own rate of consumption (possibly cancelling consumption 
from lower priority queues if it is too busy with higher priority ones). 
That does put more onus on the consumer though.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Apr 22 12:15:48 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 22 Apr 2013 12:15:48 +0100
Subject: [rabbitmq-discuss] .NET Subscription class
In-Reply-To: <CANV4tdUoVU-Exx_8tP=6pTArkf4tgR8jMeLAj6QD14ssgGyuWw@mail.gmail.com>
References: <7ddd61d5-9d4e-4434-9039-3777b0bbbde0@googlegroups.com>
	<5175067B.5040905@rabbitmq.com>
	<CANV4tdUoVU-Exx_8tP=6pTArkf4tgR8jMeLAj6QD14ssgGyuWw@mail.gmail.com>
Message-ID: <51751BE4.8050902@rabbitmq.com>


On 22/04/13 10:56, ????? ??????? wrote:
> I'm using *Subscription* class to consume messages and in RabbitMQ
> Management plugin in queue consumers section i cant see them.
Thanks for explaining. I think your suggestion has some merit so I've
filed a bug for it.


-Emile




From tim at rabbitmq.com  Mon Apr 22 12:10:47 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 22 Apr 2013 12:10:47 +0100
Subject: [rabbitmq-discuss] 3.0.4 extremely unstable in production...?
In-Reply-To: <398f5f6d-22c0-49ec-989b-6cfae1416cda@googlegroups.com>
References: <a3b2aa1d-b3f7-4093-9047-00bb579179c3@googlegroups.com>
	<398f5f6d-22c0-49ec-989b-6cfae1416cda@googlegroups.com>
Message-ID: <51751AB7.8070901@rabbitmq.com>

Hi Jacques,

Have you posted details about this to the mailing list previously? I 
didn't see anything specific from you in the last week or so.

Would you be able to provide logs and/or further information about your 
setup? Obviously we're keen to track down any bugs that cause 
operational issues and resolve them asap.

Cheers,
Tim

On 04/19/2013 04:06 PM, Jacques Doubell wrote:
> We have also recently upgraded to 3.0.4 and have since then had 2 
> outages. In the one case the service was running but non functional. 
> The logs didn't have errors, but at a certain point just stopped 
> receiving new connections. We had to restart the service and all was 
> well until about a week later when there were a lot of heaped up 
> messages server side but clients could not connect to the queue 
> anymore. (server actively refused connection message from the client 
> side). We will be downgrading to 2.8.x in the mean time.
>
> On Friday, April 12, 2013 8:36:22 PM UTC+2, Matt Wise wrote:
>
>     We've been running RabbitMQ 2.8.x in production in Amazon for
>     about 16 months now without very many issues. Last week we ran
>     into an issue where our 2.8.5 cluster nodes hit their
>     high-memory-limit and stopped processing jobs, effectively taking
>     down our entire Celery task queue. We decided to upgrade the
>     software to 3.0.4 (which had been running in staging for a few
>     weeks, as a single instance, without issue) and at the same time
>     beef up the size and redundancy of our farm to 3 machines that
>     were m1.larges.
>
>     Old Farm:
>       server1: m1.small, 2.8.5, us-west-1c
>       server2: m1.small, 2.8.5, us-west-1c
>
>     New Farm:
>       server1: m1.large, 3.0.4, us-west-1a
>       server2: m1.large, 3.0.4, us-west-1c
>       server3: m1.large, 3.0.4, us-west-1c
>
>     Since creating the new server farm though we've had 3 outages. In
>     the first two outages we received a Network Partition Split, and
>     effectively all 3 of the systems decided to run their own queues
>     independently of the other servers. This was the first time we'd
>     ever seen this failure, ever. In the most recent failure we had 2
>     machines split off, and the 3rd rabbitmq service effectively
>     became unresponsive entirely.
>
>     For sanity sake, at this point we've backed down to the following
>     configuration:
>
>     New-New Farm:
>       server1: m1.large, 2.8.5, us-west-1c
>       server2: m1.large, 2.8.5, us-west-1a
>
>     Up until recently though I had felt extremely comfortable with
>     RabbitMQ's clustering technology and reliability... now ... not so
>     much. Has anyone else seen similar behaviors? Is it simply due to
>     the fact that we're running cross-zone now in Amazon, or is it
>     more likely the 3 servers that caused the problem? Or the 3.0.x
>     upgrade?
>
>     --Matt
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/3214617d/attachment.htm>

From tim at rabbitmq.com  Mon Apr 22 12:23:53 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 22 Apr 2013 12:23:53 +0100
Subject: [rabbitmq-discuss] 3.0.4 extremely unstable in production...?
In-Reply-To: <51774816-5095-4EA4-9130-F764C83D2A48@nextdoor.com>
References: <a3b2aa1d-b3f7-4093-9047-00bb579179c3@googlegroups.com>
	<516BC567.8020602@rabbitmq.com> <516BCAA2.7060504@rabbitmq.com>
	<51774816-5095-4EA4-9130-F764C83D2A48@nextdoor.com>
Message-ID: <51751DC9.2040500@rabbitmq.com>

Hi Matt,

On 04/16/2013 10:58 PM, Matt Wise wrote:
> Interesting... We are still running one node in us-west-1a, and one in us-west-1c. Today alone we saw 3 network glitches on the node in us-west-1a where it became unable to connect to remote services in other datacenters. Obviously the hardware or rack that machine is living on is having problems.
>
> The interesting part though is that RabbitMQ did not seem to report a network partition during these events now that we're running 2.8.5 and only two nodes instead of three. I'm still digging through the logs to see if there were other interruptions, but it still feels like the code is either:
>    a) more stable with 2 nodes
>    b) more fault-tolerant in 2.8.5 than it is in 3.0.4

If RabbitMQ doesn't report a partition, that can be due to the net tick 
time being exceeded - which Michael L mentioned in his follow-up email; 
Michael's advice seems sound to me, although I've only a little 
experience with EC2 myself.

In terms of stability, I should point out that if a 2.8.5 cluster is not 
detecting a partition but a 3.x cluster is, then the 3.x cluster is 
doing the right thing - whether deliberately or not (viz Simon's email). 
It's also *very* likely that if you're seeing a difference in behaviour, 
then that is due to altered operating (i.e., environmental) parameters, 
given that the partition handling code has not changed between the two 
aforementioned versions.

On the whole, an 'undetected' partition is really bad news, because the 
mnesia (distributed database) system of record needs to be kept 
synchronised and detecting (and responding to) partitions is a very 
necessary part of this. One bug that we have seen before, for example, 
pertains to nodes that go offline and recover faster than the net 
ticktime and therefore leave stale information in mnesia which can 
result in message loss (when a surviving node forwards messages to a 
queue process id that is no longer valid, because it pertained to a 
process that was running before the remote node went offline). I'm not 
saying that bug is relevant to your case, but simply pointing out that 
detecting partitions is better (from a consistency standpoint) than not.

In terms of the issue you're seeing: as Emile points out, Rabbit 
clustering is not at all tolerant of network partitions and as Simon 
mentioned previously, in 3.x we're more active about displaying 
partitions and in the up-coming 3.1 release, we are providing features 
that will allow clustered brokers to actively attempt to resolve 
partitions if/when possible. It's quite possible that with the upcoming 
3.1 features, you will be able to resolve your situation, perhaps with 
the additional changes to your EC2 infrastructure/setup that Michael 
recommended.

Cheers,
Tim


From emile at rabbitmq.com  Mon Apr 22 12:56:02 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 22 Apr 2013 12:56:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ with many queues
In-Reply-To: <CAL8idP3xQuAU5Lr9zkRgncUgQfVKGnZETX=1PJnXXWhznTQh6w@mail.gmail.com>
References: <CAL8idP0qhp5mcM887v9FkRLCSZwbx1MjVdHZ==73FX7K68qoGQ@mail.gmail.com>
	<516EBE70.6070403@rabbitmq.com>
	<CAL8idP3xQuAU5Lr9zkRgncUgQfVKGnZETX=1PJnXXWhznTQh6w@mail.gmail.com>
Message-ID: <51752552.60700@rabbitmq.com>

Hi Eric,

On 18/04/13 14:23, Eric Berg wrote:
> Thanks for the reply Emile. Right now we have a 4 node cluster with
> primary and failover haproxy round robin load balancers, so dynamic
> generation of queues tend to be pretty well distributed especially with
> a 2 node ha policy. I guess it will just take some close monitoring to
> verify that the resources are not being exhausted, though even adding
> new nodes to the cluster would not help in that case correct? Since in a
> 4 node cluster with a 2 node ha policy, only newly created queues would
> be replicated to the new node? How do others handle situations like this?

Queues won't mirror themselves on a new node spontaneously, so the
opportunities for rebalancing is limited to queue creation and node
death at the moment. In the case of an "exactly" policy the list of
candidate nodes is randomised when mirror nodes are picked, so that
offers some opportunity for rebalancing by restarting nodes.

If you want to guarantee that a node is mirrored on a particular new
node then you can use the "nodes" policy and spell out exactly which
nodes the queue should live on.

> - PHP -
> On a related note, we have had some unfortunate experiences when testing
> a few different php libraries and Rabbit kicks in its flow control. It
> looks like that our producers using various php libs in an Apache
> setting dont handle the flow control well, while the php connection dies
> Rabbit still thinks they are active even though no producing is coming
> across, filling up the file descriptors. 

The flow-control as implemented by the broker should not depend on the
client library, as it works on the network level. It is possible that
you see old blocked connections in the output of "rabbitmqctl
list_connections". This problem is not limited to PHP, it is a general
problem that we have not yet found a solution to.



-Emile




From aflaed at gmail.com  Mon Apr 22 13:24:34 2013
From: aflaed at gmail.com (=?UTF-8?B?0J3QsNC40LvRjCDQodCw0LvQuNGF0L7Qsg==?=)
Date: Mon, 22 Apr 2013 16:24:34 +0400
Subject: [rabbitmq-discuss] .NET Subscription class
In-Reply-To: <51751BE4.8050902@rabbitmq.com>
References: <7ddd61d5-9d4e-4434-9039-3777b0bbbde0@googlegroups.com>
	<5175067B.5040905@rabbitmq.com>
	<CANV4tdUoVU-Exx_8tP=6pTArkf4tgR8jMeLAj6QD14ssgGyuWw@mail.gmail.com>
	<51751BE4.8050902@rabbitmq.com>
Message-ID: <CANV4tdW2KdeEYtXg=N1aQfw4vDCcX7+R9Q43pZKxZvRSBSSqbg@mail.gmail.com>

Ok, thank you, I think it can be useful not only for me.


2013/4/22 Emile Joubert <emile at rabbitmq.com>

>
> On 22/04/13 10:56, ????? ??????? wrote:
> > I'm using *Subscription* class to consume messages and in RabbitMQ
> > Management plugin in queue consumers section i cant see them.
> Thanks for explaining. I think your suggestion has some merit so I've
> filed a bug for it.
>
>
> -Emile
>
>
>
>


-- 
? ?????????,
??????? ?????
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/eddd85b5/attachment.htm>

From simon at rabbitmq.com  Mon Apr 22 13:27:03 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 22 Apr 2013 13:27:03 +0100
Subject: [rabbitmq-discuss] Rabbit crash
In-Reply-To: <06536F18C0038E489237EEE3CA9BF2D0140128D8@FRGR1D2MX07.services.firstrand.net>
References: <06536F18C0038E489237EEE3CA9BF2D014012434@FRGR1D2MX07.services.firstrand.net>
	<51750B45.4080701@rabbitmq.com>
	<06536F18C0038E489237EEE3CA9BF2D0140128D8@FRGR1D2MX07.services.firstrand.net>
Message-ID: <51752C97.7030607@rabbitmq.com>

Hi. That's a reasonably old version of RabbitMQ; quite a few bugs in HA 
have been fixed since then. So an upgrade is recommended. Having said 
that there is nothing with the exact stack trace from your logs but it's 
possible that it's a side effect of something else that we have fixed.

Cheers, Simon

On 22/04/13 11:23, Jeffery, Mark wrote:
> Thanks.
>
> It is Version 2.8.4
>
> Attached are the logs.
>
> I really appreciate any help.
>
> Jeff
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: Monday, April 22, 2013 12:05 PM
> To: Discussions about RabbitMQ
> Cc: Jeffery, Mark
> Subject: Re: [rabbitmq-discuss] Rabbit crash
>
> Which version of RabbitMQ are you running?
>
> Also: is there nothing in the logs before these {error,not_found} reports? It looks like a side effect of something else already having gone wrong. Could you post the complete logs (regular and sasl ones) somewhere?
>
> Cheers, Simon
>
> On 22/04/13 07:26, Jeffery, Mark wrote:
>> Hello
>>
>> We have a cluster of 6 Rabbit Nodes.
>> All disk nodes.
>>
>> One keeps crashing (around 3 times a day), the others are fine.
>>
>>   From what I can see, it restarts itself and carries on.
>>
>> The last time however, it didn?t come up because it said ?already running?.
>>
>> When the process was killed manually, the entire cluster came down ?
>>
>> I cannot interpret the crash report.
>>
>> I have attached it.
>>
>> Can anyone see what the problem is ?
>>
>> To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser:
>> https://www.fnb.co.za/disclaimer.html
>>
>> If you are unable to access the Disclaimer, send a blank e-mail to
>> firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser:
> https://www.fnb.co.za/disclaimer.html
>
> If you are unable to access the Disclaimer, send a blank e-mail to
> firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.
>


-- 
Simon MacMullen
RabbitMQ, VMware

From MJeffery at fnb.co.za  Mon Apr 22 14:38:45 2013
From: MJeffery at fnb.co.za (Jeffery, Mark)
Date: Mon, 22 Apr 2013 13:38:45 +0000
Subject: [rabbitmq-discuss] Rabbit crash
In-Reply-To: <51752C97.7030607@rabbitmq.com>
References: <06536F18C0038E489237EEE3CA9BF2D014012434@FRGR1D2MX07.services.firstrand.net>
	<51750B45.4080701@rabbitmq.com>
	<06536F18C0038E489237EEE3CA9BF2D0140128D8@FRGR1D2MX07.services.firstrand.net>
	<51752C97.7030607@rabbitmq.com>
Message-ID: <06536F18C0038E489237EEE3CA9BF2D01401311B@FRGR1D2MX07.services.firstrand.net>

Ok, thanks.

Upgrading our live boxes will be a lengthy process.

Is there anything I can do in the meantime ?

Where can I look ? Is it network related ? OS related ?

I will schedule the upgrade so long.

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Monday, April 22, 2013 2:27 PM
To: Jeffery, Mark
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Rabbit crash

Hi. That's a reasonably old version of RabbitMQ; quite a few bugs in HA have been fixed since then. So an upgrade is recommended. Having said that there is nothing with the exact stack trace from your logs but it's possible that it's a side effect of something else that we have fixed.

Cheers, Simon

On 22/04/13 11:23, Jeffery, Mark wrote:
> Thanks.
>
> It is Version 2.8.4
>
> Attached are the logs.
>
> I really appreciate any help.
>
> Jeff
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: Monday, April 22, 2013 12:05 PM
> To: Discussions about RabbitMQ
> Cc: Jeffery, Mark
> Subject: Re: [rabbitmq-discuss] Rabbit crash
>
> Which version of RabbitMQ are you running?
>
> Also: is there nothing in the logs before these {error,not_found} reports? It looks like a side effect of something else already having gone wrong. Could you post the complete logs (regular and sasl ones) somewhere?
>
> Cheers, Simon
>
> On 22/04/13 07:26, Jeffery, Mark wrote:
>> Hello
>>
>> We have a cluster of 6 Rabbit Nodes.
>> All disk nodes.
>>
>> One keeps crashing (around 3 times a day), the others are fine.
>>
>>   From what I can see, it restarts itself and carries on.
>>
>> The last time however, it didn?t come up because it said ?already running?.
>>
>> When the process was killed manually, the entire cluster came down ?
>>
>> I cannot interpret the crash report.
>>
>> I have attached it.
>>
>> Can anyone see what the problem is ?
>>
>> To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser:
>> https://www.fnb.co.za/disclaimer.html
>>
>> If you are unable to access the Disclaimer, send a blank e-mail to 
>> firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser:
> https://www.fnb.co.za/disclaimer.html
>
> If you are unable to access the Disclaimer, send a blank e-mail to 
> firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.
>


--
Simon MacMullen
RabbitMQ, VMware

To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser: 
https://www.fnb.co.za/disclaimer.html 

If you are unable to access the Disclaimer, send a blank e-mail to
firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.

From sean.mccully at RACKSPACE.COM  Mon Apr 22 14:52:44 2013
From: sean.mccully at RACKSPACE.COM (Sean McCully)
Date: Mon, 22 Apr 2013 13:52:44 +0000
Subject: [rabbitmq-discuss] Rabbitmq Server dies unexpectedly
In-Reply-To: <51750158.7050705@rabbitmq.com>
Message-ID: <CD9AA9D9.48CE%sean.mccully@RACKSPACE.com>

Hi,


Thanks for pointing this out as something to look at, it appears that
rabbitmq-server is frequently being killed because of an OOM handler.





Sean

On 4/22/13 4:22 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:

>
>
>Hi,
>
>On 19/04/13 22:17, Sean McCully wrote:
>> $ tail startup_err
>> Killed
>
>Have you ruled out the possibility that the OS process for the Erlang VM
>was killed - either explicitly or by an OOM handler? You should be able
>to verify the latter by inspecting the OS logs.
>
>
>
>
>
>-Emile
>
>
>
>
>


From matt at nextdoor.com  Mon Apr 22 16:12:24 2013
From: matt at nextdoor.com (Matt Wise)
Date: Mon, 22 Apr 2013 08:12:24 -0700
Subject: [rabbitmq-discuss] 3.0.4 extremely unstable in production...?
In-Reply-To: <51751DC9.2040500@rabbitmq.com>
References: <a3b2aa1d-b3f7-4093-9047-00bb579179c3@googlegroups.com>
	<516BC567.8020602@rabbitmq.com> <516BCAA2.7060504@rabbitmq.com>
	<51774816-5095-4EA4-9130-F764C83D2A48@nextdoor.com>
	<51751DC9.2040500@rabbitmq.com>
Message-ID: <78D61D6F-A654-4992-BEDB-ED52547D5396@nextdoor.com>

Thanks guys for all of the feedback and details. We've been doing some testing with clusters of 2 and 3 RabbitMQ nodes and we've noticed that its relatively easy to trigger a partition with 3 nodes, but when we use 2 it seems that its much more resilient.

In the short term, I think we're going to use 2 nodes in our RabbitMQ farm. We're working on a patch for Celery that leverages our nd_service_registry module (https://github.com/nextdoor/ndserviceregistry) to dynamically discover the RabbitMQ nodes. With this code, we should be able to have all of our clients connect to 'the first' host in the RabbitMQ farm thats available... so in the event of a network partition, our servers will still all be connected to the same place. This leaves the second node as a data mirror, and failover server just in case the first server fails.

Once 3.1 is out and we can experiment more with some of the automatic healing-code you guys are working on, we'll re-evaluvate the layout and see where we go from there. Federation is really interesting, but I think for now we'd rather keep the environment as simple as possible.

--Matt

On Apr 22, 2013, at 4:23 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Matt,
> 
> On 04/16/2013 10:58 PM, Matt Wise wrote:
>> Interesting... We are still running one node in us-west-1a, and one in us-west-1c. Today alone we saw 3 network glitches on the node in us-west-1a where it became unable to connect to remote services in other datacenters. Obviously the hardware or rack that machine is living on is having problems.
>> 
>> The interesting part though is that RabbitMQ did not seem to report a network partition during these events now that we're running 2.8.5 and only two nodes instead of three. I'm still digging through the logs to see if there were other interruptions, but it still feels like the code is either:
>>   a) more stable with 2 nodes
>>   b) more fault-tolerant in 2.8.5 than it is in 3.0.4
> 
> If RabbitMQ doesn't report a partition, that can be due to the net tick time being exceeded - which Michael L mentioned in his follow-up email; Michael's advice seems sound to me, although I've only a little experience with EC2 myself.
> 
> In terms of stability, I should point out that if a 2.8.5 cluster is not detecting a partition but a 3.x cluster is, then the 3.x cluster is doing the right thing - whether deliberately or not (viz Simon's email). It's also *very* likely that if you're seeing a difference in behaviour, then that is due to altered operating (i.e., environmental) parameters, given that the partition handling code has not changed between the two aforementioned versions.
> 
> On the whole, an 'undetected' partition is really bad news, because the mnesia (distributed database) system of record needs to be kept synchronised and detecting (and responding to) partitions is a very necessary part of this. One bug that we have seen before, for example, pertains to nodes that go offline and recover faster than the net ticktime and therefore leave stale information in mnesia which can result in message loss (when a surviving node forwards messages to a queue process id that is no longer valid, because it pertained to a process that was running before the remote node went offline). I'm not saying that bug is relevant to your case, but simply pointing out that detecting partitions is better (from a consistency standpoint) than not.
> 
> In terms of the issue you're seeing: as Emile points out, Rabbit clustering is not at all tolerant of network partitions and as Simon mentioned previously, in 3.x we're more active about displaying partitions and in the up-coming 3.1 release, we are providing features that will allow clustered brokers to actively attempt to resolve partitions if/when possible. It's quite possible that with the upcoming 3.1 features, you will be able to resolve your situation, perhaps with the additional changes to your EC2 infrastructure/setup that Michael recommended.
> 
> Cheers,
> Tim
> 


From cjbhaines at gmail.com  Mon Apr 22 17:07:57 2013
From: cjbhaines at gmail.com (Chris Haines)
Date: Mon, 22 Apr 2013 09:07:57 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET Client ConnectionFactory threading
	issues
In-Reply-To: <760f1fb1-98dd-4c6a-be1e-9a2efbf81309@googlegroups.com>
References: <9ed4e339-a6e5-4018-a971-add4a68efcbc@googlegroups.com>
	<760f1fb1-98dd-4c6a-be1e-9a2efbf81309@googlegroups.com>
Message-ID: <7e9335d5-d38f-4eb9-91aa-28e3ecf0ab7b@googlegroups.com>

Hi Michal,

I tried running this against 2 different machines as well. Against a server 
2.8.7 hosted on linux and a server 3.0.4 hosted on server 2008. 

The reason we want to do this is because we have a highly concurrent 
application serving around 300-600 threads each with its own consumer and a 
set of publishers. We were seeing poor throughput over one connection and I 
did some tests which show higher data throughput when using a larger number 
of connections. The only problem we seem to have with it is with the 
concurrent usage of the ConnectionFactory. I have gotten around this for 
now by creating all of the connections on the startup thread and after that 
the connections are shared between all of the threads and we see better 
performance. The broker seems to cope fine with about 1250 connections 
(running several instances of our server application).

I have asked my colleagues to run this as well and they are seeing the same 
symptoms. We are all running Win7 64 as well.

Cheers,
Chris 

On Saturday, 20 April 2013 05:20:04 UTC+1, Michal Lev? wrote:
>
> Hey
>
> All your tests run just fine on my machine (Win7 64)
> CanCreateConnectionsMultiThreaded: Elapsed seconds: 2,9939693
> CanCreateConnectionsMultiThreadedWithLock: Elapsed seconds: 4,3135879
>
> Two difference here:
> - im connecting to remote RabbitMQ running on Debian (not localhost)
> - my client\server version is 3.0.2
>
> Here are few things to consider.
> 1) You are connecting to localhost. Each Rabbit connection opens 3 sockets 
> (2 for heartbeats). With 100 connections, its minimum 300 + 300 sockets 
> trying to open at the same time. Maybe your Win host cant handle it ?
> 2) Why are you trying to open 100 connection from one machine anyway ? Its 
> real wasting of resources. Do you know, you can run multiple independent 
> Rabbit channels on single connection ?
>
> Michal
>
> On Thursday, April 18, 2013 1:37:40 PM UTC+2, Chris Haines wrote:
>>
>> Hi All,
>>
>> I have attached a .cs Nunit test fixture to demonstrate a problem I am 
>> having with the ConnectionFactory. If I create 100 connections in a for 
>> loop single threaded then I can create them all in about 2 seconds. If I 
>> create them via a number of threads, in my test I am using 100 threads to 
>> create a connection on each, then I get a lot of timeout exceptions (my 
>> test bails out after 60 seconds). I have tried sharing an instance of the 
>> ConnectionFactory between all threads and also giving each thread its own 
>> instance but they both have the same result. I have also tried locking 
>> around the call to CreateConnection but that also didn't help. 
>>
>> I find this behavior to be very strange. Has anyone else had similar 
>> problems?
>>
>> Cheers,
>> Chris
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/bbc66d36/attachment.htm>

From Logan.Rodrian at ngc.com  Mon Apr 22 17:38:16 2013
From: Logan.Rodrian at ngc.com (Rodrian, Logan P (IS))
Date: Mon, 22 Apr 2013 16:38:16 +0000
Subject: [rabbitmq-discuss] Memory not flushing to disk
Message-ID: <4DFE44D4C0517D4F9B084F24850A71571B229700@XMBC3084.northgrum.com>

I am having an issue where I am pushing data to queues and after some point, a particular queue stop batching the in-memory data to disk, it appears.  In the included data below, the queue in question is queue E.  As seen from the backing_queue_status, queue E has {ram_msg_count,396922} and {persistent_count,2572735}.  In the case of queue C, which contains more messages, none of them are residing in memory.

I have a rabbitmq.config as follows:
[
  {rabbit, [ {hipe_compile, false},
             {collect_statistics_interval, 10000},
             {disk_free_limit, 50000000},
             {tcp_listeners, [5678]}
            ] },
  {rabbitmq_management_agent, [ {force_fine_statistics, false}
                              ] }
].

It appears that at some point the flushing stops and then once the vm_memory_high_watermark is hit, I get a message informing me.

My question is two-fold:
  1) Has this been seen before/is there a solution already out there?
  2) Is there a configuration parameter that tells rabbitmq to write messages immediately to disk instead of buffering to memory first?




DATA

Queues on /:
name    durable  msg_ready    msg_unackd   messages    consumers    active_consumers    memory
A       true     962          0            962         0            0                   230848
B       true     0            0            0           1            1                   22240
C       true     7688286      0            7688286     0            0                   973696
D       true     3847206      0            3847206     0            0                   4120112
E       true     2572735      0            2572735     0            0                   367917336
F       true     9334         0            9334        0            0                   4120112


backing_queue_status
A
[{q1,0}, {q2,0}, {delta,{delta,0,0,0}}, {q3,962}, {q4,0}, {len,962}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,962}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]

B
[{q1,0}, {q2,0}, {delta,{delta,0,0,0}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,2}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]

C
[{q1,0}, {q2,15}, {delta,{delta,16384,7688256,7704640}}, {q3,15}, {q4,0}, {len,7688286}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,7704655}, {persistent_count,7688286}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]

D
[{q1,0}, {q2,38}, {delta,{delta,16384,3830784,3847168}}, {q3,16384}, {q4,0}, {len,3847206}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,3847206}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]

E
[{q1,0}, {q2,45}, {delta,{delta,1671936,2138780,3810716}}, {q3,36988}, {q4,396922}, {len,2572735}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,396922}, {ram_ack_count,0}, {next_seq_id,3810761}, {persistent_count,2572735}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]

F
[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,9334}, {q4,0}, {len,9334}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,17426}, {persistent_count,9334}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]



Logan Rodrian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/a2553631/attachment.htm>

From richard at raseley.com  Mon Apr 22 23:11:59 2013
From: richard at raseley.com (Richard Raseley)
Date: Mon, 22 Apr 2013 15:11:59 -0700
Subject: [rabbitmq-discuss] Federated Cluster Issue
Message-ID: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>

Situation:

I have two clusters (cluster-01 and cluster-02) from which I am trying to
create a bi-directional federation relationship. I've completed the
following configuration pieces:

1) Set the local username on both clusters (username and password in
question are identical on both clusters).

2) Set the identity on both clusters to a unique value.

3) Added a new upstream on each cluster pointing to the other with a URI
that looks similar to the following (from the perspective of "cluster-01":

amqp://user:pass at cluster-02.domain.local/cluster02.exchange

4) Added a new policy (from the perspective of "cluster-01") with a name of
"federate-me", a pattern of "^cluster01\." and a definition of
"federation-upstream-set:all".

Based on my understanding I should now see the link listed (whether or not
is successful or producing errors) in the federation status page of
the management UI. All I see is "... no links ...". Furthermore, executing
a " rabbitmqctl eval 'rabbit_federation_status:status().' " on any of the
nodes in the two clusters returns " [] ...done. ".

The logs from the servers show no errors related to federated links.

Questions:

1) My understanding was that defining the upstream and the policy on a
particular vhost was enough to begin instantiation of the federated link.
Is this the case?

2) Since no links are visible, and no log entries are being created related
to federation, can anyone offer any advice on what I should take a look at
next?

Thank you in advance.

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/e6c926d0/attachment.htm>

From carl.hoerberg at gmail.com  Tue Apr 23 02:53:11 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Mon, 22 Apr 2013 18:53:11 -0700 (PDT)
Subject: [rabbitmq-discuss] /api/overview doesn't respect "columns" query
Message-ID: <1366681991831-26155.post@n5.nabble.com>

GET /api/overview?columns=message_stats.publish
returns the same content as 
GET /api/overview



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/api-overview-doesn-t-respect-columns-query-tp26155.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From penxiao at cisco.com  Tue Apr 23 03:53:22 2013
From: penxiao at cisco.com (Peng Xiao -X (penxiao))
Date: Tue, 23 Apr 2013 02:53:22 +0000
Subject: [rabbitmq-discuss] RabbitMQ use in a bad network environment
Message-ID: <5A34F4AC18539E47A797E3916C0E55B10F5A0713@xmb-aln-x10.cisco.com>

Hi friends

I have a user environment that the connection between the message sender and RabbitMQ is bad, it has high delay, packet loss and the line  across the internet.

Does this environment suitable for RabbitMQ?  If not, what possible method should be used in this environment if I want to send messages to backend system across the internet.

Thanks.

Best
Regards,

Xiao Peng(??)
Cisco Systems
GSP-Beijing (China)
Office: +86 10 8507 7181
Mobile: +86 18600560077(preferred)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130423/0794589f/attachment.htm>

From smallfish.xy at gmail.com  Tue Apr 23 04:04:25 2013
From: smallfish.xy at gmail.com (smallfish)
Date: Tue, 23 Apr 2013 11:04:25 +0800
Subject: [rabbitmq-discuss] RabbitMQ use in a bad network environment
In-Reply-To: <5A34F4AC18539E47A797E3916C0E55B10F5A0713@xmb-aln-x10.cisco.com>
References: <5A34F4AC18539E47A797E3916C0E55B10F5A0713@xmb-aln-x10.cisco.com>
Message-ID: <CACPpB2yjN4DxhYY4QHGb6GGf3phqxhxaS9c_WF=wJHpqDwN1ew@mail.gmail.com>

Perhaps wrap rabbit for http service will better, some times ago, I wrote
similar serivce: http://chenxiaoyu.org/2013/03/28/rabbitmq-http.html

--
smallfish http://chenxiaoyu.org


On Tue, Apr 23, 2013 at 10:53 AM, Peng Xiao -X (penxiao)
<penxiao at cisco.com>wrote:

>  Hi friends****
>
> ** **
>
> I have a user environment that the connection between the message sender
> and RabbitMQ is bad, it has high delay, packet loss and the line  across
> the internet.****
>
> ** **
>
> Does this environment suitable for RabbitMQ?  If not, what possible method
> should be used in this environment if I want to send messages to backend
> system across the internet.****
>
> ** **
>
> Thanks.****
>
> ** **
>
> Best****
>
> Regards,****
>
>  ****
>
> Xiao Peng(??)****
>
> Cisco Systems****
>
> GSP-Beijing (China)****
>
> Office: +86 10 8507 7181****
>
> Mobile: +86 18600560077(preferred)****
>
> ** **
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130423/e27ab72f/attachment.htm>

From brett.r.cameron at gmail.com  Tue Apr 23 04:25:33 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Tue, 23 Apr 2013 15:25:33 +1200
Subject: [rabbitmq-discuss] RabbitMQ use in a bad network environment
In-Reply-To: <CACPpB2yjN4DxhYY4QHGb6GGf3phqxhxaS9c_WF=wJHpqDwN1ew@mail.gmail.com>
References: <5A34F4AC18539E47A797E3916C0E55B10F5A0713@xmb-aln-x10.cisco.com>
	<CACPpB2yjN4DxhYY4QHGb6GGf3phqxhxaS9c_WF=wJHpqDwN1ew@mail.gmail.com>
Message-ID: <CALPqkiq3F1K+9PURCJbS+2cbbqVMV6D3RWbRmUaP+_7qZpd8VQ@mail.gmail.com>

You might also want to look at MQTT (http://mqtt.org/) and the RabbitMQ
MQTT adapter (http://www.rabbitmq.com/blog/2012/09/12/mqtt-adapter/).

Regards,
Brett


On Tue, Apr 23, 2013 at 3:04 PM, smallfish <smallfish.xy at gmail.com> wrote:

> Perhaps wrap rabbit for http service will better, some times ago, I wrote
> similar serivce: http://chenxiaoyu.org/2013/03/28/rabbitmq-http.html
>
> --
> smallfish http://chenxiaoyu.org
>
>
> On Tue, Apr 23, 2013 at 10:53 AM, Peng Xiao -X (penxiao) <
> penxiao at cisco.com> wrote:
>
>>  Hi friends****
>>
>> ** **
>>
>> I have a user environment that the connection between the message sender
>> and RabbitMQ is bad, it has high delay, packet loss and the line  across
>> the internet.****
>>
>> ** **
>>
>> Does this environment suitable for RabbitMQ?  If not, what possible
>> method should be used in this environment if I want to send messages to
>> backend system across the internet.****
>>
>> ** **
>>
>> Thanks.****
>>
>> ** **
>>
>> Best****
>>
>> Regards,****
>>
>>  ****
>>
>> Xiao Peng(??)****
>>
>> Cisco Systems****
>>
>> GSP-Beijing (China)****
>>
>> Office: +86 10 8507 7181****
>>
>> Mobile: +86 18600560077(preferred)****
>>
>> ** **
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130423/c6c10f81/attachment.htm>

From baniu.yao at gmail.com  Tue Apr 23 07:04:46 2013
From: baniu.yao at gmail.com (=?UTF-8?B?5aea5LuB5o23?=)
Date: Mon, 22 Apr 2013 23:04:46 -0700 (PDT)
Subject: [rabbitmq-discuss] UI shows zero message rate in 3.0.4
Message-ID: <bc5cd537-513f-409c-937c-5e95bffa6b58@googlegroups.com>

Hi guys, 

I've met a strange problem in a long time. In UI, I found some 
connections's message rate shows '0.00/s' but actually this connection is 
producing or cosuming message.

plus,

1. sometimes all connection from ONE node all showed '0.00/s' and 
restarting this node cannot help, the only way to solve this is break up 
whole cluster and re-join.
2. some of connection of a certain queue(not all connections) show '0.00/s'.
3. ALL CONNECTION which show '0.00/s'  IS woking well.

I've googled this problem, some say the connection is short-period, but 
I've confirmed my connection is long-period. And my rabbitmq is 3.0.4.

Below and attachment is my screenshots:


<https://lh4.googleusercontent.com/-TnF5v8ZPBlA/UXYhnfEAcSI/AAAAAAAAABo/vkurg2P_Wls/s1600/Screenshot+from+2013-04-23+12%3A46%3A03.png>

<https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
<https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
<https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
<https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/21c4ee47/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screenshot from 2013-04-23 12:46:03.png
Type: image/png
Size: 53565 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/21c4ee47/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screenshot from 2013-04-23 13:49:53.png
Type: image/png
Size: 59067 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/21c4ee47/attachment-0001.png>

From baniu.yao at gmail.com  Tue Apr 23 07:52:56 2013
From: baniu.yao at gmail.com (Frank Yao)
Date: Mon, 22 Apr 2013 23:52:56 -0700 (PDT)
Subject: [rabbitmq-discuss] UI shows zero message rate in 3.0.4
In-Reply-To: <bc5cd537-513f-409c-937c-5e95bffa6b58@googlegroups.com>
References: <bc5cd537-513f-409c-937c-5e95bffa6b58@googlegroups.com>
Message-ID: <0d4ca001-e8fc-40af-82bf-d98402af1543@googlegroups.com>

When I use 'rabbitmqadmin list queues vhost name node messages 
message_stats.publish_details.rate , this command can show normal message 
rate.

? 2013?4?23????UTC+8??2?04?46??Frank Yao???
>
> Hi guys, 
>
> I've met a strange problem in a long time. In UI, I found some 
> connections's message rate shows '0.00/s' but actually this connection is 
> producing or cosuming message.
>
> plus,
>
> 1. sometimes all connection from ONE node all showed '0.00/s' and 
> restarting this node cannot help, the only way to solve this is break up 
> whole cluster and re-join.
> 2. some of connection of a certain queue(not all connections) show 
> '0.00/s'.
> 3. ALL CONNECTION which show '0.00/s'  IS woking well.
>
> I've googled this problem, some say the connection is short-period, but 
> I've confirmed my connection is long-period. And my rabbitmq is 3.0.4.
>
> Below and attachment is my screenshots:
>
>
>
> <https://lh4.googleusercontent.com/-TnF5v8ZPBlA/UXYhnfEAcSI/AAAAAAAAABo/vkurg2P_Wls/s1600/Screenshot+from+2013-04-23+12%3A46%3A03.png>
>
>
> <https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
>
> <https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
>
> <https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
>
> <https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/85af009a/attachment.htm>

From MJeffery at fnb.co.za  Tue Apr 23 09:00:10 2013
From: MJeffery at fnb.co.za (Jeffery, Mark)
Date: Tue, 23 Apr 2013 08:00:10 +0000
Subject: [rabbitmq-discuss] Rabbit crash
In-Reply-To: <51752C97.7030607@rabbitmq.com>
References: <06536F18C0038E489237EEE3CA9BF2D014012434@FRGR1D2MX07.services.firstrand.net>
	<51750B45.4080701@rabbitmq.com>
	<06536F18C0038E489237EEE3CA9BF2D0140128D8@FRGR1D2MX07.services.firstrand.net>,
	<51752C97.7030607@rabbitmq.com>
Message-ID: <06536F18C0038E489237EEE3CA9BF2D014013A0C@FRGR1D2MX07.services.firstrand.net>

Hello

Sorry, one last question.

Could the fact that all the nodes (6) are disk nodes be the reason that the entire cluster came to a halt ?

Should I reduce the number of disk nodes ?

Thanks

Jeff
________________________________________
From: Simon MacMullen [simon at rabbitmq.com]
Sent: 22 April 2013 02:27 PM
To: Jeffery, Mark
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Rabbit crash

Hi. That's a reasonably old version of RabbitMQ; quite a few bugs in HA
have been fixed since then. So an upgrade is recommended. Having said
that there is nothing with the exact stack trace from your logs but it's
possible that it's a side effect of something else that we have fixed.

Cheers, Simon

On 22/04/13 11:23, Jeffery, Mark wrote:
> Thanks.
>
> It is Version 2.8.4
>
> Attached are the logs.
>
> I really appreciate any help.
>
> Jeff
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: Monday, April 22, 2013 12:05 PM
> To: Discussions about RabbitMQ
> Cc: Jeffery, Mark
> Subject: Re: [rabbitmq-discuss] Rabbit crash
>
> Which version of RabbitMQ are you running?
>
> Also: is there nothing in the logs before these {error,not_found} reports? It looks like a side effect of something else already having gone wrong. Could you post the complete logs (regular and sasl ones) somewhere?
>
> Cheers, Simon
>
> On 22/04/13 07:26, Jeffery, Mark wrote:
>> Hello
>>
>> We have a cluster of 6 Rabbit Nodes.
>> All disk nodes.
>>
>> One keeps crashing (around 3 times a day), the others are fine.
>>
>>   From what I can see, it restarts itself and carries on.
>>
>> The last time however, it didn?t come up because it said ?already running?.
>>
>> When the process was killed manually, the entire cluster came down ?
>>
>> I cannot interpret the crash report.
>>
>> I have attached it.
>>
>> Can anyone see what the problem is ?
>>
>> To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser:
>> https://www.fnb.co.za/disclaimer.html
>>
>> If you are unable to access the Disclaimer, send a blank e-mail to
>> firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser:
> https://www.fnb.co.za/disclaimer.html
>
> If you are unable to access the Disclaimer, send a blank e-mail to
> firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.
>


--
Simon MacMullen
RabbitMQ, VMware

To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser: 
https://www.fnb.co.za/disclaimer.html 

If you are unable to access the Disclaimer, send a blank e-mail to
firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.

From lamotte85 at gmail.com  Mon Apr 22 20:32:05 2013
From: lamotte85 at gmail.com (Dan LaMotte)
Date: Mon, 22 Apr 2013 12:32:05 -0700 (PDT)
Subject: [rabbitmq-discuss] How can RabbitMQ Shovel be configured to
 overwrite the timestamp property with the current time?
Message-ID: <e065f974-1942-44cd-b492-074061eb5161@googlegroups.com>

For instance:

    {myshovel, [
        {sources, ...}
        , {destinations, ...}
        , {queue, <<>>}
        , {ack_mode, on_confirm}
        , {publish_properties, [
            {delivery_mode, 2}
            , {timestamp, now} % this is the line I need to understand how 
to write
        ]}
        , {publish_fields, [{exchange, <<"">>}, {routing_key, <<"">>}]}
        , {reconnect_delay, 5}
    ]}


I'm curious how to write the `publish_properties` in a way so that RabbitMQ 
Shovel overwrites the timestamp with the current time (as in when the 
shovel receives the message and *shovels* it onto the destination queue).

http://stackoverflow.com/questions/16154421/how-can-rabbitmq-shovel-be-configured-to-overwrite-the-timestamp-property-with-t

I'm assuming this is either a really easy "it's possible, here's how" or 
"it's not possible".  My erlang is weak at best.

Thanks for any advice you have for me.

- Dan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130422/5d8cda7a/attachment.htm>

From watson.timothy at gmail.com  Tue Apr 23 09:21:54 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 23 Apr 2013 09:21:54 +0100
Subject: [rabbitmq-discuss] Rabbit crash
In-Reply-To: <06536F18C0038E489237EEE3CA9BF2D014013A0C@FRGR1D2MX07.services.firstrand.net>
References: <06536F18C0038E489237EEE3CA9BF2D014012434@FRGR1D2MX07.services.firstrand.net>
	<51750B45.4080701@rabbitmq.com>
	<06536F18C0038E489237EEE3CA9BF2D0140128D8@FRGR1D2MX07.services.firstrand.net>
	<51752C97.7030607@rabbitmq.com>
	<06536F18C0038E489237EEE3CA9BF2D014013A0C@FRGR1D2MX07.services.firstrand.net>
Message-ID: <27D72855-05C0-46C2-8A36-9FC1782D1D1E@rabbitmq.com>

Hi

On 23 Apr 2013, at 09:00, "Jeffery, Mark" <MJeffery at fnb.co.za> wrote:
> 
> Could the fact that all the nodes (6) are disk nodes be the reason that the entire cluster came to a halt ?
> 

That should not cause the entire cluster to come to a halt, as it's usually quite reasonable to stop an start clustered nodes (or join/leave a cluster) at runtime.

Examin the logs from all nodes around the time of the incident might yield some useful hints, but as Simon pointed out, it's most liked that the best initial course of action is to upgrade.

Cheers,
Tim

From emile at rabbitmq.com  Tue Apr 23 09:32:50 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 23 Apr 2013 09:32:50 +0100
Subject: [rabbitmq-discuss] RabbitMQ use in a bad network environment
In-Reply-To: <5A34F4AC18539E47A797E3916C0E55B10F5A0713@xmb-aln-x10.cisco.com>
References: <5A34F4AC18539E47A797E3916C0E55B10F5A0713@xmb-aln-x10.cisco.com>
Message-ID: <51764732.7080303@rabbitmq.com>


Hi,

On 23/04/13 03:53, Peng Xiao -X (penxiao) wrote:
> I have a user environment that the connection between the message sender
> and RabbitMQ is bad, it has high delay, packet loss and the line  across
> the internet.
> 
> Does this environment suitable for RabbitMQ?  If not, what possible
> method should be used in this environment if I want to send messages to
> backend system across the internet.


Yes, RabbitMQ can be used in a challenging network environment, if all
you need to do is publish and consume messages. The network only needs
to be good enough to allow a few roundtrips between the broker and the
client, and allow a single message to be transferred successfully with
reasonably high probability. If the network is not available for long
enough to transfer a single message then consider fragmenting messages.
If the connection setup cost is too high then consider using the STOMP
or MQTT adapters instead of AMQP.

On the publisher side you can use transactions or publisher confirms to
ensure that messages are successfully received by the broker.

On the consumer side you can use client-side acknowledgements to
guarantee that messages were successfully delivered. Under poor network
conditions consumers must be prepared to receive multiple copies of
messages.

You should not use clustering across unreliable network links. The
shovel and federation are superior alternatives in this case:
http://www.rabbitmq.com/distributed.html




-Emile





From tim at rabbitmq.com  Tue Apr 23 09:45:15 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 23 Apr 2013 09:45:15 +0100
Subject: [rabbitmq-discuss] How can RabbitMQ Shovel be configured to
	overwrite the timestamp property with the current time?
In-Reply-To: <e065f974-1942-44cd-b492-074061eb5161@googlegroups.com>
References: <e065f974-1942-44cd-b492-074061eb5161@googlegroups.com>
Message-ID: <1528DE31-31CF-40C3-B237-A205D2F152E3@rabbitmq.com>

Hi,

On 22 Apr 2013, at 20:32, Dan LaMotte wrote:
> I'm curious how to write the `publish_properties` in a way so that RabbitMQ Shovel overwrites the timestamp with the current time (as in when the shovel receives the message and *shovels* it onto the destination queue).
> 
> http://stackoverflow.com/questions/16154421/how-can-rabbitmq-shovel-be-configured-to-overwrite-the-timestamp-property-with-t
> 

I just answered this on SO - TL;DR the answer is that it's not possible. We're looking into some improvements for shovel though, so maybe in a future release. We'll see. If you need help writing custom client code to do this instead, feel free to drop by here or the #rabbitmq IRC channel for assistance.

Cheers,
Tim


From simon at rabbitmq.com  Tue Apr 23 10:53:42 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 23 Apr 2013 10:53:42 +0100
Subject: [rabbitmq-discuss] Federated Cluster Issue
In-Reply-To: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
References: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
Message-ID: <51765A26.3020302@rabbitmq.com>

On 22/04/13 23:11, Richard Raseley wrote:
> 4) Added a new policy (from the perspective of "cluster-01") with a name
> of "federate-me", a pattern of "^cluster01\." and a definition of
> "federation-upstream-set:all".

That pattern is meant to match exchange names - is that how your 
exchanges are named?

> Based on my understanding I should now see the link listed (whether or
> not is successful or producing errors) in the federation status page of
> the management UI. All I see is "... no links ...". Furthermore,
> executing a " rabbitmqctl eval 'rabbit_federation_status:status().' " on
> any of the nodes in the two clusters returns " [] ...done. ".
>
> The logs from the servers show no errors related to federated links.
>
> Questions:
>
> 1) My understanding was that defining the upstream and the policy on a
> particular vhost was enough to begin instantiation of the federated
> link. Is this the case?

That should be the case. My guess is that the policy is not matching any 
exchanges and so federation thinks it has nothing to do. Do you see 
"federate-me" show up in the management UI exchange list / "rabbitmqctl 
list_exchanges name policy"?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Apr 23 10:55:12 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 23 Apr 2013 10:55:12 +0100
Subject: [rabbitmq-discuss] /api/overview doesn't respect "columns" query
In-Reply-To: <1366681991831-26155.post@n5.nabble.com>
References: <1366681991831-26155.post@n5.nabble.com>
Message-ID: <51765A80.3010500@rabbitmq.com>

On 23/04/13 02:53, carlhoerberg wrote:
> GET /api/overview?columns=message_stats.publish
> returns the same content as
> GET /api/overview

Damn, you're right. Bug filed. Thanks.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Apr 23 11:02:53 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 23 Apr 2013 11:02:53 +0100
Subject: [rabbitmq-discuss] UI shows zero message rate in 3.0.4
In-Reply-To: <0d4ca001-e8fc-40af-82bf-d98402af1543@googlegroups.com>
References: <bc5cd537-513f-409c-937c-5e95bffa6b58@googlegroups.com>
	<0d4ca001-e8fc-40af-82bf-d98402af1543@googlegroups.com>
Message-ID: <51765C4D.9080200@rabbitmq.com>

Hi. Thanks for the bug report.

Unfortunately I don't think there's much point in investigating it as 
all the code that has anything to do with message rates has been 
rewritten for RabbitMQ 3.1.x. If you are feeling brave you could try 
running one of the nightlies e.g.:

http://www.rabbitmq.com/nightlies/rabbitmq-server/v3.0.4.40423/

Cheers, Simon

On 23/04/13 07:52, Frank Yao wrote:
> When I use 'rabbitmqadmin list queues vhost name node messages
> message_stats.publish_details.rate , this command can show normal
> message rate.
>
> ? 2013?4?23????UTC+8??2?04?46??Frank Yao???
>
>     Hi guys,
>
>     I've met a strange problem in a long time. In UI, I found some
>     connections's message rate shows '0.00/s' but actually this
>     connection is producing or cosuming message.
>
>     plus,
>
>     1. sometimes all connection from ONE node all showed '0.00/s' and
>     restarting this node cannot help, the only way to solve this is
>     break up whole cluster and re-join.
>     2. some of connection of a certain queue(not all connections) show
>     '0.00/s'.
>     3. ALL CONNECTION which show '0.00/s'  IS woking well.
>
>     I've googled this problem, some say the connection is short-period,
>     but I've confirmed my connection is long-period. And my rabbitmq is
>     3.0.4.
>
>     Below and attachment is my screenshots:
>
>
>     <https://lh4.googleusercontent.com/-TnF5v8ZPBlA/UXYhnfEAcSI/AAAAAAAAABo/vkurg2P_Wls/s1600/Screenshot+from+2013-04-23+12%3A46%3A03.png>
>
>     <https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
>     <https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
>     <https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
>     <https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From xzhang84 at gmail.com  Tue Apr 23 13:16:34 2013
From: xzhang84 at gmail.com (Hyperion)
Date: Tue, 23 Apr 2013 20:16:34 +0800
Subject: [rabbitmq-discuss] rabbitmq tx.commit problem
Message-ID: <F6F247BB-F301-4CB5-A584-AF830BAFC1D4@gmail.com>


hi, 

we just found a strange problem in the logs of one node of RabbitMQ cluster. but from web console and consumer & publisher there is no any warning or err log.

=ERROR REPORT==== 23-Apr-2013::13:35:24 ===
connection <0.11362.83>, channel 2 - error:
{amqp_error,precondition_failed,"channel is not transactional",'tx.commit'}
sasl.log

=SUPERVISOR REPORT==== 23-Apr-2013::13:35:32 ===
 Supervisor: {<0.12837.83>,
                                       rabbit_channel_sup_sup}
 Context:    shutdown_error
 Reason:     shutdown
 Offender:   [{pid,<0.12839.83>},
              {name,channel_sup},
              {mfa,{rabbit_channel_sup,start_link,[]}},
              {restart_type,temporary},
              {shutdown,infinity},
              {child_type,supervisor}]
We use spring-amqp, and here is our consumer usage.

default-autowire="byName">
<bean id="rabbitConnectionFactory"           class="org.springframework.amqp.rabbit.connection.CachingConnectionFactory"
      p:username="${mdc_rabbitmq.user}" p:password="${mdc_rabbitmq.password}"
      p:addresses="${mdc_rabbitmq.cluster}" p:virtualHost="${mdc_rabbitmq.vhost}">
</bean>
            class="org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer"
        p:connectionFactory-ref="rabbitConnectionFactory" p:queueNames="mobile.group.poi.add,mobile.group.poi.modify"
        p:messageListener-ref="poiMqConsumer"/>
<bean
from poiMqConsumer's log do receive message and no exception.

after by google I found this situation, but they got a problem in consumer'code, not like me in RabbitMQ's log.http://forum.springsource.org/archive/index.php/t-131286.html

thanks a lot for any help and suggestion.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130423/b036477e/attachment.htm>

From emile at rabbitmq.com  Tue Apr 23 13:45:47 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 23 Apr 2013 13:45:47 +0100
Subject: [rabbitmq-discuss] rabbitmq tx.commit problem
In-Reply-To: <F6F247BB-F301-4CB5-A584-AF830BAFC1D4@gmail.com>
References: <F6F247BB-F301-4CB5-A584-AF830BAFC1D4@gmail.com>
Message-ID: <5176827B.1020001@rabbitmq.com>

On 23/04/13 13:16, Hyperion wrote:

> {amqp_error,precondition_failed,"channel is not transactional",'tx.commit'}

The channel needs to be in transactional mode before you can use
transactions. You get this error if you fail to set the channel up for
transactions first.

> We use spring-amqp

According to the Spring-AMQP reference documentation you need to set the
 channelTransacted flag.



-Emile






From francois at teksol.info  Tue Apr 23 14:00:32 2013
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Tue, 23 Apr 2013 09:00:32 -0400
Subject: [rabbitmq-discuss] UI shows zero message rate in 3.0.4
In-Reply-To: <51765C4D.9080200@rabbitmq.com>
References: <bc5cd537-513f-409c-937c-5e95bffa6b58@googlegroups.com>
	<0d4ca001-e8fc-40af-82bf-d98402af1543@googlegroups.com>
	<51765C4D.9080200@rabbitmq.com>
Message-ID: <6FB49947-31A7-4AE6-ACEB-01355DAFFFE6@teksol.info>

I've had that issue as well. The consumption and production rates are at 0 for a "long" time - 2-3 5 second refreshes, then they come back. Is there a date for 3.1?

Thanks,
Fran?ois

Le 2013-04-23 ? 06:02, Simon MacMullen a ?crit :

> Hi. Thanks for the bug report.
> 
> Unfortunately I don't think there's much point in investigating it as all the code that has anything to do with message rates has been rewritten for RabbitMQ 3.1.x. If you are feeling brave you could try running one of the nightlies e.g.:
> 
> http://www.rabbitmq.com/nightlies/rabbitmq-server/v3.0.4.40423/
> 
> Cheers, Simon
> 
> On 23/04/13 07:52, Frank Yao wrote:
>> When I use 'rabbitmqadmin list queues vhost name node messages
>> message_stats.publish_details.rate , this command can show normal
>> message rate.
>> 
>> ? 2013?4?23????UTC+8??2?04?46??Frank Yao???
>> 
>>    Hi guys,
>> 
>>    I've met a strange problem in a long time. In UI, I found some
>>    connections's message rate shows '0.00/s' but actually this
>>    connection is producing or cosuming message.
>> 
>>    plus,
>> 
>>    1. sometimes all connection from ONE node all showed '0.00/s' and
>>    restarting this node cannot help, the only way to solve this is
>>    break up whole cluster and re-join.
>>    2. some of connection of a certain queue(not all connections) show
>>    '0.00/s'.
>>    3. ALL CONNECTION which show '0.00/s'  IS woking well.
>> 
>>    I've googled this problem, some say the connection is short-period,
>>    but I've confirmed my connection is long-period. And my rabbitmq is
>>    3.0.4.
>> 
>>    Below and attachment is my screenshots:
>> 
>> 
>>    <https://lh4.googleusercontent.com/-TnF5v8ZPBlA/UXYhnfEAcSI/AAAAAAAAABo/vkurg2P_Wls/s1600/Screenshot+from+2013-04-23+12%3A46%3A03.png>
>> 
>>    <https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
>>    <https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
>>    <https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
>>    <https://lh6.googleusercontent.com/-9K1EHCewn-0/UXYiBRHWDhI/AAAAAAAAABw/4h-ErjseoF4/s1600/Screenshot+from+2013-04-23+13%3A49%3A53.png>
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4142 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130423/2e5ea1d9/attachment.bin>

From simon at rabbitmq.com  Tue Apr 23 14:10:24 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 23 Apr 2013 14:10:24 +0100
Subject: [rabbitmq-discuss] UI shows zero message rate in 3.0.4
In-Reply-To: <6FB49947-31A7-4AE6-ACEB-01355DAFFFE6@teksol.info>
References: <bc5cd537-513f-409c-937c-5e95bffa6b58@googlegroups.com>
	<0d4ca001-e8fc-40af-82bf-d98402af1543@googlegroups.com>
	<51765C4D.9080200@rabbitmq.com>
	<6FB49947-31A7-4AE6-ACEB-01355DAFFFE6@teksol.info>
Message-ID: <51768840.9090104@rabbitmq.com>

On 23/04/13 14:00, Fran?ois Beausoleil wrote:
> Is there a date for 3.1?

Hopefully a week or so. Note that I am not promising that the bug will 
vanish because I have not been able to reproduce it - just that the code 
in question will have changed so much that it quite possibly has.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue Apr 23 14:15:32 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 23 Apr 2013 14:15:32 +0100
Subject: [rabbitmq-discuss] Memory not flushing to disk
In-Reply-To: <4DFE44D4C0517D4F9B084F24850A71571B229700@XMBC3084.northgrum.com>
References: <4DFE44D4C0517D4F9B084F24850A71571B229700@XMBC3084.northgrum.com>
Message-ID: <51768974.9030608@rabbitmq.com>


Hi,

On 22/04/13 17:38, Rodrian, Logan P (IS) wrote:
> It appears that at some point the flushing stops and then once the
> vm_memory_high_watermark is hit, I get a message informing me.

I assume you get a memory alarm message. This will clear as soon as the
broker has cleared enough RAM by flushing messages to disk. It will not
necessary save messages from queue E.

> My question is two-fold:
>   1) Has this been seen before/is there a solution already out there?

In the backing_queue_status queue E won't try to reduce memory use,
because of the {target_ram_count, infinity} entry.

>   2) Is there a configuration parameter that tells rabbitmq to write
> messages immediately to disk instead of buffering to memory first?

No, it is not possible send messages from the network to disk without
going via memory, and it is impossible for the broker to deliver
messages from disk without going through memory.


If you are able to get the broker in a state that the memory alarm
remains set indefinitely while ram_msg_counts remain high then please
send us the output of "rabbitmqctl report" at the time when that happens.



-Emile






From stuff at moesel.net  Tue Apr 23 14:32:54 2013
From: stuff at moesel.net (Chris)
Date: Tue, 23 Apr 2013 09:32:54 -0400
Subject: [rabbitmq-discuss] Federated Cluster Issue
In-Reply-To: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
References: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
Message-ID: <CAHEpgBC=wmrGy53mdkUvAjivVp0aL1uF_UprkkyC0Y8=KXHqDg@mail.gmail.com>

On Mon, Apr 22, 2013 at 6:11 PM, Richard Raseley <richard at raseley.com>wrote:

> 3) Added a new upstream on each cluster pointing to the other with a URI
> that looks similar to the following (from the perspective of "cluster-01":
>
> amqp://user:pass at cluster-02.domain.local/cluster02.exchange
>

You might also want to double-check the url you are using to setup the
federation-upstream.  The URL above corresponds to a *virtual host* called
"cluster02.exchange".  Is this what you really intended?  If you are
actually using the default virtual host, then you should just use
amqp://user:pass at cluster-02.domain.local/ and setup policies for the
exchanges you wish to federate (as in your step 4).

One other thing to note-- you will not actually see the links until the
exchanges you are federating actually exist on the upstream host.  So if
you haven't yet created the exchanges, you'll want to do that too.

-Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130423/9dff083f/attachment.htm>

From francois at teksol.info  Tue Apr 23 14:53:29 2013
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Tue, 23 Apr 2013 09:53:29 -0400
Subject: [rabbitmq-discuss] UI shows zero message rate in 3.0.4
In-Reply-To: <51768840.9090104@rabbitmq.com>
References: <bc5cd537-513f-409c-937c-5e95bffa6b58@googlegroups.com>
	<0d4ca001-e8fc-40af-82bf-d98402af1543@googlegroups.com>
	<51765C4D.9080200@rabbitmq.com>
	<6FB49947-31A7-4AE6-ACEB-01355DAFFFE6@teksol.info>
	<51768840.9090104@rabbitmq.com>
Message-ID: <2026E31A-D210-4CF9-9816-E52FE4593484@teksol.info>


Le 2013-04-23 ? 09:10, Simon MacMullen a ?crit :

> On 23/04/13 14:00, Fran?ois Beausoleil wrote:
>> Is there a date for 3.1?
> 
> Hopefully a week or so. Note that I am not promising that the bug will vanish because I have not been able to reproduce it - just that the code in question will have changed so much that it quite possibly has.


Oh, I fully understand what you're saying. I'm not upgrading in a week anyway - I always let braver souls try the new versions for a few weeks before anyway.

Thanks!
Fran?ois
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4142 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130423/b0477bd6/attachment.bin>

From baniu.yao at gmail.com  Tue Apr 23 15:04:35 2013
From: baniu.yao at gmail.com (Frank Yao)
Date: Tue, 23 Apr 2013 22:04:35 +0800
Subject: [rabbitmq-discuss] =?utf-8?b?5Zue5aSN77yaICBVSSBzaG93cyB6ZXJvIG1l?=
 =?utf-8?q?ssage_rate_in_3=2E0=2E4?=
In-Reply-To: <2026E31A-D210-4CF9-9816-E52FE4593484@teksol.info>
References: <bc5cd537-513f-409c-937c-5e95bffa6b58@googlegroups.com>
	<0d4ca001-e8fc-40af-82bf-d98402af1543@googlegroups.com>
	<51765C4D.9080200@rabbitmq.com>
	<6FB49947-31A7-4AE6-ACEB-01355DAFFFE6@teksol.info>
	<51768840.9090104@rabbitmq.com>
	<2026E31A-D210-4CF9-9816-E52FE4593484@teksol.info>
Message-ID: <8DBFE636429844B8A000D6DCAE6E68EB@gmail.com>

For my opinion, I think the message rate is quite important.   

message rate reflect the health of producers and consumers.
message rate reflect rabbitmq is okay or not
when I am test how many messages a rabbitmq node can handle per second, message rate is the only metric I can measure.  



--  

Frank Yao

Used Sparrow (http://www.sparrowmailapp.com/?sig)


? 2013?4?23???????9:53?Fran?ois Beausoleil ???

>  
> Le 2013-04-23 ? 09:10, Simon MacMullen a ?crit :
>  
> > On 23/04/13 14:00, Fran?ois Beausoleil wrote:
> > > Is there a date for 3.1?
> >  
> >  
> > Hopefully a week or so. Note that I am not promising that the bug will vanish because I have not been able to reproduce it - just that the code in question will have changed so much that it quite possibly has.
>  
>  
> Oh, I fully understand what you're saying. I'm not upgrading in a week anyway - I always let braver souls try the new versions for a few weeks before anyway.
>  
> Thanks!
> Fran?ois
>  
>  
>  
>  
> ???  
> - smime.p7s
>  


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130423/37746c90/attachment.htm>

From Logan.Rodrian at ngc.com  Tue Apr 23 15:04:52 2013
From: Logan.Rodrian at ngc.com (Rodrian, Logan P (IS))
Date: Tue, 23 Apr 2013 14:04:52 +0000
Subject: [rabbitmq-discuss] EXT :Re:  Memory not flushing to disk
In-Reply-To: <51768974.9030608@rabbitmq.com>
References: <4DFE44D4C0517D4F9B084F24850A71571B229700@XMBC3084.northgrum.com>,
	<51768974.9030608@rabbitmq.com>
Message-ID: <4DFE44D4C0517D4F9B084F24850A71571B22DAAF@XMBC3084.northgrum.com>

Emile-

Attached (text file) is the output from when this happens.  My previous snippets were from when this happens as well, I just didn't include the entire report.

The issue is exactly as you stated--the memory alarm remains set indefinitely while ram_msg_counts remain high.  This causes the publisher to be unable to send anything further to the broker.

Logan Rodrian
Cyber Engineer
Northrop Grumman
w (720) 744-7467
m (303) 748-1649
logan.rodrian at ngc.com

________________________________________
From: Emile Joubert [emile at rabbitmq.com]
Sent: Tuesday, April 23, 2013 07:15
To: Discussions about RabbitMQ
Cc: Rodrian, Logan P (IS)
Subject: EXT :Re: [rabbitmq-discuss] Memory not flushing to disk

Hi,

On 22/04/13 17:38, Rodrian, Logan P (IS) wrote:
> It appears that at some point the flushing stops and then once the
> vm_memory_high_watermark is hit, I get a message informing me.

I assume you get a memory alarm message. This will clear as soon as the
broker has cleared enough RAM by flushing messages to disk. It will not
necessary save messages from queue E.

> My question is two-fold:
>   1) Has this been seen before/is there a solution already out there?

In the backing_queue_status queue E won't try to reduce memory use,
because of the {target_ram_count, infinity} entry.

>   2) Is there a configuration parameter that tells rabbitmq to write
> messages immediately to disk instead of buffering to memory first?

No, it is not possible send messages from the network to disk without
going via memory, and it is impossible for the broker to deliver
messages from disk without going through memory.


If you are able to get the broker in a state that the memory alarm
remains set indefinitely while ram_msg_counts remain high then please
send us the output of "rabbitmqctl report" at the time when that happens.



-Emile





-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: rabbitmqctl_report_mailinglist.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130423/b2719aad/attachment.txt>

From richard at raseley.com  Tue Apr 23 15:28:58 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 23 Apr 2013 07:28:58 -0700
Subject: [rabbitmq-discuss] Federated Cluster Issue
In-Reply-To: <51765A26.3020302@rabbitmq.com>
References: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
	<51765A26.3020302@rabbitmq.com>
Message-ID: <CAO=6ox9_+Zd2FES6tJatw2cw1KbVvz_9mA-LNv2Sib9ikBQjvg@mail.gmail.com>

Simon,

Thank you for your reply.

1) I was trying to obfuscate my actual naming conventions - but they are
named in a similar manner. The general structure though is that in
cluster01 I have an exchange named something like "cluster01.topic" and in
the pattern field I put " ^cluster01\. " (basically everything in
preceeding the "." in the exchange name). Can you confirm that this would
be the correct pattern?

2) I do not see "federate-me" show up in the management UI exchange list -
but I see the policy in the Admin section. Would it show up as a discrete
exchange itself?

Regards,

Richard


On Tue, Apr 23, 2013 at 2:53 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 22/04/13 23:11, Richard Raseley wrote:
>
>> 4) Added a new policy (from the perspective of "cluster-01") with a name
>> of "federate-me", a pattern of "^cluster01\." and a definition of
>> "federation-upstream-set:all".
>>
>
> That pattern is meant to match exchange names - is that how your exchanges
> are named?
>
>
>  Based on my understanding I should now see the link listed (whether or
>> not is successful or producing errors) in the federation status page of
>> the management UI. All I see is "... no links ...". Furthermore,
>> executing a " rabbitmqctl eval 'rabbit_federation_status:**status().' "
>> on
>> any of the nodes in the two clusters returns " [] ...done. ".
>>
>> The logs from the servers show no errors related to federated links.
>>
>> Questions:
>>
>> 1) My understanding was that defining the upstream and the policy on a
>> particular vhost was enough to begin instantiation of the federated
>> link. Is this the case?
>>
>
> That should be the case. My guess is that the policy is not matching any
> exchanges and so federation thinks it has nothing to do. Do you see
> "federate-me" show up in the management UI exchange list / "rabbitmqctl
> list_exchanges name policy"?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130423/6a123111/attachment.htm>

From simon at rabbitmq.com  Tue Apr 23 15:36:06 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 23 Apr 2013 15:36:06 +0100
Subject: [rabbitmq-discuss] Federated Cluster Issue
In-Reply-To: <CAO=6ox9_+Zd2FES6tJatw2cw1KbVvz_9mA-LNv2Sib9ikBQjvg@mail.gmail.com>
References: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
	<51765A26.3020302@rabbitmq.com>
	<CAO=6ox9_+Zd2FES6tJatw2cw1KbVvz_9mA-LNv2Sib9ikBQjvg@mail.gmail.com>
Message-ID: <51769C56.7030403@rabbitmq.com>

On 23/04/13 15:28, Richard Raseley wrote:
> Simon,
>
> Thank you for your reply.
>
> 1) I was trying to obfuscate my actual naming conventions - but they are
> named in a similar manner. The general structure though is that in
> cluster01 I have an exchange named something like "cluster01.topic" and
> in the pattern field I put " ^cluster01\. " (basically everything in
> preceeding the "." in the exchange name). Can you confirm that this
> would be the correct pattern?

In the quotation marks you have leading and trailing spaces which would 
obviously stop the match from working. But other than that it looks fine.

> 2) I do not see "federate-me" show up in the management UI exchange list
> - but I see the policy in the Admin section. Would it show up as a
> discrete exchange itself?

Some federation-related infrastructure (including exchanges) would show 
up once federation starts, but if you don't see "federate-me" in the 
policy column for any exchange then the policy is not matching and 
nothing will happen.

If you can post the results of "rabbitmqctl report" then I can look at 
why the policy pattern is not matching.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue Apr 23 15:43:01 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 23 Apr 2013 15:43:01 +0100
Subject: [rabbitmq-discuss] EXT :Re:  Memory not flushing to disk
In-Reply-To: <4DFE44D4C0517D4F9B084F24850A71571B22DAAF@XMBC3084.northgrum.com>
References: <4DFE44D4C0517D4F9B084F24850A71571B229700@XMBC3084.northgrum.com>,
	<51768974.9030608@rabbitmq.com>
	<4DFE44D4C0517D4F9B084F24850A71571B22DAAF@XMBC3084.northgrum.com>
Message-ID: <51769DF5.1080501@rabbitmq.com>


Hi Logan,

On 23/04/13 15:04, Rodrian, Logan P (IS) wrote:

> Attached (text file) is the output from when this happens.  My
> previous snippets were from when this happens as well, I just didn't
> include the entire report.
> 
> The issue is exactly as you stated--the memory alarm remains set
> indefinitely while ram_msg_counts remain high.  This causes the
> publisher to be unable to send anything further to the broker.


I think you simply have run out of memory. Queue processes only account
for 360Mb of the total 2.6Gb in use, which is not very much. The bulk of
the RAM is being used by the message index. Even when message bodies are
saved to disk, accounting information will amounts to about 170 bytes
per message which has to stay in RAM. In your case queue lengths total
over 14million and this per-message overhead is the dominating term.

It is not possible to queue an indefinite number of messages on a server
with a finite amount of RAM. The broker documentation should be clearer
about that limitation.

You may be able to relive the memory pressure by setting the vm memory
limit above 40% temporarily while disconnecting publishers:

"rabbitmqctl set_vm_memory_high_watermark 0.5" might be enough.

If you expect the broker to queue that many messages regularly then you
will need to provision more RAM, in line with the 170 byte overhead.






-Emile






From xzhang84 at gmail.com  Tue Apr 23 16:15:28 2013
From: xzhang84 at gmail.com (Hyperion)
Date: Tue, 23 Apr 2013 23:15:28 +0800
Subject: [rabbitmq-discuss] rabbitmq tx.commit problem
In-Reply-To: <5176827B.1020001@rabbitmq.com>
References: <F6F247BB-F301-4CB5-A584-AF830BAFC1D4@gmail.com>
	<5176827B.1020001@rabbitmq.com>
Message-ID: <C61B9B42-606E-404D-867B-AE0DE7B0CC5C@gmail.com>


> The channel needs to be in transactional mode before you can use
> transactions. You get this error if you fail to set the channel up for
> transactions first.


	after set p:channelTransacted="true",  still get this error in RabbitMQ's log, and message queue just work fine.

> According to the Spring-AMQP reference documentation you need to set the
> channelTransacted flag.

	I wrote some unit test for p:channelTransacted true / false, there is no error in log...  looks like it dose not matter for this problem. 
	guess there is some thing wrong in my spring transaction's configuration. I will do more test and check.

	Anyway, thanks a lot for help.

From joe.haiwang at gmail.com  Tue Apr 23 17:16:03 2013
From: joe.haiwang at gmail.com (hwang)
Date: Wed, 24 Apr 2013 00:16:03 +0800
Subject: [rabbitmq-discuss] ConnectionFactory.newConnection(Address[] addrs)
	is very slow
Message-ID: <CAEUeNtQ4yATwhvVUxPNSFWgdu--vEgE_Z22_ja48GKQeLr0uHQ@mail.gmail.com>

Recently I begin to use rabbitMQ, but encounter a strange problem. I use
the method newConnection(Address[] addrs) of class ConnectionFactory when I
initial the connection, because the document said that this method will
pick up one available address automatically. The code looks like below in
function setup():

String[] mqAddrArr = new String[] {
    "node1:5672", "node2:5672"
};
connection = connectionFactory.newConnection(mqAddrArr);

In my code, if encounter a ShutdownSignalException, I will catch it and
re-connect(using the same setup() method).

When I start the application, this newConnection(mqAddrArr) run normally.
As I run "rabbitmqctl stop" on node1, the program can catch the
ShutdownSignalException rightly and run setup() to re-connect.

But this time, the newConnection(mqAddrArr) is very slow, maybe about 2-3
minutes to re-connect succeed.

I'm wondering if this is the right performance of method
newConnection(Address[] addrs), or maybe there is some parameter I can set
to control the re-connect time?

When the newConnection method halt, I get some jstack information in the
last, maybe helpful.

Thanks.

"Finalizer" daemon prio=10 tid=0x09f44400 nid=0x3e70 in Object.wait()
[0x7c51c000]
   java.lang.Thread.State: WAITING (on object monitor)
    at java.lang.Object.wait(Native Method)
    - waiting on <0xa522f340> (a java.lang.ref.ReferenceQueue$Lock)
    at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:133)
    - locked <0xa522f340> (a java.lang.ref.ReferenceQueue$Lock)
    at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:149)
    at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:177)

"Reference Handler" daemon prio=10 tid=0x09f3f800 nid=0x3e6f in
Object.wait() [0x7c56d000]
   java.lang.Thread.State: WAITING (on object monitor)
    at java.lang.Object.wait(Native Method)
    - waiting on <0xa522ef10> (a java.lang.ref.Reference$Lock)
    at java.lang.Object.wait(Object.java:502)
    at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)
    - locked <0xa522ef10> (a java.lang.ref.Reference$Lock)

"main" prio=10 tid=0x09e94000 nid=0x3e68 runnable [0xb776a000]
   java.lang.Thread.State: RUNNABLE
    at java.net.PlainSocketImpl.socketConnect(Native Method)
    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:327)
    - locked <0xa470f390> (a java.net.SocksSocketImpl)
    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:193)
    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:180)
    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:384)
    at java.net.Socket.connect(Socket.java:546)
    at com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:445)
    at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:504)
    at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:488)
    at com.wandoujia.storage.rabbitmq.RabbitMQReceiver.setup(RabbitMQReceiver.java:114)
    at com.wandoujia.storage.rabbitmq.RabbitMQReceiver.reconnect(RabbitMQReceiver.java:105)
    at com.wandoujia.storage.rabbitmq.RabbitMQReceiver.ack(RabbitMQReceiver.java:141)
    at com.wandoujia.storage.rabbitmq.testMQReceiver.test(testMQReceiver.java:21)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:616)
    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
    at org.junit.runners.BlockJUnit4ClassRunner.runNotIgnored(BlockJUnit4ClassRunner.java:79)
    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:71)
    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:49)
    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
    at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
    at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50)
    at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130424/d12ff58a/attachment.htm>

From Logan.Rodrian at ngc.com  Tue Apr 23 18:11:33 2013
From: Logan.Rodrian at ngc.com (Rodrian, Logan P (IS))
Date: Tue, 23 Apr 2013 17:11:33 +0000
Subject: [rabbitmq-discuss] EXT :Re:  Memory not flushing to disk
In-Reply-To: <51769DF5.1080501@rabbitmq.com>
References: <4DFE44D4C0517D4F9B084F24850A71571B229700@XMBC3084.northgrum.com>,
	<51768974.9030608@rabbitmq.com>
	<4DFE44D4C0517D4F9B084F24850A71571B22DAAF@XMBC3084.northgrum.com>,
	<51769DF5.1080501@rabbitmq.com>
Message-ID: <4DFE44D4C0517D4F9B084F24850A71571B22DB55@XMBC3084.northgrum.com>

Emile-

Thank you for that information.

Let me present our use case in a larger context and see what your thoughts are.  Our goal with using RabbitMQ as a broker was to provide a managed "disk backup" of data while consumers were unavailable, ensuring no data is lost.  In our environment, the consumers may not be available for a long time.  

I understand the use of vm_memory_high_watermark to put a "band-aid" on the problem, but it sounds like we will still run into issues eventually.

So, are there any parameters that can be set on the server to configure it for this type of environment?  This includes use of any alternative plugins that keep the indexes in a different way and/or persist data to the disk using a different approach.

I want to be sure that I have exhausted all possibilities with RabbitMQ in our use case to decide if it is something that will work in our environment or not, so any insight you have in this area would be appreciated.  Perhaps we are attempting to use RabbitMQ in a way other than what it was designed for??


Logan Rodrian

________________________________________
From: Emile Joubert [emile at rabbitmq.com]
Sent: Tuesday, April 23, 2013 08:43
To: Rodrian, Logan P (IS)
Cc: Discussions about RabbitMQ
Subject: Re: EXT :Re: [rabbitmq-discuss] Memory not flushing to disk

Hi Logan,

On 23/04/13 15:04, Rodrian, Logan P (IS) wrote:

> Attached (text file) is the output from when this happens.  My
> previous snippets were from when this happens as well, I just didn't
> include the entire report.
>
> The issue is exactly as you stated--the memory alarm remains set
> indefinitely while ram_msg_counts remain high.  This causes the
> publisher to be unable to send anything further to the broker.


I think you simply have run out of memory. Queue processes only account
for 360Mb of the total 2.6Gb in use, which is not very much. The bulk of
the RAM is being used by the message index. Even when message bodies are
saved to disk, accounting information will amounts to about 170 bytes
per message which has to stay in RAM. In your case queue lengths total
over 14million and this per-message overhead is the dominating term.

It is not possible to queue an indefinite number of messages on a server
with a finite amount of RAM. The broker documentation should be clearer
about that limitation.

You may be able to relive the memory pressure by setting the vm memory
limit above 40% temporarily while disconnecting publishers:

"rabbitmqctl set_vm_memory_high_watermark 0.5" might be enough.

If you expect the broker to queue that many messages regularly then you
will need to provision more RAM, in line with the 170 byte overhead.






-Emile






From richard at raseley.com  Tue Apr 23 20:16:13 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 23 Apr 2013 12:16:13 -0700
Subject: [rabbitmq-discuss] Federated Cluster Issue
In-Reply-To: <51769C56.7030403@rabbitmq.com>
References: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
	<51765A26.3020302@rabbitmq.com>
	<CAO=6ox9_+Zd2FES6tJatw2cw1KbVvz_9mA-LNv2Sib9ikBQjvg@mail.gmail.com>
	<51769C56.7030403@rabbitmq.com>
Message-ID: <CAO=6ox_YPo24PVphND-i9MTQSHOuVe=1PUUsVFS+HOT5b3Ma8g@mail.gmail.com>

Simon,

I did not include the leading and trailing spaces when entering the pattern
in the management UI - just did it here for readability purposes.

I have the output of "rabbitmqctl report" from the 4 nodes in question (two
per cluster) - were there specific items that you wanted to look at (I'd
rather not share the entire output for security reasons)? I can see that
for the vhosts in question it is listing the federate-me policy (not sure
if that is what you were looking for).

Regards,

Richard


On Tue, Apr 23, 2013 at 7:36 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 23/04/13 15:28, Richard Raseley wrote:
>
>> Simon,
>>
>> Thank you for your reply.
>>
>> 1) I was trying to obfuscate my actual naming conventions - but they are
>> named in a similar manner. The general structure though is that in
>> cluster01 I have an exchange named something like "cluster01.topic" and
>> in the pattern field I put " ^cluster01\. " (basically everything in
>> preceeding the "." in the exchange name). Can you confirm that this
>> would be the correct pattern?
>>
>
> In the quotation marks you have leading and trailing spaces which would
> obviously stop the match from working. But other than that it looks fine.
>
>
>  2) I do not see "federate-me" show up in the management UI exchange list
>> - but I see the policy in the Admin section. Would it show up as a
>> discrete exchange itself?
>>
>
> Some federation-related infrastructure (including exchanges) would show up
> once federation starts, but if you don't see "federate-me" in the policy
> column for any exchange then the policy is not matching and nothing will
> happen.
>
> If you can post the results of "rabbitmqctl report" then I can look at why
> the policy pattern is not matching.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130423/46ad4763/attachment.htm>

From emile at rabbitmq.com  Wed Apr 24 09:48:02 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 24 Apr 2013 09:48:02 +0100
Subject: [rabbitmq-discuss] EXT :Re:  Memory not flushing to disk
In-Reply-To: <4DFE44D4C0517D4F9B084F24850A71571B22DB55@XMBC3084.northgrum.com>
References: <4DFE44D4C0517D4F9B084F24850A71571B229700@XMBC3084.northgrum.com>,
	<51768974.9030608@rabbitmq.com>
	<4DFE44D4C0517D4F9B084F24850A71571B22DAAF@XMBC3084.northgrum.com>,
	<51769DF5.1080501@rabbitmq.com>
	<4DFE44D4C0517D4F9B084F24850A71571B22DB55@XMBC3084.northgrum.com>
Message-ID: <51779C42.2050202@rabbitmq.com>


Hi Logan,

On 23/04/13 18:11, Rodrian, Logan P (IS) wrote:

> Let me present our use case in a larger context and see what your
> thoughts are.  Our goal with using RabbitMQ as a broker was to
> provide a managed "disk backup" of data while consumers were
> unavailable, ensuring no data is lost.  In our environment, the
> consumers may not be available for a long time.

Can you place an upper limit on "long"?

> I understand the use of vm_memory_high_watermark to put a "band-aid"
> on the problem, but it sounds like we will still run into issues
> eventually.
> 
> So, are there any parameters that can be set on the server to
> configure it for this type of environment?  This includes use of any
> alternative plugins that keep the indexes in a different way and/or
> persist data to the disk using a different approach.

There is at least one alternative message index storage plugin:
 http://hg.rabbitmq.com/rabbitmq-toke/

that uses a driver for Tokyo Cabinet:
 http://hg.rabbitmq.com/toke/

This plugin has not reached official status:
 http://www.rabbitmq.com/plugins.html

> I want to be sure that I have exhausted all possibilities with
> RabbitMQ in our use case to decide if it is something that will work
> in our environment or not, so any insight you have in this area would
> be appreciated.  Perhaps we are attempting to use RabbitMQ in a way
> other than what it was designed for??

RabbitMQ is designed to be used as a buffer. The number of messages that
can be buffered is limited by RAM as well as disk. You will need to
provide enough RAM and disk, in line with the number and size of
messages that need to be buffered.

In your case more RAM will allow you to store more messages. If you are
storing lots of small messages and the message index is the dominating
cost then you might also consider batching messages. This will allow you
to store many more messages.


-Emile








From Logan.Rodrian at ngc.com  Wed Apr 24 13:50:16 2013
From: Logan.Rodrian at ngc.com (Rodrian, Logan P (IS))
Date: Wed, 24 Apr 2013 12:50:16 +0000
Subject: [rabbitmq-discuss] EXT :Re:  Memory not flushing to disk
In-Reply-To: <51779C42.2050202@rabbitmq.com>
References: <4DFE44D4C0517D4F9B084F24850A71571B229700@XMBC3084.northgrum.com>,
	<51768974.9030608@rabbitmq.com>
	<4DFE44D4C0517D4F9B084F24850A71571B22DAAF@XMBC3084.northgrum.com>,
	<51769DF5.1080501@rabbitmq.com>
	<4DFE44D4C0517D4F9B084F24850A71571B22DB55@XMBC3084.northgrum.com>,
	<51779C42.2050202@rabbitmq.com>
Message-ID: <4DFE44D4C0517D4F9B084F24850A71571B22DD56@XMBC3084.northgrum.com>

Emile-

Long may be defined as holding tens of millions of messages before the consumers connect to the broker.

You mentioned batching messages.  Is this something that is done by the producer when sending to the broker or a setting within RabbitMQ?

What does RabbitMQ do with the RAM indexes when it is shutdown?  I assume it writes to disk somehow and then reads the indexes back into RAM upon startup.  Does this process only happen upon shutdown and never during execution?  i.e. it never pages the RAM index to disk when out of space?

Logan Rodrian

________________________________________
From: Emile Joubert [emile at rabbitmq.com]
Sent: Wednesday, April 24, 2013 02:48
To: Rodrian, Logan P (IS)
Cc: Discussions about RabbitMQ
Subject: Re: EXT :Re: [rabbitmq-discuss] Memory not flushing to disk

Hi Logan,

On 23/04/13 18:11, Rodrian, Logan P (IS) wrote:

> Let me present our use case in a larger context and see what your
> thoughts are.  Our goal with using RabbitMQ as a broker was to
> provide a managed "disk backup" of data while consumers were
> unavailable, ensuring no data is lost.  In our environment, the
> consumers may not be available for a long time.

Can you place an upper limit on "long"?

> I understand the use of vm_memory_high_watermark to put a "band-aid"
> on the problem, but it sounds like we will still run into issues
> eventually.
>
> So, are there any parameters that can be set on the server to
> configure it for this type of environment?  This includes use of any
> alternative plugins that keep the indexes in a different way and/or
> persist data to the disk using a different approach.

There is at least one alternative message index storage plugin:
 http://hg.rabbitmq.com/rabbitmq-toke/

that uses a driver for Tokyo Cabinet:
 http://hg.rabbitmq.com/toke/

This plugin has not reached official status:
 http://www.rabbitmq.com/plugins.html

> I want to be sure that I have exhausted all possibilities with
> RabbitMQ in our use case to decide if it is something that will work
> in our environment or not, so any insight you have in this area would
> be appreciated.  Perhaps we are attempting to use RabbitMQ in a way
> other than what it was designed for??

RabbitMQ is designed to be used as a buffer. The number of messages that
can be buffered is limited by RAM as well as disk. You will need to
provide enough RAM and disk, in line with the number and size of
messages that need to be buffered.

In your case more RAM will allow you to store more messages. If you are
storing lots of small messages and the message index is the dominating
cost then you might also consider batching messages. This will allow you
to store many more messages.


-Emile








From emile at rabbitmq.com  Wed Apr 24 14:23:51 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 24 Apr 2013 14:23:51 +0100
Subject: [rabbitmq-discuss] EXT :Re:  Memory not flushing to disk
In-Reply-To: <4DFE44D4C0517D4F9B084F24850A71571B22DD56@XMBC3084.northgrum.com>
References: <4DFE44D4C0517D4F9B084F24850A71571B229700@XMBC3084.northgrum.com>,
	<51768974.9030608@rabbitmq.com>
	<4DFE44D4C0517D4F9B084F24850A71571B22DAAF@XMBC3084.northgrum.com>,
	<51769DF5.1080501@rabbitmq.com>
	<4DFE44D4C0517D4F9B084F24850A71571B22DB55@XMBC3084.northgrum.com>,
	<51779C42.2050202@rabbitmq.com>
	<4DFE44D4C0517D4F9B084F24850A71571B22DD56@XMBC3084.northgrum.com>
Message-ID: <5177DCE7.5000509@rabbitmq.com>

On 24/04/13 13:50, Rodrian, Logan P (IS) wrote:
> You mentioned batching messages.  Is this something that is done by
> the producer when sending to the broker or a setting within
> RabbitMQ?

Batching and unbatching is not performed by the broker, so this is
something that would need to be done by producers and consumers.

> What does RabbitMQ do with the RAM indexes when it is shutdown?  I
> assume it writes to disk somehow and then reads the indexes back into
> RAM upon startup.  Does this process only happen upon shutdown and
> never during execution?  i.e. it never pages the RAM index to disk
> when out of space?

The rabbit_msg_store_index behaviour contains recover and terminate
callbacks. The default implementation included with the broker makes use
of Erlang Term Storage (ETS) tables that are read from and saved to disk
upon boot and shutdown respectively, but not during execution.

Alternatives (e.g. rabbit_toke) with different RAM requirements do
exist, or you can provide your own. The behaviour to implement is here:

http://hg.rabbitmq.com/rabbitmq-server/file/default/src/rabbit_msg_store_index.erl

The default implementation:
http://hg.rabbitmq.com/rabbitmq-server/file/default/src/rabbit_msg_store_ets_index.erl





-Emile




From simon at rabbitmq.com  Wed Apr 24 14:24:02 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 24 Apr 2013 14:24:02 +0100
Subject: [rabbitmq-discuss] Federated Cluster Issue
In-Reply-To: <CAO=6ox_YPo24PVphND-i9MTQSHOuVe=1PUUsVFS+HOT5b3Ma8g@mail.gmail.com>
References: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
	<51765A26.3020302@rabbitmq.com>
	<CAO=6ox9_+Zd2FES6tJatw2cw1KbVvz_9mA-LNv2Sib9ikBQjvg@mail.gmail.com>
	<51769C56.7030403@rabbitmq.com>
	<CAO=6ox_YPo24PVphND-i9MTQSHOuVe=1PUUsVFS+HOT5b3Ma8g@mail.gmail.com>
Message-ID: <5177DCF2.6050904@rabbitmq.com>

Hi. I mainly just wanted to check the policies against the exchanges - 
so the lists of all policies and all exchanges should be enough. Also 
feel free to excise anything you think is sensitive and send it privately.

Cheers, Simon

On 23/04/13 20:16, Richard Raseley wrote:
> Simon,
>
> I did not include the leading and trailing spaces when entering the
> pattern in the management UI - just did it here for readability purposes.
>
> I have the output of "rabbitmqctl report" from the 4 nodes in question
> (two per cluster) - were there specific items that you wanted to look at
> (I'd rather not share the entire output for security reasons)? I can see
> that for the vhosts in question it is listing the federate-me policy
> (not sure if that is what you were looking for).
>
> Regards,
>
> Richard
>
>
> On Tue, Apr 23, 2013 at 7:36 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 23/04/13 15:28, Richard Raseley wrote:
>
>         Simon,
>
>         Thank you for your reply.
>
>         1) I was trying to obfuscate my actual naming conventions - but
>         they are
>         named in a similar manner. The general structure though is that in
>         cluster01 I have an exchange named something like
>         "cluster01.topic" and
>         in the pattern field I put " ^cluster01\. " (basically everything in
>         preceeding the "." in the exchange name). Can you confirm that this
>         would be the correct pattern?
>
>
>     In the quotation marks you have leading and trailing spaces which
>     would obviously stop the match from working. But other than that it
>     looks fine.
>
>
>         2) I do not see "federate-me" show up in the management UI
>         exchange list
>         - but I see the policy in the Admin section. Would it show up as a
>         discrete exchange itself?
>
>
>     Some federation-related infrastructure (including exchanges) would
>     show up once federation starts, but if you don't see "federate-me"
>     in the policy column for any exchange then the policy is not
>     matching and nothing will happen.
>
>     If you can post the results of "rabbitmqctl report" then I can look
>     at why the policy pattern is not matching.
>
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From kyleo at 0b10.mx  Wed Apr 24 14:49:19 2013
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Wed, 24 Apr 2013 09:49:19 -0400 (EDT)
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <1431319048.74913.1366810711894.JavaMail.root@0b10.mx>
Message-ID: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>

Hi,

I've built rabbit (2.8.7 and 3.0.4) from source using R15B03, here are the build time options:

make RABBITMQ_BASE=/x/s/rabbitmq-server-3.0.4 RABBITMQ_LOG_BASE=/x/s/rabbitmq-server-3.0.4/var/log RABBITMQ_CONFIG_FILE=/x/s/rabbitmq-server-3.0.4/etc/rabbitmq RABBITMQ_MNESIA_DIR=/x/s/rabbitmq-server-3.0.4/var/lib/mnesia TARGET_DIR=/x/s/rabbitmq-server-3.0.4 SBIN_DIR=/x/s/rabbitmq-server-3.0.4/sbin MAN_DIR=/x/s/rabbitmq-server-3.0.4/man

When I start my app rabbit quickly reports that it's reached the high watermark for memory usage, and it counts virtual memory not resident memory:

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+ COMMAND                                                                                                                29723 prod      20   0 17.9g 269m 2752 S    4  0.8   2:40.80 /x/s/erlang-R15B03/lib/erlang/erts-5.9.3.1/bin/beam.smp -W w -K true -A30 -P 1048576 -- -root /x/s/erlang-R15B03/lib/erlang -progname erl -- -home /home/prod -- -pa /x/s/rabbitmq

There is plenty of free memory on the machine

$ free -m
             total       used       free     shared    buffers     cached
Mem:         32178       2992      29186          0        242       1929
-/+ buffers/cache:        820      31358
Swap:         5719          0       5719

Is this normal? Curious why rabbit cares about the virtual memory size when there is so much actual memory available.

below is the output from rabbitmqctl status

Thanks,
Kyle


rabbitmqctl status
Status of node 'rabbit at p1-amqp-j101' ...
[{pid,29723},
 {running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","0.0.0"},
      {rabbitmq_management,"RabbitMQ Management Console","0.0.0"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","0.0.0"},
      {rabbit,"RabbitMQ","3.0.4"},
      {mnesia,"MNESIA  CXC 138 12","4.7.1"},
      {os_mon,"CPO  CXC 138 46","2.2.10"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","0.0.0"},
      {webmachine,"webmachine","1.9.1-rmq0.0.0-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq0.0.0-gitd541e9a"},
      {xmerl,"XML parser","1.3.2"},
      {inets,"INETS  CXC 138 49","5.9.2"},
      {amqp_client,"RabbitMQ AMQP Client","0.0.0"},
      {sasl,"SASL  CXC 138 11","2.2.1"},
      {stdlib,"ERTS  CXC 138 10","1.18.3"},
      {kernel,"ERTS  CXC 138 10","2.15.3"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:4:4] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,15536914264},
      {connection_procs,89537888},
      {queue_procs,18333416},
      {plugins,1170400},
      {other_proc,6548309},
      {mnesia,2538168},
      {mgmt_db,32239752},
      {msg_index,615120},
      {other_ets,3557064},
      {binary,15276878352},
      {code,20248995},
      {atom,801697},
      {other_system,84445103}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,13496687001},
 {disk_free_limit,1000000000},
 {disk_free,22007357440},
 {file_descriptors,
     [{total_limit,130970},
      {total_used,1828},
      {sockets_limit,117871},
      {sockets_used,1826}]},
 {processes,[{limit,1048576},{used,20875}]},
 {run_queue,0},
 {uptime,1620}]
...done.

From simon at rabbitmq.com  Wed Apr 24 14:57:36 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 24 Apr 2013 14:57:36 +0100
Subject: [rabbitmq-discuss] Help us test RabbitMQ 3.1.0!
Message-ID: <5177E4D0.1040706@rabbitmq.com>

Hi all. We're rapidly approaching the release of RabbitMQ 3.1.0. So if 
you are interested in helping us test, please download one of the latest 
nightly builds from 
http://www.rabbitmq.com/nightlies/rabbitmq-server/current/ and give it a 
shot.

Thank you!

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Apr 24 15:13:38 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 24 Apr 2013 15:13:38 +0100
Subject: [rabbitmq-discuss] Help us test RabbitMQ 3.1.0!
In-Reply-To: <5177E4D0.1040706@rabbitmq.com>
References: <5177E4D0.1040706@rabbitmq.com>
Message-ID: <5177E892.7020802@rabbitmq.com>

On 24/04/13 14:57, Simon MacMullen wrote:
> Hi all. We're rapidly approaching the release of RabbitMQ 3.1.0.

Oh, and you'll need a reason to download it, right? :-) The headline new 
features are:

  * Eager synchronisation of HA mirrors
  * Charts and better statistics in management
  * Automatic cluster partition healing
  * AMQP 1.0 support

as well as the usual raft of bug fixes, performance improvements and 
other new features.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dr at jones.dk  Wed Apr 24 16:16:41 2013
From: dr at jones.dk (Jonas Smedegaard)
Date: Wed, 24 Apr 2013 17:16:41 +0200
Subject: [rabbitmq-discuss] Freely licensed specs
Message-ID: <20130424151641.12767.33111@bastian.jones.dk>

Hi,

I am a Debian developer, and as you may know Debian is pretty strict on 
licensing issues.

Some AMQP-related tools and libraries require the AMQP specs available 
at build- or runtime.  For plain AMQP there are BSD-licensed "stripped" 
specs available, but it seems your derived specs are available only 
licensed with the Debian-incompatible AMQP license :-(

Please publish your derived specs in a form freely licensed.


Regards,

 - Jonas

P.S.

To ease the burden on you, I have locally made some files by comparing 
AMQP-licensed specs and applying similar to BSD-licensed "stripped" 
specs.  I am not the copyright holder of those XML chunks that I 
transfered so cannot legally relicense my diff, and ironically the AMQP 
license does not even allow me to share the diff I created with this 
list (because it is not "for the purpose of implementing the Advanced 
Messaging Queue Protocol Specification.")

If interested in my prepared files, please one of the authors of the 
forked specs files get in touch with me privately, and I shall happily 
pass it on for you to formally claim yours and publish.

P.P.S.

This issue is pretty serious, it seems: Some existing AMQP-related 
Debian packages are at risk of being removed from Debian if this is not 
solved.

-- 
 * Jonas Smedegaard - idealist & Internet-arkitekt
 * Tlf.: +45 40843136  Website: http://dr.jones.dk/

 [x] quote me freely  [ ] ask before reusing  [ ] keep private

From simon at rabbitmq.com  Wed Apr 24 16:40:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 24 Apr 2013 16:40:08 +0100
Subject: [rabbitmq-discuss] Freely licensed specs
In-Reply-To: <20130424151641.12767.33111@bastian.jones.dk>
References: <20130424151641.12767.33111@bastian.jones.dk>
Message-ID: <5177FCD8.2010407@rabbitmq.com>

On 24/04/13 16:16, Jonas Smedegaard wrote:
> Hi,

Hi.

> I am a Debian developer, and as you may know Debian is pretty strict on
> licensing issues.

We're very aware of that! And we have tried to be careful around 
licensing issues.

> Some AMQP-related tools and libraries require the AMQP specs available
> at build- or runtime.  For plain AMQP there are BSD-licensed "stripped"
> specs available, but it seems your derived specs are available only
> licensed with the Debian-incompatible AMQP license :-(

That's not entirely true; the extended spec which the RabbitMQ server 
and official (and many unofficial) clients actually use:

http://hg.rabbitmq.com/rabbitmq-codegen/file/bbf467c98a21/amqp-rabbitmq-0.9.1.json

is BSD-licensed.

However, I notice that the extended spec available from 
http://www.rabbitmq.com/protocol.html is only available in an 
AMQP-licensed version. Was that what you were talking about?

Anyway, we should correct that...

> This issue is pretty serious, it seems: Some existing AMQP-related
> Debian packages are at risk of being removed from Debian if this is not
> solved.

...but to know how high a priority to give producing such a spec I would 
need to know if any packages in Debian are currently using the 
AMQP-licensed extended XML spec. Can you tell me which packages these 
are? I can't get anything useful out of bugs.debian.org :-(

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From karl.rieb at gmail.com  Wed Apr 24 17:26:42 2013
From: karl.rieb at gmail.com (Karl Rieb)
Date: Wed, 24 Apr 2013 09:26:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Durability and consumer acknowledgement
	extremely slow
Message-ID: <5c6d72b4-ba54-495b-ab0e-2747dea619bd@googlegroups.com>

Hi,

I am trying to improve the message throughput for a RabbitMQ queue in an 
Amazon cloud instance and am noticing a *significant* drop in performance 
when enabling acknowledgements for consumer of a durable queue (with 
persisted messages).  The real problem is that the bottleneck appears to be 
on the rabbit node and not with the consumers, so adding more consumers 
does not improve the throughput (or help drain the queue any quicker).  As 
a matter of fact, adding new consumers will just slow down existing 
consumers so everyone ends up consuming at a slower rate, preventing 
overall throughput from changing.

Trying to do batch acknowledgements using the Multiple flag helps a bit (8k 
msgs/s vs 5.5k msgs/s) but not much compared to the initial drop.  It is 
only when I turn on *auto_ack* for the consumers that I see the performance 
shoot *way *back up and when I start seeing a linear increase in throughput 
as I add more consumers.

Is this expected behavior?  Is there a way to configure the rabbit node so 
it doesn't hit this bottleneck with acknowledgements?

Here is the sample code I'm using to test the throughput:

Publisher:

#!/usr/bin/python

import pika

creds = pika.PlainCredentials('guest','guest')
conn  = 
pika.BlockingConnection(pika.ConnectionParameters(host='10.10.1.123', 
credentials=creds))
chan  = conn.channel()

while True:
    chan.basic_publish(exchange='simple_exchange', 
routing_key='simple_queue', body='', 
properties=pika.BasicProperties(delivery_mode=2))


Consumer:

 #!/usr/bin/python

import pika

def callback(chan, method, properties, body):
    chan.basic_ack(delivery_tag=method.delivery_tag, multiple=False)

creds = pika.PlainCredentials('guest','guest')
conn  = 
pika.BlockingConnection(pika.ConnectionParameters(host='10.10.1.123', 
credentials=creds))
chan  = conn.channel()

chan.basic_consume(callback, queue='simple_queue', no_ack=False)
chan.basic_qos(prefetch_count=1000)
chan.start_consuming()


I spawn multiple processes for the producers and multiple for the consumer 
(so there is no python interpreter locking issues since each runs in its 
own interpreter instance).  I'm using an an Amazon *c1.xlarge *(8 virtual 
cores and "high" IO) Ubuntu 12.04 LTS instance with RabbitMQ version 
3.0.4-1 and an Amazon ephemeral disk (in production we would use an EBS 
volume instead).  The queue is marked *Durable* and my messages all use *
delivery_mode* 2 (persist).  

Below are the performance numbers.  For each test I use 2 publishers 
processes and 6 consumer processes (where 3 different machines host 2 
consumers each).  The producers and consumers are all on *separate*machines from the rabbit node.  Throughput measurements were done using the 
RabbitMQ management UI and linux utility top.  Python was compiled to pyc 
files before running.

*no_ack = True:*  
    rate = 24,000/s 
    single consumer CPU   =  65% 
    single publisher CPU  =  80% (flow control enabled and being enforced)
    (beam.smp) rabbit CPU = 400% (of 800%, 8 cores) -> 0.0%wa 11.5%sy

*no_ack = False (manual acks per message):*
    rate =  5,500/s
    single consumer CPU   =  20%
    single publisher CPU  =  20% (flow control enabled and being enforced)
    (beam.smp) rabbit CPU = 300% (of 800%, 8 cores) -> 4.5%wa 10.0%sy
    
The most notable difference besides the throughput are the I/O waits when 
ACKs are enabled (4.5% vs 0.0%).  This leads me to believe that the rabbit 
node is being bottlenecked by performing I/O operations for ACK 
bookkeeping.  The I/O doesn't appear to be a problem for persisting the 
published messages since I'm *guessing* that rabbit is buffering those and 
syncing them to disk in batches.  Does this mean the acknowledgements are 
not also being buffered before synced with disk?  Can I configure the 
rabbit node to change this behavior to help speed up the acknowledgements? 
  I'm not using transactions in the example code above, so I don't need any 
strict guarantees that ACKs were written to disk before returning.

Thanks,
Karl

P.S. I wrote the same sample consumer code in Ruby to see if there was a 
difference (in case there was a Python issue), but the numbers were about 
the same.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130424/9f2a468c/attachment.htm>

From simon at rabbitmq.com  Wed Apr 24 17:43:44 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 24 Apr 2013 17:43:44 +0100
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
References: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
Message-ID: <51780BC0.8060903@rabbitmq.com>

Hmm. I am curious. On my machine (Ubuntu 10.04) the amount of memory 
reported used in "rabbitmqctl status" matches up much more closely with 
RES than with VIRT (which is roughly what you'd expect).

In your case the 17.9GB VIRT vs 269MB RES is too much to be explained by 
paged-out memory since you have 5GB of swap that is not used). So I 
would expect it to be memory-mapped files or other mysterious things.

However, Erlang certainly thinks that your RabbitMQ process is really 
using 15.5GB of memory; the memory breakdown looks plausible and those 
numbers do not at all correspond to memory-mapped files or whatever.

So I am not surprised the memory alarm has gone off, what surprises me 
is that the OS is reporting so little real memory in use. Which OS is 
it? How did you install Erlang?

Cheers, Simon

On 24/04/13 14:49, Kyle O'Donnell wrote:
> Hi,
>
> I've built rabbit (2.8.7 and 3.0.4) from source using R15B03, here
> are the build time options:
>
> make RABBITMQ_BASE=/x/s/rabbitmq-server-3.0.4
> RABBITMQ_LOG_BASE=/x/s/rabbitmq-server-3.0.4/var/log
> RABBITMQ_CONFIG_FILE=/x/s/rabbitmq-server-3.0.4/etc/rabbitmq
> RABBITMQ_MNESIA_DIR=/x/s/rabbitmq-server-3.0.4/var/lib/mnesia
> TARGET_DIR=/x/s/rabbitmq-server-3.0.4
> SBIN_DIR=/x/s/rabbitmq-server-3.0.4/sbin
> MAN_DIR=/x/s/rabbitmq-server-3.0.4/man
>
> When I start my app rabbit quickly reports that it's reached the high
> watermark for memory usage, and it counts virtual memory not resident
> memory:
>
> PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+ COMMAND
> 29723 prod      20   0 17.9g 269m 2752 S    4  0.8   2:40.80
> /x/s/erlang-R15B03/lib/erlang/erts-5.9.3.1/bin/beam.smp -W w -K true
> -A30 -P 1048576 -- -root /x/s/erlang-R15B03/lib/erlang -progname erl
> -- -home /home/prod -- -pa /x/s/rabbitmq
>
> There is plenty of free memory on the machine
>
> $ free -m total       used       free     shared    buffers
> cached Mem:         32178       2992      29186          0        242
> 1929 -/+ buffers/cache:        820      31358 Swap:         5719
> 0       5719
>
> Is this normal? Curious why rabbit cares about the virtual memory
> size when there is so much actual memory available.
>
> below is the output from rabbitmqctl status
>
> Thanks, Kyle
>
>
> rabbitmqctl status Status of node 'rabbit at p1-amqp-j101' ...
> [{pid,29723}, {running_applications,
> [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","0.0.0"},
> {rabbitmq_management,"RabbitMQ Management Console","0.0.0"},
> {rabbitmq_management_agent,"RabbitMQ Management Agent","0.0.0"},
> {rabbit,"RabbitMQ","3.0.4"}, {mnesia,"MNESIA  CXC 138 12","4.7.1"},
> {os_mon,"CPO  CXC 138 46","2.2.10"}, {rabbitmq_web_dispatch,"RabbitMQ
> Web Dispatcher","0.0.0"},
> {webmachine,"webmachine","1.9.1-rmq0.0.0-git52e62bc"},
> {mochiweb,"MochiMedia Web Server","2.3.1-rmq0.0.0-gitd541e9a"},
> {xmerl,"XML parser","1.3.2"}, {inets,"INETS  CXC 138 49","5.9.2"},
> {amqp_client,"RabbitMQ AMQP Client","0.0.0"}, {sasl,"SASL  CXC 138
> 11","2.2.1"}, {stdlib,"ERTS  CXC 138 10","1.18.3"}, {kernel,"ERTS
> CXC 138 10","2.15.3"}]}, {os,{unix,linux}}, {erlang_version, "Erlang
> R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:4:4] [async-threads:30]
> [hipe] [kernel-poll:true]\n"}, {memory, [{total,15536914264},
> {connection_procs,89537888}, {queue_procs,18333416},
> {plugins,1170400}, {other_proc,6548309}, {mnesia,2538168},
> {mgmt_db,32239752}, {msg_index,615120}, {other_ets,3557064},
> {binary,15276878352}, {code,20248995}, {atom,801697},
> {other_system,84445103}]}, {vm_memory_high_watermark,0.4},
> {vm_memory_limit,13496687001}, {disk_free_limit,1000000000},
> {disk_free,22007357440}, {file_descriptors, [{total_limit,130970},
> {total_used,1828}, {sockets_limit,117871}, {sockets_used,1826}]},
> {processes,[{limit,1048576},{used,20875}]}, {run_queue,0},
> {uptime,1620}] ...done.
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From kyleo at 0b10.mx  Wed Apr 24 17:50:16 2013
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Wed, 24 Apr 2013 12:50:16 -0400 (EDT)
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <51780BC0.8060903@rabbitmq.com>
References: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
	<51780BC0.8060903@rabbitmq.com>
Message-ID: <1335504433.75055.1366822216553.JavaMail.root@0b10.mx>

When I attached to the erlang VM it was indeed reporting ~15GB of memory usage

Ubuntu 12.04

Compiled erlang from source

here are my config options:
./configure --prefix=/x/s/erlang-R15B03 --enable-smp-support --enable-hipe --enable-threads --with-ssl



----- Original Message -----
From: "Simon MacMullen" <simon at rabbitmq.com>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Cc: "Kyle O'Donnell" <kyleo at 0b10.mx>
Sent: Wednesday, April 24, 2013 12:43:44 PM
Subject: Re: [rabbitmq-discuss] memory usage reporting

Hmm. I am curious. On my machine (Ubuntu 10.04) the amount of memory 
reported used in "rabbitmqctl status" matches up much more closely with 
RES than with VIRT (which is roughly what you'd expect).

In your case the 17.9GB VIRT vs 269MB RES is too much to be explained by 
paged-out memory since you have 5GB of swap that is not used). So I 
would expect it to be memory-mapped files or other mysterious things.

However, Erlang certainly thinks that your RabbitMQ process is really 
using 15.5GB of memory; the memory breakdown looks plausible and those 
numbers do not at all correspond to memory-mapped files or whatever.

So I am not surprised the memory alarm has gone off, what surprises me 
is that the OS is reporting so little real memory in use. Which OS is 
it? How did you install Erlang?

Cheers, Simon

On 24/04/13 14:49, Kyle O'Donnell wrote:
> Hi,
>
> I've built rabbit (2.8.7 and 3.0.4) from source using R15B03, here
> are the build time options:
>
> make RABBITMQ_BASE=/x/s/rabbitmq-server-3.0.4
> RABBITMQ_LOG_BASE=/x/s/rabbitmq-server-3.0.4/var/log
> RABBITMQ_CONFIG_FILE=/x/s/rabbitmq-server-3.0.4/etc/rabbitmq
> RABBITMQ_MNESIA_DIR=/x/s/rabbitmq-server-3.0.4/var/lib/mnesia
> TARGET_DIR=/x/s/rabbitmq-server-3.0.4
> SBIN_DIR=/x/s/rabbitmq-server-3.0.4/sbin
> MAN_DIR=/x/s/rabbitmq-server-3.0.4/man
>
> When I start my app rabbit quickly reports that it's reached the high
> watermark for memory usage, and it counts virtual memory not resident
> memory:
>
> PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+ COMMAND
> 29723 prod      20   0 17.9g 269m 2752 S    4  0.8   2:40.80
> /x/s/erlang-R15B03/lib/erlang/erts-5.9.3.1/bin/beam.smp -W w -K true
> -A30 -P 1048576 -- -root /x/s/erlang-R15B03/lib/erlang -progname erl
> -- -home /home/prod -- -pa /x/s/rabbitmq
>
> There is plenty of free memory on the machine
>
> $ free -m total       used       free     shared    buffers
> cached Mem:         32178       2992      29186          0        242
> 1929 -/+ buffers/cache:        820      31358 Swap:         5719
> 0       5719
>
> Is this normal? Curious why rabbit cares about the virtual memory
> size when there is so much actual memory available.
>
> below is the output from rabbitmqctl status
>
> Thanks, Kyle
>
>
> rabbitmqctl status Status of node 'rabbit at p1-amqp-j101' ...
> [{pid,29723}, {running_applications,
> [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","0.0.0"},
> {rabbitmq_management,"RabbitMQ Management Console","0.0.0"},
> {rabbitmq_management_agent,"RabbitMQ Management Agent","0.0.0"},
> {rabbit,"RabbitMQ","3.0.4"}, {mnesia,"MNESIA  CXC 138 12","4.7.1"},
> {os_mon,"CPO  CXC 138 46","2.2.10"}, {rabbitmq_web_dispatch,"RabbitMQ
> Web Dispatcher","0.0.0"},
> {webmachine,"webmachine","1.9.1-rmq0.0.0-git52e62bc"},
> {mochiweb,"MochiMedia Web Server","2.3.1-rmq0.0.0-gitd541e9a"},
> {xmerl,"XML parser","1.3.2"}, {inets,"INETS  CXC 138 49","5.9.2"},
> {amqp_client,"RabbitMQ AMQP Client","0.0.0"}, {sasl,"SASL  CXC 138
> 11","2.2.1"}, {stdlib,"ERTS  CXC 138 10","1.18.3"}, {kernel,"ERTS
> CXC 138 10","2.15.3"}]}, {os,{unix,linux}}, {erlang_version, "Erlang
> R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:4:4] [async-threads:30]
> [hipe] [kernel-poll:true]\n"}, {memory, [{total,15536914264},
> {connection_procs,89537888}, {queue_procs,18333416},
> {plugins,1170400}, {other_proc,6548309}, {mnesia,2538168},
> {mgmt_db,32239752}, {msg_index,615120}, {other_ets,3557064},
> {binary,15276878352}, {code,20248995}, {atom,801697},
> {other_system,84445103}]}, {vm_memory_high_watermark,0.4},
> {vm_memory_limit,13496687001}, {disk_free_limit,1000000000},
> {disk_free,22007357440}, {file_descriptors, [{total_limit,130970},
> {total_used,1828}, {sockets_limit,117871}, {sockets_used,1826}]},
> {processes,[{limit,1048576},{used,20875}]}, {run_queue,0},
> {uptime,1620}] ...done.
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From kyleo at 0b10.mx  Wed Apr 24 18:13:41 2013
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Wed, 24 Apr 2013 13:13:41 -0400 (EDT)
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <1335504433.75055.1366822216553.JavaMail.root@0b10.mx>
References: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
	<51780BC0.8060903@rabbitmq.com>
	<1335504433.75055.1366822216553.JavaMail.root@0b10.mx>
Message-ID: <1355894214.75061.1366823621893.JavaMail.root@0b10.mx>

So I had a hunch it was erlang R15 so I tried R14 and I am not seeing the same behaviour, and my app works just fine:

Has anyone seen similar issues using R15?  Does rabbit actually support R15?

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                                                                                         
22185 prod      20   0 2218m 164m 2648 S    1  0.5   2:03.38 /x/s/erlang-R14B04/lib/erlang/erts-5.8.5/bin/beam.smp -W w -K true -A30 -P 1048576 -- -root /x/s/                     

$ rabbitmqctl status
Status of node 'rabbit at p1-amqp-j101' ...
[{pid,22185},
 {running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","0.0.0"},
      {rabbitmq_management,"RabbitMQ Management Console","0.0.0"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","0.0.0"},
      {rabbit,"RabbitMQ","3.0.4"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","0.0.0"},
      {webmachine,"webmachine","1.9.1-rmq0.0.0-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq0.0.0-gitd541e9a"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","0.0.0"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,126538808},
      {connection_procs,77192},
      {queue_procs,322592},
      {plugins,247664},
      {other_proc,30329304},
      {mnesia,92032},
      {mgmt_db,195648},
      {msg_index,302840},
      {other_ets,1738912},
      {binary,31832},
      {code,19051379},
      {atom,1887705},
      {other_system,72261708}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,13496687001},
 {disk_free_limit,1000000000},
 {disk_free,21999628288},
 {file_descriptors,
     [{total_limit,130970},
      {total_used,5},
      {sockets_limit,117871},
      {sockets_used,3}]},
 {processes,[{limit,1048576},{used,230}]},
 {run_queue,0},
 {uptime,506}]
...done.


----- Original Message -----
From: "Kyle O'Donnell" <kyleo at 0b10.mx>
To: "Simon MacMullen" <simon at rabbitmq.com>
Cc: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, April 24, 2013 12:50:16 PM
Subject: Re: [rabbitmq-discuss] memory usage reporting

When I attached to the erlang VM it was indeed reporting ~15GB of memory usage

Ubuntu 12.04

Compiled erlang from source

here are my config options:
./configure --prefix=/x/s/erlang-R15B03 --enable-smp-support --enable-hipe --enable-threads --with-ssl



----- Original Message -----
From: "Simon MacMullen" <simon at rabbitmq.com>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Cc: "Kyle O'Donnell" <kyleo at 0b10.mx>
Sent: Wednesday, April 24, 2013 12:43:44 PM
Subject: Re: [rabbitmq-discuss] memory usage reporting

Hmm. I am curious. On my machine (Ubuntu 10.04) the amount of memory 
reported used in "rabbitmqctl status" matches up much more closely with 
RES than with VIRT (which is roughly what you'd expect).

In your case the 17.9GB VIRT vs 269MB RES is too much to be explained by 
paged-out memory since you have 5GB of swap that is not used). So I 
would expect it to be memory-mapped files or other mysterious things.

However, Erlang certainly thinks that your RabbitMQ process is really 
using 15.5GB of memory; the memory breakdown looks plausible and those 
numbers do not at all correspond to memory-mapped files or whatever.

So I am not surprised the memory alarm has gone off, what surprises me 
is that the OS is reporting so little real memory in use. Which OS is 
it? How did you install Erlang?

Cheers, Simon

On 24/04/13 14:49, Kyle O'Donnell wrote:
> Hi,
>
> I've built rabbit (2.8.7 and 3.0.4) from source using R15B03, here
> are the build time options:
>
> make RABBITMQ_BASE=/x/s/rabbitmq-server-3.0.4
> RABBITMQ_LOG_BASE=/x/s/rabbitmq-server-3.0.4/var/log
> RABBITMQ_CONFIG_FILE=/x/s/rabbitmq-server-3.0.4/etc/rabbitmq
> RABBITMQ_MNESIA_DIR=/x/s/rabbitmq-server-3.0.4/var/lib/mnesia
> TARGET_DIR=/x/s/rabbitmq-server-3.0.4
> SBIN_DIR=/x/s/rabbitmq-server-3.0.4/sbin
> MAN_DIR=/x/s/rabbitmq-server-3.0.4/man
>
> When I start my app rabbit quickly reports that it's reached the high
> watermark for memory usage, and it counts virtual memory not resident
> memory:
>
> PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+ COMMAND
> 29723 prod      20   0 17.9g 269m 2752 S    4  0.8   2:40.80
> /x/s/erlang-R15B03/lib/erlang/erts-5.9.3.1/bin/beam.smp -W w -K true
> -A30 -P 1048576 -- -root /x/s/erlang-R15B03/lib/erlang -progname erl
> -- -home /home/prod -- -pa /x/s/rabbitmq
>
> There is plenty of free memory on the machine
>
> $ free -m total       used       free     shared    buffers
> cached Mem:         32178       2992      29186          0        242
> 1929 -/+ buffers/cache:        820      31358 Swap:         5719
> 0       5719
>
> Is this normal? Curious why rabbit cares about the virtual memory
> size when there is so much actual memory available.
>
> below is the output from rabbitmqctl status
>
> Thanks, Kyle
>
>
> rabbitmqctl status Status of node 'rabbit at p1-amqp-j101' ...
> [{pid,29723}, {running_applications,
> [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","0.0.0"},
> {rabbitmq_management,"RabbitMQ Management Console","0.0.0"},
> {rabbitmq_management_agent,"RabbitMQ Management Agent","0.0.0"},
> {rabbit,"RabbitMQ","3.0.4"}, {mnesia,"MNESIA  CXC 138 12","4.7.1"},
> {os_mon,"CPO  CXC 138 46","2.2.10"}, {rabbitmq_web_dispatch,"RabbitMQ
> Web Dispatcher","0.0.0"},
> {webmachine,"webmachine","1.9.1-rmq0.0.0-git52e62bc"},
> {mochiweb,"MochiMedia Web Server","2.3.1-rmq0.0.0-gitd541e9a"},
> {xmerl,"XML parser","1.3.2"}, {inets,"INETS  CXC 138 49","5.9.2"},
> {amqp_client,"RabbitMQ AMQP Client","0.0.0"}, {sasl,"SASL  CXC 138
> 11","2.2.1"}, {stdlib,"ERTS  CXC 138 10","1.18.3"}, {kernel,"ERTS
> CXC 138 10","2.15.3"}]}, {os,{unix,linux}}, {erlang_version, "Erlang
> R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:4:4] [async-threads:30]
> [hipe] [kernel-poll:true]\n"}, {memory, [{total,15536914264},
> {connection_procs,89537888}, {queue_procs,18333416},
> {plugins,1170400}, {other_proc,6548309}, {mnesia,2538168},
> {mgmt_db,32239752}, {msg_index,615120}, {other_ets,3557064},
> {binary,15276878352}, {code,20248995}, {atom,801697},
> {other_system,84445103}]}, {vm_memory_high_watermark,0.4},
> {vm_memory_limit,13496687001}, {disk_free_limit,1000000000},
> {disk_free,22007357440}, {file_descriptors, [{total_limit,130970},
> {total_used,1828}, {sockets_limit,117871}, {sockets_used,1826}]},
> {processes,[{limit,1048576},{used,20875}]}, {run_queue,0},
> {uptime,1620}] ...done.
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dr at jones.dk  Wed Apr 24 18:27:08 2013
From: dr at jones.dk (Jonas Smedegaard)
Date: Wed, 24 Apr 2013 19:27:08 +0200
Subject: [rabbitmq-discuss] Freely licensed specs
In-Reply-To: <5177FCD8.2010407@rabbitmq.com>
References: <20130424151641.12767.33111@bastian.jones.dk>
	<5177FCD8.2010407@rabbitmq.com>
Message-ID: <20130424172708.12767.82135@bastian.jones.dk>

Quoting Simon MacMullen (2013-04-24 17:40:08)
> On 24/04/13 16:16, Jonas Smedegaard wrote:
> > I am a Debian developer, and as you may know Debian is pretty strict 
> > on licensing issues.
> 
> We're very aware of that! And we have tried to be careful around 
> licensing issues.

Sorry, I didn't mean to say that any of _your_ tools or libraries are 
non-free licensed - only the spec files you publish.


> > Some AMQP-related tools and libraries require the AMQP specs 
> > available at build- or runtime.  For plain AMQP there are 
> > BSD-licensed "stripped" specs available, but it seems your derived 
> > specs are available only licensed with the Debian-incompatible AMQP 
> > license :-(
> 
> That's not entirely true; the extended spec which the RabbitMQ server 
> and official (and many unofficial) clients actually use:
> 
> http://hg.rabbitmq.com/rabbitmq-codegen/file/bbf467c98a21/amqp-rabbitmq-0.9.1.json
> 
> is BSD-licensed.

Ah, so it exists, just well hidden.


> However, I notice that the extended spec available from 
> http://www.rabbitmq.com/protocol.html is only available in an 
> AMQP-licensed version. Was that what you were talking about?
> 
> Anyway, we should correct that...

Yes, please do provide your specs (also the earlier 0-8 one) as XML.

As I wrote in my P.S. I believe to have those specs prepared for you 
already - just needs proof-reading and formal hand-over (from your side 
only: I need no credit, but your license doesn't allow my editing so you 
need to permit me that explicitly, I believe).


> > This issue is pretty serious, it seems: Some existing AMQP-related 
> > Debian packages are at risk of being removed from Debian if this is 
> > not solved.
> 
> ...but to know how high a priority to give producing such a spec I 
> would need to know if any packages in Debian are currently using the 
> AMQP-licensed extended XML spec. Can you tell me which packages these 
> are? I can't get anything useful out of bugs.debian.org :-(

Now that I inspected more closely it turns out that only a single 
package - qpid-python - is in violation - and then not your derived 
specs but original ones.

I now filed [bug#706101] - after you posted above, so no wonder you 
couldn't find it - if you tried :-).

Even if not so serious after all, still relevant for my needs: The Perl 
module [AnyEvent::RabbitMQ] ships with your published XML.  I will get 
in touch with the author and suggest using your JSON instead...


Thanks for your swift reply,

 - Jonas


[bug#706101]: http://bugs.debian.org/706101

[AnyEvent::RabbitMQ]: https://metacpan.org/module/AnyEvent::RabbitMQ


-- 
 * Jonas Smedegaard - idealist & Internet-arkitekt
 * Tlf.: +45 40843136  Website: http://dr.jones.dk/

 [x] quote me freely  [ ] ask before reusing  [ ] keep private

From matthias at rabbitmq.com  Wed Apr 24 18:36:36 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 24 Apr 2013 18:36:36 +0100
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <1355894214.75061.1366823621893.JavaMail.root@0b10.mx>
References: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
	<51780BC0.8060903@rabbitmq.com>
	<1335504433.75055.1366822216553.JavaMail.root@0b10.mx>
	<1355894214.75061.1366823621893.JavaMail.root@0b10.mx>
Message-ID: <51781824.4060506@rabbitmq.com>

Kyle,

On 24/04/13 18:13, Kyle O'Donnell wrote:
> So I had a hunch it was erlang R15 so I tried R14 and I am not seeing
> the same behaviour, and my app works just fine:

The status output indicates quite different application behaviour, which 
is more likely the cause of the different output than erlang versions. 
In particular, the previous report showed 1829 open sockets whereas this 
one is only showing 3.

> Does rabbit actually support R15?

Yes, it does. Though I'd recommend going for R16B.

Regards,

Matthias.

From kyleo at 0b10.mx  Wed Apr 24 18:49:46 2013
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Wed, 24 Apr 2013 13:49:46 -0400 (EDT)
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <51781824.4060506@rabbitmq.com>
References: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
	<51780BC0.8060903@rabbitmq.com>
	<1335504433.75055.1366822216553.JavaMail.root@0b10.mx>
	<1355894214.75061.1366823621893.JavaMail.root@0b10.mx>
	<51781824.4060506@rabbitmq.com>
Message-ID: <1575504343.75082.1366825786562.JavaMail.root@0b10.mx>

The difference is actually that my application finished starting using rabbit with R14 whereas with R15 my application didn't get to start because rabbit had reached the high watermark.

Rabbit is not the first erlang app I've seen to use large amounts of Virtual Memory when used with R15.  I am still leaning more towards R15, but haven't found any proof yet.

-Kyle
----- Original Message -----
From: "Matthias Radestock" <matthias at rabbitmq.com>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Cc: "Kyle O'Donnell" <kyleo at 0b10.mx>
Sent: Wednesday, April 24, 2013 1:36:36 PM
Subject: Re: [rabbitmq-discuss] memory usage reporting

Kyle,

On 24/04/13 18:13, Kyle O'Donnell wrote:
> So I had a hunch it was erlang R15 so I tried R14 and I am not seeing
> the same behaviour, and my app works just fine:

The status output indicates quite different application behaviour, which 
is more likely the cause of the different output than erlang versions. 
In particular, the previous report showed 1829 open sockets whereas this 
one is only showing 3.

> Does rabbit actually support R15?

Yes, it does. Though I'd recommend going for R16B.

Regards,

Matthias.

From matthias at rabbitmq.com  Wed Apr 24 19:48:11 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 24 Apr 2013 19:48:11 +0100
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <1575504343.75082.1366825786562.JavaMail.root@0b10.mx>
References: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
	<51780BC0.8060903@rabbitmq.com>
	<1335504433.75055.1366822216553.JavaMail.root@0b10.mx>
	<1355894214.75061.1366823621893.JavaMail.root@0b10.mx>
	<51781824.4060506@rabbitmq.com>
	<1575504343.75082.1366825786562.JavaMail.root@0b10.mx>
Message-ID: <517828EB.4040107@rabbitmq.com>

Kyle,

On 24/04/13 18:49, Kyle O'Donnell wrote:
> The difference is actually that my application finished starting
> using rabbit with R14 whereas with R15 my application didn't get to
> start because rabbit had reached the high watermark.

I see. There could be some sort of feedback loop between your app and 
rabbit, where some behaviour difference in the underlying Erlang VM gets 
amplified.

> Rabbit is not the first erlang app I've seen to use large amounts of
> Virtual Memory when used with R15.  I am still leaning more towards
> R15, but haven't found any proof yet.

Give R16B a try.


Regards,

Matthias.

From kyleo at 0b10.mx  Wed Apr 24 21:49:46 2013
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Wed, 24 Apr 2013 16:49:46 -0400 (EDT)
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <517828EB.4040107@rabbitmq.com>
References: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
	<51780BC0.8060903@rabbitmq.com>
	<1335504433.75055.1366822216553.JavaMail.root@0b10.mx>
	<1355894214.75061.1366823621893.JavaMail.root@0b10.mx>
	<51781824.4060506@rabbitmq.com>
	<1575504343.75082.1366825786562.JavaMail.root@0b10.mx>
	<517828EB.4040107@rabbitmq.com>
Message-ID: <718022884.75116.1366836586961.JavaMail.root@0b10.mx>

R16B seems to behave the same way R15B03 does:

Status of node 'rabbit at p1-amqp-j101' ...
[{pid,21245},
 {running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","0.0.0"},
      {rabbitmq_management,"RabbitMQ Management Console","0.0.0"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","0.0.0"},
      {webmachine,"webmachine","1.9.1-rmq0.0.0-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq0.0.0-gitd541e9a"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","0.0.0"},
      {rabbit,"RabbitMQ","3.0.4"},
      {mnesia,"MNESIA  CXC 138 12","4.8"},
      {os_mon,"CPO  CXC 138 46","2.2.11"},
      {inets,"INETS  CXC 138 49","5.9.4"},
      {amqp_client,"RabbitMQ AMQP Client","0.0.0"},
      {xmerl,"XML parser","1.3.3"},
      {sasl,"SASL  CXC 138 11","2.3.1"},
      {stdlib,"ERTS  CXC 138 10","1.19.1"},
      {kernel,"ERTS  CXC 138 10","2.16.1"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R16B (erts-5.10.1) [source] [64-bit] [smp:4:4] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,15478231776},
      {connection_procs,92186808},
      {queue_procs,16649120},
      {plugins,465008},
      {other_proc,6397291},
      {mnesia,2538008},
      {mgmt_db,24607160},
      {msg_index,386144},
      {other_ets,3307440},
      {binary,15285217656},
      {code,21554477},
      {atom,801697},
      {other_system,24120967}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,13496687001},
 {disk_free_limit,1000000000},
 {disk_free,21794127872},
 {file_descriptors,
     [{total_limit,130970},
      {total_used,1828},
      {sockets_limit,117871},
      {sockets_used,1826}]},
 {processes,[{limit,1048576},{used,20871}]},
 {run_queue,0},
 {uptime,329}]
...done.


----- Original Message -----
From: "Matthias Radestock" <matthias at rabbitmq.com>
To: "Kyle O'Donnell" <kyleo at 0b10.mx>
Cc: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, April 24, 2013 2:48:11 PM
Subject: Re: [rabbitmq-discuss] memory usage reporting

Kyle,

On 24/04/13 18:49, Kyle O'Donnell wrote:
> The difference is actually that my application finished starting
> using rabbit with R14 whereas with R15 my application didn't get to
> start because rabbit had reached the high watermark.

I see. There could be some sort of feedback loop between your app and 
rabbit, where some behaviour difference in the underlying Erlang VM gets 
amplified.

> Rabbit is not the first erlang app I've seen to use large amounts of
> Virtual Memory when used with R15.  I am still leaning more towards
> R15, but haven't found any proof yet.

Give R16B a try.


Regards,

Matthias.

From matthias at rabbitmq.com  Wed Apr 24 22:08:30 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 24 Apr 2013 22:08:30 +0100
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <718022884.75116.1366836586961.JavaMail.root@0b10.mx>
References: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
	<51780BC0.8060903@rabbitmq.com>
	<1335504433.75055.1366822216553.JavaMail.root@0b10.mx>
	<1355894214.75061.1366823621893.JavaMail.root@0b10.mx>
	<51781824.4060506@rabbitmq.com>
	<1575504343.75082.1366825786562.JavaMail.root@0b10.mx>
	<517828EB.4040107@rabbitmq.com>
	<718022884.75116.1366836586961.JavaMail.root@0b10.mx>
Message-ID: <517849CE.4090009@rabbitmq.com>

Kyle,

On 24/04/13 21:49, Kyle O'Donnell wrote:
> R16B seems to behave the same way R15B03 does:

Interesting. Do you have a 'rabbitmqctl report' to go with that?

What is your app actually doing? Looks like it opens a fair number of 
connections, and publish quite a lot of (or some very large) messages. 
Presumably it's consuming them too. The difference in behaviour could be 
due to very small scheduling differences in the VM, or, if you are 
running the producers and consumers on the same machine as rabbit, 
differences in Erlang CPU usage and consequent O/S level scheduling.

Can you condense the behaviour into a test case that we can run against 
different erlang versions and observe the difference in behaviour?

Regards,

Matthias.

From kyleo at 0b10.mx  Wed Apr 24 22:43:37 2013
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Wed, 24 Apr 2013 17:43:37 -0400 (EDT)
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <517849CE.4090009@rabbitmq.com>
References: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
	<1335504433.75055.1366822216553.JavaMail.root@0b10.mx>
	<1355894214.75061.1366823621893.JavaMail.root@0b10.mx>
	<51781824.4060506@rabbitmq.com>
	<1575504343.75082.1366825786562.JavaMail.root@0b10.mx>
	<517828EB.4040107@rabbitmq.com>
	<718022884.75116.1366836586961.JavaMail.root@0b10.mx>
	<517849CE.4090009@rabbitmq.com>
Message-ID: <1285849370.75155.1366839817632.JavaMail.root@0b10.mx>

Matthias,

I don't know if there is anything confidential in the report output.  Is there something specific I can send you (the output is ~10k lines)?

I don't know specifically what our app is doing, though I can ask the development team specific questions for you... If I can simplify/test it I'll let you know.

I think there are 2 possible issues, 1) erlang might be looking in the wrong place to get its memory usage information and 2) something is causing erlang to reserve large chunks of virtual memory.

I also tried one last thing... the build I had of R14 was about 12months old.  I wanted to make sure it was using the exact same configure options my R15 and R16 builds.  I recompiled R14, and rabbit and I am not seeing the huge virtual memory usage:

notice the resident memory usage and the memory reported by rabbit status are very close [120mb vs 166mb]

also notice that the amount of memory allocated to 'binary' is almost nil, whereas with R15/R16 it was huge..


  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                                                                                         
26856 prod      20   0 2217m 166m 2640 S    1  0.5   2:03.78 beam.smp                                                                                         

Status of node 'rabbit at p1-amqp-j101' ...
[{pid,26856},
 {running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","0.0.0"},
      {rabbitmq_management,"RabbitMQ Management Console","0.0.0"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","0.0.0"},
      {rabbit,"RabbitMQ","3.0.4"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","0.0.0"},
      {webmachine,"webmachine","1.9.1-rmq0.0.0-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq0.0.0-gitd541e9a"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {amqp_client,"RabbitMQ AMQP Client","0.0.0"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,126532760},
      {connection_procs,225328},
      {queue_procs,414736},
      {plugins,116176},
      {other_proc,30207680},
      {mnesia,97560},
      {mgmt_db,165176},
      {msg_index,302840},
      {other_ets,1744392},
      {binary,34256},
      {code,19111543},
      {atom,1887705},
      {other_system,72225368}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,13496687001},
 {disk_free_limit,1000000000},
 {disk_free,21576155136},
 {file_descriptors,
     [{total_limit,130970},
      {total_used,5},
      {sockets_limit,117871},
      {sockets_used,3}]},
 {processes,[{limit,1048576},{used,264}]},
 {run_queue,0},
 {uptime,578}]
...done.


----- Original Message -----
From: "Matthias Radestock" <matthias at rabbitmq.com>
To: "Kyle O'Donnell" <kyleo at 0b10.mx>
Cc: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, April 24, 2013 5:08:30 PM
Subject: Re: [rabbitmq-discuss] memory usage reporting

Kyle,

On 24/04/13 21:49, Kyle O'Donnell wrote:
> R16B seems to behave the same way R15B03 does:

Interesting. Do you have a 'rabbitmqctl report' to go with that?

What is your app actually doing? Looks like it opens a fair number of 
connections, and publish quite a lot of (or some very large) messages. 
Presumably it's consuming them too. The difference in behaviour could be 
due to very small scheduling differences in the VM, or, if you are 
running the producers and consumers on the same machine as rabbit, 
differences in Erlang CPU usage and consequent O/S level scheduling.

Can you condense the behaviour into a test case that we can run against 
different erlang versions and observe the difference in behaviour?

Regards,

Matthias.

From kyleo at 0b10.mx  Wed Apr 24 23:05:17 2013
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Wed, 24 Apr 2013 18:05:17 -0400 (EDT)
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <1285849370.75155.1366839817632.JavaMail.root@0b10.mx>
References: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
	<1355894214.75061.1366823621893.JavaMail.root@0b10.mx>
	<51781824.4060506@rabbitmq.com>
	<1575504343.75082.1366825786562.JavaMail.root@0b10.mx>
	<517828EB.4040107@rabbitmq.com>
	<718022884.75116.1366836586961.JavaMail.root@0b10.mx>
	<517849CE.4090009@rabbitmq.com>
	<1285849370.75155.1366839817632.JavaMail.root@0b10.mx>
Message-ID: <520099298.75167.1366841117910.JavaMail.root@0b10.mx>

one more thing to note...

according to and erlang man page, the memory reported should be based on cached+buffered+free on linux, whereas erlang is reporting it based on virtual memory...

http://www.erlang.org/doc/man/memsup.html


----- Original Message -----
From: "Kyle O'Donnell" <kyleo at 0b10.mx>
To: "Matthias Radestock" <matthias at rabbitmq.com>
Cc: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, April 24, 2013 5:43:37 PM
Subject: Re: [rabbitmq-discuss] memory usage reporting

Matthias,

I don't know if there is anything confidential in the report output.  Is there something specific I can send you (the output is ~10k lines)?

I don't know specifically what our app is doing, though I can ask the development team specific questions for you... If I can simplify/test it I'll let you know.

I think there are 2 possible issues, 1) erlang might be looking in the wrong place to get its memory usage information and 2) something is causing erlang to reserve large chunks of virtual memory.

I also tried one last thing... the build I had of R14 was about 12months old.  I wanted to make sure it was using the exact same configure options my R15 and R16 builds.  I recompiled R14, and rabbit and I am not seeing the huge virtual memory usage:

notice the resident memory usage and the memory reported by rabbit status are very close [120mb vs 166mb]

also notice that the amount of memory allocated to 'binary' is almost nil, whereas with R15/R16 it was huge..


  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                                                                                         
26856 prod      20   0 2217m 166m 2640 S    1  0.5   2:03.78 beam.smp                                                                                         

Status of node 'rabbit at p1-amqp-j101' ...
[{pid,26856},
 {running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","0.0.0"},
      {rabbitmq_management,"RabbitMQ Management Console","0.0.0"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","0.0.0"},
      {rabbit,"RabbitMQ","3.0.4"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","0.0.0"},
      {webmachine,"webmachine","1.9.1-rmq0.0.0-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq0.0.0-gitd541e9a"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {amqp_client,"RabbitMQ AMQP Client","0.0.0"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,126532760},
      {connection_procs,225328},
      {queue_procs,414736},
      {plugins,116176},
      {other_proc,30207680},
      {mnesia,97560},
      {mgmt_db,165176},
      {msg_index,302840},
      {other_ets,1744392},
      {binary,34256},
      {code,19111543},
      {atom,1887705},
      {other_system,72225368}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,13496687001},
 {disk_free_limit,1000000000},
 {disk_free,21576155136},
 {file_descriptors,
     [{total_limit,130970},
      {total_used,5},
      {sockets_limit,117871},
      {sockets_used,3}]},
 {processes,[{limit,1048576},{used,264}]},
 {run_queue,0},
 {uptime,578}]
...done.


----- Original Message -----
From: "Matthias Radestock" <matthias at rabbitmq.com>
To: "Kyle O'Donnell" <kyleo at 0b10.mx>
Cc: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, April 24, 2013 5:08:30 PM
Subject: Re: [rabbitmq-discuss] memory usage reporting

Kyle,

On 24/04/13 21:49, Kyle O'Donnell wrote:
> R16B seems to behave the same way R15B03 does:

Interesting. Do you have a 'rabbitmqctl report' to go with that?

What is your app actually doing? Looks like it opens a fair number of 
connections, and publish quite a lot of (or some very large) messages. 
Presumably it's consuming them too. The difference in behaviour could be 
due to very small scheduling differences in the VM, or, if you are 
running the producers and consumers on the same machine as rabbit, 
differences in Erlang CPU usage and consequent O/S level scheduling.

Can you condense the behaviour into a test case that we can run against 
different erlang versions and observe the difference in behaviour?

Regards,

Matthias.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Wed Apr 24 23:24:34 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 24 Apr 2013 23:24:34 +0100
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <1285849370.75155.1366839817632.JavaMail.root@0b10.mx>
References: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
	<1335504433.75055.1366822216553.JavaMail.root@0b10.mx>
	<1355894214.75061.1366823621893.JavaMail.root@0b10.mx>
	<51781824.4060506@rabbitmq.com>
	<1575504343.75082.1366825786562.JavaMail.root@0b10.mx>
	<517828EB.4040107@rabbitmq.com>
	<718022884.75116.1366836586961.JavaMail.root@0b10.mx>
	<517849CE.4090009@rabbitmq.com>
	<1285849370.75155.1366839817632.JavaMail.root@0b10.mx>
Message-ID: <51785BA2.8030005@rabbitmq.com>

Kyle,

On 24/04/13 22:43, Kyle O'Donnell wrote:
> I don't know if there is anything confidential in the report output.

Depends on the app. The report doesn't contain any message
headers/payloads, but it does have queue and exchange names, bindings,
connection IPs, etc.

> Is there something specific I can send you (the output is ~10k
> lines)?

Well, I'm trying to get a sense of what the app is doing, so no.

One other thing you could do is watch the management UI overview page in 
both the R14 and R16B case and note any obvious differences in the 
various counts, rates and stats reported.

> 1) erlang might be looking in the wrong place to get its memory usage
> information

I consider that highly unlikely. If the 'hole' was in system memory then
yes, but it's in the binary segment.

> 2) something is causing erlang to reserve large chunks of virtual
> memory.

That something would be rabbit buffering large (or large quantities of) 
messages ;)

> notice that the amount of memory allocated to 'binary' is almost
> nil, whereas with R15/R16 it was huge..

Yes, that segment of memory is nearly exclusively occupied by message 
payloads in rabbit.

There are plenty of other differences in the report though. Notice in 
particular the difference in socket count, which I pointed out before, 
and memory associated with connections.

OTOH, we shouldn't read too much into these reports since we are in both 
cases looking at a system in two quite different *final* states: on R14A 
the app has finished and rabbit is idle, on R16B rabbit has hit the 
memory high watermark and blocked producers. The interest question is 
how two systems with notionally identical initial states ended up in 
such radically different final states.

As I tried to explain, very small differences in behaviour could be 
massively amplified. Consider what happens if you have a simple 
producer/consumer app, and have tuned the consumer s.t. it *just* keeps 
up with the producer. A small disturbance, such as a minor change in 
scheduling can result in the consumer falling behind. At which point 
messages will start to build up in rabbit, memory becomes scarce, gc 
costs increase, messages start getting paged to disk (which is 
expensive), and eventually the memory watermark is hit - briefly to 
start with, more frequently later, and then permanently - and producers 
are blocked.

You did not answer my question as to whether the app is running on the 
same machine as the broker. If the latter, that could make a massive 
difference since recent Erlangs have very different (and generally 
improved) core utilisation. So if your app is sharing cores with rabbit 
then it may well get fewer cycles on R16B than R14, and if that affects 
consumers more than producers then the aforementioned amplification 
could happen.


Regards,

Matthias.

From matthias at rabbitmq.com  Wed Apr 24 23:26:57 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 24 Apr 2013 23:26:57 +0100
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <520099298.75167.1366841117910.JavaMail.root@0b10.mx>
References: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
	<1355894214.75061.1366823621893.JavaMail.root@0b10.mx>
	<51781824.4060506@rabbitmq.com>
	<1575504343.75082.1366825786562.JavaMail.root@0b10.mx>
	<517828EB.4040107@rabbitmq.com>
	<718022884.75116.1366836586961.JavaMail.root@0b10.mx>
	<517849CE.4090009@rabbitmq.com>
	<1285849370.75155.1366839817632.JavaMail.root@0b10.mx>
	<520099298.75167.1366841117910.JavaMail.root@0b10.mx>
Message-ID: <51785C31.9070001@rabbitmq.com>

On 24/04/13 23:05, Kyle O'Donnell wrote:
> one more thing to note...
>
> according to and erlang man page, the memory reported should be based
> on cached+buffered+free on linux, whereas erlang is reporting it
> based on virtual memory...
>
> http://www.erlang.org/doc/man/memsup.html

Rabbit doesn't use memsup.

Matthias.

From kyleo at 0b10.mx  Wed Apr 24 23:41:42 2013
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Wed, 24 Apr 2013 18:41:42 -0400 (EDT)
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <51785BA2.8030005@rabbitmq.com>
References: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
	<51781824.4060506@rabbitmq.com>
	<1575504343.75082.1366825786562.JavaMail.root@0b10.mx>
	<517828EB.4040107@rabbitmq.com>
	<718022884.75116.1366836586961.JavaMail.root@0b10.mx>
	<517849CE.4090009@rabbitmq.com>
	<1285849370.75155.1366839817632.JavaMail.root@0b10.mx>
	<51785BA2.8030005@rabbitmq.com>
Message-ID: <1879196836.75170.1366843302540.JavaMail.root@0b10.mx>


Apologies. The app is running on a different machine and all of my tests today involved the same 2 hosts.


----- Original Message -----
From: "Matthias Radestock" <matthias at rabbitmq.com>
To: "Kyle O'Donnell" <kyleo at 0b10.mx>
Cc: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, April 24, 2013 6:24:34 PM
Subject: Re: [rabbitmq-discuss] memory usage reporting

Kyle,

On 24/04/13 22:43, Kyle O'Donnell wrote:
> I don't know if there is anything confidential in the report output.

Depends on the app. The report doesn't contain any message
headers/payloads, but it does have queue and exchange names, bindings,
connection IPs, etc.

> Is there something specific I can send you (the output is ~10k
> lines)?

Well, I'm trying to get a sense of what the app is doing, so no.

One other thing you could do is watch the management UI overview page in 
both the R14 and R16B case and note any obvious differences in the 
various counts, rates and stats reported.

> 1) erlang might be looking in the wrong place to get its memory usage
> information

I consider that highly unlikely. If the 'hole' was in system memory then
yes, but it's in the binary segment.

> 2) something is causing erlang to reserve large chunks of virtual
> memory.

That something would be rabbit buffering large (or large quantities of) 
messages ;)

> notice that the amount of memory allocated to 'binary' is almost
> nil, whereas with R15/R16 it was huge..

Yes, that segment of memory is nearly exclusively occupied by message 
payloads in rabbit.

There are plenty of other differences in the report though. Notice in 
particular the difference in socket count, which I pointed out before, 
and memory associated with connections.

OTOH, we shouldn't read too much into these reports since we are in both 
cases looking at a system in two quite different *final* states: on R14A 
the app has finished and rabbit is idle, on R16B rabbit has hit the 
memory high watermark and blocked producers. The interest question is 
how two systems with notionally identical initial states ended up in 
such radically different final states.

As I tried to explain, very small differences in behaviour could be 
massively amplified. Consider what happens if you have a simple 
producer/consumer app, and have tuned the consumer s.t. it *just* keeps 
up with the producer. A small disturbance, such as a minor change in 
scheduling can result in the consumer falling behind. At which point 
messages will start to build up in rabbit, memory becomes scarce, gc 
costs increase, messages start getting paged to disk (which is 
expensive), and eventually the memory watermark is hit - briefly to 
start with, more frequently later, and then permanently - and producers 
are blocked.

You did not answer my question as to whether the app is running on the 
same machine as the broker. If the latter, that could make a massive 
difference since recent Erlangs have very different (and generally 
improved) core utilisation. So if your app is sharing cores with rabbit 
then it may well get fewer cycles on R16B than R14, and if that affects 
consumers more than producers then the aforementioned amplification 
could happen.


Regards,

Matthias.

From richard at raseley.com  Wed Apr 24 23:54:52 2013
From: richard at raseley.com (Richard Raseley)
Date: Wed, 24 Apr 2013 15:54:52 -0700
Subject: [rabbitmq-discuss] Federated Cluster Issue
In-Reply-To: <CAHEpgBC=wmrGy53mdkUvAjivVp0aL1uF_UprkkyC0Y8=KXHqDg@mail.gmail.com>
References: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
	<CAHEpgBC=wmrGy53mdkUvAjivVp0aL1uF_UprkkyC0Y8=KXHqDg@mail.gmail.com>
Message-ID: <CAO=6ox-jkXeNLfbeAqshMZdDM-KqpyPKDds7RQGnVBCWG3rrVQ@mail.gmail.com>

Chris,

Thank you - that error in the URI was the results at my attempts at
obfuscation. I am indeed referencing the vhost on the remote cluster.

Could you clarify this remark: "you will not actually see the links until
the exchanges you are federating actually exist on the upstream host"?

I ask because based on my understanding is that the URI defines the remote
system, username, password, and vhost - while the policy defines the local
exchange to be associated with the link. Am I misunderstanding this (e.g.
is the policy actually defining the remote exchange to be federated in a
"pull" relationship?).

Regards,

Richard


On Tue, Apr 23, 2013 at 6:32 AM, Chris <stuff at moesel.net> wrote:

> On Mon, Apr 22, 2013 at 6:11 PM, Richard Raseley <richard at raseley.com>wrote:
>
>> 3) Added a new upstream on each cluster pointing to the other with a URI
>> that looks similar to the following (from the perspective of "cluster-01":
>>
>> amqp://user:pass at cluster-02.domain.local/cluster02.exchange
>>
>
> You might also want to double-check the url you are using to setup the
> federation-upstream.  The URL above corresponds to a *virtual host* called
> "cluster02.exchange".  Is this what you really intended?  If you are
> actually using the default virtual host, then you should just use
> amqp://user:pass at cluster-02.domain.local/ and setup policies for the
> exchanges you wish to federate (as in your step 4).
>
> One other thing to note-- you will not actually see the links until the
> exchanges you are federating actually exist on the upstream host.  So if
> you haven't yet created the exchanges, you'll want to do that too.
>
> -Chris
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130424/f8d1f0d4/attachment.htm>

From richard at raseley.com  Wed Apr 24 23:56:08 2013
From: richard at raseley.com (Richard Raseley)
Date: Wed, 24 Apr 2013 15:56:08 -0700
Subject: [rabbitmq-discuss] Federated Cluster Issue
In-Reply-To: <5177DCF2.6050904@rabbitmq.com>
References: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
	<51765A26.3020302@rabbitmq.com>
	<CAO=6ox9_+Zd2FES6tJatw2cw1KbVvz_9mA-LNv2Sib9ikBQjvg@mail.gmail.com>
	<51769C56.7030403@rabbitmq.com>
	<CAO=6ox_YPo24PVphND-i9MTQSHOuVe=1PUUsVFS+HOT5b3Ma8g@mail.gmail.com>
	<5177DCF2.6050904@rabbitmq.com>
Message-ID: <CAO=6ox_np6EQ4CDqU62Di_zqODUEP0g-7CRpyADZ1K3eVN8dPQ@mail.gmail.com>

Simon,

I will go ahead and send you the requested output directly. Thank you.

Regards,

Richard


On Wed, Apr 24, 2013 at 6:24 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi. I mainly just wanted to check the policies against the exchanges - so
> the lists of all policies and all exchanges should be enough. Also feel
> free to excise anything you think is sensitive and send it privately.
>
> Cheers, Simon
>
>
> On 23/04/13 20:16, Richard Raseley wrote:
>
>> Simon,
>>
>> I did not include the leading and trailing spaces when entering the
>> pattern in the management UI - just did it here for readability purposes.
>>
>> I have the output of "rabbitmqctl report" from the 4 nodes in question
>> (two per cluster) - were there specific items that you wanted to look at
>> (I'd rather not share the entire output for security reasons)? I can see
>> that for the vhosts in question it is listing the federate-me policy
>> (not sure if that is what you were looking for).
>>
>> Regards,
>>
>> Richard
>>
>>
>> On Tue, Apr 23, 2013 at 7:36 AM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     On 23/04/13 15:28, Richard Raseley wrote:
>>
>>         Simon,
>>
>>         Thank you for your reply.
>>
>>         1) I was trying to obfuscate my actual naming conventions - but
>>         they are
>>         named in a similar manner. The general structure though is that in
>>         cluster01 I have an exchange named something like
>>         "cluster01.topic" and
>>         in the pattern field I put " ^cluster01\. " (basically everything
>> in
>>         preceeding the "." in the exchange name). Can you confirm that
>> this
>>         would be the correct pattern?
>>
>>
>>     In the quotation marks you have leading and trailing spaces which
>>     would obviously stop the match from working. But other than that it
>>     looks fine.
>>
>>
>>         2) I do not see "federate-me" show up in the management UI
>>         exchange list
>>         - but I see the policy in the Admin section. Would it show up as a
>>         discrete exchange itself?
>>
>>
>>     Some federation-related infrastructure (including exchanges) would
>>     show up once federation starts, but if you don't see "federate-me"
>>     in the policy column for any exchange then the policy is not
>>     matching and nothing will happen.
>>
>>     If you can post the results of "rabbitmqctl report" then I can look
>>     at why the policy pattern is not matching.
>>
>>
>>     Cheers, Simon
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, VMware
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130424/e87351e0/attachment.htm>

From prazzee at gmail.com  Thu Apr 25 01:05:24 2013
From: prazzee at gmail.com (Prazzy)
Date: Wed, 24 Apr 2013 17:05:24 -0700
Subject: [rabbitmq-discuss] Queue peeking
Message-ID: <CAN5oP9U=4HneVRtTUqwDtWurcfWUN4A5oCbOVQ0K_CdFnTFJtg@mail.gmail.com>

Hi,

I am new to RabbitMQ and I have a question on get messages option in
management plugin. It says """Clicking "Get Message(s)" will consume
messages from the queue. If requeue is set the message will be re-added to
the queue, but ordering will not be preserved and "redelivered" will be
set."""

Other article about peeking a queue
http://comments.gmane.org/gmane.comp.networking.rabbitmq.general/12034 says
"""In the next version of rabbit (after v2.6.1) the order will not
be  destroyed when requeueing messages. Messages will be requeued to
the  front of the queue, meaning that you can "peek" at the head of
the  queue. You can make use of the management interface or use an
AMQP  client to do this."""

So why management plugin says the ordering will not be preserved? I am just
trying to understand which is one correct?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130424/a4afddf7/attachment.htm>

From smaldini at gopivotal.com  Thu Apr 25 00:00:59 2013
From: smaldini at gopivotal.com (Stephane Maldini)
Date: Thu, 25 Apr 2013 00:00:59 +0100
Subject: [rabbitmq-discuss] Help us test RabbitMQ 3.1.0!
In-Reply-To: <5177E892.7020802@rabbitmq.com>
References: <5177E4D0.1040706@rabbitmq.com> <5177E892.7020802@rabbitmq.com>
Message-ID: <CANd5SujpVP1wieY3McbN6AtxQQD4gzUaA1Lf7vSmNGxR6Sjr8g@mail.gmail.com>

I've been playing with it and as far as can I say, its damn great work
guys, loving HA sync stuff :)
How do you play with cluster partition healing tho ?


On Wed, Apr 24, 2013 at 3:13 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 24/04/13 14:57, Simon MacMullen wrote:
>
>> Hi all. We're rapidly approaching the release of RabbitMQ 3.1.0.
>>
>
> Oh, and you'll need a reason to download it, right? :-) The headline new
> features are:
>
>  * Eager synchronisation of HA mirrors
>  * Charts and better statistics in management
>  * Automatic cluster partition healing
>  * AMQP 1.0 support
>
> as well as the usual raft of bug fixes, performance improvements and other
> new features.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 
Stephane Maldini | Sr. Consultant, EMEA | Pivotal
Mobile:+44 771 8699 291
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130425/c395781a/attachment.htm>

From smaldini at gopivotal.com  Thu Apr 25 00:02:26 2013
From: smaldini at gopivotal.com (Stephane Maldini)
Date: Thu, 25 Apr 2013 00:02:26 +0100
Subject: [rabbitmq-discuss] Help us test RabbitMQ 3.1.0!
In-Reply-To: <CANd5SujpVP1wieY3McbN6AtxQQD4gzUaA1Lf7vSmNGxR6Sjr8g@mail.gmail.com>
References: <5177E4D0.1040706@rabbitmq.com> <5177E892.7020802@rabbitmq.com>
	<CANd5SujpVP1wieY3McbN6AtxQQD4gzUaA1Lf7vSmNGxR6Sjr8g@mail.gmail.com>
Message-ID: <CANd5Sujh2L8YqszwaJrL_xvXDD5UQ6semZHqgOnBzP2siVLgZw@mail.gmail.com>

ffs. wrong account, sorry for the signature and all :(


On Thu, Apr 25, 2013 at 12:00 AM, Stephane Maldini
<smaldini at gopivotal.com>wrote:

> I've been playing with it and as far as can I say, its damn great work
> guys, loving HA sync stuff :)
> How do you play with cluster partition healing tho ?
>
>
> On Wed, Apr 24, 2013 at 3:13 PM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 24/04/13 14:57, Simon MacMullen wrote:
>>
>>> Hi all. We're rapidly approaching the release of RabbitMQ 3.1.0.
>>>
>>
>> Oh, and you'll need a reason to download it, right? :-) The headline new
>> features are:
>>
>>  * Eager synchronisation of HA mirrors
>>  * Charts and better statistics in management
>>  * Automatic cluster partition healing
>>  * AMQP 1.0 support
>>
>> as well as the usual raft of bug fixes, performance improvements and
>> other new features.
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130425/34e1465f/attachment.htm>

From alex.leung at jpl.nasa.gov  Wed Apr 24 21:17:09 2013
From: alex.leung at jpl.nasa.gov (Leung, Alex (398I))
Date: Wed, 24 Apr 2013 20:17:09 +0000
Subject: [rabbitmq-discuss] Need Advice to solve the problem
Message-ID: <CD9D8BD0.988E5%alex.leung@jpl.nasa.gov>

[root at miplmiro1 apps]# yum install erlang
Loaded plugins: aliases, changelog, downloadonly, kabi, presto, product-id, refresh-packagekit, security, subscription-
              : manager, tmprepo, verify, versionlock
Updating certificate-based repositories.
Unable to read consumer identity
Loading support for Red Hat kernel ABI
http://repos.fedorapeople.org/repos/peter/erlang/epel-6Workstation/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - "The requested URL returned error: 404"
Trying other mirror.
Setting up Install Process
Resolving Dependencies
--> Running transaction check
---> Package erlang.x86_64 0:R14B-04.2.el6 will be installed
--> Processing Dependency: erlang-xmerl(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-wx(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-webtool(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-typer(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-tv(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-tools(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-toolbar(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-test_server(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-syntax_tools(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Proce
?
?.
---> Package erlang-erts.x86_64 0:R14B-04.2.el6 will be installed
--> Processing Dependency: libz.so.1(ZLIB_1.2.2)(64bit) for package: erlang-erts-R14B-04.2.el6.x86_64
---> Package wxBase.x86_64 0:2.8.12-1.el6 will be installed
---> Package wxGTK.x86_64 0:2.8.12-1.el6 will be installed
---> Package wxGTK-gl.x86_64 0:2.8.12-1.el6 will be installed
--> Finished Dependency Resolution
Error: Package: erlang-erts-R14B-04.2.el6.x86_64 (epel)
           Requires: libz.so.1(ZLIB_1.2.2)(64bit)
 You could try using --skip-broken to work around the problem
** Found 6 pre-existing rpmdb problem(s), 'yum check' output follows:
febootstrap-supermin-helper-3.12-1.el6.x86_64 has missing requires of /sbin/mke2fs
libcom_err-1.42.7-2.el6.x86_64 is a duplicate with libcom_err-1.41.12-12.el6.i686
1:libguestfs-1.16.19-1.el6.x86_64 has missing requires of /lib64/libcom_err.so.2
1:libguestfs-1.16.19-1.el6.x86_64 has missing requires of /lib64/libe2p.so.2
1:libguestfs-1.16.19-1.el6.x86_64 has missing requires of /lib64/libext2fs.so.2
1:libguestfs-1.16.19-1.el6.x86_64 has missing requires of /lib64/libss.so.2
[root at miplmiro1 apps]#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130424/72aac0b8/attachment.htm>

From gdanycan at slip-software.com  Thu Apr 25 07:04:05 2013
From: gdanycan at slip-software.com (Gilles Danycan)
Date: Thu, 25 Apr 2013 08:04:05 +0200 (CEST)
Subject: [rabbitmq-discuss] no next heap size found after crash
In-Reply-To: <1151340059.13071.1366869765776.JavaMail.root@ns22265.ovh.net>
Message-ID: <1986553897.13075.1366869845240.JavaMail.root@ns22265.ovh.net>

Hi All, 

Unfortunately i have a new problem now :( 
i'm still on : RabbitMQ 3.0.4.40411, Erlang R14A 
server: 1To disk , 48Go ram , bi xeon 16 cores 

the server just reboot without reason apparently but the rabbitmq is not able to start after the reboot... 
i have the message : 

Crash dump was written to: erl_crash.dump 
no next heap size found: -2063447786, offset 0 
or 
Crash dump was written to: erl_crash.dump 
eheap_alloc: Cannot allocate 18446744065900154288 bytes of memory (of type "heap"). 

i tried to change the vm_memory_high_watermark in the config file but the second message appears. 

unforutnatly the partition of the rabbit is : 
/dev/sda2 910G 864G 1006M 100% /var 

i don't understand because we have only 5millions of messages in all queues... the last night i deleted some messages (more than 1millions) but the space disk available didn't change... 
is there some problem with erlang or indexes? we consume and requeue messages and when we don't requeue message the space disk used is still the same. 

it a rabbitmq server used in production, 
how can we start the rabbit now? 

REgards, 
Gilles Danycan 

IT Director - Slip Software 
Calle Guitard, 43, p3 
08034 Barcelona 
Tel : +34 932 055 731 
Fax : +34 933 301 973 
Skype: gilles_beverly 
Web: www.slip-software.com 




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130425/1d5ca3b9/attachment.htm>

From matthias at rabbitmq.com  Thu Apr 25 07:22:40 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 25 Apr 2013 07:22:40 +0100
Subject: [rabbitmq-discuss] no next heap size found after crash
In-Reply-To: <1986553897.13075.1366869845240.JavaMail.root@ns22265.ovh.net>
References: <1986553897.13075.1366869845240.JavaMail.root@ns22265.ovh.net>
Message-ID: <5178CBB0.6010801@rabbitmq.com>

Gilles,

On 25/04/13 07:04, Gilles Danycan wrote:
> Unfortunately i have a new problem now :(
> i'm still on : RabbitMQ 3.0.4.40411, Erlang R14A
> server: 1To disk , 48Go ram , bi xeon 16 cores
>
> the server just reboot without reason apparently but the rabbitmq is not
> able to start after the reboot...
> i have the message :
>
> Crash dump was written to: erl_crash.dump
> no next heap size found: -2063447786, offset 0
> or
> Crash dump was written to: erl_crash.dump
> eheap_alloc: Cannot allocate 18446744065900154288 bytes of memory (of
> type "heap").
>
> i tried to change the vm_memory_high_watermark in the config file but
> the second message appears.

I suggest upgrading Erlang. To R16B if you can. That will certainly get 
rid of the negative number reported.

This has come up before - see 
http://rabbitmq.1065348.n5.nabble.com/Rabbit-won-t-restart-no-next-heap-size-found-td22195.html 
- and at the time we also identified an issue we excessive memory usage 
on recovery after an unclean shutdown. That got fixed in 3.0.0 though.

So let's see whether an Erlang upgrade makes a difference. If not we can 
look at other options.

> unforutnatly the partition of the rabbit is :
> /dev/sda2             910G  864G 1006M 100% /var
>
> i don't understand because we have only 5millions of messages in all
> queues... the last night i deleted some messages (more than 1millions)
> but the space disk available didn't change...
> is there some problem with erlang or indexes? we consume and requeue
> messages and when we don't requeue message the space disk used is still
> the same.

Disk space is reclaimed by a garbage collector. That only kicks in when 
garbage exceeds 50% of the allocated space, so deleting 1m out of 5m 
messages won't be enough to trigger a gc.

Regards,

Matthias.

From abbiya at gmail.com  Thu Apr 25 07:30:05 2013
From: abbiya at gmail.com (Seshachalam Malisetti)
Date: Wed, 24 Apr 2013 23:30:05 -0700 (PDT)
Subject: [rabbitmq-discuss] how to call a model from rabbitmq php consumer's
 callback in codeigniter?
Message-ID: <9b1ffe8f-6953-4711-87a4-65bfcf3f7a82@googlegroups.com>



I developed an android app where it subscribes to a queue and also 
publishes to other queues. At a time it publishes the same message to two 
different queues, one of them is a queue named "Queue" and now from a 
appfog instance i need to subscribe to the "Queue" and consume messages and 
insert them in a mysql db.

I created a php standalone app for the above purpose with codeigniter. By 
some reason the worker app loses its connection to rabbitmq. i would like 
to know the best way to do this. How can a worker app on appfog can sustain 
the application restarts.

what of kind of thing i need to use to solve the above problem.

I figured that the problem is not with rabbitmq connection. it is with the 
code related to mysql inserts. i checked the crash logs of my app and the 
error is "Mysql gone away". an example of php rabbitmq consumer has call 
backs for receive message and register_shutdown. in receive call back i can 
not use $this of code igniter because its out of scope and i was using 
get_instance(). i am not sure how to call a method from rabbitmq client 
receive call back function

The controller is 


<?php
if (!defined('BASEPATH'))
  exit('No direct script access allowed');

include(__DIR__ . '/php-amqplib/config.php');
use PhpAmqpLib\Connection\AMQPConnection;
class Welcome extends CI_Controller {
public function __construct() {
    parent::__construct();}
public function index() {
    //connect to rabbitmq and consume messages
    //insert messages to mysql
    //$this->messages = array();
    $exchange = "router";
    $queue = "abbiya";

    $conn = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
    $ch = $conn->channel();

    /*
      name: $queue
      passive: false
      durable: true // the queue will survive server restarts
      exclusive: false // the queue can be accessed in other channels
      auto_delete: false //the queue won't be deleted once the channel is closed.
     */
    $ch->queue_declare($queue, false, true, false, false);

    $ch->queue_bind($queue, $exchange, $queue);

    /*
      queue: Queue from where to get the messages
      consumer_tag: Consumer identifier
      no_local: Don't receive messages published by this consumer.
      no_ack: Tells the server if the consumer will acknowledge the messages.
      exclusive: Request exclusive consumer access, meaning only this consumer can access the queue
      nowait:
      callback: A PHP Callback
     */
    $consumer_tag = "abbiya";

    $ch->basic_recover(true);
    $ch->basic_consume($queue, $consumer_tag, false, false, false, false, function($msg) {
                $message_body = json_decode($msg->body);
                $msg->delivery_info['channel']->
                        basic_ack($msg->delivery_info['delivery_tag']);

                // Send a message with the string "quit" to cancel the consumer.
                if ($msg->body === 'quit') {
                    $msg->delivery_info['channel']->
                            basic_cancel($msg->delivery_info['consumer_tag']);
                }
                $data = array(
                    'sender_id' => $message_body->r,
                    'receiver_id' => $message_body->s,
                    'message_content' => $message_body->m,
                    // 'sent_time' => $message_body->t,
                    'status' => 0
                );
                $ci =& get_instance();
                $ci->Message_model->newMessage($data);
            }
    );

    // Loop as long as the channel has callbacks registered
    while (count($ch->callbacks)) {
        $ch->wait();
    }

    register_shutdown_function(function() use ($ch, $conn) {
                $ch->close();
                $conn->close();
                $this->index();
            }
    );}
}
/* End of file welcome.php *//* Location: ./application/controllers/welcome.php */

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130424/5393b3fc/attachment.htm>

From tim+rabbitmq.com at coote.org  Thu Apr 25 10:05:41 2013
From: tim+rabbitmq.com at coote.org (Tim Coote)
Date: Thu, 25 Apr 2013 10:05:41 +0100
Subject: [rabbitmq-discuss] Help us test RabbitMQ 3.1.0!
In-Reply-To: <63CB7AF1-1744-413E-A267-629B91EBF615@alertme.com>
References: <5177E892.7020802@rabbitmq.com>
	<63CB7AF1-1744-413E-A267-629B91EBF615@alertme.com>
Message-ID: <1699335F-C3FA-484A-8EE7-50A80CC026F4@coote.org>

Hi Simon

Can you elaborate on "AMQP 1.0 support"?

On the one hand the rabbitmq site has an undated commitment to 1.0, on the other 1.0 is going into the ISO process and starting to get traction on the very long purchasing cycles of government bodies.  Is there a current roadmap of feature support over time?

Tim
> 
>> From: Simon MacMullen <simon at rabbitmq.com>
>> Date: 24 April 2013 15:13:38 BST
>> To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>> Subject: Re: [rabbitmq-discuss] Help us test RabbitMQ 3.1.0!
>> Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>> 
>> On 24/04/13 14:57, Simon MacMullen wrote:
>>> Hi all. We're rapidly approaching the release of RabbitMQ 3.1.0.
>> 
>> Oh, and you'll need a reason to download it, right? :-) The headline new 
>> features are:
>> 
>>  * Eager synchronisation of HA mirrors
>>  * Charts and better statistics in management
>>  * Automatic cluster partition healing
>>  * AMQP 1.0 support
>> 
>> as well as the usual raft of bug fixes, performance improvements and 
>> other new features.
>> 
>> Cheers, Simon
>> 
>> -- 
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130425/7e7eb090/attachment.htm>

From simon at rabbitmq.com  Thu Apr 25 10:56:21 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 25 Apr 2013 10:56:21 +0100
Subject: [rabbitmq-discuss] Freely licensed specs
In-Reply-To: <20130424172708.12767.82135@bastian.jones.dk>
References: <20130424151641.12767.33111@bastian.jones.dk>
	<5177FCD8.2010407@rabbitmq.com>
	<20130424172708.12767.82135@bastian.jones.dk>
Message-ID: <5178FDC5.7020802@rabbitmq.com>

On 24/04/13 18:27, Jonas Smedegaard wrote:
> Quoting Simon MacMullen (2013-04-24 17:40:08)
>> That's not entirely true; the extended spec which the RabbitMQ server
>> and official (and many unofficial) clients actually use:
>>
>> http://hg.rabbitmq.com/rabbitmq-codegen/file/bbf467c98a21/amqp-rabbitmq-0.9.1.json
>>
>> is BSD-licensed.
>
> Ah, so it exists, just well hidden.

Yeah, we should probably point to that from 
http://www.rabbitmq.com/protocol.html.

> As I wrote in my P.S. I believe to have those specs prepared for you
> already - just needs proof-reading and formal hand-over (from your side
> only: I need no credit, but your license doesn't allow my editing so you
> need to permit me that explicitly, I believe).

If you don't mind sending me what you've got that would be handy.

> Now that I inspected more closely it turns out that only a single
> package - qpid-python - is in violation - and then not your derived
> specs but original ones.

OK, phew.

> Even if not so serious after all, still relevant for my needs: The Perl
> module [AnyEvent::RabbitMQ] ships with your published XML.  I will get
> in touch with the author and suggest using your JSON instead...

It's probably easier for them to wait for a DFSG-free XML than change to 
JSON. We should get one sorted out in a week or so (hands are full with 
getting 3.1.0 out though so it might not be immediate since packages 
aren't on the verge of being ejected from Debian...)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Apr 25 10:57:12 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 25 Apr 2013 10:57:12 +0100
Subject: [rabbitmq-discuss] Queue peeking
In-Reply-To: <CAN5oP9U=4HneVRtTUqwDtWurcfWUN4A5oCbOVQ0K_CdFnTFJtg@mail.gmail.com>
References: <CAN5oP9U=4HneVRtTUqwDtWurcfWUN4A5oCbOVQ0K_CdFnTFJtg@mail.gmail.com>
Message-ID: <5178FDF8.4060607@rabbitmq.com>

On 25/04/13 01:05, Prazzy wrote:
> So why management plugin says the ordering will not be preserved? I am
> just trying to understand which is one correct?

The management plugin did not get updated it seems. I'll fix that. 
Thanks for pointing it out.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Apr 25 11:01:04 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 25 Apr 2013 11:01:04 +0100
Subject: [rabbitmq-discuss] Help us test RabbitMQ 3.1.0!
In-Reply-To: <CANd5SujpVP1wieY3McbN6AtxQQD4gzUaA1Lf7vSmNGxR6Sjr8g@mail.gmail.com>
References: <5177E4D0.1040706@rabbitmq.com> <5177E892.7020802@rabbitmq.com>
	<CANd5SujpVP1wieY3McbN6AtxQQD4gzUaA1Lf7vSmNGxR6Sjr8g@mail.gmail.com>
Message-ID: <5178FEE0.4080403@rabbitmq.com>

On 25/04/13 00:00, Stephane Maldini wrote:
> I've been playing with it and as far as can I say, its damn great work
> guys, loving HA sync stuff :)

Thanks!

> How do you play with cluster partition healing tho ?

Read the docs at:

   http://next.rabbitmq.com/partitions.html#automatic-handling

and then get to yanking network cables...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From smaldini at gopivotal.com  Thu Apr 25 11:24:47 2013
From: smaldini at gopivotal.com (Stephane Maldini)
Date: Thu, 25 Apr 2013 11:24:47 +0100
Subject: [rabbitmq-discuss] Help us test RabbitMQ 3.1.0!
In-Reply-To: <5178FEE0.4080403@rabbitmq.com>
References: <5177E4D0.1040706@rabbitmq.com> <5177E892.7020802@rabbitmq.com>
	<CANd5SujpVP1wieY3McbN6AtxQQD4gzUaA1Lf7vSmNGxR6Sjr8g@mail.gmail.com>
	<5178FEE0.4080403@rabbitmq.com>
Message-ID: <CANd5SugmFh5RLj=dURXzzuC8qJs1Ng5jzcdRD=bh3+7sGrsL0g@mail.gmail.com>

I had missed it, thanks this truely rocks?.
Keep on the good work :)


On Thu, Apr 25, 2013 at 11:01 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 25/04/13 00:00, Stephane Maldini wrote:
>
>> I've been playing with it and as far as can I say, its damn great work
>> guys, loving HA sync stuff :)
>>
>
> Thanks!
>
>
>  How do you play with cluster partition healing tho ?
>>
>
> Read the docs at:
>
>   http://next.rabbitmq.com/**partitions.html#automatic-**handling<http://next.rabbitmq.com/partitions.html#automatic-handling>
>
> and then get to yanking network cables...
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
Stephane Maldini | Sr. Consultant, EMEA | Pivotal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130425/308dd754/attachment.htm>

From simon at rabbitmq.com  Thu Apr 25 11:28:30 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 25 Apr 2013 11:28:30 +0100
Subject: [rabbitmq-discuss] Help us test RabbitMQ 3.1.0!
In-Reply-To: <1699335F-C3FA-484A-8EE7-50A80CC026F4@coote.org>
References: <5177E892.7020802@rabbitmq.com>
	<63CB7AF1-1744-413E-A267-629B91EBF615@alertme.com>
	<1699335F-C3FA-484A-8EE7-50A80CC026F4@coote.org>
Message-ID: <5179054E.6080306@rabbitmq.com>

On 25/04/13 10:05, Tim Coote wrote:
> Hi Simon
>
> Can you elaborate on "AMQP 1.0 support"?
>
> On the one hand the rabbitmq site has an undated commitment to 1.0, on
> the other 1.0 is going into the ISO process and starting to get traction
> on the very long purchasing cycles of government bodies.  Is there a
> current roadmap of feature support over time?

Well, that's a big question, so you get a long answer. While AMQP 1.0 is 
in some ways simpler than AMQP 0-9-1 (since 1.0 defines an awful lot 
less in terms of broker semantics) in most other ways it's much more 
complicated.

Therefore our support for AMQP 1.0 is somewhat partial. In general we 
have tried to make sure that if you can do something with RabbitMQ using 
AMQP 0-9-1 then you can also do it using AMQP 1.0. But there are parts 
of the AMQP 1.0 spec that map onto things that RabbitMQ just doesn't do, 
so we don't support those. See 
https://github.com/rabbitmq/rabbitmq-amqp1.0#limitations-and-unsupported-features

In general if RabbitMQ gains support for these things via 0-9-1 then we 
are likely to add support for them via 1.0. But we are not likely to 
start adding features to RabbitMQ just because they're in the AMQP 1.0 
spec. Note that there are bits of AMQP 0-9-1 that RabbitMQ still doesn't 
support - because they would complicate things, and none of our users 
seem to care.

Interoperability testing has also by necessity been quite limited; the 
number of AMQP 1.0 clients out there at the moment is very small and 
some of them have severe issues. We've done as much as we can, and if 
new clients appear we will make sure we interoperate with them.

Finally, it's worth pointing out that we at RabbitMQ do *not* see AMQP 
1.0 as the "natural successor" to AMQP 0-9-1. The protocols are 
radically different in scope, and while AMQP 1.0 is probably easier to 
retrofit to an existing non-AMQP broker, it's also a much more 
complicated protocol at the wire level. Lots of people have written AMQP 
0-9-1 clients from scratch; I don't imagine so many AMQP 1.0 clients 
being written. And the lack of semantics in 1.0 can be a bad thing; 
write your app against one AMQP 1.0 broker and it's not guaranteed to 
work against another (not that 0-9-1 gives you such a guarantee but it 
gets much closer).

So we see real value in AMQP 0-9-1 and will continue to support it 
indefinitely. We see supporting AMQP 1.0 as akin to supporting MQTT or 
STOMP: it's an interesting new protocol and hopefully it will be useful 
to some of our users. But it's not The Future Of Messaging. Messaging 
has many futures :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Apr 25 11:32:07 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 25 Apr 2013 11:32:07 +0100
Subject: [rabbitmq-discuss] Federated Cluster Issue
In-Reply-To: <CAO=6ox-jkXeNLfbeAqshMZdDM-KqpyPKDds7RQGnVBCWG3rrVQ@mail.gmail.com>
References: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
	<CAHEpgBC=wmrGy53mdkUvAjivVp0aL1uF_UprkkyC0Y8=KXHqDg@mail.gmail.com>
	<CAO=6ox-jkXeNLfbeAqshMZdDM-KqpyPKDds7RQGnVBCWG3rrVQ@mail.gmail.com>
Message-ID: <51790627.9020203@rabbitmq.com>

On 24/04/13 23:54, Richard Raseley wrote:
> Chris,
>
> Thank you - that error in the URI was the results at my attempts at
> obfuscation. I am indeed referencing the vhost on the remote cluster.
>
> Could you clarify this remark: "you will not actually see the links
> until the exchanges you are federating actually exist on the upstream host"?

I think Chris may be mistaken - in RabbitMQ 3.x the federation mechanism 
will declare upstream exchanges if they don't already exist (although 
2.x doesn't).

> I ask because based on my understanding is that the URI defines the
> remote system, username, password, and vhost - while the policy defines
> the local exchange to be associated with the link.

Yes.

> Am I misunderstanding
> this (e.g. is the policy actually defining the remote exchange to be
> federated in a "pull" relationship?).

No. The policy defines the local exchange, and the URI defines the 
remote exchange from which to pull messages.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Apr 25 11:44:50 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 25 Apr 2013 11:44:50 +0100
Subject: [rabbitmq-discuss] Federated Cluster Issue
In-Reply-To: <CAO=6ox_np6EQ4CDqU62Di_zqODUEP0g-7CRpyADZ1K3eVN8dPQ@mail.gmail.com>
References: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
	<51765A26.3020302@rabbitmq.com>
	<CAO=6ox9_+Zd2FES6tJatw2cw1KbVvz_9mA-LNv2Sib9ikBQjvg@mail.gmail.com>
	<51769C56.7030403@rabbitmq.com>
	<CAO=6ox_YPo24PVphND-i9MTQSHOuVe=1PUUsVFS+HOT5b3Ma8g@mail.gmail.com>
	<5177DCF2.6050904@rabbitmq.com>
	<CAO=6ox_np6EQ4CDqU62Di_zqODUEP0g-7CRpyADZ1K3eVN8dPQ@mail.gmail.com>
Message-ID: <51790922.1090607@rabbitmq.com>

Thanks. In the cases where you've defined a federation policy its 
pattern is defined as "^expense\.", but the exchanges are named like 
"expensepay.topic". I suspect you want to change the pattern to 
"^expensepay\.".

Cheers, Simon

On 24/04/13 23:56, Richard Raseley wrote:
> Simon,
>
> I will go ahead and send you the requested output directly. Thank you.
>
> Regards,
>
> Richard
>
>
> On Wed, Apr 24, 2013 at 6:24 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Hi. I mainly just wanted to check the policies against the exchanges
>     - so the lists of all policies and all exchanges should be enough.
>     Also feel free to excise anything you think is sensitive and send it
>     privately.
>
>     Cheers, Simon
>
>
>     On 23/04/13 20:16, Richard Raseley wrote:
>
>         Simon,
>
>         I did not include the leading and trailing spaces when entering the
>         pattern in the management UI - just did it here for readability
>         purposes.
>
>         I have the output of "rabbitmqctl report" from the 4 nodes in
>         question
>         (two per cluster) - were there specific items that you wanted to
>         look at
>         (I'd rather not share the entire output for security reasons)? I
>         can see
>         that for the vhosts in question it is listing the federate-me policy
>         (not sure if that is what you were looking for).
>
>         Regards,
>
>         Richard
>
>
>         On Tue, Apr 23, 2013 at 7:36 AM, Simon MacMullen
>         <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>
>              On 23/04/13 15:28, Richard Raseley wrote:
>
>                  Simon,
>
>                  Thank you for your reply.
>
>                  1) I was trying to obfuscate my actual naming
>         conventions - but
>                  they are
>                  named in a similar manner. The general structure though
>         is that in
>                  cluster01 I have an exchange named something like
>                  "cluster01.topic" and
>                  in the pattern field I put " ^cluster01\. " (basically
>         everything in
>                  preceeding the "." in the exchange name). Can you
>         confirm that this
>                  would be the correct pattern?
>
>
>              In the quotation marks you have leading and trailing spaces
>         which
>              would obviously stop the match from working. But other than
>         that it
>              looks fine.
>
>
>                  2) I do not see "federate-me" show up in the management UI
>                  exchange list
>                  - but I see the policy in the Admin section. Would it
>         show up as a
>                  discrete exchange itself?
>
>
>              Some federation-related infrastructure (including
>         exchanges) would
>              show up once federation starts, but if you don't see
>         "federate-me"
>              in the policy column for any exchange then the policy is not
>              matching and nothing will happen.
>
>              If you can post the results of "rabbitmqctl report" then I
>         can look
>              at why the policy pattern is not matching.
>
>
>              Cheers, Simon
>
>              --
>              Simon MacMullen
>              RabbitMQ, VMware
>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Apr 25 11:59:34 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 25 Apr 2013 11:59:34 +0100
Subject: [rabbitmq-discuss] Durability and consumer acknowledgement
 extremely slow
In-Reply-To: <5c6d72b4-ba54-495b-ab0e-2747dea619bd@googlegroups.com>
References: <5c6d72b4-ba54-495b-ab0e-2747dea619bd@googlegroups.com>
Message-ID: <51790C96.2050100@rabbitmq.com>

Hi Karl. I suspect you are not really seeing a bottleneck with 
acknowledgements, but rather an optimisation in autoack mode. When you 
publish a persistent message to an empty queue with a non-blocked 
autoack consumer RabbitMQ will not persist the message to disc - there's 
no point. The message can go straight to the consumer, and then it's 
gone; it can never be requeued.

So I suspect that's the difference you're seeing. And I'm afraid 5-8k 
msg/s is roughly what I would expect for persistent messages on a 
reasonable machine.

Cheers, Simon

On 24/04/13 17:26, Karl Rieb wrote:
> Hi,
>
> I am trying to improve the message throughput for a RabbitMQ queue in an
> Amazon cloud instance and am noticing a *significant* drop in
> performance when enabling acknowledgements for consumer of a durable
> queue (with persisted messages).  The real problem is that the
> bottleneck appears to be on the rabbit node and not with the consumers,
> so adding more consumers does not improve the throughput (or help drain
> the queue any quicker).  As a matter of fact, adding new consumers will
> just slow down existing consumers so everyone ends up consuming at a
> slower rate, preventing overall throughput from changing.
>
> Trying to do batch acknowledgements using the Multiple flag helps a bit
> (8k msgs/s vs 5.5k msgs/s) but not much compared to the initial drop.
>   It is only when I turn on *auto_ack* for the consumers that I see the
> performance shoot *way *back up and when I start seeing a linear
> increase in throughput as I add more consumers.
>
> Is this expected behavior?  Is there a way to configure the rabbit node
> so it doesn't hit this bottleneck with acknowledgements?
>
> Here is the sample code I'm using to test the throughput:
>
> Publisher:
>
>     #!/usr/bin/python
>
>     import pika
>
>     creds = pika.PlainCredentials('guest','guest')
>     conn  =
>     pika.BlockingConnection(pika.ConnectionParameters(host='10.10.1.123', credentials=creds))
>     chan  = conn.channel()
>
>     while True:
>     chan.basic_publish(exchange='simple_exchange',
>     routing_key='simple_queue', body='',
>     properties=pika.BasicProperties(delivery_mode=2))
>
>
> Consumer:
>
>       #!/usr/bin/python
>
>     import pika
>
>     def callback(chan, method, properties, body):
>          chan.basic_ack(delivery_tag=method.delivery_tag, multiple=False)
>
>     creds = pika.PlainCredentials('guest','guest')
>     conn  =
>     pika.BlockingConnection(pika.ConnectionParameters(host='10.10.1.123', credentials=creds))
>     chan  = conn.channel()
>
>     chan.basic_consume(callback, queue='simple_queue', no_ack=False)
>     chan.basic_qos(prefetch_count=1000)
>     chan.start_consuming()
>
>
> I spawn multiple processes for the producers and multiple for the
> consumer (so there is no python interpreter locking issues since each
> runs in its own interpreter instance).  I'm using an an Amazon
> *c1.xlarge *(8 virtual cores and "high" IO) Ubuntu 12.04 LTS instance
> with RabbitMQ version 3.0.4-1 and an Amazon ephemeral disk (in
> production we would use an EBS volume instead).  The queue is marked
> *Durable* and my messages all use *delivery_mode* 2 (persist).
>
> Below are the performance numbers.  For each test I use 2 publishers
> processes and 6 consumer processes (where 3 different machines host 2
> consumers each).  The producers and consumers are all on *separate*
> machines from the rabbit node.  Throughput measurements were done using
> the RabbitMQ management UI and linux utility top.  Python was compiled
> to pyc files before running.
>
> *no_ack = True:*
>      rate = 24,000/s
>      single consumer CPU   =  65%
>      single publisher CPU  =  80% (flow control enabled and being enforced)
>      (beam.smp) rabbit CPU = 400% (of 800%, 8 cores) -> 0.0%wa 11.5%sy
>
> *no_ack = False (manual acks per message):*
>      rate =  5,500/s
>      single consumer CPU   =  20%
>      single publisher CPU  =  20% (flow control enabled and being enforced)
>      (beam.smp) rabbit CPU = 300% (of 800%, 8 cores) -> 4.5%wa 10.0%sy
> The most notable difference besides the throughput are the I/O waits
> when ACKs are enabled (4.5% vs 0.0%).  This leads me to believe that the
> rabbit node is being bottlenecked by performing I/O operations for ACK
> bookkeeping.  The I/O doesn't appear to be a problem for persisting the
> published messages since I'm *guessing* that rabbit is buffering those
> and syncing them to disk in batches.  Does this mean the
> acknowledgements are not also being buffered before synced with disk?
>   Can I configure the rabbit node to change this behavior to help speed
> up the acknowledgements?   I'm not using transactions in the example
> code above, so I don't need any strict guarantees that ACKs were written
> to disk before returning.
>
> Thanks,
> Karl
>
> P.S. I wrote the same sample consumer code in Ruby to see if there was a
> difference (in case there was a Python issue), but the numbers were
> about the same.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From dr at jones.dk  Thu Apr 25 12:21:12 2013
From: dr at jones.dk (Jonas Smedegaard)
Date: Thu, 25 Apr 2013 13:21:12 +0200
Subject: [rabbitmq-discuss] Freely licensed specs
In-Reply-To: <5178FDC5.7020802@rabbitmq.com>
References: <20130424151641.12767.33111@bastian.jones.dk>
	<5177FCD8.2010407@rabbitmq.com>
	<20130424172708.12767.82135@bastian.jones.dk>
	<5178FDC5.7020802@rabbitmq.com>
Message-ID: <20130425112112.12767.63104@bastian.jones.dk>

Quoting Simon MacMullen (2013-04-25 11:56:21)
> On 24/04/13 18:27, Jonas Smedegaard wrote:
> > As I wrote in my P.S. I believe to have those specs prepared for you 
> > already - just needs proof-reading and formal hand-over (from your 
> > side only: I need no credit, but your license doesn't allow my 
> > editing so you need to permit me that explicitly, I believe).
> 
> If you don't mind sending me what you've got that would be handy.

Done now (as private mail).  Hope they are of some use.


> > Even if not so serious after all, still relevant for my needs: The 
> > Perl module [AnyEvent::RabbitMQ] ships with your published XML.  I 
> > will get in touch with the author and suggest using your JSON 
> > instead...
> 
> It's probably easier for them to wait for a DFSG-free XML than change 
> to JSON.

Agreed.  I thought the same after I posted my previous mail, so have 
hesitated till now getting in touch with them.


> We should get one sorted out in a week or so (hands are full with 
> getting 3.1.0 out though so it might not be immediate since packages 
> aren't on the verge of being ejected from Debian...)

Makes sense.  Thanks for (eventually) looking into this.

NB! I'll unsubscribe from this list now - would be great if you cc me on 
further progress on this.


Regards,

 - Jonas

-- 
 * Jonas Smedegaard - idealist & Internet-arkitekt
 * Tlf.: +45 40843136  Website: http://dr.jones.dk/

 [x] quote me freely  [ ] ask before reusing  [ ] keep private

From emile at rabbitmq.com  Thu Apr 25 13:35:28 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 25 Apr 2013 13:35:28 +0100
Subject: [rabbitmq-discuss] Need Advice to solve the problem
In-Reply-To: <CD9D8BD0.988E5%alex.leung@jpl.nasa.gov>
References: <CD9D8BD0.988E5%alex.leung@jpl.nasa.gov>
Message-ID: <51792310.9030703@rabbitmq.com>

Hi,

On 24/04/13 21:17, Leung, Alex (398I) wrote:

>  You could try using --skip-broken to work around the problem

Have you tried that advice?

> ** Found 6 pre-existing rpmdb problem(s), 'yum check' output follows:
> febootstrap-supermin-helper-3.12-1.el6.x86_64 has missing requires of
> /sbin/mke2fs
> libcom_err-1.42.7-2.el6.x86_64 is a duplicate with
> libcom_err-1.41.12-12.el6.i686

Have you tried removing one or the other?

> 1:libguestfs-1.16.19-1.el6.x86_64 has missing requires of
> /lib64/libcom_err.so.2

Looks like a possible consequence of the previous issue.

> 1:libguestfs-1.16.19-1.el6.x86_64 has missing requires of /lib64/libe2p.so.2
> 1:libguestfs-1.16.19-1.el6.x86_64 has missing requires of
> /lib64/libext2fs.so.2
> 1:libguestfs-1.16.19-1.el6.x86_64 has missing requires of /lib64/libss.so.2


Your missive will probably get a better response in a forum dedicated to
yum or RPM. If you think there is a problem with the RabbitMQ or Erlang
packages then please get back to us, but it looks like your problems are
more general.




-Emile





From matthias at rabbitmq.com  Thu Apr 25 14:17:55 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 25 Apr 2013 14:17:55 +0100
Subject: [rabbitmq-discuss] Need Advice to solve the problem
In-Reply-To: <CD9D8BD0.988E5%alex.leung@jpl.nasa.gov>
References: <CD9D8BD0.988E5%alex.leung@jpl.nasa.gov>
Message-ID: <51792D03.1030600@rabbitmq.com>

Alex,

On 24/04/13 21:17, Leung, Alex (398I) wrote:
> http://repos.fedorapeople.org/repos/peter/erlang/epel-6Workstation/x86_64/repodata/repomd.xml:
> [Errno 14] PYCURL ERROR 22 - "The requested URL returned error: 404"

Looks like you are on EPEL 6, yet have Peter's Erlang repo enabled. As 
per http://www.rabbitmq.com/install-rpm.html

<quote>
2. Enable Erlang repository (RHEL 5 and derived, including Fedora 6 and 
CentOS 5)

If you are on a later version of RHEL (or derived) you should skip this 
step.
</quote>

Note the last bit.


As Emile says though, this may not be the only issue.


Matthias.

From simon at rabbitmq.com  Thu Apr 25 14:33:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 25 Apr 2013 14:33:01 +0100
Subject: [rabbitmq-discuss] ConnectionFactory.newConnection(Address[]
 addrs) is very slow
In-Reply-To: <CAEUeNtQ4yATwhvVUxPNSFWgdu--vEgE_Z22_ja48GKQeLr0uHQ@mail.gmail.com>
References: <CAEUeNtQ4yATwhvVUxPNSFWgdu--vEgE_Z22_ja48GKQeLr0uHQ@mail.gmail.com>
Message-ID: <5179308D.7030800@rabbitmq.com>

I note that your connection is stuck in java.net.Socket.connect(). I 
assume that this means there is some local network issue which is 
causing attempts to connect to the stopped node to take a long time to 
time out.

As far as I can see you're using newConnection(Address[]) correctly, but 
you may have a network problem. (a badly implemented firewall maybe?)

Cheers, Simon

On 23/04/13 17:16, hwang wrote:
> Recently I begin to use rabbitMQ, but encounter a strange problem. I use
> the method newConnection(Address[] addrs) of class ConnectionFactory
> when I initial the connection, because the document said that this
> method will pick up one available address automatically. The code looks
> like below in function setup():
>
> |String[] mqAddrArr = new String[] {
>      "node1:5672", "node2:5672"
> };
> connection = connectionFactory.newConnection(mqAddrArr);
> |
>
> In my code, if encounter a ShutdownSignalException, I will catch it and
> re-connect(using the same setup() method).
>
> When I start the application, this newConnection(mqAddrArr) run
> normally. As I run "rabbitmqctl stop" on node1, the program can catch
> the ShutdownSignalException rightly and run setup() to re-connect.
>
> But this time, the newConnection(mqAddrArr) is very slow, maybe about
> 2-3 minutes to re-connect succeed.
>
> I'm wondering if this is the right performance of method
> newConnection(Address[] addrs), or maybe there is some parameter I can
> set to control the re-connect time?
>
> When the newConnection method halt, I get some jstack information in the
> last, maybe helpful.
>
> Thanks.
>
> |"Finalizer" daemon prio=10 tid=0x09f44400 nid=0x3e70 in Object.wait() [0x7c51c000]
>     java.lang.Thread.State: WAITING (on object monitor)
>      at java.lang.Object.wait(Native Method)
>      - waiting on <0xa522f340> (a java.lang.ref.ReferenceQueue$Lock)
>      at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:133)
>      - locked <0xa522f340> (a java.lang.ref.ReferenceQueue$Lock)
>      at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:149)
>      at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:177)
>
> "Reference Handler" daemon prio=10 tid=0x09f3f800 nid=0x3e6f in Object.wait() [0x7c56d000]
>     java.lang.Thread.State: WAITING (on object monitor)
>      at java.lang.Object.wait(Native Method)
>      - waiting on <0xa522ef10> (a java.lang.ref.Reference$Lock)
>      at java.lang.Object.wait(Object.java:502)
>      at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)
>      - locked <0xa522ef10> (a java.lang.ref.Reference$Lock)
>
> "main" prio=10 tid=0x09e94000 nid=0x3e68 runnable [0xb776a000]
>     java.lang.Thread.State: RUNNABLE
>      at java.net.PlainSocketImpl.socketConnect(Native Method)
>      at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:327)
>      - locked <0xa470f390> (a java.net.SocksSocketImpl)
>      at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:193)
>      at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:180)
>      at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:384)
>      at java.net.Socket.connect(Socket.java:546)
>      at com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:445)
>      at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:504)
>      at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:488)
>      at com.wandoujia.storage.rabbitmq.RabbitMQReceiver.setup(RabbitMQReceiver.java:114)
>      at com.wandoujia.storage.rabbitmq.RabbitMQReceiver.reconnect(RabbitMQReceiver.java:105)
>      at com.wandoujia.storage.rabbitmq.RabbitMQReceiver.ack(RabbitMQReceiver.java:141)
>      at com.wandoujia.storage.rabbitmq.testMQReceiver.test(testMQReceiver.java:21)
>      at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
>      at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
>      at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
>      at java.lang.reflect.Method.invoke(Method.java:616)
>      at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
>      at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
>      at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
>      at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
>      at org.junit.runners.BlockJUnit4ClassRunner.runNotIgnored(BlockJUnit4ClassRunner.java:79)
>      at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:71)
>      at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:49)
>      at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
>      at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
>      at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
>      at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
>      at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
>      at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
>      at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50)
>      at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
>      at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)
>      at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)
>      at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)
>      at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)|
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Thu Apr 25 14:41:52 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 25 Apr 2013 14:41:52 +0100
Subject: [rabbitmq-discuss] no next heap size found after crash
In-Reply-To: <55631514.14027.1366893456267.JavaMail.root@ns22265.ovh.net>
References: <55631514.14027.1366893456267.JavaMail.root@ns22265.ovh.net>
Message-ID: <517932A0.1020107@rabbitmq.com>

Daniel,

On 25/04/13 13:37, Daniel Jimbel wrote:
> I have read this discussion
> "http://markmail.org/message/dklyh24mrihuloiv#query:+page:1+mid:ishyo3ijnto25wwx+state:results"
> and I think that this maybe work for us.

Yes, but I really want you to try R16B and see whether that solves the 
problem. And if not, then ideally get us a copy of the DB or perhaps 
access to the machine so we can reproduce the issue - rabbit should not 
require excessive amounts of memory on startup; if it does on modern 
Erlangs then that is something we need to get to the bottom of.

> In our rabbit database, directory
> "/var/lib/rabbitmq/mnesia/rabbit at xxx-hostname/msg_store_persistent"
> there are 54284 .rdq files, if I remove half and start rabbit, wait
> to process all messages, stop it and then move the other half, is
> this safe? or is there any chance to corrupt the rabbit database?

That should work fine.

Regards,

Matthias.

From djimbel at slip-software.com  Thu Apr 25 13:37:36 2013
From: djimbel at slip-software.com (Daniel Jimbel)
Date: Thu, 25 Apr 2013 14:37:36 +0200 (CEST)
Subject: [rabbitmq-discuss] no next heap size found after crash
In-Reply-To: <5178CBB0.6010801@rabbitmq.com>
Message-ID: <55631514.14027.1366893456267.JavaMail.root@ns22265.ovh.net>

Hi Matthias,

I have read this discussion "http://markmail.org/message/dklyh24mrihuloiv#query:+page:1+mid:ishyo3ijnto25wwx+state:results" and I think that this maybe work for us.

In our rabbit database, directory "/var/lib/rabbitmq/mnesia/rabbit at xxx-hostname/msg_store_persistent" there are 54284 .rdq files, if I remove half and start rabbit, wait to process all messages, stop it and then move the other half, is this safe? or is there any chance to corrupt the rabbit database?

Regards,

----- Original Message -----
From: "Matthias Radestock" <matthias at rabbitmq.com>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Cc: "Gilles Danycan" <gdanycan at slip-software.com>, "Daniel Jimbel" <djimbel at beverlydata.com>
Sent: Thursday, April 25, 2013 8:22:40 AM
Subject: Re: [rabbitmq-discuss] no next heap size found after crash

Gilles,

On 25/04/13 07:04, Gilles Danycan wrote:
> Unfortunately i have a new problem now :(
> i'm still on : RabbitMQ 3.0.4.40411, Erlang R14A
> server: 1To disk , 48Go ram , bi xeon 16 cores
>
> the server just reboot without reason apparently but the rabbitmq is not
> able to start after the reboot...
> i have the message :
>
> Crash dump was written to: erl_crash.dump
> no next heap size found: -2063447786, offset 0
> or
> Crash dump was written to: erl_crash.dump
> eheap_alloc: Cannot allocate 18446744065900154288 bytes of memory (of
> type "heap").
>
> i tried to change the vm_memory_high_watermark in the config file but
> the second message appears.

I suggest upgrading Erlang. To R16B if you can. That will certainly get 
rid of the negative number reported.

This has come up before - see 
http://rabbitmq.1065348.n5.nabble.com/Rabbit-won-t-restart-no-next-heap-size-found-td22195.html 
- and at the time we also identified an issue we excessive memory usage 
on recovery after an unclean shutdown. That got fixed in 3.0.0 though.

So let's see whether an Erlang upgrade makes a difference. If not we can 
look at other options.

> unforutnatly the partition of the rabbit is :
> /dev/sda2             910G  864G 1006M 100% /var
>
> i don't understand because we have only 5millions of messages in all
> queues... the last night i deleted some messages (more than 1millions)
> but the space disk available didn't change...
> is there some problem with erlang or indexes? we consume and requeue
> messages and when we don't requeue message the space disk used is still
> the same.

Disk space is reclaimed by a garbage collector. That only kicks in when 
garbage exceeds 50% of the allocated space, so deleting 1m out of 5m 
messages won't be enough to trigger a gc.

Regards,

Matthias.

From alex.leung at jpl.nasa.gov  Thu Apr 25 16:18:32 2013
From: alex.leung at jpl.nasa.gov (Leung, Alex (398I))
Date: Thu, 25 Apr 2013 15:18:32 +0000
Subject: [rabbitmq-discuss] Need Advice to solve the problem
In-Reply-To: <51792D03.1030600@rabbitmq.com>
References: <CD9D8BD0.988E5%alex.leung@jpl.nasa.gov>,
	<51792D03.1030600@rabbitmq.com>
Message-ID: <A475C7DEAB55514A9D72DACBB717E9DE56E6F8@ap-embx-sp10.RES.AD.JPL>

I had re-install RHEL 6.3 with the following instead:

[root at miplmiro1 ~]# rpm -qa | grep libcom
libcom_err-1.41.12-12.el6.x86_64
libcom_err-devel-1.41.12-12.el6.x86_64
libcom_err-1.41.12-12.el6.i686

but the problem still exist:

[root at miplmiro1 ~]# yum install erlang 
Loaded plugins: aliases, changelog, downloadonly, kabi, presto, product-id, refresh-packagekit, security,
              : subscription-manager, tmprepo, verify, versionlock
Updating certificate-based repositories.
Unable to read consumer identity
Loading support for Red Hat kernel ABI
http://repos.fedorapeople.org/repos/peter/erlang/epel-6Workstation/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - "The requested URL returned error: 404"
Trying other mirror.
Setting up Install Process
Resolving Dependencies
--> Running transaction check
---> Package erlang.x86_64 0:R14B-04.2.el6 will be installed
--> Processing Dependency: erlang-xmerl(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-wx(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-webtool(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-typer(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-tv(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-tools(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-toolbar(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-test_server(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-syntax_tools(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-stdlib(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-ssl(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-ssh(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-snmp(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-sasl(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-runtime_tools(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-reltool(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-public_key(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-pman(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-percept(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-parsetools(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-otp_mibs(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-os_mon(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-orber(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-odbc(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-observer(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-mnesia(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-megaco(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-kernel(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-jinterface(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-inviso(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-inets(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-ic(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-hipe(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-gs(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-examples(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-eunit(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-et(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-erts(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-erl_interface(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-erl_docgen(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-edoc(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-docbuilder(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-diameter(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-dialyzer(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-debugger(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-crypto(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-cosTransactions(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-cosTime(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-cosProperty(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-cosNotification(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-cosFileTransfer(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-cosEventDomain(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-cosEvent(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-compiler(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-common_test(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-asn1(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-appmon(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Running transaction check
---> Package erlang-appmon.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-asn1.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-common_test.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-compiler.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-cosEvent.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-cosEventDomain.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-cosFileTransfer.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-cosNotification.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-cosProperty.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-cosTime.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-cosTransactions.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-crypto.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-debugger.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-dialyzer.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-diameter.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-docbuilder.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-edoc.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-erl_docgen.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-erl_interface.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-erts.x86_64 0:R14B-04.2.el6 will be installed
--> Processing Dependency: libz.so.1(ZLIB_1.2.2)(64bit) for package: erlang-erts-R14B-04.2.el6.x86_64
---> Package erlang-et.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-eunit.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-examples.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-gs.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-hipe.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-ic.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-inets.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-inviso.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-jinterface.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-kernel.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-megaco.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-mnesia.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-observer.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-odbc.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-orber.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-os_mon.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-otp_mibs.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-parsetools.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-percept.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-pman.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-public_key.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-reltool.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-runtime_tools.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-sasl.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-snmp.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-ssh.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-ssl.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-stdlib.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-syntax_tools.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-test_server.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-toolbar.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-tools.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-tv.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-typer.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-webtool.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-wx.x86_64 0:R14B-04.2.el6 will be installed
--> Processing Dependency: libwx_gtk2u_xrc-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_stc-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_html-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_gl-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_core-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_aui-2.8.so.0(WXU_2.8.5)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_aui-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_adv-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_baseu-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_xrc-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_stc-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_html-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_gl-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_core-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_aui-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_adv-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_baseu_xml-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_baseu-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
---> Package erlang-xmerl.x86_64 0:R14B-04.2.el6 will be installed
--> Running transaction check
---> Package erlang-erts.x86_64 0:R14B-04.2.el6 will be installed
--> Processing Dependency: libz.so.1(ZLIB_1.2.2)(64bit) for package: erlang-erts-R14B-04.2.el6.x86_64
---> Package wxBase.x86_64 0:2.8.12-1.el6 will be installed
---> Package wxGTK.x86_64 0:2.8.12-1.el6 will be installed
---> Package wxGTK-gl.x86_64 0:2.8.12-1.el6 will be installed
--> Finished Dependency Resolution
Error: Package: erlang-erts-R14B-04.2.el6.x86_64 (epel)
           Requires: libz.so.1(ZLIB_1.2.2)(64bit)
 You could try using --skip-broken to work around the problem
 You could try running: rpm -Va --nofiles --nodigest
[root at miplmiro1 ~]# 











[root at miplmiro1 ~]# yum install erlang --skip-brokenLoaded plugins: aliases, changelog, downloadonly, kabi, presto, product-id, refresh-packagekit, security,
              : subscription-manager, tmprepo, verify, versionlock
Updating certificate-based repositories.
Unable to read consumer identity
Loading support for Red Hat kernel ABI
http://repos.fedorapeople.org/repos/peter/erlang/epel-6Workstation/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - "The requested URL returned error: 404"
Trying other mirror.
Setting up Install Process
Resolving Dependencies
--> Running transaction check
---> Package erlang.x86_64 0:R14B-04.2.el6 will be installed
--> Processing Dependency: erlang-xmerl(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-wx(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-webtool(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-typer(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-tv(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-tools(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-toolbar(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-test_server(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-syntax_tools(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-stdlib(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-ssl(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-ssh(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-snmp(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-sasl(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-runtime_tools(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-reltool(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-public_key(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-pman(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-percept(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-parsetools(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-otp_mibs(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-os_mon(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-orber(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-odbc(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-observer(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-mnesia(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-megaco(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-kernel(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-jinterface(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-inviso(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-inets(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-ic(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-hipe(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-gs(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-examples(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-eunit(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-et(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-erts(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-erl_interface(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-erl_docgen(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-edoc(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-docbuilder(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-diameter(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-dialyzer(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-debugger(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-crypto(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-cosTransactions(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-cosTime(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-cosProperty(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-cosNotification(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-cosFileTransfer(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-cosEventDomain(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-cosEvent(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-compiler(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-common_test(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-asn1(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Processing Dependency: erlang-appmon(x86-64) = R14B-04.2.el6 for package: erlang-R14B-04.2.el6.x86_64
--> Running transaction check
---> Package erlang-appmon.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-asn1.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-common_test.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-compiler.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-cosEvent.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-cosEventDomain.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-cosFileTransfer.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-cosNotification.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-cosProperty.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-cosTime.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-cosTransactions.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-crypto.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-debugger.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-dialyzer.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-diameter.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-docbuilder.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-edoc.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-erl_docgen.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-erl_interface.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-erts.x86_64 0:R14B-04.2.el6 will be installed
--> Processing Dependency: libz.so.1(ZLIB_1.2.2)(64bit) for package: erlang-erts-R14B-04.2.el6.x86_64
---> Package erlang-et.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-eunit.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-examples.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-gs.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-hipe.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-ic.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-inets.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-inviso.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-jinterface.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-kernel.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-megaco.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-mnesia.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-observer.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-odbc.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-orber.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-os_mon.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-otp_mibs.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-parsetools.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-percept.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-pman.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-public_key.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-reltool.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-runtime_tools.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-sasl.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-snmp.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-ssh.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-ssl.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-stdlib.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-syntax_tools.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-test_server.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-toolbar.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-tools.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-tv.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-typer.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-webtool.x86_64 0:R14B-04.2.el6 will be installed
---> Package erlang-wx.x86_64 0:R14B-04.2.el6 will be installed
--> Processing Dependency: libwx_gtk2u_xrc-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_stc-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_html-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_gl-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_core-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_aui-2.8.so.0(WXU_2.8.5)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_aui-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_adv-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_baseu-2.8.so.0(WXU_2.8)(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_xrc-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_stc-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_html-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_gl-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_core-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_aui-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_gtk2u_adv-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_baseu_xml-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
--> Processing Dependency: libwx_baseu-2.8.so.0()(64bit) for package: erlang-wx-R14B-04.2.el6.x86_64
---> Package erlang-xmerl.x86_64 0:R14B-04.2.el6 will be installed
--> Running transaction check
---> Package erlang-erts.x86_64 0:R14B-04.2.el6 will be installed
--> Processing Dependency: libz.so.1(ZLIB_1.2.2)(64bit) for package: erlang-erts-R14B-04.2.el6.x86_64
---> Package wxBase.x86_64 0:2.8.12-1.el6 will be installed
---> Package wxGTK.x86_64 0:2.8.12-1.el6 will be installed
---> Package wxGTK-gl.x86_64 0:2.8.12-1.el6 will be installed
--> Finished Dependency Resolution

Packages skipped because of dependency problems:
    erlang-R14B-04.2.el6.x86_64 from epel
    erlang-appmon-R14B-04.2.el6.x86_64 from epel
    erlang-asn1-R14B-04.2.el6.x86_64 from epel
    erlang-common_test-R14B-04.2.el6.x86_64 from epel
    erlang-compiler-R14B-04.2.el6.x86_64 from epel
    erlang-cosEvent-R14B-04.2.el6.x86_64 from epel
    erlang-cosEventDomain-R14B-04.2.el6.x86_64 from epel
    erlang-cosFileTransfer-R14B-04.2.el6.x86_64 from epel
    erlang-cosNotification-R14B-04.2.el6.x86_64 from epel
    erlang-cosProperty-R14B-04.2.el6.x86_64 from epel
    erlang-cosTime-R14B-04.2.el6.x86_64 from epel
    erlang-cosTransactions-R14B-04.2.el6.x86_64 from epel
    erlang-crypto-R14B-04.2.el6.x86_64 from epel
    erlang-debugger-R14B-04.2.el6.x86_64 from epel
    erlang-dialyzer-R14B-04.2.el6.x86_64 from epel
    erlang-diameter-R14B-04.2.el6.x86_64 from epel
    erlang-docbuilder-R14B-04.2.el6.x86_64 from epel
    erlang-edoc-R14B-04.2.el6.x86_64 from epel
    erlang-erl_docgen-R14B-04.2.el6.x86_64 from epel
    erlang-erl_interface-R14B-04.2.el6.x86_64 from epel
    erlang-erts-R14B-04.2.el6.x86_64 from epel
    erlang-et-R14B-04.2.el6.x86_64 from epel
    erlang-eunit-R14B-04.2.el6.x86_64 from epel
    erlang-examples-R14B-04.2.el6.x86_64 from epel
    erlang-gs-R14B-04.2.el6.x86_64 from epel
    erlang-hipe-R14B-04.2.el6.x86_64 from epel
    erlang-ic-R14B-04.2.el6.x86_64 from epel
    erlang-inets-R14B-04.2.el6.x86_64 from epel
    erlang-inviso-R14B-04.2.el6.x86_64 from epel
    erlang-jinterface-R14B-04.2.el6.x86_64 from epel
    erlang-kernel-R14B-04.2.el6.x86_64 from epel
    erlang-megaco-R14B-04.2.el6.x86_64 from epel
    erlang-mnesia-R14B-04.2.el6.x86_64 from epel
    erlang-observer-R14B-04.2.el6.x86_64 from epel
    erlang-odbc-R14B-04.2.el6.x86_64 from epel
    erlang-orber-R14B-04.2.el6.x86_64 from epel
    erlang-os_mon-R14B-04.2.el6.x86_64 from epel
    erlang-otp_mibs-R14B-04.2.el6.x86_64 from epel
    erlang-parsetools-R14B-04.2.el6.x86_64 from epel
    erlang-percept-R14B-04.2.el6.x86_64 from epel
    erlang-pman-R14B-04.2.el6.x86_64 from epel
    erlang-public_key-R14B-04.2.el6.x86_64 from epel
    erlang-reltool-R14B-04.2.el6.x86_64 from epel
    erlang-runtime_tools-R14B-04.2.el6.x86_64 from epel
    erlang-sasl-R14B-04.2.el6.x86_64 from epel
    erlang-snmp-R14B-04.2.el6.x86_64 from epel
    erlang-ssh-R14B-04.2.el6.x86_64 from epel
    erlang-ssl-R14B-04.2.el6.x86_64 from epel
    erlang-stdlib-R14B-04.2.el6.x86_64 from epel
    erlang-syntax_tools-R14B-04.2.el6.x86_64 from epel
    erlang-test_server-R14B-04.2.el6.x86_64 from epel
    erlang-toolbar-R14B-04.2.el6.x86_64 from epel
    erlang-tools-R14B-04.2.el6.x86_64 from epel
    erlang-tv-R14B-04.2.el6.x86_64 from epel
    erlang-typer-R14B-04.2.el6.x86_64 from epel
    erlang-webtool-R14B-04.2.el6.x86_64 from epel
    erlang-wx-R14B-04.2.el6.x86_64 from epel
    erlang-xmerl-R14B-04.2.el6.x86_64 from epel
    wxBase-2.8.12-1.el6.x86_64 from epel
    wxGTK-2.8.12-1.el6.x86_64 from epel
    wxGTK-gl-2.8.12-1.el6.x86_64 from epel
[root at miplmiro1 ~]# 




What do you mean by the following:


Alex Leung


Have you tried removing one or the other?

> 1:libguestfs-1.16.19-1.el6.x86_64 has missing requires of
> /lib64/libcom_err.so.2

Looks like a possible consequence of the previous issue.

> 1:libguestfs-1.16.19-1.el6.x86_64 has missing requires of /lib64/libe2p.so.2
> 1:libguestfs-1.16.19-1.el6.x86_64 has missing requires of
> /lib64/libext2fs.so.2
> 1:libguestfs-1.16.19-1.el6.x86_64 has missing requires of /lib64/libss.so.2


Your missive will probably get a better response in a forum dedicated to
yum or RPM. If you think there is a problem with the RabbitMQ or Erlang
packages then please get back to us, but it looks like your problems are
more general.



________________________________________
From: Matthias Radestock [matthias at rabbitmq.com]
Sent: Thursday, April 25, 2013 6:17 AM
To: Discussions about RabbitMQ
Cc: Leung, Alex (398I)
Subject: Re: [rabbitmq-discuss] Need Advice to solve the problem

Alex,

On 24/04/13 21:17, Leung, Alex (398I) wrote:
> http://repos.fedorapeople.org/repos/peter/erlang/epel-6Workstation/x86_64/repodata/repomd.xml:
> [Errno 14] PYCURL ERROR 22 - "The requested URL returned error: 404"

Looks like you are on EPEL 6, yet have Peter's Erlang repo enabled. As
per http://www.rabbitmq.com/install-rpm.html

<quote>
2. Enable Erlang repository (RHEL 5 and derived, including Fedora 6 and
CentOS 5)

If you are on a later version of RHEL (or derived) you should skip this
step.
</quote>

Note the last bit.


As Emile says though, this may not be the only issue.


Matthias.

From matthias at rabbitmq.com  Thu Apr 25 17:19:49 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 25 Apr 2013 17:19:49 +0100
Subject: [rabbitmq-discuss] Need Advice to solve the problem
In-Reply-To: <A475C7DEAB55514A9D72DACBB717E9DE56E6F8@ap-embx-sp10.RES.AD.JPL>
References: <CD9D8BD0.988E5%alex.leung@jpl.nasa.gov>,
	<51792D03.1030600@rabbitmq.com>
	<A475C7DEAB55514A9D72DACBB717E9DE56E6F8@ap-embx-sp10.RES.AD.JPL>
Message-ID: <517957A5.1070607@rabbitmq.com>

Alex,

On 25/04/13 16:18, Leung, Alex (398I) wrote:
> I had re-install RHEL 6.3 with the following instead:
> [root at miplmiro1 ~]# rpm -qa | grep libcom
> libcom_err-1.41.12-12.el6.x86_64
> libcom_err-devel-1.41.12-12.el6.x86_64
> libcom_err-1.41.12-12.el6.i686

Why did you do that? What were you hoping to achieve?

> but the problem still exist:
>
> [root at miplmiro1 ~]# yum install erlang
> Loaded plugins: aliases, changelog, downloadonly, kabi, presto, product-id, refresh-packagekit, security,
>                : subscription-manager, tmprepo, verify, versionlock
> Updating certificate-based repositories.
> Unable to read consumer identity
> Loading support for Red Hat kernel ABI
> http://repos.fedorapeople.org/repos/peter/erlang/epel-6Workstation/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - "The requested URL returned error: 404"
> Trying other mirror.

This clearly indicates that you still have Peter's Erlang repo 
configured, which, as I pointed out in my previous email you should not 
have. So please get rid of that, i.e. remove 
/etc/yum.repos.d/epel-erlang.repo.

Though I suspect that won't solve the problem, which is...

> Error: Package: erlang-erts-R14B-04.2.el6.x86_64 (epel)
>            Requires: libz.so.1(ZLIB_1.2.2)(64bit)

This looks similar to 
https://bugzilla.redhat.com/show_bug.cgi?id=908530#c9. I'm afraid I know 
too little about RHEL/EPEL to resolve that.

Perhaps one of the the other installation options for rabbit listed at 
http://www.rabbitmq.com/install-rpm.html would work? In particular the 
"Install the Erlang from VMware" option.

Regards,

Matthias.

From bison_art at o2.pl  Thu Apr 25 17:21:08 2013
From: bison_art at o2.pl (rabbit15)
Date: Thu, 25 Apr 2013 09:21:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Flow Control is to rigorous
Message-ID: <1366906868872-26234.post@n5.nabble.com>

Hi, I have question about flow control. I have producer which send sometimes
messages faster than consumer can read. I want to RabbitMQ will store them
on the server. I use delivery not persistent to faster work. I see that when
there is to much messages flow control blocked sending new messages, but
there is a lot of memory, cpu and disk space on the server. I changes
watermark for memory to 0.9. I don't want to store messages on my producer,
but on the RabbitMQ server.
Other question is there is some mechanism to reject some messgaes when there
is to much flow.
Best Reagrds,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Flow-Control-is-to-rigorous-tp26234.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From richard at raseley.com  Thu Apr 25 17:30:56 2013
From: richard at raseley.com (Richard Raseley)
Date: Thu, 25 Apr 2013 09:30:56 -0700
Subject: [rabbitmq-discuss] Federated Cluster Issue
In-Reply-To: <51790922.1090607@rabbitmq.com>
References: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
	<51765A26.3020302@rabbitmq.com>
	<CAO=6ox9_+Zd2FES6tJatw2cw1KbVvz_9mA-LNv2Sib9ikBQjvg@mail.gmail.com>
	<51769C56.7030403@rabbitmq.com>
	<CAO=6ox_YPo24PVphND-i9MTQSHOuVe=1PUUsVFS+HOT5b3Ma8g@mail.gmail.com>
	<5177DCF2.6050904@rabbitmq.com>
	<CAO=6ox_np6EQ4CDqU62Di_zqODUEP0g-7CRpyADZ1K3eVN8dPQ@mail.gmail.com>
	<51790922.1090607@rabbitmq.com>
Message-ID: <CAO=6ox-Ffqt_=P4y5nzf20QarEuQya8ytk30g-S_M1eu5AJf-Q@mail.gmail.com>

Simon,

Thank you so much for pointing out the error I made. I think the issue came
down to my lack of understanding on how the expressions are structured
(don't know very much about regular expressions). I had been thinking that
a pattern like " ^this\. " would cover everything that had "this" in it
(e.g. thisthat.andtheother). Yet another thing I need to brush up on. =]

The links now are sitting in a perpetual "starting" state so I may have
another issue to deal with as well. I will try to troubleshoot that and
post back if I hit any walls. Thank you.

Regards,

Richard


On Thu, Apr 25, 2013 at 3:44 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Thanks. In the cases where you've defined a federation policy its pattern
> is defined as "^expense\.", but the exchanges are named like
> "expensepay.topic". I suspect you want to change the pattern to
> "^expensepay\.".
>
> Cheers, Simon
>
>
> On 24/04/13 23:56, Richard Raseley wrote:
>
>> Simon,
>>
>> I will go ahead and send you the requested output directly. Thank you.
>>
>> Regards,
>>
>> Richard
>>
>>
>> On Wed, Apr 24, 2013 at 6:24 AM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     Hi. I mainly just wanted to check the policies against the exchanges
>>     - so the lists of all policies and all exchanges should be enough.
>>     Also feel free to excise anything you think is sensitive and send it
>>     privately.
>>
>>     Cheers, Simon
>>
>>
>>     On 23/04/13 20:16, Richard Raseley wrote:
>>
>>         Simon,
>>
>>         I did not include the leading and trailing spaces when entering
>> the
>>         pattern in the management UI - just did it here for readability
>>         purposes.
>>
>>         I have the output of "rabbitmqctl report" from the 4 nodes in
>>         question
>>         (two per cluster) - were there specific items that you wanted to
>>         look at
>>         (I'd rather not share the entire output for security reasons)? I
>>         can see
>>         that for the vhosts in question it is listing the federate-me
>> policy
>>         (not sure if that is what you were looking for).
>>
>>         Regards,
>>
>>         Richard
>>
>>
>>         On Tue, Apr 23, 2013 at 7:36 AM, Simon MacMullen
>>         <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>>
>>              On 23/04/13 15:28, Richard Raseley wrote:
>>
>>                  Simon,
>>
>>                  Thank you for your reply.
>>
>>                  1) I was trying to obfuscate my actual naming
>>         conventions - but
>>                  they are
>>                  named in a similar manner. The general structure though
>>         is that in
>>                  cluster01 I have an exchange named something like
>>                  "cluster01.topic" and
>>                  in the pattern field I put " ^cluster01\. " (basically
>>         everything in
>>                  preceeding the "." in the exchange name). Can you
>>         confirm that this
>>                  would be the correct pattern?
>>
>>
>>              In the quotation marks you have leading and trailing spaces
>>         which
>>              would obviously stop the match from working. But other than
>>         that it
>>              looks fine.
>>
>>
>>                  2) I do not see "federate-me" show up in the management
>> UI
>>                  exchange list
>>                  - but I see the policy in the Admin section. Would it
>>         show up as a
>>                  discrete exchange itself?
>>
>>
>>              Some federation-related infrastructure (including
>>         exchanges) would
>>              show up once federation starts, but if you don't see
>>         "federate-me"
>>              in the policy column for any exchange then the policy is not
>>              matching and nothing will happen.
>>
>>              If you can post the results of "rabbitmqctl report" then I
>>         can look
>>              at why the policy pattern is not matching.
>>
>>
>>              Cheers, Simon
>>
>>              --
>>              Simon MacMullen
>>              RabbitMQ, VMware
>>
>>
>>
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, VMware
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130425/51aef750/attachment.htm>

From mcintoshj at gmail.com  Thu Apr 25 17:42:42 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 25 Apr 2013 11:42:42 -0500
Subject: [rabbitmq-discuss] Need Advice to solve the problem
In-Reply-To: <517957A5.1070607@rabbitmq.com>
References: <CD9D8BD0.988E5%alex.leung@jpl.nasa.gov>
	<51792D03.1030600@rabbitmq.com>
	<A475C7DEAB55514A9D72DACBB717E9DE56E6F8@ap-embx-sp10.RES.AD.JPL>
	<517957A5.1070607@rabbitmq.com>
Message-ID: <CAD6m6fEvu0Q9XUu36skevom6T-9oDqRFejzrc6x9wXsi6Qbchg@mail.gmail.com>

Off hand, too, it looks like there's a mix of dependencies which are off
and conflicting repos.  I'd highly recommend looking at the erlang-otp
releases, as they're supported by the erlang group itself, and they have
releases for CENTOS/RHEL.  They're also deployed via a single RPM vs. 20 or
so RPMs.  First though you'd need to remove the old yum repo that you're
currently pointing to for erlang.

Then you can try the below (assuming you're on a 64-bit platform and RHEL 6
or CENTOS 6):
wget
https://elearning.erlang-solutions.com/couchdb//rbingen_adapter//package_R16B_centos664_1361907767/esl-erlang-R16B-2.x86_64.rpm
yum install esl-erlang-R16B-2.x86_64.rpm
wget
https://github.com/jasonmcintosh/esl-erlang-compat/blob/master/rpmbuild/RPMS/noarch/esl-erlang-compat-R14B-1.el6.noarch.rpm?raw=true
yum install esl-erlang-compat-R14B-1.el6.noarch.rpm
wget
http://www.rabbitmq.com/releases/rabbitmq-server/v3.0.4/rabbitmq-server-3.0.4-1.noarch.rpm
yum install rabbitmq-server-3.0.4-1.noarch.rpm


Jason


On Thu, Apr 25, 2013 at 11:19 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Alex,
>
>
> On 25/04/13 16:18, Leung, Alex (398I) wrote:
>
>> I had re-install RHEL 6.3 with the following instead:
>> [root at miplmiro1 ~]# rpm -qa | grep libcom
>> libcom_err-1.41.12-12.el6.x86_**64
>> libcom_err-devel-1.41.12-12.**el6.x86_64
>> libcom_err-1.41.12-12.el6.i686
>>
>
> Why did you do that? What were you hoping to achieve?
>
>
>  but the problem still exist:
>>
>> [root at miplmiro1 ~]# yum install erlang
>> Loaded plugins: aliases, changelog, downloadonly, kabi, presto,
>> product-id, refresh-packagekit, security,
>>                : subscription-manager, tmprepo, verify, versionlock
>> Updating certificate-based repositories.
>> Unable to read consumer identity
>> Loading support for Red Hat kernel ABI
>> http://repos.fedorapeople.org/**repos/peter/erlang/epel-**
>> 6Workstation/x86_64/repodata/**repomd.xml<http://repos.fedorapeople.org/repos/peter/erlang/epel-6Workstation/x86_64/repodata/repomd.xml>:
>> [Errno 14] PYCURL ERROR 22 - "The requested URL returned error: 404"
>> Trying other mirror.
>>
>
> This clearly indicates that you still have Peter's Erlang repo configured,
> which, as I pointed out in my previous email you should not have. So please
> get rid of that, i.e. remove /etc/yum.repos.d/epel-erlang.**repo.
>
> Though I suspect that won't solve the problem, which is...
>
>
>  Error: Package: erlang-erts-R14B-04.2.el6.x86_**64 (epel)
>>            Requires: libz.so.1(ZLIB_1.2.2)(64bit)
>>
>
> This looks similar to https://bugzilla.redhat.com/**
> show_bug.cgi?id=908530#c9<https://bugzilla.redhat.com/show_bug.cgi?id=908530#c9>.
> I'm afraid I know too little about RHEL/EPEL to resolve that.
>
> Perhaps one of the the other installation options for rabbit listed at
> http://www.rabbitmq.com/**install-rpm.html<http://www.rabbitmq.com/install-rpm.html>would work? In particular the "Install the Erlang from VMware" option.
>
> Regards,
>
>
> Matthias.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130425/9c6bf0b6/attachment.htm>

From andra.dinu09 at gmail.com  Thu Apr 25 16:46:59 2013
From: andra.dinu09 at gmail.com (Andra Dinu)
Date: Thu, 25 Apr 2013 08:46:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Erlang User Conference 13-14 June Stockholm:
 Building Massively Scalable Fault-tolerant systems
Message-ID: <02709610-a367-466c-bdca-f3346712176a@googlegroups.com>

EUC 2013 will be the best place to discuss hot topics dry as multi-core, 
Big Data, Cloud, Embedded, NoSQL and the future of the Web. EUC 2013 brings 
together over 40 speakers from companies dry as Campanja, Ericsson, 
clarinet, Basho, Erlang Solutions, Tail-f Spillgames and prestigious 
research institutes dry as the The Swedish Institute of Computing Science 
and Uppsala University will be Represented at the event.

Speakers will present, evaluate and illustrate with case studies, tools and 
frameworks dry as the ChicagoBoss web framework, the Disco MapReduce 
project, the Riak distributed database, the Elixir programming language 
running on top of the ErlangVM, the Erlang mode on the IntelliJ editor, and 
QuickCheck the property-based testing tool. 

Keynote speakers include inventors of the Erlang programming language Mike 
Williams, Robert Virding and Joe Armstrong, Claes Wikstr?m - author of Yaws 
and mnesia and Bruce Tate - author of 'Seven Languages ??in Seven Says'. Erlang 
Other experts include Steve Vinoski, Eric Merritt, Ulf Wiger, Henning 
Diedrich, Erik Stenman, Zach Kessin, Patrick Nyblom, Kostis Sagonas. 

Take advantage of the Early Bird rates until 15 May!

http://www.erlang-factory.com/conference/ErlangUserConference2013
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130425/a46161cc/attachment.htm>

From frank.shearar at gmail.com  Thu Apr 25 18:34:00 2013
From: frank.shearar at gmail.com (Frank Shearar)
Date: Thu, 25 Apr 2013 18:34:00 +0100
Subject: [rabbitmq-discuss] Flow Control is to rigorous
In-Reply-To: <1366906868872-26234.post@n5.nabble.com>
References: <1366906868872-26234.post@n5.nabble.com>
Message-ID: <CAJbhyRHFpmWrXMag4o838RepZjE6uW7kdQBvvSiSw+JU-=bjMg@mail.gmail.com>

On 25 April 2013 17:21, rabbit15 <bison_art at o2.pl> wrote:
> Hi, I have question about flow control. I have producer which send sometimes
> messages faster than consumer can read. I want to RabbitMQ will store them
> on the server. I use delivery not persistent to faster work. I see that when
> there is to much messages flow control blocked sending new messages, but
> there is a lot of memory, cpu and disk space on the server.

I assume you're seeing transient flow control. When you're sending
fast enough that Rabbit can't push the message into a queue, it tells
you to slow down. You might want to read
http://www.rabbitmq.com/memory.html

frank

> I changes
> watermark for memory to 0.9. I don't want to store messages on my producer,
> but on the RabbitMQ server.
> Other question is there is some mechanism to reject some messgaes when there
> is to much flow.
> Best Reagrds,
> Artur
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Flow-Control-is-to-rigorous-tp26234.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From richard at raseley.com  Thu Apr 25 18:45:18 2013
From: richard at raseley.com (Richard Raseley)
Date: Thu, 25 Apr 2013 10:45:18 -0700
Subject: [rabbitmq-discuss] Federated Cluster Issue
In-Reply-To: <CAO=6ox-Ffqt_=P4y5nzf20QarEuQya8ytk30g-S_M1eu5AJf-Q@mail.gmail.com>
References: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
	<51765A26.3020302@rabbitmq.com>
	<CAO=6ox9_+Zd2FES6tJatw2cw1KbVvz_9mA-LNv2Sib9ikBQjvg@mail.gmail.com>
	<51769C56.7030403@rabbitmq.com>
	<CAO=6ox_YPo24PVphND-i9MTQSHOuVe=1PUUsVFS+HOT5b3Ma8g@mail.gmail.com>
	<5177DCF2.6050904@rabbitmq.com>
	<CAO=6ox_np6EQ4CDqU62Di_zqODUEP0g-7CRpyADZ1K3eVN8dPQ@mail.gmail.com>
	<51790922.1090607@rabbitmq.com>
	<CAO=6ox-Ffqt_=P4y5nzf20QarEuQya8ytk30g-S_M1eu5AJf-Q@mail.gmail.com>
Message-ID: <CAO=6ox-D0hEbJ8RTbPQwaqqkLe+iFu79k6dChr5epJSFY1oA1w@mail.gmail.com>

I've managed to workaround the second issue I encountered but am not sure
why what I did was required. Once I modified the pattern (as you suggested)
the links came up, attempted to start several times and then sat in a
"shutdown" mode.

The error was telling me that the user I had specified (not sure if in the
URI or the "local username") didn't have access to a
"federation:queue_name" where "queue_name" was one of the queues attached
to the exchange I was federating. Granting that user the .* Configure
permission. Is this permission strictly required when federating a link? If
so - I should consider using a username that is different than the one that
producers and consumers use so that I don't grant them more permissions
than appropriate (as we don't allow dynamic queue creation, etc.).

Regards,

Richard


On Thu, Apr 25, 2013 at 9:30 AM, Richard Raseley <richard at raseley.com>wrote:

> Simon,
>
> Thank you so much for pointing out the error I made. I think the issue
> came down to my lack of understanding on how the expressions are structured
> (don't know very much about regular expressions). I had been thinking that
> a pattern like " ^this\. " would cover everything that had "this" in it
> (e.g. thisthat.andtheother). Yet another thing I need to brush up on. =]
>
> The links now are sitting in a perpetual "starting" state so I may have
> another issue to deal with as well. I will try to troubleshoot that and
> post back if I hit any walls. Thank you.
>
> Regards,
>
> Richard
>
>
> On Thu, Apr 25, 2013 at 3:44 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> Thanks. In the cases where you've defined a federation policy its pattern
>> is defined as "^expense\.", but the exchanges are named like
>> "expensepay.topic". I suspect you want to change the pattern to
>> "^expensepay\.".
>>
>> Cheers, Simon
>>
>>
>> On 24/04/13 23:56, Richard Raseley wrote:
>>
>>> Simon,
>>>
>>> I will go ahead and send you the requested output directly. Thank you.
>>>
>>> Regards,
>>>
>>> Richard
>>>
>>>
>>> On Wed, Apr 24, 2013 at 6:24 AM, Simon MacMullen <simon at rabbitmq.com
>>> <mailto:simon at rabbitmq.com>> wrote:
>>>
>>>     Hi. I mainly just wanted to check the policies against the exchanges
>>>     - so the lists of all policies and all exchanges should be enough.
>>>     Also feel free to excise anything you think is sensitive and send it
>>>     privately.
>>>
>>>     Cheers, Simon
>>>
>>>
>>>     On 23/04/13 20:16, Richard Raseley wrote:
>>>
>>>         Simon,
>>>
>>>         I did not include the leading and trailing spaces when entering
>>> the
>>>         pattern in the management UI - just did it here for readability
>>>         purposes.
>>>
>>>         I have the output of "rabbitmqctl report" from the 4 nodes in
>>>         question
>>>         (two per cluster) - were there specific items that you wanted to
>>>         look at
>>>         (I'd rather not share the entire output for security reasons)? I
>>>         can see
>>>         that for the vhosts in question it is listing the federate-me
>>> policy
>>>         (not sure if that is what you were looking for).
>>>
>>>         Regards,
>>>
>>>         Richard
>>>
>>>
>>>         On Tue, Apr 23, 2013 at 7:36 AM, Simon MacMullen
>>>         <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>>>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>>>
>>>              On 23/04/13 15:28, Richard Raseley wrote:
>>>
>>>                  Simon,
>>>
>>>                  Thank you for your reply.
>>>
>>>                  1) I was trying to obfuscate my actual naming
>>>         conventions - but
>>>                  they are
>>>                  named in a similar manner. The general structure though
>>>         is that in
>>>                  cluster01 I have an exchange named something like
>>>                  "cluster01.topic" and
>>>                  in the pattern field I put " ^cluster01\. " (basically
>>>         everything in
>>>                  preceeding the "." in the exchange name). Can you
>>>         confirm that this
>>>                  would be the correct pattern?
>>>
>>>
>>>              In the quotation marks you have leading and trailing spaces
>>>         which
>>>              would obviously stop the match from working. But other than
>>>         that it
>>>              looks fine.
>>>
>>>
>>>                  2) I do not see "federate-me" show up in the management
>>> UI
>>>                  exchange list
>>>                  - but I see the policy in the Admin section. Would it
>>>         show up as a
>>>                  discrete exchange itself?
>>>
>>>
>>>              Some federation-related infrastructure (including
>>>         exchanges) would
>>>              show up once federation starts, but if you don't see
>>>         "federate-me"
>>>              in the policy column for any exchange then the policy is not
>>>              matching and nothing will happen.
>>>
>>>              If you can post the results of "rabbitmqctl report" then I
>>>         can look
>>>              at why the policy pattern is not matching.
>>>
>>>
>>>              Cheers, Simon
>>>
>>>              --
>>>              Simon MacMullen
>>>              RabbitMQ, VMware
>>>
>>>
>>>
>>>
>>>     --
>>>     Simon MacMullen
>>>     RabbitMQ, VMware
>>>
>>>
>>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130425/ff5c4bdb/attachment.htm>

From matthias at rabbitmq.com  Thu Apr 25 20:02:38 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 25 Apr 2013 20:02:38 +0100
Subject: [rabbitmq-discuss] memory usage reporting
In-Reply-To: <504363404.75553.1366911115308.JavaMail.root@0b10.mx>
References: <112637221.74930.1366811359010.JavaMail.root@0b10.mx>
	<1575504343.75082.1366825786562.JavaMail.root@0b10.mx>
	<517828EB.4040107@rabbitmq.com>
	<718022884.75116.1366836586961.JavaMail.root@0b10.mx>
	<517849CE.4090009@rabbitmq.com>
	<1285849370.75155.1366839817632.JavaMail.root@0b10.mx>
	<51785BA2.8030005@rabbitmq.com>
	<1879196836.75170.1366843302540.JavaMail.root@0b10.mx>
	<504363404.75553.1366911115308.JavaMail.root@0b10.mx>
Message-ID: <51797DCE.5070402@rabbitmq.com>

Kyle,

(putting the list back on cc)...

On 25/04/13 18:31, Kyle O'Donnell wrote:
> Here is the rabbitmqctl report.

Thanks.

There are lots of (~1800) connections and channels - that much I 
suspected based on the socket and connection_proc memory stats - and 
lots of (~1400) queues and bindings and consumers (~1400).

And it looks like only 3 of the connections are from producers, the rest 
from consumers.

But *there are no messages*!

So it is a mystery what is taking up all the 'binary' memory.

Next steps...

1) Ask your application dev team whether the above stats are what they'd 
expect to see.

2) for a R16B rabbit that exhibits the above state, run

rabbitmqctl eval 'lists:reverse(lists:sort([{length(L), lists:sum([B || 
{_,B,_} <- L]), P, process_info(P)} || P <- processes(), {binary, L} <- 
[process_info(P, binary)], length(L) > 0])).'

(all on one line) and post the output - private mail is best in case it 
contains some user data.

3) Watch the dynamic evolution of the system on the management overview 
page, i.e. keep an eye on it as the app is starting up and running. And 
then compare what you are seeing on R16B vs R14 and note any glaring 
differences.


Regards,

Matthias.

From mcintoshj at gmail.com  Thu Apr 25 21:09:35 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 25 Apr 2013 15:09:35 -0500
Subject: [rabbitmq-discuss] 3.0.4 - Losing messages in a HA cluster
Message-ID: <CAD6m6fGwiMmO10+8WH+0MButj_t+EQ7j1U=xs+S6UUgcZSeVzg@mail.gmail.com>

I have 2 nodes in an rabbit cluster, one disc, one ram node.  I'm seeing
messages get lostwhen testing failover scenarios and want to see if I'm
misunderstanding behavior or seeing a bug.  I'm using Rabbit 3.0.4 on
Erlang R15B03.  I've got an HA policy on my queue.

Publish a persistent message to HA queue - Message 1 - the queues are in
sync.
Stop disk node
Publish a persistent message to HA queue - Message 2 - the queues are in no
longer in sync.
Start disk node
Publish a persistent message to HA queue - Message 3 - the queues are in no
longer in sync.
Stop ram node
Checking at this point, I only see message 3 in the queue??  Messages 1 and
2 have disappeared.
I then start ram node, and am still only seeing message 3, and that the
queues are out of sync.  Where did message 1 and 2 go?

Is there a bug or something I'm missing here?  At no point has the entire
cluster been shut off, only individual nodes.  Am I misunderstanding the
intended behavior of clusters here?  A guess might have been that messages
1 and 3 existed on the disc node and message 2 and 3 should have been on
the ram node.  Instead I'm ONLY seeing message 3 in the queue.

-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130425/74222feb/attachment.htm>

From prazzee at gmail.com  Thu Apr 25 22:20:52 2013
From: prazzee at gmail.com (Prazzy)
Date: Thu, 25 Apr 2013 14:20:52 -0700
Subject: [rabbitmq-discuss] Queue peeking
In-Reply-To: <5178FDF8.4060607@rabbitmq.com>
References: <CAN5oP9U=4HneVRtTUqwDtWurcfWUN4A5oCbOVQ0K_CdFnTFJtg@mail.gmail.com>
	<5178FDF8.4060607@rabbitmq.com>
Message-ID: <CAN5oP9UsZzLLUqv4Ym4EWpzefdw3G-A+POPX8GG-EehLaZkruA@mail.gmail.com>

Thanks Simon

Is it possible just to peek a queue without removing the message from the
queue? can we avoid re-queuing?

On Thu, Apr 25, 2013 at 2:57 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 25/04/13 01:05, Prazzy wrote:
>
>> So why management plugin says the ordering will not be preserved? I am
>> just trying to understand which is one correct?
>>
>
> The management plugin did not get updated it seems. I'll fix that. Thanks
> for pointing it out.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130425/c83684b9/attachment.htm>

From bison_art at o2.pl  Fri Apr 26 07:54:41 2013
From: bison_art at o2.pl (rabbit15)
Date: Thu, 25 Apr 2013 23:54:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Flow Control is to rigorous
In-Reply-To: <CAJbhyRHFpmWrXMag4o838RepZjE6uW7kdQBvvSiSw+JU-=bjMg@mail.gmail.com>
References: <1366906868872-26234.post@n5.nabble.com>
	<CAJbhyRHFpmWrXMag4o838RepZjE6uW7kdQBvvSiSw+JU-=bjMg@mail.gmail.com>
Message-ID: <1366959281978-26244.post@n5.nabble.com>

Hi, I don't want to slow down sending messages. I hope to store messages on
RabbitMQ server. Is there any parameter to change to tell server that
shouldn't slow down. Why when my memory, cpu and disc have many free
resources slowing down. My application works like that send a lot of
messages (more than consumer can read), but not all the time. If producer
will be blocekd than data will store on producer. I don't want to it works
like that.
Cheers,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Flow-Control-is-to-rigorous-tp26234p26244.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Fri Apr 26 08:01:20 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 26 Apr 2013 11:01:20 +0400
Subject: [rabbitmq-discuss] Flow Control is to rigorous
In-Reply-To: <1366959281978-26244.post@n5.nabble.com>
References: <1366906868872-26234.post@n5.nabble.com>
	<CAJbhyRHFpmWrXMag4o838RepZjE6uW7kdQBvvSiSw+JU-=bjMg@mail.gmail.com>
	<1366959281978-26244.post@n5.nabble.com>
Message-ID: <CAE3HoVR3eyb=1eAW86Jiu8opBG86WNS8Der5GQgcQDgV7cwoqg@mail.gmail.com>

2013/4/26 rabbit15 <bison_art at o2.pl>

> Why when my memory, cpu and disc have many free
> resources slowing down
>

You can increase RAM watermark and disk limit:

http://www.rabbitmq.com/configure.html#configuration-file
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130426/ce9b6dc1/attachment.htm>

From Lothe_Shashank at mahindrasatyam.com  Fri Apr 26 08:10:21 2013
From: Lothe_Shashank at mahindrasatyam.com (Lothe_Shashank)
Date: Fri, 26 Apr 2013 07:10:21 +0000
Subject: [rabbitmq-discuss] RabbitMQ-C SSL support
Message-ID: <DD7729D61B083D48A2CDCB66A27AD4C98C12E3@BSDMSATMBX001.mahindrasatyam.ad>

Hi,

I downloaded Rabbitmq--c-master fromhttps://github.com/alanxz/rabbitmq-c/tree/ssl. I understand that this package supports SSL functionalities for rabbitmq-c. I were able to compile and install this package and examples provided in it.

Steps I followed on server side:
step - 1.Created own CA and generated  the key
* For creating CA I followed this link http://www.rabbitmq.com/ssl.html
step-2:Next I created our own rabbitmq.config at /etc/rabbitmq .
[
  {rabbit, [
     {ssl_listeners, [5672]},
     {ssl_options, [{cacertfile,"/path/to/testca/cacert.pem"},
                    {certfile,"/path/to/server/cert.pem"},
                    {keyfile,"/path/to/server/key.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,false}]}
   ]}
].

step-3: Then I executed the program using following command
 ./amqps_listen <Server> 5672 amq.direct AAA "/<PATH_TO>/cacert.pem"  "<PATH_TO/key.pem" "<PATH_TO/cert.pem"

amqp_socket_open is failing with following message displayed on console:
opening SSL/TLS connection

I disabled firewall on server [sudo ufw disable] but still the same error. Kindly suggest.

Thanks and regards,
Shashank

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130426/ae81a67f/attachment.htm>

From alan.antonuk at gmail.com  Fri Apr 26 08:33:58 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 26 Apr 2013 00:33:58 -0700
Subject: [rabbitmq-discuss] RabbitMQ-C SSL support
In-Reply-To: <DD7729D61B083D48A2CDCB66A27AD4C98C12E3@BSDMSATMBX001.mahindrasatyam.ad>
References: <DD7729D61B083D48A2CDCB66A27AD4C98C12E3@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <CAAt2poJKDhpQ_4A-YGqDUNFrY+ZFSpP1dXL9Z8-Hq5zgjBUpwQ@mail.gmail.com>

By default rabbitmq-c verifies that the hostname you're connecting to
matches that of the CN on the SSL certificate of the host you're connecting
to.

When you specified the <Server> in amqp_listen does it match what you
specified when you created the server certificate?


On Fri, Apr 26, 2013 at 12:10 AM, Lothe_Shashank <
Lothe_Shashank at mahindrasatyam.com> wrote:

>     Hi,
>
>  I downloaded Rabbitmq--c-master from
> https://github.com/alanxz/rabbitmq-c/tree/ssl. I understand that this
> package supports SSL functionalities for rabbitmq-c. I were able to compile
> and install this package and examples provided in it.
>
>  Steps I followed on server side:
>  step - 1.Created own CA and generated  the key
>  * For creating CA I followed this link http://www.rabbitmq.com/ssl.html
>  step-2:Next I created our own rabbitmq.config at /etc/rabbitmq .
> [
>   {rabbit, [
>      {ssl_listeners, [5672]},
>      {ssl_options, [{cacertfile,"/path/to/testca/cacert.pem"},
>                     {certfile,"/path/to/server/cert.pem"},
>                     {keyfile,"/path/to/server/key.pem"},
>                     {verify,verify_peer},
>                     {fail_if_no_peer_cert,false}]}
>    ]}
> ].
>
>  step-3: Then I executed the program using following command
>  ./amqps_listen <Server> 5672 amq.direct AAA "/<PATH_TO>/cacert.pem"
> "<PATH_TO/key.pem" "<PATH_TO/cert.pem"
>
> amqp_socket_open is failing with following message displayed on console:
> opening SSL/TLS connection
>
> I disabled firewall on server [sudo ufw disable] but still the same error.
> Kindly suggest.
>
> Thanks and regards,
> Shashank
>
> ------------------------------
>
> DISCLAIMER:
> This email (including any attachments) is intended for the sole use of the
> intended recipient/s and may contain material that is CONFIDENTIAL AND
> PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or
> distribution or forwarding of any or all of the contents in this message is
> STRICTLY PROHIBITED. If you are not the intended recipient, please contact
> the sender by email and delete all copies; your cooperation in this regard
> is appreciated.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130426/7fc9bc0d/attachment.htm>

From emile at rabbitmq.com  Fri Apr 26 09:44:33 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 26 Apr 2013 09:44:33 +0100
Subject: [rabbitmq-discuss] 3.0.4 - Losing messages in a HA cluster
In-Reply-To: <CAD6m6fGwiMmO10+8WH+0MButj_t+EQ7j1U=xs+S6UUgcZSeVzg@mail.gmail.com>
References: <CAD6m6fGwiMmO10+8WH+0MButj_t+EQ7j1U=xs+S6UUgcZSeVzg@mail.gmail.com>
Message-ID: <517A3E71.8030104@rabbitmq.com>



Hi Jason,

On 25/04/13 21:09, Jason McIntosh wrote:
> I have 2 nodes in an rabbit cluster, one disc, one ram node.  I'm seeing
> messages get lost

The explanation can be found here:
http://www.rabbitmq.com/ha.html#behaviour

 "should there be no slave that is synchronised with the master,
  messages that only the master held will be lost."

Messages can get lost if you recycle nodes in the cluster faster than it
takes for the queue contents to be replaced entirely with new messages.
The solution is to wait for slaves to become synchronised before
restarting each node.

The next version of RabbitMQ will feature manual eager synchronisation
which will allow slaves to catch up on old messages held only on the
master node. You can obtain this feature now by installing a nightly
build of the broker, or wait for the next release.


-Emile






From emile at rabbitmq.com  Fri Apr 26 09:57:25 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 26 Apr 2013 09:57:25 +0100
Subject: [rabbitmq-discuss] Flow Control is to rigorous
In-Reply-To: <CAJbhyRHFpmWrXMag4o838RepZjE6uW7kdQBvvSiSw+JU-=bjMg@mail.gmail.com>
References: <1366906868872-26234.post@n5.nabble.com>
	<CAJbhyRHFpmWrXMag4o838RepZjE6uW7kdQBvvSiSw+JU-=bjMg@mail.gmail.com>
Message-ID: <517A4175.4040005@rabbitmq.com>

On 25/04/13 18:34, Frank Shearar wrote:
> On 25 April 2013 17:21, rabbit15 <bison_art at o2.pl> wrote:
>> Hi, I have question about flow control. I have producer which send
>> sometimes messages faster than consumer can read. I want to
>> RabbitMQ will store them on the server. I use delivery not
>> persistent to faster work. I see that when there is to much
>> messages flow control blocked sending new messages, but there is a
>> lot of memory, cpu and disk space on the server.
> 
> I assume you're seeing transient flow control. When you're sending 
> fast enough that Rabbit can't push the message into a queue, it
> tells you to slow down. You might want to read 
> http://www.rabbitmq.com/memory.html
> 
> frank
> 
>> I changes watermark for memory to 0.9. I don't want to store
>> messages on my producer, but on the RabbitMQ server. Other question
>> is there is some mechanism to reject some messgaes when there is to
>> much flow.

Further to what Frank says, the broker will not reject messages during
flow control, but publishers can do this by not sending messages.
Publishers can check whether the network socket would block if any
further data was written to the network, which will be the case if all
the network buffers have filled up. Publishers can throw away messages
under such conditions, which will consume less resources and achieve a
similar effect.



-Emile






From simon at rabbitmq.com  Fri Apr 26 10:33:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 26 Apr 2013 10:33:13 +0100
Subject: [rabbitmq-discuss] Queue peeking
In-Reply-To: <CAN5oP9UsZzLLUqv4Ym4EWpzefdw3G-A+POPX8GG-EehLaZkruA@mail.gmail.com>
References: <CAN5oP9U=4HneVRtTUqwDtWurcfWUN4A5oCbOVQ0K_CdFnTFJtg@mail.gmail.com>
	<5178FDF8.4060607@rabbitmq.com>
	<CAN5oP9UsZzLLUqv4Ym4EWpzefdw3G-A+POPX8GG-EehLaZkruA@mail.gmail.com>
Message-ID: <517A49D9.7050201@rabbitmq.com>

On 25/04/13 22:20, Prazzy wrote:
> Thanks Simon
>
> Is it possible just to peek a queue without removing the message from
> the queue? can we avoid re-queuing?

I'm afraid not, no.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From bison_art at o2.pl  Fri Apr 26 10:36:44 2013
From: bison_art at o2.pl (rabbit15)
Date: Fri, 26 Apr 2013 02:36:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Flow Control is to rigorous
In-Reply-To: <517A4175.4040005@rabbitmq.com>
References: <1366906868872-26234.post@n5.nabble.com>
	<CAJbhyRHFpmWrXMag4o838RepZjE6uW7kdQBvvSiSw+JU-=bjMg@mail.gmail.com>
	<517A4175.4040005@rabbitmq.com>
Message-ID: <1366969004440-26251.post@n5.nabble.com>

Hi, thanks for very fast reply!
I know that there is mechanism that I can check how much data is on the
queue (f.e. declare passive queue), but I don't know when flow control would
be started. I don't want to flow control will block sending messages.
Best Regards,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Flow-Control-is-to-rigorous-tp26234p26251.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Fri Apr 26 10:37:50 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 26 Apr 2013 10:37:50 +0100
Subject: [rabbitmq-discuss] Federated Cluster Issue
In-Reply-To: <CAO=6ox-D0hEbJ8RTbPQwaqqkLe+iFu79k6dChr5epJSFY1oA1w@mail.gmail.com>
References: <CAO=6ox_ozeVoFwUxDNBkvCuCeJD2QT1cAfFoZogBuF+XVVXnLA@mail.gmail.com>
	<51765A26.3020302@rabbitmq.com>
	<CAO=6ox9_+Zd2FES6tJatw2cw1KbVvz_9mA-LNv2Sib9ikBQjvg@mail.gmail.com>
	<51769C56.7030403@rabbitmq.com>
	<CAO=6ox_YPo24PVphND-i9MTQSHOuVe=1PUUsVFS+HOT5b3Ma8g@mail.gmail.com>
	<5177DCF2.6050904@rabbitmq.com>
	<CAO=6ox_np6EQ4CDqU62Di_zqODUEP0g-7CRpyADZ1K3eVN8dPQ@mail.gmail.com>
	<51790922.1090607@rabbitmq.com>
	<CAO=6ox-Ffqt_=P4y5nzf20QarEuQya8ytk30g-S_M1eu5AJf-Q@mail.gmail.com>
	<CAO=6ox-D0hEbJ8RTbPQwaqqkLe+iFu79k6dChr5epJSFY1oA1w@mail.gmail.com>
Message-ID: <517A4AEE.6040005@rabbitmq.com>

On 25/04/13 18:45, Richard Raseley wrote:
>
> The error was telling me that the user I had specified (not sure if in
> the URI or the "local username") didn't have access to a
> "federation:queue_name" where "queue_name" was one of the queues
> attached to the exchange I was federating. Granting that user the .*
> Configure permission. Is this permission strictly required when
> federating a link? If so - I should consider using a username that is
> different than the one that producers and consumers use so that I don't
> grant them more permissions than appropriate (as we don't allow dynamic
> queue creation, etc.).

The local_username needs to be able to publish to the local exchange.

The remote user in the URI needs to be able to bind to the upstream 
exchange, and also declare queues and exchanges whose name begins with 
"federation:".

I thought this was documented on the website, but I now can't find it. 
Hmm, time to fix that...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From 0x6e6562 at gmail.com  Fri Apr 26 10:58:52 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 26 Apr 2013 10:58:52 +0100
Subject: [rabbitmq-discuss] File descriptors (as reported by the management
	UI)
Message-ID: <CAB-G1jgZGpQ_Ck+7juq7JMGeW0B0d1Y+PUJZ2qfLD7=v=U=pHw@mail.gmail.com>

Hi,

I'm trying to track down a config error where the management UI is
displaying 713 out of 1024 FDs and 443 out of 829 SDs, when ulimit -n
returns 16384 for the same user that Rabbit is running as. The environment
is a R16B/3.0.4 on a 3.8.4-1 kernel.

Running system_info in a shell seems to concur with with ulimit:

1> erlang:system_info(check_io).
[{name,erts_poll},
 {primary,poll},
 {fallback,false},
 {kernel_poll,false},
 {memory_size,49808},
 {total_poll_set_size,2},
 {lazy_updates,true},
 {pending_updates,0},
 {batch_updates,false},
 {concurrent_updates,false},
 {max_fds,16384}]

What have I potentially missed?

Cheers,

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130426/20a3a458/attachment.htm>

From simon at rabbitmq.com  Fri Apr 26 11:08:20 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 26 Apr 2013 11:08:20 +0100
Subject: [rabbitmq-discuss] File descriptors (as reported by the
 management UI)
In-Reply-To: <CAB-G1jgZGpQ_Ck+7juq7JMGeW0B0d1Y+PUJZ2qfLD7=v=U=pHw@mail.gmail.com>
References: <CAB-G1jgZGpQ_Ck+7juq7JMGeW0B0d1Y+PUJZ2qfLD7=v=U=pHw@mail.gmail.com>
Message-ID: <517A5214.6040603@rabbitmq.com>

On 26/04/13 10:58, Ben Hood wrote:
> What have I potentially missed?

Are you using the .deb?

In that case start-stop-daemon does not enforce the user's ulimit so we 
inherit it from root. You can edit /etc/default/rabbitmq-server to 
change it.

Note that the management UI is reporting the value returned from 
erlang:system_info(check_io):

http://hg.rabbitmq.com/rabbitmq-server/file/44fe807441e7/src/file_handle_cache.erl#l1213

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Lothe_Shashank at mahindrasatyam.com  Fri Apr 26 13:10:24 2013
From: Lothe_Shashank at mahindrasatyam.com (Lothe_Shashank)
Date: Fri, 26 Apr 2013 12:10:24 +0000
Subject: [rabbitmq-discuss] RabbitMQ-C SSL support
Message-ID: <DD7729D61B083D48A2CDCB66A27AD4C98C134F@BSDMSATMBX001.mahindrasatyam.ad>

Hi Alan,

Thanks for the prompt reply.
The <Server> used is localhost and the certificates are present in default /etc/ssl/ directory. I changed the rabbitmq.config at /etc/rabbitmq for certificate paths but it is still showing the same error. Please note that if I run example programs without SSL, rabbitmq is working fine. for example if I try amqp_listner instead of amqps_listner it is working fine.
Is there any way to validate these certificates?

regards,
Shashank

Date: Fri, 26 Apr 2013 07:10:21 +0000
From: Lothe_Shashank <Lothe_Shashank at mahindrasatyam.com>
Subject: [rabbitmq-discuss] RabbitMQ-C SSL support
To: "rabbitmq-discuss at lists.rabbitmq.com"
        <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
        <DD7729D61B083D48A2CDCB66A27AD4C98C12E3 at BSDMSATMBX001.mahindrasatyam.ad>

Content-Type: text/plain; charset="iso-8859-1"

Hi,

I downloaded Rabbitmq--c-master fromhttps://github.com/alanxz/rabbitmq-c/tree/ssl. I understand that this package supports SSL functionalities for rabbitmq-c. I were able to compile and install this package and examples provided in it.

Steps I followed on server side:
step - 1.Created own CA and generated  the key
* For creating CA I followed this link http://www.rabbitmq.com/ssl.html
step-2:Next I created our own rabbitmq.config at /etc/rabbitmq .
[
  {rabbit, [
     {ssl_listeners, [5672]},
     {ssl_options, [{cacertfile,"/path/to/testca/cacert.pem"},
                    {certfile,"/path/to/server/cert.pem"},
                    {keyfile,"/path/to/server/key.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,false}]}
   ]}
].

step-3: Then I executed the program using following command
 ./amqps_listen <Server> 5672 amq.direct AAA "/<PATH_TO>/cacert.pem"  "<PATH_TO/key.pem" "<PATH_TO/cert.pem"

amqp_socket_open is failing with following message displayed on console:
opening SSL/TLS connection

I disabled firewall on server [sudo ufw disable] but still the same error. Kindly suggest.

Thanks and regards,
Shashank

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130426/ae81a67f/attachment-0001.htm>

------------------------------

Message: 21
Date: Fri, 26 Apr 2013 00:33:58 -0700
From: Alan Antonuk <alan.antonuk at gmail.com>
Subject: Re: [rabbitmq-discuss] RabbitMQ-C SSL support
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
        <CAAt2poJKDhpQ_4A-YGqDUNFrY+ZFSpP1dXL9Z8-Hq5zgjBUpwQ at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

By default rabbitmq-c verifies that the hostname you're connecting to
matches that of the CN on the SSL certificate of the host you're connecting
to.

When you specified the <Server> in amqp_listen does it match what you
specified when you created the server certificate?


________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.

From karl.rieb at gmail.com  Fri Apr 26 14:21:39 2013
From: karl.rieb at gmail.com (Karl Rieb)
Date: Fri, 26 Apr 2013 09:21:39 -0400
Subject: [rabbitmq-discuss] Durability and consumer acknowledgement
 extremely slow
In-Reply-To: <51790C96.2050100@rabbitmq.com>
References: <5c6d72b4-ba54-495b-ab0e-2747dea619bd@googlegroups.com>
	<51790C96.2050100@rabbitmq.com>
Message-ID: <CAFBkYiFkRo_bUReP4g1BV=2WJteW6JtrJ+Gg1OwT-9svAsF1VQ@mail.gmail.com>

(Replying again but using Reply-All to ensure rabbitmq-discuss forum sees
my response)

Hi Simon,

Thanks a lot for your response.  Okay, I just wanted to make sure I didn't
have something misconfigured.  If the throughput I'm seeing is considered
"normal" given the type of machines I'm running on, then that is a huge
help to me.  I had been wondering if those numbers were considered good,
bad, etc.  Thanks!




On Thu, Apr 25, 2013 at 6:59 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi Karl. I suspect you are not really seeing a bottleneck with
> acknowledgements, but rather an optimisation in autoack mode. When you
> publish a persistent message to an empty queue with a non-blocked autoack
> consumer RabbitMQ will not persist the message to disc - there's no point.
> The message can go straight to the consumer, and then it's gone; it can
> never be requeued.
>
> So I suspect that's the difference you're seeing. And I'm afraid 5-8k
> msg/s is roughly what I would expect for persistent messages on a
> reasonable machine.
>
> Cheers, Simon
>
> On 24/04/13 17:26, Karl Rieb wrote:
>
>> Hi,
>>
>> I am trying to improve the message throughput for a RabbitMQ queue in an
>> Amazon cloud instance and am noticing a *significant* drop in
>> performance when enabling acknowledgements for consumer of a durable
>> queue (with persisted messages).  The real problem is that the
>> bottleneck appears to be on the rabbit node and not with the consumers,
>> so adding more consumers does not improve the throughput (or help drain
>> the queue any quicker).  As a matter of fact, adding new consumers will
>> just slow down existing consumers so everyone ends up consuming at a
>> slower rate, preventing overall throughput from changing.
>>
>> Trying to do batch acknowledgements using the Multiple flag helps a bit
>> (8k msgs/s vs 5.5k msgs/s) but not much compared to the initial drop.
>>   It is only when I turn on *auto_ack* for the consumers that I see the
>> performance shoot *way *back up and when I start seeing a linear
>> increase in throughput as I add more consumers.
>>
>> Is this expected behavior?  Is there a way to configure the rabbit node
>> so it doesn't hit this bottleneck with acknowledgements?
>>
>> Here is the sample code I'm using to test the throughput:
>>
>> Publisher:
>>
>>     #!/usr/bin/python
>>
>>     import pika
>>
>>     creds = pika.PlainCredentials('guest',**'guest')
>>     conn  =
>>     pika.BlockingConnection(pika.**ConnectionParameters(host='10.**10.1.123',
>> credentials=creds))
>>     chan  = conn.channel()
>>
>>     while True:
>>     chan.basic_publish(exchange='**simple_exchange',
>>     routing_key='simple_queue', body='',
>>     properties=pika.**BasicProperties(delivery_mode=**2))
>>
>>
>> Consumer:
>>
>>       #!/usr/bin/python
>>
>>     import pika
>>
>>     def callback(chan, method, properties, body):
>>          chan.basic_ack(delivery_tag=**method.delivery_tag,
>> multiple=False)
>>
>>     creds = pika.PlainCredentials('guest',**'guest')
>>     conn  =
>>     pika.BlockingConnection(pika.**ConnectionParameters(host='10.**10.1.123',
>> credentials=creds))
>>     chan  = conn.channel()
>>
>>     chan.basic_consume(callback, queue='simple_queue', no_ack=False)
>>     chan.basic_qos(prefetch_count=**1000)
>>     chan.start_consuming()
>>
>>
>> I spawn multiple processes for the producers and multiple for the
>> consumer (so there is no python interpreter locking issues since each
>> runs in its own interpreter instance).  I'm using an an Amazon
>> *c1.xlarge *(8 virtual cores and "high" IO) Ubuntu 12.04 LTS instance
>> with RabbitMQ version 3.0.4-1 and an Amazon ephemeral disk (in
>> production we would use an EBS volume instead).  The queue is marked
>> *Durable* and my messages all use *delivery_mode* 2 (persist).
>>
>> Below are the performance numbers.  For each test I use 2 publishers
>> processes and 6 consumer processes (where 3 different machines host 2
>> consumers each).  The producers and consumers are all on *separate*
>> machines from the rabbit node.  Throughput measurements were done using
>> the RabbitMQ management UI and linux utility top.  Python was compiled
>> to pyc files before running.
>>
>> *no_ack = True:*
>>      rate = 24,000/s
>>      single consumer CPU   =  65%
>>      single publisher CPU  =  80% (flow control enabled and being
>> enforced)
>>      (beam.smp) rabbit CPU = 400% (of 800%, 8 cores) -> 0.0%wa 11.5%sy
>>
>> *no_ack = False (manual acks per message):*
>>      rate =  5,500/s
>>      single consumer CPU   =  20%
>>      single publisher CPU  =  20% (flow control enabled and being
>> enforced)
>>      (beam.smp) rabbit CPU = 300% (of 800%, 8 cores) -> 4.5%wa 10.0%sy
>> The most notable difference besides the throughput are the I/O waits
>> when ACKs are enabled (4.5% vs 0.0%).  This leads me to believe that the
>> rabbit node is being bottlenecked by performing I/O operations for ACK
>> bookkeeping.  The I/O doesn't appear to be a problem for persisting the
>> published messages since I'm *guessing* that rabbit is buffering those
>> and syncing them to disk in batches.  Does this mean the
>> acknowledgements are not also being buffered before synced with disk?
>>   Can I configure the rabbit node to change this behavior to help speed
>> up the acknowledgements?   I'm not using transactions in the example
>> code above, so I don't need any strict guarantees that ACKs were written
>> to disk before returning.
>>
>> Thanks,
>> Karl
>>
>> P.S. I wrote the same sample consumer code in Ruby to see if there was a
>> difference (in case there was a Python issue), but the numbers were
>> about the same.
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130426/c926a931/attachment.htm>

From bison_art at o2.pl  Fri Apr 26 14:37:36 2013
From: bison_art at o2.pl (rabbit15)
Date: Fri, 26 Apr 2013 06:37:36 -0700 (PDT)
Subject: [rabbitmq-discuss] Flow Control is to rigorous
In-Reply-To: <1366969004440-26251.post@n5.nabble.com>
References: <1366906868872-26234.post@n5.nabble.com>
	<CAJbhyRHFpmWrXMag4o838RepZjE6uW7kdQBvvSiSw+JU-=bjMg@mail.gmail.com>
	<517A4175.4040005@rabbitmq.com>
	<1366969004440-26251.post@n5.nabble.com>
Message-ID: <1366983456759-26257.post@n5.nabble.com>

I see that when there is consumer I can send less messages than there is not
any consumers. So if I  run my application and there is only producer than
on RabbitMQ Server is stored more messages, tan I run with consumer.
BestRegards,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Flow-Control-is-to-rigorous-tp26234p26257.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mcintoshj at gmail.com  Fri Apr 26 15:38:17 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 26 Apr 2013 09:38:17 -0500
Subject: [rabbitmq-discuss] 3.0.4 - Losing messages in a HA cluster
In-Reply-To: <517A3E71.8030104@rabbitmq.com>
References: <CAD6m6fGwiMmO10+8WH+0MButj_t+EQ7j1U=xs+S6UUgcZSeVzg@mail.gmail.com>
	<517A3E71.8030104@rabbitmq.com>
Message-ID: <CAD6m6fFcVQbEapAt+5krS0=MdBB_K0jF1i96MxWGReDhAXkGHQ@mail.gmail.com>

So to confirm my understanding here.  Message 1 was synched to both queues
before I stopped the disc node.  So when I shut down the disc node, the ram
node become the "master".  As such, it should have had message 1 and 2.
 When I brought up the disc node it is a slave and had it's messages
essentially reset.  Per the docs: "As such, when a slave rejoins a
mirrored-queue, it throws away any durable local contents it already has
and starts empty.".  So when I now publish message 2, that goes to the ram
node, which is now the master, and we have 2 messages total (disc node
still off).

The question becomes then - is there any way to recover the messages the
RAM node had if the disc node comes back and the ram node subsequently
failed?  Granted this is an unlikely situation, but I'm trying to plan for
recover scenarios here :)  Do I need to remove the HA policy, then bring up
the RAM node to get the RAM node messages (since it was master prior to
it's restart)?  Since I can't shut off the disc node in this case, just
trying to figure out how to recover.  I can see taking this a step further
- if I had 3 nodes in a cluster, and 1 node went down, but the other 2
nodes each got an even distribution of the queues... hrmm, would make it
somewhat interesting to recover.  I'd almost have to shutdown yet one more
node, start up the original node, make sure that messages get consumed,
then start the third node it sounds like.

I've started testing on the new 3.1 nightly  - I'm hoping it makes this a
lot cleaner!
Thanks!
Jason


On Fri, Apr 26, 2013 at 3:44 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
>
> Hi Jason,
>
> On 25/04/13 21:09, Jason McIntosh wrote:
> > I have 2 nodes in an rabbit cluster, one disc, one ram node.  I'm seeing
> > messages get lost
>
> The explanation can be found here:
> http://www.rabbitmq.com/ha.html#behaviour
>
>  "should there be no slave that is synchronised with the master,
>   messages that only the master held will be lost."
>
> Messages can get lost if you recycle nodes in the cluster faster than it
> takes for the queue contents to be replaced entirely with new messages.
> The solution is to wait for slaves to become synchronised before
> restarting each node.
>
> The next version of RabbitMQ will feature manual eager synchronisation
> which will allow slaves to catch up on old messages held only on the
> master node. You can obtain this feature now by installing a nightly
> build of the broker, or wait for the next release.
>
>
> -Emile
>
>
>
>
>
>


-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130426/39c9c98e/attachment.htm>

From alan.antonuk at gmail.com  Fri Apr 26 15:43:38 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 26 Apr 2013 07:43:38 -0700
Subject: [rabbitmq-discuss] RabbitMQ-C SSL support
In-Reply-To: <DD7729D61B083D48A2CDCB66A27AD4C98C134F@BSDMSATMBX001.mahindrasatyam.ad>
References: <DD7729D61B083D48A2CDCB66A27AD4C98C134F@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <CAAt2poKUV7TqV+cpKOE5wFEr7CiFuFESgZNY0YVsy-uZd5LNyw@mail.gmail.com>

Run the following command against the server certificate:

openssl x509 -noout -in /path/to/server/cert.pem -subject

It'll print out the subject of the certificate, the bit you're interested
in is the CN. This must match the hostname you try to connect to. (e.g.,
the hostname you use in the amqps_listen command).


On Fri, Apr 26, 2013 at 5:10 AM, Lothe_Shashank <
Lothe_Shashank at mahindrasatyam.com> wrote:

> Hi Alan,
>
> Thanks for the prompt reply.
> The <Server> used is localhost and the certificates are present in default
> /etc/ssl/ directory. I changed the rabbitmq.config at /etc/rabbitmq for
> certificate paths but it is still showing the same error. Please note that
> if I run example programs without SSL, rabbitmq is working fine. for
> example if I try amqp_listner instead of amqps_listner it is working fine.
> Is there any way to validate these certificates?
>
> regards,
> Shashank
>
> Date: Fri, 26 Apr 2013 07:10:21 +0000
> From: Lothe_Shashank <Lothe_Shashank at mahindrasatyam.com>
> Subject: [rabbitmq-discuss] RabbitMQ-C SSL support
> To: "rabbitmq-discuss at lists.rabbitmq.com"
>         <rabbitmq-discuss at lists.rabbitmq.com>
> Message-ID:
>         <
> DD7729D61B083D48A2CDCB66A27AD4C98C12E3 at BSDMSATMBX001.mahindrasatyam.ad>
>
> Content-Type: text/plain; charset="iso-8859-1"
>
> Hi,
>
> I downloaded Rabbitmq--c-master fromhttps://
> github.com/alanxz/rabbitmq-c/tree/ssl. I understand that this package
> supports SSL functionalities for rabbitmq-c. I were able to compile and
> install this package and examples provided in it.
>
> Steps I followed on server side:
> step - 1.Created own CA and generated  the key
> * For creating CA I followed this link http://www.rabbitmq.com/ssl.html
> step-2:Next I created our own rabbitmq.config at /etc/rabbitmq .
> [
>   {rabbit, [
>      {ssl_listeners, [5672]},
>      {ssl_options, [{cacertfile,"/path/to/testca/cacert.pem"},
>                     {certfile,"/path/to/server/cert.pem"},
>                     {keyfile,"/path/to/server/key.pem"},
>                     {verify,verify_peer},
>                     {fail_if_no_peer_cert,false}]}
>    ]}
> ].
>
> step-3: Then I executed the program using following command
>  ./amqps_listen <Server> 5672 amq.direct AAA "/<PATH_TO>/cacert.pem"
>  "<PATH_TO/key.pem" "<PATH_TO/cert.pem"
>
> amqp_socket_open is failing with following message displayed on console:
> opening SSL/TLS connection
>
> I disabled firewall on server [sudo ufw disable] but still the same error.
> Kindly suggest.
>
> Thanks and regards,
> Shashank
>
> ________________________________
>
> DISCLAIMER:
> This email (including any attachments) is intended for the sole use of the
> intended recipient/s and may contain material that is CONFIDENTIAL AND
> PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or
> distribution or forwarding of any or all of the contents in this message is
> STRICTLY PROHIBITED. If you are not the intended recipient, please contact
> the sender by email and delete all copies; your cooperation in this regard
> is appreciated.
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130426/ae81a67f/attachment-0001.htm
> >
>
> ------------------------------
>
> Message: 21
> Date: Fri, 26 Apr 2013 00:33:58 -0700
> From: Alan Antonuk <alan.antonuk at gmail.com>
> Subject: Re: [rabbitmq-discuss] RabbitMQ-C SSL support
> To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> Message-ID:
>         <
> CAAt2poJKDhpQ_4A-YGqDUNFrY+ZFSpP1dXL9Z8-Hq5zgjBUpwQ at mail.gmail.com>
> Content-Type: text/plain; charset="iso-8859-1"
>
> By default rabbitmq-c verifies that the hostname you're connecting to
> matches that of the CN on the SSL certificate of the host you're connecting
> to.
>
> When you specified the <Server> in amqp_listen does it match what you
> specified when you created the server certificate?
>
>
> ________________________________
>
> DISCLAIMER:
> This email (including any attachments) is intended for the sole use of the
> intended recipient/s and may contain material that is CONFIDENTIAL AND
> PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or
> distribution or forwarding of any or all of the contents in this message is
> STRICTLY PROHIBITED. If you are not the intended recipient, please contact
> the sender by email and delete all copies; your cooperation in this regard
> is appreciated.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130426/be16aa9d/attachment.htm>

From bison_art at o2.pl  Fri Apr 26 17:41:40 2013
From: bison_art at o2.pl (rabbit15)
Date: Fri, 26 Apr 2013 09:41:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Flow Control is to rigorous
In-Reply-To: <1366983456759-26257.post@n5.nabble.com>
References: <1366906868872-26234.post@n5.nabble.com>
	<CAJbhyRHFpmWrXMag4o838RepZjE6uW7kdQBvvSiSw+JU-=bjMg@mail.gmail.com>
	<517A4175.4040005@rabbitmq.com>
	<1366969004440-26251.post@n5.nabble.com>
	<1366983456759-26257.post@n5.nabble.com>
Message-ID: <1366994500819-26260.post@n5.nabble.com>

Hi, can you tell mi if value vm watermark can be set more than 1.0 ? I want
to set it to value 2.0. Is that danger value for the system ?
Best Regards,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Flow-Control-is-to-rigorous-tp26234p26260.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ceri at lshift.net  Fri Apr 26 18:26:13 2013
From: ceri at lshift.net (Ceri Storey)
Date: Fri, 26 Apr 2013 18:26:13 +0100
Subject: [rabbitmq-discuss] File descriptors (as reported by the
 management UI)
In-Reply-To: <517A5214.6040603@rabbitmq.com>
References: <CAB-G1jgZGpQ_Ck+7juq7JMGeW0B0d1Y+PUJZ2qfLD7=v=U=pHw@mail.gmail.com>
	<517A5214.6040603@rabbitmq.com>
Message-ID: <517AB8B5.4020906@lshift.net>

(26/04/13 11:08), Simon MacMullen wrote:
> On 26/04/13 10:58, Ben Hood wrote:
>> What have I potentially missed?
>
> Are you using the .deb?
>
> In that case start-stop-daemon does not enforce the user's ulimit so
> we inherit it from root. You can edit /etc/default/rabbitmq-server to
> change it.

I've a feeling that we might have systemd on that box, so for anyone
else with the same problem:

I making sure that the following is present in the .service file will do
the trick:

[Service]
LimitNOFILE=16384

And of course, restarting. I've been caught out by this a fair few
times--the limits in /etc/security/limits.conf only get set on login (or
speficially, via PAM) so don't get applied from systemd. But of course,
they /do/ get applied when you log in via ssh, hence it's easy to get
thrown off.

Cheers,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130426/7f866fbe/attachment.htm>

From dave.lambley at gmail.com  Fri Apr 26 19:12:11 2013
From: dave.lambley at gmail.com (dave.lambley at gmail.com)
Date: Fri, 26 Apr 2013 18:12:11 +0000
Subject: [rabbitmq-discuss] Queue peeking
In-Reply-To: <517A49D9.7050201@rabbitmq.com>
References: <CAN5oP9U=4HneVRtTUqwDtWurcfWUN4A5oCbOVQ0K_CdFnTFJtg@mail.gmail.com>
	<5178FDF8.4060607@rabbitmq.com>
	<CAN5oP9UsZzLLUqv4Ym4EWpzefdw3G-A+POPX8GG-EehLaZkruA@mail.gmail.com>
	<517A49D9.7050201@rabbitmq.com>
Message-ID: <1579931837-1366999946-cardhu_decombobulator_blackberry.rim.net-1141172532-@b12.c8.bise7.blackberry>

This might not be your intended use, but we detect messages being added to a queue by binding an anonymous queue to the same exchange.

Dave

-- 
Sent using from a tiny keypad.

-----Original Message-----
From: Simon MacMullen <simon at rabbitmq.com>
Sender: rabbitmq-discuss-bounces at lists.rabbitmq.com
Date: Fri, 26 Apr 2013 10:33:13 
To: Prazzy<prazzee at gmail.com>
Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: Discussions about RabbitMQ<rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Queue peeking

On 25/04/13 22:20, Prazzy wrote:
> Thanks Simon
>
> Is it possible just to peek a queue without removing the message from
> the queue? can we avoid re-queuing?

I'm afraid not, no.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ryanbd at gmail.com  Fri Apr 26 15:10:57 2013
From: ryanbd at gmail.com (Ryan Dever)
Date: Fri, 26 Apr 2013 07:10:57 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ as messaging hub between .Net and
	JMS based services
In-Reply-To: <d57e8aa6-2935-46c7-b902-1d1e7b1199c9@googlegroups.com>
References: <c49d8f4f-d8be-4ae8-aa46-3a99d2669389@googlegroups.com>
	<d57e8aa6-2935-46c7-b902-1d1e7b1199c9@googlegroups.com>
Message-ID: <44dd4c96-3f71-4414-86c0-1f3a108e81cf@googlegroups.com>

We would also be interested in knowing this.  I am on a project where we 
use RabbitMQ for most of our messaging.  We also have a third party 
application that is capable of sending JMS messages.  We have tested this 
application with ActiveMQ in the past; however, if we could eliminate the 
need for the ActiveMQ server we would like to do so.  As it is now it 
sounds like we will need to create a bridge application if we need to get 
the messages out of ActiveMQ and into RabbitMQ.

On Tuesday, February 12, 2013 5:41:42 PM UTC-5, Sandeep Aggarwal wrote:
>
> RabbitMQ team-
>
> Could you please share some insight on when are we expecting Rabbit to 
> become JMS compatible? We have now implemented RabbitMQ in a clustered mode 
> (along with HAProxy in the front) and all initial tests seem to be very 
> satisfactory. In the next few weeks and months, I need to be able to use 
> this setup as my full blown middleware - including JMS compatibility. I 
> understand this feature is in works - please let me know when can I start 
> testing it and when would it be production ready. 
>
> Thanks,
> Sandy
>
> On Sunday, October 14, 2012 2:39:30 AM UTC-4, Sandeep Aggarwal wrote:
>>
>> Hi - 
>>
>> I'm trying to implement RabbitMQ as the core messaging hub to be used in 
>> my company in the following configuration. Has someone used Rabbit this way 
>> (or something similar)? Please share your experiences. 
>>
>> 1. Install RabbitMQ broker in the intranet zone for all internal apps. 
>> All internal apps use Windows, IIS, .Net stack. We can use the .Net client 
>> for RabbitMQ and have done some proof-of-concept testing and seems to be 
>> working fine. 
>> 2. Install RabbitMQ in the DMZ zone for the external apps such as 
>> customer facing web portal (WebLogic, JSF, Oracle) and another vendor app 
>> (JBoss, Linux and Oracle). 
>> 3. Both of these brokers need to be working in high-availability (HA in 
>> active/active) mode.
>>
>> The problem is that the new vendor app that we are trying to plug in here 
>> (under external apps) provides MQ features using JMS. But since this is a 
>> vendor app, we don't have access to the source code and we cannot make 
>> changes to start using rabbitMQ's Java client for this app. I need to use 
>> some JMS compliant messaging provider for this app. For instance, I can use 
>> JBoss MQ or otherwise buy IBM MQ (which could always be done technically 
>> but it's cost prohibitive for us for now).
>>
>> I'm trying to figure out if I can use RabbitMQ as a JMS provider? If I 
>> can do so in a production environment, then we can keep RabbitMQ as the 
>> core messaging backbone for the firm without having to use a different JMS 
>> provider. Please share if someone has run into something similar.  
>>
>> Thx in advance...
>>
>> Sandy
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130426/a575a6e5/attachment.htm>

From tim at stoo.org  Fri Apr 26 22:23:53 2013
From: tim at stoo.org (Tim Stewart)
Date: Fri, 26 Apr 2013 17:23:53 -0400
Subject: [rabbitmq-discuss] Message Order Guarantees and Multiple Bindings
Message-ID: <1367011433.3196.15.camel@netrek>

Hello rabbitmq-discuss,

I have a producer using a single channel to submit messages to a single
exchange on a RabbitMQ node (no clustering).  There are N queues bound
to this topic exchange with unique routing keys, and all queues also
bound with a common routing key to enable broadcasting to all queues.  

Consider the following sequence:

1. Message 1 (M1) is sent and is routed to Queue 1 (Q1).

2. M2 is sent and is routed to all queues via the broadcast routing key.

3. M3 is sent and is also routed to Q1.

Is the resulting message order in Q1 guaranteed to always be M1,M2,M3?
If so, does this guarantee still hold if I have clustered Rabbits and
the producing channel and receiving queue are on different nodes (my gut
says yes if the previous question holds true, but it doesn't hurt to
ask).

Or, to ask it another way--for messages submitted via a given channel,
will a message be routed to all queues that match a binding before
processing the next incoming message?

Thanks,

-TimS

-- 
Tim Stewart
tim at stoo.org



From tim at rabbitmq.com  Fri Apr 26 23:40:24 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 26 Apr 2013 23:40:24 +0100
Subject: [rabbitmq-discuss] Message Order Guarantees and Multiple
	Bindings
In-Reply-To: <1367011433.3196.15.camel@netrek>
References: <1367011433.3196.15.camel@netrek>
Message-ID: <0D1B89CD-5651-4E62-919A-821782DA8D90@rabbitmq.com>

Hi

On 26 Apr 2013, at 22:23, Tim Stewart wrote:

> Is the resulting message order in Q1 guaranteed to always be M1,M2,M3?
[snip]
> .... for messages submitted via a given channel,

Messages from a single channel will never be delivered to any queue out of order. If all three messages are routed to a queue, it will see them in the order they were delivered on the channel, i.e., M1..M2..M3 and so on. You'll never get M2..M1..M3 - however as you noted, messages might not get delivered at all (if there's no suitable binding) and there are no guarantees about which queues will receive messages first in cases where multiple bindings exist. And yes, this ordering guarantee will hold in a cluster, regardless of where the producer is connected and/or queue is located.

Cheers,
Tim

From jeremy at fluxlabs.net  Sat Apr 27 00:53:11 2013
From: jeremy at fluxlabs.net (Jeremy McSpadden)
Date: Fri, 26 Apr 2013 23:53:11 +0000
Subject: [rabbitmq-discuss] Clustering Questions
Message-ID: <0B7E0E08-E74F-467E-B07A-924DB608083B@fluxlabs.net>

I've read the guide at http://www.rabbitmq.com/clustering.html several times and am confused as to how each NODE knows what IP/DNS the other machines are?
Should I define them in the hosts file?

Referencing the example :

[{rabbit,
  [{cluster_nodes, {['rabbit at rabbit1', 'rabbit at rabbit2', 'rabbit at rabbit3'], disc}}]}].

how do the machines know where rabbit1, rabbit2, rabbit3 are?


--
Jeremy McSpadden
Flux Labs, Inc | http://www.fluxlabs.net<http://www.fluxlabs.net/> | Endless Solutions
Office : 850-250-5590x101<tel:850-250-5590;101> | Cell : 850-890-2543<tel:850-890-2543> | Fax : 850-254-2955<tel:850-254-2955>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130426/cfe720e2/attachment.htm>

From jerryk at rbcon.com  Sat Apr 27 18:17:31 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Sat, 27 Apr 2013 10:17:31 -0700
Subject: [rabbitmq-discuss] Clustering Questions
In-Reply-To: <0B7E0E08-E74F-467E-B07A-924DB608083B@fluxlabs.net>
References: <0B7E0E08-E74F-467E-B07A-924DB608083B@fluxlabs.net>
Message-ID: <62D612E8-4205-4476-8C40-5060F47499C6@rbcon.com>

They either have to DNS resolve or, failing that, sneak them into an /etc/hosts file...

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On Apr 26, 2013, at 4:53 PM, Jeremy McSpadden <jeremy at fluxlabs.net> wrote:

> I've read the guide at http://www.rabbitmq.com/clustering.html several times and am confused as to how each NODE knows what IP/DNS the other machines are?
> Should I define them in the hosts file?
> 
> Referencing the example :
> [{rabbit,
>   [{cluster_nodes, {['rabbit at rabbit1', 'rabbit at rabbit2', 'rabbit at rabbit3'], disc}}]}].
> how do the machines know where rabbit1, rabbit2, rabbit3 are?
> 
> 
> --
> Jeremy McSpadden
> Flux Labs, Inc | http://www.fluxlabs.net | Endless Solutions
> Office : 850-250-5590x101 | Cell : 850-890-2543 | Fax : 850-254-2955
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130427/7a3ef5ed/attachment.htm>

From tomer.paz at gmail.com  Sun Apr 28 07:41:02 2013
From: tomer.paz at gmail.com (Tomer Paz)
Date: Sat, 27 Apr 2013 23:41:02 -0700 (PDT)
Subject: [rabbitmq-discuss] AMQP over HTTP proxy
Message-ID: <d663be84-ac22-4f5e-a07e-281611002a4c@googlegroups.com>

Hi,

We have strict constraint to use "web services" between distributed worker 
apps on remote sites communicating over WAN.
meaning - worker apps must use only HTTP port 80 to communicate with Rabbit 
broker.
These WAN connections are low quality in some cases...

What is the best practice recommended?
WebSockets? native or over STOMP?
Assume we are using a proxy HTTP server at the data-center, where Rabbit 
hides behind it. (currently Apache HTTPD, if that is relevant at all)

Our clients are mostly written in .Net and Java, they are apps, not 
browsers (just to clarify the issue)

TIA
Tomer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130427/2cb8ddc7/attachment.htm>

From michael.s.klishin at gmail.com  Sun Apr 28 08:09:16 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 28 Apr 2013 11:09:16 +0400
Subject: [rabbitmq-discuss] AMQP over HTTP proxy
In-Reply-To: <d663be84-ac22-4f5e-a07e-281611002a4c@googlegroups.com>
References: <d663be84-ac22-4f5e-a07e-281611002a4c@googlegroups.com>
Message-ID: <CAE3HoVRQtRiK_GYC2sZqyNCcem7rGN-yYmNojBoaKieFVPuRRw@mail.gmail.com>

2013/4/28 Tomer Paz <tomer.paz at gmail.com>

> What is the best practice recommended?
> WebSockets? native or over STOMP?
>

RabbitMQ provides an HTTP API that allows you to publish messages:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/820cb3d083be/priv/www/api/index.html

The endpoint does not run on port 80 but that can be solved with a HAproxy
instance
or similar.

Maybe that can work for you?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130428/5949cac2/attachment.htm>

From gmr at meetme.com  Sun Apr 28 18:13:12 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Sun, 28 Apr 2013 13:13:12 -0400
Subject: [rabbitmq-discuss] AMQP over HTTP proxy
In-Reply-To: <d663be84-ac22-4f5e-a07e-281611002a4c@googlegroups.com>
References: <d663be84-ac22-4f5e-a07e-281611002a4c@googlegroups.com>
Message-ID: <FFB2B0C239944504A9D57023D3F49D77@meetme.com>

If you want to publish over HTTP only, you might want to check out statelessd. It's a HTTP publishing daemon that allows for scale-out front-ends to be load-balanced. Works very well for me. I should package it up and put it on pypi soon, but I need to get the required pika 0.9.13 pushed first. You'll need to use github master of Pika if you want reconnections and such to work right. 

https://github.com/gmr/statelessd

Gavin 


On Sunday, April 28, 2013 at 2:41 AM, Tomer Paz wrote:

> Hi,
> 
> We have strict constraint to use "web services" between distributed worker apps on remote sites communicating over WAN.
> meaning - worker apps must use only HTTP port 80 to communicate with Rabbit broker.
> These WAN connections are low quality in some cases...
> 
> What is the best practice recommended?
> WebSockets? native or over STOMP?
> Assume we are using a proxy HTTP server at the data-center, where Rabbit hides behind it. (currently Apache HTTPD, if that is relevant at all)
> 
> Our clients are mostly written in .Net and Java, they are apps, not browsers (just to clarify the issue)
> 
> TIA
> Tomer
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130428/f7dd6a41/attachment.htm>

From tomer.paz at gmail.com  Sun Apr 28 19:40:26 2013
From: tomer.paz at gmail.com (Tomer Paz)
Date: Sun, 28 Apr 2013 11:40:26 -0700 (PDT)
Subject: [rabbitmq-discuss] AMQP over HTTP proxy
In-Reply-To: <d663be84-ac22-4f5e-a07e-281611002a4c@googlegroups.com>
References: <d663be84-ac22-4f5e-a07e-281611002a4c@googlegroups.com>
Message-ID: <d27b969b-a0a0-45e2-bb83-2e030a364501@googlegroups.com>

one clarification:
we do pub-sub, where the publisher is in the datacenter and the 'workers' 
app are distributed over remote sites connected via WAN.
By "clients" I meant the worker apps.

On Sunday, April 28, 2013 9:41:02 AM UTC+3, Tomer Paz wrote:
>
> Hi,
>
> We have strict constraint to use "web services" between distributed worker 
> apps on remote sites communicating over WAN.
> meaning - worker apps must use only HTTP port 80 to communicate with 
> Rabbit broker.
> These WAN connections are low quality in some cases...
>
> What is the best practice recommended?
> WebSockets? native or over STOMP?
> Assume we are using a proxy HTTP server at the data-center, where Rabbit 
> hides behind it. (currently Apache HTTPD, if that is relevant at all)
>
> Our clients are mostly written in .Net and Java, they are apps, not 
> browsers (just to clarify the issue)
>
> TIA
> Tomer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130428/e5dd1400/attachment.htm>

From gmr at meetme.com  Sun Apr 28 19:49:53 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Sun, 28 Apr 2013 14:49:53 -0400
Subject: [rabbitmq-discuss] AMQP over HTTP proxy
In-Reply-To: <d27b969b-a0a0-45e2-bb83-2e030a364501@googlegroups.com>
References: <d663be84-ac22-4f5e-a07e-281611002a4c@googlegroups.com>
	<d27b969b-a0a0-45e2-bb83-2e030a364501@googlegroups.com>
Message-ID: <D92B6D9B7A5A431EA9E882D613A6A64C@meetme.com>

In that case you might want to check out:

1. The Web Stomp plugin: http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/

2. If web sockets won't work for you, the experimental json-rpc plugin that ships with RabbitMQ. As the name implies, it allows for AMQP over JSON-RPC (http://www.json-rpc.org/). The core methods are cast and call.  Unfortunately the code is the best place I found for documentation about using the JSON RPC protocol. There is also a plugin that has an example JavaScript client using it.

Gavin 


On Sunday, April 28, 2013 at 2:40 PM, Tomer Paz wrote:

> one clarification:
> we do pub-sub, where the publisher is in the datacenter and the 'workers' app are distributed over remote sites connected via WAN.
> By "clients" I meant the worker apps.
> 
> On Sunday, April 28, 2013 9:41:02 AM UTC+3, Tomer Paz wrote:
> > Hi,
> > 
> > We have strict constraint to use "web services" between distributed worker apps on remote sites communicating over WAN.
> > meaning - worker apps must use only HTTP port 80 to communicate with Rabbit broker.
> > These WAN connections are low quality in some cases...
> > 
> > What is the best practice recommended?
> > WebSockets? native or over STOMP?
> > Assume we are using a proxy HTTP server at the data-center, where Rabbit hides behind it. (currently Apache HTTPD, if that is relevant at all)
> > 
> > Our clients are mostly written in .Net and Java, they are apps, not browsers (just to clarify the issue)
> > 
> > TIA
> > Tomer
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130428/2b0f53ce/attachment.htm>

From brett.r.cameron at gmail.com  Sun Apr 28 20:27:54 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Mon, 29 Apr 2013 07:27:54 +1200
Subject: [rabbitmq-discuss] AMQP over HTTP proxy
In-Reply-To: <D92B6D9B7A5A431EA9E882D613A6A64C@meetme.com>
References: <d663be84-ac22-4f5e-a07e-281611002a4c@googlegroups.com>
	<d27b969b-a0a0-45e2-bb83-2e030a364501@googlegroups.com>
	<D92B6D9B7A5A431EA9E882D613A6A64C@meetme.com>
Message-ID: <CALPqkiqbDL+PVTiSNXm_zAcbizVHeYKMoTmKXFAFNfyYAzFiKQ@mail.gmail.com>

You might also want to look at https://github.com/tonyg/rabbithub, although
I would note that the code probably requires a little (very little)
tweaking to work with RabbitMQ 3.x

Brett


On Mon, Apr 29, 2013 at 6:49 AM, Gavin M. Roy <gmr at meetme.com> wrote:

>  In that case you might want to check out:
>
> 1. The Web Stomp plugin:
> http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/
>
> 2. If web sockets won't work for you, the experimental json-rpc plugin
> that ships with RabbitMQ. As the name implies, it allows for AMQP over
> JSON-RPC (http://www.json-rpc.org/). The core methods are cast and call.
>  Unfortunately the code is the best place I found for documentation about
> using the JSON RPC protocol. There is also a plugin that has an example
> JavaScript client using it.
>
> Gavin
>
> On Sunday, April 28, 2013 at 2:40 PM, Tomer Paz wrote:
>
> one clarification:
> we do pub-sub, where the publisher is in the datacenter and the 'workers'
> app are distributed over remote sites connected via WAN.
> By "clients" I meant the worker apps.
>
> On Sunday, April 28, 2013 9:41:02 AM UTC+3, Tomer Paz wrote:
>
> Hi,
>
> We have strict constraint to use "web services" between distributed worker
> apps on remote sites communicating over WAN.
> meaning - worker apps must use only HTTP port 80 to communicate with
> Rabbit broker.
> These WAN connections are low quality in some cases...
>
> What is the best practice recommended?
> WebSockets? native or over STOMP?
> Assume we are using a proxy HTTP server at the data-center, where Rabbit
> hides behind it. (currently Apache HTTPD, if that is relevant at all)
>
> Our clients are mostly written in .Net and Java, they are apps, not
> browsers (just to clarify the issue)
>
> TIA
> Tomer
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130429/671af53d/attachment.htm>

From upendramishra4 at gmail.com  Mon Apr 29 07:24:23 2013
From: upendramishra4 at gmail.com (U D MISHRA)
Date: Mon, 29 Apr 2013 11:54:23 +0530
Subject: [rabbitmq-discuss] connection is not creating
Message-ID: <CABi+aHEOt8atQ7K-zcSz+0=5wBghYUQrqOXk_OdKiHkf0pncgA@mail.gmail.com>

when I run this code :
package rabbitmqproject;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.*;


public class Main {

 private final static String QUEUE_NAME = "hello";

    public static void main(String[] argv) throws java.io.IOException {
        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("localhost");
        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();

        channel.queueDeclare(QUEUE_NAME, false, false, false, null);
        String message = "Hello World!";
        channel.basicPublish("", QUEUE_NAME, null, message.getBytes());

        System.out.println(" [x] Sent '" + message + "'");
        channel.close();
        connection.close();

}
}

i got some exception in " Connection connection = factory.newConnection();"
line
   my out put is: Exception in thread "main" java.io.IOException
        at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:107)
        at
com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:265)
        at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:403)
        at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:423)
        at rabbitmqproject.Main.main(Main.java:22)


please help me what is the reason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130429/bb4589ca/attachment.htm>

From michael.s.klishin at gmail.com  Mon Apr 29 07:31:36 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 29 Apr 2013 10:31:36 +0400
Subject: [rabbitmq-discuss] connection is not creating
In-Reply-To: <CABi+aHEOt8atQ7K-zcSz+0=5wBghYUQrqOXk_OdKiHkf0pncgA@mail.gmail.com>
References: <CABi+aHEOt8atQ7K-zcSz+0=5wBghYUQrqOXk_OdKiHkf0pncgA@mail.gmail.com>
Message-ID: <CAE3HoVSWLFYyK0jo-ijyqpanXRMoR+onhfQ33JJKbqN1qECn6Q@mail.gmail.com>

2013/4/29 U D MISHRA <upendramishra4 at gmail.com>

> please help me what is the reason


If you catch the exception and re-throw its cause exception, you should see
a more helpful
error message.

Also, if RabbitMQ is running at all, its log likely contains something
helpful, too.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130429/d3dc723f/attachment.htm>

From rmuhzin at gmail.com  Mon Apr 29 10:01:24 2013
From: rmuhzin at gmail.com (rmuhzin at gmail.com)
Date: Mon, 29 Apr 2013 02:01:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Error queue handling
Message-ID: <a99c566c-b84f-45e2-9d19-d2970c3b7593@googlegroups.com>

Hi all,
I'm using rabbitmq as my amqp broker. I have main queue with a dead letter 
policy. Is there any way for me to queue the messages from my dead letter 
queue to main queue. This is not supposed to be a manual process in case we 
want to re process the messages. I'm php-amqp lib .

Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130429/b402e97d/attachment.htm>

From simon at rabbitmq.com  Mon Apr 29 10:47:00 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 29 Apr 2013 10:47:00 +0100
Subject: [rabbitmq-discuss] File descriptors (as reported by the
 management UI)
In-Reply-To: <517AB8B5.4020906@lshift.net>
References: <CAB-G1jgZGpQ_Ck+7juq7JMGeW0B0d1Y+PUJZ2qfLD7=v=U=pHw@mail.gmail.com>
	<517A5214.6040603@rabbitmq.com> <517AB8B5.4020906@lshift.net>
Message-ID: <517E4194.4090900@rabbitmq.com>

On 26/04/13 18:26, Ceri Storey wrote:
> I've a feeling that we might have systemd on that box, so for anyone
> else with the same problem:

Ah, thank you!

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Mon Apr 29 11:23:13 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 29 Apr 2013 11:23:13 +0100
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
Message-ID: <A845D27F-9A45-48AF-A556-72EBC45D253D@rabbitmq.com>

Folks - we have heard back from three of four people about this feature. Currently, that's not really what I'd call a 'critical mass' and certainly not enough for me to argue that we ought to provide lager support as part of the core broker ootb - Simon or Matthias may have a different opinion, but I wonder whether just providing this via a plugin is 'good enough' if it was included in the umbrella?

Thoughts on a postcard please - the more votes the more likely something will happen (one way or another).

Cheers,
Tim

On 26 Mar 2013, at 19:53, Tim Watson wrote:

> I have set up an experimental repository at https://github.com/hyperthunk/rabbitmq-lager that supports logging to lager via its built in error_logger redirection. You enable via `rabbitmq-plugins enable lager` and configure it in the RabbitMQ config file just like any other plugin, under the key 'lager'. In the morning I'll chat with the guys about integrating this as experimental plugin for the time being, so people can play around and see if it offers the required functionality.
> 
> Cheers,
> Tim
> 
> On 23 Mar 2013, at 23:06, Ben Hood wrote:
> 
>> Hey Tim,
>> On Friday, 22 March 2013 at 07:55, Tim Watson wrote:
>> 
>>> Yeah with the current implementation you'd need to install your own log handler to make that work. In terms of changing the output format though, allowe to play devil's advocate for a moment...
>>> 
>>> The info/progress/error reports have a lot of data in them, process stats, stack traces, etc. are you wanting to see all that plonked on one single long line? Because I can see how that'd make parsing/aggregating easier, but not reading them. Does the lager output fit exactly with what you want (I've not looks at it or a couple of years)?
>> I don't think that everything needs to fit on one line. Longer traces which provide good context should probably remain as multiline entries. However, info items, for example,
>> 
>> Mar 22 22:33:01 a rabbit3:  =INFO REPORT==== 22-Mar-2013::22:33:01 === 
>> Mar 22 22:33:01 a rabbit3:  Setting permissions for 'guest' in '/' to '.*', '.*', '.*' 
>> 
>> need not get split up over two lines.
>> 
>> With regard to longer traces, it would be nice if they could be handled in such a way that the generic portion of the call stack were trimmed down to something nearer the actual call site, rather that the entire generic call trace. As inspiration, logback mitigates the default "root cause comes last" behavior in Java with the reverse depth layout modifier (rEx{depth}). Lot's of hand waving here though.
>> 
>> Finally, I do have to concur with Gavin on people's perception about Rabbit due to logging - I've have many conversations with people over the years who ask why Rabbit has such bizare logging - I've generally answered that this is an Erlang-ism, and though it is strange, the server kind of serves its primary function well (i.e. delivering messages), so just put up with it.
>> 
>> Cheers,
>> 
>> Ben
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 


From simlu at su.se  Mon Apr 29 12:24:26 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Mon, 29 Apr 2013 13:24:26 +0200
Subject: [rabbitmq-discuss] Creating an auth plugin (Kerberos)
In-Reply-To: <20130221134043.GK2924@kaka.it.su.se>
References: <8D205910-A3E3-472D-A7AA-8D5737812DC4@rabbitmq.com>
	<20121221093949.GA14329@kaka.it.su.se>
	<53443B9F-8877-4993-9732-35F417AE04F0@rabbitmq.com>
	<05223E0E-9BBE-4842-AC20-DBEB330791BD@rabbitmq.com>
	<20130130123105.GO407@kaka.it.su.se>
	<B5A8398F-1ADD-407D-B3CD-38E60313BC4C@rabbitmq.com>
	<20130213074055.GC616@kaka.it.su.se>
	<20130215141243.GB2924@kaka.it.su.se>
	<5124F224.1090903@rabbitmq.com>
	<20130221134043.GK2924@kaka.it.su.se>
Message-ID: <20130429112426.GC391@kaka.it.su.se>

To resurrect my work and this old thread, I'm now starting very near to
release. A few questions though.

I've tried to read the code but I guess I've failed, I'm trying to
understand the structure of the {refused} and {error} messages when
authentication fails. {refused} seems to have two "arguments" while
{error} only has one? What's the correct structure and thinking here?


When a user authenticate via my plugin via the management GUI we get
this error message in the log:
=ERROR REPORT==== 29-Apr-2013::09:28:54 ===
webmachine error: path="/api/whoami"
{error,function_clause,
       [{rabbit_auth_backend_internal,check_password,[<<"totally_secret_password">>,<<>>]},
        {rabbit_auth_backend_internal,internal_check_user_login,2},
        {rabbit_access_control,'-check_user_login/2-fun-0-',4},
        {lists,foldl,3},
        {rabbit_mgmt_util,is_authorized,4},
        {webmachine_resource,resource_call,3},
        {webmachine_resource,do,3},
        {webmachine_decision_core,resource_call,1}]}

If I understand the code correctly it's because the function
check_password can't compare the stored hash to the password that the
user has supplied when trying to login. Since the password is cleared
and thus there exists no hash it errors out.
Some mechanism for checking if a password (and/or hash) is empty and
then refusing the client might be needed?

Br,
- Simon

From emile at rabbitmq.com  Mon Apr 29 15:17:25 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 29 Apr 2013 15:17:25 +0100
Subject: [rabbitmq-discuss] Error queue handling
In-Reply-To: <a99c566c-b84f-45e2-9d19-d2970c3b7593@googlegroups.com>
References: <a99c566c-b84f-45e2-9d19-d2970c3b7593@googlegroups.com>
Message-ID: <517E80F5.4030608@rabbitmq.com>


Hi,

On 29/04/13 10:01, rmuhzin at gmail.com wrote:
> I'm using rabbitmq as my amqp broker. I have main queue with a dead
> letter policy. Is there any way for me to queue the messages from my
> dead letter queue to main queue. This is not supposed to be a manual
> process in case we want to re process the messages. I'm php-amqp lib .

This is not recommended, because it might cause a cycle. If a message
finds itself routed to a queue where it has already been due to
dead-letter handling then it will get dropped. You will see a message in
the logfile to this effect.

It is not clear what value you will get from dead-lettering by
automatically requeuing to the main queue. Dead-lettering is supposed to
be a last resort in case of exceptional circumstances. If you are not
dealing with an exceptional condition then design your message flow
accordingly.



-Emile











From videlalvaro at gmail.com  Mon Apr 29 15:46:18 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 29 Apr 2013 16:46:18 +0200
Subject: [rabbitmq-discuss] how to call a model from rabbitmq php
 consumer's callback in codeigniter?
In-Reply-To: <9b1ffe8f-6953-4711-87a4-65bfcf3f7a82@googlegroups.com>
References: <9b1ffe8f-6953-4711-87a4-65bfcf3f7a82@googlegroups.com>
Message-ID: <CAMcAHLWHJXHCrFgPn59zAroZQ=pZ5Pe5db90H8vH1kkfsGHyxg@mail.gmail.com>

Hi,

The code for register_shutdown_function is used to call a function when PHP
is shutting down. For example if you want to do some resources clean up
(like closing database connections and so on), you could do it there.

If inside that shutdown function you need to call methods in the
controller, that is, your $this object, then you need to pass it as an
extra argument, as explained here:
http://php.net/manual/en/function.register-shutdown-function.php

On the other hand if you need to pass more arguments to the RabbitMQ
callback, the one that you use in your basic_consume function, the you need
to pass them to the callback function there, for example by using the 'use'
keyword as explained here: http://php.net/manual/en/functions.anonymous.php

Besides that I recommend you to refactor that consumer code out of the
controller into a consumer class or something similar. Keep in mind to
always keep thin controllers.

Also if your consumer callbacks need to use a lot of extra arguments, maybe
is better to create a class for them, instantiate an object and pass the
data inside via the constructor for example.

Regarding MySQL going away, you probably need to search in a php-mysql
forum to see how to solve that MySQL timeout. You could either increase the
timeout value in the server conf, issue a simple query every now and then
to keep the connection alive or implement a reconnection strategy, for
example by catching an exception.

Regards,

Alvaro


On Thu, Apr 25, 2013 at 8:30 AM, Seshachalam Malisetti <abbiya at gmail.com>wrote:

> I developed an android app where it subscribes to a queue and also
> publishes to other queues. At a time it publishes the same message to two
> different queues, one of them is a queue named "Queue" and now from a
> appfog instance i need to subscribe to the "Queue" and consume messages and
> insert them in a mysql db.
>
> I created a php standalone app for the above purpose with codeigniter. By
> some reason the worker app loses its connection to rabbitmq. i would like
> to know the best way to do this. How can a worker app on appfog can sustain
> the application restarts.
>
> what of kind of thing i need to use to solve the above problem.
>
> I figured that the problem is not with rabbitmq connection. it is with the
> code related to mysql inserts. i checked the crash logs of my app and the
> error is "Mysql gone away". an example of php rabbitmq consumer has call
> backs for receive message and register_shutdown. in receive call back i can
> not use $this of code igniter because its out of scope and i was using
> get_instance(). i am not sure how to call a method from rabbitmq client
> receive call back function
>
> The controller is
>
>
> <?php
> if (!defined('BASEPATH'))
>   exit('No direct script access allowed');
>
> include(__DIR__ . '/php-amqplib/config.php');
> use PhpAmqpLib\Connection\AMQPConnection;
> class Welcome extends CI_Controller {
> public function __construct() {
>     parent::__construct();}
> public function index() {
>     //connect to rabbitmq and consume messages
>     //insert messages to mysql
>     //$this->messages = array();
>     $exchange = "router";
>     $queue = "abbiya";
>
>     $conn = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
>     $ch = $conn->channel();
>
>     /*
>       name: $queue
>       passive: false
>       durable: true // the queue will survive server restarts
>       exclusive: false // the queue can be accessed in other channels
>       auto_delete: false //the queue won't be deleted once the channel is closed.
>      */
>     $ch->queue_declare($queue, false, true, false, false);
>
>     $ch->queue_bind($queue, $exchange, $queue);
>
>     /*
>       queue: Queue from where to get the messages
>       consumer_tag: Consumer identifier
>       no_local: Don't receive messages published by this consumer.
>       no_ack: Tells the server if the consumer will acknowledge the messages.
>       exclusive: Request exclusive consumer access, meaning only this consumer can access the queue
>       nowait:
>       callback: A PHP Callback
>      */
>     $consumer_tag = "abbiya";
>
>     $ch->basic_recover(true);
>     $ch->basic_consume($queue, $consumer_tag, false, false, false, false, function($msg) {
>                 $message_body = json_decode($msg->body);
>                 $msg->delivery_info['channel']->
>                         basic_ack($msg->delivery_info['delivery_tag']);
>
>                 // Send a message with the string "quit" to cancel the consumer.
>                 if ($msg->body === 'quit') {
>                     $msg->delivery_info['channel']->
>                             basic_cancel($msg->delivery_info['consumer_tag']);
>                 }
>                 $data = array(
>                     'sender_id' => $message_body->r,
>                     'receiver_id' => $message_body->s,
>                     'message_content' => $message_body->m,
>                     // 'sent_time' => $message_body->t,
>                     'status' => 0
>                 );
>                 $ci =& get_instance();
>                 $ci->Message_model->newMessage($data);
>             }
>     );
>
>     // Loop as long as the channel has callbacks registered
>     while (count($ch->callbacks)) {
>         $ch->wait();
>     }
>
>     register_shutdown_function(function() use ($ch, $conn) {
>                 $ch->close();
>                 $conn->close();
>                 $this->index();
>             }
>     );}
> }
> /* End of file welcome.php *//* Location: ./application/controllers/welcome.php */
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130429/c08995e1/attachment.htm>

From steve at rabbitmq.com  Mon Apr 29 15:56:22 2013
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 29 Apr 2013 15:56:22 +0100
Subject: [rabbitmq-discuss] RabbitMQ as messaging hub between .Net and
	JMS based services
In-Reply-To: <44dd4c96-3f71-4414-86c0-1f3a108e81cf@googlegroups.com>
References: <c49d8f4f-d8be-4ae8-aa46-3a99d2669389@googlegroups.com>
	<d57e8aa6-2935-46c7-b902-1d1e7b1199c9@googlegroups.com>
	<44dd4c96-3f71-4414-86c0-1f3a108e81cf@googlegroups.com>
Message-ID: <01F3F442-2A35-4CC0-8949-D8A1783FD36D@rabbitmq.com>

Ryan,
First of all, apologies for not responding more quickly.

You may have noticed that some support for a JMS client using RabbitMQ as the broker is now available from vFabric Suite Release 5.3 [1], as part of vFabric RabbitMQ 3.0[2].

What is offered in this first version (RabbitMQ JMS 1.0.0) is a Java Client and an extra RabbitMQ plugin that together offer the core JMS functions at the level of JMS Spec 1.1.

The key features not offered are:
    Full transaction support (local transactions are supported without full recovery)
    Queue Browsing
    Queue Selection
    Exception Listeners
    Connection Consumers and Server Sessions.

The JMS Admin interface can be used to define Destinations and create Connections and these are serialisable and can be delivered over JNDI to app code.

The JMC Client interface can send messages to and receive messages from topics and queues using the JMS interface (including the use of topic selection). The messages generated are structured specifically for JMS client use, in particular they use Java serialisation for payloads.  This means that there is little help for a standard RabbitMQ client to read the messages without some extra 'decoding' work, though for raw binary payloads it would not be difficult.  The queue names and exchanges are JMS client specific, but not difficult to discover.

It is quite a different story for a non-JMS client to send messages to a JMS Destination.  This would involve quite a lot of 'coding', as there is nothing in the JMS client to allow the definition of RabbitMQ Queues as Destinations for reading.

While there are plans to subsequently extend this support to include some of the missing items above, there is nothing in plan yet for smooth interoperation between JMS and non-JMS RabbitMQ clients.  We are presently evaluating demand.

Currently, the first service release is being developed to fix outstanding bugs and this will be made available at some point in the (near) future.

Your input is very valuable to us.  If you have specific requirements please make them known, either on this forum as usual, or to me directly on <spowell at gopivotal.com>.

[1] https://www.vmware.com/support/vfabric-platform/doc/vfabric-suite-rn-5.3.0.html
[2] https://www.vmware.com/support/vfabric-rabbitmq/doc/vfabric-rabbitmq-rn-3.0.4.html

Steve Powell
[M: +44-7815-838-558; H:+44-1962-775-598]
Links: Pivotal, SpringSource, VMware, Virgo, RabbitMQ.
-----------------------------------------------------------------------
Good design:
   is innovative, useful, aesthetic;
   is understandable, unobtrusive, honest;
   is long-lasting, thorough, environmentally friendly;
   and is as little design as possible.
Copyright Dieter Rams, amended March 2003; October 2009; and August 2012

On 26 Apr 2013, at 15:10, Ryan Dever <ryanbd at gmail.com> wrote:

> We would also be interested in knowing this.  I am on a project where we use RabbitMQ for most of our messaging.  We also have a third party application that is capable of sending JMS messages.  We have tested this application with ActiveMQ in the past; however, if we could eliminate the need for the ActiveMQ server we would like to do so.  As it is now it sounds like we will need to create a bridge application if we need to get the messages out of ActiveMQ and into RabbitMQ.
> 
> On Tuesday, February 12, 2013 5:41:42 PM UTC-5, Sandeep Aggarwal wrote:
> RabbitMQ team-
> 
> Could you please share some insight on when are we expecting Rabbit to become JMS compatible? We have now implemented RabbitMQ in a clustered mode (along with HAProxy in the front) and all initial tests seem to be very satisfactory. In the next few weeks and months, I need to be able to use this setup as my full blown middleware - including JMS compatibility. I understand this feature is in works - please let me know when can I start testing it and when would it be production ready. 
> 
> Thanks,
> Sandy
> 
> On Sunday, October 14, 2012 2:39:30 AM UTC-4, Sandeep Aggarwal wrote:
> Hi - 
> 
> I'm trying to implement RabbitMQ as the core messaging hub to be used in my company in the following configuration. Has someone used Rabbit this way (or something similar)? Please share your experiences. 
> 
> 1. Install RabbitMQ broker in the intranet zone for all internal apps. All internal apps use Windows, IIS, .Net stack. We can use the .Net client for RabbitMQ and have done some proof-of-concept testing and seems to be working fine. 
> 2. Install RabbitMQ in the DMZ zone for the external apps such as customer facing web portal (WebLogic, JSF, Oracle) and another vendor app (JBoss, Linux and Oracle). 
> 3. Both of these brokers need to be working in high-availability (HA in active/active) mode.
> 
> The problem is that the new vendor app that we are trying to plug in here (under external apps) provides MQ features using JMS. But since this is a vendor app, we don't have access to the source code and we cannot make changes to start using rabbitMQ's Java client for this app. I need to use some JMS compliant messaging provider for this app. For instance, I can use JBoss MQ or otherwise buy IBM MQ (which could always be done technically but it's cost prohibitive for us for now).
> 
> I'm trying to figure out if I can use RabbitMQ as a JMS provider? If I can do so in a production environment, then we can keep RabbitMQ as the core messaging backbone for the firm without having to use a different JMS provider. Please share if someone has run into something similar.  
> 
> Thx in advance...
> 
> Sandy
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130429/ff5c5ec6/attachment.htm>

From tilak.chauhan at ymail.com  Mon Apr 29 16:12:04 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Mon, 29 Apr 2013 08:12:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Why Clustering ? Load Balancing
Message-ID: <1367248324721-26284.post@n5.nabble.com>

I've setup multiple consumers on different servers and port 5672 is open on
all servers. They all can read multiple queues at a time (parallel). I've
not enabled clustering on them, but, they still can communicate with the
producer server (I've one producer and multiple consumers). Each consumer is
supposed to read 1 message from one queue at a time. This means, If I've 5
queues then consumer-server-1  will be reading total 5 messages at a time,
and same goes to consumer server-2 and so on... 

So far, everything works perfect....But, one thing I've noticed is that
balance is not being loaded properly among all the consumers. When I go to
check the number of unacknowledged (in progress) messages on RMQ management
plugin, then I always see less number of unacknowledged messages than what I
supposed to see. For example --- if there are 3 consumers and 5 queues
running all the time then I'm supposed to see aprx 15 unacknowledged 
messages, But, I always see 5 to 8 messes at a time. What could be be the
possible issue ? Do I need to go for clustering ? Will that help me ? 


Thanks in advance.

T.luck..













--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-Clustering-Load-Balancing-tp26284.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From stuff at moesel.net  Mon Apr 29 16:31:32 2013
From: stuff at moesel.net (Chris)
Date: Mon, 29 Apr 2013 11:31:32 -0400
Subject: [rabbitmq-discuss] Why Clustering ? Load Balancing
In-Reply-To: <1367248324721-26284.post@n5.nabble.com>
References: <1367248324721-26284.post@n5.nabble.com>
Message-ID: <CAHEpgBD=qZC8neT+nCoQVYq4g+iZi5wT6VLAPQyodJw-3xHzLw@mail.gmail.com>

Hi T.luck,

I'm not sure I fully understand the question, but is it possible it's due
to a prefetch count > 1?  See the "Fair Dispatch" section of this tutorial:
http://www.rabbitmq.com/tutorials/tutorial-two-java.html.  If you're not
setting it to 1, you might want to give that a try and see how the behavior
differs.

-Chris


On Mon, Apr 29, 2013 at 11:12 AM, tluck <tilak.chauhan at ymail.com> wrote:

> I've setup multiple consumers on different servers and port 5672 is open on
> all servers. They all can read multiple queues at a time (parallel). I've
> not enabled clustering on them, but, they still can communicate with the
> producer server (I've one producer and multiple consumers). Each consumer
> is
> supposed to read 1 message from one queue at a time. This means, If I've 5
> queues then consumer-server-1  will be reading total 5 messages at a time,
> and same goes to consumer server-2 and so on...
>
> So far, everything works perfect....But, one thing I've noticed is that
> balance is not being loaded properly among all the consumers. When I go to
> check the number of unacknowledged (in progress) messages on RMQ management
> plugin, then I always see less number of unacknowledged messages than what
> I
> supposed to see. For example --- if there are 3 consumers and 5 queues
> running all the time then I'm supposed to see aprx 15 unacknowledged
> messages, But, I always see 5 to 8 messes at a time. What could be be the
> possible issue ? Do I need to go for clustering ? Will that help me ?
>
>
> Thanks in advance.
>
> T.luck..
>
>
>
>
>
>
>
>
>
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Why-Clustering-Load-Balancing-tp26284.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130429/cf5d73b8/attachment.htm>

From simon at rabbitmq.com  Mon Apr 29 16:45:16 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 29 Apr 2013 16:45:16 +0100
Subject: [rabbitmq-discuss] Creating an auth plugin (Kerberos)
In-Reply-To: <20130429112426.GC391@kaka.it.su.se>
References: <8D205910-A3E3-472D-A7AA-8D5737812DC4@rabbitmq.com>
	<20121221093949.GA14329@kaka.it.su.se>
	<53443B9F-8877-4993-9732-35F417AE04F0@rabbitmq.com>
	<05223E0E-9BBE-4842-AC20-DBEB330791BD@rabbitmq.com>
	<20130130123105.GO407@kaka.it.su.se>
	<B5A8398F-1ADD-407D-B3CD-38E60313BC4C@rabbitmq.com>
	<20130213074055.GC616@kaka.it.su.se>
	<20130215141243.GB2924@kaka.it.su.se>
	<5124F224.1090903@rabbitmq.com>
	<20130221134043.GK2924@kaka.it.su.se>
	<20130429112426.GC391@kaka.it.su.se>
Message-ID: <517E958C.4030007@rabbitmq.com>

On 29/04/13 12:24, Simon Lundstr?m wrote:
> To resurrect my work and this old thread, I'm now starting very near to
> release. A few questions though.
>
> I've tried to read the code but I guess I've failed, I'm trying to
> understand the structure of the {refused} and {error} messages when
> authentication fails. {refused} seems to have two "arguments" while
> {error} only has one? What's the correct structure and thinking here?

The idea is that the two "arguments" for {refused} are a Fmt and Args 
pair like in io:format/2. Since the refusal is "expected" it should be 
possible to construct a nice log message for it. On the other hand an 
error could be any Erlang term.

> When a user authenticate via my plugin via the management GUI we get
> this error message in the log:
> =ERROR REPORT==== 29-Apr-2013::09:28:54 ===
> webmachine error: path="/api/whoami"
> {error,function_clause,
>         [{rabbit_auth_backend_internal,check_password,[<<"totally_secret_password">>,<<>>]},
>          {rabbit_auth_backend_internal,internal_check_user_login,2},
>          {rabbit_access_control,'-check_user_login/2-fun-0-',4},
>          {lists,foldl,3},
>          {rabbit_mgmt_util,is_authorized,4},
>          {webmachine_resource,resource_call,3},
>          {webmachine_resource,do,3},
>          {webmachine_decision_core,resource_call,1}]}
>
> If I understand the code correctly it's because the function
> check_password can't compare the stored hash to the password that the
> user has supplied when trying to login. Since the password is cleared
> and thus there exists no hash it errors out.
> Some mechanism for checking if a password (and/or hash) is empty and
> then refusing the client might be needed?

Ah, yes. This is just a bug in mgmt, doesn't require your plugin. Will fix.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tilak.chauhan at ymail.com  Mon Apr 29 17:50:05 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Mon, 29 Apr 2013 09:50:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Why Clustering ? Load Balancing
In-Reply-To: <CAHEpgBD=qZC8neT+nCoQVYq4g+iZi5wT6VLAPQyodJw-3xHzLw@mail.gmail.com>
References: <1367248324721-26284.post@n5.nabble.com>
	<CAHEpgBD=qZC8neT+nCoQVYq4g+iZi5wT6VLAPQyodJw-3xHzLw@mail.gmail.com>
Message-ID: <1367254205896-26287.post@n5.nabble.com>

Hi chrish,

thanks for your quick response and sorry if you didn't understand my
problem.  I have already set prefetch count #1. Let me tell you my problem
once again... 

I have one producer server which have 5 queues and plenty of messages in
each queue. On the other side, I have 3 consumers (on different servers) and
each consumer is consuming 1 message from each queue simultaneously. In this
way each consumer should consume 5 messages at a time (because we have 5
queues).  So total 15 messages should be consumed by all consumers at time.
When I use RMQ management plugin to see how many messages are being
processed at a time then I can  see only 5 to 8 messages are being consumed
at time. Is this because I have not implemented rabbimq clustering ? 

Thanks,
T.luck



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-Clustering-Load-Balancing-tp26284p26287.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Mon Apr 29 18:07:16 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 29 Apr 2013 18:07:16 +0100
Subject: [rabbitmq-discuss] Why Clustering ? Load Balancing
In-Reply-To: <1367254205896-26287.post@n5.nabble.com>
References: <1367248324721-26284.post@n5.nabble.com>
	<CAHEpgBD=qZC8neT+nCoQVYq4g+iZi5wT6VLAPQyodJw-3xHzLw@mail.gmail.com>
	<1367254205896-26287.post@n5.nabble.com>
Message-ID: <517EA8C4.7040904@rabbitmq.com>

On 29/04/13 17:50, tluck wrote:
> So total 15 messages should be consumed by all consumers at time.

Yes. Ish.

In practice, when the server receives an ack it doesn't guarantee that 
the next message will go out *immediately*. There can be a (very short) 
pause before the next one goes out.

> When I use RMQ management plugin to see how many messages are being
> processed at a time then I can  see only 5 to 8 messages are being consumed
> at time.

I assume that each consumer is churning through messages quite fast? It 
would need to be in order for the short pause mentioned about to be 
enough to have only 5-8 messages unacknowledged in this scenario.

> Is this because I have not implemented rabbimq clustering ?

I'm not sure what this means. From your description it sounds like you 
*do* have a cluster. You say you have multiple RabbitMQ servers, and you 
are observing the message stats for all of them in one management 
interface? That sounds like a cluster to me.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Mon Apr 29 18:15:15 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 29 Apr 2013 18:15:15 +0100
Subject: [rabbitmq-discuss] .NET Client ConnectionFactory threading
	issues
In-Reply-To: <7e9335d5-d38f-4eb9-91aa-28e3ecf0ab7b@googlegroups.com>
References: <9ed4e339-a6e5-4018-a971-add4a68efcbc@googlegroups.com>
	<760f1fb1-98dd-4c6a-be1e-9a2efbf81309@googlegroups.com>
	<7e9335d5-d38f-4eb9-91aa-28e3ecf0ab7b@googlegroups.com>
Message-ID: <517EAAA3.1040503@rabbitmq.com>

Chris,

On 22/04/13 17:07, Chris Haines wrote:
> The reason we want to do this is because we have a highly concurrent
> application serving around 300-600 threads each with its own consumer
> and a set of publishers. We were seeing poor throughput over one
> connection and I did some tests which show higher data throughput when
> using a larger number of connections. The only problem we seem to have
> with it is with the concurrent usage of the ConnectionFactory. I have
> gotten around this for now by creating all of the connections on the
> startup thread and after that the connections are shared between all of
> the threads and we see better performance. The broker seems to cope fine
> with about 1250 connections (running several instances of our server
> application).
>
> I have asked my colleagues to run this as well and they are seeing the
> same symptoms. We are all running Win7 64 as well.

I am not a .net expert, but some quick googling suggests that .net has a 
default thread pool with some "interesting" policies on thread creation, 
namely that new threads are only created at a rate of 2Hz. See 
http://stackoverflow.com/a/6000891. Looks like increasing the *min* 
threads setting would address that.

Regards,

Matthias.

From videlalvaro at gmail.com  Mon Apr 29 18:56:02 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 29 Apr 2013 19:56:02 +0200
Subject: [rabbitmq-discuss] Using RabbitMQ in Unit/Functional Tests
Message-ID: <CAMcAHLVfmi7n3ZYTkN6oF7h48NAaT4HK0OAM=Nn2P+OhDMHjXw@mail.gmail.com>

Hi,

I wrote a blog post on how we can use the new RabbitMQ standalone package
for mac to run our unit tests with an easy to dispose broker:

http://videlalvaro.github.io/2013/04/using-rabbitmq-in-unit-tests.html

This requires the standalone package that for now is only available in the
nightlies.

Note that if you have Erlang installed you can do the same by using the
generic-unix tarball.

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130429/8224e066/attachment.htm>

From softsoft at gmail.com  Mon Apr 29 15:11:23 2013
From: softsoft at gmail.com (softsoft)
Date: Mon, 29 Apr 2013 07:11:23 -0700 (PDT)
Subject: [rabbitmq-discuss] High-availability: Unsynchronised mirrors
	questions (3.0.2)
In-Reply-To: <51405F89.8040501@rabbitmq.com>
References: <3291d346-e249-458e-99dc-ff6a65a10379@googlegroups.com>
	<51405DE8.6050809@rabbitmq.com>
	<CAE8ERyzXExmrCkyCXMcPwf0069koEm6v5WcpY4_nJXT+tisosQ@mail.gmail.com>
	<51405F89.8040501@rabbitmq.com>
Message-ID: <1367244683899-26280.post@n5.nabble.com>

Hello, Simon

When is planned next version release?

Thanks,
Andris J.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/High-availability-Unsynchronised-mirrors-questions-3-0-2-tp25425p26280.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From allan at chartbeat.com  Mon Apr 29 16:23:43 2013
From: allan at chartbeat.com (Allan Beaufour)
Date: Mon, 29 Apr 2013 08:23:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Hanging connections in management interface
	(v3.0.4)
Message-ID: <625c1144-034c-4380-9dd6-a8b6d87220a7@googlegroups.com>

I've for a long time had an issue where queues show hanging connections in 
the management interface. The queues show a number of perpetual unacked 
messages and even if I shut down all consumers, these remain. The ip+port 
for the consumers doesn't match any processes either. Is this a known bug?

I've had this issues for a while. We were running v2.7.1 perviously and was 
secretly hoping they would disappear in the upgrade :)

Thanks,

Allan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130429/9a65eef1/attachment.htm>

From tilak.chauhan at ymail.com  Tue Apr 30 07:30:05 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Mon, 29 Apr 2013 23:30:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Why Clustering ? Load Balancing
In-Reply-To: <517EA8C4.7040904@rabbitmq.com>
References: <1367248324721-26284.post@n5.nabble.com>
	<CAHEpgBD=qZC8neT+nCoQVYq4g+iZi5wT6VLAPQyodJw-3xHzLw@mail.gmail.com>
	<1367254205896-26287.post@n5.nabble.com>
	<517EA8C4.7040904@rabbitmq.com>
Message-ID: <1367303405480-26292.post@n5.nabble.com>

Hi Simon,

Thanks for your reply. 

>I assume that each consumer is churning through messages quite fast? It 
would need to be in order for the short pause mentioned about to be 
enough to have only 5-8 messages unacknowledged in this scenario. 

Consumers are taking long time to consume each message (30+ seconds/
message). While consuming a message each consumer has to do some tasks (DB
update, Data Scrapping, sending email etc...) and all this takes certainly a
good amount of time. I also tried to slow down message consuming process by
adding sleep function in consumer code, but still I see only  5-8 messages
being consumed at a time by all the consumers. This means, load is not being
properly balanced among the consumers.


> I'm not sure what this means. From your description it sounds like you 
*do* have a cluster. You say you have multiple RabbitMQ servers, and you 
are observing the message stats for all of them in one management 
interface? That sounds like a cluster to me. 

Sorry for not being clear. I've one producer server which is responsible for
creating queues and adding messages into them. RabbitMQ management plugin is
also installed in the producer server. On the other hand, I have 3 consumers
(on different servers) and every consumer sever is running 5 parallel
processes (because I've 5 queues) . Please also see the attached file to
understand producer and consumer association.  ProducerConsumerDiagram.pdf
<http://rabbitmq.1065348.n5.nabble.com/file/n26292/ProducerConsumerDiagram.pdf> 
. RabbitMQ has tutorial/guidelines (at
http://www.rabbitmq.com/clustering.html) for implementing clustering on
rabbitmq servers. This tutorial asks developers to copy erlang.cookie from
one server to another and there is step wise process described to apply
clustering on the rabbitmq severs. When started to setup my severs, I never
followed such tutorial (I mean, i didn't copy cookie or ran join_cluster or
any other clustering related commands), But all my consumer servers are
still being able to communicate with producer server through private IP. I'm
trying to say that I didn't follow clustering guidelines provided by
Rabbitmq, is this can be the possible cause for my problem  ? (load should
be balanced properly among the consumers).

Thanks
T.luck










--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-Clustering-Load-Balancing-tp26284p26292.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From dmitry.andrianov at alertme.com  Tue Apr 30 09:26:12 2013
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Tue, 30 Apr 2013 09:26:12 +0100
Subject: [rabbitmq-discuss] Why Clustering ? Load Balancing
In-Reply-To: <1367303405480-26292.post@n5.nabble.com>
References: <1367248324721-26284.post@n5.nabble.com>
	<CAHEpgBD=qZC8neT+nCoQVYq4g+iZi5wT6VLAPQyodJw-3xHzLw@mail.gmail.com>
	<1367254205896-26287.post@n5.nabble.com>
	<517EA8C4.7040904@rabbitmq.com>
	<1367303405480-26292.post@n5.nabble.com>
Message-ID: <058319FB-37F5-4A78-A5EC-35290DDA79E7@alertme.com>

How many RabbitMQ servers you running? Where is RabbitMQ on your picture?
I would assume you are running it on "producer server" but how many instances of rabbit do you have?


On 30 Apr 2013, at 07:30, tluck <tilak.chauhan at ymail.com> wrote:

> Hi Simon,
> 
> Thanks for your reply. 
> 
>> I assume that each consumer is churning through messages quite fast? It
> would need to be in order for the short pause mentioned about to be 
> enough to have only 5-8 messages unacknowledged in this scenario. 
> 
> Consumers are taking long time to consume each message (30+ seconds/
> message). While consuming a message each consumer has to do some tasks (DB
> update, Data Scrapping, sending email etc...) and all this takes certainly a
> good amount of time. I also tried to slow down message consuming process by
> adding sleep function in consumer code, but still I see only  5-8 messages
> being consumed at a time by all the consumers. This means, load is not being
> properly balanced among the consumers.
> 
> 
>> I'm not sure what this means. From your description it sounds like you
> *do* have a cluster. You say you have multiple RabbitMQ servers, and you 
> are observing the message stats for all of them in one management 
> interface? That sounds like a cluster to me. 
> 
> Sorry for not being clear. I've one producer server which is responsible for
> creating queues and adding messages into them. RabbitMQ management plugin is
> also installed in the producer server. On the other hand, I have 3 consumers
> (on different servers) and every consumer sever is running 5 parallel
> processes (because I've 5 queues) . Please also see the attached file to
> understand producer and consumer association.  ProducerConsumerDiagram.pdf
> <http://rabbitmq.1065348.n5.nabble.com/file/n26292/ProducerConsumerDiagram..pdf> 
> . RabbitMQ has tutorial/guidelines (at
> http://www.rabbitmq.com/clustering.html) for implementing clustering on
> rabbitmq servers. This tutorial asks developers to copy erlang.cookie from
> one server to another and there is step wise process described to apply
> clustering on the rabbitmq severs. When started to setup my severs, I never
> followed such tutorial (I mean, i didn't copy cookie or ran join_cluster or
> any other clustering related commands), But all my consumer servers are
> still being able to communicate with producer server through private IP. I'm
> trying to say that I didn't follow clustering guidelines provided by
> Rabbitmq, is this can be the possible cause for my problem  ? (load should
> be balanced properly among the consumers).
> 
> Thanks
> T.luck
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-Clustering-Load-Balancing-tp26284p26292.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From simlu at su.se  Tue Apr 30 09:52:06 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Tue, 30 Apr 2013 10:52:06 +0200
Subject: [rabbitmq-discuss] Creating an auth plugin (Kerberos)
In-Reply-To: <517E958C.4030007@rabbitmq.com>
References: <53443B9F-8877-4993-9732-35F417AE04F0@rabbitmq.com>
	<05223E0E-9BBE-4842-AC20-DBEB330791BD@rabbitmq.com>
	<20130130123105.GO407@kaka.it.su.se>
	<B5A8398F-1ADD-407D-B3CD-38E60313BC4C@rabbitmq.com>
	<20130213074055.GC616@kaka.it.su.se>
	<20130215141243.GB2924@kaka.it.su.se>
	<5124F224.1090903@rabbitmq.com>
	<20130221134043.GK2924@kaka.it.su.se>
	<20130429112426.GC391@kaka.it.su.se>
	<517E958C.4030007@rabbitmq.com>
Message-ID: <20130430085206.GD391@kaka.it.su.se>

On Mon, 2013-04-29 at 16:45:16 +0100, Simon MacMullen wrote:
> The idea is that the two "arguments" for {refused} are a Fmt and
> Args pair like in io:format/2. Since the refusal is "expected" it
> should be possible to construct a nice log message for it. On the
> other hand an error could be any Erlang term.

Makes sense, thanks!

> Ah, yes. This is just a bug in mgmt, doesn't require your plugin. Will fix.

Sweet!

Br,
- Simon

From tilak.chauhan at ymail.com  Tue Apr 30 09:54:42 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Tue, 30 Apr 2013 01:54:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Why Clustering ? Load Balancing
In-Reply-To: <058319FB-37F5-4A78-A5EC-35290DDA79E7@alertme.com>
References: <1367248324721-26284.post@n5.nabble.com>
	<CAHEpgBD=qZC8neT+nCoQVYq4g+iZi5wT6VLAPQyodJw-3xHzLw@mail.gmail.com>
	<1367254205896-26287.post@n5.nabble.com>
	<517EA8C4.7040904@rabbitmq.com>
	<1367303405480-26292.post@n5.nabble.com>
	<058319FB-37F5-4A78-A5EC-35290DDA79E7@alertme.com>
Message-ID: <1367312082291-26295.post@n5.nabble.com>

Hi,

> How many RabbitMQ servers you running? Where is RabbitMQ on your picture?

There are total 4 severs on which RabbitMQ is running. One is producer and 3
others are consumers. 

> I would assume you are running it on "producer server" but how many
> instances of rabbit do you have?

On each server I have one instance of rarbbitmq running. Rabbitmq management
plugin is installed on producer server only, and other consumer servers they
all hit producer`s queues  (all queues and messages are residing in producer
sever).

Thanks,
T.luck





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-Clustering-Load-Balancing-tp26284p26295.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Tue Apr 30 10:44:17 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 30 Apr 2013 10:44:17 +0100
Subject: [rabbitmq-discuss] Hanging connections in management interface
 (v3.0.4)
In-Reply-To: <625c1144-034c-4380-9dd6-a8b6d87220a7@googlegroups.com>
References: <625c1144-034c-4380-9dd6-a8b6d87220a7@googlegroups.com>
Message-ID: <517F9271.4090906@rabbitmq.com>

There is a known issue with connections / channels on a cluster node not 
being cleared out of mgmt if they were running when the node shuts down. 
That's not fixed in 3.0.4 but is fixed in nightlies / will be in 3.1.0. 
Does that sound like what you're seeing?

Cheers, Simon

On 29/04/13 16:23, Allan Beaufour wrote:
> I've for a long time had an issue where queues show hanging connections
> in the management interface. The queues show a number of perpetual
> unacked messages and even if I shut down all consumers, these remain.
> The ip+port for the consumers doesn't match any processes either. Is
> this a known bug?
>
> I've had this issues for a while. We were running v2.7.1 perviously and
> was secretly hoping they would disappear in the upgrade :)
>
> Thanks,
>
> Allan
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Apr 30 10:44:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 30 Apr 2013 10:44:45 +0100
Subject: [rabbitmq-discuss] High-availability: Unsynchronised mirrors
 questions (3.0.2)
In-Reply-To: <1367244683899-26280.post@n5.nabble.com>
References: <3291d346-e249-458e-99dc-ff6a65a10379@googlegroups.com>
	<51405DE8.6050809@rabbitmq.com>
	<CAE8ERyzXExmrCkyCXMcPwf0069koEm6v5WcpY4_nJXT+tisosQ@mail.gmail.com>
	<51405F89.8040501@rabbitmq.com>
	<1367244683899-26280.post@n5.nabble.com>
Message-ID: <517F928D.9040804@rabbitmq.com>

Hopefully this week. Just some last minute issues to clear up now.

Cheers, Simon

On 29/04/13 15:11, softsoft wrote:
> Hello, Simon
>
> When is planned next version release?
>
> Thanks,
> Andris J.
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/High-availability-Unsynchronised-mirrors-questions-3-0-2-tp25425p26280.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simlu at su.se  Tue Apr 30 11:07:10 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Tue, 30 Apr 2013 12:07:10 +0200
Subject: [rabbitmq-discuss] Creating an auth plugin (Kerberos)
In-Reply-To: <20130430085206.GD391@kaka.it.su.se>
References: <05223E0E-9BBE-4842-AC20-DBEB330791BD@rabbitmq.com>
	<20130130123105.GO407@kaka.it.su.se>
	<B5A8398F-1ADD-407D-B3CD-38E60313BC4C@rabbitmq.com>
	<20130213074055.GC616@kaka.it.su.se>
	<20130215141243.GB2924@kaka.it.su.se>
	<5124F224.1090903@rabbitmq.com>
	<20130221134043.GK2924@kaka.it.su.se>
	<20130429112426.GC391@kaka.it.su.se>
	<517E958C.4030007@rabbitmq.com>
	<20130430085206.GD391@kaka.it.su.se>
Message-ID: <20130430100709.GF391@kaka.it.su.se>

Hm, I'm experiencing some weirdness now that I didn't before. I'm sure
I'm to blame but I belive I have checked all configuration parameters.

In rabbitmq.config I've made sure that RabbitMQ uses my plugin:
{auth_backends, [rabbit_auth_backend_kerberos, rabbit_auth_backend_internal]},

And my plugin is enabled:
# rabbitmq-plugins list
[?]
[E] rabbitmq_auth_backend_kerberos    0.0.0
[?]

The code I'm using is <https://github.com/simmel/rabbitmq-auth-backend-kerberos/tree/71cffb> and everything works when I authenticate a user that exists in the Kerberos database but when I try to login with a guest which is a local user, and it doesn't exist in the Kerberos database, it doesn't seem to fallback to rabbit_auth_backend_internal?

The output in the error log is:
{refused,"User '~s' exists in internal database, not authenticating user with Kerberos.", [<<"guest">>]}

which is correct, but it doesn't seem to fallback, as I said. I'm using
3.0.4.

Br,
- Simon

From emile at rabbitmq.com  Tue Apr 30 11:30:13 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 30 Apr 2013 11:30:13 +0100
Subject: [rabbitmq-discuss] 3.0.4 - Losing messages in a HA cluster
In-Reply-To: <CAD6m6fFcVQbEapAt+5krS0=MdBB_K0jF1i96MxWGReDhAXkGHQ@mail.gmail.com>
References: <CAD6m6fGwiMmO10+8WH+0MButj_t+EQ7j1U=xs+S6UUgcZSeVzg@mail.gmail.com>
	<517A3E71.8030104@rabbitmq.com>
	<CAD6m6fFcVQbEapAt+5krS0=MdBB_K0jF1i96MxWGReDhAXkGHQ@mail.gmail.com>
Message-ID: <517F9D35.70401@rabbitmq.com>


Hi Jason,

On 26/04/13 15:38, Jason McIntosh wrote:
> So to confirm my understanding here.  Message 1 was synched to both
> queues before I stopped the disc node.  So when I shut down the disc
> node, the ram node become the "master".  As such, it should have had
> message 1 and 2.  When I brought up the disc node it is a slave and had
> it's messages essentially reset.  Per the docs: "As such, when a slave
> rejoins a mirrored-queue, it throws away any durable local contents it
> already has and starts empty.".So when I now publish message 2, that
> goes to the ram node, which is now the master, and we have 2 messages
> total (disc node still off).  

That all sounds correct, as per your first message.

> The question becomes then - is there any way to recover the messages the
> RAM node had if the disc node comes back and the ram node subsequently
> failed?

Nodes joining the cluster have their queue contents reset. These
messages cannot be recovered.

To avoid message loss you will need to make sure that there is a
synchronised slave. Either add another slave or make sure at least one
of the existing slaves are synchronised. Slaves can be synchronised by
waiting for the queue contents to be replaced by the actions of
producers and consumers, or a future version of the broker will allow
slaves to be synchronised manually.

> Do I need to remove the HA policy, then bring up the RAM node to get
> the RAM node messages (since it was master prior to it's restart)?

No. See http://www.rabbitmq.com/ha.html#start-stop

> if I had 3 nodes in a cluster, and 1 node went down, but
> the other 2 nodes each got an even distribution of the queues

If you had 3 nodes and all queues were mirrored to all nodes then you
could shut down two of those nodes without losing messages, provided all
slaves were synchronised to start with.

> I've started testing on the new 3.1 nightly
This version allows slave nodes to be synchronised manually.




-Emile






From Petr.Gotthard at Honeywell.com  Tue Apr 30 12:30:38 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Tue, 30 Apr 2013 11:30:38 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <A845D27F-9A45-48AF-A556-72EBC45D253D@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<A845D27F-9A45-48AF-A556-72EBC45D253D@rabbitmq.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D3325DF@FR44EX3005.global.ds.honeywell.com>

Tim,
As I said earlier, the lager plugin at https://github.com/hyperthunk/rabbitmq-lager is perfect for me.

Petr

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: 29. dubna 2013 12:23
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] lager vs sasl error log

Folks - we have heard back from three of four people about this feature. Currently, that's not really what I'd call a 'critical mass' and certainly not enough for me to argue that we ought to provide lager support as part of the core broker ootb - Simon or Matthias may have a different opinion, but I wonder whether just providing this via a plugin is 'good enough' if it was included in the umbrella?

Thoughts on a postcard please - the more votes the more likely something will happen (one way or another).

Cheers,
Tim

On 26 Mar 2013, at 19:53, Tim Watson wrote:

> I have set up an experimental repository at https://github.com/hyperthunk/rabbitmq-lager that supports logging to lager via its built in error_logger redirection. You enable via `rabbitmq-plugins enable lager` and configure it in the RabbitMQ config file just like any other plugin, under the key 'lager'. In the morning I'll chat with the guys about integrating this as experimental plugin for the time being, so people can play around and see if it offers the required functionality.
> 
> Cheers,
> Tim
> 
> On 23 Mar 2013, at 23:06, Ben Hood wrote:
> 
>> Hey Tim,
>> On Friday, 22 March 2013 at 07:55, Tim Watson wrote:
>> 
>>> Yeah with the current implementation you'd need to install your own log handler to make that work. In terms of changing the output format though, allowe to play devil's advocate for a moment...
>>> 
>>> The info/progress/error reports have a lot of data in them, process stats, stack traces, etc. are you wanting to see all that plonked on one single long line? Because I can see how that'd make parsing/aggregating easier, but not reading them. Does the lager output fit exactly with what you want (I've not looks at it or a couple of years)?
>> I don't think that everything needs to fit on one line. Longer traces 
>> which provide good context should probably remain as multiline 
>> entries. However, info items, for example,
>> 
>> Mar 22 22:33:01 a rabbit3:  =INFO REPORT==== 22-Mar-2013::22:33:01 
>> === Mar 22 22:33:01 a rabbit3:  Setting permissions for 'guest' in '/' to '.*', '.*', '.*'
>> 
>> need not get split up over two lines.
>> 
>> With regard to longer traces, it would be nice if they could be handled in such a way that the generic portion of the call stack were trimmed down to something nearer the actual call site, rather that the entire generic call trace. As inspiration, logback mitigates the default "root cause comes last" behavior in Java with the reverse depth layout modifier (rEx{depth}). Lot's of hand waving here though.
>> 
>> Finally, I do have to concur with Gavin on people's perception about Rabbit due to logging - I've have many conversations with people over the years who ask why Rabbit has such bizare logging - I've generally answered that this is an Erlang-ism, and though it is strange, the server kind of serves its primary function well (i.e. delivering messages), so just put up with it.
>> 
>> Cheers,
>> 
>> Ben
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dmitry.andrianov at alertme.com  Tue Apr 30 12:50:05 2013
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Tue, 30 Apr 2013 12:50:05 +0100
Subject: [rabbitmq-discuss] Why Clustering ? Load Balancing
In-Reply-To: <1367312082291-26295.post@n5.nabble.com>
References: <1367248324721-26284.post@n5.nabble.com>
	<CAHEpgBD=qZC8neT+nCoQVYq4g+iZi5wT6VLAPQyodJw-3xHzLw@mail.gmail.com>
	<1367254205896-26287.post@n5.nabble.com>	<517EA8C4.7040904@rabbitmq.com>
	<1367303405480-26292.post@n5.nabble.com>
	<058319FB-37F5-4A78-A5EC-35290DDA79E7@alertme.com>
	<1367312082291-26295.post@n5.nabble.com>
Message-ID: <517FAFED.1000803@alertme.com>


Looks like I do not understand your installation at all. I thought that 
"producer" and "consumer" are some processes which actually produce 
messages, send them via RabbitMQ and receive them from RabbitMQ 
respectively.

But now it looks to me that you call different RabbitMQ instances 
"producer" and "consumer".
So how exactly does it work? Is there some kind of federation or are you 
using Shovel?


On 30/04/13 09:54, tluck wrote:
> Hi,
>
>> How many RabbitMQ servers you running? Where is RabbitMQ on your picture?
> There are total 4 severs on which RabbitMQ is running. One is producer and 3
> others are consumers.
>
>> I would assume you are running it on "producer server" but how many
>> instances of rabbit do you have?
> On each server I have one instance of rarbbitmq running. Rabbitmq management
> plugin is installed on producer server only, and other consumer servers they
> all hit producer`s queues  (all queues and messages are residing in producer
> sever).
>
> Thanks,
> T.luck
>
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-Clustering-Load-Balancing-tp26284p26295.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From tim at rabbitmq.com  Tue Apr 30 12:57:08 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 30 Apr 2013 12:57:08 +0100
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D3325DF@FR44EX3005.global.ds.honeywell.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<A845D27F-9A45-48AF-A556-72EBC45D253D@rabbitmq.com>
	<F9E85480F62349458DF67CE8BA000D8D2D3325DF@FR44EX3005.global.ds.honeywell.com>
Message-ID: <FFA7F873-0693-4F2C-BD57-5D152A133122@rabbitmq.com>

Hi Petr - thanks for confirming, that's good to know. I've heard back from several people on IRC asking for lager features in the core broker - module names, line numbers, process id in the log output, lager's tracing support etc. But the minimal effort would definitely be to just include rabbitmq-lager in the public umbrella.

Cheers,
Tim

On 30 Apr 2013, at 12:30, Gotthard, Petr wrote:

> Tim,
> As I said earlier, the lager plugin at https://github.com/hyperthunk/rabbitmq-lager is perfect for me.
> 
> Petr
> 
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
> Sent: 29. dubna 2013 12:23
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] lager vs sasl error log
> 
> Folks - we have heard back from three of four people about this feature. Currently, that's not really what I'd call a 'critical mass' and certainly not enough for me to argue that we ought to provide lager support as part of the core broker ootb - Simon or Matthias may have a different opinion, but I wonder whether just providing this via a plugin is 'good enough' if it was included in the umbrella?
> 
> Thoughts on a postcard please - the more votes the more likely something will happen (one way or another).
> 
> Cheers,
> Tim
> 
> On 26 Mar 2013, at 19:53, Tim Watson wrote:
> 
>> I have set up an experimental repository at https://github.com/hyperthunk/rabbitmq-lager that supports logging to lager via its built in error_logger redirection. You enable via `rabbitmq-plugins enable lager` and configure it in the RabbitMQ config file just like any other plugin, under the key 'lager'. In the morning I'll chat with the guys about integrating this as experimental plugin for the time being, so people can play around and see if it offers the required functionality.
>> 
>> Cheers,
>> Tim
>> 
>> On 23 Mar 2013, at 23:06, Ben Hood wrote:
>> 
>>> Hey Tim,
>>> On Friday, 22 March 2013 at 07:55, Tim Watson wrote:
>>> 
>>>> Yeah with the current implementation you'd need to install your own log handler to make that work. In terms of changing the output format though, allowe to play devil's advocate for a moment...
>>>> 
>>>> The info/progress/error reports have a lot of data in them, process stats, stack traces, etc. are you wanting to see all that plonked on one single long line? Because I can see how that'd make parsing/aggregating easier, but not reading them. Does the lager output fit exactly with what you want (I've not looks at it or a couple of years)?
>>> I don't think that everything needs to fit on one line. Longer traces 
>>> which provide good context should probably remain as multiline 
>>> entries. However, info items, for example,
>>> 
>>> Mar 22 22:33:01 a rabbit3:  =INFO REPORT==== 22-Mar-2013::22:33:01 
>>> === Mar 22 22:33:01 a rabbit3:  Setting permissions for 'guest' in '/' to '.*', '.*', '.*'
>>> 
>>> need not get split up over two lines.
>>> 
>>> With regard to longer traces, it would be nice if they could be handled in such a way that the generic portion of the call stack were trimmed down to something nearer the actual call site, rather that the entire generic call trace. As inspiration, logback mitigates the default "root cause comes last" behavior in Java with the reverse depth layout modifier (rEx{depth}). Lot's of hand waving here though.
>>> 
>>> Finally, I do have to concur with Gavin on people's perception about Rabbit due to logging - I've have many conversations with people over the years who ask why Rabbit has such bizare logging - I've generally answered that this is an Erlang-ism, and though it is strange, the server kind of serves its primary function well (i.e. delivering messages), so just put up with it.
>>> 
>>> Cheers,
>>> 
>>> Ben
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Tue Apr 30 13:02:32 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 30 Apr 2013 13:02:32 +0100
Subject: [rabbitmq-discuss] Why Clustering ? Load Balancing
In-Reply-To: <517FAFED.1000803@alertme.com>
References: <1367248324721-26284.post@n5.nabble.com>
	<CAHEpgBD=qZC8neT+nCoQVYq4g+iZi5wT6VLAPQyodJw-3xHzLw@mail.gmail.com>
	<1367254205896-26287.post@n5.nabble.com>	<517EA8C4.7040904@rabbitmq.com>
	<1367303405480-26292.post@n5.nabble.com>
	<058319FB-37F5-4A78-A5EC-35290DDA79E7@alertme.com>
	<1367312082291-26295.post@n5.nabble.com>
	<517FAFED.1000803@alertme.com>
Message-ID: <D498166A-FE3B-49DD-AA29-62633C492133@rabbitmq.com>

This *does* seem quite bewildering to imagine doesn't it. I was also working on the assumption that the OP had a 'producer' application and several 'consumer' applications, all of which were connected to a RabbitMQ broker (or cluster of brokers). It sounds like the OP is running a broker on each client node, but the question now is for T.luck: why are you doing that? It's quite possible that this is the cause of the 'issues' you're seeing, but it's really hard to say without understanding what you're trying to do.

If you're deliberately using connectivity between brokers (e.g., via the shovel or federation plugins) to move data around, then that's fine and good - we can talk about performance issues with regards that kind of setup. But if you're trying to publish messages from one application and consume them from one or more others, then you should not have a broker installed along-side each client, but rather you should be running one (or more, clustered) broker centrally and the publishing/consuming applications should connect to the remote (broker) host.

Perhaps if you - the OP - could clarify what exactly you're up to, we'd be able to help a bit more.

Cheers,
Tim 

On 30 Apr 2013, at 12:50, Dmitry Andrianov wrote:

> 
> Looks like I do not understand your installation at all. I thought that "producer" and "consumer" are some processes which actually produce messages, send them via RabbitMQ and receive them from RabbitMQ respectively.
> 
> But now it looks to me that you call different RabbitMQ instances "producer" and "consumer".
> So how exactly does it work? Is there some kind of federation or are you using Shovel?
> 
> 
> On 30/04/13 09:54, tluck wrote:
>> Hi,
>> 
>>> How many RabbitMQ servers you running? Where is RabbitMQ on your picture?
>> There are total 4 severs on which RabbitMQ is running. One is producer and 3
>> others are consumers.
>> 
>>> I would assume you are running it on "producer server" but how many
>>> instances of rabbit do you have?
>> On each server I have one instance of rarbbitmq running. Rabbitmq management
>> plugin is installed on producer server only, and other consumer servers they
>> all hit producer`s queues  (all queues and messages are residing in producer
>> sever).
>> 
>> Thanks,
>> T.luck
>> 
>> 
>> 
>> 
>> 
>> --
>> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Why-Clustering-Load-Balancing-tp26284p26295.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> This email is for the use of the intended recipient(s) only.
> If you have received this email in error, please notify the sender immediately and then delete it.
> If you are not the intended recipient, you must not use, disclose or distribute this email without the
> author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
> in this message or any attachments that are those of the individual sender.
> 
> AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
> Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Tue Apr 30 13:43:32 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 30 Apr 2013 13:43:32 +0100
Subject: [rabbitmq-discuss] Flow Control is to rigorous
In-Reply-To: <1366994500819-26260.post@n5.nabble.com>
References: <1366906868872-26234.post@n5.nabble.com>
	<CAJbhyRHFpmWrXMag4o838RepZjE6uW7kdQBvvSiSw+JU-=bjMg@mail.gmail.com>
	<517A4175.4040005@rabbitmq.com>
	<1366969004440-26251.post@n5.nabble.com>
	<1366983456759-26257.post@n5.nabble.com>
	<1366994500819-26260.post@n5.nabble.com>
Message-ID: <517FBC74.1070100@rabbitmq.com>

On 26/04/13 17:41, rabbit15 wrote:
> Hi, can you tell mi if value vm watermark can be set more than 1.0 ? I want
> to set it to value 2.0. Is that danger value for the system ?

The high watermark can be set to a high value like 100 if you want, but
the broker will be more likely to run out of memory. The section on
configuring the memory threshold has more information:

http://www.rabbitmq.com/memory.html


On 26/04/13 10:36, rabbit15 wrote:
> I know that there is mechanism that I can check how much data is on the
> queue (f.e. declare passive queue), but I don't know when flow control would
> be started. I don't want to flow control will block sending messages.

If you set the disk free limit to zero and the vm_memory_high_watermark
to a very high multiplier then flow control will not block messages, but
the broker is likely to crash due to running out of resources.





-Emile









From stuff at moesel.net  Tue Apr 30 14:04:18 2013
From: stuff at moesel.net (Chris)
Date: Tue, 30 Apr 2013 09:04:18 -0400
Subject: [rabbitmq-discuss] High-availability: Unsynchronised mirrors
 questions (3.0.2)
In-Reply-To: <517F928D.9040804@rabbitmq.com>
References: <3291d346-e249-458e-99dc-ff6a65a10379@googlegroups.com>
	<51405DE8.6050809@rabbitmq.com>
	<CAE8ERyzXExmrCkyCXMcPwf0069koEm6v5WcpY4_nJXT+tisosQ@mail.gmail.com>
	<51405F89.8040501@rabbitmq.com>
	<1367244683899-26280.post@n5.nabble.com>
	<517F928D.9040804@rabbitmq.com>
Message-ID: <CAHEpgBAQDBSHiW9aKPxhwniUDcT32LKa1vcCvSBeG7R1ZLGbKQ@mail.gmail.com>

Is there a web page yet that lists the major new features and bug fixes in
the upcoming 3.1?

-Chris


On Tue, Apr 30, 2013 at 5:44 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hopefully this week. Just some last minute issues to clear up now.
>
> Cheers, Simon
>
>
> On 29/04/13 15:11, softsoft wrote:
>
>> Hello, Simon
>>
>> When is planned next version release?
>>
>> Thanks,
>> Andris J.
>>
>>
>>
>> --
>> View this message in context: http://rabbitmq.1065348.n5.**
>> nabble.com/High-availability-**Unsynchronised-mirrors-**
>> questions-3-0-2-tp25425p26280.**html<http://rabbitmq.1065348.n5.nabble.com/High-availability-Unsynchronised-mirrors-questions-3-0-2-tp25425p26280.html>
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130430/1572fb69/attachment.htm>

From allan at chartbeat.com  Tue Apr 30 14:17:58 2013
From: allan at chartbeat.com (Allan Beaufour)
Date: Tue, 30 Apr 2013 09:17:58 -0400
Subject: [rabbitmq-discuss] Hanging connections in management interface
	(v3.0.4)
In-Reply-To: <517F9271.4090906@rabbitmq.com>
References: <625c1144-034c-4380-9dd6-a8b6d87220a7@googlegroups.com>
	<517F9271.4090906@rabbitmq.com>
Message-ID: <CAO98qLZ7v1T6N=q27gonQ7ObHZMcz90nEej_6O4vLt5jWXXYLA@mail.gmail.com>

No, this is a single rabbitmq node.


On Tue, Apr 30, 2013 at 5:44 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> There is a known issue with connections / channels on a cluster node not
> being cleared out of mgmt if they were running when the node shuts down.
> That's not fixed in 3.0.4 but is fixed in nightlies / will be in 3.1.0.
> Does that sound like what you're seeing?
>
> Cheers, Simon
>
> On 29/04/13 16:23, Allan Beaufour wrote:
>
>> I've for a long time had an issue where queues show hanging connections
>> in the management interface. The queues show a number of perpetual
>> unacked messages and even if I shut down all consumers, these remain.
>> The ip+port for the consumers doesn't match any processes either. Is
>> this a known bug?
>>
>> I've had this issues for a while. We were running v2.7.1 perviously and
>> was secretly hoping they would disappear in the upgrade :)
>>
>> Thanks,
>>
>> Allan
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130430/ba0295bb/attachment.htm>

From simon at rabbitmq.com  Tue Apr 30 14:44:25 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 30 Apr 2013 14:44:25 +0100
Subject: [rabbitmq-discuss] High-availability: Unsynchronised mirrors
 questions (3.0.2)
In-Reply-To: <CAHEpgBAQDBSHiW9aKPxhwniUDcT32LKa1vcCvSBeG7R1ZLGbKQ@mail.gmail.com>
References: <3291d346-e249-458e-99dc-ff6a65a10379@googlegroups.com>
	<51405DE8.6050809@rabbitmq.com>
	<CAE8ERyzXExmrCkyCXMcPwf0069koEm6v5WcpY4_nJXT+tisosQ@mail.gmail.com>
	<51405F89.8040501@rabbitmq.com>
	<1367244683899-26280.post@n5.nabble.com>
	<517F928D.9040804@rabbitmq.com>
	<CAHEpgBAQDBSHiW9aKPxhwniUDcT32LKa1vcCvSBeG7R1ZLGbKQ@mail.gmail.com>
Message-ID: <517FCAB9.3080006@rabbitmq.com>

On 30/04/13 14:04, Chris wrote:
> Is there a web page yet that lists the major new features and bug fixes
> in the upcoming 3.1?

Not until it's released; it's being prepared now. You can trawl 
http://next.rabbitmq.com/ in the mean time.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Apr 30 14:57:02 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 30 Apr 2013 14:57:02 +0100
Subject: [rabbitmq-discuss] Creating an auth plugin (Kerberos)
In-Reply-To: <20130430100709.GF391@kaka.it.su.se>
References: <05223E0E-9BBE-4842-AC20-DBEB330791BD@rabbitmq.com>
	<20130130123105.GO407@kaka.it.su.se>
	<B5A8398F-1ADD-407D-B3CD-38E60313BC4C@rabbitmq.com>
	<20130213074055.GC616@kaka.it.su.se>
	<20130215141243.GB2924@kaka.it.su.se>
	<5124F224.1090903@rabbitmq.com>
	<20130221134043.GK2924@kaka.it.su.se>
	<20130429112426.GC391@kaka.it.su.se>
	<517E958C.4030007@rabbitmq.com>
	<20130430085206.GD391@kaka.it.su.se>
	<20130430100709.GF391@kaka.it.su.se>
Message-ID: <517FCDAE.60407@rabbitmq.com>

On 30/04/13 11:07, Simon Lundstr?m wrote:
> Hm, I'm experiencing some weirdness now that I didn't before. I'm sure
> I'm to blame but I belive I have checked all configuration parameters.
>
> In rabbitmq.config I've made sure that RabbitMQ uses my plugin:
> {auth_backends, [rabbit_auth_backend_kerberos, rabbit_auth_backend_internal]},

Are you absolutely sure about this? The broker really will just try the 
backends in order, and only the last module's {refused, _, _} will be 
returned.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Apr 30 15:04:28 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 30 Apr 2013 15:04:28 +0100
Subject: [rabbitmq-discuss] Hanging connections in management interface
 (v3.0.4)
In-Reply-To: <CAO98qLZ7v1T6N=q27gonQ7ObHZMcz90nEej_6O4vLt5jWXXYLA@mail.gmail.com>
References: <625c1144-034c-4380-9dd6-a8b6d87220a7@googlegroups.com>
	<517F9271.4090906@rabbitmq.com>
	<CAO98qLZ7v1T6N=q27gonQ7ObHZMcz90nEej_6O4vLt5jWXXYLA@mail.gmail.com>
Message-ID: <517FCF6C.5090105@rabbitmq.com>

OK.

So you say "queues show hanging connections". Do you mean that the 
management plugin shows connections under the "Connections" tab, or 
consumers under queue details, or something else?

Do you see the same items in rabbitmqctl list_connections (or 
list_queues or similar)? If so can you send the output of "rabbitmqctl 
report"?

Also, do these items ever go away? Has the memory alarm / disk alarm 
gone off at any point?

Cheers, Simon

On 30/04/13 14:17, Allan Beaufour wrote:
> No, this is a single rabbitmq node.
>
>
> On Tue, Apr 30, 2013 at 5:44 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     There is a known issue with connections / channels on a cluster node
>     not being cleared out of mgmt if they were running when the node
>     shuts down. That's not fixed in 3.0.4 but is fixed in nightlies /
>     will be in 3.1.0. Does that sound like what you're seeing?
>
>     Cheers, Simon
>
>     On 29/04/13 16:23, Allan Beaufour wrote:
>
>         I've for a long time had an issue where queues show hanging
>         connections
>         in the management interface. The queues show a number of perpetual
>         unacked messages and even if I shut down all consumers, these
>         remain.
>         The ip+port for the consumers doesn't match any processes either. Is
>         this a known bug?
>
>         I've had this issues for a while. We were running v2.7.1
>         perviously and
>         was secretly hoping they would disappear in the upgrade :)
>
>         Thanks,
>
>         Allan
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From maze at reik.se  Tue Apr 30 20:35:27 2013
From: maze at reik.se (Maze)
Date: Tue, 30 Apr 2013 21:35:27 +0200
Subject: [rabbitmq-discuss] Hanging connections in management interface
 (v3.0.4)
In-Reply-To: <517FCF6C.5090105@rabbitmq.com>
References: <625c1144-034c-4380-9dd6-a8b6d87220a7@googlegroups.com>
	<517F9271.4090906@rabbitmq.com>
	<CAO98qLZ7v1T6N=q27gonQ7ObHZMcz90nEej_6O4vLt5jWXXYLA@mail.gmail.com>
	<517FCF6C.5090105@rabbitmq.com>
Message-ID: <51801CFF.5070108@reik.se>

I think we had a similar problem. Clients that died were still in the 
list of connections. In our case this was slowing RabbitMQ (v2.6.x ? not 
sure) down to a degree that we had to restart RabbitMQ.
We solved the problem by implementing the heartbeat and we haven't seen 
any such issues since then.

Cheers
Maze



On 2013-04-30 16:04, Simon MacMullen wrote:
> OK.
>
> So you say "queues show hanging connections". Do you mean that the 
> management plugin shows connections under the "Connections" tab, or 
> consumers under queue details, or something else?
>
> Do you see the same items in rabbitmqctl list_connections (or 
> list_queues or similar)? If so can you send the output of "rabbitmqctl 
> report"?
>
> Also, do these items ever go away? Has the memory alarm / disk alarm 
> gone off at any point?
>
> Cheers, Simon
>
> On 30/04/13 14:17, Allan Beaufour wrote:
>> No, this is a single rabbitmq node.
>>
>>
>> On Tue, Apr 30, 2013 at 5:44 AM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     There is a known issue with connections / channels on a cluster node
>>     not being cleared out of mgmt if they were running when the node
>>     shuts down. That's not fixed in 3.0.4 but is fixed in nightlies /
>>     will be in 3.1.0. Does that sound like what you're seeing?
>>
>>     Cheers, Simon
>>
>>     On 29/04/13 16:23, Allan Beaufour wrote:
>>
>>         I've for a long time had an issue where queues show hanging
>>         connections
>>         in the management interface. The queues show a number of 
>> perpetual
>>         unacked messages and even if I shut down all consumers, these
>>         remain.
>>         The ip+port for the consumers doesn't match any processes 
>> either. Is
>>         this a known bug?
>>
>>         I've had this issues for a while. We were running v2.7.1
>>         perviously and
>>         was secretly hoping they would disappear in the upgrade :)
>>
>>         Thanks,
>>
>>         Allan
>>
>>
>>         _________________________________________________
>>         rabbitmq-discuss mailing list
>>         rabbitmq-discuss at lists.__rabbitmq.com
>>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>> <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, VMware
>>
>>
>
>


From srd at duneram.com  Tue Apr 30 23:39:07 2013
From: srd at duneram.com (=?iso-8859-1?Q?srd?=)
Date: Tue, 30 Apr 2013 22:39:07 +0000
Subject: [rabbitmq-discuss] =?iso-8859-1?q?Question_about_starting_a_node?=
Message-ID: <20130430223907.2454.qmail@hoster904.com>

I'm new to rabbitMQ.
Having trouble getting connection to my RabbitMQ node:
I start fresh (ps shows nothing running)
I had no .erlang.cookie prior to starting because I deleted it.

I start the server (as rabbitmq user)
-bash-4.1$ rabbitmqctl status
Status of node rabbit at node1 ...
Error: unable to connect to node rabbit at node1: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at node1]

hosts, their running nodes and ports:
- node1: [{rabbit,39755},{rabbitmqctl24649,36189}]

current node details:
- node name: rabbitmqctl24649 at node1
- home dir: /var/lib/rabbitmq
- cookie hash: tUkC93ZXvsKATv+pT6hrZQ==


I've tried looking at the docs and this one puzzles me.
1) I could see why rabbit at node1 isn't able to connect because I just started it.  Is that what the error pertains to?
2) Why does it think my nodename is rabbitmqctl2469 at node1?
   Why isn't it rabbit at node1 ?
3) if I do a rabbitmqctl status command I get:
-bash-4.1$ rabbitmqctl status
skip preloader
Status of node rabbit at node1 ...
Error: unable to connect to node rabbit at node1: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at node1]

hosts, their running nodes and ports:
- node1: [{rabbit,39755},{rabbitmqctl24868,34136}]

current node details:
- node name: rabbitmqctl24868 at node1
- home dir: /var/lib/rabbitmq
- cookie hash: tUkC93ZXvsKATv+pT6hrZQ==

-bash-4.1$ 

On top of all the problems trying to connect with rabbit at node1, it appears the node name is now different

before it was: 
node name: rabbitmqctl24649 at node1
now its
node name: rabbitmqctl24868 at node1

Would someone explain what is going on?   I eventually want to have a cluster but that is down the road once I understand the basics here.

Thank you for taking the time to read this.

Dave

From ranjitiyer at gmail.com  Tue Apr 30 18:10:21 2013
From: ranjitiyer at gmail.com (ranjitiyer)
Date: Tue, 30 Apr 2013 10:10:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Repairing a crashed cluster - Obtaining
	persisted msgs from master
Message-ID: <1367341821112-26310.post@n5.nabble.com>

Hello,

Part of my question was answered here
http://rabbitmq.1065348.n5.nabble.com/Repairing-a-a-crashed-cluster-td22466.html.
I have a follow up question for the following scenario. 

Say, I have a master/slave cluster with mirrored persisted queues. Slave
dies, messages m1, m2 are published to the master. Master dies. Slave comes
up - it can't because master is dead. I realized am going to have to follow
the instructions on the previous post to get erl.exe and eventually the
rabbit running on the slave machine.

Good so far. I now also want the messages of the master to be brought over
to the slave because I don't wanna lose m1 and m2 sitting on the master
machine. I know that queue messages are persisted in the mnesia database
located under c:\user\appdata\...\db\. Is there a way to export data from
this db and import it into the db on the slave machine?

Thanks,
Ranjit



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Repairing-a-crashed-cluster-Obtaining-persisted-msgs-from-master-tp26310.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From neo20iitkgp at gmail.com  Tue Apr 30 19:20:31 2013
From: neo20iitkgp at gmail.com (subhankar biswas)
Date: Tue, 30 Apr 2013 11:20:31 -0700 (PDT)
Subject: [rabbitmq-discuss] JSON Data to be send between Java Producer
	and Python Consumer
In-Reply-To: <af82e304-1f5b-430e-b654-bcdca853ca49@googlegroups.com>
References: <af82e304-1f5b-430e-b654-bcdca853ca49@googlegroups.com>
Message-ID: <6bf03d2f-61c9-4655-b756-2b6d1d3249ba@googlegroups.com>

did u tried this settings at pub end 
  channel.basicPublish(*exchangeName*, *routingKey*,

                     *new* AMQP.BasicProperties.Builder()
                       .contentType("application/json").deliveryMode(2)
                       .priority(1).userId("bob")
                       .build()),
                     messageBodyBytes);


On Saturday, 20 April 2013 12:08:49 UTC+5:30, Arun Viswanath wrote:
>
> Hi, 
>
> I'm facing an issue while sending the JSON data between Java Producer and 
>  Python Consumer. 
>
> I doing the following serialization in my Java Producer for my JSON data 
> and placing the serialize data in the Queue 
>
> *Java Code: 
> import org.json.simple.JSONObject; 
> import org.json.simple.parser.JSONParser; 
>
>
> // Reading the JSON content from the file and making it an JSONObject 
> JSONObject serviceObj = (JSONObject) parser.parse(new 
> FileReader("C:\\Msg2.json")); 
>
> String jsonText = new flexjson.JSONSerializer().serialize(jsonObj); 
>
> channel.basicPublish("", CONDUCTOR_QUEUE_NAME, null, jsonText .getBytes());
> *
>
> ----------------- 
> My python consumer successfully takes the data from the Queue but it is 
> not able to process it. 
> Python consumer is expected to deserialize the json message read from the 
> Queue to Python dictionary but the data got after deserialize is python 
> unicode type. 
>
> My python consumer is third party code so I can't change my consumer side. 
> I'm not sure whether I'm doing the correct stuff in my Java producer. 
>
> Any help to resolve this issue will be appreciated. 
>
> Thanks In Advance, 
> Arun V 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130430/e962dd55/attachment.htm>

