<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Load balancing with multiple consumers on a single queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Load%20balancing%20with%20multiple%20consumers%20on%20a%0A%20single%20queue&In-Reply-To=OFEBE1BE72.4C966F45-ON80257496.005E29AA-80257496.0060F5F1%40Edftrading.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001106.html">
   <LINK REL="Next"  HREF="001113.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Load balancing with multiple consumers on a single queue</H1>
    <B>Gordon Sim</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Load%20balancing%20with%20multiple%20consumers%20on%20a%0A%20single%20queue&In-Reply-To=OFEBE1BE72.4C966F45-ON80257496.005E29AA-80257496.0060F5F1%40Edftrading.com"
       TITLE="[rabbitmq-discuss] Load balancing with multiple consumers on a single queue">gsim at redhat.com
       </A><BR>
    <I>Thu Jul 31 09:20:36 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001106.html">[rabbitmq-discuss] Load balancing with multiple consumers on a single queue
</A></li>
        <LI>Next message: <A HREF="001113.html">[rabbitmq-discuss] Load balancing with multiple consumers on a single queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1112">[ date ]</a>
              <a href="thread.html#1112">[ thread ]</a>
              <a href="subject.html#1112">[ subject ]</a>
              <a href="author.html#1112">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">David.Corcoran at edftrading.com</A> wrote:
&gt;<i> 
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A> wrote on 30/07/2008 18:02:30:
</I>&gt;<i> 
</I>&gt;<i> Hey Matthias,
</I>&gt;&gt;<i> Wouldn't a simple solution be to have all consumers consuming off a
</I>&gt;&gt;<i> single queue using basic.get? I.e. consumer gets job with basic.get,
</I>&gt;&gt;<i> does work, sends ack, gets next job with basic.get, etc.
</I>&gt;<i> 
</I>&gt;<i> Not really because a lot of our jobs are only a few ms so the rtt would
</I>&gt;<i> play too much part if we did it this way. The idea of having a local queue
</I>&gt;<i> full of messages works great for us, as long as there's a way to reject
</I>&gt;<i> messages if someone else's queue is empty.
</I>
Could you use basic.recover(requeue=true) in that case? You could ack 
the first n messages on your local queue that you want to deal with, 
then issue the recover to have any subsequently delievered messages 
requeued.

Of course when requeued those messages will be allocated to available 
consumers, so some may come back to the same subscriber (that would also 
be the case if you ack and sent them back to the same queue yourself).

To avoid that (without having some form of flow control or prefetch 
limit) you would I think need to temporarily cancel your subscription 
and re-subscribe when you have processed the n messages (or a portion 
thereof) from your local queue.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001106.html">[rabbitmq-discuss] Load balancing with multiple consumers on a single queue
</A></li>
	<LI>Next message: <A HREF="001113.html">[rabbitmq-discuss] Load balancing with multiple consumers on a single queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1112">[ date ]</a>
              <a href="thread.html#1112">[ thread ]</a>
              <a href="subject.html#1112">[ subject ]</a>
              <a href="author.html#1112">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
