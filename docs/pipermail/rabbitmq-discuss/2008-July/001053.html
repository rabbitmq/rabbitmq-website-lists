<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Suggestion for performance options
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Suggestion%20for%20performance%20options&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001043.html">
   <LINK REL="Next"  HREF="001054.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Suggestion for performance options</H1>
    <B>Holger Hoffst&#228;tte</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Suggestion%20for%20performance%20options&In-Reply-To="
       TITLE="[rabbitmq-discuss] Suggestion for performance options">holger at wizards.de
       </A><BR>
    <I>Wed Jul 16 15:28:06 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001043.html">[rabbitmq-discuss] Durable queues for STOMP broker
</A></li>
        <LI>Next message: <A HREF="001054.html">[rabbitmq-discuss] RabbitMQ Administration API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1053">[ date ]</a>
              <a href="thread.html#1053">[ thread ]</a>
              <a href="subject.html#1053">[ subject ]</a>
              <a href="author.html#1053">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Afte playing with the Multicast test I wanted to share something and 
suggest an improvement to the client connection setup.

By default the MulticastMain test blasts many empty messages over the 
wire, and I was puzzled by the numbers I got. While the machine running 
the broker is &quot;only&quot; an old single-core 2.4GHz P4 (client is a dual-core 
Thinkpad with Windows) I expected much more than ~2000 messages/sec over 
Gigabit ethernet. Turns out that the Java client by default does not set 
any socket buffer options, which are crucial for TCP performance. This is 
usually only a problem over long distances and WANs with large latencies, 
but the situation is essentially the same with many small messages on a 
LAN - just the scales are different.

A quick test confirmed this. I added the following bits to 
SocketFrameHandler's constructor after the socket has been created:

     _socket.setSendBufferSize(16777216);
     _socket.setReceiveBufferSize(16777216);

This resulted in a jump from ~2000 messages/sec to &gt;35000 for the 
producer. Variations with e.g. multiple consumers show similar gains with 
continous receives in the ~20k/sec range.

Now, that 16M value is just an almost arbitrary &quot;big value&quot; for gigabit 
LAN; you might get similar results with something like ~2-4 MB, and in 
fact too large values often degrade performance again (it's all very 
obscure). Both Linux and Windows are supposed to have auto-tuning for the 
TCP stack including dynamically growing the TCP window, but in practice 
this only seems to work in special cases and/or for continuously high 
bandwidth transfers like FTP.

It seems to me that being able to set these values would be a good 
addition to the ConnectionParameters class. They could then be configured 
on the underlying socket when it is created by the ConnectionFactory.

cheers!
Holger


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001043.html">[rabbitmq-discuss] Durable queues for STOMP broker
</A></li>
	<LI>Next message: <A HREF="001054.html">[rabbitmq-discuss] RabbitMQ Administration API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1053">[ date ]</a>
              <a href="thread.html#1053">[ thread ]</a>
              <a href="subject.html#1053">[ subject ]</a>
              <a href="author.html#1053">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
