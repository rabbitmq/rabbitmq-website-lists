<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Load balancing with multiple consumers on a single queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Load%20balancing%20with%20multiple%20consumers%20on%20a%0A%20single%20queue&In-Reply-To=489175D4.7060104%40redhat.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001112.html">
   <LINK REL="Next"  HREF="001114.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Load balancing with multiple consumers on a single queue</H1>
    <B>Gordon Sim</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Load%20balancing%20with%20multiple%20consumers%20on%20a%0A%20single%20queue&In-Reply-To=489175D4.7060104%40redhat.com"
       TITLE="[rabbitmq-discuss] Load balancing with multiple consumers on a single queue">gsim at redhat.com
       </A><BR>
    <I>Thu Jul 31 09:32:48 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001112.html">[rabbitmq-discuss] Load balancing with multiple consumers on a single queue
</A></li>
        <LI>Next message: <A HREF="001114.html">[rabbitmq-discuss] Load balancing with multiple consumers on a single queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1113">[ date ]</a>
              <a href="thread.html#1113">[ thread ]</a>
              <a href="subject.html#1113">[ subject ]</a>
              <a href="author.html#1113">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gordon Sim wrote:
&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">David.Corcoran at edftrading.com</A> wrote:
</I>&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A> wrote on 30/07/2008 18:02:30:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hey Matthias,
</I>&gt;&gt;&gt;<i> Wouldn't a simple solution be to have all consumers consuming off a
</I>&gt;&gt;&gt;<i> single queue using basic.get? I.e. consumer gets job with basic.get,
</I>&gt;&gt;&gt;<i> does work, sends ack, gets next job with basic.get, etc.
</I>&gt;&gt;<i> Not really because a lot of our jobs are only a few ms so the rtt would
</I>&gt;&gt;<i> play too much part if we did it this way. The idea of having a local queue
</I>&gt;&gt;<i> full of messages works great for us, as long as there's a way to reject
</I>&gt;&gt;<i> messages if someone else's queue is empty.
</I>&gt;<i> 
</I>&gt;<i> Could you use basic.recover(requeue=true) in that case? You could ack 
</I>&gt;<i> the first n messages on your local queue that you want to deal with, 
</I>&gt;<i> then issue the recover to have any subsequently delievered messages 
</I>&gt;<i> requeued.
</I>
Sorry, didn't think this one through enough! Of course you can't ack 
before you process the tasks in case the client dies before actually 
doing the work and the messages are lost.

So for this to be of any use you would have to finish processing your 
current task, ack that then requeue everything everything else. That may 
be less attractive an option if it happens often as it removes the value 
of the prefetch.

&gt;<i> Of course when requeued those messages will be allocated to available 
</I>&gt;<i> consumers, so some may come back to the same subscriber (that would also 
</I>&gt;<i> be the case if you ack and sent them back to the same queue yourself).
</I>&gt;<i> 
</I>&gt;<i> To avoid that (without having some form of flow control or prefetch 
</I>&gt;<i> limit) you would I think need to temporarily cancel your subscription 
</I>&gt;<i> and re-subscribe when you have processed the n messages (or a portion 
</I>&gt;<i> thereof) from your local queue.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> 
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001112.html">[rabbitmq-discuss] Load balancing with multiple consumers on a single queue
</A></li>
	<LI>Next message: <A HREF="001114.html">[rabbitmq-discuss] Load balancing with multiple consumers on a single queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1113">[ date ]</a>
              <a href="thread.html#1113">[ thread ]</a>
              <a href="subject.html#1113">[ subject ]</a>
              <a href="author.html#1113">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
