<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Load balancing with multiple consumers on a	single queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Load%20balancing%20with%20multiple%20consumers%20on%0A%20a%09single%20queue&In-Reply-To=6c2563b20807301738lf76c58ub2ffbaafc57281b2%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001110.html">
   <LINK REL="Next"  HREF="001104.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Load balancing with multiple consumers on a	single queue</H1>
    <B>David.Corcoran at edftrading.com</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Load%20balancing%20with%20multiple%20consumers%20on%0A%20a%09single%20queue&In-Reply-To=6c2563b20807301738lf76c58ub2ffbaafc57281b2%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Load balancing with multiple consumers on a	single queue">David.Corcoran at edftrading.com
       </A><BR>
    <I>Thu Jul 31 08:33:10 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001110.html">[rabbitmq-discuss] Load balancing with multiple consumers on a	single queue
</A></li>
        <LI>Next message: <A HREF="001104.html">[rabbitmq-discuss] Load balancing with multiple consumers on a single queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1111">[ date ]</a>
              <a href="thread.html#1111">[ thread ]</a>
              <a href="subject.html#1111">[ subject ]</a>
              <a href="author.html#1111">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Morning Edwin,

Unfortunately the polling can't work for us because a 100ms delay between
each basic.get is too long. A lot of our jobs are only a few ms. But when I
first started using RabbitMq I used basic.get and a 10ms delay with 250
consumers on 250 tcp connections (although we could easily need 500 or
more). At the time we were using Erlang 11b5 and RabbitMQ 1.3 and it didn't
handle it very well. Obviously in our tests the 250 different clients
weren't registering any cpu usage on their machines but RabbitMQ was at
100%.

I stopped the tests and moved onto consumers soon after.

Dave

<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A> wrote on 31/07/2008 01:38:18:

&gt;<i> I was curious about the cost of polling using basic.get, so I wrote
</I>&gt;<i> a small Erlang client program to start up 500 consumers, on one
</I>&gt;<i> TCP/IP channel, listening on one queue, each polling with a basic.
</I>&gt;<i> get every 100ms. I know this is a high rate, but I wanted to see how
</I>&gt;<i> it behaved.
</I>&gt;<i>
</I>&gt;<i> Maybe my code was naive or inefficient, but I found the polling
</I>&gt;<i> program's Linux process to be taking 85% CPU (and off the chart in
</I>&gt;<i> appmon), while Rabbit's process was about 30% (on a 4-core Intel
</I>&gt;<i> Q6600 box, hence CPU numbers don't add up to 100%). I haven't tried
</I>&gt;<i> it with the &quot;native&quot; client. It seemed to make no difference if
</I>&gt;<i> kernel poll was enabled.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i> Edwin
</I>&gt;<i>
</I>&gt;<i> Environment: Ubuntu Linux 8.04, 2.4 GHz Q6600, 8 GB RAM, Erlang
</I>&gt;<i> R12B-3, RabbitMQ 1.4.0, RabbitMQ Erlang client as of 2008/06/23.
</I>

*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001110.html">[rabbitmq-discuss] Load balancing with multiple consumers on a	single queue
</A></li>
	<LI>Next message: <A HREF="001104.html">[rabbitmq-discuss] Load balancing with multiple consumers on a single queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1111">[ date ]</a>
              <a href="thread.html#1111">[ thread ]</a>
              <a href="subject.html#1111">[ subject ]</a>
              <a href="author.html#1111">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
