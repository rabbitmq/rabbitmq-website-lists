<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Poor performance using a single RabbitMQ connection on high-latency networks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Poor%20performance%20using%20a%20single%20RabbitMQ%0A%20connection%20on%20high-latency%20networks&In-Reply-To=pan.2010.02.01.13.59.14.948750%40googlemail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006120.html">
   <LINK REL="Next"  HREF="006132.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Poor performance using a single RabbitMQ connection on high-latency networks</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Poor%20performance%20using%20a%20single%20RabbitMQ%0A%20connection%20on%20high-latency%20networks&In-Reply-To=pan.2010.02.01.13.59.14.948750%40googlemail.com"
       TITLE="[rabbitmq-discuss] Poor performance using a single RabbitMQ connection on high-latency networks">matthew at lshift.net
       </A><BR>
    <I>Mon Feb  1 14:50:37 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006120.html">[rabbitmq-discuss] Poor performance using a single RabbitMQ	connection on high-latency networks
</A></li>
        <LI>Next message: <A HREF="006132.html">[rabbitmq-discuss] Poor performance using a single RabbitMQ connection on high-latency networks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6124">[ date ]</a>
              <a href="thread.html#6124">[ thread ]</a>
              <a href="subject.html#6124">[ subject ]</a>
              <a href="author.html#6124">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Feb 01, 2010 at 02:59:16PM +0100, Holger Hoffstaette wrote:
&gt;<i> On Mon, 01 Feb 2010 13:33:16 +0000, Matthew Sackman wrote:
</I>&gt;<i> I've always been curious why the default values were so small - any good
</I>&gt;<i> reasons? What I find even more curious is why fixing the server side
</I>&gt;<i> affects TCP window handling, which should normally be negotiated by the
</I>&gt;<i> client. IIRC that only works properly when the server does not explicitly
</I>&gt;<i> configure anything and uses the OS defaults.
</I>
Hmm. Our defaults are
SERVER_ERL_ARGS=&quot;+K true +A30 \
-kernel inet_default_listen_options
[{nodelay,true},{sndbuf,16384},{recbuf,4096}] \
-kernel inet_default_connect_options [{nodelay,true}]&quot;

so the send buffer you've increased by 4, and the receive buffer by 16.
I'm sure we have had some reasons as to why they're set as they are, but
I'm afraid I don't know what they were. We have recently done some
investigation into the effect of different buffer sizes in the Java
client, but nothing recently going on wrt the server. I wonder whether
Matthias or Tony may recall why our server options are set as they are.

&gt;<i> &gt; We have fixed the problem by set send/receive buffers on server side.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; -kernel inet_default_listen_options
</I>&gt;<i> &gt; [{nodelay,true},{sndbuf,65535},{recbuf,65535}]
</I>&gt;<i> 
</I>&gt;<i> Good to know - I wanted to suggest that next as I always do that on my
</I>&gt;<i> rabbits even on LAN.
</I>
Indeed, I'm glad that's fixed. I'll raise a bug internally to have a
look at these options again. It's really a matter of providing some
sensible defaults - I'm sure that on every platform, things can be
improved by specific tunings, but it's a case of finding something that
works well out of the box.

If you have any comments or advice for us on these options then we're
certainly all ears.

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006120.html">[rabbitmq-discuss] Poor performance using a single RabbitMQ	connection on high-latency networks
</A></li>
	<LI>Next message: <A HREF="006132.html">[rabbitmq-discuss] Poor performance using a single RabbitMQ connection on high-latency networks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6124">[ date ]</a>
              <a href="thread.html#6124">[ thread ]</a>
              <a href="subject.html#6124">[ subject ]</a>
              <a href="author.html#6124">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
