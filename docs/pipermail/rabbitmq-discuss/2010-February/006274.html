<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] PHP Client libraries
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20PHP%20Client%20libraries&In-Reply-To=C796D19B.5D47%25pdezwart%40rubiconproject.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006271.html">
   <LINK REL="Next"  HREF="006276.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] PHP Client libraries</H1>
    <B>Pieter de Zwart</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20PHP%20Client%20libraries&In-Reply-To=C796D19B.5D47%25pdezwart%40rubiconproject.com"
       TITLE="[rabbitmq-discuss] PHP Client libraries">pdezwart at rubiconproject.com
       </A><BR>
    <I>Tue Feb  9 19:20:29 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006271.html">[rabbitmq-discuss] PHP Client libraries
</A></li>
        <LI>Next message: <A HREF="006276.html">[rabbitmq-discuss] PHP Client libraries
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6274">[ date ]</a>
              <a href="thread.html#6274">[ thread ]</a>
              <a href="subject.html#6274">[ subject ]</a>
              <a href="author.html#6274">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Good news. Seems like have a mostly working php-rabbit PHP module. Attached
is the patch to make it work with RabbitMQ 1.7*. For those of you less
familiar with building/managing PHP clients, perform the following commands:

$ wget <A HREF="http://php-rabbit.googlecode.com/files/php-rabbit.zip">http://php-rabbit.googlecode.com/files/php-rabbit.zip</A>
$ unzip php-rabbit.zip
$ cd php-rabbit
$ phpize
$ php &#173;I | head
Copy the current ./configure statement and execute it
$ patch rabbit.c php-rabbit.patch
$ make &amp;&amp; sudo make install
$ echo &#179;extension = /path/to/lib/folder/rabbit.so&#178; &gt; /etc/php.d/rabbit.ini
$ php &#173;m | grep rabbit
The last command should display &#179;rabbit&#178;, meaning that the library was
recognized.

I have also included a very basic test script that you can use to validate
that things are working. I tweaked it post test, so there might be some
typos in it.

I had to run:
$ sudo /sbin/ldconfig
to get the librabbitmq.so library to be pulled in, so please keep that in
mind.

If you have any questions, please let me know. There are still a few bugs,
two of which are:
1. During connection, if you specify additional parameters like
AMQP_DURABLE, the exchange type length is seen as 0, even if you specify
one, and it therefore defaults all new exchange types to &#140;direct&#185;. We use
topic exchanges here, so I tweaked it to default to &#140;topic&#185; until that gets
fixed. 
2. I managed to make it segfault by passing in a weird exchange name. I will
put together a demonstration script asap.

This patch fixes:
1. Names and typos. Everything is AMQP (not AQPM, etc..) and the connection
class is AMQPConnection, not AQMPConnect.
2. The library is now defined correctly, and should therefore load without
tweaking the configure or doing any other wonky things.
3. All of the METHOD_OK parameters are no longer dereferenced improperly
4. I added the heartbeat parameter to provide the valid number of parameters
to amqp_login

I am now going to go load test this thing to see if I can make it crash.

Pieter


On 2/9/10 8:47 AM, &quot;Pieter de Zwart&quot; &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">pdezwart at rubiconproject.com</A>&gt; wrote:

&gt;<i> Hey guys,
</I>&gt;<i> 
</I>&gt;<i> Just FYI, I have a mostly working php-rabbit patch. Using the demo script I
</I>&gt;<i> can declare, bind, publish and consume. I ran into a segfault when I tried to
</I>&gt;<i> incorporate it into our framework, so there is still some debugging to do
</I>&gt;<i> there.
</I>&gt;<i> I will submit a patch to everyone later today, with the understanding that I
</I>&gt;<i> make no guarantees as to whether it is production ready.
</I>&gt;<i> 
</I>&gt;<i> Pieter
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 2/9/10 3:00 AM, &quot;Alexandre Kalendarev&quot; &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">akalend at mail.ru</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Hi Dieter,
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> &gt; thank you for your reply. Am I right, the module does not support
</I>&gt;&gt;&gt;<i> &gt; consuming messages?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The module is support Consume and Get methods. But Consume
</I>&gt;&gt;<i> methods is sync and GET is async.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If You use the  the consume in the WEB pages, the HTTP protocol is async and
</I>&gt;&gt;<i> You can't wait if you have not commet technology.
</I>&gt;&gt;<i> My recomendation  is use the series of GET method:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> // get queue items
</I>&gt;&gt;<i> $queue = new AMQPQueue(APMQConection(), 'my_queue');
</I>&gt;&gt;<i> $i=0;
</I>&gt;&gt;<i> $res = true;
</I>&gt;&gt;<i> while ($res = $queue-&gt;get() !== false  ){
</I>&gt;&gt;<i>     $i++;
</I>&gt;&gt;<i>     echo &quot;$i : {$res['msg']}&lt;br&gt;\n&quot;;
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> But, You can use the Consume, You must the read queue lenght and make Consume
</I>&gt;&gt;<i> of len messages.
</I>&gt;&gt;<i> It is guarantie of absent waiting new messages.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> // consume
</I>&gt;&gt;<i> $i=0;
</I>&gt;&gt;<i> $queue = new AMQPQueue(APMQConection());
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> $n = $queue-&gt;declare('my_queue');  // we get the lenght of queue
</I>&gt;&gt;<i>   
</I>&gt;&gt;<i> $queueMessages = $queue-&gt;consume( $n ); // we reading $n messages,  all
</I>&gt;&gt;<i> queue.
</I>&gt;&gt;<i> foreach($queueMessages as $item){
</I>&gt;&gt;<i>   $i++;
</I>&gt;&gt;<i>   echo &quot;$i.$item&quot;;
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If $n less lenght of queue, the all nonreaded messages will be gone.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The Consume method is faster.
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> &gt;Or Am i mixing up the Modules?
</I>&gt;&gt;<i> the module php-amqp  <A HREF="http://code.google.com/p/php-amqp/">http://code.google.com/p/php-amqp/</A>   don't support
</I>&gt;&gt;<i> consume, bind and queue. It is only publish.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If You have any questions send me, I will very happeness ask You. Sorry for
</I>&gt;&gt;<i> my English.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Alexandre
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i> 
</I>
-- 
the rubicon project

PIETER DE ZWART | INTERFACES ENGINEER

&#128;&#128;&#128; P 310 207 0272 | x224
&#128;&#128;&#128; F 323 466 7119


1925 S. BUNDY  DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM &lt;<A HREF="http://www.rubiconproject.com/">http://www.rubiconproject.com/</A>&gt;


&#179;COMPANY OF THE YEAR&#178; ALWAYSON ONMEDIA 2009
#24 ON FAST COMPANY FAST 50 READER FAVORITES
2008  ALWAYSON 250 GLOBAL WINNER
2008 ALWAYSON ONMEDIA 100 WINNER
TWIISTUP3  BEST IN SHOW
PRICEWATERHOUSECOOPERS &#173; ENTRETECH  BEST STARTUP
AMERICAN BUSINESS AWARDS - STEVIES  &#140;08 FINALIST BEST NEW COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES &#140;08 FINALIST MOST INNOVATIVE COMPANY
AMERICAN BUSINESS  AWARDS - STEVIES &#140;08 FINALIST NEW PRODUCT OR SERVICE -
SERVICES

P          Please consider the environment before printing this e-mail

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/655aa139/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/655aa139/attachment.htm</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 28320 bytes
Desc: not available
Url : <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/655aa139/attachment.png">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/655aa139/attachment.png</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: php-rabbit.patch
Type: application/octet-stream
Size: 5660 bytes
Desc: not available
Url : <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/655aa139/attachment.obj">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/655aa139/attachment.obj</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-rabbit.php
Type: application/octet-stream
Size: 770 bytes
Desc: not available
Url : <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/655aa139/attachment-0001.obj">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100209/655aa139/attachment-0001.obj</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006271.html">[rabbitmq-discuss] PHP Client libraries
</A></li>
	<LI>Next message: <A HREF="006276.html">[rabbitmq-discuss] PHP Client libraries
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6274">[ date ]</a>
              <a href="thread.html#6274">[ thread ]</a>
              <a href="subject.html#6274">[ subject ]</a>
              <a href="author.html#6274">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
