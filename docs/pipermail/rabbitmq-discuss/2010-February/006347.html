<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] beam process using 100% cpu and lots of memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20beam%20process%20using%20100%25%20cpu%20and%20lots%20of%20memory&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006473.html">
   <LINK REL="Next"  HREF="006348.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] beam process using 100% cpu and lots of memory</H1>
    <B>Joel Heenan</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20beam%20process%20using%20100%25%20cpu%20and%20lots%20of%20memory&In-Reply-To="
       TITLE="[rabbitmq-discuss] beam process using 100% cpu and lots of memory">joelh at planetjoel.com
       </A><BR>
    <I>Mon Feb 15 23:51:31 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006473.html">[rabbitmq-discuss] message in queue
</A></li>
        <LI>Next message: <A HREF="006348.html">[rabbitmq-discuss] beam process using 100% cpu and lots of	memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6347">[ date ]</a>
              <a href="thread.html#6347">[ thread ]</a>
              <a href="subject.html#6347">[ subject ]</a>
              <a href="author.html#6347">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We are having a situation where when we put lots of data through a
RabbitMQ queue we sometimes we see a beam process running using 100%
cpu and up to 1.5GB (RSS) of memory. The only way to resolve this
situation is to restart RabbitMQ.

We are trying to trace down the exact conditions that cause the
problem, and I hope to also post up an strace and lsof of what it is
doing during this time and log messages.

I could not find anything particularly interesting in the rabbitmq.log file.

We are talking a very large number of connections here, 1807334
connections in 17 hours, or 29/second.

We started using RabbitMQ Stomp Server 1.6.0-5 then moved to version
latest public umbrella (as of 24 hours ago). OS is Centos 5.4 x86_64
Xen domU with 4GB of RAM and 1VCPU.

We are using persistent mode on the queues, currently testing with
non-persistent.

Joel


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006473.html">[rabbitmq-discuss] message in queue
</A></li>
	<LI>Next message: <A HREF="006348.html">[rabbitmq-discuss] beam process using 100% cpu and lots of	memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6347">[ date ]</a>
              <a href="thread.html#6347">[ thread ]</a>
              <a href="subject.html#6347">[ subject ]</a>
              <a href="author.html#6347">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
