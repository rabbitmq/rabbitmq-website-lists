<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Dead but still established connections in	RabbitMQ on EC2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Dead%20but%20still%20established%20connections%20in%0A%09RabbitMQ%20on%20EC2&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006170.html">
   <LINK REL="Next"  HREF="006159.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Dead but still established connections in	RabbitMQ on EC2</H1>
    <B>Mathias Meyer</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Dead%20but%20still%20established%20connections%20in%0A%09RabbitMQ%20on%20EC2&In-Reply-To="
       TITLE="[rabbitmq-discuss] Dead but still established connections in	RabbitMQ on EC2">meyer at paperplanes.de
       </A><BR>
    <I>Wed Feb  3 09:50:13 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006170.html">[rabbitmq-discuss] Is there more infos about AMQP 1.0 and	rabbitmq roadmap towards it?
</A></li>
        <LI>Next message: <A HREF="006159.html">[rabbitmq-discuss] Dead but still established connections in	RabbitMQ on EC2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6150">[ date ]</a>
              <a href="thread.html#6150">[ thread ]</a>
              <a href="subject.html#6150">[ subject ]</a>
              <a href="author.html#6150">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Mornin,

we had an odd situation yesterday where we fired up an EC2 instance
with a Ruby-based client (using the EventMachine-based AMQP lib) that
connected to our Rabbit (also running on an EC2 host) using its
external IP address. Some time after the client connected its host got
a new (elastic) IP address assigned. One of the two active connections
from the old IP was dropped as Rabbit received an according exception
on it, but the other wasn't, and is still established according to
lsof -i and netstat almost 24 hours later. Problem is that Rabbit
apparently tried to deliver messages to these sockets and noone picked
up. The client that reconnected from the new IP in the meantime did
not get the messages, only when I killed it and restarted it.

We've had that situation twice already, and while there's some ways to
work around that I'm wondering if there's some way to work around
that, some configuration tweak (like heartbeats or something) so that
Rabbit will recognize dead connections and close them?

We're using 1.7 (will try updating to 1.7.1 later today) without any
particular configuration tweaks.

Any help or pointers would be much appreciated.

Cheers, Mathias
-- 
<A HREF="http://paperplanes.de">http://paperplanes.de</A> | <A HREF="http://holgarific.net">http://holgarific.net</A>
<A HREF="http://twitter.com/roidrage">http://twitter.com/roidrage</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006170.html">[rabbitmq-discuss] Is there more infos about AMQP 1.0 and	rabbitmq roadmap towards it?
</A></li>
	<LI>Next message: <A HREF="006159.html">[rabbitmq-discuss] Dead but still established connections in	RabbitMQ on EC2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6150">[ date ]</a>
              <a href="thread.html#6150">[ thread ]</a>
              <a href="subject.html#6150">[ subject ]</a>
              <a href="author.html#6150">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
