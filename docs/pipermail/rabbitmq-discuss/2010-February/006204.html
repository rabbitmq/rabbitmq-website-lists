<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Poor performance using a single RabbitMQ	connection on high-latency networks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Poor%20performance%20using%20a%20single%20RabbitMQ%0A%09connection%20on%20high-latency%20networks&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006200.html">
   <LINK REL="Next"  HREF="006232.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Poor performance using a single RabbitMQ	connection on high-latency networks</H1>
    <B>Holger Hoffstaette</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Poor%20performance%20using%20a%20single%20RabbitMQ%0A%09connection%20on%20high-latency%20networks&In-Reply-To="
       TITLE="[rabbitmq-discuss] Poor performance using a single RabbitMQ	connection on high-latency networks">holger.hoffstaette at googlemail.com
       </A><BR>
    <I>Sat Feb  6 03:32:35 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006200.html">[rabbitmq-discuss] Poor performance using a single RabbitMQ connection on high-latency networks
</A></li>
        <LI>Next message: <A HREF="006232.html">[rabbitmq-discuss] Poor performance using a single RabbitMQ connection on high-latency networks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6204">[ date ]</a>
              <a href="thread.html#6204">[ thread ]</a>
              <a href="subject.html#6204">[ subject ]</a>
              <a href="author.html#6204">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 05 Feb 2010 16:59:50 +0000, Matthew Sackman wrote:

&gt;<i> I've just done some testing and found that removing our settings and
</I>&gt;<i> relying on the OS to set them does not, in any case I can come up with,
</I>&gt;<i> improve performance. I'm curious - you've said that you always set them to
</I>&gt;<i> 65536, and there certainly seems to be evidence that that helps over
</I>&gt;<i> WANs.
</I>
I just tend to remove them and use the host defaults out of
habit; this gave the best results in the one case where I needed to have
an eye on production performance. That was over a year ago though.

The part that I found curious was why fixing the server values worked
for Vladimir, whereas changing the client did apparently not - even though
that's where the connection originated. This could have been caused by a
peculiar behaviour of the broker, erlang or something else. Don't know
really.

&gt;<i> But what about with no explicit setting of sndbuf and recbuf over WANs. Is
</I>&gt;<i> the performance the same as manually setting to 65536, or the same as our
</I>&gt;<i> explicit defaults, or something else?
</I>
Err..I wasn't the original poster of this thread and don't even have
Rabbit running over a WAN. I guess that's for Vladimir to answer.

FWIW the max initial window size without window scaling is 65535 (16 bit)
so anything larger may or may not work out correctly, especially through
routers or firewalls. If you really want to know what a client and server
agree on you'll need to fire up Wireshark and look at the first SYN/ACK
sequence on connection establishment. This may (hopefully will) then be
scaled up dynamically as data starts to flow.
See e.g.: <A HREF="http://support.novell.com/techcenter/articles/ana20021203.html">http://support.novell.com/techcenter/articles/ana20021203.html</A>
(ignore the Netware bits ;)

This rabbit hole goes deep..

Holger




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006200.html">[rabbitmq-discuss] Poor performance using a single RabbitMQ connection on high-latency networks
</A></li>
	<LI>Next message: <A HREF="006232.html">[rabbitmq-discuss] Poor performance using a single RabbitMQ connection on high-latency networks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6204">[ date ]</a>
              <a href="thread.html#6204">[ thread ]</a>
              <a href="subject.html#6204">[ subject ]</a>
              <a href="author.html#6204">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
