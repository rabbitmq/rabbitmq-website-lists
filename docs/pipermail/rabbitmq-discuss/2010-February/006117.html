<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] PubSub - all bindings have to be in memory?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20PubSub%20-%20all%20bindings%20have%20to%20be%20in%20memory%3F&In-Reply-To=b0200d7f1001312158g1437c8b4y123e5af00dfd5fa6%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006109.html">
   <LINK REL="Next"  HREF="006119.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] PubSub - all bindings have to be in memory?</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20PubSub%20-%20all%20bindings%20have%20to%20be%20in%20memory%3F&In-Reply-To=b0200d7f1001312158g1437c8b4y123e5af00dfd5fa6%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] PubSub - all bindings have to be in memory?">matthew at lshift.net
       </A><BR>
    <I>Mon Feb  1 13:43:15 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006109.html">[rabbitmq-discuss] PubSub - all bindings have to be in memory?
</A></li>
        <LI>Next message: <A HREF="006119.html">[rabbitmq-discuss] PubSub - all bindings have to be in memory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6117">[ date ]</a>
              <a href="thread.html#6117">[ thread ]</a>
              <a href="subject.html#6117">[ subject ]</a>
              <a href="author.html#6117">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Ben,

On Mon, Feb 01, 2010 at 07:58:52AM +0200, Ben Browitt wrote:
&gt;<i> Do I have to keep all bindings in memory or is there a mode where rabbitmq
</I>&gt;<i> can read binding keys from disk when needed?
</I>
I'm afraid bindings are all kept in RAM. The binding record is quite
small (dependent on the size of the exchange name, binding key, queue
name and any args - minimising these will help reduce memory foot print)
so you should be able to fit quite a lot of them in RAM:

&gt;<i> erts_debug:flat_size(#binding{exchange_name = &lt;&lt;&quot;my_exchange&quot;&gt;&gt;, queue_name = &lt;&lt;&quot;my_queue&quot;&gt;&gt;, key = &lt;&lt;&quot;my_key&quot;&gt;&gt;, args = []}).
</I>24

So just 24 bytes for that record, though obviously with padding and
longer field values, this will grow. Fixed size values here would help -
if for example you're able to use md5sums to get the exchange name and
queue name, and only use fanout or direct exchanges, and thus have an
fixed sized hash for the binding key too, then that'll make estimations
easier.

If you can estimate given, say, twice your expected number of visitors
and twice the expected number of articles they subscribe to how many
bindings that would result in, then you may be able to satisfy yourself
whether or not this is going to be a problem.

Whilst the new persister is able to page messages out to disk, we have
no plans just at the moment to be able to do the same for bindings.

Please let us know how you get on.

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006109.html">[rabbitmq-discuss] PubSub - all bindings have to be in memory?
</A></li>
	<LI>Next message: <A HREF="006119.html">[rabbitmq-discuss] PubSub - all bindings have to be in memory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6117">[ date ]</a>
              <a href="thread.html#6117">[ thread ]</a>
              <a href="subject.html#6117">[ subject ]</a>
              <a href="author.html#6117">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
