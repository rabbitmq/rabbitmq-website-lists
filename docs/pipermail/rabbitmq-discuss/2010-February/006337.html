<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem concurrency isue with rabbitmq (branch bug21673)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Problem%20concurrency%20isue%20with%20rabbitmq%0A%20%28branch%20bug21673%29&In-Reply-To=401b577e1002151140j654cfeepfcd87ed9eaefa7ea%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006335.html">
   <LINK REL="Next"  HREF="006341.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem concurrency isue with rabbitmq (branch bug21673)</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Problem%20concurrency%20isue%20with%20rabbitmq%0A%20%28branch%20bug21673%29&In-Reply-To=401b577e1002151140j654cfeepfcd87ed9eaefa7ea%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Problem concurrency isue with rabbitmq (branch bug21673)">matthew at lshift.net
       </A><BR>
    <I>Mon Feb 15 20:10:14 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006335.html">[rabbitmq-discuss] Problem concurrency isue with rabbitmq (branch	bug21673)
</A></li>
        <LI>Next message: <A HREF="006341.html">[rabbitmq-discuss] Problem concurrency isue with rabbitmq	(branch bug21673)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6337">[ date ]</a>
              <a href="thread.html#6337">[ thread ]</a>
              <a href="subject.html#6337">[ subject ]</a>
              <a href="author.html#6337">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Feb 15, 2010 at 11:40:20AM -0800, scott w wrote:
&gt;<i> We are also noticing that rabbitmq branch bug 21673 seems to hang after
</I>&gt;<i> placing a severe amount of load on it. I don't know erlang but is there some
</I>&gt;<i> way I can do a thread dump to send to you guys to help determine what the
</I>&gt;<i> problem might be?
</I>
Let me guess. You send an awful lot of messages into RabbitMQ, and then
you start reading from the queue, and you find it takes some time before
the first message pops out?

If so, that's entirely expected. What you're seeing is the fact that
writes, being async, allow a large backlog of pending disk activity to
grow, bounded by available RAM. When a read occurs, except in some
special circumstances, you have no choice but to let those writes hit
disk before you can read them - you can't risk a read overtaking a
write.

However, that said, I'm now thinking that there are some situations in
which allowing a read to have a higher priority than a write would be
safe... I shall have a play. If you could confirm that this is the
scenario you're seeing that'd be great. In general, you should be able
to identify this situation by a high(ish) load average, but no CPU
activity and your disks being burnt to a cinder. A 15kRPM SAS Fiber
Channel 8-disk RAID 0 array /may/ help here :P

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006335.html">[rabbitmq-discuss] Problem concurrency isue with rabbitmq (branch	bug21673)
</A></li>
	<LI>Next message: <A HREF="006341.html">[rabbitmq-discuss] Problem concurrency isue with rabbitmq	(branch bug21673)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6337">[ date ]</a>
              <a href="thread.html#6337">[ thread ]</a>
              <a href="subject.html#6337">[ subject ]</a>
              <a href="author.html#6337">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
