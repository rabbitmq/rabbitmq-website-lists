<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Fwd: Client-connection failover workarounds (ruby)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Fwd%3A%20Client-connection%20failover%20workarounds%0A%20%28ruby%29&In-Reply-To=670a00381002030421w53fce458k21c1b0a5df8cb2ce%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006155.html">
   <LINK REL="Next"  HREF="006233.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Fwd: Client-connection failover workarounds (ruby)</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Fwd%3A%20Client-connection%20failover%20workarounds%0A%20%28ruby%29&In-Reply-To=670a00381002030421w53fce458k21c1b0a5df8cb2ce%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Fwd: Client-connection failover workarounds (ruby)">matthias at lshift.net
       </A><BR>
    <I>Sat Feb  6 18:42:19 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006155.html">[rabbitmq-discuss] Fwd: Client-connection failover workarounds	(ruby)
</A></li>
        <LI>Next message: <A HREF="006233.html">[rabbitmq-discuss] Fwd: Client-connection failover workarounds	(ruby)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6206">[ date ]</a>
              <a href="thread.html#6206">[ thread ]</a>
              <a href="subject.html#6206">[ subject ]</a>
              <a href="author.html#6206">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Peter,

Peter Fitzgibbons wrote:
&gt;<i> I'm thinking about how to handle client-connection failover.  By this
</I>&gt;<i> I mean clientA has a producerP that needs to have reliable and
</I>&gt;<i> tolerant connections to rabbitA and rabbitB.  This is so that if the
</I>&gt;<i> connection/pid of rabbitA goes down, producerP sends it's next message
</I>&gt;<i> to rabbitB with as little handling (and wall-clock time) as possible.
</I>&gt;<i> [...]
</I>&gt;<i> The best solution I can think of right now is to have a rabbitP on the
</I>&gt;<i> same machine as producerP, which is clustered to the &quot;real&quot; cluster,
</I>&gt;<i> so if rabbitA goes down, the built-in clustering failover will handle
</I>&gt;<i> the proper interaction.  My issue with this is considering how this is
</I>&gt;<i> configured and maintained when the farm of servers with producerP gets
</I>&gt;<i> to be 1000+.  Even if this doesn't scale to the google-farm level,
</I>&gt;<i> what about farm = 10, 30 ?
</I>
Having a local broker is indeed a common approach to get higher 
resilience, particularly since it allows producers to offload messages 
even when the connection to the main brokers is down for prolonged 
periods of time, e.g. in the event the main brokers are across a WAN and 
there is a WAN failure.

As you suspect, making all these brokers part of a cluster would indeed 
be problematic for high node counts, even more so when going across a 
WAN. Besides, RabbitMQ's clustering is really designed for scaling, not 
improved reliability.

But you do not need to cluster the brokers. Instead you could stick our 
experimental shovel (see 
<A HREF="http://www.lshift.net/blog/2010/02/01/rabbitmq-shovel-message-relocation-equipment">http://www.lshift.net/blog/2010/02/01/rabbitmq-shovel-message-relocation-equipment</A>) 
onto each local node and configure it to shovel messages to the main 
broker pair. The shovel has built-in re-connection and failover logic 
for that.

Of course having a local broker is no panacea for reliability, since 
that broker itself becomes a point of failure. Whether that is a problem 
depends on how high you place the reliability bar.

An alternative approachh is to make the clients themselves deal with 
re-connection and failover. Check out the experimental 
<A HREF="http://hg.rabbitmq.com/rabbitmq-java-messagepatterns/">http://hg.rabbitmq.com/rabbitmq-java-messagepatterns/</A> and 
<A HREF="http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/">http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/</A> libraries which 
do that for a specific type of messaging (point-to-point, though most of 
the logic should be easily ported to other types).


Regards,

Matthias


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006155.html">[rabbitmq-discuss] Fwd: Client-connection failover workarounds	(ruby)
</A></li>
	<LI>Next message: <A HREF="006233.html">[rabbitmq-discuss] Fwd: Client-connection failover workarounds	(ruby)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6206">[ date ]</a>
              <a href="thread.html#6206">[ thread ]</a>
              <a href="subject.html#6206">[ subject ]</a>
              <a href="author.html#6206">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
