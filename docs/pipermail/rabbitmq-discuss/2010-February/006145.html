<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] routing threads on a rabbitmq node
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20routing%20threads%20on%20a%20rabbitmq%20node&In-Reply-To=b93cb8621002021345l59d1f1adt3cd3c3773a5545a9%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006144.html">
   <LINK REL="Next"  HREF="006166.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] routing threads on a rabbitmq node</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20routing%20threads%20on%20a%20rabbitmq%20node&In-Reply-To=b93cb8621002021345l59d1f1adt3cd3c3773a5545a9%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] routing threads on a rabbitmq node">matthias at lshift.net
       </A><BR>
    <I>Wed Feb  3 02:00:37 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006144.html">[rabbitmq-discuss] routing threads on a rabbitmq node
</A></li>
        <LI>Next message: <A HREF="006166.html">[rabbitmq-discuss] routing threads on a rabbitmq node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6145">[ date ]</a>
              <a href="thread.html#6145">[ thread ]</a>
              <a href="subject.html#6145">[ subject ]</a>
              <a href="author.html#6145">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Brian,

Brian Sullivan wrote:
&gt;<i> 1) How many msgs/second are being published for this issue to occur?
</I>&gt;<i>  From a single producer, about 900 messages/sec during these burst 
</I>&gt;<i> catchup periods.  Normal volumes then drop down to 300-500 mps 
</I>&gt;<i> throughout the day, which we can keep up with for the most part.  Note 
</I>&gt;<i> that there are 8-9 such producers, distributed across 2 nodes.
</I>
So that's a 900Hz * 9 = 8.1kHz peak inbound rate?

&gt;<i> 4) How many queues do messages end up in, on average?
</I>&gt;<i> About the same number of bindings - 75.  We don't do many multiple 
</I>&gt;<i> bindings per queue (if any).
</I>
8.1kHz inbound with a 75x fan-out ratio would require an outbound rate 
of &gt;600kHz, which is way more than a two-node rabbit cluster can handle. 
So some backlog will certainly build up.

It will take a while for messages to make it into queues. This isn't 
helped by lack of optimisation in two areas of the server code:

- topic exchanges. As you know, they are currently totally unoptimised 
and the cost of determining the queues a message should be routed to is 
linear in the total number of bindings on the exchage. How many bindings 
are there in total in your case? If you can, please use a direct exchange.

- cross-node routing in a cluster. A while ago we had to remove 
optimised cross-node routing since it turned out to break certain effect 
visibility guarantees required by AMQP. As a result, routing a message 
to N queues residing on a different node will result in N network 
transmissions of the message to that node, and N copies of the message 
at the node. If you can, don't use clustering or at least avoid 
configurations where producers and consumers connect to different nodes.


Regards,

Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006144.html">[rabbitmq-discuss] routing threads on a rabbitmq node
</A></li>
	<LI>Next message: <A HREF="006166.html">[rabbitmq-discuss] routing threads on a rabbitmq node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6145">[ date ]</a>
              <a href="thread.html#6145">[ thread ]</a>
              <a href="subject.html#6145">[ subject ]</a>
              <a href="author.html#6145">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
