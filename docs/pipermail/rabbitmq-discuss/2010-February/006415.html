<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ (branch bug21673) running out of	file descriptors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20%28branch%20bug21673%29%20running%20out%20of%0A%09file%20descriptors&In-Reply-To=ae4b61c1002180738x5b5c5bb2i5b8f845e33a94827%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006402.html">
   <LINK REL="Next"  HREF="006411.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ (branch bug21673) running out of	file descriptors</H1>
    <B>Andrey Smirnov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20%28branch%20bug21673%29%20running%20out%20of%0A%09file%20descriptors&In-Reply-To=ae4b61c1002180738x5b5c5bb2i5b8f845e33a94827%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] RabbitMQ (branch bug21673) running out of	file descriptors">smirnov.andrey at gmail.com
       </A><BR>
    <I>Fri Feb 19 15:49:57 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006402.html">[rabbitmq-discuss] RabbitMQ (branch bug21673) running out of	file descriptors
</A></li>
        <LI>Next message: <A HREF="006411.html">[rabbitmq-discuss] WCF bindings support SOAP -- what would be	invovled in others?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6415">[ date ]</a>
              <a href="thread.html#6415">[ thread ]</a>
              <a href="subject.html#6415">[ subject ]</a>
              <a href="author.html#6415">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>24 hours with new version - still running fine.

Thanks for the quick fix!

2010/2/18 Andrey Smirnov &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">smirnov.andrey at gmail.com</A>&gt;:
&gt;<i> Thanks a lot, Matthew!
</I>&gt;<i>
</I>&gt;<i> Rebuilt from source, running currently with new version. Will report
</I>&gt;<i> back how it goes.
</I>&gt;<i>
</I>&gt;<i> Actually I have about 13 TCP connections to broker and this number is
</I>&gt;<i> pretty steady.
</I>&gt;<i>
</I>&gt;<i> 2010/2/18 Matthew Sackman &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at lshift.net</A>&gt;:
</I>&gt;&gt;<i> Hi Andrey,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Thu, Feb 18, 2010 at 10:58:34AM +0300, Andrey Smirnov wrote:
</I>&gt;&gt;&gt;<i> We're running RabbitMQ from branch bug21673 (built yesterday). We have
</I>&gt;&gt;&gt;<i> a lot of non-persisten queues (2k - 10k+) that are created/destroyed
</I>&gt;&gt;&gt;<i> all the time. Some queues have unconsumed messaged and they will get
</I>&gt;&gt;&gt;<i> destroyed with unconsumed messages.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> When file descriptor limit for RabbitMQ was left to default 1024 files
</I>&gt;&gt;&gt;<i> it was dying in 2 hours. I've raised the limit to 10240 files and it
</I>&gt;&gt;&gt;<i> worked for 16 hours and crashed.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Crash for clients looks like &quot;INTERNAL_ERROR&quot; error on connections.
</I>&gt;&gt;&gt;<i> RabbitMQ is still running and eating 100% of CPU. Restarting RabbitMQ
</I>&gt;&gt;&gt;<i> helps to revive it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Many thanks for the bug report. The short version is that this is now
</I>&gt;&gt;<i> Fixed - if you pull again and rebuild, it should all &quot;just work&quot; now.
</I>&gt;&gt;<i> The long version is in the commit comment
</I>&gt;&gt;<i> (<A HREF="http://hg.rabbitmq.com/rabbitmq-server/rev/56a0daed8b4e">http://hg.rabbitmq.com/rabbitmq-server/rev/56a0daed8b4e</A>). I can now
</I>&gt;&gt;<i> artificially limit Rabbit to approx 3 file descriptors, and it still
</I>&gt;&gt;<i> runs some fairly aggressive tests perfectly well. Note that whilst on
</I>&gt;&gt;<i> branch bug21673, Rabbit is able to very flexibly redistribute file
</I>&gt;&gt;<i> handles as necessary, this obviously doesn't apply to sockets. So you
</I>&gt;&gt;<i> should make sure you always have at least, say, 100 more file
</I>&gt;&gt;<i> descriptors available to Rabbit than you need sockets.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Please try retesting - provided you don't have more than about 900
</I>&gt;&gt;<i> simultaneous connections open, you shouldn't need to raise the ulimit
</I>&gt;&gt;<i> above 1024, though you might find performance improves if you do.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Do let us know how you get on.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Matthew
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Andrey Smirnov,
</I>&gt;<i> phone. +7 (905) 769-83-20
</I>&gt;<i>
</I>


-- 
Andrey Smirnov,
phone. +7 (905) 769-83-20


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006402.html">[rabbitmq-discuss] RabbitMQ (branch bug21673) running out of	file descriptors
</A></li>
	<LI>Next message: <A HREF="006411.html">[rabbitmq-discuss] WCF bindings support SOAP -- what would be	invovled in others?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6415">[ date ]</a>
              <a href="thread.html#6415">[ thread ]</a>
              <a href="subject.html#6415">[ subject ]</a>
              <a href="author.html#6415">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
