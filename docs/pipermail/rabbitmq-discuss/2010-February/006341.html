<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem concurrency isue with rabbitmq	(branch bug21673)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Problem%20concurrency%20isue%20with%20rabbitmq%0A%09%28branch%20bug21673%29&In-Reply-To=20100215201014.GB7472%40wellquite.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006337.html">
   <LINK REL="Next"  HREF="006342.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem concurrency isue with rabbitmq	(branch bug21673)</H1>
    <B>scott w</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Problem%20concurrency%20isue%20with%20rabbitmq%0A%09%28branch%20bug21673%29&In-Reply-To=20100215201014.GB7472%40wellquite.org"
       TITLE="[rabbitmq-discuss] Problem concurrency isue with rabbitmq	(branch bug21673)">scottblanc at gmail.com
       </A><BR>
    <I>Mon Feb 15 20:36:12 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006337.html">[rabbitmq-discuss] Problem concurrency isue with rabbitmq (branch bug21673)
</A></li>
        <LI>Next message: <A HREF="006342.html">[rabbitmq-discuss] Problem concurrency isue with rabbitmq (branch bug21673)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6341">[ date ]</a>
              <a href="thread.html#6341">[ thread ]</a>
              <a href="subject.html#6341">[ subject ]</a>
              <a href="author.html#6341">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matthew --

I'm not sure that's the problem. Things were running fine for a day or so
and then all the sudden we found our ruby and java clients could not longer
pull things out of the queue. I have a little multi-threaded performance
tool I use which just writes out some messages and reads back the same
messages on a single queue and I have never had a problem with it before.
When I pointed it at the machine that had high load and which the clients
weren't able to connect to, it was not able to receive any messages at all
even after sitting there for a minute. When I pointed it at the other
machine it was working fine. Interestingly, after some time the 2nd machine
which had similarly high load (we round robin queue tasks across two
machines) stopped working after a few hours as well.

Let me know what other info I can give you to help diagnose this.

thanks,
Scott

On Mon, Feb 15, 2010 at 12:10 PM, Matthew Sackman &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at lshift.net</A>&gt;wrote:

&gt;<i> On Mon, Feb 15, 2010 at 11:40:20AM -0800, scott w wrote:
</I>&gt;<i> &gt; We are also noticing that rabbitmq branch bug 21673 seems to hang after
</I>&gt;<i> &gt; placing a severe amount of load on it. I don't know erlang but is there
</I>&gt;<i> some
</I>&gt;<i> &gt; way I can do a thread dump to send to you guys to help determine what the
</I>&gt;<i> &gt; problem might be?
</I>&gt;<i>
</I>&gt;<i> Let me guess. You send an awful lot of messages into RabbitMQ, and then
</I>&gt;<i> you start reading from the queue, and you find it takes some time before
</I>&gt;<i> the first message pops out?
</I>&gt;<i>
</I>&gt;<i> If so, that's entirely expected. What you're seeing is the fact that
</I>&gt;<i> writes, being async, allow a large backlog of pending disk activity to
</I>&gt;<i> grow, bounded by available RAM. When a read occurs, except in some
</I>&gt;<i> special circumstances, you have no choice but to let those writes hit
</I>&gt;<i> disk before you can read them - you can't risk a read overtaking a
</I>&gt;<i> write.
</I>&gt;<i>
</I>&gt;<i> However, that said, I'm now thinking that there are some situations in
</I>&gt;<i> which allowing a read to have a higher priority than a write would be
</I>&gt;<i> safe... I shall have a play. If you could confirm that this is the
</I>&gt;<i> scenario you're seeing that'd be great. In general, you should be able
</I>&gt;<i> to identify this situation by a high(ish) load average, but no CPU
</I>&gt;<i> activity and your disks being burnt to a cinder. A 15kRPM SAS Fiber
</I>&gt;<i> Channel 8-disk RAID 0 array /may/ help here :P
</I>&gt;<i>
</I>&gt;<i> Matthew
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100215/f634f7dc/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100215/f634f7dc/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006337.html">[rabbitmq-discuss] Problem concurrency isue with rabbitmq (branch bug21673)
</A></li>
	<LI>Next message: <A HREF="006342.html">[rabbitmq-discuss] Problem concurrency isue with rabbitmq (branch bug21673)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6341">[ date ]</a>
              <a href="thread.html#6341">[ thread ]</a>
              <a href="subject.html#6341">[ subject ]</a>
              <a href="author.html#6341">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
