<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET) writing to queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Receiving%20errno%2010054%20%28WSAECONNRESET%29%0A%20writing%20to%20queue&In-Reply-To=ebcef6281002072354h2d53613bj3c4041b8b8cf9259%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006224.html">
   <LINK REL="Next"  HREF="006257.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET) writing to queue</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Receiving%20errno%2010054%20%28WSAECONNRESET%29%0A%20writing%20to%20queue&In-Reply-To=ebcef6281002072354h2d53613bj3c4041b8b8cf9259%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET) writing to queue">matthias at lshift.net
       </A><BR>
    <I>Mon Feb  8 20:53:12 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006224.html">[rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET)	writing to queue
</A></li>
        <LI>Next message: <A HREF="006257.html">[rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET)	writing to queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6248">[ date ]</a>
              <a href="thread.html#6248">[ thread ]</a>
              <a href="subject.html#6248">[ subject ]</a>
              <a href="author.html#6248">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sigurd,

Sigurd H&#248;gsbro wrote:
&gt;<i> =WARNING REPORT==== 7-Feb-2010::09:56:35 ===
</I>&gt;<i> exception on TCP connection &lt;0.835.5&gt; from 127.0.0.1:47539
</I>&gt;<i> connection_closed_abruptly
</I>
That indicates that the client closed the connection. Or the network died.

&gt;<i> I used to have immediate and mandatory flags set but I've removed
</I>&gt;<i> these to make the connection as plain vanilla as possible.
</I>
With these flags set the server may send 'basic.return' commands to the 
client. Perhaps amqplib doesn't handle these and dies?

&gt;<i> I injected the java Tracer into the path, and spotted a Connection.tune 
</I>&gt;<i> method with interesting parameters:
</I>
&gt;<i> 1265609050961: conn#0 ch#0 &lt;- 
</I>&gt;<i> {#method&lt;connection.tune&gt;(channel-max=0,frame-max=131072,heartbeat=0),null,&quot;&quot;}
</I>&gt;<i> 1265609051002: conn#0 ch#0 -&gt; 
</I>&gt;<i> {#method&lt;connection.tune-ok&gt;(channel-max=65535,frame-max=131072,heartbeat=0),null,&quot;&quot;}
</I>
&gt;<i> This led me to the discussion 
</I>&gt;<i> on <A HREF="http://www.amqp.org/jira/browse/AMQP-108,">http://www.amqp.org/jira/browse/AMQP-108,</A> suggesting that there is an 
</I>&gt;<i> upper limit on AMQP payload of a 16-bit number in versions 0.8/0.9. 
</I>
That discussion pertains to 0-10 work in progress at the time. In AMQP 
0-8/9/9-1 the frame size is encoded in a 32 bit field and the frame-max 
field in connection.tune/tune-ok is 32 bit wide too. So the above values 
are perfectly fine.

Also note that the frame size does not limit the message size, since 
messages can be split across multiple frames. All our supported client 
libraries do that automatically but it's possible that amqplib doesn't.

&gt;<i> I'll try patching py-amqplib to take frame-max in kwargs, but any other 
</I>&gt;<i> gotchas you can think of would be appreciated?
</I>
Try to get a trace that includes the connection disappearance. The 
pattern of commands just prior to that might shed some light on what 
causes the client to trip up.

&gt;<i> Would I be better off trying Tony's PIKA?
</I>
Feel free to give it a try, but since we do not know what the problem is 
there is no way to tell in advance whether it will fare any better.


Regards,

Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006224.html">[rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET)	writing to queue
</A></li>
	<LI>Next message: <A HREF="006257.html">[rabbitmq-discuss] Receiving errno 10054 (WSAECONNRESET)	writing to queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6248">[ date ]</a>
              <a href="thread.html#6248">[ thread ]</a>
              <a href="subject.html#6248">[ subject ]</a>
              <a href="author.html#6248">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
