<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Behaviour change from rabbitMQ v1.7.0 to v1.7.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Behaviour%20change%20from%20rabbitMQ%20v1.7.0%20to%20v1.7.1&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006383.html">
   <LINK REL="Next"  HREF="006418.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Behaviour change from rabbitMQ v1.7.0 to v1.7.1</H1>
    <B>Arun Suresh</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Behaviour%20change%20from%20rabbitMQ%20v1.7.0%20to%20v1.7.1&In-Reply-To="
       TITLE="[rabbitmq-discuss] Behaviour change from rabbitMQ v1.7.0 to v1.7.1">arun.suresh at gmail.com
       </A><BR>
    <I>Thu Feb 18 04:06:00 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006383.html">[rabbitmq-discuss] Changelogs for releases?
</A></li>
        <LI>Next message: <A HREF="006418.html">[rabbitmq-discuss] Behaviour change from rabbitMQ v1.7.0 to	v1.7.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6386">[ date ]</a>
              <a href="thread.html#6386">[ thread ]</a>
              <a href="subject.html#6386">[ subject ]</a>
              <a href="author.html#6386">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

We are currently using RabbitMQ 1.7.0 and we'd like to move to 1.7.2 but we
have noticed a fundamental behavior change across these versions. Let me
explain:

1) Assume we have a cluster of RabbitMQ nodes... '<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at host1</A>' and
'<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at host2</A>'
2) 'client1' connects to '<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at host1</A>', declares an exchange 'test_x' and
then declares a q 'test_queue' and binds to it.
3) 'client2' being of the same codebase as 'client1' on starting up connects
to '<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at host2</A>' and does the same thing as 'client1'.

At this point of time, If we do a 'rabbitmqctl list_queues consumers name
node' the response we get is:

2        test_queue         <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at host1</A>

Our reason for doing this was that a message sent to the 'test_x' exchange
would be consumed by either of the clients.

Now..

4) Assume '<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at host1</A>' node goes down (machine crash, becomes
unreachable... whatever)
5) 'client1' detects the outage and tries connecting to '<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at host2</A>'...
and the mq connection startup code kicks in.. thus.. the queue 'test_queue'
is recreated on '<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at host2</A>'

Now... If we do a 'rabbitmqctl list_queues consumers name node' the response
we get is:

1        test_queue         <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at host2</A>

As u can see we have only one consumer...

To fix this isuue... we get 'client1' to notify all other clients of a
network outage.. 'client2' intercepts this message and promptly reconnects
to '<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at host2</A>' and again binds to 'test_queue'.
Everyone is happy...

Unfortunately... we have noticed that from 1.7.1, step 4 goes for a toss..

if '<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at host1</A>' goes down, 'client1' cannot recreate 'test_queue' on
'<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at host2</A>'.
Do this imply that... all queues created on the node WILL be unavailable for
the duration of the nodes outage ??
Which means there wont be any consumers for messages sent to the exchange
for the duration of the outage..

I was wondering if anybody could probably shed some light on :
1) Why this change in behaviour ?
2) What is the suggested approach to tackle these types of availability
issues in rabbitMQ ?

Thanx in advance
-Arun Suresh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100218/09f5aada/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100218/09f5aada/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006383.html">[rabbitmq-discuss] Changelogs for releases?
</A></li>
	<LI>Next message: <A HREF="006418.html">[rabbitmq-discuss] Behaviour change from rabbitMQ v1.7.0 to	v1.7.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6386">[ date ]</a>
              <a href="thread.html#6386">[ thread ]</a>
              <a href="subject.html#6386">[ subject ]</a>
              <a href="author.html#6386">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
